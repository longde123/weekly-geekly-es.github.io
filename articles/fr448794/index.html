<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§Æ ‚öïÔ∏è ü§±üèæ Test Python avec pytest. Plugins CHAPITRE 5 „äôÔ∏è üêû üìØ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Retour Suivant 


 Un pytest puissant d√®s la sortie de la bo√Æte, il devient encore meilleur lorsque vous y ajoutez un m√©lange de plugins. La base de c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Test Python avec pytest. Plugins CHAPITRE 5</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448794/"><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Retour</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Suivant</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p><br><p>  <em>Un pytest puissant d√®s la sortie de la bo√Æte, il devient encore meilleur lorsque vous y ajoutez un m√©lange de plugins.</em>  <em>La base de code pytest est structur√©e par des param√®tres et des extensions, et il existe des crochets disponibles pour la modification et l'am√©lioration via des plugins.</em> </p><br><p><img src="https://habrastorage.org/webt/hd/--/9w/hd--9w134j0rxhmxftrflbbdopy.png"></p><a name="habracut"></a><br><p>  Les exemples de ce livre sont √©crits en utilisant Python 3.6 et pytest 3.2.  pytest 3.2 prend en charge Python 2.6, 2.7 et Python 3.3+. </p><br><blockquote> Le code source du projet T√¢ches, ainsi que pour tous les tests pr√©sent√©s dans ce livre, est disponible sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="https://pragprog.com/titles/bopytest/source_code">lien</a> sur la page Web du livre √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="https://pragprog.com/titles/bopytest">pragprog.com</a> .  Vous n'avez pas besoin de t√©l√©charger le code source pour comprendre le code de test;  le code de test est pr√©sent√© sous une forme pratique dans les exemples.  Mais pour suivre les t√¢ches du projet ou adapter des exemples de test pour tester votre propre projet (vos mains ne sont pas li√©es!), Vous devez vous rendre sur la page Web du livre et t√©l√©charger le travail.  L√†, sur la page Web du livre, il y a un lien pour les messages d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="https://pragprog.com/titles/bopytest/errata">erreur</a> et un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="https://forums.pragprog.com/forums/438">forum de discussion</a> . </blockquote><p>  Sous le spoiler se trouve une liste d'articles de cette s√©rie. </p><br><div class="spoiler">  <b class="spoiler_title">Table des mati√®res</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><strong>Pr√©sentation</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><strong>Chapitre 1: Premiers pas avec Pytest</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><strong>Chapitre 2: √âcriture des fonctions de test</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><strong>Chapitre 3: Appareils Pytest</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><strong>Chapitre 4: Luminaires int√©gr√©s</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><strong>Chapitre 5: Plugins</strong></a> (Cet article) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><strong>Chapitre 6: Configuration</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><strong>Chapitre 7: Utilisation de pytest avec d'autres outils</strong></a> </li></ul></div></div><br><h2 id="poehali-dalshe">  Allons plus loin! </h2><br><p> Vous pourriez √™tre surpris d'apprendre que vous avez d√©j√† √©crit des plugins si vous avez parcouru les chapitres pr√©c√©dents de ce livre.  Chaque fois que vous placez des fixtures et / ou des fonctions de hook dans le fichier <code>conftest.py</code> niveau <code>conftest.py</code> du projet, vous cr√©ez un plugin <code>conftest</code> local.  C'est juste un peu de travail suppl√©mentaire pour convertir ces fichiers <code>conftest.py</code> en plugins installables que vous pouvez partager entre projets, avec d'autres personnes ou avec le monde. </p><br><p>  Nous commen√ßons ce chapitre en r√©pondant √† la question de savoir o√π chercher des plugins tiers.  Un certain nombre de plugins sont disponibles, il y a donc de fortes chances que quelqu'un ait d√©j√† √©crit les modifications que vous souhaitez apporter dans <code>pytest</code> .  Puisque nous consid√©rerons les plugins open source, si le plugin fait presque ce que vous voulez faire, mais pas tout √† fait, vous pouvez le d√©velopper, ou l'utiliser comme r√©f√©rence pour cr√©er votre propre plugin.  Bien que ce chapitre traite de la cr√©ation de vos propres plugins, l'annexe 3, le plugin <em>Sampler Pack</em> , √† la page 163 est incluse pour vous donner un avant-go√ªt de ce qui est possible. </p><br><p>  Dans ce chapitre, vous apprendrez √† cr√©er des plugins et je vous montrerai la bonne direction pour les tests, le packaging et la distribution.  Le sujet complet de l'emballage et de la distribution Python est trop vaste et pr√©tend √™tre son propre livre, nous ne couvrirons donc pas tout.  Mais vous obtiendrez suffisamment d'informations pour pouvoir √©changer des plugins avec votre √©quipe.  Je parlerai √©galement de quelques fa√ßons simples de cr√©er des plugins avec le support PyPI et le moins de travail. </p><br><h2 id="poisk-plaginov">  Plugins de recherche </h2><br><p>  Vous pouvez trouver des plugins tiers pytest √† plusieurs endroits.  Les plugins r√©pertori√©s dans l'annexe 3, Plugin Sampler Pack, √† la page 163, peuvent √™tre t√©l√©charg√©s √† partir de PyPI.  Cependant, ce n'est pas le seul endroit pour trouver de super plugins pytest. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://docs.pytest.org/en/latest/plugins.html</a> </p><br><p>  Le site principal de documentation de pytest a une page qui parle de l'installation et de l'utilisation des plugins pytest et r√©pertorie certains plugins courants. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://pypi.python.org</a> </p><br><p>  L'index des packages Python (PyPI) est un excellent endroit pour obtenir beaucoup de packages Python, mais aussi un excellent endroit pour rechercher des plugins pytest.  Lorsque vous recherchez des plugins pytest, entrez simplement ¬´pytest¬ª, ¬´pytest -¬ª ou ¬´-pytest¬ª dans le champ de recherche, car la plupart des plugins pytest commencent par ¬´pytest -¬ª ou se terminent par ¬´-pytest¬ª. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/pytest-dev</a> </p><br><p>  Le groupe pytest-dev sur GitHub est l'endroit o√π le code source pytest est stock√©.  De plus, vous pouvez trouver ici des plugins pytest populaires qui devraient √™tre pris en charge √† long terme par l'√©quipe du noyau pytest. </p><br><h2 id="ustanovka-plaginov">  Installation du plugin </h2><br><p>  Les plugins Pytest sont install√©s avec pip, comme les autres packages Python.  Cependant <br>  vous pouvez utiliser pip de plusieurs mani√®res pour installer des plugins. </p><br><h3 id="ustanovka-iz-pypi">  Installer depuis PyPI </h3><br><p>  √âtant donn√© que PyPI est l'emplacement par d√©faut pour pip, l'installation de plugins √† partir de PyPI est la m√©thode la plus simple.  <code>pytest-cov</code> plugin <code>pytest-cov</code> : </p><br><pre> <code class="plaintext hljs">$ pip install pytest-cov</code> </pre> <br><p>  La derni√®re version stable de PyPI sera install√©e. </p><br><h3 id="ustanovka-opredelennoy-versii-iz-pypi">  Installer une version sp√©cifique de PyPI </h3><br><p>  Si vous voulez une version sp√©cifique du plugin, vous pouvez sp√©cifier la version apr√®s <code>==</code> : </p><br><pre> <code class="plaintext hljs">$ pip install pytest-cov==2.4.0</code> </pre> <br><h3 id="ustanovka-iz-fayla-targz-ili-whl">  Installer √† partir d'un fichier .tar.gz ou .whl </h3><br><p>  Les packages PyPI sont distribu√©s sous forme de fichiers zip avec les extensions <code>.tar.gz</code> et / ou <code>.whl</code> .  Ils sont souvent appel√©s boules de goudron et roues.  Si vous rencontrez des probl√®mes pour essayer de travailler directement avec PyPI (ce qui peut se produire avec les pare-feu et autres complications r√©seau), vous pouvez t√©l√©charger <code>.tar.gz</code> ou <code>.whl</code> et installer √† partir de ceci ou cela. </p><br><p>  Vous n'avez pas besoin de d√©baller ou de danser avec un tambourin;  il suffit de pointer pip dessus: </p><br><pre> <code class="plaintext hljs">$ pip install pytest-cov-2.4.0.tar.gz # or $ pip install pytest_cov-2.4.0-py2.py3-none-any.whl</code> </pre> <br><h3 id="ustanovka-iz-lokalnogo-kataloga">  Installation √† partir du r√©pertoire local </h3><br><p>  Vous pouvez avoir les plugins pour les plugins (et d'autres packages Python) dans un r√©pertoire local ou partag√© au <code>.whl</code> <code>.tar.gz</code> ou <code>.whl</code> et l'utiliser √† la place de PyPI pour installer les plugins: </p><br><pre> <code class="plaintext hljs">$ mkdir some_plugins $ cp pytest_cov-2.4.0-py2.py3-none-any.whl some_plugins/ $ pip install --no-index --find-links=./some_plugins/ pytest-cov</code> </pre> <br><p>  <code>--no-index</code> indique √† <code>pip</code> ne pas se connecter √† PyPI.  <code>--find-links=./some_plugins/</code> indique √† pip de chercher dans le r√©pertoire <code>some_plugins</code> .  Cette m√©thode est particuli√®rement utile si vous avez √† la fois des tiers et vos propres plugins stock√©s localement, ainsi que si vous cr√©ez de nouveaux environnements virtuels pour une int√©gration continue ou avec tox.  (Nous parlerons √† la fois de tox et d'int√©gration continue dans le chapitre 7, √† l'aide de pytest avec d'autres outils, √† la page 125.) </p><br><p>  Veuillez noter qu'en utilisant la m√©thode d'installation du r√©pertoire local, vous pouvez installer plusieurs versions et sp√©cifier la version souhait√©e en ajoutant == et le num√©ro de version: </p><br><pre> <code class="plaintext hljs">$ pip install --no-index --find-links=./some_plugins/ pytest-cov==2.4.0</code> </pre> <br><h3 id="ustanovka-iz-repozitoriya-git">  Installer √† partir du r√©f√©rentiel Git </h3><br><p>  Vous pouvez installer des plugins directement depuis le r√©f√©rentiel Git dans ce cas GitHub: </p><br><pre> <code class="plaintext hljs">$ pip install git+https://github.com/pytest-dev/pytest-cov</code> </pre> <br><p>  Vous pouvez √©galement sp√©cifier la balise de version: </p><br><pre> <code class="plaintext hljs">$ pip install git+https://github.com/pytest-dev/pytest-cov@v2.4.0</code> </pre> <br><p>  Ou vous pouvez sp√©cifier une branche: </p><br><pre> <code class="plaintext hljs">$ pip install git+https://github.com/pytest-dev/pytest-cov@master</code> </pre> <br><p>  L'installation √† partir du r√©f√©rentiel Git est particuli√®rement utile si vous stockez votre propre travail dans Git ou si la version requise du plugin ou du plugin est manquante dans PyPI. </p><br><blockquote>  <em>Note du traducteur:</em> <br><br>  pip prend en charge l'installation de Git, Mercurial, Subversion et Bazaar et d√©finit le type VCS en utilisant les pr√©fixes d'URL: "git +", "hg +", "svn +", "bzr +". <br>  Voir la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation PyPI pour</a> plus de d√©tails. </blockquote><br><h2 id="napisanie-sobstvennyh-plaginov">  √âcrire vos propres plugins </h2><br><p>  De nombreux plugins tiers contiennent beaucoup de code.  C'est l'une des raisons pour lesquelles nous les utilisons pour nous faire gagner du temps √† d√©velopper tout cela par nous-m√™mes.  Cependant, pour votre code sp√©cifique, vous trouverez sans aucun doute des installations et des modifications sp√©ciales pour vous aider √† le tester.  En cr√©ant un plugin, vous pouvez facilement partager m√™me plusieurs appareils que vous souhaitez partager entre plusieurs projets.  Vous pouvez partager ces changements avec plusieurs projets - et √©ventuellement avec le reste du monde - en d√©veloppant et en distribuant vos propres plugins.  C'est assez facile √† faire.  Dans cette section, nous allons d√©velopper une petite modification du comportement de pytest, l'emballer sous forme de plugin, le tester et r√©fl√©chir √† sa distribution. </p><br><p>  Les plugins peuvent inclure des fonctions de hook qui modifient le comportement de pytest.  Puisque pytest a √©t√© con√ßu pour permettre aux plugins de modifier l√©g√®rement le comportement de pytest, de nombreuses fonctions de hook sont disponibles.  les crochets pour pytest sont r√©pertori√©s sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le site de documentation de pytest</a> .  Dans notre exemple, nous allons cr√©er un plugin qui changera l'apparence du statut du test.  Ajoutez un param√®tre de ligne de commande pour activer ce nouveau comportement.  Ajoutez du texte √† l'en-t√™te de sortie.  En particulier, nous changerons tous les indicateurs d'√©tat √âCHEC (√©chou√©) en ¬´OPPORTUNIT√â (potentielle) pour am√©lioration¬ª, changer F en O et ajouter ¬´Merci d'avoir ex√©cut√© les tests¬ª dans l'en-t√™te.  Pour ce faire, nous utiliserons l'option <code>--nice</code> . </p><br><p>  Pour garder les changements de comportement s√©par√©s de la discussion sur la m√©canique des plugins, nous apporterons des modifications √† conftest.py avant de le transformer en plugin redistribuable.  Vous n'avez pas besoin d'ex√©cuter les plugins de cette fa√ßon.  Mais souvent, les modifications que vous aviez l'intention d'utiliser dans un seul projet seront suffisamment utiles pour √™tre partag√©es et transform√©es en plug-in.  Par cons√©quent, nous commen√ßons par ajouter des fonctionnalit√©s au fichier conftest.py, puis, une fois que tout fonctionne dans conftest.py, nous d√©pla√ßons le code dans le package. </p><br><p>  Retour au projet T√¢ches.  Dans la section ¬´En attente d'exceptions¬ª √† la page 30, nous avons √©crit plusieurs tests qui v√©rifiaient si des exceptions √©taient lev√©es si quelqu'un appelait la fonction API de mani√®re incorrecte.  Il semble que nous ayons rat√© au moins quelques √©tats d'erreur possibles. </p><br><p>  Voici quelques tests suppl√©mentaires: </p><br><blockquote>  <strong>ch5 / a / tasks_proj / tests / func / test_api_exceptions.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""     API wrong."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tasks <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tasks <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Task @pytest.mark.usefixtures(<span class="hljs-string"><span class="hljs-string">'tasks_db'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestAdd</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">""",   tasks.add()."""</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_missing_summary</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""  ,  summary missing."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pytest.raises(ValueError): tasks.add(Task(owner=<span class="hljs-string"><span class="hljs-string">'bob'</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_done_not_bool</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""  ,  done   bool."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pytest.raises(ValueError): tasks.add(Task(summary=<span class="hljs-string"><span class="hljs-string">'summary'</span></span>, done=<span class="hljs-string"><span class="hljs-string">'True'</span></span>))</code> </pre><br><p>  Ex√©cutons-les pour v√©rifier s'ils r√©ussissent: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch5/a/tasks_proj $ pytest ===================== test session starts ====================== collected 57 items tests/func/test_add.py ... tests/func/test_add_variety.py ............................ tests/func/test_add_variety2.py ............ tests/func/test_api_exceptions.py .F....... tests/func/test_unique_id.py . tests/unit/test_task.py .... =========================== FAILURES =========================== __________________ TestAdd.test_done_not_bool __________________ self = &lt;func.test_api_exceptions.TestAdd object at 0x103a71a20&gt; def test_done_not_bool(self): """Should raise an exception if done is not a bool.""" with pytest.raises(ValueError): &gt; tasks.add(Task(summary='summary', done='True')) E Failed: DID NOT RAISE &lt;class 'ValueError'&gt; tests/func/test_api_exceptions.py:20: Failed ============= 1 failed, 56 passed in 0.28 seconds ==============</code> </pre><br><p>  Ex√©cutons-le √† nouveau avec <code>-v</code> pour plus de d√©tails.  Puisque vous avez d√©j√† vu la trace, vous pouvez la d√©sactiver en appuyant sur <code>--tb=no</code> . </p><br><p>  Concentrons-nous maintenant sur les nouveaux tests avec <code>-k TestAdd</code> , qui fonctionne car il n'y a pas d'autres tests avec des noms qui contiennent ¬´TestAdd¬ª. </p><br><p>  Nous pourrions ¬´tout laisser tomber¬ª et essayer de corriger ce test (et nous le ferons plus tard), mais nous allons maintenant nous concentrer sur la tentative de rendre les √©checs plus agr√©ables pour les d√©veloppeurs. </p><br><p>  Commen√ßons par ajouter un message de remerciement √† l'en-t√™te, ce que vous pouvez faire avec un crochet <code>pytest_report_header()</code> appel√© <code>pytest_report_header()</code> . </p><br><blockquote>  <strong>ch5 / b / tasks_proj / tests / conftest.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_header</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Thanks for running the tests."</span></span></code> </pre> <br><p>  De toute √©vidence, taper une note de remerciement est assez stupide.  Cependant, la possibilit√© d'ajouter des informations √† l'en-t√™te peut √™tre √©tendue.  Vous pouvez ajouter un nom d'utilisateur, indiquer l'√©quipement utilis√© et les versions √† tester.  En g√©n√©ral, tout ce que vous pouvez convertir en cha√Æne peut √™tre ins√©r√© dans le titre du test. </p><br><p>  Ensuite, nous changerons le rapport d'√©tat du test pour changer <code>F</code> en <code>O</code> et <code>FAILED</code> en <code>OPPORTUNITY for improvement</code> .  Il y a un hook qui permet cette affaire: <code>pytest_report_teststatus()</code> : </p><br><blockquote>  <strong>ch5 / b / tasks_proj / tests / conftest.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_teststatus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(report)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""   ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> report.when == <span class="hljs-string"><span class="hljs-string">'call'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> report.failed: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (report.outcome, <span class="hljs-string"><span class="hljs-string">'O'</span></span>, <span class="hljs-string"><span class="hljs-string">'OPPORTUNITY for improvement'</span></span>)</code> </pre> <br><p>  Et maintenant, nous avons juste la solution que nous recherchions.  Une session de test sans l'indicateur <code>--verbose</code> affiche <code>O</code> pour les √©checs, c'est-√†-dire que des am√©liorations sont possibles: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch5/b/tasks_proj/tests/func $ pytest --tb=no test_api_exceptions.py -k TestAdd ===================== test session starts ====================== Thanks for running the tests. collected 9 items test_api_exceptions.py .O ====================== 7 tests deselected ====================== ======= 1 failed, 1 passed, 7 deselected in 0.06 seconds =======</code> </pre> <br><p>  Avec le drapeau <code>-v</code> ou <code>--verbose</code> , ce serait mieux: </p><br><pre> <code class="plaintext hljs">$ pytest -v --tb=no test_api_exceptions.py -k TestAdd ===================== test session starts ====================== Thanks for running the tests. collected 9 items test_api_exceptions.py::TestAdd::test_missing_summary PASSED test_api_exceptions.py::TestAdd::test_done_not_bool OPPORTUNITY for improvement ====================== 7 tests deselected ====================== ======= 1 failed, 1 passed, 7 deselected in 0.07 seconds =======</code> </pre> <br><p>  La derni√®re modification que nous apporterons consiste √† ajouter un param√®tre de ligne de commande, <code>--nice,</code> afin que les modifications de notre √©tat ne se produisent que si vous remplacez <code>--nice</code> : </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_addoption</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parser)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" nice    --nice."""</span></span> group = parser.getgroup(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>) group.addoption(<span class="hljs-string"><span class="hljs-string">"--nice"</span></span>, action=<span class="hljs-string"><span class="hljs-string">"store_true"</span></span>, help=<span class="hljs-string"><span class="hljs-string">"nice: turn failures into opportunities"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_header</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pytest.config.getoption(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Thanks for running the tests."</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_teststatus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(report)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""   ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> report.when == <span class="hljs-string"><span class="hljs-string">'call'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> report.failed <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> pytest.config.getoption(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (report.outcome, <span class="hljs-string"><span class="hljs-string">'O'</span></span>, <span class="hljs-string"><span class="hljs-string">'OPPORTUNITY for improvement'</span></span>)</code> </pre><br><p>  Il convient de noter que pour ce plugin, nous n'utilisons que quelques crochets.  Il y en a beaucoup d'autres sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site de documentation principal de Pytest</a> . </p><br><p>  Maintenant, nous pouvons tester manuellement notre plugin en l'ex√©cutant simplement dans notre exemple.  Tout d'abord, sans l'option <code>--nice</code> , pour vous assurer que seul le nom d'utilisateur est affich√©: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch5/c/tasks_proj/tests/func $ pytest --tb=no test_api_exceptions.py -k TestAdd ===================== test session starts ====================== collected 9 items test_api_exceptions.py .F ====================== 7 tests deselected ====================== ======= 1 failed, 1 passed, 7 deselected in 0.07 seconds =======</code> </pre><br><p>  Maintenant avec <code>--nice</code> : </p><br><pre> <code class="plaintext hljs">$ pytest --nice --tb=no test_api_exceptions.py -k TestAdd ===================== test session starts ====================== Thanks for running the tests. collected 9 items test_api_exceptions.py .O ====================== 7 tests deselected ====================== ======= 1 failed, 1 passed, 7 deselected in 0.07 seconds =======</code> </pre> <br><p>  Maintenant avec <code>--nice</code> et <code>--verbose</code> : </p><br><pre> <code class="plaintext hljs">$ pytest -v --nice --tb=no test_api_exceptions.py -k TestAdd ===================== test session starts ====================== Thanks for running the tests. collected 9 items test_api_exceptions.py::TestAdd::test_missing_summary PASSED test_api_exceptions.py::TestAdd::test_done_not_bool OPPORTUNITY for improvement ====================== 7 tests deselected ====================== ======= 1 failed, 1 passed, 7 deselected in 0.06 seconds =======</code> </pre> <br><p>  Super!  Toutes les modifications que nous voulions apporter ont √©t√© effectu√©es dans une dizaine de lignes de code pour le fichier <code>conftest.py</code> .  Ensuite, nous d√©placerons ce code dans la structure du plugin. </p><br><h2 id="sozdanie-ustanavlivaemogo-plagina">  Cr√©ation d'un plugin installable </h2><br><p>  Le processus de partage des plugins avec d'autres utilisateurs est clairement d√©fini.  M√™me si vous n'activez jamais votre propre plugin dans PyPI, passer par ce processus vous facilitera la lecture du code √† partir des plugins open source, et vous aurez plus d'occasions d'√©valuer s'ils vous aideront ou non. </p><br><p>  Il serait superflu de couvrir enti√®rement le conditionnement et la distribution des packages Python dans ce livre, car ce sujet est bien document√© ailleurs.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ici</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> en russe.  Cependant, passer du plug-in de configuration local que nous avons cr√©√© dans la section pr√©c√©dente √† quelque chose install√© √† l'aide de pip n'est pas un gros probl√®me.  , </p><br><p>  Tout d'abord, nous devons cr√©er un nouveau r√©pertoire pour h√©berger notre code de plugin.  Peu importe comment vous l'appelez, mais comme nous cr√©ons un plugin pour le joli drapeau, appelons-le pytest-nice.  Nous aurons deux fichiers dans ce nouveau r√©pertoire: pytest_nice.py et setup.py.  (Le catalogue de tests sera discut√© dans la section ¬´Plugins de test¬ª √† la page 105.) </p><br><pre> <code class="plaintext hljs">‚îÇ LICENSE ‚îÇ pytest_nice.py ‚îÇ setup.py ‚îÇ ‚îî‚îÄ‚îÄ‚îÄtests ‚îÇ conftest.py ‚îÇ test_nice.py</code> </pre><br><p>  Dans <code>pytest_nice.py</code> , nous mettons le contenu exact de notre conftest.py qui √©tait associ√© √† cette fonction (et l'extrayons de <code>tasks_proj/tests/conftest.py</code> ): </p><br><p>  <strong>ch5 / pytest-nice / pytest_nice.py</strong> </p><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""  pytest-nice ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_addoption</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parser)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" nice    --nice."""</span></span> group = parser.getgroup(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>) group.addoption(<span class="hljs-string"><span class="hljs-string">"--nice"</span></span>, action=<span class="hljs-string"><span class="hljs-string">"store_true"</span></span>, help=<span class="hljs-string"><span class="hljs-string">"nice: turn FAILED into OPPORTUNITY for improvement"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_header</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pytest.config.getoption(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Thanks for running the tests."</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_teststatus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(report)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""   ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> report.when == <span class="hljs-string"><span class="hljs-string">'call'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> report.failed <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> pytest.config.getoption(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (report.outcome, <span class="hljs-string"><span class="hljs-string">'O'</span></span>, <span class="hljs-string"><span class="hljs-string">'OPPORTUNITY for improvement'</span></span>)</code> </pre> <br><p>  Dans <code>setup.py</code> nous avons besoin de l'appel le plus minimal pour <code>setup()</code> : </p><br><blockquote>  <strong>ch5 / pytest-nice / setup.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""Setup  pytest-nice plugin."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> setuptools <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> setup setup( name=<span class="hljs-string"><span class="hljs-string">'pytest-nice'</span></span>, version=<span class="hljs-string"><span class="hljs-string">'0.1.0'</span></span>, description=<span class="hljs-string"><span class="hljs-string">' Pytest,   FAILURE into OPPORTUNITY'</span></span>, url=<span class="hljs-string"><span class="hljs-string">'https:////////'</span></span>, author=<span class="hljs-string"><span class="hljs-string">' '</span></span>, author_email=<span class="hljs-string"><span class="hljs-string">'your_email@somewhere.com'</span></span>, license=<span class="hljs-string"><span class="hljs-string">'proprietary'</span></span>, py_modules=[<span class="hljs-string"><span class="hljs-string">'pytest_nice'</span></span>], install_requires=[<span class="hljs-string"><span class="hljs-string">'pytest'</span></span>], entry_points={<span class="hljs-string"><span class="hljs-string">'pytest11'</span></span>: [<span class="hljs-string"><span class="hljs-string">'nice = pytest_nice'</span></span>, ], }, )</code> </pre> <br><p>  Vous aurez besoin de plus d'informations dans les param√®tres si vous souhaitez les diffuser √† un large public ou sur Internet.  Cependant, pour une petite √©quipe ou juste pour vous, ce sera suffisant. </p><br><p>  Vous pouvez inclure d'autres param√®tres pour <code>setup()</code> ;  et ici nous n'avons que les champs obligatoires.  Le champ version est la version de ce plugin.  Et cela d√©pend enti√®rement de vous lorsque vous montez la version.  Le champ URL est obligatoire.  Vous pouvez le laisser vide, mais vous obtiendrez un avertissement.  Les <code>author_email</code> <code>author</code> et <code>author_email</code> peuvent √™tre remplac√©s par <code>author_email</code> et <code>author_email</code> , mais l'une de ces paires doit √™tre l√†.  Le champ de <code>license</code> est un champ de texte court.  Cela peut √™tre l'une des nombreuses licences open source, votre nom ou votre entreprise, ou quelque chose qui vous convient.  L' <code>py_modules</code> r√©pertorie <code>pytest_nice</code> comme notre seul module pour ce plugin.  Bien qu'il s'agisse d'une liste et que vous pouvez inclure plusieurs modules, si j'en avais plusieurs, j'utiliserais le package et mettrais tous les modules dans un r√©pertoire. </p><br><p>  Jusqu'√† pr√©sent, toutes les options <code>setup()</code> sont standard et sont utilis√©es par tous les installateurs Python.  La partie qui est diff√©rente pour les plugins Pytest est le param√®tre <code>entry_points</code> .  Nous avons r√©pertori√© <code>entry_points={'pytest11': ['nice = pytest_nice', ], },.</code>  La fonction <code>entry_points</code> est standard pour <code>setuptools</code> , mais pytest11 est l'identifiant sp√©cial que pytest recherche.  Dans cette ligne, nous disons √† pytest que <code>nice</code> est le nom de notre plugin, et <code>pytest_nice</code> nom du module dans lequel notre plugin vit.  Si nous avons utilis√© le package, notre entr√©e ici serait: </p><br><p>  Je n'ai pas encore parl√© du fichier <code>README.rst</code> .  Une certaine forme de README est une exigence de setuptools.  Si vous le manquez, vous obtiendrez ceci: </p><br><pre> <code class="plaintext hljs">... warning: sdist: standard file not found: should have one of README, README.rst, README.txt ...</code> </pre><br><p>  Garder README comme moyen standard d'inclure des informations sur le projet est de toute fa√ßon une bonne id√©e.  Voici ce que j'ai mis dans le fichier pour pytest-nice: </p><br><blockquote>  <strong>ch5 / pytest-nice / README.rst</strong> </blockquote><br><pre> <code class="plaintext hljs">pytest-nice : A pytest plugin =============================   pytest     .  -------- -   ,     pytest. -  ``--nice`` , : -  ``F``  ``O`` -  ``-v``,  ``FAILURE``  ``OPPORTUNITY for improvement``  ------------ ,    Pytest    .tar.gz    PATH,  : :: $ pip install PATH/pytest-nice-0.1.0.tar.gz $ pip install --no-index --find-links PATH pytest-nice  ----- :: $ pytest --nice</code> </pre><br><p>  Il existe de nombreuses opinions sur ce qui devrait √™tre dans le fichier README.  Il s'agit d'une version fortement recadr√©e, mais cela fonctionne. </p><br><h2 id="testirovanie-plaginov">  Test des plugins </h2><br><p>  Les plugins sont du code qui doit √™tre test√© comme tout autre code.  Cependant, tester les modifications apport√©es √† un outil de test est un peu plus compliqu√©.  Lorsque nous avons d√©velopp√© le code du plugin dans la section ¬´√âcriture de vos propres plugins¬ª, √† la page 98, nous l'avons v√©rifi√© manuellement √† l'aide d'un exemple de fichier de test, en ex√©cutant pytest avec lui et en v√©rifiant la sortie pour vous assurer qu'elle √©tait correcte.  Nous pouvons faire de m√™me en mode automatique en utilisant un plugin appel√© <code>pytester</code> , qui vient avec pytest mais est d√©sactiv√© par d√©faut. </p><br><p>  Il y a deux fichiers dans notre r√©pertoire test pour pytest-nice: <code>conftest.py</code> et <code>test_nice.py</code> .  Pour utiliser <code>pytester</code> , nous devons ajouter une seule ligne √† <code>conftest.py</code> : </p><br><blockquote>  <strong>ch5 / pytest-nice / tests / conftest.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""pytester is needed for testing plugins."""</span></span> pytest_plugins = <span class="hljs-string"><span class="hljs-string">'pytester'</span></span></code> </pre> <br><p>  Cette ligne inclut le plugin <code>pytester</code> .  Nous utiliserons un appareil appel√© <code>testdir</code> , qui devient disponible lorsque le <code>pytester</code> activ√©. <br>  Souvent, les tests de plugins prennent la forme que nous avons d√©crite manuellement: </p><br><ol><li>  Cr√©ez un exemple de fichier de test. </li><li>  Ex√©cutez pytest avec ou sans certains param√®tres dans le r√©pertoire qui contient l'exemple de fichier. </li><li>  V√©rifiez la sortie. </li><li>  Possible, pour v√©rifier le code de r√©sultat est 0 pour toutes les passes, 1 pour certains √©checs. </li></ol><br><p>  Regardons un exemple: </p><br><blockquote>  <strong>ch5 / pytest-nice / tests / test_nice.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_pass_fail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(testdir)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#     Pytest testdir.makepyfile(""" def test_pass(): assert 1 == 1 def test_fail(): assert 1 == 2 """) #  pytest result = testdir.runpytest() # fnmatch_lines    result.stdout.fnmatch_lines([ '*.F', # .  Pass, F  Fail ]) # ,      '1'  testsuite assert result.ret == 1</span></span></code> </pre> <br><p>  Fixture <code>testdir</code> cr√©e automatiquement un r√©pertoire temporaire pour l'h√©bergement des fichiers de test.  Il a une m√©thode <code>makepyfile()</code> qui vous permet de mettre le contenu d'un fichier de <code>makepyfile()</code> ce cas, nous cr√©ons deux tests: l'un qui <em>passe</em> et l'autre qui <em>ne passe pas</em> . </p><br><p>  Nous ex√©cutons pytest pour un nouveau fichier de test en utilisant <code>testdir.runpytest()</code> .  Vous pouvez transmettre des param√®tres si vous le souhaitez.  La valeur de retour peut √™tre consid√©r√©e ult√©rieurement et est de type <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RunResult</a> . </p><br><p>  Habituellement, je regarde <code>stdout</code> et <code>ret</code> .   ,    ,     ,  <code>fnmatch_lines</code> ,   ,      ,   ,  <code>ret</code>  0     1   . ,   <code>fnmatch_lines</code> ,    .        .  ,    ,   : </p><br><blockquote> <strong>ch5/pytest-nice/tests/test_nice.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.fixture() def sample_test(testdir): testdir.makepyfile(""" def test_pass(): assert 1 == 1 def test_fail(): assert 1 == 2 """) return testdir</span></span></code> </pre> <br><p> ,   ,    <code>sample_test</code>   ,       .      : </p><br><blockquote> <strong>ch5/pytest-nice/tests/test_nice.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_with_nice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sample_test)</span></span></span><span class="hljs-function">:</span></span> result = sample_test.runpytest(<span class="hljs-string"><span class="hljs-string">'--nice'</span></span>) result.stdout.fnmatch_lines([<span class="hljs-string"><span class="hljs-string">'*.O'</span></span>, ]) <span class="hljs-comment"><span class="hljs-comment"># . for Pass, O for Fail assert result.ret == 1 def test_with_nice_verbose(sample_test): result = sample_test.runpytest('-v', '--nice') result.stdout.fnmatch_lines([ '*::test_fail OPPORTUNITY for improvement', ]) assert result.ret == 1 def test_not_nice_verbose(sample_test): result = sample_test.runpytest('-v') result.stdout.fnmatch_lines(['*::test_fail FAILED']) assert result.ret == 1</span></span></code> </pre> <br><p>     .  ,       : </p><br><blockquote> <strong>ch5/pytest-nice/tests/test_nice.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_header</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sample_test)</span></span></span><span class="hljs-function">:</span></span> result = sample_test.runpytest(<span class="hljs-string"><span class="hljs-string">'--nice'</span></span>) result.stdout.fnmatch_lines([<span class="hljs-string"><span class="hljs-string">'Thanks for running the tests.'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_header_not_nice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sample_test)</span></span></span><span class="hljs-function">:</span></span> result = sample_test.runpytest() thanks_message = <span class="hljs-string"><span class="hljs-string">'Thanks for running the tests.'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> thanks_message <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> result.stdout.str()</code> </pre><br><p>       ,        ,      . </p><br><p>    : </p><br><blockquote> <strong>ch5/pytest-nice/tests/test_nice.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_help_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(testdir)</span></span></span><span class="hljs-function">:</span></span> result = testdir.runpytest(<span class="hljs-string"><span class="hljs-string">'--help'</span></span>) <span class="hljs-comment"><span class="hljs-comment"># fnmatch_lines    result.stdout.fnmatch_lines([ 'nice:', '*--nice*nice: turn FAILED into OPPORTUNITY for improvement', ])</span></span></code> </pre> <br><p>  ,     , ,    . </p><br><p>         <code>pytest-nice</code>  ,    .       <code>.zip.gz</code> ,       : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch5/pytest-nice/ $ pip install . Processing /path/to/code/ch5/pytest-nice Requirement already satisfied: pytest in /path/to/venv/lib/python3.6/site-packages (from pytest-nice==0.1.0) Requirement already satisfied: py&gt;=1.4.33 in /path/to/venv/lib/python3.6/site-packages (from pytest-&gt;pytest-nice==0.1.0) Requirement already satisfied: setuptools in /path/to/venv/lib/python3.6/site-packages (from pytest-&gt;pytest-nice==0.1.0) Building wheels for collected packages: pytest-nice Running setup.py bdist_wheel for pytest-nice ... done ... Successfully built pytest-nice Installing collected packages: pytest-nice Successfully installed pytest-nice-0.1.0</code> </pre> <br><p> ,   ,   : </p><br><pre> <code class="plaintext hljs">$ pytest -v ===================== test session starts ====================== plugins: nice-0.1.0 collected 7 items tests/test_nice.py::test_pass_fail PASSED tests/test_nice.py::test_with_nice PASSED tests/test_nice.py::test_with_nice_verbose PASSED tests/test_nice.py::test_not_nice_verbose PASSED tests/test_nice.py::test_header PASSED tests/test_nice.py::test_header_not_nice PASSED tests/test_nice.py::test_help_message PASSED =================== 7 passed in 0.34 seconds ===================</code> </pre> <br><blockquote> <strong>. :</strong>    ,    .      . <br><pre> <code class="plaintext hljs">platform win32 -- Python 3.6.5, pytest-3.9.3, py-1.7.0, pluggy-0.8.0 -- c:\venv36\scripts\python.exe collected 7 items tests/test_nice.py::test_pass_fail FAILED [ 14%] tests/test_nice.py::test_with_nice OPPORTUNITY for improvement [ 28%] tests/test_nice.py::test_with_nice_verbose OPPORTUNITY for improvement [ 42%] tests/test_nice.py::test_not_nice_verbose FAILED [ 57%] tests/test_nice.py::test_header PASSED [ 71%] tests/test_nice.py::test_header_not_nice PASSED [ 85%] tests/test_nice.py::test_help_message PASSED [100%] ================================== FAILURES =================================== _______________________________ test_pass_fail ________________________________</code> </pre> <br><br>     <br><pre> <code class="plaintext hljs"> result.stdout.fnmatch_lines([ '*.F', # . for Pass, F for Fail ])</code> </pre> <br><br>  sur <br><pre> <code class="plaintext hljs"> result.stdout.fnmatch_lines([ '*.F*', # . for Pass, F for Fail ])</code> </pre> <br><br>   <code>*</code>  <code>F</code> <br><br>       <code>test_with_nice</code> , <code>test_with_nice_verbose</code> , <code>test_not_nice_verbose</code> <br><br>     pytest. <br>    c   <br> <code>'test_with_nice.py .O [100%]'</code> <br>   <code>.</code>        <br>  ,    <br><br> RemovedInPytest4Warning: usage of Session.Class is deprecated, please use pytest.Class instead <br><br>    ! <br><pre> <code class="plaintext hljs">(venv36) c:\_BOOKS_\pytest_si\bopytest-code\code\ch5\pytest-nice&gt;pytest -v ============================= test session starts ============================= platform win32 -- Python 3.6.5, pytest-3.9.3, py-1.7.0, pluggy-0.8.0 -- c:\venv36\scripts\python.exe cachedir: .pytest_cache rootdir: c:\_BOOKS_\pytest_si\bopytest-code\code\ch5\pytest-nice, inifile: plugins: nice-0.1.0 collected 7 items tests/test_nice.py::test_pass_fail PASSED [ 14%] tests/test_nice.py::test_with_nice PASSED [ 28%] tests/test_nice.py::test_with_nice_verbose PASSED [ 42%] tests/test_nice.py::test_not_nice_verbose PASSED [ 57%] tests/test_nice.py::test_header PASSED [ 71%] tests/test_nice.py::test_header_not_nice PASSED [ 85%] tests/test_nice.py::test_help_message PASSED [100%] ============================== warnings summary =============================== tests/test_nice.py::test_pass_fail c:\venv36\lib\site-packages\_pytest\compat.py:332: RemovedInPytest4Warning: usage of Session.Class is deprecated, please use pytest.Class instead return getattr(object, name, default)</code> </pre> <br></blockquote><p>  Hourra!   .     (pytest-nice),      Python <br>  pytest-: </p><br><pre> <code class="plaintext hljs">$ pip uninstall pytest-nice Uninstalling pytest-nice-0.1.0: Would remove: \path\to\venv\lib\site-packages\pytest_nice-0.1.0.dist-info\* ... Proceed (y/n)? y Successfully uninstalled pytest-nice-0.1.0</code> </pre> <br><p>        ‚Äî   ,     pytest,   PyPI. </p><br><h2 id="sozdanie-distributiva">   </h2><br><p>    ,      . ,         setup.py   : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch5/pytest-nice $ python setup.py sdist running sdist running egg_info creating pytest_nice.egg-info ... running check creating pytest-nice-0.1.0 ... creating dist Creating tar archive ... $ ls dist pytest-nice-0.1.0.tar.gz</code> </pre> <br><p> ( ,  sdist  <em>source distribution</em> ‚Äî ‚Äú  .‚Äù) </p><br><p>  pytest-nice  dist      <code>pytest-nice-0.1.0.tar.gz</code> . </p><br><p>         ,    ,   : </p><br><pre> <code class="plaintext hljs">$ pip install dist/pytest-nice-0.1.0.tar.gz Processing ./dist/pytest-nice-0.1.0.tar.gz ... Installing collected packages: pytest-nice Successfully installed pytest-nice-0.1.0</code> </pre> <br><p>       <code>.tar.gz</code>   ,       . </p><br><h2 id="rasprostranenie-plaginov-cherez-obschiy-katalog">      </h2><br><p> <code>pip</code>       ,  ,    ,       ,   ,    ,     <code>.tar.gz</code>   . ,   <code>pytest-nice-0.1.0.tar.gz</code>     <code>myplugins</code> . </p><br><p>   <code>pytest-nice</code>  <code>myplugins</code> : </p><br><pre> <code class="plaintext hljs">$ pip install --no-index --find-links myplugins pytest-nice</code> </pre> <br><p> <code>--no-index</code>  <code>pip</code>    PyPI,   ,    . <br> The --find-links myplugins tells PyPI to look in myplugins for packages to install. And of course, pytest-nice is what we want to install. <br> <code>--find-links myplugins</code>  PyPI   <code>myplugins</code>   .  , <code>pytest-nice</code> ‚Äî  ,    . </p><br><p>         <code>myplugins</code>    ,    ,  <code>--upgrade</code> : </p><br><pre> <code class="plaintext hljs">$ pip install --upgrade --no-index --find-links myplugins pytest-nice</code> </pre> <br><p>      <code>pip</code> ,    <code>--no-index --find-links myplugins</code> . </p><br><h2 id="rasprostranenie-plaginov-cherez-pypi">    PyPI </h2><br><p>        ,    ,    .   ,    . ,          ,      ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Python Packaging</a> . </p><br><p>     pytest,      ‚Äî  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>cookiecutter-pytest-plugin</code></a> : </p><br><pre> <code class="plaintext hljs">$ pip install cookiecutter $ cookiecutter https://github.com/pytest-dev/cookiecutter-pytest-plugin</code> </pre> <br><p>          .      ,      .          ; , ,     .     pytest,      ,       . </p><br><h2 id="uprazhneniya">  Exercices </h2><br><p>  <code>ch4/cache/test_slower.py</code>  autouse fixture,  <code>check_duration()</code> .        4.      . </p><br><ol><li>     pytest-slower,        ,  ,    ¬´  ¬ª  . 102. </li><li>    ,   pytest-slower ,   . </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √âcrivez un code de test pour le plugin. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jetez un ≈ìil √† l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">index des packages Python</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et recherchez ¬´pytest-¬ª. </font><font style="vertical-align: inherit;">Trouvez un plugin pytest qui vous semble int√©ressant.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Installez le plugin de votre choix et essayez-le sur les tests de t√¢ches. </font></font></li></ol><br><h2 id="chto-dalshe">  Et ensuite </h2><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous avez jusqu'√† pr√©sent utilis√© de nombreuses fois </font></font><code>conftest.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans ce livre. </font><font style="vertical-align: inherit;">Il existe √©galement des fichiers de configuration qui affectent l'ex√©cution de pytest, par exemple </font></font><code>pytest.ini</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dans le chapitre suivant, vous vous familiariserez avec les diff√©rents fichiers de configuration et d√©couvrirez ce que vous pouvez faire pour vous faciliter la vie lors des tests.</font></font></p><br><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Retour</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Suivant</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr448794/">https://habr.com/ru/post/fr448794/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr448782/index.html">Test Python avec pytest. Premiers pas avec pytest, Chapitre 1</a></li>
<li><a href="../fr448784/index.html">Nouvelles fonctionnalit√©s pour les auteurs d'extensions dans Visual Studio 2019 version 16.1</a></li>
<li><a href="../fr448786/index.html">Test Python avec pytest. CHAPITRE 3 Appareils pytest</a></li>
<li><a href="../fr448790/index.html">SpaceVIL - Framework GUI multiplateforme pour le d√©veloppement sur .Net Core, .Net Standard et JVM</a></li>
<li><a href="../fr448792/index.html">Test Python avec pytest. Luminaires int√©gr√©s, Chapitre 4</a></li>
<li><a href="../fr448796/index.html">Test Python avec pytest. Configuration, CHAPITRE 6</a></li>
<li><a href="../fr448798/index.html">Test Python avec pytest. Utilisation de pytest avec d'autres outils, CHAPITRE 7</a></li>
<li><a href="../fr448800/index.html">Configurer Visual Studio dans votre organisation avec .vsconfig</a></li>
<li><a href="../fr448802/index.html">Penser avec des portails: cr√©er des portails dans Unreal Engine 4</a></li>
<li><a href="../fr448804/index.html">Se pr√©parer pour le runtime et le notaire renforc√©s de macOS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>