<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìñ üê® üç´ Debugging-Spiele f√ºr NES: wie es heute passiert üóØÔ∏è üíÜ üßëüèæ‚Äçü§ù‚Äçüßëüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wenn Sie jemals an der Programmierung beteiligt waren, sind Sie mit dem Konzept der Fehler vertraut. Wenn sie uns nicht st√∂ren w√ºrden, w√ºrde der Entwi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Debugging-Spiele f√ºr NES: wie es heute passiert</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466653/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ec/4b4/b16/5ec4b4b16c4a29c8669a5dea88746758.gif" alt="Bild"></div><br>  Wenn Sie jemals an der Programmierung beteiligt waren, sind Sie mit dem Konzept der Fehler vertraut.  Wenn sie uns nicht st√∂ren w√ºrden, w√ºrde der Entwicklungsprozess viel schneller und angenehmer werden.  Aber diese Fehler warten nur auf den Moment, um unseren Code, unseren Arbeitsplan und unseren kreativen Fluss zu ruinieren.  Gl√ºcklicherweise gibt es viele Tools und Strategien, um Fehler zu beseitigen, selbst im Code von Retro-Game-Programmierern. <br><br><h3>  Debugging-Tools </h3><br>  Eine der besten M√∂glichkeiten zum Debuggen von Code ist die Verwendung eines Debuggers.  Einige Versionen der FCEUX- und Mesen-Emulatoren verf√ºgen √ºber einen integrierten Debugger, mit dem Sie das Programm jederzeit unterbrechen k√∂nnen, um den Zustand des Codes zu √ºberpr√ºfen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ea6/3aa/a59/ea63aaa59021320ef8bdbdb928f2bf8f.png"></div><br>  <i>FCEUX-Emulator-Debugger</i> <br><br>  Es ist erw√§hnenswert, dass diese Methode besser f√ºr fortgeschrittene Programmierer geeignet ist, die mit Assemblersprache arbeiten.  Aber wir sind neu, also werden wir in C (cc65) schreiben.  Nat√ºrlich wird der Compiler nach seinen eigenen Regeln spielen, und es wird f√ºr uns schwierig sein, mit aus C-Code kompiliertem Maschinencode umzugehen. <br><a name="habracut"></a><br><h5>  Hex-Editor FCEUX </h5><br>  Nehmen wir an, wir m√ºssen eine Art Variable oder Array beobachten.  F√ºgen Sie den Linkeroptionen (ld65) die folgende Zeile hinzu: <code>-Ln labels.txt</code> <br><br>  Nach dem Kompilieren des Projekts wird die Datei <code>labels.txt</code> in ihrem Ordner <code>labels.txt</code> .  √ñffnen Sie es einfach in einem beliebigen Programm zum Anzeigen von Texten und suchen Sie nach dem Namen der Variablen, die wir beobachten m√∂chten. <br><br>  ( <em>Hinweis: Wenn Sie eine statische Variable deklariert haben, wird diese nicht in diese Liste aufgenommen. Verwenden Sie daher anstelle des <code>static unsigned char playerX</code> den <code>unsigned char playerX</code></em> ) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dc1/949/8d0/dc19498d02f665f3f9c4b797ab74de5b.png"></div><br>  Jetzt kennen wir die Adresse der gew√ºnschten Variablen, nicht schlecht.  Lassen Sie es uns im Debugger finden.  F√ºhren Sie die ROM-Spiele im FCEUX-Emulator aus.  W√§hlen Sie im Men√º Debug das Element Hex Editor aus. Dr√ºcken Sie im folgenden Fenster Strg + G und geben Sie die Adresse unserer Variablen ein: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/495/ce0/085/495ce0085c38bf77a9941c76c28e9f92.png"></div><br>  Dr√ºcken Sie OK, und der Cursor bewegt sich zu der Adresse, an der sich die Variable befindet.  Werfen wir einen Blick darauf: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ec/4b4/b16/5ec4b4b16c4a29c8669a5dea88746758.gif"></div><br>  Dies kann n√ºtzlich sein, um zu √ºberpr√ºfen, ob das Array korrekt gef√ºllt ist, oder um √Ñnderungen an bestimmten Variablen zu verfolgen.  Au√üerdem k√∂nnen Sie sich wie ein gro√üer Bruder f√ºhlen und Ihren Code genau beobachten. <br><br>  Weitere n√ºtzliche Debug-Men√º-Tools f√ºr den FCEUX-Emulator wie PPU Viewer, Name Table Viewer usw. <br><br><h3>  Vereinfachen Sie den Debugging-Prozess </h3><br>  Und wenn wir nicht jedes Mal einen Debugger ausf√ºhren m√∂chten, um eine Variable zu beobachten?  Eine fortgeschrittenere Methode besteht darin, eine Prozedur zu schreiben, die den Wert auf dem Bildschirm anzeigt.  Versuchen wir, anhand der Punktzahl in der Benutzeroberfl√§che die Position des Spielers auf der Y-Achse anzuzeigen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9dd/4cb/3ca/9dd4cb3caac2ebb53331df53b565365d.gif"></div><br>  Es funktioniert perfekt! <br><br>  Doug Fraker, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Inhaber</a> eines Retro-Codierers und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Nesdoug-Blogs,</a> hat eine √§hnliche Methode f√ºr die Verwendung von Bildschirmvisualisierungen f√ºr Debugging-Zwecke entwickelt.  Das unten gezeigte Verfahren erzeugt eine graue Linie auf dem Bildschirm, die den Grad der CPU-Auslastung deutlich anzeigt: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// void gray_line(void); // For debugging. Insert at the end of the game loop, to see how much frame is left. // Will print a gray line on the screen. Distance to the bottom = how much is left. // No line, possibly means that you are in v-blank. _gray_line: lda &lt;PPU_MASK_VAR and #$1f ;no color emphasis bits ora #1 ;yes gray bit sta PPU_MASK ldx #20 ;wait @loop2: dex bne @loop2 lda &lt;PPU_MASK_VAR ;normal sta PPU_MASK rts</span></span></code> </pre> <br>  Sie k√∂nnen diese Prozedur einfach in Ihren Code kopieren oder die Bibliothek nesdoug.h in das Projekt aufnehmen.  Die Prozedur muss nach Abschluss des Spielzyklus aufgerufen werden, dann wird ein grauer Balken auf dem Bildschirm angezeigt. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ca6/11a/007/ca611a0072771688eb1618922b14d8f2.gif"></div><br>  Es hat funktioniert, aber es sieht so aus, als h√§tte ich noch einen Fehler!  Wir werden ihn sp√§ter loswerden.  In der Zwischenzeit gehen wir weiter. <br><br><h3>  Die Kraft der Makros </h3><br>  Makros k√∂nnen auch ein n√ºtzliches Debugging-Tool sein.  Sie erm√∂glichen es Ihnen, einen Platz im Code zu finden, der zur Quelle des Fehlers geworden ist. <br><br>  Lassen Sie uns eine Art Makro erstellen, das uns zum richtigen Zeitpunkt Signale gibt, z. B. einen Sound abspielen oder eine Nullpalette mit dem erforderlichen Wert ausw√§hlen.  Wir haben mehrere Makros, die die Nullpalette in rote, blaue und zuf√§llige Farben √§ndern und Ton wiedergeben: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/343/886/d8e/343886d8e09643d4a35df968e094ac85.png"></div><br>  Wie funktioniert es  Angenommen, Sie haben ein Projekt erfolgreich kompiliert, starten den Emulator mit Ihrem Spiel, klicken auf die Schaltfl√§che Start und ... <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e5/220/6ff/9e52206ffadd67162cf8e9893d3e7c4f.gif"></div><br>  Es scheint nichts als einen wei√üen Bildschirm zu geben.  Dar√ºber hinaus melden einige Emulatoren m√∂glicherweise "CPU-Stau!" In der Statusleiste.  Was ist als n√§chstes zu tun? <br><br>  Zun√§chst m√ºssen Sie den Code lokalisieren, in dem der Fehler auftritt.  Und hier kommt mein Klangmakro ins Spiel. <br><br>  Wir wissen sicher, dass das Hauptmen√º funktioniert.  Mal sehen, was danach passiert: <br><br><pre> <code class="cpp hljs">playMainMenu(); player.lives = <span class="hljs-number"><span class="hljs-number">9</span></span>; points = <span class="hljs-number"><span class="hljs-number">0</span></span>; gameFlags = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(current_level&lt;<span class="hljs-number"><span class="hljs-number">7</span></span> &amp;&amp; player.lives&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { set_world(current_world); debugSound; playCurrentLevel(); }</code> </pre> <br>  Ich habe den Verdacht, dass das Spiel abst√ºrzt, wenn die <code>set_world</code> Prozedur <code>set_world</code> .  Lassen Sie uns diese Vermutung √ºberpr√ºfen.  Ich gebe einfach den Makronamen in die n√§chste Zeile ein, nachdem die Prozedur √ºberpr√ºft wurde. <br><br>  Wir starten das Projekt und ... ich h√∂re einen Ton!  Das hei√üt, dieses Verfahren war erfolgreich und wir m√ºssen Folgendes √ºberpr√ºfen: <code>playCurrentLevel</code> .  Verschieben wir das Debug-Makro unten: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(current_level&lt;<span class="hljs-number"><span class="hljs-number">7</span></span> &amp;&amp; player.lives&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { set_world(); playCurrentLevel(): debugSound; }</code> </pre> <br>  Ich starte das Projekt erneut, kann jedoch keinen Ton h√∂ren.  Dies bedeutet, dass der Vorgang nicht abgeschlossen ist und ein Fehler darin auftritt. <br><br>  In solchen F√§llen sollten Sie den Prozedurcode √∂ffnen und diese Technik weiter anwenden, bis Sie Ihre Suche nach einem m√∂glichen Fehlerort eingrenzen k√∂nnen. <br><br>  Ein Makro zum √Ñndern der Palette kann auch zum √úberpr√ºfen der Bedingungen hilfreich sein.  Zum Beispiel f√ºhrt unser Code einen komplexen Test mehrerer Bedingungen durch: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( (getTile(objX, objY+<span class="hljs-number"><span class="hljs-number">16</span></span>) || collide16() ) || (objsOX[i] &amp;&amp; objY&gt;objsOX[i])) { debugRed; objsSTATE[i]=THWOMP_SMASH; objY=objsY[i]-=<span class="hljs-number"><span class="hljs-number">4</span></span>; objsFRM[i]=<span class="hljs-number"><span class="hljs-number">0</span></span>; sfx_play(SFX_THWOMP_SLAM_DOWN,<span class="hljs-number"><span class="hljs-number">2</span></span>); }</code> </pre> <br>  Wenn wir hier die Farbe der Palette √§ndern, werden wir sehen, ob die Bedingung erf√ºllt ist: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/196/db1/654/196db16543e8be8a6e7e02f01316a84f.gif"></div><br>  Dieses Huhn scheint in Ordnung zu sein.  Wenn das Flag jedoch nicht funktioniert, ist eine der Bedingungen nicht erf√ºllt.  In diesem Fall m√ºssen Sie alle separat √ºberpr√ºfen, und dann finden Sie m√∂glicherweise einen weiteren Fehler. <br><br><h3>  Nukleare Option </h3><br>  Ich habe k√ºrzlich entdeckt, dass einer der Geister in meinem Spiel verd√§chtiges Verhalten zeigt.  Von Zeit zu Zeit weigerte er sich, den Spieler anzugreifen. <br><br>  Schauen Sie sich diesen Geist an, der von einem Fehler getroffen wurde - er greift nur an, wenn sich der Charakter in der N√§he der Bildschirmmitte befindet: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f17/bd9/e30/f17bd9e300807a706298c64d8113c5f1.gif"></div><br>  Egal wie intensiv ich den Code dieses Verfahrens studiert habe, ich konnte nicht herausfinden, wo der Fehler versteckt war, und entschied mich daher, extreme Ma√ünahmen zu ergreifen und die Arbeit dieses Codes in einer modernen Entwicklungsumgebung zu testen. <br><br>  Ich nahm alles, was ich brauchte: eine Bildschirmzuordnung, ein Array mit Metadateiattributen, einen Prozedurcode und f√ºgte sie einfach in Visual Studio 2017 ein: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/383/d8f/d69/383d8fd6900e550652513f43fb70b6ff.png"></div><br>  Auf dem PC funktionierte der Code genauso.  Wie sich herausstellte, versteckte sich der Fehler in einer Prozedur, die den Cache f√ºllte, um Hindernisse zwischen dem Spieler und dem Feind zu finden.  Das Array wurde falsch gef√ºllt.  Ich bin sicher, es sollte 0 statt 0x80 geben. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2f0/225/8c5/2f02258c52bbc8c4e2bf59b9e9aab8b4.png"></div><br>  Daher werde ich versuchen, den Code Schritt f√ºr Schritt zu debuggen, um herauszufinden, warum dies geschieht. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d23/678/2db/d236782dbf4473e6bee4c7460782fec9.gif"></div><br>  Es ist lustig, aber es sieht so aus, als h√§tte ich die Aktionen in der falschen Reihenfolge ausgef√ºhrt.  Lassen Sie es uns beheben und das Array erneut √ºberpr√ºfen! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4c7/b01/54b/4c7b0154b745c486715e4af208ff0068.png"></div><br>  Es scheint, dass das Array jetzt korrekt gef√ºllt ist.  Das hei√üt, ich muss nur den cc65-Code korrigieren und das NES-Projekt erneut kompilieren. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/1NRqqPzOoSg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Moderne Entwicklungstools k√∂nnen also beim Debuggen von Algorithmen und beim Beheben von Fehlern helfen. <br><br><h3>  Befreien Sie sich ruhig von Insekten </h3><br>  Fehler sind √§rgerlich, ebenso wie Code √§rgerlich.  Bleiben Sie einfach ruhig, verlieren Sie nicht die Kontrolle und nutzen Sie die gesamte Palette der verf√ºgbaren Werkzeuge, um diese Sch√§dlinge zu suchen und zu zerst√∂ren.  Die Qualit√§t Ihres Codes und die Sicherheit werden erheblich verbessert. <br><br>  <em>M√∂chten Sie Tipps direkt von Retro-Design-Profis erhalten?</em>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="noopener noreferrer">Willkommen zu unserer Zwietracht!</a></em> <em><br><br></em>  <em><em>Unser Spiel The Meating gibt es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> !</em></em> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de466653/">https://habr.com/ru/post/de466653/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de466641/index.html">Als Dummkopf lehrte C #. Teil 1</a></li>
<li><a href="../de466643/index.html">Die Zusammenfassung interessanter Materialien f√ºr den mobilen Entwickler # 314 (vom 2. bis 8. September)</a></li>
<li><a href="../de466647/index.html">Telefon f√ºr ein Pferd und ein Orchester ohne Pianisten. Wie man Sportaufgaben am Frontend macht</a></li>
<li><a href="../de466649/index.html">Wochenende mit Elektroauto</a></li>
<li><a href="../de466651/index.html">Auswahl zwischen XML und SQL zum Rollen von LiquiBase-Skripten am Beispiel von Java / Spring / H2</a></li>
<li><a href="../de466657/index.html">Dynamisches Detail: verdeckte Compiler-Spiele, Speicherverlust, Leistungsnuancen</a></li>
<li><a href="../de466659/index.html">Kubecost Bewertung, um Geld f√ºr Kubernetes in den Wolken zu sparen</a></li>
<li><a href="../de466661/index.html">Fernstudium im Ausland: Notizen vor der Arbeit</a></li>
<li><a href="../de466663/index.html">Einfache Experimente mit dem Mikrocontroller STM32F103 (Blue Tablet)</a></li>
<li><a href="../de466665/index.html">CSS-√úberlauf und Datenverlust</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>