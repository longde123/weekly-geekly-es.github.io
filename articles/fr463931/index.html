<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïö üé¨ ‚ôêÔ∏è Explorer les profondeurs des annotations de type en Python. 2e partie üèÖ üï∫ ‚ûï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aujourd'hui, nous publions la deuxi√®me partie d'une traduction du mat√©riel, qui est consacr√©e aux annotations de type en Python. 

  

 ‚Üí La premi√®re ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Explorer les profondeurs des annotations de type en Python. 2e partie</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/463931/">  Aujourd'hui, nous publions la deuxi√®me partie d'une traduction du mat√©riel, qui est consacr√©e aux annotations de type en Python. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/wr/lw/bq/wrlwbqu0zinltnd22qtfjqnhsb4.jpeg"></a> <br><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La premi√®re partie</a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Comment Python prend-il en charge les types de donn√©es?</font> </h2><br>  Python est un langage typ√© dynamiquement.  Cela signifie que les types de variables utilis√©s ne sont v√©rifi√©s que pendant l'ex√©cution du programme.  Dans l'exemple donn√© dans la partie pr√©c√©dente de l'article, on pouvait voir qu'un programmeur qui √©crit en Python n'avait pas besoin de planifier les types de variables et de r√©fl√©chir √† la quantit√© de m√©moire n√©cessaire pour stocker ses donn√©es. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Voici</a> ce qui se passe lorsque vous pr√©parez votre code Python pour l'ex√©cution: ¬´En Python, le code source est converti √† l'aide de CPython en une forme beaucoup plus simple appel√©e bytecode.  Le bytecode se compose d'instructions qui, en substance, sont similaires aux instructions du processeur.  Mais ils ne sont pas ex√©cut√©s par le processeur, mais par un syst√®me logiciel appel√© machine virtuelle.  (Il ne s'agit pas de machines virtuelles dont les capacit√©s vous permettent d'ex√©cuter des syst√®mes d'exploitation entiers sur elles. Dans notre cas, il s'agit d'un environnement qui est une version simplifi√©e de l'environnement disponible pour les programmes s'ex√©cutant sur le processeur). " <br><br>  Comment CPython sait-il quels types de variables doivent √™tre lorsqu'il pr√©pare un programme pour l'ex√©cution?  Apr√®s tout, nous n'avons pas indiqu√© ces types.  CPython n'en sait rien.  Il sait seulement que les variables sont des objets.  Tout en Python est un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">objet</a> , au moins jusqu'√† ce qu'il s'av√®re que quelque chose a un type plus sp√©cifique. <br><br>  Par exemple, Python consid√®re comme une cha√Æne tout ce qui est entour√© de guillemets simples ou doubles.  Si Python rencontre un nombre, il consid√®re que la valeur correspondante est de type num√©rique.  Si nous essayons de faire quelque chose avec une entit√© qui ne peut pas √™tre fait avec une entit√© de son type, Python nous le fera savoir plus tard. <br><br>  Consid√©rez le message d'erreur suivant qui s'affiche lorsque vous essayez d'ajouter une cha√Æne et un nombre: <br><br><pre><code class="python hljs">name = <span class="hljs-string"><span class="hljs-string">'Vicki'</span></span> seconds = <span class="hljs-number"><span class="hljs-number">4.71</span></span>; --------------------------------------------------------------------------- TypeError                 Traceback (most recent call last) &lt;ipython-input<span class="hljs-number"><span class="hljs-number">-9</span></span><span class="hljs-number"><span class="hljs-number">-71805</span></span>d305c0b&gt; <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;module&gt;       <span class="hljs-number"><span class="hljs-number">3</span></span>       <span class="hljs-number"><span class="hljs-number">4</span></span> ----&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> name + seconds TypeError: must be str, <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> float</code> </pre> <br>  Le syst√®me nous dit qu'il ne peut pas ajouter de cha√Ænes et de nombres √† virgule flottante.  De plus, le fait que le <code>name</code> soit une cha√Æne et les <code>seconds</code> un nombre n'int√©ressait pas le syst√®me jusqu'√† ce qu'une tentative soit faite pour ajouter le <code>name</code> et les <code>seconds</code> . <br><br>  En d'autres termes, il peut √™tre d√©crit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">comme suit</a> : ¬´Le typage canard est utilis√© lors de l'addition.  Python n'est pas int√©ress√© par le type d'un objet particulier.  Tout ce qui int√©resse le syst√®me, c'est s'il renvoie un appel significatif √† la m√©thode d'addition.  Si ce n'est pas le cas, une erreur est g√©n√©r√©e. " <br><br>  Qu'est-ce que cela signifierait?  Cela signifie que si nous √©crivons des programmes Python, nous ne recevrons pas de message d'erreur tant que l'interpr√©teur CPython ne sera pas engag√© dans l'ex√©cution de la m√™me ligne dans laquelle il y a une erreur. <br><br>  Cette approche n'√©tait pas pratique lorsqu'elle √©tait appliqu√©e dans des √©quipes travaillant sur de grands projets.  Le fait est que dans de tels projets, ils ne fonctionnent pas avec des variables distinctes, mais avec des structures de donn√©es complexes.  Dans de tels projets, certaines fonctions sont appel√©es par d'autres, et celles-ci, √† leur tour, sont appel√©es par d'autres fonctions.  Les membres de l'√©quipe doivent pouvoir v√©rifier rapidement le code de leurs projets.  S'ils ne sont pas en mesure d'√©crire de bons tests qui d√©tectent les erreurs dans les projets avant leur mise en production, cela signifie que ces projets peuvent s'attendre √† de gros probl√®mes. <br><br>  √Ä proprement parler, nous arrivons ici √† la conversation sur les annotations de type en Python. <br><br>  On peut dire qu'en g√©n√©ral, l'utilisation d'annotations de type a de nombreux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">atouts</a> .  Si vous travaillez avec des structures de donn√©es ou des fonctions complexes qui prennent de nombreuses valeurs d'entr√©e, l'utilisation d'annotations simplifie consid√©rablement le travail avec des structures et des fonctions similaires.  Surtout - quelque temps apr√®s leur cr√©ation.  Si vous n'avez qu'une seule fonction avec un seul param√®tre, comme dans les exemples donn√©s ici, alors travailler avec une telle fonction est, en tout cas, tr√®s simple. <br><br>  Et si nous devons travailler avec des fonctions complexes qui prennent de nombreuses valeurs d'entr√©e similaires √† celles de la documentation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PyTorch</a> : <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">train</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(args, model, device, train_loader, optimizer, epoch)</span></span></span><span class="hljs-function">:</span></span>    model.train()    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> batch_idx, (data, target) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(train_loader):        data, target = data.to(device), target.to(device)        optimizer.zero_grad()        output = model(data)        loss = F.nll_loss(output, target)        loss.backward()        optimizer.step()        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> batch_idx % args.log_interval == <span class="hljs-number"><span class="hljs-number">0</span></span>:            print(<span class="hljs-string"><span class="hljs-string">'Train Epoch: {} [{}/{} ({:.0f}%)]\tLoss: {:.6f}'</span></span>.format(                epoch, batch_idx * len(data), len(train_loader.dataset), <span class="hljs-number"><span class="hljs-number">100.</span></span> * batch_idx / len(train_loader), loss.item()))</code> </pre> <br>  Qu'est-ce que le <code>model</code> ?  Bien s√ªr, nous pouvons creuser dans la base de code et d√©couvrir: <br><br><pre> <code class="python hljs">model = Net().to(device)</code> </pre> <br>  Mais ce serait bien si vous pouviez simplement sp√©cifier le type de <code>model</code> dans la signature de fonction et vous √©pargner des analyses de code inutiles.  Peut-√™tre que cela ressemblerait √† ceci: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">train</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(args, model </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(type Net)</span></span></span></span><span class="hljs-function"><span class="hljs-params">, device, train_loader, optimizer, epoch)</span></span></span><span class="hljs-function">:</span></span></code> </pre> <br>  Et l' <code>device</code> ?  Si vous fouillez le code, vous pouvez trouver les informations suivantes: <br><br><pre> <code class="python hljs">device = torch.device(<span class="hljs-string"><span class="hljs-string">"cuda"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> use_cuda <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">"cpu"</span></span>)</code> </pre> <br>  Nous sommes maintenant confront√©s √† la question de savoir ce qu'est un appareil <code>torch.device</code> .  Il s'agit d'un type sp√©cial de PyTorch.  Sa description se trouve dans la <a href="">section correspondante de</a> la documentation PyTorch. <br><br>  Ce serait bien si nous pouvions sp√©cifier le type <code>device</code> dans la liste d'arguments de la fonction.  Ainsi, nous gagnerions beaucoup de temps √† ceux qui devraient analyser ce code. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">train</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(args, model </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(type Net)</span></span></span></span><span class="hljs-function"><span class="hljs-params">, device </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(type torch.Device)</span></span></span></span><span class="hljs-function"><span class="hljs-params">, train_loader, optimizer, epoch)</span></span></span><span class="hljs-function">:</span></span></code> </pre> <br>  Ces consid√©rations peuvent perdurer tr√®s longtemps. <br><br>  En cons√©quence, il s'av√®re que les annotations de type sont tr√®s utiles pour quelqu'un qui √©crit du code.  Mais ils profitent √©galement √† ceux qui lisent le code des autres.  Il est beaucoup plus facile de lire du code dactylographi√© que du code, pour comprendre que vous devez g√©rer ce qu'est une entit√©.  Les annotations de type am√©liorent la lisibilit√© du code. <br><br>  Alors, qu'est-ce qui a √©t√© fait en Python pour amener le code au m√™me niveau de lisibilit√© qui distingue le code √©crit dans des langages typ√©s statiquement? <br><br><h2>  <font color="#3AC1EF">Annotations de type en Python</font> </h2><br>  Nous sommes maintenant pr√™ts √† parler s√©rieusement des annotations de type en Python.  Lors de la lecture de programmes √©crits en Python 2, on pouvait voir que les programmeurs fournissaient leur code avec des conseils indiquant aux lecteurs du code de quel type sont les variables ou les valeurs renvoy√©es par les fonctions. <br><br>  Un code similaire ressemblait √† l'origine √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ceci</a> : <br><br><pre> <code class="python hljs">users = [] <span class="hljs-comment"><span class="hljs-comment"># type: List[UserID] examples = {} # type: Dict[str, Any]</span></span></code> </pre> <br>  Les annotations de type √©taient auparavant de simples commentaires.  Mais il se trouve que Python a commenc√© √† √©voluer progressivement vers une mani√®re plus uniforme de g√©rer les annotations.  En particulier, nous parlons de l'√©mergence du document <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PEP 3107</a> , d√©di√© √† l'annotation des fonctions. <br><br>  Ensuite, les travaux ont commenc√© sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PEP 484</a> .  Ce document, consacr√© aux annotations de types, a √©t√© d√©velopp√© en √©troite relation avec mypy, le projet DropBox, qui vise √† v√©rifier les types avant d'ex√©cuter des scripts.  En utilisant mypy, il convient de se rappeler que la v√©rification de type n'est pas effectu√©e pendant l'ex√©cution du script.  Un message d'erreur peut √™tre re√ßu lors de l'ex√©cution si, par exemple, vous essayez de cr√©er quelque chose d'un type que ce type ne prend pas en charge.  Dites - si vous essayez de d√©couper un dictionnaire ou appelez la m√©thode <code>.pop()</code> pour une cha√Æne. <br><br>  Voici ce que vous pouvez apprendre du PEP 484 sur les d√©tails de la mise en ≈ìuvre des annotations: ¬´Bien que ces annotations soient disponibles au moment de l'ex√©cution via l'attribut d' <code>annotations</code> standard, aucune v√©rification de type n'est effectu√©e au moment de l'ex√©cution.  Au lieu de cela, cette proposition pr√©voit l'existence d'un outil de v√©rification de type autonome distinct, avec lequel l'utilisateur, s'il le souhaite, peut v√©rifier le code source de ses programmes.  En g√©n√©ral, un outil de v√©rification de type similaire fonctionne comme un linter tr√®s puissant.  "Bien que, bien s√ªr, les utilisateurs individuels puissent utiliser un outil similaire pour v√©rifier les types au moment de l'ex√©cution, soit pour la mise en ≈ìuvre de la m√©thodologie Design By Contract ou pour la mise en ≈ìuvre de l'optimisation JIT. Mais il convient de noter que ces outils n'ont pas encore atteint une maturit√© suffisante." <br><br>  √Ä quoi ressemble le travail avec les annotations de type dans la pratique? <br><br>  Par exemple, leur utilisation signifie la capacit√© de faciliter le travail dans divers IDE.  Ainsi, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PyCharm</a> propose, en fonction des informations de type, de l'ach√®vement du code et de la v√©rification.  Des fonctionnalit√©s similaires sont disponibles dans VS Code. <br><br>  Les annotations de type sont utiles pour une raison suppl√©mentaire: elles prot√®gent le d√©veloppeur contre les erreurs stupides.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Voici un</a> excellent exemple d'une telle protection. <br><br>  Supposons que nous ajoutions les noms des personnes au dictionnaire: <br><br><pre> <code class="python hljs">names = {<span class="hljs-string"><span class="hljs-string">'Vicki'</span></span>: <span class="hljs-string"><span class="hljs-string">'Boykis'</span></span>,         <span class="hljs-string"><span class="hljs-string">'Kim'</span></span>: <span class="hljs-string"><span class="hljs-string">'Kardashian'</span></span>} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append_name</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dict, first_name, last_name)</span></span></span><span class="hljs-function">:</span></span>    dict[first_name] = last_name   append_name(names,<span class="hljs-string"><span class="hljs-string">'Kanye'</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span>)</code> </pre> <br>  Si nous l'autorisons, il y aura de nombreuses entr√©es incorrectement form√©es dans le dictionnaire. <br>  Corrigeons ceci: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> typing <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Dict names_new: Dict[str, str] = {<span class="hljs-string"><span class="hljs-string">'Vicki'</span></span>: <span class="hljs-string"><span class="hljs-string">'Boykis'</span></span>,                             <span class="hljs-string"><span class="hljs-string">'Kim'</span></span>: <span class="hljs-string"><span class="hljs-string">'Kardashian'</span></span>} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append_name</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dic: Dict[str, str] , first_name: str, last_name: str)</span></span></span><span class="hljs-function">:</span></span>    dic[first_name] = last_name append_name(names_new,<span class="hljs-string"><span class="hljs-string">'Kanye'</span></span>,<span class="hljs-number"><span class="hljs-number">9.7</span></span>) names_new</code> </pre> <br>  Maintenant, v√©rifiez ce code avec mypy et obtenez ce qui suit: <br><br><pre> <code class="python hljs">(kanye) mbp-vboykis:types vboykis$ mypy kanye.py kanye.py:<span class="hljs-number"><span class="hljs-number">9</span></span>: error: Argument <span class="hljs-number"><span class="hljs-number">3</span></span> to <span class="hljs-string"><span class="hljs-string">"append_name"</span></span> has incompatible type <span class="hljs-string"><span class="hljs-string">"float"</span></span>; expected <span class="hljs-string"><span class="hljs-string">"str"</span></span></code> </pre> <br>  On peut voir que mypy ne permet pas l'utilisation de nombres l√† o√π la cha√Æne est attendue.  Ceux qui souhaitent utiliser r√©guli√®rement ces tests sont invit√©s √† inclure mypy lorsque les tests de code sont effectu√©s dans leurs syst√®mes d'int√©gration continue. <br><br><h2>  <font color="#3AC1EF">Tapez des astuces dans divers IDE</font> </h2><br>  L'un des avantages les plus importants de l'utilisation des annotations de type est qu'ils permettent aux programmeurs Python d'utiliser les m√™mes fonctionnalit√©s de compl√©tion de code dans divers IDE disponibles pour les langages typ√©s statiquement. <br><br>  Par exemple, supposons que vous ayez un morceau de code semblable au suivant.  Il s'agit de quelques fonctions des exemples pr√©c√©dents encapsul√©es dans des classes. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> typing <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Dict <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rainfallRate</span></span></span><span class="hljs-class">:</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, hours, inches)</span></span></span><span class="hljs-function">:</span></span>        self.hours= hours        self.inches = inches    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateRate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, inches:int, hours:int)</span></span></span><span class="hljs-function"> -&gt; float:</span></span>        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> inches/hours rainfallRate.calculateRate() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">addNametoDict</span></span></span><span class="hljs-class">:</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, first_name, last_name)</span></span></span><span class="hljs-function">:</span></span>        self.first_name = first_name        self.last_name = last_name        self.dict = dict    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append_name</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dict:Dict[str, str], first_name:str, last_name:str)</span></span></span><span class="hljs-function">:</span></span>        dict[first_name] = last_name addNametoDict.append_name()</code> </pre> <br>  La bonne chose est que nous, de notre propre initiative, avons ajout√© des descriptions de types au code, nous pouvons observer ce qui se passe dans le programme lorsque les m√©thodes de classe sont appel√©es: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8dd/b42/ded/8ddb42ded904ffe516a90d990a7ff856.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/731/336/a7a/731336a7aa97c55b1e60930ada747ac0.png"></div><br>  <i><font color="#999999">Conseils de type IDE</font></i> <br><br><h2>  <font color="#3AC1EF">Premiers pas avec les annotations de type</font> </h2><br>  Vous pouvez trouver de bonnes recommandations dans la documentation de mypy pour savoir par quoi commencer lorsque vous commencez √† taper la base de code: <br><br><ol><li>  Commencez petit - assurez-vous que certains fichiers contenant plusieurs annotations sont valid√©s avec mypy. </li><li>  √âcrivez un script pour ex√©cuter mypy.  Cela aidera √† obtenir des r√©sultats de test coh√©rents. </li><li>  Ex√©cutez mypy dans les pipelines CI pour √©viter les erreurs de type. </li><li>  Annotez progressivement les modules les plus utilis√©s dans le projet. </li><li>  Ajoutez des annotations de type au code existant que vous modifiez;  √©quipez-les du nouveau code que vous √©crivez. </li><li>  Utilisez MonkeyType ou PyAnnotate pour annoter automatiquement l'ancien code. </li></ol><br>  Avant de vous lancer dans l'annotation de votre propre code, il vous sera utile de traiter quelque chose. <br><br>  Tout d'abord, vous devrez importer le module de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">saisie</a> dans le code si vous utilisez autre chose que des cha√Ænes, des entiers, des bool√©ens et les valeurs d'autres types de base Python. <br><br>  Deuxi√®mement, ce module permet de travailler avec plusieurs types complexes.  Parmi eux, <code>Dict</code> , <code>Tuple</code> , <code>List</code> et <code>Set</code> .  La construction du formulaire <code>Dict[str, float]</code> signifie que vous souhaitez travailler avec un dictionnaire dont les √©l√©ments utilisent une cha√Æne comme cl√© et un nombre √† virgule flottante comme valeur.  Il existe √©galement des types appel√©s <code>Optional</code> et <code>Union</code> . <br><br>  Troisi√®mement, vous devez vous familiariser avec le format des annotations de type: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> typing <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">some_function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(variable: type)</span></span></span><span class="hljs-function"> -&gt; return_type:</span></span>  do_something</code> </pre> <br>  Si vous souhaitez en savoir plus sur la fa√ßon de commencer √† appliquer des annotations de type dans vos projets, je voudrais noter que de nombreux bons didacticiels y sont consacr√©s.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">En voici</a> un.  Je le consid√®re comme le meilleur.  Apr√®s l'avoir ma√Ætris√©, vous en apprendrez plus sur l'annotation de code et sa v√©rification. <br><br><h2>  <font color="#3AC1EF">Les r√©sultats.</font>  <font color="#3AC1EF">Vaut-il la peine d'utiliser des annotations de type en Python?</font> </h2><br>  Maintenant, demandons-nous si vous devez utiliser des annotations de type en Python.  En fait, cela d√©pend des caract√©ristiques de votre projet.  Voici ce que Guido van Rossum dit √† ce sujet dans la documentation de mypy: ¬´Le but de mypy n'est pas de convaincre tout le monde d'√©crire du code Python typ√© statiquement.  La saisie statique est compl√®tement facultative maintenant et √† l'avenir.  L'objectif de Mypy est d'offrir aux programmeurs Python plus d'options.  Il s'agit de faire de Python une alternative plus comp√©titive aux autres langages typ√©s statiquement utilis√©s dans les grands projets.  Il s'agit d'augmenter la productivit√© des programmeurs et d'am√©liorer la qualit√© des logiciels. " <br><br>  Le temps n√©cessaire pour configurer mypy et planifier les types n√©cessaires √† un certain programme ne se justifie pas dans les petits projets et lors des exp√©rimentations (par exemple, celles r√©alis√©es dans Jupyter).  Quel projet devrait √™tre consid√©r√© comme petit?  Probablement celui dont le volume, selon des estimations soigneuses, ne d√©passe pas 1000 lignes. <br><br>  Les annotations de type ont un sens dans les grands projets.  L√†, ils peuvent notamment gagner beaucoup de temps.  Nous parlons de projets d√©velopp√©s par des groupes de programmeurs, de packages, de code, qui sont utilis√©s dans le d√©veloppement de syst√®mes de contr√¥le de version et de pipelines CI. <br><br>  Je crois que les annotations de type au cours des deux prochaines ann√©es deviendront beaucoup plus courantes que maintenant, sans parler du fait qu'elles pourraient bien devenir un outil ordinaire de tous les jours.  Et je crois que quelqu'un qui commence √† travailler avec eux avant les autres ne perdra rien. <br><br>  <b>Chers lecteurs!</b>  Utilisez-vous des annotations de type dans vos projets Python? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr463931/">https://habr.com/ru/post/fr463931/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr463921/index.html">(Pas tr√®s) les co√ªts cach√©s de la base de code commune d'iOS et d'Android</a></li>
<li><a href="../fr463923/index.html">.container n'est plus n√©cessaire</a></li>
<li><a href="../fr463925/index.html">Vivaldi: Comment comptons-nous le nombre d'utilisateurs?</a></li>
<li><a href="../fr463927/index.html">Contournement de la s√©curit√© et de la censure: 5 VPN et procurations pour Google Chrome</a></li>
<li><a href="../fr463929/index.html">Explorer les profondeurs des annotations de type en Python. Partie 1</a></li>
<li><a href="../fr463933/index.html">Un script Python de 20 lignes qui souhaite aux parents bonjour tous les jours via WhatsApp</a></li>
<li><a href="../fr463937/index.html">Je n'ai rien √† cacher</a></li>
<li><a href="../fr463939/index.html">SimbirSoft a publi√© une solution mobile pour les compagnies d'assurance</a></li>
<li><a href="../fr463943/index.html">Les m√©saventures de la licorne noire</a></li>
<li><a href="../fr463951/index.html">c.tech: Cassandra Meetup # 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>