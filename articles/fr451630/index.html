<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçüç≥ üë©üèΩ‚ÄçüöÄ üç° Surveillance continue - automatisation des contr√¥les de qualit√© des logiciels dans CI / CD Pipeline üöµüèº üéâ üöª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Maintenant sur le th√®me battage DevOps. Convoyeur d'int√©gration continue et de livraison de CI / CD est mis en ≈ìuvre par tous ceux qui en ont envie. M...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Surveillance continue - automatisation des contr√¥les de qualit√© des logiciels dans CI / CD Pipeline</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lanit/blog/451630/">  Maintenant sur le th√®me battage DevOps.  Convoyeur d'int√©gration continue et de livraison de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CI / CD est</a> mis en ≈ìuvre par tous ceux qui en ont envie.  Mais la plupart ne pr√™tent pas toujours l'attention voulue √† la fiabilit√© des syst√®mes d'information √† divers stades du pipeline CI / CD.  Dans cet article, je voudrais parler de mon exp√©rience dans l'automatisation des contr√¥les de qualit√© des logiciels et l'impl√©mentation de sc√©narios possibles pour leur "auto-gu√©rison". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/279/b1b/d43/279b1bd4301b7755a590307a9378243c.jpg"></div>  <a href=""><i>Source</i></a> <br><a name="habracut"></a><br>  Je travaille en tant qu'ing√©nieur au sein du d√©partement de gestion des services informatiques de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LANIT-Integration</a> .  Mon domaine principal est la mise en ≈ìuvre de divers syst√®mes de surveillance des performances et de la disponibilit√© des applications.  Je communique souvent avec des clients informatiques de diff√©rents segments de march√© sur des questions d'actualit√© concernant le contr√¥le de la qualit√© de leurs services informatiques.  La t√¢che principale est de minimiser le temps de cycle de lib√©ration et d'augmenter la fr√©quence de leur lib√©ration.  Bien s√ªr, tout cela est bien: plus de versions - plus de nouvelles fonctionnalit√©s - plus d'utilisateurs satisfaits - plus de profits.  Mais en r√©alit√©, tout ne se passe pas toujours bien.  √Ä des taux de d√©ploiement tr√®s √©lev√©s, la question se pose imm√©diatement de la qualit√© de nos versions.  M√™me avec un pipeline enti√®rement automatis√©, l'un des plus gros probl√®mes est le transfert de services du test √† la production, ce qui n'affecte pas la disponibilit√© et l'interaction de l'utilisateur avec l'application. <br><br>  Sur la base des r√©sultats de nombreuses conversations avec les clients, je peux dire que le contr√¥le de la qualit√© des versions, le probl√®me de la fiabilit√© des applications et la possibilit√© de son "auto-gu√©rison" (par exemple, le retour √† une version stable) √† diff√©rentes √©tapes du pipeline CI / CD sont parmi les sujets les plus passionnants et pertinents. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/373/e6e/f90/373e6ef9080b3a7f8c6c4e65568254eb.png"></div><br>  R√©cemment, j'ai moi-m√™me travaill√© du c√¥t√© client - dans le service d'assistance aux applications bancaires en ligne.  L'architecture de notre application utilisait un grand nombre de microservices auto-√©crits.  Le plus triste est que tous les d√©veloppeurs n'ont pas fait face au rythme √©lev√© de d√©veloppement, la qualit√© de certains microservices a souffert, ce qui a donn√© lieu √† des surnoms ridicules pour eux et leurs cr√©ateurs.  Il y avait des histoires sur les mat√©riaux dont ces produits sont faits. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/210/472/129/21047212917809f642f154cfa2b8e6c6.png"></div><br><h1>  "√ânonc√© du probl√®me" </h1><br>  La fr√©quence √©lev√©e des rejets et un grand nombre de microservices rendent difficile la compr√©hension de l'application dans son ensemble, tant au stade des tests qu'au stade op√©rationnel.  Les changements se produisent constamment et il est tr√®s difficile de les contr√¥ler sans de bons outils de surveillance.  Souvent, apr√®s une sortie nocturne le matin, les d√©veloppeurs sont assis sur un baril de poudre et attendent que rien ne se brise, bien qu'au stade des tests, tous les contr√¥les aient r√©ussi. <br><br>  Il y a encore un point.  Au stade des tests, l'op√©rabilit√© du logiciel est v√©rifi√©e: la mise en ≈ìuvre des principales fonctions de l'application et l'absence d'erreurs.  Les estimations qualitatives des performances sont soit absentes, soit ne prennent pas en compte tous les aspects de l'application et de la couche d'int√©gration.  Certaines mesures peuvent ne pas √™tre v√©rifi√©es du tout.  Par cons√©quent, lorsqu'une panne se produit dans un environnement productif, le service d'assistance technique ne d√©couvre que lorsque de vrais utilisateurs commencent √† se plaindre.  Je souhaite minimiser l'impact des logiciels de faible qualit√© sur les utilisateurs finaux. <br><br>  L'une des solutions consiste √† mettre en ≈ìuvre des processus de contr√¥le qualit√© logiciel √† diff√©rentes √©tapes du pipeline CI / CD, √† ajouter divers scripts pour restaurer le syst√®me en cas d'accident.  N'oubliez pas non plus que nous avons des DevOps.  Les entreprises s'attendent √† recevoir un nouveau produit le plus rapidement possible.  Par cons√©quent, tous nos contr√¥les et scripts doivent √™tre automatis√©s. <br><br>  La t√¢che est divis√©e en deux volets: <br><br><ul><li>  contr√¥le qualit√© des assemblages au stade des tests (pour automatiser le processus de capture des assemblages de qualit√© inf√©rieure); </li><li>  contr√¥le de la qualit√© des logiciels dans l'environnement de production (m√©canismes de d√©tection automatique des probl√®mes et sc√©narios possibles d'auto-gu√©rison). </li></ul><br><h1>  Outil de surveillance et de collecte de m√©triques </h1><br>  Afin de r√©aliser les t√¢ches d√©finies, un syst√®me de surveillance est n√©cessaire pour d√©tecter les probl√®mes et les transf√©rer vers des syst√®mes d'automatisation √† diff√©rentes √©tapes du pipeline CI / CD.  De plus, un point positif sera si ce syst√®me fournit des m√©triques utiles pour diff√©rentes √©quipes: d√©veloppement, test, op√©ration.  Et tout √† fait merveilleux, si pour les affaires. <br><br>  Pour collecter des m√©triques, vous pouvez utiliser une combinaison de diff√©rents syst√®mes (Prometheus, ELK Stack, Zabbix, etc.), mais, √† mon avis, les solutions APM ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Application Performance Monitoring</a> ) sont les mieux adapt√©es √† ces t√¢ches, ce qui peut grandement vous simplifier la vie. <br><br>  Dans le cadre de mon travail dans le service d'escorte, j'ai commenc√© √† faire un projet similaire en utilisant la solution de classe APM de Dynatrace.  Maintenant, en tant qu'int√©grateur, je connais assez bien le march√© des syst√®mes de surveillance.  Mon opinion subjective: Dynatrace est le mieux adapt√© pour de telles t√¢ches. <br>  La solution Dynatrace fournit un affichage horizontal de chaque op√©ration utilisateur avec un degr√© de d√©tail approfondi jusqu'au niveau d'ex√©cution du code.  Vous pouvez suivre l'int√©gralit√© de la cha√Æne d'interaction entre les diff√©rents services d'information: des niveaux frontaux d'applications Web et mobiles, des serveurs d'applications principaux, du bus d'int√©gration √† un appel sp√©cifique √† la base de donn√©es. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/223/706/776/223706776e2f818b7c9e58451f3b5874.png"></div>  <i><a href="">Source</a></i>  <i>Construction automatique de toutes les d√©pendances entre les composants du syst√®me</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/73f/796/e80/73f796e80d722c47cc6044f1c60bf2c8.png"></div>  <i><a href="">Source</a></i>  <i>D√©tection et construction automatiques d'un chemin pour une op√©ration de service</i> <br><br>  N'oubliez pas non plus que nous devons nous int√©grer √† divers outils d'automatisation.  Ici, la solution dispose d'une API pratique qui vous permet d'envoyer et de recevoir diverses mesures et √©v√©nements. <br><br>  Ensuite, nous allons passer √† une discussion plus d√©taill√©e sur la fa√ßon de r√©soudre les t√¢ches √† l'aide du syst√®me Dynatrace. <br><br><h1>  T√¢che 1. Automatisation du contr√¥le qualit√© des assemblages au stade des tests </h1><br>  La premi√®re t√¢che consiste √† d√©tecter les probl√®mes le plus t√¥t possible aux √©tapes du pipeline de livraison des applications.  Seules les ¬´bonnes¬ª versions de code devraient atteindre l'environnement de prod.  Pour ce faire, des moniteurs suppl√©mentaires doivent √™tre inclus dans votre pipeline au stade des tests pour v√©rifier la qualit√© de vos services. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/034/bd9/498/034bd9498761bf4addffd97f68e70699.png"></div><br><br>  Examinons les √©tapes pour impl√©menter cela et automatiser ce processus: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1b6/2eb/b7f/1b62ebb7fa1fd652fc7ca5110926676e.png"></div>  <i><a href="">Source</a></i> <br><br>  La figure montre le d√©roulement des √©tapes automatis√©es de contr√¥le de la qualit√© des logiciels: <br><br><ol><li>  d√©ploiement d'un syst√®me de surveillance (installation d'agents); </li><li>  d√©finition des √©v√©nements d'√©valuation de la qualit√© de votre logiciel (m√©triques et valeurs seuils) et leur transfert vers le syst√®me de surveillance; </li><li>  g√©n√©ration de charge et tests de performance; </li><li>  collecte de donn√©es de performance et de disponibilit√© dans un syst√®me de surveillance; </li><li>  transfert des donn√©es de test bas√©es sur les √©v√©nements d'√©valuation de la qualit√© du logiciel du syst√®me de surveillance vers le syst√®me CI / CD.  Analyse d'assemblage automatique. </li></ol><br>  <b>√âtape 1. D√©ployer un syst√®me de surveillance</b> <br><br>  Vous devez d'abord installer les agents dans votre environnement de test.  Dans le m√™me temps, la solution Dynatrace a une fonctionnalit√© int√©ressante - elle utilise l'agent universel OneAgent, qui est install√© sur l'instance de syst√®me d'exploitation (Windows, Linux, AIX), d√©tecte automatiquement vos services et commence √† collecter des donn√©es de surveillance sur eux.  Vous n'avez pas besoin de configurer un agent s√©par√©ment pour chaque processus.  Une situation similaire sera pour les plates-formes cloud et conteneurs.  Dans le m√™me temps, vous pouvez √©galement automatiser l'installation d'agents.  Dynatrace s'int√®gre parfaitement dans le concept d '"infrastructure en tant que code" ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Infrastructure en tant que code ou IaC</a> ): il existe des scripts et des instructions pr√™ts √† l'emploi pour toutes les plates-formes populaires.  Int√©grez l'agent dans la configuration de votre service et lorsque vous le d√©ployez, vous obtenez imm√©diatement un nouveau service avec un agent d√©j√† en cours d'ex√©cution. <br><br>  <b>√âtape 2. Identifiez vos √©v√©nements d'√©valuation de la qualit√© des logiciels</b> <br><br>  Vous devez maintenant d√©terminer la liste des services et des op√©rations commerciales.  Il est important de prendre en compte exactement les op√©rations utilisateur qui sont critiques pour votre service.  Ici, je recommande de consulter des analystes commerciaux et syst√®me. <br><br>  Ensuite, vous devez d√©terminer les mesures que vous souhaitez inclure dans la v√©rification pour chacun des niveaux.  Par exemple, il peut s'agir de runtime (avec s√©paration par moyenne, m√©diane, centile, etc.), d'erreurs (logique, service, infrastructure, etc.) et de diverses m√©triques d'infrastructure (tas de m√©moire, garbage collector, nombre de threads, etc.). <br><br>  Pour l'automatisation et la facilit√© d'utilisation, l'√©quipe DevOps introduit le concept de ¬´Monitoring as code¬ª.  Ce que je veux dire par l√†, c'est qu'un d√©veloppeur / testeur peut √©crire un simple fichier JSON qui d√©finit les indicateurs de contr√¥le de qualit√© logiciel. <br><br>  Regardons un exemple d'un tel fichier JSON.  Les objets de l'API Dynatrace sont utilis√©s comme paire cl√© / valeur (voir l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">API Dynatrace pour une description de l'API</a> ). <br><br><pre><code class="json hljs">{    <span class="hljs-attr"><span class="hljs-attr">"timeseries"</span></span>: [    {      <span class="hljs-attr"><span class="hljs-attr">"timeseriesId"</span></span>: <span class="hljs-string"><span class="hljs-string">"service.ResponseTime"</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"aggregation"</span></span>: <span class="hljs-string"><span class="hljs-string">"avg"</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"tags"</span></span>: <span class="hljs-string"><span class="hljs-string">"Frontend"</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"severe"</span></span>: <span class="hljs-number"><span class="hljs-number">250000</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"warning"</span></span>: <span class="hljs-number"><span class="hljs-number">1000000</span></span>    },    {      <span class="hljs-attr"><span class="hljs-attr">"timeseriesId"</span></span>: <span class="hljs-string"><span class="hljs-string">"service.ResponseTime "</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"aggregation"</span></span>: <span class="hljs-string"><span class="hljs-string">"avg"</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"tags"</span></span>: <span class="hljs-string"><span class="hljs-string">"Backend"</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"severe"</span></span>: <span class="hljs-number"><span class="hljs-number">4000000</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"warning"</span></span>: <span class="hljs-number"><span class="hljs-number">8000000</span></span>    },    {      <span class="hljs-attr"><span class="hljs-attr">"timeseriesId"</span></span>: <span class="hljs-string"><span class="hljs-string">"docker.Container.Cpu"</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"aggregation"</span></span>: <span class="hljs-string"><span class="hljs-string">"avg"</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"severe"</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"warning"</span></span>: <span class="hljs-number"><span class="hljs-number">70</span></span>    }  ] }</code> </pre> <br>  Le fichier est un tableau de d√©finitions de s√©ries temporelles: <br><br><ul><li>  timeseriesId - m√©trique v√©rifi√©e, par exemple, temps de r√©ponse, nombre d'erreurs, m√©moire utilis√©e, etc. </li><li>  agr√©gation - le niveau d'agr√©gation des m√©triques, dans notre cas moy, mais vous pouvez utiliser tout ce dont vous avez besoin (moy, min, max, somme, nombre, centile); </li><li>  balises - une balise d'objet dans le syst√®me de surveillance, ou vous pouvez sp√©cifier un identifiant d'objet sp√©cifique; </li><li>  s√©v√®re et avertissement - ces indicateurs ajustent les valeurs seuils de nos m√©triques, si la valeur des tests d√©passe le seuil s√©v√®re, alors notre assemblage est marqu√© comme infructueux. </li></ul><br>  La figure suivante montre un exemple d'utilisation de ces corbeilles. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/087/be4/db9/087be4db9e8c7a51de722110e526f39a.png"></div>  <i><a href="">Source</a></i> <br><br>  <b>√âtape 3. G√©n√©ration de charge</b> <br><br>  Apr√®s avoir d√©termin√© les niveaux de qualit√© de notre service, il est n√©cessaire de g√©n√©rer une charge de test.  Vous pouvez utiliser n'importe lequel des outils de test qui vous conviennent, par exemple Jmeter, Selenium, Neotys, Gatling, etc. <br><br>  Le syst√®me de surveillance Dynatrace vous permet de capturer diverses m√©tadonn√©es de vos tests et de reconna√Ætre quel test se rapporte √† quel cycle de publication et quel service.  Il est recommand√© d'ajouter des en-t√™tes suppl√©mentaires aux requ√™tes HTTP de test. <br><br>  La figure suivante montre un exemple o√π, en utilisant l'en-t√™te X-Dynatrace-Test facultatif, nous marquons que ce test fait r√©f√©rence au test de l'op√©ration d'ajout d'un article au panier. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/96a/3b8/277/96a3b8277f52b4643cc05acc38b7258b.png"></div>  <i><a href="https://dt-cdn.net/images/dynatrace-loadtesting-">Source</a></i> <br><br>  Lorsque vous ex√©cutez chaque test de charge, vous envoyez des informations contextuelles suppl√©mentaires √† Dynatrace √† l'aide de l'API d'√©v√©nement du serveur CI / CD.  Ainsi, le syst√®me peut faire la distinction entre diff√©rents tests entre eux. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/574/f50/948/574f509484f4a0fcc4dea39f9a39870e.png"></div>  <i><a href="">Source</a></i>  <i>√âv√©nement dans le syst√®me de surveillance sur le lancement du test de charge</i> <br><br>  <b>√âtape 4-5.</b>  <b>Collectez les donn√©es de performances et transf√©rez les donn√©es vers un syst√®me CI / CD</b> <br><br>  Parall√®lement au test g√©n√©r√©, un √©v√©nement est transmis au syst√®me de surveillance sur la n√©cessit√© de collecter des donn√©es sur la v√©rification des indicateurs de qualit√© de service.  Notre fichier JSON est √©galement indiqu√©, dans lequel les m√©triques cl√©s sont d√©finies. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/584/427/af6/584427af69b059959ece68661cefbf9e.png"></div>  <i>Un √©v√©nement sur la n√©cessit√© de v√©rifier la qualit√© des logiciels g√©n√©r√©s sur le serveur CI / CD pour les envoyer au syst√®me de surveillance</i> <br><br>  Dans notre exemple, l'√©v√©nement de contr√¥le qualit√© est appel√© <i>perfSigDynatraceReport</i> (Performance_Signature <i>)</i> - il s'agit d'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plug</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">in</a> pr√™t √† l'emploi pour l'int√©gration avec Jenkins, qui a √©t√© d√©velopp√© par les gars de T-Systems Multimedia Solutions.  Chaque √©v√©nement concernant le lancement du test contient des informations sur le service, le num√©ro de build et la dur√©e du test.  Le plugin collecte les valeurs de performances lors de l'assemblage, les √©value et compare le r√©sultat avec les assemblages pr√©c√©dents et les exigences non fonctionnelles. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e58/f13/7d8/e58f137d890618ddb2c59be5eb292b3d.png"></div>  <i>√âv√©nement dans le syst√®me de surveillance sur le d√©but du contr√¥le qualit√© de l'assemblage.</i>  <i><a href="">Source</a></i> <br><br>  Une fois le test termin√©, toutes les mesures d'√©valuation de la qualit√© du logiciel sont retransf√©r√©es au syst√®me d'int√©gration continue, par exemple Jenkins, qui g√©n√®re un rapport sur les r√©sultats. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0y/nl/rc/0ynlrc9qxeffy9v4ei_s4ihn5v0.png"></div>  <i>R√©sultat des statistiques d'assemblage sur le serveur CI / CD.</i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Source</a></i> <br><br>  Pour chaque assemblage individuel, nous voyons des statistiques pour chaque m√©trique que nous avons d√©finie pendant tout le test.  Nous voyons √©galement s'il y a eu des violations √† certaines valeurs de seuil (avertissement et thrasholds s√©v√®res).  Sur la base des m√©triques agr√©g√©es, l'assemblage entier est marqu√© comme stable, instable ou a √©chou√©.  De plus, pour plus de commodit√©, vous pouvez ajouter des indicateurs pour comparer l'assemblage actuel avec l'assemblage pr√©c√©dent dans le rapport. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/09a/a3d/106/09aa3d106d50eb6be368d1be57e5ee39.png"></div>  <i>Affichez les statistiques d√©taill√©es d'assemblage sur le serveur CI / CD.</i>  <i><a href="">Source</a></i> <br><br>  <b>Comparaison d√©taill√©e de deux assemblages</b> <br><br>  Si n√©cessaire, vous pouvez acc√©der √† l'interface Dynatrace et y regarder plus en d√©tail les statistiques de chacun de vos assemblages et les comparer les uns aux autres. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/586/d52/12d/586d5212dcf21aeb30d8f7a6bbd4f158.png"></div>  <i>Comparaison des statistiques d'assemblage dans Dynatrace.</i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Source</a></i> <br><br>  <b>Conclusions</b> <br><br>  En cons√©quence, nous obtenons le service ¬´monitoring as a service¬ª, automatis√© dans le pipeline d'int√©gration continue.  Le d√©veloppeur ou le testeur n'a besoin que de d√©terminer la liste des m√©triques dans le fichier JSON, et tout le reste se produit automatiquement.  Nous obtenons un contr√¥le de qualit√© transparent des versions: toutes les notifications sur les performances, la consommation des ressources ou les r√©gressions architecturales. <br><br><h1>  T√¢che 2. Automatisation du contr√¥le qualit√© des logiciels dans un environnement de production </h1><br>  Nous avons donc r√©solu le probl√®me de l'automatisation du processus de surveillance au stade des tests dans Pipeline.  Ainsi, nous minimisons le pourcentage d'assemblages de faible qualit√© atteignant l'environnement alimentaire. <br><br>  Mais que faire si un mauvais logiciel arrive toujours au point de vente, ou si quelque chose se casse.  Pour l'utopie, nous voulions disposer de m√©canismes de d√©tection automatique des probl√®mes et, si possible, le syst√®me lui-m√™me r√©tablirait sa capacit√© de travail, au moins la nuit. <br><br>  Pour ce faire, nous, par analogie avec la section pr√©c√©dente, fournissons des v√©rifications automatiques de la qualit√© des logiciels dans l'environnement de production et mettons des scripts pour l'auto-r√©paration du syst√®me sous eux. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/94d/63e/6c0/94d63e6c0575a310f5982386d731649a.png"></div><br>  <b>Correction automatique en tant que code</b> <br><br>  La plupart des entreprises ont d√©j√† une base de connaissances accumul√©es sur divers types de probl√®mes courants et une liste d'actions pour les r√©soudre, par exemple, red√©marrage des processus, nettoyage des ressources, restauration des versions, restauration des modifications de configuration incorrectes, augmentation ou diminution du nombre de composants dans un cluster, changement de contour bleu ou vert et autre <br><br>  Malgr√© le fait que ces cas d'utilisation sont connus depuis de nombreuses ann√©es pour de nombreuses √©quipes avec lesquelles je communique, seuls quelques-uns ont pens√© et investi dans leur automatisation. <br><br>  Si vous y r√©fl√©chissez, alors dans l'impl√©mentation de processus d'auto-gu√©rison de la sant√© de l'application, il n'y a rien de super compliqu√©, vous devez pr√©senter les sc√©narios de travail bien connus de vos administrateurs sous la forme de scripts de code (le concept d '¬´autocorrection en tant que code¬ª) que vous avez √©crits √† l'avance pour chaque cas sp√©cifique.  Les sc√©narios de r√©paration automatique doivent r√©soudre la cause premi√®re du probl√®me.  Vous d√©finissez vous-m√™me les bonnes actions de r√©ponse aux incidents. <br><br>  Toute m√©trique de votre syst√®me de surveillance peut agir comme un d√©clencheur pour ex√©cuter un script, l'essentiel est que ces m√©triques d√©terminent avec pr√©cision que tout est mauvais, car je ne voudrais pas obtenir de faux positifs dans un environnement productif. <br><br>  Vous pouvez utiliser n'importe quel syst√®me ou ensemble de syst√®mes: Prometheus, ELK Stack, Zabbix, etc.  Mais je vais donner quelques exemples bas√©s sur la solution APM (Dynatrace sera encore un exemple), qui vous aideront √©galement √† vous faciliter la vie. <br><br>  Premi√®rement, il y a tout ce qui concerne l'op√©rabilit√© en termes d'application.  La solution fournit des centaines de mesures √† diff√©rents niveaux que vous pouvez utiliser comme d√©clencheurs: <br><br><ul><li>  niveau utilisateur (navigateurs, applications mobiles, appareils IoT, comportement des utilisateurs, conversion, etc.); </li><li>  niveau de service et d'exploitation (performances, disponibilit√©, erreurs, etc.); </li><li>  niveau d'infrastructure d'application (mesures du syst√®me d'exploitation h√¥te, JMX, MQ, serveur Web, etc.); </li><li>  niveau plateforme (virtualisation, cloud, conteneur, etc.). </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ac2/5f9/480/ac25f94800d26b672cace37d7495d008.png"></div>  <i>Surveillance des niveaux dans Dynatrace.</i>  <i><a href="">Source</a></i> <br><br>  Deuxi√®mement, comme je l'ai dit plus t√¥t, Dynatrace poss√®de une API ouverte, ce qui le rend tr√®s pratique pour l'int√©grer √† divers syst√®mes tiers.  Par exemple, envoyer une notification au syst√®me d'automatisation lorsque les param√®tres de contr√¥le sont d√©pass√©s. <br><br>  Voici un exemple d'interaction avec Ansible. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b90/a7a/d74/b90a7ad74b93428578dafb42235e19b4.png"></div>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Source</a></i> <br><br>  Ci-dessous, je donnerai quelques exemples de l'automatisation exacte qui peut √™tre effectu√©e.  Ce n'est qu'une partie des cas; les r√©pertorier dans votre environnement ne peut √™tre limit√© que par votre imagination et les capacit√©s de vos outils de surveillance. <br><br>  <b>1. Mauvais d√©ploiement - restauration de version</b> <br><br>  M√™me si nous testons tous tr√®s bien dans un environnement de test, il y a toujours une chance qu'une nouvelle version puisse tuer votre application dans l'environnement prod.  Le m√™me facteur humain n'a pas √©t√© annul√©. <br><br>  Dans la figure suivante, nous voyons qu'il y a une forte augmentation du temps d'ex√©cution des op√©rations sur le service.  Le d√©but de ce saut co√Øncide avec le temps de d√©ploiement de l'application.  Nous transf√©rons toutes ces informations sous forme d'√©v√©nements au syst√®me d'automatisation.  Si l'aptitude au service du service ne se normalise pas apr√®s l'expiration de la dur√©e sp√©cifi√©e par nous, un script est automatiquement appel√© qui ram√®ne la version √† l'ancienne. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lk/f9/ps/lkf9psxvdi6kivm-oa29pvypblw.png"></div>  <i>D√©gradation des performances apr√®s le d√©ploiement.</i>  <i><a href="">Source</a></i> <br><br>  <b>2. Chargement des ressources √† 100% - ajoutez un n≈ìud au routage</b> <br><br>  Dans l'exemple suivant, le syst√®me de surveillance d√©termine que l'un des composants a 100% d'utilisation du processeur. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a6c/f16/d1a/a6cf16d1aebeb435e1a24c3760563f54.png"></div>  <i>Utilisation du processeur √† 100%</i> <br><br>  Plusieurs sc√©narios diff√©rents sont possibles pour cet √©v√©nement.  Par exemple, le syst√®me de surveillance v√©rifie en outre si le manque de ressources est associ√© √† une augmentation de la charge sur le service.  Si, oui, un script est ex√©cut√© qui ajoute automatiquement le n≈ìud au routage, restaurant ainsi le syst√®me dans son ensemble. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/du/kc/1z/dukc1zzqhiae9ymfilbxpoem2qo.jpeg"></div>  <i>Mise √† l'√©chelle des n≈ìuds apr√®s un incident</i> <br><br>  <b>3. Manque d'espace sur le disque dur - Nettoyage de disque</b> <br><br>  Je pense que beaucoup de ces processus sont d√©j√† automatis√©s.  √Ä l'aide d'APM, vous pouvez √©galement surveiller l'espace libre sur le sous-syst√®me de disque.  En l'absence d'espace ou de fonctionnement lent du disque, nous appelons le script pour nettoyer ou ajouter de l'espace. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ea8/0cc/b7f/ea80ccb7f269eb465f30e7c94ba18c6d.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d8/f22/64d/3d8f2264dd7f312dac430eaa4446d845.png"></div>  <i>Chargement du disque √† 100%</i> <br><br>  <b>4. Faible activit√© utilisateur ou faible conversion - basculez entre les branches bleue et verte</b> <br><br>  Je rencontre souvent des clients utilisant deux circuits (d√©ploiement bleu-vert) pour des applications dans l'environnement de production.  Cela vous permet de basculer rapidement entre les branches lors de la livraison de nouvelles versions.  Souvent, apr√®s le d√©ploiement, des changements cardinaux peuvent se produire qui ne sont pas imm√©diatement perceptibles.  Cependant, une d√©gradation des performances et de la disponibilit√© peut ne pas √™tre observ√©e.  Pour r√©pondre rapidement √† de tels changements, il est pr√©f√©rable d'utiliser diverses m√©triques qui refl√®tent le comportement de l'utilisateur (nombre de sessions et d'actions utilisateur, conversion, taux de rebond).  La figure suivante montre un exemple dans lequel, lorsque la conversion diminue, le basculement entre les branches logicielles a lieu. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f9c/db2/776/f9cdb27767029d743a6f7b51a31fc87b.png"></div>  <i>Chute de conversion apr√®s le basculement entre les branches du logiciel.</i>  <i><a href="">Source</a></i> <br><br>  <b>M√©canismes de d√©termination automatique des probl√®mes</b> <br><br>  √Ä la fin, je donnerai un autre exemple, pour lequel j'aime le plus Dynatrace. <br><br>  Dans une partie de mon histoire sur l'automatisation du contr√¥le qualit√© des assemblages dans un environnement de test, nous avons d√©termin√© toutes les valeurs de seuil en mode manuel.  Ceci est normal pour un environnement de test, le testeur d√©termine lui-m√™me les indicateurs avant chaque test, en fonction de la charge.  Dans l'environnement de production, il est souhaitable que les probl√®mes soient d√©tect√©s automatiquement, en tenant compte des diff√©rents m√©canismes de base. <br><br>  Dynatrace poss√®de des outils d'intelligence artificielle int√©gr√©s int√©ressants qui, sur la base des m√©canismes pour d√©terminer les mesures anormales (r√©f√©rence) et construire une carte d'interaction entre tous les composants, comparer et corr√©ler les √©v√©nements entre eux, d√©terminer les anomalies dans le travail de votre service et fournir des informations d√©taill√©es sur chaque probl√®me et cause racine. <br><br>  En analysant automatiquement les d√©pendances entre les composants, Dynatrace d√©termine non seulement si le service probl√©matique est la cause principale, mais aussi sa d√©pendance √† l'√©gard d'autres services.  Dans l'exemple ci-dessous, Dynatrace surveille et √©value automatiquement la sant√© de chaque service dans le cadre d'une transaction, identifie le service Golang comme la raison principale. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/afa/623/f52/afa623f525f3c5e2565fcc6382c173e3.png"></div>  <i>Un exemple de d√©termination de la cause premi√®re d'une d√©faillance.</i>  <i><a href="">Source</a></i> <br><br>  La figure suivante montre le processus de surveillance des probl√®mes avec votre application depuis le d√©but de l'incident. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fu/z_/rt/fuz_rt4omgppab3zkuxs4b-xfmm.gif"></div>  <i>Visualisation d'un probl√®me √©mergent avec l'affichage de tous les composants et √©v√©nements sur ceux-ci</i> <br><br>  Le syst√®me de surveillance a compil√© une chronologie compl√®te des √©v√©nements sur le probl√®me.  Dans la fen√™tre sous la chronologie, nous voyons tous les √©v√©nements cl√©s sur chacun des composants.  En fonction de ces √©v√©nements, vous pouvez sp√©cifier des proc√©dures de correction automatique sous forme de scripts de code. <br><br>  De plus, je vous conseille d'int√©grer le syst√®me de surveillance avec Service Desk ou un bug tracker.  En cas de probl√®me, les d√©veloppeurs re√ßoivent rapidement des informations compl√®tes pour leur analyse au niveau du code dans l'environnement de production. <br><br><h1>  Conclusion </h1><br>  En cons√©quence, nous nous sommes retrouv√©s avec un pipeline CI / CD avec des contr√¥les de qualit√© logiciels automatis√©s int√©gr√©s dans Pipeline.  Nous minimisons le nombre d‚Äôassemblages de mauvaise qualit√©, augmentons la fiabilit√© du syst√®me dans son ensemble et si nous perturbons toujours les performances du syst√®me, nous lan√ßons des m√©canismes pour le restaurer. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e3/1c3/ae2/9e31c3ae24cc9f07a4771167ad2043d3.png"></div><br>  Cela vaut vraiment la peine d‚Äôautomatiser la surveillance de la qualit√© des logiciels, ce n‚Äôest pas toujours un processus rapide, mais avec le temps, cela portera ses fruits.  Je recommande qu'apr√®s avoir r√©solu un nouvel incident dans l'environnement de prod, pensez imm√©diatement aux moniteurs √† ajouter pour les v√©rifications dans l'environnement de test afin d'√©viter d'avoir une mauvaise construction dans le prod, et cr√©ez √©galement un script pour r√©soudre automatiquement ces probl√®mes. <br><br>  J'esp√®re que mes exemples vous aideront dans vos efforts.  Il sera √©galement int√©ressant pour moi de voir vos exemples de mesures utilis√©es pour la mise en ≈ìuvre de syst√®mes d'auto-gu√©rison. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bea/ccc/1c5/beaccc1c5f2fb65ac9cf91e6dda3bbd5.jpg"></div>  <i><a href="">Source</a></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr451630/">https://habr.com/ru/post/fr451630/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr451620/index.html">Autorisation automatique sur la carte Strava Heatmap</a></li>
<li><a href="../fr451622/index.html">√Ä propos du comptage de bits, des types non sign√©s dans Kotlin et des situations o√π il est justifi√© d'enregistrer des correspondances</a></li>
<li><a href="../fr451624/index.html">Sur la fa√ßon dont Harry Potter fa√ßonne l'√©ducation russe, bien s√ªr, pas l√† o√π vous en avez besoin</a></li>
<li><a href="../fr451626/index.html">Apprendre sans professeur: un √©tudiant curieux</a></li>
<li><a href="../fr451628/index.html">Top Revue 3D Expo en avril 2019</a></li>
<li><a href="../fr451634/index.html">Comment nous sommes analys√©s dans les magasins et les restaurants</a></li>
<li><a href="../fr451636/index.html">Cinq ans d'esclavage</a></li>
<li><a href="../fr451638/index.html">Animation dans les applications mobiles: tester Lottie</a></li>
<li><a href="../fr451640/index.html">Game of Thrones: Construire des infographies sur les meurtres, le sexe, voyager Westeros et plus</a></li>
<li><a href="../fr451642/index.html">Trouver un moyen parmi les obstacles ronds</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>