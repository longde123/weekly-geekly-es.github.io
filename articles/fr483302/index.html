<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍💼 ⛄️ 🆒 Premiers pas avec Google Sheets en Python. De l'enregistrement à la lecture des données 👺 👶🏿 👨‍⚖️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pendant un certain temps, j'ai réussi à télécharger des données vers Excel, mais le mod change, les utilisateurs le veulent dans les nuages. 

 Ayant ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Premiers pas avec Google Sheets en Python. De l'enregistrement à la lecture des données</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483302/">  Pendant un certain temps, j'ai réussi à télécharger des données vers Excel, mais le mod change, les utilisateurs le veulent dans les nuages. <br><br>  Ayant commencé à traduire un certain nombre de projets en Python, j'ai décidé qu'il était temps de changer (ou d'ajouter) à Excel avec quelque chose de plus moderne. <br><br>  Lorsque j'ai rencontré pour la première fois le besoin de travailler avec des feuilles de calcul Google à partir de Python, j'avais l'illusion que tout cela peut être fait en quelques clics.  La réalité s'est avérée moins rose, mais nous n'avons pas d'autre globe. <br><br>  Les articles m'ont beaucoup aidé: <br><br><ul><li>  <a href="https://habr.com/ru/post/305378">Nous générons une belle feuille de calcul Google à partir de notre programme (en utilisant l'API Google Sheets v4)</a> </li><li>  <a href="http://italylov.ru/blog/all/probuem-rabotat-s-google-sheets-api/">Premiers pas avec l'API Google Sheets v4 /</a> </li><li>  <a href="http://datalytics.ru/all/rabotaem-s-api-google-drive-s-pomoschyu-python/">Travailler avec l'API Google Drive avec Python</a> </li></ul><br>  Comme d'habitude - lorsque vous abordez quelque chose pour la première fois, vous êtes confronté à une masse de questions qui ne causent plus que de la confusion - comment quelqu'un pourrait-il même y penser.  Élémentaire! <br><br>  Peut-être que je viens de marcher un long chemin - je serai heureux si vous me corrigez. <br><br>  Toutes les actions ont été effectuées sur un ordinateur exécutant Windows + Python 3.6.6, et un bloc-notes Jupyter a également été utilisé. <br><br>  Les principales difficultés que j'ai eues au stade des réglages préliminaires.  Trouver un code exploitable n'est pas difficile. <br><br>  Le code utilisé dans l'article est disponible <a href="https://github.com/ovkgit/google_sheets_python">dans le référentiel.</a> <br><a name="habracut"></a><br><h2>  Inscrivez-vous aux services Google et installez des bibliothèques </h2><br>  Pour travailler avec des tableaux, vous devez vous inscrire auprès de Google, configurer le projet et installer les bibliothèques nécessaires. <br><br>  <a href="https://developers.google.com/sheets/">La documentation officielle en anglais est ici</a> . <br><br>  Vous devez d'abord vous inscrire sur gmail.com (vous pouvez le faire vous-même).  Ensuite, vous devez créer un projet (car Google donne accès à ses services). <br><br>  Il s'agit d'un processus long et fastidieux qui vous permet de comprendre pourquoi les interfaces de Google ne sont pas considérées comme les plus pratiques et intuitives (certaines personnes pensent que le réseau social Google+ n'a pas décollé pour cette raison). <br><br>  Pour ce faire, accédez à <a href="https://console.developers.google.com/cloud-resource-manager">console.developers.google.com/cloud-resource-manager</a> et cliquez sur "Créer un projet" <br><br><img src="https://habrastorage.org/webt/fi/-w/y6/fi-wy693xsw54m-xh7jnh-17ble.jpeg"><br><br>  Entrez le nom du projet et cliquez sur "Créer" <br><br><img src="https://habrastorage.org/webt/pq/li/wq/pqliwqiudct5g7s6q_rm6iag6tw.jpeg"><br><br>  Dans la liste mise à jour des projets, allez dans le menu "Autorisations" <br><img src="https://habrastorage.org/webt/3z/pr/yb/3zprybr3paa7eqi5sxsurdt_aq8.jpeg"><br><br>  Dans la fenêtre qui s'ouvre, cliquez sur "Ajouter", entrez votre adresse e-mail depuis le domaine gmail.com et sélectionnez le groupe "Projet" - "Propriétaire" <br><br><img src="https://habrastorage.org/webt/fu/4a/cl/fu4aclu3gibqg8-1rae94sovf08.jpeg"><br><br>  Enregistrez les modifications. <br><br>  Il peut sembler étrange que vous ayez créé un projet mais que vous soyez obligé de vous accorder des droits.  Et c'est en fait étrange, mais c'était une telle voie qui devait être prise au moment d'écrire ce cours, pour que tout commence à fonctionner comme il se doit. <br><br>  Accédez à nouveau à <a href="https://console.developers.google.com/cloud-resource-manager">console.developers.google.com/cloud-resource-manager</a> <br><br>  Sélectionnez le menu Paramètres de votre projet <br><br><img src="https://habrastorage.org/webt/_p/dx/al/_pdxalr_zhciudnkssxnej4iybo.jpeg"><br><br>  Dans la fenêtre qui s'ouvre, sélectionnez «Comptes de service» puis «Créer un compte de service» <br><br><img src="https://habrastorage.org/webt/8e/ss/t-/8esst-mi2_3ioiylkv5ej1itpxu.jpeg"><br><br>  Saisissez le nom du compte et cliquez sur "Créer" <br><br><img src="https://habrastorage.org/webt/4h/fe/18/4hfe18ts9ywn44bevocl3-fpsue.jpeg"><br><br>  Sélectionnez le rôle Propriétaire et cliquez sur Continuer. <br><br><img src="https://habrastorage.org/webt/0x/d9/sx/0xd9sxloeigykugl41pdx_qgp64.jpeg"><br><br>  Dans la fenêtre qui apparaît, cliquez sur Créer une clé <br><br><img src="https://habrastorage.org/webt/pv/jc/xk/pvjcxkvp6mjwda30w3uorjkbex4.jpeg"><br><br>  Sélectionnez le type de clé json et cliquez sur Créer <br><br><img src="https://habrastorage.org/webt/75/sz/3l/75sz3lffo7nr8119jrpu-vvm1i8.jpeg"><br><br>  Un fichier avec des clés sera créé et téléchargé immédiatement.  Enregistrez-le, grâce à lui, nous pourrons accéder aux services Google. <br><br>  Cliquez sur le bouton à trois traits horizontaux, à gauche de l'inscription "API Google", sélectionnez "API et services", et en son sein le sous-élément "Panneau de configuration". <br><br><img src="https://habrastorage.org/webt/n9/0c/gh/n90cgh2hyrqigsxjus02cwhrt-c.jpeg"><br><br>  Dans la fenêtre qui s'ouvre, cliquez sur "Activer l'API et les services" <br><br><img src="https://habrastorage.org/webt/w8/3f/wc/w83fwcm2h2zcq4qza3pysyjhseu.jpeg"><br><br>  Tapez "google drive" dans la barre de recherche et cliquez sur le service "Google Drive API" <br><br><img src="https://habrastorage.org/webt/fj/ks/iw/fjksiwvxazgd-6erfruqwrwq8os.jpeg"><br><br>  Cliquez sur Activer <br><br><img src="https://habrastorage.org/webt/jk/f-/ys/jkf-ysfiu--oqojyf8vi1lwphao.jpeg"><br><br>  Le site vous informera que l'API est activée et vous avertira que les informations d'identification doivent être créées.  Ignorez cet avertissement (nous avons déjà créé un compte de service). <br><br><img src="https://habrastorage.org/webt/se/e4/z4/see4z4tacpn3manmkn_tixgkgck.jpeg"><br><br>  Revenez au panneau de contrôle <br><br><img src="https://habrastorage.org/webt/c0/ak/ln/c0aklnjxew9zwlph6fgp1ym-yt8.jpeg"><br><br>  Dans la fenêtre qui s'ouvre, cliquez sur "Activer l'API et les services" <br><br><img src="https://habrastorage.org/webt/w8/3f/wc/w83fwcm2h2zcq4qza3pysyjhseu.jpeg"><br><br>  Saisissez «feuille» dans la barre de recherche et cliquez sur le service «API Google Sheets» <br><br><img src="http://img/Task09_17.jpg"><br><br>  Assurez-vous que cette API est connectée.  Il devrait s'activer automatiquement lorsque vous connectez l'API Google Drive.  S'il est connecté, vous verrez le bouton "Gérer l'API", sinon, le bouton "Activer".  Allumez-le si nécessaire. <br><br>  La dernière fois, visitez <a href="https://console.developers.google.com/cloud-resource-manager">console.developers.google.com/cloud-resource-manager</a> <br><br>  Sélectionnez le menu Paramètres de votre projet <br><br><img src="https://habrastorage.org/webt/ov/ue/i6/ovuei6xocepbhtqmgs8ydb9tbt4.jpeg"><br>  Dans la fenêtre qui s'ouvre, sélectionnez "Comptes de service", puis copiez et enregistrez l'adresse e-mail du compte de service.  Il vous sera utile de donner accès aux tables. <br><br><img src="https://habrastorage.org/webt/qh/p5/yr/qhp5yrn74itkqnbwkvtstlcjwha.jpeg"><br><br>  Nous passons maintenant à l'installation des bibliothèques.  Exécutez la commande dans la console <br><br><pre><code class="bash hljs">pip3 install --upgrade google-api-python-client</code> </pre> <br>  et puis <br><br><pre> <code class="bash hljs">pip3 install oauth2client</code> </pre> <br>  Il est possible que lorsque vous exécutez la deuxième commande, vous recevrez un message indiquant que la bibliothèque oauth2client est déjà installée. <br><br>  Accédez à <a href="https://raw.githubusercontent.com/gsuitedevs/python-samples/master/sheets/quickstart/quickstart.py">raw.githubusercontent.com/gsuitedevs/python-samples/master/sheets/quickstart/quickstart.py</a> <br><br>  Appuyez sur le bouton droit de la souris et sélectionnez «Enregistrer sous» <br><br><img src="https://habrastorage.org/webt/t7/z5/mv/t7z5mvudm8lmipgvbcxsjn6jsr4.jpeg"><br><br>  Enregistrez le fichier sous quickstart.py <br><br>  et l'exécuter avec la commande <br><br><pre> <code class="python hljs">python quickstart.py</code> </pre> <br>  Une nouvelle page s'ouvrira dans le navigateur (peut-être que cela dira que la page n'est pas sûre, mais allez-y hardiment) et vous devrez accepter les conditions. <br><br>  Sur ce chemin, notre chemin est achevé. <br><br><h2>  Remplir et mettre en forme un tableau </h2><br>  Créer la première table <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   import httplib2 import apiclient.discovery from oauth2client.service_account import ServiceAccountCredentials CREDENTIALS_FILE = 'seraphic-effect-248407-7ac2c44ec709.json' #     ,     #     credentials = ServiceAccountCredentials.from_json_keyfile_name(CREDENTIALS_FILE, ['https://www.googleapis.com/auth/spreadsheets', 'https://www.googleapis.com/auth/drive']) httpAuth = credentials.authorize(httplib2.Http()) #    service = apiclient.discovery.build('sheets', 'v4', http = httpAuth) #      4  API spreadsheet = service.spreadsheets().create(body = { 'properties': {'title': '  ', 'locale': 'ru_RU'}, 'sheets': [{'properties': {'sheetType': 'GRID', 'sheetId': 0, 'title': '  ', 'gridProperties': {'rowCount': 100, 'columnCount': 15}}}] }).execute() spreadsheetId = spreadsheet['spreadsheetId'] #    print('https://docs.google.com/spreadsheets/d/' + spreadsheetId)</span></span></code> </pre><br>  Si tout s'est déroulé sans erreur, un lien vers le tableau sera affiché. <br><br>  L'identifiant du fichier est utilisé dans ce lien, nous l'enregistrons dans la variable spreadsheetId et nous l'utiliserons à l'avenir. <br><br>  Suivez-le.  Google vous informera que vous n'avez pas accès <br><br><img src="https://habrastorage.org/webt/y0/n7/te/y0n7te-mweqjhzr_9eg0gqsj50q.jpeg"><br><br>  Ne demandez pas la permission!  Vous recevrez une notification indiquant qu'il n'est pas possible d'envoyer une lettre de demande à l'adresse que Google a elle-même attribuée au compte système.  Mais vous ne pouvez pas changer cette adresse.  Peut-être que cela ne fonctionne pas uniquement en mode gratuit. <br><br>  Mais nous pouvons nous donner accès via Google Drive.  Vous devez remplacer my_test_address@gmail.com par le vôtre. <br><br><pre> <code class="python hljs">driveService = apiclient.discovery.build(<span class="hljs-string"><span class="hljs-string">'drive'</span></span>, <span class="hljs-string"><span class="hljs-string">'v3'</span></span>, http = httpAuth) <span class="hljs-comment"><span class="hljs-comment">#    Google Drive  3  API access = driveService.permissions().create( fileId = spreadsheetId, body = {'type': 'user', 'role': 'writer', 'emailAddress': 'my_test_address@gmail.com'}, #     fields = 'id' ).execute()</span></span></code> </pre> <br>  Maintenant que vous avez accès, ne fermez pas la table, nous allons la gérer et regarder immédiatement les changements. <br><br>  Chaque document a son propre code - spreadsheetId - c'est exactement ce qui est affiché dans la barre d'adresse lorsque nous ouvrons la table dans le navigateur (dans l'URL de la page avec la table ouverte, c'est entre "https://docs.google.com/spreadsheets/d/" et "/ edit # gid = 0"). <br><br>  Nous l'avons enregistré dans le tableur variable et continuerons de travailler avec. <br><br>  Tout d'abord, un peu de théorie. <br><br>  Dans chaque fichier (feuille de calcul), il y a des onglets (feuille). <br><br>  Chaque feuille a son propre code numérique (sheetId).  La première feuille créée dans le document a cet ID égal à 0. Les feuilles restantes ont un ID différent de zéro très différent (c'est-à-dire qu'elles ne sont pas numérotées consécutivement). <br><br>  Assurez-vous de cela <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   results = service.spreadsheets().batchUpdate( spreadsheetId = spreadsheetId, body = { "requests": [ { "addSheet": { "properties": { "title": "  ", "gridProperties": { "rowCount": 20, "columnCount": 12 } } } } ] }).execute() #   ,  Id   spreadsheet = service.spreadsheets().get(spreadsheetId = spreadsheetId).execute() sheetList = spreadsheet.get('sheets') for sheet in sheetList: print(sheet['properties']['sheetId'], sheet['properties']['title']) sheetId = sheetList[0]['properties']['sheetId'] print('     Id = ', sheetId)</span></span></code> </pre><br>  Quelque chose comme ça apparaîtra à l'écran: <br><br><blockquote>  0 Feuille numéro un <br>  415832263 Une autre feuille <br>  Nous utiliserons une feuille avec Id = 0 </blockquote><br><br>  En fait, la première feuille a un Id de zéro et la seconde est numérotée différemment. <br><br>  Une autre question: comment spécifier des plages de cellules.  Apparemment, les tables Google ont été développées par différentes équipes, sous la direction de différents gestionnaires et avec l'aide de différents architectes.  Parce que les coordonnées des cellules sont définies de deux manières différentes. <br><br>  Option 1: au format texte «Feuille numéro un! B2: D5», c'est-à-dire  le nom de la feuille, suivi d'un point d'exclamation, après - la cellule supérieure gauche au format "lettre (colonne) + nombre (chaîne)" + la cellule inférieure droite au même format. <br><br><pre> <code class="python hljs">{<span class="hljs-string"><span class="hljs-string">"range"</span></span>: <span class="hljs-string"><span class="hljs-string">"  !B2:D5"</span></span>}</code> </pre> <br>  Option 2: au format json, indiquant l'ID de la feuille et les coordonnées des cellules supérieure gauche et inférieure droite sous forme numérique (numéro de ligne et numéro de colonne) <br><br><pre> <code class="python hljs">{<span class="hljs-string"><span class="hljs-string">"range"</span></span>: { <span class="hljs-string"><span class="hljs-string">"sheetId"</span></span>: sheetId, <span class="hljs-comment"><span class="hljs-comment"># ID  "startRowIndex": 1, #    startRowIndex "endRowIndex": 5,#  endRowIndex - 1 (endRowIndex  !) "startColumnIndex": 0, #    startColumnIndex "endColumnIndex": 1 #  endColumnIndex - 1 }}</span></span></code> </pre> <br>  Différentes fonctions utilisent différents formats. <br><br>  Nous en savons maintenant assez pour remplir les cellules de données, dessiner un cadre et mettre en évidence les en-têtes. <br><br><pre> <code class="python hljs">results = service.spreadsheets().values().batchUpdate(spreadsheetId = spreadsheetId, body = { <span class="hljs-string"><span class="hljs-string">"valueInputOption"</span></span>: <span class="hljs-string"><span class="hljs-string">"USER_ENTERED"</span></span>, <span class="hljs-comment"><span class="hljs-comment">#  ,    (  ) "data": [ {"range": "  !B2:D5", "majorDimension": "ROWS", #   ,   "values": [ [" B2", " C2", " D2"], #    ['25', "=6*6", "=sin(3,14/2)"] #    ]} ] }).execute()</span></span></code> </pre> <br>  Remplissez plusieurs cellules avec des données.  Parce que  le paramètre USER_ENTERED est spécifié, le tableau perçoit ces données comme il percevrait les entrées utilisateur - convertit les valeurs numériques en nombres et les valeurs commençant par le signe égal en formules. <br><br>  Regardez votre table, elle est remplie de données <br><br><img src="https://habrastorage.org/webt/ob/3h/h_/ob3hh_l6npzamjxabctqph8lrny.jpeg"><br><br>  Définissez la largeur de colonne.  La fonction batchUpdate peut accepter plusieurs commandes à la fois, nous allons donc définir la largeur de trois groupes de colonnes avec une seule demande.  Il y a une colonne dans les premier et troisième groupes et deux dans le second. <br><br><pre> <code class="python hljs">results = service.spreadsheets().batchUpdate(spreadsheetId = spreadsheetId, body = { <span class="hljs-string"><span class="hljs-string">"requests"</span></span>: [ <span class="hljs-comment"><span class="hljs-comment">#    A: 20  { "updateDimensionProperties": { "range": { "sheetId": sheetId, "dimension": "COLUMNS", #    "startIndex": 0, #     "endIndex": 1 #    startIndex  endIndex - 1 (endIndex  !) }, "properties": { "pixelSize": 20 #    }, "fields": "pixelSize" # ,     pixelSize } }, #    B  C: 150  { "updateDimensionProperties": { "range": { "sheetId": sheetId, "dimension": "COLUMNS", "startIndex": 1, "endIndex": 3 }, "properties": { "pixelSize": 150 }, "fields": "pixelSize" } }, #    D: 200  { "updateDimensionProperties": { "range": { "sheetId": sheetId, "dimension": "COLUMNS", "startIndex": 3, "endIndex": 4 }, "properties": { "pixelSize": 200 }, "fields": "pixelSize" } } ] }).execute()</span></span></code> </pre> <br>  Regardez le tableau, les largeurs des colonnes ont changé. <br><br><img src="https://habrastorage.org/webt/wu/zv/h4/wuzvh4jz9uloyxlkhfnxqk7otke.jpeg"><br><br>  Dessinez un cadre autour de la table <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   results = service.spreadsheets().batchUpdate( spreadsheetId = spreadsheetId, body = { "requests": [ {'updateBorders': {'range': {'sheetId': sheetId, 'startRowIndex': 1, 'endRowIndex': 3, 'startColumnIndex': 1, 'endColumnIndex': 4}, 'bottom': { #      'style': 'SOLID', #   'width': 1, #  1  'color': {'red': 0, 'green': 0, 'blue': 0, 'alpha': 1}}, #   'top': { #      'style': 'SOLID', 'width': 1, 'color': {'red': 0, 'green': 0, 'blue': 0, 'alpha': 1}}, 'left': { #      'style': 'SOLID', 'width': 1, 'color': {'red': 0, 'green': 0, 'blue': 0, 'alpha': 1}}, 'right': { #      'style': 'SOLID', 'width': 1, 'color': {'red': 0, 'green': 0, 'blue': 0, 'alpha': 1}}, 'innerHorizontal': { #       'style': 'SOLID', 'width': 1, 'color': {'red': 0, 'green': 0, 'blue': 0, 'alpha': 1}}, 'innerVertical': { #       'style': 'SOLID', 'width': 1, 'color': {'red': 0, 'green': 0, 'blue': 0, 'alpha': 1}} }} ] }).execute()</span></span></code> </pre><br><img src="https://habrastorage.org/webt/7v/8l/db/7v8ldbkjnukd2j6lukhezmaupje.jpeg"><br><br>  Combinez les cellules au-dessus du tableau et entrez-y le titre. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   A2:D1 results = service.spreadsheets().batchUpdate( spreadsheetId = spreadsheetId, body = { "requests": [ {'mergeCells': {'range': {'sheetId': sheetId, 'startRowIndex': 0, 'endRowIndex': 1, 'startColumnIndex': 1, 'endColumnIndex': 4}, 'mergeType': 'MERGE_ALL'}} ] }).execute() #    results = service.spreadsheets().values().batchUpdate(spreadsheetId = spreadsheetId, body = { "valueInputOption": "USER_ENTERED", #  ,    (  ) "data": [ {"range": "  !B1", "majorDimension": "ROWS", #   ,   "values": [[" " ] ]} ] }).execute()</span></span></code> </pre><br><img src="https://habrastorage.org/webt/ba/pi/tq/bapitq07wcnkdodrbmodxssvvl8.jpeg"><br><br>  Définir le format des cellules d'en-tête de tableau <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#    results = service.spreadsheets().batchUpdate( spreadsheetId = spreadsheetId, body = { "requests": [ { "repeatCell": { "cell": { "userEnteredFormat": { "horizontalAlignment": 'CENTER', "backgroundColor": { "red": 0.8, "green": 0.8, "blue": 0.8, "alpha": 1 }, "textFormat": { "bold": True, "fontSize": 14 } } }, "range": { "sheetId": sheetId, "startRowIndex": 1, "endRowIndex": 2, "startColumnIndex": 1, "endColumnIndex": 4 }, "fields": "userEnteredFormat" } } ] }).execute()</span></span></code> </pre><br><img src="https://habrastorage.org/webt/an/mx/ix/anmxixf0r8g3tgobvulohsg3w5i.jpeg"><br><br>  Il existe un moyen simple de déterminer la largeur ou la couleur à définir pour une cellule.  Pour ce faire, il suffit de formater manuellement l'une des cellules et de lire ses propriétés. <br><br><pre> <code class="python hljs">ranges = [<span class="hljs-string"><span class="hljs-string">"  !C2:C2"</span></span>] <span class="hljs-comment"><span class="hljs-comment"># results = service.spreadsheets().get(spreadsheetId = spreadsheetId, ranges = ranges, includeGridData = True).execute() print(' ') print(results['properties']) print('\n  ') print(results['sheets'][0]['data'][0]['rowData'] ) print('\n ') print(results['sheets'][0]['data'][0]['rowMetadata']) print('\n ') print(results['sheets'][0]['data'][0]['columnMetadata'])</span></span></code> </pre><br>  Nous obtenons en réponse <br><blockquote>  Données de base <br>  {'title': 'First test document', 'locale': 'ru_RU', 'autoRecalc': 'ON_CHANGE', 'timeZone': 'Etc / GMT', 'defaultFormat': {'backgroundColor': {'red' : 1, 'vert': 1, 'bleu': 1}, 'rembourrage': {'haut': 2, 'droit': 3, 'bas': 2, 'gauche': 3}, 'verticalAlignment': 'BOTTOM', 'wrapStrategy': 'OVERFLOW_CELL', 'textFormat': {'foregroundColor': {}, 'fontFamily': 'arial, sans, sans-serif', 'fontSize': 10, 'bold': False, 'italique': Faux, 'barré': Faux, 'souligné': Faux}}} <br><br>  Valeurs et coloration <br>  [{'values': [{'userEnteredValue': {'stringValue': 'Cell C2'}, 'effectiveValue': {'stringValue': 'Cell C2'}, 'formatedValue': 'Cell C2', 'userEnteredFormat' : {'backgroundColor': {'red': 1, 'green': 0.6}, 'horizontalAlignment': 'CENTER', 'textFormat': {'fontSize': 14, 'bold': True, 'italic': True }}, 'effectiveFormat': {'backgroundColor': {'red': 1, 'green': 0.6}, 'padding': {'top': 2, 'right': 3, 'bottom': 2, ' left ': 3},' horizontalAlignment ':' CENTER ',' verticalAlignment ':' BOTTOM ',' wrapStrategy ':' OVERFLOW_CELL ',' textFormat ': {' foregroundColor ': {},' fontFamily ':' Arial ', 'fontSize': 14, 'bold': True, 'italic': True, 'strikethrough': False, 'underline': False}, 'hyperlinkDisplayType': 'PLAIN_TEXT'}}]}}]] <br><br>  Hauteur de cellule <br>  [{'pixelSize': 21}] <br><br>  Largeur de cellule <br>  [{'pixelSize': 150}] <br></blockquote>  Ce code affichera les propriétés de la cellule C2.  Vous pouvez sélectionner la police et la couleur de remplissage manuellement (dans le tableau), puis voir comment elles se reflètent dans json. <br><br><h2>  Lecture des données d'une table </h2><br>  Afin de révéler pleinement les caractéristiques de la lecture des données, j'ai rempli manuellement les cellules B4, C7 et D5 comme indiqué sur la figure. <br><br><img src="https://habrastorage.org/webt/ms/yc/ph/msycphwvaxu8x49rvc2vq6zwdfo.jpeg"><br><br>  Code pour lire les données <br><br><pre> <code class="python hljs">ranges = [<span class="hljs-string"><span class="hljs-string">"  !A2:F8"</span></span>] <span class="hljs-comment"><span class="hljs-comment"># results = service.spreadsheets().values().batchGet(spreadsheetId = spreadsheetId, ranges = ranges, valueRenderOption = 'FORMATTED_VALUE', dateTimeRenderOption = 'FORMATTED_STRING').execute() sheet_values = results['valueRanges'][0]['values'] print(sheet_values)</span></span></code> </pre> <br>  Résultat <br><blockquote>  [['', 'Cell B2', 'Cell C2', 'Cell D2'], ['', '25', '36', '0,9999996829']] </blockquote><br>  Certains paramètres de la fonction: <i>valueRenderOption</i> - format de lecture des données numériques. <br><br><ul><li>  <b>FORMATTED_VALUE</b> - lecture basée sur le format d'affichage.  C'est-à-dire  ce qui était visible dans le tableau sera lu.  Par exemple, dans la cellule D3, le nombre est 0,9999999, mais le format est "deux décimales", donc "1,00" est affiché et il sera lu dans ce format. </li><li>  <b>UNFORMATTED_VALUE</b> - le contenu de la cellule est lu, le formatage n'est pas pris en compte (c'est-à-dire que 0,9999999 serait lu) </li><li>  <b>FORMULE</b> - la formule est affichée (dans ce cas «= sin (3,14 / 2)». Si un nombre est entré dans la cellule, alors dans ce mode il sera lu. </li></ul><br>  Ce code lit les données et les affiche ligne par ligne.  Plage lisible A2: F8. <br>  Comme vu à l'écran: <br><br><ul><li>  Si aucune cellule de la ligne en cours de lecture n'est remplie, les données de la ligne ne s'affichent pas. </li><li>  Les données après la dernière cellule remplie ne sont pas affichées. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr483302/">https://habr.com/ru/post/fr483302/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr483280/index.html">Système de fichiers ESP32 et SPIFFS</a></li>
<li><a href="../fr483284/index.html">Comment j'ai analysé le programme</a></li>
<li><a href="../fr483290/index.html">Penser le design en gestion de projet ou pourquoi un chef de projet a-t-il besoin de techniques créatives</a></li>
<li><a href="../fr483294/index.html">Nous écrivons une «calculatrice». Partie II Résolvez des équations, effectuez un rendu dans LaTeX, accélérez les fonctions pour surligner</a></li>
<li><a href="../fr483298/index.html">Comment quitter correctement, pour que plus tard ...</a></li>
<li><a href="../fr483308/index.html">Expérience VonmoTrade. Partie 4: Tableaux de négociation</a></li>
<li><a href="../fr483310/index.html">Créez des objectifs pour Snapchat en utilisant pix2pix</a></li>
<li><a href="../fr483312/index.html">La grande théorie du flocon de neige</a></li>
<li><a href="../fr483314/index.html">Comment effectuer des actions Redux asynchrones à l'aide de Redux-Thunk</a></li>
<li><a href="../fr483316/index.html">Présentation rapide de SwiftUI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>