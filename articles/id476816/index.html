<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐐 🍧 🎙️ Dubai Mall di smartphone, atau cara menambahkan denah bangunan ke aplikasi Anda 🎢 🅱️ 🙆🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam artikel sebelumnya, saya berbicara tentang cara membuat aplikasi seluler dengan peta. Sebagai kelanjutan dari seri "on the knee" saya akan berba...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dubai Mall di smartphone, atau cara menambahkan denah bangunan ke aplikasi Anda</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/2gis/blog/476816/"><img src="https://habrastorage.org/webt/lq/cz/8s/lqcz8slsffexqi-rc0n0bovyyju.jpeg"><br><br>  Dalam <a href="https://habr.com/ru/company/2gis/blog/453182/">artikel sebelumnya,</a> saya berbicara tentang cara membuat aplikasi seluler dengan peta.  Sebagai kelanjutan dari seri "on the knee" saya akan berbagi dengan Anda alat untuk mengimplementasikan denah lantai. <br><br>  Pernyataan awal masalah dalam bentuk yang disederhanakan: Saya ingin dapat memvisualisasikan diagram lantai dalam aplikasi seluler Anda dan dapat menunjukkan lokasi organisasi tertentu di dalamnya.  Saya juga ingin melihat lokasi pengguna, tetapi di sini masalahnya ada di bidang teknis - Anda memerlukan peralatan yang memungkinkan Anda mendapatkan koordinat perangkat di dalam ruangan.  Jadi kami meninggalkan aspek ini di luar ruang lingkup artikel dan fokus pada bagian perangkat lunak. <br><br>  Di bawah ini saya akan menunjukkan kepada Anda beberapa opsi yang dapat digunakan untuk mengimplementasikan persyaratan yang dijelaskan di atas.  Itu semua tergantung pada data apa yang Anda miliki dan apa sebenarnya aplikasi harus dapat dilakukan.  Dan kita akan mulai dengan yang paling sederhana. <br><a name="habracut"></a><br><h3>  Opsi pertama.  API siap dengan data </h3><br>  Opsi pertama yang akan kami pertimbangkan adalah penggunaan widget yang sudah jadi dari 2GIS.  Deskripsi API dapat dilihat di <a href="https://api.2gis.ru/">api.2gis.ru.</a>  Ini akan cocok untuk Anda jika bangunan yang Anda minati sudah disajikan dalam 2GIS, dan lantainya sudah ditarik ke dalam gedung.  Artinya, dalam hal data, semuanya sudah dilakukan.  Dan yang paling penting, Anda siap online, karena opsi ini akan bekerja secara eksklusif dengan Internet. <br><br>  Untuk menampilkan lantai dalam kasus ini, praktis tidak ada yang diperlukan dari Anda sama sekali.  Implementasi eksekusi sebagai widget web, yang Anda hanya perlu dimasukkan ke dalam WebView. <br><br><pre><code class="java hljs">&lt;WebView android:layout_width=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span> android:id=<span class="hljs-string"><span class="hljs-string">"@+id/am_webview"</span></span> android:layout_marginTop=<span class="hljs-string"><span class="hljs-string">"160dp"</span></span> /&gt;</code> </pre> <br>  Ini adalah wadah tempat kita akan meletakkan widget kita.  Kami menginisialisasi sebagai berikut: <br><br><pre> <code class="kotlin hljs">webView = findViewById(R.id.am_webview) webView.settings.javaScriptEnabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span> webView.settings.useWideViewPort = <span class="hljs-literal"><span class="hljs-literal">true</span></span> webView.settings.loadWithOverviewMode = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-comment"><span class="hljs-comment">//webView.settings.setSupportZoom(true) //webView.settings.displayZoomControls = true //webView.settings.builtInZoomControls = true webView.loadUrl("file:///android_asset/map_api.html") webView.webViewClient = object : WebViewClient() { override fun onPageFinished(view: WebView, url: String) { super.onPageFinished(view, url) val js = "initMap('13933647002593772');" // The Dubai Mall webView.evaluateJavascript(js, ValueCallback { }) } }</span></span></code> </pre><br>  Kami mengkonfigurasi webView itu sendiri, pastikan untuk mengaktifkan JavaScript, javaScriptEnabled = true, karena kami akan berinteraksi dengan widget yang melaluinya.  Jika perlu, Anda dapat mengaktifkan scrollbar dan tombol zoom (lihat kode yang dikomentari), tetapi tidak bekerja dengan baik, jadi saya tidak merekomendasikannya. <br><br>  Yang paling penting adalah memuat HTML dengan widget kami <i>webView.loadUrl ("file: ///android_asset/map_api.html")</i> dan berlangganan acara, jika diperlukan.  Dalam contoh di atas, setelah memuat peta, kami memanggil metode <i>initMap</i> yang didefinisikan dalam map_api.html, dengan meneruskan pengidentifikasi bangunan yang ingin kami perlihatkan lantai. <br><br>  HTML adalah kode yang cukup sederhana.  Metode <i>DG.FloorsWidget.init dipanggil</i> , ke mana objek json yang berisi data untuk diinisialisasi dilewatkan.  Sebagai wadah, tentukan id yang dengannya kami telah mendeklarasikan div di markup HTML di atas.  Sesuaikan lebar, tinggi.  Dan di <i>initData kita</i> melewati bangunan di tag <i>complexId</i> , dan parameter tampilan widget tambahan, yang dapat ditemukan dalam dokumentasi API.  Omong-omong, pengidentifikasi dapat dilihat sebagai respons terhadap permintaan pencarian, yang dikirim 2GIS ketika Anda mengklik bangunan yang Anda minati di <a href="http://2gis.ru/">2gis.ru.</a>  Dalam contoh saya, saya menggunakan Dubai Mall.  Tapi tidak ada yang mengganggu untuk mengindikasikan bangunan lain dengan lantai. <br><br>  Sentuhan terakhir.  Untuk pindah ke perusahaan tertentu, panggil metode showFirm, dengan lewati pengenal perusahaan <br><br><pre> <code class="kotlin hljs">webView.loadUrl(<span class="hljs-string"><span class="hljs-string">"javascript:showFirm('</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$firmId</span></span></span><span class="hljs-string">')"</span></span>)</code> </pre> <br><br>  Sederhana saja.  Contoh implementasi yang sudah jadi dapat dilihat di <a href="https://github.com/viloboda/android-2gis-tiles">Github</a> . <br><br><img src="https://habrastorage.org/webt/dj/wr/kt/djwrkts1gbnmjcatdunldu_hoam.gif"><br><br>  Kelebihan dari opsi yang dipertimbangkan: <br><br><ul><li>  data siap pakai dengan denah lantai dan data perusahaan; </li><li>  implementasi ringan siap pakai di tampilan web; </li><li>  pencarian siap menurut 2GIS. </li></ul><br>  Cons: <br><br><ul><li>  Dibutuhkan internet; </li><li>  diperlukan pengetahuan dasar tentang HTML dan JavaScript; </li><li>  hanya data 2GIS dan hanya bangunan yang sudah memiliki lantai. </li></ul><br><h3>  Opsi kedua.  Denah lantai sebagai gambar </h3><br>  Jika opsi dengan data siap dan API tidak cocok untuk Anda, Anda dapat menggunakan yang berikut ini. <br><br>  Dalam hal ini, Anda akan memerlukan denah lantai dalam bentuk gambar, katakanlah, jpeg atau png.  Jika interaktivitas dari jenis "menyodok ke dalam gambar - membuka kartu objek" diperlukan, maka geocoding juga akan diperlukan, yang perlu diterapkan secara independen.  Jika Anda mengambil koordinat global, maka gambar harus diskalakan dengan benar dan salah satu sudut harus ditarik ke koordinat nyata sehingga Anda dapat menghitung perpindahan dari itu.  Kami tidak akan membahas masalah ini secara rinci, saya harap semuanya jelas di sini. <br><br>  Yang paling penting adalah menampilkan gambar ini di aplikasi.  Dan untuk ini, perpustakaan <a href="https://github.com/moagrius/TileView">TileView</a> sangat ideal bagi kami.  Bahkan, perpustakaan ini memungkinkan, pada prinsipnya, untuk menampilkan petak peta.  Tetapi ini juga cocok untuk kita, karena menyediakan kemampuan untuk bergerak dan memperbesar, memusatkan pada posisi yang ditentukan, penanda tampilan, transformasi koordinat dan kemampuan untuk berlangganan berbagai acara. <br><br>  Agar perpustakaan dapat bekerja seefisien mungkin, gambar aslinya perlu disiapkan dengan memotongnya menjadi ubin.  Ada <a href="https://github.com/moagrius/TileView/wiki/Creating-Tiles">instruksi yang</a> cukup sederhana <a href="https://github.com/moagrius/TileView/wiki/Creating-Tiles">untuk ini</a> .  Saya merekomendasikan skrip di akhir halaman yang ditentukan yang akan membuat 4 tileset.  Kami menambahkan hasil yang diperoleh ke dalam aset dan menampilkan gambar kami di aktivitas dengan kode sederhana: <br><br><pre> <code class="kotlin hljs">tileView.setSize(floorWidth, floorHeight) tileView.setShouldRenderWhilePanning(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) tileView.addDetailLevel(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-string"><span class="hljs-string">"tiles/floors1/1000/%d_%d.jpg"</span></span>) tileView.addDetailLevel(<span class="hljs-number"><span class="hljs-number">0.500f</span></span>, <span class="hljs-string"><span class="hljs-string">"tiles/floors1/500/%d_%d.jpg"</span></span>) tileView.addDetailLevel(<span class="hljs-number"><span class="hljs-number">0.250f</span></span>, <span class="hljs-string"><span class="hljs-string">"tiles/floors1/250/%d_%d.jpg"</span></span>) tileView.addDetailLevel(<span class="hljs-number"><span class="hljs-number">0.125f</span></span>, <span class="hljs-string"><span class="hljs-string">"tiles/floors1/125/%d_%d.jpg"</span></span>) tileView.defineBounds(<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, floorWidth.toDouble(), floorHeight.toDouble()) tileView.setScaleLimits(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">5f</span></span>) tileView.setMinimumScaleMode(ZoomPanLayout.MinimumScaleMode.FIT)</code> </pre><br>  Semuanya, layar sudah siap.  Anda dapat berlangganan acara dan menambahkan logika yang diperlukan.  Misalnya, marker dapat ditampilkan seperti ini: <br><br><pre> <code class="kotlin hljs">tileView.setMarkerAnchorPoints(-<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, -<span class="hljs-number"><span class="hljs-number">0.5f</span></span>) tileView.addMarker(imageView, x, floorHeight - y, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>)</code> </pre><br>  Contoh lengkap tersedia di <a href="https://github.com/viloboda/TileViewExample">Github</a> . <br><br><img src="https://habrastorage.org/webt/tb/29/bn/tb29bnjnkmnbvm5qwyjx5zztutw.gif"><br><br>  Pro: <br><br><ul><li>  kemampuan untuk melakukan sepenuhnya offline; </li><li>  persiapan data yang relatif sederhana, denah dalam bentuk gambar. </li></ul><br>  Cons: <br><br><ul><li>  kurangnya gaya dinamis. </li></ul><br><h3>  Opsi ketiga.  Data vektor </h3><br>  Opsi ini adalah yang paling canggih dan paling sulit.  Diasumsikan bahwa Anda telah menyiapkan data vektor, yaitu lantai yang digambar sepenuhnya dalam vektor.  Anda akan membutuhkan beberapa jenis objek.  Area organisasi, tempat parkir, lapangan makanan, panggung, arena seluncur es, dan sebagainya.  Objek linear - terutama dinding, arah aliran.  Objek titik: input / output, lift, ATM dan sejenisnya. <br><br>  Seperti apa bentuk denah di Fiji, sistem internal 2GIS: <br><br><img src="https://habrastorage.org/webt/dz/kg/uc/dzkguc7hmkwyjw2ymcaqufvkwbs.png"><br><br>  Nah, untuk visualisasi mereka, mesin vektor, yang saya bicarakan di <a href="https://habr.com/ru/company/2gis/blog/453182/">artikel sebelumnya</a> , mapsforge-vtm cocok untuk kita. <br><br>  Untuk mendemonstrasikan pendekatan, saya menyiapkan data uji: satu set kotak dan garis untuk beberapa lantai menggunakan contoh bangunan di pulau Siprus yang cerah.  Untuk persiapan, saya mengambil geometri asli bangunan dan memotongnya menjadi beberapa bagian sesuai dengan komponen geometri, semata-mata untuk kesederhanaan.  Seperti yang Anda tahu, bagian yang paling sulit adalah persiapan data yang berkualitas.  Sisanya adalah masalah teknologi.  Anda akan membutuhkan tombol untuk berpindah lantai, gaya yang disiapkan untuk merender kotak dan garis yang berbeda, dan overlay untuk merendernya. <br><br>  Lihat kode lengkapnya di <a href="http://github.com/viloboda/MapMobileApp">sini</a> . <br><br>  Kelas <i>FloorData</i> berisi kode geodata uji untuk lantai kami, dan kelas <i>FloorsManager</i> dirancang untuk membuatnya. <br><br>  Dalam konstruktor, kami mendefinisikan gaya untuk kotak dan dinding: <br><br><pre> <code class="kotlin hljs">styles.put(ObjectType.Floor, org.oscim.layers.vector.geometries.Style.builder() .fillColor(Color.GRAY) .build());</code> </pre><br>  Dan dalam metode <i>drawFloor</i> , <i>kami</i> menentukan logika menambahkan objek ke lapisan pada peta: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> void drawFloor(int floorId) { hideFloors(); indoorLayer = new CustomVectorLayer(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.map); List&lt;GeoData&gt; geoObjects = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.floorData.getFloorData(floorId); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (GeoData geo: geoObjects) { indoorLayer.add(geo.getGeometry(), styles.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(geo.getObjectType())); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.map.layers().add(indoorLayer); indoorLayer.update(); }</code> </pre><br>  Semuanya dasar di sini.  Buat layer baru <i>indoorLayer</i> , tambahkan data lantai yang sudah disiapkan sebelumnya dengan gaya yang diperlukan untuk itu dan tambahkan layer ke peta <i>this.map.layers (). Tambahkan (indoorLayer)</i> . <br><br>  Tetap menambahkan tombol untuk beralih lantai.  Untuk melakukan ini, ada <i>FloorPickerControl</i> berdasarkan pada <i>RecyclerView</i> , yang melakukan apa yang Anda butuhkan.  Jangan buang waktu untuk itu, lihat sumbernya. <br><br>  Dan di sini adalah Dubai Mall dalam aplikasi kita.  Ini juga menerapkan pengeditan objek geo. <br><br><img src="https://habrastorage.org/webt/bt/nn/ah/btnnahpkbpactvr2ywt4tflwh-w.png"><br><br>  Pro: <br><br><ul><li>  lagi, kemampuan untuk melakukan sepenuhnya offline; </li><li>  gambar berkualitas tinggi; </li><li>  kemungkinan variasi gaya dinamis; </li><li>  kemampuan untuk mengimplementasikan editor data. </li></ul><br>  Cons: <br><br><ul><li>  persiapan data yang kompleks. </li></ul><br>  Pada akhir artikel saya ingin mengatakan bahwa tugas menampilkan denah lantai dalam aplikasi tidak mengerikan seperti yang terlihat pada pandangan pertama.  Anda memiliki beberapa opsi dengan pro dan kontra, di mana Anda dapat memilih yang paling cocok untuk menyelesaikan masalah Anda. <br><br>  Semua referensi di satu tempat: <br><br>  <a href="https://habr.com/ru/company/2gis/blog/453182/">Artikel tentang peta di ponsel</a> <br>  <a href="https://api.2gis.ru/">API 2GIS</a> <br>  <a href="https://github.com/viloboda/android-2gis-tiles">Contoh 2GIS API</a> <br>  <a href="https://github.com/moagrius/TileView">Perpustakaan TileView</a> <br>  <a href="https://github.com/viloboda/TileViewExample">Contoh TileView</a> <br>  <a href="http://github.com/viloboda/MapMobileApp">Contoh di mapsforge-vtm</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id476816/">https://habr.com/ru/post/id476816/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id476792/index.html">Swift.assert - kehidupan setelah rilis</a></li>
<li><a href="../id476796/index.html">Refleksi pada tubuh yang sempurna</a></li>
<li><a href="../id476798/index.html">Kami mempelajari perakitan chip RAM pada contoh Hynix GDDR3 SDRAM</a></li>
<li><a href="../id476806/index.html">MPS 2019.2: enumerasi tipe data, penyesuaian pesan kesalahan, transisi ke JDK 11 dan banyak lagi</a></li>
<li><a href="../id476812/index.html">Catatan tentang segalanya. Catu daya sederhana dan berbahaya</a></li>
<li><a href="../id476824/index.html">McKinsey: Memikirkan Kembali Perangkat Lunak dan Arsitektur Elektronik di Otomotif</a></li>
<li><a href="../id476826/index.html">Berbagai Eksperimen: Teori dan Praktek</a></li>
<li><a href="../id476828/index.html">Operasi "Migrasi": bagaimana cara pindah ke cloud DataLine</a></li>
<li><a href="../id476830/index.html">Bagaimana Cara Menerapkan Fungsi Utilitas JavaScript Menggunakan Reduce?</a></li>
<li><a href="../id476834/index.html">Red Hat OpenShift 4.2: Alat Baru</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>