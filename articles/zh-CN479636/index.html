<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“¤ ğŸ›ŒğŸ¿ â›¹ğŸ¿ è‡ªå·±çš„å¯¼èˆªå †æ ˆã€‚ æ¯”ROSæ›´å¥½ï¼Ÿ ğŸ¤ğŸ¾ ğŸ‘©ğŸ»â€ğŸ“ ğŸ‘¨â€ğŸš’</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è¿™æ˜¯setUPå›¢é˜Ÿçš„ç¬¬äºŒç¯‡æ–‡ç« ï¼Œä»‹ç»äº†æˆ‘ä»¬åœ¨ä¸ºEurobot Openç«èµ›åˆ›å»ºè‡ªåŠ¨æœºå™¨äººå¹¶ä¸ºæ­¤ä½¿ç”¨ROSæ–¹é¢çš„ç»éªŒã€‚ 

 ç¬¬ä¸€ç¯‡æ–‡ç« ä»‹ç»äº†æœºå™¨äººçš„åŠ›å­¦å’Œæ€»ä½“æ¶æ„ã€‚ 

 æœºå™¨äººåœ¨å¹³å¦çš„åœ°é¢ä¸Šè¡Œé©¶ï¼Œå¤§å¤šæ•°éšœç¢æ˜¯äº‹å…ˆçŸ¥é“çš„ï¼Œä½†æ˜¯ï¼Œé˜´é™©çš„å¯¹æ‰‹å¯ä»¥å°è¯•çªƒå–æˆ‘ä»¬çš„èµ„æºï¼ˆæˆ‘ä»¬æœ‰æ—¶æƒ³åƒæ‰å‡ åä¸ªé¢å¤–çš„ç§¯åˆ†ï¼‰ï¼ŒåŒæ—¶...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>è‡ªå·±çš„å¯¼èˆªå †æ ˆã€‚ æ¯”ROSæ›´å¥½ï¼Ÿ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479636/">è¿™æ˜¯setUPå›¢é˜Ÿçš„ç¬¬äºŒç¯‡æ–‡ç« ï¼Œä»‹ç»äº†æˆ‘ä»¬åœ¨ä¸ºEurobot Openç«èµ›åˆ›å»ºè‡ªåŠ¨æœºå™¨äººå¹¶ä¸ºæ­¤ä½¿ç”¨ROSæ–¹é¢çš„ç»éªŒã€‚ <br><br>  <a href="https://habr.com/ru/post/478836/">ç¬¬ä¸€ç¯‡æ–‡ç« ä»‹ç»äº†æœºå™¨äººçš„åŠ›å­¦å’Œæ€»ä½“æ¶æ„ã€‚</a> <br><br> æœºå™¨äººåœ¨å¹³å¦çš„åœ°é¢ä¸Šè¡Œé©¶ï¼Œå¤§å¤šæ•°éšœç¢æ˜¯äº‹å…ˆçŸ¥é“çš„ï¼Œä½†æ˜¯ï¼Œé˜´é™©çš„å¯¹æ‰‹å¯ä»¥å°è¯•çªƒå–æˆ‘ä»¬çš„èµ„æºï¼ˆæˆ‘ä»¬æœ‰æ—¶æƒ³åƒæ‰å‡ åä¸ªé¢å¤–çš„ç§¯åˆ†ï¼‰ï¼ŒåŒæ—¶æˆ‘ä»¬å¸Œæœ›å°½å¿«é©¶å‘æ‰€éœ€çš„åœ°ç‚¹è€Œä¸ç¢°éšœç¢ç‰©ã€‚ ä»ç°åœºçš„å¤–éƒ¨æ‘„åƒæœºï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—æ•Œäººçš„ä½ç½®æ•°æ®ï¼Œå¹¶çŸ¥é“ä»–ç°åœ¨çš„ä½ç½®ã€‚ ä½†æ˜¯ï¼Œä»…ä»…çŸ¥é“ä»–çš„ä½ç½®è¿˜ä¸å¤Ÿ-æ‚¨éœ€è¦èƒ½å¤Ÿä½¿ç”¨æ­¤ä¿¡æ¯ã€‚ <br><br> ä»Šå¤©ï¼Œæˆ‘ä»¬å°†å°è¯•ä»Aç‚¹é©¶å‘Bç‚¹ï¼Œè€Œä¸å¿…æ²¿ç€åœ¨èµ›åœºä¸Šç¡ç€äº†çš„çŒ«å°¾å·´èµ°ã€‚ ç‰¹åˆ«æ˜¯ï¼Œæˆ‘ä»¬å°†è¯´æ˜å¦‚ä½•æ„å»ºè·¯çº¿å¹¶æ§åˆ¶æœºå™¨äººçš„é€Ÿåº¦ï¼Œå¹¶è¯´æ˜å¦‚ä½•å¯åŠ¨è®¡ç®—æœºä¸Šçš„æ‰€æœ‰å†…å®¹ã€‚ <br><br><img src="https://habrastorage.org/webt/om/x0/a6/omx0a6wfefbht9c1pialld-9vqy.png"><br><a name="habracut"></a><br><h3> è¯•å›¾ä¸€ç‚¹ç‚¹æµè¡€ </h3><br> è§£å†³æ­¤é—®é¢˜æ—¶ï¼Œæ‚¨å¯ä»¥è·å–ä¸“ä¸šäººå£«ç¼–å†™çš„ç°æˆææ–™ï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰ä¸‹ä¸€ä¸ªâ€œè‡ªè¡Œè½¦â€çš„æŠ˜ç£¨å’Œå‘æ˜ã€‚ æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å…¨è½®å¼å¹³å°ï¼Œå› æ­¤å°½ç®¡å°è¯•ä½¿ç”¨ROSæä¾›çš„ç°æˆçš„æœ¬åœ°åˆ¨åºŠï¼Œä½†ç”±äºå¤šç§åŸå› ï¼Œä»–ä»¬è®¤ä¸ºè¿™æ˜¯æ²¡æœ‰å¸Œæœ›çš„ã€‚ åœ¨ä¸‹é¢ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æ ‡å‡†æ»‘ç¿”æœºçš„è®¾è®¡å¸ˆéœ€è¦å¤šå°‘ä¸œè¥¿ï¼š <br><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/** * @class TrajectoryPlanner * @brief Computes control velocities for a robot given a costmap, a plan, and the robot's position in the world. */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TrajectoryPlanner</span></span></span><span class="hljs-class">{</span></span> <span class="hljs-keyword"><span class="hljs-keyword">friend</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TrajectoryPlannerTest</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">//Need this for gtest to work public: /** * @brief Constructs a trajectory controller * @param world_model The WorldModel the trajectory controller uses to check for collisions * @param costmap A reference to the Costmap the controller should use * @param footprint_spec A polygon representing the footprint of the robot. (Must be convex) * @param inscribed_radius The radius of the inscribed circle of the robot * @param circumscribed_radius The radius of the circumscribed circle of the robot * @param acc_lim_x The acceleration limit of the robot in the x direction * @param acc_lim_y The acceleration limit of the robot in the y direction * @param acc_lim_theta The acceleration limit of the robot in the theta direction * @param sim_time The number of seconds to "roll-out" each trajectory * @param sim_granularity The distance between simulation points should be small enough that the robot doesn't hit things * @param vx_samples The number of trajectories to sample in the x dimension * @param vtheta_samples The number of trajectories to sample in the theta dimension * @param pdist_scale A scaling factor for how close the robot should stay to the path * @param gdist_scale A scaling factor for how aggresively the robot should pursue a local goal * @param occdist_scale A scaling factor for how much the robot should prefer to stay away from obstacles * @param heading_lookahead How far the robot should look ahead of itself when differentiating between different rotational velocities * @param oscillation_reset_dist The distance the robot must travel before it can explore rotational velocities that were unsuccessful in the past * @param escape_reset_dist The distance the robot must travel before it can exit escape mode * @param escape_reset_theta The distance the robot must rotate before it can exit escape mode * @param holonomic_robot Set this to true if the robot being controlled can take y velocities and false otherwise * @param max_vel_x The maximum x velocity the controller will explore * @param min_vel_x The minimum x velocity the controller will explore * @param max_vel_th The maximum rotational velocity the controller will explore * @param min_vel_th The minimum rotational velocity the controller will explore * @param min_in_place_vel_th The absolute value of the minimum in-place rotational velocity the controller will explore * @param backup_vel The velocity to use while backing up * @param dwa Set this to true to use the Dynamic Window Approach, false to use acceleration limits * @param heading_scoring Set this to true to score trajectories based on the robot's heading after 1 timestep * @param heading_scoring_timestep How far to look ahead in time when we score heading based trajectories * @param meter_scoring adapt parameters to costmap resolution * @param simple_attractor Set this to true to allow simple attraction to a goal point instead of intelligent cost propagation * @param y_vels A vector of the y velocities the controller will explore * @param angular_sim_granularity The distance between simulation points for angular velocity should be small enough that the robot doesn't hit things */ TrajectoryPlanner(WorldModel&amp; world_model, const costmap_2d::Costmap2D&amp; costmap, std::vector&lt;geometry_msgs::Point&gt; footprint_spec, double acc_lim_x = 1.0, double acc_lim_y = 1.0, double acc_lim_theta = 1.0, double sim_time = 1.0, double sim_granularity = 0.025, int vx_samples = 20, int vtheta_samples = 20, double pdist_scale = 0.6, double gdist_scale = 0.8, double occdist_scale = 0.2, double heading_lookahead = 0.325, double oscillation_reset_dist = 0.05, double escape_reset_dist = 0.10, double escape_reset_theta = M_PI_2, bool holonomic_robot = true, double max_vel_x = 0.5, double min_vel_x = 0.1, double max_vel_th = 1.0, double min_vel_th = -1.0, double min_in_place_vel_th = 0.4, double backup_vel = -0.1, bool dwa = false, bool heading_scoring = false, double heading_scoring_timestep = 0.1, bool meter_scoring = true, bool simple_attractor = false, std::vector&lt;double&gt; y_vels = std::vector&lt;double&gt;(0), double stop_time_buffer = 0.2, double sim_period = 0.1, double angular_sim_granularity = 0.025);</span></span></code> </pre> <br>  <i>è¿™æ˜¯ç”¨äºè°ƒèŠ‚é€Ÿåº¦å’Œæ•´ä½“è½¨è¿¹çš„å‚æ•°åˆå§‹åŒ–çš„ç¤ºä¾‹ã€‚</i> <br><br> å®Œæ•´è®¡ç®—çš„é‡è¦å‚æ•°ï¼š <br><br><ol><li> å‚æ•°world_modelã€‚ </li><li> æˆæœ¬å›¾å‚æ•°ï¼šåˆ°åŒ…å«éšœç¢ç‰©åŠå…¶â€œè™šæ‹Ÿå»¶ä¼¸â€çš„åœ°å›¾çš„é“¾æ¥ï¼Œå…¶ä¸­è€ƒè™‘äº†æ½œåœ¨çš„ç¢°æ’ã€‚ </li></ol><br> åœ¨æ ‡å‡†å †æ ˆçš„ä¼˜ç‚¹ä¸­ï¼Œæ‚¨å¯ä»¥çªå‡ºæ˜¾ç¤ºæ–‡æ¡£çš„å¯ç”¨æ€§ä»¥åŠåœ¨è®ºå›ä¸ŠæŸ¥æ‰¾ä¿¡æ¯çš„èƒ½åŠ›ã€‚  <a href="https://github.com/ros-planning/navigation" rel="nofollow">æ‚¨å¯ä»¥åœ¨å®˜æ–¹ç½‘ç«™ä¸Šé˜…è¯»æ›´å¤šæ–‡æ¡£</a> <br><br> å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒROSè½¯ä»¶åŒ…æ˜¯ä¸ºä¸¤è½®å¹³å°ç¼–å†™çš„ï¼Œåœ¨Omniä¹‹ä¸‹ï¼Œå®ƒä»¬é€šè¿‡å¢åŠ åˆ°360åº¦æ—¶çš„å¯ç”¨æ—‹è½¬è§’åº¦è¿›è¡Œäº†ä¼˜åŒ–ï¼Œè¿™æ— ç–‘æ˜¯ä¸€ä¸ªæ‹æ–ã€‚ <br><br> å¯¹é¡¹ç›®è¿›è¡Œåˆ†æåï¼Œæˆ‘ä»¬æ„è¯†åˆ°å­¦ä¹ å’Œè¡¥å……å­˜åœ¨å›°éš¾ï¼Œå¹¶ä¸”ä¸éœ€è¦å¾ˆå¤šç¹é‡çš„èŠ¯ç‰‡ã€‚ çœ‹èµ·æ¥ï¼Œè®©å®ƒä»¬æˆä¸ºç°å®ï¼Œä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨äº†Odroid xu4ï¼ˆè¯¥å¤„ç†å™¨ä»åœ¨ä¸‰æ˜Ÿs5ä¸Šä½¿ç”¨ï¼‰ï¼Œæ€§èƒ½ç»“æœä»¤äººæ²®ä¸§ï¼Œè€Œæ›´å¼ºå¤§çš„è®¾å¤‡çš„ç©ºé—´ï¼ˆä¸ä¹‹ç›¸æ¯”ï¼Œæ ‘è“4å’Œjetson nanoå¤„ç†å™¨åˆ™ç´§å¼ åœ°æŠ½çƒŸäº†ï¼‰å’Œä»–åœ¨ä¸€èµ·ï¼‰ æˆ‘ä¸å¾—ä¸æ”¾å¼ƒæ ‡å‡†å †æ ˆï¼Œå°è¯•è‡ªå·±åˆ›å»ºå…¨å±€è®¡åˆ’ç¨‹åºï¼Œæœ¬åœ°è®¡åˆ’ç¨‹åºå’Œè½¨è¿¹ç®¡ç†å™¨ <br><br><img src="https://habrastorage.org/webt/ij/qe/es/ijqeesrak1vuhjqfr1ij6exr4_a.jpeg"><br><br><h3> å…¨çƒè§„åˆ’å¸ˆï¼Œæœ¬åœ°è§„åˆ’å¸ˆï¼Œè½¨è¿¹ç®¡ç†å™¨ä»¥åŠæ‰€æœ‰è¿™äº› </h3><br> éœ€è¦å…¨çƒå’Œæœ¬åœ°æ»‘ç¿”æœºæ‰èƒ½è·å¾—å‰å¾€ç›®çš„åœ°çš„è·¯çº¿ã€‚ ä¸ºä»€ä¹ˆéœ€è¦åˆ†éš”ï¼Ÿ æ‚¨ä¸ºä»€ä¹ˆä¸èƒ½åªä¹˜<a href="https://ru.wikipedia.org/wiki/A*" rel="nofollow">A *</a>ä¹˜å®ƒå‘¢ï¼Ÿ é€šå¸¸ï¼Œå…¨å±€è§„åˆ’äººå‘˜åœ¨æ„é€ è·¯çº¿æ—¶å¯ä»¥åœ¨å…¶å·¥ä½œä¸­ä½¿ç”¨æ•´ä¸ªåœ°å›¾ï¼Œå› æ­¤ç®—æ³•åº”è¯¥å°½å¯èƒ½å¿«ï¼Œç”šè‡³å¯ä»¥è¿›è¡Œä¸€äº›ç®€åŒ–ã€‚ ä¸ºäº†ç®€åŒ–è¿™äº›ç®€åŒ–è¿‡ç¨‹ï¼Œä»–ä»¬è¿˜ä½¿ç”¨äº†æœ¬åœ°è®¡åˆ’ç¨‹åºï¼Œè¯¥ç¨‹åºæ ¹æ®å…¨å±€è®¡åˆ’ç¨‹åºçš„ç»“æœï¼ˆæˆ–ä»…åœ¨æœºå™¨äººå‘¨å›´çš„æœ‰é™åŒºåŸŸå†…ï¼‰å°è¯•è€ƒè™‘æ‰€æœ‰ç»†å¾®å·®åˆ«ã€‚ <br><br> æ„å»ºè·¯çº¿åï¼Œæˆ‘ä»¬çŸ¥é“æœºå™¨äººåº”è¯¥å»å“ªé‡Œï¼Œä½†æ˜¯å¦‚ä½•å¾—çŸ¥ä»–å‘¢ï¼Ÿ ä¸ºæ­¤ï¼Œæœ‰ä¸€ä¸ªè½¨è¿¹è°ƒèŠ‚å™¨ã€‚ å®ƒè®¡ç®—æœºå™¨äººæ­¤æ—¶åº”ä»¥ä»€ä¹ˆé€Ÿåº¦å’Œæœå“ªä¸ªæ–¹å‘è¿åŠ¨ï¼Œä»¥å…åç¦»è½¨è¿¹ã€‚ åœ¨è®¸å¤šæ–¹é¢ï¼Œæ­¤è½¯ä»¶åŒ…è´Ÿè´£æœºå™¨äººè¿è¡Œçš„é€Ÿåº¦å’Œç¾è§‚ç¨‹åº¦ã€‚ <br><br> é™¤äº†è¿™ä¸‰ä¸ªå®ä½“ä¹‹å¤–ï¼Œè¿˜æœ‰ç¬¬å››ä¸ªå®ä½“-åœ°å›¾æœåŠ¡å™¨ï¼Œå®ƒä½¿æ‚¨å¯ä»¥æ–¹ä¾¿åœ°å¤„ç†ä¸–ç•ŒçŠ¶å†µã€‚ å®ƒè®¾ç½®äº†æˆ‘ä»¬æè¿°åœ°å›¾çš„æ–¹å¼ï¼Œä½¿ç”¨åœ°å›¾æ—¶æœ‰ä»€ä¹ˆå¯èƒ½æ€§ï¼Œå¹¶åœ¨è®¸å¤šæ–¹é¢å†³å®šäº†æ»‘ç¿”æœºçš„é€Ÿåº¦ã€‚ <br><br> åœ¨ç»§ç»­ä»‹ç»å¯¼èˆªå †æ ˆä¹‹å‰ï¼Œæœ€å¥½æ¦‚è¿°ä¸€ä¸‹ä¸ºä»€ä¹ˆé€‰æ‹©cost_mapä½œä¸ºåœ°å›¾æœåŠ¡å™¨çš„åŸå› ã€‚ é€šå¸¸ï¼Œæˆ‘ä»¬ä¸ºåœ°å›¾å¤„ç†ç¨‹åºå°è¯•äº†ä¸åŒçš„é€‰é¡¹ï¼š <a href="https://github.com/IntelRealSense/realsense-ros/tree/occupancy-mapping" rel="nofollow">Occupancy_grid</a> ï¼Œ <a href="http://wiki.ros.org/grid_map" rel="nofollow">Grid_map</a> ï¼Œ <a href="https://github.com/stonier/cost_map" rel="nofollow">Cost_map</a> ï¼Œä½†é€‰æ‹©äº†åè€…ã€‚ <br><br> åŸå› ï¼š <br><br><ol><li> æ–¹ä¾¿åœ°ä¸åœ°å›¾äº’åŠ¨ã€‚ </li><li> æˆ‘ä»¬éœ€è¦å„ç§å½¢å¼ï¼ˆåœ†å½¢ï¼Œçº¿æ€§ï¼ŒçŸ©å½¢ç­‰ï¼‰çš„è¿­ä»£å™¨ã€‚ </li><li> æ‚¨å¯ä»¥ä½¿ç”¨ä¸åŒçš„å‚æ•°å­˜å‚¨å¤šä¸ªåœ°å›¾å›¾å±‚ã€‚ </li><li> è‰¯å¥½çš„å†…å­˜ç®¡ç†ã€‚ </li><li> æœ€é‡è¦çš„æ˜¯é€Ÿåº¦ã€‚ ç½‘æ ¼åœ°å›¾å¯ä½¿ç”¨åŒç²¾åº¦ç±»å‹ï¼Œå› æ­¤ï¼Œå®ƒæ¯”ä½¿ç”¨int8èµ·ä½œç”¨çš„é‚£äº›åœ°å›¾æœåŠ¡å™¨è¦æ…¢å‡ å€ã€‚ </li></ol><br> å°½ç®¡Occupancyç½‘æ ¼ä¹Ÿå¯ä»¥ä¸int8ä¸€èµ·ä½¿ç”¨ï¼Œä½†æ˜¯å®ƒä¸èƒ½æ‹¥æœ‰ç›¸åŒçš„å¯ç”¨æ€§ï¼Œå› æ­¤æˆ‘ä¸å¾—ä¸æ”¾å¼ƒå®ƒã€‚ <br><br> ä»åœ°å›¾ä¸Šï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“è‡ªç”±ï¼Œå±é™©å’Œä¸å¯æŠ—æ‹’çš„åŒºåŸŸåœ¨å“ªé‡Œã€‚ å¯¹äºåœºä¸Šçš„æ¯ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥è°ƒæ•´å……æ°”åœº-è¯¥å€¼å–å†³äºä¸å¯¹è±¡çš„è·ç¦»ï¼Œè¯¥å€¼è¡¨ç¤ºå•å…ƒçš„æ¸—é€æ€§ã€‚ é€šè´§è†¨èƒ€æ˜¯çŒ«çš„å°¾å·´ï¼Œå¾ˆå®¹æ˜“æ³¨æ„åˆ°ï¼Œä½†æ‚¨ä¼šåæ‚”å¾ˆé•¿ä¸€æ®µæ—¶é—´ã€‚ æˆ‘ä»¬ä¸ºæ•Œæ–¹æœºå™¨äººç»˜åˆ¶åœ°å›¾ï¼Œå¹¶æ·»åŠ ä»…æœ¬åœ°è®¡åˆ’äººå‘˜è€ƒè™‘çš„å±é™©åŒºåŸŸã€‚ å…¨çƒè§„åˆ’å¸ˆå°†å¿½ç•¥æ‰€æœ‰è¦ç‚¹ï¼Œå¦‚æœå®ƒä»¬ä¸æ˜¯éšœç¢ã€‚ <br><br><h4> å…¨çƒè§„åˆ’å¸ˆ </h4><br> ä»–ä»¬åœ¨å¯¼èˆªä¸­å†™çš„ç¬¬ä¸€ä»¶äº‹æ˜¯å…¨çƒè§„åˆ’å¸ˆã€‚ å®ƒåŸºäºtheta *ç®—æ³•ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œè¿™æ˜¯ä¸€ä¸ªä¿®æ”¹åçš„<a href="https://ru.wikipedia.org/wiki/A*" rel="nofollow">A *</a> ï¼Œå…¶é‡ç‚¹æ˜¯æ‰¾åˆ°å¯ä»¥ç›´æ¥åˆ°è¾¾çš„çˆ¶èŠ‚ç‚¹ï¼Œå³ å¥¹æ²¡æœ‰ä»»ä½•éšœç¢ã€‚ è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ„å»ºåœ¨æœ¬åœ°è®¡åˆ’ç¨‹åºä¸­ä½¿ç”¨çš„æ–¹ä¾¿ä¸”å¹³æ»‘çš„è·¯å¾„ã€‚ <br><br><img src="https://habrastorage.org/webt/it/qs/e4/itqse4uuumbbzu8rxws07gapbn8.png"><br>  <i>A *å’Œtheta *çš„æ¯”è¾ƒ</i> <br><br> å¯¹äºå…¨å±€è§„åˆ’å¸ˆï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¸¦æœ‰å‚æ•°çš„æ–‡ä»¶ï¼ˆparams / path_planner.yamlï¼‰ï¼Œè¯¥æ–‡ä»¶æè¿°åœ°å›¾ä¸»é¢˜å’Œæ‰€æœ‰æœºå™¨äººçš„ä½ç½®çš„ä¸»é¢˜ï¼ˆå¯¹äºç°åœºçš„æ‰€æœ‰å››ä¸ªæœºå™¨äººï¼Œå…¶ä¸­â€œ nullâ€æ˜¯å¸¦æœ‰æœ‰å…³å½“å‰æœºå™¨äººæ•°æ®çš„ä¸»é¢˜ï¼‰ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta"># small robot debug param list robot_id: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"small"</span></span></span><span class="hljs-meta"> ########################### # cost_map_server params ## ########################### cost_map_server/big_robot_size: 0.45 cost_map_server/little_robot_size: 0.45 cost_map_server/cube_size: 0.11 cost_map_server/inscribed_radius: 0.3 cost_map_server/inflation_radius: 0.3 cost_map_server/inflation_exponential_rate: 0.6 cost_map_server/big_robot1: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/aruco/big_robot"</span></span></span><span class="hljs-meta"> cost_map_server/big_robot2: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/aruco/enemy_robot1"</span></span></span><span class="hljs-meta"> cost_map_server/small_robot1: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"null"</span></span></span><span class="hljs-meta"> cost_map_server/small_robot2: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/aruco/enemy_robot2"</span></span></span><span class="hljs-meta"> cost_map_server/collision: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"collision"</span></span></span><span class="hljs-meta"> cost_map_server/image_resource_name: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"$(find cost_map_server)/param/image_resource.yaml"</span></span></span><span class="hljs-meta"> cost_map_server/min_diff_points: 0.01 ########################### ### path_planner params ### ########################### global_planner/path_layer: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"inflation_layer"</span></span></span><span class="hljs-meta"> global_planner/path_force_layer: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"obstacle_inflation_layer"</span></span></span><span class="hljs-meta"> global_planner/frame_id: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"map"</span></span></span><span class="hljs-meta"> global_planner/current_position: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"real_corr"</span></span></span><span class="hljs-meta"> global_planner/path_filter_epsilon: 0</span></span></code> </pre> <br> å®ƒè¿˜è¡¨æ˜ï¼š <br><br><ol><li> æ‚¨å¯ä»¥é€‰æ‹©çš„ä¸€ç§ç®—æ³•æ¥æ„å»ºè·¯çº¿ï¼Œ </li><li> æˆ‘ä»¬å°†åœ¨å…¶è‡ªèº«ä¸Šæ„å»ºè·¯çº¿çš„å›¾å±‚çš„åç§°ï¼Œ </li><li> ä¸€ä¸ªå…³äºæˆ‘ä»¬ä½ç½®çš„ä¸»é¢˜ï¼Œåœ¨è¯¥ä½ç½®å‘å¸ƒå·²è¿‡æ»¤çš„æ•°æ®ï¼ˆåœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯æ¥è‡ªç…§ç›¸æœºå’Œé‡Œç¨‹è¡¨çš„ä½ç½®æ•°æ®çš„ç»„åˆï¼‰ã€‚ </li></ol><br> è·¯å¾„æœç´¢ç®—æ³•æœ¬èº«-Theta Star-åœ¨å•ç‹¬çš„æ–‡ä»¶ï¼ˆsrc / global_planner.cppï¼‰ä¸­çªå‡ºæ˜¾ç¤ºï¼Œä»¥æ–¹ä¾¿æ·»åŠ æ–°ç®—æ³•ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cost_so_far[<span class="hljs-number"><span class="hljs-number">300</span></span>][<span class="hljs-number"><span class="hljs-number">200</span></span>]; PriorityPoint neighbors[<span class="hljs-number"><span class="hljs-number">8</span></span>]; PriorityPoint current; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> come_from[<span class="hljs-number"><span class="hljs-number">300</span></span>][<span class="hljs-number"><span class="hljs-number">200</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makePath_ThetaStar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">vector</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;cost_map::Index&gt; &amp;path, PriorityPoint start, PriorityPoint goal, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> layer, cost_map::CostMap &amp;cost_map, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> grid_cost, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> only_cost)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::priority_queue&lt;PriorityPoint, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;PriorityPoint&gt;, myCompare&gt; openSet; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> max_x = cost_map.getSize()[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> max_y = cost_map.getSize()[<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::fill_n(*cost_so_far, max_x * max_y, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::numeric_limits&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt;::max()); cost_so_far[start.x][start.y] = <span class="hljs-number"><span class="hljs-number">0</span></span>; come_from[start.x][start.y][<span class="hljs-number"><span class="hljs-number">0</span></span>] = start.x; come_from[start.x][start.y][<span class="hljs-number"><span class="hljs-number">1</span></span>] = start.y; openSet.push(start); grid_cost=<span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!openSet.empty()) { current = openSet.top(); openSet.pop(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current == goal) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } current.GetNeighbors(neighbors); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> current_cost = cost_so_far[current.x][current.y]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> parent_carent[<span class="hljs-number"><span class="hljs-number">2</span></span>] ={come_from[current.x][current.y][<span class="hljs-number"><span class="hljs-number">0</span></span>], come_from[current.x][current.y][<span class="hljs-number"><span class="hljs-number">1</span></span>]}; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">8</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!neighbors[i].OnMap(max_x, max_y)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> onLine = lineOfSight(parent_carent[<span class="hljs-number"><span class="hljs-number">0</span></span>], parent_carent[<span class="hljs-number"><span class="hljs-number">1</span></span>], neighbors[i].x, neighbors[i].y, cost_map, layer, grid_cost + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (onLine) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> new_cost = cost_so_far[parent_carent[<span class="hljs-number"><span class="hljs-number">0</span></span>]][parent_carent[<span class="hljs-number"><span class="hljs-number">1</span></span>]] + HeuristicEvclid(parent_carent, neighbors[i], grid_cost*<span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (new_cost &lt; cost_so_far[neighbors[i].x][neighbors[i].y]) { cost_so_far[neighbors[i].x][neighbors[i].y] = new_cost; neighbors[i].priority = HeuristicEvclid(neighbors[i], goal, grid_cost*<span class="hljs-number"><span class="hljs-number">10</span></span>) + new_cost; openSet.push(neighbors[i]); come_from[neighbors[i].x][neighbors[i].y][<span class="hljs-number"><span class="hljs-number">0</span></span>] = parent_carent[<span class="hljs-number"><span class="hljs-number">0</span></span>]; come_from[neighbors[i].x][neighbors[i].y][<span class="hljs-number"><span class="hljs-number">1</span></span>] = parent_carent[<span class="hljs-number"><span class="hljs-number">1</span></span>]; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> neighbor_price = cost_map.at(layer, cost_map::Index({neighbors[i].x, neighbors[i].y})) + neighbors[i].priority; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> new_cost = current_cost + neighbor_price; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (new_cost &lt; cost_so_far[neighbors[i].x][neighbors[i].y]) { cost_so_far[neighbors[i].x][neighbors[i].y] = new_cost; neighbors[i].priority =HeuristicEvclid(neighbors[i], goal, grid_cost*<span class="hljs-number"><span class="hljs-number">10</span></span>) + new_cost; openSet.push(neighbors[i]); come_from[neighbors[i].x][neighbors[i].y][<span class="hljs-number"><span class="hljs-number">0</span></span>] = current.x; come_from[neighbors[i].x][neighbors[i].y][<span class="hljs-number"><span class="hljs-number">1</span></span>] = current.y; } } } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (only_cost) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cost_so_far[current.x][current.y]; } path.clear(); PriorityPoint temp_point; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (current != start) { path.push_back({current.x, current.y}); temp_point.x = come_from[current.x][current.y][<span class="hljs-number"><span class="hljs-number">0</span></span>]; temp_point.y = come_from[current.x][current.y][<span class="hljs-number"><span class="hljs-number">1</span></span>]; current = temp_point; } path.push_back({current.x, current.y}); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br> åˆ é™¤RamerDouglasPeuckerè·¯å¾„ä¸Šå¤šä½™ç‚¹çš„ç®—æ³•ä¹Ÿåˆ†é…ç»™å•ç‹¬çš„æ–‡ä»¶ã€‚ <br> å¦‚æœè·è¿æ¥ä¸¤ä¸ªç›¸é‚»ç‚¹çš„çº¿çš„è·ç¦»è¶…å‡ºç»™å®šè·ç¦»ï¼Œå®ƒå°†ä»è·¯å¾„ä¸­åˆ é™¤ç‚¹ã€‚ <br><br><img src="https://habrastorage.org/webt/en/_9/dw/en_9dw6khdarxbyf7gvrhpqg7b4.jpeg"><br><br><h4> å½“åœ°è§„åˆ’å¸ˆ </h4><br> ä»–åœ¨åŠ¿åœºçš„æ¢¯åº¦ä¸‹é™åŸºç¡€ä¸Šä¸ºæˆ‘ä»¬å·¥ä½œã€‚ ä½œä¸ºè¾“å…¥ï¼Œæ¥è‡ªå…¨å±€è®¡åˆ’ç¨‹åºçš„è·¯å¾„ã€‚ ä½†æ˜¯ï¼Œè¿™è¿˜ä¸æ˜¯ä»–æ‰€èƒ½åšåˆ°çš„ã€‚ åœ¨local_plannerä¸­ï¼Œæœ‰ç”¨äºé€‰æ‹©è·¯å¾„æ„é€ æ¨¡å¼çš„å†…éƒ¨æœåŠ¡ã€‚ æ€»å…±æœ‰ä¸¤ç§æ“ä½œæ¨¡å¼ï¼šåœ¨åœ°å›¾ä¸Šä½¿ç”¨å¤šæ¬¡é€šè¿‡æ²¿æ¢¯åº¦å¹³ç§»ç‚¹çš„æ¨¡å¼ä»¥åŠå¹³ç§»æ¨¡å¼ï¼Œåœ¨å¹³ç§»æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬ç«‹å³åœ¨ä¸¤ä¸ªåæ ‡ä¸­è®¡ç®—å¢é‡å¹¶å°†è¯¥ç‚¹ç§»åŠ¨åˆ°å®‰å…¨åŒºçš„è¾¹ç¼˜ã€‚ å¦‚æœè¯¥ç‚¹è½å…¥å¤šä¸ªæ­¤ç±»åŒºåŸŸï¼Œåˆ™æˆ‘ä»¬å°†ç§»è‡³å…¶äº¤ç‚¹çš„ä½ç½®ï¼Œå› ä¸ºåœ¨é‚£é‡Œæœ€å®‰å…¨ã€‚ <br><br> æ“ä½œæ¨¡å¼å¦‚ä¸‹ï¼šå¦‚æœä¸Šä¸€æ¬¡è¿­ä»£çš„è·¯å¾„ä¸­æ²¡æœ‰éšœç¢ç‰©ï¼Œåˆ™æˆ‘ä»¬æ¯2 cmæ–­å¼€è·¯å¾„ï¼Œç„¶åæ²¿æ¢¯åº¦ç§»åŠ¨å®ƒï¼Œå¦åˆ™æˆ‘ä»¬ä½¿ç”¨ç¬¬äºŒä¸ªå±€éƒ¨è§„åˆ’å™¨æ“ä½œæ¨¡å¼ã€‚ <br><br> ç¬¬äºŒä¸ªé€‰é¡¹éå¸¸è½»å·§ï¼Œå¹¶ä¸”åƒå…¨å±€è®¡åˆ’å™¨ä¸€æ ·ï¼Œä¸ä¼šè¿‡å¤šåœ°åŠ è½½å¤„ç†å™¨ã€‚ æˆ‘ä»¬å¯¹åœ°å›¾ä½¿ç”¨äº†è¯¥ç®—æ³•çš„å¤šä¸ªç‰ˆæœ¬ä»¥åŠå„ç§æ“ä½œã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å°è¯•ç¼–å†™ä¸€ä¸ªå›¾å½¢ï¼Œåœ¨è¯¥å›¾å½¢ä¸­ï¼Œæ¯éš”10 cmä¼šæ‰¾åˆ°ä¸€ä¸ªé¡¶ç‚¹ï¼Œå¹¶ä¸”é¡¶ç‚¹ä¹‹é—´çš„æœ€å¤§åç§»é‡ä¸º4 cmï¼Œç„¶ååœ¨è·å¾—çš„å›¾å½¢ä¸Šä½¿ç”¨Dijkstraç®—æ³•æŸ¥æ‰¾æœ€å°çš„è·ç¦»ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç«¯ç‚¹ä½¿ç”¨æœ€è¿‘çš„åç§»ç‚¹ã€‚ ä½†æ˜¯è¿™ç§ç®—æ³•æ›´é€‚åˆå…¨å±€è§„åˆ’äººå‘˜ï¼Œå› æ­¤æˆ‘ä»¬å†³å®šæ”¾å¼ƒæ­¤å®ç°ã€‚ <br><br> æˆ‘ä»¬è¿˜å°è¯•ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•ä»å¤´å¼€å§‹ä½¿ç”¨è·¯å¾„æ„å»ºã€‚ è¯¥æ–¹æ³•æ˜¯æˆ‘ä»¬å†³å®šç¼–å†™çš„ç¬¬ä¸€ä¸ªæ–¹æ³•ã€‚ ç»“æœè¯æ˜å†…å­˜æ•ˆç‡ä¸é«˜ï¼ˆå®ƒå ç”¨äº†è¶…è¿‡400 mbçš„çº¯RAMï¼Œå› ä¸ºå®ƒæ¯æ¬¡éƒ½ä½¿ç”¨äº†æˆæœ¬æ˜ å°„ï¼‰å¹¶ä¸”é€Ÿåº¦å¾ˆæ…¢ã€‚ ç”±äºä¼˜åŒ–ä¸ä½³è€Œå…³é—­äº†é¢‘ç‡æ§åˆ¶ï¼Œå¹¶ä¸”é€Ÿåº¦ä½äºæ¯ç§’30æ¬¡ï¼Œè¿™ä¸é€‚åˆæˆ‘ä»¬ã€‚ <br><br> ç»“æœï¼Œæˆ‘ä»¬å†³å®šæ ¹æ®æ•´ä½“åˆ¨åºŠçš„è·¯å¾„åœ¨åŠ¿åœºä¸­ä½¿ç”¨æ¢¯åº¦ä¸‹é™ã€‚ äº‹å®è¯æ˜ï¼Œè¿™æ˜¯ä¸€ç§è½»é‡çº§ä¸”ç›¸å¯¹ç®€å•çš„ç®—æ³•ï¼Œåœ¨è·¯å¾„è´¨é‡ï¼Œå·¥ä½œæ—¶é—´å’Œ100-150 mbåŒºåŸŸå†…ä½¿ç”¨çš„RAMé‡æ–¹é¢å®Œå…¨é€‚åˆæˆ‘ä»¬ï¼Œè¿™æ¯”å¼€å‘çš„ç¬¬ä¸€æ¬¡è¿­ä»£å°‘äº†å‡ å€ã€‚ <br><br><img src="https://habrastorage.org/webt/sg/oq/mo/sgoqmogivjs8elhylt74oqjqrdw.png"><br>  <i>æœ¬åœ°å¹³é¢é“£åˆ€åç§»è·¯å¾„çš„ç¤ºä¾‹</i> <br><br> ä¸global_plannerä¸åŒï¼Œlocal_plannerä¸­çš„å‚æ•°éå¸¸å°ï¼Œè¿™æ˜¯å› ä¸ºå®ƒå¾ˆç®€å•ï¼Œå› ä¸ºæ‰€æœ‰æœ€é‡è¦çš„ä»»åŠ¡éƒ½ç”±global_planneræ‰¿æ‹…ï¼š <br><br><pre> <code class="cpp hljs">grid_map_server/big_robot1 : <span class="hljs-number"><span class="hljs-number">0.4</span></span> grid_map_server/big_robot2 : <span class="hljs-number"><span class="hljs-number">0.4</span></span> grid_map_server/small_robot1 : <span class="hljs-number"><span class="hljs-number">0.4</span></span> grid_map_server/small_robot2 : <span class="hljs-number"><span class="hljs-number">0.4</span></span> local_planner/radius : <span class="hljs-number"><span class="hljs-number">0.15</span></span> global_planner/frame_id : <span class="hljs-string"><span class="hljs-string">"map"</span></span></code> </pre> <br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é…ç½®ï¼š <br><br><ul><li> æ¯ä¸ªæœºå™¨äººçš„å®‰å…¨åŒºåŸŸåŠå¾„ã€‚ </li><li> æœ¬åœ°åˆ¨åºŠçš„æœ€å¤§è·¯å¾„åç§»é‡ã€‚ </li><li> æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„åœ°å›¾å›¾å±‚çš„åç§°ã€‚ </li></ul><br> åœ¨ä¸€ä¸ªå•ç‹¬çš„ç±»ä¸­ï¼Œåˆ†é…äº†æ‰€æœ‰æœ€é‡è¦çš„åŠŸèƒ½ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™æ˜¯è·¯å¾„çš„é€’å½’åˆ†è§£ï¼Œåˆ›å»ºæ»‘ç¿”æœºä»¥åŠè™šæ‹Ÿæ„é€ å‡½æ•°å’Œææ„å‡½æ•°ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Planner</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Planner(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span> inflation_radius_, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> frame_id_) { inflation_radius = inflation_radius_; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">300</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; <span class="hljs-number"><span class="hljs-number">200</span></span>; j++) our_map[i][j] = <span class="hljs-number"><span class="hljs-number">3000.0</span></span>; } OurPath-&gt;poses.resize(<span class="hljs-number"><span class="hljs-number">50</span></span>); geometry_msgs::Pose pose; pose.position.x = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; pose.position.y = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">50</span></span>; i++) { OurPath-&gt;poses[i].pose = pose; } frame_id = frame_id_; } <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~Planner() { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdatePath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; ros::Publisher move_pub; ros::Publisher BigEnemyPub; ros::Publisher LittleEnemyPub; ros::Publisher local_path_publisher; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: <span class="hljs-comment"><span class="hljs-comment">// virtual double Calculate_Path_Len(); nav_msgs::Path* recursive_path(nav_msgs::Path *path, std::pair&lt;double, double&gt; start, std::pair&lt;double, double&gt; end, double epsilon, int &amp;index) { if (CalcDistance(start, end) &lt; (epsilon) || path-&gt;poses.size() &gt; 200) return path; double start_x = (start.first + end.first) / 2.0; double start_y = (start.second + end.second) / 2.0; index = find_out(path, start); geometry_msgs::PoseStamped pose; pose.pose.position.x = start_x; pose.pose.position.y = start_y; path-&gt;poses.insert(path-&gt;poses.begin() + index, pose); recursive_path(path, start, std::pair&lt;double, double&gt;{start_x, start_y}, epsilon, index); recursive_path(path, std::pair&lt;double, double&gt;{start_x, start_y}, end, epsilon, index); } int find_out(nav_msgs::Path *path, pair_double point) { int index = 0; for (int i = 0; i &lt; path-&gt;poses.size(); i++) if (path-&gt;poses[i].pose.position.x == point.first &amp;&amp; path-&gt;poses[i].pose.position.y == point.second) return ++i; return index; } void add_in_path(nav_msgs::Path* Path, geometry_msgs::PoseStamped pose, int&amp; Index) { Path-&gt;poses[Index % max_size] = pose; Index++; } double inflation_radius; double our_map[300][200]; int max_size = 49; std::string frame_id; nav_msgs::Path *path = new nav_msgs::Path; nav_msgs::Path *OurPath = new nav_msgs::Path; };</span></span></code> </pre> <br>  LocalPlanningç±»æ˜¯ä»è¯¥ç±»ç»§æ‰¿è€Œæ¥çš„ï¼Œè¯¥ç±»æ˜¯æ»‘ç¿”æœºæ•´ä¸ªæ ¸å¿ƒæ‰€åœ¨çš„ä½ç½®ï¼Œå³ï¼Œå°†ç‚¹ç§»åŠ¨åˆ°å®‰å…¨åŒºçš„è¾¹ç¼˜ï¼Œå¹¶å…·ä½“å†³å®šå¦‚ä½•å¤„ç†è¯¥è·¯å¾„ã€‚ <br><br> æ‰€æœ‰å…¶ä»–åŠŸèƒ½åœ¨å•ç‹¬çš„æ–‡ä»¶fichi.hppä¸­çªå‡ºæ˜¾ç¤ºï¼Œå¹¶ä¸”æ¢¯åº¦ä¸‹é™åœ¨potential_field.hppä¸­ã€‚ ä»¥ä¸‹æ˜¯æ­¤æ–‡ä»¶çš„å¿«ç…§ï¼Œå…¶ä¸­æ˜¾ç¤ºäº†åœ¨cost_mapæ˜ å°„ä¸Šåˆ›å»ºæ½œåœ¨å­—æ®µçš„åŠŸèƒ½ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CalcAttractivePotential</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(grid_map::Index index, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> goalx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> goaly)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">pow</span></span>(index[<span class="hljs-number"><span class="hljs-number">0</span></span>] - goalx, <span class="hljs-number"><span class="hljs-number">2</span></span>) + <span class="hljs-built_in"><span class="hljs-built_in">pow</span></span>(index[<span class="hljs-number"><span class="hljs-number">1</span></span>] - goaly, <span class="hljs-number"><span class="hljs-number">2</span></span>)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CalcPotential</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> startx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> starty, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> goalx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> goaly, cost_map::CostMap &amp;cost_map, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (&amp;our_map)[</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">300</span></span></span></span><span class="hljs-function"><span class="hljs-params">][</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">200</span></span></span></span><span class="hljs-function"><span class="hljs-params">])</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Use some magic for normalisation of Field double max_distance = (CalcAttractivePotential(grid_map::Index(startx, starty), goalx, goaly) + 15); if (max_distance == 0.0) { max_distance = 0.01; } for (cost_map::CircleIterator iterator(cost_map, grid_map::Position(startx / 100.0, starty / 100.0), max_distance / 100.); !iterator.isPastEnd(); ++iterator) { try { grid_map::Index index(*iterator); double uf; uf = cost_map.at("obstacle_inflation_layer", *iterator); // if we on free podouble - field is more less then if it not free podouble if ( uf &gt;= 10) { uf = 3000.0; // CP - is const variable } else uf += CalcAttractivePotential(index, goalx, goaly)/max_distance * 256; our_map[299-index(0)][199-index(1)] = uf; } catch(std::exception&amp; e) { ROS_INFO("Exception! %s", e.what() ); } } }</span></span></code> </pre> <br><h4> è½¨è¿¹è°ƒèŠ‚å™¨ </h4><br> æœ€åä½†å¹¶éæœ€ä¸é‡è¦çš„æ˜¯è½¨è¿¹è°ƒèŠ‚å™¨ã€‚ ä»–è´Ÿè´£å°†æœ¬åœ°è®¡åˆ’ç¨‹åºè·¯å¾„è½¬æ¢ä¸ºè·¯å¾„ï¼Œå¹¶ç»™å‡ºå½“å‰æ­¥éª¤çš„é€Ÿåº¦ã€‚ <br><br> æˆ‘ä»¬åœ¨Eurobot 2018å†³èµ›ä¸­ä½¿ç”¨çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬æ˜¯åŠ é€Ÿå’Œåˆ¶åŠ¨pidæ§åˆ¶å™¨çš„æ··åˆä½“ï¼Œå…¶ä¸­çŸ¢é‡ç›¸å¯¹äºåˆ°ç»ˆç‚¹çš„è·ç¦»å½’ä¸€åŒ–ä¸ºæ²¿é€”çš„ä¸‹ä¸€ä¸ªç‚¹ã€‚ <br><br> ç®€è€Œè¨€ä¹‹ï¼ŒPIDæ§åˆ¶å™¨æ˜¯æœ‰åŠ©äºä¿®å¤ç³»ç»Ÿçš„ç³»ç»Ÿä¸‰ä¸ªçŠ¶æ€å’Œæœ‰æ—¶ä¼šå‡ºç°çš„éšæœºé”™è¯¯çš„æ€»å’Œã€‚ <br><br> è¿™äº›å‡½æ•°æ˜¯æ ¹æ®ç»éªŒé€‰æ‹©çš„ï¼Œå¹¶ä¸”å–å†³äºåˆ°è·¯å¾„ç»ˆç‚¹çš„è·ç¦»ï¼ˆå®ƒå¯ä»¥æ˜¯äºŒæ¬¡æ–¹ï¼Œä¸‰æ¬¡æ–¹ï¼Œé€†æ–¹ï¼Œä½†æ˜¯æˆ‘ä»¬å®šä¸ºäºŒæ¬¡æ–¹ï¼‰ã€‚ è¿™è¡Œå¾—é€šï¼Œä½†å”¯ä¸€ä¸é€‚åˆæˆ‘ä»¬çš„æ˜¯æœºå™¨äººæ— æ³•ä»¥æ¯ç§’0.7ç±³ä»¥ä¸Šçš„é€Ÿåº¦åŠæ—¶åˆ¶åŠ¨ã€‚ å› æ­¤ï¼Œå½“æ—¶é—´åˆ°æ¥æ—¶ï¼Œæˆ‘ä»¬å†³å®šé‡å»ºæ•´ä¸ªç®—æ³•ã€‚ <br><br> é€šå¾€æ–°è½¨è¿¹çš„ç¬¬ä¸€ä¸ªè¿­ä»£æ˜¯æ›¿æ¢æˆ‘ä»¬è¦å»çš„å‘é‡ã€‚ ç°åœ¨å®ƒæ˜¯ä¸‹ä¸‰ä¸ªç³»æ•°ä¸åŒçš„å‘é‡çš„æ€»å’Œã€‚ ç¬¬äºŒæ¬¡è¿­ä»£æ˜¯ç¼–å†™æœ€å°æ··è›‹ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œè¿™æ˜¯ç¬¬5æ¬¡å¤šé¡¹å¼çš„æ„é€ ï¼Œå…¶ä¸­xå’Œyåæ ‡å–å†³äºåˆ°è¾¾æ¯ä¸ªç‚¹çš„æ—¶é—´ã€‚ <br><br><img src="https://habrastorage.org/webt/ho/mw/hd/homwhdagbnkgdlrigettcc6yook.png"><br>  <i>è¯¥å›¾æ˜¾ç¤ºäº†åæ ‡ä¹‹ä¸€ä¸æ—¶é—´çš„å…³ç³»å›¾ï¼Œä»¥åŠæ²¿è¯¥åæ ‡çš„é€Ÿåº¦</i> <br><br> è¿™ç§ç±»å‹çš„è½¨è¿¹è°ƒèŠ‚å™¨æ›´é€‚åˆæˆ‘ä»¬ï¼Œå› ä¸ºå®ƒéœ€è¦è¾ƒå°‘çš„æ“ä½œæ¥é€‰æ‹©ä¸åŒçš„ç³»æ•°ï¼Œå› ä¸ºæ‰€æœ‰ç³»æ•°éƒ½æ˜¯å¤šé¡¹å¼ä¸­çš„å€¼ï¼Œè¿™äº›å€¼æ˜¯æ ¹æ®åˆ°è¾¾æ—¶é—´ï¼Œå½“å‰é€Ÿåº¦å’ŒåŠ é€Ÿåº¦ï¼Œè¾“å‡ºé€Ÿåº¦å’ŒåŠ é€Ÿåº¦æ¥è®¡ç®—çš„ã€‚ <br><br> è½¨è¿¹é‡å†™çš„ç»“æœæ˜¯æˆ‘ä»¬è®¾æ³•ä½¿æœºå™¨äººçš„å¹³å‡é€Ÿåº¦æé«˜äº†ä¸€å€ã€‚ <br><br> ä¸å‰ä¸¤ç§æƒ…å†µä¸€æ ·ï¼Œæ‰€æœ‰ä¸»è¦åŠŸèƒ½éƒ½åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­çªå‡ºæ˜¾ç¤ºï¼Œä»¥ä¾¿äºäº¤äº’ã€‚ è¿™æ¬¡ï¼ŒPlannerTrajectoryç±»è´Ÿè´£åŸºäºMinimumJerkæ„é€ è½¨è¿¹ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">State</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> velocity; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> acceleration; State(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span> v_, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> a_) : velocity(v_), acceleration(a_) {} State() { velocity = <span class="hljs-number"><span class="hljs-number">0</span></span>; acceleration = <span class="hljs-number"><span class="hljs-number">0</span></span>; } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlannerTrajectory</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: nav_msgs::Path global_path; cost_map::CostMap *costmap_ptr; geometry_msgs::PoseStamped Goal_pred; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt; trajectory_x; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt; trajectory_y; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> average_velocity = <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Defualt or get from param // double max_velocity = 100; double coef_x[6]; double coef_y[6]; int frequency = 30; // Defualt or get from param // int index; public: PlannerTrajectory(cost_map::CostMap *costmap_, const int &amp;frequency_, const double &amp;max_velocity_, const double &amp;average_velocity_) { average_velocity = average_velocity;; max_velocity = max_velocity_; costmap_ptr = costmap_; frequency = frequency_; Goal_pred.pose.position.x = 0.0; Goal_pred.pose.position.y = 0.0; }</span></span></code> </pre> <br>  <i>ç…§ç‰‡æ˜¾ç¤ºäº†æˆ‘ä»¬ä½¿ç”¨çš„æ‰€æœ‰å·²å£°æ˜çš„å˜é‡ã€‚</i> <br><br> å…¶ä»–æ‰€æœ‰å†…å®¹éƒ½åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ï¼ˆåŒ…æ‹¬/ trajectory_regulator.hï¼‰ä¸­çªå‡ºæ˜¾ç¤ºï¼šä»ä¸»é¢˜æ¥æ”¶ç‚¹ï¼Œç¡®å®šæ˜¯å¦è¦åˆ°è¾¾ä¸‹ä¸€ä¸ªç‚¹ï¼ˆå¦‚æœæœ‰éšœç¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸èµ°ï¼‰ï¼Œç­‰ç­‰ã€‚ <br><br><h3> è¿ç§»åˆ°ROS Melodic </h3><br> ç›´åˆ°å»å¹´ï¼Œæˆ‘ä»¬æ‰ä½¿ç”¨ROSçš„LTEç‰ˆæœ¬-ROS Kineticã€‚ ä»–é€šå¸¸é€‚åˆæˆ‘ä»¬ï¼Œä½†ä»–çš„æ”¯æŒå°†åœ¨æ˜å¹´ç»“æŸï¼Œå¹¶ä¸”æˆ‘ä»¬éœ€è¦çš„è®¸å¤šè½¯ä»¶åŒ…å¼€å§‹ä¸“é—¨é’ˆå¯¹ROS Melodicæä¾›ã€‚ ç„¶åäº‹å®è¯æ˜ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„costmap_serverä¸åœ¨Melodicä¹‹ä¸‹ã€‚ <br><br> å¤„ç†å¡ä¸­çš„æ•°æ®æ—¶å‡ºç°é—®é¢˜ã€‚ <br><br> æˆ‘ä»¬é€‰æ‹©äº†Gridåœ°å›¾ï¼Œå› ä¸ºå †æ ˆæ˜¯ç›¸ä¼¼çš„ï¼Œä½†æ˜¯åœ°å›¾çš„å¼€å¤´åœ¨ä¸åŒçš„ä½ç½®ï¼Œå¹¶ä¸”åœ°å›¾æœ¬èº«çš„å€¼ä»0åˆ°1ä¸ç­‰ã€‚è¿™å·²æˆä¸ºæ•´ä¸ªå¯¼èˆªå †æ ˆä¸­çš„å¤§é—®é¢˜ã€‚ å¦‚æœæ—©äº›æ—¶å€™å…¨å±€è§„åˆ’å™¨æ¯ç§’å¯åŠ¨50æ¬¡ï¼ˆå­˜åœ¨é¢‘ç‡é™åˆ¶ï¼Œå› æ­¤å³ä½¿åœ¨ä¸€ä¸ªçº¿ç¨‹çš„ä¸€åŠä¸­ä¹Ÿä¸ä¼šä½¿ç”¨å¤ªå¤šå¤„ç†å™¨ï¼‰ï¼Œç°åœ¨æ¯ä¸¤ç§’é’Ÿé“ºè·¯å¹¶è®¤ä¸ºå®ƒä¸å¥½ï¼šå®ƒå®Œå…¨åŠ è½½äº†ä¸€ä¸ªå†…æ ¸ã€‚ åœ¨2ç§’å†…ï¼Œæœºå™¨äººå¯ä»¥è¶Šè¿‡æ•´ä¸ªåœ°å›¾ã€‚ è¿™ä¸é€‚åˆæˆ‘ä»¬ï¼Œå¹¶ä¸”å°è¯•å¹¶è¡ŒåŒ–æ­¤è¿‡ç¨‹çš„å°è¯•å‡ä»¥å¤±è´¥å‘Šç»ˆï¼Œå› ä¸ºè¿™æ ·ä¸€æ¥ï¼Œå…¶ä»–é¡¹ç›®å°±æ²¡æœ‰æ€§èƒ½å¯è¨€ï¼ˆè€ƒè™‘åˆ°å¹¶è¡ŒåŒ–çš„æˆæœ¬ï¼‰ã€‚ <br><br> æˆ‘ä»¬å†³å®šå†æ¬¡æ›´æ”¹å †æ ˆï¼Œæ”¾å¼ƒç½‘æ ¼å›¾ï¼Œè½¬è€Œä½¿ç”¨å ç”¨ç½‘æ ¼ã€‚ å‡ºç°äº†ä¸€ä¸ªæ–°é—®é¢˜-æ— æ³•åŒæ—¶å­˜å‚¨å¤šä¸ªç‰ˆæœ¬çš„åœ°å›¾ï¼ˆä¾‹å¦‚ï¼Œå…·æœ‰æ‰€æœ‰éšœç¢çš„å®Œæ•´åœ°å›¾ä»¥åŠä»…å…·æœ‰åŠ¨æ€éšœç¢çš„é™æ€åœ°å›¾ï¼‰ã€‚ æˆ‘å°†ä¸å¾—ä¸æ›´æ”¹ä¸€åŠçš„ä»£ç ï¼Œè¿™å¹¶ä¸æ˜¯ç‰¹åˆ«å¯é ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å†³å®šä¸ºè¯¥é—®é¢˜å¯»æ‰¾æ›¿ä»£è§£å†³æ–¹æ¡ˆã€‚ <br><br><h4> æˆæœ¬å›¾æœåŠ¡å™¨ </h4><br> ç»è¿‡é•¿æ—¶é—´çš„æœç´¢ï¼Œæˆ‘ä»¬å‘ç°äº†åˆ†å‰åœ°å›¾costmap_serverrï¼š <a href="" rel="nofollow">https</a> : <a href="" rel="nofollow">//github.com/lelongg/cost_map.git-</a>å¯¹æˆ‘ä»¬çš„åˆ†å‰ç³»ç»Ÿéå¸¸æœ‰ç”¨ã€‚ <br><br><img src="https://habrastorage.org/webt/27/rb/oh/27rbohj3kefxprwtjqrg4mwtqjc.png"><br><br> ç°åœ¨ï¼Œæˆ‘ä»¬ä¸å†ä»…ä»…ä¸ºæ …æ ¼åœ°å›¾æä¾›æœåŠ¡ï¼Œè€Œæ˜¯ä¸ºäº†äº¤ä»˜ï¼Œæˆ‘ä»¬è®¾æ³•æ ¹æ®å¡å°”æ›¼æ»¤æ³¢å™¨çš„é¢„æµ‹æ¥è®¡ç®—æ•Œäººçš„å¯èƒ½ä½ç½®ã€‚ <br><br><img src="https://habrastorage.org/webt/ni/pm/nz/nipmnzvhcrqdje1cu8glf9quude.png"><br><br> åœ°å›¾æœåŠ¡å™¨æœ€é‡è¦çš„äº‹æƒ…ä¹‹ä¸€å°±æ˜¯åœ°å›¾æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ç”¨äºåˆå§‹åˆ›å»ºæ‰€æœ‰å›¾å±‚ï¼Œéšåä»…å¯¹å…¶è¿›è¡Œæ›´æ–°ã€‚ è¿™æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶pngå›¾ç‰‡ï¼Œå…¶ä¸­é»‘è‰²æ˜¯éšœç¢ç‰©ï¼Œç™½è‰²æ˜¯è‡ªç”±åŒºã€‚ <br><br><img src="https://habrastorage.org/webt/2b/l5/rg/2bl5rgpuecb7he51heslqpvcazm.png"><br><br> è¿˜æœ‰ä¸€ä¸ªç”¨äºcost_map_serveré…ç½®çš„è®¾ç½®æ–‡ä»¶ã€‚ å®ƒåŒ…å«å¸¦æœ‰æ•Œäººè¦ç‚¹ï¼Œé€šè´§è†¨èƒ€åŒºå’Œæ­£æ–¹å½¢å¤§å°çš„ä¸»é¢˜ï¼Œè¿˜å¯ä»¥ç”¨äºåœ¨åœ°å›¾ä¸Šæ”¾ç½®æ•Œäººçš„å±é™©åŒºã€‚ <br><br><pre> <code class="cpp hljs">########################### # cost_map_server params ## ########################### cost_map_server/big_robot_size: <span class="hljs-number"><span class="hljs-number">0.4</span></span> cost_map_server/little_robot_size: <span class="hljs-number"><span class="hljs-number">0.4</span></span> cost_map_server/cube_size: <span class="hljs-number"><span class="hljs-number">0.11</span></span> cost_map_server/inscribed_radius: <span class="hljs-number"><span class="hljs-number">0.25</span></span> cost_map_server/inflation_radius: <span class="hljs-number"><span class="hljs-number">0.25</span></span> cost_map_server/inflation_exponential_rate: <span class="hljs-number"><span class="hljs-number">0.6</span></span> cost_map_server/big_robot1: <span class="hljs-string"><span class="hljs-string">"/aruco/robot1"</span></span> cost_map_server/big_robot2: <span class="hljs-string"><span class="hljs-string">"/aruco/robot2"</span></span> cost_map_server/small_robot1: <span class="hljs-string"><span class="hljs-string">"/aruco/robot3"</span></span> cost_map_server/small_robot2: <span class="hljs-string"><span class="hljs-string">"/aruco/robot4"</span></span> cost_map_server/collision: <span class="hljs-string"><span class="hljs-string">"collision"</span></span> cost_map_server/image_resource_name: <span class="hljs-string"><span class="hljs-string">"$(find cost_map_server)/param/image_resource.yaml"</span></span> cost_map_server/min_diff_points: <span class="hljs-number"><span class="hljs-number">0.01</span></span></code> </pre> <br> ä»…å½“æœ‰äººè®¢é˜…æ‰€æœ‰å›¾å±‚æ—¶ï¼Œæ‰ä¼šå‘å¸ƒæ‰€æœ‰å›¾å±‚ï¼š <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PublishChanges</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ nav_msgs::OccupancyGrid msg; cost_map_msgs::CostMap cost_map_msg; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obstacle_inflation_publisher.getNumSubscribers() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { cost_map::toOccupancyGrid(costmap, <span class="hljs-string"><span class="hljs-string">"obstacle_layer"</span></span>, msg); obstacle_inflation_publisher.publish(msg); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inflation_publisher.getNumSubscribers() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { cost_map::toOccupancyGrid(costmap, <span class="hljs-string"><span class="hljs-string">"inflation_layer"</span></span>, msg); inflation_publisher.publish(msg); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cost_map_publisher.getNumSubscribers() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { cost_map::toMessage(costmap, cost_map_msg); cost_map_publisher.publish(cost_map_msg); } }</code> </pre> <br><h3> åœ¨ç”µè„‘ä¸Šè¿è¡Œ </h3><br> è¦å¯åŠ¨æ•´ä¸ªå †æ ˆï¼Œæ‚¨å¿…é¡»ï¼š <br><br><ul><li> æ”¾ROS </li><li>  roslaunch cost_map_server cost_map_server_alone.launch-å¯åŠ¨åœ°å›¾ </li><li>  roslaunch global_planner global_planner.launch-ä½¿ç”¨å‚æ•°å¯åŠ¨å…¨å±€åˆ¨åºŠ </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rosparamåŠ è½½$ï¼ˆæ‰¾åˆ°local_plannerï¼‰/param/param.yaml </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rosrun local_planner local_planning </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rosrun trajectory_regulator rosjectory_regulator </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rosrun global_plannerç§»åŠ¨å™¨ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç½—æ–¯ä¼¦Â·ç»´å…¹ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ·»åŠ é€šèƒ€å±‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç°åœ¨å‘ä¸»é¢˜/ gp /ç›®æ ‡å‘é€æ¶ˆæ¯ï¼Œæˆ‘ä»¬å°†æœºå™¨äººå‘é€è‡³æ‰€éœ€ä½ç½® </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯åŠ¨æ‰€æœ‰é¡¹ç›®çš„ç»“æœæ˜¯ï¼Œæ‚¨å°†è¿›è¡Œä»¿çœŸä»¥å‡†å¤‡åœ¨è®¡ç®—æœºä¸Šå¯åŠ¨æˆ‘ä»¬çš„å †æ ˆã€‚</font></font><a href="https://github.com/lelongg/cost_map" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¿…è¦çš„å‰å­</font></font></a> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/iRY5WHgAFns" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åˆï¼Œæˆ‘ä»¬éœ€è¦å¯¼èˆªï¼Œä»¥å¸®åŠ©æˆ‘ä»¬çš„æœºå™¨äººåœ¨å…¨å‘è½®ä¸Šç²¾ç¾ï¼Œå¿«é€Ÿï¼Œå‡†ç¡®åœ°è¡Œé©¶ã€‚</font><font style="vertical-align: inherit;">åœ¨æ¯”èµ›çš„å‡†å¤‡è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰ä¸€åªçŒ«å—ä¼¤ï¼Œè€Œä¸”æœºå™¨äººå¾ˆå¸…ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªç±»ä¼¼äºEurobotçš„è½»é‡çº§å¯¼èˆªå †æ ˆï¼Œæˆ‘ä»¬å¯¹æ­¤æ„Ÿåˆ°éå¸¸æ»¡æ„ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œæ­¤å †æ ˆæ¯”æ ‡å‡†å †æ ˆè¦å¥½ï¼Œä½†æ˜¯... </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬çš„ç”µæŠ¥ï¼št.me/SetUpSber </font></font><br> <a href="https://github.com/ristle/EUrobotNavigation" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬æ‰€æœ‰åˆ›é€ åŠ›çš„å­˜å‚¨åº“</font></font></a> <br><br><img src="https://habrastorage.org/webt/98/gl/4m/98gl4mdibk20qgavmhzkbdppu4w.jpeg"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN479636/">https://habr.com/ru/post/zh-CN479636/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN479620/index.html">é€†é€»è¾‘</a></li>
<li><a href="../zh-CN479622/index.html">WavesåŒºå—é“¾ä¸Šçš„åŒ¿åäº¤æ˜“åŸå‹å¦‚ä½•å·¥ä½œ</a></li>
<li><a href="../zh-CN479624/index.html">Postgresä¸“ä¸šå®ªå…µOleg Bartunovå‘Faride Roslovetsä»‹ç»äº†PostgreSQLå’Œä¿„ç½—æ–¯çš„ä¸šåŠ¡</a></li>
<li><a href="../zh-CN479626/index.html">å…±æŒ¯å™¨ï¼Œç‰©ç†å­¦å®¶ä¸çŸ¥é“</a></li>
<li><a href="../zh-CN479630/index.html">äº‰å–å…³æ³¨</a></li>
<li><a href="../zh-CN479642/index.html">è®¾è®¡ç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ˜çš„é£æœºæ—¶æ„šè ¢çš„å†³å®šå¦‚ä½•å¯¼è‡´äº†Macintoshçš„è¯ç”Ÿ</a></li>
<li><a href="../zh-CN479644/index.html">å…³äºç¨‹åºåŒ–çš„ç®€å•è¯æ±‡</a></li>
<li><a href="../zh-CN479646/index.html">ä¸­çº§åç»§ç»­å­¦ä¹ è‹±è¯­çš„ä¸å¥½å»ºè®®æˆ–ç†ç”±</a></li>
<li><a href="../zh-CN479650/index.html">å‰12ä¸ªæœ€æœ‰è¶£çš„ITåŠ¨æ€åŠ¨æ€å›¾è¡¨</a></li>
<li><a href="../zh-CN479654/index.html">Django Vueç”Ÿæˆå™¨</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>