<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title> 凤  C贸mo hacer una muleta para sus propias inversiones de Tinkoff o notificaciones de acci贸n requeridas para tomar ganancias / detener p茅rdidas   </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Existe un corredor de ese tipo: Tinkoff Bank. Y hay un problema en el hecho de que en este momento este corredor no tiene 贸rdenes de tomar ganancias /...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C贸mo hacer una muleta para sus propias inversiones de Tinkoff o notificaciones de acci贸n requeridas para tomar ganancias / detener p茅rdidas</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442734/"> Existe un corredor de ese tipo: Tinkoff Bank.  Y hay un problema en el hecho de que en este momento este corredor no tiene 贸rdenes de tomar ganancias / detener p茅rdidas.  Por lo tanto, si desea comerciar m谩s activamente, entonces necesita crear alg煤n tipo de soluci贸n temporal, mientras que en las profundidades de los programadores de Tinkoff se desarrolla una caracter铆stica asesina para tomar ganancias / detener p茅rdidas, y debajo del corte es una de ellas. <br>  <b>actualizaci贸n:</b> 22/03/2019, El corredor lanz贸 la versi贸n principal 3.0.0 en Google Play, en la que todav铆a aparec铆a tomar ganancias / detener p茅rdidas. <br><a name="habracut"></a><br>  驴Por qu茅 decid铆 escribir este art铆culo aqu铆?  Me pareci贸 que Tinkoff Bank y sus productos son bastante populares entre las personas de TI, y tal vez alguien tiene la misma necesidad, pero no hay deseo ni tiempo para montar una bicicleta.  Por lo tanto, comparto mi. <br><br>  Para empezar, acerca de las oportunidades alternativas proporcionadas por el corredor mismo. <br>  Primero, Tinkoff tiene 贸rdenes limitadas que aparecieron en febrero de 2019 (隆esperaron dos a帽os, no es broma!), Pero funcionan dentro de un d铆a y, lo que es peor, en un peque帽o intervalo de dinero, lo que crea inconvenientes en el vol谩til mercado.  Es simplemente imposible establecer valores menores (m谩s) que un cierto umbral calculado a partir de las cotizaciones actuales.  Bueno, probablemente sea imposible solicitar m谩s de una orden de l铆mite (cuando trato de guardar la primera orden, la aplicaci贸n m贸vil siempre falla, pero el sitio no tiene esa funcionalidad). <br>  En segundo lugar, dentro de su aplicaci贸n m贸vil, puede suscribirse a un cambio de precio estableciendo un umbral absoluto o umbral para un cambio porcentual (aumento o disminuci贸n), pero puede establecer uno y solo un umbral por activo. <br><br>  La l贸gica de mi bicicleta es simple: <br>  1) tenemos umbrales (en adelante, umbrales) para nuestra seguridad (activo), en los cuales debemos tener una acci贸n de toma de ganancias / stop loss manual.  Los umbrales se calculan de forma independiente, en funci贸n del precio de compra del activo; <br>  2) necesitamos analizar los datos del precio actual del activo desde alg煤n lugar; <br>  3) env铆ese un aviso si se ha alcanzado uno de los umbrales. <br>  A pesar de la descripci贸n directa, hay matices en la implementaci贸n :) <br><br>  1) Si bien mi cartera constaba de un activo, establec铆 umbrales directamente en el cuerpo del gui贸n, y la b煤squeda en papel no se hizo ni siquiera una variable, sino simplemente una l铆nea m谩gica.  Mala decisi贸n, pero suficiente para probar la idea.  A medida que la cartera se diversific贸, hice un archivo donde se cargan los valores, los intercambios en los que se negocian y los valores umbral. <br><br>  2) Dado que mi activo era una seguridad extranjera que cotiza en la Bolsa de San Petersburgo, primero decid铆 analizar los datos del sitio web de la Bolsa de San Petersburgo desde la siguiente p谩gina: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">spbexchange.ru/ru/market-data/Default.aspx</a> <br>  La clasificaci贸n en la Bolsa de Valores de San Petersburgo se realiza de acuerdo con el volumen de negociaci贸n, y mi seguridad siempre estuvo en la primera p谩gina.  Funcion贸 muy bien, pero el 8 de marzo todo se rompi贸.  Por alguna raz贸n, TSLA ya estaba en la p谩gina 25, y su paginador carga los datos din谩micamente a trav茅s de JS.  Este problema se puede resolver "de frente": analizando todas las p谩ginas hasta que encontremos nuestro activo.  Pero este enfoque no es muy efectivo si consideramos el tiempo de ejecuci贸n del bucle de script.  En cambio, decid铆 agregar el an谩lisis de tradingview.com.  No hay necesidad de palear largas listas en m谩s p谩ginas.  All铆, cada activo tiene algo como este enlace: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.tradingview.com/symbols/NASDAQ-TSLA</a> <br>  Me pareci贸 que todo deber铆a comenzar de forma r谩pida y sencilla, pero hab铆a un problema: los datos que me interesan se cargan a trav茅s de JS y las solicitudes habituales no pod铆an hacer frente. <br>  Este problema tiene tres soluciones que conozco: <br>  PyQT, selenium (webdriver) y la extensi贸n Requests-HTML.  Como ya ten铆a Solicitudes en el proyecto, se decidi贸 usar su propia extensi贸n. <br>  Desafortunadamente, esta soluci贸n no funcion贸 muy estable, tuve que buscar soluciones. <br><pre><code class="python hljs">session = HTMLSession() r = session.get(url) my = r.html.render(timeout=<span class="hljs-number"><span class="hljs-number">30</span></span>) selector = <span class="hljs-string"><span class="hljs-string">'span.tv-symbol-header-quote__value.tv-symbol-header-quote__value--large.js-symbol-last'</span></span> price = r.html.find(selector)[<span class="hljs-number"><span class="hljs-number">0</span></span>].text r.close() session.close()</code> </pre> <br>  Tenga en cuenta el tiempo de espera, as铆 como las llamadas al m茅todo close ().  No se encuentran en todos los ejemplos, pero funciona mejor con ellos que sin ellos. <br><br>  3) Nos registramos en un servicio que puede enviar SMS (sms.ru), tomar su API, crear una clave.  Hasta 5 SMS por d铆a, sin cargo.  Suficiente para mi <br>  La clave se ve as铆: <br>  24A41EA5-EEEE-Priv-5555-094143C2EDDD <br>  y el env铆o de SMS en las primeras versiones se implement贸 as铆: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mymessage)</span></span></span><span class="hljs-function">:</span></span> sms_url = <span class="hljs-string"><span class="hljs-string">'https://sms.ru/sms/send?api_id=key&amp;to=number&amp;msg=message&amp;json=1'</span></span> sms_url = sms_url.replace(<span class="hljs-string"><span class="hljs-string">'key'</span></span>, mykey) sms_url = sms_url.replace(<span class="hljs-string"><span class="hljs-string">'number'</span></span>, mynumber) sms_url = sms_url.replace(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, mymessage) sms_response = requests.get(sms_url)</code> </pre> <br><br>  Durante el desarrollo, surgi贸 la siguiente pregunta: 驴qu茅 hacer si ya hemos enviado un SMS al usuario acerca de cruzar el umbral?  Si bien no hubo controles, envi贸 SMS nuevamente.  Todo el tiempo  R谩pidamente "comi贸" el l铆mite libre y comenz贸 a pensar qu茅 hacer con 茅l.  Tuve que agregar un contador de SMS enviados (sms_counter), que verificamos antes de llamar a send_message. <br><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> sms_counter sms_counter = sms_counter + <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><br>  Se seguir谩 otra pregunta: excelente, durante la sesi贸n de negociaci贸n procesamos un cruce de umbral con un determinado activo, y esto nos conviene.  驴Qu茅 hacer para la pr贸xima sesi贸n de negociaci贸n?  Se decidi贸 restablecer el contador de SMS enviados.  Hab铆a tres opciones: almacenar datos en la base de datos (pero actualmente tengo una aplicaci贸n sin estado), analizar hora / fecha o reiniciar el script.  Hasta ahora estoy haciendo la tercera opci贸n, pero en el futuro pasar茅 a la segunda o primera opci贸n. <br><br>  Ahora la soluci贸n ya est谩 operativa y se puede descargar desde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Github</a> <br>  Para los usuarios que no entienden qu茅 es Python y c贸mo configurarlo, sugiero intentar lanzar una <a href="">soluci贸n</a> empaquetada <a href="">para Windows</a> <br><br>  Planes para un mayor desarrollo: <br>  1) analizar fecha / hora, para restablecer el contador de SMS (en lugar de reiniciar el script); <br>  2) ahora es una aplicaci贸n sin estado, pero tengo la intenci贸n de atornillar la base de datos; <br>  3) despu茅s del 铆tem 2, quiero agregar el seguimiento de saltos bruscos en el aumento / disminuci贸n del precio, en relaci贸n con el precio de cierre del d铆a anterior; <br>  4) ampliar las oportunidades de "comunicaci贸n": m谩s rutas (Telegram, Viber, llamadas de voz, otras opciones) y proveedores (tengo la intenci贸n de agregar smsc.ru, ya que sms.ru a veces pierde capacidad de respuesta, y aunque env铆a SMS, pero el script no se ejecuta m谩s hasta que obtengamos sms_response). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/442734/">https://habr.com/ru/post/442734/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442722/index.html">Dejar de descargar y almacenar ceros</a></li>
<li><a href="../442724/index.html">La pel铆cula "Office Space" tiene 20 a帽os: c贸mo cambi贸 nuestros trabajos</a></li>
<li><a href="../442726/index.html">El robot MIT Cheetah puede hacer volteretas y correr r谩pido</a></li>
<li><a href="../442730/index.html">Microsoft: Rusia est谩 por delante de Estados Unidos y Europa en la implementaci贸n de inteligencia artificial</a></li>
<li><a href="../442732/index.html">My Little Relays: Triple Brainfuck, o 驴Qu茅 es la locura?</a></li>
<li><a href="../442736/index.html">6 juegos de mesa para nivelar ingl茅s</a></li>
<li><a href="../442738/index.html">Perfilado y trazado con perf</a></li>
<li><a href="../442740/index.html">Ingenier铆a inversa de formato binario utilizando archivos Korg SNG como ejemplo. Parte 2</a></li>
<li><a href="../442742/index.html">Computadora port谩til Compaq LTE 5000, parte dos y media: bonificaci贸n</a></li>
<li><a href="../442744/index.html">Soluci贸n RIPE y sus consecuencias para la exclusi贸n de dos LIR rusos (Netup, gcxc.net)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>