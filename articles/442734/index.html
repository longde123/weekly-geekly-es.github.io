<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💥 ⛷️ 🎉 Cómo hacer una muleta para sus propias inversiones de Tinkoff o notificaciones de acción requeridas para tomar ganancias / detener pérdidas 🌋 🎊 🛌🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Existe un corredor de ese tipo: Tinkoff Bank. Y hay un problema en el hecho de que en este momento este corredor no tiene órdenes de tomar ganancias /...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cómo hacer una muleta para sus propias inversiones de Tinkoff o notificaciones de acción requeridas para tomar ganancias / detener pérdidas</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442734/"> Existe un corredor de ese tipo: Tinkoff Bank.  Y hay un problema en el hecho de que en este momento este corredor no tiene órdenes de tomar ganancias / detener pérdidas.  Por lo tanto, si desea comerciar más activamente, entonces necesita crear algún tipo de solución temporal, mientras que en las profundidades de los programadores de Tinkoff se desarrolla una característica asesina para tomar ganancias / detener pérdidas, y debajo del corte es una de ellas. <br>  <b>actualización:</b> 22/03/2019, El corredor lanzó la versión principal 3.0.0 en Google Play, en la que todavía aparecía tomar ganancias / detener pérdidas. <br><a name="habracut"></a><br>  ¿Por qué decidí escribir este artículo aquí?  Me pareció que Tinkoff Bank y sus productos son bastante populares entre las personas de TI, y tal vez alguien tiene la misma necesidad, pero no hay deseo ni tiempo para montar una bicicleta.  Por lo tanto, comparto mi. <br><br>  Para empezar, acerca de las oportunidades alternativas proporcionadas por el corredor mismo. <br>  Primero, Tinkoff tiene órdenes limitadas que aparecieron en febrero de 2019 (¡esperaron dos años, no es broma!), Pero funcionan dentro de un día y, lo que es peor, en un pequeño intervalo de dinero, lo que crea inconvenientes en el volátil mercado.  Es simplemente imposible establecer valores menores (más) que un cierto umbral calculado a partir de las cotizaciones actuales.  Bueno, probablemente sea imposible solicitar más de una orden de límite (cuando trato de guardar la primera orden, la aplicación móvil siempre falla, pero el sitio no tiene esa funcionalidad). <br>  En segundo lugar, dentro de su aplicación móvil, puede suscribirse a un cambio de precio estableciendo un umbral absoluto o umbral para un cambio porcentual (aumento o disminución), pero puede establecer uno y solo un umbral por activo. <br><br>  La lógica de mi bicicleta es simple: <br>  1) tenemos umbrales (en adelante, umbrales) para nuestra seguridad (activo), en los cuales debemos tener una acción de toma de ganancias / stop loss manual.  Los umbrales se calculan de forma independiente, en función del precio de compra del activo; <br>  2) necesitamos analizar los datos del precio actual del activo desde algún lugar; <br>  3) envíese un aviso si se ha alcanzado uno de los umbrales. <br>  A pesar de la descripción directa, hay matices en la implementación :) <br><br>  1) Si bien mi cartera constaba de un activo, establecí umbrales directamente en el cuerpo del guión, y la búsqueda en papel no se hizo ni siquiera una variable, sino simplemente una línea mágica.  Mala decisión, pero suficiente para probar la idea.  A medida que la cartera se diversificó, hice un archivo donde se cargan los valores, los intercambios en los que se negocian y los valores umbral. <br><br>  2) Dado que mi activo era una seguridad extranjera que cotiza en la Bolsa de San Petersburgo, primero decidí analizar los datos del sitio web de la Bolsa de San Petersburgo desde la siguiente página: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">spbexchange.ru/ru/market-data/Default.aspx</a> <br>  La clasificación en la Bolsa de Valores de San Petersburgo se realiza de acuerdo con el volumen de negociación, y mi seguridad siempre estuvo en la primera página.  Funcionó muy bien, pero el 8 de marzo todo se rompió.  Por alguna razón, TSLA ya estaba en la página 25, y su paginador carga los datos dinámicamente a través de JS.  Este problema se puede resolver "de frente": analizando todas las páginas hasta que encontremos nuestro activo.  Pero este enfoque no es muy efectivo si consideramos el tiempo de ejecución del bucle de script.  En cambio, decidí agregar el análisis de tradingview.com.  No hay necesidad de palear largas listas en más páginas.  Allí, cada activo tiene algo como este enlace: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.tradingview.com/symbols/NASDAQ-TSLA</a> <br>  Me pareció que todo debería comenzar de forma rápida y sencilla, pero había un problema: los datos que me interesan se cargan a través de JS y las solicitudes habituales no podían hacer frente. <br>  Este problema tiene tres soluciones que conozco: <br>  PyQT, selenium (webdriver) y la extensión Requests-HTML.  Como ya tenía Solicitudes en el proyecto, se decidió usar su propia extensión. <br>  Desafortunadamente, esta solución no funcionó muy estable, tuve que buscar soluciones. <br><pre><code class="python hljs">session = HTMLSession() r = session.get(url) my = r.html.render(timeout=<span class="hljs-number"><span class="hljs-number">30</span></span>) selector = <span class="hljs-string"><span class="hljs-string">'span.tv-symbol-header-quote__value.tv-symbol-header-quote__value--large.js-symbol-last'</span></span> price = r.html.find(selector)[<span class="hljs-number"><span class="hljs-number">0</span></span>].text r.close() session.close()</code> </pre> <br>  Tenga en cuenta el tiempo de espera, así como las llamadas al método close ().  No se encuentran en todos los ejemplos, pero funciona mejor con ellos que sin ellos. <br><br>  3) Nos registramos en un servicio que puede enviar SMS (sms.ru), tomar su API, crear una clave.  Hasta 5 SMS por día, sin cargo.  Suficiente para mi <br>  La clave se ve así: <br>  24A41EA5-EEEE-Priv-5555-094143C2EDDD <br>  y el envío de SMS en las primeras versiones se implementó así: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mymessage)</span></span></span><span class="hljs-function">:</span></span> sms_url = <span class="hljs-string"><span class="hljs-string">'https://sms.ru/sms/send?api_id=key&amp;to=number&amp;msg=message&amp;json=1'</span></span> sms_url = sms_url.replace(<span class="hljs-string"><span class="hljs-string">'key'</span></span>, mykey) sms_url = sms_url.replace(<span class="hljs-string"><span class="hljs-string">'number'</span></span>, mynumber) sms_url = sms_url.replace(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, mymessage) sms_response = requests.get(sms_url)</code> </pre> <br><br>  Durante el desarrollo, surgió la siguiente pregunta: ¿qué hacer si ya hemos enviado un SMS al usuario acerca de cruzar el umbral?  Si bien no hubo controles, envió SMS nuevamente.  Todo el tiempo  Rápidamente "comió" el límite libre y comenzó a pensar qué hacer con él.  Tuve que agregar un contador de SMS enviados (sms_counter), que verificamos antes de llamar a send_message. <br><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> sms_counter sms_counter = sms_counter + <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><br>  Se seguirá otra pregunta: excelente, durante la sesión de negociación procesamos un cruce de umbral con un determinado activo, y esto nos conviene.  ¿Qué hacer para la próxima sesión de negociación?  Se decidió restablecer el contador de SMS enviados.  Había tres opciones: almacenar datos en la base de datos (pero actualmente tengo una aplicación sin estado), analizar hora / fecha o reiniciar el script.  Hasta ahora estoy haciendo la tercera opción, pero en el futuro pasaré a la segunda o primera opción. <br><br>  Ahora la solución ya está operativa y se puede descargar desde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Github</a> <br>  Para los usuarios que no entienden qué es Python y cómo configurarlo, sugiero intentar lanzar una <a href="">solución</a> empaquetada <a href="">para Windows</a> <br><br>  Planes para un mayor desarrollo: <br>  1) analizar fecha / hora, para restablecer el contador de SMS (en lugar de reiniciar el script); <br>  2) ahora es una aplicación sin estado, pero tengo la intención de atornillar la base de datos; <br>  3) después del ítem 2, quiero agregar el seguimiento de saltos bruscos en el aumento / disminución del precio, en relación con el precio de cierre del día anterior; <br>  4) ampliar las oportunidades de "comunicación": más rutas (Telegram, Viber, llamadas de voz, otras opciones) y proveedores (tengo la intención de agregar smsc.ru, ya que sms.ru a veces pierde capacidad de respuesta, y aunque envía SMS, pero el script no se ejecuta más hasta que obtengamos sms_response). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/442734/">https://habr.com/ru/post/442734/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442722/index.html">Dejar de descargar y almacenar ceros</a></li>
<li><a href="../442724/index.html">La película "Office Space" tiene 20 años: cómo cambió nuestros trabajos</a></li>
<li><a href="../442726/index.html">El robot MIT Cheetah puede hacer volteretas y correr rápido</a></li>
<li><a href="../442730/index.html">Microsoft: Rusia está por delante de Estados Unidos y Europa en la implementación de inteligencia artificial</a></li>
<li><a href="../442732/index.html">My Little Relays: Triple Brainfuck, o ¿Qué es la locura?</a></li>
<li><a href="../442736/index.html">6 juegos de mesa para nivelar inglés</a></li>
<li><a href="../442738/index.html">Perfilado y trazado con perf</a></li>
<li><a href="../442740/index.html">Ingeniería inversa de formato binario utilizando archivos Korg SNG como ejemplo. Parte 2</a></li>
<li><a href="../442742/index.html">Computadora portátil Compaq LTE 5000, parte dos y media: bonificación</a></li>
<li><a href="../442744/index.html">Solución RIPE y sus consecuencias para la exclusión de dos LIR rusos (Netup, gcxc.net)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>