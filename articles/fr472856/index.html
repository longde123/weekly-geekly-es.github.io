<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåï üë®üèΩ‚Äçüé® üëó Comment j'ai cr√©√© un service de contr√¥le qualit√© √† partir de tables et de b√¢tons üêè üö¥üèº üßôüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! Souvent, lorsqu'ils envisagent de lancer un pilote, les gestionnaires commencent √† compliquer la situation, √† cr√©er des feuilles de rou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment j'ai cr√©√© un service de contr√¥le qualit√© √† partir de tables et de b√¢tons</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dodopizzadev/blog/472856/">  Bonjour, Habr!  Souvent, lorsqu'ils envisagent de lancer un pilote, les gestionnaires commencent √† compliquer la situation, √† cr√©er des feuilles de route et √† attendre le MVP des d√©veloppeurs, au lieu de prendre et de tester l'id√©e par eux-m√™mes.  Sous la coupe, je veux partager l'histoire de la cr√©ation d'un service de contr√¥le de qualit√© bas√© sur les formulaires Google, VK et des dizaines de lignes de code, dans lequel aucun d√©veloppeur n'a √©t√© bless√©, seulement 1 agent de commercialisation. <br><br><img src="https://habrastorage.org/webt/z0/h1/0h/z0h10hxua4cagzjcovtbf5t8oja.png"><br><a name="habracut"></a><br><blockquote>  <b>Avertissement</b> : dans cet article, j'attends des exemples de code qui vous poseront des questions, des doutes, peut-√™tre m√™me des larmes sanglantes et la c√©cit√©.  Pour le justifier, il n'y a qu'une seule chose √† dire - ce code a fonctionn√© comme Papa Carlo, et a rempli sa mission √† 100%, et certains scripts fonctionnent toujours. </blockquote><h2>  √âvaluation du First Dodo Pizzeria </h2><br>  L'un des grands principes de notre entreprise - <b>celui qui ne peut pas √™tre mesur√©, n'existe pas</b> .  La pizza existe, ce qui signifie que vous devez en quelque sorte √©valuer sa qualit√©. <br><br>  Tout a commenc√© en 2013.  A cette √©poque, il y avait 7 pizzerias sur le r√©seau.  Puis, √† Dodo, ils ont d√©cid√© de lancer un projet de contr√¥le de la qualit√© et des normes des produits - une note de pizzerias ouverte √† tous les partenaires. <br><br>  Il ressemblait √† √ßa. <br><br><img src="https://habrastorage.org/webt/c9/rq/qj/c9rqqjnm6lxlqahi13lral5y7ni.png"><br><br>  Les donn√©es ont √©t√© tir√©es des appels des clients, des avis sur le social.  r√©seaux et un peu de Dodo IS (notre syst√®me d'information). <br><br>  Un plus √©vident √† cette √©poque - la notation a commenc√© √† pousser les pizzerias √† g√©rer la qualit√© pour √™tre au top. <br><br><h2>  Pizzerias Second Mystery Shop </h2><br>  Environ un an plus tard, nous avons r√©alis√© que nous devions √©valuer le produit lui-m√™me et avons pris le fameux mod√®le - ¬´mystery shoppers¬ª.  √Ä ce moment, nous avons fait une perc√©e - le premier en Russie a d√©cid√© que nos clients seraient les acheteurs myst√®res. <br><br><h4>  L'√©mergence d'un groupe ferm√© VK </h4><br>  Au d√©part, nous avons d√©couvert comment ils travaillent avec les clients myst√®res dans les agences qui fournissent de tels services.  Il s'est av√©r√© qu'ils communiquaient par e-mail ou appelaient directement pour proposer une v√©rification. <br><br>  Cette option ne nous a pas imm√©diatement s√©duits.  Nous n'allions certainement pas appeler, car pour nous, c'√©tait long, mais pour un client, c'√©tait douloureux et comparable au spam.  Le courrier √©tait utilis√© pour les envois de masse, mais il a √©t√© rapidement abandonn√©. <br><br>  Nous avons trouv√©: <br><br><ol><li>  Pour la communication avec les agents secrets et la coordination des contr√¥les, ils ont utilis√© la page habituelle en VK. </li><li>  Pour collecter des reportages photo, ils ont cr√©√© un groupe √† VK avec un mur ouvert. </li><li>  Et pour les enqu√™tes de service, nous avons choisi les formulaires Google.  Quoi?  Id√©alement, vous n'avez pas besoin de couper un service distinct, et il est bien affich√© sur le t√©l√©phone mobile. </li><li>  Toutes les instructions √©taient dans Google Docs. </li></ol><br>  Tout est √† genoux.  Tout est comme il se doit pour une startup. <br><br><img src="https://habrastorage.org/webt/0x/bu/2u/0xbu2ung5j6no9ltwyi_re80aqe.jpeg"><br>  <i>Photo d'un client myst√®re.</i>  <i>Oui, ils ont mesur√© la largeur avec une r√®gle, ont coup√© le bord de la pizza pour montrer la cuisson et la qualit√© de la p√¢te.</i> <br><br><div class="spoiler">  <b class="spoiler_title">Plus d'exemples de reportages photo de 2015 sont ici.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/-v/fx/nh/-vfxnheu2wvm1gxfcc2epiwqyxw.jpeg"><br><img src="https://habrastorage.org/webt/zd/kk/d0/zdkkd0crvk0xqgdidv9roxanw_c.jpeg"><br><img src="https://habrastorage.org/webt/qk/co/fz/qkcofzsjt7iz2qm0czous0dw84o.jpeg"><br><img src="https://habrastorage.org/webt/ca/zq/5a/cazq5atxyea8vjvdtmprmwnstly.jpeg"><br></div></div><br>  La note changeait constamment, de nouveaux crit√®res d'√©valuation ont √©t√© ajout√©s.  Par exemple, il s'agit de 131 points pour l'√©valuation de la pizzeria Abakan-1. <br><br><img src="https://habrastorage.org/webt/x9/6c/lj/x96cljo2g-fkxgmsrbbqy8_bcxe.gif"><br><br>  L'enfer du processus √©tait que toutes les violations des points √©taient not√©es manuellement, pas d'automatisation.  Et tout cela a √©t√© fait par un employ√©. <br><br><h4>  La magie des feuilles de calcul Google </h4><br>  En 2016, nous avons appris (m√ªri) que l'humanit√© a longtemps invent√© des fonctions autres que = SUM.  Et ce qui peut √™tre fait en utilisant des scripts et des fonctions d'importation de donn√©es entre les tables ... Construction CRM directe. <br><br>  Par exemple, pour √©valuer chaque pizzeria dans le tableau √©tait une feuille, et en elle les crit√®res d'√©valuation et les scores.  1 pizzeria = 1 feuille.  Plus il y a de pizzerias, plus il y a de feuilles.  Chaque semaine, un nouveau signe.  En appuyant sur le bouton magique, la feuille de mod√®le dans le tableau a √©t√© d√©velopp√©e en 120 feuilles.  Wah, comme c'est bon! <br><br><img src="https://habrastorage.org/webt/k-/s9/fv/k-s9fvqwy1wnaomulahpgn7a7no.gif"><br><br>  Cette √©tape de l'automatisation ¬´Dodo Controlling¬ª a dur√© environ six mois.  Nous avons progress√© pas √† pas: nous avons appris quelque chose de nouveau - mis en ≈ìuvre, nous avons appris quelque chose d'autre de nouveau - introduit √† nouveau. <br><br><h2>  La limitation comme moteur de progr√®s </h2><br>  D√®s le d√©but, nous avons parl√© avec des acheteurs myst√®res au nom d'un compte personnel dans VK.  Et puis est venu le jour o√π nous avons √©t√© confront√©s √† des probl√®mes insolubles de pages personnelles: <br><br><ul><li>  il y a une limite de 10 000 amis; </li><li>  Il y a une limite √† l'envoi de messages: parfois nous ne pouvions pas envoyer de messages, parce que VK nous bloquait avec la formulation ¬´vous avez envoy√© trop de messages, venez demain¬ª. </li></ul><br>  Habituellement, VK a bloqu√© l'envoi de messages vers 16h00.  C'√©tait une happy hour o√π l'√©quipe pouvait se reposer. <br><br>  Peu √† peu, nous avons rencontr√© presque toutes les limites du VK et avons presque r√©ussi √† cesser d'aimer ce site.  Mais un miracle s'est produit et VK a donn√© aux groupes la possibilit√© de connecter des widgets de messages, des robots de discussion et d'autres goodies. <br><br>  En fait, cette possibilit√© √©tait ant√©rieure √† d√©cembre 2016, mais avec une limitation critique pour nous: le groupe ne pouvait r√©pondre au message que dans les 10 jours suivant l'envoi du dernier message du client.  Lorsqu'ils ont supprim√© cette restriction, la vie de notre √©quipe a commenc√© √† briller de nouvelles couleurs.  Depuis lors, nous avons commenc√© la voie de l'automatisation √† l'aide de l'API VK et des feuilles de calcul Google. <br><br><h2>  Peur et d√©go√ªt dans un script utilisateur </h2><br>  Au d√©part, pour devenir un client myst√®re, vous deviez remplir un formulaire, puis postuler au groupe, nous √©crire un mot de code et attendre que nous r√©pondions.  Cette attente peut durer jusqu'√† 48 heures.  Elle a √©t√© ind√©cemment longue et le d√©sir de proc√©der √† des v√©rifications apr√®s cet enregistrement s'est estomp√©. <br><br>  Avec un nouveau magasin de connaissances, nous avons commenc√© √† automatiser l'enregistrement. <br><br>  Nous avions plusieurs m√©thodes API, un formulaire, plusieurs dizaines de tableaux, une page de destination, un bot en PHP, des scripts dans le tableau qui ont √©t√© √©crits par le marketing le plus cool Dodo et le premier directeur financier de Dodo en une seule personne, des dizaines de mod√®les de messages pour diff√©rentes situations.  Ensuite, je ne savais m√™me pas que cela s'appelait un script utilisateur: <br><br><ol><li>  Le client myst√®re a rempli un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">questionnaire</a> (il s'agit d'une version obsol√®te et maintenant elle ne fonctionne plus). </li><li>  Les donn√©es du formulaire sont tomb√©es d'abord dans la base de donn√©es, puis dans le tableau.  Le bot a d'abord frapp√© la base de donn√©es pour v√©rifier les donn√©es sur le profil, car le d√©lai de r√©ponse de la plaque en dizaines de milliers de lignes √©tait important, et la base de donn√©es la dig√©rait facilement). </li><li>  Apr√®s avoir rempli le questionnaire dans le formulaire, un message est apparu √† l'√©cran: ¬´Merci, il reste √† rejoindre le groupe (lien) et √† √©crire le mot de code¬´ Sherlock ¬ª¬ª. </li><li>  Ensuite, le client myst√®re a envoy√© une demande pour rejoindre le groupe et a √©crit le mot de code "Sherlock".  Le mot a √©t√© le d√©clencheur pour ex√©cuter le script de validation: <br>  - une demande a √©t√© envoy√©e √† la base de donn√©es pour savoir si l'agent nous convient selon l'√¢ge; <br>  - si oui, alors la personne a √©t√© ajout√©e aux groupes, et dans le tableau en face du questionnaire du candidat, le statut ¬´ok / not ok¬ª a √©t√© not√©; <br>  - Plus de donn√©es ont √©t√© peintes en couleur turquoise et c'√©tait important.  Donc, avec mes yeux, il √©tait plus facile de comprendre qui nous convient et avec qui nous pouvons parler.  Le script a peint des profils rouges inappropri√©s; <br>  - puis l'acheteur secret a √©t√© automatiquement accept√© dans le groupe, et un message a √©t√© envoy√© au chat avec d'autres √©tapes et instructions. </li></ol><br><img src="https://habrastorage.org/webt/so/ty/se/sotysezhht_urug1ax9cnrvc9-g.png"><br><br>  Telle est l'automatisation de l'enregistrement.  Maintenant, toute la proc√©dure est devenue presque simple et compr√©hensible. <br><br>  De plus, tout s'est pass√© comme sur des roulettes.  Il est devenu clair que nous pouvons envoyer des messages via des tables directement √† PM √† des agents secrets via des messages de groupe. <br><br><img src="https://habrastorage.org/webt/zn/px/nd/znpxndqiyuxkqp0y6mnhov7fooc.gif"><br><br>  Et vous n'aviez que 46 lignes de code! <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> range = SpreadsheetApp.getActiveSpreadsheet().getActiveRange(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ss = range.getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> carray = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> marray = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> iarray = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>).getValues(); ss.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r, i</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tt = range.getRowIndex(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = tt + i; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> check = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet().getRange(<span class="hljs-string"><span class="hljs-string">'L'</span></span> + add).getValue(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (check != <span class="hljs-string"><span class="hljs-string">''</span></span>) { SpreadsheetApp.getActiveSpreadsheet().getActiveSheet().getRange(<span class="hljs-string"><span class="hljs-string">'K'</span></span> + add).setValue(<span class="hljs-string"><span class="hljs-string">""</span></span>).setBackground(<span class="hljs-string"><span class="hljs-string">"#ffff00"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> payload = { <span class="hljs-string"><span class="hljs-string">"message"</span></span> : marray[i][<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">"user_id"</span></span> : r[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">"access_token"</span></span> : <span class="hljs-string"><span class="hljs-string">"    "</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span> : <span class="hljs-string"><span class="hljs-string">"5.74"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> options = { <span class="hljs-comment"><span class="hljs-comment">//   http- "method" : "post", "header" : "Content-type: application/x-www-form-urlencoded", "payload" : payload, "muteHttpExceptions" : true, }; var jsonData = JSON.parse(UrlFetchApp.fetch("https://api.vk.com/method/messages.send", options).getContentText()); if (jsonData['error'] != undefined) { SpreadsheetApp.getActiveSpreadsheet().getActiveSheet().getRange('K' + add).setValue("").setBackground("#ff0000"); } Logger.log(jsonData); var log = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Log'); var int = log.getRange('A1').getValue(); var d = new Date(); log.getRange('B' + int).setValue(d); log.getRange('C' + int).setValue(r[0] + ""); log.getRange('A1').setValue(int + 1); Utilities.sleep(400); }); }</span></span></code> </pre> <br>  Dans les tableaux, nous avons g√©n√©r√© le texte des messages et cr√©√© un mailing personnalis√© en utilisant la page d'identification.  Nous avons √©galement cess√© de copier et d'envoyer des messages manuellement.  Aux heures de pointe, nous pouvions envoyer jusqu'√† 3000 messages en 45 minutes √† l'aide de tableaux.  Si nous le faisions √† la main, je n'√©crirais pas cet article, mais continuerais √† envoyer des messages. <br><br>  Ensuite, je donne un exemple d'une telle tablette miracle.  J'ai essay√© tr√®s fort de cr√©er une UX / UI claire et fonctionnelle.  En cliquant sur le bouton rouge, une liste de diffusion a √©t√© lanc√©e avec une proposition de proc√©der √† un contr√¥le secret. <br><br><img src="https://habrastorage.org/webt/ht/be/ix/htbeixa27tdtlix28xnzhsmh6xg.png"><br><br><h2>  Plus de fonctionnalit√©s pour automatiser les processus infernaux </h2><br>  La soci√©t√© dispose de nombreux formulaires Google qui nous aident √† collecter r√©guli√®rement des statistiques sur les pizzerias.  Chaque formulaire contient une liste de pizzerias qui doivent √™tre tenues √† jour.  Il existe au total 53 formulaires de ce type, chacun d'entre eux a √©t√© mis √† jour manuellement auparavant. <br><br>  Un peu fatigu√©s de ce travail, nous avons r√©alis√© que cette entreprise pouvait √™tre automatis√©e.  Je me suis de nouveau tourn√© vers notre responsable marketing, apr√®s une heure ou deux, tout √©tait pr√™t et seulement 47 lignes de code. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myFunction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ss = SpreadsheetApp.getActiveSpreadsheet(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> range = ss.getActiveRange(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> forms = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sources = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ranges = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>).getValues(); forms.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r,i</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> form = FormApp.openById(forms[i]); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> values = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(sources[i]).getRange(ranges[i]).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arr = []; values.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">el,ei</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (el[<span class="hljs-number"><span class="hljs-number">0</span></span>] != <span class="hljs-string"><span class="hljs-string">''</span></span>) { arr.push(el[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item = form.getItems()[<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>(items[i])].asListItem(); item.setChoiceValues(arr); Logger.log(item.getTitle()); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ss = SpreadsheetApp.getActiveSpreadsheet(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> range = ss.getSheetByName(<span class="hljs-string"><span class="hljs-string">"    "</span></span>).getRange(<span class="hljs-string"><span class="hljs-string">"A2:C"</span></span>).getValues(); Logger.log(range); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOpen</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ui = SpreadsheetApp.getUi(); <span class="hljs-comment"><span class="hljs-comment">// Or DocumentApp or FormApp. ui.createMenu('Custom Menu') .addItem('Change', 'myFunction') .addToUi(); } function update() { var ss = SpreadsheetApp.getActiveSpreadsheet(); var range = ss.getSheetByName(" ").getRange("A2:A"); range.activate(); myFunction(); } function createTimeDrivenTriggers() { ScriptApp.newTrigger('update').timeBased().everyDays(1).create(); }</span></span></code> </pre><br>  Les formulaires sont diff√©rents, avec diff√©rentes listes de pizzerias et l'emplacement de la liste des pizzerias dans le formulaire.  Quelque part, nous avons besoin d'√©trangers, quelque part de Russie. <br><br><img src="https://habrastorage.org/webt/wq/h8/g2/wqh8g2jyt3gmwqopaicz4h2u_h8.png"><br><br>  Les colonnes B et C indiquent au script sous quel formulaire mettre √† jour et √† quel endroit le formulaire affiche la liste.  Et les colonnes D et E, √† partir de quelle feuille et plage vous devez prendre la liste pour la mise √† jour. <br><br>  Ensuite, nous avons d√©fini un d√©clencheur pour ex√©cuter le script une fois par jour et avons ainsi r√©ussi √† vaincre l'enfer du processus de mise √† jour des formulaires d'abord pour notre d√©partement, puis pour l'ensemble de l'entreprise.  Ce script fonctionne toujours. <br><br><h2>  Le cas le plus difficile d'un escargot </h2><br>  Une fois, nous voulions recevoir des enregistrements audio des contr√¥les de livraison. <br><br>  D'o√π vient l'enregistrement audio: les clients myst√®res ont enregistr√© la r√©union du courrier avec le client sous forme de message audio dans VK.  Il s'agit g√©n√©ralement de 10 √† 15 secondes d'enregistrement audio. <br><br>  Comment nous les avons obtenus: ils ont pris les 20 derniers messages sur l'adresse VK du client myst√®re, ont recherch√© le mot ¬´Ulica¬ª parmi eux, puis ont recul√© d'un message et ont enlev√© le lien vers l'enregistrement audio.  (Spoiler: pas le meilleur mot, souvent ils nous ont √©crit le mot "Snail"). <br><br>  Il y a d√©j√† plus de lignes de code, pr√©parez-vous. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLastAudio</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ss = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> token = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> range = ss.getActiveRange().getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tt = ss.getActiveRange().getRowIndex(); range.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r,i</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ri = tt + i; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cuid = r[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ci = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> payload1 = { <span class="hljs-string"><span class="hljs-string">"q"</span></span> : <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'peer_id'</span></span> : r[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">"access_token"</span></span> : token, <span class="hljs-string"><span class="hljs-string">"v"</span></span> : <span class="hljs-string"><span class="hljs-string">"5.73"</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> options1 = { <span class="hljs-comment"><span class="hljs-comment">//   http- "method" : "post", "header" : "Content-type: application/x-www-form-urlencoded", "payload" : payload1, "muteHttpExceptions" : true }; var jsonData = JSON.parse(UrlFetchApp.fetch("https://api.vk.com/method/messages.search", options1).getContentText()); Logger.log(jsonData); if (jsonData['response']['items'] == undefined) { ss.getRange("B" + ri).setValue(' ').setBackground('#f00'); return; } var cmid = jsonData['response']['items'][0]['id']; var date = new Date((jsonData['response']['items'][0]['date']*1000)); var fdate = Utilities.formatDate(date, "GMT+3", "dd-MM-yyyy HH:mm:ss"); ss.getRange("B" + ri).setValue(fdate); var payload2 = { "user_id" : cuid, "count" : '20', "access_token" : token, "v" : "5.73", }; var options2 = { //   http- "method" : "post", "header" : "Content-type: application/x-www-form-urlencoded", "payload" : payload2, "muteHttpExceptions" : true }; var jsonData2 = JSON.parse(UrlFetchApp.fetch("https://api.vk.com/method/messages.getHistory", options2).getContentText()); Logger.log(jsonData2); jsonData2['response']['items'].forEach(function (r,i) { if (r['id'] == cmid) { ci = i + 1; Logger.log(jsonData2['response']['items'][ci]); if (jsonData2['response']['items'][ci] == undefined) { ss.getRange("C" + ri).setValue(" "); } else { if (jsonData2['response']['items'][ci] != undefined &amp;&amp; jsonData2['response']['items'][ci]['attachments'] != undefined &amp;&amp; jsonData2['response']['items'][ci]['attachments'][0]['doc'] != undefined &amp;&amp; jsonData2['response']['items'][ci]['attachments'][0]['doc']['url'] != undefined) { ss.getRange("C" + ri).setValue(jsonData2['response']['items'][ci]['attachments'][0]['doc']['url']); } else { ss.getRange("C" + ri).setValue(jsonData2['response']['items'][ci]['body']); } } } }); }); }</span></span></code> </pre><br><h2>  Les feuilles de calcul Google ne sont pas caoutchouteuses, mais je suis un encodeur moyen </h2><br>  Donc tout tournait et tournait, jusqu'√† ce que nous soyons pass√©s √† 60000 clients myst√®res au d√©but de 2018. <br><br>  Nous avons donc d√©j√† rencontr√© des restrictions de table.  Ensuite, un tableau ne pouvait pas contenir plus de 2 millions de cellules, et nous avons utilis√© 1,6 million de cellules dans l'une des √©tiquettes de d√©partement les plus fr√©quent√©es, dont 135 000 cellules avaient toutes sortes de fonctions de tableau. <br><br>  Un tel backend.  Tout a terriblement ralenti et lorsque plusieurs personnes ont travaill√© ensemble, l'assiette a donn√© "Le document est trop populaire, revenez plus tard". <br><br>  Ensuite, il est devenu clair que je suis un mauvais encodeur, le syst√®me ne supporte pas la charge et je dois √™tre remplac√©. <br><br><h2>  Et puis le vrai d√©veloppeur est venu ... </h2><br>  Mais c'est une histoire compl√®tement diff√©rente et nous en parlerons plus tard.  J'esp√®re que ces exemples aideront les managers dans leurs projets, o√π il existe de nombreux processus infernaux.  Les processus peuvent et doivent √™tre automatis√©s, les tables et zapier (nous l'avons √©galement utilis√©) peuvent aider, et h√©berger des solutions s'il y a des ressources, nous ne les avions pas au d√©part. <br><br>  Si vous avez une personne dans l'entreprise qui sait quelque chose sur les scripts, alors elle convient pour organiser les processus infernaux dans les tablettes.  Si vous voulez vous-m√™me apprendre quelque chose comme √ßa, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Telegram</a> a un excellent canal pour cela, √† partir duquel j'ai pris des informations sur les fonctions et les scripts. <br><br>  Eh bien, t√™te de m√¢t pour tous les gestionnaires - conna√Ætre les tables chaque jour permet de gagner du temps lorsque vous travaillez avec des donn√©es et vous permet de penser et de comprendre au moins un peu ce que le d√©veloppeur fait avec les donn√©es et ce que vous pouvez faire avec les donn√©es en g√©n√©ral. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr472856/">https://habr.com/ru/post/fr472856/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr472838/index.html">En pratique, dans 80 √† 90% des cas, l'application web est lente du fait du front-end: un entretien avec Ivan Akulov</a></li>
<li><a href="../fr472840/index.html">Stockage d√©fini par logiciel, ou qu'est-ce qui a tu√© les dinosaures?</a></li>
<li><a href="../fr472848/index.html">R√©flexions sur une carri√®re en informatique</a></li>
<li><a href="../fr472850/index.html">Profession ou vie: gagnez un cours de netologie si vous n'avez pas peur</a></li>
<li><a href="../fr472854/index.html">Profilage UI Unity: qui g√¢che mon lot?</a></li>
<li><a href="../fr472858/index.html">Clients Python et HTTP rapides</a></li>
<li><a href="../fr472860/index.html">Invalidation du cache en cascade. Partie 1</a></li>
<li><a href="../fr472862/index.html">Invalidation du cache en cascade. 2e partie</a></li>
<li><a href="../fr472864/index.html">Check Point: optimisation CPU et RAM</a></li>
<li><a href="../fr472866/index.html">Talisman pour une communication stable</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>