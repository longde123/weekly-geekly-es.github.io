<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐คฝ๐ฟ ๐พ ๐ฉโ๐งโ๐ง ุฅุถุงูุฉ ุชููุงุฆูุง ูุณุงุญุฉ ุงูุฎุงุฏู ุงูุธุงูุฑู ๐๏ธ ๐ผ๐พ ๐ท</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุฑุญุจุง ุจุงูุฌููุน! 
 ูู ูุฐู ุงูููุงูุฉ ุณูู ูุชุญุฏุซ ุนู ููููุฉ ุฃุชูุชุฉ ูููุฉ ุชูุณูุน ูุณุงุญุฉ ุงููุฑุต ุนูู ุฃุญุฏ ุฎูุงุฏููุง. ููุง ูู ุงูุตุนูุจุฉ ูู ูุฐู ุงููููุฉ ุงูุจุณูุทุฉ ุงูุชู ุงุถุทุฑุฑุช ุฅูู ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุฅุถุงูุฉ ุชููุงุฆูุง ูุณุงุญุฉ ุงูุฎุงุฏู ุงูุธุงูุฑู</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440138/" style=";text-align:right;direction:rtl"><h2 style=";text-align:right;direction:rtl">  ูุฑุญุจุง ุจุงูุฌููุน! </h2><br>  ูู ูุฐู ุงูููุงูุฉ ุณูู ูุชุญุฏุซ ุนู ููููุฉ ุฃุชูุชุฉ ูููุฉ ุชูุณูุน ูุณุงุญุฉ ุงููุฑุต ุนูู ุฃุญุฏ ุฎูุงุฏููุง.  ููุง ูู ุงูุตุนูุจุฉ ูู ูุฐู ุงููููุฉ ุงูุจุณูุทุฉ ุงูุชู ุงุถุทุฑุฑุช ุฅูู ุชูููุฐูุง ุชููุงุฆููุง - ุชุณุฃูุ  ูุง ุดูุก ุฅุฐุง ููุช ูุง ุชุณุชุฎุฏู ุชุตุงุนุฏ ุงููุฏูุฌุฉ ุงููุชุชุงููุฉ.  ุฃุดุนุฑ ุฃู ููุงู ุงููุฒูุฏ ูู ุงูุฃุณุฆูุฉ!  ุญุณูุงู ุ ุฏุนูุง ูุฐูุจ ุชุญุช ุงููุท. <br><a name="habracut"></a><br>  ุฃููุงู ุ ุณูู ุฃุฎุจุฑู ุนู ุณุจุจ ุงุณุชุฎุฏุงููุง ููุชุฑููุจ ุงููุชูุงูู ุงููุชุชุงูู. <br><br>  ูุฏููุง ูุธุงู ูุงุญุฏ ูุญุชุงุฌ ุฅูู ุชุฎุฒูู ูููููุงุช ุงูุตุบูุฑุฉ (ูุญุต ุงููุณุชูุฏุงุช ุ ุฅูุฎ).  ูุชูุณุท โโุญุฌู ุงูููู ูู ูู 200 ูููู ุจุงูุช ุฅูู 1 ููุฌุงุจุงูุช ุ ูุงูุจูุงูุงุช ุซุงุจุชุฉ ุ ูุง ูุชุบูุฑ.  ููุงู ูููุงุฑุงุช ุงููููุงุช ุงูููุฌูุฏุฉ ููู ููุชุฒุงูุฏ ุงูุนุฏุฏ ูู ููู.  ูุฑุฉ ูุงุญุฏุฉ ุ ุนูุฏูุง ูุงู ุญุฌู ูุญุฏุฉ ุงูุชุฎุฒูู ูุชุฌุงูุฒ ุจุงููุนู 6 ุชูุฑุงุจุงูุช ุ ุฃุฏุฑููุง ุฃู ุงููุดุงูู ุณุชุจุฏุฃ ูุฑูุจูุง ุ ุฃุญุฏูุง ูุงู ููุช ุงููุณุฎ ุงูุงุญุชูุงุทู ูุงูุงุณุชุฑุฏุงุฏ.  ุซู ูุฑุฑูุง ุชูุณูู ุงูุจูุงูุงุช ุฅูู ุฃูุฑุงุต ุ ูุชู ุงุณุชุฏุนุงุก UnionFS ููุณุงุนุฏุชูุง ูู ุฐูู. <br><br>  ุชู ุชุญุฏูุฏ ุงูุฎูุงุฑุฒููุฉ ุนูู ุงููุญู ุงูุชุงูู: ุชุชู ูุชุงุจุฉ ุงูุจูุงูุงุช ุนูู ุงููุฑุต ูุง ูุฒูุฏ ุนู 2 ุชูุฑุงุจุงูุช ุ ุนูุฏูุง ููุชูู ูุถูู ูุฑุตูุง ุฌุฏูุฏูุง ุฅูู ุงูุฌูุงุฒ ุงูุธุงูุฑู ุ ูุถุน ุนูุงูุฉ ุนููู ุ ุฅุถุงูุชู ุฅูู UnionFS ุ ููู ุงููุฑุต ุงููุฏูู ุฅูู ReadOnly ุ ุฅุฒุงูุฉ ูุณุฎุฉ ููู ุ ุงููุชุงุจุฉ ุฅูู ุงูุดุฑูุท ุ ุฅุฒุงูุชู ูู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุนุจุฑ ุงูุฅูุชุฑูุช. <br><br>  ููุง ูููุช ุจุงููุนู ุ ูุฅู ูุฐู ุงูุฎูุงุฑุฒููุฉ ุชุชุทูุจ ุงูุชูุงููุง ูุจูุฑูุง ูู ุงููุณุคูู - ูุง ุชุชููุฑ ุฃู ุญุฑูุฉ ุญุฑุฌุฉ ูุชุฎุฒูู.  ูุฐูู ุ ูุฑุฑูุง ุงุณุชุจุนุงุฏ ุงูุนุงูู ุงูุจุดุฑู ุชูุงููุง ูุชุฐูุฑูุง ุฃู ูุฏููุง ZABBIX ุ ูุงูุฐู ููููู ุงูุชุนุงูู ุฌูุฏูุง ูุน ูุฐุง ุงูุฃูุฑ ุจุฃููุณูุง ุฅุฐุง ุฃุถููุง ุงููููู ูู ุณุญุฑ PowerShell ู Bash ุฅูู ุงูุฎูุงุฑุฒููุฉ. <br><br>  ุงูุขู ุญูู ููููุฉ ุงูููุงู ุจุฐูู. <br><br>  ูู Zabbix ุ ูุชู ุชูููู ูุดุบู ูููุณุงุญุฉ ุงูุญุฑุฉ ููุชู ุฅูุดุงุก ุฒุฑ ูููุถุน ุงููุฏูู: <br><br><img src="https://habrastorage.org/webt/fb/kc/bt/fbkcbtky2fhz15djj6tnu1knuhs.jpeg" alt="ุงูุตูุฑุฉ"><br><br>  ุนูุฏูุง ูุชู ุชุดุบูู ุงููุดุบู ุ ูุชู ุชุดููู ูููุฉ ูู sheduler ูุฎุงุฏู ุงูุฑูุจูุช ูุงูุชู ุชูุฌุฏ ุนูููุง ุฌููุน ุจุฑุงูุฌ ุงูุชุดุบูู ุงูุขูู: <br><br><pre style=";text-align:right;direction:rtl"><code class="actionscript hljs">Powershell.exe <span class="hljs-string"><span class="hljs-string">"Enable-ScheduledTask \PROD_TASKS\Add_HDD_OS0226โ</span></span></code> </pre> <br>  ูู ุงูููุช ุงููุญุฏุฏ ุ ูุชู ุชุดุบูู ุงูุจุฑูุงูุฌ ุงููุตู ุนูู ุงูุฎุงุฏู ูุงูุฐู: <br><br>  ูุถูู ุงููุฑุต ุฅูู ุงูุฌูุงุฒ ุงููุฑุบูุจ ููู: <br>  <i>(ูู ููุณ ุงูููุช ูุฎุชุงุฑ ุงูุญุฌู ุงูุฃูุซุฑ ุญุฑูุฉ)</i> <br><br><pre style=";text-align:right;direction:rtl"> <code class="actionscript hljs">$vm = Get-VM -Name $vmName New-HardDisk -VM $vm -CapacityGB $newHDDCapacity -Datastore $datastoreName โThinProvisioned</code> </pre><br>  ูุจุญุซ ุนู ุชูุงุตูู ูุตูู ุงูุฎุงุฏู: <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">OFFTop</b> <div class="spoiler_text" style=";text-align:right;direction:rtl">  <i>ูุณุชุฎุฏู ูุณุชูุฏุนูุง ูุฎุตุตูุง ูุชูุงุตูู ุงููุตูู ุงุณุชูุงุฏูุง ุฅูู TeamPass ุ ูุฐูู ูุนุซุฑ ุงูุจุฑูุงูุฌ ุงููุตู ุนูู ุงูุฎุงุฏู ุงููุทููุจ ูู ุงููุธุงู ููุชููู ุชูุงุตููู ุชููุงุฆููุง.</i>  <i>ูุชู ุฐูู ูุฃููุง ูููู ูู ุดูุฑ ุจุชุบููุฑ ูู ูููุงุช ุงููุฑูุฑ ุชููุงุฆููุง ุ ูููู ูุฐุง ููุถูุน ููุงูุฉ ูููุตูุฉ</i> </div></div><br><pre style=";text-align:right;direction:rtl"> <code class="actionscript hljs">#Generate TeamPass API request string $vmTPReq = <span class="hljs-string"><span class="hljs-string">"   TeamPass"</span></span> #Send request to TeamPass $vmCreds = Invoke-WebRequest($vmTPReq) -UseBasicParsing | ConvertFrom-Json #Convert credentials $credential = New-Object System.Management.Automation.PSCredential($vmCreds.login,(ConvertTo-SecureString $vmCreds.pw -asPlainText -Force))</code> </pre><br>  ูุฃุชู ุนูู SSH: <br><pre style=";text-align:right;direction:rtl"> <code class="actionscript hljs">#Create partition &amp; FS, mount disk to directory, edit fstab...etc. New-SSHSession -ComputerName $vmCreds.url -Credential $credential -Verbose -AcceptKey:$<span class="hljs-literal"><span class="hljs-literal">true</span></span> $results = Invoke-SSHCommand -SessionId <span class="hljs-number"><span class="hljs-number">0</span></span> -Command <span class="hljs-string"><span class="hljs-string">"/mnt/autodoit.sh"</span></span> Remove-SSHSession -Index <span class="hljs-number"><span class="hljs-number">0</span></span> -Verbose</code> </pre><br>  ูุถุน ุนูุงูุฉ ุนูููุง ูุฅุถุงูุชูุง ุฅูู ุญุงูู UnionFS: <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">(autodoit.sh)</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash fstab="/etc/fstab" newdisk=$(( ( parted -lm &gt;&amp;1 ) 1&gt;/tmp/gethddlog ) 2&gt;&amp;1) newdisk=$(echo $newdisk | cut -d ':' -f 2) if [[ $newdisk == "" ]] ; then printf "New disk not found! Exit\n". exit fi printf "New disk found: $newdisk\n" echo #Create new partition echo Create new partition ... parted $newdisk mklabel gpt unit TB mkpart primary 0.00TB 2.00TB print sleep 10 #Create filesystem echo Create filesystem xfs ... newdisk="$newdisk$((1))" mkfs.xfs $newdisk #Create new DATA directory lastdata=$(ls /mnt/ | grep 'data[0-9]\+$' | cut -c5- | sort -n | tail -n1) lastdatamount="/mnt/data$((lastdata))" newdata="/mnt/data$((lastdata+1))" printf "Create new direcory: $newdata\n" mkdir $newdata chown -R nobody:nobody $newdata chmod -R 755 $newdata #Mount new partition to new directory printf "Mount new partition to $newdata...\n" mount -t xfs ${newdisk} ${newdata} #Get UUID of new partition uuid=$(blkid $newdisk -o value -s UUID) printf "New disk UUID: $uuid\n" #Add mountpoint for new partition printf "Add mountpoint for new disk to fstab...\n" lastdatamount=$(cat $fstab | grep "$lastdatamount\s") newdatamount="UUID=$uuid $newdata xfs defaults,nofail 0 0" ldm=$(echo $lastdatamount | sed -r 's/[\/]/\\\//g') ndm=$(echo $newdatamount | sed -r 's/[\/]/\\\//g') sed -i "/$ldm/a $ndm" $fstab #Change UnionFS mountpoint string printf "Modify mountpoint for UnionFS in fstab...\n" prevunion=$(cat $fstab | grep fuse.unionfs) newunion=$(echo $prevunion | sed -e "s/=rw/=ro/") newunion=$(echo $newdata=rw:$newunion) sed -i "s|$prevunion|$newunion|" $fstab #Remount UnionFS printf "Remount UnionFS...\n" service smb stop sleep 0.6 umount /mnt/unionfs mount /mnt/unionfs service smb start printf "Done!\n\n" rm /tmp/gethddlog</span></span></code> </pre><br></div></div><br>  ูุณูุก ุงูุญุธ ุ ูู ููุช ูุชุงุจุฉ ูุฐุง ุงูุชูุฑูุฑ ุ ูู ูุญู ุงูุนุฏูุฏ ูู ุงููุดููุงุช ุงููุชุนููุฉ ุจุงูุฅูุดุงุก ุงูุชููุงุฆู ููููุงู ูู VEEAM ูุฃุฑุดูุฉ ุงููุฑุต ุงููุฏูู ููุชุงุจุชู ุนูู ุดุฑูุท ุ ูุฐูู ูุง ูุฒุงู ูุชู ุฐูู ูุฏูููุง.  ูููู ุณูููู ุจุงูุชุฃููุฏ ุจุชุญุฏูุซ ุงูุจุฑูุงูุฌ ุงููุตู ุจูุฌุฑุฏ ุฃู ูุญู ุจุนุถ ุงููุดุงูู. <br><br>  ุฃุฑุณูุช ุจูุงุณุทุฉ ููุชุงูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">ุฑูุฒูุงู</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">PBCVIT</a> ). <br><br>  ุชู ุงุณุชุนุงุฑุฉ ุฌุฒุก ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ููุตูููุงุช ุงูุฅูุชุตุงู ุ ูุชู ุญูุธ ุฑูุงุจุท ุงููุคูู ูู ุงูููุฏ. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงููุตู ุงููุงูู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#Set VM name $vmName = "OS0226" #Set TeamPass ID of linux server $vmTPId = "1161" #Set capacity of new HDD in GB $newHDDCapacity = 2048 #Set Log file $logFile = "C:\SCRIPTS\Log\NewHardDisk-OS0226.log" #Import module for SSH connections Import-Module Posh-SSH #Add VEEAM Snap-In Add-PSSnapin VeeamPSSnapin #Initialize VMWare PowerCLI &amp; 'C:\Program Files (x86)\VMware\Infrastructure\PowerCLI\Scripts\Initialize-PowerCLIEnvironment.ps1' #Add function for array join Function Join-Object { # https://powersnippets.com/join-object/ [CmdletBinding()]Param ( # Version 02.02.00, by iRon [Object[]]$RightTable, [Alias("Using")]$On, $Merge = @{}, [Parameter(ValueFromPipeLine = $True)][Object[]]$LeftTable, [String]$Equals ) $Type = ($MyInvocation.InvocationName -Split "-")[0] $PipeLine = $Input | ForEach {$_}; If ($PipeLine) {$LeftTable = $PipeLine} If ($LeftTable -eq $Null) {If ($RightTable[0] -is [Array]) {$LeftTable = $RightTable[0]; $RightTable = $RightTable[-1]} Else {$LeftTable = $RightTable}} $DefaultMerge = If ($Merge -is [ScriptBlock]) {$Merge; $Merge = @{}} ElseIf ($Merge."") {$Merge.""} Else {{$Left.$_, $Right.$_}} If ($Equals) {$Merge.$Equals = {If ($Left.$Equals -ne $Null) {$Left.$Equals} Else {$Right.$Equals}}} ElseIf ($On -is [String] -or $On -is [Array]) {@($On) | ForEach {If (!$Merge.$_) {$Merge.$_ = {$Left.$_}}}} $LeftKeys = @($LeftTable[0].PSObject.Properties | ForEach {$_.Name}) $RightKeys = @($RightTable[0].PSObject.Properties | ForEach {$_.Name}) $Keys = $LeftKeys + $RightKeys | Select -Unique $Keys | Where {!$Merge.$_} | ForEach {$Merge.$_ = $DefaultMerge} $Properties = @{}; $LeftOut = @($True) * @($LeftTable).Length; $RightOut = @($True) * @($RightTable).Length For ($LeftIndex = 0; $LeftIndex -lt $LeftOut.Length; $LeftIndex++) {$Left = $LeftTable[$LeftIndex] For ($RightIndex = 0; $RightIndex -lt $RightOut.Length; $RightIndex++) {$Right = $RightTable[$RightIndex] $Select = If ($On -is [String]) {If ($Equals) {$Left.$On -eq $Right.$Equals} Else {$Left.$On -eq $Right.$On}} ElseIf ($On -is [Array]) {($On | Where {!($Left.$_ -eq $Right.$_)}) -eq $Null} ElseIf ($On -is [ScriptBlock]) {&amp;$On} Else {$True} If ($Select) {$Keys | ForEach {$Properties.$_ = If ($LeftKeys -NotContains $_) {$Right.$_} ElseIf ($RightKeys -NotContains $_) {$Left.$_} Else {&amp;$Merge.$_} }; New-Object PSObject -Property $Properties; $LeftOut[$LeftIndex], $RightOut[$RightIndex] = $Null } } } If ("LeftJoin", "FullJoin" -Contains $Type) { For ($LeftIndex = 0; $LeftIndex -lt $LeftOut.Length; $LeftIndex++) { If ($LeftOut[$LeftIndex]) {$Keys | ForEach {$Properties.$_ = $LeftTable[$LeftIndex].$_}; New-Object PSObject -Property $Properties} } } If ("RightJoin", "FullJoin" -Contains $Type) { For ($RightIndex = 0; $RightIndex -lt $RightOut.Length; $RightIndex++) { If ($RightOut[$RightIndex]) {$Keys | ForEach {$Properties.$_ = $RightTable[$RightIndex].$_}; New-Object PSObject -Property $Properties} } } }; Set-Alias Join Join-Object Set-Alias InnerJoin Join-Object; Set-Alias InnerJoin-Object Join-Object -Description "Returns records that have matching values in both tables" Set-Alias LeftJoin Join-Object; Set-Alias LeftJoin-Object Join-Object -Description "Returns all records from the left table and the matched records from the right table" Set-Alias RightJoin Join-Object; Set-Alias RightJoin-Object Join-Object -Description "Returns all records from the right table and the matched records from the left table" Set-Alias FullJoin Join-Object; Set-Alias FullJoin-Object Join-Object -Description "Returns all records when there is a match in either left or right table" #Connect to vCenter Connect-VIServer vcenter.mmc.local #Get datastore $datastores = get-datastore | where-object Name -like "*TIERED_VM_PROD*" if ($datastores.Count -gt 0) { if (($datastores | Sort -Descending {$_.FreeSpaceGB})[0].FreeSpaceGB -gt 2048) { $datastoreName = ($datastores | Sort -Descending {$_.FreeSpaceGB})[0].Name } else { Write-Host("ERROR: No enought space on datastore for new HDD!") break } } else { Write-Host("ERROR: No Datastores found!") break } #Generate TeamPass API request string $vmTPReq = "   TeamPass" #Send request to TeamPass $vmCreds = Invoke-WebRequest($vmTPReq) -UseBasicParsing | ConvertFrom-Json #Convert credentials $credential = New-Object System.Management.Automation.PSCredential($vmCreds.login,(ConvertTo-SecureString $vmCreds.pw -asPlainText -Force)) if ((Test-Connection $vmCreds.url -Count 1 -Quiet) -eq $false) { $err = $error[0].FullyQualifiedErrorId } try { # Get disks information from Linux New-SSHSession -ComputerName $vmCreds.url -Credential $credential -Verbose -AcceptKey:$true $linuxCommand1 = 'ls -dl /sys/block/sd*/device/scsi_device/*' $linuxDisksData1 = Invoke-SSHCommand -SessionId 0 -Command $linuxCommand1 $linuxCommand2 = 'lsblk -l | grep /mnt' $linuxDisksData2 = Invoke-SSHCommand -SessionId 0 -Command $linuxCommand2 Remove-SSHSession -Index 0 -Verbose $linuxMounts = $linuxDisksData2.Output -replace '\s+', ' ' | Select @{N='Partition';E={($_.split(" ")[0])}}, @{N='linuxMount';E={($_.split(" ")[6])}} $linuxDisks = $linuxDisksData1.Output -replace '\s+', ' ' | Select @{N='Partition';E={($_.split(" ")[8]).split('/')[3]+'1'}}, @{N='SCSIAddr';E={(($_.split(" ")[8]).split('/')[6]).split(':')[1]+':'+(($_.split(" ")[8]).split('/')[6]).split(':')[2]}} $linuxDisks = $linuxDisks | sort SCSIAddr } catch { $err = $error[0].FullyQualifiedErrorId } #Get disks information from vmware $vmDisks = Get-VM -Name $vmName | Get-HardDisk | Select @{N='vmwareHardDisk';E={$_.Name}}, @{N='vSCSI';E={$_.uid.split("/")[3].split("=")[1]}}, @{N='SCSIAddr';E={[string]([math]::truncate((($_.uid.split("/")[3].split("=")[1])-2000)/16))+':'+[string]((($_.uid.split("/")[3].split("=")[1])-2000)%16)}} $vmDisks = $vmDisks | sort SCSIAddr #Get total information about VM Disks $OLAYtotalEffects = $vmDisks | InnerJoin $linuxDisks SCSIAddr -eq SCSIAddr | InnerJoin $linuxMounts Partition -eq Partition| sort vmwareHardDisk #Display total information about VM Disks $OLAYtotalEffects | ft $OLAYtotalEffects | ft 2&gt;$logFile #Get latest mount $linuxLatestDiskMount = [string](($OLAYtotalEffects | select linuxMount | where linuxMount -like "/mnt/data*" | % {[int](($_.linuxMount.Split("/")[2]).Replace("data",""))} | Measure -Maximum).Maximum) #Get latest vSCSI number $latestDiskvSCSI = ($OLAYtotalEffects | where {$_.linuxMount -eq "/mnt/data$linuxLatestDiskMount"}).vSCSI #Add HDD to VM $vm = Get-VM -Name $vmName New-HardDisk -VM $vm -CapacityGB $newHDDCapacity -Datastore $datastoreName -ThinProvisioned #Let the disk takes root Write-Host("Let the disk takes root...") sleep 10 if ((Test-Connection $vmCreds.url -Count 1 -Quiet) -eq $false) { $err = $error[0].FullyQualifiedErrorId } try { #Create partition &amp; FS, mount disk to directory, edit fstab...etc. New-SSHSession -ComputerName $vmCreds.url -Credential $credential -Verbose -AcceptKey:$true $results = Invoke-SSHCommand -SessionId 0 -Command "/mnt/autodoit.sh" Remove-SSHSession -Index 0 -Verbose $results.Output } catch { $err = $error[0].FullyQualifiedErrorId } #After adding a new disk, some checks are just performed if ((Test-Connection $vmCreds.url -Count 1 -Quiet) -eq $false) { $err = $error[0].FullyQualifiedErrorId } try { # Get disks information from Linux New-SSHSession -ComputerName $vmCreds.url -Credential $credential -Verbose -AcceptKey:$true $linuxCommand1 = 'ls -dl /sys/block/sd*/device/scsi_device/*' $linuxDisksData1 = Invoke-SSHCommand -SessionId 0 -Command $linuxCommand1 $linuxCommand2 = 'lsblk -l | grep /mnt' $linuxDisksData2 = Invoke-SSHCommand -SessionId 0 -Command $linuxCommand2 Remove-SSHSession -Index 0 -Verbose $linuxMounts = $linuxDisksData2.Output -replace '\s+', ' ' | Select @{N='Partition';E={($_.split(" ")[0])}}, @{N='linuxMount';E={($_.split(" ")[6])}} $linuxDisks = $linuxDisksData1.Output -replace '\s+', ' ' | Select @{N='Partition';E={($_.split(" ")[8]).split('/')[3]+'1'}}, @{N='SCSIAddr';E={(($_.split(" ")[8]).split('/')[6]).split(':')[1]+':'+(($_.split(" ")[8]).split('/')[6]).split(':')[2]}} $linuxDisks = $linuxDisks | sort SCSIAddr } catch { $err = $error[0].FullyQualifiedErrorId } #Get disks information from vmware $vmDisks = Get-VM -Name $vmName | Get-HardDisk | Select @{N='vmwareHardDisk';E={$_.Name}}, @{N='vSCSI';E={$_.uid.split("/")[3].split("=")[1]}}, @{N='SCSIAddr';E={[string]([math]::truncate((($_.uid.split("/")[3].split("=")[1])-2000)/16))+':'+[string]((($_.uid.split("/")[3].split("=")[1])-2000)%16)}} $vmDisks = $vmDisks | sort SCSIAddr #Get total information about VM Disks $OLAYtotalEffects = $vmDisks | InnerJoin $linuxDisks SCSIAddr -eq SCSIAddr | InnerJoin $linuxMounts Partition -eq Partition| sort vmwareHardDisk #Display total information about VM Disks $OLAYtotalEffects | ft $OLAYtotalEffects | ft 2&gt;$logFile Disconnect-VIServer -Confirm:$false Disable-ScheduledTask \PROD_TASKS\Add_HDD_OS0226</span></span></code> </pre> <br></div></div><br>  ูุง ุชูุฌุฏ ุดูุงูู ุถุฏ UnionFS ุ ููู ุชุนูู ุจุซุจุงุช ูุฃูุซุฑ ูู ุนุงููู. <br><br>  ุงูุณุคุงู ุนู ุณุจุจ ุชูุธูู ุงูุชุฎุฒูู ุจุดูู ุนุงู ูู ุจูุงุบู ุนุงู ุ ููุท ุชูุจูู ููุง ูู. <br><br>  ูุฑุฌู ููุงุญุธุฉ ุฃูู ูุฌุจ ุงุณุชุฎุฏุงู ุฃููุงุน ูุฎุชููุฉ ูู ุชุนููู ูุญุฑู ุงูุฃูุฑุงุต ูุฃูุธูุฉ ูุฎุชููุฉ.  ูุฐูู ูู ุญุฐุฑูุง ูุณุชุฃุชู ุงูููุฉ ูุนู. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar440138/">https://habr.com/ru/post/ar440138/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar440122/index.html">ููููุฉ ุตูุน ูุตุจุงุญ ูุฏูู ููุทุงูุฉ ุงูุดูุณูุฉ ุจูุฏูู (ุงูุฌุฒุก 2)</a></li>
<li><a href="../ar440124/index.html">ููุงุฐุง ูุทูุฑู ุดุจูุงุช ABBYY Mobile ุงูุนุตุจูุฉ ููุชุญู ููููุฉ ุนุดูุงุฆูุฉ</a></li>
<li><a href="../ar440130/index.html">ููู ูููุจุชุฏุฆูู</a></li>
<li><a href="../ar440134/index.html">ููู ูููุน ุฅูู ุงุญุตุงุฆูุงุช: ุงูุฏุงูุน ุ ุงูุชูููุฉ ุ ุงูุนูู</a></li>
<li><a href="../ar440136/index.html">ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุงูุฃูู ุตูุฑ ุงููุฌุฑ: ุงูุณููู ุงููุฑุฏู</a></li>
<li><a href="../ar440142/index.html">ูุฌุจ ุฃู ูููู ุจูู ุงูุฅุถุงูุงุช ูุจุนุถ ุงูุฃุฏูุงุช ุงููุณุงุนุฏุฉ ูุชุทููุฑ C \ C ++ ูู VS Code</a></li>
<li><a href="../ar440148/index.html">ุงููุงูุน ุงูุงูุชุฑุงุถู - ุงูุญูุงุฉ ุงูููุงุฒูุฉ ูุน ุงูุชูุงุฑุงุช</a></li>
<li><a href="../ar440152/index.html">ูููุงู ุงูุฎุทู DIY ุฃู ููููุฉ ุงุณุชูุณุงุฎ ุงูุฃููุงููุฉ ุงูุฃุตููุฉ ูุน ูุชูุฌุฉ ุฌูุฏุฉ</a></li>
<li><a href="../ar440154/index.html">ููู ุชู ุฅูุดุงุก Spore: ููุงุจูุงุช ูุน ุงููุทูุฑูู</a></li>
<li><a href="../ar440156/index.html">ููููุฉ ุชูุธูู ุงูุชูููุฉ ุงูููุฒุนุฉ ุ ุฅุฐุง ูุงู ูุฐุง ุบูุฑ ูููู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>