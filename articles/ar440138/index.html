<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤½ğŸ¿ ğŸ¾ ğŸ‘©â€ğŸ‘§â€ğŸ‘§ Ø¥Ø¶Ø§ÙØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø¸Ø§Ù‡Ø±ÙŠ ğŸšï¸ ğŸ‘¼ğŸ¾ ğŸ“·</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ù…Ø±Ø­Ø¨Ø§ Ø¨Ø§Ù„Ø¬Ù…ÙŠØ¹! 
 ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‚Ø§Ù„Ø© Ø³ÙˆÙ Ù†ØªØ­Ø¯Ø« Ø¹Ù† ÙƒÙŠÙÙŠØ© Ø£ØªÙ…ØªØ© Ù…Ù‡Ù…Ø© ØªÙˆØ³ÙŠØ¹ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù‚Ø±Øµ Ø¹Ù„Ù‰ Ø£Ø­Ø¯ Ø®ÙˆØ§Ø¯Ù…Ù†Ø§. ÙˆÙ…Ø§ Ù‡Ùˆ Ø§Ù„ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø¨Ø³ÙŠØ·Ø© Ø§Ù„ØªÙŠ Ø§Ø¶Ø·Ø±Ø±Øª Ø¥Ù„Ù‰ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ø¥Ø¶Ø§ÙØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø¸Ø§Ù‡Ø±ÙŠ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440138/" style=";text-align:right;direction:rtl"><h2 style=";text-align:right;direction:rtl">  Ù…Ø±Ø­Ø¨Ø§ Ø¨Ø§Ù„Ø¬Ù…ÙŠØ¹! </h2><br>  ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‚Ø§Ù„Ø© Ø³ÙˆÙ Ù†ØªØ­Ø¯Ø« Ø¹Ù† ÙƒÙŠÙÙŠØ© Ø£ØªÙ…ØªØ© Ù…Ù‡Ù…Ø© ØªÙˆØ³ÙŠØ¹ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù‚Ø±Øµ Ø¹Ù„Ù‰ Ø£Ø­Ø¯ Ø®ÙˆØ§Ø¯Ù…Ù†Ø§.  ÙˆÙ…Ø§ Ù‡Ùˆ Ø§Ù„ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø¨Ø³ÙŠØ·Ø© Ø§Ù„ØªÙŠ Ø§Ø¶Ø·Ø±Ø±Øª Ø¥Ù„Ù‰ ØªÙ†ÙÙŠØ°Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ - ØªØ³Ø£Ù„ØŸ  Ù„Ø§ Ø´ÙŠØ¡ Ø¥Ø°Ø§ ÙƒÙ†Øª Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… ØªØµØ§Ø¹Ø¯ Ø§Ù„Ù…Ø¯Ù…Ø¬Ø© Ø§Ù„Ù…ØªØªØ§Ù„ÙŠØ©.  Ø£Ø´Ø¹Ø± Ø£Ù† Ù‡Ù†Ø§Ùƒ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ø³Ø¦Ù„Ø©!  Ø­Ø³Ù†Ø§Ù‹ ØŒ Ø¯Ø¹Ù†Ø§ Ù†Ø°Ù‡Ø¨ ØªØ­Øª Ø§Ù„Ù‚Ø·. <br><a name="habracut"></a><br>  Ø£ÙˆÙ„Ø§Ù‹ ØŒ Ø³ÙˆÙ Ø£Ø®Ø¨Ø±Ùƒ Ø¹Ù† Ø³Ø¨Ø¨ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù†Ø§ Ù„Ù„ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ø§Ù„Ù…ØªØªØ§Ù„ÙŠ. <br><br>  Ù„Ø¯ÙŠÙ†Ø§ Ù†Ø¸Ø§Ù… ÙˆØ§Ø­Ø¯ ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ®Ø²ÙŠÙ† Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØµØºÙŠØ±Ø© (ÙØ­Øµ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª ØŒ Ø¥Ù„Ø®).  Ù…ØªÙˆØ³Ø· â€‹â€‹Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù Ù‡Ùˆ Ù…Ù† 200 ÙƒÙŠÙ„Ùˆ Ø¨Ø§ÙŠØª Ø¥Ù„Ù‰ 1 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª ØŒ ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø«Ø§Ø¨ØªØ© ØŒ Ù„Ø§ ÙŠØªØºÙŠØ±.  Ù‡Ù†Ø§Ùƒ Ù…Ù„ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠÙ‡ ÙˆÙŠØªØ²Ø§ÙŠØ¯ Ø§Ù„Ø¹Ø¯Ø¯ ÙƒÙ„ ÙŠÙˆÙ….  Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ØŒ Ø¹Ù†Ø¯Ù…Ø§ ÙƒØ§Ù† Ø­Ø¬Ù… ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† ÙŠØªØ¬Ø§ÙˆØ² Ø¨Ø§Ù„ÙØ¹Ù„ 6 ØªÙŠØ±Ø§Ø¨Ø§ÙŠØª ØŒ Ø£Ø¯Ø±ÙƒÙ†Ø§ Ø£Ù† Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø³ØªØ¨Ø¯Ø£ Ù‚Ø±ÙŠØ¨Ù‹Ø§ ØŒ Ø£Ø­Ø¯Ù‡Ø§ ÙƒØ§Ù† ÙˆÙ‚Øª Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯.  Ø«Ù… Ù‚Ø±Ø±Ù†Ø§ ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø£Ù‚Ø±Ø§Øµ ØŒ ÙˆØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ UnionFS Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙ†Ø§ ÙÙŠ Ø°Ù„Ùƒ. <br><br>  ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø­Ùˆ Ø§Ù„ØªØ§Ù„ÙŠ: ØªØªÙ… ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø±Øµ Ù„Ø§ ÙŠØ²ÙŠØ¯ Ø¹Ù† 2 ØªÙŠØ±Ø§Ø¨Ø§ÙŠØª ØŒ Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙ†ØªÙ‡ÙŠ Ù†Ø¶ÙŠÙ Ù‚Ø±ØµÙ‹Ø§ Ø¬Ø¯ÙŠØ¯Ù‹Ø§ Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø¸Ø§Ù‡Ø±ÙŠ ØŒ ÙˆØ¶Ø¹ Ø¹Ù„Ø§Ù…Ø© Ø¹Ù„ÙŠÙ‡ ØŒ Ø¥Ø¶Ø§ÙØªÙ‡ Ø¥Ù„Ù‰ UnionFS ØŒ Ù†Ù‚Ù„ Ø§Ù„Ù‚Ø±Øµ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¥Ù„Ù‰ ReadOnly ØŒ Ø¥Ø²Ø§Ù„Ø© Ù†Ø³Ø®Ø© Ù…Ù†Ù‡ ØŒ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø±ÙŠØ· ØŒ Ø¥Ø²Ø§Ù„ØªÙ‡ Ù…Ù† Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª. <br><br>  ÙƒÙ…Ø§ ÙÙ‡Ù…Øª Ø¨Ø§Ù„ÙØ¹Ù„ ØŒ ÙØ¥Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© ØªØªØ·Ù„Ø¨ Ø§Ù‡ØªÙ…Ø§Ù…Ù‹Ø§ ÙƒØ¨ÙŠØ±Ù‹Ø§ Ù…Ù† Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ - Ù„Ø§ ØªØªÙˆÙØ± Ø£ÙŠ Ø­Ø±ÙƒØ© Ø­Ø±Ø¬Ø© ÙˆØªØ®Ø²ÙŠÙ†.  Ù„Ø°Ù„Ùƒ ØŒ Ù‚Ø±Ø±Ù†Ø§ Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø§Ù„Ø¹Ø§Ù…Ù„ Ø§Ù„Ø¨Ø´Ø±ÙŠ ØªÙ…Ø§Ù…Ù‹Ø§ ÙˆØªØ°ÙƒØ±Ù†Ø§ Ø£Ù† Ù„Ø¯ÙŠÙ†Ø§ ZABBIX ØŒ ÙˆØ§Ù„Ø°ÙŠ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ø¬ÙŠØ¯Ù‹Ø§ Ù…Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø± Ø¨Ø£Ù†ÙØ³Ù†Ø§ Ø¥Ø°Ø§ Ø£Ø¶ÙÙ†Ø§ Ø§Ù„Ù‚Ù„ÙŠÙ„ Ù…Ù† Ø³Ø­Ø± PowerShell Ùˆ Bash Ø¥Ù„Ù‰ Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ©. <br><br>  Ø§Ù„Ø¢Ù† Ø­ÙˆÙ„ ÙƒÙŠÙÙŠØ© Ø§Ù„Ù‚ÙŠØ§Ù… Ø¨Ø°Ù„Ùƒ. <br><br>  ÙÙŠ Zabbix ØŒ ÙŠØªÙ… ØªÙƒÙˆÙŠÙ† Ù…Ø´ØºÙ„ Ù„Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø­Ø±Ø© ÙˆÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø²Ø± Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙŠØ¯ÙˆÙŠ: <br><br><img src="https://habrastorage.org/webt/fb/kc/bt/fbkcbtky2fhz15djj6tnu1knuhs.jpeg" alt="Ø§Ù„ØµÙˆØ±Ø©"><br><br>  Ø¹Ù†Ø¯Ù…Ø§ ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø´ØºÙ„ ØŒ ÙŠØªÙ… ØªØ´ÙƒÙŠÙ„ Ù…Ù‡Ù…Ø© ÙÙŠ sheduler Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø±ÙˆØ¨ÙˆØª ÙˆØ§Ù„ØªÙŠ ØªÙˆØ¬Ø¯ Ø¹Ù„ÙŠÙ‡Ø§ Ø¬Ù…ÙŠØ¹ Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¢Ù„ÙŠ: <br><br><pre style=";text-align:right;direction:rtl"><code class="actionscript hljs">Powershell.exe <span class="hljs-string"><span class="hljs-string">"Enable-ScheduledTask \PROD_TASKS\Add_HDD_OS0226â€</span></span></code> </pre> <br>  ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯ ØŒ ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ù†ØµÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… ÙˆØ§Ù„Ø°ÙŠ: <br><br>  ÙŠØ¶ÙŠÙ Ø§Ù„Ù‚Ø±Øµ Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø±ØºÙˆØ¨ ÙÙŠÙ‡: <br>  <i>(ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª ÙŠØ®ØªØ§Ø± Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø£ÙƒØ«Ø± Ø­Ø±ÙŠØ©)</i> <br><br><pre style=";text-align:right;direction:rtl"> <code class="actionscript hljs">$vm = Get-VM -Name $vmName New-HardDisk -VM $vm -CapacityGB $newHDDCapacity -Datastore $datastoreName â€“ThinProvisioned</code> </pre><br>  ÙŠØ¨Ø­Ø« Ø¹Ù† ØªÙØ§ØµÙŠÙ„ ÙˆØµÙˆÙ„ Ø§Ù„Ø®Ø§Ø¯Ù…: <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">OFFTop</b> <div class="spoiler_text" style=";text-align:right;direction:rtl">  <i>Ù†Ø³ØªØ®Ø¯Ù… Ù…Ø³ØªÙˆØ¯Ø¹Ù‹Ø§ Ù…Ø®ØµØµÙ‹Ø§ Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ø³ØªÙ†Ø§Ø¯Ù‹Ø§ Ø¥Ù„Ù‰ TeamPass ØŒ Ù„Ø°Ù„Ùƒ ÙŠØ¹Ø«Ø± Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ù†ØµÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆÙŠØªÙ„Ù‚Ù‰ ØªÙØ§ØµÙŠÙ„Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</i>  <i>ÙŠØªÙ… Ø°Ù„Ùƒ Ù„Ø£Ù†Ù†Ø§ Ù†Ù‚ÙˆÙ… ÙƒÙ„ Ø´Ù‡Ø± Ø¨ØªØºÙŠÙŠØ± ÙƒÙ„ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ØŒ ÙˆÙ„ÙƒÙ† Ù‡Ø°Ø§ Ù…ÙˆØ¶ÙˆØ¹ Ù…Ù‚Ø§Ù„Ø© Ù…Ù†ÙØµÙ„Ø©</i> </div></div><br><pre style=";text-align:right;direction:rtl"> <code class="actionscript hljs">#Generate TeamPass API request string $vmTPReq = <span class="hljs-string"><span class="hljs-string">"   TeamPass"</span></span> #Send request to TeamPass $vmCreds = Invoke-WebRequest($vmTPReq) -UseBasicParsing | ConvertFrom-Json #Convert credentials $credential = New-Object System.Management.Automation.PSCredential($vmCreds.login,(ConvertTo-SecureString $vmCreds.pw -asPlainText -Force))</code> </pre><br>  ÙŠØ£ØªÙŠ Ø¹Ù„Ù‰ SSH: <br><pre style=";text-align:right;direction:rtl"> <code class="actionscript hljs">#Create partition &amp; FS, mount disk to directory, edit fstab...etc. New-SSHSession -ComputerName $vmCreds.url -Credential $credential -Verbose -AcceptKey:$<span class="hljs-literal"><span class="hljs-literal">true</span></span> $results = Invoke-SSHCommand -SessionId <span class="hljs-number"><span class="hljs-number">0</span></span> -Command <span class="hljs-string"><span class="hljs-string">"/mnt/autodoit.sh"</span></span> Remove-SSHSession -Index <span class="hljs-number"><span class="hljs-number">0</span></span> -Verbose</code> </pre><br>  ÙˆØ¶Ø¹ Ø¹Ù„Ø§Ù…Ø© Ø¹Ù„ÙŠÙ‡Ø§ ÙˆØ¥Ø¶Ø§ÙØªÙ‡Ø§ Ø¥Ù„Ù‰ Ø­Ø§Ù…Ù„ UnionFS: <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">(autodoit.sh)</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash fstab="/etc/fstab" newdisk=$(( ( parted -lm &gt;&amp;1 ) 1&gt;/tmp/gethddlog ) 2&gt;&amp;1) newdisk=$(echo $newdisk | cut -d ':' -f 2) if [[ $newdisk == "" ]] ; then printf "New disk not found! Exit\n". exit fi printf "New disk found: $newdisk\n" echo #Create new partition echo Create new partition ... parted $newdisk mklabel gpt unit TB mkpart primary 0.00TB 2.00TB print sleep 10 #Create filesystem echo Create filesystem xfs ... newdisk="$newdisk$((1))" mkfs.xfs $newdisk #Create new DATA directory lastdata=$(ls /mnt/ | grep 'data[0-9]\+$' | cut -c5- | sort -n | tail -n1) lastdatamount="/mnt/data$((lastdata))" newdata="/mnt/data$((lastdata+1))" printf "Create new direcory: $newdata\n" mkdir $newdata chown -R nobody:nobody $newdata chmod -R 755 $newdata #Mount new partition to new directory printf "Mount new partition to $newdata...\n" mount -t xfs ${newdisk} ${newdata} #Get UUID of new partition uuid=$(blkid $newdisk -o value -s UUID) printf "New disk UUID: $uuid\n" #Add mountpoint for new partition printf "Add mountpoint for new disk to fstab...\n" lastdatamount=$(cat $fstab | grep "$lastdatamount\s") newdatamount="UUID=$uuid $newdata xfs defaults,nofail 0 0" ldm=$(echo $lastdatamount | sed -r 's/[\/]/\\\//g') ndm=$(echo $newdatamount | sed -r 's/[\/]/\\\//g') sed -i "/$ldm/a $ndm" $fstab #Change UnionFS mountpoint string printf "Modify mountpoint for UnionFS in fstab...\n" prevunion=$(cat $fstab | grep fuse.unionfs) newunion=$(echo $prevunion | sed -e "s/=rw/=ro/") newunion=$(echo $newdata=rw:$newunion) sed -i "s|$prevunion|$newunion|" $fstab #Remount UnionFS printf "Remount UnionFS...\n" service smb stop sleep 0.6 umount /mnt/unionfs mount /mnt/unionfs service smb start printf "Done!\n\n" rm /tmp/gethddlog</span></span></code> </pre><br></div></div><br>  Ù„Ø³ÙˆØ¡ Ø§Ù„Ø­Ø¸ ØŒ ÙÙŠ ÙˆÙ‚Øª ÙƒØªØ§Ø¨Ø© Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ØŒ Ù„Ù… Ù†Ø­Ù„ Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø´ÙƒÙ„Ø§Øª Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…Ù‡Ø§Ù… ÙÙŠ VEEAM Ù„Ø£Ø±Ø´ÙØ© Ø§Ù„Ù‚Ø±Øµ Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙˆÙƒØªØ§Ø¨ØªÙ‡ Ø¹Ù„Ù‰ Ø´Ø±ÙŠØ· ØŒ Ù„Ø°Ù„Ùƒ Ù„Ø§ ÙŠØ²Ø§Ù„ ÙŠØªÙ… Ø°Ù„Ùƒ ÙŠØ¯ÙˆÙŠÙ‹Ø§.  ÙˆÙ„ÙƒÙ† Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¨ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ù†ØµÙŠ Ø¨Ù…Ø¬Ø±Ø¯ Ø£Ù† Ù†Ø­Ù„ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„. <br><br>  Ø£Ø±Ø³Ù„Øª Ø¨ÙˆØ§Ø³Ø·Ø© ÙÙŠØªØ§Ù„ÙŠ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">Ø±ÙˆØ²Ù…Ø§Ù†</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">PBCVIT</a> ). <br><br>  ØªÙ… Ø§Ø³ØªØ¹Ø§Ø±Ø© Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ© Ù„Ù…ØµÙÙˆÙØ§Øª Ø§Ù„Ø¥Ù„ØªØµØ§Ù‚ ØŒ ÙˆØªÙ… Ø­ÙØ¸ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø¤Ù„Ù ÙÙŠ Ø§Ù„ÙƒÙˆØ¯. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">Ø§Ù„Ù†ØµÙŠ Ø§Ù„ÙƒØ§Ù…Ù„</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#Set VM name $vmName = "OS0226" #Set TeamPass ID of linux server $vmTPId = "1161" #Set capacity of new HDD in GB $newHDDCapacity = 2048 #Set Log file $logFile = "C:\SCRIPTS\Log\NewHardDisk-OS0226.log" #Import module for SSH connections Import-Module Posh-SSH #Add VEEAM Snap-In Add-PSSnapin VeeamPSSnapin #Initialize VMWare PowerCLI &amp; 'C:\Program Files (x86)\VMware\Infrastructure\PowerCLI\Scripts\Initialize-PowerCLIEnvironment.ps1' #Add function for array join Function Join-Object { # https://powersnippets.com/join-object/ [CmdletBinding()]Param ( # Version 02.02.00, by iRon [Object[]]$RightTable, [Alias("Using")]$On, $Merge = @{}, [Parameter(ValueFromPipeLine = $True)][Object[]]$LeftTable, [String]$Equals ) $Type = ($MyInvocation.InvocationName -Split "-")[0] $PipeLine = $Input | ForEach {$_}; If ($PipeLine) {$LeftTable = $PipeLine} If ($LeftTable -eq $Null) {If ($RightTable[0] -is [Array]) {$LeftTable = $RightTable[0]; $RightTable = $RightTable[-1]} Else {$LeftTable = $RightTable}} $DefaultMerge = If ($Merge -is [ScriptBlock]) {$Merge; $Merge = @{}} ElseIf ($Merge."") {$Merge.""} Else {{$Left.$_, $Right.$_}} If ($Equals) {$Merge.$Equals = {If ($Left.$Equals -ne $Null) {$Left.$Equals} Else {$Right.$Equals}}} ElseIf ($On -is [String] -or $On -is [Array]) {@($On) | ForEach {If (!$Merge.$_) {$Merge.$_ = {$Left.$_}}}} $LeftKeys = @($LeftTable[0].PSObject.Properties | ForEach {$_.Name}) $RightKeys = @($RightTable[0].PSObject.Properties | ForEach {$_.Name}) $Keys = $LeftKeys + $RightKeys | Select -Unique $Keys | Where {!$Merge.$_} | ForEach {$Merge.$_ = $DefaultMerge} $Properties = @{}; $LeftOut = @($True) * @($LeftTable).Length; $RightOut = @($True) * @($RightTable).Length For ($LeftIndex = 0; $LeftIndex -lt $LeftOut.Length; $LeftIndex++) {$Left = $LeftTable[$LeftIndex] For ($RightIndex = 0; $RightIndex -lt $RightOut.Length; $RightIndex++) {$Right = $RightTable[$RightIndex] $Select = If ($On -is [String]) {If ($Equals) {$Left.$On -eq $Right.$Equals} Else {$Left.$On -eq $Right.$On}} ElseIf ($On -is [Array]) {($On | Where {!($Left.$_ -eq $Right.$_)}) -eq $Null} ElseIf ($On -is [ScriptBlock]) {&amp;$On} Else {$True} If ($Select) {$Keys | ForEach {$Properties.$_ = If ($LeftKeys -NotContains $_) {$Right.$_} ElseIf ($RightKeys -NotContains $_) {$Left.$_} Else {&amp;$Merge.$_} }; New-Object PSObject -Property $Properties; $LeftOut[$LeftIndex], $RightOut[$RightIndex] = $Null } } } If ("LeftJoin", "FullJoin" -Contains $Type) { For ($LeftIndex = 0; $LeftIndex -lt $LeftOut.Length; $LeftIndex++) { If ($LeftOut[$LeftIndex]) {$Keys | ForEach {$Properties.$_ = $LeftTable[$LeftIndex].$_}; New-Object PSObject -Property $Properties} } } If ("RightJoin", "FullJoin" -Contains $Type) { For ($RightIndex = 0; $RightIndex -lt $RightOut.Length; $RightIndex++) { If ($RightOut[$RightIndex]) {$Keys | ForEach {$Properties.$_ = $RightTable[$RightIndex].$_}; New-Object PSObject -Property $Properties} } } }; Set-Alias Join Join-Object Set-Alias InnerJoin Join-Object; Set-Alias InnerJoin-Object Join-Object -Description "Returns records that have matching values in both tables" Set-Alias LeftJoin Join-Object; Set-Alias LeftJoin-Object Join-Object -Description "Returns all records from the left table and the matched records from the right table" Set-Alias RightJoin Join-Object; Set-Alias RightJoin-Object Join-Object -Description "Returns all records from the right table and the matched records from the left table" Set-Alias FullJoin Join-Object; Set-Alias FullJoin-Object Join-Object -Description "Returns all records when there is a match in either left or right table" #Connect to vCenter Connect-VIServer vcenter.mmc.local #Get datastore $datastores = get-datastore | where-object Name -like "*TIERED_VM_PROD*" if ($datastores.Count -gt 0) { if (($datastores | Sort -Descending {$_.FreeSpaceGB})[0].FreeSpaceGB -gt 2048) { $datastoreName = ($datastores | Sort -Descending {$_.FreeSpaceGB})[0].Name } else { Write-Host("ERROR: No enought space on datastore for new HDD!") break } } else { Write-Host("ERROR: No Datastores found!") break } #Generate TeamPass API request string $vmTPReq = "   TeamPass" #Send request to TeamPass $vmCreds = Invoke-WebRequest($vmTPReq) -UseBasicParsing | ConvertFrom-Json #Convert credentials $credential = New-Object System.Management.Automation.PSCredential($vmCreds.login,(ConvertTo-SecureString $vmCreds.pw -asPlainText -Force)) if ((Test-Connection $vmCreds.url -Count 1 -Quiet) -eq $false) { $err = $error[0].FullyQualifiedErrorId } try { # Get disks information from Linux New-SSHSession -ComputerName $vmCreds.url -Credential $credential -Verbose -AcceptKey:$true $linuxCommand1 = 'ls -dl /sys/block/sd*/device/scsi_device/*' $linuxDisksData1 = Invoke-SSHCommand -SessionId 0 -Command $linuxCommand1 $linuxCommand2 = 'lsblk -l | grep /mnt' $linuxDisksData2 = Invoke-SSHCommand -SessionId 0 -Command $linuxCommand2 Remove-SSHSession -Index 0 -Verbose $linuxMounts = $linuxDisksData2.Output -replace '\s+', ' ' | Select @{N='Partition';E={($_.split(" ")[0])}}, @{N='linuxMount';E={($_.split(" ")[6])}} $linuxDisks = $linuxDisksData1.Output -replace '\s+', ' ' | Select @{N='Partition';E={($_.split(" ")[8]).split('/')[3]+'1'}}, @{N='SCSIAddr';E={(($_.split(" ")[8]).split('/')[6]).split(':')[1]+':'+(($_.split(" ")[8]).split('/')[6]).split(':')[2]}} $linuxDisks = $linuxDisks | sort SCSIAddr } catch { $err = $error[0].FullyQualifiedErrorId } #Get disks information from vmware $vmDisks = Get-VM -Name $vmName | Get-HardDisk | Select @{N='vmwareHardDisk';E={$_.Name}}, @{N='vSCSI';E={$_.uid.split("/")[3].split("=")[1]}}, @{N='SCSIAddr';E={[string]([math]::truncate((($_.uid.split("/")[3].split("=")[1])-2000)/16))+':'+[string]((($_.uid.split("/")[3].split("=")[1])-2000)%16)}} $vmDisks = $vmDisks | sort SCSIAddr #Get total information about VM Disks $OLAYtotalEffects = $vmDisks | InnerJoin $linuxDisks SCSIAddr -eq SCSIAddr | InnerJoin $linuxMounts Partition -eq Partition| sort vmwareHardDisk #Display total information about VM Disks $OLAYtotalEffects | ft $OLAYtotalEffects | ft 2&gt;$logFile #Get latest mount $linuxLatestDiskMount = [string](($OLAYtotalEffects | select linuxMount | where linuxMount -like "/mnt/data*" | % {[int](($_.linuxMount.Split("/")[2]).Replace("data",""))} | Measure -Maximum).Maximum) #Get latest vSCSI number $latestDiskvSCSI = ($OLAYtotalEffects | where {$_.linuxMount -eq "/mnt/data$linuxLatestDiskMount"}).vSCSI #Add HDD to VM $vm = Get-VM -Name $vmName New-HardDisk -VM $vm -CapacityGB $newHDDCapacity -Datastore $datastoreName -ThinProvisioned #Let the disk takes root Write-Host("Let the disk takes root...") sleep 10 if ((Test-Connection $vmCreds.url -Count 1 -Quiet) -eq $false) { $err = $error[0].FullyQualifiedErrorId } try { #Create partition &amp; FS, mount disk to directory, edit fstab...etc. New-SSHSession -ComputerName $vmCreds.url -Credential $credential -Verbose -AcceptKey:$true $results = Invoke-SSHCommand -SessionId 0 -Command "/mnt/autodoit.sh" Remove-SSHSession -Index 0 -Verbose $results.Output } catch { $err = $error[0].FullyQualifiedErrorId } #After adding a new disk, some checks are just performed if ((Test-Connection $vmCreds.url -Count 1 -Quiet) -eq $false) { $err = $error[0].FullyQualifiedErrorId } try { # Get disks information from Linux New-SSHSession -ComputerName $vmCreds.url -Credential $credential -Verbose -AcceptKey:$true $linuxCommand1 = 'ls -dl /sys/block/sd*/device/scsi_device/*' $linuxDisksData1 = Invoke-SSHCommand -SessionId 0 -Command $linuxCommand1 $linuxCommand2 = 'lsblk -l | grep /mnt' $linuxDisksData2 = Invoke-SSHCommand -SessionId 0 -Command $linuxCommand2 Remove-SSHSession -Index 0 -Verbose $linuxMounts = $linuxDisksData2.Output -replace '\s+', ' ' | Select @{N='Partition';E={($_.split(" ")[0])}}, @{N='linuxMount';E={($_.split(" ")[6])}} $linuxDisks = $linuxDisksData1.Output -replace '\s+', ' ' | Select @{N='Partition';E={($_.split(" ")[8]).split('/')[3]+'1'}}, @{N='SCSIAddr';E={(($_.split(" ")[8]).split('/')[6]).split(':')[1]+':'+(($_.split(" ")[8]).split('/')[6]).split(':')[2]}} $linuxDisks = $linuxDisks | sort SCSIAddr } catch { $err = $error[0].FullyQualifiedErrorId } #Get disks information from vmware $vmDisks = Get-VM -Name $vmName | Get-HardDisk | Select @{N='vmwareHardDisk';E={$_.Name}}, @{N='vSCSI';E={$_.uid.split("/")[3].split("=")[1]}}, @{N='SCSIAddr';E={[string]([math]::truncate((($_.uid.split("/")[3].split("=")[1])-2000)/16))+':'+[string]((($_.uid.split("/")[3].split("=")[1])-2000)%16)}} $vmDisks = $vmDisks | sort SCSIAddr #Get total information about VM Disks $OLAYtotalEffects = $vmDisks | InnerJoin $linuxDisks SCSIAddr -eq SCSIAddr | InnerJoin $linuxMounts Partition -eq Partition| sort vmwareHardDisk #Display total information about VM Disks $OLAYtotalEffects | ft $OLAYtotalEffects | ft 2&gt;$logFile Disconnect-VIServer -Confirm:$false Disable-ScheduledTask \PROD_TASKS\Add_HDD_OS0226</span></span></code> </pre> <br></div></div><br>  Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´ÙƒØ§ÙˆÙ‰ Ø¶Ø¯ UnionFS Ø› ÙÙ‡ÙŠ ØªØ¹Ù…Ù„ Ø¨Ø«Ø¨Ø§Øª Ù„Ø£ÙƒØ«Ø± Ù…Ù† Ø¹Ø§Ù…ÙŠÙ†. <br><br>  Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¹Ù† Ø³Ø¨Ø¨ ØªÙ†Ø¸ÙŠÙ… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ù… Ù‡Ùˆ Ø¨Ù„Ø§ØºÙŠ Ø¹Ø§Ù… ØŒ ÙÙ‚Ø· ØªÙ‚Ø¨Ù„Ù‡ ÙƒÙ…Ø§ Ù‡Ùˆ. <br><br>  ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø§Ø­Ø¸Ø© Ø£Ù†Ù‡ ÙŠØ¬Ø¨ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ù†ÙˆØ§Ø¹ Ù…Ø®ØªÙ„ÙØ© Ù…Ù† ØªØ¹ÙŠÙŠÙ† Ù…Ø­Ø±Ùƒ Ø§Ù„Ø£Ù‚Ø±Ø§Øµ Ù„Ø£Ù†Ø¸Ù…Ø© Ù…Ø®ØªÙ„ÙØ©.  Ù„Ø°Ù„Ùƒ ÙƒÙ† Ø­Ø°Ø±Ù‹Ø§ ÙˆØ³ØªØ£ØªÙŠ Ø§Ù„Ù‚ÙˆØ© Ù…Ø¹Ùƒ. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar440138/">https://habr.com/ru/post/ar440138/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar440122/index.html">ÙƒÙŠÙÙŠØ© ØµÙ†Ø¹ Ù…ØµØ¨Ø§Ø­ ÙŠØ¯ÙˆÙŠ Ù„Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ© Ø¨ÙŠØ¯ÙŠÙƒ (Ø§Ù„Ø¬Ø²Ø¡ 2)</a></li>
<li><a href="../ar440124/index.html">Ù„Ù…Ø§Ø°Ø§ Ù…Ø·ÙˆØ±ÙŠ Ø´Ø¨ÙƒØ§Øª ABBYY Mobile Ø§Ù„Ø¹ØµØ¨ÙŠØ© ÙˆÙ…ØªØ­Ù ÙˆÙ‚Ù‡ÙˆØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©</a></li>
<li><a href="../ar440130/index.html">ÙÙŠÙ… Ù„Ù„Ù…Ø¨ØªØ¯Ø¦ÙŠÙ†</a></li>
<li><a href="../ar440134/index.html">Ù†Ù‚Ù„ Ù…ÙˆÙ‚Ø¹ Ø¥Ù„Ù‰ Ø§Ø­ØµØ§Ø¦ÙŠØ§Øª: Ø§Ù„Ø¯Ø§ÙØ¹ ØŒ Ø§Ù„ØªÙƒÙ„ÙØ© ØŒ Ø§Ù„Ø¹Ù…Ù„</a></li>
<li><a href="../ar440136/index.html">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ø£ÙÙ‚ ØµÙØ± Ø§Ù„ÙØ¬Ø±: Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„ÙØ±Ø¯ÙŠ</a></li>
<li><a href="../ar440142/index.html">ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª ÙˆØ¨Ø¹Ø¶ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ·ÙˆÙŠØ± C \ C ++ ÙÙŠ VS Code</a></li>
<li><a href="../ar440148/index.html">Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ - Ø§Ù„Ø­ÙŠØ§Ø© Ø§Ù„Ù…ÙˆØ§Ø²ÙŠØ© Ù…Ø¹ Ø§Ù„ØªÙŠØ§Ø±Ø§Øª</a></li>
<li><a href="../ar440152/index.html">Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ø®Ø·ÙŠ DIY Ø£Ùˆ ÙƒÙŠÙÙŠØ© Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠØ© Ø§Ù„Ø£ØµÙŠÙ„Ø© Ù…Ø¹ Ù†ØªÙŠØ¬Ø© Ø¬ÙŠØ¯Ø©</a></li>
<li><a href="../ar440154/index.html">ÙƒÙŠÙ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Spore: Ù…Ù‚Ø§Ø¨Ù„Ø§Øª Ù…Ø¹ Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ†</a></li>
<li><a href="../ar440156/index.html">ÙƒÙŠÙÙŠØ© ØªÙ†Ø¸ÙŠÙ… Ø§Ù„ØªÙ†Ù…ÙŠØ© Ø§Ù„Ù…ÙˆØ²Ø¹Ø© ØŒ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ø°Ø§ ØºÙŠØ± Ù…Ù…ÙƒÙ†</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>