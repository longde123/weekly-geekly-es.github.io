<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöõ üë©üèæ‚Äçüé® üôÜüèº Ecrire TodoMVC sur dap. 2e partie üÜé üóº ü§≥üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il s'agit de la deuxi√®me, derni√®re partie du didacticiel dans laquelle nous √©crivons le client TodoMVC en utilisant le framework ds js r√©actif minimal...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ecrire TodoMVC sur dap. 2e partie</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481680/"> Il s'agit de la deuxi√®me, derni√®re partie du didacticiel dans laquelle nous √©crivons le client TodoMVC en utilisant le framework <a href="https://dap.js.org/" rel="nofollow">ds</a> js r√©actif minimaliste. <br><br>  R√©sum√© de la <a href="https://habr.com/en/post/480912/">premi√®re partie</a> : nous avons re√ßu une liste de t√¢ches du serveur au format JSON, cr√©√© une liste HTML √† partir de celui-ci, ajout√© la possibilit√© de modifier le nom et le signe d'ach√®vement pour chaque cas et impl√©ment√© une notification du serveur concernant ces modifications. <br><br>  Cela reste √† r√©aliser: suppression de cas arbitraires, ajout de nouveaux cas, installation / r√©initialisation de masse et filtrage des cas en fonction de l'ach√®vement et fonction de suppression de tous les cas termin√©s.  Voil√† ce que nous allons faire.  La version finale du client, √† laquelle nous reviendrons dans cet article, peut √™tre consult√©e <a href="https://dap.js.org/samples/tutorial/16.html" rel="nofollow">ici</a> . <br><br><a name="habracut"></a><br><br>  L'option sur laquelle nous nous sommes d√©cid√©s la derni√®re fois peut √™tre rafra√Æchie <a href="https://dap.js.org/samples/tutorial/7-3.html" rel="nofollow">ici</a> . <br><br>  Voici son code: <br><br><pre><code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#header'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'H1'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'INPUT#new-todo placeholder="What needs to be done?" autofocus'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ,<span class="hljs-string"><span class="hljs-string">'#main'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#toggle-all type=checkbox'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"*@ todos:query"</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed $editing= $patch=; a!"</span></span> ,<span class="hljs-string"><span class="hljs-string">'INPUT.toggle type=checkbox'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"#.checked=.completed"</span></span>) .ui(<span class="hljs-string"><span class="hljs-string">"$patch=($completed=#.checked)"</span></span>) ,<span class="hljs-string"><span class="hljs-string">'LABEL.view'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"? $editing:!; ! .title"</span></span>) .e(<span class="hljs-string"><span class="hljs-string">"dblclick"</span></span>,<span class="hljs-string"><span class="hljs-string">"$editing=`yes"</span></span>) ,<span class="hljs-string"><span class="hljs-string">'INPUT.edit'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"? $editing; !! .title@value"</span></span>) .ui(<span class="hljs-string"><span class="hljs-string">"$patch=(.title=#.value)"</span></span>) .e(<span class="hljs-string"><span class="hljs-string">"blur"</span></span>,<span class="hljs-string"><span class="hljs-string">"$editing="</span></span>) ,<span class="hljs-string"><span class="hljs-string">'BUTTON.destroy'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) .a(<span class="hljs-string"><span class="hljs-string">"!? $completed $editing"</span></span>) .u(<span class="hljs-string"><span class="hljs-string">"? $patch; (@method`PATCH .url:dehttp headers $patch@):query $patch="</span></span>) ) ) ,<span class="hljs-string"><span class="hljs-string">'#footer'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#todo-count'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'UL#filters'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ,<span class="hljs-string"><span class="hljs-string">'#clear-completed'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ) .DICT({ <span class="hljs-attr"><span class="hljs-attr">todos</span></span> : <span class="hljs-string"><span class="hljs-string">"//todo-backend-express.herokuapp.com/"</span></span>, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: {<span class="hljs-string"><span class="hljs-string">"Content-type"</span></span>:<span class="hljs-string"><span class="hljs-string">"application/json"</span></span>} }) .FUNC({ <span class="hljs-attr"><span class="hljs-attr">convert</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">dehttp</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function">=&gt;</span></span>url.replace(<span class="hljs-regexp"><span class="hljs-regexp">/^https?\:/</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>) } }) .RENDER()</code> </pre> <br><br>  Maintenant, il n'y a que cinquante lignes ici, mais √† la fin de l'article, il y en aura deux fois - jusqu'√† 100. Il y aura de nombreuses requ√™tes HTTP vers le serveur, alors veuillez ouvrir les outils de d√©veloppement (dans Chrome, comme vous vous en souvenez, Ctrl + Shift + I) - il y aura Tout d'abord, l'onglet R√©seau est int√©ressant, et deuxi√®mement, la console.  N'oubliez pas non plus d'afficher le code de chaque version de notre page - dans Chrome, c'est Ctrl + U. <br><br>  Ici, je dois faire une petite digression.  Si vous n'avez pas lu la <a href="https://habr.com/en/post/480912/">premi√®re partie du</a> didacticiel, je vous recommande tout de m√™me de commencer par celui-ci.  Si vous le lisez mais ne comprenez rien, il vaut mieux le relire.  Comme le montrent les commentaires sur mes deux articles pr√©c√©dents, la syntaxe et le principe de dap ne sont pas toujours imm√©diatement compris par un lecteur non pr√©par√©.  Un autre article n'est pas recommand√© pour la lecture aux personnes qui ne sont pas √† l'aise avec l'apparence d'une syntaxe non similaire √† la SI. <br><br><img src="https://habrastorage.org/webt/wj/-n/br/wj-nbrh5eflirkcich69glgnooo.jpeg"><br><br>  Cette deuxi√®me partie du tutoriel sera un peu plus compliqu√©e et int√©ressante que la premi√®re.  <i>[√Ä FAIRE: demandez un <a href="https://habr.com/en/users/token/" class="user_link">jeton pour</a> trouver une photo d'√©colier en train d'exploser un cerveau sur Internet]</i> . <br><br>  Avec votre permission, je continuerai √† num√©roter les chapitres avec la partie 1.  L√†, nous avons compt√© jusqu'√† 7. Donc, <br><br><h2>  8. Faire une liste de t√¢ches de la variable d'√©tat </h2><br>  Pour supprimer un cas de la liste, il existe un bouton <code>BUTTON.destroy</code> .  La suppression consiste √† envoyer une requ√™te DELETE au serveur et √† supprimer de la vue l'√©l√©ment <code>UL#todo-list &gt; LI</code> correspondant <code>UL#todo-list &gt; LI</code> avec tout le contenu.  Avec l'envoi d'une demande DELETE, tout est clair: <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'BUTTON.destroy'</span></span>.ui(<span class="hljs-string"><span class="hljs-string">"(@method`DELETE .url:dehttp):query"</span></span>)</code> </pre><br><br>  Mais avec la suppression d'un √©l√©ment de l'√©cran, des options sont possibles.  On pourrait simplement introduire une autre variable d'√©tat, par exemple <code>$deleted</code> , et masquer l'√©l√©ment avec CSS, y compris la classe CSS <code>deleted</code> <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed $editing= $patch= $deleted=; a!"</span></span> <span class="hljs-comment"><span class="hljs-comment">//  $deleted   "" ... ,'BUTTON.destroy'.d("(@method`DELETE .url:dehttp):query $deleted=`yes") //  $deleted -     ) .a("!? $completed $editing $deleted") //   CSS  .deleted{display:none}</span></span></code> </pre><br><br>  Et √ßa marcherait.  Mais ce serait tricher.  De plus, plus loin sur la ligne, nous aurons des filtres et des compteurs de cas actifs et termin√©s (ce qui se trouve dans <code>#footer</code> ).  Par cons√©quent, il est pr√©f√©rable de retirer imm√©diatement l'objet de la liste des t√¢ches honn√™tement, ¬´physiquement¬ª.  Autrement dit, nous devons pouvoir modifier le tableau lui-m√™me, que nous avons initialement re√ßu du serveur - ce qui signifie que ce tableau doit √©galement devenir une variable d'√©tat.  Appelons-la <code>$todos</code> . <br><br>  La port√©e de la variable <code>$todos</code> est de s√©lectionner l'anc√™tre commun de tous les √©l√©ments qui acc√©deront √† cette variable.  Et il sera accessible par <code>INPUT#new-todo</code> partir de <code>#header</code> , et les compteurs √† partir de <code>#footer</code> , et en fait <code>UL#todo-list</code> .  L'anc√™tre commun de tous est l'√©l√©ment racine du mod√®le, <code>#todoapp</code> .  Par cons√©quent, dans sa r√®gle d, nous d√©finirons la variable <code>$todos</code> .  Au m√™me endroit, nous y t√©l√©chargeons imm√©diatement les donn√©es du serveur.  Et pour construire la liste <code>UL#todo-list</code> , nous en serons d√©sormais aussi: <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$todos=todos:query"</span></span> <span class="hljs-comment"><span class="hljs-comment">//   $todos      ... ,'UL#todo-list'.d("*@ $todos" //     $todos</span></span></code> </pre><br><br>  <b>C'est important.</b>  Si pendant les tests, la liste de t√¢ches ne se charge pas soudainement - il est fort possible que quelqu'un les ait tous supprim√©s (il s'agit d'un serveur public et tout peut y arriver). <br>  Dans ce cas, veuillez consulter un <a href="https://dap.js.org/samples/tutorial/16.html" rel="nofollow">exemple complet</a> et cr√©er quelques cas √† exp√©rimenter. <br><br>  <a href="https://dap.js.org/samples/tutorial/8-1.html" rel="nofollow">Nous regardons</a> .  Ici, <code>$todos</code> <i>d√©clar√©</i> dans la r√®gle d de l'√©l√©ment <code>#todoapp</code> et est imm√©diatement <i>initialis√© avec les</i> donn√©es n√©cessaires.  Tout semble fonctionner, mais une caract√©ristique d√©sagr√©able est apparue.  Si le serveur r√©pond √† la demande depuis longtemps (Chrome vous permet de simuler cette situation: sur l'onglet R√©seau des outils de d√©veloppement, vous pouvez choisir diff√©rents modes de simulation de r√©seaux lents), alors notre nouvelle version de l'application jusqu'√† ce que la demande soit termin√©e semble un peu triste - il n'y a que du CSS artefacts.  Une telle image n'ajoutera certainement pas d'enthousiasme √† l'utilisateur.  Bien que la version pr√©c√©dente n'en souffre pas - jusqu'√† ce que les donn√©es soient re√ßues sur la page, seule la liste elle-m√™me manquait, mais d'autres √©l√©ments sont apparus imm√©diatement, sans attendre les donn√©es. <br><br>  Voici le truc.  Comme vous vous en souvenez, le <code>:query</code> converter est asynchrone.  Cette asynchronie s'exprime par le fait que jusqu'√† la fin de la requ√™te, seule l'ex√©cution de la r√®gle courante est bloqu√©e, c'est-√†-dire la g√©n√©ration de l'√©l√©ment, qui, en fait, a besoin des donn√©es demand√©es (ce qui est logique).  La g√©n√©ration d'autres √©l√©ments n'est pas bloqu√©e.  Par cons√©quent, lorsque <code>UL#todo-list</code> acc√©d√© au serveur, seul celui-ci a √©t√© bloqu√©, mais pas <code>#header</code> et pas <code>#footer</code> , qui ont √©t√© dessin√©s imm√©diatement.  Maintenant, <code>#todoapp</code> attend la fin de la demande. <br><br><h2>  9. Chargement diff√©r√© des donn√©es </h2><br>  Pour corriger la situation et √©viter de bloquer les √©l√©ments non impliqu√©s, nous reporterons le chargement initial des donn√©es jusqu'√† ce que tout soit d√©j√† trac√©.  Pour ce faire, nous ne chargerons pas imm√©diatement les donn√©es dans la variable <code>$todos</code> , mais nous les initialisons simplement avec ¬´rien¬ª <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$todos="</span></span> <span class="hljs-comment"><span class="hljs-comment">//   $todos    ""</span></span></code> </pre><br><br>  Elle ne bloquera donc rien et le mod√®le entier fonctionnera - bien que pour l'instant avec une ¬´liste de t√¢ches¬ª vide.  Mais maintenant, avec un √©cran initial ennuyeux, vous pouvez <i>modifier en</i> toute s√©curit√© <code>$todos</code> en y t√©l√©chargeant une liste de t√¢ches.  Pour ce faire, ajoutez ce descendant √† <code>#todoapp</code> <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'loader'</span></span> .u(<span class="hljs-string"><span class="hljs-string">"$todos=todos:query"</span></span>) <span class="hljs-comment"><span class="hljs-comment">//  $todos,       .d("u") //   (u-)   </span></span></code> </pre><br><br>  Cet √©l√©ment a une r√®gle u qui ressemble exactement √† la r√®gle de blocage que nous avons rejet√©e, mais il y a une diff√©rence fondamentale. <br>  Permettez-moi de vous rappeler que la r√®gle d (de <i>bas en haut</i> ) est la r√®gle de g√©n√©ration d'√©l√©ment qui est ex√©cut√©e lorsque le mod√®le est construit de haut en <i>bas</i> , du parent aux descendants;  et les r√®gles u (√† partir du <i>haut</i> ) sont des r√®gles de r√©action qui sont ex√©cut√©es en r√©ponse √† un √©v√©nement qui appara√Æt de bas en <i>haut</i> , de l'enfant au parent. <br>  Donc, si quelque chose (y compris ¬´rien¬ª) est assign√© <b>√† une</b> variable <b>dans la r√®gle d</b> , cela signifie sa <i>d√©claration et son initialisation</i> dans la port√©e de cet √©l√©ment et ses descendants (les port√©es imbriqu√©es sont impl√©ment√©es dans dap, comme dans JS )  L'affectation <b>dans les r√®gles ascendantes</b> signifie une <i>modification d'une</i> variable d√©clar√©e pr√©c√©demment dans la port√©e.  La d√©claration et l'initialisation des variables dans la r√®gle d permettent au parent de transmettre aux descendants de la hi√©rarchie les informations n√©cessaires √† la construction, et la modification permet au parent de transmettre les mises √† jour de ces informations vers le haut et ainsi de lancer la restructuration correspondante de tous les √©l√©ments qui en d√©pendent. <br><br>  L'√©l√©ment <code>loader</code> , √©tant un descendant de <code>#todoapp</code> , dans sa r√®gle u <b>modifie la</b> variable <code>$todos</code> , chargeant des donn√©es depuis le serveur, ce qui provoque la r√©g√©n√©ration automatique de tous les √©l√©ments consommateurs de cette variable (et seulement eux, ce qui est important!).  Les consommateurs d'une variable sont des √©l√©ments dont les r√®gles d contiennent cette variable en tant que valeur r, c'est-√†-dire  Ceux qui <b>lisent</b> cette variable (en tenant compte de la port√©e) lors de la construction. <br><br>  Nous avons maintenant un consommateur de la variable <code>$todos</code> - la liste de <code>UL#todo-list</code> tr√®s <code>UL#todo-list</code> , qui, en cons√©quence, sera reconstruite apr√®s le chargement des donn√©es. <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"*@ $todos"</span></span> <span class="hljs-comment"><span class="hljs-comment">//  ,   $todos</span></span></code> </pre><br><br>  Donc, <a href="https://dap.js.org/samples/tutorial/9.html" rel="nofollow">maintenant</a> nous avons une liste de choses √† faire est une variable d'√©tat dans <code>#todoapp</code> , sans bloquer le rendu initial du mod√®le. <br><br><h2>  10. Suppression et ajout de t√¢ches </h2><br>  Maintenant, nous pouvons modifier <code>$todos</code> tous les sens.  Commen√ßons par supprimer les √©l√©ments.  Nous avons d√©j√† un bouton crois√© <code>BUTTON.destroy</code> , qui jusqu'√† pr√©sent envoie simplement les demandes de suppression du serveur <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'BUTTON.destroy'</span></span>.ui(<span class="hljs-string"><span class="hljs-string">"(@method`DELETE .url:dehttp):query"</span></span>)</code> </pre><br><br>  Il est n√©cessaire de s'assurer que l'objet correspondant est √©galement supprim√© de la variable <code>$todos</code> - et puisqu'il s'agit d'une modification, <code>UL#todo-list</code> , en tant que consommateur de cette variable, sera automatiquement reconstruit, mais sans l'√©l√©ment supprim√©. <br><br>  En soi, dap ne fournit aucun moyen sp√©cial pour manipuler les donn√©es.  Les manipulations peuvent √™tre parfaitement √©crites dans des fonctions dans JS, et les r√®gles dap leur fournissent simplement des donn√©es et r√©cup√®rent le r√©sultat.  Nous √©crivons une fonction JS pour supprimer un objet d'un tableau sans conna√Ætre son num√©ro.  Par exemple, ceci: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> remove = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arr,tgt</span></span></span><span class="hljs-function">)=&gt;</span></span> arr.filter( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">obj</span></span></span><span class="hljs-function"> =&gt;</span></span> obj!=tgt );</code> </pre><br><br>  Vous pouvez probablement √©crire quelque chose de plus efficace, mais ce n'est pas le cas maintenant.  Il est peu probable que notre application doive fonctionner avec des listes de t√¢ches de millions d'√©l√©ments.  L'important est que la fonction retourne un nouvel objet tableau, et pas seulement supprime l'√©l√©ment de ce qu'il est. <br><br>  Pour rendre cette fonction accessible √† partir des r√®gles dap, vous devez l'ajouter √† la section <code>.FUNC</code> , mais avant cela, d√©cidez comment nous voulons l'appeler.  L'option la plus simple dans ce cas est, peut-√™tre, de l'appeler √† partir du convertisseur, qui accepte l'objet <code>{ todos, tgt }</code> et renvoie un tableau filtr√© <br><br><pre> <code class="javascript hljs">.FUNC({ <span class="hljs-attr"><span class="hljs-attr">convert</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">dehttp</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function"> =&gt;</span></span> url.replace(<span class="hljs-regexp"><span class="hljs-regexp">/^https?\:/</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>), <span class="hljs-comment"><span class="hljs-comment">//        remove: x =&gt; remove(x.todos,x.tgt) //     } })</span></span></code> </pre><br><br>  mais rien ne vous emp√™che de d√©finir cette fonction directement √† l'int√©rieur de <code>.FUNC</code> (j'ai d√©j√† dit que <code>.FUNC</code> est en fait une m√©thode JS r√©guli√®re, et son argument est un objet JS normal?) <br><br><pre> <code class="javascript hljs">.FUNC({ <span class="hljs-attr"><span class="hljs-attr">convert</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">dehttp</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function"> =&gt;</span></span> url.replace(<span class="hljs-regexp"><span class="hljs-regexp">/^https?\:/</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>), <span class="hljs-attr"><span class="hljs-attr">remove</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x.todos.filter( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todo</span></span></span><span class="hljs-function"> =&gt;</span></span> todo!=x.tgt ) } })</code> </pre><br><br>  Maintenant, nous pouvons acc√©der √† ce convertisseur √† partir des r√®gles DAP <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'BUTTON.destroy'</span></span> .ui(<span class="hljs-string"><span class="hljs-string">"$todos=($todos $@tgt):remove (@method`DELETE .url:dehttp):query"</span></span>)</code> </pre><br><br>  Ici, nous formons d'abord un objet qui, dans la notation JS, correspond √† <code>{ todos, tgt:$ }</code> , le transmettons au convertisseur <code>:remove</code> d√©crit dans <code>.FUNC</code> et <code>.FUNC</code> le r√©sultat filtr√© √† <code>$todos</code> , le modifiant ainsi.  Ici <code>$</code> est le <i>contexte de donn√©es de l'</i> √©l√©ment, cet objet m√©tier du tableau <code>$todos</code> sur lequel le mod√®le est construit.  Apr√®s le symbole <code>@</code> , l'alias de l'argument est indiqu√©.  Si <code>@</code> absent, alors le propre nom de l'argument est utilis√©.  Ceci est similaire √† la r√©cente innovation ES6 - <a href="http://es6-features.org/" rel="nofollow">raccourci immobilier</a> . <br><br>  De m√™me, nous ajoutons un nouveau cas √† la liste en utilisant l'√©l√©ment <code>INPUT#new-todo</code> et la requ√™te POST <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT#new-todo placeholder="What needs to be done?" autofocus'</span></span> .ui(<span class="hljs-string"><span class="hljs-string">"$=(#.value@title) (@method`POST todos@url headers $):query $todos=($todos $@tgt):insert #.value="</span></span>) ... .FUNC({ <span class="hljs-attr"><span class="hljs-attr">convert</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">dehttp</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function"> =&gt;</span></span> url.replace(<span class="hljs-regexp"><span class="hljs-regexp">/^https?\:/</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>), <span class="hljs-attr"><span class="hljs-attr">remove</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x.todos.filter( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todo</span></span></span><span class="hljs-function"> =&gt;</span></span> todo!=x.tgt ), <span class="hljs-comment"><span class="hljs-comment">//     insert: x =&gt; x.todos.concat( [x.tgt] ) //     } })</span></span></code> </pre><br><br>  La r√®gle de r√©action de l'√©l√©ment <code>INPUT#new-todo</code> √† un √©v√©nement d'interface utilisateur standard (pour les √©l√©ments <code>INPUT</code> , l'√©v√©nement <code>change</code> est consid√©r√© comme le dap standard) comprend: la lecture des entr√©es utilisateur √† partir de la propri√©t√© <code>value</code> de cet √©l√©ment, la formation d'un contexte local <code>$</code> avec cette valeur comme champ <code>.title</code> , l'envoi de <code>$</code> context au serveur √† l'aide de la m√©thode POST, en modifiant le tableau <code>$todos</code> en ajoutant le contexte <code>$</code> tant que nouvel √©l√©ment et enfin en effa√ßant la propri√©t√© <code>value</code> de l'√©l√©ment <code>INPUT</code> . <br><br>  Ici, un jeune lecteur peut se demander: pourquoi utiliser <a href="https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Array/concat" rel="nofollow"><code>concat()</code></a> lors de l'ajout d'un √©l√©ment √† un tableau, si cela peut √™tre fait en utilisant <a href="https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Array/push" rel="nofollow"><code>push()</code></a> normal?  Un lecteur exp√©riment√© comprendra imm√©diatement le probl√®me et notera sa r√©ponse dans les commentaires. <br><br>  Nous regardons ce qui <a href="https://dap.js.org/samples/tutorial/10-1.html" rel="nofollow">s'est pass√©: les</a> cas sont ajout√©s et supprim√©s normalement, les demandes correspondantes sont envoy√©es correctement au serveur (vous gardez l'onglet R√©seau ouvert tout ce temps, non?).  Mais que faire si nous voulons changer le nom ou le statut d'un cas fra√Æchement ajout√©?  Le probl√®me est que pour notifier le serveur de ces modifications, nous avons besoin de <code>.url</code> , qui affecte le serveur √† cette entreprise.  Lorsque nous avons cr√©√© l'entreprise, <code>.url</code> ne connaissions pas son <code>.url</code> , respectivement, nous ne pouvons pas former la demande de modification PATCH correcte. <br><br>  En fait, toutes les informations n√©cessaires sur le cas sont contenues dans la r√©ponse du serveur √† la demande POST, et il serait plus correct de cr√©er un nouvel objet m√©tier non seulement √† partir de l'entr√©e utilisateur, mais √† partir de la r√©ponse du serveur, et d'ajouter cet objet √† <code>$todos</code> - avec toutes les informations fournies informations sur le serveur, y compris le champ <code>.url</code> <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT#new-todo placeholder="What needs to be done?" autofocus'</span></span> .ui(<span class="hljs-string"><span class="hljs-string">"$todos=($todos (@method`POST todos@url headers (#.value@title)):query@tgt ):insert #.value="</span></span>)</code> </pre><br><br>  Nous regardons - d'accord, maintenant tout se d√©roule correctement.  Les notifications au serveur concernant la modification des cas fra√Æchement cr√©√©s vont bien. <br><br>  On pourrait s'arr√™ter l√†, mais ... Mais si vous regardez de plus pr√®s, vous pouvez toujours remarquer un l√©ger d√©lai entre la saisie du nom du nouveau bo√Ætier et le moment o√π il appara√Æt dans la liste.  Ce d√©lai est clairement visible si vous activez un r√©seau lent simul√©.  Comme vous l'avez peut-√™tre devin√©, il s'agit d'une demande au serveur: d'abord, nous demandons des donn√©es pour un nouveau cas au serveur, et seulement apr√®s les avoir re√ßus, nous modifions <code>$todos</code> .  L'√©tape suivante, nous essaierons de corriger cette situation, mais je vais d'abord attirer votre attention sur un autre point int√©ressant.  Si l'on revient un peu √† la <a href="https://dap.js.org/samples/tutorial/10-1.html" rel="nofollow">version pr√©c√©dente</a> , on note: bien que la requ√™te soit √©galement l√†, le nouveau cas est ajout√© √† la liste instantan√©ment, sans attendre la fin de la requ√™te <br><br><pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">//    , :query   .ui("$=(#.value@title) (@method`POST todos@url headers $):query $todos=($todos $@tgt):insert #.value=")</span></span></code> </pre><br><br>  C'est une autre caract√©ristique de l'√©laboration de convertisseurs asynchrones en dap: si le r√©sultat du convertisseur asynchrone n'est pas utilis√© (√† savoir, il n'est affect√© √† rien), vous ne pouvez pas attendre sa fin - et l'ex√©cution de la r√®gle n'est pas bloqu√©e.  Ceci est souvent utile: vous avez peut-√™tre remarqu√© que lors de la suppression de cas de la liste, ils disparaissent instantan√©ment de l'√©cran, sans attendre le r√©sultat de la demande DELETE.  Cela est particuli√®rement visible si vous supprimez rapidement plusieurs cas cons√©cutifs et suivez les demandes dans le panneau R√©seau. <br><br>  Mais, puisque nous utilisons le r√©sultat de la requ√™te POST - l'affectons au contexte <code>$</code> - nous devons attendre qu'il se termine.  Par cons√©quent, vous devez trouver un autre moyen de modifier <code>$todos</code> avant d'ex√©cuter la demande POST.  Solution: toujours, cr√©ez d'abord un nouvel objet m√©tier et ajoutez-le imm√©diatement √† <code>$todos</code> , laissez la liste dessiner, puis seulement, apr√®s le rendu, si l'entreprise <code>.url</code> pas <code>.url</code> (c'est-√†-dire que l'entreprise vient d'√™tre cr√©√©e), ex√©cutez une demande POST, et imposer son r√©sultat au contexte de donn√©es de cette affaire. <br><br>  Donc, tout d'abord, nous ajoutons simplement un blanc contenant uniquement <code>.title</code> √† la <code>.title</code> <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT#new-todo placeholder="What needs to be done?" autofocus'</span></span> .ui(<span class="hljs-string"><span class="hljs-string">"$todos=($todos (#.value@title)@tgt):insert #.value="</span></span>)</code> </pre><br><br>  <code>UL#todo-list &gt; LI</code> La r√®gle de g√©n√©ration d'√©l√©ment <code>UL#todo-list &gt; LI</code> contient d√©j√† <code>a!</code>  d√©marrer une r√®gle a apr√®s le premier dessin de l'√©l√©ment.  Nous pouvons y ajouter le lancement d'une requ√™te POST en l'absence de <code>.url</code> .  Pour injecter des champs suppl√©mentaires dans le contexte, dap a l'op√©rateur <code>&amp;</code> <br><br><pre> <code class="javascript hljs"> .a(<span class="hljs-string"><span class="hljs-string">"!? $completed $editing; ? .url:!; &amp; (@method`POST todos@url headers $):query"</span></span>)</code> </pre><br><br>  <a href="https://dap.js.org/samples/tutorial/10-3.html" rel="nofollow">Nous regardons</a> .  Une autre chose!  M√™me avec un r√©seau lent, la liste des t√¢ches est mise √† jour instantan√©ment, et la notification du serveur et le chargement des donn√©es manquantes se produisent en arri√®re-plan, apr√®s avoir trac√© la liste mise √† jour. <br><br><h2>  11. Daw tout le monde! </h2><br>  Dans l'√©l√©ment <code>#header</code> , il y a un bouton pour une installation en masse / r√©initialisation du signe d'ach√®vement pour tous les cas de la liste.  Pour l'affectation en masse de valeurs aux champs des √©l√©ments du tableau, nous √©crivons simplement un autre convertisseur <code>:assign</code> , et l'appliquons √† <code>$todos</code> en cliquant sur <code>INPUT#toggle-all</code> <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT#toggle-all type=checkbox'</span></span> .ui(<span class="hljs-string"><span class="hljs-string">"$todos=($todos (#.checked@completed)@src):assign"</span></span>) ... assign: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x.todos &amp;&amp; x.todos.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todo</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign(todo,x.src))</code> </pre><br><br>  Dans ce cas, nous ne sommes int√©ress√©s que par le champ <code>.completed</code> , mais il est facile de voir qu'avec un tel convertisseur, vous pouvez modifier massivement les valeurs de tous les champs des √©l√©ments du tableau. <br>  Ok, dans le tableau <code>$todos</code> , les <code>$todos</code> commut√©es, nous devons maintenant informer le serveur des modifications apport√©es.  Dans l'exemple d'origine, cela se fait en envoyant des requ√™tes PATCH pour chaque cas - pas une strat√©gie tr√®s efficace, mais cela ne d√©pend plus de nous.  Ok, pour chaque cas, nous envoyons une demande de PATCH <br><br><pre> <code class="javascript hljs"> .ui(<span class="hljs-string"><span class="hljs-string">"*@ $todos=($todos (#.checked@completed)@src):assign; (@method`PATCH .url:dehttp headers (.completed)):query"</span></span>)</code> </pre><br><br>  <a href="https://dap.js.org/samples/tutorial/11.html" rel="nofollow">Nous regardons</a> : Un clic sur un daw commun aligne tous les daw individuels, et le serveur est averti par des requ√™tes PATCH appropri√©es.  Norm <br><br><h2>  12. Filtrage des cas en fonction de l'ach√®vement </h2><br>  En plus de la liste de t√¢ches r√©elle, l'application doit √©galement √™tre en mesure de filtrer les cas par le signe d'ach√®vement et d'afficher les compteurs des t√¢ches termin√©es et inachev√©es.  Bien s√ªr, pour le filtrage, il sera trivial d'utiliser la m√™me m√©thode <a href="https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Array/filter" rel="nofollow"><code>filter()</code></a> fournie par JS lui-m√™me. <br><br>  Mais vous devez d'abord vous assurer que le champ <code>.completed</code> de chaque cas est toujours vrai, et lorsque vous cliquez sur l'index individuel du cas est mis √† jour avec la variable <code>$completed</code> .  Auparavant, cela n'√©tait pas important pour nous, mais ce le sera d√©sormais. <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT.toggle type=checkbox'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"#.checked=.completed"</span></span>) .ui(<span class="hljs-string"><span class="hljs-string">"$patch=(.completed=$completed=#.checked) $recount=()"</span></span>) <span class="hljs-comment"><span class="hljs-comment">//  .completed       </span></span></code> </pre><br><br>  Le point important ici est que le contexte de donn√©es de chaque cas est l'objet de cas lui-m√™me, qui se trouve dans le tableau <code>$todos</code> .  Pas une seule copie, ou construction connexe, mais l'objet lui-m√™me.  Et tous les appels aux champs <code>.title</code> , <code>.completed</code>  <code>url</code> - √† la fois en lecture et en √©criture - s'applique directement √† cet objet.  Par cons√©quent, pour que le filtrage du tableau <code>$todos</code> fonctionne correctement, nous devons que l'ach√®vement du cas soit refl√©t√© non seulement dans le daw √† l'√©cran, mais √©galement dans le champ <code>.completed</code> de l'objet <code>.completed</code> . <br><br>  Afin de n'afficher que les cas avec le signe n√©cessaire de compl√©tude <code>.completed</code> dans la liste, nous <code>.completed</code> simplement <code>$todos</code> selon le filtre s√©lectionn√©.  Le filtre s√©lectionn√© est, vous l'aurez devin√©, une autre variable d'√©tat de notre application, et nous l'appellerons: <code>$filter</code> .  Pour filtrer <code>$todos</code> fonction du <code>$filter</code> s√©lectionn√© <code>$filter</code> allons le long de la vignette et ajoutons simplement un autre convertisseur, de la forme <i>{list, filter} =&gt; la liste filtr√©e</i> , et nous prendrons les noms et les fonctions de filtrage du "tableau associatif" (c'est-√†-dire JS ordinaire objet) <code>todoFilters</code> <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> todoFilters={ <span class="hljs-string"><span class="hljs-string">"All"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"Active"</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todo</span></span></span><span class="hljs-function"> =&gt;</span></span> !todo.completed, <span class="hljs-string"><span class="hljs-string">"Completed"</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todo</span></span></span><span class="hljs-function"> =&gt;</span></span> !!todo.completed }; <span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$todos= $filter="</span></span> <span class="hljs-comment"><span class="hljs-comment">//   $filter ... ,'UL#todo-list'.d("* ($todos $filter):filter" ... ,'UL#filters'.d("* filter" //  filter      .DICT ,'LI' .d("! .filter") .ui("$filter=.") //    "$filter=.filter" ) ... .DICT({ ... filter: Object.keys(todoFilters) //["All","Active","Completed"] }) .FUNC({ convert:{ ... filter: x =&gt;{ const a = x.todos, f = x.filter &amp;&amp; todoFilters[x.filter]; return a&amp;&amp;f ? a.filter(f) : a; } } })</span></span></code> </pre><br><br>  <a href="https://dap.js.org/samples/tutorial/12-1.html" rel="nofollow">Nous v√©rifions</a> .  Les filtres fonctionnent correctement.  Il y a une nuance dans le fait que les noms des filtres sont affich√©s ensemble, car  ici, nous sommes un peu sortis de la structure DOM de l'original et sommes sortis de CSS.  Mais nous y reviendrons un peu plus tard. <br><br><h2>  13. Compteurs de cas termin√©s et actifs. </h2><br>  Pour afficher les compteurs des cas termin√©s et actifs, il suffit de filtrer <code>$todos</code> avec les filtres appropri√©s et d'afficher les longueurs des tableaux r√©sultants <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'#footer'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$active=($todos @filter`Active):filter $completed=($todos @filter`Completed):filter"</span></span> ,<span class="hljs-string"><span class="hljs-string">'#todo-count'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"! (active $active.length)format"</span></span>) <span class="hljs-comment"><span class="hljs-comment">//  length    active ... ,'#clear-completed'.d("! (completed $completed.length)format") ) ... .DICT({ ... active: "{length} items left", completed: "Clear completed items ({length})" })</span></span></code> </pre><br><br>  Dans <a href="https://dap.js.org/samples/tutorial/13-1.html" rel="nofollow">ce formulaire, les</a> compteurs affichent les valeurs correctes au d√©marrage, mais ne r√©pondent pas aux changements ult√©rieurs dans la fin des affaires (en cliquant sur les daws).  Le fait est que les clics sur les choucas, changeant l'√©tat de chaque cas individuel, ne changent pas l'√©tat de <code>$todos</code> - une modification d'un √©l√©ment de tableau n'est pas une modification du tableau lui-m√™me.  Par cons√©quent, nous avons besoin d'un signal suppl√©mentaire sur la n√©cessit√© de r√©enregistrer les cas.  Un tel signal peut √™tre une variable d'√©tat suppl√©mentaire, qui est modifi√©e √† chaque fois qu'un nouveau comptage est n√©cessaire.  Appelez √ßa <code>$recount</code> .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous d√©clarerons un anc√™tre commun dans la r√®gle d, nous le mettrons √† jour lorsque nous cliquons sur les m√¢les, et nous </font></font><code>#footer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ferons de l' </font><font style="vertical-align: inherit;">√©l√©ment un </font><font style="vertical-align: inherit;">consommateur - pour cela, mentionnez simplement cette variable dans sa r√®gle d</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$todos= $filter= $recount="</span></span> <span class="hljs-comment"><span class="hljs-comment">//  $recount     ... ,'INPUT.toggle type=checkbox' .d("#.checked=.completed") .ui("$patch=(.completed=$completed=#.checked) $recount=()") //  $recount    ... ,'#footer'.d("$active=($todos @filter`Active):filter $completed=($todos @filter`Completed):filter $recount" //  $recount</span></span></code> </pre><br><br> <a href="https://dap.js.org/samples/tutorial/13-2.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tout fonctionne comme il se doit, les compteurs sont mis √† jour correctement.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 14. Suppression de tous les cas termin√©s. </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La suppression par lot des cas dans TodoMVC est impl√©ment√©e comme non casher en tant que modification par lot - par plusieurs demandes. </font><font style="vertical-align: inherit;">Eh bien, soupirons, haussons les mains et ex√©cutons par DELETE-request pour chaque cas termin√© - et nous les avons d√©j√† tous </font></font><code>$completed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En cons√©quence, </font></font><code>$todos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apr√®s la suppression des dossiers termin√©s, ce qui devrait d√©j√† √™tre</font></font><code>$active</code> <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'#clear-completed'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"! (completed $completed.length)format"</span></span>) .ui(<span class="hljs-string"><span class="hljs-string">"$todos=$active; *@ $completed; (@method`DELETE .url:dehttp):query"</span></span>)</code> </pre><br><br> <a href="https://dap.js.org/samples/tutorial/14.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous regardons</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : nous cr√©ons des affaires inutiles, les marquons avec des griffes et les supprimons. </font><font style="vertical-align: inherit;">L'onglet R√©seau montrera l'horreur de cette approche des op√©rations par lots.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 15. Statut dans la barre d'adresse </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retour √† la s√©lection des filtres. </font><font style="vertical-align: inherit;">Dans l'exemple d'origine, le filtre s√©lectionn√© se refl√®te dans la barre d'adresse apr√®s #. </font><font style="vertical-align: inherit;">Lorsque vous modifiez le # -fragment dans la barre d'adresse manuellement ou pendant la navigation, le filtre s√©lectionn√© change √©galement. </font><font style="vertical-align: inherit;">Cela vous permet d'acc√©der √† la page de l'application par URL avec le filtre de t√¢ches d√©j√† s√©lectionn√©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez √©crire avec un </font></font><code>location.hash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">op√©rateur </font></font><code>urlhash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, par exemple, dans la r√®gle a d'un √©l√©ment </font></font><code>#todoapp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ou l'un de ses descendants), qui sera ex√©cut√©e √† chaque fois</font></font><code>$filter</code> <br><br><pre> <code class="javascript hljs">.a(<span class="hljs-string"><span class="hljs-string">"urlhash $filter"</span></span>)</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et vous pouvez initialiser la variable avec une </font></font><code>$filter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valeur de la barre d'adresse, puis la mettre √† jour par l'√©v√©nement </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hashchange √† l'</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aide d'un pseudo-convertisseur </font></font><code>:urlhash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui retourne l'√©tat actuel </font></font><code>location.hash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(sans #)</font></font><br><br><pre> <code class="javascript hljs">.d(<span class="hljs-string"><span class="hljs-string">"$todos= $filter=:urlhash $recount="</span></span> .e(<span class="hljs-string"><span class="hljs-string">"hashchange"</span></span>,<span class="hljs-string"><span class="hljs-string">"$filter=:urlhash"</span></span>)</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'√©v√©nement </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hashchange</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><i><font style="vertical-align: inherit;">d√©clench√©</font></i><font style="vertical-align: inherit;"> par le navigateur lorsqu'un # -fragment dans la barre d'adresse change. </font><font style="vertical-align: inherit;">Cependant, pour une raison que </font></font><code>window</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et </font></font><code>document.body</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut √©couter cet √©v√©nement. </font><font style="vertical-align: inherit;">Pour suivre cet √©v√©nement √† partir d'un √©l√©ment </font></font><code>#todoapp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, vous devrez ajouter un op√©rateur √† sa r√®gle d </font></font><code>listen</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui signe l'√©l√©ment pour relayer les √©v√©nements de l'objet</font></font><code>window</code> <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span> .a(<span class="hljs-string"><span class="hljs-string">"urlhash $filter"</span></span>) .e(<span class="hljs-string"><span class="hljs-string">"hashchange"</span></span>,<span class="hljs-string"><span class="hljs-string">"$filter=:urlhash"</span></span>) .d(<span class="hljs-string"><span class="hljs-string">"$todos= $filter=:urlhash $recount=; listen @hashchange"</span></span></code> </pre><br><br> <a href="https://dap.js.org/samples/tutorial/15-1.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous regardons</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : changer de filtre, suivre les changements dans la barre d'adresse, suivre les liens avec </font></font><a href="https://dap.js.org/samples/tutorial/15-1.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#Active</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://dap.js.org/samples/tutorial/15-1.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#All</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://dap.js.org/samples/tutorial/15-1.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#Completed</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tout fonctionne. </font><font style="vertical-align: inherit;">Mais revenons √† l'original. </font><font style="vertical-align: inherit;">L√†, il semble, le choix du filtre est mis en ≈ìuvre - en cliquant sur les liens. </font><font style="vertical-align: inherit;">Bien que ce ne soit pas tr√®s pratique, nous ferons de m√™me pour √™tre complet.</font></font><br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'UL#filters'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"* filter"</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'A'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"!! (`# .filter)concat@href .filter@"</span></span>) ) )</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et pour faire ressortir le filtre s√©lectionn√©, ajoutez un op√©rateur de stylisation conditionnelle </font></font><code>!?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui ajoutera une classe CSS √† l'√©l√©ment </font></font><code>selected</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si la valeur dans le champ de </font></font><code>.filter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contexte est √©gale √† la valeur de la variable</font></font><code>$filter</code> <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'A'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"!! (`# .filter)concat@href .filter@; !? (.filter $filter)eq@selected"</span></span>)</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sous </font></font><a href="https://dap.js.org/samples/tutorial/15-2.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cette forme, la</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonctionnalit√© de notre application dap est d√©j√† pleinement (pour autant que je sache) coh√©rente avec ce que fait l' </font></font><a href="https://todo-backend-express.herokuapp.com/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">original</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 16. Quelques touches finales </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je n'aime pas vraiment que dans l'original la forme du curseur ne change pas sur les √©l√©ments actifs, nous allons donc ajouter </font></font><code>head</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce style </font><font style="vertical-align: inherit;">√† </font><font style="vertical-align: inherit;">notre document HTML</font></font><br><br><pre> <code class="javascript hljs"> [ui=click]{<span class="hljs-attr"><span class="hljs-attr">cursor</span></span>:pointer}</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Donc, au moins, nous verrons o√π vous pouvez cliquer. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oh oui! </font><font style="vertical-align: inherit;">Il reste √† √©crire le mot "todos" en majuscules. </font><font style="vertical-align: inherit;">Mais ici, je me permettrai peut-√™tre enfin de montrer un peu d'imagination et de cr√©ativit√©, et au lieu de simplement "todos" j'√©crirai "dap todos"</font></font><br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'H1'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-string"><span class="hljs-string">"dap todos"</span></span>)</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouah. </font><font style="vertical-align: inherit;">Maintenant, </font></font><a href="https://dap.js.org/samples/tutorial/16.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notre application</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peut √™tre consid√©r√©e comme compl√®te et le tutoriel peut √™tre tenu (si vous lisez honn√™tement ces lignes).</font></font><br><br><h2>  En conclusion </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Peut-√™tre qu'en lisant, vous avez eu l'impression que le programme dap est √©crit par essais et erreurs - ce sont tous ¬´voyons ce qui s'est pass√©¬ª, ¬´il semble fonctionner, mais il y a une nuance¬ª, etc. </font></font> Ce n'est en fait pas le cas.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toutes ces nuances sont assez √©videntes et pr√©visibles lors de l'√©criture de code. </font><font style="vertical-align: inherit;">Mais j'ai pens√© qu'il serait utile de montrer par l'exemple de ces nuances pourquoi telle ou telle d√©cision est pr√©sente dans les r√®gles et pourquoi elle se fait de cette fa√ßon et pas autrement. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Posez, comme on dit, des questions.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr481680/">https://habr.com/ru/post/fr481680/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr481670/index.html">Cr√©er un plan d'action √† l'aide de AWS Cloud Adoption Framework</a></li>
<li><a href="../fr481672/index.html">Automates cellulaires dans le navigateur</a></li>
<li><a href="../fr481674/index.html">Entonnoir de vente de voitures ou comment ne pas fusionner les clients et m√™me travailler avec ceux qui ont refus√© vos services?</a></li>
<li><a href="../fr481676/index.html">Semaine de s√©curit√© 52: S√©curit√© des haut-parleurs intelligents et des cam√©ras IP</a></li>
<li><a href="../fr481678/index.html">Examen avant les vacances: lecteur N6IIT01 et casque YB04 Armature - Hi-Fi du sud de la Chine</a></li>
<li><a href="../fr481684/index.html">Un ordinateur portable de Powerbank?</a></li>
<li><a href="../fr481688/index.html">Pourquoi apprendre Java et comment le faire efficacement. Rapport Yandex</a></li>
<li><a href="../fr481692/index.html">Utilisation de Intel Processor Trace pour tracer le code du mode de gestion du syst√®me</a></li>
<li><a href="../fr481694/index.html">Ma fa√ßon de partitionner dans PostgreSQL</a></li>
<li><a href="../fr481696/index.html">r√®gle: contr√¥le dynamique de Go</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>