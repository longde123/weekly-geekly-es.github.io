<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌔 🎣 🚳 微服务：即使您拥有Kubernetes，规模也很重要 🙍 🔓 📴</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="9月19日， 第一个主题metap HUG（高负载++用户组）在莫斯科举行 ，专门针对微服务。 这份报告“微服务的运营：即使您拥有Kubernetes，规模也很重要”，在这份报告中，我们分享了Flant在使用微服务架构运营项目方面的丰富经验。 首先，它将对所有正在考虑在当前或将来的项目中采用这种方法...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>微服务：即使您拥有Kubernetes，规模也很重要</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/424531/">  9月19日， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第</a>一个主题metap HUG（高负载++用户组）在莫斯科<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">举行</a> ，专门针对微服务。 这份报告“微服务的运营：即使您拥有Kubernetes，规模也很重要”，在这份报告中，我们分享了Flant在使用微服务架构运营项目方面的丰富经验。 首先，它将对所有正在考虑在当前或将来的项目中采用这种方法的开发人员有用。 <br><br><img src="https://habrastorage.org/webt/jb/ka/cp/jbkacpew1yyus4jx9l5rbdpc3iq.jpeg"><br><br> 我们将<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b>视频与报告一起</b></a>呈现（50分钟，比文章多得多），并以文本形式提供其主要摘录。 <br><br>  <i>注意：视频和演示文稿也可以在本出版物的末尾获得。</i> <a name="habracut"></a><br><br><h2> 引言 </h2><br> 通常，一个好故事有一个情节，一个主要情节和一个结局。 这份报告更像是一个阴谋，而且是悲惨的。 同样重要的是要注意它提供了微服务的<i>运行情况</i> 。 <br><br> 我将从这样一个时间表开始，该时间表的作者（在2015年） <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">是</a> Martin Fowler： <br><br><img src="https://habrastorage.org/webt/lj/fo/rz/ljforzqes2fsafgqo6gvhxfrpue.png"><br><br> 它显示了在单片应用程序已达到一定值的情况下，工作效率如何开始下降。 微服务的不同之处在于，微服务的初始生产率较低，但是，随着复杂性的提高，它们的效率下降并不是那么明显。 <br><br> 对于使用Kubernetes的情况，我将对此图进行补充： <br><br><img src="https://habrastorage.org/webt/b1/co/v-/b1cov-wky66lpvijeu0cgf72u9y.png"><br><br> 为什么微服务应用程序会变得更好？ 因为这样的架构提出了严重的架构要求，而Kubernetes功能又可以完美地覆盖这些要求。 另一方面，此功能的一部分对整体结构也很有用，特别是因为当今的典型整体结构并非完全是整体结构（详细信息将在报告中进一步介绍）。 <br><br> 如您所见，最终时间表（当使用Kubernetes的基础架构中的单片和微服务应用程序时）与原始时间表没有太大差异。 接下来，我们将讨论使用Kubernetes运行的应用程序。 <br><br><h2> 有用和有害的微服务 </h2><br> 这里的主要思想是： <br><br><img src="https://habrastorage.org/webt/fa/ks/uz/faksuzabviitaowg8rxaaxz3hgi.jpeg"><br><br> 什么是<b>正常的</b>微服务架构？ 它应该为您带来真正的好处，提高工作效率。 如果您返回图表，则为： <br><br><img src="https://habrastorage.org/webt/az/mn/jv/azmnjv4kc7fnk36mxvhodoirsk8.png"><br><br> 如果您认为它<b>有用</b> ，那么在图的另一侧，将会有<b>有害的</b>微服务（干扰工作）： <br><br><img src="https://habrastorage.org/webt/fh/nt/y4/fhnty40ebkuydrbdwacgmxmnghk.png"><br><br> 回到“主要思想”：完全值得信赖我的经验吗？ 从今年年初开始，我研究了<b>85个项目</b> 。 并非所有人都是微服务（大约三分之一到一半拥有这种架构），但这仍然是一个很大的数目。 作为外包商，我们（弗兰特公司）设法看到在小型公司（有5个开发人员）和大型公司（约500个开发人员）中开发了各种各样的应用程序。 另外一个好处是，我们可以看到这些应用程序多年来如何生存和发展。 <br><br><h2> 为什么选择微服务？ </h2><br> 对于有关微服务的好处的问题，已经提到的Martin Fowler有一个<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">非常具体的答案</a> ： <br><br><ol><li> 明确的模块化界限； </li><li> 独立部署； </li><li> 选择技术的自由。 </li></ol><br> 我与架构师和软件开发人员进行了很多交谈，并询问为什么他们需要微服务。 并整理了他的期望清单。 这是发生了什么： <br><br><img src="https://habrastorage.org/webt/su/g3/nb/sug3nbuvq8arpcszp9eprf0swto.png"><br><br> 如果您“有些激动”地描述了一些观点，那么： <br><br><ul><li> 明确的模块边界：这里我们有一个可怕的整体，现在所有内容都将被整齐地放置在Git存储库中，其中所有内容都“摆在架子上”，而不是温暖和柔软的混合； </li><li> 部署独立性：我们将能够独立推出服务，从而加快开发速度（并行发布新功能）； </li><li> 开发独立性：我们可以将此微服务提供给该团队/开发人员，以及另一个，以便我们可以更快地进行开发； </li><li> 更高的可靠性：如果发生部分降级（20个故障中有1个微服务），那么只有一个按钮将停止工作，整个系统将继续运行。 </li></ul><br><h2> 典型的（有害的）微服务架构 </h2><br> 为了解释为什么实际上一切都不如我们期望的那样，我将基于许多不同项目的经验，提供微服务体系结构的<i>总体</i>形象。 <br><br> 一个例子是将要与亚马逊或至少与OZON竞争的抽象在线商店。 其微服务架构如下所示： <br><br><img src="https://habrastorage.org/webt/ly/sl/7-/lysl7-cb72eaj8wnhes4bgina84.gif"><br><br> 由于多种原因，这些微服务是在不同的平台上编写的： <br><br><img src="https://habrastorage.org/webt/x6/hu/rt/x6hurt6jnp-cdugf_mcopvhaqu8.png"><br><br> 由于每个微服务都应具有自治权，因此许多微服务需要自己的数据库和缓存。 最终的体系结构如下： <br><br><img src="https://habrastorage.org/webt/ee/dr/_x/eedr_xp3mh22lyb9b04ewqzm1ek.png"><br><br><h2> 其后果是什么？ </h2><br>  Fowler对此主题<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">发表了一篇文章</a> -关于使用微服务的“回报”： <br><br><img src="https://habrastorage.org/webt/v8/9l/0j/v89l0j0ucc2icw34ojowadgf4w0.jpeg"><br><br> 我们将看看是否满足我们的期望。 <br><br><h3> 明确的模块边界... </h3><br> 但是<b>，我们真的需要修复多少微服务</b>才能推出更改？ 我们是否可以弄清楚没有分布式跟踪器的情况下所有东西如何工作（毕竟，任何请求都由一半的微服务处理）？ <br><br> 有一个“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">大块的泥</a> ”模式，但是这里我们得到了一个分散的泥块。 为此，下面是查询如何进行的示例说明： <br><br><img src="https://habrastorage.org/webt/9x/p4/dg/9xp4dgwekrlygkemlygsisl6nxm.jpeg"><br><br><h3> 部署独立性... </h3><br> 从技术上讲，它已经实现：我们可以分别滚动每个微服务。 但是实际上，您需要考虑到总是会推出<b>许多微服务</b> ，并且我们需要考虑<b>其推出</b>的<b>顺序</b> 。 以一种很好的方式，我们通常需要在单独的电路中测试是否按正确的顺序推出了发行版。 <br><br><h3> 自由选择技术... </h3><br> 她在那里。 唯一值得记住的是，自由常常与无法无天联系在一起。 在这里非常重要的是不要选择仅与它们“玩”的技术。 <br><br><h3> 发展独立性... </h3><br> 如何为整个应用（由那么多的组件）制作测试电路？ 但是您仍然需要保持最新状态。 所有这些导致一个事实，即我们原则上可以包含<b>的测试循环</b>的<b>实际数量</b> <b>是最小的</b> 。 <br><br> 但是要在本地部署所有这些吗？..事实证明，开发人员通常是独立但随机地完成工作，因为他必须等到测试电路发布后才能进行。 <br><br><h3> 单独缩放... </h3><br> 是的，但是它在使用的DBMS领域中受到限制。 在给定的体系结构示例中，Cassandra不会有问题，但是MySQL和PostgreSQL会有问题。 <br><br><h3> 更高的可靠性... </h3><br> 不仅如此，事实上，一个微服务的故障通常会破坏整个系统的正常运行，还有一个新问题： <b>使每个微服务容错非常困难</b> 。 因为微服务使用不同的技术（内存缓存，Redis等），所以每个人都需要考虑并实现所有事情，这当然是可能的，但是需要大量的资源。 <br><br><h3> 负载的可测量性... </h3><br> 一切真的很好。 <br><br><h3> 微服务的轻便性..​​. </h3><br> 我们不仅有巨大的<b>网络开销</b> （DNS查询等），而且由于子查询很多，我们开始<b>复制数据</b> （存储缓存），从而导致大量的存储。 <br><br> 这是满足我们期望的结果： <br><br><img src="https://habrastorage.org/webt/hg/oe/35/hgoe35hkyfy3kfkmhxguoqq5rne.png"><br><br><h3> 但这还不是全部！ </h3><br> 因为： <br><br><ul><li> 我们很可能需要消息总线。 </li><li> 如何在正确的时间进行一致的备份？ 唯一的<i>实际</i>选择是为此关闭流量。 但是如何在生产中做到这一点？ </li><li> 如果我们要谈论支持多个地区，那么在每个地区组织可持续性是一项非常耗时的任务。 </li><li> 存在进行集中更改的问题。 例如，如果需要更新PHP的版本，则需要提交到每个存储库（其中有数十个）。 </li><li> 一方面，操作复杂性的增加是指数级的。 </li></ul><br><h2> 这一切怎么办？ </h2><br>  <b>从整体应用开始</b> 。  Fowler的经验<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">表明</a> ，几乎所有成功的微服务应用程序都是从整体开始的，而整体变得太大，之后就被破坏了。 同时，几乎所有从一开始就构建为微服务的系统迟早都会遇到严重问题。 <br><br> 另一个有价值的想法是，要使具有微服务架构的项目成功，您应该非常了解<b>主题领域和如何制作微服务</b> 。 知道主题区域的最佳方法是制作一个整体。 <br><br><h2> 但是，如果我们已经处于这种情况下该怎么办？ </h2><br> 解决任何问题的第一步是同意它，并理解这是一个我们不再希望遭受的问题。 <br><br> 如果在整体堆满的情况下（当我们没有足够的机会为其购买资源时）将其削减，那么在这种情况下，我们得到了相反的结论：当过多的微服务不再有用，而是造成干扰时，请<b>砍掉多余的并扩大规模</b> ！ <br><br> 例如，对于上面讨论的集体图像... <br><br> 摆脱最可疑的微服务： <br><br><img src="https://habrastorage.org/webt/tf/-s/su/tf-ssueuj8be3jxrwhqfqwocqjo.png"><br><br> 组合所有负责生成前端的微服务： <br><br><img src="https://habrastorage.org/webt/ii/sw/gs/iiswgsg4bjx69wpgn8vk3_xxp70.png"><br><br>  ...在一种微服务中，以一种（您自己认为是现代的和普通的）语言/框架编写的： <br><br><img src="https://habrastorage.org/webt/vy/yk/hi/vyykhitrn3crjfplovw_acdoicu.png"><br><br> 它将有一个ORM（一个DBMS）和第一个应用程序： <br><br><img src="https://habrastorage.org/webt/4x/pe/7s/4xpe7siw54omsbrabwatzggsp1c.png"><br><br>  ...一般而言，可以得到更多的结果，结果如下： <br><br><img src="https://habrastorage.org/webt/gv/cc/mz/gvccmzms2zvyzzg1kfttpyih2bk.png"><br><br> 此外，在Kubernetes中，我们在单独的实例中运行所有这些，这意味着我们仍然可以测量负载并分别缩放它们。 <br><br><h2> 总结 </h2><br> 宽看图片。 通常，微服务的所有这些问题都是由于有人执行任务但想“玩微服务”而引起的。 <br><br>  <b>在“微服务”一词中，“微”部分是多余的</b> 。 它们之所以“微”，仅仅是因为它们比巨大的整体小。 但是不要认为它们太小。 <br><br> 最后的想法是回到原来的时间表： <br><br><img src="https://habrastorage.org/webt/w8/t5/lg/w8t5lgftdcf1zjri4aekoipk1p0.png"><br><br> 写给他的注释<i>（右上）可以</i>归结为这样一个事实，即使<b>您的项目成为团队</b>的<b>技能始终是首要的</b> -它们将在您选择微服务和整体服务之间发挥关键作用。 如果团队没有足够的技能，但是开始提供微服务，那么这个故事肯定是致命的。 <br><br><h2> 影片和幻灯片 </h2><br> 演讲视频（〜50分钟；不幸的是，它并没有传达出访客的众多情绪，很大程度上决定了报告的气氛，但实际上）： <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/g9cgppj0gKQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br> 报告介绍： <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h2> 聚苯乙烯 </h2><br> 我们博客上的其他报告： <br><br><ul><li>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">监控和Kubernetes</a> ” <i>（Dmitry Stolyarov； 2018年5月28日在RootConf上）</i> ； </li><li>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用Kubernetes和GitLab的最佳CI / CD实践</a> ” <i>（Dmitry Stolyarov； 2017年11月7日，HighLoad ++）</i> ； </li><li>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">我们在小型项目中使用Kubernetes的经验</a> ” <i>（Dmitry Stolyarov； 2017年6月6日在RootConf上）</i> ； </li><li>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">我们使用dapp快速方便地收集了CI / CD的Docker映像</a> ” <i>（Dmitry Stolyarov； 2016年11月8日，HighLoad ++）</i> ； </li><li>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用Docker的持续交付实践</a> ” <i>（Dmitry Stolyarov； 2016年5月31日，RootConf）</i> 。 </li></ul><br> 您可能也对以下出版物感兴趣： <br><br><ul><li>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">2018年微服务疯狂之死</a> ”； </li><li>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">根据Google的规定，操作容器的7种最佳做法</a> ”； </li><li>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">有关Kubernetes实现困难的新堆栈统计信息</a> 。” </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN424531/">https://habr.com/ru/post/zh-CN424531/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN424511/index.html">用于在Java中查找带注释的类的工具</a></li>
<li><a href="../zh-CN424513/index.html">关于廉价数据中心，ILV和DDoS保护</a></li>
<li><a href="../zh-CN424517/index.html">使用不完整输入集的Quine \ McCluskey方法实现逻辑功能的最小化</a></li>
<li><a href="../zh-CN424519/index.html">贝多芬可以发送删除请求吗？</a></li>
<li><a href="../zh-CN424525/index.html">迷你钻头速度控制</a></li>
<li><a href="../zh-CN424533/index.html">“任何自重的IT人员都在业余时间从事技术工作”-程序员的10个问题，第6期</a></li>
<li><a href="../zh-CN424537/index.html">Sberbank推出了自己的运营商SberMobile</a></li>
<li><a href="../zh-CN424539/index.html">Java 11：String中的新增功能</a></li>
<li><a href="../zh-CN424541/index.html">UGJ 2018惨败故事：如何制作没人喜欢的游戏（不要做！）</a></li>
<li><a href="../zh-CN424543/index.html">Java 11 / JDK 11：常规可用性</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>