<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙈 🏉 🧗🏼 Meluncurkan Platform Elbrus untuk PuzzleLib Neural Networks 💱 ❕ 🆗</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="AI pada setrika domestik 
 Kami berbicara tentang bagaimana kami mem-porting kerangka kerja kami untuk jaringan saraf dan menghadapi sistem pengenalan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Meluncurkan Platform Elbrus untuk PuzzleLib Neural Networks</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ashmanov_net/blog/469033/"><h3>  AI pada setrika domestik </h3><br>  Kami berbicara tentang bagaimana kami mem-porting kerangka kerja kami untuk jaringan saraf dan menghadapi sistem pengenalan ke prosesor Rusia Elbrus. <br><br><img src="https://habrastorage.org/webt/e3/sq/qz/e3sqqz_1suglr-i19vtkvjaj3l4.png" alt="gambar"><br><br>  Itu adalah tugas yang menarik, pada musim semi 2019 kami membicarakannya di kantor Yandex pada pertemuan besar tentang Elbrus, sekarang kami berbagi dengan Habr. <br><a name="habracut"></a><br><h3>  Secara singkat - apa itu Elbrus </h3><br>  Ini adalah prosesor Rusia dengan arsitekturnya sendiri, yang dikembangkan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MCST</a> .  Maxim Gorshenin berbicara tentang dia dengan baik di salurannya: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">www.youtube.com/watch?v=H8eBgJ58EPY</a> <br><br><h3>  Secara singkat - apa itu PuzzleLib </h3><br>  Ini adalah platform kami untuk jaringan saraf, yang telah kami kembangkan dan gunakan sejak 2015.  Analogi Google TensorFlow dan Facebook PyTorch.  Menariknya, PuzzleLib mendukung tidak hanya prosesor NVIDIA dan Intel, tetapi juga kartu video AMD. <br><br>  Meskipun kami memiliki perpustakaan kecil (TensorFlow memiliki sekitar 2 juta baris, kami memiliki 100 ribu), kami lebih baik dalam kecepatan - sedikit, tetapi lebih baik =) <br><br>  Kami belum dalam open source, perpustakaan digunakan untuk proyek kami.  Perpustakaan lengkap: mendukung tahap pelatihan dan tahap inferensi jaringan saraf.  Anda dapat membangun berulang, jaringan saraf convolutional, ada juga antarmuka untuk membuat grafik perhitungan sewenang-wenang. <br><br><h4>  PuzzleLib punya </h4><br><ul><li>  Modul untuk merakit jaringan saraf (Aktivasi (Sigmoid, Tanh, ReLU, ELU, LeakyReLU, SoftMaxPlus), AvgPool (1D, 2D, 3D), BatchNorm (1D, 2D, 3D, ND), Conv (1D, 2D, 3D, ND) , CrossMapLRN, Deconv (1D, 2D, 3D, ND), Putus Sekolah (1D, 2D), dll.) </li><li>  Pengoptimal (AdaDelta, AdaGrad, Adam, Hooks, LBFGS, MomentumSGD, NesterovSGD, RMSProp, dll.) </li><li>  Jaringan saraf siap pakai (Resnet, Inception, YOLO, U-Net, dll.) </li></ul><br>  Ini adalah yang akrab, akrab bagi semua yang terlibat dalam jaringan saraf, blok untuk desainer jaringan saraf (karena kerangka kerja apa pun adalah konstruktor yang terdiri dari blok dan algoritma komputasi khas). <br><br>  <b>Kami punya ide untuk meluncurkan perpustakaan kami pada arsitektur Elbrus.</b> <b><br></b> <br><br><h3>  Mengapa kami ingin mendukung Elbrus? </h3><br><ol><li>  Ini adalah satu-satunya prosesor Rusia, saya ingin memahami bagaimana hal itu terjadi, betapa mudahnya untuk bekerja dengannya. </li><li>  Kami berpikir bahwa mungkin menarik bagi organisasi negara bahwa perangkat lunak Rusia yang kami kembangkan bekerja pada perangkat keras Rusia. </li><li>  Dan tentu saja, kami hanya tertarik, karena Elbrus adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">prosesor VLIW</a> , yaitu, prosesor dengan instruksi panjang, dan tidak ada prosesor tujuan umum yang lengkap di dunia. </li></ol><br>  Semuanya berawal dari fakta bahwa kami bertemu dengan MCST, berbicara, dan meminjamkan komputer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Elbrus 401</a> untuk pengembangan. <br><br>  <b>Apa yang saya sukai</b> : Linux berjalan di Elbrus, ada python di Linux ini, dan itu tidak berfungsi dalam mode emulasi - ini adalah python asli yang dibuat untuk Elbrus.  Ada juga bundel pustaka python standar, misalnya numpy, yang sangat disukai semua pengembang. <br><br>  Ada beberapa tugas yang harus kami kumpulkan secara tambahan: misalnya, di PuzzleLib kami menggunakan format hdf untuk menyimpan bobot jaringan saraf, dan, oleh karena itu, kami harus membangun perpustakaan libhdf dan h5py menggunakan kompiler lcc.  Tapi kami tidak punya masalah perakitan. <br><br>  Pustaka visi komputer OpenCV juga sudah dikompilasi, tetapi tidak ada ikatan untuk python - kami membangunnya secara terpisah. <br><br>  Perpustakaan dlib yang terkenal juga cukup mudah untuk dikompilasi.  Hanya ada sedikit kesulitan: beberapa file proyek open source ini tidak memiliki penanda-bom untuk menentukan utf-8, yang mengacaukan lcc lexer.  Sebenarnya, hanya ada format file yang salah, yang harus diperbaiki di sumbernya. <br><br>  Kami memutuskan untuk mulai mengenali wajah terlebih dahulu.  Ini adalah kasus penggunaan yang dapat dimengerti bagi banyak orang, di mana teknologi ini digunakan.  PuzzleLib, seperti perpustakaan lain, memiliki bagian backend yang agak besar, yaitu basis kode khusus untuk arsitektur prosesor yang berbeda. <br><br>  <b>Backends kami:</b> <br><br><ul><li>  CUDA (NVIDIA) </li><li>  Buka CL + MI Terbuka (AMD) </li><li>  mlkDNN (Intel) </li><li>  CPU (numpy) </li></ul><br>  Di Elbrus, kami meluncurkan backend numpy, yang sangat sederhana, karena platform membutuhkan minimal segalanya: <br><br>  <i>Platform -&gt; kompiler c90 -&gt; python -&gt; numpy</i> <br><br>  Kami memiliki perpustakaan tanpa faktor-faktor yang menyulitkan (misalnya, tanpa sistem perakitan khusus) - selain fakta bahwa kami perlu mengumpulkan binder tertentu.  Kami menjalankan tes, semuanya berfungsi - baik grid konvolusional maupun berulang.  Pengenalan wajah yang kami luncurkan cukup sederhana, berdasarkan Inception-ResNet. <br><br>  <b>Hasil pekerjaan pertama</b> <br><br>  Pada Intel Core i7 7700, waktu pemrosesan untuk satu gambar adalah 0,1 detik, dan di sini - 15. Itu perlu untuk mengoptimalkan. <br><br>  Tentu saja, berharap numpy akan bekerja dengan baik dengan cepat akan salah. <br><br><h3>  Bagaimana kami mengoptimalkan komputasi </h3><br>  Kami mengukur kecepatan inferensi melalui python profiler dan menemukan bahwa hampir sepanjang waktu dihabiskan mengalikan matriks dalam numpy.  Untuk sampel, mereka menulis perkalian yang paling sederhana, manual dari matriks, dan itu ternyata lebih cepat, meskipun tidak jelas mengapa. <br><br>  Tampaknya numpy.dot seharusnya ditulis sedikit lebih naif daripada perkalian sederhana seperti itu.  Namun demikian, kami yakin, memeriksa - ternyata lebih cepat (12 detik per frame, bukan 15). <br><br>  Selanjutnya, kami belajar tentang perpustakaan aljabar linier EML, yang sedang dikembangkan di ICST, dan mengganti panggilan np.dot dengan cblas_sgemm.  Itu menjadi 10 kali lebih cepat (1,5 detik) - kami sangat senang. <br><br>  Ini diikuti oleh beberapa optimasi langkah demi langkah.  Karena kami hanya menjalankan pengenalan wajah, dan biasanya bukan data yang arbitrer, kami memutuskan untuk mempertajam operasi kami hanya di bawah tensor 4d dan membuat Fusion - setelah itu waktu pemrosesan menurun 2 kali - menjadi 0,75 detik. <br><br>  Penjelasan: Fusion adalah ketika beberapa operasi digabungkan menjadi satu, misalnya konvolusi, normalisasi dan aktivasi.  Alih-alih membuat operan dalam tiga siklus, satu operan dilakukan. <br><br>  Perpustakaan semacam itu tersedia dari NVIDIA ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">TensorRT</a> ).  Grafik komputasi dimasukkan ke dalamnya, dan perpustakaan menghasilkan grafik yang dioptimalkan dan dipercepat, khususnya karena fakta bahwa ia dapat menciutkan operasi menjadi satu.  Intel juga memiliki yang serupa (nGraph dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">OpenVINO</a> ). <br><br>  Kemudian kami melihat bahwa karena ada banyak konvolusi 1x1 di Inception-ResNet, kami memiliki penyalinan data tambahan.  Kami memutuskan untuk berspesialisasi dalam fakta bahwa kami mengerjakan batch dari 1 foto (yaitu, jangan memproses 100 foto dalam batch, tetapi menyediakan mode streaming) - ada kasus penggunaan seperti itu ketika Anda perlu bekerja bukan dengan arsip, tetapi dengan streaming (misalnya, untuk pengawasan video atau ACS).  Kami membuat bagian khusus tanpa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">im2col</a> (dihapus salinan besar) - itu menjadi 0,45 detik. <br><br>  Kemudian kami melihat lagi pada profiler, kami memiliki segalanya dengan cara yang sama - meskipun semua tahapan menyusut dalam waktu, kami masih 80% dari waktu yang dihabiskan untuk perhitungan blok inferensi konvolusional. <br>  Kami menyadari bahwa kami perlu memparalelkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">gemm</a> (penggandaan matriks umum).  Permata itu, yang dalam EML, ternyata berulir tunggal.  Oleh karena itu, kami harus menulis permata multi-utas sendiri.  Idenya adalah ini: sebuah matriks besar dibagi menjadi subblok, dan kemudian ada perkalian dari matriks-matriks kecil ini.  Kami menulis permata dengan OpenMP, tetapi tidak berhasil, kesalahan terhenti.  Kami mengambil kumpulan benang secara manual, paralelisasi memberi 0,33 detik per frame. <br><br>  Selanjutnya, kami diberi akses jarak jauh ke server yang lebih kuat dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Elbrus 8C</a> , di mana kecepatan meningkat menjadi 0,2 detik per frame. <br><br>  Video berikut ini menunjukkan karya demo stand dengan pengenalan wajah pada komputer Elbrus 401-PC dengan prosesor Elbrus 4C: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/iNMRKQqNM1Q" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  Kesimpulan dan Rencana Masa Depan </h3><br><ul><li>  Ini berfungsi tidak hanya menghadapi pengenalan, tetapi pada prinsipnya kerangka kerja jaringan saraf, sehingga kami dapat mengumpulkan detektor, pengklasifikasi dan menjalankannya pada Elbrus. </li><li>  Kami telah membuat demo stand dengan Web-UI untuk menunjukkan pengenalan wajah di PuzzleLib. <br></li><li>  Pengenalan wajah pada Elbrus sudah cukup cepat untuk tugas-tugas praktis, maka Anda dapat mempercepatnya jika perlu. </li><li>  Anda bisa bekerja dengan Elbrus.  Kami dulu bekerja dengan prosesor eksotis - misalnya, dengan prosesor Rusia tensor yang masih dikembangkan, dengan kartu video AMD dan perangkat lunak mereka.  Semuanya tidak begitu bagus dan sederhana di sana.  Yaitu, jika kita mengambil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MI Open</a> library dari AMD, ini adalah perpustakaan yang ditulis dengan sangat buruk di mana tidak semua kombinasi langkah, bantalan, dan ukuran filter mengarah pada perhitungan yang berhasil.  Kualitas alat dari Elbrus bagus - jika Anda memiliki proyek dengan Python, C atau C ++, menjalankannya pada Elbrus tidak sulit sama sekali. </li><li>  Perlu juga dicatat bahwa pengerjaan optimasi langkah demi langkah yang kita bicarakan bukanlah operasi khusus untuk bekerja di Elbrus.  Ini adalah operasi prosesor multi-core standar.  Menurut pendapat kami, ini adalah pertanda baik bahwa prosesor dapat dioperasikan seperti halnya prosesor reguler dari Intel / NVIDIA. <br></li></ul><br><h4>  Paket: </h4><br><ul><li>  Karena Elbrus memiliki kekhasan dalam hal itu adalah prosesor VLIW, dimungkinkan untuk membuat beberapa optimasi khusus untuk Elbrus. <br></li><li>  Lakukan kuantisasi (bekerja dengan int8 alih-alih float32), yang menghemat memori dan meningkatkan kecepatan.  Dengan demikian, dalam hal ini, tentu saja, mungkin ada penurunan dalam kualitas perhitungan - tetapi ini mungkin tidak.  Kami telah memperhatikan kedua kasus dalam praktiknya. </li></ul><br>  Kami berencana untuk lebih memahami, mengeksplorasi kemampuan prosesor VLIW.  Faktanya, untuk saat ini, kami cukup mempercayai kompiler karena jika kami menulis kode yang baik, kompiler mengoptimalkannya dengan baik, karena ia mengetahui fitur-fitur Elbrus. <br><br>  Secara umum, itu menarik, kita akan mengerti lebih jauh.  Ini tidak memakan banyak waktu - semua operasi pelabuhan membutuhkan waktu seminggu. <br><br>  Pada Januari 2020 kami berencana untuk menempatkan PuzzleLib di sumber terbuka, kami akan menulis lebih banyak tentang ini di sini =) <br>  Terima kasih atas perhatian anda! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id469033/">https://habr.com/ru/post/id469033/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id469021/index.html">Pengembangan di monorepositori. Laporan Yandex</a></li>
<li><a href="../id469023/index.html">Cara menemukan pekerjaan dengan relokasi ke Eropa: panduan praktis untuk profesional TI</a></li>
<li><a href="../id469025/index.html">Dinginkan anggur dengan cepat! Penemuan Rusia</a></li>
<li><a href="../id469027/index.html">Ivanovo! Mitap: Bagaimana cara membangun karir di Digital?</a></li>
<li><a href="../id469031/index.html">12 baru kecerdasan buatan Layanan Media Azure</a></li>
<li><a href="../id469035/index.html">Inovasi baru AI-powered Azure Media Services</a></li>
<li><a href="../id469037/index.html">Pengontrol industri. Sistem pengumpulan data. ACS</a></li>
<li><a href="../id469039/index.html">Lebih dari sekedar permainan: Menguasai Mahjong dengan AI dan pembelajaran mesin</a></li>
<li><a href="../id469041/index.html">Bagaimana cara melindungi sistem ERP Anda?</a></li>
<li><a href="../id469043/index.html">C / C ++ dari Python (C API)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>