<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåÇ üßúüèø ‚úàÔ∏è Pompes √† insuline, micropuces inviolables et radio d√©finie par logiciel üëÅÔ∏è ‚õπÔ∏è üïú</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pompe √† insuline √† ing√©nierie inverse pour la th√©rapie de bricolage 

 Il y a environ trois ans, j'ai entendu parler d'un site Web offrant une r√©compe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pompes √† insuline, micropuces inviolables et radio d√©finie par logiciel</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450962/">  <i>Pompe √† insuline √† ing√©nierie inverse pour la th√©rapie de bricolage</i> <br><br>  Il y a environ trois ans, j'ai entendu parler d'un site Web offrant une r√©compense pour √™tre tr√®s proche de mon c≈ìur: la r√©tro-ing√©nierie des communications avec une pompe √† insuline.  J'ai d√©j√† aid√© √† cr√©er un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">syst√®me</a> pour ma fille appel√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Loop</a> , avec une pompe Medtronic pour laquelle je fais de l'ing√©nierie inverse des communications (la plupart du protocole de communication Medtronic principal a √©t√© d√©cod√© par Ben West √† l'aide de Carelink USB, et j'ai d√©couvert les fr√©quences radio et fait un travail suppl√©mentaire sur protocole).  Mais la pompe Medtronic a d√ª √™tre arr√™t√©e pendant la gymnastique pendant plusieurs heures.  Le design tubeless de cette pompe Omnipod m'a paru int√©ressant, et j'avais tous les outils pour travailler. <br><br>  Le syst√®me Omnipod se compose d'une petite pompe √† usage unique appel√©e module (pod) et d'une unit√© de contr√¥le (PDM). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/841/6a8/053/8416a805371c4dd2def86783f903bc24.jpg"></div><br><a name="habracut"></a><br>  √âtant donn√© que le PDM communique avec le module par radio et que le module n'a pas d'interface int√©gr√©e, cela signifie qu'il est enti√®rement radiocommand√©.  Il existe une possibilit√© d'int√©gration compl√®te avec Loop, en utilisant uniquement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RileyLink</a> ou sa version modifi√©e. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">James Wedding a</a> nomm√© une r√©compense, qui a attir√© beaucoup d'attention, puis les bonnes personnes qui ont aid√© dans le travail. <br><br><h1>  Radio d√©finie par logiciel </h1><br>  Le SDR est un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">formidable outil</a> .  Il rend visible le monde cach√© de la radio.  Il existe une vari√©t√© de types de messages qui sont constamment diffus√©s dans l'air, et ces outils vous permettent de fouiner, d'afficher des messages et, apr√®s un certain travail, de d√©coder les petits √©clairs que vous voyez l√†-bas.  Si vous recherchez des messages √† partir d'un appareil sp√©cifique, vous devez savoir dans quelle zone commencer la recherche.  C'est l√† que les documents publics de la FCC sont utiles. <br><br>  La documentation FCC pour PDM, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RBV-019</a> , indique que l'appareil transmet dans la bande 433 MHz.  Apr√®s avoir configur√© le logiciel SDR pour √©couter dans la plage 433 MHz, les signaux suivants apparaissent lors de l'√©mission de l'√©tat √† partir de PDM: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/45b/3a2/f4b/45b3a2f4bc2273bfc3980fe7ce880ddf.png"><br><br>  Comme je l'ai finalement d√©couvert, ces deux lignes lumineuses indiquent un certain type de modulation appel√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fr√©quence shift keying</a> , ou FSK.  Cela signifie que la fr√©quence du signal varie en fonction des informations transmises.  Le bit 1 est envoy√© comme une fr√©quence plus √©lev√©e (ligne sup√©rieure) et 0 est envoy√© avec une fr√©quence l√©g√®rement inf√©rieure (ligne inf√©rieure).  En utilisant l'outil d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">inspection,</a> nous pouvons analyser les donn√©es pour reconna√Ætre plus clairement 1 et 0. Voici une vue consid√©rablement agrandie du premier message: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/20c/80e/a0d/20c80ea0d16d084da29f5e2afdd76283.png"><br><br>  J'ai √©crit un script python pour extraire ces bits afin que nous puissions les regarder comme des packages entiers. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4a9/bbc/f46/4a9bbcf46f710c93c85407fb9c4df813.png"><br><br>  Il s'av√®re que ce motif r√©p√©titif fait partie du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pr√©ambule</a> .  Pour √©conomiser de l'√©nergie, les r√©cepteurs passent souvent en mode veille et se r√©veillent p√©riodiquement pour v√©rifier le signal.  L'√©metteur envoie le pr√©ambule suffisamment longtemps pour que le r√©cepteur l'attrape pendant l'une des courtes p√©riodes d'√©coute.  Lorsque le r√©cepteur entend le pr√©ambule, il se r√©veille jusqu'√† ce que des donn√©es r√©elles apparaissent. <br><br>  Vous devez passer par une autre couche avant d'obtenir les donn√©es r√©elles du lot.  Vous ne pouvez pas envoyer vos donn√©es sur la radio exactement de la m√™me mani√®re que les bits d'origine, car le r√©cepteur utilise des transitions pour se synchroniser dans le temps quand attendre le bit suivant.  Si vous avez un long ensemble de z√©ros ou de uns, le r√©cepteur peut se d√©synchroniser.  Par cons√©quent, les communications radio utilisent g√©n√©ralement le codage pour v√©rifier qu'il y a suffisamment de transitions.  Les communications omnipodes utilisent le soi-disant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">codage Manchester</a> .  Chaque bit est cod√© en deux bits.  1 est cod√© comme 10 et 0 est cod√© comme 01. <br><br>  Il a fallu beaucoup de temps pour le d√©couvrir, et il y avait beaucoup de th√©ories sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le canal openomni √† Slack alors</a> que nous essayions de r√©p√©ter les bits originaux.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mark Brighton</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dan Caron</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@larsonlr</a> ont r√©ussi √† utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RFCat</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ti Stick</a> pour capturer des paquets.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Evarist Kurgio a</a> finalement √©crit un outil appel√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rtlomni</a> , il utilise le r√©cepteur USB rtl-sdr pour √©couter les paquets et les d√©coder, ce qui s'est av√©r√© tr√®s pratique et plus fiable que les m√©thodes bas√©es sur TI Stick. <br><br><h1>  D√©codage de paquets </h1><br>  Apr√®s avoir re√ßu les bits r√©els, nous avons commenc√© √† √©tudier la structure du paquet.  Sur la base des bits qui ont chang√© entre diff√©rents modules et diff√©rentes √©quipes, nous avons cr√©√© une structure qui ressemble √† ceci: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/502/143/9c3/5021439c396b22015da60af09a84516a.png"><br><br><h1>  CRC8 </h1><br>  La radio est loin d'√™tre un support de transmission id√©al.  Il existe de nombreuses sources d'interf√©rences diff√©rentes qui font que le r√©cepteur entend 1 lorsque 0 est envoy√©, et vice versa.  Il est important de savoir quand cela s'est produit, de sorte que la plupart des protocoles utilisent une somme de contr√¥le, souvent appel√©e CRC.  Le r√©cepteur calcule le CRC √† mesure que les donn√©es sont re√ßues, et le dernier octet du paquet inclut le CRC calcul√© par l'√©metteur.  S'ils ne correspondent pas, le r√©cepteur rejette le paquet et attend la retransmission. <br><br>  Le protocole Omnipod utilisait le CRC 8 bits standard.  Lorsque nous l'avons trouv√©, nous avons d√©cid√© que nous √©tions tr√®s pr√®s de comprendre les messages.  Comme nous en savions peu ... <br><br><h1>  Messages, CRC16 </h1><br>  Certains messages sont trop volumineux pour tenir dans un seul package, ils sont donc divis√©s en plusieurs packages.  Nous avons commenc√© √† reconstituer le format du message et avons remarqu√© un autre ensemble de bits √† la fin de chaque message, qui ressemblait √† un CRC 16 bits.  Mais c'√©tait √©trange: 5 bits sur 16 n'ont jamais √©t√© d√©finis.  Nous avons essay√© de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nombreuses m√©thodes diff√©rentes</a> pour comprendre comment cela est cod√©, mais rien n'a fonctionn√©. <br><br>  C'√©tait le premier gros probl√®me: nous pouvions continuer √† travailler sur d'autres bits dans les messages, mais cela n'aiderait pas beaucoup √† comprendre ce qui est envoy√©, et nous ne pourrons pas g√©n√©rer nous-m√™mes de nouveaux paquets, donc les progr√®s ont ralenti. <br><br>  Plusieurs mois se sont √©coul√©s presque en vain.  Enfin, √† l'hiver 2016, un membre du groupe sous le surnom <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@lorelai a</a> d√©clar√© qu'elle avait copi√© avec succ√®s le micrologiciel d'une puce ARM plus grande vers PDM et commenc√© le processus de d√©sassemblage fastidieux: accepter les instructions du processeur et les transformer en code lisible par l'homme avec des variables s√©mantiques et des noms de fonction.  Elle a fait un travail incroyable en d√©couvrant les diff√©rentes m√©thodes utilis√©es pour transmettre les donn√©es. <br><br>  J'ai regard√© l'une des routines sans titre et j'ai remarqu√© qu'elle ressemblait √† une impl√©mentation standard du calcul CRC √† partir d'une table.  Et la table avait des valeurs pour le CRC 16 bits standard.  J'ai √©crit ma propre impl√©mentation sur des tables, et elle a √©t√© test√©e comme un CRC normal.  Ensuite, j'ai regard√© attentivement comment la fonction a √©t√© √©crite.  Une impl√©mentation CRC normale ressemble √† ceci: <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (len--) { crc = (crc &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) ^ crctable[((crc &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) ^ *c++)]; }</code> </pre> <br>  Leur impl√©mentation ressemblait √† ceci: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (len--) { crc = (crc &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) ^ crctable[((crc &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) ^ *c++)]; }</code> </pre> <br>  Remarquez la diff√©rence?  Ce qui √©tait cens√© √™tre un op√©rateur de d√©calage gauche au niveau du bit a √©t√© en quelque sorte cod√© comme un d√©calage droit.  C'est une erreur;  Il n'y a aucune raison de paralyser votre propre algorithme CRC, car cela rend difficile l'identification des messages corrompus. <br><br>  Nous sommes de retour en op√©ration!  Et ils ont repris le travail sur le d√©codage des messages, les sessions d'enregistrement √† partir du PDM pour l'administration de bolus [m√©dicaments], les bases temporaires [Le d√©bit basal temporaire d√©termine une augmentation ou une diminution de l'administration d'insuline - env.  voie], suspension du classement, etc. <br><br><h1>  Num√©ro √† usage unique </h1><br>  Toutes les √©quipes d'administration d'insuline avaient une donn√©e de 4 octets au d√©but du message, qui ressemblait √† une forme de cryptographie.  Encore une fois, nous avons essay√© de nombreuses fa√ßons diff√©rentes de l'interpr√©ter et de l'analyser dans le contexte des messages dans lesquels il a √©t√© envoy√©, mais ce n'√©tait pas CRC (parfois nous avons vu les m√™mes 4 octets m√™me dans des messages diff√©rents).  Et parfois, nous avons vu l'image se r√©p√©ter.  Elle semblait, peut-√™tre, faire partie d'un protocole visant √† emp√™cher la reproduction des donn√©es.  Dans d'autres protocoles, une fonction similaire est appel√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nonce</a> . <br><br>  L'une des options que nous avons envisag√©es consistait √† enregistrer une base de messages pour lire les commandes donn√©es.  M√™me si l'adresse de chaque module √©tait diff√©rente, nous savions maintenant comment g√©n√©rer un CRC, afin que nous puissions prendre la copie pr√©c√©dente de la commande, mettre la nouvelle adresse sur le message et recompter le CRC.  Seul ce nonce nous a emp√™ch√© d'utiliser cette strat√©gie.  Quelle que soit la commande, le module n'a accept√© que le nonce suivant dans la s√©quence, et nous ne savions pas comment g√©n√©rer le nonce suivant. <br><br>  Mais!  Apr√®s tout, nous avons un firmware PDM d√©compil√©, nous pouvons simplement y regarder!  Nous avons donc √©tudi√© le micrologiciel PDM, suivi la g√©n√©ration de messages dans le code et trouv√© o√π ces quatre octets devraient √™tre.  Mais au lieu d'une m√©thode qui calcule un nonce cryptographique, nous venons de trouver quatre caract√®res <code>INS.</code>  .  Quelle absurdit√©?!?!  Eh bien, cette zone de message doit √™tre mise √† jour plus tard dans le pipeline. <br><br>  Il y avait une autre puce sur le PDM, plus pr√®s de la radio.  C'√©tait la m√™me puce qui √©tait utilis√©e dans les modules, avec l'identifiant SC9S08ER48, qui n'√©tait pas document√©e sur Internet.  Il a probablement √©t√© fabriqu√© sur commande pour l'Insulet.  Peut-√™tre que nous pouvons supprimer le firmware de cette puce.  Malheureusement, la puce a √©t√© bloqu√©e, ce qui a emp√™ch√© la copie du firmware. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7fa/b0d/60c/7fab0d60c765bfaf689f79d4bdf5433a.png"><br><br>  Le travail a de nouveau ralenti ... c'√©tait comme une vraie impasse.  Nous avons mis tous nos efforts mentaux dans ce nonce, et nous n'avions pas de bonnes pistes en math√©matiques derri√®re cela.  Et la puce ER48, qui (probablement) gardait des secrets, a √©t√© bloqu√©e, et il est difficile de trouver des informations publiques qui pourraient l'aider √† se fissurer. <br><br><h1>  Rayons X </h1><br>  En essayant de comprendre ER48, certains membres de la communaut√© Slack ont ‚Äã‚Äãsugg√©r√© de prendre des radiographies.  C'√©tait vraiment cool, mais malheureusement, cela n'a pas ouvert de nouvelles opportunit√©s. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/76f/9d7/261/76f9d72614dc261b6a594d099b610514.jpg"><br>  <i><font color="gray">Plan g√©n√©ral</font></i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d8b/5ac/86b/d8b5ac86b2c595e0ab03724e22eb58de.jpg"><br>  <i><font color="gray">Plan d√©taill√©</font></i> <br><br><h1>  Autopsie et prise de vue </h1><br>  Dan Caron a d√©cid√© de se tourner vers un chercheur, le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dr Sergey Skorobogatov</a> de l'Universit√© de Cambridge au Royaume-Uni.  Dan a lu qu'il avait de l'exp√©rience dans l'extraction de code √† partir de puces verrouill√©es et l'a convaincu de jeter un ≈ìil √† notre probl√®me.  Le Dr Skorobogatov a men√© des recherches dans le domaine de l'utilisation du SEM (microscope √©lectronique √† balayage) pour l'ing√©nierie inverse des microcircuits.  Il a sugg√©r√© que c'est possible, mais que cela co√ªtera cher, n√©cessitera un √©quipement co√ªteux et ne garantit pas un r√©sultat.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Joe Moran</a> , qui a r√©cemment commenc√© √† utiliser Loop apr√®s notre rencontre au hackathon Nightscout √† l'automne 2016, a accept√© d'aider avec le projet.  Il a convenu avec une entreprise de la Silicon Valley, Nanolab Technologies, d'ouvrir et de photographier les puces, et a √©galement aimablement financ√© le travail de Nanolab et du Dr Skorobogatov (ainsi que ses modules personnels). <br><br>  Le Dr Skorobogatov a demand√© √† Nanolab d'appliquer diverses techniques d'imagerie pour savoir s'il est possible de casser la protection avec des m√©thodes connues non invasives ou semi-invasives.  En cons√©quence, de nombreuses images sont apparues, dont certaines tr√®s belles.  Ce sont des images microscopiques optiques d'une matrice de silicium. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/031/21e/bfb/03121ebfb9b91c9b4b68c71664df2869.jpg"><br>  <i><font color="gray">Vue g√©n√©rale du microcircuit sous microscope optique</font></i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d9a/131/5b7/d9a1315b7eb9403fd06e38b06229f01d.jpg"><br>  <i><font color="gray">Vue g√©n√©rale du microcircuit sous microscope optique</font></i> <br><br>  Des photos ont √©galement √©t√© prises de zones sp√©cifiques de la matrice √† l'aide d'un microscope √©lectronique √† balayage.  Avec diff√©rentes tensions, diff√©rentes pr√©parations de surface et diff√©rents √©quipements. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d3a/e7a/1b0/d3ae7a1b0d68eb0bd0400c56eecad6fa.jpg"><br>  <i><font color="gray">Image SEM des cellules flash.</font></i>  <i><font color="gray">N'affiche pas de donn√©es</font></i> <br><br>  Malheureusement, aucune de ces images n'a montr√© le contenu r√©el de la m√©moire flash. <br><br>  Le Dr Skorobogatov avait une derni√®re m√©thode, qui ne peut √™tre utilis√©e qu'en cas d'√©chec.  Il s'agissait d'une m√©thode brevet√©e, dont l'utilisation devait obtenir l'autorisation de l'universit√©.  Le Dr Skorobogatov a effectu√© le test initial et a confirm√© qu'il √©tait capable de lire les donn√©es sur cette puce.  Mais avant de continuer, il √©tait n√©cessaire de signer le NDA, et donc des n√©gociations ont eu lieu sur qui recevrait le contenu du firmware extrait. <br><br>  En fin de compte, la NDA a sign√© la fondation Nightscout et a pris la responsabilit√© d'emp√™cher la divulgation non autoris√©e des m√©thodes et des r√©sultats d'extraction de m√©moire. <br><br>  Le r√©sultat de cet accord et de ce travail a √©t√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un article incroyable</a> √©crit par le Dr Sergei Skorobogatov, ainsi que le code du firmware.  D√®s la premi√®re fois, il y avait pas mal d'erreurs dans le code, mais c'√©tait suffisant pour commencer.  Au Nightscout Spring Hackathon, Joe s'est tourn√© vers les gars si quelqu'un voulait faire le d√©montage.  Personne n'a lev√© la main.  Transformer les instructions du processeur en quelque chose de compr√©hensible est un travail minutieux, et tr√®s peu de gens savent comment le faire.  J'ai essay√© de me plonger dans l'assembleur en utilisant la documentation du CPU, mais j'ai r√©alis√© tr√®s peu et j'ai √©t√© d√©√ßu.  D'autres ont demand√© avec optimisme le code du firmware avec des attentes de progr√®s rapides, puis ont r√©alis√© l'ampleur et la complexit√© de la t√¢che - et sont tomb√©s tranquillement. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5b4/ab1/8f8/5b4ab18f82c273633dab9f193d69d331.png"><br>  <i><font color="gray">Exemple de d√©montage des instructions SC908</font></i> <br><br>  Il s'av√®re que Joe avait √©galement une vaste exp√©rience de travail avec l'assembleur, et il a commenc√© √† effectuer cette t√¢che difficile.  En juillet, le Dr Skorobogatov a termin√© une deuxi√®me op√©ration d'extraction de m√©moire avec beaucoup moins d'erreurs.  Pendant l'√©t√©, Joe Moran a travaill√© sans rel√¢che pour afficher un grand nombre d'instructions de processeur et les int√©grer progressivement dans l'image globale du pseudocode du module. <br><br>  Finalement, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ken Shirriff</a> , un expert en r√©troconception mat√©rielle, nous a rejoint et il a consid√©rablement acc√©l√©r√© le processus.  Ensemble, Joe et Ken ont fini par traduire suffisamment de code pour trouver une fonction qui code nonce.  Cela s'est produit en septembre 2017. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d93/1d5/a00/d931d5a000713fdefa9f865744a5b6a2.gif"></div><br><br><h1>  RileyLink et Loop </h1><br>  Nous avons mis √† jour les scripts Python d'Openomni, mais maintenant il est temps de se concentrer sur RileyLink + iOS, j'ai donc commenc√© √† travailler sur OmniKit et les mises √† jour du firmware pour RileyLink.  Je croyais que nous avions les bases du protocole, et le reste n'√©tait que des d√©tails.  Encore une fois, sous-estimer compl√®tement ce qui reste √† venir. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4f5/710/6d8/4f57106d8931a3e2b5f01e2a8fd8f9db.jpg"><br><br>  J'ai d√ª √©crire un nouveau firmware qui g√®re la modulation et le codage du module.  J'ai √©galement d√ª r√©√©crire comment deux puces sur RL se parlent pour traiter les z√©ros, car dans Medtronic, les z√©ros √©taient la fin sp√©ciale du marqueur de paquet.  Une grande partie de Loop a d√ª √™tre repens√©e pour prendre en charge plusieurs pompes, ainsi que de nouvelles interfaces pour prendre en charge l'appariement, la d√©sactivation et la gestion des erreurs.  Heureusement, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nate Racklift a</a> pos√© des bases solides chez Loop pour rendre tout cela possible. <br><br>  Pendant ce temps, le travail s'est poursuivi pour comprendre le format des √©quipes.  Tout a √©t√© soigneusement document√© sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wiki openomni</a> , la documentation la plus compl√®te du protocole.  Joe, Evarist et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Elke J√§ger</a> ont fait un excellent travail au fil du temps dans le d√©codage des messages et la mise √† jour des pages.  Divers membres du canal Slack ont ‚Äã‚Äãcontribu√© √† la capture des paquets PDM et du module pour aider les efforts de d√©codage globaux. <br><br>  Le d√©codage √©tait un travail amusant, avec beaucoup de petites victoires, car chaque composant de chaque √©quipe d√©crypte, et j'ai vraiment aim√© travailler sur cette partie, en ajoutant progressivement du code √† Loop.  En avril 2018, j'ai partag√© √† Slack que j'avais fait ¬´une canulation primaire coupl√©e via iPhone + RL selon le programme basal programm√©, puis 5 unit√©s sont tomb√©es malades¬ª. <br><br>  Le micrologiciel RL 2.0 a √©t√© achev√© en juillet 2018 et de nouvelles livraisons l'ont d√©j√† accompagn√©.  On esp√©rait que ces cartes pourraient √™tre utilis√©es avec Loop et Omnipod, mais l'antenne existante √† 915 MHz √©tait trop mauvaise pour fonctionner efficacement √† 433 MHz. <br><br>  Le d√©codage et la mise en ≈ìuvre ont consid√©rablement progress√© au cours de l'√©t√© et Loop se rapproche progressivement des performances.  Joe a fait la chose incroyable en me donnant du financement, alors j'ai quitt√© mon travail de jour et me concentrer sur ce projet, et j'ai finalement rejoint la merveilleuse √©quipe de Tidepool.  Bien s√ªr, dans le domaine du bricolage et de la r√©glementation l√©gislative des √©quipements m√©dicaux, il y a eu plus d'√©v√©nements que je ne couvrirai pas, mais ce fut un √©t√© tr√®s int√©ressant! <br><br><h1>  Screamers </h1><br>  Lorsque plus de fonctions sont apparues dans le pilote, je l'ai connect√© √† Loop, activant la possibilit√© de configurer automatiquement la livraison √† l'heure.  √Ä ce stade, des modules ¬´flashy¬ª ont souvent √©t√© obtenus lorsque certaines v√©rifications internes des modules ont r√©v√©l√© un probl√®me et il a cess√© de d√©livrer de l'insuline. <br><br>  Mais cela semblait √™tre un probl√®me r√©solu, car nous avons continu√© √† trouver de petites diff√©rences dans les packages de boucle et le PDM d'origine lors de l'envoi manuel des commandes, et j'ai suppos√© que si nous les corrigions tous, les ¬´cris¬ª cesseraient. <br><br><h1>  Boucle de travail! </h1><br>  Le 3 octobre 2018, Joe a enfil√© le module g√©r√© Loop et est devenu le premier utilisateur Loop Omnipod, bien qu'il ne me l'ait pas dit tout de suite parce qu'il savait que je serais inquiet.  Quand il me l'a dit, j'√©tais toujours inquiet.  Nous avons vu comment le module fonctionnait, et compris la fonctionnalit√©, et l'algorithme de base a √©t√© test√© pendant longtemps, mais quand m√™me ... <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c74/adc/6ec/c74adc6ecee823d919dbf3162b120e5c.png"><br><br>  Un mois plus tard, lors du hackathon de Nightscout en novembre 2018, plusieurs autres aventuriers ont d√©cid√© de l'essayer par eux-m√™mes et ont √©galement fait partie d'un petit groupe de test ferm√© qui comptera plus de 30 personnes avant la publication du code. <br><br>  Malheureusement, nous avons encore rencontr√© des ¬´cris¬ª de module, survenant souvent avant la fin des trois jours complets d'utilisation, et nous avons soigneusement compar√© les commandes de boucle avec des √©chantillons PDM.  Dans ce processus, Elke a √©t√© particuli√®rement utile: il a √©crit un script pour v√©rifier automatiquement les commandes avec les versions originales.  J'ai commenc√© √† m'inqui√©ter du fait que le fonctionnement intermittent des modules √©tait d√ª √† l'augmentation des besoins en batterie pour les communications toutes les cinq minutes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e92/90b/39b/e9290b39bd5057064ebaf3dfed0e8980.png"><br>  <i><font color="gray">Prises du r√©gulateur de tension dans le module, perc√©es √† travers le plastique du panneau arri√®re, sur superglue</font></i> <br><br>  Par cons√©quent, j'ai commenc√© √† mesurer la tension d'alimentation du module √† l'aide d'Arduino, √† √©crire des donn√©es et √† les enregistrer dans une base de donn√©es locale pour la visualisation.  J'ai compar√© PDM et Loop. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/701/02d/d09/70102dd0984ee469ff50a75f4912f8bc.png"><br>  <i><font color="gray">Changement √† long terme de la tension d'alimentation du module</font></i> <br><br>  Malheureusement, cela s'est √©galement av√©r√© √™tre une impasse;  en utilisant PDM et en injectant une grande quantit√© d'insuline, j'ai pu amener le module √† une tension plus basse que pendant toute la dur√©e de vie du module Loop, et je n'ai pas pu faire ¬´hurler¬ª le module.  Il semblait que le stress n'√©tait pas un probl√®me, il devait y avoir autre chose. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fc6/4bc/e44/fc64bce4473247b8d55f69a3d2bcab58.jpg"><br>  <i><font color="gray">RileyLinks avec antennes √† bobine 955 MHz (gauche) et 433 MHz (droite)</font></i> <br><br>  √Ä un moment donn√©, j'ai remarqu√© que si l'√©change de messages avec le module √©chouait, le module continuait parfois √† essayer de mettre fin √† l'√©change en renvoyant des paquets encore et encore.  Les journaux des testeurs ont √©galement montr√© beaucoup de probl√®mes, j'ai donc commenc√© √† exp√©rimenter avec des antennes.  Les deux probl√®mes doivent √™tre li√©s √† la qualit√© de la communication.  J'ai pr√©vu d'essayer diff√©rentes antennes et de les commander √† diff√©rents endroits sur Internet, mais je n'ai pas eu le temps de les tester jusqu'√† ce que cela devienne une priorit√©. <br><br>  J'avais plusieurs antennes flexibles de 433 MHz qui peuvent √™tre fix√©es √† l'int√©rieur du bo√Ætier RL.  Ils montrent souvent de meilleures performances dans certains sc√©narios, mais pas dans d'autres;  trop peu fiable.  Quand je suis arriv√© √† la bobine, il a montr√© de bonnes performances tr√®s r√©guli√®rement et sur des gammes tr√®s √©tonnantes.  Il est temps de faire une nouvelle affaire pour RileyLink. <br><br>  Avec une nouvelle antenne et quelques optimisations qui ont r√©duit la messagerie tout en faisant des ajustements toutes les 5 minutes, les cris sont devenus tr√®s rares.  Probablement comparable √† l'utilisation habituelle des modules avec PDM.  Au cours des 7 500 derni√®res heures de tests en temps r√©el, 94% des modules ont √©t√© ex√©cut√©s sans √©chec. <br><br><h1>  Test et documentation </h1><br>  Le groupe de test a lentement grandi: de nouveaux utilisateurs ont constamment rejoint le syst√®me, qui, avec un nouveau look, pouvaient √©valuer quelles parties semblaient d√©routantes.  Ces testeurs ont support√© de nombreux modules flashy et ont grandement contribu√© √† am√©liorer les performances de Loop avec Omnipod.  Fondamentalement, ils ont envoy√© des rapports de probl√®mes et des journaux de travail. <br><br>  Ces rapports contiennent un journal de messages qui peut √™tre analys√© √† l'aide d'un outil cr√©√© par Elke.  Cela donne une id√©e si nous obtenons des commandes d√©form√©es et vous permet √©galement de collecter des statistiques sur certaines parties de l'interaction de Loop avec les modules. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Marion Barker a</a> rejoint le groupe de test et ajout√© des rapports sp√©ciaux et des statistiques suppl√©mentaires sur la progression des tests - et nous avons pu utiliser ses statistiques des modules r√©ussis contre les √©checs afin d'avoir une id√©e de haut niveau des progr√®s. <br><br>  Finalement, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Katie DiSimone a</a> rejoint le groupe de test.  Elle a commenc√© une restructuration majeure de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">loopdocs.org</a> avec de la documentation sur l'utilisation de Loop avec plusieurs appareils.  L'attente pour la version de Loop qui fonctionnait avec Omnipod √©tait incroyablement longue, et sans une bonne documentation, il √©tait clair que nous serions submerg√©s par les m√™mes questions. <br><br><h1>  Nouvelles fonctionnalit√©s de boucle </h1><br>  L'int√©gration avec Omnipod a n√©cessit√© une refonte de certains des √©l√©ments de l'interface et l'ajout de nouveaux contr√¥les.  Le module ne signale pas la batterie et l'utilisateur peut faire peu avec une faible charge si cela se produit, donc l'affichage du widget de niveau de batterie n'a pas de sens.  De plus, sans interface utilisateur sur la pompe, l'utilisateur devrait pouvoir annuler rapidement le bolus.  L'ic√¥ne du r√©servoir repr√©sentait le r√©servoir Medtronic, nous voulions donc le refaire.  Merci √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Paul Forgione d'</a> avoir d√©velopp√© le logo du module, qui indique d√©sormais le niveau du r√©servoir. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ed/2ff/020/0ed2ff02079b5cbaf6606c21467577ee.png"><br><br><h1>  Remerciements </h1><br>  Merci √† toutes les personnes qui nous ont aid√©s √† aller si loin afin que nous r√©alisions l'objectif que nous nous √©tions fix√© il y a longtemps.  Je sais que je n'ai pas mentionn√© tous les √©v√©nements et pas tous les √©v√©nements.  Ce n'est pas possible dans un article, et je n'ai qu'une exp√©rience personnelle.  Il est difficile d'imaginer combien d'heures cela a pris.  Si vous les ajoutez tous ensemble, je suis s√ªr que c'est un chiffre choquant.  Sans parler du travail de cr√©ation de l'Omnipod lui-m√™me, qui, il me semble, √©clipse tous ces efforts.  Merci √† tous.  De plus, bon nombre de ces heures auraient autrement √©t√© consacr√©es √† des familles.  J'appr√©cie vraiment la compr√©hension de ma femme et de mes enfants en raison du temps que j'y ai consacr√©, et je tiens √©galement √† les remercier. <br><br><h1>  Remarques </h1><br>  Je dois mentionner <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Joachim Ornstedt</a> comme l'un des contributeurs au d√©codage openomni, ainsi que le cr√©ateur de probablement la premi√®re int√©gration avec l'omnipode.  Il a construit un appareil qui utilisait la reconnaissance optique de caract√®res (OCR) pour extraire les donn√©es du PDM et a connect√© les touches num√©riques au PDM physique via un autre microcontr√¥leur.  Cette approche est difficile √† mettre √† l'√©chelle, mais elle est tr√®s intelligente et contourne bon nombre des probl√®mes que nous avons d√ª r√©soudre avec une solution bas√©e sur les ER.  J'admire vraiment la fa√ßon dont il a r√©solu le probl√®me et mis en place un travail pendant une infime fraction du temps qu'il a fallu pour que l'appareil fonctionne avec Loop. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr450962/">https://habr.com/ru/post/fr450962/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr450950/index.html">Dart Streams Basics</a></li>
<li><a href="../fr450952/index.html">Indice moyen et antibank</a></li>
<li><a href="../fr450954/index.html">Comment nous avons appris √† exploiter Java dans Docker</a></li>
<li><a href="../fr450956/index.html">Comparaison des COB industriels: ISIM vs. Kics</a></li>
<li><a href="../fr450958/index.html">AnyStub, biblioth√®que de stub de connexion Java</a></li>
<li><a href="../fr450964/index.html">Nouvelle biblioth√®que intrins√®que SIMD x86 - D√©bogage immintrin</a></li>
<li><a href="../fr450966/index.html">Enregistrement de vid√©o √† partir d'un vieil ordinateur - m√©thodes de LGR</a></li>
<li><a href="../fr450970/index.html">Comment vraiment comparer les prix Apple aux √âtats-Unis et en Russie. Exp√©rience personnelle</a></li>
<li><a href="../fr450972/index.html">Comment organiser un studio photo? Cas de Bolshakova Studio</a></li>
<li><a href="../fr450974/index.html">Xiaomi Sleep Tracker - Sleepace Sleep Dot Review</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>