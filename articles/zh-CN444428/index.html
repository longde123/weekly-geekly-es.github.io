<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧗🏼 👩🏽‍🎨 ✋🏻 山地车：通过强化训练解决经典挑战 🚐 👩🏼‍🔧 🚐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="通常，对依赖于特定任务的特定功能的算法的修改被认为价值不高，因为它们很难推广到更广泛的问题类别。 但是，这并不意味着不需要此类修改。 而且，即使对于简单的经典问题，它们通常也可以显着改善结果，这在算法的实际应用中非常重要。 例如，在这篇文章中，我将通过强化训练来解决“山地车”问题，并表明利用有关任务...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>山地车：通过强化训练解决经典挑战</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/hsespb/blog/444428/"> 通常，对依赖于特定任务的特定功能的算法的修改被认为价值不高，因为它们很难推广到更广泛的问题类别。 但是，这并不意味着不需要此类修改。 而且，即使对于简单的经典问题，它们通常也可以显着改善结果，这在算法的实际应用中非常重要。 例如，在这篇文章中，我将通过强化训练来解决“山地车”问题，并表明利用有关任务组织方式的知识，可以更快地解决该问题。 <br><br><img src="https://habrastorage.org/webt/xy/ju/ai/xyjuaivxj9j2c5hp2o-2x3cem2y.png"><br><a name="habracut"></a><br><h2> 关于我自己 </h2><br> 我叫Oleg Svidchenko，现在我在圣彼得堡HSE的物理，数学和计算机科学学院学习，然后在圣彼得堡大学学习了三年。 我还在JetBrains Research担任研究员。 在进入大学之前，我曾在莫斯科国立大学的SSC学习，并成为莫斯科团队中全俄计算机科学奥林匹克竞赛的获胜者。 <br><br><h2> 我们需要什么？ </h2><br> 如果您有兴趣尝试进行强化训练，那么“山地车”挑战就是一个很好的选择。 今天，我们需要具有安装<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">好的</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Gym</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PyTorch库</a>以及神经网络基础知识的Python。 <br><br><h2> 任务说明 </h2><br> 在二维世界中，汽车需要从两个山丘之间的凹陷处爬到右山丘的顶部。 由于她没有足够的发动机动力来克服重力并在第一次尝试时进入该重力，这一事实使情况变得复杂。 我们被邀请训练一个特工（在我们的例子中是一个神经网络），他可以通过控制它来尽快爬上正确的山坡。 <br><br> 机器控制是通过与环境的交互来执行的。 它分为独立的情节，每个情节都是逐步进行的。 在每个步骤，代理响应于动作<i>a</i>从环境接收状态<i>s</i>和环境<i>r</i> 。 另外，有时媒体可能会另外报告该情节结束。 在这个问题中， <i>s</i>是一对数字，第一个是汽车在弯道上的位置（一个坐标就足够了，因为我们不能将自己从曲面上撕开），第二个是它在曲面上的速度（带符号）。 奖励<i>r</i>是一个始终等于-1的数字。 通过这种方式，我们鼓励特工尽快完成剧集。 只有三种可能的动作：将汽车向左推，什么也不做，然后将汽车向右推。 这些动作对应于从0到2的数字。如果汽车到达右山顶或特工已采取200步，则该事件可能会结束。 <br><br><h2> 一点理论 </h2><br> 在哈布雷（Habré）上已经有<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一篇有关DQN</a>的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文章</a> ，作者在其中很好地描述了所有必要的理论。 不过，为了便于阅读，我将在这里以更正式的形式重复它。 <br><br> 强化学习任务由一组状态空间S，动作空间A，系数 <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext mathcolor=&quot;red&quot;>\&amp;#x4F3D;</mtext><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x739B;</mo></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.018ex" height="2.66ex" viewBox="0 -832 2160.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g fill="red" stroke="red"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">伽</text></g></g><g transform="translate(1330,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">玛</text></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext mathcolor="red">\伽</mtext><mrow class="MJX-TeXAtom-ORD"><mo>玛</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-1"> \伽玛</script>  ，过渡函数T和奖励函数R。通常，过渡函数和奖励函数可以是随机变量，但是现在我们将考虑一个更简单的版本，在其中对其进行唯一定义。 目标是最大化累积奖励。 <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>u</mi><msubsup><mi>m</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>t</mi><mo>=</mo><mn>0</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>T</mi></mrow></msubsup><msub><mi>r</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>t</mi></mrow></msub><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&amp;#xA0;</mtext><mi>g</mi><mi>a</mi><mi>m</mi><mi>m</mi><msup><mi>a</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>t</mi></mrow></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="23.676ex" height="3.021ex" viewBox="0 -883.9 10193.7 1300.8" role="img" focusable="false" style="vertical-align: -0.969ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-73" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-75" x="719" y="0"></use><g transform="translate(1292,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-54" x="1242" y="488"></use><g transform="translate(878,-308)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-74" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMAIN-3D" x="361" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMAIN-30" x="1140" y="0"></use></g></g><g transform="translate(3430,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-74" x="638" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-63" x="4487" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-64" x="4921" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-6F" x="5444" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-74" x="5930" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-67" x="6541" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-61" x="7022" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-6D" x="7551" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-6D" x="8430" y="0"></use><g transform="translate(9308,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-74" x="748" y="513"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>s</mi><mi>u</mi><msubsup><mi>m</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>=</mo><mn>0</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>T</mi></mrow></msubsup><msub><mi>r</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi></mrow></msub><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&nbsp;</mtext><mi>g</mi><mi>a</mi><mi>m</mi><mi>m</mi><msup><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-2"> \ sum_ {t = 0} ^ {T} r_ {t} \ cdot \ gamma ^ {t} </script>  ，其中t是媒体中的步数，T是情节中的步数。 <br><br> 为了解决这个问题，假设我们从状态s开始，我们将状态s的值函数V定义为最大累积奖励的值。 知道了这样一个函数，我们可以简单地通过在每一步将s传递给s来获得最大可能值来解决问题。 但是，并非一切都那么简单：在大多数情况下，我们不知道采取什么行动会使我们达到理想的状态。 因此，我们将动作a添加为函数的第二个参数。 所得函数称为Q函数。 它显示了通过在状态s中执行动作a可以获得的最大可能累积奖励。 但是我们已经可以使用此功能解决问题：处于状态s时，我们只需选择一个使得Q（s，a）为最大。 <br><br> 实际上，我们不知道真正的Q函数，但是可以通过各种方法对其进行近似。 一种这样的技术是深度Q网络（DQN）。 他的想法是，对于每个动作，我们都使用神经网络来逼近Q函数。 <br><br><h2> 环境 </h2><br> 现在开始练习。 首先，我们需要学习如何模拟MountainCar环境。 健身房图书馆提供大量标准的强化学习环境，将帮助我们应对这一任务。 要创建环境，我们需要在Gym模块上调用make方法，将所需环境的名称作为参数传递给它： <br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> gym env = gym.make(<span class="hljs-string"><span class="hljs-string">"MountainCar-v0"</span></span>)</code> </pre> <br> 在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>可以找到详细的文档，并在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>可以找到有关环境的说明。 <br> 让我们更详细地考虑如何对创建的环境执行以下操作： <br><br><ul><li>  <code>env.reset()</code> -结束当前情节并开始新的情节。 返回初始状态。 </li><li>  <code>env.step(action)</code> -执行指定的操作。 返回新状态，奖励，情节是否已结束以及可用于调试的其他信息。 </li><li>  <code>env.seed(seed)</code> -设置随机种子。 这取决于在env.reset（）期间如何生成初始状态。 </li><li>  <code>env.render()</code> -显示环境的当前状态。 </li></ul><br><h2> 我们实现DQN </h2><br>  DQN是一种使用神经网络评估Q函数的算法。 在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">原始文章中，</a> DeepMind使用卷积神经网络定义了Atari游戏的标准架构。 与这些游戏不同，Mountain Car不会将图像用作状态，因此我们必须自己确定架构。 <br><br> 例如，一个具有两个隐藏层的架构，每个隐藏层包含32个神经元。 在每个隐藏层之后，我们将使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ReLU</a>作为激活函数。 两个描述状态的数字被馈送到神经网络的输入，在输出处我们得到Q函数的估计。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ae/jl/mk/aejlmktkosv-jpbne9hqi96enxw.png" alt="神经网络架构"></div><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> torch.nn <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> nn model = nn.Sequential( nn.Linear(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>), nn.ReLU(), nn.Linear(<span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>), nn.ReLU(), nn.Linear(<span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) ) target_model = copy.deepcopy(model) <span class="hljs-comment"><span class="hljs-comment">#    def init_weights(layer): if type(layer) == nn.Linear: nn.init.xavier_normal(layer.weight) model.apply(init_weights)</span></span></code> </pre><br> 由于我们将在GPU上训练神经网络，因此我们需要在此处加载网络： <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     CPU,  “cuda”    “cpu” device = torch.device("cuda") model.to(device) target_model.to(device)</span></span></code> </pre><br> 设备变量将是全局变量，因为我们还需要加载数据。 <br><br> 我们还需要定义一个优化器，该优化器将使用梯度下降来更新模型权重。 是的，不止一个。 <br><br><pre> <code class="python hljs">optimizer = optim.Adam(model.parameters(), lr=<span class="hljs-number"><span class="hljs-number">0.00003</span></span>)</code> </pre><br><div class="spoiler">  <b class="spoiler_title">一起</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> torch.nn <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> nn <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> torch device = torch.device(<span class="hljs-string"><span class="hljs-string">"cuda"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_new_model</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> model = nn.Sequential( nn.Linear(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>), nn.ReLU(), nn.Linear(<span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>), nn.ReLU(), nn.Linear(<span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) ) target_model = copy.deepcopy(model) <span class="hljs-comment"><span class="hljs-comment">#    def init_weights(layer): if type(layer) == nn.Linear: nn.init.xavier_normal(layer.weight) model.apply(init_weights) #   ,     (GPU  CPU) model.to(device) target_model.to(device) #  ,        optimizer = optim.Adam(model.parameters(), lr=0.00003) return model, target_model, optimizer</span></span></code> </pre><br></div></div><br> 现在，我们声明一个函数，该函数将考虑误差函数，沿其的梯度并应用下降。 但是在此之前，您需要将数据从批处理下载到GPU： <br><br><pre> <code class="python hljs">state, action, reward, next_state, done = batch <span class="hljs-comment"><span class="hljs-comment">#       state = torch.tensor(state).to(device).float() next_state = torch.tensor(next_state).to(device).float() reward = torch.tensor(reward).to(device).float() action = torch.tensor(action).to(device) done = torch.tensor(done).to(device)</span></span></code> </pre><br> 接下来，我们需要计算Q函数的实际值，但是，由于我们不知道它们的真实性，我们将通过以下状态的值来评估它们： <br><br><pre> <code class="python hljs">target_q = torch.zeros(reward.size()[<span class="hljs-number"><span class="hljs-number">0</span></span>]).float().to(device) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> torch.no_grad(): <span class="hljs-comment"><span class="hljs-comment">#     Q-function    target_q = target_model(next_state).max(1)[0].view(-1) target_q[done] = 0 target_q = reward + target_q * gamma</span></span></code> </pre><br> 和当前的预测： <br><br><pre> <code class="python hljs">q = model(state).gather(<span class="hljs-number"><span class="hljs-number">1</span></span>, action.unsqueeze(<span class="hljs-number"><span class="hljs-number">1</span></span>))</code> </pre><br> 使用target_q和q，我们计算损失函数并更新模型： <br><br><pre> <code class="python hljs">loss = F.smooth_l1_loss(q, target_q.unsqueeze(<span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-comment"><span class="hljs-comment">#      optimizer.zero_grad() #     loss.backward() #   . ,       for param in model.parameters(): param.grad.data.clamp_(-1, 1) #    optimizer.step()</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">一起</b> <div class="spoiler_text"><pre> <code class="python hljs">gamma = <span class="hljs-number"><span class="hljs-number">0.99</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(batch, model, target_model, optimizer)</span></span></span><span class="hljs-function">:</span></span> state, action, reward, next_state, done = batch <span class="hljs-comment"><span class="hljs-comment">#       state = torch.tensor(state).to(device).float() next_state = torch.tensor(next_state).to(device).float() reward = torch.tensor(reward).to(device).float() action = torch.tensor(action).to(device) done = torch.tensor(done).to(device) #  ,       target_q = torch.zeros(reward.size()[0]).float().to(device) with torch.no_grad(): #     Q-function    target_q = target_model(next_state).max(1)[0].view(-1) target_q[done] = 0 target_q = reward + target_q * gamma #   q = model(state).gather(1, action.unsqueeze(1)) loss = F.smooth_l1_loss(q, target_q.unsqueeze(1)) #      optimizer.zero_grad() #     loss.backward() #   . ,       for param in model.parameters(): param.grad.data.clamp_(-1, 1) #    optimizer.step()</span></span></code> </pre><br></div></div><br> 由于模型仅考虑Q函数，并且不执行操作，因此我们需要确定将决定代理将执行哪些操作的功能。 作为决策算法，我们采用 <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>v</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>p</mi><mi>s</mi><mi>i</mi><mi>l</mi><mi>o</mi><mi>n</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.348ex" height="2.419ex" viewBox="0 -780.1 4886 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-76" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-61" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-72" x="1265" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-65" x="1716" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-70" x="2183" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-73" x="2686" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-69" x="3156" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-6C" x="3501" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-6F" x="3800" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-6E" x="4285" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>v</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>p</mi><mi>s</mi><mi>i</mi><mi>l</mi><mi>o</mi><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-3"> \ varepsilon </script>  -贪婪的政治。 她的想法是，代理通常会贪婪地执行操作，选择Q函数的最大值，但是很有可能 <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>v</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>p</mi><mi>s</mi><mi>i</mi><mi>l</mi><mi>o</mi><mi>n</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.348ex" height="2.419ex" viewBox="0 -780.1 4886 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-76" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-61" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-72" x="1265" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-65" x="1716" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-70" x="2183" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-73" x="2686" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-69" x="3156" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-6C" x="3501" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-6F" x="3800" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-6E" x="4285" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>v</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>p</mi><mi>s</mi><mi>i</mi><mi>l</mi><mi>o</mi><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-4"> \ varepsilon </script> 他将采取随机行动。 需要随机动作，以便算法可以检查那些仅在贪婪策略的指导下不会执行的动作-此过程称为探索。 <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">select_action</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(state, epsilon, model)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> random.random() &lt; epsilon: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> random.randint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> model(torch.tensor(state).to(device).float().unsqueeze(<span class="hljs-number"><span class="hljs-number">0</span></span>))[<span class="hljs-number"><span class="hljs-number">0</span></span>].max(<span class="hljs-number"><span class="hljs-number">0</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>].view(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).item()</code> </pre><br> 由于我们使用批处理来训练神经网络，因此我们需要一个缓冲区来存储与环境交互的经验，并从中选择批处理： <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Memory</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, capacity)</span></span></span><span class="hljs-function">:</span></span> self.capacity = capacity self.memory = [] self.position = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, element)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(self.memory) &lt; self.capacity: self.memory.append(<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>) self.memory[self.position] = element self.position = (self.position + <span class="hljs-number"><span class="hljs-number">1</span></span>) % self.capacity <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sample</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, batch_size)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> list(zip(*random.sample(self.memory, batch_size))) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__len__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> len(self.memory)</code> </pre><br><h2> 天真的决定 </h2><br> 首先，声明我们将在学习过程中使用的常量，并创建一个模型： <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#  model   target model target_update = 1000 #  ,      batch_size = 128 #   max_steps = 100001 #  exploration max_epsilon = 0.5 min_epsilon = 0.1 #    memory = Memory(5000) model, target_model, optimizer = create_new_model()</span></span></code> </pre><br> 尽管将交互过程划分为几集是合乎逻辑的，但为了描述学习过程，将其划分为单独的步骤对于我们来说更为方便，因为我们希望在环境的每一步之后都采取梯度下降的一步。 <br><br> 让我们详细讨论一下学习的第一步。 我们假设现在正在使用max_steps步骤的步骤数和当前状态进行操作。 然后用 <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>v</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>p</mi><mi>s</mi><mi>i</mi><mi>l</mi><mi>o</mi><mi>n</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.348ex" height="2.419ex" viewBox="0 -780.1 4886 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-76" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-61" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-72" x="1265" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-65" x="1716" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-70" x="2183" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-73" x="2686" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-69" x="3156" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-6C" x="3501" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-6F" x="3800" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-6E" x="4285" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>v</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>p</mi><mi>s</mi><mi>i</mi><mi>l</mi><mi>o</mi><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-5"> \ varepsilon </script>  -贪婪策略如下所示： <br><br><pre> <code class="python hljs">epsilon = max_epsilon - (max_epsilon - min_epsilon)* step / max_steps action = select_action(state, epsilon, model) new_state, reward, done, _ = env.step(action)</code> </pre><br> 立即将获得的经验添加到内存中，如果当前的情节已经结束，则开始新的情节： <br><br><pre> <code class="python hljs">memory.push((state, action, reward, new_state, done)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> done: state = env.reset() done = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: state = new_state</code> </pre><br> 我们将采取梯度下降的步骤（当然，如果我们已经可以收集至少一批）： <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> step &gt; batch_size: fit(memory.sample(batch_size), model, target_model, optimizer)</code> </pre><br> 现在仍然需要更新target_model： <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> step % target_update == <span class="hljs-number"><span class="hljs-number">0</span></span>: target_model = copy.deepcopy(model)</code> </pre><br> 但是，我们也希望遵循学习过程。 为此，我们将在每次更新epsilon = 0的target_model之后播放另外一集，将总奖励存储在rewards_by_target_updates缓冲区中： <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> step % target_update == <span class="hljs-number"><span class="hljs-number">0</span></span>: target_model = copy.deepcopy(model) state = env.reset() total_reward = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> done: action = select_action(state, <span class="hljs-number"><span class="hljs-number">0</span></span>, target_model) state, reward, done, _ = env.step(action) total_reward += reward done = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> state = env.reset() rewards_by_target_updates.append(total_reward)</code> </pre><br><div class="spoiler">  <b class="spoiler_title">一起</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#  model   target model target_update = 1000 #  ,      batch_size = 128 #   max_steps = 100001 #  exploration max_epsilon = 0.5 min_epsilon = 0.1 def fit(): #    memory = Memory(5000) model, target_model, optimizer = create_new_model() for step in range(max_steps): #    epsilon = max_epsilon - (max_epsilon - min_epsilon)* step / max_steps action = select_action(state, epsilon, model) new_state, reward, done, _ = env.step(action) #  ,  ,   memory.push((state, action, reward, new_state, done)) if done: state = env.reset() done = False else: state = new_state #  if step &gt; batch_size: fit(memory.sample(batch_size), model, target_model, optimizer) if step % target_update == 0: target_model = copy.deepcopy(model) #Exploitation state = env.reset() total_reward = 0 while not done: action = select_action(state, 0, target_model) state, reward, done, _ = env.step(action) total_reward += reward done = False state = env.reset() rewards_by_target_updates.append(total_reward) return rewards_by_target_updates</span></span></code> </pre><br></div></div><br> 运行以下代码，并获得如下图所示的内容： <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e35/952/b37/e35952b375fc831ec4bd405303440509.png" alt="直线y = -200形式的示意图"><br><br><h2> 怎么了？ </h2><br> 这是一个错误吗？ 这是错误的算法吗？ 这些参数不好吗？ 不完全是 实际上，问题出在任务上，即奖赏的功能上。 让我们仔细看看。 在每个步骤中，我们的特工都会得到-1的奖励，这种奖励一直持续到情节结束为止。 这样的奖励激励特工尽快完成情节，但同时并没有告诉他该如何做。 因此，学习如何解决此类代理问题的唯一方法就是使用探索多次解决问题。 <br><br> 当然，可以尝试使用更复杂的算法而不是我们的算法来研究环境 <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>v</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>p</mi><mi>s</mi><mi>i</mi><mi>l</mi><mi>o</mi><mi>n</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.348ex" height="2.419ex" viewBox="0 -780.1 4886 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-76" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-61" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-72" x="1265" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-65" x="1716" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-70" x="2183" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-73" x="2686" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-69" x="3156" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-6C" x="3501" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-6F" x="3800" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-6E" x="4285" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>v</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>p</mi><mi>s</mi><mi>i</mi><mi>l</mi><mi>o</mi><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-6"> \ varepsilon </script>  -贪婪的政策。 但是，首先，由于它们的应用，我们的模型将变得更加复杂，这是我们希望避免的；其次，并不是它们可以很好地完成此任务的事实。 相反，我们可以通过修改任务本身（即通过更改奖励功能）来消除问题的根源。 通过应用所谓的奖励塑造。 <br><br><h2> 加快融合 </h2><br> 我们的直觉知识告诉我们，爬上山需要加速。 速度越高，代理商越能解决问题。 您可以例如通过在奖励中添加具有一定系数的速度模块来告诉他： <pre>  modified_reward =奖励+ 10 * abs（new_state [1]） </pre><br><br> 因此，函数中的一条线适合 <pre>  memory.push（（状态，动作，奖励，new_state，完成）） </pre> 应该由 <pre>  memory.push（（状态，动作，modified_reward，new_state，完成）） </pre> 现在，让我们看一下新图表（它给出了未经修改的<b>原始</b>奖项）： <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c19/3c2/925/c193c2925d13ba1977cf525697cba1c2.png" alt="绝对与RS图"><br>  <i>RS是“奖励塑形”的缩写。</i> <br><br><h2> 这样做好吗？ </h2><br> 进步是显而易见的：随着奖励开始与-200不同，我们的代理商显然学会了爬坡。 剩下的只有一个问题：如果改变奖励的功能，我们也改变了任务本身，我们发现的新问题的解决方案对旧问题有好处吗？ <br><br> 首先，我们了解在我们的案例中“善良”的含义。 解决问题的方法是，我们试图找到最佳策略-一种使事件总回报最大化的策略。 在这种情况下，我们可以用“最佳”一词代替“良好”，因为我们正在寻找它。 我们还乐观地希望我们的DQN迟早会找到修改后的问题的最佳解决方案，而不会陷入局部最大值。 因此，问题可以重新表述为：如果改变奖励的功能，我们也改变了问题本身，发现的新问题的最优解对旧问题是否最优？ <br><br> 事实证明，在一般情况下我们无法提供这种保证。 答案取决于我们如何精确地改变奖励的功能，如何更早地安排奖励以及如何安排环境本身。 幸运的是，有<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一篇文章</a>的作者调查了奖励功能的变化如何影响所找到解决方案的最优性。 <br><br> 首先，他们发现了一整套基于潜在方法的“安全”更改： <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>R</mi><mo>&amp;#x2032;</mo></msup><mo>=</mo><mi>R</mi><mo>+</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mtext>&amp;#xA0;</mtext><mi>g</mi><mi>a</mi><mi>m</mi><mi>m</mi><mi>a</mi><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&amp;#xA0;</mtext><mi>P</mi><mi>h</mi><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x65B0;</mo></mrow><msub><mtext>&amp;#xA0;</mtext><mi>s</mi></msub><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow><mo>&amp;#x2212;</mo><mtext>&amp;#xA0;</mtext><mi>P</mi><mi>h</mi><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x5DDE;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="55.933ex" height="2.539ex" viewBox="0 -832 24082.1 1093.4" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMAIN-2032" x="1074" y="513"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMAIN-3D" x="1332" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-52" x="2388" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMAIN-2B" x="3370" y="0"></use><g transform="translate(4370,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-67" x="5450" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-61" x="5931" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-6D" x="6460" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-6D" x="7339" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-61" x="8217" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-63" x="8997" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-64" x="9430" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-6F" x="9954" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-74" x="10439" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-50" x="11051" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-68" x="11802" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-69" x="12379" y="0"></use><g transform="translate(12724,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><g transform="translate(13554,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">新</text></g><g transform="translate(14384,0)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-73" x="353" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-74" x="15066" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-61" x="15428" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-74" x="15957" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-65" x="16319" y="0"></use><g transform="translate(16785,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMAIN-2212" x="17837" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-50" x="19088" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-68" x="19840" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-69" x="20416" y="0"></use><g transform="translate(20762,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><g transform="translate(21592,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">州</text></g><g transform="translate(22422,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><g transform="translate(23252,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>R</mi><mo>′</mo></msup><mo>=</mo><mi>R</mi><mo>+</mo><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mtext>&nbsp;</mtext><mi>g</mi><mi>a</mi><mi>m</mi><mi>m</mi><mi>a</mi><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&nbsp;</mtext><mi>P</mi><mi>h</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>新</mo></mrow><msub><mtext>&nbsp;</mtext><mi>s</mi></msub><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow><mo>−</mo><mtext>&nbsp;</mtext><mi>P</mi><mi>h</mi><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>州</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-7"> R’= R +（\ gamma \ cdot \ Phi（新\ _state）-\ Phi（州））</script> 在哪里 <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext mathcolor=&quot;red&quot;>\&amp;#x76AE;</mtext><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x76AE;</mo></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.018ex" height="2.66ex" viewBox="0 -832 2160.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g fill="red" stroke="red"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">皮</text></g></g><g transform="translate(1330,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">皮</text></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext mathcolor="red">\皮</mtext><mrow class="MJX-TeXAtom-ORD"><mo>皮</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-8"> \皮皮</script>  -潜力，仅取决于状态。 对于此类功能，作者能够证明，如果新问题的解决方案是最优的，那么旧问题的解决方案也是最优的。 <br><br> 其次，作者表明对于任何其他 <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>R</mi><mo>&amp;#x2032;</mo></msup><mo>=</mo><mi>R</mi><mo>+</mo><mi>F</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mi>s</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><mi>a</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="19.996ex" height="2.419ex" viewBox="0 -832 8609.3 1041.5" role="img" focusable="false" style="vertical-align: -0.487ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMAIN-2032" x="1074" y="513"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMAIN-3D" x="1332" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-52" x="2388" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMAIN-2B" x="3370" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-46" x="4370" y="0"></use><g transform="translate(5120,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-73" x="5950" y="0"></use><g transform="translate(6419,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/hsespb/blog/444428/&amp;usg=ALkJrhiDAT7yX2ffAVBvr8-ukxOr6XA_2Q#MJMATHI-61" x="7249" y="0"></use><g transform="translate(7779,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>R</mi><mo>′</mo></msup><mo>=</mo><mi>R</mi><mo>+</mo><mi>F</mi><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-9"> R’= R + F（s，a）</script> 存在这样的问题，即R奖励函数和更改后的问题的最优解，因此该解决方案对于原始问题不是最优的。 这意味着，如果我们使用的更改不基于潜在方法，我们将无法保证所找到解决方案的优良性。 <br><br> 因此，使用潜在函数修改奖励函数只能改变算法的收敛速度，而不会影响最终解决方案。 <br><br><h2> 正确加速收敛 </h2><br> 现在我们知道了如何安全地更改奖励，让我们尝试使用潜在方法而不是幼稚的启发式方法再次修改任务： <pre>  modified_reward =奖励+ 300 *（gamma * abs（new_state [1]）-abs（状态[1]）） </pre><br> 让我们看一下原始奖项的时间表： <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ba/a60/5dc/6baa605dc8dd5ad8e7bf154e5dde3c74.png" alt="比较正确，RS和RS与电位的图"><br><br> 事实证明，除了具有理论上的保证外，借助潜在功能修改奖励还可以显着改善结果，尤其是在早期阶段。 当然，有可能选择更多的最佳超参数（随机种子，伽玛和其他系数）来训练代理，但是奖励整形仍会显着提高模型的收敛速度。 <br><br><h2> 后记 </h2><br> 感谢您阅读到底！ 我希望您喜欢这种以实践为导向的小课程，以加强学习。 很明显，Mountain Car是一项“玩具”任务，但是，正如我们能够注意到的那样，从人的角度来看，教给代理商解决甚至是看似简单的任务也很困难。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN444428/">https://habr.com/ru/post/zh-CN444428/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN444418/index.html">数百万的二进制文件。 Linux如何得到加强</a></li>
<li><a href="../zh-CN444420/index.html">如何骑两个轮子工作</a></li>
<li><a href="../zh-CN444422/index.html">与2018年一样：在Top 3D Expo上进行工业FDM打印</a></li>
<li><a href="../zh-CN444424/index.html">AMD Radeon VII：高端芯片（第2部分）</a></li>
<li><a href="../zh-CN444426/index.html">Lyft和Uber公开发行股票。 为什么要投资Lyft？</a></li>
<li><a href="../zh-CN444430/index.html">分析：如何实际使用英文的Present Perfect</a></li>
<li><a href="../zh-CN444432/index.html">Linux和开源软件在我们教育机构中的应用：是还是不是？</a></li>
<li><a href="../zh-CN444434/index.html">Java 12的时机已到！ 热门JEP的评论</a></li>
<li><a href="../zh-CN444436/index.html">什么是Mirai僵尸网络，如何保护我的设备？</a></li>
<li><a href="../zh-CN444438/index.html">开源简史-自由软件与专有软件的对抗</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>