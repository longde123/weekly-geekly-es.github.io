<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¨ â‰ï¸ ğŸ ä½¿ç”¨WireGuardå’ŒDNSCryptåœ¨OpenWrtè·¯ç”±å™¨ä¸Šç²¾ç¡®å®šä½PKHé˜»æ­¢ â—»ï¸ ğŸ‹ ğŸ”€</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä¸ç±»ä¼¼ææ–™æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ 


- çº¯OpenWrtå®ç° 
- ä½¿ç”¨WireGuard 
- è·¯ç”±å™¨çš„é…ç½®æ˜¯ä½¿ç”¨OpenWrté…ç½®è¿›è¡Œç»„ç»‡çš„ï¼Œè€Œä¸æ˜¯ä¸€å †è„šæœ¬ 
- åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œé‡æ–°å¯åŠ¨ç½‘ç»œå¹¶é‡æ–°å¯åŠ¨ 
- å®ƒæ¶ˆè€—å¾ˆå°‘çš„è·¯ç”±å™¨èµ„æºï¼šé”å®šçš„å­ç½‘åŒ…å«åœ¨iptablesä¸­ï¼Œè€Œä¸åŒ…å«åœ¨è·¯ç”±è¡¨ä¸­ã€‚ ä»€ä¹ˆä½¿æ‚¨å³ä½¿...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨WireGuardå’ŒDNSCryptåœ¨OpenWrtè·¯ç”±å™¨ä¸Šç²¾ç¡®å®šä½PKHé˜»æ­¢</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440030/"><h2 id="chem-otlichaetsya-ot-podobnyh-materialov"> ä¸ç±»ä¼¼ææ–™æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ </h2><br><ul><li> çº¯OpenWrtå®ç° </li><li> ä½¿ç”¨WireGuard </li><li> è·¯ç”±å™¨çš„é…ç½®æ˜¯ä½¿ç”¨OpenWrté…ç½®è¿›è¡Œç»„ç»‡çš„ï¼Œè€Œä¸æ˜¯ä¸€å †è„šæœ¬ </li><li> åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œé‡æ–°å¯åŠ¨ç½‘ç»œå¹¶é‡æ–°å¯åŠ¨ </li><li> å®ƒæ¶ˆè€—å¾ˆå°‘çš„è·¯ç”±å™¨èµ„æºï¼šé”å®šçš„å­ç½‘åŒ…å«åœ¨iptablesä¸­ï¼Œè€Œä¸åŒ…å«åœ¨è·¯ç”±è¡¨ä¸­ã€‚ ä»€ä¹ˆä½¿æ‚¨å³ä½¿åœ¨åŠŸèƒ½å¼±çš„è®¾å¤‡ä¸Šä¹Ÿå¯ä»¥éƒ¨ç½²æ­¤ä¸šåŠ¡ </li><li> ä½¿ç”¨Ansibleè¿›è¡Œè‡ªåŠ¨é…ç½®ï¼ˆè·¯ç”±å™¨ä¸Šä¸éœ€è¦pythonï¼‰ </li></ul><a name="habracut"></a><br><h2 id="videoversiya"> å½±ç‰‡ç‰ˆæœ¬ </h2><br><iframe width="560" height="315" src="https://www.youtube.com/embed/GMvEF0PXN-w" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="pochemu-openwrt-i-wireguard"> ä¸ºä»€ä¹ˆé€‰æ‹©OpenWrtå’ŒWireGuardï¼Ÿ </h2><br><p>  OpenWrtå·²å®‰è£…åœ¨è®¸å¤šå‹å·çš„sohoè·¯ç”±å™¨ä¸Šï¼Œå¯ä»¥æ ¹æ®æ‚¨çš„éœ€è¦è¿›è¡Œé…ç½®å’Œæ‰©å±•ã€‚ ç°åœ¨ï¼Œè®¸å¤šè·¯ç”±å™¨å›ºä»¶éƒ½æ˜¯OpenWrtçš„é™„åŠ ç»„ä»¶ã€‚ </p><br><p> ä¹‹æ‰€ä»¥ä½¿ç”¨Wireguardï¼Œæ˜¯å› ä¸ºå®ƒå®‰è£…ç®€ä¾¿ï¼Œå¹¶ä¸”é€šè¿‡éš§é“çš„ä¼ è¾“é€Ÿåº¦å¾ˆé«˜ã€‚ </p><br><h2 id="nemnogo-o-wireguard"> å…³äºWireGuardçš„ä¸€äº›çŸ¥è¯† </h2><br><p> åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨æ˜¯ILVå¤–éƒ¨çš„VPSï¼Œå®¢æˆ·ç«¯æ˜¯å®¶åº­ä¸­çš„OpenWrtè·¯ç”±å™¨ã€‚ å½“ä½ æƒ³å» <del>  Pornolab </del> é€šè¿‡ç”µæŠ¥ï¼Œæ‚¨çš„è·¯ç”±å™¨å°†é€šè¿‡WireGuardå¼•å¯¼æµé‡é€šè¿‡æœåŠ¡å™¨ã€‚ <br>  WireGuardä¼šå»ºç«‹ç«™ç‚¹åˆ°ç«™ç‚¹çš„è¿æ¥ï¼Œå³ æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½å…·æœ‰é…ç½®çš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚ å¦‚æœä¸æ¸…æ¥šï¼Œå½“æ‚¨çœ‹åˆ°é…ç½®æ—¶ï¼Œå®ƒå°†å˜å¾—æ¸…æ™°ã€‚ </p><br><p> æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å…·æœ‰è‡ªå·±çš„ç§é’¥å’Œå…¬é’¥ã€‚ </p><br><h2 id="nastroyka-wireguard-na-servere"> åœ¨æœåŠ¡å™¨ä¸Šé…ç½®WireGuard </h2><br><p> æˆ‘æ­£åœ¨Ubuntu 18.04ä¸Šè¿›è¡Œæ‰€æœ‰æ“ä½œï¼Œä½†æ˜¯åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æœ‰é’ˆå¯¹æ‰€æœ‰å·²çŸ¥æ“ä½œç³»ç»Ÿçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="å®‰è£…è¯´æ˜">å®‰è£…è¯´æ˜</a> ã€‚ </p><br><h3 id="ustanovka"> å®‰è£…æ–¹å¼ </h3><br><pre><code class="bash hljs">sudo add-apt-repository ppa:wireguard/wireguard</code> </pre> <br><blockquote> å¦‚æœå‘ç”Ÿé”™è¯¯ <br><pre> <code class="bash hljs">sudo: add-apt-repository: <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> not found</code> </pre> <br><br> å®‰è£…software-properties-common-è¯¥è½¯ä»¶åŒ…æä¾›äº†æ·»åŠ å’Œåˆ é™¤PPAçš„åŠŸèƒ½ <br><pre> <code class="bash hljs">sudo apt install software-properties-common</code> </pre> <br></blockquote><br><pre> <code class="bash hljs">sudo apt update sudo apt install wireguard-dkms wireguard-tools</code> </pre> <br><p> æˆ‘ä»¬ä¸ºæœåŠ¡å™¨ç”Ÿæˆå¯†é’¥ã€‚ ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬å°†å¯†é’¥ä¿å­˜åœ¨WireGuardç›®å½•ä¸­ã€‚ </p><br><pre> <code class="plaintext hljs">cd /etc/wireguard/ wg genkey | tee privatekey-server | wg pubkey &gt; publickey-server</code> </pre> <br><p> å› æ­¤ï¼Œåœ¨privatekey-serveræ–‡ä»¶ä¸­å°†æœ‰ä¸€ä¸ªç§é’¥ï¼Œåœ¨publickey-serverä¸­å°†æœ‰ä¸€ä¸ªå…¬é’¥ã€‚ <br> æˆ‘ä»¬è¿˜å°†ç«‹å³ä¸ºå®¢æˆ·ç”Ÿæˆä¸€ä¸ªå¯†é’¥ï¼š </p><br><pre> <code class="plaintext hljs">wg genkey | tee privatekey-client | wg pubkey &gt; publickey-client</code> </pre> <br><p><img src="https://habrastorage.org/webt/k4/xo/m5/k4xom503xmvyxdhjsvelqhaslxo.png"></p><br><h3 id="konfiguraciya"> æ„å‹ </h3><br><p> è¯¥é…ç½®å­˜å‚¨åœ¨/etc/wireguard/wg0.confä¸­ã€‚ æœåŠ¡å™¨ç«¯çœ‹èµ·æ¥åƒè¿™æ ·ï¼š </p><br><pre> <code class="bash hljs">[Interface] Address = 192.168.100.1 PrivateKey = privatekey-server ListenPort = 51820 PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -A FORWARD -o %i -j ACCEPT; iptables -t nat -A POSTROUTING -o ens3 -j MASQUERADE PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -D FORWARD -o %i -j ACCEPT; iptables -t nat -D POSTROUTING -o ens3 -j MASQUERADE</code> </pre> <br><p>  <strong>åœ°å€</strong> -wgæ¥å£çš„åœ°å€ï¼ˆéš§é“å†…éƒ¨çš„åœ°å€ï¼‰ <br> ç§é’¥-ç§é’¥ï¼ˆç§é’¥æœåŠ¡å™¨ï¼‰ <br>  <strong>ListenPort-</strong>æœåŠ¡æ­£åœ¨ç­‰å¾…è¿æ¥çš„ç«¯å£ </p><br><p> å¥½å§ï¼Œæˆ‘ä»¬ä¼šä¼ªè£…ï¼Œå› ä¸ºæˆ‘ä»¬å°†ä½¿ç”¨æ­¤æœåŠ¡å™¨è®¿é—®Internet <br> è¯·æ³¨æ„ï¼Œæ‚¨æ‰€ç”¨çš„æ¥å£åç§°å¯èƒ½æœ‰æ‰€ä¸åŒï¼š </p><br><p> å®¢æˆ·éƒ¨åˆ† </p><br><pre> <code class="bash hljs">[Peer] PublicKey = publickey-client AllowedIPs = 192.168.100.3/24</code> </pre> <br><p>  <strong>PublicKey-</strong>æˆ‘ä»¬è·¯ç”±å™¨çš„å…¬é’¥ï¼ˆpublickey-clientï¼‰ <br>  <strong>AllowedIP</strong>æ˜¯å¯é€šè¿‡æ­¤éš§é“ä½¿ç”¨çš„å­ç½‘ã€‚ æœåŠ¡å™¨ä»…éœ€è¦è®¿é—®å®¢æˆ·ç«¯åœ°å€ã€‚ </p><br><p> è¿™ä¸¤éƒ¨åˆ†éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªé…ç½®ä¸­ã€‚ </p><br><p> åœ¨é‡æ–°å¯åŠ¨æ—¶å¯ç”¨è‡ªåŠ¨å¯åŠ¨ï¼š </p><br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> wg-quick@wg0</code> </pre> <br><p> æˆ‘ä»¬ä½¿æœåŠ¡å™¨æˆä¸ºè·¯ç”±å™¨ï¼š </p><br><pre> <code class="bash hljs">sysctl -w net.ipv4.ip_forward=1</code> </pre> <br><p> é…ç½®é˜²ç«å¢™ã€‚ å‡è®¾æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸Šåªæœ‰WireGuardå’Œsshï¼š </p><br><pre> <code class="bash hljs">sudo iptables -A INPUT -i lo -j ACCEPT sudo iptables -A INPUT -p udp -m udp --dport 51820 -j ACCEPT sudo iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT sudo iptables -A INPUT -p icmp -j ACCEPT sudo iptables -A INPUT -p tcp -m tcp --dport 22 -j ACCEPT sudo iptables -A INPUT -j DROP</code> </pre> <br><p> ä¿å­˜iptablesé…ç½®ï¼š </p><br><pre> <code class="bash hljs">sudo apt-get install iptables-persistent sudo netfilter-persistent save</code> </pre> <br><p> æˆ‘ä»¬ç¬¬ä¸€æ¬¡æ‰‹åŠ¨æé«˜wgç•Œé¢ï¼š </p><br><pre> <code class="bash hljs">wg-quick up wg0</code> </pre> <br><p><img src="https://habrastorage.org/webt/1_/me/ai/1_meai1la87gto2qfa7vwmcfmju.png"></p><br><p>  WireGuardæœåŠ¡å™¨å·²å‡†å¤‡å°±ç»ªã€‚ </p><br><p>  <strong>UPD 06/27/19</strong>å¦‚æœæ‚¨çš„æä¾›å•†ä»ç„¶ä½¿ç”¨PPoEï¼Œåˆ™éœ€è¦æ·»åŠ ä¸€æ¡è§„åˆ™ã€‚ è°¢è°¢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">denix123</a> </p><br><pre> <code class="plaintext hljs">iptables -t mangle -I POSTROUTING -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu</code> </pre> <br><h2 id="nastroyka-routera"> è·¯ç”±å™¨è®¾å®š </h2><br><p> æˆ‘åœ¨å°ç±³mi 3Gå’Œåç¡•RT-N16ä¸Šä½¿ç”¨OpenWrtç‰ˆæœ¬18.06.1ã€‚ </p><br><h3 id="logika-raboty-routera"> è·¯ç”±å™¨çš„é€»è¾‘ </h3><br><p> æˆ‘ä»¬åŠ è½½åˆ—è¡¨ï¼Œå°†å®ƒä»¬æ”¾åœ¨iptablesä¸­ï¼Œiptablesç”¨0x1æ ‡è®°æ ‡è®°è¿™äº›åˆ—è¡¨ä¸­çš„æ‰€æœ‰åœ°å€ã€‚ æ­¤å¤–ï¼Œæ‰€æœ‰æ ‡è®°ä¸º0x1çš„æ•°æ®åŒ…éƒ½è¿›å…¥å•ç‹¬çš„è·¯ç”±è¡¨ï¼Œæ‰€æœ‰è½å…¥è¯¥è·¯ç”±è¡¨çš„æ•°æ®åŒ…éƒ½é€šè¿‡wgæ¥å£ã€‚ </p><br><p><img src="https://habrastorage.org/webt/vy/rc/ji/vyrcjihaaozo-vzf1nkm9nlxpl0.gif"></p><br><h3 id="ustanovka-paketov"> å¥—ä»¶å®‰è£… </h3><br><p> è‡³äºé—ªå­˜ä¸Šçš„å ç”¨ç©ºé—´ï¼Œæ‰€æœ‰å†…å®¹å¤§çº¦éœ€è¦0.9MBã€‚ å¦‚æœæ‚¨çš„ä½ç½®éå¸¸ç³Ÿç³•ï¼Œè¯·ç”¨wgetæ›¿æ¢curlï¼Œå¹¶ä¸”å¯èƒ½ä¸éœ€è¦å®‰è£…dnscrypt-proxyã€‚ </p><br><p> æˆ‘ä»¬æŠŠåŒ…è£¹ã€‚ åœ¨OpenWrtä¸­ï¼Œè¿™å¯ä»¥é€šè¿‡opkgè½¯ä»¶åŒ…ç®¡ç†å™¨è½»æ¾å®Œæˆï¼š </p><br><pre> <code class="bash hljs">opkg update opkg install ipset wireguard curl</code> </pre> <br><h3 id="zagruzka-spiskov"> ä¸‹è½½æ¸…å• </h3><br><p> é€šè¿‡OpenWrtçš„æ ‡å‡†åŠŸèƒ½å¯ä»¥å®Œæˆçš„æ‰€æœ‰æ“ä½œéƒ½é€šè¿‡å®ƒä»¬å®Œæˆã€‚ å…¶ä»–æ‰€æœ‰å†…å®¹ï¼ˆçƒ­æ’æ‹”é™¤å¤–ï¼‰éƒ½æ”¾åœ¨ä¸€ä¸ªå°è„šæœ¬ä¸­ï¼š </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh START=99 dir=/tmp/lst mkdir -p $dir echo "Run download lists" curl -z $dir/subnet.lst https://antifilter.download/list/subnet.lst --output $dir/subnet.lst curl -z $dir/ipsum.lst https://antifilter.download/list/ipsum.lst --output $dir/ipsum.lst echo "Firewall restart" /etc/init.d/firewall restart</span></span></code> </pre> <br><p> ç¦æ­¢å­ç½‘å’Œåœ°å€çš„åˆ—è¡¨æ˜¯é€šè¿‡æ–‡ä»¶è·å–çš„ã€‚ å¯¹äºä»–ä»¬ï¼Œæˆ‘ä»¬åœ¨/ tmpä¸­åˆ›å»ºä¸€ä¸ªç›®å½•ã€‚ åœ¨/ tmpä¸­-å› ä¸ºå®ƒæ˜¯RAMï¼Œæ‰€ä»¥OpenWrtçš„è¿™ç§åŠŸèƒ½éå¸¸æ–¹ä¾¿ã€‚ å†æ¬¡åœ¨è·¯ç”±å™¨çš„ROMä¸Šå†™å…¥å†…å®¹æ˜¯ä¸å€¼å¾—çš„ã€‚ </p><br><p> æˆ‘ä»¬ç”¨antifilter.download curlæŠ½å‡ºåˆ—è¡¨ï¼Œzæ ‡å¿—æ„å‘³ç€curlä»…åœ¨è¿œç¨‹æ–‡ä»¶ä¸æœ¬åœ°æ–‡ä»¶ä¸åŒæˆ–æœ¬åœ°æ–‡ä»¶ä¸å­˜åœ¨æ—¶æ‰ä¸‹è½½æ–‡ä»¶ï¼Œä¾‹å¦‚åŠ è½½è·¯ç”±å™¨æ—¶ã€‚ </p><br><p>  <em>subnet.lst-</em>é˜»æ­¢çš„å­ç½‘çš„åˆ—è¡¨ï¼›å®ƒä¸ä¼šç»å¸¸æ›´æ”¹ã€‚ <br>  <em>ipsum.lst</em>æ˜¯è¢«é˜»æ­¢åœ°å€çš„åˆ—è¡¨ï¼Œç”±æ©ç è¿›è¡Œæ±‡æ€»ã€‚ è€Œä¸æ˜¯15ä¸‡æ¡è®°å½•ï¼Œæˆ‘ä»¬å¾—åˆ°äº†1.5ä¸‡æ¡-æ–¹ä¾¿ã€‚ </p><br><p> åœ¨æ‹¥æœ‰æ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬å°†é‡æ–°å¯åŠ¨é˜²ç«å¢™ï¼Œè¿™å¯¹äºä½¿ipsetæ­£å¸¸è¿è¡Œå¹¶å°†åˆ—è¡¨æ·»åŠ åˆ°iptablesæ˜¯å¿…è¦çš„ï¼Œæˆ‘ä»¬å°†åœ¨/ etc / config / firewallä¸­é…ç½®ipsetã€‚ </p><br><p> æˆ‘ä»¬åœ¨/etc/init.d/ä¸­æ·»åŠ çš„è„šæœ¬ç§°ä¸ºhirknã€‚ ä½¿å®ƒå¯æ‰§è¡Œ </p><br><pre> <code class="bash hljs">chmod +x /etc/init.d/hirkn</code> </pre> <br><p> ç°åœ¨æˆ‘ä»¬ä¸ä»…æœ‰ä¸€ä¸ªè„šæœ¬ï¼Œè€Œä¸”è¿˜æœ‰ä¸€ä¸ªå®Œæ•´çš„æœåŠ¡ã€‚ ä¸ºäº†ä½¿å®ƒåœ¨å¯åŠ¨æ—¶å¯åŠ¨ï¼Œæˆ‘ä»¬åœ¨/etc/rc.dä¸­è¿›è¡Œç¬¦å·é“¾æ¥ã€‚ æˆ‘ä»¬éœ€è¦å®ƒåœ¨æ‰€æœ‰å…¶ä»–æœåŠ¡ä¹‹åå¯åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="å‰ç¼€S99">S99å‰ç¼€</a> </p><br><pre> <code class="bash hljs">ln -s /etc/init.d/hirkn /etc/rc.d/S99hirkn</code> </pre> <br><p> åˆ—è¡¨éœ€è¦ä¸æ—¶æ›´æ–°ï¼Œæˆ‘ä»¬åœ¨cronä¸­æ·»åŠ è®°å½•ï¼š </p><br><pre> <code class="bash hljs">crontab -e</code> </pre> <br><pre> <code class="bash hljs">0 4 * * * /etc/init.d/hirkn</code> </pre> <br><p> æ¯å¤©æ›´æ–°ä¸€æ¬¡ä¼¼ä¹è¶³å¤Ÿäº†ã€‚ è¯·è®°ä½ï¼Œå°†åˆ—è¡¨æ·»åŠ åˆ°ipsetæ—¶ï¼Œç½‘ç»œæ–­å¼€ï¼Œåœ¨æˆ‘çš„æƒ…å†µä¸‹ä¸º2ç§’ã€‚ <br>  <strong>UPD</strong> ï¼šå¦‚æœæ‚¨ä¸æƒ³ä¼‘æ¯ï¼Œåˆ™<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">sigo73</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">Grayver</a>åœ¨æ³¨é‡Šä¸­å»ºè®®äº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œã€‚ </p><br><p> åŒæ—¶æ‰“å¼€è¡¨å† ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒè¢«ç¦ç”¨ï¼š </p><br><pre> <code class="bash hljs">/etc/init.d/cron <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> /etc/init.d/cron start</code> </pre> <br><h3 id="konfiguraciya-tablicy-marshrutizacii"> è·¯ç”±è¡¨é…ç½® </h3><br><p> åªéœ€æ·»åŠ ä»¥ä¸‹è¡Œï¼Œå³å¯ä¸ºé€šè¿‡éš§é“çš„æµé‡åˆ›å»ºè·¯ç”±è¡¨ï¼š </p><br><pre> <code class="bash hljs">99 vpn</code> </pre> <br><p> åˆ°/ etc / iproute2 / rt_tablesæ–‡ä»¶ã€‚ </p><br><p> æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é€šè¿‡wgæ¥å£ä¸ºâ€œ vpnâ€è¡¨åˆ›å»ºé»˜è®¤è·¯ç”±ï¼š </p><br><pre> <code class="bash hljs">ip route add table vpn default dev wg0</code> </pre> <br><p> ä½†æ˜¯ï¼Œå½“æ‚¨é‡æ–°å¯åŠ¨ç½‘ç»œæ—¶ï¼Œè·¯ç”±æ¶ˆå¤±äº†ï¼Œå› æ­¤æˆ‘ä»¬åœ¨/etc/hotplug.d/iface/ç›®å½•ä¸­åˆ›å»ºäº†30-rknrouteæ–‡ä»¶ï¼Œå…¶å†…å®¹ç®€å•ï¼š </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh ip route add table vpn default dev wg0</span></span></code> </pre> <br><p> è¿™æ„å‘³ç€å½“æ‚¨æ‰“å¼€/å…³é—­æ¥å£æ—¶ï¼Œå°†æ·»åŠ æˆ‘ä»¬çš„è·¯ç”±ã€‚ å› æ­¤ï¼Œæ­¤è·¯ç”±å°†å§‹ç»ˆè¢«æ³¨å†Œã€‚ </p><br><h3 id="konfiguraciya-seti"> ç½‘ç»œé…ç½® </h3><br><p> æˆ‘ä»¬éœ€è¦ä¸ºæ ‡è®°ä¸º0x1çš„æ•°æ®åŒ…é…ç½®WireGuardå’Œè§„åˆ™ã€‚ </p><br><p>  WireGuardé…ç½®ä½äº/ etc / config / networkä¸­ </p><br><p>  â€œæœåŠ¡å™¨â€éƒ¨åˆ†ï¼š </p><br><pre> <code class="bash hljs">config interface <span class="hljs-string"><span class="hljs-string">'wg0'</span></span> option private_key <span class="hljs-string"><span class="hljs-string">'privatekey-client'</span></span> list addresses <span class="hljs-string"><span class="hljs-string">'192.168.100.3/24'</span></span> option listen_port <span class="hljs-string"><span class="hljs-string">'51820'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'wireguard'</span></span></code> </pre> <br><p>  <strong>private_key</strong>æ˜¯æˆ‘ä»¬åœ¨é…ç½®æœåŠ¡å™¨æ—¶ç”Ÿæˆçš„privatekey-client <br>  <strong>åˆ—å‡ºåœ°å€</strong> -wgæ¥å£åœ°å€ <br>  <strong>listen_port</strong> -WireGuardæ¥å—è¿æ¥çš„ç«¯å£ã€‚ ä½†æ˜¯è¿æ¥å°†é€šè¿‡æœåŠ¡å™¨ä¸Šçš„ç«¯å£è¿›è¡Œï¼Œå› æ­¤åœ¨è¿™é‡Œæˆ‘ä»¬ä¸ä¼šä¸ºå…¶æ‰“å¼€é˜²ç«å¢™ä¸Šçš„ç«¯å£ <br>  <strong>åŸå‹</strong> -æŒ‡å®šåè®®ï¼Œä»¥ä¾¿openwrtå¯ä»¥ç†è§£è¿™æ˜¯WireGuardé…ç½® </p><br><p>  â€œå®¢æˆ·â€éƒ¨åˆ†ï¼š </p><br><pre> <code class="bash hljs">config wireguard_wg0 option public_key <span class="hljs-string"><span class="hljs-string">'publickey-server'</span></span> option allowed_ips <span class="hljs-string"><span class="hljs-string">'0.0.0.0/0'</span></span> option route_allowed_ips <span class="hljs-string"><span class="hljs-string">'0'</span></span> option endpoint_host <span class="hljs-string"><span class="hljs-string">'wg-server-ip'</span></span> option persistent_keepalive <span class="hljs-string"><span class="hljs-string">'25'</span></span> option endpoint_port <span class="hljs-string"><span class="hljs-string">'51820'</span></span></code> </pre> <br><p>  <strong>public_key-å…¬å…±</strong>å¯†é’¥æœåŠ¡å™¨å¯†é’¥ <br>  <strong>allowed_ips-</strong>æµé‡å¯ä»¥é€šè¿‡éš§é“è¿›å…¥çš„å­ç½‘ï¼Œåœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œä¸éœ€è¦é™åˆ¶ï¼Œå› æ­¤ä¸º0.0.0.0/0 <br>  <strong>route_allowed_ips-</strong>ä¸€ä¸ªæ ‡å¿—ï¼Œè¯¥æ ‡å¿—é€šè¿‡wgæ¥å£ä¸ºallowed_ipså‚æ•°ä¸ºåˆ—å‡ºçš„ç½‘ç»œå»ºç«‹è·¯ç”±ã€‚ åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œè¿™æ˜¯æ²¡æœ‰å¿…è¦çš„ï¼Œiptableså¯ä»¥å®Œæˆè¿™é¡¹å·¥ä½œ <br>  <strong>endpoint_host-</strong>æˆ‘ä»¬çš„wgæœåŠ¡å™¨çš„ip / URL <br>  <strong>sistence_keepalive-</strong>å‘é€æ•°æ®åŒ…ä»¥æ”¯æŒè¿æ¥ä¹‹åçš„æ—¶é—´é—´éš” <br>  <strong>Endpoint_port-</strong>æœåŠ¡å™¨ä¸Šçš„Wireguardç«¯å£ </p><br><p> æˆ‘ä»¬è¿˜å°†åœ¨ç½‘ç»œé…ç½®ä¸­æ·»åŠ ä¸€æ¡è§„åˆ™ï¼Œè¯¥è§„åˆ™ä¼šå°†æ‰€æœ‰æ ‡è®°ä¸º0x1çš„æµé‡å‘é€åˆ°è·¯ç”±è¡¨â€œ vpnâ€ï¼š </p><br><pre> <code class="bash hljs">config rule option priority <span class="hljs-string"><span class="hljs-string">'100'</span></span> option lookup <span class="hljs-string"><span class="hljs-string">'vpn'</span></span> option mark <span class="hljs-string"><span class="hljs-string">'0x1'</span></span></code> </pre> <br><h3 id="konfiguraciya-firewall"> é˜²ç«å¢™é…ç½® </h3><br><p><del> æˆ‘ä»¬æ·»åŠ äº†ä¸¤ä¸ªæ ‡è®°åŒ…çš„è§„åˆ™ï¼Œå®ƒä»¬ä¸é€‚åˆopenwrt UCIè¯­æ³•ï¼Œå› æ­¤æˆ‘ä»¬å°†å®ƒä»¬â€œæŒ‰åŸæ ·â€æ·»åŠ åˆ°/etc/firewall.userä¸­ã€‚ </del><br>  <strong>UPD</strong> ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">Grayver</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="å»ºè®®çš„">å»ºè®®</a>å®ƒä»¬éå¸¸åˆé€‚ã€‚ æˆ‘ä»¬åœ¨è®¾ç½®ipsetä¹‹åè®¾ç½®å®ƒä»¬ </p><br><p> é˜²ç«å¢™é…ç½®åœ¨/ etc / config / firewallä¸­ </p><br><p> æ·»åŠ ä¸€ä¸ªåŒºåŸŸç”¨äºçº¿å«ã€‚ åœ¨openwrtä¸­ï¼ŒåŒºåŸŸæ˜¯iptablesä¸­çš„è‡ªå®šä¹‰é“¾ã€‚ å› æ­¤ï¼Œå°†åˆ›å»ºå…·æœ‰ä¸€ä¸ª/å¤šä¸ªæ¥å£çš„åŒºåŸŸï¼Œå¹¶ä¸”è§„åˆ™å·²ç»æŒ‚åœ¨å…¶ä¸Šã€‚  wgçš„åŒºåŸŸå¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="bash hljs">config zone option name <span class="hljs-string"><span class="hljs-string">'wg'</span></span> option family <span class="hljs-string"><span class="hljs-string">'ipv4'</span></span> option masq <span class="hljs-string"><span class="hljs-string">'1'</span></span> option output <span class="hljs-string"><span class="hljs-string">'ACCEPT'</span></span> option forward <span class="hljs-string"><span class="hljs-string">'REJECT'</span></span> option input <span class="hljs-string"><span class="hljs-string">'REJECT'</span></span> option mtu_fix <span class="hljs-string"><span class="hljs-string">'1'</span></span> option network <span class="hljs-string"><span class="hljs-string">'wg0'</span></span></code> </pre> <br><p> æˆ‘ä»¬ä»…å…è®¸æµé‡é€€å‡ºæ¥å£å¹¶å¯ç”¨ä¼ªè£…ã€‚ </p><br><p> ç°åœ¨ï¼Œæ‚¨éœ€è¦å¯ç”¨ä»lanåŒºåŸŸåˆ°wgåŒºåŸŸçš„è½¬å‘ï¼š </p><br><pre> <code class="bash hljs">config forwarding option src <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option dest <span class="hljs-string"><span class="hljs-string">'wg'</span></span></code> </pre> <br><p> å¥½å§ï¼Œæœ€åä¸€ä»¶äº‹æ˜¯ä½¿ç”¨ipsetåœ¨iptablesä¸­åˆ›å»ºåˆ—è¡¨ï¼š </p><br><pre> <code class="bash hljs">config ipset option name <span class="hljs-string"><span class="hljs-string">'vpn_subnets'</span></span> option storage <span class="hljs-string"><span class="hljs-string">'hash'</span></span> option loadfile <span class="hljs-string"><span class="hljs-string">'/tmp/lst/subnet.lst'</span></span> option match <span class="hljs-string"><span class="hljs-string">'dst_net'</span></span> config ipset option name <span class="hljs-string"><span class="hljs-string">'vpn_ipsum'</span></span> option storage <span class="hljs-string"><span class="hljs-string">'hash'</span></span> option loadfile <span class="hljs-string"><span class="hljs-string">'/tmp/lst/ipsum.lst'</span></span> option match <span class="hljs-string"><span class="hljs-string">'dst_net'</span></span></code> </pre> <br><p>  <strong>loadfile-</strong>æˆ‘ä»¬ä»ä¸­è·å–åˆ—è¡¨çš„æ–‡ä»¶ <br>  <strong>åç§°</strong> -æˆ‘ä»¬åˆ—è¡¨çš„åç§° <br>  <strong>storage</strong> ï¼Œ <strong>match-</strong>åœ¨è¿™é‡Œæˆ‘ä»¬æŒ‡å®šå¦‚ä½•å­˜å‚¨ä»¥åŠä»€ä¹ˆç±»å‹çš„æ•°æ®ã€‚ æˆ‘ä»¬å°†å­˜å‚¨â€œå­ç½‘â€ç±»å‹ </p><br><p>  <strong>UPD</strong> ï¼šå¦‚æœè¦ä½¿ç”¨å•ä¸ªIPåœ°å€çš„åˆ—è¡¨ï¼Œåˆ™éœ€è¦å¢åŠ ipsetåˆ—è¡¨çš„å¤§å°ã€‚ åœ¨é…ç½®ipsetä¸­æ·»åŠ  </p><br><pre> <code class="plaintext hljs"> option hashsize '1000000' option maxelem '1000000'</code> </pre> <br><p> å¦åˆ™ä½ ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ </p><br><pre> <code class="plaintext hljs">ipset v6.38: Hash is full, cannot add more elements</code> </pre> <br><p>  <strong>UPD</strong> ï¼šæ·»åŠ ä¸¤ä¸ªç”¨äºæ ‡è®°åŒ…è£…çš„è§„åˆ™ </p><br><pre> <code class="plaintext hljs">config rule option name 'mark_subnet' option src 'lan' option proto 'all' option ipset 'vpn_subnets' option set_mark '0x1' option target 'MARK' config rule option name 'mark_ipsum' option src 'lan' option proto 'all' option ipset 'vpn_ipsum' option set_mark '0x1' option target 'MARK'</code> </pre> <br><p> è¿™äº›è§„åˆ™æ„å‘³ç€ä»vpn_subnetså’Œvpn_ipsumåˆ—è¡¨è¿›å…¥å­ç½‘çš„æ‰€æœ‰æ•°æ®åŒ…éƒ½å¿…é¡»æ ‡è®°ä¸º0x1ã€‚ </p><br><p> ä¹‹åï¼Œæˆ‘ä»¬é‡æ–°å¯åŠ¨ç½‘ç»œï¼š </p><br><pre> <code class="bash hljs">/etc/init.d/network restart</code> </pre> <br><p><img src="https://habrastorage.org/webt/e6/pm/m6/e6pmm6etqcw0dbz-c3ddqmzqemo.png"></p><br><p> å¹¶è¿è¡Œè„šæœ¬ï¼š </p><br><pre> <code class="bash hljs">/etc/init.d/hirkn</code> </pre> <br><p><img src="https://habrastorage.org/webt/e4/q-/6r/e4q-6rktvq2y8znvhmtpxfdsnwi.gif"></p><br><p> ç¼–å†™å®Œè„šæœ¬åï¼Œä¸€åˆ‡éƒ½ä¼šä¸ºæ‚¨å·¥ä½œã€‚ æ£€æŸ¥è·¯ç”±å™¨å®¢æˆ·ç«¯ä¸Šçš„è·¯ç”±ï¼š </p><br><pre> <code class="bash hljs">mtr/traceroute telegram.org/linkedin.com</code> </pre> <br><p><img src="https://habrastorage.org/webt/wp/6e/jp/wp6ejpwtfwu9xkk-iizc8qj_aeu.gif"></p><br><h2 id="bonusom-nastroim-dnscrypt"> å¥–åŠ±é…ç½®DNSCrypt </h2><br><p> æ€ä¹ˆäº† æ‚¨çš„æä¾›å•†å¯ä»¥å°å¿ƒåœ°æ›¿æ¢è¢«é˜»æ­¢èµ„æºçš„ipåœ°å€ï¼Œä»è€Œä½¿ç”¨å­˜æ ¹å°†æ‚¨é‡å®šå‘åˆ°æ‚¨çš„ipï¼Œé‚£ä¹ˆï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„IPæ—è·¯å°†æ— æµäºäº‹ã€‚ å¯¹äºæ›¿æ¢ï¼Œä¸ä¸€å®šæ€»æ˜¯ä½¿ç”¨æä¾›ç¨‹åºçš„dnsæœåŠ¡å™¨ï¼Œæ‚¨çš„è¯·æ±‚å¯ä»¥è¢«æ‹¦æˆªï¼Œç­”å¤å°†è¢«æ›¿æ¢ã€‚ å¥½çš„ï¼Œé¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œä¸ä»…æä¾›è€…å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ </p><br><pre> <code class="bash hljs">opkg install dnscrpt-proxy</code> </pre> <br><p> åƒè¿™æ ·é…ç½®/ etc / config / dnscrypt-proxyé…ç½®ï¼š </p><br><pre> <code class="bash hljs">config dnscrypt-proxy ns1 option address <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option port <span class="hljs-string"><span class="hljs-string">'5353'</span></span> option resolver <span class="hljs-string"><span class="hljs-string">'cpunks-ru'</span></span></code> </pre> <br><p> å› æ­¤ï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°ä¸»æœºä¸Šå¯ç”¨çš„ç«¯å£5353ä¸Šæä¾›äº†dnscryptæœåŠ¡ã€‚ </p><br><p>  <strong>è§£æå™¨</strong>æ˜¯æ”¯æŒåŠ å¯†çš„DNSæœåŠ¡å™¨ã€‚ åœ¨è·¯ç”±å™¨ä¸Šï¼Œæ–‡ä»¶/usr/share/dnscrypt-proxy/dnscrypt-resolvers.csvåŒ…å«å‘å¸ƒå·²å®‰è£…dnscryptç‰ˆæœ¬æ—¶çš„å¯ç”¨æœåŠ¡å™¨åˆ—è¡¨ã€‚ é€šå¸¸ï¼Œè¿™é‡Œæ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://dnscrypt.info/public-servers/</a>æ‰€æœ‰å¯ç”¨çš„dnscryptæœåŠ¡å™¨ã€‚ æ‚¨å¯ä»¥é€‰æ‹©å…¶ä»–è§£æå™¨å’Œ/æˆ–æ·»åŠ æœåŠ¡å™¨ä»¥å®ç°å®¹é”™åŠŸèƒ½ã€‚ è¯·è®°ä½ï¼Œä¸ºäº†ä½¿DNSCryptä¸é€‰å®šçš„è§£æå™¨ä¸€èµ·ä½¿ç”¨ï¼Œå¿…é¡»åœ¨dnscrypt-resolvers.csvä¸­æŒ‡å®šå®ƒã€‚ </p><br><p> æˆ‘ä»¬å°†dnsmasqé…ç½®ä¸ºä¸dnscryptä¸€èµ·ä½¿ç”¨ã€‚ åœ¨/ etc / config / dhcpä¸­ï¼Œå°†ä»¥ä¸‹è¡Œæ³¨é‡Šæ‰ï¼š </p><br><pre> <code class="bash hljs">option resolvfile <span class="hljs-string"><span class="hljs-string">'/tmp/resolv.conf.auto'</span></span></code> </pre> <br><p> è¿™æ ·å°±ä¸ä¼šæ¶‰åŠæä¾›å•†dnsæœåŠ¡å™¨ã€‚ </p><br><p> å¹¶æ·»åŠ ï¼š </p><br><pre> <code class="bash hljs"> list server <span class="hljs-string"><span class="hljs-string">'/pool.ntp.org/208.67.222.222'</span></span> list server <span class="hljs-string"><span class="hljs-string">'127.0.0.1#5353'</span></span></code> </pre> <br><p>  <strong>åˆ—è¡¨æœåŠ¡å™¨çš„â€œ domain / ip_dnsâ€æ¡ç›®</strong>æŒ‡ç¤ºè¦ä½¿ç”¨å“ªä¸ªdnsæœåŠ¡å™¨æ¥è§£ææŒ‡å®šçš„åŸŸã€‚ å› æ­¤ï¼Œæˆ‘ä»¬ä¸ä½¿ç”¨dnscryptè¿›è¡ŒntpåŒæ­¥-å¯¹äºdnscryptæœåŠ¡è€Œè¨€ï¼Œæ‹¥æœ‰å½“å‰æ—¶é—´å¾ˆé‡è¦ã€‚ </p><br><p><del> è·¯ç”±å™¨åŠ è½½æ—¶ï¼Œhirknè„šæœ¬çš„è¿è¡Œé€Ÿåº¦æ¯”dnscryptå¯åŠ¨çš„é€Ÿåº¦å¿«ï¼Œå› æ­¤antifilter.downloadåŸŸæ— æ³•è§£æï¼Œå¹¶ä¸”åˆ—è¡¨ä¹Ÿä¸ä¼šä¸‹è½½ã€‚ æ‚¨å¯ä»¥æå‡ºä¸€äº›å»¶è¿Ÿæˆ–æå‡ºå…¶ä»–å»ºè®®ï¼Œä½†åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»ç„¶æ²¡æœ‰ç†ç”±ã€‚ </del><br>  <strong>UPD</strong> ï¼šéœ€è¦æ·»åŠ ä¸€è¡Œ </p><br><pre> <code class="plaintext hljs">START=99</code> </pre> <br><p> éšè—è„šæœ¬ </p><br><p> ç»“æœï¼Œæˆ‘ä»¬åœ¨é…ç½®ä¸­å¾—åˆ°äº†è¿™æ ·çš„æ’å…¥ï¼š </p><br><pre> <code class="bash hljs"> <span class="hljs-comment"><span class="hljs-comment">#option resolvfile '/tmp/resolv.conf.auto' list server '/pool.ntp.org/208.67.222.222' list server '127.0.0.1#5353'</span></span></code> </pre> <br><p>  <strong>UPD</strong> ï¼šåœ¨æŸäº›è®¾å¤‡ä¸Šï¼Œæ— è®ºå¦‚ä½•ï¼ŒDNSCryptéƒ½ä¼šåœ¨è„šæœ¬ä¹‹åå¯åŠ¨ã€‚ è§£å†³æ­¤é—®é¢˜çš„æœ€ç®€å•æ–¹æ³•æ˜¯å°†è¡Œæ·»åŠ åˆ°/ etc / config / dhcp </p><br><pre> <code class="plaintext hljs"> list server '/antifilter.download/208.67.222.222'</code> </pre> <br><p> ç¦ç”¨å¯¹WANæ¥å£ä½¿ç”¨æä¾›ç¨‹åºDNS <br> åœ¨/ etc / config / networkä¸­æ·»åŠ è¯¥è¡Œ </p><br><pre> <code class="plaintext hljs">option peerdns '0'</code> </pre> <br><p> åˆ°wanæ¥å£ã€‚ <br> æˆ‘ä»¬å¾—åˆ°è¿™ä¸ªé…ç½® </p><br><pre> <code class="bash hljs">config interface <span class="hljs-string"><span class="hljs-string">'wan'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0.2'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'dhcp'</span></span> option peerdns <span class="hljs-string"><span class="hljs-string">'0'</span></span></code> </pre> <br><p> é‡æ–°å¯åŠ¨ç½‘ç»œ </p><br><pre> <code class="plaintext hljs">/etc/init.d/network restart</code> </pre> <br><p> æ·»åŠ åˆ°å¯åŠ¨å¹¶å¯åŠ¨dnscryptï¼š </p><br><pre> <code class="bash hljs">/etc/init.d/dnscrypt-proxy <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> /etc/init.d/dnscrypt-proxy start</code> </pre> <br><p> é‡æ–°å¯åŠ¨dnsmasqï¼š </p><br><pre> <code class="bash hljs">/etc/init.d/dnsmasq restart</code> </pre> <br><p><img src="https://habrastorage.org/webt/i2/b5/90/i2b590nxr6-lqnk1h2-tq-i6t-4.gif"><br>  <em>ä¸ä½¿ç”¨DNSCryptå’Œä½¿ç”¨DNSCryptçš„å·¥ä½œæ’å›¾</em> </p><br><h2 id="avtomaticheski-razvertyvaem-s-pomoschyu-ansible"> é€šè¿‡Ansibleè‡ªåŠ¨éƒ¨ç½² </h2><br><p> å‰§æœ¬å’Œæ¨¡æ¿åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="çš„github">githubä¸Š</a> ã€‚ å®ƒä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ¨¡å—</a> ï¼Œè·¯ç”±å™¨ä¸Šä¸éœ€è¦pythonï¼Œå¹¶ä¸”æ”¯æŒuciã€‚ æˆ‘è¯•å›¾ç¡®ä¿æ‚¨çš„OpenWrté…ç½®ä¿æŒä¸å˜ï¼Œä½†è¿˜æ˜¯è¦å°å¿ƒã€‚ </p><br><p> å®‰è£…gekmihesg / ansible-openwrtæ¨¡å—ï¼š </p><br><pre> <code class="bash hljs">ansible-galaxy install gekmihesg.openwrt</code> </pre> <br><p> å¤åˆ¶å‰§æœ¬å’Œtempeytaï¼š </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /etc/ansible git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/itdoginfo/ansible-openwrt-hirkn mv ansible-openwrt-hirkn/* . rm -rf ansible-openwrt-hirkn</code> </pre> <br><p> å°†è·¯ç”±å™¨æ·»åŠ åˆ°ä¸»æœºï¼š </p><br><pre> <code class="bash hljs">[openwrt] 192.168.1.1</code> </pre> <br><p> å°†æ‚¨çš„å˜é‡æ›¿æ¢ä¸ºhirkn.ymlï¼š </p><br><pre> <code class="bash hljs"> vars: ansible_template_dir: /etc/ansible/templates/ wg_server_address: wg_server_ip/url wg_private_key: privatekey-client wg_public_key: publickey-server wg_listen_port: 51820 wg_client_port: 51820 wg_client_address: 192.168.100.3/24</code> </pre> <br><p> ç¡®ä¿è®¾ç½®ï¼š </p><br><p>  <strong>wg_server_address</strong> -IP / URL WireguardæœåŠ¡å™¨ <br>  <strong>wg_private_key</strong> ï¼Œ <strong>wg_public_key-</strong>å®¢æˆ·ç«¯å’Œå…¬å…±æœåŠ¡å™¨çš„ç§é’¥ <br> å…¶ä½™çš„ä¸èƒ½æ›´æ”¹æˆ–æ›´æ”¹ï¼Œå…·ä½“å–å†³äºWireGuardæœåŠ¡å™¨çš„é…ç½®æ–¹å¼ </p><br><p> å¯åŠ¨å‰§æœ¬ </p><br><pre> <code class="bash hljs">ansible-playbook playbooks/hirkn.yml</code> </pre> <br><p> å®Œæˆå‰§æœ¬åï¼Œè·¯ç”±å™¨å°†ç«‹å³å¼€å§‹é€šè¿‡WireguardæœåŠ¡å™¨ç»•è¿‡é”ã€‚ </p><br><h2 id="pochemu-ne-bgp"> ä¸ºä»€ä¹ˆä¸ä½¿ç”¨BGPï¼Ÿ </h2><br><p> åœ¨openwrtä¸‹ï¼Œæœ‰ä¸¤ä¸ªå®ç°BGPçš„å®ç”¨ç¨‹åº-quaggaå’Œbirdã€‚  Quaggæˆ‘æ— æ³•ä»åè¿‡æ»¤å™¨æ”¶é›†æ•°æ®ã€‚ ä¼¯å¾·è·ç¦»è¯¥æœåŠ¡ä»…å‡ æ­¥ä¹‹é¥ï¼Œä½†æ˜¯ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä¸æ˜ç™½å¦‚ä½•å¼ºåˆ¶å°†é»˜è®¤æ¥å£æ·»åŠ åˆ°æ¥æ”¶çš„å­ç½‘ä¸­ã€‚  ï¼ˆæˆ‘å°†å¾ˆé«˜å…´çŸ¥é“è¯¥å¦‚ä½•å®ç°ï¼‰ã€‚ </p><br><p> åœ¨æœ‰å…³æ­¤ç±»æ–‡ç« çš„è¯„è®ºä¸­ï¼Œæˆ‘çœ‹åˆ°äººä»¬çš„è·¯ç”±å™¨åœ¨å°†åˆ—è¡¨æ”¾å…¥è·¯ç”±è¡¨ä¸­çš„è¿‡ç¨‹ä¸­ï¼Œå·²ç»â€œè€ƒè™‘å‘¨å…¨â€ã€‚ é€šè¿‡ipsetå®ç°åï¼Œå½“æ‚¨å‘ä»–æä¾›15,000ä¸ªå­ç½‘çš„åˆ—è¡¨æ—¶ï¼Œæˆ‘çš„å°ç±³mi 3Gä¼šæ€è€ƒ2ç§’ï¼ˆAsus rt-n16æŒç»­5ç§’ï¼‰ã€‚ ç»è¿‡è¿›ä¸€æ­¥çš„å·¥ä½œï¼Œæˆ‘æ²¡æœ‰æ³¨æ„åˆ°å¤„ç†å™¨ä¸Šçš„è´Ÿè½½ã€‚ </p><br><p>  <em>æ‰€æœ‰ææ–™å¹¶éå‘¼åé‡‡å–è¡ŒåŠ¨ï¼Œè€Œæ˜¯ä¸ºäº†ç†Ÿæ‚‰Linux OSçš„åŠŸèƒ½è€Œæå‡ºçš„ã€‚</em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN440030/">https://habr.com/ru/post/zh-CN440030/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN440018/index.html">åŠ¨æ€å±€éƒ¨æ›å…‰</a></li>
<li><a href="../zh-CN440020/index.html">æµ‹è¯•ä¸­çš„å›å½’æˆ–å›å½’</a></li>
<li><a href="../zh-CN440022/index.html">å°æ³•æ‹‰åˆ©ï¼šé‡‘èç§‘æŠ€åˆ›ä¸šå…¬å¸Rally Rdå°†è®©æ‚¨è´­ä¹°ç¨€æœ‰æ±½è½¦çš„â€œè‚¡ä»½â€</a></li>
<li><a href="../zh-CN440024/index.html">ä»STM32å°†printfï¼ˆï¼‰é‡å®šå‘åˆ°Qt Creatoræ§åˆ¶å°</a></li>
<li><a href="../zh-CN440026/index.html">Kaggleï¼šä¸èƒ½èµ°è·¯-è®©æˆ‘ä»¬è·‘æ­¥</a></li>
<li><a href="../zh-CN440032/index.html">äººå·¥æ™ºèƒ½åœ°å¹³çº¿é›¶é»æ˜</a></li>
<li><a href="../zh-CN440034/index.html">å»å»ºç­‘ã€‚ ä»å¾®æœåŠ¡åˆ°æ•´ä½“</a></li>
<li><a href="../zh-CN440036/index.html">è§¦æ‘¸æ‰“å­—</a></li>
<li><a href="../zh-CN440040/index.html">åœ¨å‘å±•ä¸­-å„è‡ªä¸ºæˆ˜ã€‚ ä½†æ˜¯æœ‰æ—¶å€™è¿™ä¼šå¯¼è‡´æ­»èƒ¡åŒã€‚</a></li>
<li><a href="../zh-CN440044/index.html">é«˜é€šè¯¦ç»†å†å²</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>