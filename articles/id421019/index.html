<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍💼 💉 🖐🏼 Menggergaji layanan Windows Anda - panduan untuk "programmer tidak nyata" 🍕 ✖️ 👨‍👩‍👧‍👧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Setelah Anda berpikir tentang cara mengubah skrip atau aplikasi menjadi layanan Windows. Kemungkinan besar, tugas itu tidak akan sepele - setidaknya a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Menggergaji layanan Windows Anda - panduan untuk "programmer tidak nyata"</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pc-administrator/blog/421019/"><p><img src="https://habrastorage.org/webt/j3/j5/7b/j3j57big8bze9751j7_frrcjc7q.jpeg"></p><br><p>  Setelah Anda berpikir tentang cara mengubah skrip atau aplikasi menjadi layanan Windows.  Kemungkinan besar, tugas itu tidak akan sepele - setidaknya aplikasi akan membutuhkan antarmuka khusus untuk menerima perintah dari sistem.  Dan karena ada persyaratan dan batasan, yaitu skrip, dan kruk, yang menyenangkan hati, untuk diatasi. </p><br><p>  Artikel ini akan bermanfaat bagi mereka yang, seperti saya, adalah "bukan programmer yang sebenarnya." <a name="habracut"></a></p><br><h1 id="zachem-nuzhna-sluzhba-esli-est-naznachennye-zadaniya">  Mengapa saya memerlukan layanan jika ada tugas yang dijadwalkan </h1><br><p>  Berbeda dengan tugas yang ditugaskan, layanan berjalan terus-menerus, dimulai pada awal PC dan dapat dikontrol oleh alat Windows.  Juga, skrip yang diluncurkan secara rutin mungkin memerlukan data dari peluncuran sebelumnya, dan mungkin bermanfaat untuk mendapatkan data dari sumber eksternal - misalnya, dalam kasus TCP atau server Web. </p><br><p>  Secara pribadi, selama lima tahun terakhir saya harus membuat layanan tiga setengah kali: </p><br><ul><li> Itu diperlukan untuk membuat layanan pada <strong>fail2ban untuk Windows 2003.</strong> yang berfungsi dengan log FileZilla dan Apache, dan jika dicurigai brute force, ia memblokir IP menggunakan alat Windows biasa - ipsec. </li><li>  Analog server telnet untuk Windows versi rumah.  Butuh untuk menjalankan perintah pada workstation jarak jauh yang menjalankan Windows 7 Home.  Bahkan, upaya kedua untuk memainkan layanan. </li><li>  Pemutar musik untuk lantai perdagangan di bawah Windows.  Tugas pada TK dapat diselesaikan dengan bantuan <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mpd</a></strong> dan sekumpulan skrip, tapi saya memutuskan - jika kita membuat skrip, lalu mengapa tidak "menumpuk" pemain itu sendiri.  Berdasarkan perpustakaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">BASS.dll</a> . </li><li>  Ketika memilih server web dengan dukungan untuk mengunduh file di bawah Windows, satu opsi adalah <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">HFS</a></strong> .  Dia tidak bisa bekerja sendiri, jadi dia harus "mendorong" dia ke dalam layanan.  Akibatnya, saya tidak suka solusinya, dan baru saja menginstal <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tema Apaxy</a> di server web Apache. </li></ul><br><p>  Untuk membuat layanan, Anda dapat menggunakan bahasa pemrograman dewasa seperti C. Tetapi jika Anda tidak ingin menghubungi Visual Studio, maka ambil alat yang sudah jadi.  Ada solusi berbayar seperti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">FireDaemon Pro</a> atau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">AlwaysUp</a> , tetapi kami secara tradisional akan fokus pada yang gratis. </p><br><h1 id="sposob-pervyy-ot-microsoft">  Cara pertama.  Dari Microsoft </h1><br><p>  Mekanisme yang sudah lama ini terdiri dari dua komponen: utilitas <strong>instsrv.exe</strong> untuk menginstal layanan dan <strong>srvany.exe</strong> , proses untuk meluncurkan file yang dapat dieksekusi.  Misalkan kita membuat server Web pada PowerShell menggunakan modul <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Polaris</a> .  Scriptnya akan sangat sederhana: </p><br><pre><code class="hljs powershell"><span class="hljs-built_in"><span class="hljs-built_in">New-PolarisGetRoute</span></span> <span class="hljs-literal"><span class="hljs-literal">-Path</span></span> <span class="hljs-string"><span class="hljs-string">'/helloworld'</span></span> <span class="hljs-literal"><span class="hljs-literal">-Scriptblock</span></span> { <span class="hljs-variable"><span class="hljs-variable">$Response</span></span>.Send(<span class="hljs-string"><span class="hljs-string">'Hello World!'</span></span>) } <span class="hljs-built_in"><span class="hljs-built_in">Start-Polaris</span></span> <span class="hljs-literal"><span class="hljs-literal">-Port</span></span> <span class="hljs-number"><span class="hljs-number">8080</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-variable"><span class="hljs-variable">$true</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">Start-Sleep</span></span> <span class="hljs-literal"><span class="hljs-literal">-Milliseconds</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> }</code> </pre> <br><p><img src="https://habrastorage.org/webt/im/br/xz/imbrxzpsqml1osyityi0k1nwe1w.jpeg"><br>  <em>Karya yang disebut "server".</em> </p><br><p>  Sekarang mari kita coba mengubah skrip menjadi layanan.  Untuk melakukan ini, unduh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Windows Resource Kit Tools</a> , di mana utilitas kami akan berada.  Mari kita mulai dengan menginstal layanan kosong dengan perintah: </p><br><pre> <code class="hljs tex">instsrv WebServ C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">temp</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rktools</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">srvany</span></span></span></span>.exe</code> </pre><br><p>  Di mana WebServ adalah nama layanan baru kami.  Jika perlu, melalui snap-in <strong>services.msc</strong> , Anda dapat menentukan pengguna di mana layanan akan diluncurkan dan memungkinkan interaksi dengan desktop. </p><br><p>  Sekarang mari kita menulis path ke skrip kita menggunakan sihir registri.  Parameter layanan ada di kunci registri <strong>HKLM \ SYSTEM \ CurrentControlSet \ Services \ WebServ</strong> .  Di dalamnya, kita perlu menambahkan <strong>Parameter</strong> bagian baru dan membuat <strong>Aplikasi</strong> parameter string di sana, yang menunjukkan di dalamnya path ke file yang dapat dieksekusi.  Dalam kasus skrip PowerShell, akan terlihat seperti ini: </p><br><pre> <code class="hljs tex">C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Windows</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">System</span></span></span></span>32<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WindowsPowerShell</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v</span></span></span></span>1.0<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">powershell</span></span></span></span>.exe -ExecutionPolicy Bypass -NoProfile -File C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">temp</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Polaris</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">server</span></span></span></span>.ps1</code> </pre><br><p><img src="https://habrastorage.org/webt/2c/9a/zw/2c9azwf_tlvz6cs2ez4jlw7pl58.jpeg"><br>  <em>Layanan yang disesuaikan.</em> </p><br><p>  Anda dapat berlari dan menikmati. </p><br><p><img src="https://habrastorage.org/webt/4j/qh/kd/4jqhkdbgssb6gv8el-qpnfn4wea.jpeg"><br>  <em>Layanan kerja.</em> </p><br><p>  Namun, metode ini memiliki kelemahan: </p><br><ul><li>  Utilitas sudah tua, dikembangkan sebelum penemuan PowerShell, UAC dan hal-hal lainnya. </li><li>  <strong>Srvany</strong> tidak mengontrol operasi aplikasi.  Bahkan jika itu jatuh ke dalam kesalahan, layanan akan melanjutkan pekerjaannya seolah-olah tidak ada yang terjadi. </li><li>  Harus menyesuaikan dan menggali ke dalam registri.  Apakah Anda ingat bahwa menggali ke dalam registri tidak aman? </li></ul><br><p>  Oleh karena itu, kami beralih ke metode yang sebagian tanpa masalah ini. </p><br><h1 id="sposob-vtoroy-pochti-vzroslyy">  Cara kedua, hampir dewasa </h1><br><p>  Ada utilitas bernama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">NSSM</a> - <strong>Non-Sucking Service Manager</strong> , yang dapat diterjemahkan sebagai <em>manajer layanan yang tidak buruk</em> .  Berbeda dengan yang sebelumnya, ini didukung oleh pengembang, dan kode sumber diterbitkan di situs.  Selain metode yang biasa, instalasi juga tersedia melalui manajer paket <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Chocolately</a> . </p><br><p>  Anda dapat membuat layanan dari baris perintah yang biasa, dilengkapi dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi</a> di situs pengembang.  Tapi kami akan menggunakan PowerShell.  Karena kita bisa, tentu saja. </p><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$nssm</span></span> = (<span class="hljs-built_in"><span class="hljs-built_in">Get-Command</span></span> ./nssm).Source <span class="hljs-variable"><span class="hljs-variable">$serviceName</span></span> = <span class="hljs-string"><span class="hljs-string">'WebServ'</span></span> <span class="hljs-variable"><span class="hljs-variable">$powershell</span></span> = (<span class="hljs-built_in"><span class="hljs-built_in">Get-Command</span></span> powershell).Source <span class="hljs-variable"><span class="hljs-variable">$scriptPath</span></span> = <span class="hljs-string"><span class="hljs-string">'C:\temp\Polaris\server.ps1'</span></span> <span class="hljs-variable"><span class="hljs-variable">$arguments</span></span> = <span class="hljs-string"><span class="hljs-string">'-ExecutionPolicy Bypass -NoProfile -File "{0}"'</span></span> <span class="hljs-operator"><span class="hljs-operator">-f</span></span> <span class="hljs-variable"><span class="hljs-variable">$scriptPath</span></span> &amp; <span class="hljs-variable"><span class="hljs-variable">$nssm</span></span> install <span class="hljs-variable"><span class="hljs-variable">$serviceName</span></span> <span class="hljs-variable"><span class="hljs-variable">$powershell</span></span> <span class="hljs-variable"><span class="hljs-variable">$arguments</span></span> &amp; <span class="hljs-variable"><span class="hljs-variable">$nssm</span></span> status <span class="hljs-variable"><span class="hljs-variable">$serviceName</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Start-Service</span></span> <span class="hljs-variable"><span class="hljs-variable">$serviceName</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Get-Service</span></span> <span class="hljs-variable"><span class="hljs-variable">$serviceName</span></span></code> </pre> <br><p><img src="https://habrastorage.org/webt/nn/gf/xz/nngfxzjxsimbi2srebmcwjzioie.jpeg"><br>  <em>Instalasi melalui PowerShell.</em> </p><br><p>  Untuk perubahan, kami akan memeriksa kerja layanan tidak dengan browser, tetapi juga melalui PowerShell menggunakan perintah <strong>Invoke-RestMethod.</strong> </p><br><p><img src="https://habrastorage.org/webt/b-/wg/17/b-wg17nhhlesw6xon8sdv9c0hks.png"><br>  <em>Dan itu benar-benar berfungsi.</em> </p><br><p>  Tidak seperti <strong>srvany</strong> , metode ini memungkinkan Anda untuk me-restart aplikasi saat startup, mengarahkan ulang <strong>stdin</strong> dan <strong>stdout</strong> dan banyak lagi.  Secara khusus, jika Anda tidak ingin menulis perintah pada baris perintah, maka jalankan saja GUI dan masukkan parameter yang diperlukan melalui antarmuka yang nyaman. </p><br><p>  GUI dimulai dengan perintah: </p><br><pre> <code class="hljs sql">nssm.exe <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> ServiceName</code> </pre> <br><p><img src="https://habrastorage.org/webt/ji/rg/6i/jirg6iwexgpn_3zun4ich0zgepo.jpeg"><br>  <em>Anda bahkan dapat mengkonfigurasi prioritas dan penggunaan inti prosesor.</em> </p><br><p>  Memang, ada lebih banyak peluang daripada <strong>svvany</strong> dan sejumlah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">analog</a> lainnya.  Dari minus, kontrol yang tidak memadai atas seluruh proses mencolok. </p><br><p>  Ada kekurangan timah.  Oleh karena itu, saya akan beralih ke metode paling hardcore dari semua yang diuji. </p><br><h1 id="sposob-tretiy-autoit">  Cara ketiga.  AutoIT </h1><br><p>  Karena saya sudah lama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menyukai</a> bahasa scripting ini, saya tidak bisa melewati perpustakaan yang disebut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">_Services_UDF v4</a> .  Ini dilengkapi dengan dokumentasi dan contoh yang kaya, jadi di bawah spoiler saya akan segera memberikan teks lengkap dari skrip yang dihasilkan. </p><br><div class="spoiler">  <b class="spoiler_title">Daftar skrip</b> <div class="spoiler_text"><p>  Jadi, mari kita coba "membungkus" layanan web kami ke dalamnya: </p><br><pre> <code class="hljs mel">#NoTrayIcon #RequireAdmin #Region #AutoIt3Wrapper_Version=Beta #AutoIt3Wrapper_UseUpx=n #AutoIt3Wrapper_Compile_Both=y #AutoIt3Wrapper_UseX64=y #EndRegion Dim $MainLog = @ScriptDir &amp; <span class="hljs-string"><span class="hljs-string">"\test_service.log"</span></span> #include &lt;services.au3&gt; #include &lt;WindowsConstants.au3&gt; $sServiceName=<span class="hljs-string"><span class="hljs-string">"WebServ"</span></span> If $cmdline[<span class="hljs-number"><span class="hljs-number">0</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> Then Switch $cmdline[<span class="hljs-number"><span class="hljs-number">1</span></span>] Case <span class="hljs-string"><span class="hljs-string">"install"</span></span>, <span class="hljs-string"><span class="hljs-string">"-i"</span></span>, <span class="hljs-string"><span class="hljs-string">"/i"</span></span> InstallService() Case <span class="hljs-string"><span class="hljs-string">"remove"</span></span>, <span class="hljs-string"><span class="hljs-string">"-u"</span></span>, <span class="hljs-string"><span class="hljs-string">"/u"</span></span>, <span class="hljs-string"><span class="hljs-string">"uninstall"</span></span> RemoveService() Case Else ConsoleWrite(<span class="hljs-string"><span class="hljs-string">" - - - Help - - - "</span></span> &amp; @CRLF) ConsoleWrite(<span class="hljs-string"><span class="hljs-string">"params : "</span></span> &amp; @CRLF) ConsoleWrite(<span class="hljs-string"><span class="hljs-string">" -i : install service"</span></span> &amp; @CRLF) ConsoleWrite(<span class="hljs-string"><span class="hljs-string">" -u : remove service"</span></span> &amp; @CRLF) ConsoleWrite(<span class="hljs-string"><span class="hljs-string">" - - - - - - - - "</span></span> &amp; @CRLF) Exit EndSwitch Else _Service_init($sServiceName) Exit EndIf Func _main($iArg, $sArgs) If Not _Service_ReportStatus($SERVICE_RUNNING, $NO_ERROR, <span class="hljs-number"><span class="hljs-number">0</span></span>) Then _Service_ReportStatus($SERVICE_STOPPED, _WinAPI_GetLastError(), <span class="hljs-number"><span class="hljs-number">0</span></span>) Exit EndIf $bServiceRunning = True $PID=Run(<span class="hljs-string"><span class="hljs-string">"C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -ExecutionPolicy Bypass -NoProfile -File C:\temp\Polaris\server.ps1"</span></span>) While $bServiceRunning _sleep(<span class="hljs-number"><span class="hljs-number">1000</span></span>) WEnd ProcessClose($PID) _Service_ReportStatus($SERVICE_STOP_PENDING, $NO_ERROR, <span class="hljs-number"><span class="hljs-number">1000</span></span>) DllCallbackFree($tServiceMain) DllCallbackFree($tServiceCtrl) _Service_ReportStatus($SERVICE_STOPPED, $NO_ERROR, <span class="hljs-number"><span class="hljs-number">0</span></span>) DllClose($hAdvapi32_DLL) DllClose($hKernel32_DLL) EndFunc Func _Sleep($delay) Local $result = DllCall($hKernel32_DLL, <span class="hljs-string"><span class="hljs-string">"none"</span></span>, <span class="hljs-string"><span class="hljs-string">"Sleep"</span></span>, <span class="hljs-string"><span class="hljs-string">"dword"</span></span>, $delay) EndFunc Func InstallService() #RequireAdmin Local $bDebug = True If $cmdline[<span class="hljs-number"><span class="hljs-number">0</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> Then $sServiceName = $cmdline[<span class="hljs-number"><span class="hljs-number">2</span></span>] EndIf If $bDebug Then ConsoleWrite(<span class="hljs-string"><span class="hljs-string">"InstallService("</span></span>&amp;$sServiceName &amp;<span class="hljs-string"><span class="hljs-string">"): Installing service, please wait"</span></span>) _Service_Create($sServiceName, $sServiceName, $SERVICE_WIN32_OWN_PROCESS, $SERVICE_AUTO_START, $SERVICE_ERROR_SEVERE, <span class="hljs-string"><span class="hljs-string">'"'</span></span> &amp; @ScriptFullPath &amp; <span class="hljs-string"><span class="hljs-string">'"'</span></span>);,<span class="hljs-string"><span class="hljs-string">""</span></span>,False,<span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-string"><span class="hljs-string">"NT AUTHORITY\NetworkService"</span></span>) If @error Then Msgbox(<span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-string"><span class="hljs-string">"InstallService(): Problem installing service, Error number is "</span></span> &amp; @error &amp; @CRLF &amp; <span class="hljs-string"><span class="hljs-string">" message : "</span></span> &amp; _WinAPI_GetLastErrorMessage()) Else If $bDebug Then ConsoleWrite(<span class="hljs-string"><span class="hljs-string">"InstallService(): Installation of service successful"</span></span>) EndIf Exit EndFunc Func RemoveService() _Service_Stop($sServiceName) _Service_Delete($sServiceName) If Not @error Then EndIf Exit EndFunc Func _exit() _Service_ReportStatus($SERVICE_STOPPED, $NO_ERROR, <span class="hljs-number"><span class="hljs-number">0</span></span>); EndFunc Func StopTimer() _Service_ReportStatus($SERVICE_STOP_PENDING, $NO_ERROR, $iServiceCounter) $iServiceCounter += <span class="hljs-number"><span class="hljs-number">-100</span></span> EndFunc Func _Stopping() _Service_ReportStatus($SERVICE_STOP_PENDING, $NO_ERROR, <span class="hljs-number"><span class="hljs-number">3000</span></span>) EndFunc</code> </pre> </div></div><br><p>  Saya akan menganalisis lebih detail saat aplikasi diluncurkan.  Itu dimulai setelah operasi <strong>$ bServiceRunning = True</strong> dan berubah menjadi loop yang tampaknya tak terbatas.  Bahkan, proses ini akan terganggu segera setelah layanan menerima sinyal penyelesaian - apakah itu keluar atau berhenti secara manual. </p><br><p>  Karena program untuk skrip adalah eksternal (powershell.exe), maka setelah keluar dari loop kita harus menyelesaikan pekerjaannya menggunakan <strong>ProcessClose</strong> . </p><br><p>  Untuk melakukan ini, skrip harus dikompilasi ke <strong>.exe</strong> , dan kemudian instal layanan dengan menjalankan exe dengan <strong>-i</strong> switch <strong>.</strong> </p><br><p><img src="https://habrastorage.org/webt/wl/xp/ph/wlxpphvp20lakbyd2wii7ssytle.jpeg"><br>  <em>Itu berhasil!</em> </p><br><p>  Tentu saja, metode ini bukan yang paling nyaman, dan semua fitur tambahan harus diimplementasikan secara independen, apakah itu me-restart aplikasi jika terjadi kegagalan atau rotasi log.  Tetapi dia memberikan kontrol penuh atas apa yang terjadi.  Dan pada akhirnya, Anda dapat melakukan lebih banyak lagi - mulai dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">memberi tahu</a> Telegram tentang kegagalan layanan hingga interaksi IPC dengan program lain.  Dan selain itu - dalam bahasa scripting, tanpa menginstal dan belajar Visual Studio. </p><br><p>  Beri tahu kami, apakah Anda harus mengubah skrip dan aplikasi menjadi layanan? </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id421019/">https://habr.com/ru/post/id421019/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id421005/index.html">REST-terjamin: Tips Berguna</a></li>
<li><a href="../id421007/index.html">Tape recorder - alat untuk merekam autotest</a></li>
<li><a href="../id421009/index.html">25 dan 26 Agustus: konferensi online tentang manajemen operasional</a></li>
<li><a href="../id421011/index.html">Pertanyaan pada wawancara yang menurut Anda bodoh. Tapi tidak juga</a></li>
<li><a href="../id421015/index.html">Survei Keberlanjutan 2018 untuk Segmen Internet Nasional</a></li>
<li><a href="../id421021/index.html">Ulasan Google Hadoop (dataproc)</a></li>
<li><a href="../id421023/index.html">Skizofrenia perusahaan</a></li>
<li><a href="../id421025/index.html">7 firewall terkelola yang kuat untuk melindungi infrastruktur cloud Anda</a></li>
<li><a href="../id421027/index.html">SDMX (Data Statistik dan Metadata eXchange)</a></li>
<li><a href="../id421029/index.html">Cara meningkatkan throughput toko dan menghilangkan antrian</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>