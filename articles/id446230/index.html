<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â™ï¸ ğŸ‘©â€ğŸ“ ğŸ‘ğŸ½ Pemantauan jarak jauh dan pengelolaan perangkat berbasis Linux / OpenWrt / Lede melalui port 80, lanjutan ğŸœï¸ ğŸ•Ÿ ã€½ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ini adalah bagian akhir dari artikel ini, ini adalah awalnya . 

 Terakhir kali saya menulis tentang bagaimana saya menerapkan pemantauan perangkat, s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pemantauan jarak jauh dan pengelolaan perangkat berbasis Linux / OpenWrt / Lede melalui port 80, lanjutan</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446230/">  Ini adalah bagian akhir dari artikel ini, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ini adalah awalnya</a> . <br><br>  Terakhir kali saya menulis tentang bagaimana saya menerapkan pemantauan perangkat, sekarang kita akan fokus pada manajemen.  Dalam diskusi dengan "teknisi" pada bagian Pelanggan, saya sering menemukan persepsi terbatas tentang kemampuan perangkat kecil tersebut (dengan sumber daya memori rendah dan kinerja), banyak orang berpikir bahwa "maksimum yang kami butuhkan adalah mengirim reboot, untuk sesuatu yang lebih serius - kami akan mengirim tim" . <br><br>  Tetapi latihan menunjukkan bahwa ini tidak sepenuhnya benar. <br><a name="habracut"></a><br>  Berikut adalah daftar singkat dari tugas umum yang umum: <br><br><ol><li>  Diagnosis dan pemecahan masalah jaringan.  Di belakang port ethernet router Anda, perangkat keras lain biasanya memiliki alamat IP internal sendiri.  Terkadang, itu bisa (perlu) "ping".  Atau manajemen terowongan - jika router yang tidak tiba-tiba naik pada router yang berjalan melalui modem 3G, tetapi kita melihat router itu sendiri. </li><li>  Layanan sistem.  Pembaruan firmware, peningkatan skrip layanan. </li><li>  Tindakan penyeimbangan.  Ini bisa disebut "penyimpangan", tetapi konsep "penyeimbang" seperti, saya kutip, <i>"kemampuan seorang seniman sirkus untuk menjaga keseimbangan dalam posisi tubuh yang tidak stabil"</i> lebih cocok.  Situasi serupa muncul karena terbatasnya anggaran pelanggan.  Berikut adalah beberapa contoh, tetapi karena  mereka tidak memiliki hubungan langsung dengan subjek narasi, taruh dalam catatan </li></ol><br><div class="spoiler">  <b class="spoiler_title">Pemantauan wifi</b> <div class="spoiler_text">  Topik modis selama lima tahun terakhir terutama di antara rantai ritel federal.  Anda berjalan perlahan melalui lantai perdagangan, dan ponsel Anda dengan Wi-Fi dihidupkan dalam upaya untuk "menempel" ke beberapa utas jaringan secara teratur mengirimkan paket Permintaan Probe yang dapat dianalisis untuk menghitung seberapa sering Anda datang ke toko ini, untuk apa berjalan lintasan dan sebagainya.  Kemudian data dikumpulkan, dianalisis, peta panas diambil dan manajer untuk gambar-gambar seperti "knock out" uang dari manajemen atau investor.  Sementara itu .... "tidak ada uang, tetapi Anda tunggu ...", dan hasilnya (nyata) harus sudah ditampilkan, lagu lama yang baik termasuk "Ya, ya, maka tentu saja kita akan meletakkan tsiska dan apa pun yang kita inginkan, tetapi sekarang kita perlu tunjukkan pada pelanggan hasilnya!  Ngomong-ngomong, mereka lupa mengatakan bahwa Pelanggan mengizinkan peralatan kami terhubung ke hotspot-nya melalui Wi-Fi, tetapi secara umum, itu sama seperti kita adalah klien tamu. "  Dan sekarang Anda harus membuat router-balancers - beberapa subfaces WiFi naik, salah satunya menempel pada hotspot, dan yang kedua memonitor lingkungan, dengan panik membongkar hasil tcpdump ke dalam dirinya sendiri, lalu isi file tersebut dikemas ke dalam arsip dan berisiko mati karena "makan berlebihan" mencoba memuntahkan konten di server ftp.  Tidak mengherankan bahwa router-balancer sering "rusak" dan entah bagaimana harus disusupkan dari jarak jauh. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Radius</b> <div class="spoiler_text">  Di sini lebih mudah untuk menggambarkan situasi dengan sesuatu seperti pernyataan ini oleh pelanggan: <i>â€œKami menginginkan jaringan hotspot yang terdesentralisasi yang bekerja pada peralatan yang modelnya tidak diketahui sebelumnya, melalui saluran, tetapi kami belum tahu yang mana.</i>  <i>Ah, mereka lupa mengatakan, kami tidak hanya ingin menampilkan iklan kepada pelanggan, tetapi juga menganalisis segala sesuatu di sekitar tempat pemasangan hotspot.</i>  <i>Tidak, kami belum tahu mengapa, tapi kami akan datang, jangan ragu, kami dapat menemukan ide ini "</i> <br></div></div><br>  Dan kita tidak boleh lupa bahwa karena banyak keadaan yang tidak menentu sebelumnya, kontrol harus dilakukan dalam kondisi non-standar, ketika kita tidak dapat terhubung ke router langsung melalui ip: port dan dipaksa untuk hanya menunggu aktivitas darinya.  Jika kita mengabaikannya, maka dialog antara server dan router dapat direpresentasikan seperti ini: <br><br><ul><li>  <b>Router</b> : hai.  Saya router seperti itu, apakah ada tugas untuk saya? </li><li>  <b>Server</b> : router ini dan itu saya daftarkan Anda bahwa Anda masih hidup.  Inilah tugasnya: tunjukkan pada saya hasil dari perintah ifconfig? </li><li>  <b>Router</b> : hai.  Saya seperti router, terakhir kali Anda meminta saya untuk menunjukkan hasil ifconfig, ini dia.  Apakah ada tugas untuk saya? </li><li>  <b>Server</b> : router ini dan itu saya daftarkan Anda bahwa Anda masih hidup.  Tidak ada tugas untuk Anda. </li></ul><br>  Pertanyaan yang paling menarik: bagaimana sebuah remote router dapat mengirimkan sejumlah informasi?  Pada bagian terakhir, saya menggambarkan bahwa pada router karena sumber daya yang terbatas hanya ada "stripped down" wget yang hanya berfungsi melalui GET dan tidak ada yang lain, tidak ada ftp client atau curl.  Lebih tepatnya, kita membutuhkan cara universal, terlepas dari fitur perakitan gambar.  Saya memutuskan untuk menggunakan wget.  Lebih tepatnya, bagaimana saya "berhenti" - Saya tidak punya pilihan :) <br><br><div class="spoiler">  <b class="spoiler_title">Segera reservasi</b> <div class="spoiler_text">  Solusi manajemen saya berfungsi, tetapi sangat terbatas dan saya yakin itu bengkok, bahkan jika itu cocok untuk sebagian besar pelanggan saya.  Bagaimana mungkin melakukannya dengan bijak - untuk menulis utilitas kecil yang mengirim data biner melalui port ke-80.  Masukkan (utilitas) dalam firmware router dan gunakan bash untuk mengaksesnya.  Tetapi kenyataannya adalah: a) Anda harus cepat b) mungkin Anda perlu melakukan segala sesuatu di "router zoo" yang ada c) "jangan membahayakan!"  - jika router bekerja dan melakukan tugas-tugas lain, cobalah untuk membuat perubahan yang akan mempengaruhi fungsionalitas yang ada. <br></div></div><br>  Mari beralih ke implementasi.  Katakanlah pelanggan Anda inginkan dari zabbix untuk mem-boot ulang router dengan mudah dan alami, dengan "klik mouse."  Hari ini kita akan memulai deskripsi implementasi dengan zabbiksa. <br><br>  Dalam menu "Administrasi" -&gt; "Skrip" tambahkan skrip baru.  Kami menyebutnya "Reboot", seperti perintah yang kami tulis "php /usr/share/zabbix/reboot.php {HOST.HOST}" <br><br><img src="https://habrastorage.org/webt/pf/hg/on/pfhgongtotx7njamqfnrnxcqvhg.jpeg"><br><br>  Selanjutnya: Menu "Pemantauan" -&gt; "Data terbaru" -&gt; "Klik kanan pada node jaringan."  Beginilah tampilan menu setelah menambahkan skrip. <br><br><img src="https://habrastorage.org/webt/4k/um/go/4kumgoc08rhijg8sz5jq_e1t3z4.jpeg"><br>  Oleh karena itu, kami meletakkan skrip reboot.php di direktori / usr / share / zabbix (Anda mungkin memiliki yang lain, saya menggunakan direktori root zabbixa). <br><br><div class="spoiler">  <b class="spoiler_title">Penafian untuk keamanan</b> <div class="spoiler_text">  Untuk kejelasan penjelasan dalam skrip, saya hanya menggunakan id router, tetapi saya tidak menggunakan kata sandi.  Dalam versi yang berfungsi, ini tidak direkomendasikan!  Mengapa saya melakukan ini: karena pertanyaan besarnya adalah di mana menyimpan kata sandi untuk router?  Dalam zabbixe sendiri dalam "inventaris"?  Praktek yang saling bertentangan.  Sebagai pilihan: batasi akses eksternal ke file reboot.php itu sendiri <br></div></div><br>  Reboot.php file <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//      $user = $argv[1]; // .      -   !            . //$password = $argv[2]; $conn=new mysqli("localhost","db_user","db_password","db_name"); if (mysqli_connect_errno()) { exit(); } $conn-&gt;set_charset("utf8"); // ""  reboot     task  users.   task    . $sql_users=$conn-&gt;prepare("UPDATE users SET task='reboot' WHERE id=? AND status='active';"); $sql_users-&gt;bind_param('s', $user); $sql_users-&gt;execute(); $sql_users-&gt;close(); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br>  Sebenarnya semuanya.  Pertanyaan "bagaimana mendapatkan hasil dari eksekusi perintah dari sisi perangkat" tetap terbuka.  Pertimbangkan masalah menggunakan perintah ifconfig sebagai contoh.  Perintah ini dapat dikirim ke perangkat: <br><br><pre> <code class="bash hljs">message=`ifconfig`; wget <span class="hljs-string"><span class="hljs-string">"http://xn--80abgfbdwanb2akugdrd3a2e5gsbj.xn--p1ai/a.php?u=user&amp;p=password!&amp;m=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$message</span></span></span><span class="hljs-string">"</span></span> -O /tmp/out.txt</code> </pre> <br>  dimana: <br>  <i>message = `ifconfig`</i> - kami menetapkan hasil dari output perintah ifconfig ke variabel $ message <br>  <i>wget " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">xn - 80abgfbdwanb2akugdrd3a2e5gsbj.xn - p1ai / a.php</a></i> - skrip a.php kami yang mendaftarkan router dan menerima pesan dari mereka <br>  <i>u = pengguna &amp; p = kata sandi! &amp; m = $ message</i> - kredensial dan nilai variabel permintaan m - memberikan konten variabel $ message <br>  <i>-O /tmp/out.txt</i> - kami tidak perlu menampilkan ke file /tmp/out.txt dalam kasus ini, tetapi jika Anda tidak menentukan parameter ini, wget tidak berfungsi <br><br><div class="spoiler">  <b class="spoiler_title">Mengapa ini bekerja dengan bengkok</b> <div class="spoiler_text">  Karena itu lubang keamanan potensial.  kesalahan paling berbahaya yang dapat terjadi adalah jika, misalnya, ada simbol "&amp;" di output dari perintah Anda.  Oleh karena itu, perlu untuk memfilter semua yang dikirim dari router dan semua yang datang ke server.  <b>Ya, saya benar-benar malu.</b>  Dalam pembelaan saya, saya hanya dapat menulis - bahwa seluruh artikel dikhususkan untuk bagaimana mengelola router dengan firmware yang tidak ditentukan sebelumnya, dengan saluran komunikasi yang tidak ditentukan sebelumnya. <br></div></div><br>  Yah, saya telah menyentuh masa depan: Saya belum menemukan cara untuk mencerminkan hasil (misalnya, hasil dari perintah) yang datang ke server menggunakan alat zabbix standar. <br><br>  Saya mengingatkan Anda bahwa <a href="">semua sumber dapat diambil dari repositori Git</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id446230/">https://habr.com/ru/post/id446230/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id446212/index.html">Kedalaman SIEM: korelasi out-of-box. Bagian 5. Metodologi untuk mengembangkan aturan korelasi</a></li>
<li><a href="../id446214/index.html">OS1: kernel primitif di Rust untuk x86. Bagian 3. Kartu memori, pengecualian kesalahan halaman, tumpukan dan alokasi</a></li>
<li><a href="../id446218/index.html">Desainer game tidak jauh berbeda dari seorang psiko. Bagaimana kami membuat game CMAN</a></li>
<li><a href="../id446222/index.html">Penggunaan potensi termal untuk analisis wilayah</a></li>
<li><a href="../id446228/index.html">Meningkatkan kualitas klasifikasi teks dengan menghubungkan Wikipedia</a></li>
<li><a href="../id446234/index.html">Bagaimana para sukarelawan dari seluruh dunia membuat siaran langsung ICPC-2019</a></li>
<li><a href="../id446236/index.html">Yandex akan meningkatkan algoritme pengenalan suara</a></li>
<li><a href="../id446238/index.html">Memanfaatkan bootloader yang telah ditandatangani untuk menghindari UEFI Secure Boot</a></li>
<li><a href="../id446242/index.html">Penundaan sebagai alat untuk perjalanan waktu</a></li>
<li><a href="../id446244/index.html">Ekstensi Chrome untuk pengembangan web dan bekerja dengan GitHub</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>