<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçüé§ üîÅ üôçüèø Die 10 h√§ufigsten Fehler in C ++ - Projekten im Jahr 2019 üë©‚Äçüíº üòÉ üí±</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ein weiteres Jahr neigt sich dem Ende zu und es ist eine perfekte Zeit, sich eine Tasse Kaffee zu machen und die Kritiken der Fehler, die in diesem Ja...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Die 10 h√§ufigsten Fehler in C ++ - Projekten im Jahr 2019</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/481188/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a8/cc3/539/7a8cc3539721631b68ce36c56f5471bf.png" alt="Bild 7"></div><br>  Ein weiteres Jahr neigt sich dem Ende zu und es ist eine perfekte Zeit, sich eine Tasse Kaffee zu machen und die Kritiken der Fehler, die in diesem Jahr in Open-Source-Projekten gesammelt wurden, noch einmal durchzulesen.  Dies w√ºrde nat√ºrlich eine Weile dauern, daher haben wir diesen Artikel vorbereitet, um es Ihnen zu erleichtern.  Heute erinnern wir uns an die interessantesten dunklen Flecken, die wir 2019 in Open-Source-C / C ++ -Projekten entdeckt haben. <br><a name="habracut"></a><br><h2>  Nr  10. Auf welchem ‚Äã‚ÄãBetriebssystem laufen wir? </h2><br>  <a href="https://www.viva64.com/en/w/v1040/">V1040</a> M√∂gliche Tippfehler in der Schreibweise eines vordefinierten <a href="https://www.viva64.com/en/w/v1040/">Makronamens</a> .  Das Makro '__MINGW32_' √§hnelt dem Makro '__MINGW32__'.  winapi.h 4112 <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> !defined(__UNICODE_STRING_DEFINED) &amp;&amp; defined(__MINGW32_) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> __UNICODE_STRING_DEFINED #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre> <br>  Der Name des <i>Makros __MINGW32</i> _ enth√§lt einen Tippfehler (MINGW32 wird tats√§chlich von __MINGW32__ deklariert).  An anderer Stelle im Projekt wird der Scheck korrekt geschrieben: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed5/ad7/425/ed5ad7425145902765d728287ab5f2fa.png" alt="Bild 3"></div><br><br>  √úbrigens war dieser Fehler nicht nur der erste, der im Artikel " <a href="https://www.viva64.com/en/b/0658/">CMake: Der Fall, in dem die Qualit√§t des Projekts unverzeihlich ist</a> " beschrieben wurde, sondern auch der allererste echte Fehler, den die V1040-Diagnose in einem echten Open-Source-Projekt gefunden hat (19. August) 2019). <br><br><h2>  Nr  9. Wer ist zuerst da? </h2><br>  <a href="https://www.viva64.com/en/w/v502/">V502</a> Vielleicht arbeitet der Operator '?:' Anders als erwartet.  Der Operator '?:' Hat eine niedrigere Priorit√§t als der Operator '=='.  mir_parser.cpp 884 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Opcode : uint8 { kOpUndef, .... OP_intrinsiccall, OP_intrinsiccallassigned, .... kOpLast, }; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> MIRParser::ParseStmtIntrinsiccall(StmtNodePtr &amp;stmt, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isAssigned) { Opcode o = !isAssigned ? (....) : (....); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> *intrnCallNode = mod.CurFuncCodeMemPool()-&gt;New&lt;IntrinsiccallNode&gt;(....); lexer.NextToken(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (o == !isAssigned ? OP_intrinsiccall : OP_intrinsiccallassigned) { intrnCallNode-&gt;SetIntrinsic(GetIntrinsicID(lexer.GetTokenKind())); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { intrnCallNode-&gt;SetIntrinsic(<span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;MIRIntrinsicID&gt;(....)); } .... }</code> </pre> <br>  Wir interessieren uns f√ºr folgenden Teil: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (o == !isAssigned ? OP_intrinsiccall : OP_intrinsiccallassigned) { .... }</code> </pre> <br>  Die Priorit√§t des Operators '==' ist h√∂her als die des tern√§ren Operators (? :).  Daher wird der Bedingungsausdruck in der falschen Reihenfolge ausgewertet und entspricht dem folgenden Code: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((o == !isAssigned) ? OP_intrinsiccall : OP_intrinsiccallassigned) { .... }</code> </pre> <br>  Da die Konstanten <i>OP_intrinsiccall</i> und <i>OP_intrinsiccallassigned</i> nicht null sind, wird die Bedingung die ganze Zeit <i>wahr zur√ºckgegeben</i> , was bedeutet, dass der Body des <i>else-</i> Zweigs nicht erreichbarer Code ist. <br><br>  Dieser Fehler wurde im Artikel " <a href="https://www.viva64.com/en/b/0690/">√úberpr√ºfen des k√ºrzlich von Huawei als Open Source erstellten Arche-Compilers</a> " beschrieben. <br><br><h2>  Nr  8. Gef√§hrliche bitweise Operationen </h2><br>  <a href="https://www.viva64.com/en/w/v1046/">V1046</a> Unsichere Verwendung der Typen bool 'und' int 'zusammen in der Operation' &amp; = '.  GSLMultiRootFinder.h 175 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFunction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ROOT::Math::IMultiGenFunction &amp; func)</span></span></span><span class="hljs-function"> </span></span>{ ROOT::Math::IMultiGenFunction * f = func.Clone(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!f) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; fFunctions.push_back(f); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fFunctions.size(); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FuncIterator</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bool</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SetFunctionList</span></span></span><span class="hljs-class">( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FuncIterator</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">begin</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FuncIterator</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class">) {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ret = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (FuncIterator itr = begin; itr != end; ++itr) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ROOT::Math::IMultiGenFunction * f = *itr; ret &amp;= AddFunction(*f); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }</code> </pre> <br>  Der Code schl√§gt vor, dass die <i>SetFunctionList-</i> Funktion eine Iteratorliste durchl√§uft.  Wenn mindestens ein Iterator ung√ºltig ist, gibt die Funktion <i>false</i> oder andernfalls <i>true zur√ºck</i> . <br><br>  Die <i>SetFunctionList-</i> Funktion kann jedoch auch f√ºr g√ºltige Iteratoren <i>false zur√ºckgeben</i> .  Lassen Sie uns herausfinden, warum. <i>Die</i> Funktion <i>AddFunction</i> gibt die Anzahl der g√ºltigen Iteratoren in der Liste <i>fFunctions zur√ºck</i> .  Das hei√üt, das Hinzuf√ºgen von Nicht-Null-Iteratoren f√ºhrt dazu, dass die Liste inkrementell gr√∂√üer wird: 1, 2, 3, 4 usw.  Hier kommt der Fehler ins Spiel: <br><br><pre> <code class="cpp hljs">ret &amp;= AddFunction(*f);</code> </pre> <br>  Da die Funktion einen Wert vom Typ <i>int</i> anstelle von <i>bool</i> zur√ºckgibt, gibt die Operation '&amp; =' f√ºr gerade Werte <i>false zur√ºck</i> , da das niedrigstwertige Bit einer geraden Zahl immer auf Null gesetzt ist.  Auf diese Weise kann ein <i>kleiner</i> Fehler den R√ºckgabewert von <i>SetFunctionsList unterbrechen,</i> selbst wenn seine Argumente g√ºltig sind. <br><br>  Wenn Sie das Snippet sorgf√§ltig gelesen haben (und Sie waren es auch?), K√∂nnten Sie bemerkt haben, dass es aus dem Projekt ROOT stammt.  Ja, wir haben es auch √ºberpr√ºft: " <a href="https://www.viva64.com/en/b/0682/">Analyse des Code of ROOT, Scientific Data Analysis Framework</a> ". <br><br><h2>  Nr  7. Variablen vertauscht </h2><br>  <a href="https://www.viva64.com/en/w/v1001/">V1001</a> [CWE-563] Die Variable 'Mode' wird zugewiesen, aber am Ende der Funktion nicht verwendet.  SIModeRegister.cpp 48 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Status</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Mask; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Mode; Status() : Mask(<span class="hljs-number"><span class="hljs-number">0</span></span>), Mode(<span class="hljs-number"><span class="hljs-number">0</span></span>){}; Status(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Mask, <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Mode) : Mask(Mask), Mode(Mode) { Mode &amp;= Mask; }; .... };</code> </pre> <br>  Es ist sehr gef√§hrlich, f√ºr Funktionsargumente die gleichen Namen zu verwenden wie f√ºr Klassenmitglieder, da Sie die Gefahr haben, sie zu verwechseln.  Und genau das ist hier passiert.  Der folgende Ausdruck macht keinen Sinn: <br><br><pre> <code class="cpp hljs">Mode &amp;= Mask;</code> </pre> <br>  Das Argument der Funktion √§ndert sich und das war's.  Dieses Argument wird danach in keiner Weise mehr verwendet.  Was der Programmierer eigentlich schreiben wollte, war wahrscheinlich folgendes: <br><br><pre> <code class="cpp hljs">Status(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Mask, <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Mode) : Mask(Mask), Mode(Mode) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;Mode &amp;= Mask; };</code> </pre> <br>  Dieser Fehler wurde in <a href="http://llvm.org/">LLVM gefunden</a> .  Wir haben die Tradition, dieses Projekt von Zeit zu Zeit zu √ºberpr√ºfen.  In diesem Jahr haben wir es noch einmal <a href="https://www.viva64.com/en/b/0629/">√ºberpr√ºft</a> . <br><br><h2>  Nr  6. C ++ hat seine eigenen Gesetze </h2><br>  Dieser Fehler beruht auf der Tatsache, dass C ++ - Regeln nicht immer mathematischen Regeln oder "gesundem Menschenverstand" folgen.  Schauen Sie sich das kleine Snippet unten an und versuchen Sie, den Fehler selbst zu finden. <br><br>  <a href="https://www.viva64.com/en/w/v709/">V709</a> Verd√§chtiger Vergleich gefunden: 'f0 == f1 == m_fractureBodies.size ()'.  Denken Sie daran, dass 'a == b == c' nicht gleich 'a == b &amp;&amp; b == c' ist.  btFractureDynamicsWorld.cpp 483 <br><br><pre> <code class="cpp hljs">btAlignedObjectArray&lt;btFractureBody*&gt; m_fractureBodies; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> btFractureDynamicsWorld::fractureCallback() { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; numManifolds; i++) { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> f0 = m_fractureBodies.findLinearSearch(....); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> f1 = m_fractureBodies.findLinearSearch(....); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (f0 == f1 == m_fractureBodies.size()) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; .... } .... }</code> </pre> <br>  Die Bedingung scheint zu pr√ºfen, <i>ob f0</i> gleich <i>f1</i> und gleich der Anzahl der Elemente in <i>m_fractureBodies ist</i> .  Es sollte wahrscheinlich √ºberpr√ºft werden, ob sich <i>f0</i> und <i>f1</i> am Ende des Arrays <i>m_fractureBodies befinden,</i> da sie eine Objektposition enthalten, die mit der Methode <i>findLinearSearch () gefunden wurde</i> .  In Wirklichkeit pr√ºft dieser Bedingungsausdruck jedoch, ob <i>f0</i> gleich <i>f1 ist</i> und ob <i>m_fractureBodies.size ()</i> gleich dem Ergebnis des Ausdrucks <i>f0 == f1 ist</i> .  Das hei√üt, der dritte Operand hier wird gegen 0 oder 1 gepr√ºft. <br><br>  Das ist ein sch√∂ner Bug!  Und zum Gl√ºck eine ziemlich seltene.  Bisher haben wir es nur in drei Open-Source-Projekten gesehen, und interessanterweise waren alle drei Spiele-Engines.  Dies ist nicht der einzige Fehler in Bullet.  Die interessantesten wurden im Artikel " <a href="https://www.viva64.com/en/b/0647/">PVS-Studio blickte in die Bullet Engine von Red Dead Redemption</a> " beschrieben. <br><br><h2>  Nr  5. Was steht am Ende der Zeile? </h2><br>  Dieser ist einfach, wenn Sie ein heikles Detail kennen. <br><br>  <a href="https://www.viva64.com/en/w/v739/">V739</a> EOF sollte nicht mit einem Wert vom Typ 'char' verglichen werden.  Das 'ch' sollte vom Typ 'int' sein.  json.cpp 762 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> JsonIn::skip_separator() { <span class="hljs-keyword"><span class="hljs-keyword">signed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> ch; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">','</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( ate_separator ) { .... } .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == EOF) { .... }</code> </pre> <br>  Dies ist einer der Fehler, die Sie nicht leicht erkennen k√∂nnen, wenn Sie nicht wissen, dass <i>EOF</i> als -1 definiert ist.  Wenn Sie also versuchen, es mit einer Variablen mit Vorzeichen zu vergleichen, ist die Bedingung fast immer <i>falsch</i> .  Die einzige Ausnahme ist das als 0xFF (255) codierte Zeichen.  Im Vergleich zu <i>EOF</i> wird dieses Zeichen zu -1, wodurch die Bedingung erf√ºllt wird. <br><br>  Viele Fehler in den diesj√§hrigen Top 10 wurden in Computerspielsoftware gefunden: Engines oder Open-Source-Spiele.  Wie Sie bereits vermutet haben, kam auch dieser aus dieser Gegend.  Weitere Fehler sind im Artikel " <a href="https://www.viva64.com/en/b/0628/">Cataclysm Dark Days Ahead: Static Analysis und Roguelike Games</a> " beschrieben. <br><br><h2>  Nr  4. Die magische Konstante Pi </h2><br>  <a href="https://www.viva64.com/en/w/v624/">V624</a> Die Konstante '3.141592538' enth√§lt wahrscheinlich einen Druckfehler.  Erw√§gen Sie die Verwendung der M_PI-Konstante aus &lt;math.h&gt;.  PhysicsClientC_API.cpp 4109 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">B3_SHARED_API </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b3ComputeProjectionMatrixFOV</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fov, ....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> yScale = <span class="hljs-number"><span class="hljs-number">1.0</span></span> / <span class="hljs-built_in"><span class="hljs-built_in">tan</span></span>((<span class="hljs-number"><span class="hljs-number">3.141592538</span></span> / <span class="hljs-number"><span class="hljs-number">180.0</span></span>) * fov / <span class="hljs-number"><span class="hljs-number">2</span></span>); .... }</code> </pre> <br><br>  Die Pi-Nummer enth√§lt einen winzigen Tippfehler (3,141592653 ...): Bei der 7. Dezimalstelle fehlt die Zahl ‚Äû6‚Äú. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f83/42b/62f/f8342b62f2250ce927675fbbc1f40af7.png" alt="Bild 4"></div>  Eine falsche 1-millionste Dezimalstelle w√ºrde kaum nennenswerten Schaden anrichten, es ist jedoch besser, vorhandene Konstanten aus Bibliotheken zu verwenden, deren Korrektheit garantiert ist.  Die Pi-Nummer wird zum Beispiel durch die Konstante M_PI aus dem Header math.h dargestellt. <br><br>  Sie haben diesen Fehler bereits in dem Artikel " <a href="https://www.viva64.com/en/b/0647/">PVS-Studio hat sich mit der Bullet Engine von Red Dead Redemption befasst</a> " gelesen, in dem es den sechsten Platz belegte.  Wenn Sie es noch nicht gelesen haben, ist dies Ihre letzte Chance. <br><br><h2>  Eine kleine Ablenkung </h2><br>  Wir n√§hern uns den Top 3 der interessantesten Bugs.  Wie Sie wahrscheinlich bemerkt haben, sortiere ich die Fehler nicht nach ihrer Auswirkung, sondern nach dem Aufwand, den ein menschlicher Pr√ºfer ben√∂tigt, um sie zu finden.  Schlie√ülich ist der Vorteil der statischen Analyse gegen√ºber Code√ºberpr√ºfungen im Grunde die Unf√§higkeit von Softwaretools, m√ºde zu werden oder Dinge zu vergessen.  :) <br><br>  Nun wollen wir sehen, was wir in unseren Top 3 haben. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ff/519/18d/2ff51918d95a06eaf72aa7037aa66732.png" alt="Bild 8"></div><br><br><h2>  Nr  3. Eine schwer fassbare Ausnahme </h2><br>  <a href="https://www.viva64.com/en/w/v702/">V702-</a> Klassen sollten immer von std :: exception (und √§hnlichem) als 'public' abgeleitet werden (es wurde kein Schl√ºsselwort angegeben, daher verwendet der Compiler standardm√§√üig 'private').  CalcManager CalcException.h 4 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CalcException</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::exception { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: CalcException(HRESULT hr) { m_hr = hr; } <span class="hljs-function"><span class="hljs-function">HRESULT </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetException</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_hr; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: HRESULT m_hr; };</code> </pre> <br>  Der Analysator hat eine Klasse erkannt, die von der Klasse <i>std :: exception</i> mit dem Modifikator <i>private abgeleitet wurde</i> (der standardm√§√üig verwendet wird, wenn nichts anderes angegeben ist).  Das Problem mit diesem Code besteht darin, dass das Programm beim Versuch, eine generische <i>std :: Ausnahmebedingung</i> <i>abzufangen</i> , eine Ausnahmebedingung vom Typ <i>CalcException √ºbersieht</i> .  Dieses Verhalten beruht auf der Tatsache, dass die private Vererbung die implizite Typkonvertierung verbietet. <br><br>  Sie m√∂chten definitiv nicht, dass Ihr Programm aufgrund eines fehlenden <i>√∂ffentlichen</i> Modifikators abst√ºrzt.  √úbrigens, ich wette, Sie haben diese Anwendung mindestens einmal in Ihrem Leben verwendet, da es sich um den guten alten <a href="https://github.com/Microsoft/calculator">Windows-Rechner handelt</a> , den wir auch Anfang dieses Jahres <a href="https://www.viva64.com/en/b/0615/">√ºberpr√ºft</a> haben. <br><br><h2>  Nr  2. Nicht geschlossene HTML-Tags </h2><br>  <a href="https://www.viva64.com/en/w/v735/">V735</a> M√∂glicherweise falsches HTML.  Das schlie√üende Tag "&lt;/ body&gt;" wurde gefunden, w√§hrend das Tag "&lt;/ div&gt;" erwartet wurde.  book.cpp 127 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> QString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeAlgebraLogBaseConversionPage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> BEGIN INDEX_LINK TITLE(Book::tr(<span class="hljs-string"><span class="hljs-string">"Logarithmic Base Conversion"</span></span>)) FORMULA(y = <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(x) / <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(a), <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>&lt;sub&gt;a&lt;/sub&gt;x = <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(x) / <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(a)) END; }</code> </pre> <br>  Wie so oft sagt der C / C ++ - Quellcode nicht viel aus. Schauen wir uns also den vorverarbeiteten Code an, der aus dem obigen Snippet generiert wurde: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/19a/7cf/4d4/19a7cf4d4da73085a677db2eceede962.png" alt="Bild 6"></div><br><br>  Der Analysator hat ein nicht geschlossenes <i>&lt;div&gt;</i> -Tag gefunden.  Es gibt hier viele HTML-Code-Fragmente, daher m√ºssen die Autoren diese √ºberarbeiten. <br><br>  √úberrascht, dass wir diese Art von Fehlern diagnostizieren k√∂nnen?  Ich war auch beeindruckt, als ich das zum ersten Mal sah.  Also, ja, wir wissen etwas √ºber das Analysieren von HTML-Code.  Nun, nur wenn es sich um C ++ - Code handelt.  :) <br><br>  Dieser Fehler steht nicht nur an zweiter Stelle, sondern ist auch ein zweiter Rechner in unserer Top-10-Liste.  Weitere Informationen zu den in diesem Projekt gefundenen Fehlern finden Sie im Artikel " <a href="https://www.viva64.com/en/b/0618/">Auf den Spuren der Taschenrechner: SpeedCrunch</a> ". <br><br><h2>  Nr  1. schwer fassbare Standardfunktionen </h2><br>  Hier ist der Fehler zuerst platziert.  Dies ist ein beeindruckend seltsamer Fehler, der es durch die Code√ºberpr√ºfung geschafft hat. <br><br>  Versuchen Sie es selbst zu finden: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EatWhitespace</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FILE * InFile)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">/* ----------------------------------------------------------------------- ** * Scan past whitespace (see ctype(3C)) and return the first non-whitespace * character, or newline, or EOF. * * Input: InFile - Input source. * * Output: The next non-whitespace character in the input stream. * * Notes: Because the config files use a line-oriented grammar, we * explicitly exclude the newline character from the list of * whitespace characters. * - Note that both EOF (-1) and the nul character ('\0') are * considered end-of-file markers. * * ----------------------------------------------------------------------- ** */</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (c = getc (InFile); <span class="hljs-built_in"><span class="hljs-built_in">isspace</span></span> (c) &amp;&amp; (<span class="hljs-string"><span class="hljs-string">'\n'</span></span> != c); c = getc (InFile)) ; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (c); } <span class="hljs-comment"><span class="hljs-comment">/* EatWhitespace */</span></span></code> </pre> <br>  Nun wollen wir sehen, was der Analysator zu sagen hat: <br><br>  <a href="https://www.viva64.com/en/w/v560/">V560</a> Ein Teil eines bedingten Ausdrucks ist immer wahr: ('\ n'! = C).  params.c 136. <br><br>  Seltsam, nicht wahr?  Schauen wir uns einen anderen merkw√ºrdigen Punkt an, aber in einer anderen Datei (charset.h): <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> isspace #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">undef</span></span></span><span class="hljs-meta"> isspace #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> .... #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> isspace(c) ((c)==</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">' '</span></span></span><span class="hljs-meta"> || (c) == </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'\t'</span></span></span><span class="hljs-meta">)</span></span></code> </pre> <br>  Hm, das ist in der Tat seltsam ... Wenn also die Variable <i>c</i> gleich <i>'\ n' ist,</i> wird die scheinbar harmlose Funktion <i>isspace (c)</i> auf <i>false zur√ºckgesetzt</i> , wodurch verhindert wird, dass der zweite Teil der Pr√ºfung aufgrund einer Kurzschlussbewertung ausgef√ºhrt wird.  Und wenn <i>isspace (c)</i> ausgef√ºhrt wird, ist die Variable <i>c</i> entweder gleich <i>''</i> oder <i>'\ t',</i> was offensichtlich nicht gleich <i>'\ n' ist</i> . <br><br>  Sie k√∂nnten argumentieren, dass dieses Makro √§hnlich wie <i>#define true false ist</i> und Code wie dieser niemals eine Code√ºberpr√ºfung durchlaufen w√ºrde.  Aber dieser spezielle Ausschnitt tat es - und sa√ü im Archiv und wartete darauf, entdeckt zu werden. <br><br>  Ausf√ºhrlichere Kommentare zu diesem Fehler finden Sie im Artikel " <a href="https://www.viva64.com/en/b/0610/">Willst du einen Detektiv spielen? Finde den</a> Fehler <a href="https://www.viva64.com/en/b/0610/">in einer Funktion von Midnight Commander</a> ". <br><br><h2>  Fazit </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a63/2b1/196/a632b119620f61c1a553a02c998b1509.png" alt="Bild 9"></div><br><br>  Wir haben in diesem Jahr Unmengen von Fehlern gefunden.  Dies waren h√§ufige Fehler beim Kopieren und Einf√ºgen, ungenaue Konstanten, nicht geschlossene Tags und viele andere Fehler.  Unser Analyzer entwickelt sich jedoch weiter und <a href="https://www.viva64.com/en/b/0632/">lernt</a> , immer mehr Arten von Problemen zu diagnostizieren. Daher werden wir mit Sicherheit nicht nachlassen und neue Artikel √ºber Fehler ver√∂ffentlichen, die in Projekten genauso regelm√§√üig wie zuvor gefunden wurden. <br><br>  F√ºr den Fall, dass Sie unsere Artikel noch nicht gelesen haben, wurden all diese Fehler mit unserem statischen Analysator PVS-Studio gefunden. Sie k√∂nnen ihn gerne <a href="https://www.viva64.com/en/pvs-studio-download/">herunterladen</a> und Ihre eigenen Projekte ausprobieren.  Es erkennt Fehler in Programmen, die in C, C ++, C # und Java geschrieben wurden. <br><br>  Sie haben endlich die Ziellinie!  Wenn Sie die ersten beiden Ebenen verpasst haben, schlage ich vor, dass Sie die Gelegenheit nutzen und diese Ebenen mit uns abschlie√üen: <a href="https://habr.com/en/company/pvs-studio/blog/481174/">C #</a> und <a href="https://habr.com/en/company/pvs-studio/blog/481184/">Java</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de481188/">https://habr.com/ru/post/de481188/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de481178/index.html">Top 10 Bugs in C # -Projekten f√ºr 2019</a></li>
<li><a href="../de481180/index.html">M√ºssen Entwickler Vorschl√§ge von Benutzern erhalten?</a></li>
<li><a href="../de481182/index.html">Istio Service Mesh Beitr√§ge Serie</a></li>
<li><a href="../de481184/index.html">Die 10 h√§ufigsten Fehler in Java-Projekten im Jahr 2019</a></li>
<li><a href="../de481186/index.html">Top 10 Bugs in Java-Projekten f√ºr 2019</a></li>
<li><a href="../de481190/index.html">Top 10 Bugs in C ++ Projekten f√ºr 2019</a></li>
<li><a href="../de481200/index.html">Sprachsteuerung und VoiceOver: So passen Sie die Anwendung f√ºr Blinde oder Standbilder an</a></li>
<li><a href="../de481202/index.html">Antiquit√§ten: das Prinzip des M√ºllsammelns und die Ergebnisse von 2019</a></li>
<li><a href="../de481204/index.html">Tech release Mail.ru Group, Winter 2019</a></li>
<li><a href="../de481206/index.html">Wie die Amerikaner ein lebendes Frettchen in einen Collider steckten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>