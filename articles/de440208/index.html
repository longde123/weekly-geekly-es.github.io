<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéª üî† üèÇüèø Erkundung der Bandbreitenbeschr√§nkungen von Kafka f√ºr Dropbox üöö ‚õ∞Ô∏è üò†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die weit verbreitete Verwendung von Apache-Stack-Technologien ist ein offensichtlicher Trend. Und Kafka steht an der Spitze der Popularit√§t: Heute √ºbe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Erkundung der Bandbreitenbeschr√§nkungen von Kafka f√ºr Dropbox</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/440208/"><img src="https://habrastorage.org/webt/7l/ga/d-/7lgad-4hzifyz50iy26wvpx-pna.png"><br><br>  Die weit verbreitete Verwendung von Apache-Stack-Technologien ist ein offensichtlicher Trend.  Und Kafka steht an der Spitze der Popularit√§t: Heute √ºberschreiten Menschen, die einen solchen Nachrichtenbroker kennen, vielleicht die Anzahl derer, die es gewohnt sind, das Wort Franz neben dem Wort Kafka zu sehen. <br><br>  Wir selbst setzen diese Technologie aktiv in unseren Projekten ein.  Aber es ist immer interessant, aber wie funktioniert es f√ºr andere?  Und es ist doppelt interessant, wenn dies nicht nur ein Beispiel aus der Praxis eines Menschen ist, sondern ein gezieltes Testen der Technologie.  Aus diesem Grund haben wir k√ºrzlich einen Artikel √ºbersetzt, in dem es darum geht, wie Dropbox empirisch nach Grenzen von Chancen- und Ausdauergrenzen bei Kafka gesucht hat.  Und gefunden, was er wollte. <br><a name="habracut"></a><br>  <b>Erkundung der Bandbreitenbeschr√§nkungen von Kafka f√ºr Dropbox</b> <br>  Apache Kafka ist eine beliebte L√∂sung f√ºr das verteilte Streaming und die sequentielle Verarbeitung gro√üer Datenmengen.  Es ist in der High-Tech-Industrie weit verbreitet, und Dropbox ist keine Ausnahme.  Kafka spielt eine wichtige Rolle in der Datenstruktur vieler unserer kritischen verteilten Systeme - Datenanalyse, maschinelles Lernen, √úberwachung, Abruf und Stream-Verarbeitung (Cape) (und dies sind nur einige davon). <br><br>  Bei Dropbox werden Kafka-Cluster vom Jetstream-Team verwaltet, dessen Hauptverantwortung darin besteht, qualitativ hochwertige Dienste im Zusammenhang mit Kafka bereitzustellen.  Das Verst√§ndnis der Kafka-Bandbreitenbeschr√§nkung innerhalb der Dropbox-Infrastruktur ist entscheidend, um die richtigen Entscheidungen √ºber die Zuweisung von Ressourcen in verschiedenen Anwendungsf√§llen zu treffen. Dies war eines der vorrangigen Ziele des Teams.  Wir haben k√ºrzlich eine automatisierte Testplattform erstellt, um dies zu erreichen.  Und in dieser Ver√∂ffentlichung m√∂chten wir unsere Methode und die Ergebnisse teilen. <br><br>  <b>Testplattform</b> <br><img src="https://habrastorage.org/webt/he/uq/to/heuqtorszvkeq3ocxtein41cyuy.png"><br>  Die obige Abbildung zeigt die Parameter unserer Testplattform f√ºr diese Studie.  Wir verwenden Spark, um Kafka-Kunden zu hosten, wodurch wir Datenverkehr in einem beliebigen Volumen produzieren und konsumieren k√∂nnen.  Wir haben drei Kafka-Cluster unterschiedlicher Gr√∂√üe erstellt, sodass die Optimierung der Clustergr√∂√üe buchst√§blich darauf reduziert wurde, den Datenverkehr an einen anderen Punkt umzuleiten.  Kafka hat ein Thema f√ºr die Produktion und den Verbrauch von Testverkehr erstellt.  Der Einfachheit halber haben wir den Datenverkehr gleichm√§√üig auf alle Broker verteilt.  Zu diesem Zweck haben wir ein Testthema erstellt, bei dem die Anzahl der Abschnitte zehnmal so hoch ist wie die Anzahl der Broker.  Jeder Broker f√ºhrt genau 10 Abschnitte.  Da das Schreiben in einen Abschnitt sequentiell erfolgt, k√∂nnen zu wenige Partitionen, die einem Broker zugewiesen sind, zu einem wettbewerbsf√§higen Schreiben f√ºhren, wodurch die Bandbreite begrenzt wird.  Unsere Experimente haben gezeigt, dass 10 eine gute Zahl ist, um die mit der Wettbewerbsaufzeichnung verbundenen Engpassschwierigkeiten zu beseitigen. <br><br>  Aufgrund der Verteilung unserer Infrastruktur befinden sich unsere Kunden in verschiedenen Regionen der USA.  Angesichts der Tatsache, dass unser Testverkehr deutlich unter der Grenze der Dropbox-Amtsleitungskan√§le liegt, k√∂nnen wir davon ausgehen, dass diese Grenze des interregionalen Verkehrs auch f√ºr den lokalen Verkehr gilt. <br><br>  <b>Was beeinflusst die Last?</b> <br><br>  Es gibt viele Faktoren, die die Auslastung des Kafka-Clusters beeinflussen k√∂nnen: die Anzahl der Hersteller, die Anzahl der Verbrauchergruppen, der anf√§ngliche Versatz der Verbraucher, die Anzahl der Nachrichten pro Sekunde, die Gr√∂√üe jeder Nachricht, die Anzahl der beteiligten Themen und Abschnitte.  Und das sind nur einige davon.  Der Freiheitsgrad bei der Einstellung von Parametern ist hoch.  Daher m√ºssen wir die dominierenden Faktoren finden, um die Komplexit√§t des Testens auf ein akzeptables Ma√ü zu reduzieren. <br><br>  Wir haben verschiedene Kombinationen von Parametern untersucht, die wir f√ºr geeignet befunden haben.  Wir kamen zu dem nicht √ºberraschenden Schluss, dass die Hauptfaktoren, die ber√ºcksichtigt werden sollten, die Hauptkomponenten der Last sind: die Anzahl der pro Sekunde (s / s) erzeugten Nachrichten und die Anzahl der Bytes pro Nachricht (b / s). <br><br>  <b>Verkehrsmodell</b> <br><br>  Wir haben einen formalen Ansatz gew√§hlt, um die Grenzen von Kafka zu verstehen.  Es gibt einen verwandten Verkehrsraum f√ºr einen bestimmten Kafka-Cluster.  Jeder Punkt in diesem mehrdimensionalen Raum entspricht einem eindeutigen Verkehrszustand, der f√ºr Kafka gilt und als Vektor von Parametern dargestellt wird: &lt;s ‚Äã‚Äã/ s, b / s, # Produzenten, # Verbrauchergruppen, # Themen, ...&gt;.  Alle Verkehrszust√§nde, die nicht zu einer √úberlastung von KafKa f√ºhren, bilden einen geschlossenen Unterraum, dessen Oberfl√§che den Kafka-Cluster begrenzt. <br><br>  F√ºr unseren ersten Test haben wir s / s und b / s als Hauptparameter gew√§hlt und den Verkehrsraum auf eine zweidimensionale Ebene reduziert.  Die Grenzen des zul√§ssigen Verkehrs bilden klare Verfolgungsbereiche.  Die Erkennung der Kafka-Grenze entspricht in unserem Fall der Bestimmung der Grenzwerte dieses Bereichs. <br><br>  <b>Testautomatisierung</b> <br><br>  Um die Grenzen mit ausreichender Genauigkeit festzulegen, mussten Hunderte von Tests mit verschiedenen Parametern durchgef√ºhrt werden - was manuell √§u√üerst irrational w√§re.  Aus diesem Grund haben wir einen Algorithmus entwickelt, mit dem Sie alle Experimente ohne menschliches Eingreifen durchf√ºhren k√∂nnen. <br><br>  <b>√úberlastungsrate</b> <br><br>  Es ist sehr wichtig, eine Reihe von Indikatoren zu finden, mit denen Sie den Status von Kafka programmgesteuert bewerten k√∂nnen.  Wir haben eine Vielzahl m√∂glicher Indikatoren untersucht und uns f√ºr die folgende kleine Stichprobe entschieden: <br><br><ul><li>  Ein einfacher E / A-Stream liegt unter 20%. Dies bedeutet, dass der von Kafka zur Verarbeitung von Clientanforderungen verwendete Workflow-Pool zu voll ist und eingehende Aufgaben nicht bew√§ltigen kann. </li><li>  √Ñnderung des Satzes synchronisierter Replikate (ISR) um mehr als 50%: Dies bedeutet, dass mindestens ein Broker keine Zeit hat, um die von seinem Leader empfangenen Daten zu duplizieren, wenn er 50% der beobachteten Zeit Datenverkehr verwendet. </li></ul><br>  Dieselben Indikatoren werden in Jetstream verwendet, um den Status von Kafka zu √ºberwachen und als erste Alarmsignale f√ºr eine Cluster√ºberlastung zu dienen. <br><br>  <b>Grenzen finden</b> <br><br>  Um einen Grenzwert zu bestimmen, korrigieren wir b / s und √§ndern dann s / s, um Kafka zur √úberlastung zu bringen.  Es ist m√∂glich, den Grenz-S / S-Wert zu bestimmen, wenn wir den sicheren S / S-Wert kennen und nahe daran sind, aber bereits eine √úberlastung verursachen.  Von diesen beiden wird der sichere s / s-Wert als Grenzwert verwendet.  Wie unten gezeigt, wird die Linie der Grenzwerte gem√§√ü den Ergebnissen √§hnlicher Tests mit verschiedenen Indikatoren b / s gebildet: <br><br><img src="https://habrastorage.org/webt/76/k0/u7/76k0u7ql-gxvwxsahu9qdavsj7k.png"><br><br>  Es ist erw√§hnenswert, dass wir, anstatt s / s direkt zu regulieren, mit einer anderen Anzahl von Herstellern experimentiert haben, die die gleiche Produktionsgeschwindigkeit haben, bezeichnet mit np.  Die Stapelverarbeitung von Nachrichten erschwert die Kontrolle √ºber die Produktionsgeschwindigkeit eines einzelnen Herstellers.  Im Gegensatz dazu k√∂nnen Sie durch √Ñndern der Anzahl der Hersteller den Datenverkehr linear √§ndern.  Nach unseren fr√ºhen Untersuchungen wird eine einfache Erh√∂hung der Anzahl der Hersteller keinen merklichen Unterschied in der Belastung von Kafka bewirken. <br><br>  Zun√§chst finden wir mithilfe einer bin√§ren Suche einen separaten Grenzwert.  Die Suche beginnt mit einem sehr gro√üen Bereich np [0, max], wobei max der Wert ist, der notwendigerweise zu einer √úberlastung f√ºhrt.  In jeder Iteration wird ein Durchschnittswert ausgew√§hlt, um Verkehr zu erzeugen.  Wenn Kafka mit diesem Wert √ºberladen ist, wird dieser Durchschnittswert zur neuen Obergrenze.  Andernfalls wird es eine neue Untergrenze.  Der Suchvorgang wird beendet, wenn der Bereich ausreichend eingeschr√§nkt ist.  Dann betrachten wir die s / s-Indikatoren, die sich auf die festgelegte untere Grenze der Grenzwerte beziehen. <br><br>  <b>Ergebnis</b> <br><br><img src="https://habrastorage.org/webt/pb/on/ni/pbonniixt0fgnygngvjnecsil8s.png"><br><br>  Wie Sie im obigen Diagramm sehen k√∂nnen, legen wir die Grenzwerte f√ºr Kafka unterschiedlicher Gr√∂√üe fest.  Basierend auf den Ergebnissen kamen wir zu dem Schluss, dass der maximal m√∂gliche Durchsatz der Dropbox-Infrastruktur 60 Mbit / s pro Broker betr√§gt. <br><br>  Es sollte betont werden, dass dies eine konservative Grenze ist, da der Inhalt unserer Testnachrichten so zuf√§llig wie m√∂glich war, um den Effekt der internen Nachrichtenkomprimierung in Kafka zu verringern.  Wenn der Datenverkehr an seine Grenzen st√∂√üt, sind sowohl das Laufwerk als auch das Netzwerk voll ausgelastet.  In Arbeitsskripten entsprechen Kafka-Nachrichten normalerweise einem bestimmten Muster, da sie h√§ufig durch √§hnliche Algorithmen gebildet werden.  Dies bietet erhebliche M√∂glichkeiten zur Optimierung der Nachrichtenkomprimierung.  Wir haben ein extremes Szenario getestet, in dem Nachrichten aus einem einzelnen Zeichen bestehen und einen viel h√∂heren Durchsatz verzeichnen, da Festplatte und Netzwerk keinen Engpass mehr darstellen. <br><br>  Dar√ºber hinaus sind diese Durchsatzindikatoren korrekt, wenn mindestens 5 Verbrauchergruppen das getestete Thema abonnieren.  Mit anderen Worten wird die angegebene Aufzeichnungsbandbreite erreicht, wenn die Lesebandbreite f√ºnfmal gr√∂√üer ist.  Wenn die Anzahl der Verbrauchergruppen 5 √ºberschreitet, beginnt die Aufzeichnungsbandbreite zu sinken, da das Netzwerk zu einem Engpass wird.  Da das Verh√§ltnis von Lese- und Schreibverkehr in F√§llen, in denen Dropbox-Produktionscluster verwendet werden, viel weniger als 5 betr√§gt, erstreckt sich die erhaltene Bandbreite auf alle Produktionscluster. <br><br>  Dieses Ergebnis hilft Ihnen dabei, Ressourcen f√ºr zuk√ºnftige Kafka besser zu planen.  Wenn beispielsweise bis zu 20% aller Broker offline arbeiten sollen, sollte die maximale sichere Bandbreite eines Brokers 60 MB / s * 0,8 ~ = 50 Mb / s betragen.  Diese Zahl kann fortan verwendet werden, um die Clustergr√∂√üe abh√§ngig vom geplanten Durchsatz zuk√ºnftiger Anwendungsf√§lle zu bestimmen. <br><br>  <b>Werkzeuge f√ºr die zuk√ºnftige Arbeit</b> <br><br>  Die Plattform und der automatisierte Tester werden wertvolle Werkzeuge f√ºr das Jetstream-Team in ihrer zuk√ºnftigen Arbeit sein.  Wenn wir auf eine neue Hardware umsteigen, die Netzwerkkonfiguration √§ndern oder die Version von Kafka aktualisieren, k√∂nnen wir diese Tests einfach erneut ausf√ºhren und neue Daten zu den zul√§ssigen Grenzen der neuen Konfiguration abrufen.  Wir k√∂nnen dieselbe Methode anwenden, um andere Faktoren zu untersuchen, die die Leistung von Kafka auf verschiedene Weise beeinflussen k√∂nnen.  Schlie√ülich kann die Plattform als Jetstream-Testumgebung fungieren, um neue Verkehrsoptionen zu simulieren oder Probleme in einer isolierten Umgebung zu reproduzieren. <br><br>  <b>Zusammenfassend</b> <br><br>  In diesem Artikel haben wir unseren systematischen Ansatz zum Verst√§ndnis der Grenzen von Kafka vorgestellt.  Es ist wichtig zu beachten, dass wir diese Ergebnisse basierend auf der Dropbox-Infrastruktur erzielt haben, sodass unsere Zahlen aufgrund der unterschiedlichen Hardware-, Software- und Netzwerkbedingungen m√∂glicherweise nicht f√ºr andere Kafka-Installationen gelten.  Wir hoffen, dass die hier vorgestellte Methodik den Lesern helfen kann, ihre eigenen Systeme zu verstehen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de440208/">https://habr.com/ru/post/de440208/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de440198/index.html">Neue DWS 3D-Drucker f√ºr Profis</a></li>
<li><a href="../de440200/index.html">Lassen Sie uns √ºber die Protokollierung sprechen</a></li>
<li><a href="../de440202/index.html">OWASP Proactive Controls: Liste der Voraussetzungen f√ºr Softwareentwickler</a></li>
<li><a href="../de440204/index.html">DIY Hobby CNC Fr√§ser. Geisteswissenschaften f√ºr die Geisteswissenschaften</a></li>
<li><a href="../de440206/index.html">Gl√ºhbirnen "das ganze Jahr √ºber"</a></li>
<li><a href="../de440210/index.html">Maschinensyn√§sthetischer Ansatz zur Erkennung von Netzwerk-DDoS-Angriffen. Teil 1</a></li>
<li><a href="../de440214/index.html">Spring und JDK 8: Verwenden Sie immer noch @Param und Name / Wert in Spring MVC-Anmerkungen? Dann ist der Artikel f√ºr Sie</a></li>
<li><a href="../de440216/index.html">Wie ich Zabbix beigebracht habe, meinen Knoten im Auge zu behalten und Probleme zu melden</a></li>
<li><a href="../de440218/index.html">DoS-Angriff, der nicht abgeschlossen werden kann: Die Beschaffung hat eine eigene Atmosph√§re</a></li>
<li><a href="../de440220/index.html">Das Impostor-Syndrom ist nicht nur sch√§dlich, sondern auch vorteilhaft</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>