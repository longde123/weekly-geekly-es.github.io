<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêâ üëèüèª üëª Feliz Ano Novo, Feliz Novo MQTT / UDP ‚úçüèæ üë©üèª‚Äçü§ù‚Äçüë®üèº üó°Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Oi 

 Como escrevi recentemente ( Primeiro pequeno artigo sobre MQTT / UDP ), o MQTT / UDP √© um protocolo baseado no MQTT, mas: 



- Acompanha a tran...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Feliz Ano Novo, Feliz Novo MQTT / UDP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435450/">  Oi <br><br>  Como escrevi recentemente ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Primeiro pequeno artigo sobre MQTT / UDP</a> ), o MQTT / UDP √© um protocolo baseado no MQTT, mas: <br><br><ul><li>  Acompanha a transmiss√£o UDP (nenhum corretor √© necess√°rio, quase nenhuma configura√ß√£o √© necess√°ria) </li><li>  √â indecentemente f√°cil de implementar (10 linhas na pilha C + UDP / IP - e voc√™ envia dados do sensor) </li><li>  Todo mundo ouve todo mundo </li></ul><br>  De certa forma, isso √© CAN, mas acima da Ethernet. <br><br>  Porque <br><a name="habracut"></a><br>  Meu apartamento est√° morando h√° v√°rios anos sob o controle de um sistema como "a casa n√£o √© realmente oligofr√™nica".  Seria redundante cham√°-lo de intelig√™ncia, mas a luz e o clima s√£o automatizados.  Para imaginar a escala do desastre - o sistema ocupa um rack cheio de cerca de 19 polegadas de largura e dois metros de altura.  Duas paredes do rack est√£o ocupadas quase no ch√£o. <br><br>  Quando projetei tudo isso, o problema da toler√¢ncia a falhas veio primeiro.  V√°rios anos de opera√ß√£o mostraram: √© verdade.  Nega tudo.  Mais cedo ou mais tarde.  Mas os rel√©s eletromec√¢nicos ainda n√£o falharam, e √© neles o √∫ltimo escal√£o de prote√ß√£o contra falhas. <br><br>  O pr√≥ximo problema ap√≥s a toler√¢ncia a falhas √© o zool√≥gico.  Devido ao curso natural da vida, minha curiosidade e necessidades urgentes, o Unix comum em um PC comum, Aries PLC, Raspberr + Orange PI, m√≥dulos Atmega, m√≥dulos baseados em NodeMCU (ESP8266) vivem no sistema e tudo isso se modela via modbus 485, modbus TCP, http e, ao lado, fica pendurado um corretor MQTT inquieto, como um legado de uma tentativa malsucedida de mudar para ele com um campo inteiro. <br><br>  Por que a tentativa de mudar para o MQTT n√£o teve √™xito.  Em primeiro lugar, para parte do ferro √© pesado ou complicado.  No fragmento de Pascal que est√° escondido no CLP CodeSys, apenas um masoquista pode escrever MQTT.  Mas ent√£o voc√™ precisa depurar.  Da mesma forma em atmega: voc√™ pode empinar, mas de perto.  Mas este n√£o √© o problema todo. <br><br>  O MQTT como ele √© (e √© aceit√°vel em qualquer lugar 3.1.1) insiste em enviar um pacote PUBLISH (ou seja, nossa mensagem para o broker) a todos os destinat√°rios, incluindo o remetente.  O efeito dessa insanidade √© encantador - o mesmo OpenHAB n√£o pode enviar e receber dados no MQTT com o mesmo nome.  Isso significa que √© imposs√≠vel organizar um barramento com base no MQTT (v√°rios m√≥dulos que atualizam o valor do mesmo objeto e o utilizam).  E √© exatamente assim que a comunica√ß√£o do PLC deve ser organizada, na qual reside o principal controle de luz, o OpenHAB, que controla a luz da interface da web e do aplicativo m√≥vel, e switches inteligentes, que eu gostaria de poder adicionar aqui e aqui.  Isto √©, √© claro, esse problema pode ser contornado, mas na verdade significa construir seu pr√≥prio protocolo SURFACE MQTT, e isso j√° parece ser demais. <br><br>  Ao mesmo tempo, o que eu preciso?  Envie uma atualiza√ß√£o do valor do par√¢metro e obtenha-a em todos os pontos de interesse.  Pelo que, de fato, os av√≥s fizeram UDP para o endere√ßo de transmiss√£o. <br><br>  Ap√≥s o √∫ltimo post sobre Habr√©, um dos leitores por um longo tempo me censurou com a falta de confiabilidade do protocolo UDP.  Eu especulativamente respondi a ele que, para a IoT, o UDP √© mais confi√°vel que o TCP: com 50% de perda de pacotes em uma rede, o TCP n√£o apenas se deita, mas geralmente, e o sensor de temperatura que envia medi√ß√µes pelo UDP simplesmente perde metade da contagem, o que afetar√° a opera√ß√£o do sistema de qualquer maneira.  Geralmente. <br><br>  Mas era especulativo.  No entanto, os feriados de Ano Novo tamb√©m foram dados a uma pessoa para terminar de beber champanhe e perguntar a si mesmo: colocaremos nossa LAN local em p√°s hoje?  E n√£o importa o qu√™. <br><br>  Peguei o MQTT / UDP e escrevi um teste primitivo.  Um lado envia pacotes consecutivos sem uma pausa entre os pacotes, tanto quanto poss√≠vel.  O segundo considera a velocidade e a perda de pacotes.  O experimento foi simples: lan√ßamos essa zombaria e, paralelamente, duas TVs HD mostram filmes da Internet, e o computador de mesa grava um arquivo enorme no NAS. <br><br>  Classifique o resultado.  Eu esperei por tudo, mas ... a perda m√°xima para o UDP atingiu meio por cento e as duas TVs pararam de aparecer.  Ent√£o eu ainda era um pessimista.  Em uma rede dom√©stica real, a confiabilidade da entrega UDP √© quase absoluta.  No entanto, provavelmente vou fazer uma vers√£o com confirma√ß√µes e reenviar pacotes.  Existem poucas dificuldades, mas a quest√£o √© completamente removida. <br><br>  A segunda pergunta √© seguran√ßa, mas, se eles invadirem minha rede dom√©stica, a perda de dados dos sensores de temperatura √© a √∫ltima coisa que eu lamentarei.  No entanto, novamente, a tarefa de assinar pacotes digitalmente no rastreador de problemas est√° presente e eu j√° entendo como expandir os pacotes MQTT para sua implementa√ß√£o. <br><br>  Em geral, planejo que o primeiro par de dispositivos na rede dom√©stica mude para o MQTT / UDP outro dia. <br><br>  E sugiro que voc√™ tente nos seus programas e dispositivos: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Reposit√≥rio</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o em ingl√™s</a> . <br><br>  O que est√° dispon√≠vel: <br><br>  Implementa√ß√µes bastante completas em Java, Python e C.  Implementa√ß√£o b√°sica em Lua.  At√© agora, apenas enviando para Arduino e CodeSys PLC (testado e funciona em √Åries, mas deve fazer qualquer coisa). <br><br>  Ferramenta GUI para analisar o que est√° acontecendo e intervir: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f04/333/9c9/f043339c94a34a24a3887043f095baae.png" alt="imagem"><br><br>  Programas para envio e recebimento de dados em Python, Lua e Java. <br><br>  Conectores Python para integra√ß√£o com o MQTT regular e diretamente com o OpenHAB.  Eles trabalham com prote√ß√£o contra ciclos, proibindo a transmiss√£o reversa da mensagem por 5 segundos ap√≥s passar na dire√ß√£o direta.  Al√©m disso, h√° uma biblioteca para limitar o fluxo de dados repetidos.  Ela verifica se j√° houve uma atualiza√ß√£o deste t√≥pico pelo tempo especificado e, se o fizer, ignora a nova atualiza√ß√£o apenas se os dados foram alterados. <br><br>  Eu pretendo mudar gradualmente para esse protocolo completamente, e aqui est√° um exemplo do que eu quero obter com os sensores: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3dc/6ed/528/3dc6ed528bb36067f12038fad62857c7.png"><br><br>  Existem tr√™s sensores em uma sala (bem, ou na rua, isso n√£o importa).  Eles enviam amostras atrav√©s do MQTT / UDP.  Essas leituras s√£o recebidas simultaneamente pelo principal sistema de casa inteligente (OpenHAB), um banco de dados hist√≥rico e um monitor de parede que exibe a temperatura para os residentes. <br><br>  Todo o charme do MQTT / UDP √© que, nesse esquema, a falha de qualquer bloco n√£o cria problemas para todos os outros.  E isso √© com a simplicidade encantadora do protocolo. <br><br>  Al√©m disso, esquemas de controle redundantes com duplica√ß√£o s√£o facilmente implementados no mesmo esquema.  O servidor de banco de dados pode ser duplicado sem nenhum problema.  Ser√° mais dif√≠cil duplicar os m√≥dulos que lidam com o gerenciamento.  Por exemplo, ouvir a temperatura aciona os radiadores.  Mas provavelmente esta √© a pr√≥xima hist√≥ria.  Hoje, pretendo focar na coleta de sinais de sensores e na troca entre os m√≥dulos de uma casa inteligente. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt435450/">https://habr.com/ru/post/pt435450/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt435438/index.html">PHP: alterando a estrutura do banco de dados no desenvolvimento de equipes</a></li>
<li><a href="../pt435442/index.html">Funil de mudan√ßa</a></li>
<li><a href="../pt435444/index.html">Estamos implementando o OSGI na plataforma Karaf</a></li>
<li><a href="../pt435446/index.html">Algoritmo Verhuff para um sistema arbitr√°rio de n√∫meros pares</a></li>
<li><a href="../pt435448/index.html">Sobre a experi√™ncia de comunica√ß√£o com um gerador de sinal atrav√©s do QTcpSocket e SCPI</a></li>
<li><a href="../pt435452/index.html">Teste de ponta a ponta de microsservi√ßos com o Catcher</a></li>
<li><a href="../pt435454/index.html">AOP vs Recursos</a></li>
<li><a href="../pt435456/index.html">√â prejudicial deixar um smartphone ao seu lado √† noite?</a></li>
<li><a href="../pt435460/index.html">Excurs√£o fotogr√°fica Coworkidea Coworking (Barcelona)</a></li>
<li><a href="../pt435462/index.html">Testando projetos Node.js. Parte 1. Anatomia e tipos de teste</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>