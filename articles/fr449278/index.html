<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêá üë≤üèø ü•Ö Attaques de domaine ‚ûï üíÜüèº üé≤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lors de tests de p√©n√©tration, nous d√©tectons assez souvent des erreurs dans la configuration du domaine. Bien que cela ne semble pas critique pour bea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Attaques de domaine</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jetinfosystems/blog/449278/"><img src="https://habrastorage.org/webt/om/yi/ln/omyiln4hxyukdu7znc3sn5j-mzy.png"><br>  Lors de tests de p√©n√©tration, nous d√©tectons assez souvent des erreurs dans la configuration du domaine.  Bien que cela ne semble pas critique pour beaucoup, en r√©alit√©, de telles inexactitudes peuvent compromettre l'ensemble du domaine. <br><br>  Par exemple, selon les r√©sultats du pentest dans une entreprise, nous sommes arriv√©s √† la conclusion que toutes les machines disponibles dans le domaine n'√©taient pas inf√©rieures √† Windows10 / Windows Server2016, et qu'ils avaient tous les derniers correctifs sur eux.  Le r√©seau √©tait r√©guli√®rement scann√©, les machines √©taient dures.  Tous les utilisateurs se sont assis √† travers des jetons et ne connaissaient pas leurs "mots de passe de 20 caract√®res".  Tout semble aller bien, mais IPv6 n'a pas √©t√© d√©sactiv√©.  Le sch√©ma de capture de domaine ressemblait √† ceci: <br><br>  mitm6 -&gt; ntlmrelay -&gt; attaque par d√©l√©gation -&gt; le hachage du mot de passe administrateur local est re√ßu -&gt; le hachage du mot de passe administrateur du domaine est re√ßu. <br><br>  Malheureusement, les certifications populaires telles que OSCP, GPEN ou CEH n'enseignent pas les tests de p√©n√©tration d'Active Directory. <br><br>  Dans cet article, nous examinerons plusieurs types d'attaques Active Directory que nous avons effectu√©es dans le cadre de pentests, ainsi que les outils utilis√©s.  Cela ne peut en aucun cas √™tre consid√©r√© comme un guide complet pour tous les types d'attaques et d'outils, il y en a vraiment beaucoup, et il est difficile de s'int√©grer dans un seul article. <br><br>  Donc, pour la d√©monstration, nous utilisons un ordinateur portable sur Kali Linux 2019 et les h√¥tes virtuels √©lev√©s sur VMware.  Imaginez que l‚Äôobjectif principal du pentest est d‚Äôobtenir les droits d‚Äôadministrateur de domaine et, en tant qu‚Äôentr√©e, nous avons acc√®s au r√©seau d‚Äôentreprise de l‚Äôentreprise via Ethernet.  Pour commencer √† tester le domaine, nous avons besoin d'un compte. <br><a name="habracut"></a><br><h1>  Obtenir un compte </h1><br>  Consid√©rez les deux m√©thodes les plus courantes, √† mon avis, pour obtenir le login et le mot de passe du compte de domaine: usurpation LLMNR / NBNS et attaque sur le protocole IPv6. <br><br><h3>  Usurpation LLMNR / NBNS </h3><br>  Beaucoup a √©t√© dit sur cette attaque.  L'essentiel est que le client envoie des LLMNR multicast et diffuse des requ√™tes NBT-NS pour r√©soudre les noms d'h√¥te si cela n'√©tait pas possible via DNS.  Tout utilisateur du r√©seau peut r√©pondre √† de telles demandes. <br><br>  Outils permettant une attaque: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">R√©ponse</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Inveight</a> </li><li>  Modules Metasploit: auxiliaire / usurpation / llmnr / llmnr_response, auxiliaire / usurpation / nbns / nbns_response, <br>  auxiliaire / serveur / capture / smb, auxiliaire / serveur / capture / http_ntlm </li></ul><br>  Avec une attaque r√©ussie, nous pouvons obtenir le hachage NetNTLM du mot de passe de l'utilisateur. <br><br><pre><code class="bash hljs">Responder -I eth0 -wrf</code> </pre> <br><img src="https://habrastorage.org/webt/ul/6f/1r/ul6f1rsc1dbtugnzoiup43cofnc.png"><br><br>  Le hachage r√©sultant, nous pouvons d√©boguer ou ex√©cuter des relais NTLM. <br><br><h3>  Attaque IPv6 </h3><br>  Si IPv6 est utilis√© dans le r√©seau d'entreprise, nous pouvons r√©pondre aux demandes DHCPv6 et d√©finir notre adresse IP comme serveur DNS sur la machine attaqu√©e.  Puisque IPv6 a priorit√© sur IPv4, les requ√™tes DNS du client seront envoy√©es √† notre adresse.  En savoir plus sur l'attaque <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Outils: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mitm6</a> </li></ul><br>  Ex√©cution de l'utilitaire mitm6 <br><br><pre> <code class="bash hljs">mitm6 -i vmnet0</code> </pre> <br>  Une fois l'attaque termin√©e, un nouveau serveur DNS avec notre adresse IPv6 appara√Ætra sur le poste de travail attaqu√©. <br><br><img src="https://habrastorage.org/webt/ww/w4/w3/www4w3x2eqtuytsmysia_deoi_y.png"><br><br>  Les machines attaqu√©es tenteront de s'authentifier aupr√®s de notre machine.  Apr√®s avoir √©lev√© le serveur SMB √† l'aide de l'utilitaire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">smbserver.py</a> , nous pouvons obtenir des hachages de mot de passe utilisateur. <br><br><pre> <code class="bash hljs">smbserver.py -smb2support SMB /root/SMB</code> </pre> <br><img src="https://habrastorage.org/webt/df/s8/jx/dfs8jxcdecrikctqxdxzbuyq8wk.png"><br><br><h2>  Actions de hachage captur√©es </h2><br>  L'√©tape suivante consiste soit √† effectuer une attaque cryptographique sur les hachages de mot de passe et √† obtenir le mot de passe en texte clair, soit √† ex√©cuter un relais NTLM. <br><br><h3>  Force brute du mot de passe </h3><br>  C'est simple: prenez un mot de passe de hachage, hashcat <br><br><pre> <code class="bash hljs">hashcat -m 5600 -a 3 hash.txt /usr/share/wordlists/rockyou.txt</code> </pre> <br>  et brutus.  Le mot de passe peut √™tre obtenu ou non :) <br><br><img src="https://habrastorage.org/webt/pf/l8/7g/pfl87glgjcfbove5ywlkmul1uyi.png"><br>  <i>Le mot de passe de l'utilisateur Harvey a √©t√© r√©cup√©r√© - Pbvf2019</i> <br><br><h3>  Relais NTLM </h3><br>  Nous pouvons √©galement ex√©cuter des relais NTLM.  Apr√®s avoir v√©rifi√© que la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">signature SMB</a> n'est pas utilis√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">, nous</a> utilisons l'utilitaire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ntlmrelayx.py</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">menons</a> une attaque.  L√† encore, en fonction de l'objectif, nous s√©lectionnons le vecteur dont nous avons besoin.  Examinons certains d'entre eux. <br><br><br><h4>  Acc√®s √† la machine attaqu√©e via le protocole SMB </h4><br>  Effectuez une attaque avec la touche <i>i</i> . <br><br><pre> <code class="bash hljs">ntlmrelayx.py -t 192.168.1.5 -l loot -i</code> </pre> <br><img src="https://habrastorage.org/webt/jk/3w/zu/jk3wzuzoxwr2qnrzhagq7bnweya.png"><br><br>  Avec une attaque r√©ussie, nous pouvons nous connecter √† la machine distante √† l'aide de netcat. <br><br><img src="https://habrastorage.org/webt/1f/8x/ba/1f8xbajj3gofx2bonp0quqdnxae.png"><br><br><h4>  Collecte d'informations sur le domaine </h4><br>  Dans ce cas, nous effectuons le relais vers le contr√¥leur de domaine. <br><br><pre> <code class="bash hljs">ntlmrelayx.py -t ldap://192.168.1.2</code> </pre> <br>  Si l'attaque r√©ussit, nous obtiendrons des informations d√©taill√©es sur le domaine: <br><br><img src="https://habrastorage.org/webt/el/gf/eu/elgfeumon83qjseesppzb8yjitq.png"><br><br><h4>  Ajout d'un nouvel ordinateur au domaine </h4><br>  Par d√©faut, chaque utilisateur a la possibilit√© de cr√©er jusqu'√† 10 ordinateurs dans le domaine.  Pour cr√©er un ordinateur, vous devez ex√©cuter un relais sur un contr√¥leur de domaine √† l'aide du protocole LDAP.  La cr√©ation d'utilisateurs et d'ordinateurs via une connexion LDAP non chiffr√©e est interdite.  De plus, un compte ne peut pas √™tre cr√©√© si la connexion via SMB est intercept√©e. <br><br><pre> <code class="bash hljs">ntlmrelayx.py -t ldaps://192.168.1.2 --add-computer</code> </pre> <br><img src="https://habrastorage.org/webt/ei/xe/qi/eixeqiuxwttuxx3xmmroqrj8smy.png"><br><br>  Comme vous pouvez le voir sur la figure, nous avons pu cr√©er un ordinateur RORYOTGS $. <br><br>  Lors de la cr√©ation de plus de 10 ordinateurs, nous obtenons une erreur de la forme suivante: <br><br><img src="https://habrastorage.org/webt/gb/za/ar/gbzaarxwpzhs0zhy4zi8kvwuqjo.png"><br><br>  En utilisant les informations d'identification d'un ordinateur RORYOTGS $, nous pouvons effectuer des demandes l√©gitimes √† un contr√¥leur de domaine. <br><br><h1>  Collecte d'informations sur le domaine </h1><br>  Nous avons donc un utilisateur de domaine ou un compte d'ordinateur.  Pour continuer les tests, nous devons collecter les informations disponibles pour une meilleure planification des attaques.  Consid√©rez certains des outils qui nous aideront √† d√©terminer la recherche des syst√®mes les plus critiques, √† planifier et √† ex√©cuter une attaque. <br><br><h3>  Bloodhound </h3><br>  L'un des outils les plus importants utilis√©s dans presque tous les tests de p√©n√©tration interne.  Le projet se d√©veloppe activement et est compl√©t√© par de nouvelles fonctionnalit√©s. <br><br><div class="spoiler">  <b class="spoiler_title">Informations collect√©es par Bloodhound</b> <div class="spoiler_text"><ul><li>  Groupe - Effectue la collecte des membres du groupe </li><li>  LocalAdmin - Effectue la collecte d'administration locale </li><li>  RDP - Effectue la collecte d'utilisateurs de bureau √† distance </li><li>  DCOM - Effectue la collecte des utilisateurs COM distribu√©s </li><li>  GPOLocalGroup - Effectue une collecte d'administration locale √† l'aide d'objets de strat√©gie de groupe </li><li>  Session - Effectue la collecte de session </li><li>  ComputerOnly - Effectue l'administration locale, RDP, DCOM et la collecte de sessions </li><li>  LoggedOn - Effectue la collecte de sessions privil√©gi√©es (n√©cessite des droits d'administrateur sur les syst√®mes cibles) </li><li>  Approbations - Effectue l'√©num√©ration d'approbation de domaine </li><li>  ACL - Effectue la collecte des ACL </li><li>  Conteneur - Effectue la collecte des conteneurs; </li><li>  DcOnly - Effectue la collecte √† l'aide de LDAP uniquement.  Comprend Group, Trusts, ACL, ObjectProps, Container et GPOLocalGroup </li><li>  Tout - Ex√©cute toutes les m√©thodes de collecte sauf GPOLocalGroup et LoggedOn </li><li>  Rechercher dans la for√™t - Rechercher tous les domaines de la for√™t au lieu de votre domaine actuel </li><li>  Domaine - Recherchez un domaine particulier.  Utilise votre domaine actuel s'il est nul (par d√©faut: nul) </li><li>  Stealth - Ex√©cute des m√©thodes de collecte furtive.  Toutes les options furtives sont √† filetage unique </li><li>  SkipGCDeconfliction - Ignore la d√©confliction du catalogue global pendant l'√©num√©ration de session.  Cela peut acc√©l√©rer l'√©num√©ration, mais entra√Ænera de possibles inexactitudes dans les donn√©es </li><li>  ExcludeDc - Exclut les contr√¥leurs de domaine de l'√©num√©ration (√©vite les drapeaux Microsoft ATA) </li><li>  ComputerFile - Sp√©cifiez un fichier √† partir duquel charger les noms / adresses IP des ordinateurs </li><li>  OU - Sp√©cifiez l'unit√© d'organisation √† √©num√©rer </li></ul><br></div></div><br>  Les collecteurs d'informations sont <a href="">SharpHound.exe</a> (n√©cessite l'installation de .NET v3.5) et le script <a href="">SharpHound.ps1</a> √©crit en PowerShell.  Il existe √©galement un compilateur √©crit par un d√©veloppeur Python tiers, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bloodhound-python</a> . <br><br>  En tant que base de donn√©es, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Neo4j est</a> utilis√©, qui a sa propre syntaxe, qui vous permet d'effectuer des requ√™tes personnalis√©es.  Vous pouvez en savoir plus sur la syntaxe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Hors de la bo√Æte 12 demandes sont disponibles</b> <div class="spoiler_text"><ul><li>  Trouver tous les administrateurs de domaine </li><li>  Trouver les chemins les plus courts vers les administrateurs de domaine </li><li>  Rechercher des principaux avec des droits DCSync </li><li>  Utilisateurs avec appartenance √† un groupe de domaine √©tranger </li><li>  Groupes avec appartenance √† un groupe de domaine √©tranger </li><li>  Mapper les approbations de domaine </li><li>  Chemins les plus courts vers des syst√®mes de d√©l√©gation sans contrainte </li><li>  Chemins les plus courts des utilisateurs Kerberoastable </li><li>  Chemins les plus courts vers les administrateurs de domaine √† partir d'utilisateurs Kerberoastable </li><li>  Chemin le plus court depuis les principaux propri√©taires </li><li>  Chemins les plus courts vers les administrateurs de domaine √† partir des principaux propri√©taires </li><li>  Chemins les plus courts vers des cibles de grande valeur </li></ul><br></div></div><br>  Les d√©veloppeurs fournissent √©galement le script <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DBCreator.py</a> , qui vous permet de g√©n√©rer une base de donn√©es al√©atoire pour les tests. <br><br><img src="https://habrastorage.org/webt/do/if/95/doif95xzpkhd3xqbdjbwdenmrfu.png"><br><br>  Neo4j poss√®de une API REST.  Il existe diff√©rents utilitaires qui peuvent se connecter √† la base de donn√©es et utiliser les donn√©es re√ßues: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cypherdog</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Gofetch</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ANGRYPUPPY</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gt-generator</a> </li></ul><br>  Examinons certains d'entre eux. <br><br><h3>  Cypherdog </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CypherDog</a> est un shell BloodHound √©crit en PowerShell.  Comprend 27 applets de commande. <br><br><div class="spoiler">  <b class="spoiler_title">Liste des applets de commande</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><td>  Cmdlet </td><td>  Synopsis </td></tr><tr><td>  Get-BloodHoundCmdlet </td><td>  BloodHound RTFM - Obtenir la cmdlet </td></tr><tr><td>  Send-bloodhoundpost </td><td>  BloodHound POST - Cypher to REST API </td></tr><tr><td>  Get-BloodHoundNode </td><td>  BloodHound Node - Obtenir le n≈ìud </td></tr><tr><td>  Search-BloodHoundNode </td><td>  N≈ìud BloodHound - N≈ìud de recherche </td></tr><tr><td>  New-BloodHoundNode </td><td>  BloodHound Node - Cr√©er un n≈ìud </td></tr><tr><td>  Set-bloodhoundnode </td><td>  N≈ìud BloodHound - N≈ìud de mise √† jour </td></tr><tr><td>  Remove-BloodHoundNode </td><td>  BloodHound Node - Supprimer le n≈ìud </td></tr><tr><td>  Get-BloodHoundNodeList </td><td>  BloodHound Node - Obtenir la liste </td></tr><tr><td>  Get-BloodHoundNodeHighValue </td><td>  BloodHound Node - Obtenez une valeur √©lev√©e </td></tr><tr><td>  Get-BloodHoundNodeOwned </td><td>  BloodHound Node - Devenez propri√©taire </td></tr><tr><td>  Get-BloodHoundNodeNote </td><td>  BloodHound Node - Get Note </td></tr><tr><td>  Set-BloodHoundNodeNote </td><td>  BloodHound Node - D√©finir des notes </td></tr><tr><td>  Get-BloodHoundBlacklist </td><td>  BloodHound Node - Obtenir la liste noire </td></tr><tr><td>  Set-BloodHoundBlacklist </td><td>  BloodHound Node - D√©finir la liste noire </td></tr><tr><td>  Remove-BloodHoundBlacklist </td><td>  BloodHound Node - Supprimer la liste noire </td></tr><tr><td>  Get-BloodHoundEdge </td><td>  BloodHound Edge - Get Target </td></tr><tr><td>  Get-BloodHoundEdgeReverse </td><td>  BloodHound Edge - Get Source </td></tr><tr><td>  Get-BloodHoundEdgeCrossDomain </td><td>  BloodHound Edge - Obtenez CrossDomain </td></tr><tr><td>  Get-BloodHoundEdgeCount </td><td>  BloodHound Edge - Get Count </td></tr><tr><td>  Get-BloodHoundEdgeInfo </td><td>  BloodHound Edge - Obtenir des informations </td></tr><tr><td>  New-BloodHoundEdge </td><td>  BloodHound Edge - Cr√©er un bord </td></tr><tr><td>  Remove-BloodHoundEdge </td><td>  BloodHound Edge - Supprimer un bord </td></tr><tr><td>  Get-BloodHoundPathShort </td><td>  BloodHound Path - Obtenez le plus court </td></tr><tr><td>  Get-BloodHoundPathAny </td><td>  BloodHound Path - Obtenez tout </td></tr><tr><td>  Get-BloodHoundPathCost </td><td>  BloodHound Path - Obtenez le co√ªt </td></tr><tr><td>  Get-BloodHoundPathCheap </td><td>  BloodHound Path - Obtenez le moins cher </td></tr><tr><td>  Get-BloodHoundWald0IO </td><td>  BloodHound Path - Obtenez l'index Wald0 </td></tr></tbody></table></div><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Exemples d'utilisation</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><td>  L'√©quipe </td><td>  La description </td></tr><tr><td>  Search-BloodHoundNode -Type Computer -Property unconstraineddelegation -Value $ true |  s√©lectionner un nom, Serviceprincipalnames, unconstraineddelegation, operatingsystem |  Format-list </td><td>  Rechercher des ordinateurs avec une d√©l√©gation Kerberos illimit√©e </td></tr><tr><td>  Utilisateur Edge ADMINISTRATOR@JET.LAB MemberOf Group </td><td>  Liste des groupes d'utilisateurs </td></tr><tr><td>  Quel ordinateur poss√®de une session ADMINISTRATOR@JET.LAB </td><td>  R√©pertorier les ordinateurs sur lesquels se trouve une session utilisateur Administrateur </td></tr><tr><td>  Utilisateur de chemin d'acc√®s Ordinateur HARVEY@JET.LAB DC1.JET.LAB </td><td>  Imprimer le chemin de l'utilisateur vers le contr√¥leur de domaine </td></tr><tr><td>  quel utilisateur MemberOf Group 'DOMAIN ADMINS@JET.LAB' * |  ouvrir une session </td><td>  R√©pertorier les sessions utilisateur actives qui sont membres du groupe Administrateurs DOMAIN </td></tr><tr><td>  quel utilisateur MemberOf Group 'DOMAIN ADMINS@JET.LAB' |  ouvrir une session |?  operat * -match 7 |  list AdminTo |  s√©lectionner un nom </td><td>  R√©pertorier les utilisateurs disposant de droits d'administrateur sur les postes de travail ex√©cutant Windows 7 disposant d'une session d'utilisateurs du groupe d'administrateurs de domaine </td></tr></tbody></table></div><br></div></div><br>  Par d√©faut, une authentification est requise pour acc√©der √† la base de donn√©es neo4j.  Vous pouvez d√©sactiver l'authentification en modifiant le fichier neo4j.conf.  Il doit d√©commenter la ligne <i>dbms.security.auth_enabled = false.</i>  Mais ce n'est pas recommand√©, car tout utilisateur peut se connecter √† la base de donn√©es √† 127.0.0.1:7474 (la configuration par d√©faut).  Vous pouvez en savoir plus sur l'authentification et l'autorisation dans neo4j <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici.</a> <br><br><h3>  Gofetch </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GoFetch</a> utilise un graphique cr√©√© dans Bloodhound pour planifier et ex√©cuter une attaque. <br><br><div class="spoiler">  <b class="spoiler_title">Exemple de graphique Bloodhound</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/l3/pm/g_/l3pmg_9fw8yy5dkbrftpfq4flyo.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Logique GoFetch</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ph/g-/us/phg-usiezxoh0-jz2zvfq4iack8.jpeg"><br></div></div><br>  Lancement d'attaque <br><br><pre> <code class="bash hljs">.\Invoke-GoFetch.ps1 -PathToGraph .\pathFromBloodHound.json</code> </pre> <br><h3>  gt-generator </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gt-generator</a> , utilisant les donn√©es BloodHound, facilite la cr√©ation de tickets d'or.  Pour recevoir un ticket d'or, seuls le hachage du nom d'utilisateur et du mot de passe de l'utilisateur KRBTGT sont requis. <br><br><pre> <code class="bash hljs">python gt-generator.py -s 127.0.0.1 -u user -p pass administrator &lt;KRBTGT_HASH&gt;</code> </pre> <br><img src="https://habrastorage.org/webt/oo/d3/b8/ood3b84ooqbwwawb-pn7nybey_s.png"><br><br><h3>  Powerview </h3><br>  <a href="">PowerView</a> est un framework Powershell inclus avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PowerSploit</a> .  Voici une liste de certaines applets de commande qui peuvent vous aider √† collecter des informations sur un domaine. <br><br><div class="spoiler">  <b class="spoiler_title">Liste des applets de commande</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><td>  Get-NetDomain -Domain jet.lab </td><td>  Obtenez le domaine actuel </td></tr><tr><td>  Get-domainSID </td><td>  Obtenez le SID actuel du domaine </td></tr><tr><td>  Get-NetDomainController -Domain jet.lab </td><td>  Obtenir des contr√¥leurs de domaine pour un domaine </td></tr><tr><td>  Get-NetUser -Domain jet.lab -UserName labuser </td><td>  Obtenez les utilisateurs d'un domaine </td></tr><tr><td>  Get-NetGroup * nom_groupe * </td><td>  Obtenez tous les groupes du domaine actuel </td></tr><tr><td>  Get-NetGroupMember -GroupName "Administrateurs de domaine" </td><td>  Obtenez tous les membres du groupe Admins du domaine </td></tr><tr><td>  Get-NetGroup -UserName "utilisateur_domaine" </td><td>  Obtenir l'appartenance √† un groupe pour un utilisateur </td></tr><tr><td>  Get-NetComputer -FullData </td><td>  Obtenez tous les ordinateurs du domaine </td></tr><tr><td>  Find-LocalAdminAccess -Verbose </td><td>  Rechercher toutes les machines du domaine actuel o√π l'utilisateur actuel a un acc√®s administrateur local </td></tr><tr><td>  Get-NetSession -ComputerName dc02.jet.lab </td><td>  Liste des sessions sur un ordinateur particulier </td></tr><tr><td>  Invoke-UserHunter -CheckAccess </td><td>  Rechercher les ordinateurs sur lesquels un administrateur de domaine est connect√© et o√π l'utilisateur actuel a acc√®s </td></tr></tbody></table></div><br></div></div><br><h3>  Adidnsdump </h3><br>  Lors de l'utilisation du DNS int√©gr√© dans Active Directory, tout utilisateur de domaine peut interroger tous les enregistrements DNS par d√©faut. <br><br>  Outil utilis√©: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Adidnsdump.</a> <br><br><img src="https://habrastorage.org/webt/hq/48/rb/hq48rboxepskftc5tnlbsnvgfr0.gif"><br><br><h1>  Attaques de domaine </h1><br>  Maintenant que nous avons les informations sur le domaine, nous passons √† la prochaine phase des tests de p√©n√©tration - directement √† l'attaque.  Consid√©rons 4 vecteurs potentiels: <br><br><ol><li>  Torr√©faction </li><li>  Attaque via ACL </li><li>  D√©l√©gation Kerberos </li><li>  Abus des autorisations de GPO </li></ol><br><br><h3>  Torr√©faction </h3><br>  Ce type d'attaque cible le protocole Kerberos.  Il existe 2 types d'attaque comme la torr√©faction: <br><br><ul><li>  Kerberoast </li><li>  Asreproast </li></ul><br><h4>  Kerberoast </h4><br>  L'attaque a √©t√© d√©montr√©e pour la premi√®re fois par l'utilisateur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">timmedin</a> √† DerbyCon en 2014 ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vid√©o</a> ).  Avec une attaque r√©ussie, nous pourrons trier le mot de passe de l'√©chographie du service en mode hors ligne, sans crainte de bloquer l'utilisateur.  Tr√®s souvent, les comptes de service ont des droits excessifs et un mot de passe perp√©tuel, ce qui peut nous permettre d'obtenir des droits d'administrateur de domaine. <br>  Pour comprendre l'essence de l'attaque, r√©fl√©chissez au fonctionnement de Kerberos. <br><br><img src="https://habrastorage.org/webt/vj/g2/ud/vjg2ud1wzdr89drnazgcob0eaum.png"><br><br>  1. Le mot de passe est converti en un hachage NTLM, l'horodatage est chiffr√© avec un hachage et envoy√© √† KDC en tant qu'authentificateur dans la demande de ticket TGT (AS-REQ).  Le contr√¥leur de domaine (KDC) v√©rifie les informations utilisateur et cr√©e un ticket TGT. <br><br>  2. Le ticket TGT est crypt√©, sign√© et envoy√© √† l'utilisateur (AS-REP).  Seul le service Kerberos (KRBTGT) peut ouvrir et lire les donn√©es d'un ticket TGT. <br><br>  3. L'utilisateur soumet le ticket TGT au contr√¥leur de domaine √† la demande du ticket TGS (TGS-REQ).  Le contr√¥leur de domaine ouvre un ticket TGT et v√©rifie la somme de contr√¥le PAC. <br><br>  4. Le ticket TGS est crypt√© avec le hachage NTLM du mot de passe du compte de service et est envoy√© √† l'utilisateur (TGS-REP). <br><br>  5. L'utilisateur fournit un ticket TGS √† l'ordinateur sur lequel le service s'ex√©cute (AP-REQ).  Le service ouvre un ticket TGS √† l'aide de son hachage NTLM. <br><br>  6. L'acc√®s au service est fourni (AS-REP). <br><br>  Apr√®s avoir re√ßu un ticket TGS (TGS-REP), nous pouvons trouver le mot de passe pour le compte de service hors ligne.  Par exemple, en utilisant hashcat. <br><br>  Selon la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RFC396</a> , 20 types de cryptage sont r√©serv√©s au protocole Kerberos.  Les types de cryptage utilis√©s actuellement, par ordre de priorit√©: <br><br><ul><li>  AES256_CTS_HMAC_SHA1 </li><li>  AES128_CTS_HMAC_SHA1 </li><li>  RC4_HMAC_MD5 </li></ul><br>  Dans les versions r√©centes de Windows, le cryptage AES est utilis√© par d√©faut.  Mais pour la compatibilit√© avec les syst√®mes sous les serveurs Windows Vista et Windows 2008, la prise en charge de l'algorithme RC4 est requise.  Lors d'une attaque, une tentative est toujours effectu√©e pour obtenir un ticket TGS avec le cryptage RC4_HMAC_MD5, ce qui permet de trier les mots de passe plus rapidement, puis avec le reste.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Harmj0y a</a> men√© une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©tude</a> int√©ressante et a d√©couvert que si les propri√©t√©s des utilisateurs sp√©cifient la prise en charge du chiffrement uniquement Kerberos AES128 et AES256, un ticket Kerberos est toujours √©mis avec le chiffrement RC4_HMAC_MD5. <br><br><img src="https://habrastorage.org/webt/el/4w/vn/el4wvniixybekufn7jswfcr7pey.png"><br><br>  La d√©sactivation de RC4_HMAC_MD5 est n√©cessaire au niveau du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">domaine.</a> <br><br>  L'attaque Kerberoasting a 2 approches. <br><br>  1. L'ancienne m√©thode.  Les tickets TGS sont demand√©s via setspn.exe ou .NET System.IdentityModel.Tokens.KerberosRequestorSecurityToken de la classe Powershell, r√©cup√©r√©s de la m√©moire √† l'aide de mimikatz, puis convertis au format souhait√© (John, Hashcat) et tri√©s. <br><br>  2. La nouvelle m√©thode.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">machosec a</a> remarqu√© que la classe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">KerberosRequestorSecurityToken</a> a une m√©thode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GetRequest</a> , qui extrait la partie chiffr√©e avec un mot de passe d'un ticket TGS. <br><br>  Outils pour mener une attaque: <br><br>  1) Rechercher des enregistrements SPN <br><br><ul><li>  <a href="">GetUserSPN.ps1</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Find-PSServiceAccounts.ps1</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Get-NetUSER -SPN</a> </li><li>  (Get-ADUser -Filter {ServicePrincipalName -ne "$ null"} -Properties ServicePrincipalName) .ServicePrincipalName </li></ul><br>  2) Demander un ticket TGS <br><br><ul><li>  setspn.exe (utilitaire Windows natif) </li><li>  Demande de ticket via PowerShell <br><br><pre> <code class="plaintext hljs">Add-Type -AssemblyNAme System.IdentityModel New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList ‚Äú&lt;ServicePrincipalName&gt;‚Äù</code> </pre> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Request-SPNTicket</a> </li></ul><br>  Vous pouvez afficher les tickets actuellement mis en cache √† l'aide de la commande klist. <br><br><div class="spoiler">  <b class="spoiler_title">Enregistrements SPN communs</b> <div class="spoiler_text"><ul><li>  TERMSRV - Bureau √† distance </li><li>  SmtpSVC et SMTP - Courrier </li><li>  WSMAN - WinRM </li><li>  ExchangeAB, ExchangeRFR, ExchangeMDM - MS Exchange </li><li>  POP / POP3 - Service postal POP3 </li><li>  IMAP / IMAP4 - Service de messagerie IMAP </li><li>  MSSQLSvc - Microsoft SQL Server </li><li>  MONGO - Serveur de base de donn√©es MongoDB </li><li>  DNS - serveur DNS </li><li>  HTTP, WWW - Serveur Web </li><li>  LDAP - LDAP </li><li>  FTP - Serveur FTP </li></ul><br></div></div><br>  3) Exportation de billets: <br><br><ul><li>  <a href="">Invoke-Mimikatz</a> -Commande '"Kerberos :: list / export"' </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mimikatz</a> -Commande '"Kerberos :: list / export"' </li><li>  <a href="">Invioke-kerberoast</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tgsrepack.py</a> </li></ul><br><br>  Un exemple d'ex√©cution automatis√©e des 3 points: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RiskiskSPN</a> <br><br><pre> <code class="bash hljs">Find-PotentiallyCrackableAccounts -Sensitive -Stealth -GetSPNs | Get-TGSCipher -Format <span class="hljs-string"><span class="hljs-string">"Hashcat"</span></span> | Out-File kerberoasting.txt</code> </pre> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Powersploit</a> <br><br><pre> <code class="bash hljs">Invoke-Kerberoast -Domain jet.lab -OutputFormat Hashcat | fl</code> </pre> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GetUserSPNs.py</a> <br><br><pre> <code class="bash hljs">GetUserSPNs.py -request jet.lab\user:Password</code> </pre> </li></ul><br><h3>  Asreproast </h3><br>  La vuln√©rabilit√© est que la pr√©-authentification Kerberos est d√©sactiv√©e.  Dans ce cas, nous pouvons envoyer des demandes AS-REQ √† un utilisateur dont la pr√©-authentification Kerberos est d√©sactiv√©e et obtenir la partie chiffr√©e avec un mot de passe. <br><br><img src="https://habrastorage.org/webt/zd/pm/h5/zdpmh5i7cas-s0gtv2uopy2sj14.png"><br><br>  La vuln√©rabilit√© est rare, car la d√©sactivation de la pr√©-authentification n'est pas le param√®tre par d√©faut. <br><br>  Recherche d'utilisateurs avec l'authentification Kerberos d√©sactiv√©e: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Powerview</a> <br><br><pre> <code class="bash hljs">Get-DomainUser -PreauthNotRequired -Properties samaccountname -Verbose</code> </pre> </li><li>  Module Active Directory <br><br><pre> <code class="bash hljs">get-aduser -filter * -properties DoesNotRequirePreAuth | <span class="hljs-built_in"><span class="hljs-built_in">where</span></span> {<span class="hljs-variable"><span class="hljs-variable">$_</span></span>.DoesNotRequirePreAuth -eq <span class="hljs-string"><span class="hljs-string">"True"</span></span> -and <span class="hljs-variable"><span class="hljs-variable">$_</span></span>.Enabled -eq <span class="hljs-string"><span class="hljs-string">"True"</span></span>} | select Name</code> </pre> </li></ul><br>  Obtenir la partie crypt√©e: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ASREPRoast</a> <br><br><pre> <code class="bash hljs">Invoke-ASREPROast | fl</code> </pre> <br><img src="https://habrastorage.org/webt/i_/o-/vf/i_o-vfbviphgjknolenx_qoesyo.png"></li></ul><br><br><h1>  Attaque via ACL </h1><br>  Une ACL dans un contexte de domaine est un ensemble de r√®gles qui d√©finissent les droits d'acc√®s des objets dans AD.  Une ACL peut √™tre configur√©e pour un seul objet (par exemple, un compte d'utilisateur) ou pour une unit√© d'organisation, par exemple, l'unit√© d'organisation.  Lorsque vous configurez l'ACL sur l'unit√© d'organisation, tous les objets de l'unit√© d'organisation h√©riteront de l'ACL.  Les ACL contiennent des entr√©es de contr√¥le d'acc√®s (ACE) qui d√©terminent comment le SID interagit avec l'objet Active Directory. <br><br>  Par exemple, nous avons trois groupes: A, B, C, o√π le groupe C est membre du groupe B et le groupe B est membre du groupe A. Lorsque vous ajoutez un invit√© au groupe C, l'invit√© sera non seulement membre du groupe C, mais aussi un membre indirect des groupes B et A. Lors de l'ajout de l'acc√®s √† un objet de domaine au groupe A, l'utilisateur invit√© aura √©galement acc√®s √† cet objet.  Dans une situation o√π l'utilisateur est un membre direct d'un seul groupe et que ce groupe est un membre indirect des 50 autres groupes, il est facile de perdre la connexion des autorisations h√©rit√©es. <br><br>  Vous pouvez r√©cup√©rer les ACL associ√©es √† l'objet en ex√©cutant la commande suivante <br><br><pre> <code class="bash hljs">Get-ObjectACL -Samaccountname Guest -ResolveGUIDs</code> </pre> <br>  Vous pouvez utiliser l'outil pour exploiter les erreurs de configuration ACL. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Invoke-ACLPwn</a> .  Le script Powershell collecte des informations sur toutes les listes de contr√¥le d'acc√®s dans le domaine √† l'aide du collecteur BloodHound, SharpHound, et cr√©e une cha√Æne pour obtenir l'autorisation writeDACL.  Une fois la cha√Æne cr√©√©e, le script ex√©cute chaque √©tape de la cha√Æne.  L'ordre du script: <br><br><ol><li>  L'utilisateur est ajout√© aux groupes n√©cessaires. </li><li>  Deux ACE (r√©plication des modifications de r√©pertoire et r√©plication des modifications de r√©pertoire TOUT) sont ajout√©es aux ACL de l'objet de domaine. </li><li>  Si vous avez des droits sur DCSync √† l'aide de l'utilitaire Mimikatz, le hachage du mot de passe de l'utilisateur krbtgt est demand√© (param√®tre par d√©faut). </li><li>  Une fois l'op√©ration termin√©e, le script supprime tous les groupes et entr√©es ACE ajout√©s dans l'ACL. </li></ol><br>  Le script vise uniquement √† utiliser les autorisations writeDACL.  Les droits d'acc√®s suivants peuvent √©galement int√©resser un attaquant: <br><br><ul><li>  ForceChangePassword.  Droits de modifier le mot de passe utilisateur lorsque le mot de passe actuel n'est pas connu.  Fonctionnement avec PowerSploit - Set-DomainUserPassword. </li><li>  AddMembers.  Droits d'ajouter des groupes, des ordinateurs et des utilisateurs √† des groupes.  Fonctionnement avec PowerSploit - Add-DomainGroupMember. </li><li>  GenericWrite  Droits de modifier les attributs d'un objet.  Par exemple, modifiez la valeur du param√®tre scriptPath.  La prochaine fois que l'utilisateur se connecte au syst√®me, le fichier sp√©cifi√© d√©marre.  Fonctionnement avec PowerSploit - Set-DomainObject. </li><li>  WriteOwner.  Droits de changer le propri√©taire de l'objet.  Fonctionnement avec PowerSploit - Set-DomainObjectOwner. </li><li>  AllExtendedRights.  Droits d'ajouter des utilisateurs √† des groupes, de modifier les mots de passe des utilisateurs, etc. Fonctionnement avec PowerSploit - Set-DomainUserPassword ou Add-DomainGroupMember. </li></ul><br>  Fonctionnement: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Invoke-aclpwn</a> </li></ul><br>  √Ä partir d'une machine qui se trouve dans un domaine <br><br><pre> <code class="bash hljs">./Invoke-ACL.ps1 -SharpHoundLocation .\sharphound.exe -mimiKatzLocation .\mimikatz.exe</code> </pre> <br>  √Ä partir d'une machine qui n'est pas dans un domaine <br><br><pre> <code class="bash hljs">/Invoke-ACL.ps1 -SharpHoundLocation .\sharphound.exe -mimiKatzLocation .\mimikatz.exe -Username <span class="hljs-string"><span class="hljs-string">'domain\user'</span></span> -Domain <span class="hljs-string"><span class="hljs-string">'fqdn_of_target_domain'</span></span> -Password <span class="hljs-string"><span class="hljs-string">'Pass'</span></span></code> </pre> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">aclpwn.py</a> est un outil similaire √©crit en Python </li></ul><br><h3>  D√©l√©gation Kerberos </h3><br>  La d√©l√©gation d'autorit√© Kerberos vous permet de r√©utiliser les informations d'identification de l'utilisateur final pour acc√©der aux ressources h√©berg√©es sur un autre serveur. <br><br>  La d√©l√©gation Kerberos peut √™tre de trois types: <br><br><ol><li>  Illimit√© (d√©l√©gation sans contrainte).  La seule option de d√©l√©gation avant Windows Server 2003 </li><li>  D√©l√©gation restreinte depuis Windows Server 2003 </li><li>  D√©l√©gation contrainte bas√©e sur les ressources  Introduit dans Windows Server 2012 </li></ol><br><h4>  D√©l√©gation illimit√©e </h4><br>  Dans le composant logiciel enfichable Active Directory, la fonction de d√©l√©gation illimit√©e activ√©e est la suivante: <br><br><img src="https://habrastorage.org/webt/ip/mp/e8/ipmpe8ygslgtbdklbkiseqtwg64.png"><br><br>  Pour plus de clart√©, consid√©rez comment la d√©l√©gation illimit√©e se produit sur un diagramme. <br><br><img src="https://habrastorage.org/webt/1i/p1/wq/1ip1wqkjnc9plqcqzmpkr1rcfwg.png"><br><br><ol><li>  Le mot de passe utilisateur est converti en hachage ntlm.  L'horodatage est chiffr√© avec ce hachage et envoy√© au contr√¥leur de domaine pour demander un ticket TGT. </li><li>  Le contr√¥leur de domaine v√©rifie les informations sur l'utilisateur (restriction de connexion, appartenance √† des groupes, etc.), cr√©e un ticket TGT et l'envoie √† l'utilisateur.  Le ticket TGT est crypt√©, sign√© et seul krbtgt peut lire ses donn√©es. </li><li>  L'utilisateur demande un ticket TGS pour acc√©der au service Web sur le serveur Web. </li><li>  Le contr√¥leur de domaine fournit un ticket TGS. </li><li>  L'utilisateur envoie des tickets TGT et TGS au serveur Web. </li><li>  Le compte de service du serveur Web utilise le ticket TGT de l'utilisateur pour demander un ticket TGS pour acc√©der au serveur de base de donn√©es. </li><li>  Le compte de service se connecte au serveur de base de donn√©es en tant qu'utilisateur. </li></ol><br>  Le principal danger d'une d√©l√©gation illimit√©e est que lorsqu'une machine avec une d√©l√©gation illimit√©e est compromise, un attaquant pourra obtenir des tickets TGT d'utilisateurs de cette machine et acc√©der √† n'importe quel syst√®me du domaine au nom de ces utilisateurs. <br><br>  Rechercher des machines dans un domaine avec d√©l√©gation illimit√©e: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Powerview</a> <br><br><pre> <code class="bash hljs">Get-NetComputer -unconstrained</code> </pre> </li><li>  Module Active Directory <br><br><pre> <code class="bash hljs">Get-Adcomputer -Filter {TrustedForDelegation -eq <span class="hljs-variable"><span class="hljs-variable">$True</span></span>}</code> </pre>  . </li></ul><br>  Exportation de ticket: <br><br><ul><li>  Utilisation de mimikatz.  sekurlsa :: tickets / exportation </li><li>  Vous pouvez √©galement effectuer une attaque Pass-The-ticket. <br><br><pre> <code class="bash hljs"> kerberos::ptt C:\tickets\.</code> </pre> </li></ul><br><img src="https://habrastorage.org/webt/oa/wa/25/oawa25sduaj5u303b1q9svirdku.gif"><br><br><h4>  D√©l√©gation limit√©e </h4><br>  Le mode de d√©l√©gation limit√©e vous permet d'acc√©der uniquement aux services autoris√©s et sur une machine sp√©cifique.  Dans le composant logiciel enfichable Active Directory, cela ressemble √† ceci: <br><br><img src="https://habrastorage.org/webt/xj/ku/no/xjkunogyspfpevoanui8nzxwlzq.png"><br><br>  Avec une d√©l√©gation limit√©e, 2 extensions de protocole Kerberos sont utilis√©es: <br><br><ul><li>  S4uself </li><li>  S4UProxy </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">S4U2Self est</a> utilis√© lorsque le client ne s'authentifie pas √† l'aide de Kerberos. <br><br>  Pour une d√©l√©gation illimit√©e, TGT est utilis√© pour identifier l'utilisateur, auquel cas l'extension S4U utilise la structure <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PA-FOR-USER</a> comme nouveau type dans le champ de donn√©es padata / pr√©-authentification.  Le processus S4U2self n'est autoris√© que si l'utilisateur demandeur a le champ TRUSTED_TO_AUTH_FOR_DELEGATION d√©fini dans son userAccountControl. <br><br><img src="https://habrastorage.org/webt/oo/yk/5s/ooyk5sjtsusxcfkois5ej7dgnua.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">S4U2Proxy</a> permet au compte de service d'utiliser le ticket de redirection re√ßu dans le processus S4U2proxy pour demander un ticket TGS pour l'acc√®s aux services autoris√©s (msds-allowtodelegateto).  KDC v√©rifie si le service demand√© est sp√©cifi√© dans le champ msds-allowtodelegateto de l'utilisateur demandeur et √©met un ticket si la v√©rification r√©ussit.  Ainsi, la d√©l√©gation est ¬´limit√©e¬ª √† des services cibles sp√©cifiques. <br><br><img src="https://habrastorage.org/webt/t-/a7/n6/t-a7n6ludbpsvmbk0ru_kwxvpq4.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez rechercher des ordinateurs et des utilisateurs dans un domaine de d√©l√©gation limit√© √† l'aide de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerView</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recherche d'ordinateurs avec d√©l√©gation illimit√©e</font></font><br><br><pre> <code class="bash hljs">Get-DomainComputer -TrustedtoAuth</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Recherche d'utilisateurs √† d√©l√©gation limit√©e </font></font><br><br><pre> <code class="bash hljs">Get-DomainUser -TrustedtoAuth</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pour mener une attaque, nous avons besoin d'un mot de passe ouvert, d'un hachage de mot de passe NTLM ou d'un ticket TGT. </font></font><br><br><img src="https://habrastorage.org/webt/gd/5f/fx/gd5ffxfwmgeqr5j28ovwzcqqacy.gif"><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> D√©l√©gation limit√©e bas√©e sur les ressources </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme pour la d√©l√©gation r√©guli√®re, des extensions S4U sont utilis√©es. √âtant donn√© que la d√©l√©gation bas√©e sur les ressources est principalement une d√©l√©gation limit√©e, les attaques qui concernent la d√©l√©gation limit√©e r√©guli√®re sont √©galement disponibles ici. La seule diff√©rence est que dans une d√©l√©gation limit√©e simple, le service A doit avoir l' </font><font style="vertical-align: inherit;">attribut </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msDS-AllowedToDelegateTo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = ServiceB, et ici le service B doit avoir l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">attribut msDS-AllowedToActOnBehalfOfOtherIdentity</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = Service A. </font></font><br><br><img src="https://habrastorage.org/webt/td/um/jl/tdumjlcportki98xbixgfo1jaiu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette propri√©t√© permet une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">attaque</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> suppl√©mentaire </font><font style="vertical-align: inherit;">publi√©e par </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">harmj0y</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Une attaque n√©cessite des autorisations pour modifier le param√®tre PrincipalsAllowedToDelegateToAccount, qui d√©finit l'attribut msds-AllowedToActOnBehalfOfOtherIdentity, qui contient une liste de contr√¥le d'acc√®s (ACL). </font><font style="vertical-align: inherit;">Contrairement √† une d√©l√©gation limit√©e, nous n'avons pas besoin des droits d'administrateur de domaine pour modifier l'attribut msds-AllowedToActOnBehalfOfOtherIdentity. </font><font style="vertical-align: inherit;">Vous pouvez savoir qui est autoris√© √† modifier l'attribut comme suit:</font></font><br><br><pre> <code class="plaintext hljs">(Get-acl "AD:$((get-adcomputer Windows7).distinguishedname)").access | Where-Object -Property ActiveDirectoryRights -Match WriteProperty |out-gridview</code> </pre> <br><img src="https://habrastorage.org/webt/ej/4p/bk/ej4pbkl5bkv5y75mqp54mxu0qcm.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Donc, pour mener l'attaque, ex√©cutez mitm6 </font></font><br><br><pre> <code class="bash hljs">mitm6 -I vmnet0</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous commen√ßons ntlmrelayx avec l'option --delegate-access </font></font><br><br><pre> <code class="plaintext hljs">ntlmrelayx -t ldaps://dc1.jet.lab --delegate-access</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L'attaque cr√©e un ordinateur ZGXTPVYX $ avec des droits de d√©l√©gation sur un ordinateur Windows7. </font></font><br><br><pre> <code class="plaintext hljs">$x = Get-ADComputer Windows7 -Properties msDS-AllowedToActOnBehalfOfOtherIdentity $x.'msDS-AllowedToActOnBehalfOfOtherIdentity'.Access</code> </pre><br><img src="https://habrastorage.org/webt/21/oo/w9/21oow9kxnu53sg9wi-xnneus9fc.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un bon rapport de d√©l√©gation a √©t√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√©sent√©</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aux PHDays par Yegor Podmokov.</font></font><br><br><img src="https://habrastorage.org/webt/kr/ri/za/krrizaffbrqgiee3gd2kufqs8s4.gif"><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Abus des autorisations de GPO </font></font></h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les objets de strat√©gie de groupe</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un outil qui permet aux administrateurs de g√©rer efficacement un domaine. </font><font style="vertical-align: inherit;">Mais il se trouve que les utilisateurs se voient attribuer des droits inutiles, y compris pour modifier les strat√©gies de GPO. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour illustrer l'exemple, nous ajouterons √† l'utilisateur Ragnar les droits de modification de la strat√©gie des contr√¥leurs de domaine par d√©faut (dans la vie r√©elle, les droits de cette strat√©gie ne sont accord√©s qu'aux administrateurs de domaine, mais l'essence de l'attaque ne change pas; dans le cas d'une autre strat√©gie, seuls les h√¥tes contr√¥l√©s changent). </font></font><br><br><img src="https://habrastorage.org/webt/yw/on/ht/ywonhtpbkwdqffjvzck5hdhjgza.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ânum√©rer les droits sur tous les objets de strat√©gie de groupe du domaine √† l'aide de </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerView</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="plaintext hljs">Get-NetGPO | % {Get-ObjectAcl -ResolveGUIDs -Name $_.Name}</code> </pre> <br><img src="https://habrastorage.org/webt/fk/cf/sk/fkcfskfmeohuicn13_76t190miy.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un utilisateur Ragnar a le droit de modifier un objet de strat√©gie de groupe dont le GUID est 6AC1786C-016F-11D2-945F-00C04FB984F9. </font><font style="vertical-align: inherit;">Pour d√©terminer quels h√¥tes du domaine appliquent cette strat√©gie, ex√©cutez la commande suivante</font></font><br><br><pre> <code class="plaintext hljs">Get-NetOU -GUID "6AC1786C-016F-11D2-945F-00C04FB984F9" | % {Get-NetComputer -AdSpath $_}</code> </pre> <br><img src="https://habrastorage.org/webt/ou/ut/9c/ouut9cizgebvp9q_dkoifqlqgic.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous avez l'h√¥te dc1.jet.lab. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connaissant la politique sp√©cifique que l'utilisateur Ragnar peut modifier et les h√¥tes auxquels cette politique s'applique, nous pouvons effectuer diverses actions sur l'h√¥te dc1.jet.lab.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voici les options d'utilisation de l'objet de strat√©gie de groupe</font></font></b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><td> Computer Configuration\Preferences\Control Panel Settings\Folder Options </td><td> Create/alter file type associations, register DDE actions with those associations </td></tr><tr><td> Computer Configuration\Preferences\Control Panel Settings\Local Users and Groups </td><td> Add new local admin account </td></tr><tr><td> Computer Configuration\Preferences\Control Panel Settings\Scheduled Tasks </td><td> Deploy a new evil scheduled task (ie: PowerShell download cradle) </td></tr><tr><td> Computer Configuration\Preferences\Control Panel Settings\Services </td><td> Create and configure new evil services </td></tr><tr><td> Computer Configuration\Preferences\Windows Settings\Files </td><td> Affected computers will download a file from the domain controller </td></tr><tr><td> Computer Configuration\Preferences\Windows Settings\INI Files </td><td> Update existing INI files </td></tr><tr><td> Computer Configuration\Preferences\Windows Settings\Registry </td><td> Update specific registry keys. Very useful for disabling security mechanisms, or triggering code execution in any number of ways </td></tr><tr><td> Computer Configuration\Preferences\Windows Settings\Shortcuts </td><td> Deploy a new evil shortcut </td></tr><tr><td> Computer Configuration\Policies\Software Settings\Software installation </td><td> Deploy an evil MSI. The MSI must be available to the GP client via a network share </td></tr><tr><td> Computer Configuration\Policies\Windows Settings\Scripts (startup/shutdown) </td><td> Configure and deploy evil startup scripts. Can run scripts out of GPO directory, can also run PowerShell commands with arguments </td></tr><tr><td> Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Audit Policy </td><td> Modify local audit settings. Useful for evading detection </td></tr><tr><td> Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\ </td><td> Grant a user the right to logon via RDP, grant a user SeDebugPrivilege, grant a user the right to load device drivers, grant a user seTakeOwnershipPrivilege. Basically, take over the remote computer without ever being an administrator on it </td></tr><tr><td> Computer Configuration\Policies\Windows Settings\Security Settings\Registry </td><td> Alter DACLs on registry keys, grant yourself an extremely hard to find backdoor on the system </td></tr><tr><td> Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall </td><td> Manage the Windows firewall. Open up ports if they're blocked </td></tr><tr><td> Computer Configuration\Preferences\Windows Settings\Environment </td><td> Add UNC path for DLL side loading </td></tr><tr><td> Computer Configuration\Preferences\Windows Settings\Files </td><td> Copy a file from a remote UNC path </td></tr></tbody></table></div><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">outils </font></a></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New-GPOImmediateTask</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SharpGPOAbuse</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous permettent de:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ex√©cuter la t√¢che dans le planificateur de t√¢ches </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ajouter des droits d'utilisateur (SeDebugPrivilege, SeTakeOwnershipPrivilege, etc.) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ajouter un script qui s'ex√©cute apr√®s le d√©marrage </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ajouter un utilisateur au groupe local </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Par exemple, ajoutez une t√¢che dans le planificateur de t√¢ches pour obtenir une session Meterpreter: </font></font><br><br><pre> <code class="plaintext hljs">New-GPOImmediateTask -TaskName test3 -GPODisplayName "Default Domain Controllers Policy" -CommandArguments '&lt;powershell_meterepreter_payload&gt;' -Force</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s l'ex√©cution, le test de t√¢che planifi√©e </font></font><br><br><img src="https://habrastorage.org/webt/dr/au/v8/drauv8km1pwp56jt_reymw8d5gw.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">appara√Æt et une session Meterpreter appara√Æt. </font></font><br><br><img src="https://habrastorage.org/webt/js/e6/g8/jse6g8vqatvnvr5h1qlx2mvrvzq.png"><br><br><img src="https://habrastorage.org/webt/zj/ct/wz/zjctwz7ca8xg5j6zbqoqlf3q9w0.gif"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour supprimer une t√¢che planifi√©e, vous devez ex√©cuter la commande suivante:</font></font><br><br><pre> <code class="plaintext hljs">New-GPOImmediateTask -Remove -Force -GPODisplayName SecurePolicy</code> </pre> <br><h1>  Conclusions </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans l'article, nous n'avons examin√© que certains vecteurs d'attaque. </font><font style="vertical-align: inherit;">Des vues telles que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enumerate Accounts et Password spray</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS14-068</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un tas de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bogues d'imprimante</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et de d√©l√©gation sans contrainte, les attaques sur Exchange ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ruler</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PrivExchange</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ExchangeRelayX</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) peuvent √©largir consid√©rablement la port√©e de l'attaque. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les techniques d'attaque et les m√©thodes d'√©pinglage (Golden ticket, Silver ticket, Pass-The-Hash, Over pass the hash, SID History, DC Shadow, etc.) changent constamment, et l'√©quipe de d√©fense devrait toujours √™tre pr√™te pour de nouveaux types d'attaques.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr449278/">https://habr.com/ru/post/fr449278/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr449264/index.html">Cr√©ation d'un syst√®me de reporting pour 1C: ERP bas√© sur OLAP et Excel</a></li>
<li><a href="../fr449266/index.html">3 rapports avec RusCrypto: conf√©rences avec exp√©rience</a></li>
<li><a href="../fr449270/index.html">Yandex a publi√© un aper√ßu du march√© des postes vacants en informatique</a></li>
<li><a href="../fr449274/index.html">Grand √©cran √† 7 segments avec n√©on sur l'ESP8266</a></li>
<li><a href="../fr449276/index.html">Changement de carri√®re √† 35 ans. Mon exp√©rience et mes premiers succ√®s</a></li>
<li><a href="../fr449280/index.html">Fonctionnement de la plateforme de jeu en nuage pour les clients B2B et B2C. Solutions pour une belle image et combattez avec le dernier kilom√®tre</a></li>
<li><a href="../fr449282/index.html">Sauvegarde, partie 1: objectif, vue d'ensemble des techniques et technologies</a></li>
<li><a href="../fr449284/index.html">Je vends des oignons en ligne</a></li>
<li><a href="../fr449286/index.html">Make on go GraphQL API</a></li>
<li><a href="../fr449288/index.html">Quelle √©quipe est n√©cessaire pour cr√©er une tr√®s bonne boutique en ligne?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>