<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📴 👩‍👩‍👧‍👧 💇🏾 GraphQL es el futuro de los microservicios? 👩🏿‍🤝‍👨🏽 🐺 🤸🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="GraphQL a menudo se presenta como una forma revolucionaria de diseñar API web en comparación con REST. Sin embargo, si observa más de cerca estas tecn...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GraphQL es el futuro de los microservicios?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421985/"> GraphQL a menudo se presenta como una forma revolucionaria de diseñar API web en comparación con REST.  Sin embargo, si observa más de cerca estas tecnologías, verá que hay muchas diferencias entre ellas.  GraphQL es una solución relativamente nueva, cuyas fuentes se abrieron a la comunidad de Facebook en 2015.  Hoy, REST sigue siendo el paradigma más popular utilizado para proporcionar API e interoperabilidad entre microservicios.  ¿GraphQL podrá superar a REST en el futuro?  Veamos cómo se produce la interacción de microservicios a través de la API GraphQL utilizando Spring Boot y la biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GQL</a> . <br><a name="habracut"></a><br>  Comencemos con el ejemplo de arquitectura de nuestro sistema.  Supongamos que tenemos tres microservicios que se comunican entre sí a través de las URL recibidas de las aplicaciones Spring Cloud Eureka. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/597/9a0/705/5979a0705e43efb645b34e199f5c162e.png" alt="imagen"><br><br><h2>  Habilitación de la compatibilidad con GraphQL en Spring Boot </h2><br>  Podemos habilitar fácilmente el soporte para GraphQL en el lado del servidor de la aplicación Spring Boot usando iniciadores.  Después de agregar graphql-spring-boot-starter, el servlet GraphQL estará disponible automáticamente en / graphql.  Podemos anular esta ruta predeterminada especificando la propiedad graphql.servlet.mapping en el archivo application.yml.  También incluimos GraphiQL, un IDE basado en navegador para escribir, validar y probar consultas GraphQL y la biblioteca GraphQL Java Tools, que contiene componentes útiles para crear consultas y mutaciones.  Gracias a esta biblioteca, todos los archivos en el classpath con la extensión .graphqls se usarán para crear una definición de esquema. <br><br><pre><code class="hljs lisp">compile('com.graphql-java<span class="hljs-symbol"><span class="hljs-symbol">:graphql-spring-boot-starter</span></span>:<span class="hljs-number"><span class="hljs-number">5.0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>') compile('com.graphql-java<span class="hljs-symbol"><span class="hljs-symbol">:graphiql-spring-boot-starter</span></span>:<span class="hljs-number"><span class="hljs-number">5.0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>') compile('com.graphql-java<span class="hljs-symbol"><span class="hljs-symbol">:graphql-java-tools</span></span>:<span class="hljs-number"><span class="hljs-number">5.2</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>')</code> </pre> <br><h2>  Descripción del esquema GrpahQL </h2><br>  Cada descripción del esquema contiene una declaración de tipos, relaciones entre ellos y muchas operaciones que incluyen consultas para buscar objetos y mutaciones para crear, actualizar o eliminar datos.  Por lo general, comenzamos definiendo el tipo responsable del dominio del objeto descrito.  Puede indicar si el campo es obligatorio con <code>!</code>  carácter o si es una matriz - <code>[…]</code> .  La descripción debe contener el tipo declarado o una referencia a otros tipos disponibles en la especificación. <br><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Employee</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ID</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">organizationId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">departmentId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">age</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">position</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">salary</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">! }</span></span></code> </pre><br>  La siguiente parte de la definición del esquema contiene declaraciones de consultas y mutaciones.  La mayoría de las consultas devuelven una lista de objetos que están marcados como [Empleado] en el esquema.  Dentro del tipo EmployeeQueries, declaramos todos los métodos de búsqueda, mientras que en el tipo EmployeeMutations, métodos para agregar, actualizar y eliminar empleados.  Si pasa un objeto completo a un método, debe declararlo como un tipo de entrada. <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">schema</span></span> { query: <span class="hljs-type"><span class="hljs-type">EmployeeQueries</span></span> mutation: <span class="hljs-type"><span class="hljs-type">EmployeeMutations</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EmployeeQueries</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">employees</span></span></span><span class="hljs-class">: [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Employee</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">employee</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ID</span></span></span><span class="hljs-class">!): </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Employee</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">employeesByOrganization</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">organizationId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">!): [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Employee</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">employeesByDepartment</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">departmentId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">!): [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Employee</span></span></span><span class="hljs-class">] } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EmployeeMutations</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">newEmployee</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">employee</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EmployeeInput</span></span></span><span class="hljs-class">!): </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Employee</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">deleteEmployee</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ID</span></span></span><span class="hljs-class">!) : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Boolean</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">updateEmployee</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ID</span></span></span><span class="hljs-class">!, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">employee</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EmployeeInput</span></span></span><span class="hljs-class">!): </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Employee</span></span></span><span class="hljs-class"> } input </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EmployeeInput</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">organizationId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">departmentId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">age</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">position</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">salary</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class"> }</span></span></code> </pre><br><h2>  Implementación de consultas y mutaciones </h2><br>  Gracias a la configuración automática de GraphQL Java Tools y Spring Boot GraphQL, no necesitamos hacer un gran esfuerzo para implementar consultas y mutaciones en nuestra aplicación.  El bean EmployeesQuery debe implementar la interfaz GraphQLQueryResolver.  En base a esto, Spring podrá encontrar y llamar automáticamente al método correcto como respuesta a una de las consultas GraphQL que se han declarado dentro del esquema.  Aquí está la clase que contiene la implementación de las respuestas a las consultas: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmployeeQueries</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GraphQLQueryResolver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger LOGGER = LoggerFactory.getLogger(EmployeeQueries.class); <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> EmployeeRepository repository; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">employees</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ LOGGER.info(<span class="hljs-string"><span class="hljs-string">"Employees find"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> repository.findAll(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">employeesByOrganization</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long organizationId)</span></span></span><span class="hljs-function"> </span></span>{ LOGGER.info(<span class="hljs-string"><span class="hljs-string">"Employees find: organizationId={}"</span></span>, organizationId); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> repository.findByOrganization(organizationId); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">employeesByDepartment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long departmentId)</span></span></span><span class="hljs-function"> </span></span>{ LOGGER.info(<span class="hljs-string"><span class="hljs-string">"Employees find: departmentId={}"</span></span>, departmentId); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> repository.findByDepartment(departmentId); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Employee </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">employee</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long id)</span></span></span><span class="hljs-function"> </span></span>{ LOGGER.info(<span class="hljs-string"><span class="hljs-string">"Employee find: id={}"</span></span>, id); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> repository.findById(id); } }</code> </pre><br>  Si desea llamar, por ejemplo, al método de empleado (Identificación larga), escriba la siguiente consulta.  Para probarlo en su aplicación, use GraphiQL, que está disponible en / graphiql. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5d1/c24/8aa/5d1c248aa840e0955775b7da1eee4595.png" alt="imagen"><br><br>  El bean responsable de implementar los métodos de mutación necesita implementar la interfaz GraphQLMutationResolver.  A pesar del nombre EmployeeInput, seguimos utilizando el mismo objeto de dominio Employee que devuelve la solicitud. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmployeeMutations</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GraphQLMutationResolver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger LOGGER = LoggerFactory.getLogger(EmployeeQueries.class); <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> EmployeeRepository repository; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Employee </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newEmployee</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Employee employee)</span></span></span><span class="hljs-function"> </span></span>{ LOGGER.info(<span class="hljs-string"><span class="hljs-string">"Employee add: employee={}"</span></span>, employee); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> repository.add(employee); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deleteEmployee</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long id)</span></span></span><span class="hljs-function"> </span></span>{ LOGGER.info(<span class="hljs-string"><span class="hljs-string">"Employee delete: id={}"</span></span>, id); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> repository.delete(id); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Employee </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateEmployee</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long id, Employee employee)</span></span></span><span class="hljs-function"> </span></span>{ LOGGER.info(<span class="hljs-string"><span class="hljs-string">"Employee update: id={}, employee={}"</span></span>, id, employee); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> repository.update(id, employee); } }</code> </pre><br>  Y aquí usamos GraphiQL para probar mutaciones.  Aquí hay un comando que agrega un nuevo empleado y acepta la respuesta con la identificación y el nombre del empleado. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cb4/e5b/23b/cb4e5b23b7f832aef059456d9cea361c.png" alt="imagen"><br><br>  <b>Sobre esto, detengo la traducción de este artículo y escribo mi "digresión lírica", pero en realidad reemplazo la descripción de la parte del microservicio a través del Apollo Client para interactuar a través de las bibliotecas GQL y Unirest, bibliotecas para ejecutar solicitudes HTTP.</b> <b><br></b> <br><br><h2>  Cliente GraphQL en Groovy. </h2><br>  Para crear consultas GraphQL en microservicios de servicio de departamento, utilizaré los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">constructores de consultas</a> : <br><br><pre> <code class="hljs powershell">String queryString = DSL.buildQuery { query(<span class="hljs-string"><span class="hljs-string">'employeesByDepartment'</span></span>, [<span class="hljs-type"><span class="hljs-type">departmentId</span></span>: <span class="hljs-type"><span class="hljs-type">departmentId</span></span>]) { returns { id name position salary } } }</code> </pre><br>  Esta construcción en DSL GQL crea una consulta del formulario: <br><br><pre> <code class="hljs objectivec">{ employeesByDepartment (departmentId: <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> name position salary } }</code> </pre><br>  Y, además, realizaré una solicitud HTTP en la dirección pasada al método. <br>  Descubriremos cómo se forma aún más la dirección de solicitud. <br><br><pre> <code class="hljs markdown">(Unirest.post(serverUrl) .body(JsonOutput.toJson([<span class="hljs-string"><span class="hljs-string">query: queryString</span></span>])) .asJson() .body.jsonObject[<span class="hljs-string"><span class="hljs-string">'data'</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">'employeesByDepartment'</span></span>] as List) .collect { JsonUtils.jsonToData(it.toString(), Employee.class) }</code> </pre><br>  Después de recibir la respuesta, la transformamos de JSONObject a la vista de lista de Empleados. <br><br><h2>  Cliente GrpahQL para microservicio de empleados </h2><br>  Considere la implementación de empleados de microservicios.  En este ejemplo, utilicé el cliente Eureka directamente.  eurekaClient obtiene todas las instancias de servicio en ejecución registradas como servicio de empleado.  Luego, selecciona aleatoriamente alguna instancia de las registradas (2).  A continuación, toma su número de puerto y forma la dirección de solicitud (3) y la pasa al objeto EmployeeGQL que es el cliente GraphQL en Groovy y que se describe en el párrafo anterior. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmployeeClient</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger LOGGER = LoggerFactory.getLogger(EmployeeClient.class); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String SERVICE_NAME = <span class="hljs-string"><span class="hljs-string">"EMPLOYEE-SERVICE"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String SERVER_URL = <span class="hljs-string"><span class="hljs-string">"http://localhost:%d/graphql"</span></span>; Random r = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random(); <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> EurekaClient discoveryClient; <span class="hljs-comment"><span class="hljs-comment">// (1) public List&lt;Employee&gt; findByDepartment(Long departmentId) { Application app = discoveryClient.getApplication(SERVICE_NAME); InstanceInfo ii = app.getInstances().get(r.nextInt(app.size())); // (2) String serverUrl = String.format(SERVER_URL, ii.getPort()); // (3) EmployeeGQL clientGQL = new EmployeeGQL(); return clientGQL.getEmployeesByDepartmentQuery(serverUrl, departmentId.intValue()); // (4) } }</span></span></code> </pre><br>  <b>Además, "paso" la palabra al autor nuevamente, o más bien continúo la traducción de su artículo.</b> <br><br>  Finalmente, EmployeeClient se inyecta en una clase que responde a las solicitudes de DepartmentQueries y se usa dentro de la solicitud de departamentosByOrganizationWithEmployees. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Department&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">departmentsByOrganizationWithEmployees</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long organizationId)</span></span></span><span class="hljs-function"> </span></span>{ LOGGER.info(<span class="hljs-string"><span class="hljs-string">"Departments find: organizationId={}"</span></span>, organizationId); List&lt;Department&gt; departments = repository.findByOrganization(organizationId); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; departments.size(); i++) { departments.get(i).setEmployees(employeeClient.findByDepartment(departments.get(i).getId())); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> departments; }</code> </pre><br>  Antes de hacer las solicitudes necesarias, debemos echar un vistazo al diagrama creado para el servicio de departamento.  Cada objeto del Departamento puede contener una lista de empleados asignados, y también definimos el tipo de Empleado al que hace referencia el tipo de Departamento. <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">schema</span></span> { query: <span class="hljs-type"><span class="hljs-type">DepartmentQueries</span></span> mutation: <span class="hljs-type"><span class="hljs-type">DepartmentMutations</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DepartmentQueries</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">departments</span></span></span><span class="hljs-class">: [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Department</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">department</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ID</span></span></span><span class="hljs-class">!): </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Department</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">departmentsByOrganization</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">organizationId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">!): [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Department</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">departmentsByOrganizationWithEmployees</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">organizationId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">!): [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Department</span></span></span><span class="hljs-class">] } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DepartmentMutations</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">newDepartment</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">department</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DepartmentInput</span></span></span><span class="hljs-class">!): </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Department</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">deleteDepartment</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ID</span></span></span><span class="hljs-class">!) : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Boolean</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">updateDepartment</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ID</span></span></span><span class="hljs-class">!, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">department</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DepartmentInput</span></span></span><span class="hljs-class">!): </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Department</span></span></span><span class="hljs-class"> } input </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DepartmentInput</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">organizationId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">! } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Department</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ID</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">organizationId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">employees</span></span></span><span class="hljs-class">: [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Employee</span></span></span><span class="hljs-class">] } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Employee</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ID</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">position</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">salary</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">! }</span></span></code> </pre><br>  Ahora podemos llamar a nuestra consulta de prueba con una lista de los campos obligatorios usando GraphiQL.  La aplicación de servicio de departamento está disponible de forma predeterminada en el puerto 8091, es decir, podemos verla en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http: // localhost: 8091 / graphiql</a> <br><br><h2>  Conclusión </h2><br>  Quizás GraphQL puede ser una alternativa interesante a la API REST estándar.  Sin embargo, no debemos considerarlo como un reemplazo para REST.  Hay varios casos en los que GraphQL puede ser la mejor opción, pero aquellos en los que REST es la mejor opción.  Si sus clientes no necesitan tener todos los campos devueltos por el lado del servidor, y además tiene muchos clientes con diferentes requisitos para un punto de entrada, GraphQL es una buena opción.  Si observa lo que hay en la comunidad de microservicios, puede ver que ahora no hay una solución basada en Java que le permita usar GraphQL junto con el descubrimiento de servicios, un equilibrador o una API de puerta de enlace lista para usar.  En este artículo, mostré un ejemplo del uso de GQL y Unirest para crear un cliente GraphQL con Spring Cloud Eureka para la comunicación de microservicios.  Código de muestra para el autor de un artículo en inglés en GitHub <a href="">github.com/piomin/sample-graphql-microservices.git</a> . <br><br>  <b>Un ejemplo mío cuando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">estoy</a> con la biblioteca</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GQL</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github.com/lynx-r/sample-graphql-microservices</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es421985/">https://habr.com/ru/post/es421985/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es421971/index.html">El ruso nativo de Xorg en rdesktop es un poco, pero agradable</a></li>
<li><a href="../es421975/index.html">Nuevas características de FLProg: ESP8266 como controlador, no como módem</a></li>
<li><a href="../es421977/index.html">GPS subacuático en dos transceptores</a></li>
<li><a href="../es421979/index.html">Tema Drácula: un tema universal para casi todo</a></li>
<li><a href="../es421983/index.html">El aprendizaje automático ayudará a reducir la población de moscas tsetsé para reducir la incidencia de la enfermedad del sueño.</a></li>
<li><a href="../es421991/index.html">Hospede una aplicación web en Amazon Web Services. Barato ¿Es esto posible?</a></li>
<li><a href="../es421993/index.html">Python interesante y útil</a></li>
<li><a href="../es421995/index.html">Diferencias entre compilar un sitio web y una aplicación web</a></li>
<li><a href="../es422001/index.html">Medidor de CO2</a></li>
<li><a href="../es422003/index.html">Costos fijos y variables en el desarrollo de software.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>