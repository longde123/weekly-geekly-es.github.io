<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéóÔ∏è ‚¨ÖÔ∏è üå®Ô∏è Porting Lode Runner de BC para UKNC üñïüèΩ ‚Ü™Ô∏è üë©üèΩ‚Äçüî¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em mar√ßo-maio ‚Äã‚Äãdeste ano, passei v√°rias semanas (√† noite e nos fins de semana) transportando o brinquedo Lode Runner da BK-0010 para o UKSC. 
 Captur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Porting Lode Runner de BC para UKNC</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/383497/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em mar√ßo-maio ‚Äã‚Äãdeste ano, passei v√°rias semanas (√† noite e nos fins de semana) transportando o brinquedo Lode Runner da BK-0010 para o UKSC. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Captura de tela do menu portado:</font></font><br>
<img src="https://habrastorage.org/files/1d3/d35/f41/1d3d35f4111c4f4c9e4324d8e285ea26.png"><br>
<a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tela do jogo da vers√£o portada: O </font></font><br>
<img src="https://habrastorage.org/files/4f0/798/b1f/4f0798b1ff524bcab9d1a8039ccd8473.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BK-0010 √© um computador dom√©stico do final dos anos 80 e in√≠cio dos anos 90 e parcialmente um computador escolar (classes KUVT-86). </font><font style="vertical-align: inherit;">UKSC √© um computador escolar dos anos 90. </font><font style="vertical-align: inherit;">BC e UKSC s√£o parcialmente compat√≠veis em arquitetura e sistema de comando - ambos os computadores remontam √† fam√≠lia PDP-11.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sele√ß√£o de jogo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At√© este ano, eu n√£o escrevia nada s√©rio no UKSC, mas tinha que entender o c√≥digo da m√°quina. </font><font style="vertical-align: inherit;">Havia um desejo de escrever algo, mas geralmente tenho grandes problemas com o tempo livre, por isso dificilmente funcionaria do zero. </font><font style="vertical-align: inherit;">E para iniciantes, √© melhor facilitar a tarefa. </font><font style="vertical-align: inherit;">Ao portar, a quantidade de trabalho geralmente √© muito menor do que ao escrever do zero - voc√™ encontra principalmente problemas de incompatibilidade entre os dois sistemas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No f√≥rum zx.pk.ru (um dos sites em que os f√£s de retrocomputa√ß√£o em geral e as m√°quinas compat√≠veis com PDP-11 em particular participam), o participante do hobot </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elogiou a implementa√ß√£o do Lode Runner no BC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - esse foi realmente o motivo: para come√ßar, tentei "olhar" o c√≥digo do brinquedo , bem, se envolveu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menu da vers√£o original:</font></font><br>
<img src="https://habrastorage.org/files/8ba/13b/271/8ba13b271f1c441e9f561d6dd4998e0b.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A tela do jogo da vers√£o original (no monitor colorido):</font></font><br>
<img src="https://habrastorage.org/files/e7a/798/d50/e7a798d5016f47129bc81b51ddfa59bb.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Engenharia reversa</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algumas semanas √† noite e nos fins de semana, passei um tempo analisando e desmontando. </font><font style="vertical-align: inherit;">No </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">emulador, o BKBTL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adicionou a capacidade de coletar </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">um rastreamento</font></a><font style="vertical-align: inherit;"> - ou seja, cada instru√ß√£o √© desmontada e salva em um arquivo de texto. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu fa√ßo uma execu√ß√£o da se√ß√£o que me interessa em registrar o rastreio, depois desligo o rastreio (sort &amp; uniq) - recebo fragmentos da l√≥gica. </font><font style="vertical-align: inherit;">Eu adiciono coment√°rios a isso, gradualmente recebo um arquivo comum.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece simples, mas, na verdade, √© um trabalho bastante complicado, baseado em conjecturas e sua confirma√ß√£o ou refuta√ß√£o. Por exemplo, observamos que o endere√ßo 001756 antes do in√≠cio do jogo recebe o valor 10 e, em seguida, √© decrementado, quando chega a 0, o jogo termina - aparentemente esse √© o n√∫mero de vidas. Encontramos confirma√ß√£o disso, colocamos coment√°rios no texto em que esse endere√ßo ocorre. Este √© um exemplo bastante simples: em casos mais complexos, passei muito tempo descobrindo o que estava acontecendo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando o volume recebido se tornou bastante grande (mais de 40 KB de texto, mais de 1.500 linhas) e eu descobri pelo menos em termos gerais o que estava acontecendo, como ele era armazenado e exibido - comecei a pensar em como traduzi-lo para o UKSC. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui voc√™ pode ver a lista final resultante da desmontagem:</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/nzeemin/uknc-loderunner/blob/master/original/loderunner.lst</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Labirinto</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada labirinto √© de 20 linhas de 30 blocos, um total de 600 blocos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O tipo de bloco √© codificado por um n√∫mero de 0 a 7 - tr√™s bits, tripleto. </font><font style="vertical-align: inherit;">Para uma palavra de 16 bits, s√£o obtidos 5 trig√™meos completos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao trabalhar com m√°quinas do tipo PDP-11, um sistema com 8 casas decimais √© amplamente utilizado, portanto, √© bastante conveniente usar trig√™meos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, cada labirinto se encaixa em 240 bytes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tipos de bloco:</font></font><br>
<pre><code class="hljs haskell">;	<span class="hljs-number">0</span> <span class="hljs-comment">-- </span>
;	<span class="hljs-number">1</span> <span class="hljs-comment">--  </span>
;	<span class="hljs-number">2</span> <span class="hljs-comment">--  </span>
;	<span class="hljs-number">3</span> <span class="hljs-comment">-- </span>
;	<span class="hljs-number">4</span> <span class="hljs-comment">-- </span>
;	<span class="hljs-number">5</span> <span class="hljs-comment">-- </span>
;	<span class="hljs-number">6</span> <span class="hljs-comment">-- </span>
;	<span class="hljs-number">7</span> <span class="hljs-comment">-- </span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os sprites desses objetos s√£o organizados na ordem de numera√ß√£o dos tipos de bloco. </font><font style="vertical-align: inherit;">Quando um labirinto √© decodificado, ao mesmo tempo, uma "imagem de labirinto" √© criada na mem√≥ria (por byte por bloco) e o estado inicial do labirinto √© desenhado na tela.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organiza√ß√£o da tela</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No BC, a tela √© endere√ßada diretamente acessando a mem√≥ria, as linhas v√£o uma ap√≥s a outra, na verdade, √© um "framebuffer", e eu diria que est√° tudo bem - √© muito conveniente para programar gr√°ficos. Linha BC - 256 pixels coloridos, 64 bytes por linha. Mas quantos pixels em uma fileira dependem de como voc√™ conectou o monitor: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
se estiver em preto e branco, ser√£o 512 pb / p em uma fileira (1 bit por pixel, 8 pixels por byte) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
e se √© para sa√≠da em cores , s√£o 256 pixels em cores por linha (2 bits por pixel, 4 pixels por byte).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No UKSC, a organiza√ß√£o da tela √© completamente diferente e muito mais complicada. </font><font style="vertical-align: inherit;">A tela est√° em tr√™s blocos de mem√≥ria, tr√™s "planos". </font><font style="vertical-align: inherit;">E cada pixel tem tr√™s bits, um pouco em cada plano - temos 8 cores. </font><font style="vertical-align: inherit;">No UKSC, temos v√°rios modos de v√≠deo - 640 √ó 288, 320 √ó 288, 160 √ó 288, mais precisamente, sempre temos exatamente 288 linhas e voc√™ pode aplicar seu pr√≥prio divisor a cada linha individual, obtendo diferentes resolu√ß√µes horizontais. </font><font style="vertical-align: inherit;">Para a unidade central de processamento (CPU), os planos de tela n√£o s√£o acess√≠veis diretamente, apenas atrav√©s do acesso √†s portas. </font><font style="vertical-align: inherit;">Al√©m disso, apenas dois de tr√™s planos est√£o dispon√≠veis para a CPU. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse caso, o modo 320 √ó 288 me serviu bem - a linha √© obtida em 320 pixels coloridos de 80 bytes de comprimento em cada um dos tr√™s planos. </font><font style="vertical-align: inherit;">Se voc√™ usar dois planos, os pixels tamb√©m ter√£o quatro cores - quase como em um BC.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S√≠ntese</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ele come√ßou a escrever exemplos na montadora da UKSC e ficou um pouco deprimido - porque o ciclo "compilado - vinculado - lan√ßado" √© bastante lento. O problema est√° nas ferramentas. H√° um MACRO11 de assembler cruzado, embora seja um pouco buggy. Mas n√£o h√° cross-linker. Mas, felizmente, h√° pouco tempo, a Patron postou o console RT-11: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zx-pk.ru/showthread.php?t=24755</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - na verdade, √© um emulador de uma m√°quina compat√≠vel com PDP11 que interage com a linha de comando do SO, como em um terminal. Assim, tornou-se poss√≠vel compilar e vincular os meios nativos do RT-11. Isso eu considero um avan√ßo real, acelerou bastante o trabalho.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois disso, as coisas correram bem, fiz um desenho do quadro de campo de jogo, renderizando sprites, descobri como misturar os bits nos sprites (escrevi um programa em C # para mistur√°-los) e, em blocos, comecei a transferir o c√≥digo do arquivo compartilhado com desasma para as novas fontes. Peguei um despejo de mem√≥ria do BC, aloquei um bloco onde est√£o os n√≠veis, o utilit√°rio RT11 DUMP fez um livro did√°tico para os n√≠veis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, transferi um bloco de c√≥digo que exibe o n√≠vel e depurei a sa√≠da de sprites. Ent√£o ele come√ßou a transferir a l√≥gica do jogo. Essa. em geral, a transfer√™ncia √© quase individual, com exce√ß√£o dos locais onde a tela √© exibida. Portanto, h√° lugares na l√≥gica em que eu n√£o entendo como eles funcionam (o mesmo inferno da IA), mas isso n√£o importa - o principal √© que eles funcionam. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, no in√≠cio de maio (quando o trabalho principal me absorveu novamente), uma op√ß√£o de trabalho foi obtida, embora sem som.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Foto de um jogo de trabalho em uma m√°quina real (obrigado hobot):</font></font><br>
<img src="https://habrastorage.org/files/08e/a17/867/08ea17867ee7451794d3f5c7d099c698.jpg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Refer√™ncias</font></font></h3><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zx-pk.ru/showthread.php?t=24886</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - t√≥pico sobre este t√≥pico em zx.pk.ru</font></font></li>
</ul></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt383497/">https://habr.com/ru/post/pt383497/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt383485/index.html">The Void: um parque de divers√µes em realidade virtual</a></li>
<li><a href="../pt383489/index.html">Plataforma musical SoundCloud atacada por detentores de direitos autorais</a></li>
<li><a href="../pt383491/index.html">Um servidor em nuvem na Holanda e nos EUA por at√© 2 meses √© gratuito para usu√°rios registrados</a></li>
<li><a href="../pt383493/index.html">Peti√ß√£o para conceder aos cidad√£os o direito de distribuir independentemente seus pr√≥prios impostos</a></li>
<li><a href="../pt383495/index.html">Sobreviv√™ncia na R√∫ssia. ‚ÄúHuskies, republica√ß√µes, tweets: como n√£o violar a legisla√ß√£o anti-extremista‚Äù</a></li>
<li><a href="../pt383499/index.html">Entalhe est√° passando por tempos dif√≠ceis</a></li>
<li><a href="../pt383501/index.html">Nos Estados Unidos, lan√ßou um experimento para simular um v√¥o para Marte com dura√ß√£o de 365 dias</a></li>
<li><a href="../pt383503/index.html">Fotoc√©lulas de perovskita: cinco gramas por metro quadrado</a></li>
<li><a href="../pt383505/index.html">EJTAG: atra√ß√£o para hackers-2</a></li>
<li><a href="../pt383507/index.html">Projetos da Base Lunar: Hist√≥ria</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>