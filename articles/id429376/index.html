<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßúüèª üë©üèø‚Äçüç≥ üõ©Ô∏è Hemat sebagai API ISTIRAHAT üíê üöü üë®‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Artikel singkat tentang bagaimana kami mengalami masalah sinkronisasi pekerjaan antara tim pengembangan klien dan server. Bagaimana kami menghubungkan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hemat sebagai API ISTIRAHAT</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429376/"> Artikel singkat tentang bagaimana kami mengalami masalah sinkronisasi pekerjaan antara tim pengembangan klien dan server.  Bagaimana kami menghubungkan Thrift untuk menyederhanakan interaksi antara tim kami. <br><br>  Siapa yang peduli bagaimana kita melakukan ini, dan apa efek "samping" yang kita tangkap, silakan lihat di bawah kucing <br><a name="habracut"></a><br><h4>  Latar belakang </h4><br>  Pada awal 2017, ketika kami memulai proyek baru, kami memilih EmberJS sebagai frontend.  Yang, hampir secara otomatis membuat kami bekerja pada skema REST ketika mengatur interaksi bagian klien dan server aplikasi.  Karena  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">EmberData</a> menyediakan alat yang mudah digunakan untuk memisahkan pekerjaan perintah backend dan frontend, dan menggunakan Adaptor memungkinkan Anda untuk memilih "protokol" interaksi. <br><br>  Pada awalnya, semuanya baik-baik saja - Ember memberi kami kemampuan untuk mengimplementasikan emulasi permintaan server.  Data untuk meniru model server dimasukkan ke file-file terpisah.  Jika, di suatu tempat, kami mulai bekerja tanpa menggunakan Data Ember, maka Ember memungkinkan Anda untuk menulis emulator pengendali titik akhir terdekat dan mengembalikan data ini.  Kami memiliki perjanjian bahwa pengembang backend harus membuat perubahan pada file-file ini untuk menjaga agar data tetap mutakhir agar pengembang frontend berfungsi dengan benar.  Tapi seperti biasa, ketika semuanya dibangun di atas "perjanjian" (dan tidak ada alat untuk memverifikasi mereka), ada saatnya ketika "ada sesuatu yang salah." <br>  Persyaratan baru tidak hanya memunculkan tampilan data baru pada klien, tetapi juga memperbarui model data lama.  Yang pada akhirnya menyebabkan fakta bahwa menjaga sinkronisasi model pada server dan emulasi dalam file sumber klien menjadi sangat mahal.  Sekarang, pengembangan bagian klien, sebagai aturan, dimulai setelah rintisan server siap.  Dan pengembangan dilakukan di atas server produksi, dan ini mempersulit kerja tim dan meningkatkan waktu rilis fungsi baru. <br><br><h4>  Pengembangan proyek </h4><br>  Sekarang kami meninggalkan EmberJS demi VueJS.  dan sebagai bagian dari keputusan tentang migrasi, kami mulai mencari solusi untuk masalah ini.  Kriteria berikut dikembangkan: <br><br><ul><li>  Kompatibilitas dengan versi protokol yang lebih lama dan lebih baru </li><li>  Kenyamanan maksimal untuk pengembang frontend saat bekerja "tanpa server" </li><li>  Pemisahan deskripsi API dari data uji </li><li>  Sinkronisasi tanda tangan panggilan mudah <ul><li>  deskripsi tanda tangan yang jelas </li><li>  kemudahan modifikasi oleh pengembang frontend dan backend </li><li>  otonomi maksimum </li></ul></li><li>  API yang diketik dengan baik sangat diinginkan.  Yaitu  deteksi tercepat dari fakta perubahan protokol </li><li>  Kemudahan pengujian logika server </li><li>  Integrasi dengan Spring di sisi server tanpa menari dengan rebana. </li></ul><br><h4>  Implementasi </h4><br>  Setelah berpikir, diputuskan untuk berhenti di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Thrift</a> .  Ini memberi kami bahasa deskripsi API yang sederhana dan jelas. <br><br><pre><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> java ru.company.api <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> php ru.company.api <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> javascrip ru.company.api <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> DIRECTORY_SERVICE= <span class="hljs-string"><span class="hljs-string">"directoryService"</span></span> exception ObjectNotFoundException{ } struct AdvBreed { <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> id, <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> name, <span class="hljs-number"><span class="hljs-number">3</span></span>: optional <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> title } service DirectoryService { <span class="hljs-built_in"><span class="hljs-built_in">list</span></span>&lt;AdvBreed&gt; loadBreeds() AdsBreed getAdvBreedById(<span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> id) }</code> </pre> <br>  Untuk interaksi, kami menggunakan TMultiplexedProcessor, dapat diakses melalui TServlet, menggunakan TJSONProtocol.  Saya harus berdansa sedikit untuk membuat Thrift ini berintegrasi dengan Spring.  Untuk melakukan ini, saya harus membuat dan mendaftarkan Servlet di ServletContainer secara terprogram. <br><br><pre> <code class="hljs kotlin"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ThriftRegister</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ContextRefreshedEvent</span></span></span><span class="hljs-class">&gt;, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ApplicationContextAware</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ServletContextAware { companion object { private const val unsecureAreaUrlPattern = "/api/v2/thrift-ns" private const val secureAreaUrlPattern = "/api/v2/thrift" } private var inited = false private lateinit var appContext:ApplicationContext private lateinit var servletContext:ServletContext override fun onApplicationEvent</span></span></span></span>(event: ContextRefreshedEvent) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!inited) { initServletsAndFilters() inited = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initServletsAndFilters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { registerOpenAreaServletAndFilter() registerSecureAreaServletAndFilter() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registerSecureAreaServletAndFilter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { registerServletAndFilter(SecureAreaServlet::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SecureAreaThriftFilter::class.java</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">secureAreaUrlPattern) } private fun registerOpenAreaServletAndFilter</span></span></span></span>() { registerServletAndFilter(UnsecureAreaServlet::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UnsecureAreaThriftFilter::class.java</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">unsecureAreaUrlPattern) } private fun registerServletAndFilter</span></span></span></span>(servletClass:Class&lt;<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> Servlet&gt;, filterClass:Class&lt;<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> Filter&gt;, pattern:String) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> servletBean = appContext.getBean(servletClass) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> addServlet = servletContext.addServlet(servletClass.simpleName, servletBean) addServlet.setLoadOnStartup(<span class="hljs-number"><span class="hljs-number">1</span></span>) addServlet.addMapping(pattern) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> filterBean = appContext.getBean(filterClass) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> addFilter = servletContext.addFilter(filterClass.simpleName, filterBean) addFilter.addMappingForUrlPatterns(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, pattern) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setApplicationContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(applicationContext: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ApplicationContext</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { appContext = applicationContext } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setServletContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ServletContext</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.servletContext = context } }</code> </pre> <br>  Apa yang harus diperhatikan di sini.  Dalam kode ini, dua area layanan terbentuk.  Terlindungi, yang tersedia di alamat "/ api / v2 / penghematan".  Dan terbuka, tersedia di "/ api / v2 / thrift-ns".  Untuk area ini, berbagai filter digunakan.  Dalam kasus pertama, ketika mengakses layanan dengan cookie, objek dibentuk yang mendefinisikan pengguna yang membuat panggilan.  Jika tidak mungkin untuk membentuk objek seperti itu, kesalahan 401 dilemparkan, yang diproses dengan benar di sisi klien.  Dalam kasus kedua, filter melewatkan semua permintaan untuk layanan, dan jika itu menentukan bahwa otorisasi telah terjadi, maka setelah operasi selesai, itu mengisi cookie dengan informasi yang diperlukan sehingga dapat membuat permintaan ke area yang dilindungi. <br><br>  Untuk menghubungkan layanan baru, Anda harus menulis sedikit kode tambahan. <br><br><pre> <code class="hljs delphi">@Component <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> DirectoryServiceProcessor @Autowired <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(handler: DirectoryService.Iface)</span></span></span><span class="hljs-function">:</span></span> DirectoryService.Processor&lt;DirectoryService.Iface&gt;(handler)</code> </pre> <br>  Dan daftarkan prosesor <br><br><pre> <code class="hljs delphi">@Component <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> SecureMultiplexingProcessor @Autowired <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dsProcessor: DirectoryServiceProcessor)</span></span></span><span class="hljs-function"> :</span></span> TMultiplexedProcessor() <span class="hljs-comment"><span class="hljs-comment">{ init { this.registerProcessor(DIRECTORY_SERVICE, dsProcessor) ... }</span></span> }</code> </pre> <br>  Bagian terakhir dari kode dapat disederhanakan dengan menggantung antarmuka tambahan pada semua prosesor, yang akan memungkinkan Anda untuk segera mendapatkan daftar prosesor dengan satu parameter desainer, dan telah memberikan tanggung jawab untuk nilai kunci akses ke prosesor ke prosesor itu sendiri. <br><br>  Bekerja dalam mode "tidak ada server" telah mengalami sedikit perubahan.  Pengembang bagian frontend membuat proposal bahwa mereka akan bekerja pada server rintisan PHP.  Mereka sendiri menghasilkan kelas untuk server mereka yang mengimplementasikan tanda tangan untuk versi protokol yang diinginkan.  Dan mereka mengimplementasikan server dengan set data yang diperlukan.  Semua ini memungkinkan mereka untuk bekerja sebelum pengembang sisi server menyelesaikan pekerjaan mereka. <br><br>  Titik pemrosesan utama di sisi klien adalah penghematan-plugin yang ditulis oleh kami. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> store <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../store'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { UNAUTHORIZED } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../store/actions/auth'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> thrift = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'thrift'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { install (Vue, options) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DirectoryService = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./gen-nodejs/DirectoryService'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> _options = { <span class="hljs-attr"><span class="hljs-attr">transport</span></span>: thrift.TBufferedTransport, <span class="hljs-attr"><span class="hljs-attr">protocol</span></span>: thrift.TJSONProtocol, <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">'/api/v2/thrift'</span></span>, <span class="hljs-attr"><span class="hljs-attr">https</span></span>: location.protocol === <span class="hljs-string"><span class="hljs-string">'https:'</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> _optionsOpen = { ... } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> XHRConnectionError = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_status</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_status === <span class="hljs-number"><span class="hljs-number">0</span></span>) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_status &gt;= <span class="hljs-number"><span class="hljs-number">400</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_status === <span class="hljs-number"><span class="hljs-number">401</span></span>) { store.dispatch(UNAUTHORIZED) } ... } } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bufers = {} thrift.XHRConnection.prototype.flush = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.url === <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.url === <span class="hljs-string"><span class="hljs-string">''</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.send_buf } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xreq = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getXmlHttpRequestObject() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xreq.overrideMimeType) { xreq.overrideMimeType(<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>) } xreq.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.readyState === <span class="hljs-number"><span class="hljs-number">4</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.status === <span class="hljs-number"><span class="hljs-number">200</span></span>) { self.setRecvBuffer(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.status === <span class="hljs-number"><span class="hljs-number">404</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.status &gt;= <span class="hljs-number"><span class="hljs-number">500</span></span>) {... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {... } } } } xreq.open(<span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.headers).forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">headerKey</span></span></span><span class="hljs-function">) </span></span>{ xreq.setRequestHeader(headerKey, self.headers[headerKey]) }) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (process.env.NODE_ENV === <span class="hljs-string"><span class="hljs-string">'development'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sendBuf = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.send_buf) bufers[sendBuf[<span class="hljs-number"><span class="hljs-number">3</span></span>]] = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.send_buf xreq.seqid = sendBuf[<span class="hljs-number"><span class="hljs-number">3</span></span>] } xreq.send(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.send_buf) } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> thrift.Multiplexer() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> connectionHostName = process.env.THRIFT_HOST ? process.env.THRIFT_HOST : location.hostname <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> connectionPort = process.env.THRIFT_PORT ? process.env.THRIFT_PORT : location.port <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> connection = thrift.createXHRConnection(connectionHostName, connectionPort, _options) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> connectionOpen = thrift.createXHRConnection(connectionHostName, connectionPort, _optionsOpen) Vue.prototype.$ThriftPlugin = { <span class="hljs-attr"><span class="hljs-attr">DirectoryService</span></span>: mp.createClient(<span class="hljs-string"><span class="hljs-string">'directoryService'</span></span>, DirectoryService, connectionOpen), } } }</code> </pre> <br>  Agar plugin ini berfungsi dengan benar, Anda harus menghubungkan kelas-kelas yang dihasilkan. <br><br>  Metode panggilan server pada klien adalah sebagai berikut: <br><br><pre> <code class="javascript hljs">thriftPlugin.DirectoryService.loadBreeds() .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_response</span></span></span><span class="hljs-function"> =&gt;</span></span> { ... }) .catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> { ... }) })</code> </pre><br>  Di sini saya tidak mempelajari fitur VueJS itu sendiri, di mana sudah benar untuk menjaga kode yang memanggil server.  Kode ini dapat digunakan baik di dalam komponen dan di dalam rute dan di dalam Vuex-action. <br>  Ketika bekerja dengan sisi klien, ada beberapa batasan yang harus diperhitungkan setelah migrasi mental dari integrasi penghematan internal. <br><br><ul><li>  Klien Javascript tidak mengenali nilai null.  Oleh karena itu, untuk bidang yang bisa nol, Anda harus menentukan bendera opsional.  Dalam hal ini, klien akan menerima nilai ini dengan benar. </li><li>  Javascript tidak tahu cara bekerja dengan nilai yang panjang, jadi semua pengidentifikasi integer harus dilemparkan ke string di sisi server </li></ul><br><h4>  Kesimpulan </h4><br>  Transisi ke Thrift memungkinkan kami untuk memecahkan masalah yang ada dalam interaksi antara pengembangan server dan klien saat bekerja pada versi antarmuka yang lama.  Diizinkan untuk memungkinkan pemrosesan kesalahan global di satu tempat. <br><br>  Pada saat yang sama, dengan bonus tambahan, karena pengetikan API yang ketat, dan oleh karena itu aturan ketat untuk serialisasi / deserialisasi data, kami menerima peningkatan ~ 30% pada saat interaksi pada klien dan server untuk sebagian besar permintaan (ketika membandingkan permintaan yang sama melalui interaksi REST dan THRIFT, dari saat permintaan dikirim ke server hingga respons diterima) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id429376/">https://habr.com/ru/post/id429376/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id429362/index.html">Pembelajaran mesin berbahaya sebagai metode diagnostik</a></li>
<li><a href="../id429364/index.html">Lembah Silikon mulai membentuk konsensus suram pada anak-anak dan layar</a></li>
<li><a href="../id429366/index.html">Cara membuat mesin waktu untuk radio</a></li>
<li><a href="../id429368/index.html">Anda Mengharapkan Terlalu Banyak Dari Robot Boston Dynamics</a></li>
<li><a href="../id429370/index.html">Bagaimana Google Night Sight Bekerja di Ponsel dan Mengapa Itu Bekerja Dengan Baik</a></li>
<li><a href="../id429380/index.html">Untuk mengganti TCP: QUIC siap untuk implementasi [tetapi tidak siap untuk menjadi RFC]</a></li>
<li><a href="../id429382/index.html">Dari Alibaba ke Pyaterochka: siapa dan bagaimana menggunakan sistem pengenalan wajah dalam bisnis</a></li>
<li><a href="../id429384/index.html">Komponen Sepeda Listrik: Motor</a></li>
<li><a href="../id429386/index.html">Penyedia AT&T Menjadi Pemegang Hak Cipta Terbesar dan Akan Mulai Memutuskan Pengguna yang Dituduh Pembajakan</a></li>
<li><a href="../id429388/index.html">Cara membuat desain ulang situs web dan tidak membuat masalah: 4 langkah penting</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>