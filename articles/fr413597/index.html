<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçü§ù‚Äçüë®üèº üë©üèΩ‚Äçü§ù‚Äçüë®üèæ ü§∞üèæ ¬´Dernier recours¬ª ou pourquoi la premi√®re conception de la base de donn√©es est n√©cessaire üè™ ‚ÄºÔ∏è üåæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article tr√®s r√©cent, j'expliquerai pourquoi, √† mon avis, dans la plupart des cas, lors du d√©veloppement d'un mod√®le de donn√©es pour une appli...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>¬´Dernier recours¬ª ou pourquoi la premi√®re conception de la base de donn√©es est n√©cessaire</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413597/"><p>  Dans cet article tr√®s r√©cent, j'expliquerai pourquoi, √† mon avis, dans la plupart des cas, lors du d√©veloppement d'un mod√®le de donn√©es pour une application, vous devez suivre la premi√®re approche de la base de donn√©es.  Au lieu de l'approche ¬´Java [tout autre langage] d'abord¬ª, qui vous emm√®ne sur une longue piste pleine de douleur et de souffrance, d√®s que le projet commence √† grandir. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/2ae/fcf/aaf/2aefcfaafbeb94adc7a73ec265b5feb1.png" alt="image"><br>  <em>"Trop occup√© pour √™tre meilleur" <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sous licence CC</a> par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Alan O'Rourke / Audience Stack</a> .</em>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Image originale</a></em> <em><br></em> </p><a name="habracut"></a><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cet article est inspir√© d'une r√©cente question sur StackOverflow</a> . </p><br><p>  Discussions reddit int√©ressantes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">/ r / java</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">/ r / programmation</a> . </p><br><h2 id="kodogeneraciya">  G√©n√©ration de code </h2><br><p>  √Ä ma grande surprise, un petit groupe d'utilisateurs semble avoir √©t√© choqu√© par le fait que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">jOOQ est</a> fortement li√© √† la g√©n√©ration de code source. </p><br><p>  Bien que vous puissiez utiliser jOOQ exactement comme vous le souhaitez, la mani√®re pr√©f√©r√©e (selon la documentation) est de commencer avec le sch√©ma de base de donn√©es existant, puis de g√©n√©rer les classes clientes n√©cessaires (correspondant √† vos tables) √† l'aide de jOOQ, et apr√®s cela, il est facile d'√©crire en toute s√©curit√© requ√™tes pour ces tables: </p><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Record2&lt;String, String&gt; record : DSL.using(configuration) <span class="hljs-comment"><span class="hljs-comment">// ^^^^^^^^^^^^^^^^^^^^^^^ Type information derived from the // generated code referenced from the below SELECT clause .select(ACTOR.FIRST_NAME, ACTOR.LAST_NAME) // vvvvv ^^^^^^^^^^^^ ^^^^^^^^^^^^^^^ Generated names .from(ACTOR) .orderBy(1, 2)) { // ... }</span></span></code> </pre> <br><p>  Le code peut √™tre g√©n√©r√© soit manuellement en dehors de l'assembly, soit automatiquement avec chaque assembly.  Par exemple, une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">telle g√©n√©ration peut se produire imm√©diatement apr√®s l'installation des migrations Flyway</a> , qui peuvent √©galement √™tre d√©marr√©es manuellement ou automatiquement. </p><br><h3 id="generaciya-ishodnogo-koda">  G√©n√©ration de code source </h3><br><p>  Il existe diff√©rentes philosophies, avantages et inconv√©nients concernant ces approches de g√©n√©ration de code que je ne veux pas aborder dans cet article.  Mais en substance, la signification du code g√©n√©r√© est qu'il s'agit d'une repr√©sentation Java de ce que nous consid√©rons comme une sorte de "standard" (√† l'int√©rieur et √† l'ext√©rieur de notre syst√®me).  D'une certaine mani√®re, les compilateurs font la m√™me chose lorsqu'ils g√©n√®rent du bytecode, du code machine ou un autre code source √† partir de la source - en cons√©quence, nous avons une id√©e de notre ¬´standard¬ª dans un autre langage sp√©cifique. </p><br><p>  Il existe de nombreux g√©n√©rateurs de code.  Par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">XJC peut g√©n√©rer du code Java √† partir de fichiers XSD ou WSDL</a> .  Le principe est toujours le m√™me: </p><br><ul><li>  Il existe des normes (externes ou internes), telles que les sp√©cifications, le mod√®le de donn√©es, etc. </li><li>  Il est n√©cessaire de se faire une id√©e de cette norme dans notre langage de programmation habituel. </li></ul><br><p>  Et presque toujours, il est logique de <em>g√©n√©rer</em> cette vue afin d'√©viter un travail inutile et des erreurs inutiles. </p><br><h3 id="type-providers-i-obrabotka-annotaciy">  Fournisseurs de type et traitement des annotations </h3><br><p>  Il est √† noter qu'une autre approche, plus moderne, de la g√©n√©ration de code dans jOOQ est les fournisseurs de type ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">comme cela se fait en F #</a> ), o√π le code est g√©n√©r√© par le compilateur pendant la compilation et n'existe jamais sous sa forme originale.  Un outil similaire (mais moins sophistiqu√©) en Java est les processeurs d'annotation tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lombok</a> . </p><br><p>  Dans les deux cas, tout est identique √† la g√©n√©ration de code normale, sauf: </p><br><ul><li>  Vous ne voyez pas le code g√©n√©r√© (peut-√™tre pour beaucoup, c'est un gros plus?) </li><li>  Vous devez vous assurer que votre ¬´r√©f√©rence¬ª est disponible √† chaque compilation.  Cela ne pose aucun probl√®me dans le cas de Lombok, qui annote directement le code source lui-m√™me, qui est le "standard" dans ce cas.  Un peu plus compliqu√© avec les mod√®les de base de donn√©es qui reposent sur une connexion en direct toujours active. </li></ul><br><h2 id="v-chem-problema-s-generaciey-koda">  Quel est le probl√®me avec la g√©n√©ration de code? </h2><br><p>  Outre la question d√©licate de savoir s'il faut g√©n√©rer le code manuellement ou automatiquement, certaines personnes pensent que le code n'a pas du tout besoin d'√™tre g√©n√©r√©.  La raison pour laquelle j'entends le plus souvent est qu'une telle g√©n√©ration est difficile √† impl√©menter dans le pipeline CI / CD.  Et oui, c'est vrai, car  nous obtenons des frais g√©n√©raux pour cr√©er et prendre en charge une infrastructure suppl√©mentaire, surtout si vous √™tes nouveau dans les outils utilis√©s (jOOQ, JAXB, Hibernate, etc.). </p><br><p>  Si les frais g√©n√©raux li√©s √† l'√©tude du g√©n√©rateur de code sont trop √©lev√©s, il y aura vraiment peu d'avantages.  Mais c'est le seul argument contre.  Dans la plupart des autres cas, cela n'a absolument aucun sens d'√©crire manuellement du code, qui est la repr√©sentation habituelle d'un mod√®le de quelque chose. </p><br><p>  Beaucoup de gens affirment qu‚Äôils n‚Äôont pas le temps pour cela, car  en ce moment, vous devez d√©ployer un autre MVP d√®s que possible.  Et ils pourront finaliser leur pipeline CI / CD un peu plus tard.  Dans de tels cas, je dis g√©n√©ralement: "Vous √™tes trop occup√© pour aller mieux". </p><br><h2 id="no-ved-hibernatejpa-delaet-java-first-razrabotku-gorazdo-prosche">  "Mais Hibernate / JPA facilite beaucoup le premier d√©veloppement Java." </h2><br><p>  Oui c'est vrai.  C'est √† la fois une joie et une douleur pour les utilisateurs d'Hibernate.  Avec lui, vous pouvez simplement √©crire plusieurs objets du formulaire: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Book</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id; String title; }</code> </pre> <br><p>  Et c'est presque fini.  Ensuite, Hibernate se chargera de toute la routine sur la fa√ßon de d√©finir cet objet en DDL et dans le dialecte SQL souhait√©: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> book ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GENERATED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALWAYS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, title <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> pk_book PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> i_book_title <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> book (title);</code> </pre> <br><p>  C'est vraiment un excellent moyen de d√©marrer rapidement le d√©veloppement - il vous suffit de d√©marrer l'application. </p><br><p>  Mais tout n'est pas si rose.  Il y a encore beaucoup de questions: </p><br><ul><li>  Hibernate g√©n√©rera-t-il le nom dont j'ai besoin pour la cl√© primaire? </li><li>  Vais-je cr√©er l'index dont j'ai besoin dans le champ TITLE? </li><li>  Une valeur d'ID unique sera-t-elle g√©n√©r√©e pour chaque enregistrement? </li></ul><br><p>  Il semble que non.  Mais pendant que le projet est en cours de d√©veloppement, vous pouvez toujours jeter votre base de donn√©es actuelle et tout g√©n√©rer √† partir de z√©ro en ajoutant les annotations n√©cessaires au mod√®le. <br>  Ainsi, la classe de livre dans sa forme finale ressemblera √† ceci: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"book"</span></span>, indexes = { <span class="hljs-meta"><span class="hljs-meta">@Index</span></span>(name = <span class="hljs-string"><span class="hljs-string">"i_book_title"</span></span>, columnList = <span class="hljs-string"><span class="hljs-string">"title"</span></span>) }) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Book</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>(strategy = IDENTITY) <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id; String title; }</code> </pre> <br><h2 id="no-vy-zaplatite-za-eto-chut-pozzhe">  Mais tu paieras pour √ßa, un peu plus tard </h2><br><p>  T√¥t ou tard, votre application entre en production et le sch√©ma d√©crit cessera de fonctionner: </p><br><blockquote>  Dans un syst√®me vivant et r√©el, vous ne pouvez plus simplement r√©cup√©rer et d√©poser votre base de donn√©es, car  les donn√©es y sont utilis√©es et peuvent co√ªter beaucoup d'argent. </blockquote><p>  √Ä partir de maintenant, vous devez √©crire des scripts de migration pour chaque changement dans le mod√®le de donn√©es, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">par exemple, en utilisant Flyway</a> .  Mais qu'advient-il de vos classes clientes?  Vous pouvez soit les adapter manuellement (ce qui entra√Ænera un double travail), soit demander √† Hibernate de les g√©n√©rer (mais quelle est la probabilit√© que les r√©sultats d'une telle g√©n√©ration r√©pondent aux attentes?).  En cons√©quence, vous pouvez vous attendre √† de gros probl√®mes. </p><br><p>  D√®s que le code entre en production, il est presque imm√©diatement n√©cessaire d'apporter des corrections, et le plus rapidement possible. </p><br><p>  Et parce que  l'installation des migrations de base de donn√©es n'est pas int√©gr√©e √† votre cha√Æne de montage; vous devrez installer ces correctifs manuellement √† vos risques et p√©rils.  Il n'y aura pas assez de temps pour revenir en arri√®re et tout faire correctement.  Il suffit de bl√¢mer Hibernate pour tous ses ennuis. </p><br><p>  Au lieu de cela, vous auriez pu agir diff√©remment d√®s le d√©part.  √Ä savoir, utilisez des roues rondes au lieu de celles carr√©es. </p><br><h2 id="vpered-k-database-first">  Allez d'abord √† la base de donn√©es </h2><br><p>  La r√©f√©rence et le contr√¥le du sch√©ma de donn√©es se trouvent dans le bureau de votre SGBD.  Une base de donn√©es est le seul endroit o√π un sch√©ma est d√©fini, et tous les clients ont une <em>copie de</em> ce sch√©ma, mais pas l'inverse.  Les donn√©es sont dans votre base de donn√©es, et non dans votre client, il est donc logique de fournir un contr√¥le du sch√©ma et de son int√©grit√© exactement o√π les donn√©es se trouvent. </p><br><p>  C'est de la vieille sagesse, rien de nouveau.  Les cl√©s primaires et uniques sont bonnes.  Les cl√©s √©trang√®res sont belles.  La v√©rification des contraintes c√¥t√© base de donn√©es est formidable.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les assertions (quand elles sont finalement impl√©ment√©es) sont</a> g√©niales. </p><br><p>  Et ce n'est pas tout.  Par exemple, si vous utilisez Oracle, vous pouvez sp√©cifier: </p><br><ul><li>  Dans quel espace de table se trouve votre table? </li><li>  Quelle est la signification de PCTFREE qu'elle a </li><li>  Quelle est la taille du cache de s√©quence? </li></ul><br><p>  Peut-√™tre que tout cela n'a pas d'importance sur les petits syst√®mes, mais sur les syst√®mes plus grands, vous n'avez pas √† suivre le chemin du ¬´big data¬ª jusqu'√† ce que vous extrayiez tous les jus de votre stockage actuel.  Pas un seul ORM que j'ai jamais vu (y compris jOOQ) ne vous permettra d'utiliser l'ensemble complet des param√®tres DDL fournis par votre SGBD.  Les ORM ne proposent que quelques outils pour vous aider √† √©crire DDL. </p><br><p>  En fin de compte, un sch√©ma bien con√ßu ne doit √™tre √©crit que manuellement √† l'aide d'un DDL sp√©cifique au SGBD.  Tous les DDL g√©n√©r√©s automatiquement ne sont qu'une approximation de cela. </p><br><h2 id="chto-naschet-klientskoy-modeli">  Et le mod√®le client? </h2><br><p>  Comme mentionn√© pr√©c√©demment, vous aurez besoin d'une certaine repr√©sentation du sch√©ma de base de donn√©es c√¥t√© client.  Il va sans dire que cette vue doit √™tre synchronis√©e avec le mod√®le r√©el.  Comment faire  Bien s√ªr, en utilisant des g√©n√©rateurs de code. </p><br><p>  Toutes les bases de donn√©es donnent acc√®s √† leurs m√©ta-informations via le bon vieux SQL.  Ainsi, par exemple, vous pouvez obtenir une liste de toutes les tables de diff√©rentes bases de donn√©es: </p><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- H2, HSQLDB, MySQL, PostgreSQL, SQL Server SELECT table_schema, table_name FROM information_schema.tables -- DB2 SELECT tabschema, tabname FROM syscat.tables -- Oracle SELECT owner, table_name FROM all_tables -- SQLite SELECT name FROM sqlite_master -- Teradata SELECT databasename, tablename FROM dbc.tables</span></span></code> </pre> <br><p>  Ce sont ces requ√™tes (ainsi que les requ√™tes similaires pour les vues, les vues mat√©rialis√©es et les fonctions de table) qui sont ex√©cut√©es lorsque la m√©thode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DatabaseMetaData.getTables ()</a> d'un pilote JDBC sp√©cifique est appel√©e, ou dans le module jOOQ-meta. </p><br><p>  √Ä partir des r√©sultats de ces requ√™tes, il est relativement facile de cr√©er une repr√©sentation client du mod√®le de base de donn√©es, quelle que soit la technologie d'acc√®s aux donn√©es utilis√©e. </p><br><ul><li>  Si vous utilisez JDBC ou Spring, vous pouvez cr√©er un groupe de constantes String </li><li>  Si vous utilisez JPA, vous pouvez cr√©er des objets vous-m√™me </li><li>  Si vous utilisez jOOQ, vous pouvez cr√©er des m√©tamod√®les jOOQ </li></ul><br><p>  Selon le nombre de fonctionnalit√©s offertes par votre API d'acc√®s aux donn√©es (jOOQ, JPA ou autre), le m√©tamod√®le g√©n√©r√© peut √™tre vraiment riche et complet.  Par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la fonction de jointure implicite dans jOOQ 3.11, qui repose sur des m√©ta-informations sur les relations des cl√©s √©trang√®res entre vos tables</a> . </p><br><p>  D√©sormais, toute modification du sch√©ma de base de donn√©es entra√Ænera automatiquement une mise √† jour du code client. </p><br><p>  Imaginez que vous deviez renommer une colonne dans un tableau: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> book <span class="hljs-keyword"><span class="hljs-keyword">RENAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> title <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> book_title;</code> </pre> <br><p>  Voulez-vous vraiment effectuer ce travail deux fois?  Pas question.  Validez simplement ce DDL, ex√©cutez la g√©n√©ration et profitez de l'objet mis √† jour: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"book"</span></span>, indexes = { <span class="hljs-comment"><span class="hljs-comment">// Would you have thought of this? @Index(name = "i_book_title", columnList = "book_title") }) class Book { @Id @GeneratedValue(strategy = IDENTITY) int id; @Column("book_title") String **bookTitle**; }</span></span></code> </pre> <br><p>  De plus, le client re√ßu n'a pas besoin d'√™tre compil√© √† chaque fois (au moins jusqu'√† la prochaine modification du sch√©ma de base de donn√©es), ce qui peut d√©j√† √™tre un gros plus! <br>  La plupart des modifications DDL sont √©galement des modifications s√©mantiques, pas seulement syntaxiques.  Ainsi, il est formidable de voir dans le code client g√©n√©r√© quels sont exactement les derniers changements dans la base de donn√©es affect√©s. </p><br><h2 id="pravda-vsegda-odna">  La v√©rit√© est toujours seule </h2><br><p>  Quelle que soit la technologie que vous utilisez, il ne doit y avoir qu'un seul mod√®le, qui est la norme pour le sous-syst√®me.  Ou, du moins, nous devons nous efforcer de le faire et √©viter la confusion dans les affaires, o√π la ¬´norme¬ª est partout et nulle part en m√™me temps.  Cela rend tout beaucoup plus facile.  Par exemple, si vous partagez des fichiers XML avec un autre syst√®me, vous utilisez probablement XSD.  En tant que m√©tamod√®le INFORMATION_SCHEMA jOOQ au format XML: <a href="">https://www.jooq.org/xsd/jooq-meta-3.10.0.xsd</a> </p><br><ul><li>  XSD est bien compris </li><li>  XSD d√©crit parfaitement le contenu XML et permet la validation dans toutes les langues du client </li><li>  XSD rend la gestion des versions facile et r√©trocompatible </li><li>  XSD peut √™tre transform√© en code Java √† l'aide de XJC </li></ul><br><p>  Nous accordons une attention particuli√®re au dernier point.  Lors de la communication avec un syst√®me externe via des messages XML, nous devons √™tre s√ªrs de la validit√© des messages.  Et c'est vraiment tr√®s facile √† faire avec des choses comme JAXB, XJC et XSD.  Il serait fou de penser √† la pertinence de l'approche Java-first dans ce cas.  Le XML g√©n√©r√© √† partir des objets XML sera de mauvaise qualit√©, mal document√© et difficile √† √©tendre.  Et s'il existe un SLA pour une telle interaction, vous serez d√©√ßu. </p><br><p>  Honn√™tement, cela ressemble √† ce qui se passe avec les diff√©rentes API JSON maintenant, mais c'est une histoire compl√®tement diff√©rente ... </p><br><h3 id="chem-bazy-dannyh-huzhe">  Qu'est-ce qui aggrave les bases de donn√©es? </h3><br><p>  Lorsque vous travaillez avec une base de donn√©es, tout est identique ici.  La base de donn√©es est propri√©taire des donn√©es et doit √©galement √™tre le ma√Ætre du sch√©ma de donn√©es.  Toutes les modifications de sch√©ma doivent √™tre effectu√©es directement via DDL pour mettre √† jour la r√©f√©rence. </p><br><p>  Apr√®s avoir mis √† jour la r√©f√©rence, tous les clients doivent mettre √† jour leurs id√©es sur le mod√®le.  Certains clients peuvent √™tre √©crits en Java √† l'aide de jOOQ et / ou Hibernate ou JDBC.  D'autres clients peuvent √™tre √©crits en Perl (bonne chance √† eux) ou m√™me en C #.  Ce n'est pas grave.  Le mod√®le principal est dans la base de donn√©es.  Bien que les mod√®les cr√©√©s √† l'aide d'ORM soient de mauvaise qualit√©, peu document√©s et difficiles √† √©tendre. </p><br><p>  Par cons√©quent, ne faites pas cela, et depuis le tout d√©but du d√©veloppement.  Commencez plut√¥t avec une base de donn√©es.  Cr√©ez un pipeline CI / CD automatis√©.  Utilisez la g√©n√©ration de code pour g√©n√©rer automatiquement un mod√®le de base de donn√©es pour les clients pour chaque g√©n√©ration.  Et arr√™tez de vous inqui√©ter, tout ira bien.  Tout ce qui est requis est un petit effort initial pour mettre en place l'infrastructure, mais vous obtiendrez ainsi un gain dans le processus de d√©veloppement pour le reste de votre projet pour les ann√©es √† venir. </p><br><p>  Non merci. </p><br><h2 id="poyasneniya">  Explications </h2><br><p>  Pour consolider: cet article ne pr√©tend en aucun cas que le mod√®le de base de donn√©es doit s'appliquer √† l'ensemble de votre syst√®me (domaine, logique m√©tier, etc.).  Mes d√©clarations consistent uniquement dans le fait que le code client interagissant avec la base de donn√©es ne doit √™tre qu'une <em>repr√©sentation</em> du sch√©ma de la base de donn√©es, mais pas le d√©finir et le former de quelque mani√®re que ce soit. </p><br><p>  Dans les architectures √† deux niveaux qui ont encore leur place, le sch√©ma de base de donn√©es peut √™tre la seule source d'informations sur le mod√®le de votre syst√®me.  Cependant, sur la plupart des syst√®mes, je vois le niveau d'acc√®s aux donn√©es comme un ¬´sous-syst√®me¬ª qui encapsule un mod√®le de base de donn√©es.  Quelque chose comme √ßa. </p><br><h2 id="isklyucheniya">  Exceptions </h2><br><p>  Comme dans toute autre bonne r√®gle, la n√¥tre a √©galement ses exceptions (et j'ai d√©j√† averti que la premi√®re approche de la base de donn√©es et la g√©n√©ration de code ne sont pas toujours le bon choix).  Ces exceptions (la liste n'est peut-√™tre pas compl√®te): </p><br><ul><li>  Lorsque le circuit n'est pas connu √† l'avance et doit √™tre √©tudi√©.  Par exemple, vous √™tes un fournisseur d'un outil pour aider les utilisateurs √† naviguer dans n'importe quel sch√©ma.  Bien s√ªr, il ne peut y avoir de g√©n√©ration de code.  Mais dans tous les cas, vous devez g√©rer la base de donn√©es elle-m√™me et son sch√©ma. </li><li>  Lorsque pour une t√¢che, vous devez cr√©er un sch√©ma √† la vol√©e.  Cela peut √™tre similaire √† l'une des variantes du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mod√®le Entit√©-attribut-valeur</a> , comme  vous n'avez pas de mod√®le clairement d√©fini.  De plus, rien ne garantit que le SGBDR dans ce cas est le bon choix. </li></ul><br><p>  La particularit√© de ces exceptions est qu'elles se rencontrent rarement dans la faune.  Dans la plupart des cas, lors de l'utilisation de bases de donn√©es relationnelles, le sch√©ma est connu √† l'avance et constitue la ¬´norme¬ª de votre mod√®le, et les clients doivent travailler avec une copie de ce mod√®le g√©n√©r√©e √† l'aide de g√©n√©rateurs de code. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413597/">https://habr.com/ru/post/fr413597/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr413585/index.html">Collaboration Hansen: bonne ou rien (partie 2)</a></li>
<li><a href="../fr413587/index.html">√âvaluation de la couverture de test d'un projet Java en utilisant Apache Ignite comme exemple</a></li>
<li><a href="../fr413589/index.html">Revue de code: exp√©rience r√©ussie</a></li>
<li><a href="../fr413591/index.html">Robotique industrielle - 57 ans! Rappelez-vous d'o√π vient le d√©compte</a></li>
<li><a href="../fr413593/index.html">Continuer √† conqu√©rir le fond de la mer. Microsoft et son projet de centre de donn√©es sous-marin Natick 2</a></li>
<li><a href="../fr413599/index.html">Il y a S.L.O.N.a en plusieurs parties. Introduisez ITAM et ne vous √©touffez pas</a></li>
<li><a href="../fr413601/index.html">Le centre de donn√©es de Microsoft chauffe-t-il la mer</a></li>
<li><a href="../fr413603/index.html">G√©n√©ration de code dans Uber</a></li>
<li><a href="../fr413605/index.html">Demandez √† Ethan: que se passe-t-il lorsqu'une √©toile traverse le syst√®me solaire?</a></li>
<li><a href="../fr413607/index.html">Fintech digest: les monnaies num√©riques ne menacent pas le syst√®me financier de la F√©d√©ration de Russie; PayPal a d√©couvert combien les joueurs d√©pensent pour les jeux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>