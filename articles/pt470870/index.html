<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèä üåÉ üèá Pr√©-carregando fontes üóëÔ∏è üöµ üë©üèª‚Äçüéì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O autor do artigo, cuja tradu√ß√£o estamos publicando hoje, quer falar sobre por que ele pr√©-carrega as fontes, mesmo quando n√£o deveria. 
  
 Quando el...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pr√©-carregando fontes</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/470870/">  O autor do artigo, cuja tradu√ß√£o estamos publicando hoje, quer falar sobre por que ele pr√©-carrega as fontes, mesmo quando n√£o deveria. <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/2r/jy/xq/2rjyxqifqzb06x5rhh1zj-y28ao.png"></a> <br>  Quando ele criou o site no qual o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">original</a> deste material foi publicado, ele n√£o usaria nenhuma de suas pr√≥prias fontes nele.  Isso afetaria inevitavelmente o desempenho do site, embora n√£o muito.  O autor do artigo diz que se esfor√ßou para criar um site r√°pido.  No entanto, no final, foi decidido usar uma fonte especial para os t√≠tulos das p√°ginas e, ao mesmo tempo, tentar fazer com que essa solu√ß√£o o menos poss√≠vel afetasse o desempenho do projeto. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Introdu√ß√£o</font> </h2><br>  Para come√ßar, decidi tornar o arquivo da fonte o menor poss√≠vel.  Ent√£o, eu criei um subconjunto dessa fonte.  Em outras palavras, selecionei na fonte apenas os caracteres necess√°rios para as palavras no t√≠tulo. <br><br>  Como resultado, recebi um arquivo muito compacto, cujo tamanho era inferior a 2 Kb.  Al√©m disso, coloquei-o no mesmo local que todos os outros materiais do site, o que me permitiu livrar-me das depend√™ncias de terceiros e do tempo gasto na conex√£o com outro dom√≠nio. <br><br>  E, finalmente, o link para o arquivo de fonte foi colocado no c√≥digo CSS incorporado na p√°gina, na parte superior do c√≥digo HTML, e n√£o no arquivo CSS externo. <br><br>  Isso significa que o navegador pode detectar e baixar o arquivo de fonte sem precisar baixar uma folha de estilo externa.  A prop√≥sito, esse √© um motivo comum pelo qual as fontes s√£o carregadas depois do necess√°rio. <br><br><h2>  <font color="#3AC1EF">Surpresa</font> </h2><br>  Como fontes especiais s√£o necess√°rias para a exibi√ß√£o de texto, o navegador deve trat√°-las como recursos de alta prioridade. <br><br>  Como resultado, eu esperava que o arquivo da fonte fosse carregado muito rapidamente.  As p√°ginas do meu recurso eram, de qualquer forma, bastante "leves", ent√£o pensei que nada deveria impedir o carregamento do arquivo da fonte. <br><br>  Quando analisei o site, fiquei um pouco chocado. <br><br>  Ent√£o, olhando o site usando as ferramentas de desenvolvedor do Chrome e examinando-o no Webpagetest, descobri que a fonte de alta prioridade foi carregada ap√≥s as imagens - recursos de baixa prioridade. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a9e/b69/42b/a9eb6942be47a8350a3419a54e7382ef.png"></div><br>  <i><font color="#999999">As imagens s√£o baixadas antes do download da fonte</font></i> <br><br>  Pareceu-me um absurdo completo. <br><br>  Eu tinha certeza de que o navegador, antes de baixar a fonte, pode esperar at√© descobrir que a fonte √© necess√°ria para exibir a p√°gina.  Mas o elemento em que minha fonte foi usada estava localizado na parte superior da p√°gina, dentro da <code>&lt;header&gt;</code> , muito maior do que as tags com imagens que foram carregadas antes do download da fonte.  O elemento correspondente foi localizado n√£o apenas no c√≥digo da p√°gina, mas tamb√©m na √°rvore do DOM. <br><br><h2>  <font color="#3AC1EF">Pr√©-carregando fontes como uma solu√ß√£o para o problema</font> </h2><br>  O atributo <code>preload</code> informa ao navegador que ele precisa pr√©-carregar o recurso correspondente necess√°rio para exibir a p√°gina atual. <br><br>  O uso desse atributo √© uma boa maneira de fazer o download antecipado de recursos importantes que seriam descobertos pelo navegador posteriormente. <br><br>  Arquivos de fonte s√£o um √≥timo exemplo de uso desse mecanismo.  Se o link para o arquivo de fonte for criado em uma folha de estilos externa, o navegador n√£o detectar√° a fonte at√© que ela seja carregada. <br><br>  O uso do atributo <code>preload</code> aplicado a arquivos de fonte informa ao navegador que ele precisar√° das fontes apropriadas quando exibir a p√°gina. <br>  Al√©m disso, esse mecanismo √© muito f√°cil de implementar usando o elemento <code>&lt;link&gt;</code> . <br><br><pre> <code class="plaintext hljs">&lt;link rel="preload" href="myfont.woff2" as="font" type="font/woff2" crossorigin&gt;</code> </pre> <br>  Como alternativa, voc√™ pode adicionar uma diretiva de pr√©-carregamento ao cabe√ßalho da resposta (embora, a menos que seja especificado de outra forma, alguns servidores ou CDNs podem interpretar esse design como uma solicita√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.cloudflare.com/website-optimization/">iniciada pelo servidor</a> para transferir recursos para o cliente). <br><br>  Eu n√£o esperava que neste site eu tivesse que usar mecanismos de pr√©-carregamento de recursos.  Meu c√≥digo CSS √© muito modesto, eu o integrei no c√≥digo HTML da p√°gina, para que as p√°ginas sejam exibidas mais rapidamente pelos navegadores na primeira visita ao site.  Como minha fonte n√£o dependia do carregamento de um arquivo CSS externo, o navegador, em qualquer caso, deveria detect√°-lo muito cedo e sem "dicas" sobre o pr√©-carregamento. <br><br>  No entanto, descobri que o pr√©-carregamento da fonte levou √† restaura√ß√£o da justi√ßa, ao fato de que o arquivo da fonte estava carregado agora antes do download dos arquivos de imagem. <br><br>  Aqui est√° o diagrama em cascata da Webpagetest - destaquei os lugares onde o trabalho com o arquivo de fonte √© mostrado.  Na parte superior da figura, a pr√©-carga n√£o √© usada.  No fundo - usado. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b8c/d2e/789/b8cd2e789c21ffe4d26175ef0bbd1711.png"></div><br>  <i><font color="#999999">Pr√©-carregando e trabalhando com o arquivo de fonte.</font></i> <br><br>  Talvez seja mais √∫til considerar o storyboard do processo de carregamento da p√°gina (aqui, para maior clareza, foi usada uma imita√ß√£o de uma conex√£o muito lenta). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/451/efc/532/451efc532263db4aa64740322d011bef.png"></div><br>  <i><font color="#999999">No storyboard superior, o pr√©-carregamento n√£o √© usado.</font></i>  <i><font color="#999999">No fundo - usado</font></i> <br><br>  De passagem, notei que usei o identificador de <code>font-display: fallback</code> .  Ou seja, o t√≠tulo foi exibido originalmente usando a fonte de backup, caso minha fonte seja carregada lentamente.  No entanto, para este teste, desativei esse recurso, pois, caso contr√°rio, seria muito dif√≠cil distinguir entre as etapas de carregamento da p√°gina. <br><br><h2>  <font color="#3AC1EF">Por que funcionou?</font> </h2><br>  Para exibir uma p√°gina da web, o navegador precisa criar a √°rvore DOM e a √°rvore CSSOM, que s√£o usadas posteriormente para construir a √°rvore de renderiza√ß√£o. <br><br>  <code>preload</code> que o uso do elemento <code>&lt;link&gt;</code> com o atributo <code>preload</code> para baixar a fonte permite que o navegador comece a criar CSSOM antes da conclus√£o do DOM. <br><br>  Voc√™ pode ver isso nas imagens a seguir, que mostram uma explora√ß√£o do processo de carregamento da p√°gina usando as ferramentas de desenvolvedor do Chrome. <br><br>  Veja como √© o trabalho com materiais de p√°gina sem usar a pr√©-carga.  Primeiro, o DOM √© criado e a imagem √© carregada, o CSSOM √© criado e a fonte √© carregada. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/70e/d87/be1/70ed87be14271c5d93563d18161eaba7.png"></div><br>  <i><font color="#999999">Trabalhar com a p√°gina sem usar o pr√©-carregamento</font></i> <br><br>  E aqui √© o mesmo, mas com o uso de pr√©-carregamento.  Aqui, o navegador come√ßa a criar CSSOM, inicia o download da fonte e, em seguida, cria o DOM e inicia o download das imagens. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c75/ea3/101/c75ea31011fe25c4527c7b6c64f86b2e.png"></div><br>  <i><font color="#999999">Trabalhando com a p√°gina usando pr√©-carregamento</font></i> <br><br><h2>  <font color="#3AC1EF">Existem alternativas para pr√©-carregamento?</font> </h2><br>  Suponha que eu n√£o possa usar o atributo <code>preload</code> para aumentar a prioridade do arquivo de fonte.  O que eu poderia fazer ent√£o?  Como voc√™ pode diminuir a prioridade das imagens? <br><br>  Por curiosidade, tentei implementar a id√©ia acima e adicionei o atributo <code>loading="lazy"</code> aos elementos que descrevem as imagens.  No Chrome 76 (o √∫nico navegador que suportava isso no momento da reda√ß√£o), isso teria que diminuir a prioridade das imagens fora da √°rea vis√≠vel original da p√°gina. <br><br>  Testar essa id√©ia com ferramentas de desenvolvedor mostrou que isso faz com que as fontes sejam baixadas anteriormente.  Talvez isso deva ser lembrado, pois o n√≠vel de suporte do navegador a mecanismos de carregamento lento est√° aumentando com o tempo. <br><br><h2>  <font color="#3AC1EF">Navegadores diferentes se comportam de maneira diferente</font> </h2><br>  Testei o projeto em v√°rios navegadores diferentes e em v√°rios dispositivos.  Nos testes, descobri que o iOS Safari (iPhone 8) mostra o mesmo comportamento do Chrome.  Nomeadamente, as fontes, por padr√£o, s√£o carregadas ap√≥s as imagens, mas o uso do atributo <code>preload</code> permite corrigir a situa√ß√£o. <br><br>  O problema do carregamento tardio de fontes tamb√©m ocorreu no Firefox, mas o atributo <code>preload</code> ainda n√£o √© suportado por este navegador por padr√£o, portanto, o uso do atributo <code>preload</code> ao exibir um site no Firefox n√£o mudou nada. <br><br>  No Edge, as fontes tamb√©m s√£o carregadas depois do desejado.  Havia um sentimento de que o uso do Webload Pagetest usando o atributo <code>preload</code> apenas funcionou parcialmente.  Ou seja, parecia-me que parecia um download de fonte dupla.  Uma vez carregado anteriormente, a segunda vez depois. <br><br>  No par√°grafo anterior, falei sobre o fato de que "tive uma sensa√ß√£o" e que "parecia".  O fato √© que, quando tentei testar esse comportamento usando minha pr√≥pria vers√£o do Edge, os downloads "duplos" desapareceram.  Agora, tive a sensa√ß√£o de que o uso do atributo <code>preload</code> n√£o acelera o carregamento da fonte.  Talvez essa diferen√ßa no comportamento da p√°gina tenha resultado da corre√ß√£o de algum erro no Edge, embora, nesse caso, o erro tenha sido corrigido com o custo de alterar o mecanismo de pr√©-carregamento de recursos. <br><br><h2>  <font color="#3AC1EF">Sum√°rio</font> </h2><br>  Aqui falamos sobre por que o pr√©-carregamento de fontes n√£o prejudica, mesmo que os links para seus arquivos sejam feitos no c√≥digo CSS incorporado na p√°gina. <br><br>  Os navegadores nem sempre se comportam como queremos ou como esperamos.  Mas temos ferramentas que ajudam a influenciar o comportamento dos navegadores, a orient√°-los na dire√ß√£o que precisamos. <br><br>  Eu costumava pensar que pr√©-carregar fontes no meu site √© completamente in√∫til.  Com tudo o que falei, aprendi uma li√ß√£o importante para mim.  Consiste no fato de que voc√™ nunca deve assumir nada. <br><br>  No final, posso dizer que o pr√©-carregamento de fontes √© uma √≥tima maneira de acelerar a sa√≠da de texto nas p√°ginas da web. <br><br>  <b>Caros leitores!</b>  Voc√™ usa mecanismos de pr√©-carregamento de fontes em seus projetos da web? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/-o/2e/tu/-o2etuqogwhmdnmysb9_vivc9v4.png"></a> </div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt470870/">https://habr.com/ru/post/pt470870/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt470852/index.html">Processando 40 TB de c√≥digo de 10 milh√µes de projetos em um servidor dedicado com Go por US $ 100</a></li>
<li><a href="../pt470856/index.html">Telegram GRAM Wallet: termos de servi√ßo</a></li>
<li><a href="../pt470858/index.html">Antiguidades: Refer√™ncia do 386¬∫ processador e dos anos 90</a></li>
<li><a href="../pt470864/index.html">Sobre as del√≠cias de mudar para o painel e n√£o apenas</a></li>
<li><a href="../pt470868/index.html">Hora do primeiro byte: o que √© e por que √© importante</a></li>
<li><a href="../pt470872/index.html">M√©tricas de desempenho para pesquisar aplicativos da Web incrivelmente r√°pidos</a></li>
<li><a href="../pt470874/index.html">Otimizando o carregamento do JavaScript na Wikipedia</a></li>
<li><a href="../pt470876/index.html">Crie constru√ß√µes de sintaxe JavaScript personalizadas usando Babel. Parte 1</a></li>
<li><a href="../pt470878/index.html">Crie constru√ß√µes de sintaxe JavaScript personalizadas usando Babel. Parte 2</a></li>
<li><a href="../pt470880/index.html">Mec√¢nica de jogo. Aventura, o conceito de zero e terapia da fala convincente</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>