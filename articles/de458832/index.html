<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÅ‚Äçüó® üÜò üëÑ F√ºnf Studenten und drei verteilte Schl√ºsselwertspeicher üßëüèº üòê üóΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Oder wie wir die Client-C ++ - Bibliothek f√ºr ZooKeeper, etcd und Consul KV geschrieben haben 
 In der Welt der verteilten Systeme gibt es eine Reihe ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>F√ºnf Studenten und drei verteilte Schl√ºsselwertspeicher</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458832/"><h2>  Oder wie wir die Client-C ++ - Bibliothek f√ºr ZooKeeper, etcd und Consul KV geschrieben haben </h2><br>  In der Welt der verteilten Systeme gibt es eine Reihe typischer Aufgaben: Speichern von Informationen √ºber die Zusammensetzung des Clusters, Verwalten der Konfiguration von Knoten, Erkennen fehlerhafter Knoten, Ausw√§hlen eines Leiters <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">und andere</a> .  Um diese Probleme zu l√∂sen, wurden spezielle verteilte Systeme geschaffen - Koordinierungsdienste.  Jetzt werden wir uns f√ºr drei davon interessieren: ZooKeeper, etcd und Consul.  Von allen umfangreichen Funktionen von Consul werden wir uns auf Consul KV konzentrieren. <br><br><img src="https://habrastorage.org/webt/j2/ut/gh/j2utghbsb8egpxnz1ct4k3dqtbk.jpeg"><br><br>  Tats√§chlich sind alle diese Systeme fehlertolerante linearisierte Schl√ºsselwertspeicher.  Obwohl ihre Datenmodelle signifikante Unterschiede aufweisen, die wir sp√§ter diskutieren werden, erm√∂glichen sie uns, dieselben praktischen Probleme zu l√∂sen.  Offensichtlich ist jede Anwendung, die den Koordinierungsdienst verwendet, an eine von ihnen gebunden, was dazu f√ºhren kann, dass mehrere Systeme unterst√ºtzt werden m√ºssen, die dieselben Aufgaben in einem Rechenzentrum f√ºr verschiedene Anwendungen l√∂sen. <br><br>  Die Idee zur L√∂sung dieses Problems entstand in einer australischen Beratungsagentur, und wir, ein kleines Team von Studenten, mussten sie umsetzen, wor√ºber ich Ihnen erz√§hlen werde. <br><a name="habracut"></a><br>  Wir konnten eine Bibliothek erstellen, die eine gemeinsame Schnittstelle f√ºr die Arbeit mit ZooKeeper, etcd und Consul KV bietet.  Die Bibliothek ist in C ++ geschrieben, es ist jedoch geplant, sie in andere Sprachen zu portieren. <br><br><h3>  Datenmodelle </h3><br>  Um eine gemeinsame Schnittstelle f√ºr drei verschiedene Systeme zu entwickeln, m√ºssen Sie verstehen, was sie gemeinsam haben und wie sie sich unterscheiden.  Lass es uns richtig machen. <br><br>  <b>Tierpfleger</b> <br><br><img src="https://habrastorage.org/webt/dv/7g/bu/dv7gbu5u-rvvg91d7qukhgfs1xg.png"><br><br>  Schl√ºssel sind in einem Baum organisiert und werden als Knoten (znodes) bezeichnet.  Dementsprechend k√∂nnen Sie f√ºr die Website eine Liste seiner Kinder erhalten.  Die Vorg√§nge zum Erstellen von znode (create) und zum √Ñndern des Werts (setData) sind getrennt: Nur vorhandene Schl√ºssel k√∂nnen Werte lesen und √§ndern.  Uhren k√∂nnen an Vorg√§nge angeh√§ngt werden, bei denen die Existenz eines Knotens √ºberpr√ºft, ein Wert gelesen und untergeordnete Elemente abgerufen werden.  Watch ist ein einmaliger Ausl√∂ser, der ausgel√∂st wird, wenn sich die Version der entsprechenden Daten auf dem Server √§ndert.  Ephemere Knoten werden verwendet, um Fehler zu erkennen.  Sie sind an die Sitzung des Clients angeh√§ngt, der sie erstellt hat.  Wenn ein Client eine Sitzung schlie√üt oder ZooKeeper nicht mehr √ºber seine Existenz informiert, werden diese Knoten automatisch gel√∂scht.  Es werden einfache Transaktionen unterst√ºtzt - eine Reihe von Vorg√§ngen, die entweder alle erfolgreich sind oder fehlschlagen, wenn mindestens einer davon nicht m√∂glich ist. <br><br>  <b>etcd</b> <br><br><img src="https://habrastorage.org/webt/at/hg/me/athgmezjwbafkvetueuq7ytewdc.png"><br><br>  Die Entwickler dieses Systems waren eindeutig von ZooKeeper inspiriert und haben daher alles anders gemacht.  Die Schl√ºsselhierarchie ist nicht hier, aber sie bilden eine lexikographisch geordnete Menge.  Sie k√∂nnen alle Schl√ºssel abrufen oder l√∂schen, die zu einem bestimmten Bereich geh√∂ren.  Eine solche Struktur mag seltsam erscheinen, ist aber tats√§chlich sehr ausdrucksstark, und die hierarchische Sichtweise durch sie l√§sst sich leicht emulieren. <br><br>  Es gibt keine Standard-Vergleichs- und Set-Operation in etcd, aber es gibt etwas Besseres - Transaktionen.  Nat√ºrlich sind sie in allen drei Systemen vorhanden, aber in etcd sind Transaktionen besonders gut.  Sie bestehen aus drei Bl√∂cken: Pr√ºfung, Erfolg, Misserfolg.  Der erste Block enth√§lt eine Reihe von Bedingungen, die zweite und dritte Operation.  Eine Transaktion wird atomar ausgef√ºhrt.  Wenn alle Bedingungen erf√ºllt sind, wird der Erfolgsblock ausgef√ºhrt, andernfalls - Fehler.  In API-Version 3.3 k√∂nnen Erfolgs- und Fehlerbl√∂cke verschachtelte Transaktionen enthalten.  Das hei√üt, es ist m√∂glich, bedingte Konstruktionen einer nahezu willk√ºrlichen Verschachtelungsebene atomar auszuf√ºhren.  Weitere Informationen zu den vorhandenen √úberpr√ºfungen und Vorg√§ngen finden Sie in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> . <br><br>  Auch hier gibt es Uhren, die jedoch etwas komplexer und wiederverwendbarer sind.  Das hei√üt, nachdem Sie watch auf einer Reihe von Tasten installiert haben, erhalten Sie alle Updates in diesem Bereich, bis Sie die Uhr abbrechen, und nicht nur die erste.  In etcd entsprechen Leases ZooKeeper-Client-Sitzungen. <br><br>  <b>Konsul KV</b> <br><br>  Es gibt auch keine strenge hierarchische Struktur, aber Consul kann das Erscheinungsbild erstellen, das es gibt: Sie k√∂nnen alle Schl√ºssel mit dem angegebenen Pr√§fix empfangen und l√∂schen, dh mit dem "Teilbaum" des Schl√ºssels arbeiten.  Solche Abfragen werden als rekursiv bezeichnet.  Dar√ºber hinaus kann Consul nur Schl√ºssel ausw√§hlen, die nicht das angegebene Zeichen nach dem Pr√§fix enthalten, was dem Empfang sofortiger ‚ÄûKinder‚Äú entspricht.  Es ist jedoch zu beachten, dass dies genau das Erscheinungsbild einer hierarchischen Struktur ist: Es ist durchaus m√∂glich, einen Schl√ºssel zu erstellen, wenn sein √ºbergeordnetes Element nicht vorhanden ist, oder einen Schl√ºssel mit untergeordneten Schl√ºsseln zu l√∂schen, w√§hrend die untergeordneten Elemente weiterhin im System gespeichert werden. <br><br><img src="https://habrastorage.org/webt/qq/mb/8t/qqmb8tupgbnod_6jm6andrhelrs.png"><br>  Anstelle von Uhren werden in Consul HTTP-Anforderungen blockiert.  Im Wesentlichen handelt es sich hierbei um gew√∂hnliche Aufrufe der Datenlesemethode, f√ºr die zusammen mit anderen Parametern die letzte bekannte Version der Daten angegeben wird.  Wenn die aktuelle Version der entsprechenden Daten auf dem Server gr√∂√üer als die angegebene ist, wird die Antwort sofort zur√ºckgegeben, andernfalls, wenn sich der Wert √§ndert.  Es gibt hier auch Sitzungen, die jederzeit an Schl√ºssel angeh√§ngt werden k√∂nnen.  Es ist erw√§hnenswert, dass es im Gegensatz zu etcd und ZooKeeper, wo das L√∂schen von Sitzungen zum Entfernen verwandter Schl√ºssel f√ºhrt, einen Modus gibt, in dem die Sitzung einfach von diesen getrennt wird.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Transaktionen</a> sind verf√ºgbar, ohne Verzweigung, aber mit allen Arten von Pr√ºfungen. <br><br><h3>  Bring alles zusammen </h3><br>  Das strengste Datenmodell ist ZooKeeper.  In etcd verf√ºgbare Expressive Range-Anforderungen k√∂nnen weder in ZooKeeper noch in Consul effizient emuliert werden.  Beim Versuch, das Beste aus allen Diensten herauszuholen, haben wir eine Schnittstelle erhalten, die fast der ZooKeeper-Schnittstelle entspricht, mit den folgenden wesentlichen Ausnahmen: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sequenz-, Container- und TTL-Knoten werden</a> nicht unterst√ºtzt </li><li>  ACLs werden nicht unterst√ºtzt </li><li>  Die set-Methode erstellt einen Schl√ºssel, wenn dieser nicht vorhanden war (in ZK gibt setData in diesem Fall einen Fehler zur√ºck). </li><li>  set- und cas-Methoden sind getrennt (in ZK sind sie im Wesentlichen dasselbe) </li><li>  Die L√∂schmethode l√∂scht den Scheitelpunkt zusammen mit dem Teilbaum (in ZK gibt delete einen Fehler zur√ºck, wenn der Scheitelpunkt untergeordnete Elemente hat). </li><li>  F√ºr jeden Schl√ºssel gibt es nur eine Version - die Version des Werts (in ZK <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gibt es drei davon</a> ) </li></ul><br>  Die Ablehnung von sequentiellen Knoten beruht auf der Tatsache, dass in etcd und Consul keine integrierte Unterst√ºtzung f√ºr sie vorhanden ist und dass sie zus√§tzlich zur resultierenden Bibliotheksschnittstelle vom Benutzer einfach implementiert werden k√∂nnen. <br><br>  Um dasselbe Verhalten beim Entfernen des obersten ZooKeeper zu implementieren, muss f√ºr jeden Schl√ºssel ein separater untergeordneter Z√§hler in etcd und Consul verwaltet werden.  Da wir versucht haben, das Speichern von Metainformationen zu vermeiden, wurde beschlossen, den gesamten Teilbaum zu l√∂schen. <br><br><h3>  Feinheiten der Umsetzung </h3><br>  Lassen Sie uns einige Aspekte der Implementierung der Bibliotheksschnittstelle in verschiedenen Systemen genauer betrachten. <br><br>  <b>Hierarchie in etcd</b> <br><br>  Die Aufrechterhaltung einer hierarchischen Ansicht in etcd war eine der interessantesten Aufgaben.  Bereichsanforderungen erleichtern das Abrufen einer Liste von Schl√ºsseln mit einem bestimmten Pr√§fix.  Wenn Sie beispielsweise alles m√∂chten, was mit <code>"/foo"</code> beginnt, fordern Sie den Bereich <code>["/foo", "/fop")</code> .  Dies w√ºrde jedoch den gesamten Teilbaum des Schl√ºssels zur√ºckgeben, was m√∂glicherweise nicht akzeptabel ist, wenn der Teilbaum gro√ü ist.  Zun√§chst wollten wir den <a href="">in zetcd implementierten Schl√ºsselkonvertierungsmechanismus verwenden</a> .  Dabei wird am Anfang des Schl√ºssels ein Byte hinzugef√ºgt, das der Tiefe des Knotens im Baum entspricht.  Ich werde ein Beispiel geben. <br><br><pre> <code class="plaintext hljs">"/foo" -&gt; "\u01/foo" "/foo/bar" -&gt; "\u02/foo/bar"</code> </pre> <br>  Dann k√∂nnen Sie alle unmittelbaren <code>["\u02/foo/", "\u02/foo0")</code> Taste <code>"/foo"</code> <code>["\u02/foo/", "\u02/foo0")</code> indem Sie den Bereich <code>["\u02/foo/", "\u02/foo0")</code> .  Ja, in ASCII folgt <code>"/"</code> <code>"0"</code> unmittelbar auf <code>"/"</code> . <br><br>  Aber wie l√∂scht man dann einen Scheitelpunkt?  Es stellt sich heraus, dass Sie alle Bereiche der Form <code>["\uXX/foo/", "\uXX/foo0")</code> f√ºr XX von 01 bis FF <code>["\uXX/foo/", "\uXX/foo0")</code> .  Und dann stie√üen wir auf ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Limit f√ºr die Anzahl der Vorg√§nge</a> innerhalb einer einzelnen Transaktion. <br><br>  Als Ergebnis wurde ein einfaches Schl√ºsselkonvertierungssystem erfunden, das es erm√∂glichte, sowohl das Entfernen des Schl√ºssels als auch den Empfang einer Liste von Kindern effektiv zu implementieren.  Es reicht aus, vor dem letzten Token ein spezielles Symbol hinzuzuf√ºgen.  Zum Beispiel: <br><br><pre> <code class="plaintext hljs">"/very" -&gt; "/\u00very" "/very/long" -&gt; "/very/\u00long" "/very/long/path" -&gt; "/very/long/\u00path"</code> </pre> <br>  <code>"/\u00very"</code> dann die Taste <code>"/very"</code> l√∂schen, werden <code>"/\u00very"</code> und der Bereich <code>["/very/", "/very0")</code> , und alle <code>["/very/", "/very0")</code> , Schl√ºssel aus dem Bereich <code>["/very/\u00", "/very/\u01")</code> . <br><br>  <b>Entfernen eines Schl√ºssels in ZooKeeper</b> <br><br>  Wie bereits erw√§hnt, k√∂nnen Sie in ZooKeeper einen Knoten nicht l√∂schen, wenn er untergeordnete Knoten hat.  Wir wollen den Schl√ºssel zusammen mit dem Teilbaum l√∂schen.  Wie man ist  Wir machen es optimistisch.  Zuerst durchlaufen wir den Teilbaum rekursiv und erhalten die untergeordneten Elemente jedes Scheitelpunkts in einer separaten Abfrage.  Dann erstellen wir eine Transaktion, die versucht, alle Knoten des Teilbaums in der richtigen Reihenfolge zu l√∂schen.  Nat√ºrlich k√∂nnen zwischen dem Lesen und L√∂schen eines Teilbaums √Ñnderungen auftreten.  In diesem Fall schl√§gt die Transaktion fehl.  Dar√ºber hinaus kann sich der Teilbaum w√§hrend des Lesevorgangs √§ndern.  Eine Abfrage f√ºr die untergeordneten Knoten des n√§chsten Knotens kann einen Fehler zur√ºckgeben, wenn beispielsweise dieser Scheitelpunkt bereits gel√∂scht wurde.  In beiden F√§llen wiederholen wir den gesamten Vorgang erneut. <br><br>  Dieser Ansatz macht das L√∂schen eines Schl√ºssels sehr unwirksam, wenn er untergeordnete Elemente hat, und noch mehr, wenn die Anwendung weiterhin mit dem Teilbaum arbeitet und Schl√ºssel l√∂scht und erstellt.  Dies erm√∂glichte es uns jedoch, die Implementierung anderer Methoden in etcd und Consul nicht zu erschweren. <br><br>  <b>in ZooKeeper eingestellt</b> <br><br>  In ZooKeeper gibt es separate Methoden, die mit der Baumstruktur (create, delete, getChildren) und mit Daten in Knoten (setData, getData) arbeiten. Dar√ºber hinaus haben alle Methoden strenge Voraussetzungen: create gibt einen Fehler zur√ºck, wenn der Knoten bereits erstellt, gel√∂scht oder setData - falls noch nicht vorhanden.  Wir brauchten die set-Methode, die aufgerufen werden kann, ohne √ºber den Schl√ºssel nachzudenken. <br><br>  Eine M√∂glichkeit besteht darin, einen optimistischen Ansatz wie beim L√∂schen anzuwenden.  √úberpr√ºfen Sie, ob der Knoten vorhanden ist.  Wenn vorhanden, rufen Sie setData auf, andernfalls erstellen Sie.  Wenn die letzte Methode einen Fehler zur√ºckgegeben hat, wiederholen Sie den Vorgang erneut.  Das erste, was zu beachten ist, ist die Sinnlosigkeit der Existenzpr√ºfung.  Sie k√∂nnen create sofort aufrufen.  Ein erfolgreicher Abschluss bedeutet, dass der Knoten nicht vorhanden war und erstellt wurde.  Andernfalls gibt create den entsprechenden Fehler zur√ºck, wonach setData aufgerufen werden muss.  Nat√ºrlich kann zwischen den Aufrufen der Scheitelpunkt durch einen konkurrierenden Aufruf entfernt werden, und setData gibt auch einen Fehler zur√ºck.  In diesem Fall k√∂nnen Sie alles noch einmal wiederholen, aber lohnt es sich? <br><br>  Wenn beide Methoden einen Fehler zur√ºckgegeben haben, wissen wir mit Sicherheit, dass eine konkurrierende L√∂schung stattgefunden hat.  Stellen Sie sich vor, diese L√∂schung erfolgte nach dem Aufruf von set.  Unabh√§ngig davon, welchen Wert wir zu ermitteln versuchen, wird er bereits gel√∂scht.  Sie k√∂nnen also davon ausgehen, dass das Set erfolgreich war, auch wenn tats√§chlich nichts geschrieben wurde. <br><br><h3>  Weitere technische Details </h3><br>  In diesem Abschnitt schweifen wir von verteilten Systemen ab und sprechen √ºber das Codieren. <br>  Eine der Hauptanforderungen des Kunden war plattform√ºbergreifend: Unter Linux, MacOS und Windows muss mindestens einer der Dienste unterst√ºtzt werden.  Anfangs haben wir die Entwicklung nur unter Linux durchgef√ºhrt, und in anderen Systemen haben wir sp√§ter mit dem Testen begonnen.  Dies verursachte viele Probleme, f√ºr die es einige Zeit v√∂llig unklar war, wie man vorgehen sollte.  Daher werden jetzt alle drei Koordinierungsdienste unter Linux und MacOS und nur Consul KV unter Windows unterst√ºtzt. <br><br>  Von Anfang an haben wir versucht, vorgefertigte Bibliotheken f√ºr den Zugriff auf Dienste zu verwenden.  Im Fall von ZooKeeper fiel die Wahl auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ZooKeeper C ++</a> , das am Ende unter Windows nicht kompiliert werden konnte.  Dies ist jedoch nicht √ºberraschend: Die Bibliothek ist nur unter Linux positioniert.  F√ºr Consul war <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ppconsul</a> die einzige Option.  Ich musste Unterst√ºtzung f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sitzungen</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Transaktionen</a> hinzuf√ºgen.  F√ºr etcd wurde nie eine vollwertige Bibliothek gefunden, die die neueste Version des Protokolls unterst√ºtzt. Daher haben wir nur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einen grpc-Client generiert</a> . <br><br>  Inspiriert von der asynchronen Schnittstelle der ZooKeeper C ++ - Bibliothek haben wir uns entschlossen, auch die asynchrone Schnittstelle zu implementieren.  In ZooKeeper C ++ werden hierf√ºr Future / Promise-Primitive verwendet.  In STL sind sie leider sehr bescheiden implementiert.  Beispielsweise gibt es keine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">then-Methode</a> , die die √ºbergebene Funktion auf das zuk√ºnftige Ergebnis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">anwendet</a> , sobald es verf√ºgbar ist.  In unserem Fall ist eine solche Methode erforderlich, um das Ergebnis in das Format unserer Bibliothek zu konvertieren.  Um dieses Problem zu umgehen, mussten wir unseren einfachen Thread-Pool implementieren, da wir auf Kundenwunsch keine umfangreichen Bibliotheken von Drittanbietern wie Boost verwenden konnten. <br><br>  Unsere Implementierung von funktioniert dann wie folgt.  Beim Aufruf wird ein zus√§tzliches Versprechen / zuk√ºnftiges Paar erstellt.  Die neue Zukunft wird zur√ºckgegeben, und die √ºbertragene wird zusammen mit der entsprechenden Funktion und einem zus√§tzlichen Versprechen in die Warteschlange gestellt.  Ein Thread aus dem Pool w√§hlt mehrere Futures aus der Warteschlange aus und fragt sie mit wait_for ab.  Wenn das Ergebnis verf√ºgbar ist, wird die entsprechende Funktion aufgerufen und ihr R√ºckgabewert an Versprechen √ºbergeben. <br><br>  Wir haben denselben Thread-Pool verwendet, um Anforderungen an etcd und Consul auszuf√ºhren.  Dies bedeutet, dass mehrere verschiedene Threads mit den zugrunde liegenden Bibliotheken arbeiten k√∂nnen.  ppconsul ist nicht threadsicher, daher sind Aufrufe durch Sperren durch Sperren gesch√ºtzt. <br>  Sie k√∂nnen mit grpc aus mehreren Threads arbeiten, aber es gibt Feinheiten.  Etcd-Uhren werden √ºber grpc-Streams implementiert.  Dies sind bidirektionale Kan√§le f√ºr bestimmte Arten von Nachrichten.  Die Bibliothek erstellt einen einzelnen Stream f√ºr alle Uhren und einen einzelnen Stream, der eingehende Nachrichten verarbeitet.  Daher verbietet grpc das Streamen paralleler Aufnahmen.  Dies bedeutet, dass Sie beim Initialisieren oder L√∂schen der Uhr warten m√ºssen, bis das Senden der vorherigen Anforderung abgeschlossen ist, bevor Sie die n√§chste senden.  Wir verwenden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bedingte Variablen</a> f√ºr die Synchronisation. <br><br><h3>  Zusammenfassung </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">√úberzeugen Sie sich</a> selbst: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">liboffkv</a> . <br><br>  Unser Team: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Raed Romanov</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ivan Glushenkov</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dmitry Kamaldinov</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Victor Krapivensky</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vitaly Ivanin</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de458832/">https://habr.com/ru/post/de458832/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de458818/index.html">Prominente Zeitgenossen</a></li>
<li><a href="../de458820/index.html">√úber die Implementierung des ber√ºhmten Genres auf der Minecraft-Plattform</a></li>
<li><a href="../de458826/index.html">Wie man alte Artikel aussortiert, damit sie im Bio-Bereich stark wachsen: + 104% des Verkehrs f√ºr sechs Monate</a></li>
<li><a href="../de458828/index.html">Warum, warum und wann ValueTask verwendet werden soll</a></li>
<li><a href="../de458830/index.html">Dell Technologies-Webinare: Alle Details unseres Tutorials</a></li>
<li><a href="../de458834/index.html">Seite der Pers√∂nlichkeit von Paul Allen, von der nicht so viele Menschen wussten, wie ich m√∂chte</a></li>
<li><a href="../de458836/index.html">Borsch Index. Ein systematischer Ansatz zur Bewertung, zum Vergleich und zur Bestimmung des Preis-Leistungs-Verh√§ltnisses</a></li>
<li><a href="../de458840/index.html">Wie wir die Great Chinese Firewall durchbohrt haben (Teil 2)</a></li>
<li><a href="../de458842/index.html">Geduld und Arbeit werden den gesamten Text extrahieren</a></li>
<li><a href="../de458844/index.html">Silozerst√∂rung durch VeriSM ‚Ñ¢ -Anpassungsansatz</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>