<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ต๐ผ ๐ ๐๐ฝ ุตูุฑ ุชุนุทู ุงููุดุฑ ูููุงุนุฏ ุงูุจูุงูุงุช ๐น ๐จโ๐ฉโ๐งโ๐ฆ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุชุดุฑุญ ูุฐู ุงูููุงูุฉ ุจุงูุชูุตูู ููููุฉ ุญู ุงููุดููุงุช ุงููุฑุชุจุทุฉ ุจุชูุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฃุซูุงุก ุงููุดุฑ. ุณูุฎุจุฑู ุจูุง ูููู ุฃู ูุญุฏุซ ููุชุทุจููุงุช ุงูุฎุงุตุฉ ุจู ุนูู ุงูููุชุฌ ุฅุฐุง ุญุงู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุตูุฑ ุชุนุทู ุงููุดุฑ ูููุงุนุฏ ุงูุจูุงูุงุช</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/nixys/blog/481932/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/hr/vy/qq/hrvyqqi2mmitehw9vx_xklbofj8.png" alt="ุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  ุชุดุฑุญ ูุฐู ุงูููุงูุฉ ุจุงูุชูุตูู ููููุฉ ุญู ุงููุดููุงุช ุงููุฑุชุจุทุฉ ุจุชูุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฃุซูุงุก ุงููุดุฑ.  ุณูุฎุจุฑู ุจูุง ูููู ุฃู ูุญุฏุซ ููุชุทุจููุงุช ุงูุฎุงุตุฉ ุจู ุนูู ุงูููุชุฌ ุฅุฐุง ุญุงููุช ุฅุฌุฑุงุก ุนูููุฉ ูุดุฑ ุฏูู ุฃู ุฅุนุฏุงุฏ ุฃููู.  ุจุนุฏ ุฐูู ุ ุณูู ููุฑ ุจูุฑุงุญู ุฏูุฑุฉ ุญูุงุฉ ุงูุชุทุจูู ุ ููู ุถุฑูุฑูุฉ ูู ุฃุฌู ุงูุญุตูู ุนูู ููุช ุชุนุทู ุตูุฑู ( <em>ุชูุฑูุจูุง. ุชุฑุฌู.: ูุฒูุฏ - ููุช ุชุนุทู ุตูุฑู</em> ).  ุณุชููู ูุชูุฌุฉ ุนูููุงุชูุง ูู ุชุทุจูู ุชุบููุฑ ูุงุนุฏุฉ ุจูุงูุงุช ุบูุฑ ูุชูุงูู ุฅูู ุงููุฑุงุก ุจุทุฑููุฉ ูุชูุงููุฉ ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ. </p><a name="habracut"></a><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ุชุฑุบุจ ูู ููู ุฃูุซูุฉ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูู ุงูููุงูุฉ ุ <a href="https://github.com/spring-cloud-samples/zero-downtime-deployment">ูุณุชุฌุฏูุง</a> ูู <a href="https://github.com/spring-cloud-samples/zero-downtime-deployment">GitHub</a> . </p><br><h2 id="vvedenie" style=";text-align:right;direction:rtl">  ููุฏูุฉ </h2><br><h3 id="zero-downtime-deployment" style=";text-align:right;direction:rtl">  ุตูุฑ ุชุนุทู ุงููุดุฑ </h3><br><p style=";text-align:right;direction:rtl">  ูุง ูู <strong>ุงููุดุฑ</strong> ุจุงุทูู <strong>ุตูุฑ ุงูุชุนุทู</strong> ุ  ูููููุง ุฃู ูููู ูุฐุง ุนูุฏูุง ูุชู ูุดุฑ ุงูุชุทุจูู ุงูุฎุงุต ุจู ุจุญูุซ ููููู ุฅุฏุฎุงู ุฅุตุฏุงุฑ ุฌุฏูุฏ ูู ุงูุชุทุจูู ููุฅูุชุงุฌ ุจูุฌุงุญ ุ ุจูููุง ูุง ููุงุญุธ ุงููุณุชุฎุฏู ุนุฏู ุฅููุงููุฉ ุงููุตูู ุฅููู.  ูู ูุฌูุฉ ูุธุฑ ุงููุณุชุฎุฏู ูุงูุดุฑูุฉ ุ ูุฐุง ูู ุฃูุถู ุณููุงุฑูู ูุดุฑ ูููู ุ ุญูุซ ููููู ุจูุฐู ุงูุทุฑููุฉ ุชูุฏูู ูุธุงุฆู ุฌุฏูุฏุฉ ูุงููุถุงุก ุนูู ุงูุฃุฎุทุงุก ุฏูู ุงููุทุงุน. </p><br><p style=";text-align:right;direction:rtl">  ููู ุชุญูู ูุฐุงุ  ููุงู ุนุฏุฉ ุทุฑู ุ ุฅููู ุฅุญุฏู ูุฐู ุงูุทุฑู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชูุณูุน ุงูุฅุตุฏุงุฑ 1 ูู ุงูุฎุฏูุฉ ุงูุฎุงุตุฉ ุจู </li><li style=";text-align:right;direction:rtl">  ุชุฑุญูู ูุงุนุฏุฉ ุงูุจูุงูุงุช </li><li style=";text-align:right;direction:rtl">  ูุดุฑ ุงูุฅุตุฏุงุฑ 2 ูู ุงูุฎุฏูุฉ ุจุงูุชูุงุฒู ูุน ุงูุฅุตุฏุงุฑ 1 </li><li style=";text-align:right;direction:rtl">  ุจูุฌุฑุฏ ุฃู ุชุฑู ุฃู ุงูุฅุตุฏุงุฑ ุฑูู 2 ูุนูู ููุง ูุฌุจ ุ ุฃุฒู ุงูุฅุตุฏุงุฑ ุฑูู 1 </li><li style=";text-align:right;direction:rtl">  ุฌุงูุฒุฉ! </li></ul><br><p style=";text-align:right;direction:rtl">  ุณูู ุ ุฃููุณ ูุฐููุ  ูุณูุก ุงูุญุธ ุ ูุฐุง ููุณ ุจูุฐู ุงูุจุณุงุทุฉ ุ ูุณูู ููุธุฑ ูู ูุฐุง ุจุงูุชูุตูู ูู ููุช ูุงุญู.  ุงูุขู ุฏุนููุง ูุชุญูู ูู ุนูููุฉ ูุดุฑ ุดุงุฆุนุฉ ุฃุฎุฑู - ูุดุฑ ุฃุฎุถุฑ ุฃุฒุฑู. </p><br><p style=";text-align:right;direction:rtl">  ูู ุณูุนุช ูู ูุจู <a href="https://martinfowler.com/bliki/BlueGreenDeployment.html">ูุดุฑ ุงูุฃุฎุถุฑ ุงูุฃุฒุฑู</a> ุ  ูุน Cloud Foundry ุ ูู ุงูุณูู ุฌุฏูุง ุงูููุงู ุจุฐูู.  ูุฌุฑุฏ ุฅููุงุก ูุธุฑุฉ ุนูู <a href="https://spring.io/blog/2014/04/04/project-sagan-zero-downtime-deployments">ูุฐู ุงูููุงูุฉ</a> ุญูุซ ูุตููุงูุง ุจูุฒูุฏ ูู ุงูุชูุงุตูู.  ุจุชูุฎูุต ููุชุฑุฉ ูุฌูุฒุฉ ุ ูุชุฐูุฑ ููููุฉ ุงูููุงู ุงููุดุฑ ุงูุฃุฎุถุฑ ุงูุฃุฒุฑู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <em>ุชุฃูุฏ ูู ุชุดุบูู ูุณุฎุชูู ูู ุฑูุฒ ุงูุฅูุชุงุฌ ("ุงูุฃุฒุฑู" ู "ุงูุฃุฎุถุฑ") ุ</em> </li><li style=";text-align:right;direction:rtl">  <em>ุชูุฌูู ูู ุญุฑูุฉ ุงููุฑูุฑ ุฅูู ุงูุจูุฆุฉ ุงูุฒุฑูุงุก ุ ุฃู</em>  <em>ุจุญูุซ ุชุชู ุงูุฅุดุงุฑุฉ ุฅูู ุนูุงููู URL ููุฅูุชุงุฌ ููุงู ุ</em> </li><li style=";text-align:right;direction:rtl">  <em>ูุดุฑ ูุงุฎุชุจุงุฑ ุฌููุน ุงูุชุบููุฑุงุช ุงูุชุทุจูู ูู ุจูุฆุฉ ุฎุถุฑุงุก</em> </li><li style=";text-align:right;direction:rtl">  <em>ุชุจุฏูู ุนูุงููู ุงูููุงูุน ูู ุงูุฃุฒุฑู ุฅูู ุงูุจูุฆุฉ ุงูุฎุถุฑุงุก</em> </li></ul><br><p style=";text-align:right;direction:rtl">  ูุนุชุจุฑ ุงููุดุฑ ุจุงูููู ุงูุฃุฒุฑู ูุงูุฃุฎุถุฑ ุฃุณููุจูุง ูุชูุญ ูู ุฅุฏุฎุงู ููุฒุงุช ุฌุฏูุฏุฉ ุจุณูููุฉ ุฏูู ุงูููู ูู ุฃู ุงูุฅูุชุงุฌ ุณููุชูู.  ููุฑุฌุน ุฐูู ุฅูู ุญูููุฉ ุฃูู ุญุชู ูู ุญุฏุซ ุดูุก ูุง ุ ููููู ุจุณูููุฉ ุงูุฑุฌูุน ุฅูู ุงูุจูุฆุฉ ุงูุณุงุจูุฉ ุจุจุณุงุทุฉ ุนู ุทุฑูู ุงูููุฑ ููู ููุชุงุญ ุงูุชุจุฏูู. </p><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ูุฑุงุกุฉ ูู ูุง ุณุจู ุ ููููู ุฃู ุชุทุฑุญ ุงูุณุคุงู ุงูุชุงูู: ูุง ุนูุงูุฉ ุงูุชููู ุตูุฑ ูุน ุงููุดุฑ ุงูุฃุฎุถุฑ ุงูุฃุฒุฑูุ </p><br><p style=";text-align:right;direction:rtl">  ุญุณููุง ุ ูุฏููู ุงููุซูุฑ ูู ุงูุนูุงูู ุงููุดุชุฑูุฉ ุ ูุฃู ุฏุนู ูุณุฎุชูู ูู ููุณ ุงูุจูุฆุฉ ูุชุทูุจ ุจุฐู ุฌููุฏ ูุถุงุนูุฉ ููุญูุงุธ ุนูููุง.  ููุฐุง ูู ุงูุณุจุจ ูู ุฃู ุจุนุถ ุงููุฑู ุ ููููุง ููุง ูุงูู <a href="https://martinfowler.com/bliki/BlueGreenDeployment.html">ูุงุฑุชู ูุงููุฑ</a> ุ ุชูุชุฒู ุงูุงุฎุชูุงูุงุช ูู ูุฐุง ุงูููุฌ: </p><br><p style=";text-align:right;direction:rtl"> <em>ุฎูุงุฑ ุขุฎุฑ ูู ุงุณุชุฎุฏุงู ููุณ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ูุฅูุดุงุก ููุงุชูุญ ุฒุฑูุงุก ูุฎุถุฑุงุก ูุทุจูุงุช ุงูููุจ ูุงููุฌุงู.</em>  <em>ูู ูุฐุง ุงูููุฌ ุ ุบุงูุจูุง ูุง ุชููู ููุงุนุฏ ุงูุจูุงูุงุช ูุดููุฉ ุ ุฎุงุตุฉ ุนูุฏูุง ุชุญุชุงุฌ ุฅูู ุชุบููุฑ ูุฎุทุทูุง ูุฏุนู ุฅุตุฏุงุฑ ุฌุฏูุฏ ูู ุงูุจุฑูุงูุฌ.</em> </p><br><p style=";text-align:right;direction:rtl">  ูููุง ูุฃุชู ุฅูู ุงููุดููุฉ ุงูุฑุฆูุณูุฉ ูู ูุฐู ุงูููุงูุฉ.  <strong>ูุงุนุฏุฉ ุงูุจูุงูุงุช</strong> .  ุฏุนูุง ูููู ูุธุฑุฉ ุฃุฎุฑู ุนูู ูุฐู ุงูุนุจุงุฑุฉ. </p><br><p style=";text-align:right;direction:rtl">  <em>ุชุฑุญูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.</em> </p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ุนููู ุฃู ุชุณุฃู ููุณู ุงูุณุคุงู - ูุงุฐุง ูู ูุงู ุชุบููุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ูุชูุงูู ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉุ  ูู ูู ูููุทุน ุงูุฅุตุฏุงุฑ ุงูุฃูู ูู ุงูุชุทุจููุ  ูู ุงููุงูุน ุ ูุฐุง ูู ุจุงูุถุจุท ูุง ุณูุญุฏุซ ... </p><br><p style=";text-align:right;direction:rtl">  ูุจุงูุชุงูู ุ ุนูู ุงูุฑุบู ูู ุงูููุงุฆุฏ ุงููุงุฆูุฉ ุงููุชูุซูุฉ ูู ุนุฏู ุงูุชุนุทู / ุงููุดุฑ ุงูุฃุฎุถุฑ ุงูุฃุฒุฑู ุ ุชููู ุงูุดุฑูุงุช ุฅูู ุงุชุจุงุน ุนูููุฉ ุงููุดุฑ ุงูุฃูุซุฑ ุฃูุงููุง ุงูุชุงููุฉ ูุชุทุจููุงุชูุง: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู ุจุฅุนุฏุงุฏ ุญุฒูุฉ ูุน ุฅุตุฏุงุฑ ุฌุฏูุฏ ูู ุงูุชุทุจูู </li><li style=";text-align:right;direction:rtl">  ุงุบูุงู ุชุทุจูู ููุฏ ุงูุชุดุบูู </li><li style=";text-align:right;direction:rtl">  ุชุดุบูู ุงูุจุฑุงูุฌ ุงููุตูุฉ ูุชุฑุญูู ูุงุนุฏุฉ ุงูุจูุงูุงุช </li><li style=";text-align:right;direction:rtl">  ูุดุฑ ูุฅุทูุงู ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ ูู ุงูุชุทุจูู </li></ul><br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูููุงูุฉ ุ ุณูุตู ุจุงูุชูุตูู ููู ููููู ุงูุนูู ูุน ูุงุนุฏุฉ ุจูุงูุงุช ูุฑูุฒ ููุงุณุชูุงุฏุฉ ูู ุชุนุทู ููุช ุงููุดุฑ. </p><br><h3 id="problemy-s-bazoy-dannyh" style=";text-align:right;direction:rtl">  ูุถุงูุง ูุงุนุฏุฉ ุงูุจูุงูุงุช </h3><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู ูุฏูู ุชุทุจูู ุนุฏูู ุงูุฌูุณูุฉ ูุง ูููู ุจุชุฎุฒูู ุฃู ุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ูููููู ุงูุญุตูู ุนูู ุชุนุทู ุตูุฑ ุนูู ุงูููุฑ.  ูุณูุก ุงูุญุธ ุ ุชุญุชุงุฌ ูุนุธู ุงูุจุฑุงูุฌ ุฅูู ุชุฎุฒูู ุงูุจูุงูุงุช ูู ููุงู ูุง.  ููุฐุง ุงูุณุจุจ ูุฌุจ ุฃู ุชููุฑ ูุฑุชูู ูุจู ุฅุฌุฑุงุก ุฃู ุชุบููุฑุงุช ุนูู ุงูุฏุงุฆุฑุฉ.  ูุจู ุฃู ููุญุต ุชูุงุตูู ููููุฉ ุชุบููุฑ ุงููุฎุทุท ุจุญูุซ ูุตุจุญ ูู ุงููููู ุงููุดุฑ ุฏูู ุชููู ุ ุฏุนููุง ูุฑูุฒ ุฃููุงู ุนูู ูุธุงู ุงูุชุญูู ูู ุงูุฅุตุฏุงุฑ. </p><br><h3 id="shema-upravleniya-versiyami" style=";text-align:right;direction:rtl">  ูุฎุทุท ุงูุชุญูู ูู ุงูุฅุตุฏุงุฑ </h3><br><p style=";text-align:right;direction:rtl"> ูู ูุฐู ุงูููุงูุฉ ุ ุณูู ูุณุชุฎุฏู <a href="https://flywaydb.org/">Flyway</a> ูุฃุฏุงุฉ ููุชุญูู ูู ุงูุฅุตุฏุงุฑ ( <em>ุชุฑุฌูุฉ ุชูุฑูุจูุฉ.: ูุญู ูุชุญุฏุซ ุนู ุชุฑุญูู ูุงุนุฏุฉ ุงูุจูุงูุงุช</em> ).  ุจุทุจูุนุฉ ุงูุญุงู ุ ุณูููู ุฃูุถูุง ุจูุชุงุจุฉ ุชุทุจูู Spring Boot ุงูุฐู ูุญุชูู ุนูู ุฏุนู Flyway ูุฏูุฌ ูุณูููู ุจุชุฑุญูู ุงูุฏุงุฆุฑุฉ ุฃุซูุงุก ุฅุนุฏุงุฏ ุณูุงู ุงูุชุทุจูู.  ุนูุฏ ุงุณุชุฎุฏุงู Flyway ุ ููููู ุชุฎุฒูู ุงูุจุฑุงูุฌ ุงููุตูุฉ ูููุฌุฑุฉ ูู ูุฌูุฏ ุงููุดุงุฑูุน (ุงูุชุฑุงุถููุง ูู <code>classpath:db/migration</code> ).  ููุง ููููู ุฑุคูุฉ ูุซุงู ููููุงุช ุงูุชุฑุญูู ูุฐู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">โโโ db โโโ migration โโโ V1__init.sql โโโ V2__Add_surname.sql โโโ V3__Final_migration.sql โโโ V4__Remove_lastname.sql</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูุฐุง ุงููุซุงู ุ ูุฑู 4 ุณููุงุฑูููุงุช ุชุฑุญูู ุ ุฅุฐุง ูู ูุชู ุชูููุฐูุง ูุณุจููุง ุ ูุณูุชู ุชูููุฐูุง ูุงุญุฏุฉ ุชูู ุงูุฃุฎุฑู ุนูุฏ ุจุฏุก ุชุดุบูู ุงูุชุทุจูู.  ุฏุนูุง ููุธุฑ ุฅูู ุฃุญุฏ ุงููููุงุช ( <code>V1__init.sql</code> ) ููุซุงู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">CREATE TABLE PERSON ( id BIGINT GENERATED BY DEFAULT AS IDENTITY, first_name varchar(255) not null, last_name varchar(255) not null ); insert into PERSON (first_name, last_name) values ('Dave', 'Syer');</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุดูุก ูุชุญุฏุซ ุนู ููุณู ุชูุงููุง: ููููู ุงุณุชุฎุฏุงู SQL ูุชุญุฏูุฏ ููููุฉ ุชุนุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจู.  ููุฒูุฏ ูู ุงููุนูููุงุช ุญูู Spring Boot ู Flyway ุ ุชุญูู ูู <a href="https://docs.spring.io/spring-boot/docs/1.3.5.RELEASE/reference/html/howto-database-initialization.html">Spring Boot Docs</a> . </p><br><p style=";text-align:right;direction:rtl">  ูููุญู ุงุณุชุฎุฏุงู ุงูุชุญูู ูู ุงูุฅุตุฏุงุฑ ูุน Spring Boot ุงุซููู ูู ุงูููุฒุงุช ุงูุฑุงุฆุนุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููููู ูุตู ุงูุชุบููุฑุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ุงูุชุบููุฑุงุช ุฑูุฒ </li><li style=";text-align:right;direction:rtl">  ูุญุฏุซ ุชุฑุญูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฌูุจูุง ุฅูู ุฌูุจ ูุน ุจุฏุก ุชุทุจููู ุ ุฃู  ุนูููุฉ ุงููุดุฑ ูุจุณุทุฉ </li></ul><br><h2 id="reshenie-problem-s-bazoy-dannyh" style=";text-align:right;direction:rtl">  ุญู ูุดุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช </h2><br><p style=";text-align:right;direction:rtl">  ูู ุงููุณู ุงูุชุงูู ูู ุงูููุงูุฉ ุ ุณูุฑูุฒ ุนูู ุงููุธุฑ ูู ุทุฑููุชูู ูุชุบููุฑ ููุงุนุฏ ุงูุจูุงูุงุช. </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุนุฏู ุงูุชูุงูู ุงูุฎููู </li><li style=";text-align:right;direction:rtl">  ุงูุชูุงูู ุงูุฎููู </li></ul><br><p style=";text-align:right;direction:rtl">  ุณูุชู ุงุนุชุจุงุฑ ุงูุฃูู ุจูุซุงุจุฉ ุชุญุฐูุฑ ูู ุนุฏู ุชูููุฐ ุนูููุฉ ุชุนุทู ุตูุฑูุฉ ุฏูู ุชุญุถูุฑ ุฃููู ... ูุงูุซุงูู ููุฏู ุญูุงู ุญูู ููููุฉ ุฅุฌุฑุงุก ุนูููุฉ ูุดุฑ ุฏูู ุชููู ููู ุงูููุช ููุณู ุงูุญูุงุธ ุนูู ุงูุชูุงูู ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุณูููู ูุดุฑูุนูุง ุ ุงูุฐู ุณูุนูู ุนููู ุ ุชุทุจูู Spring Spring Flyway ุจุณูุทูุง ููุฌุฏ ููู <code>Person</code> ูุญูู <code>first_name</code> ูุงุณู <em>ุงูุนุงุฆูุฉ</em> ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ( <em>approx.per.: <code>Person</code> ุนุจุงุฑุฉ ุนู ุฌุฏูู ุ ู f <code>irst_name</code> ู <code>last_name</code> ููุง <code>irst_name</code> ููู</em> ).  ูุฑูุฏ ุฅุนุงุฏุฉ ุชุณููุฉ <code>last_name</code> ุฅูู <code>surname</code> . </p><br><h3 id="dopuscheniya" style=";text-align:right;direction:rtl">  ุงูุงูุชุฑุงุถุงุช </h3><br><p style=";text-align:right;direction:rtl">  ูุจู ุงูุฎูุถ ูู ุงูุชูุงุตูู ุ ูุญุชุงุฌ ุฅูู ุชูุถูุญ ุนุฏุฉ ุงูุชุฑุงุถุงุช ุญูู ุทูุจุงุชูุง.  ุณุชููู ุงููุชูุฌุฉ ุงูุฑุฆูุณูุฉ ุงูุชู ูุฑูุฏ ุชุญููููุง ูู ุนูููุฉ ุจุณูุทุฉ ุฅูู ุญุฏ ูุง. </p><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุงููุฐูุฑุฉ.</strong>  ุงูุฃุนูุงู PRO-TIP.  ูููู ุฃู ุชููุฑ ูู ุนูููุงุช ุชุจุณูุท ุงููุซูุฑ ูู ุงููุงู ูู ุงูุฏุนู (ูููุง ุฒุงุฏ ุนุฏุฏ ุงูุฃุดุฎุงุต ุงูุนุงูููู ูู ุดุฑูุชู ุ ุฒุงุฏุช ุงูุฃููุงู ุงูุชู ููููู ุชูููุฑูุง)! </blockquote><br><h3 id="ne-nado-delat-otkat-bazy-dannyh" style=";text-align:right;direction:rtl">  ูุง ุญุงุฌุฉ ูุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช </h3><br><p style=";text-align:right;direction:rtl">  ูุนูู ุฐูู ุนูู ุชุจุณูุท ุนูููุฉ ุงููุดุฑ (ุจุนุถ ุนูููุงุช ุงูุงุณุชุนุงุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชูุงุฏ ุชููู ูุณุชุญููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุญุฐู ุงูุงุณุชุนุงุฏุฉ).  ูุญู ููุถู ุงุณุชุฑุฌุงุน ุงูุชุทุจููุงุช ููุท.  ุจูุฐู ุงูุทุฑููุฉ ุ ุญุชู ูู ูุงู ูุฏูู ููุงุนุฏ ุจูุงูุงุช ูุฎุชููุฉ (ูุซู SQL ู NoSQL) ุ ูุฅู ุฎุท ุฃูุงุจูุจ ุงููุดุฑ ุงูุฎุงุต ุจู ุณูุจุฏู ููุง ูู. </p><br><p style=";text-align:right;direction:rtl">  <strong>ูุฌุจ ุฃู ูููู ูู ุงููููู ุฏุงุฆููุง ุงุณุชุฑุฌุงุน ุงูุชุทุจูู ูุณุฎุฉ ูุงุญุฏุฉ ูุฑุฉ ุฃุฎุฑู (ูุง ุฃูุซุฑ)</strong> </p><br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ูุชู ุงูุงุณุชุนุงุฏุฉ ููุท ุฅุฐุง ูุฒู ุงูุฃูุฑ.  ุฅุฐุง ูุงู ููุงู ุฎุทุฃ ูู ุงูุฅุตุฏุงุฑ ุงูุญุงูู ููุณ ูู ุงูุณูู ุฅุตูุงุญู ุ ููุฌุจ ุฃู ูุชููู ูู ุฅุฑุฌุงุน ุฃุญุฏุซ ุฅุตุฏุงุฑ ูุนูู.  ูุญู ููุชุฑุถ ุฃู ูุฐุง ุงูุฅุตุฏุงุฑ ุงูุฃุฎูุฑ ูู ุงูุนูู ูู ุงูุฅุตุฏุงุฑ ุงูุณุงุจู.  ุณูููู ุงูุญูุงุธ ุนูู ุชูุงูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูููุงุนุฏ ุงูุจูุงูุงุช ูุฃูุซุฑ ูู ุนูููุฉ ุทุฑุญ ูุงุญุฏุฉ ุจุงูุบ ุงูุตุนูุจุฉ ููููููุง. </p><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุงููุฐูุฑุฉ.</strong>  ููุฒูุฏ ูู ุณูููุฉ ุงููุฑุงุกุฉ ุ ูู ุฅุทุงุฑ ูุฐู ุงูููุงูุฉ ุ ุณูููู ุจุชุบููุฑ ุงูุฅุตุฏุงุฑ ุงูุฑุฆูุณู ููุชุทุจูู. </blockquote><br><h3 id="shag-1-ishodnoe-sostoyanie" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 1: ุงูุญุงูุฉ ุงูุฃูููุฉ </h3><br><p style=";text-align:right;direction:rtl">  ุฅุตุฏุงุฑ ุงูุชุทุจูู: <code>1.0.0</code> <br>  ูุณุฎุฉ DB: <code>v1</code> </p><br><h3 id="kommentariy" style=";text-align:right;direction:rtl">  ุชุนููู </h3><br><p style=";text-align:right;direction:rtl">  ุณุชููู ูุฐู ูู ุงูุญุงูุฉ ุงูุฃูููุฉ ููุชุทุจูู. </p><br><h3 id="izmeneniya-bd" style=";text-align:right;direction:rtl">  ุงูุชุบููุฑุงุช DB </h3><br><p style=";text-align:right;direction:rtl">  ุชุญุชูู ูุงุนุฏุฉ ุงูุจูุงูุงุช <code>last_name.</code> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">CREATE TABLE PERSON ( id BIGINT GENERATED BY DEFAULT AS IDENTITY, first_name varchar(255) not null, last_name varchar(255) not null ); insert into PERSON (first_name, last_name) values ('Dave', 'Syer');</code> </pre> <br><h3 id="izmeneniya-koda" style=";text-align:right;direction:rtl">  ุชุบููุฑุงุช ุงูุฑูุฒ </h3><br><p style=";text-align:right;direction:rtl">  ูุญูุธ ุงูุชุทุจูู ุจูุงูุงุช ุงูุดุฎุต ูู <code>last_name</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/* * Copyright 2012-2016 the original author or authors. * * Licensed under the Apache License, Version 2.0 (the "License"); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * * http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */ package sample.flyway; import javax.persistence.Entity; import javax.persistence.GeneratedValue; import javax.persistence.Id; @Entity public class Person { @Id @GeneratedValue private Long id; private String firstName; private String lastName; public String getFirstName() { return this.firstName; } public void setFirstName(String firstName) { this.firstName = firstName; } public String getLastName() { return this.lastName; } public void setLastName(String lastname) { this.lastName = lastname; } @Override public String toString() { return "Person [firstName=" + this.firstName + ", lastName=" + this.lastName + "]"; } }</code> </pre> <br><h3 id="obratno-nesovmestimoe-pereimenovanie-stolbca" style=";text-align:right;direction:rtl">  ุฅุนุงุฏุฉ ุชุณููุฉ ุงูุนููุฏ ุบูุฑ ูุชูุงูู </h3><br><p style=";text-align:right;direction:rtl">  ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ูุซุงู ุนู ููููุฉ ุชุบููุฑ ุงุณู ุงูุนููุฏ: </p><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุญุฐูุฑ.</strong>  ุณูู ุงููุซุงู ุงูุชุงูู ูุณุฑ ุนูุฏุง.  ูุนุฑุถ ูุฐุง ูุฅุธูุงุฑ ูุดููุฉ ุชูุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช. </blockquote><p style=";text-align:right;direction:rtl">  ุฅุตุฏุงุฑ ุงูุชุทุจูู: <code>2.0.0.BAD</code> </p><br><p style=";text-align:right;direction:rtl">  ูุณุฎุฉ DB: <code>v2bad</code> </p><br><h3 id="kommentariy-1" style=";text-align:right;direction:rtl">  ุชุนููู </h3><br><p style=";text-align:right;direction:rtl">  ูุง ุชุณูุญ ููุง ุงูุชุบููุฑุงุช ุงูุญุงููุฉ ุจุชุดุบูู ุญุงูุชูู (ุงููุฏููุฉ ูุงูุฌุฏูุฏุฉ) ูู ููุณ ุงูููุช.  ูุจุงูุชุงูู ุ ุณูููู ูู ุงูุตุนุจ ุชุญููู ุชุนุทู ุงุณุชุฎุฏุงู ุงูุตูุฑ (ุงูุงูุชุฑุงุถุงุช ุงูุชู ูุชู ุฃุฎุฐูุง ูู ุงูุงุนุชุจุงุฑ ุ ูุฐุง ูุณุชุญูู ุชูุฑูุจูุง). </p><br><h3 id="ab-testirovanie" style=";text-align:right;direction:rtl">  ุงุฎุชุจุงุฑ A / B </h3><br><p style=";text-align:right;direction:rtl">  ุงููุถุน ุงูุญุงูู ูู ุฃู ูุฏููุง ุฅุตุฏุงุฑ ุชุทุจูู <code>1.0.0,</code> ูุดุฑู ูู prod ุ ููุงุนุฏุฉ ุจูุงูุงุช <code>v1</code> .  ูุฌุจ ูุดุฑ ุงููุซูู ุงูุซุงูู ููุชุทุจูู ุ ุงูุฅุตุฏุงุฑ <code>2.0.0.BAD</code> ุ ูุชุฑููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฅูู <code>v2bad</code> . </p><br><p style=";text-align:right;direction:rtl">  ุงูุฎุทูุงุช ุงูุชุงููุฉ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุดุฑ ูุซูู ุฌุฏูุฏ ูู ุฅุตุฏุงุฑ ุงูุชุทุจูู <code>2.0.0.BAD</code> ุ ูุงูุฐู ูููู ุจุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฅูู <code>v2bad</code> </li><li style=";text-align:right;direction:rtl">  ุงูุนููุฏ <code>last_name</code> ูู ูุนุฏ ููุฌูุฏูุง ูู ูุงุนุฏุฉ ุจูุงูุงุช <code>v2bad</code> - ุชู ุชุบููุฑู ุฅูู <code>surname</code> </li><li style=";text-align:right;direction:rtl">  ูุงูุช ุชุญุฏูุซุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงูุชุทุจูู ูุงุฌุญุฉ ุ ูุจุนุถ ุงูุญุงูุงุช ุชุนูู ูู <code>1.0.0</code> ุ ูุงูุจุนุถ ุงูุขุฎุฑ ูู <code>2.0.0.BAD</code> .  ุฌููุน ุงููุชุนููุฉ <code>v2bad</code> </li><li style=";text-align:right;direction:rtl">  ุณุชุจุฏุฃ ุฌููุน ูุซููุงุช ุงูุฅุตุฏุงุฑ <code>1.0.0</code> ูู ุฅููุงุก ุงูุฃุฎุทุงุก ูุฃููุง ุณุชุญุงูู ุฅุฏุฑุงุฌ ุงูุจูุงูุงุช ูู ุงูุนููุฏ <code>last_name</code> ุ ูุงูุฐู ูู ูุนุฏ </li><li style=";text-align:right;direction:rtl">  ุณุชุนูู ุฌููุน ูุซููุงุช ุงูุฅุตุฏุงุฑ <code>2.0.0.BAD</code> ุฏูู ูุดุงูู </li></ol><br><p style=";text-align:right;direction:rtl">  ููุง ุชุฑูู ุ ุฅุฐุง ุฃุฌุฑููุง ุชุบููุฑุงุช ุบูุฑ ูุชูุงููุฉ ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงูุชุทุจููุงุช ุ ูุฅู ุงุฎุชุจุงุฑ A / B ุฃูุฑ ูุณุชุญูู. </p><br><h3 id="otkat-prilozheniya" style=";text-align:right;direction:rtl">  ุชุทุจูู ุงูุงุณุชุนุงุฏุฉ </h3><br><p style=";text-align:right;direction:rtl">  ูููุชุฑุถ ุฃูู ุจุนุฏ ูุญุงููุฉ ุฅุฌุฑุงุก ูุดุฑ A / B ( <em>ุชุฑุฌูุฉ ุชูุฑูุจูุฉ.: ุฑุจูุง ุ ูุงู ุงููุคูู ูุดูุฑ ุฅูู ุงุฎุชุจุงุฑ A / B ููุง</em> ) ุ ูุฑุฑูุง ุฃููุง ูุญุชุงุฌ ุฅูู ุงุณุชุนุงุฏุฉ ุงูุชุทุจูู ุฅูู ุงูุฅุตุฏุงุฑ <code>1.0.0.</code>  ูููุชุฑุถ ุฃููุง ูุง ูุฑูุฏ ุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช. </p><br><p style=";text-align:right;direction:rtl">  ุงูุฎุทูุงุช ุงูุชุงููุฉ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุชููู ุนู ูุณุฎุฉ ุงูุชุทุจูู <code>2.0.0.BAD</code> </li><li style=";text-align:right;direction:rtl">  ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุง ุชุฒุงู <code>v2bad</code> </li><li style=";text-align:right;direction:rtl">  ููุฐ ุงูุฅุตุฏุงุฑ <code>1.0.0</code> ูุง ูููู ูุง <code>surname</code> ุ ุณูุฑู ุงูุฃุฎุทุงุก </li><li style=";text-align:right;direction:rtl">  ูุณุฑ ุงูุฌุญูู ูุฌุงูุง ูู ูุนุฏ ูุณุชุทูุน ุงูุนูุฏุฉ </li></ol><br><p style=";text-align:right;direction:rtl">  ููุง ุชุฑูู ุ ุฅุฐุง ุฃุฌุฑููุง ุชุบููุฑุงุช ุบูุฑ ูุชูุงููุฉ ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงูุชุทุจููุงุช ุ ููุง ูููููุง ุงูุฑุฌูุน ุฅูู ุงูุฅุตุฏุงุฑ ุงูุณุงุจู. </p><br><h3 id="logi-ispolneniya-skripta" style=";text-align:right;direction:rtl">  ุณุฌูุงุช ุชูููุฐ ุงูุจุฑูุงูุฌ ุงููุตู </h3><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Backward incompatible scenario: 01) Run 1.0.0 02) Wait for the app (1.0.0) to boot 03) Generate a person by calling POST localhost:9991/person to version 1.0.0 04) Run 2.0.0.BAD 05) Wait for the app (2.0.0.BAD) to boot 06) Generate a person by calling POST localhost:9991/person to version 1.0.0 &lt;-- this should fail 07) Generate a person by calling POST localhost:9992/person to version 2.0.0.BAD &lt;-- this should pass Starting app in version 1.0.0 Generate a person in version 1.0.0 Sending a post to 127.0.0.1:9991/person. This is the response: {"firstName":"b73f639f-e176-4463-bf26-1135aace2f57","lastName":"b73f639f-e176-4463-bf26-1135aace2f57"} Starting app in version 2.0.0.BAD Generate a person in version 1.0.0 Sending a post to 127.0.0.1:9991/person. This is the response: curl: (22) The requested URL returned error: 500 Internal Server Error Generate a person in version 2.0.0.BAD Sending a post to 127.0.0.1:9995/person. This is the response: {"firstName":"e156be2e-06b6-4730-9c43-6e14cfcda125","surname":"e156be2e-06b6-4730-9c43-6e14cfcda125"}</code> </pre> <br><h3 id="izmeneniya-bd-1" style=";text-align:right;direction:rtl">  ุงูุชุบููุฑุงุช DB </h3><br><p style=";text-align:right;direction:rtl">  ุณููุงุฑูู ุงูุชุฑุญูู ุงูุฐู ูุนูุฏ ุชุณููุฉ <code>last_name</code> ุฅูู <code>surname</code> </p><br><p style=";text-align:right;direction:rtl">  ุงูุจุฑูุงูุฌ ุงููุตู ุงููุตุฏุฑ Flyway: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">CREATE TABLE PERSON ( id BIGINT GENERATED BY DEFAULT AS IDENTITY, first_name varchar(255) not null, last_name varchar(255) not null ); insert into PERSON (first_name, last_name) values ('Dave', 'Syer');</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุฑูุงูุฌ ูุตู ูุนูุฏ ุชุณููุฉ <code>last_name</code> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">-- This change is backward incompatible - you can't do A/B testing ALTER TABLE PERSON CHANGE last_name surname VARCHAR;</code> </pre> <br><h3 id="izmeneniya-koda-1" style=";text-align:right;direction:rtl">  ุชุบููุฑุงุช ุงูุฑูุฒ </h3><br><p style=";text-align:right;direction:rtl">  ูููุง ุจุชุบููุฑ ุงุณู ุงูุญูู <code>lastName</code> ุฅูู <code>surname</code> . </p><br><h3 id="pereimenovanie-stolbca-obratno-sovmestimym-sposobom" style=";text-align:right;direction:rtl">  ุฅุนุงุฏุฉ ุชุณููุฉ ุนููุฏ ุจุทุฑููุฉ ูุชูุงููุฉ ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ </h3><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูู ุงููููู ุงูุฃูุซุฑ ุดููุนูุง ุงูุฐู ูุฏ ููุงุฌูู.  ูุญู ุจุญุงุฌุฉ ุฅูู ุฅุฌุฑุงุก ุชุบููุฑุงุช ุบูุฑ ูุชูุงููุฉ ุฅูู ุงููุฑุงุก.  ููุฏ ุฃุซุจุชูุง ุจุงููุนู ุฃูู ุจุงููุณุจุฉ ูููุดุฑ ุจุฏูู ุชููู ุ ูุฌุจ ุฃูุง ูุทุจู ููุท ุชุฑุญูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฏูู ุฅุฌุฑุงุกุงุช ุฅุถุงููุฉ.  ูู ูุฐุง ุงููุณู ูู ุงูููุงูุฉ ุ ุณูููู ุจุฅุฌุฑุงุก 3 ุนูููุงุช ูุดุฑ ููุชุทุจูู ุฌูุจูุง ุฅูู ุฌูุจ ูุน ุนูููุงุช ุชุฑุญูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ุฃุฌู ุชุญููู ุงููุชูุฌุฉ ุงููุฑุฌูุฉ ูุงูุญูุงุธ ูู ููุณ ุงูููุช ุนูู ุงูุชูุงูู ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ. </p><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุงููุฐูุฑุฉ.</strong>  ุฃุฐูุฑ ุฃู ูุฏููุง ุฅุตุฏุงุฑ ูุงุนุฏุฉ ุจูุงูุงุช <code>v1</code> .  ุฃูู ูุญุชูู ุนูู ุงูุฃุนูุฏุฉ <code>first_name</code> ู <code>last_name</code> .  ูุฌุจ ุชุบููุฑ <code>last_name</code> ุฅูู <code>surname</code> .  ูุฏููุง ุฃูุถูุง ุฅุตุฏุงุฑ ุชุทุจูู <code>1.0.0,</code> ูุง ูุณุชุฎุฏู <code>surname</code> . </blockquote><br><h3 id="shag-2-dobavlyaem-surname" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 2: ุฅุถุงูุฉ ุงูููุจ </h3><br><p style=";text-align:right;direction:rtl">  ุฅุตุฏุงุฑ ุงูุชุทุจูู: <code>2.0.0</code> <br>  ูุณุฎุฉ DB: <code>v2</code> </p><br><h3 id="kommentariy-2" style=";text-align:right;direction:rtl">  ุชุนููู </h3><br><p style=";text-align:right;direction:rtl">  ุจุฅุถุงูุฉ ุนููุฏ ุฌุฏูุฏ ููุณุฎ ูุญุชููุงุชู ุ ูููู ุจุฅูุดุงุก ุชุบููุฑุงุช ูุงุนุฏุฉ ุจูุงูุงุช ูุชูุงููุฉ ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ.  ูู ุงูููุช ููุณู ุ ุฅุฐุง ูููุง ุจุฅุนุงุฏุฉ JAR ุฃู ูุฏููุง JAR ูุฏูู ุ ููู ูููุณุฑ ูู ููุช ุงูุชุดุบูู. </p><br><h3 id="vykatyvaem-novuyu-versiyu" style=";text-align:right;direction:rtl">  ูุญู ุทุฑุญ ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ </h3><br><p style=";text-align:right;direction:rtl">  ุงูุฎุทูุงุช ุงูุชุงููุฉ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุฑุญูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฅูุดุงุก ุนููุฏ <code>surname</code> ุงูุฌุฏูุฏ.  ุงูุขู ูุฏูู ูุณุฎุฉ ุฏูุณูุจู <code>v2</code> </li><li style=";text-align:right;direction:rtl">  ูุณุฎ ุงูุจูุงูุงุช ูู <code>last_name</code> ุฅูู <code>surname</code> .  <strong>ูุงุญุธ</strong> ุฃูู ุฅุฐุง ูุงู ูุฏูู ุงููุซูุฑ ูู ูุฐู ุงูุจูุงูุงุช ุ ููุฌุจ ุฃู ุชููุฑ ูู ุงูุชุฑุญูู ุงูุฏูุนู! </li><li style=";text-align:right;direction:rtl">  ุงูุชุจ ุงูููุฏ ุญูุซ ูุชู ุงุณุชุฎุฏุงู ูู ูู ุงูุนููุฏ <strong>ุงูุฌุฏูุฏ</strong> <strong>ูุงููุฏูู</strong> .  ุงูุขู ุชุทุจููู ุงูุฅุตุฏุงุฑ <code>2.0.0</code> </li><li style=";text-align:right;direction:rtl">  ุงูุฑุฃ ุงููููุฉ ูู ุนููุฏ <code>surname</code> ุฅุฐุง ูู ุชูู <code>null</code> ุฃู ูู l <code>ast_name</code> ุฅุฐุง ูู ูุชู ุชุญุฏูุฏ <code>surname</code> .  ููููู ุฅุฒุงูุฉ <code>getLastName()</code> ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุ ุญูุซ ุณุชุนูุฏ <code>null</code> ุนูุฏ ุฅุฑุฌุงุน ุงูุชุทุจูู ุงูุฎุงุต ุจู ูู <code>3.0.0</code> ุฅูู <code>2.0.0</code> . </li></ol><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ุชุณุชุฎุฏู Spring Boot Flyway ุ ูุณูุชู ุชูููุฐ ูุงุชูู ุงูุฎุทูุชูู ุฃุซูุงุก ุฅุทูุงู ุงูุฅุตุฏุงุฑ <code>2.0.0</code> ุงูุชุทุจูู.  ุฅุฐุง ููุช ุจุชุดุบูู ุฃุฏุงุฉ ุชุนููู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฏูููุง ุ ูุณูุชุนูู ุนููู ุงูููุงู ุจุฃูุฑูู ูุฎุชูููู ููุฐุง (ุฃููุงู ูู ุจุชุญุฏูุซ ุฅุตุฏุงุฑ db ูุฏูููุง ุ ุซู ูุดุฑ ุชุทุจูู ุฌุฏูุฏ). </p><br><blockquote style=";text-align:right;direction:rtl">  <strong>ูุฐุง ููู.</strong>  ุชุฐูุฑ ุฃู ุงูุนููุฏ ุงูุฐู ุชู ุฅูุดุงุคู ุญุฏูุซูุง <strong>ูุฌุจ ุฃูุง</strong> ูููู <strong>ูุงุฑุบูุง</strong> .  ุฅุฐุง ุงุณุชุฑุฌุนุช ุ ูุฅู ุงูุชุทุจูู ุงููุฏูู ูุง ูุนุฑู ุงูุนููุฏ ุงูุฌุฏูุฏ ููู ูููู ุจุชุซุจูุชู ุฃุซูุงุก <code>Insert.</code>  ูููู ุฅุฐุง ุฃุถูุช ูุฐุง ุงูุชูููุฏ ุ ูุณุชููู ูุงุนุฏุฉ ุจูุงูุงุชู ูู <code>v2</code> ุ <code>v2</code> ุงูุฃูุฑ ุชุนููู ูููุฉ ุงูุนููุฏ ุงูุฌุฏูุฏ.  ููุง ุณูุคุฏู ุฅูู ุงูุชูุงูุงุช ูููููุฏ. <br><br>  <strong>ูุฐุง ููู.</strong>  ูุฌุจ ุฅุฒุงูุฉ ุทุฑููุฉ <code>getLastName()</code> ุ ูุฃู ุงูุฅุตุฏุงุฑ <code>3.0.0</code> <code>getLastName()</code> ูุญุชูู ุนูู ููููู ุนููุฏ <code>last_name</code> ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ.  ูุฐุง ูุนูู ุฃูู ุณูุชู ุชุนููู ูุงุฑุบุฉ.  ููููู ุชุฑู ุงูุทุฑููุฉ ูุฅุถุงูุฉ <code>getSurname()</code> <code>null</code> ุ ูููู ุงูุญู ุงูุฃูุถู ูู ุงูุชุฃูุฏ ูู <code>getSurname()</code> ููุทู <code>getSurname()</code> ุงุฎุชุฑุช ุงููููุฉ ุบูุฑ ุงูุตูุฑูุฉ ุงูุตุญูุญุฉ. </blockquote><br><h3 id="ab-testirovanie-1" style=";text-align:right;direction:rtl">  ุงุฎุชุจุงุฑ A / B </h3><br><p style=";text-align:right;direction:rtl">  ุงููุถุน ุงูุญุงูู ูู ุฃู ูุฏููุง ุฅุตุฏุงุฑ ุชุทุจูู <code>1.0.0</code> ูุดุฑู ุนูู prod ููุงุนุฏุฉ ุจูุงูุงุช ูู <code>v1</code> .  ูุญุชุงุฌ ุฅูู ูุดุฑ ุงููุซูู ุงูุซุงูู ูู ุฅุตุฏุงุฑ ุงูุชุทุจูู <code>2.0.0</code> ุ ูุงูุฐู ุณูุฑูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฅูู <code>v2</code> . </p><br><p style=";text-align:right;direction:rtl">  ุงูุฎุทูุงุช ุงูุชุงููุฉ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุดุฑ ูุซูู ุฌุฏูุฏ ูู ุฅุตุฏุงุฑ ุงูุชุทุจูู <code>2.0.0</code> ุ ูุงูุฐู ูููู ุจุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฅูู <code>v2</code> </li><li style=";text-align:right;direction:rtl">  ููู ุงูููุช ููุณู ุ ุชูุช ูุนุงูุฌุฉ ุจุนุถ ุงูุทูุจุงุช ุจูุงุณุทุฉ ูุซููุงุช ุงูุฅุตุฏุงุฑ <code>1.0.0</code> </li><li style=";text-align:right;direction:rtl">  ุชู ุงูุชุญุฏูุซ ุจูุฌุงุญ ุ ููุฏูู ุงูุนุฏูุฏ ูู ูุซููุงุช ุงูุนูู ูุฅุตุฏุงุฑ ุงูุชุทุจูู <code>1.0.0</code> ูุจููุฉ ุงูุฅุตุฏุงุฑ <code>2.0.0.</code>  ุงูุฌููุน ูุชูุงุตู ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู <code>v2</code> </li><li style=";text-align:right;direction:rtl">  ูุง ูุณุชุฎุฏู ุงูุฅุตุฏุงุฑ <code>1.0.0</code> ุนููุฏ ุงูููุจ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ูููู ูุณุชุฎุฏู ุงูุฅุตุฏุงุฑ <code>2.0.0</code> .  ุฃููุง ูุง ุชุชุฏุงุฎู ูุน ุจุนุถูุง ุงูุจุนุถ ุ ููุฌุจ ุฃูุง ูููู ููุงู ุฃุฎุทุงุก. </li><li style=";text-align:right;direction:rtl">  ุงูุฅุตุฏุงุฑ <code>2.0.0</code> ุจุชุฎุฒูู ุงูุจูุงูุงุช ูู ูู ูู ุงูุนููุฏ ุงููุฏูู ูุงูุฌุฏูุฏ ุ ูุงูุฐู ูููุฑ ุงูุชูุงูู ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ </li></ol><br><blockquote style=";text-align:right;direction:rtl">  <strong>ูุฐุง ููู.</strong>  ุฅุฐุง ูุงู ูุฏูู ุฃู ุงุณุชุนูุงูุงุช ุชููู ุจุญุณุงุจ ุงูุนูุงุตุฑ ุจูุงุกู ุนูู ููู ูู ุงูุนููุฏ ุงููุฏูู / ุงูุฌุฏูุฏ ุ ููุฌุจ ุฃู ุชุชุฐูุฑ ุงูุขู ุฃู ูุฏูู ููููุง ููุฑุฑุฉ (ุนูู ุงูุฃุฑุฌุญ ูุง ุชุฒุงู ุชูุงุฌุฑ).  ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ููุช ุชุฑูุฏ ุญุณุงุจ ุนุฏุฏ ุงููุณุชุฎุฏููู ุงูุฐูู ูุจุฏุฃ ุงุณููู ุงูุฃุฎูุฑ (ุจุบุถ ุงููุธุฑ ุนู ุงุณู ุงูุนููุฏ) ุจุงูุญุฑู <code>A</code> ุ ุซู ูุจู ุงูุชูุงู ุชุฑุญูู ุงูุจูุงูุงุช (ุงูุนููุฏ <code>old</code> โ <code>new</code> ) ุ ูุฏ ูููู ูุฏูู ุจูุงูุงุช ุบูุฑ ูุชุณูุฉ ุฅุฐุง ููุช ุจุชูููุฐ ุงุณุชุนูุงู ูู ุนููุฏ ุฌุฏูุฏ. </blockquote><br><h3 id="otkat-prilozheniya-1" style=";text-align:right;direction:rtl">  ุชุทุจูู ุงูุงุณุชุนุงุฏุฉ </h3><br><p style=";text-align:right;direction:rtl">  ุงูุขู ูุฏููุง ุฅุตุฏุงุฑ ุชุทุจูู <code>2.0.0</code> ููุงุนุฏุฉ ุจูุงูุงุช ูู <code>v2</code> . </p><br><p style=";text-align:right;direction:rtl">  ุงูุฎุทูุงุช ุงูุชุงููุฉ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงุณุชุฑุฌุงุน ุงูุชุทุจูู ุงูุฎุงุต ุจู ุฅูู ุงูุฅุตุฏุงุฑ <code>1.0.0</code> . </li><li style=";text-align:right;direction:rtl">  ูุง ูุณุชุฎุฏู ุงูุฅุตุฏุงุฑ <code>1.0.0</code> ุนููุฏ <code>surname</code> ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ูุฐูู ูุฌุจ ุฃู ูููู ุงูุงุณุชุนุงุฏุฉ ูุงุฌุญุฉ </li></ol><br><h3 id="izmeneniya-db" style=";text-align:right;direction:rtl">  ุงูุชุบููุฑุงุช DB </h3><br><p style=";text-align:right;direction:rtl">  ุชุญุชูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุนูู ุนููุฏ ุจุงุณู <code>last_name</code> . </p><br><p style=";text-align:right;direction:rtl">  ุงูุจุฑูุงูุฌ ุงููุตู ุงููุตุฏุฑ Flyway: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">CREATE TABLE PERSON ( id BIGINT GENERATED BY DEFAULT AS IDENTITY, first_name varchar(255) not null, last_name varchar(255) not null ); insert into PERSON (first_name, last_name) values ('Dave', 'Syer');</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุจุฑูุงูุฌ ุงููุตู ูุฅุถุงูุฉ <code>surname</code> . </p><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุญุฐูุฑ.</strong>  ุชุฐูุฑ ุฃูู ูุง ุชุณุชุทูุน ุฅุถุงูุฉ ุฃู ูููุฏ ุบูุฑ ูุงุฑุบุฉ ุนูู ุงูุนููุฏ ุงููุถุงูุฉ.  ุฅุฐุง ููุช ุจุงุณุชุฑุฌุงุน JAR ุ ููู ูููู ูููุณุฎุฉ ุงููุฏููุฉ ุฃู ููุฑุฉ ุนู ุงูุนููุฏ ุงูููุถุงู ุ ูุณูุชู ุชุนูููู ุชููุงุฆููุง ุนูู NULL.  ุฅุฐุง ูุงู ููุงู ูุซู ูุฐุง ุงูุชูููุฏ ุ ูุฅู ุงูุชุทุจูู ุงููุฏูู ุณูููุงุฑ ุจุจุณุงุทุฉ. </blockquote><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">-- NOTE: This field can't have the NOT NULL constraint cause if you rollback, the old version won't know about this field -- and will always set it to NULL ALTER TABLE PERSON ADD surname varchar(255); -- WE'RE ASSUMING THAT IT'S A FAST MIGRATION - OTHERWISE WE WOULD HAVE TO MIGRATE IN BATCHES UPDATE PERSON SET PERSON.surname = PERSON.last_name</code> </pre> <br><h3 id="izmeneniya-koda-2" style=";text-align:right;direction:rtl">  ุชุบููุฑุงุช ุงูุฑูุฒ </h3><br><p style=";text-align:right;direction:rtl">  ูููู ุจุชุฎุฒูู ุงูุจูุงูุงุช ูู ูู ูู <code>last_name</code> <code>surname</code> .  ูู ุงูููุช ููุณู ุ ููุฑุฃ ูู <code>last_name</code> ุ ูุฃู ูุฐุง ุงูุนููุฏ ูู ุงูุฃูุซุฑ ุตูุฉ.  ุฃุซูุงุก ุนูููุฉ ุงููุดุฑ ุ ูุฏ ุชุชู ูุนุงูุฌุฉ ุจุนุถ ุงูุทูุจุงุช ุจูุงุณุทุฉ ูุซูู ุชุทุจูู ูู ูุชู ุชุญุฏูุซู ุจุนุฏ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/* * Copyright 2012-2016 the original author or authors. * * Licensed under the Apache License, Version 2.0 (the "License"); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * * http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */ package sample.flyway; import javax.persistence.Entity; import javax.persistence.GeneratedValue; import javax.persistence.Id; @Entity public class Person { @Id @GeneratedValue private Long id; private String firstName; private String lastName; private String surname; public String getFirstName() { return this.firstName; } public void setFirstName(String firstName) { this.firstName = firstName; } /** * Reading from the new column if it's set. If not the from the old one. * * When migrating from version 1.0.0 -&gt; 2.0.0 this can lead to a possibility that some data in * the surname column is not up to date (during the migration process lastName could have been updated). * In this case one can run yet another migration script after all applications have been deployed in the * new version to ensure that the surname field is updated. * * However it makes sense since when looking at the migration from 2.0.0 -&gt; 3.0.0. In 3.0.0 we no longer * have a notion of lastName at all - so we don't update that column. If we rollback from 3.0.0 -&gt; 2.0.0 if we * would be reading from lastName, then we would have very old data (since not a single datum was inserted * to lastName in version 3.0.0). */ public String getSurname() { return this.surname != null ? this.surname : this.lastName; } /** * Storing both FIRST_NAME and SURNAME entries */ public void setSurname(String surname) { this.lastName = surname; this.surname = surname; } @Override public String toString() { return "Person [firstName=" + this.firstName + ", lastName=" + this.lastName + ", surname=" + this.surname + "]"; } }</code> </pre> <br><h3 id="shag-3-udalenie-last_name-iz-koda" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 3: ุฅุฒุงูุฉ last_name ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ </h3><br><p style=";text-align:right;direction:rtl">  ุฅุตุฏุงุฑ ุงูุชุทุจูู: <code>3.0.0</code> </p><br><p style=";text-align:right;direction:rtl">  ูุณุฎุฉ DB: <code>v3</code> </p><br><h3 id="kommentariy-3" style=";text-align:right;direction:rtl">  ุชุนููู </h3><br><p style=";text-align:right;direction:rtl">  <em>ุชูุฑูุจุง.</em>  <em>trans: ุนูู ูุง ูุจุฏู ุ ูุงู ุงููุคูู ุจูุณุฎ ูุต ูุฐู ุงููุชูุฉ ุนู ุทุฑูู ุงูุฎุทุฃ ูู ุงูุฎุทูุฉ 2. ูู ูุฐู ุงูููุงูุฉ ุงูุฃุตููุฉ ุ ููุฌุจ ุฅุฌุฑุงุก ุชุบููุฑุงุช ูู ูุฐู ุงูุฎุทูุฉ ุนูู ุฑูุฒ ุงูุชุทุจูู ุจูุฏู ุฅุฒุงูุฉ ุงููุธููุฉ ุงูุชู ุชุณุชุฎุฏู ุนููุฏ <code>last_name</code> .</em> </p><br><p style=";text-align:right;direction:rtl">  ุจุฅุถุงูุฉ ุนููุฏ ุฌุฏูุฏ ููุณุฎ ูุญุชููุงุชู ุ ุฃูุดุฃูุง ุชุบููุฑุงุช ูุงุนุฏุฉ ุจูุงูุงุช ูุชูุงููุฉ ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ.  ุฃูุถูุง ุ ุฅุฐุง ูููุง ุจุงุณุชุนุงุฏุฉ JAR ุฃู ูุฏููุง JAR ูุฏูู ุ ููู ูููุณุฑ ูู ููุช ุงูุชุดุบูู. </p><br><h3 id="otkat-prilozheniya-2" style=";text-align:right;direction:rtl">  ุชุทุจูู ุงูุงุณุชุนุงุฏุฉ </h3><br><p style=";text-align:right;direction:rtl">  ูุฏููุง ุญุงููุง ุชุทุจูู ุงูุฅุตุฏุงุฑ <code>3.0.0</code> ููุงุนุฏุฉ ุจูุงูุงุช <code>v3</code> .  ุงูุฅุตุฏุงุฑ <code>3.0.0</code> ูุง ูุญูุธ ุงูุจูุงูุงุช ูู <code>last_name</code> .  ูุฐุง ูุนูู ุฃู <code>surname</code> ูุฎุฒู ุฃุญุฏุซ ุงููุนูููุงุช. </p><br><p style=";text-align:right;direction:rtl">  ุงูุฎุทูุงุช ุงูุชุงููุฉ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงุณุชุฑุฌุงุน ุงูุชุทุจูู ุงูุฎุงุต ุจู ุฅูู ุงูุฅุตุฏุงุฑ <code>2.0.0</code> . </li><li style=";text-align:right;direction:rtl">  ุงูุฅุตุฏุงุฑ <code>2.0.0</code> ูุณุชุฎุฏู ูู ูู <code>last_name</code> <code>surname</code> . </li><li style=";text-align:right;direction:rtl">  ุงูุฅุตุฏุงุฑ <code>2.0.0</code> ุณูุฃุฎุฐ <code>surname</code> ุฅุฐุง ูู ููู ูุงุฑุบูุง ุ ูุฅูุง <code>last_name</code> </li></ol><br><h3 id="izmeneniya-bd-2" style=";text-align:right;direction:rtl">  ุงูุชุบููุฑุงุช DB </h3><br><p style=";text-align:right;direction:rtl">  ูุง ุชูุฌุฏ ุชุบููุฑุงุช ูููููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.  ูุชู ุชูููุฐ ุงูุจุฑูุงูุฌ ุงููุตู ุงูุชุงูู ุ ุงูุฐู ูููุฐ ุงูุชุฑุญูู ุงูููุงุฆู ููุจูุงูุงุช ุงููุฏููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">-- WE'RE ASSUMING THAT IT'S A FAST MIGRATION - OTHERWISE WE WOULD HAVE TO MIGRATE IN BATCHES -- ALSO WE'RE NOT CHECKING IF WE'RE NOT OVERRIDING EXISTING ENTRIES. WE WOULD HAVE TO COMPARE -- ENTRY VERSIONS TO ENSURE THAT IF THERE IS ALREADY AN ENTRY WITH A HIGHER VERSION NUMBER -- WE WILL NOT OVERRIDE IT. UPDATE PERSON SET PERSON.surname = PERSON.last_name; -- DROPPING THE NOT NULL CONSTRAINT; OTHERWISE YOU WILL TRY TO INSERT NULL VALUE OF THE LAST_NAME -- WITH A NOT_NULL CONSTRAINT. ALTER TABLE PERSON MODIFY COLUMN last_name varchar(255) NULL DEFAULT NULL;</code> </pre> <br><h3 id="izmeneniya-koda-3" style=";text-align:right;direction:rtl">  ุชุบููุฑุงุช ุงูุฑูุฒ </h3><br><p style=";text-align:right;direction:rtl">  <em>ุชูุฑูุจุง.</em>  <em>ุนุจุฑ: ุชู ูุณุฎ ูุตู ูุฐู ุงููุชูุฉ ุนู ุทุฑูู ุงูุฎุทุฃ ูู ูุจู ุงููุคูู ูู ุงูุฎุทูุฉ 2. ููููุง ูููุทู ูุตุฉ ุงูููุงูุฉ ุ ูุฌุจ ุฃู ุชูุฏู ุงูุชุบููุฑุงุช ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูู ูุฐู ุงูุฎุทูุฉ ุฅูู ุฅุฒุงูุฉ ุนูุงุตุฑ ูููุง ุชุนูู ูุน ุงูุนููุฏ <code>last_name</code> .</em> </p><br><p style=";text-align:right;direction:rtl">  ูููู ุจุชุฎุฒูู ุงูุจูุงูุงุช ูู ูู ูู <code>last_name</code> <code>surname.</code>  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ููุฑุฃ ูู ุงูุนููุฏ <code>last_name</code> ุ ูุฃูู ุงูุฃูุซุฑ ุตูุฉ.  ุฃุซูุงุก ุนูููุฉ ุงููุดุฑ ุ ูุฏ ุชุชู ูุนุงูุฌุฉ ุจุนุถ ุงูุทูุจุงุช ุจูุงุณุทุฉ ูุซูู ูู ูุชู ุชุญุฏูุซู ุจุนุฏ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/* * Copyright 2012-2016 the original author or authors. * * Licensed under the Apache License, Version 2.0 (the "License"); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * * http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */ package sample.flyway; import javax.persistence.Entity; import javax.persistence.GeneratedValue; import javax.persistence.Id; @Entity public class Person { @Id @GeneratedValue private Long id; private String firstName; private String surname; public String getFirstName() { return this.firstName; } public void setFirstName(String firstName) { this.firstName = firstName; } public String getSurname() { return this.surname; } public void setSurname(String lastname) { this.surname = lastname; } @Override public String toString() { return "Person [firstName=" + this.firstName + ", surname=" + this.surname + "]"; } }</code> </pre> <br><h3 id="shag-4-udalenie-last_name-iz-bd" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 4: ุฅุฒุงูุฉ last_name ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช </h3><br><p style=";text-align:right;direction:rtl">  ุฅุตุฏุงุฑ ุงูุชุทุจูู: <code>4.0.0</code> </p><br><p style=";text-align:right;direction:rtl">  ูุณุฎุฉ DB: <code>v4</code> </p><br><h3 id="kommentariy-4" style=";text-align:right;direction:rtl">  ุชุนููู </h3><br><p style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุญูููุฉ ุฃู ููุฏ ุงูุฅุตุฏุงุฑ <code>3.0.0</code> ูู ูุณุชุฎุฏู ุนููุฏ <code>last_name</code> ุ ููู ูุญุฏุซ ุดูุก ุณูุก ุฃุซูุงุก ุงูุชูููุฐ ุฅุฐุง ุนุฏูุง ุฅูู <code>3.0.0</code> ุจุนุฏ ุฅุฒุงูุฉ ุงูุนููุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช. </p><br><h3 id="logi-ispolneniya-skripta-1" style=";text-align:right;direction:rtl">  ุณุฌูุงุช ุชูููุฐ ุงูุจุฑูุงูุฌ ุงููุตู </h3><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">We will do it in the following way: 01) Run 1.0.0 02) Wait for the app (1.0.0) to boot 03) Generate a person by calling POST localhost:9991/person to version 1.0.0 04) Run 2.0.0 05) Wait for the app (2.0.0) to boot 06) Generate a person by calling POST localhost:9991/person to version 1.0.0 07) Generate a person by calling POST localhost:9992/person to version 2.0.0 08) Kill app (1.0.0) 09) Run 3.0.0 10) Wait for the app (3.0.0) to boot 11) Generate a person by calling POST localhost:9992/person to version 2.0.0 12) Generate a person by calling POST localhost:9993/person to version 3.0.0 13) Kill app (3.0.0) 14) Run 4.0.0 15) Wait for the app (4.0.0) to boot 16) Generate a person by calling POST localhost:9993/person to version 3.0.0 17) Generate a person by calling POST localhost:9994/person to version 4.0.0 Starting app in version 1.0.0 Generate a person in version 1.0.0 Sending a post to 127.0.0.1:9991/person. This is the response: {"firstName":"52b6e125-4a5c-429b-a47a-ef18bbc639d2","lastName":"52b6e125-4a5c-429b-a47a-ef18bbc639d2"} Starting app in version 2.0.0 Generate a person in version 1.0.0 Sending a post to 127.0.0.1:9991/person. This is the response: {"firstName":"e41ee756-4fa7-4737-b832-e28827a00deb","lastName":"e41ee756-4fa7-4737-b832-e28827a00deb"} Generate a person in version 2.0.0 Sending a post to 127.0.0.1:9992/person. This is the response: {"firstName":"0c1240f5-649a-4bc5-8aa9-cff855f3927f","lastName":"0c1240f5-649a-4bc5-8aa9-cff855f3927f","surname":"0c1240f5-649a-4bc5-8aa9-cff855f3927f"} Killing app 1.0.0 Starting app in version 3.0.0 Generate a person in version 2.0.0 Sending a post to 127.0.0.1:9992/person. This is the response: {"firstName":"74d84a9e-5f44-43b8-907c-148c6d26a71b","lastName":"74d84a9e-5f44-43b8-907c-148c6d26a71b","surname":"74d84a9e-5f44-43b8-907c-148c6d26a71b"} Generate a person in version 3.0.0 Sending a post to 127.0.0.1:9993/person. This is the response: {"firstName":"c6564dbe-9ab5-40ae-9077-8ae6668d5862","surname":"c6564dbe-9ab5-40ae-9077-8ae6668d5862"} Killing app 2.0.0 Starting app in version 4.0.0 Generate a person in version 3.0.0 Sending a post to 127.0.0.1:9993/person. This is the response: {"firstName":"cbe942fc-832e-45e9-a838-0fae25c10a51","surname":"cbe942fc-832e-45e9-a838-0fae25c10a51"} Generate a person in version 4.0.0 Sending a post to 127.0.0.1:9994/person. This is the response: {"firstName":"ff6857ce-9c41-413a-863e-358e2719bf88","surname":"ff6857ce-9c41-413a-863e-358e2719bf88"}</code> </pre> <br><h3 id="izmeneniya-db-1" style=";text-align:right;direction:rtl">  ุงูุชุบููุฑุงุช DB </h3><br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ุฅูู <code>v3</code> ูุฒูู ุจุจุณุงุทุฉ ุนููุฏ <code>last_name</code> ููุถูู ุงููููุฏ ุงูููููุฏุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">-- REMOVE THE COLUMN ALTER TABLE PERSON DROP last_name; -- ADD CONSTRAINTS UPDATE PERSON SET surname='' WHERE surname IS NULL; ALTER TABLE PERSON ALTER COLUMN surname VARCHAR NOT NULL;</code> </pre> <br><h3 id="izmeneniya-koda-4" style=";text-align:right;direction:rtl">  ุชุบููุฑุงุช ุงูุฑูุฒ </h3><br><p style=";text-align:right;direction:rtl">  ูุง ุชูุฌุฏ ุชุบููุฑุงุช ูู ุงูููุฏ. </p><br><h3 id="vyvod" style=";text-align:right;direction:rtl">  ุงุณุชูุชุงุฌ </h3><br><p style=";text-align:right;direction:rtl">  ุทุจููุง ุจูุฌุงุญ ุชุบููุฑ ุงุณู ุงูุนููุฏ ุบูุฑ ุงููุชูุงูู ุฅูู ุงูุฎูู ุนู ุทุฑูู ุฅุฌุฑุงุก ุงูุนุฏูุฏ ูู ุนูููุงุช ุงููุดุฑ ุงููุชูุงููุฉ ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ.  ูููุง ููู ููุฎุต ููุฎุทูุงุช ุงููุชุฎุฐุฉ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅุตุฏุงุฑ ูุดุฑ ุงูุชุทุจูู <code>1.0.0</code> ูุน ูุฎุทุท ูุงุนุฏุฉ ุจูุงูุงุช <code>v1</code> (ุงุณู ุงูุนููุฏ = ุงุณู ุงูุนุงุฆูุฉ) </li><li style=";text-align:right;direction:rtl">  ูุดุฑ ุชุทุจูู ุงูุฅุตุฏุงุฑ <code>2.0.0,</code> ููุง ูุญูุธ ุงูุจูุงูุงุช ูู <code>last_name</code> <code>surname</code> .  ููุฑุฃ ุงูุชุทุจูู ูู <code>last_name</code> .  ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ุงูุฅุตุฏุงุฑ <code>v2</code> ุ ุงูุฐู ูุญุชูู ุนูู ุฃุนูุฏุฉ ูู ูู <code>last_name</code> <code>surname. surname</code>  <code>surname. surname</code> ูู ูุณุฎุฉ ูู l <code>ast_name</code> . (:       not null) </li><li style=";text-align:right;direction:rtl">    <code>3.0.0</code> ,      <code>surname</code>    surname.   ,     <code>last_name</code>  <code>surname</code> .   <strong>NOT NULL</strong>   <code>last_name</code> .     <code>v3</code> </li><li style=";text-align:right;direction:rtl">    <code>4.0.0</code> โ      .    <code>v4</code> ,   <code>last_name</code> .         . </li></ol><br><p style=";text-align:right;direction:rtl">   ,        ,      / . </p><br><h3 id="kod" style=";text-align:right;direction:rtl">  ูุงููู </h3><br><p style=";text-align:right;direction:rtl">  ,    ,   <a href="https://github.com/spring-cloud-samples/zero-downtime-deployment">Github</a> .   . </p><br><h3 id="proekty" style=";text-align:right;direction:rtl">  </h3><br><p style=";text-align:right;direction:rtl">   ,     . </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">โโโ boot-flyway-v1 - 1.0.0 version of the app with v1 of the schema โโโ boot-flyway-v2 - 2.0.0 version of the app with v2 of the schema (backward-compatible - app can be rolled back) โโโ boot-flyway-v2-bad - 2.0.0.BAD version of the app with v2bad of the schema (backward-incompatible - app cannot be rolled back) โโโ boot-flyway-v3 - 3.0.0 version of the app with v3 of the schema (app can be rolled back) โโโ boot-flyway-v4 - 4.0.0 version of the app with v4 of the schema (app can be rolled back)</code> </pre> <br><h3 id="skripty" style=";text-align:right;direction:rtl">  </h3><br><p style=";text-align:right;direction:rtl">    ,    ,         . </p><br><p style=";text-align:right;direction:rtl">   <strong>    </strong> , : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">./scripts/scenario_backward_compatible.sh</code> </pre> <br><p style=";text-align:right;direction:rtl">    <strong>    </strong> , : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">./scripts/scenario_backward_incompatible.sh</code> </pre> <br><h3 id="spring-boot-sample-flyway" style=";text-align:right;direction:rtl"> Spring Boot Sample Flyway </h3><br><p style=";text-align:right;direction:rtl">     <code>Spring Boot Sample Flyway.</code> </p><br><p style=";text-align:right;direction:rtl">     <code>http://localhost:8080/flyway</code> ,   . </p><br><p style=";text-align:right;direction:rtl">        H2 (  <code>http://localhost:8080/h2-console</code> ),        (URL jdbc   โ <code>jdbc:h2:mem:testdb</code> ). </p><br><h2 id="dopolnitelno" style=";text-align:right;direction:rtl">  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู </h2><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <a href="https://databaserefactoring.com/">Database Refactoring patterns</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://martinfowler.com/bliki/ContinuousDelivery.html">Continuous Delivery</a> </li></ul><br><h2 id="takzhe-chitayte-drugie-stati-v-nashem-bloge" style=";text-align:right;direction:rtl">  ุงูุฑุฃ ุฃูุถูุง ููุงูุงุช ุฃุฎุฑู ุนูู ูุฏููุชูุง: </h2><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://habr.com/ru/company/nixys/blog/480072/">Kubernetes: ูุง ุฃูููุฉ ุฅุนุฏุงุฏ ุฅุฏุงุฑุฉ ููุงุฑุฏ ุงููุธุงูุ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://habr.com/ru/company/nixys/blog/481992/">Tekton Pipeline - ุฎุทูุท ุฃูุงุจูุจ Kubernetes ุงูุฃุตููุฉ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://habr.com/ru/company/nixys/blog/473578/">ุจูุงุก ูุญุฏุงุช ุฏููุงููููุฉ ู Nginx</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://habr.com/ru/company/nixys/blog/473014/">ููุฏูุฉ ูู ุชุฑุฎูุต Kubernetes ูู Hashicorp ุงูููุตู</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://habr.com/ru/company/nixys/blog/468779/">ูุง ูุงู ูุชูุฌุฉ ุงูุชุฑุญูู ูู ClickHouse ุฏูู ุงูุญุตูู ุนูู ุฅุฐู ูู ClickHouse ุจุชุฑุฎูุต</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://habr.com/ru/company/nixys/blog/470568/">ูุดุฑ ุงูุฃุฒุฑู ูุงูุฃุฎุถุฑ ูู ุชุทุจููุงุช ุงูุฑุจูุน ูุน ุฎุงุฏู ููุจ Nginx</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar481932/">https://habr.com/ru/post/ar481932/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar481916/index.html">ูุง ูู ุนุงู 2019 ูู ุงูุชูููุฉ ุงูุชู ุชุฐูุฑุชุ</a></li>
<li><a href="../ar481922/index.html">ุงูุณูุฉ ุงูุฌุฏูุฏุฉ IMaskjs 6 - ุฑุฏ ูุนู ุงูุฃุตูู ุ ุฃูุงุจูุจ ุ ESM</a></li>
<li><a href="../ar481924/index.html">ุงุจุงุชุดู ุณุจุงุฑู ุ ุชูููู ูุณูู ูุงุณุชุนูุงูุงุช SQL ูุชุนุฏุฏุฉ ุงูุตูุญุงุช</a></li>
<li><a href="../ar481926/index.html">ุชุนุฑู ุนูู Veeam Backup for AWS Solution</a></li>
<li><a href="../ar481930/index.html">ุซูุงูุฉ ุงูุชูููุฉ: ููู ูุชู ุชูููู ุงูุฃุฏุงุก ูุงูููุงุกุฉ</a></li>
<li><a href="../ar481934/index.html">ุชุญููู: ููุงุฐุง ุฃุณูู ุชุณูุง ุชููู ูู ุงูุณุนุฑ</a></li>
<li><a href="../ar481936/index.html">ุฅูุฌุงุจูุงุช ูุณูุจูุงุช ุงุฎุชุจุงุฑุงุช A / B: ุชุฌุฑุจุฉ ุงูุดุฑูุงุช ุงููุจูุฑุฉ</a></li>
<li><a href="../ar481940/index.html">ุนูู ุณุฑูุน ููุนุงู ูู ุณุทุฑ ุงูุฃูุงูุฑ</a></li>
<li><a href="../ar481942/index.html">ุงูุนูุฏุฉ ุฅูู ุงููุณุชูุจู: ูุง ูู ุงูุฃูุนุงุจ ุงูุญุฏูุซุฉ ุงูุชู ุชู ุชูุฏูููุง ูู ุนุงู 2010</a></li>
<li><a href="../ar481944/index.html">ูุง ุงูุฐู ูุญุฏุฏ ูููุน ุงููููุน ุนูู ุตูุญุฉ ุงูุจุญุซุ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>