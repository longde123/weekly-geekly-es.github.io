<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚋 ☝️ 🤖 SNA Hackathon 2019 🍊 🤳🏼 🧡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En febrero-marzo de 2019, se realizó una competencia para clasificar el feed de la red social SNA Hackathon 2019 , en el que nuestro equipo ocupó el p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SNA Hackathon 2019</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447376/"><p>  En febrero-marzo de 2019, se realizó una competencia para clasificar el feed de la red social <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SNA Hackathon 2019</a> , en el que nuestro equipo ocupó el primer lugar.  En este artículo hablaré sobre la organización del concurso, los métodos que probamos y la configuración de catboost para el entrenamiento en big data. </p><br><p><img src="https://habrastorage.org/webt/8b/bd/vv/8bbdvvg9ih5_0h5tdqmx4fho3io.jpeg"></p><a name="habracut"></a><br><p>  <strong>SNA Hackathon</strong> </p><br><p>  El hackathon bajo este nombre se lleva a cabo por tercera vez.  Está organizado por la red social ok.ru, respectivamente, la tarea y los datos están directamente relacionados con esta red social. <br>  SNA (análisis de redes sociales) en este caso se entiende mejor no como un análisis de un gráfico social, sino más bien como un análisis de una red social. </p><br><ul><li>  En 2014, la tarea era predecir la cantidad de me gusta que ganaría la publicación. </li><li>  En 2016, el objetivo de la VVZ (tal vez esté familiarizado), más cerca del análisis del gráfico social. </li><li>  En 2019: clasificación del feed de un usuario según la probabilidad de que al usuario le guste la publicación. </li></ul><br><p>  No puedo decir sobre 2014, pero en 2016 y 2019, además de la capacidad de analizar datos, también se requerían habilidades para trabajar con big data.  Creo que fue la combinación del aprendizaje automático y las tareas de procesamiento de big data lo que me atrajo a estos concursos, y la experiencia en estas áreas ayudó a ganar. </p><br><p>  <strong>mlbootcamp</strong> </p><br><p>  En 2019, la competencia se organizó en la plataforma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://mlbootcamp.ru</a> . </p><br><p>  La competencia comenzó en línea el 7 de febrero y consistió en 3 tareas.  Todos podían registrarse en el sitio, descargar la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">línea de base</a> y subir su automóvil durante varias horas.  Al final de la etapa en línea el 15 de marzo, los 15 mejores de cada programa fueron invitados a la oficina de Mail.ru para la etapa fuera de línea, que tuvo lugar del 30 de marzo al 1 de abril. </p><br><h1 id="zadacha">  Desafío </h1><br><p>  Los datos de origen proporcionan identificadores de usuario (userId) e identificadores de publicación (objectId).  Si al usuario se le mostró una publicación, los datos contienen una línea que contiene userId, objectId, reacciones del usuario a esta publicación (comentarios) y un conjunto de varios signos o enlaces a imágenes y textos. </p><br><table><thead><tr><th>  ID de usuario </th><th>  objectId </th><th>  ID de propietario </th><th>  retroalimentación </th><th>  imágenes </th></tr></thead><tbody><tr><td>  3555 </td><td>  22 </td><td>  5677 </td><td>  [gustó, hizo clic] </td><td>  [hash1] </td></tr><tr><td>  12842 </td><td>  55 </td><td>  32144 </td><td>  [disgustado] </td><td>  [hash2, hash3] </td></tr><tr><td>  13145 </td><td>  35 </td><td>  5677 </td><td>  [hecho clic, compartido] </td><td>  [hash2] </td></tr></tbody></table><br><p>  El conjunto de datos de prueba contiene una estructura similar, pero falta el campo de retroalimentación.  El objetivo es predecir la presencia de una reacción 'me gusta' en el campo de retroalimentación. <br>  El archivo de envío tiene la siguiente estructura: </p><br><table><thead><tr><th>  ID de usuario </th><th>  SortedList [objectId] </th></tr></thead><tbody><tr><td>  123 </td><td>  78.13.54.22 </td></tr><tr><td>  128 </td><td>  35,61,55 </td></tr><tr><td>  131 </td><td>  35,68,129,11 </td></tr></tbody></table><br><p>  Métrica: promedio de ROC AUC por usuarios. </p><br><p>  Se puede encontrar una descripción más detallada de los datos en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el sitio de perfección</a> .  También puede descargar datos allí, incluidas pruebas e imágenes. </p><br><p>  <strong>Etapa en línea</strong> </p><br><p>  En la etapa en línea, la tarea se dividió en 3 partes. </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sistema colaborativo</a> : incluye todos los signos, excepto imágenes y textos; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Imágenes</a> : incluye solo información sobre imágenes; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Textos</a> : incluye información solo sobre textos. </li></ul><br><p>  <strong>Etapa fuera de línea</strong> </p><br><p>  En la etapa fuera de línea, los datos incluían todos los atributos, mientras que los textos e imágenes eran escasos.  Había 1.5 veces más filas en el conjunto de datos, de las cuales ya había muchas. </p><br><h1 id="reshenie-zadachi">  Resolución de problemas </h1><br><p>  Como estoy haciendo CV en el trabajo, comencé mi viaje en esta competencia con la tarea "Imágenes".  Los datos que se proporcionaron son userId, objectId, ownerId (el grupo en el que se publica la publicación), marcas de tiempo para crear y mostrar la publicación y, por supuesto, la imagen de esta publicación. <br>  Después de generar varias características basadas en la marca de tiempo, la siguiente idea fue tomar la penúltima capa de la neurona pre-entrenada en imagenet y enviar estas incorporaciones para impulsar. </p><br><p><img src="https://habrastorage.org/webt/g6/pq/id/g6pqidmcs0hqgilcqvmii7qdzz0.png"></p><br><p>  Los resultados no fueron impresionantes.  Las incrustaciones de la neurona imagenet son irrelevantes, pensé, necesito archivar mi codificador automático. </p><br><p><img src="https://habrastorage.org/webt/8b/n_/pu/8bn_pui29109tsvwsf_s5sktlgq.png"></p><br><p>  Tomó mucho tiempo y el resultado no mejoró. </p><br><p>  <strong>Generación de funciones</strong> </p><br><p>  Trabajar con imágenes lleva mucho tiempo, y decidí hacer algo más simple. <br>  Como puede ver de inmediato, hay varios signos categóricos en el conjunto de datos, y para no molestar mucho, simplemente tomé catboost.  La solución fue excelente, sin ninguna configuración, inmediatamente llegué a la primera línea de la tabla de clasificación. </p><br><p>  Hay muchos datos y se presentan en formato de parquet, así que sin pensarlo dos veces, tomé scala y comencé a escribir todo con chispa. </p><br><p>  Las características más simples, que dieron más crecimiento que las incrustaciones de imágenes: </p><br><ul><li>  cuántas veces objectId, userId y ownerId se encontraron en los datos (debería correlacionarse con la popularidad); </li><li>  cuántas publicaciones userId vio el ownerId (debe correlacionarse con el interés del usuario en el grupo); </li><li>  cuántos ID de usuario únicos miraron publicaciones por ownerId (refleja el tamaño de la audiencia del grupo). </li></ul><br><p>  A partir de las marcas de tiempo, era posible obtener la hora del día en que el usuario miraba la cinta (mañana / día / tarde / noche).  Al combinar estas categorías, puede continuar generando características: </p><br><ul><li>  cuántas veces userId inició sesión en la noche; </li><li>  a qué hora se muestra a menudo esta publicación (objectId), etc. </li></ul><br><p>  Todo esto gradualmente mejoró la métrica.  Pero el tamaño del conjunto de datos de capacitación es de aproximadamente 20 millones de registros, por lo que agregar funciones ralentizó en gran medida el aprendizaje. </p><br><p>  Redefiní el enfoque de uso de datos.  Aunque los datos dependen del tiempo, no he visto ninguna filtración de información explícita en el futuro, sin embargo, por si acaso, la rompí así: </p><br><p><img src="https://habrastorage.org/webt/jf/zr/gq/jfzrgq7s0l3q465pa-cc0x-rkxq.png"></p><br><p>  El conjunto de capacitación que se nos proporcionó (febrero y 2 semanas de marzo) se dividió en 2 partes. <br>  Sobre los datos de los últimos N días, entrenó al modelo.  Las agregaciones descritas anteriormente se construyeron sobre todos los datos, incluida la prueba.  Al mismo tiempo, aparecieron datos sobre los que se pueden construir varios codificadores de la variable objetivo.  El enfoque más simple es reutilizar el código que ya está creando nuevas características, y simplemente proporcionarle datos que no serán entrenados y objetivo = 1. </p><br><p>  Por lo tanto, tenemos características similares: </p><br><ul><li>  Cuántas veces userId ha visto una publicación en el grupo ownerId; </li><li>  Cuántas veces a userId le gustó la publicación en ownerId; </li><li>  El porcentaje de publicaciones que a userId le gustó ownerId. </li></ul><br><p>  Es decir, resultó la <em>codificación objetivo media</em> por parte del conjunto de datos de acuerdo con varias combinaciones de características categóricas.  En principio, catboost también crea codificación de destino, y desde este punto de vista no hay ningún beneficio, pero, por ejemplo, se hizo posible contar el número de usuarios únicos a quienes les gustan las publicaciones en este grupo.  Al mismo tiempo, se logró el objetivo principal: mi conjunto de datos disminuyó varias veces y fue posible continuar generando características. </p><br><p>  Si bien catboost solo puede construir codificadores de acuerdo con la reacción que le gusta, la retroalimentación tiene otras reacciones: compartir, no me gusta, no me gusta, hacer clic, ignorar, lo que se puede hacer manualmente.  Conté todo tipo de agregados y seleccioné las características con poca importancia, para no inflar el conjunto de datos. </p><br><p>  En ese momento estaba en primer lugar por un amplio margen.  La única vergüenza fue que la incrustación de las imágenes casi no dio ganancias.  La idea surgió para dar todo a catboost.  Agrupe las imágenes de Kmeans y obtenga una nueva característica categórica imageCat. </p><br><p>  Aquí hay algunas clases después de filtrar y fusionar manualmente los clústeres obtenidos de KMeans. </p><br><p><img src="https://habrastorage.org/webt/i3/s5/m2/i3s5m2ftpdmvr0m_0dvpau4eggs.png"></p><br><p>  Basado en imageCat generamos: </p><br><ul><li>  Nuevas características categóricas: <br><ul><li>  Qué imageCat parecía más frecuentemente userId; </li><li>  Qué imageCat se muestra con mayor frecuencia por ownerId; </li><li>  ¿Qué imageCat le gusta más a menudo userId; </li></ul></li><li>  Varios contadores: <br><ul><li>  Cuántos imageCat únicos parecían userId; </li><li>  Alrededor de 15 características similares más codificación de destino como se describe anteriormente. </li></ul></li></ul><br><p>  <strong>Textos</strong> </p><br><p>  Los resultados en el concurso de imágenes me convencieron y decidí probarme en los textos.  Anteriormente, no trabajaba mucho con textos y, por estupidez, mataba un día en tf-idf y svd.  Luego vi una línea de base con doc2vec, que hace justo lo que necesito.  Habiendo ajustado ligeramente los parámetros de doc2vec, recibí incrustaciones de texto. </p><br><p>  Y luego simplemente reutilizó el código para las imágenes, en el que reemplazó las incrustaciones de imágenes con incrustaciones de texto.  Como resultado, llegué al segundo lugar en el concurso de texto. </p><br><p>  <strong>Sistema colaborativo</strong> </p><br><p>  Solo había una competencia en la que todavía no había "golpeado un palo", pero a juzgar por las AUC en la clasificación, los resultados de esta competencia en particular deberían haber tenido el mayor impacto en el escenario fuera de línea. <br>  Tomé todos los signos que estaban en los datos de origen, seleccioné los categóricos y calculé los mismos agregados que para las imágenes, excepto las características de las imágenes mismas.  Simplemente poniéndolo en catboost, llegué al segundo lugar. </p><br><h1 id="pervye-shagi-optimizacii-catboost">  Los primeros pasos para optimizar catboost </h1><br><p>  Un primer y dos segundos lugares me complacieron, pero entendí que no hice nada especial, lo que significa que podemos esperar una pérdida de posición. </p><br><p>  La tarea de la competencia es clasificar las publicaciones dentro del marco del usuario, y todo este tiempo he estado resolviendo el problema de clasificación, es decir, he optimizado la métrica incorrecta. </p><br><p>  Daré un ejemplo simple: </p><br><table><thead><tr><th>  ID de usuario </th><th>  objectId </th><th>  predicción </th><th>  verdad fundamental </th></tr></thead><tbody><tr><td>  1 </td><td>  10 </td><td>  0.9 </td><td>  1 </td></tr><tr><td>  1 </td><td>  11 </td><td>  0.8 </td><td>  1 </td></tr><tr><td>  1 </td><td>  12 </td><td>  0.7 </td><td>  1 </td></tr><tr><td>  1 </td><td>  13 </td><td>  0.6 </td><td>  1 </td></tr><tr><td>  1 </td><td>  14 </td><td>  0.5 0.5 </td><td>  0 0 </td></tr><tr><td>  2 </td><td>  15 </td><td>  0.4 0.4 </td><td>  0 0 </td></tr><tr><td>  2 </td><td>  16 </td><td>  0,3 </td><td>  1 </td></tr></tbody></table><br><p>  Hacemos una pequeña permutación </p><br><table><thead><tr><th>  ID de usuario </th><th>  objectId </th><th>  predicción </th><th>  verdad fundamental </th></tr></thead><tbody><tr><td>  1 </td><td>  10 </td><td>  0.9 </td><td>  1 </td></tr><tr><td>  1 </td><td>  11 </td><td>  0.8 </td><td>  1 </td></tr><tr><td>  1 </td><td>  12 </td><td>  0.7 </td><td>  1 </td></tr><tr><td>  1 </td><td>  13 </td><td>  0.6 </td><td>  0 0 </td></tr><tr><td>  2 </td><td>  16 </td><td>  0.5 0.5 </td><td>  1 </td></tr><tr><td>  2 </td><td>  15 </td><td>  0.4 0.4 </td><td>  0 0 </td></tr><tr><td>  1 </td><td>  14 </td><td>  0,3 </td><td>  1 </td></tr></tbody></table><br><p>  Obtenemos los siguientes resultados: </p><br><table><thead><tr><th>  Modelo </th><th>  Auc </th><th>  Usuario1 AUC </th><th>  Usuario2 AUC </th><th>  AUC medio </th></tr></thead><tbody><tr><td>  Opcion 1 </td><td>  0.8 </td><td>  1,0 </td><td>  0,0 </td><td>  0.5 0.5 </td></tr><tr><td>  Opción 2 </td><td>  0.7 </td><td>  0,75 </td><td>  1,0 </td><td>  0.875 </td></tr></tbody></table><br><p>  Como puede ver, mejorar la métrica general de AUC no significa mejorar la métrica promedio de AUC dentro del usuario. </p><br><p>  Catboost <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">puede optimizar las métricas de clasificación de forma</a> inmediata.  Leí sobre métricas de clasificación, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">historias de éxito</a> cuando uso catboost y configuré YetiRankPairwise para estudiar durante la noche.  El resultado no fue impresionante.  Habiendo decidido que no había aprendido bien, cambié la función de error a QueryRMSE, que, a juzgar por la documentación de catboost, converge más rápido.  Como resultado, obtuve los mismos resultados que durante el entrenamiento para la clasificación, pero los conjuntos de estos dos modelos dieron un buen aumento, lo que me llevó a los primeros lugares en las tres competiciones. </p><br><p>  5 minutos antes del cierre de la etapa en línea en la competencia Collaborative Systems, Sergey Shalnov me trasladó al segundo lugar.  La forma en que fuimos juntos. </p><br><h1 id="podgotovka-k-oflayn-etapu">  Preparación para la fase fuera de línea </h1><br><p>  La victoria en la etapa en línea nos fue garantizada en la tarjeta de video RTX 2080 TI, pero el premio principal de 300,000 rublos y, más bien, incluso el primer lugar final nos obligó a trabajar estas 2 semanas. </p><br><p>  Al final resultó que, Sergey también usó catboost.  Intercambiamos ideas y características, y descubrí el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">informe de Anna Veronika Dorogush</a> en el que había respuestas a muchas de mis preguntas, e incluso a aquellas que aún no había aparecido. </p><br><p>  Ver el informe me llevó a la idea de que es necesario devolver todos los parámetros al valor predeterminado y ajustar la configuración con mucho cuidado y solo después de corregir un conjunto de signos.  Ahora, un entrenamiento tomó aproximadamente 15 horas, pero un modelo logró obtener la velocidad mejor que en el conjunto con la clasificación. </p><br><p>  <strong>Generación de funciones</strong> </p><br><p>  En la competencia "Sistemas de colaboración" se evalúa una gran cantidad de características como importantes para el modelo.  Por ejemplo, <em>auditweights_spark_svd</em> es el atributo más importante y no hay información sobre lo que significa.  Pensé que valía la pena contar las distintas unidades en función de signos importantes.  Por ejemplo, el promedio auditweights_spark_svd por usuario, por grupo, por objeto.  Lo mismo se puede calcular a partir de los datos en los que no se realiza el entrenamiento y target = 1, es decir, el promedio de <em>auditweights_spark_svd</em> por usuario para los objetos que le gustaron.  <em>Hubo</em> varios signos importantes, además de <em>auditweights_spark_svd</em> .  Aquí hay algunos de ellos: </p><br><ul><li>  <em>auditweightsCtrGender</em> </li><li>  <em>auditweightsCtrHigh</em> </li><li>  <em>userOwnerCounterCreateLikes</em> </li></ul><br><p>  Por ejemplo, el valor promedio de <em>auditweightsCtrGender</em> por userId resultó ser una característica importante, así como el valor promedio de <em>userOwnerCounterCreateLikes</em> por userId + ownerId.  Esto debería habernos hecho pensar en cómo entender el significado de los campos. </p><br><p>  Otras características importantes fueron <em>auditweightsLikesCount</em> y <em>auditweightsShowsCount</em> .  Al dividir uno en otro, se obtuvo una característica aún más importante. </p><br><p>  <strong>Fugas de datos.</strong> </p><br><p>  Los modelos de competencia y producción son tareas muy diferentes.  Al preparar los datos, es muy difícil tener en cuenta todos los detalles y no transferir información no trivial sobre la variable objetivo en la prueba.  Si creamos una solución de producción, intentaremos evitar el uso de fugas de datos al entrenar el modelo.  Pero si queremos ganar el concurso, entonces las filtraciones de datos son las mejores características. </p><br><p>  Después de examinar los datos, puede ver que según objectId, los valores de <em>auditweightsLikesCount</em> y <em>auditweightsShowsCount</em> cambian, lo que significa que la proporción de los valores máximos de estos signos reflejará la conversión posterior mucho mejor que la proporción en el momento de la entrega. </p><br><p>  La primera fuga que encontramos fue <em>auditweightsLikesCountMax / auditweightsShowsCountMax</em> . <br>  Pero, ¿qué pasa si observa los datos más de cerca?  Ordenar por fecha de entrega y obtener: </p><br><table><thead><tr><th>  objectId </th><th>  ID de usuario </th><th>  auditweightsShowsCount </th><th>  auditweightsLikesCount </th><th>  objetivo (le gusta) </th></tr></thead><tbody><tr><td>  1 </td><td>  1 </td><td>  12 </td><td>  3 </td><td>  probablemente no </td></tr><tr><td>  1 </td><td>  2 </td><td>  15 </td><td>  3 </td><td>  probablemente si </td></tr><tr><td>  1 </td><td>  3 </td><td>  16 </td><td>  4 4 </td><td></td></tr></tbody></table><br><p>  Fue sorprendente cuando encontré el primer ejemplo de este tipo y resultó que mi predicción no se hizo realidad.  Pero, dado el hecho de que los valores máximos de estos signos dentro del marco del objeto aumentaron, no fuimos demasiado vagos y decidimos encontrar <em>auditweightsShowsCountNext</em> y <em>auditweightsLikesCountNext</em> , es decir, valores en el momento siguiente.  Añadiendo característica <br>  <em>(auditweightsShowsCountNext-auditweightsShowsCount) / (auditweightsLikesCount-auditweightsLikesCountNext)</em> hicimos un brusco salto durante todo el día. <br>  Se podrían usar fugas similares si se encuentran los siguientes valores para <em>userOwnerCounterCreateLikes</em> dentro de userId + ownerId y, por ejemplo, <em>auditweightsCtrGender</em> dentro de objectId + userGender.  Encontramos 6 campos similares con fugas y extrajimos información de ellos tanto como fue posible. </p><br><p>  Para entonces, habíamos exprimido un máximo de información de los atributos de colaboración, pero no volvimos a los concursos de imágenes y textos.  Hubo una gran idea para verificar: ¿cuánto dan las características directamente en las imágenes o textos en las competiciones correspondientes? </p><br><p>  No hubo fugas en los concursos de imágenes y textos, pero para ese momento había devuelto los parámetros predeterminados de catboost, peiné el código y agregué algunas características.  Resultado total: </p><br><table><thead><tr><th>  Solución </th><th>  velocidad </th></tr></thead><tbody><tr><td>  Máximo con imágenes </td><td>  0.6411 </td></tr><tr><td>  Máximo sin imágenes </td><td>  0.6297 </td></tr><tr><td>  Resultado del segundo lugar </td><td>  0.6295 </td></tr></tbody></table><br><table><thead><tr><th>  Solución </th><th>  velocidad </th></tr></thead><tbody><tr><td>  Máximo con textos </td><td>  0,666 </td></tr><tr><td>  Máximo sin textos </td><td>  0.660 </td></tr><tr><td>  Resultado del segundo lugar </td><td>  0,656 </td></tr></tbody></table><br><table><thead><tr><th>  Solución </th><th>  velocidad </th></tr></thead><tbody><tr><td>  Máximo en colaboración </td><td>  0,745 </td></tr><tr><td>  Resultado del segundo lugar </td><td>  0,723 </td></tr></tbody></table><br><p>  Se hizo evidente que era improbable que muchos textos e imágenes se eliminaran, y después de probar algunas de las ideas más interesantes, dejamos de trabajar con ellos. </p><br><p>  La generación adicional de características en sistemas colaborativos no dio crecimiento, y comenzamos a clasificar.  En la etapa en línea, el conjunto de clasificación y clasificación me dio un pequeño aumento, ya que resultó que tenía una clasificación poco entrenada.  Ninguna de las funciones de error, incluido YetiRanlPairwise, incluso dio resultados cercanos que LogLoss dio (0.745 contra 0.725).  Había esperanza de que QueryCrossEntropy no se pudiera iniciar. </p><br><h1 id="oflayn-etap">  Etapa fuera de línea </h1><br><p>  En la etapa fuera de línea, la estructura de datos se ha mantenido igual, pero ha habido pequeños cambios: </p><br><ul><li>  los identificadores userId, objectId, ownerId se han aleatorizado nuevamente; </li><li>  Se eliminaron varios letreros y se cambió el nombre de varios. </li><li>  los datos se han convertido en 1,5 veces más. </li></ul><br><p>  Además de las dificultades enumeradas, hubo una gran ventaja: se asignó un gran servidor con RTX 2080TI al equipo.  Disfruté htop por mucho tiempo. <br><img src="https://habrastorage.org/webt/0c/6n/zp/0c6nzpburmw8nxsxz9y8iwkxmwa.jpeg"></p><br><p>  La idea era una: solo reproducir lo que ya está allí.  Después de pasar un par de horas configurando el entorno en el servidor, gradualmente comenzamos a verificar que los resultados se estaban reproduciendo.  El principal problema que enfrentamos es el aumento en el volumen de datos.  Decidimos reducir ligeramente la carga y establecer el parámetro catboost ctr_complexity = 1.  Esto reduce un poco la velocidad, pero mi modelo comenzó a funcionar, el resultado fue bueno: 0.733.  Sergei, a diferencia de mí, no dividió los datos en 2 partes y se capacitó en todos los datos, aunque esto dio el mejor resultado en la etapa en línea, hubo muchas dificultades en la etapa fuera de línea.  Si tomamos todas las características que hemos generado y tratamos de ponerlo en catboost “en la frente”, entonces nada hubiera sucedido en la etapa en línea.  Sergey sí optimizó los tipos, por ejemplo, convirtiendo los tipos float64 en float32.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">En este artículo</a> puede encontrar información sobre cómo optimizar la memoria en pandas.  Como resultado, Sergey se entrenó en la CPU en todos los datos y resultó aproximadamente 0.735. </p><br><p>  Estos resultados fueron suficientes para ganar, pero ocultamos nuestra velocidad real y no podíamos estar seguros de que otros equipos no estuvieran haciendo lo mismo. </p><br><h1 id="bitva-do-poslednego">  Batalla hasta el final </h1><br><p>  <strong>Tuning catboost</strong> </p><br><p>  Nuestra solución se reprodujo por completo, agregamos características de datos de texto e imágenes, por lo que todo lo que quedaba era ajustar los parámetros de catboost.  Sergey estudió en la CPU con un pequeño número de iteraciones, y yo estudié con ctr_complexity = 1.  Solo quedaba un día, y si solo agrega iteraciones o aumenta ctr_complexity, por la mañana podría obtener una velocidad aún mejor y caminar todo el día. </p><br><p>  En la etapa fuera de línea, los puntajes podrían ser muy fáciles de ocultar, simplemente eligiendo no la mejor solución en el sitio.  Esperábamos cambios bruscos en la clasificación en los últimos minutos antes del cierre de las presentaciones y decidimos no parar. </p><br><p>  Del video de Anna, aprendí que para mejorar la calidad del modelo, es mejor seleccionar los siguientes parámetros: </p><br><ul><li>  <em>learning_rate</em> : el valor predeterminado se calcula en función del tamaño del conjunto de datos.  Con una disminución en la tasa de aprendizaje, para mantener la calidad, es necesario aumentar el número de iteraciones. </li><li>  <em>l2_leaf_reg</em> : coeficiente de regularización, valor predeterminado de 3, preferiblemente de 2 a 30. Una disminución en el valor conduce a un aumento en el sobreajuste. </li><li>  <em>bagging_temperature</em> : agrega aleatorización a los pesos de los objetos en la selección.  El valor predeterminado es 1, en el que los pesos se seleccionan de la distribución exponencial.  Una disminución en el valor conduce a un aumento en el sobreajuste. </li><li>  <em>random_strength</em> - Afecta la elección de divisiones para una iteración particular.  Cuanto mayor sea random_strength, mayor será la posibilidad de que se seleccione una división de baja importancia.  En cada iteración posterior, la aleatoriedad disminuye.  Una disminución en el valor conduce a un aumento en el sobreajuste. </li></ul><br><p>  Otros parámetros afectan significativamente menos el resultado final, por lo que no intenté seleccionarlos.  Una iteración de entrenamiento en mi conjunto de datos de GPU con ctr_complexity = 1 tomó 20 minutos, y los parámetros seleccionados en el conjunto de datos reducido fueron ligeramente diferentes de los óptimos en el conjunto de datos completo.  Como resultado, hice unas 30 iteraciones en el 10% de los datos, y luego unas 10 iteraciones más en todos los datos.  Resultó aproximadamente lo siguiente: </p><br><ul><li>  Aumenté <em>learning_rate</em> en un 40% del valor predeterminado; </li><li>  <em>l2_leaf_reg</em> dejó lo mismo; </li><li>  <em>bagging_temperature</em> y <em>random_strength</em> reducido a 0.8. </li></ul><br><p>  Podemos concluir que con los parámetros predeterminados, el modelo está poco capacitado. </p><br><p>  Me sorprendió mucho cuando vi el resultado en la tabla de clasificación: </p><br><table><thead><tr><th>  Modelo </th><th>  modelo 1 </th><th>  modelo 2 </th><th>  modelo 3 </th><th>  conjunto </th></tr></thead><tbody><tr><td>  Sin sintonización </td><td>  0.7403 </td><td>  0.7404 </td><td>  0.7404 </td><td>  0.7407 </td></tr><tr><td>  Con afinación </td><td>  0.7406 </td><td>  0.7405 </td><td>  0.7406 </td><td>  0.7408 </td></tr></tbody></table><br><p>  Llegué a la conclusión de que si no necesita una aplicación rápida del modelo, entonces es mejor reemplazar la selección de parámetros con un conjunto de varios modelos en parámetros no optimizados. </p><br><p>  Sergey se ocupó de optimizar el tamaño del conjunto de datos para ejecutarlo en la GPU.    —    ,      : </p><br><ul><li>      ( ),       ; </li><li>      ; </li><li>  userId,      ; </li><li>   userId,    . </li></ul><br><p>     —     . </p><br><p> <strong> </strong> </p><br><p>          ,   0,742.        ctr_complexity=2   30    5 .   4   ,     ,      0,7433. </p><br><p>       ,     ,      .          predict(prediction_type='RawFormulaVal')   scale_pos_weight=neg_count/pos_count. </p><br><p><img src="https://habrastorage.org/webt/ki/yv/yj/kiyvyjpnsouo46k-ny9e9hmyjxa.png"></p><br><p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">    </a> . </p><br><p> <strong> </strong> </p><br><p>       . ,      ,    ,   2  . </p><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  </a> . ,   Mail.ru,    ,         ,     . </li><li>  ,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">   facebook</a> ,        . </li></ul><br><h1 id="zaklyuchenie">  Conclusión </h1><br><p>      : </p><br><ul><li>      ,       target encoding,     catboost. </li><li>     ,       ,  learning_rate  iterations.    —    . </li><li>     GPU. Catboost      GPU,    . </li><li>          rsm~=0.2 (CPU only)  ctr_complexity=1. </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A diferencia de otros equipos, el conjunto de nuestros modelos dio un gran aumento. </font><font style="vertical-align: inherit;">Intercambiamos ideas y escribimos en diferentes idiomas. </font><font style="vertical-align: inherit;">Teníamos un enfoque diferente para dividir los datos, y creo que todos tenían sus propios errores.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> No está claro por qué la optimización de clasificación arrojó peores resultados que la optimización de clasificación. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Obtuve un poco de experiencia con textos y entendí cómo se hacen los sistemas de recomendación. </font></font></li></ul><br><p><img src="https://habrastorage.org/webt/en/m_/to/enm_topolhyttqfezaldsddvjs0.jpeg"></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gracias a los organizadores por las emociones, el conocimiento y los premios recibidos. </font></font></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/447376/">https://habr.com/ru/post/447376/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447366/index.html">¿Cuál es la mejor manera de comenzar un proyecto o cómo hacerlo para que no sea tan doloroso?</a></li>
<li><a href="../447368/index.html">No solo atrapando pulgas. ¿Por qué la velocidad es tan importante para cualquier tienda?</a></li>
<li><a href="../447370/index.html">¿Por qué, debido a un sistema de patentes roto, la sombra de Theranos todavía se cierne sobre nosotros?</a></li>
<li><a href="../447372/index.html">La transformación de TI es inevitable: por dónde empezar</a></li>
<li><a href="../447374/index.html">Creación de elementos de interfaz mediante programación mediante PureLayout (Parte 2)</a></li>
<li><a href="../447380/index.html">Excepciones de Kotlin y sus características.</a></li>
<li><a href="../447382/index.html">El libro "Unidad y C #. Gamedev desde la idea hasta la implementación. 2da ed</a></li>
<li><a href="../447384/index.html">Potencia semiconductores en guardia de ecología</a></li>
<li><a href="../447388/index.html">TL; DR-digest de la Universidad ITMO: admisión no clásica a la universidad, próximos eventos y los materiales más interesantes</a></li>
<li><a href="../447390/index.html">Pautas de configuración de AccelStor AFA para VMware vSphere</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>