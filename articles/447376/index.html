<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöã ‚òùÔ∏è ü§ñ SNA Hackathon 2019 üçä ü§≥üèº üß°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En febrero-marzo de 2019, se realiz√≥ una competencia para clasificar el feed de la red social SNA Hackathon 2019 , en el que nuestro equipo ocup√≥ el p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SNA Hackathon 2019</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447376/"><p>  En febrero-marzo de 2019, se realiz√≥ una competencia para clasificar el feed de la red social <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SNA Hackathon 2019</a> , en el que nuestro equipo ocup√≥ el primer lugar.  En este art√≠culo hablar√© sobre la organizaci√≥n del concurso, los m√©todos que probamos y la configuraci√≥n de catboost para el entrenamiento en big data. </p><br><p><img src="https://habrastorage.org/webt/8b/bd/vv/8bbdvvg9ih5_0h5tdqmx4fho3io.jpeg"></p><a name="habracut"></a><br><p>  <strong>SNA Hackathon</strong> </p><br><p>  El hackathon bajo este nombre se lleva a cabo por tercera vez.  Est√° organizado por la red social ok.ru, respectivamente, la tarea y los datos est√°n directamente relacionados con esta red social. <br>  SNA (an√°lisis de redes sociales) en este caso se entiende mejor no como un an√°lisis de un gr√°fico social, sino m√°s bien como un an√°lisis de una red social. </p><br><ul><li>  En 2014, la tarea era predecir la cantidad de me gusta que ganar√≠a la publicaci√≥n. </li><li>  En 2016, el objetivo de la VVZ (tal vez est√© familiarizado), m√°s cerca del an√°lisis del gr√°fico social. </li><li>  En 2019: clasificaci√≥n del feed de un usuario seg√∫n la probabilidad de que al usuario le guste la publicaci√≥n. </li></ul><br><p>  No puedo decir sobre 2014, pero en 2016 y 2019, adem√°s de la capacidad de analizar datos, tambi√©n se requer√≠an habilidades para trabajar con big data.  Creo que fue la combinaci√≥n del aprendizaje autom√°tico y las tareas de procesamiento de big data lo que me atrajo a estos concursos, y la experiencia en estas √°reas ayud√≥ a ganar. </p><br><p>  <strong>mlbootcamp</strong> </p><br><p>  En 2019, la competencia se organiz√≥ en la plataforma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://mlbootcamp.ru</a> . </p><br><p>  La competencia comenz√≥ en l√≠nea el 7 de febrero y consisti√≥ en 3 tareas.  Todos pod√≠an registrarse en el sitio, descargar la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">l√≠nea de base</a> y subir su autom√≥vil durante varias horas.  Al final de la etapa en l√≠nea el 15 de marzo, los 15 mejores de cada programa fueron invitados a la oficina de Mail.ru para la etapa fuera de l√≠nea, que tuvo lugar del 30 de marzo al 1 de abril. </p><br><h1 id="zadacha">  Desaf√≠o </h1><br><p>  Los datos de origen proporcionan identificadores de usuario (userId) e identificadores de publicaci√≥n (objectId).  Si al usuario se le mostr√≥ una publicaci√≥n, los datos contienen una l√≠nea que contiene userId, objectId, reacciones del usuario a esta publicaci√≥n (comentarios) y un conjunto de varios signos o enlaces a im√°genes y textos. </p><br><table><thead><tr><th>  ID de usuario </th><th>  objectId </th><th>  ID de propietario </th><th>  retroalimentaci√≥n </th><th>  im√°genes </th></tr></thead><tbody><tr><td>  3555 </td><td>  22 </td><td>  5677 </td><td>  [gust√≥, hizo clic] </td><td>  [hash1] </td></tr><tr><td>  12842 </td><td>  55 </td><td>  32144 </td><td>  [disgustado] </td><td>  [hash2, hash3] </td></tr><tr><td>  13145 </td><td>  35 </td><td>  5677 </td><td>  [hecho clic, compartido] </td><td>  [hash2] </td></tr></tbody></table><br><p>  El conjunto de datos de prueba contiene una estructura similar, pero falta el campo de retroalimentaci√≥n.  El objetivo es predecir la presencia de una reacci√≥n 'me gusta' en el campo de retroalimentaci√≥n. <br>  El archivo de env√≠o tiene la siguiente estructura: </p><br><table><thead><tr><th>  ID de usuario </th><th>  SortedList [objectId] </th></tr></thead><tbody><tr><td>  123 </td><td>  78.13.54.22 </td></tr><tr><td>  128 </td><td>  35,61,55 </td></tr><tr><td>  131 </td><td>  35,68,129,11 </td></tr></tbody></table><br><p>  M√©trica: promedio de ROC AUC por usuarios. </p><br><p>  Se puede encontrar una descripci√≥n m√°s detallada de los datos en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el sitio de perfecci√≥n</a> .  Tambi√©n puede descargar datos all√≠, incluidas pruebas e im√°genes. </p><br><p>  <strong>Etapa en l√≠nea</strong> </p><br><p>  En la etapa en l√≠nea, la tarea se dividi√≥ en 3 partes. </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sistema colaborativo</a> : incluye todos los signos, excepto im√°genes y textos; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Im√°genes</a> : incluye solo informaci√≥n sobre im√°genes; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Textos</a> : incluye informaci√≥n solo sobre textos. </li></ul><br><p>  <strong>Etapa fuera de l√≠nea</strong> </p><br><p>  En la etapa fuera de l√≠nea, los datos inclu√≠an todos los atributos, mientras que los textos e im√°genes eran escasos.  Hab√≠a 1.5 veces m√°s filas en el conjunto de datos, de las cuales ya hab√≠a muchas. </p><br><h1 id="reshenie-zadachi">  Resoluci√≥n de problemas </h1><br><p>  Como estoy haciendo CV en el trabajo, comenc√© mi viaje en esta competencia con la tarea "Im√°genes".  Los datos que se proporcionaron son userId, objectId, ownerId (el grupo en el que se publica la publicaci√≥n), marcas de tiempo para crear y mostrar la publicaci√≥n y, por supuesto, la imagen de esta publicaci√≥n. <br>  Despu√©s de generar varias caracter√≠sticas basadas en la marca de tiempo, la siguiente idea fue tomar la pen√∫ltima capa de la neurona pre-entrenada en imagenet y enviar estas incorporaciones para impulsar. </p><br><p><img src="https://habrastorage.org/webt/g6/pq/id/g6pqidmcs0hqgilcqvmii7qdzz0.png"></p><br><p>  Los resultados no fueron impresionantes.  Las incrustaciones de la neurona imagenet son irrelevantes, pens√©, necesito archivar mi codificador autom√°tico. </p><br><p><img src="https://habrastorage.org/webt/8b/n_/pu/8bn_pui29109tsvwsf_s5sktlgq.png"></p><br><p>  Tom√≥ mucho tiempo y el resultado no mejor√≥. </p><br><p>  <strong>Generaci√≥n de funciones</strong> </p><br><p>  Trabajar con im√°genes lleva mucho tiempo, y decid√≠ hacer algo m√°s simple. <br>  Como puede ver de inmediato, hay varios signos categ√≥ricos en el conjunto de datos, y para no molestar mucho, simplemente tom√© catboost.  La soluci√≥n fue excelente, sin ninguna configuraci√≥n, inmediatamente llegu√© a la primera l√≠nea de la tabla de clasificaci√≥n. </p><br><p>  Hay muchos datos y se presentan en formato de parquet, as√≠ que sin pensarlo dos veces, tom√© scala y comenc√© a escribir todo con chispa. </p><br><p>  Las caracter√≠sticas m√°s simples, que dieron m√°s crecimiento que las incrustaciones de im√°genes: </p><br><ul><li>  cu√°ntas veces objectId, userId y ownerId se encontraron en los datos (deber√≠a correlacionarse con la popularidad); </li><li>  cu√°ntas publicaciones userId vio el ownerId (debe correlacionarse con el inter√©s del usuario en el grupo); </li><li>  cu√°ntos ID de usuario √∫nicos miraron publicaciones por ownerId (refleja el tama√±o de la audiencia del grupo). </li></ul><br><p>  A partir de las marcas de tiempo, era posible obtener la hora del d√≠a en que el usuario miraba la cinta (ma√±ana / d√≠a / tarde / noche).  Al combinar estas categor√≠as, puede continuar generando caracter√≠sticas: </p><br><ul><li>  cu√°ntas veces userId inici√≥ sesi√≥n en la noche; </li><li>  a qu√© hora se muestra a menudo esta publicaci√≥n (objectId), etc. </li></ul><br><p>  Todo esto gradualmente mejor√≥ la m√©trica.  Pero el tama√±o del conjunto de datos de capacitaci√≥n es de aproximadamente 20 millones de registros, por lo que agregar funciones ralentiz√≥ en gran medida el aprendizaje. </p><br><p>  Redefin√≠ el enfoque de uso de datos.  Aunque los datos dependen del tiempo, no he visto ninguna filtraci√≥n de informaci√≥n expl√≠cita en el futuro, sin embargo, por si acaso, la romp√≠ as√≠: </p><br><p><img src="https://habrastorage.org/webt/jf/zr/gq/jfzrgq7s0l3q465pa-cc0x-rkxq.png"></p><br><p>  El conjunto de capacitaci√≥n que se nos proporcion√≥ (febrero y 2 semanas de marzo) se dividi√≥ en 2 partes. <br>  Sobre los datos de los √∫ltimos N d√≠as, entren√≥ al modelo.  Las agregaciones descritas anteriormente se construyeron sobre todos los datos, incluida la prueba.  Al mismo tiempo, aparecieron datos sobre los que se pueden construir varios codificadores de la variable objetivo.  El enfoque m√°s simple es reutilizar el c√≥digo que ya est√° creando nuevas caracter√≠sticas, y simplemente proporcionarle datos que no ser√°n entrenados y objetivo = 1. </p><br><p>  Por lo tanto, tenemos caracter√≠sticas similares: </p><br><ul><li>  Cu√°ntas veces userId ha visto una publicaci√≥n en el grupo ownerId; </li><li>  Cu√°ntas veces a userId le gust√≥ la publicaci√≥n en ownerId; </li><li>  El porcentaje de publicaciones que a userId le gust√≥ ownerId. </li></ul><br><p>  Es decir, result√≥ la <em>codificaci√≥n objetivo media</em> por parte del conjunto de datos de acuerdo con varias combinaciones de caracter√≠sticas categ√≥ricas.  En principio, catboost tambi√©n crea codificaci√≥n de destino, y desde este punto de vista no hay ning√∫n beneficio, pero, por ejemplo, se hizo posible contar el n√∫mero de usuarios √∫nicos a quienes les gustan las publicaciones en este grupo.  Al mismo tiempo, se logr√≥ el objetivo principal: mi conjunto de datos disminuy√≥ varias veces y fue posible continuar generando caracter√≠sticas. </p><br><p>  Si bien catboost solo puede construir codificadores de acuerdo con la reacci√≥n que le gusta, la retroalimentaci√≥n tiene otras reacciones: compartir, no me gusta, no me gusta, hacer clic, ignorar, lo que se puede hacer manualmente.  Cont√© todo tipo de agregados y seleccion√© las caracter√≠sticas con poca importancia, para no inflar el conjunto de datos. </p><br><p>  En ese momento estaba en primer lugar por un amplio margen.  La √∫nica verg√ºenza fue que la incrustaci√≥n de las im√°genes casi no dio ganancias.  La idea surgi√≥ para dar todo a catboost.  Agrupe las im√°genes de Kmeans y obtenga una nueva caracter√≠stica categ√≥rica imageCat. </p><br><p>  Aqu√≠ hay algunas clases despu√©s de filtrar y fusionar manualmente los cl√∫steres obtenidos de KMeans. </p><br><p><img src="https://habrastorage.org/webt/i3/s5/m2/i3s5m2ftpdmvr0m_0dvpau4eggs.png"></p><br><p>  Basado en imageCat generamos: </p><br><ul><li>  Nuevas caracter√≠sticas categ√≥ricas: <br><ul><li>  Qu√© imageCat parec√≠a m√°s frecuentemente userId; </li><li>  Qu√© imageCat se muestra con mayor frecuencia por ownerId; </li><li>  ¬øQu√© imageCat le gusta m√°s a menudo userId; </li></ul></li><li>  Varios contadores: <br><ul><li>  Cu√°ntos imageCat √∫nicos parec√≠an userId; </li><li>  Alrededor de 15 caracter√≠sticas similares m√°s codificaci√≥n de destino como se describe anteriormente. </li></ul></li></ul><br><p>  <strong>Textos</strong> </p><br><p>  Los resultados en el concurso de im√°genes me convencieron y decid√≠ probarme en los textos.  Anteriormente, no trabajaba mucho con textos y, por estupidez, mataba un d√≠a en tf-idf y svd.  Luego vi una l√≠nea de base con doc2vec, que hace justo lo que necesito.  Habiendo ajustado ligeramente los par√°metros de doc2vec, recib√≠ incrustaciones de texto. </p><br><p>  Y luego simplemente reutiliz√≥ el c√≥digo para las im√°genes, en el que reemplaz√≥ las incrustaciones de im√°genes con incrustaciones de texto.  Como resultado, llegu√© al segundo lugar en el concurso de texto. </p><br><p>  <strong>Sistema colaborativo</strong> </p><br><p>  Solo hab√≠a una competencia en la que todav√≠a no hab√≠a "golpeado un palo", pero a juzgar por las AUC en la clasificaci√≥n, los resultados de esta competencia en particular deber√≠an haber tenido el mayor impacto en el escenario fuera de l√≠nea. <br>  Tom√© todos los signos que estaban en los datos de origen, seleccion√© los categ√≥ricos y calcul√© los mismos agregados que para las im√°genes, excepto las caracter√≠sticas de las im√°genes mismas.  Simplemente poni√©ndolo en catboost, llegu√© al segundo lugar. </p><br><h1 id="pervye-shagi-optimizacii-catboost">  Los primeros pasos para optimizar catboost </h1><br><p>  Un primer y dos segundos lugares me complacieron, pero entend√≠ que no hice nada especial, lo que significa que podemos esperar una p√©rdida de posici√≥n. </p><br><p>  La tarea de la competencia es clasificar las publicaciones dentro del marco del usuario, y todo este tiempo he estado resolviendo el problema de clasificaci√≥n, es decir, he optimizado la m√©trica incorrecta. </p><br><p>  Dar√© un ejemplo simple: </p><br><table><thead><tr><th>  ID de usuario </th><th>  objectId </th><th>  predicci√≥n </th><th>  verdad fundamental </th></tr></thead><tbody><tr><td>  1 </td><td>  10 </td><td>  0.9 </td><td>  1 </td></tr><tr><td>  1 </td><td>  11 </td><td>  0.8 </td><td>  1 </td></tr><tr><td>  1 </td><td>  12 </td><td>  0.7 </td><td>  1 </td></tr><tr><td>  1 </td><td>  13 </td><td>  0.6 </td><td>  1 </td></tr><tr><td>  1 </td><td>  14 </td><td>  0.5 0.5 </td><td>  0 0 </td></tr><tr><td>  2 </td><td>  15 </td><td>  0.4 0.4 </td><td>  0 0 </td></tr><tr><td>  2 </td><td>  16 </td><td>  0,3 </td><td>  1 </td></tr></tbody></table><br><p>  Hacemos una peque√±a permutaci√≥n </p><br><table><thead><tr><th>  ID de usuario </th><th>  objectId </th><th>  predicci√≥n </th><th>  verdad fundamental </th></tr></thead><tbody><tr><td>  1 </td><td>  10 </td><td>  0.9 </td><td>  1 </td></tr><tr><td>  1 </td><td>  11 </td><td>  0.8 </td><td>  1 </td></tr><tr><td>  1 </td><td>  12 </td><td>  0.7 </td><td>  1 </td></tr><tr><td>  1 </td><td>  13 </td><td>  0.6 </td><td>  0 0 </td></tr><tr><td>  2 </td><td>  16 </td><td>  0.5 0.5 </td><td>  1 </td></tr><tr><td>  2 </td><td>  15 </td><td>  0.4 0.4 </td><td>  0 0 </td></tr><tr><td>  1 </td><td>  14 </td><td>  0,3 </td><td>  1 </td></tr></tbody></table><br><p>  Obtenemos los siguientes resultados: </p><br><table><thead><tr><th>  Modelo </th><th>  Auc </th><th>  Usuario1 AUC </th><th>  Usuario2 AUC </th><th>  AUC medio </th></tr></thead><tbody><tr><td>  Opcion 1 </td><td>  0.8 </td><td>  1,0 </td><td>  0,0 </td><td>  0.5 0.5 </td></tr><tr><td>  Opci√≥n 2 </td><td>  0.7 </td><td>  0,75 </td><td>  1,0 </td><td>  0.875 </td></tr></tbody></table><br><p>  Como puede ver, mejorar la m√©trica general de AUC no significa mejorar la m√©trica promedio de AUC dentro del usuario. </p><br><p>  Catboost <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">puede optimizar las m√©tricas de clasificaci√≥n de forma</a> inmediata.  Le√≠ sobre m√©tricas de clasificaci√≥n, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">historias de √©xito</a> cuando uso catboost y configur√© YetiRankPairwise para estudiar durante la noche.  El resultado no fue impresionante.  Habiendo decidido que no hab√≠a aprendido bien, cambi√© la funci√≥n de error a QueryRMSE, que, a juzgar por la documentaci√≥n de catboost, converge m√°s r√°pido.  Como resultado, obtuve los mismos resultados que durante el entrenamiento para la clasificaci√≥n, pero los conjuntos de estos dos modelos dieron un buen aumento, lo que me llev√≥ a los primeros lugares en las tres competiciones. </p><br><p>  5 minutos antes del cierre de la etapa en l√≠nea en la competencia Collaborative Systems, Sergey Shalnov me traslad√≥ al segundo lugar.  La forma en que fuimos juntos. </p><br><h1 id="podgotovka-k-oflayn-etapu">  Preparaci√≥n para la fase fuera de l√≠nea </h1><br><p>  La victoria en la etapa en l√≠nea nos fue garantizada en la tarjeta de video RTX 2080 TI, pero el premio principal de 300,000 rublos y, m√°s bien, incluso el primer lugar final nos oblig√≥ a trabajar estas 2 semanas. </p><br><p>  Al final result√≥ que, Sergey tambi√©n us√≥ catboost.  Intercambiamos ideas y caracter√≠sticas, y descubr√≠ el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">informe de Anna Veronika Dorogush</a> en el que hab√≠a respuestas a muchas de mis preguntas, e incluso a aquellas que a√∫n no hab√≠a aparecido. </p><br><p>  Ver el informe me llev√≥ a la idea de que es necesario devolver todos los par√°metros al valor predeterminado y ajustar la configuraci√≥n con mucho cuidado y solo despu√©s de corregir un conjunto de signos.  Ahora, un entrenamiento tom√≥ aproximadamente 15 horas, pero un modelo logr√≥ obtener la velocidad mejor que en el conjunto con la clasificaci√≥n. </p><br><p>  <strong>Generaci√≥n de funciones</strong> </p><br><p>  En la competencia "Sistemas de colaboraci√≥n" se eval√∫a una gran cantidad de caracter√≠sticas como importantes para el modelo.  Por ejemplo, <em>auditweights_spark_svd</em> es el atributo m√°s importante y no hay informaci√≥n sobre lo que significa.  Pens√© que val√≠a la pena contar las distintas unidades en funci√≥n de signos importantes.  Por ejemplo, el promedio auditweights_spark_svd por usuario, por grupo, por objeto.  Lo mismo se puede calcular a partir de los datos en los que no se realiza el entrenamiento y target = 1, es decir, el promedio de <em>auditweights_spark_svd</em> por usuario para los objetos que le gustaron.  <em>Hubo</em> varios signos importantes, adem√°s de <em>auditweights_spark_svd</em> .  Aqu√≠ hay algunos de ellos: </p><br><ul><li>  <em>auditweightsCtrGender</em> </li><li>  <em>auditweightsCtrHigh</em> </li><li>  <em>userOwnerCounterCreateLikes</em> </li></ul><br><p>  Por ejemplo, el valor promedio de <em>auditweightsCtrGender</em> por userId result√≥ ser una caracter√≠stica importante, as√≠ como el valor promedio de <em>userOwnerCounterCreateLikes</em> por userId + ownerId.  Esto deber√≠a habernos hecho pensar en c√≥mo entender el significado de los campos. </p><br><p>  Otras caracter√≠sticas importantes fueron <em>auditweightsLikesCount</em> y <em>auditweightsShowsCount</em> .  Al dividir uno en otro, se obtuvo una caracter√≠stica a√∫n m√°s importante. </p><br><p>  <strong>Fugas de datos.</strong> </p><br><p>  Los modelos de competencia y producci√≥n son tareas muy diferentes.  Al preparar los datos, es muy dif√≠cil tener en cuenta todos los detalles y no transferir informaci√≥n no trivial sobre la variable objetivo en la prueba.  Si creamos una soluci√≥n de producci√≥n, intentaremos evitar el uso de fugas de datos al entrenar el modelo.  Pero si queremos ganar el concurso, entonces las filtraciones de datos son las mejores caracter√≠sticas. </p><br><p>  Despu√©s de examinar los datos, puede ver que seg√∫n objectId, los valores de <em>auditweightsLikesCount</em> y <em>auditweightsShowsCount</em> cambian, lo que significa que la proporci√≥n de los valores m√°ximos de estos signos reflejar√° la conversi√≥n posterior mucho mejor que la proporci√≥n en el momento de la entrega. </p><br><p>  La primera fuga que encontramos fue <em>auditweightsLikesCountMax / auditweightsShowsCountMax</em> . <br>  Pero, ¬øqu√© pasa si observa los datos m√°s de cerca?  Ordenar por fecha de entrega y obtener: </p><br><table><thead><tr><th>  objectId </th><th>  ID de usuario </th><th>  auditweightsShowsCount </th><th>  auditweightsLikesCount </th><th>  objetivo (le gusta) </th></tr></thead><tbody><tr><td>  1 </td><td>  1 </td><td>  12 </td><td>  3 </td><td>  probablemente no </td></tr><tr><td>  1 </td><td>  2 </td><td>  15 </td><td>  3 </td><td>  probablemente si </td></tr><tr><td>  1 </td><td>  3 </td><td>  16 </td><td>  4 4 </td><td></td></tr></tbody></table><br><p>  Fue sorprendente cuando encontr√© el primer ejemplo de este tipo y result√≥ que mi predicci√≥n no se hizo realidad.  Pero, dado el hecho de que los valores m√°ximos de estos signos dentro del marco del objeto aumentaron, no fuimos demasiado vagos y decidimos encontrar <em>auditweightsShowsCountNext</em> y <em>auditweightsLikesCountNext</em> , es decir, valores en el momento siguiente.  A√±adiendo caracter√≠stica <br>  <em>(auditweightsShowsCountNext-auditweightsShowsCount) / (auditweightsLikesCount-auditweightsLikesCountNext)</em> hicimos un brusco salto durante todo el d√≠a. <br>  Se podr√≠an usar fugas similares si se encuentran los siguientes valores para <em>userOwnerCounterCreateLikes</em> dentro de userId + ownerId y, por ejemplo, <em>auditweightsCtrGender</em> dentro de objectId + userGender.  Encontramos 6 campos similares con fugas y extrajimos informaci√≥n de ellos tanto como fue posible. </p><br><p>  Para entonces, hab√≠amos exprimido un m√°ximo de informaci√≥n de los atributos de colaboraci√≥n, pero no volvimos a los concursos de im√°genes y textos.  Hubo una gran idea para verificar: ¬øcu√°nto dan las caracter√≠sticas directamente en las im√°genes o textos en las competiciones correspondientes? </p><br><p>  No hubo fugas en los concursos de im√°genes y textos, pero para ese momento hab√≠a devuelto los par√°metros predeterminados de catboost, pein√© el c√≥digo y agregu√© algunas caracter√≠sticas.  Resultado total: </p><br><table><thead><tr><th>  Soluci√≥n </th><th>  velocidad </th></tr></thead><tbody><tr><td>  M√°ximo con im√°genes </td><td>  0.6411 </td></tr><tr><td>  M√°ximo sin im√°genes </td><td>  0.6297 </td></tr><tr><td>  Resultado del segundo lugar </td><td>  0.6295 </td></tr></tbody></table><br><table><thead><tr><th>  Soluci√≥n </th><th>  velocidad </th></tr></thead><tbody><tr><td>  M√°ximo con textos </td><td>  0,666 </td></tr><tr><td>  M√°ximo sin textos </td><td>  0.660 </td></tr><tr><td>  Resultado del segundo lugar </td><td>  0,656 </td></tr></tbody></table><br><table><thead><tr><th>  Soluci√≥n </th><th>  velocidad </th></tr></thead><tbody><tr><td>  M√°ximo en colaboraci√≥n </td><td>  0,745 </td></tr><tr><td>  Resultado del segundo lugar </td><td>  0,723 </td></tr></tbody></table><br><p>  Se hizo evidente que era improbable que muchos textos e im√°genes se eliminaran, y despu√©s de probar algunas de las ideas m√°s interesantes, dejamos de trabajar con ellos. </p><br><p>  La generaci√≥n adicional de caracter√≠sticas en sistemas colaborativos no dio crecimiento, y comenzamos a clasificar.  En la etapa en l√≠nea, el conjunto de clasificaci√≥n y clasificaci√≥n me dio un peque√±o aumento, ya que result√≥ que ten√≠a una clasificaci√≥n poco entrenada.  Ninguna de las funciones de error, incluido YetiRanlPairwise, incluso dio resultados cercanos que LogLoss dio (0.745 contra 0.725).  Hab√≠a esperanza de que QueryCrossEntropy no se pudiera iniciar. </p><br><h1 id="oflayn-etap">  Etapa fuera de l√≠nea </h1><br><p>  En la etapa fuera de l√≠nea, la estructura de datos se ha mantenido igual, pero ha habido peque√±os cambios: </p><br><ul><li>  los identificadores userId, objectId, ownerId se han aleatorizado nuevamente; </li><li>  Se eliminaron varios letreros y se cambi√≥ el nombre de varios. </li><li>  los datos se han convertido en 1,5 veces m√°s. </li></ul><br><p>  Adem√°s de las dificultades enumeradas, hubo una gran ventaja: se asign√≥ un gran servidor con RTX 2080TI al equipo.  Disfrut√© htop por mucho tiempo. <br><img src="https://habrastorage.org/webt/0c/6n/zp/0c6nzpburmw8nxsxz9y8iwkxmwa.jpeg"></p><br><p>  La idea era una: solo reproducir lo que ya est√° all√≠.  Despu√©s de pasar un par de horas configurando el entorno en el servidor, gradualmente comenzamos a verificar que los resultados se estaban reproduciendo.  El principal problema que enfrentamos es el aumento en el volumen de datos.  Decidimos reducir ligeramente la carga y establecer el par√°metro catboost ctr_complexity = 1.  Esto reduce un poco la velocidad, pero mi modelo comenz√≥ a funcionar, el resultado fue bueno: 0.733.  Sergei, a diferencia de m√≠, no dividi√≥ los datos en 2 partes y se capacit√≥ en todos los datos, aunque esto dio el mejor resultado en la etapa en l√≠nea, hubo muchas dificultades en la etapa fuera de l√≠nea.  Si tomamos todas las caracter√≠sticas que hemos generado y tratamos de ponerlo en catboost ‚Äúen la frente‚Äù, entonces nada hubiera sucedido en la etapa en l√≠nea.  Sergey s√≠ optimiz√≥ los tipos, por ejemplo, convirtiendo los tipos float64 en float32.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">En este art√≠culo</a> puede encontrar informaci√≥n sobre c√≥mo optimizar la memoria en pandas.  Como resultado, Sergey se entren√≥ en la CPU en todos los datos y result√≥ aproximadamente 0.735. </p><br><p>  Estos resultados fueron suficientes para ganar, pero ocultamos nuestra velocidad real y no pod√≠amos estar seguros de que otros equipos no estuvieran haciendo lo mismo. </p><br><h1 id="bitva-do-poslednego">  Batalla hasta el final </h1><br><p>  <strong>Tuning catboost</strong> </p><br><p>  Nuestra soluci√≥n se reprodujo por completo, agregamos caracter√≠sticas de datos de texto e im√°genes, por lo que todo lo que quedaba era ajustar los par√°metros de catboost.  Sergey estudi√≥ en la CPU con un peque√±o n√∫mero de iteraciones, y yo estudi√© con ctr_complexity = 1.  Solo quedaba un d√≠a, y si solo agrega iteraciones o aumenta ctr_complexity, por la ma√±ana podr√≠a obtener una velocidad a√∫n mejor y caminar todo el d√≠a. </p><br><p>  En la etapa fuera de l√≠nea, los puntajes podr√≠an ser muy f√°ciles de ocultar, simplemente eligiendo no la mejor soluci√≥n en el sitio.  Esper√°bamos cambios bruscos en la clasificaci√≥n en los √∫ltimos minutos antes del cierre de las presentaciones y decidimos no parar. </p><br><p>  Del video de Anna, aprend√≠ que para mejorar la calidad del modelo, es mejor seleccionar los siguientes par√°metros: </p><br><ul><li>  <em>learning_rate</em> : el valor predeterminado se calcula en funci√≥n del tama√±o del conjunto de datos.  Con una disminuci√≥n en la tasa de aprendizaje, para mantener la calidad, es necesario aumentar el n√∫mero de iteraciones. </li><li>  <em>l2_leaf_reg</em> : coeficiente de regularizaci√≥n, valor predeterminado de 3, preferiblemente de 2 a 30. Una disminuci√≥n en el valor conduce a un aumento en el sobreajuste. </li><li>  <em>bagging_temperature</em> : agrega aleatorizaci√≥n a los pesos de los objetos en la selecci√≥n.  El valor predeterminado es 1, en el que los pesos se seleccionan de la distribuci√≥n exponencial.  Una disminuci√≥n en el valor conduce a un aumento en el sobreajuste. </li><li>  <em>random_strength</em> - Afecta la elecci√≥n de divisiones para una iteraci√≥n particular.  Cuanto mayor sea random_strength, mayor ser√° la posibilidad de que se seleccione una divisi√≥n de baja importancia.  En cada iteraci√≥n posterior, la aleatoriedad disminuye.  Una disminuci√≥n en el valor conduce a un aumento en el sobreajuste. </li></ul><br><p>  Otros par√°metros afectan significativamente menos el resultado final, por lo que no intent√© seleccionarlos.  Una iteraci√≥n de entrenamiento en mi conjunto de datos de GPU con ctr_complexity = 1 tom√≥ 20 minutos, y los par√°metros seleccionados en el conjunto de datos reducido fueron ligeramente diferentes de los √≥ptimos en el conjunto de datos completo.  Como resultado, hice unas 30 iteraciones en el 10% de los datos, y luego unas 10 iteraciones m√°s en todos los datos.  Result√≥ aproximadamente lo siguiente: </p><br><ul><li>  Aument√© <em>learning_rate</em> en un 40% del valor predeterminado; </li><li>  <em>l2_leaf_reg</em> dej√≥ lo mismo; </li><li>  <em>bagging_temperature</em> y <em>random_strength</em> reducido a 0.8. </li></ul><br><p>  Podemos concluir que con los par√°metros predeterminados, el modelo est√° poco capacitado. </p><br><p>  Me sorprendi√≥ mucho cuando vi el resultado en la tabla de clasificaci√≥n: </p><br><table><thead><tr><th>  Modelo </th><th>  modelo 1 </th><th>  modelo 2 </th><th>  modelo 3 </th><th>  conjunto </th></tr></thead><tbody><tr><td>  Sin sintonizaci√≥n </td><td>  0.7403 </td><td>  0.7404 </td><td>  0.7404 </td><td>  0.7407 </td></tr><tr><td>  Con afinaci√≥n </td><td>  0.7406 </td><td>  0.7405 </td><td>  0.7406 </td><td>  0.7408 </td></tr></tbody></table><br><p>  Llegu√© a la conclusi√≥n de que si no necesita una aplicaci√≥n r√°pida del modelo, entonces es mejor reemplazar la selecci√≥n de par√°metros con un conjunto de varios modelos en par√°metros no optimizados. </p><br><p>  Sergey se ocup√≥ de optimizar el tama√±o del conjunto de datos para ejecutarlo en la GPU.    ‚Äî    ,      : </p><br><ul><li>      ( ),       ; </li><li>      ; </li><li>  userId,      ; </li><li>   userId,    . </li></ul><br><p>     ‚Äî     . </p><br><p> <strong> </strong> </p><br><p>          ,   0,742.        ctr_complexity=2   30    5 .   4   ,     ,      0,7433. </p><br><p>       ,     ,      .          predict(prediction_type='RawFormulaVal')   scale_pos_weight=neg_count/pos_count. </p><br><p><img src="https://habrastorage.org/webt/ki/yv/yj/kiyvyjpnsouo46k-ny9e9hmyjxa.png"></p><br><p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">    </a> . </p><br><p> <strong> </strong> </p><br><p>       . ,      ,    ,   2  . </p><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  </a> . ,   Mail.ru,    ,         ,     . </li><li>  ,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">   facebook</a> ,        . </li></ul><br><h1 id="zaklyuchenie">  Conclusi√≥n </h1><br><p>      : </p><br><ul><li>      ,       target encoding,     catboost. </li><li>     ,       ,  learning_rate  iterations.    ‚Äî    . </li><li>     GPU. Catboost      GPU,    . </li><li>          rsm~=0.2 (CPU only)  ctr_complexity=1. </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A diferencia de otros equipos, el conjunto de nuestros modelos dio un gran aumento. </font><font style="vertical-align: inherit;">Intercambiamos ideas y escribimos en diferentes idiomas. </font><font style="vertical-align: inherit;">Ten√≠amos un enfoque diferente para dividir los datos, y creo que todos ten√≠an sus propios errores.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> No est√° claro por qu√© la optimizaci√≥n de clasificaci√≥n arroj√≥ peores resultados que la optimizaci√≥n de clasificaci√≥n. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Obtuve un poco de experiencia con textos y entend√≠ c√≥mo se hacen los sistemas de recomendaci√≥n. </font></font></li></ul><br><p><img src="https://habrastorage.org/webt/en/m_/to/enm_topolhyttqfezaldsddvjs0.jpeg"></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gracias a los organizadores por las emociones, el conocimiento y los premios recibidos. </font></font></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/447376/">https://habr.com/ru/post/447376/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447366/index.html">¬øCu√°l es la mejor manera de comenzar un proyecto o c√≥mo hacerlo para que no sea tan doloroso?</a></li>
<li><a href="../447368/index.html">No solo atrapando pulgas. ¬øPor qu√© la velocidad es tan importante para cualquier tienda?</a></li>
<li><a href="../447370/index.html">¬øPor qu√©, debido a un sistema de patentes roto, la sombra de Theranos todav√≠a se cierne sobre nosotros?</a></li>
<li><a href="../447372/index.html">La transformaci√≥n de TI es inevitable: por d√≥nde empezar</a></li>
<li><a href="../447374/index.html">Creaci√≥n de elementos de interfaz mediante programaci√≥n mediante PureLayout (Parte 2)</a></li>
<li><a href="../447380/index.html">Excepciones de Kotlin y sus caracter√≠sticas.</a></li>
<li><a href="../447382/index.html">El libro "Unidad y C #. Gamedev desde la idea hasta la implementaci√≥n. 2da ed</a></li>
<li><a href="../447384/index.html">Potencia semiconductores en guardia de ecolog√≠a</a></li>
<li><a href="../447388/index.html">TL; DR-digest de la Universidad ITMO: admisi√≥n no cl√°sica a la universidad, pr√≥ximos eventos y los materiales m√°s interesantes</a></li>
<li><a href="../447390/index.html">Pautas de configuraci√≥n de AccelStor AFA para VMware vSphere</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>