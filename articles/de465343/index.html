<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöó üêå üßîüèº Wie wir anderthalb Jahre lang die Engine und das Spiel darauf gemacht haben. Teil Zwei Die Infrastruktur üò© üõ∂ ‚úãüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Zun√§chst einige Kommentare zu den Spuren des vorherigen Artikels. Wir haben wirklich bei Wargaming gearbeitet , wo wir eine Engine namens dava.framewo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie wir anderthalb Jahre lang die Engine und das Spiel darauf gemacht haben. Teil Zwei Die Infrastruktur</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465343/"> Zun√§chst einige Kommentare zu den Spuren des vorherigen Artikels.  Wir haben wirklich bei <b>Wargaming gearbeitet</b> , wo wir eine Engine namens <b>dava.framework</b> oder <b>dava.engine entwickelt haben</b> .  Daher beteiligen sich viele alte Kollegen, mit denen wir noch gute Beziehungen haben, aktiv an der Diskussion. <br><br>  Einige Leute haben Zweifel: Ist das die gleiche Technologie oder eine andere?  Antwort: Dies ist eine neue Technologie, die von Grund auf neu geschrieben wurde. <br><br>  Wie haben wir es in nur einem Jahr geschafft?  Unser Team verf√ºgt √ºber umfangreiche Erfahrungen.  Viele entwickeln seit √ºber 15 Jahren Engines und Spiele. <br><br>  Warum von Grund auf neu, wenn Sie unseren alten Motor nehmen k√∂nnten, der auch in Open Source liegt?  Er ist ungef√§hr 10 Jahre alt und der gr√∂√üte Teil des Codes ist veraltet.  Sogar die besten Teile des Motors, auf die wir stolz sind, enthielten manchmal Code-Teile und einige Grundlagen von 5, 7 und manchmal sogar 10 Jahren.  Viele Architekturl√∂sungen wurden f√ºr Ger√§te dieser Zeit entwickelt - beginnend mit einem 3G iPhone.  Jetzt konzentrieren wir uns zumindest auf das iPad Air 1 und √§hnliche Android-Ger√§te.  Dementsprechend haben sich die Ans√§tze etwas ge√§ndert. <br><a name="habracut"></a><br>  Und die h√§ufigste Frage: Warum eigener Motor?  Im letzten Artikel gab es mehrere Argumente mit unterschiedlichem Ma√ü an √úberzeugungskraft.  Ich m√∂chte mich auf die Hauptsache konzentrieren: Nur unsere eigene Technologie kann es Ihnen erm√∂glichen, das Beste aus Eisen herauszuholen und die maximale Anzahl von Optimierungen speziell f√ºr Ihr Gameplay und Ihren visuellen Stil vorzunehmen.  Wir positionieren uns, auch als Technologieunternehmen, nicht nur als Spieleentwickler.  Wir glauben, dass wir mit unserem Niveau an Ingenieuren und unserer Erfahrung ernsthaft auf dem Markt f√ºr mobile High-Tech-Produkte konkurrieren k√∂nnen. <br><br>  Und jetzt zum Punkt: Welche Werkzeuge und Techniken haben uns geholfen, diese ziemlich ehrgeizige Aufgabe in kurzer Zeit zu erf√ºllen? <br><br><h4>  Die Infrastruktur </h4><br>  Wir haben uns f√ºr Atlassian Bitbucket Server + Jenkins entschieden.  Im Bitbucket liegt das Haupt-Repository (Master), mit dem Jenkins verbunden ist.  Jeder Entwickler hat seine eigene Gabel.  F√ºr jede Aufgabe wird eine neue Gabel in der Gabel erstellt, die √ºber die Pull-Anforderung wieder integriert wird.  Im Allgemeinen ist das Schema ziemlich Standard.  Jede Pull-Anfrage wird einer obligatorischen √úberpr√ºfung und automatischen Tests unterzogen.  Bei Erfolg wird es automatisch in den Master integriert. <br><br><h4>  Jenkins </h4><br>  Jenkins hat mehrere M√§ngel: Er ist ein alter, nicht sehr schneller, gefr√§√üiger Web-Maulkorb, der aussieht wie ein Internetportal aus den 90er Jahren.  Aufgrund seiner Flexibilit√§t, einer Vielzahl von Modulen und seiner kostenlosen Nutzung ist es jedoch auch 2019 eine gute Wahl.  Nachdem Sie mit den Modulen und Einstellungen gespielt haben, k√∂nnen Sie ein verdauliches Erscheinungsbild erzielen, eine deklarative Beschreibung der Pipelines (die im Repository liegen).  √úbrigens gibt es derzeit etwa 40 Pipelines: Tests, Editoren, ein Spiel f√ºr alle Plattformen;  Arbeit mit Serverinfrastruktur und Metaspiel.  Sammle alles 20 buildagentov. <br><br>  In Zukunft m√∂chte ich nat√ºrlich moderne Hipster-L√∂sungen ausprobieren, zum Beispiel GitLab oder selbst gehostete TravisCI.  Wir ber√ºcksichtigen Cloud-L√∂sungen (Nevercode, Bitrise, CircleCI usw.) aufgrund der Gr√∂√üe unseres Repositorys, unserer Assets und dementsprechend der Erstellungszeit und der Gr√∂√üe von Artefakten nicht vollst√§ndig. <br><br><h4>  System erstellen </h4><br>  Die Hauptanforderung f√ºr das System war wie folgt: Projektgenerierung f√ºr iOS, MacOS, Android, Windows, Linux in einem Skript.  Wir haben es geschafft, Premake, SCons, Bazel und CMake auszuprobieren.  Aus verschiedenen Gr√ºnden haben wir beim bew√§hrten CMake angehalten. <br><br>  In den letzten Jahren ist CMake fast zum Standard f√ºr C ++ - Bibliotheken geworden.  Fast alles von Abseilen bis SDL kann in nur wenigen Zeilen mit Ihrem CMake-Projekt verbunden werden.  Es gibt nat√ºrlich Ausnahmen wie OpenSSL oder V8, mit denen ich etwas schwitzen musste.  Auf dem nackten Zmeik haben wir ein kleines Framework entwickelt (insgesamt ca. 3.000 Zeilen).  Hauptmerkmale: <br>  Modularit√§t.  Die einzelnen Teile des Motors sind als Module ausgef√ºhrt.  Zum Beispiel Sound, Benutzeroberfl√§che, Physik, Netzwerk usw.  Jedes Modul kann √ºber eigene Assets (z. B. Shader) und Abh√§ngigkeiten von anderen Modulen verf√ºgen. <br><br>  Die endg√ºltige Anwendung auf der Engine (Spiel, Editor, Dienstprogramme) verbindet nur die Module, die sie ben√∂tigt.  Ein wenig auseinander liegt das Kernmodul, das f√ºr die meisten anderen Module eine Abh√§ngigkeit darstellt.  Core implementiert den Einstiegspunkt, den Hauptanwendungszyklus, die Interaktion mit dem Betriebssystem und anderen grundlegenden Entit√§ten. <br>  Module von Drittanbietern.  Mit unserem Framework k√∂nnen Sie ein Git-Repository oder -Archiv in mehreren Zeilen herunterladen, Bibliotheken und / oder Quellen entpacken, kompilieren, kopieren.  Heute haben wir 66 solcher Module von Drittanbietern: Analytics, Dateiformate von Drittanbietern, Middleware wie Physik, eine Soundbibliothek usw. <br><br><h4>  Entwicklungsprozess </h4><br>  Aufgrund fr√ºherer Erfahrungen haben wir beschlossen, sowohl die Engine als auch das Spiel in einem Repository hinzuzuf√ºgen.  Auf diese Weise k√∂nnen Sie problemlos √Ñnderungen an der Engine-API vornehmen und das Spiel synchron anpassen.  Das Ergebnis war das sogenannte Monorepository mit seinen Vor- und Nachteilen.  Da wir jedoch sofort vorhatten, ein sehr hohes Entwicklungstempo beizubehalten, √ºberwog die M√∂glichkeit eines synchronen Refactorings der Engine und des Spiels alle anderen Nachteile dieser L√∂sung. <br><br>  Im Durchschnitt f√ºgen wir mehr als 20 Pull-Anfragen pro Tag hinzu.  Dies bedeutet, dass der Master m√∂glicherweise 20 Mal am Tag unterbrochen werden kann.  Gl√ºcklicherweise haben sie 1991 die Continuous Integration-Technik entwickelt.  Zu was sind wir gekommen? <br><br><h4>  Kontinuierliche Integration </h4><br>  Wie oben erw√§hnt, wird f√ºr jede Aufgabe in der Gabel des Entwicklers ein Brunch erstellt.  Als N√§chstes wird aus diesem Brunch eine Pull-Anforderung an das Haupt-Repository erstellt.  Diese Pull-Anfrage besteht eine Reihe automatisierter Tests bei Jenkins: <br><br><ol><li>  Unit-Tests f√ºr alle Plattformen (Windows, Linux, Macos, iOS, Android).  Googletest wird als Basis verwendet, und OpenCppCoverage, dessen Bericht von einem zus√§tzlichen Python-Skript √ºberpr√ºft wird, wird verwendet, um den Prozentsatz der Abdeckung zu √ºberpr√ºfen.  Wenn der Prozentsatz der Abdeckung f√ºr eine bestimmte Datei weniger als 75% betr√§gt, wird der Test als fehlgeschlagen betrachtet.  Daher haben wir die meisten Low-Level-Motorklassen mit Tests abgedeckt. </li><li>  Codeformatierer  F√ºr C ++ - Code verwenden wir das Clang-Format.  Die Formatierung des ge√§nderten Codes erfolgt zuerst automatisch beim Festschreiben auf dem Computer des Entwicklers und wird dann im Test √ºberpr√ºft.  F√ºr Javascript, das als Skriptsprache verwendet wird, wird npm linter verwendet. </li><li>  Asset-Tests.  Eine ziemlich gro√üe Gruppe von Tests: von der Validierung von Dateiformaten bis zur √úberpr√ºfung von Abh√§ngigkeiten (z. B. √úberpr√ºfung, ob die in der Spielebene verwendete Textur vorhanden ist). </li><li>  Unit- und Funktionstests des Editors.  Ein wesentlicher Bestandteil der Engine ist der Editor, in dem Spielebenen und andere Elemente erstellt und bearbeitet werden.  Zus√§tzlich zu Unit-Tests wird froglogic Squish for Qt zum Testen des Editors verwendet - ein Dienstprogramm f√ºr automatische GUI-Tests.  All dies erm√∂glicht es uns, auf manuelle Tests des Editors zu verzichten.  Dar√ºber hinaus ist nach den Bewertungen von K√ºnstlern und Leveldesignern das Niveau der Qualit√§t und Stabilit√§t h√∂her als im vorherigen Unternehmen, als wir ein Team von f√ºnf Testern hatten.  Zur gleichen Zeit treten Freisetzungen t√§glich auf, und bei manuellen Tests erfolgten Freisetzungen alle 2 Wochen. </li><li>  Funktionstests des Spiels.  Es ist klar, dass ich automatische Funktionstests f√ºr das Spiel verwenden m√∂chte.  Aus diesem Grund haben wir mit der Entwicklung des folgenden Systems begonnen: </li></ol><br><ul><li>  Die Testanwendung (speziell ein Python-Skript) startet einen Spieleserver und einen Client mit bestimmten Parametern </li><li>  Laufender Server und Client √∂ffnen den Netzwerkport. </li><li>  Die Testanwendung stellt eine Verbindung zu ihnen her und sendet Befehle: Laden Sie eine Karte herunter, w√§hlen Sie einen Charakter und Waffen aus, bewegen Sie sich zu einem Punkt, zielen Sie, schie√üen Sie usw. </li><li>  Die Testsyntax selbst ist Python Pytest.  Dieses System befindet sich derzeit in der aktiven Entwicklung. </li></ul><br>  Die meisten Testprojekte werden mit aktiviertem Flag "Warnungen als Fehler behandeln" und auf der MacOS-Plattform mit zus√§tzlich aktiviertem clang AddressSanitizer erfasst, sodass Sie in der Phase der Vorbereitung der Pull-Anforderung noch mehr Fehler abfangen k√∂nnen. <br><br>  Zus√§tzlich zu den Tests wird jede Pull-Anforderung von mindestens zwei anderen Entwicklern √ºberpr√ºft und bei Bedarf zur √úberarbeitung gesendet.  Wenn alle Tests abgeschlossen sind und die Pr√ºfer keine Kommentare haben, friert die Pull-Anfrage automatisch ein. <br>  Da einige Tests viel Zeit in Anspruch nehmen k√∂nnen (z. B. dauert ein vollst√§ndiger GUI-Editor-Test mehr als eine Stunde), wird bei Pull-Anforderungen ein kurzes Skript verwendet.  Der vollst√§ndige Testsatz wird alle 4 Stunden im Assistenten gestartet. <br><br>  Bisher wurden 6.600 Pull-Quests erstellt und so durchgef√ºhrt. <br><br><img src="https://habrastorage.org/webt/sh/io/7k/shio7kkx60nm-urpb2sx97z9w0s.jpeg"><br><br><h4>  Kontinuierliche Lieferung </h4><br>  Wir verwenden das Konzept der automatischen t√§glichen (oder eher t√§glichen) Ver√∂ffentlichung.  Wie genau passiert das: <br><br><ol><li>  Git-Tag wird erstellt, </li><li>  Es werden Vollversionen aller Tests ausgef√ºhrt. </li><li>  Bei Erfolg werden Artefakte gesammelt: </li></ol><br><ul><li>  Editoren f√ºr MacOS und Windows.  Somit hat jeder Morgen eine neue Version der Werkzeuge.  Und dank automatischer Tests sind wir von ihrer Qualit√§t und Stabilit√§t √ºberzeugt. </li><li>  Game Client und Server f√ºr alle Plattformen.  Der Client f√ºr iOS wird auf TestFlight, f√ºr Android - auf Google Play, andere Plattformen - auf JFrog Artifactory, Spieleserver und andere Dienste - in die Cloud hochgeladen.  Das hei√üt, wir haben jeden Morgen eine neue Version des Spiels, die zum Testen und Testen bereit ist. </li></ul><br>  Nat√ºrlich endet nicht jede n√§chtliche Ver√∂ffentlichung erfolgreich.  Einige Tests schlagen m√∂glicherweise fehl oder beim Start der Anwendung tritt ein kritischer Fehler auf.  In diesem Fall werden die gefundenen Probleme tags√ºber vom diensthabenden Entwickler behoben und der Freigabeprozess neu gestartet. <br>  Jeden Tag sind mehrere im Dienst: <br><br><ol><li>  1st Level Attendant.  √úberwacht die Stabilit√§t von Tests im Haupt-Repository. </li><li>  2. Level Begleiter im Spiel.  Spielfehler beheben. </li><li>  2nd Level Attendant f√ºr Redakteure.  Behebt redaktionelle Fehler und ber√§t Benutzer (K√ºnstler, Leveldesigner, Spieledesigner). </li></ol><br>  Auch am Tag des Dienstes k√∂nnen Sie technische Schulden machen: F√ºgen Sie die fehlenden Tests f√ºr die alte Funktionalit√§t hinzu, erg√§nzen Sie die Dokumentation oder f√ºhren Sie ein Refactoring durch, was bei der √ºblichen Release-Planung nicht die Zeit in Anspruch nimmt. <br><br><img src="https://habrastorage.org/webt/bu/kf/w-/bukfw-ef19i1in1woa5ozjxgecm.jpeg"><br><br>  Im n√§chsten Artikel werden wir uns die Softwarearchitektur der Engine selbst sowie die Hauptmodule und Subsysteme genauer ansehen. <br><br>  Fortsetzung folgt‚Ä¶ <br><br>  Der erste Teil: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">habr.com/de/post/461623</a> <br><br><img src="https://habrastorage.org/webt/ic/l2/m8/icl2m8bbkuivjomsbt8ugzsibus.jpeg"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de465343/">https://habr.com/ru/post/de465343/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de465323/index.html">Was wird Post-Quanten-Kryptographie sein?</a></li>
<li><a href="../de465325/index.html">Spezielle Objekte, die schwer zu greifen sind</a></li>
<li><a href="../de465329/index.html">Interpretiertes Modell des maschinellen Lernens. Teil 2</a></li>
<li><a href="../de465333/index.html">Wie man Cassandra in die Augen schaut und dabei nicht Daten, Stabilit√§t und Vertrauen in NoSQL verliert</a></li>
<li><a href="../de465341/index.html">So erstellen Sie eine private Cloud f√ºr die Video√ºberwachung</a></li>
<li><a href="../de465345/index.html">FunCorp Mobile Einstellungsereignis</a></li>
<li><a href="../de465349/index.html">Ben√∂tigen Sie Agile: 5 Modelle zum Testen?</a></li>
<li><a href="../de465351/index.html">H√§ufige Probleme f√ºr diejenigen, die den Gostender gewonnen haben</a></li>
<li><a href="../de465353/index.html">ICS-Sicherheitsaudit</a></li>
<li><a href="../de465355/index.html">Wenn 'a' nicht gleich 'a' ist. Nach einem Hack</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>