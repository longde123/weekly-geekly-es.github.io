<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔂 👶 🧓🏾 Angulareact 🖤 👎🏽 👨🏽‍🤝‍👨🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich habe ein Problem. Die Anwendung ist in Angular und die Komponentenbibliothek in React geschrieben. Klonen Sie eine Bibliothek zu teuer. Daher müss...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Angulareact</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468063/"><p>  Ich habe ein Problem.  Die Anwendung ist in Angular und die Komponentenbibliothek in React geschrieben.  Klonen Sie eine Bibliothek zu teuer.  Daher müssen Sie React-Komponenten in einer Angular-Anwendung mit minimalen Kosten verwenden.  Wir finden heraus, wie es geht. </p><a name="habracut"></a><br><h1 id="diskleymer">  Haftungsausschluss </h1><br><p>  Ich bin überhaupt kein Spezialist bei Angular.  Ich habe die erste Version im Jahr 2017 ausprobiert und mich dann ein wenig mit AngularDart befasst. Jetzt bin ich auf Anwendungsunterstützung für eine moderne Version des Frameworks gestoßen.  Wenn es Ihnen so vorkommt, als wären die Entscheidungen seltsam oder "aus einer anderen Welt", dann scheint es Ihnen nicht so. </p><br><p>  Die im Artikel vorgestellte Lösung wurde noch nicht in realen Projekten getestet und ist nur ein Konzept.  Verwenden Sie es auf eigenes Risiko. </p><br><h1 id="problema">  Das Problem </h1><br><p>  Ich unterstütze und entwickle jetzt eine ziemlich große Anwendung auf Angular 8. Außerdem gibt es einige kleine Anwendungen auf React und plant, ein Dutzend weitere (auch auf React) zu erstellen.  Alle Anwendungen werden für die internen Anforderungen des Unternehmens verwendet und sollten den gleichen Stil haben.  Die einzig logische Möglichkeit besteht darin, eine Komponentenbibliothek zu erstellen, auf deren Grundlage Sie schnell jede Anwendung erstellen können. </p><br><p>  In der aktuellen Situation können Sie in React jedoch nicht einfach eine Bibliothek aufnehmen und schreiben.  Sie können es nicht in der größten Anwendung verwenden - es ist in Angular geschrieben.  Ich bin nicht der erste, der auf dieses Problem stößt.  Das erste, was bei Google für "Reagieren in Winkel" zu finden ist, ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">das Microsoft-Repository</a> .  Leider hat diese Lösung überhaupt keine Dokumentation.  In der Readme-Datei des Projekts wird außerdem klargestellt, dass das Paket intern von Microsoft verwendet wird, das Team keine offensichtlichen Pläne für seine Entwicklung hat und die Verwendung nur auf eigenes Risiko erfolgt.  Ich bin nicht bereit, ein so zweideutiges Paket in die Produktion zu ziehen, also habe ich beschlossen, mein Fahrrad zu schreiben. </p><br><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/829e9e3b-1673-4067-9278-982f01e95d52/__2019-09-18__20.15.04.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=ASIAT73L2G45FTZDIACS%2F20190919%2Fus-west-2%2Fs3%2Faws4_request&amp;X-Amz-Date=20190919T122008Z&amp;X-Amz-Expires=86400&amp;X-Amz-Security-Token=AgoJb3JpZ2luX2VjENv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCwuWc5hbwOjFa2gBX2qSa%2BrPvZmF79lBk8yc%2FXnhR5OgIgVv7r%2B%2FVK4eHtMZ4VXucxi3NFCVA8KGyzNOFcqsvvb0gq4wMIpP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgwyNzQ1NjcxNDkzNzAiDIQt1CA3IZ1diLWvKSq3A%2F7R4EFxWqz0ZQ3cWqbpSl7qAIZE6%2BRc8fFwpNm25pdxvEdKJXJAPDdmXjAfCd0QSedX2LOyOJ9aBjD1QXuPFe1EbMLho%2FztYBqFQyGw10VbM46reb9hex75UyV9W%2F4n%2Fx9A112LY%2FcYImpbCNz7C03aCnSybewd8uI6CbFQxR2T%2FttEuN%2BM7MINO3IiyviPzfxQH1%2FOh6%2BXJ%2FXnn7Hqy1cl07wbV9etV2Ul%2Bp71IAlE4sBaP2ZLCasQEwCbMS7dqxuQBD2vIaoW6xePr5UnIirdOwoTHmyCgkUvJbcMC159%2Bo2MXfWmwyYq3Zfv%2B%2FVoJAwiaSewM1LSls%2FUkj4TF0ILK58Isc2qFD9%2F07VV%2BoA9i0ppr%2BZhyxhLr02OftacApW638RhHUT2I%2B0DqSRdtLpRA0%2FJzJKfUvTuWY0P5sA7ulAEzvCZe3MuavIxQY9mAGyRJja%2BfRx6l3W49Gfk2Fdzv7054xQ0nJaaoaOrM7jR7taTU8HzoGnH1M3Ap0UXLu%2FVXYWFot78zsa0aDta2RIREzoL%2FDb7i8Sm6Ec5gPeTu7udP%2F2Zrgyidr0wPy1FEir0wGZJYj4wpLCN7AU6tAGdmaM%2F3OTcKirVsB97LangLG7SvqYaEZ0QCtZjQ1ismZ2d0epUNHq8J%2FbnEpM4DugcaKiXTKgLERS6nk61%2Bz3BEKh3GGUVz%2FS%2BYpHJEAo5QsoHBXiwvWlxEfnDVvYkyob2qghv0NjLp9ljkrHLnzgFGLAasNIDiPZT69zfBffDJwBhDVp6p7s3LefdevJiv5lMaMm3P272igMJjgxTiSCHiJrUVMvSgZ9PLY9ZICyyJCc2z60%3D&amp;X-Amz-Signature=5102f76091725ed13505a80485bbb95a0bcf5fc1ec2205aad9525c46ad70b09e&amp;X-Amz-SignedHeaders=host&amp;response-content-disposition=filename%20%3D%22__2019-09-18__20.15.04.png%22" alt="Bild"></p><br><p>  Offizielle Seite @ Angular-React / Core </p><br><h1 id="reshenie">  Lösung </h1><br><p>  React ist eine Bibliothek zur Lösung eines bestimmten Problems - der Verwaltung des DOM-Baums eines Dokuments.  Wir können jedes React-Element in einen beliebigen DOM-Knoten einfügen. </p><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Hello = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> &lt;p&gt;Hello, React!<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; render(<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Hello</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">, document.getElementById('#hello'));</span></span></code> </pre> <br><p>  Darüber hinaus gibt es keine Einschränkungen für wiederholte Aufrufe der <code>render</code> .  Das heißt, es ist möglich, jede Komponente separat im DOM zu rendern.  Und genau das wird dazu beitragen, den ersten Schritt in der Integration zu tun. </p><br><h2 id="podgotovka">  Vorbereitung </h2><br><p>  Zunächst ist es wichtig zu verstehen, dass React standardmäßig keine besonderen Bedingungen während der Montage erfordert.  Wenn Sie JSX nicht verwenden, sich aber darauf beschränken, <code>createElement</code> , müssen Sie keine Schritte unternehmen. Alles funktioniert <code>createElement</code> . </p><br><p>  Aber natürlich sind wir es gewohnt, JSX zu verwenden und wollen es nicht verlieren.  Glücklicherweise verwendet Angular standardmäßig TypeScript, das JSX in Funktionsaufrufe umwandeln kann.  Sie müssen nur das Compiler-Flag <code>--jsx=react</code> hinzufügen oder in <code>tsconfig.json</code> im Abschnitt <code>compilerOptions</code> die Zeile <code>"jsx": "react"</code> hinzufügen. </p><br><h2 id="integraciya-otobrazheniya">  Integration anzeigen </h2><br><p>  Um zu beginnen, müssen wir sicherstellen, dass die React-Komponenten in der Angular-Anwendung angezeigt werden.  Das heißt, damit die resultierenden DOM-Elemente aus der Bibliotheksarbeit die richtigen Stellen im Elementbaum einnehmen. </p><br><p>  Jedes Mal, wenn Sie die React-Komponente verwenden, ist es zu schwierig, über das korrekte Aufrufen der <code>render</code> nachzudenken.  Außerdem müssen wir in Zukunft Komponenten auf Datenebene und Ereignishandler integrieren.  In diesem Fall ist es sinnvoll, eine Winkelkomponente zu erstellen, die die gesamte Logik zum Erstellen und Steuern des React-Elements enthält. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Hello.tsx export const Hello = () =&gt; &lt;p&gt;Hello, React!&lt;/p&gt;; // hello.component.ts import { createElement } from 'react'; import { render } from 'react-dom'; import { Hello } from './Hello'; @Component({ selector: 'app-hello', template: `&lt;div #react&gt;&lt;/div&gt;`, }) export class HelloComponent implements OnInit { @ViewChild('react', { read: ElementRef, static: true }) ref: ElementRef; ngOnInit() { this.renderReactElement(); } private renderReactElement() { const props = {}; const reactElement = createElement(Hello, props); render(reactElement, this.ref.nativeElement); } }</span></span></code> </pre> <br><p>  Der Code der Winkelkomponente ist äußerst einfach.  Es selbst rendert nur einen leeren Container und erhält einen Link dazu.  In diesem Fall wird zum Zeitpunkt der Initialisierung das Rendern des React-Elements aufgerufen.  Es wird mit der Funktion <code>createElement</code> und an die <code>createElement</code> übergeben, die es in den aus Angular erstellten DOM-Knoten platziert.  Sie können eine solche Komponente wie jede andere Angulat-Komponente ohne besondere Bedingungen verwenden. </p><br><h2 id="integraciya-vhodnyh-dannyh">  Eingabeintegration </h2><br><p>  Wenn Sie Schnittstellenelemente anzeigen, müssen Sie normalerweise Daten an diese übertragen.  Alles hier ist auch ziemlich prosaisch - wenn Sie <code>createElement</code> aufrufen <code>createElement</code> Sie alle Daten über die Requisiten an die Komponente übergeben. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Hello.tsx export const Hello = ({ name }) =&gt; &lt;p&gt;Hello, {name}!&lt;/p&gt;; // hello.component.ts import { createElement } from 'react'; import { render } from 'react-dom'; import { Hello } from './Hello'; @Component({ selector: 'app-hello', template: `&lt;div #react&gt;&lt;/div&gt;`, }) export class HelloComponent implements OnInit { @ViewChild('react', { read: ElementRef, static: true }) ref: ElementRef; @Input() name: string; ngOnInit() { this.renderReactElement(); } private renderReactElement() { const props = { name: this.name, }; const reactElement = createElement(Hello, props); render(reactElement, this.ref.nativeElement); } }</span></span></code> </pre> <br><p>  Jetzt können Sie die Namenszeichenfolge an die Angular-Komponente übergeben. Sie fällt in die React-Komponente und wird gerendert.  Wenn sich die Zeile jedoch aus externen Gründen ändert, weiß React nichts davon und wir erhalten eine veraltete Anzeige.  Angular verfügt über eine <code>ngOnChanges</code> Lebenszyklusmethode, mit der Sie Änderungen der Komponentenparameter und Reaktionen darauf verfolgen können.  Wir implementieren die <code>OnChanges</code> Schnittstelle und fügen eine Methode hinzu: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ... ngOnChanges(_: SimpleChanges) { this.renderReactElement(); } // ...</span></span></code> </pre> <br><p>  Es reicht aus, die <code>render</code> mit einem aus neuen Requisiten erstellten Element erneut aufzurufen, und die Bibliothek selbst ermittelt, welche Teile des Baums gerendert werden sollen.  Der lokale Status innerhalb der Komponente bleibt ebenfalls erhalten. </p><br><p>  Nach diesen Manipulationen kann die Winkelkomponente auf die übliche Weise verwendet werden und Daten an sie übergeben. </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">app-hello</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Angular"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">app-hello</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">app-hello</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">app-hello</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Für eine genauere Arbeit mit der Aktualisierung von Komponenten können Sie sich die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Strategie</a> zur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Änderungserkennung</a> ansehen.  Ich werde dies nicht im Detail betrachten. </p><br><h2 id="integraciya-vyhodnyh-dannyh">  Ausgabe-Integration </h2><br><p>  Ein weiteres Problem bleibt bestehen - die Reaktion der Anwendung auf Ereignisse innerhalb der React-Komponenten.  <code>@Output</code> wir <code>@Output</code> Dekorator und <code>@Output</code> den Rückruf über Requisiten an die Komponente weiter. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Hello.tsx export const Hello = ({ name, onClick }) =&gt; ( &lt;div&gt; &lt;p&gt;Hello, {name}!&lt;/p&gt; &lt;button onClick={onClick}&gt;Say "hello"&lt;/button&gt; &lt;/div&gt; ); // hello.component.ts import { createElement } from 'react'; import { render } from 'react-dom'; import { Hello } from './Hello'; @Component({ selector: 'app-hello', template: `&lt;div #react&gt;&lt;/div&gt;`, }) export class HelloComponent implements OnInit { @ViewChild('react', { read: ElementRef, static: true }) ref: ElementRef; @Input() name: string; @Output() click = new EventEmitter&lt;string&gt;(); ngOnInit() { this.renderReactElement(); } private renderReactElement() { const props = { name: this.name, onClick: () =&gt; this.lick.emit(`Hello, ${this.name}!`), }; const reactElement = createElement(Hello, props); render(reactElement, this.ref.nativeElement); } }</span></span></code> </pre> <br><p>  Fertig.  Wenn Sie die Komponente verwenden, können Sie Ereignishandler registrieren und darauf reagieren. </p><br><pre> <code class="html hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">app-hello</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name"</span></span></span><span class="hljs-tag"> (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">)=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sayHello($event)"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">app-hello</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Das Ergebnis ist ein voll funktionsfähiger Wrapper für die React-Komponente zur Verwendung in einer Angular-Anwendung.  Es kann Daten übertragen und auf darin enthaltene Ereignisse reagieren. </p><br><h2 id="one-more-thing">  Noch eine Sache ... </h2><br><p>  Für mich ist die Zwei-Wege- <code>ngModel</code> die bequemste Sache in Angular.  Es ist bequem, einfach und erfordert eine sehr kleine Menge Code.  In der aktuellen Implementierung ist eine Integration jedoch nicht möglich.  Dies kann behoben werden.  Um ehrlich zu sein, verstehe ich nicht wirklich, wie dieser Mechanismus aus Sicht des internen Geräts funktioniert.  Daher gebe ich zu, dass meine Lösung super-suboptimal ist und ich würde mich freuen, wenn Sie in den Kommentaren eine schönere Möglichkeit zur Unterstützung von <code>ngModel</code> . </p><br><p>  Zunächst müssen Sie die <code>ControlValueAccessor</code> Schnittstelle implementieren (aus dem Paket <code>@angular/forms</code> und der Komponente einen neuen Anbieter hinzufügen. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { NG_VALUE_ACCESSOR, ControlValueAccessor } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/forms'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> REACT_VALUE_ACCESSOR: any = { <span class="hljs-attr"><span class="hljs-attr">provide</span></span>: NG_VALUE_ACCESSOR, <span class="hljs-attr"><span class="hljs-attr">useExisting</span></span>: forwardRef(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> HelloComponent), <span class="hljs-attr"><span class="hljs-attr">multi</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }; @Component({ <span class="hljs-attr"><span class="hljs-attr">selector</span></span>: <span class="hljs-string"><span class="hljs-string">'app-hello'</span></span>, <span class="hljs-attr"><span class="hljs-attr">template</span></span>: <span class="hljs-string"><span class="hljs-string">`&lt;div #react&gt;&lt;/div&gt;`</span></span>, <span class="hljs-attr"><span class="hljs-attr">providers</span></span>: [PREACT_VALUE_ACCESSOR], }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PreactComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnInit</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnChanges</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ControlValueAccessor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p>  Diese Schnittstelle erfordert die Implementierung der Methoden <code>onBlur</code> , <code>writeValue</code> , <code>registerOnChange</code> , <code>registerOnTouched</code> .  Alle von ihnen sind in der Dokumentation gut beschrieben.  Wir erkennen sie. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    const noop = () =&gt; {}; @Component({ selector: 'app-hello', template: `&lt;div #react&gt;&lt;/div&gt;`, providers: [PREACT_VALUE_ACCESSOR], }) export class PreactComponent implements OnInit, OnChanges, ControlValueAccessor { // ... private innerValue: string; //      ngModel private onTouchedCallback: Callback = noop; private onChangeCallback: Callback = noop; //       //       get value(): string { return this.innerValue; } set value(v: string) { if (v !== this.innerValue) { this.innerValue = v; //    ,   this.onChangeCallback(v); } } writeValue(value: string) { if (value !== this.innerValue) { this.innerValue = value; //        this.renderReactElement(); } } //   registerOnChange(fn: Callback) { this.onChangeCallback = fn; } registerOnTouched(fn: Callback) { this.onTouchedCallback = fn; } //    onBlur() { this.onTouchedCallback(); } }</span></span></code> </pre> <br><p>  Danach müssen Sie sicherstellen, dass all dies an die React-Komponente übergeben wird.  Leider kann React nicht mit der bidirektionalen Datenbindung arbeiten, daher geben wir ihm einen Wert und einen Rückruf, um ihn zu ändern.  <code>renderReactElement</code> Methode. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ... private renderReactElement() { const props = { name: this.name, onClick: () =&gt; this.lick.emit(`Hello, ${this.name}!`), model: { value: this.value, onChange: v =&gt; { this.value = v; } }, }; const reactElement = createElement(Hello, props); render(reactElement, this.ref.nativeElement); } // ...</span></span></code> </pre> <br><p>  In der React-Komponente verwenden wir diesen Wert und den Rückruf. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Hello = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ name, onClick, model }</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Hello, {name}!</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{onClick}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Say "hello"</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{model.value}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{e</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> model.onChange(e.target.value)} /&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> );</span></span></code> </pre> <br><p>  Jetzt haben wir React wirklich in Angular integriert.  Sie können die resultierende Komponente beliebig verwenden. </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">app-hello</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name"</span></span></span><span class="hljs-tag"> (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">)=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sayHello($event)"</span></span></span><span class="hljs-tag"> [(</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngModel</span></span></span><span class="hljs-tag">)]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name"</span></span></span><span class="hljs-tag"> &gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">app-hello</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h1 id="itog">  Zusammenfassung </h1><br><p>  React ist eine sehr einfache Bibliothek, die sich leicht in alles integrieren lässt.  Mit dem gezeigten Ansatz können Sie nicht nur alle React-Komponenten in Angular-Anwendungen fortlaufend verwenden, sondern auch die gesamte Anwendung schrittweise migrieren. </p><br><p>  In diesem Artikel habe ich überhaupt nicht auf Stylingprobleme eingegangen.  Wenn Sie klassische CSS-in-JS-Lösungen (Styled-Components, Emotion, JSS) verwenden, müssen Sie keine zusätzlichen Maßnahmen ergreifen.  Wenn das Projekt jedoch produktivere Lösungen erfordert (Kunstrasen, Linaria, CSS-Module), müssen Sie an der Webpack-Konfiguration arbeiten.  Feature Story - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Passen Sie die Webpack-Konfiguration in Ihrer Angular-Anwendung an</a> . </p><br><p>  Um die Anwendung vollständig von Angular nach React zu migrieren, müssen Sie noch das Problem der Implementierung von Diensten in React-Komponenten lösen.  Eine einfache Möglichkeit besteht darin, den Service in eine Wrapper-Komponente zu integrieren und durch Requisiten weiterzuleiten.  Der schwierige Weg besteht darin, eine Schicht zu schreiben, die per Token Dienste vom Injektor erhält.  Berücksichtigung dieses Themas über den Rahmen des Artikels hinaus. </p><br><h1 id="bonus">  Bonus </h1><br><p>  Es ist wichtig zu verstehen, dass mit diesem Ansatz für 85 KB Angular fast 40 KB React- und React <code>react-dom</code> Code <code>react</code> .  Dies kann erhebliche Auswirkungen auf die Geschwindigkeit der Anwendung haben.  Ich empfehle die Verwendung des Miniatur-Preact, der nur 3 KB wiegt.  Die Integration ist fast nicht anders. </p><br><ol><li>  In <code>tsconfig.json</code> fügen <code>tsconfig.json</code> eine neue Kompilierungsoption hinzu - <code>"jsxFactory": "h"</code> zeigt an, dass Sie die <code>h</code> Funktion zum Konvertieren von JSX verwenden müssen.  <code>import { h } from 'preact'</code> nun in jeder Datei mit JSX-Code <code>import { h } from 'preact'</code> . </li><li>  Alle Aufrufe von <code>React.createElement</code> durch <code>Preact.h</code> . </li><li>  Alle Aufrufe von <code>ReactDOM.render</code> durch <code>Preact.render</code> . </li></ol><br><p>  Fertig!  Lesen Sie die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anweisungen für die Migration von React zu Preact</a> .  Es gibt praktisch keine Unterschiede. </p><br><h1 id="upd-19919-1649">  UPD 19.9.19 16.49 </h1><br><p>  Thematischer Link aus Kommentaren - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Micro Frontends</a> </p><br><h1 id="upd-20919-1430">  UPD 20.9.19 14.30 </h1><br><p>  Ein weiterer thematischer Link aus den Kommentaren - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Micro Frontends</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de468063/">https://habr.com/ru/post/de468063/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de468051/index.html">VDS mit lizenziertem Windows Server für 100 Rubel: Mythos oder Realität?</a></li>
<li><a href="../de468053/index.html">Maschinelles Lernen für Ihre Wohnungssuche. Teil 1</a></li>
<li><a href="../de468057/index.html">Unix-ähnliche Betriebssystementwicklung - Multitasking und Systemaufrufe (7)</a></li>
<li><a href="../de468059/index.html">Meine zweite Woche mit Haiku: viele versteckte Diamanten und angenehme Überraschungen sowie einige Probleme</a></li>
<li><a href="../de468061/index.html">Cron unter Linux: Verlauf, Verwendung und Gerät</a></li>
<li><a href="../de468065/index.html">Mentale Produktmanagementmodelle für alle</a></li>
<li><a href="../de468067/index.html">So funktioniert Alpha Compositing</a></li>
<li><a href="../de468071/index.html">Eduard Medwedew, CTO bei Tungsten Labs: „Wir sind so weit gewachsen, dass Technologie massiven Schaden anrichten kann.“</a></li>
<li><a href="../de468073/index.html">Andrei Terekhov: "Sie können so viel sagen, wie Sie möchten, dass Amerikaner besser sind, aber unser Auto bricht nie zusammen."</a></li>
<li><a href="../de468075/index.html">Die Verwendung von siamesischen neuronalen Netzen bei der Suche</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>