<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶Ö üíñ ‚¨áÔ∏è Entity Framework 6 con b√∫squeda de texto completo a trav√©s de LINQ üë®‚Äçüöí üëæ üë®üèø‚Äçüè´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quiero compartir mi muleta para resolver un problema bastante banal: c√≥mo hacer amigos en la b√∫squeda de texto completo de MSSQL con Entity Framework....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Entity Framework 6 con b√∫squeda de texto completo a trav√©s de LINQ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455160/"><p>  Quiero compartir mi muleta para resolver un problema bastante banal: c√≥mo hacer amigos en la b√∫squeda de texto completo de MSSQL con Entity Framework.  El tema es muy especializado, pero me parece que es relevante hoy.  Para los interesados, pido gato. </p><a name="habracut"></a><br><h1 id="vse-nachalos-s-boli">  Todo comenz√≥ con dolor. </h1><br><p>  Desarrollo proyectos en C # (ASP.NET) y a veces escribo microservicios.  En la mayor√≠a de los casos, uso la base de datos MSSQL para trabajar con datos.  Entity Framework se utiliza como un enlace entre la base de datos y mi proyecto.  Con EF, obtengo amplias oportunidades para trabajar con datos, generar las consultas correctas y regular la carga en el servidor.  El mecanismo m√°gico de LINQ simplemente cautiva con sus capacidades.  Con los a√±os, ya no imagino formas m√°s r√°pidas y convenientes de trabajar con la base de datos.  Pero como casi cualquier ORM, EF tiene una serie de desventajas.  En primer lugar, este es el rendimiento, pero este es el tema de un art√≠culo separado.  Y en segundo lugar, cubre las capacidades de la base de datos en s√≠. </p><br><p> MSSQL tiene una b√∫squeda de texto completo incorporada que funciona de forma inmediata.  Para realizar consultas de texto completo, puede usar los predicados integrados (CONTAINS y FREETEXT) o funciones (CONTAINSTABLE y FREETEXTTABLE).  Solo hay un problema: ¬°EF no admite consultas de texto completo, desde el principio! </p><br><p>  Dar√© un ejemplo de la experiencia real.  Supongamos que tengo una tabla de art√≠culos - Art√≠culo, y creo una clase que describe esta tabla: </p><br><pre><code class="plaintext hljs">/// c# public partial class Article { public int Id { get; set; } public System.DateTime Date { get; set; } public string Text { get; set; } public bool Active { get; set; } }</code> </pre> <br><p>  Luego necesito hacer una selecci√≥n de estos art√≠culos, digamos, mostrar los √∫ltimos 10 art√≠culos publicados: </p><br><pre> <code class="plaintext hljs">/// c# dbEntities db = new dbEntities(); var articles = db.Article .Where(n =&gt; n.Active) .OrderByDescending(n =&gt; n.Date) .Take(10) .ToArray();</code> </pre> <br><p>  Todo es muy hermoso hasta que aparece la tarea de agregar b√∫squeda de texto completo.  Como no hay soporte para las funciones de selecci√≥n de texto completo en EF (.NET core 2.1 ya lo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tiene</a> parcialmente), queda usar una biblioteca de terceros o escribir una consulta en SQL puro. </p><br><p>  La consulta SQL del ejemplo anterior no es tan complicada: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP (<span class="hljs-number"><span class="hljs-number">10</span></span>) [Extent1].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [Extent1].[<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>], [Extent1].[<span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>], [Extent1].[Active] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Active] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [dbo].[Article] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Extent1] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> [Extent1].[Active] = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> [Extent1].[<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre> <br><p>  En proyectos reales, las cosas no son tan simples.  Las consultas a la base de datos son mucho m√°s complicadas y es dif√≠cil mantenerlas manualmente.  Como resultado, la primera vez que escrib√≠ una consulta usando LINQ, obtuve el texto generado de la consulta SQL en la base de datos y ya introduje las condiciones de selecci√≥n de datos de texto completo.  Luego lo envi√© a <code>db.Database.SqlQuery</code> y recib√≠ los datos que necesitaba.  Todo esto es bueno, por supuesto, siempre y cuando la solicitud no necesite colgar una docena de filtros diferentes con condiciones y condiciones complejas. </p><br><p>  Entonces, tengo un dolor espec√≠fico.  ¬°Debemos resolverlo! </p><br><h1 id="v-poiskah-resheniya">  En busca de una soluci√≥n </h1><br><p>  Una vez m√°s, sentado en mi b√∫squeda favorita con la esperanza de encontrar al menos alguna soluci√≥n, me encontr√© con <a href="">este repositorio</a> .  Con esta soluci√≥n, se puede implementar el soporte de predicado LINQ (CONTAINS y FREETEXT).  Gracias al soporte de EF 6 de la interfaz especial <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>IDbCommandInterceptor</code></a> , que le permite interceptar la consulta SQL finalizada, esta soluci√≥n se implement√≥ antes de enviarla a la base de datos.  Una cadena de marcador especial generada se sustituye en el campo <code>Contains</code> , y luego de generar la solicitud, este lugar se reemplaza con un predicado Ejemplo: </p><br><pre> <code class="plaintext hljs">/// c# var text = FullTextSearchModelUtil.Contains("code"); db.Tables.Where(c=&gt;c.Fullname.Contains(text));</code> </pre> <br><p>  Sin embargo, si la selecci√≥n de datos necesita ser ordenada por el rango de coincidencias, entonces esta soluci√≥n ya no ser√° adecuada y tendr√° que escribir la consulta SQL manualmente.  En esencia, esta soluci√≥n reemplaza el LIKE habitual con una selecci√≥n de predicado. </p><br><p>  Entonces, en esta etapa, ten√≠a una pregunta: ¬øes posible implementar una b√∫squeda de texto completo real usando las funciones integradas de MS SQL (CONTAINSTABLE y FREETEXTTABLE) para que todo esto se pueda generar a trav√©s de LINQ e incluso con soporte para ordenar la consulta por el rango de coincidencias?  ¬°Result√≥ que puedes! </p><br><h1 id="realizaciya">  Implementaci√≥n </h1><br><p>  Para empezar, era necesario desarrollar la l√≥gica para escribir la consulta en s√≠ usando LINQ.  Dado que en las consultas SQL reales con selecciones de texto completo, JOIN se usa con mayor frecuencia para unir una tabla virtual con rangos, decid√≠ seguir el mismo camino en la consulta LINQ. </p><br><p>  Aqu√≠ hay un ejemplo de dicha consulta LINQ: </p><br><pre> <code class="plaintext hljs">/// c# var queryFts = db.FTS_Int.Where(n =&gt; n.Query.Contains(queryText)); var query = db.Article .Join(queryFts, article =&gt; article.Id, fts =&gt; fts.Key, (article, fts) =&gt; new { article.Id, article.Text, fts.Key, fts.Rank, }) .OrderByDescending(n =&gt; n.Rank);</code> </pre> <br><p>  Tal c√≥digo a√∫n no se pudo compilar, pero ya resolvi√≥ visualmente el problema de ordenar los datos resultantes por rango.  Quedaba por ponerlo en pr√°ctica. </p><br><p>  Clase adicional <code>FTS_Int</code> utilizada en esta solicitud: </p><br><pre> <code class="plaintext hljs">/// c# public partial class FTS_Int { public int Key { get; set; } public int Rank { get; set; } public string Query { get; set; } }</code> </pre> <br><p>  El nombre no se eligi√≥ por casualidad, ya que la columna clave en esta clase debe coincidir en tic con la columna clave en la tabla de b√∫squeda (en mi ejemplo, con <code>[Article].[Id]</code> tipo <code>int</code> ).  En caso de que necesite realizar consultas en otras tablas con otros tipos de columnas clave, supuse que simplemente copiar√≠a una clase similar y crear√≠a su clave del tipo que se necesita. </p><br><p>  Se supon√≠a que la condici√≥n para la formaci√≥n de una consulta de texto completo se pasaba en la variable <code>queryText</code> .  Para formar el texto de esta variable, se implement√≥ una funci√≥n separada: </p><br><pre> <code class="plaintext hljs">/// c# string queryText = FtsSearch.Query( dbContext: db, //   ,       ftsEnum: FtsEnum.CONTAINS, //  : CONTAINS  FREETEXT tableQuery: typeof(News), //       tableFts: typeof(FTS_Int), //    search: "text"); //   </code> </pre> <br><p>  Cumplimiento de la solicitud lista y recuperaci√≥n de datos: </p><br><pre> <code class="plaintext hljs">/// c# var result = FtsSearch.Execute(() =&gt; query.ToList());</code> </pre> <br><p>  La √∫ltima funci√≥n de contenedor <code>FtsSearch.Execute</code> se usa para conectar temporalmente la interfaz <code>IDbCommandInterceptor</code> .  En el ejemplo proporcionado por el enlace anterior, el autor prefiri√≥ usar el algoritmo de sustituci√≥n de consultas constantemente para todas las solicitudes.  Como resultado, despu√©s de conectar el mecanismo de reemplazo de consultas, cada solicitud busca la combinaci√≥n necesaria para el reemplazo.  Esta opci√≥n me pareci√≥ un desperdicio, por lo tanto, la ejecuci√≥n de la solicitud de datos en s√≠ se realiza en la funci√≥n transmitida, que antes de la llamada conecta la consulta, reemplaza autom√°ticamente y, despu√©s de la llamada, la desconecta. </p><br><h1 id="primenenie">  Solicitud </h1><br><p>  Estoy usando la generaci√≥n autom√°tica de clases de modelo de datos a partir de una base de datos usando el archivo edmx.  Dado que simplemente no puede usar la clase <code>FTS_Int</code> creada en EF debido a la falta de los metadatos necesarios en <code>DbContext</code> , cre√© una tabla real de acuerdo con su modelo (tal vez alguien conozca una mejor manera, me complacer√° su ayuda en los comentarios): </p><br><p>  <em>Captura de pantalla de la tabla creada en el archivo edmx</em> </p><br><p><img src="https://habrastorage.org/webt/p3/my/mm/p3mymmi7n_n6kpsxqibzdrrixfi.png"></p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> [dbo].[FTS_Int] ( [<span class="hljs-keyword"><span class="hljs-keyword">Key</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [<span class="hljs-keyword"><span class="hljs-keyword">Rank</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [<span class="hljs-keyword"><span class="hljs-keyword">Query</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> [PK_FTS_Int] PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> CLUSTERED ([<span class="hljs-keyword"><span class="hljs-keyword">Key</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">ASC</span></span>) );</code> </pre> <br><p>  Despu√©s de eso, al actualizar el archivo edmx desde la base de datos, agregue la tabla creada y obtenga su clase generada: </p><br><pre> <code class="plaintext hljs">/// c# public partial class FTS_Int { public int Key { get; set; } public int Rank { get; set; } public string Query { get; set; } }</code> </pre> <br><p>  No se realizar√°n consultas en esta tabla; solo es necesario para que los metadatos se formen correctamente para crear la consulta.  El √∫ltimo ejemplo de uso de consulta de base de datos de texto completo: </p><br><pre> <code class="plaintext hljs">/// c# string queryText = FtsSearch.Query( dbContext: db, ftsEnum: FtsEnum.CONTAINS, tableQuery: typeof(Article), tableFts: typeof(FTS_Int), search: "text"); var queryFts = db.FTS_Int.Where(n =&gt; n.Query.Contains(queryText)); var query = db.Article .Where(n =&gt; n.Active) .Join(queryFts, article =&gt; article.Id, fts =&gt; fts.Key, (article, fts) =&gt; new { article, fts.Rank, }) .OrderByDescending(n =&gt; n.Rank) .Take(10) .Select(n =&gt; n.article); var result = FtsSearch.Execute(() =&gt; query.ToList());</code> </pre> <br><p>  Tambi√©n hay soporte para solicitudes as√≠ncronas: </p><br><pre> <code class="plaintext hljs">/// c# var result = await FtsSearch.ExecuteAsync(async () =&gt; await query.ToListAsync());</code> </pre> <br><p>  Consulta SQL generada antes de Autocorrecci√≥n: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP (<span class="hljs-number"><span class="hljs-number">10</span></span>) [Project1].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [Project1].[<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>], [Project1].[<span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>], [Project1].[Active] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Active] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> [Extent1].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [Extent1].[<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>], [Extent1].[<span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>], [Extent1].[Active] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Active], [Extent2].[<span class="hljs-keyword"><span class="hljs-keyword">Rank</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Rank</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [dbo].[Article] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Extent1] <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> [dbo].[FTS_Int] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Extent2] <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> [Extent1].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] = [Extent2].[<span class="hljs-keyword"><span class="hljs-keyword">Key</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ([Extent1].[Active] = <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> ([Extent2].[<span class="hljs-keyword"><span class="hljs-keyword">Query</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> @p__linq__0 ESCAPE N<span class="hljs-string"><span class="hljs-string">'~'</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Project1] <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> [Project1].[<span class="hljs-keyword"><span class="hljs-keyword">Rank</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre> <br><p>  Consulta SQL generada despu√©s de autocorrecci√≥n: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP (<span class="hljs-number"><span class="hljs-number">10</span></span>) [Project1].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [Project1].[<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>], [Project1].[<span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>], [Project1].[Active] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Active] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> [Extent1].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [Extent1].[<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>], [Extent1].[<span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>], [Extent1].[Active] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Active], [Extent2].[<span class="hljs-keyword"><span class="hljs-keyword">Rank</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Rank</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [dbo].[Article] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Extent1] <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> CONTAINSTABLE([dbo].[Article],(*),<span class="hljs-string"><span class="hljs-string">'text'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Extent2] <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> [Extent1].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] = [Extent2].[<span class="hljs-keyword"><span class="hljs-keyword">Key</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ([Extent1].[Active] = <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Project1] <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> [Project1].[<span class="hljs-keyword"><span class="hljs-keyword">Rank</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre> <br><p>  Por defecto, la b√∫squeda de texto completo funciona en todas las columnas de la tabla: </p><br><pre> <code class="sql hljs">CONTAINSTABLE([dbo].[Article],(*),'text')</code> </pre> <br><p>  Si necesita seleccionar solo ciertos campos, puede especificarlos en el par√°metro de campos de la funci√≥n <code>FtsSearch.Query</code> . </p><br><h1 id="itogo">  Total </h1><br><p>  El resultado es el soporte de b√∫squeda de texto completo en LINQ. </p><br><p>  Los matices de este enfoque. </p><br><ol><li><p>  El par√°metro de b√∫squeda en la funci√≥n <code>FtsSearch.Query</code> no utiliza ninguna comprobaci√≥n o envoltura para protegerse contra la inyecci√≥n de SQL.  El valor de esta variable se pasa tal cual al texto de la solicitud.  Si tienes alguna idea sobre esto, escribe en los comentarios.  Us√© la expresi√≥n regular habitual que simplemente elimina todos los caracteres que no sean letras y n√∫meros. </p><br></li><li><p>  Tambi√©n debe tener en cuenta las caracter√≠sticas de la creaci√≥n de expresiones para consultas de texto completo.  Par√°metro para funcionar </p><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> CONTAINSTABLE([dbo].[News],(*),' ')</code> </pre> <br><p>  Tiene un formato no v√°lido porque MS SQL requiere la separaci√≥n de palabras por literales l√≥gicos.  Para que la solicitud se complete con √©xito, debe corregirla de esta manera: </p><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> CONTAINSTABLE([dbo].[News],(*),' and ')</code> </pre> <br><p>  o cambiar la funci√≥n de recuperaci√≥n de datos </p><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> FREETEXTTABLE([dbo].[News],(*),' ')</code> </pre> <br><p>  Para obtener m√°s informaci√≥n sobre las caracter√≠sticas de la creaci√≥n de consultas, es mejor consultar la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n oficial</a> . </p><br></li><li><p>  El registro est√°ndar con esta soluci√≥n no funciona correctamente.  Se ha agregado un registrador especial para esto: </p><br><pre> <code class="plaintext hljs">/// c# db.Database.Log = (val) =&gt; Console.WriteLine(val);</code> </pre> <br><p>  Si observa la consulta generada en la base de datos, se generar√° antes de procesar las funciones de reemplazo autom√°tico. </p><br></li></ol><br><p>  Durante las pruebas, verifiqu√© consultas m√°s complejas con m√∫ltiples selecciones de diferentes tablas y no hubo problemas. </p><br><p>  Fuentes de <a href="">GitHub</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/455160/">https://habr.com/ru/post/455160/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../455146/index.html">Replicaci√≥n de alto nivel en el DBMS Tarantool</a></li>
<li><a href="../455148/index.html">Resolvemos tareas de toma de decisiones basadas en datos</a></li>
<li><a href="../455152/index.html">Mejore su aplicaci√≥n m√≥vil utilizando la tecnolog√≠a de aprendizaje autom√°tico</a></li>
<li><a href="../455156/index.html">Tareas de secuenciaci√≥n dom√©stica (junio de 2019)</a></li>
<li><a href="../455158/index.html">Las maravillas de la metodolog√≠a contable: fondo de amortizaci√≥n</a></li>
<li><a href="../455164/index.html">Elena Balashova: "Los activistas plantearon la pregunta de que los datos de nuestro portal SIG deber√≠an estar abiertos a OpenStreetMap"</a></li>
<li><a href="../455166/index.html">VPN en el enrutador Beeline para evitar bloqueos</a></li>
<li><a href="../455168/index.html">Demostraci√≥n de 492 bytes en ATtiny5</a></li>
<li><a href="../455170/index.html">Nueva arquitectura para el acceso de bytes a SSD: c√≥mo funciona</a></li>
<li><a href="../455172/index.html">√Årboles de b√∫squeda binaria equilibrada: implementaci√≥n en Julia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>