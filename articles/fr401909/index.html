<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤›ğŸ½ ğŸ˜“ ğŸš® SystÃ¨me de sÃ©curitÃ© fait maison basÃ© sur des produits pour une maison intelligente de Nootekhnika ğŸ§–ğŸ¾ ğŸ…ğŸ½ ğŸ¬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, chÃ¨re communautÃ©. Je veux partager avec vous une expÃ©rience dans la mise en Å“uvre d'un systÃ¨me de sÃ©curitÃ© pour une maison basÃ©e sur des appa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SystÃ¨me de sÃ©curitÃ© fait maison basÃ© sur des produits pour une maison intelligente de Nootekhnika</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/401909/"> Bonjour, chÃ¨re communautÃ©.  Je veux partager avec vous une expÃ©rience dans la mise en Å“uvre d'un systÃ¨me de sÃ©curitÃ© pour une maison basÃ©e sur des appareils domestiques intelligents de Nootehnika.  Je veux tout de suite faire une rÃ©serve que c'est l'une des premiÃ¨res expÃ©riences, et mon objectif n'est pas de Â«construire un bastion imprenableÂ», mais de dÃ©montrer les possibilitÃ©s d'utiliser les appareils que j'ai choisis, d'expÃ©rimenter et d'apprendre des leÃ§ons, ainsi que de recevoir des commentaires de votre part. <br><br>  En bref, le systÃ¨me que je concevais devrait prendre une photo de chaque personne qui s'est approchÃ©e de la porte d'entrÃ©e en mode d'armement et envoyer une photo Ã  une adresse e-mail, ainsi qu'un message Ã©lectronique en cas d'enregistrement de mouvement dans le couloir (c'est-Ã -dire qu'il y a du mouvement Ã  l'intÃ©rieur de l'appartement) . <a name="habracut"></a>  Donc, Ã  l'Ã©noncÃ© du problÃ¨me. <br><br><h2>  <b>1. Ã‰noncÃ© du problÃ¨me</b> </h2><br>  Le systÃ¨me que je conÃ§ois devrait: <br><br><ul><li>  en mode armement, prenez une photo de chaque personne qui s'approche de la porte d'entrÃ©e et envoyez la photo Ã  une adresse e-mail; </li><li>  en mode armement, envoyer un e-mail en cas d'enregistrement de mouvement dans le couloir (sans photo car je n'y ai pas de camÃ©ras IP); </li><li>  fournir diverses interfaces pour l'armement et le dÃ©sarmement. </li></ul><br>  Par diverses interfaces d'armement, j'entends: <br><br><ul><li>  Armement et dÃ©sarmement Ã  l'aide de commutateurs radio Nootehnika; </li><li>  Armement et dÃ©sarmement via l'interface Web pour gÃ©rer une maison intelligente. </li></ul><br><h2>  <b>2. Description de la solution</b> </h2><br>  Pour rÃ©soudre ce problÃ¨me, j'ai utilisÃ© le matÃ©riel suivant: <br><br><ul><li>  deux capteurs de mouvement 112; </li><li>  rÃ©cepteur de signaux de capteurs et interrupteurs RX2164; </li><li>  Commutateur PU311-2; </li><li>  Nettop 3VI (basÃ© sur le processeur Atom D525); </li><li>  CamÃ©ra IP chinoise noname. </li></ul><br>  J'ai dÃ©jÃ  donnÃ© une brÃ¨ve description des dispositifs pour construire la maison intelligente de Nootechnika dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">section</a> Â«introductionÂ» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de l'article</a> , donc je ne me concentrerai pas sur cette question ici.  De plus, tous les dÃ©tails sur les appareils peuvent Ãªtre trouvÃ©s sur le site externe de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sociÃ©tÃ©</a> . <br><br>  Donc, Ã  la description du systÃ¨me.  Sur la nettop 3VI, Debian Linux 7, le logiciel Simple Event Correlation (SEC) et un ensemble d'utilitaires Linux pour gÃ©rer les pÃ©riphÃ©riques Nootechnics d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Oleg Artamonov sont</a> installÃ©s. <br><br>  Des dÃ©tecteurs de mouvement (PM112) sont installÃ©s dans le vestibule devant la porte d'entrÃ©e et dans le couloir (Ã  l'intÃ©rieur de l'appartement).  Le rÃ©cepteur USB RX2164 est connectÃ© au nettop.  Le rÃ©cepteur reÃ§oit les signaux des capteurs et des commutateurs, et les utilitaires de gestion de pÃ©riphÃ©riques Nootehnics (ci-aprÃ¨s dÃ©nommÃ©s les utilitaires Noolite) installÃ©s sur le nettop transmettent les signaux reÃ§us Ã  syslog.  SEC lit le fichier dans lequel les donnÃ©es syslog sont Ã©crites et les traite selon les rÃ¨gles configurÃ©es.  Ã€ la suite du traitement, des actions telles que la rÃ©ception de photos de la camÃ©ra IP et l'envoi d'e-mails sont effectuÃ©es. <br><br>  Il existe deux faÃ§ons d'activer (et de dÃ©sactiver) le mode de sÃ©curitÃ©: <br><br><ol><li>  en appuyant sur un bouton du commutateur PU311-2; </li><li>  en appuyant sur un bouton dans l'interface Web du systÃ¨me de contrÃ´le de la maison intelligente. </li></ol><br>  Un schÃ©ma de principe illustrant le fonctionnement du systÃ¨me est illustrÃ© Ã  la figure 1. <br><br><img src="https://habrastorage.org/files/ac2/e02/b20/ac2e02b2021f408f95d5fe039beb7588.jpg"><br><br>  <b>Figure 1</b> - SchÃ©ma fonctionnel illustrant le fonctionnement du systÃ¨me <br><br><h2>  <b>3. Installation du matÃ©riel systÃ¨me</b> </h2><br>  Pour ce systÃ¨me, j'utilise les mÃªmes 2 dÃ©tecteurs de mouvement, dont l'installation j'ai dÃ©crit dans la section 4 de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> . <br><br>  Bref, l'un des capteurs est installÃ© prÃ¨s de la porte d'entrÃ©e du vestibule (Ã  l'extÃ©rieur de l'appartement).  La sensibilitÃ© de ce capteur est rÃ©glÃ©e Ã  un niveau tel qu'il dÃ©tecte les mouvements Ã  proximitÃ© immÃ©diate de la porte.  Le deuxiÃ¨me capteur est installÃ© immÃ©diatement prÃ¨s de la porte d'entrÃ©e, mais dÃ©jÃ  Ã  l'intÃ©rieur de l'appartement.  La sensibilitÃ© est rÃ©glÃ©e de maniÃ¨re Ã  fixer le mouvement Ã  proximitÃ© immÃ©diate de la porte. <br><br>  Une camÃ©ra IP est installÃ©e Ã  l'extÃ©rieur de l'appartement dans le vestibule sous le plafond.  La porte d'entrÃ©e et environ 1,5 mÃ¨tre d'espace devant elle tombent dans son champ de vision. <br><br>  L'interrupteur PU311-2 est installÃ© Ã  l'intÃ©rieur de l'armoire afin de ne pas attirer l'attention et de ne pas Ãªtre accidentellement enfoncÃ©. <br><br>  Le nettop 3VI avec le rÃ©cepteur de signal RX2164 est situÃ© Ã  proximitÃ© sur la mezzanine pour fournir une rÃ©ception stable des signaux des capteurs et des commutateurs. <br><br>  Le schÃ©ma d'installation de l'Ã©quipement est illustrÃ© Ã  la figure 2. <br><br><img src="https://habrastorage.org/files/210/f9b/27b/210f9b27bd7349fbaa3ac91752612f73.jpg" height="300" width="180"><br><br>  <b>Figure 2</b> - SchÃ©ma d'installation de l'Ã©quipement <br><br><h2>  <b>4. Configuration du logiciel</b> </h2><br>  La configuration du logiciel comprend: <br><br><ul><li>  mettre en place des utilitaires Noolite pour recevoir les signaux des capteurs et des commutateurs; </li><li>  Ã©tablir des rÃ¨gles SEC pour rÃ©pondre aux signaux provenant des capteurs et des commutateurs; </li><li>  crÃ©er un script qui recevra une photo de l'appareil photo et enverra des courriels; </li><li>  crÃ©er un bouton pour allumer et Ã©teindre le systÃ¨me dans l'interface Web. </li></ul><br><h3>  <b>Configuration des utilitaires Noolite pour recevoir les signaux des capteurs et des commutateurs</b> </h3><br>  Pour que le rÃ©cepteur RX2164 commence Ã  recevoir des signaux d'un capteur ou d'un commutateur, il est nÃ©cessaire de le Â«lierÂ».  Pour ce faire, nous appuyons sur le bouton Â«bindÂ» du capteur lui-mÃªme (Ã  l'arriÃ¨re) et exÃ©cutons sur l'ordinateur auquel le rÃ©cepteur est connectÃ© la commande: nooliterxcfg â€“bind &lt;numÃ©ro de canal de 1 Ã  64&gt;.  De mÃªme, le commutateur est liÃ© au rÃ©cepteur. <br><br>  Dans mon cas, le capteur dans le vestibule Ã©tait connectÃ© au canal 3, le capteur dans l'appartement au canal 2 et deux boutons de commutation aux canaux 1 et 4, respectivement. <br><br>  Pour recevoir les signaux des capteurs en temps rÃ©el, vous devez exÃ©cuter l'utilitaire nooliterx en mode dÃ©mon.  Le processus d'installation des utilitaires et leurs paramÃ¨tres est dÃ©crit par le dÃ©veloppeur lui-mÃªme (Oleg Artamonov dans la documentation des utilitaires) et aussi par moi dans la section 4 de l'article (LINK).  En consÃ©quence, nous obtenons un enregistrement des signaux des capteurs et des commutateurs dans syslog.  Il ne reste plus qu'Ã  configurer l'enregistrement de ces messages dans un fichier dans syslog lui-mÃªme et ce qui suit est obtenu sur la sortie (exemples de messages de capteurs): <br><br><pre><code class="bash hljs">Jan 7 15:47:39 vmon nooliterx[23022]: Received: status 133, channel 3, <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> 25, format 1, data 2 0 0 0 Jan 7 18:43:58 vmon nooliterx[23022]: Received: status 135, channel 2, <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> 25, format 1, data 1 0 0 0</code> </pre> <br>  Les Ã©chantillons de messages provenant des commutateurs (lorsqu'un bouton est enfoncÃ© sur eux) sont un peu diffÃ©rents: <br><br><pre> <code class="bash hljs">Jan 5 22:29:43 vmon nooliterx[23022]: Received: status 26, channel 1, <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> 4, format 0, data 1 0 0 0 Jan 5 22:27:55 vmon nooliterx[23022]: Received: status 145, channel 4, <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> 4, format 0, data 1 0 0 0</code> </pre> <br><h3>  <b>Configurez les rÃ¨gles SEC pour dÃ©clencher les signaux provenant des capteurs et des commutateurs.</b> </h3><br>  SEC est un utilitaire de traitement des journaux d'Ã©vÃ©nements.  En bref, il reÃ§oit un flux d'Ã©vÃ©nements Ã  l'entrÃ©e, dont chacun vÃ©rifie la conformitÃ© avec les modÃ¨les de rÃ¨gles configurÃ©es.  En cas de recherche d'un match, il lance l'action prescrite dans la rÃ¨gle correspondante.  La chose est incroyablement flexible Ã  utiliser.  Il existe une page de manuel dÃ©taillÃ©e sur le Web. <br><br>  SEC est utilisÃ© dans mon systÃ¨me pour rechercher des messages en temps rÃ©el provenant de capteurs et de commutateurs dans le flux d'Ã©vÃ©nements et exÃ©cuter un script qui prend des photos et envoie des e-mails, ou tout simplement traduire l'ensemble du systÃ¨me sous et hors tension. <br><br>  En SEC, j'ai configurÃ© 4 rÃ¨gles.  2 - pour le traitement des Ã©vÃ©nements des dÃ©tecteurs de mouvement et deux - pour le traitement des signaux des deux boutons du commutateur.  Les rÃ¨gles sont dans /etc/sec.conf <br><br>  <b>RÃ¨gle 1: Traitement du signal du capteur de mouvement dans le vestibule (capteur attachÃ© au canal 3)</b> <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=SingleWithSuppress ptype=RegExp pattern=\w+\s+\d+\s+\d+\:\d+\:\d+\s+\w+\s+nooliterx\S+\s+Received\:\s+status\s+\d+,\s+channel\s+(3),\s+<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>\s+25.* desc=Motion sensor frontdoor <span class="hljs-variable"><span class="hljs-variable">$1</span></span> triggered action=shellcmd (/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/smarthome/security/send_photo_alert.sh <span class="hljs-variable"><span class="hljs-variable">$1</span></span>); event %s window=60</code> </pre> <br>  Le type de cette rÃ¨gle - Â«SingleWithSurpressÂ» - est conÃ§u pour rÃ©pondre uniquement au premier Ã©vÃ©nement enregistrÃ© pendant l'intervalle de temps spÃ©cifiÃ© par le paramÃ¨tre Â«windowÂ» en secondes.  C'est-Ã -dire  ce paramÃ¨tre signifie que la rÃ¨gle ne fonctionnera pas plus d'une fois par minute et que l'action spÃ©cifiÃ©e dans le paramÃ¨tre "action" ne sera lancÃ©e que 1 fois par minute.  Ceci est fait de faÃ§on Ã  ce que quelqu'un piÃ©tine autour de la porte pendant plusieurs minutes pour ne pas spammer son courrier avec des tonnes de lettres.  Dans le paramÃ¨tre Â«patternÂ», une expression rÃ©guliÃ¨re est Ã©crite, selon laquelle les Ã©vÃ©nements du capteur associÃ© au canal 3 sont recherchÃ©s. Deux actions sont spÃ©cifiÃ©es dans le paramÃ¨tre Â«actionÂ» - shellcmd, qui exÃ©cute le script et lui transmet un paramÃ¨tre extrait de l'expression rÃ©guliÃ¨re (dans ce cas reprÃ©sentant le nombre Â«3Â»), et la deuxiÃ¨me action Â«Ã©vÃ©nement% sÂ» servant Ã  transfÃ©rer l'expression enregistrÃ©e dans le paramÃ¨tre Â«descÂ» vers d'autres rÃ¨gles, ce qui n'est pas nÃ©cessaire au fonctionnement de ce systÃ¨me et peut Ãªtre omis.  Le paramÃ¨tre Â«descÂ» indique des informations de service supplÃ©mentaires utilisÃ©es par d'autres rÃ¨gles.  Pour ce systÃ¨me, il n'est pas nÃ©cessaire et des donnÃ©es arbitraires peuvent y Ãªtre saisies. <br><br>  <b>RÃ¨gle 2: Traitement du signal provenant d'un capteur de mouvement dans le couloir (capteur fixÃ© au canal 2)</b> <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=SingleWithSuppress ptype=RegExp pattern=\w+\s+\d+\s+\d+\:\d+\:\d+\s+\w+\s+nooliterx\S+\s+Received\:\s+status\s+\d+,\s+channel\s+(2),\s+<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>\s+25.* desc=Motion sensor lobby <span class="hljs-variable"><span class="hljs-variable">$1</span></span> triggered action=shellcmd (/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/smarthome/security/send_photo_alert.sh <span class="hljs-variable"><span class="hljs-variable">$1</span></span>); event %s window=60</code> </pre> <br>  Ici, tout est similaire Ã  la rÃ¨gle 1. Il faut seulement noter que le nombre Â«2Â» obtenu Ã  partir de l'expression rÃ©guliÃ¨re est passÃ© au script. <br><br>  <b>RÃ¨gle 3: Traitement du signal Ã  partir d'un bouton de commutation associÃ© au canal 1</b> <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=single ptype=regexp pattern=\w+\s+\d+\s+\d+\:\d+\:\d+\s+\w+\s+nooliterx\S+\s+Received\:\s+status\s+\d+,\s+channel\s+(1),\s+<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>\s+4.* desc=switch guard mode online action=shellcmd (/bin/<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"online"</span></span> &gt; /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/smarthome/security/status)</code> </pre> <br>  Cette rÃ¨gle est encore plus simple - elle se dÃ©clenche pour chaque Ã©vÃ©nement qui correspond Ã  l'expression rÃ©guliÃ¨re spÃ©cifiÃ©e dans le paramÃ¨tre "pattern".  En tant qu'action, il Ã©crit dans le fichier d'Ã©tat du systÃ¨me.  Ce fichier est analysÃ© par un script lancÃ© par les rÃ¨gles 1 et 2. Si l'Ã©tat est Â«en ligneÂ», le script est dÃ©clenchÃ©, si la valeur est Â«hors ligneÂ», le script ne fonctionne pas.  Plus Ã  ce sujet un peu plus loin. <br><br>  <b>RÃ¨gle 4: Traitement du signal Ã  partir d'un bouton de commutation associÃ© au canal 4</b> <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=single ptype=regexp pattern=\w+\s+\d+\s+\d+\:\d+\:\d+\s+\w+\s+nooliterx\S+\s+Received\:\s+status\s+\d+,\s+channel\s+(4),\s+<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>\s+4.* desc=switch guard mode offline action=shellcmd (/bin/<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"offline"</span></span> &gt; /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/smarthome/security/status)</code> </pre> <br>  Tout est similaire Ã  la rÃ¨gle 3, seul le statut est dÃ©fini sur "hors ligne". <br><br><h3>  <b>Un script qui prend des photos de l'appareil photo et envoie des e-mails</b> </h3><br>  Le script lancÃ© par les rÃ¨gles 1 et 2 vÃ©rifie l'Ã©tat du systÃ¨me dans le fichier d'Ã©tat et, selon sa valeur ("en ligne" ou "hors ligne"), effectue ou n'effectue pas les actions suivantes: <br><br><ul><li>  reÃ§oit une photo de la camÃ©ra IP dans le vestibule et envoie un e-mail en cas de capteur dans le vestibule; </li><li>  envoie un message d'alarme en cas de capteur dans le couloir. </li></ul><br>  Ce qui suit est le corps du script.  A son entrÃ©e, il reÃ§oit (de la SEC) le numÃ©ro de canal auquel le capteur est attachÃ© et, en fonction de ce numÃ©ro et de l'Ã©tat du systÃ¨me, effectue certaines actions. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh dir="/usr/local/smarthome/security" MAIL=$dir/mail.letter stat_file="$dir/status" dt=`date` if [ "$1" -eq 2 ] then if grep "online" $stat_file then cd $dir rm -f $dir/snapshot.cgi wget http://&lt;IP  &gt;/snapshot.cgi --user=&lt;username&gt; --password=&lt;password&gt; mpack -s "Someone at the door at $dt" $dir/snapshot.cgi d.shulinin@gmail.com fi elif [ "$1" -eq 3 ] then if grep "online" $stat_file then printf "Subject: Motion in the lobby spotted at $dt\n" &gt; $MAIL /usr/sbin/ssmtp email@gmail.com &lt; $MAIL fi else echo "no legitimate input detected" fi</span></span></code> </pre> <br>  Pour obtenir des photos de ma camÃ©ra IP, j'utilise wget et une ligne comme celle-ci: <br><br><pre> <code class="bash hljs">wget http://&lt;IP  &gt;/snapshot.cgi --user=&lt;username&gt; --password=&lt;password&gt;</code> </pre> <br>  Pour les autres camÃ©ras IP, vous devrez peut-Ãªtre rechercher d'autres options, il n'y a pas de solution unique.  RTFM Ã  la camÃ©ra, comme on dit. <br><br>  Les boutons de mise sous et hors tension du systÃ¨me dans l'interface Web.  Pour activer et dÃ©sactiver le mode de sÃ©curitÃ©, j'ai Ã©galement ajoutÃ© quelques boutons Ã  mon interface Web auto-Ã©crite pour contrÃ´ler les sources de lumiÃ¨re d'une maison intelligente. <br><br>  Ils se prÃ©sentent comme suit: <br><br><pre> <code class="bash hljs">&lt;?php <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isset(<span class="hljs-variable"><span class="hljs-variable">$_POST</span></span>[<span class="hljs-string"><span class="hljs-string">'button9_on'</span></span>])) { <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span>(<span class="hljs-string"><span class="hljs-string">'/bin/echo "online" &gt; /usr/local/smarthome/security/status'</span></span>); } ?&gt; &lt;?php <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isset(<span class="hljs-variable"><span class="hljs-variable">$_POST</span></span>[<span class="hljs-string"><span class="hljs-string">'button9_off'</span></span>])) { <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span>(<span class="hljs-string"><span class="hljs-string">'/bin/echo "offline" &gt; /usr/local/smarthome/security/status'</span></span>); } ?&gt; &lt;p&gt;&lt;h2&gt;Guard mode&lt;/h2&gt;&lt;/p&gt; &lt;form method=<span class="hljs-string"><span class="hljs-string">"post"</span></span>&gt; &lt;p&gt; &lt;button name=<span class="hljs-string"><span class="hljs-string">"button9_on"</span></span>&gt;ON&lt;/button&gt; &lt;button name=<span class="hljs-string"><span class="hljs-string">"button9_off"</span></span>&gt;OFF&lt;/button&gt; &lt;/p&gt;</code> </pre> <br>  Tout est simple ici - lorsque vous cliquez sur le bouton Â«ONÂ», Â«en ligneÂ» est Ã©crit dans le fichier d'Ã©tat, lorsque vous cliquez sur Â«OFFÂ» - Â«hors ligneÂ». <br><br><h2>  <b>5. Conclusion</b> </h2><br>  En consÃ©quence, j'ai obtenu un systÃ¨me qui, lorsqu'il est activÃ©, prend des photos de toute personne qui s'est approchÃ©e de la porte et envoie la photo par e-mail.  Et s'il y a du mouvement Ã  l'intÃ©rieur de l'appartement, il envoie simplement une alerte par e-mail. <br><br>  Les exemples d'e-mails ressemblent Ã  ceci (voir figure 3).  Les images elles-mÃªmes, bien sÃ»r, sont plus grandes et se dÃ©veloppent lorsque vous cliquez dessus avec la souris. <br><br><img src="https://habrastorage.org/files/fe5/9d4/689/fe59d468920b4e9fbfb5059d3f1d40aa.jpg"><br>  <i><b>Figure 3</b> - Exemple d'e-mail avec photo</i> <br><br>  Le systÃ¨me peut Ãªtre activÃ© et dÃ©sactivÃ© en appuyant sur un bouton de l'interrupteur et Ã©galement via les boutons de l'interface Web du systÃ¨me de contrÃ´le de la maison intelligente. <br><br>  Ã€ court terme, je souhaite Ã©galement afficher l'Ã©tat actuel du systÃ¨me (actif / inactif) dans l'interface Web. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr401909/">https://habr.com/ru/post/fr401909/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr401899/index.html">Enregistreur multifonctionnel de bricolage. Partie 1</a></li>
<li><a href="../fr401901/index.html">FenÃªtre au clair de lune sur l'Univers</a></li>
<li><a href="../fr401903/index.html">Comment les sons affectent notre sommeil et notre productivitÃ©</a></li>
<li><a href="../fr401905/index.html">Apple Power Mac G4 Cube et ses contemporains dans une petite revue de photo</a></li>
<li><a href="../fr401907/index.html">Les voitures robotisÃ©es doivent apprendre Ã  comprendre les gens.</a></li>
<li><a href="../fr401911/index.html">Sauvegarde de l'alimentation dans le centre de donnÃ©es "Maria-Ra"</a></li>
<li><a href="../fr401913/index.html">Pilote de bus Ã  1 fil pour les contrÃ´leurs alimentÃ©s par moins de 5 V</a></li>
<li><a href="../fr401915/index.html">MWC 2017: smartphones</a></li>
<li><a href="../fr401917/index.html">Les jouets de tous Ã¢ges sont soumis</a></li>
<li><a href="../fr401919/index.html">Imprimante ONO 3D. StÃ©rÃ©olithographie - aux masses</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>