<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëåüèΩ üëåüèª üôáüèª Askozia. Cara Kerja Plug & Play Autoprovisioning üîü üò∏ ‚õîÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ketika mengembangkan Askozia PBX, kami menghadapi tugas mengatur telepon secara otomatis dan menyelesaikannya dengan cara kami sendiri. 

 Autoprovisi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Askozia. Cara Kerja Plug & Play Autoprovisioning</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471522/">  Ketika mengembangkan Askozia PBX, kami menghadapi tugas mengatur telepon secara otomatis dan menyelesaikannya dengan cara kami sendiri. <br><br>  <b>Autoprovisioning Plug &amp; Play</b> (PnP), teknologi ini didukung oleh banyak produsen - Yealink, Snom, Fanvil. <br><br>  Keuntungan utama pengaturan telepon otomatis: <br><br><ul><li>  <b>Memfasilitasi pengaturan awal</b> - tidak perlu pergi ke antarmuka web setiap perangkat.  Cukup untuk menunjukkan korespondensi alamat MAC perangkat dan akun pada server pencarian otomatis. </li><li>  <b>Menyederhanakan dukungan</b> - ini benar-benar menjadi lebih mudah jika Anda perlu mengubah pengaturan perangkat.  Kami mengontrol pengaturan lagi di server </li><li>  <b>Dimungkinkan untuk mengurangi konfigurasi ke himpunan Starcode</b> ‚Äú* 911 * &lt;SIP_ACC&gt;‚Äù - dalam beberapa kasus fungsi ini tidak dihargai.  Tidak setiap pekerja kantoran akan dapat mengonfigurasi telepon IP, tetapi memanggil kombinasi angka adalah tugas yang sederhana. </li></ul><br>  Mari kita jelaskan cara kerja Plug &amp; Play Autoprovisioning.  <b>Di akhir artikel, tautan ke kode sumber</b> skrip PHP kecil yang mengimplementasikan fungsionalitas server PnP. <br><a name="habracut"></a><br><h3>  Studi Kasus </h3><br>  Kami memiliki kasus yang menarik ketika memperkenalkan telepon kepada salah satu pelanggan kami.  Masalah utama adalah bahwa klien berada di kota lain.  Pada saat yang sama, salah satu persyaratannya adalah setelah membongkar paket dengan telepon dan menghubungkannya ke jaringan, telepon harus segera bekerja. <br><br>  Masalahnya diselesaikan relatif sederhana.  Klien telah memesan sejumlah alamat IP untuk kami.  Kami menyiapkan peralatan di kantor kami dan mengemasnya dalam sebuah kotak dan mengirimkannya melalui kurir. <br><br>  Menggunakan konfigurasi perangkat otomatis, tugas akan menjadi lebih sederhana. <br><br><h3>  Skema PnP Sederhana </h3><br>  Perangkat telepon pada awal pekerjaan mengirimkan permintaan <b>SIP</b> <b>SUBSCRIBE</b> broadcast ke alamat <b>224.0.1.75</b> IP multicast. <br><div class="spoiler">  <b class="spoiler_title">Baca lebih lanjut tentang 224.0.1.75</b> <div class="spoiler_text">  224.0.1.75 - ini adalah IP multicast (untuk multicasting) "disediakan" untuk server SIP. <br>  lihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">networksorcery.com/Enp/protocol/sip.htm</a> <br>  224.0.1.75 SIP, Session Initiation Protocol (semua server). <br></div></div><br>  Sebagai tanggapan, ia mengharapkan untuk menerima respons <b>NOTIFY</b> dengan instruksi konfigurasi. <br><br><img src="https://habrastorage.org/webt/co/v1/ml/cov1mlrt6u8vq2eb_vfdk9eny9g.jpeg" alt="gambar"><br><br><div class="spoiler">  <b class="spoiler_title">Contoh BERLANGGANAN</b> <div class="spoiler_text"><pre><code class="plaintext hljs">2019/09/02 09:26:41.543856 172.16.32.148:5059 -&gt; 224.0.1.75:5060 SUBSCRIBE sip:MAC0015657322ff@224.0.1.75 SIP/2.0 Via: SIP/2.0/UDP 172.16.32.148:5059;branch=z9hG4bK42032775 From: &lt;sip:MAC0015657322ff@224.0.1.75&gt;;tag=42032772 To: &lt;sip:MAC0015657322ff@224.0.1.75&gt; Call-ID: 42032772@172.16.32.148 CSeq: 1 SUBSCRIBE Contact: &lt;sip:MAC0015657322ff@172.16.32.148:5059&gt; Max-Forwards: 70 User-Agent: Yealink SIP-T21P 34.72.14.6 Expires: 0 Event: ua-profile;profile-type="device";vendor="Yealink";model="T21D";version="34.72.14.6" Accept: application/url Content-Length: 0</code> </pre> <br></div></div><br><h4>  Berita utama yang paling penting dan menarik </h4><br><ul><li>  <b>Dari</b> - alamat poppy perangkat adalah <b>0015657322ff</b> </li><li>  <b>Peristiwa</b> - secara komprehensif menjelaskan perangkat, pabrikan, model, versi firmware </li><li>  <b>Kontak</b> - alamat perangkat </li><li>  <b>Call-ID</b> - header ini menarik ketika mengkonfigurasi perangkat DECT dari Yealink, ia mentransfer pengidentifikasi garis (nomor seri tabung), pembatas " <b>_</b> " </li></ul><br>  Setelah server PnP menerima permintaan seperti itu, ia harus merespons <br><br><div class="spoiler">  <b class="spoiler_title">PEMBERITAHUAN contoh</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">2019/09/02 09:26:41.550125 172.16.32.153:57593 -&gt; 172.16.32.148:5059 NOTIFY sip:172.16.32.148:5059 SIP/2.0 Via: SIP/2.0/UDP 172.16.32.148:5059;branch=z9hG4bK42032775 Max-Forwards: 20 Contact: &lt;sip:172.16.32.148:5059;transport=UDP;handler=dum&gt; From: &lt;sip:MAC0015657322ff@224.0.1.75&gt;;tag=42032772 To: &lt;sip:MAC0015657322ff@224.0.1.75&gt; Call-ID: 42032772@172.16.32.148 CSeq: 3 NOTIFY Content-Type: application/url Subscription-State: terminated;reason=timeout Event: ua-profile;profile-type="device";vendor="MIKO";model="MikoServerPnP";version="1.8" Content-Length: 40 http://172.16.32.153:84/0015657322ff.cfg</code> </pre> <br></div></div><br>  Dalam pesan NOTIFY, informasi paling berharga ada di badan pesan.  Sebagai aturan, di dalam tubuh Anda harus melewati tautan untuk mendapatkan file konfigurasi: <br><br><pre> <code class="plaintext hljs">http://172.16.32.153:84/0015657322ff.cfg</code> </pre> <br>  Jika beberapa server PnP berjalan di jaringan, maka siapa yang pertama yang akan merespons perangkat akan mengkonfigurasinya. <br><br>  Telepon, setelah menerima NOTIFY, berupaya memenuhi permintaan di alamat yang ditentukan. <br><br><div class="spoiler">  <b class="spoiler_title">Contoh permintaan dan respons server</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># curl -i http://172.16.32.153:84/0015657322ff.cfg HTTP/1.0 200 OK Content-type: text/plain Date: Mon, 02 Sep 2019 06:52:23 GMT Connection: close Accept-Ranges: bytes Last-Modified: Mon, 02 Sep 2019 06:25:02 GMT Content-length: 769 #!version:1.0.0.1 account.1.enable = 1 account.1.label = PnP (203) ...</code> </pre> <br></div></div><br>  Contoh implementasi server tersedia di github <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://github.com/boffart/MikoServerPnP</a> <br><br>  Agar server PnP ini berfungsi, Anda harus: <br><br><ul><li>  PHP 7.1.9 </li><li>  Soket php </li><li>  BusyBox v1.26.2 </li><li>  Permintaan siaran harus diizinkan di jaringan </li></ul><br><h3>  Fitur Server PnP </h3><br><ul><li>  Mendengarkan permintaan yang dikirim ke alamat ' <b>224.0.1.75:5060</b> ' </li><li>  Ketika mulai, itu memulai server web ( <b>busybox httpd</b> ) </li><li>  Memungkinkan Anda membuat konfigurasi ponsel yang disederhanakan </li><li>  Memungkinkan Anda mengirim ke Yealink NOTIFY untuk memulai ulang </li></ul><br><h3>  Menggunakan server PnP memungkinkan Anda untuk menggunakan "tautan satu kali". </h3><br>  Misalkan kita memberikan file melalui tautan: <br><br><pre> <code class="plaintext hljs">http://172.16.32.153:84/0015657322ff.cfg</code> </pre> <br>  Tautan langsung yang biasa ke file.  Jelas, ini TIDAK aman.  Mengetahui alamat MAC dari ponsel dan alamat server, Anda dapat mencoba untuk mendapatkan konfigurasi dengan login dan kata sandi. <br><br>  Saat bekerja dengan server PnP, dimungkinkan untuk memberikan tautan unik untuk setiap permintaan SUBSCRIBE: <br><br><pre> <code class="plaintext hljs">http://172.16.32.153:84/?mac=0015657322ff&amp;hash=0a67f5290</code> </pre> <br>  Contoh rumus untuk menghitung hash: <br><br><pre> <code class="plaintext hljs">hash = md5(MAC + DATE + PID)</code> </pre> <br>  <b>PID</b> adalah ID proses dari server PnP.  Hanya <b>root yang</b> bisa mengenalinya. <br>  Memilih <b>hash</b> semacam <b>itu</b> praktis tidak mungkin. <br><br>  Jika banding terjadi melalui tautan yang tidak valid, maka kami melarang hama tersebut. <br><br><h3>  Reboot Yealink PEMBERITAHUAN berarti tanpa otorisasi </h3><br>  Ya, ya, <b>tanpa otorisasi</b> . <br>  Saya tidak dapat menutup perangkat dari versi firmware saat ini dari kemungkinan ini. <br><br>  Jalankan saja perintahnya <br><br><pre> <code class="plaintext hljs">php -f MikoServerPnP.php socket_client_notify &lt;IP_PBX&gt; &lt;PORT_SIP_PBX&gt; &lt;IP_PHONE&gt; &lt;PORT_PHONE&gt;</code> </pre> <br>  Dan ponsel akan masuk ke reboot.  Dengan menggantung perintah seperti itu di cron Anda dapat mencapai efek yang menakutkan.  Tentu saja, ini dimungkinkan jika kita mengetahui alamat IP dan port SIP pada ponsel. <br><br><div class="spoiler">  <b class="spoiler_title">Contoh fungsi PHP untuk mengirim PEMBERITAHUAN</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">socket_client_notify</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($ip_pbx, $port_pbx, $ip_phone, $port_phone)</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ $phone_user = <span class="hljs-string"><span class="hljs-string">'autoprovision_user'</span></span>; $sock = socket_create(AF_INET, SOCK_DGRAM, SOL_UDP); $msg = <span class="hljs-string"><span class="hljs-string">"NOTIFY sip:{$phone_user}@{$ip_phone}:{$port_phone};ob SIP/2.0\r\n"</span></span>. <span class="hljs-string"><span class="hljs-string">"Via: SIP/2.0/UDP {$ip_pbx}:{$port_pbx};branch=z9hG4bK12fd4e5c;rport\r\n"</span></span>. <span class="hljs-string"><span class="hljs-string">"Max-Forwards: 70\r\n"</span></span>. <span class="hljs-string"><span class="hljs-string">"From: \"asterisk\" &lt;sip:asterisk@{$ip_pbx}&gt;;tag=as54cd2be9\r\n"</span></span>. <span class="hljs-string"><span class="hljs-string">"To: &lt;sip:{$phone_user}@{$ip_phone}:{$port_phone};ob&gt;\r\n"</span></span>. <span class="hljs-string"><span class="hljs-string">"Contact: &lt;sip:asterisk@{$ip_pbx}:{$port_pbx}&gt;\r\n"</span></span>. <span class="hljs-string"><span class="hljs-string">"Call-ID: 4afab6ce2bff0be11a4af41064340242@{$ip_pbx}:{$port_pbx}\r\n"</span></span>. <span class="hljs-string"><span class="hljs-string">"CSeq: 102 NOTIFY\r\n"</span></span>. <span class="hljs-string"><span class="hljs-string">"User-Agent: mikopbx\r\n"</span></span>. <span class="hljs-string"><span class="hljs-string">"Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY, INFO, PUBLISH, MESSAGE\r\n"</span></span>. <span class="hljs-string"><span class="hljs-string">"Supported: replaces, timer\r\n"</span></span>. <span class="hljs-string"><span class="hljs-string">"Subscription-State: terminated\r\n"</span></span>. <span class="hljs-string"><span class="hljs-string">"Event: check-sync;reboot=true\r\n"</span></span>. <span class="hljs-string"><span class="hljs-string">"Content-Length: 0\r\n\n"</span></span>; $len = strlen($msg); socket_sendto($sock, $msg, $len, <span class="hljs-number"><span class="hljs-number">0</span></span>, $ip_phone, $port_phone); socket_close($sock); }</code> </pre> <br></div></div><br><h3>  Konfigurasi Server PnP </h3><br>  Terletak di <b>setting / settings.json</b> <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://&lt;pbx_host&gt;:&lt;http_port&gt;/"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"http_port"</span></span>: <span class="hljs-number"><span class="hljs-number">84</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pbx_host"</span></span>: <span class="hljs-string"><span class="hljs-string">"172.16.32.153"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pbx_sip_port"</span></span>: <span class="hljs-string"><span class="hljs-string">"5060"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"vm_extension"</span></span>: <span class="hljs-string"><span class="hljs-string">"*001"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"feature_transfer"</span></span>: <span class="hljs-string"><span class="hljs-string">"**"</span></span> }</code> </pre> <br><h4>  Daftar putih MAC </h4><br>  Dapat dijelaskan dalam <b>pengaturan / mac_white.conf</b> .  Umpan garis pemisah. <br><br><h4>  Daftar hitam MAC </h4><br>  Dapat dijelaskan dalam <b>pengaturan / mac_black.conf</b> .  Umpan garis pemisah. <br><br><h4>  File konfigurasi telepon </h4><br>  Harus ditempatkan di direktori <b>konfigurasi</b> . <br>  Menggunakan server PnP, Anda dapat membuat konfigurasi paling sederhana untuk Yeakink dan Snom: <br><br><pre> <code class="plaintext hljs">php -f MikoServerPnP.php mk_config SIP_ACCAUNT SECRET MAC</code> </pre> <br><h3>  Bahan yang berguna </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Askozia adalah produk gratis.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Sumber di Github</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Wiki oleh Snom</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Situs Dukungan Yealink</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Repositori MikoServerPnP di Github</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id471522/">https://habr.com/ru/post/id471522/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id471512/index.html">28 Oktober, Yekaterinburg - Komunikasi Berkualitas</a></li>
<li><a href="../id471514/index.html">Judul "Baca artikel untuk Anda." Januari - Juni 2019</a></li>
<li><a href="../id471516/index.html">Intel 665p - SSD dengan QLC NAND 96-layer</a></li>
<li><a href="../id471518/index.html">Apple pada 2019 adalah Linux pada 2000</a></li>
<li><a href="../id471520/index.html">Buku "Tugas Ilmu Komputer Klasik dengan Python"</a></li>
<li><a href="../id471524/index.html">Terjemahan lengkap instruksi untuk penilai Google</a></li>
<li><a href="../id471528/index.html">Menyebarkan aplikasi menggunakan gerombolan buruh pelabuhan</a></li>
<li><a href="../id471530/index.html">GitLab berjalan di jalur yang tidak biasa ke CI / CD dan Kubernetes</a></li>
<li><a href="../id471532/index.html">Selamat tinggal PCB; halo silikon interkoneksi</a></li>
<li><a href="../id471536/index.html">Google Flood Prediction: An Inside Look</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>