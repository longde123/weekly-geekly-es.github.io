<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§≤üèæ üë©üèª‚Äçüç≥ ü§ôüèΩ Wir verbinden das Gamepad von PS1 / PS2 mit Raspberry Pi ‚ùì üßôüèæ üíä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Auf dem Hof ‚Äã‚Äãsind die Maiferien. Und das bedeutet Zeit, Kebabs zu essen und verschiedene gezapfte Getr√§nke und Flaschengetr√§nke zu trinken. Und ich m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wir verbinden das Gamepad von PS1 / PS2 mit Raspberry Pi</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/403753/">  Auf dem Hof ‚Äã‚Äãsind die Maiferien.  Und das bedeutet Zeit, Kebabs zu essen und verschiedene gezapfte Getr√§nke und Flaschengetr√§nke zu trinken.  Und ich mache alle Arten von Unsinn.  Der Gedanke an dieses Projekt kam vor dem neuen Jahr.  Aber lange konnte ich es nicht realisieren.  Nachdem ich das erste Gamepad gekauft hatte (das ich sp√§ter weggeworfen hatte) und versucht hatte, es abzufragen, wurde mir klar, dass es nicht ausreicht, nur die Handb√ºcher zu lesen, obwohl es gen√ºgend Informationen gibt.  Gl√ºcklicherweise erhielt ich f√ºr diesen 23. Februar als Geschenk keinen in Socken verpackten Rasierschaum, sondern 600 Rubel.  mit dem Wunsch, sich auf aliexpress nichts zu verweigern.  Wo die chinesische Kopie des Saleae Logic Logikanalysators gekauft wurde.  Diejenigen, die daran interessiert sind, was daraus entstanden ist, k√∂nnen auf die Schaltfl√§che unten klicken.  Und wer zu faul zum Lesen ist, kann das Ergebnis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> sofort sehen. <br><br><img src="https://habrastorage.org/web/079/966/3bb/0799663bb6154ee49ee69e0583654ac3.jpg"><br><a name="habracut"></a><br>  Nachdem ich den Logikanalysator auf ein unkompliziertes Design geschraubt hatte, sah ich, dass eine explizite Schlacke an das Gamepad gesendet wurde. <br><br>  Ein Moment der Theorie. <br><br>  Tatsache ist, dass die Konsole √ºber die SPI-Schnittstelle mit dem Gamepad kommuniziert.  Und es gibt geregelte Betriebsarten dieser Schnittstelle.  In diesem Fall sollten MODE 3, Vorw√§rts√ºbertragung und der Logikpegel auf der Leitung Chip aktivieren oder Slave ausw√§hlen sein, wenn auf das Gamepad "0" zugegriffen wird.  Die Frequenz auf der Clk-Leitung betr√§gt 250 kHz.  Aber ich habe 100 kHz gemacht und es funktioniert gut.  Grunds√§tzlich wird <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> alles klar beschrieben.  Und das Befehlssystem f√ºr das Gamepad und die Abschrift der Antworten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> .  Auch auf dem Radiokot-Portal gibt es eine Ver√∂ffentlichung, aber es gibt Fehler in den Teams.  Einfach ausgedr√ºckt, um ein Standard-Gamepad abzufragen, m√ºssen Sie ihm einen Befehl geben: <br><br><pre><code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">0x1</span></span> <span class="hljs-number"><span class="hljs-number">0x42</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span>   , -  <span class="hljs-number"><span class="hljs-number">0xff</span></span> <span class="hljs-number"><span class="hljs-number">0x41</span></span> <span class="hljs-number"><span class="hljs-number">0x5a</span></span> <span class="hljs-number"><span class="hljs-number">0xff</span></span> <span class="hljs-number"><span class="hljs-number">0xff</span></span></code> </pre> <br>  Dabei ist 0x41 der Typ des Gamepads und die letzten 2 Bytes der Status der Schaltfl√§chen.  Mit Analog ist alles √§hnlich, nur m√ºssen Sie dem Paket 4 weitere Null-Bytes hinzuf√ºgen. <br><br><pre> <code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">0x1</span></span>, <span class="hljs-number"><span class="hljs-number">0x42</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>   , -  <span class="hljs-number"><span class="hljs-number">0xff</span></span> <span class="hljs-number"><span class="hljs-number">0x73</span></span> <span class="hljs-number"><span class="hljs-number">0x5a</span></span> <span class="hljs-number"><span class="hljs-number">0xff</span></span> <span class="hljs-number"><span class="hljs-number">0xff</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span></code> </pre><br>  Hier 0x73 bedeutet dies, dass das Gamepad analog ist, die letzten 4 Bytes sind der Status der Analoga. <br><br>  Es ist wichtig, dass das Gamepad mit 3,3 V arbeitet, damit es direkt √ºber Raspberry Pi mit Strom versorgt werden kann.  Im Standardmodus (nur Tasten funktionieren) betr√§gt der Verbrauch ca. 2 mA, im Analogmodus 12 mA.  Und dann f√ºgen diese 10 mA eine LED am Controller hinzu.  Und auf der 3,3-V-Himbeer-Pi-Leitung kann eine Last von bis zu 50 mA gepflanzt werden. <br><br>  Um ein Gamepad anzuschlie√üen, ben√∂tigen Sie 4 GPIO-Anschl√ºsse und Strom.  Nur 6 Dr√§hte. <br><br>  Also.  Ich erkannte, dass die Bibliotheken f√ºr die Arbeit mit GPIO, das bcm2835, das wiringPi, mit SPI sehr schlecht funktionieren.  Im Prinzip wissen sie nicht, wie Pakete mit dem niedrigstwertigen Bit vorw√§rts √ºbertragen werden sollen.  In den Docks zu einem von ihnen wird dies ehrlich beschrieben, aber irgendwo sehr tief.  Und sie k√∂nnen sich wirklich nicht an die Regime halten. <br><br>  Nichts hindert jedoch daran, das Paket selbst zu reproduzieren und Daten vom Gamepad zu lesen.  Kaum gesagt als getan.  Nehmen Sie die wiringPi-Bibliothek und schreiben Sie: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;unistd.h&gt; #include &lt;wiringPi.h&gt; #define mosi 12 #define miso 13 #define clk 14 #define ce 5 unsigned char i, b; unsigned char cmd[9] = {0x1, 0x42, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0}; int main() { wiringPiSetup () ; //  pinMode (mosi, OUTPUT); pinMode (clk, OUTPUT); pinMode (ce, OUTPUT); pinMode (miso, INPUT); digitalWrite (clk, HIGH); digitalWrite (mosi, LOW); digitalWrite (ce, HIGH); while(1) { unsigned char data[9] = {0}; digitalWrite (ce, LOW); delayMicroseconds(20); for (i = 0; i &lt; 9; i++) { for (b = 0; b &lt; 8; b++) { if (((cmd[i] &gt;&gt; b)&amp;1) == 1) { digitalWrite (mosi, HIGH); digitalWrite (clk, LOW); delayMicroseconds(5); digitalWrite (clk, HIGH); data[i] ^= digitalRead(miso) &lt;&lt; b; delayMicroseconds(5); digitalWrite (mosi, LOW); } else { digitalWrite (clk, LOW); delayMicroseconds(5); digitalWrite (clk, HIGH); data[i] ^= digitalRead(miso) &lt;&lt; b; delayMicroseconds(5); } } delayMicroseconds(40); } digitalWrite (ce, HIGH); printf("%x %x %x %x %x %x\n", data[3], data[4], data[5], data[6], data[7], data[8]); delayMicroseconds(100); } }</span></span></span></span></code> </pre><br>  Alles ist klassisch, wir deklarieren GPIO-Ports, Variablen und eine Reihe von Befehlen.  Als n√§chstes werden die Port-Betriebsmodi konfiguriert und die Leitungen clk, mosi und ce (Chip Enable) zur√ºckgesetzt.  Dann werden 2 Zyklen gebildet.  Im ersten Fall werden die Bytes des Befehls sortiert, und im zweiten Fall sind die Bytes selbst bitweise, um der Mosi-Zeile je nach Wert des Bits eine logische Einheit oder Null zu liefern.  Gleichzeitig lesen wir die Antwort.  Als ich die gesch√§tzte Antwort sah: <br><br><pre> <code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">0xff</span></span> <span class="hljs-number"><span class="hljs-number">0x41</span></span> <span class="hljs-number"><span class="hljs-number">0x5a</span></span> <span class="hljs-number"><span class="hljs-number">0xff</span></span> <span class="hljs-number"><span class="hljs-number">0xff</span></span></code> </pre><br>  Ich w√§re fast an die Decke gesprungen.  Hier ist ein Beispiel f√ºr die Ausgabe des Programms, in diesem Fall habe ich mit dem linken Analog gespielt. <br><br><pre> <code class="cpp hljs">ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">80</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">80</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">80</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">80</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">80</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">80</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">40</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">4b</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">4b</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">4b</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">4b</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">4b</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">1</span></span>a ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">1</span></span>a ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">1</span></span>a ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">1</span></span>a ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">1</span></span>a ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  Nun, dann war es schon an der Zeit, diesen Code in den Emulator zu integrieren.  In diesem Fall war die Frage bei der Wahl des Emulators nicht.  Auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">jeden</a> Fall <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pcsx_rearmed</a> .  Genau wie beim vorherigen Mal war es notwendig, eine Funktion zu finden, die als eine der ersten gestartet wurde, um die Bibliothek darin zu initialisieren.  PsxInit stellte sich als solche Funktion heraus: Es befindet sich in der Datei r3000a.c, die den Betrieb des Zentralprozessors emuliert.  Ich habe die Bibliotheks-Header-Datei zu dieser Datei hinzugef√ºgt und GPIO-Ports deklariert.  In der psxInit-Funktion initialisiere ich die Bibliothek und stelle die Anfangspegel an den GPIO-Ports ein.  Unten finden Sie die ersten Zeilen dieser Datei mit den √Ñnderungen. <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"r3000a.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cdrom.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"mdec.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"gte.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;wiringPi.h&gt; #define mosi 12 #define miso 13 #define clk 14 #define ce 5 R3000Acpu *psxCpu = NULL; psxRegisters psxRegs; int psxInit() { SysPrintf(_("Running PCSX Version %s (%s).\n"), PACKAGE_VERSION, __DATE__); wiringPiSetup () ; //  pinMode (mosi, OUTPUT); pinMode (clk, OUTPUT); pinMode (ce, OUTPUT); pinMode (miso, INPUT); digitalWrite (clk, HIGH); digitalWrite (mosi, LOW); digitalWrite (ce, HIGH); #ifdef PSXREC if (Config.Cpu == CPU_INTERPRETER) { psxCpu = &amp;psxInt; } else psxCpu = &amp;psxRec; #else psxCpu = &amp;psxInt; #endif Log = 0; if (psxMemInit() == -1) return -1; return psxCpu-&gt;Init(); }</span></span></span></span></code> </pre><br>  Als n√§chstes musste ich herausfinden, wie der Emulator den Betrieb eines Gamepads simuliert.  Es gibt eine Header-Datei psemu_plugin_defs.h, die sich im Include-Verzeichnis befindet. Hier enth√§lt sie die Struktur, in der die Variablen gespeichert sind, in der der Gamepad-Typ Standard-, Analog-, Tastenstatusvariable-, Analogstatusvariablen- und Vibrationssteuerungsvariablen ist. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">// controler type - fill it withe predefined values above unsigned char controllerType; // status of buttons - every controller fills this field unsigned short buttonStatus; // for analog pad fill those next 4 bytes // values are analog in range 0-255 where 127 is center position unsigned char rightJoyX, rightJoyY, leftJoyX, leftJoyY; // for mouse fill those next 2 bytes // values are in range -128 - 127 unsigned char moveX, moveY; unsigned char Vib[2]; unsigned char VibF[2]; unsigned char reserved[87]; } PadDataS;</span></span></code> </pre><br>  Die Hauptaufgabe besteht also darin, die empfangenen Daten in diese Variablen zu schreiben.  Dieser Emulator hat Plugins.  Mit dem Gamepad-Plugin befindet sich im Plugins-Verzeichnis ein Unterverzeichnis dfinput, in dem sich die gew√ºnschte pad.c-Datei befindet, in der der Gamepad-Status sowie die Einstellungen gelesen werden.  Hier wurde der Code aus dem Testprogramm √ºbertragen.  Ports und die Bibliotheksheaderdatei werden ebenfalls deklariert.  Es enth√§lt auch Variablen, die den Code f√ºr Befehle speichern, die an das Gamepad gesendet werden.  Diese Variablen werden f√ºr den Zugriff auf das Gamepad verwendet.  Unten ist dieser Code: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdint.h&gt; #include "../include/psemu_plugin_defs.h" #include "main.h" #include &lt;wiringPi.h&gt; #define mosi 12 #define miso 13 #define clk 14 #define ce 5 unsigned char a, b; unsigned char cmd[9] = {0x1, 0x42, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0}; enum { ANALOG_LEFT = 0, ANALOG_RIGHT, ANALOG_TOTAL }; enum { CMD_READ_DATA_AND_VIBRATE = 0x42, CMD_CONFIG_MODE = 0x43, CMD_SET_MODE_AND_LOCK = 0x44, CMD_QUERY_MODEL_AND_MODE = 0x45, CMD_QUERY_ACT = 0x46, // ?? CMD_QUERY_COMB = 0x47, // ?? CMD_QUERY_MODE = 0x4C, // QUERY_MODE ?? CMD_VIBRATION_TOGGLE = 0x4D, };</span></span></span></span></code> </pre><br>  Wir sind an der allerersten interessiert, die einen Wert von 42 hat. Wenn diese Variable aufgerufen wird, wird hier der Code ausgef√ºhrt.  Au√üerdem ist es in der Originaldatei leer.  Und in die Aufz√§hlungsfunktion des Befehls do_cmd habe ich den Hauptcode eingef√ºgt: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> uint8_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_cmd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ PadDataS *pad = &amp;padstate[CurPad].pad; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pad_num = CurPad; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> data[<span class="hljs-number"><span class="hljs-number">9</span></span>] = {<span class="hljs-number"><span class="hljs-number">0</span></span>}; CmdLen = <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (CurCmd) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CMD_SET_MODE_AND_LOCK: buf = stdmode[pad_num]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0xF3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CMD_QUERY_MODEL_AND_MODE: buf = stdmodel[pad_num]; buf[<span class="hljs-number"><span class="hljs-number">4</span></span>] = padstate[pad_num].PadMode; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0xF3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CMD_QUERY_ACT: buf = unk46[pad_num]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0xF3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CMD_QUERY_COMB: buf = unk47[pad_num]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0xF3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CMD_QUERY_MODE: buf = unk4c[pad_num]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0xF3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CMD_VIBRATION_TOGGLE: buf = unk4d[pad_num]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0xF3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CMD_CONFIG_MODE: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (padstate[pad_num].ConfigMode) { buf = stdcfg[pad_num]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0xF3</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// else FALLTHROUGH case CMD_READ_DATA_AND_VIBRATE: digitalWrite (ce, LOW); delayMicroseconds(20); for (a = 0; a &lt; 9; a++) { for (b = 0; b &lt; 8; b++) { if (((cmd[a] &gt;&gt; b)&amp;1) == 1) { digitalWrite (mosi, HIGH); digitalWrite (clk, LOW); delayMicroseconds(5); digitalWrite (clk, HIGH); data[a] ^= digitalRead(miso) &lt;&lt; b; delayMicroseconds(5); digitalWrite (mosi, LOW); } else { digitalWrite (clk, LOW); delayMicroseconds(5); digitalWrite (clk, HIGH); data[a] ^= digitalRead(miso) &lt;&lt; b; delayMicroseconds(5); } } delayMicroseconds(40); } digitalWrite (ce, HIGH); pad-&gt;buttonStatus = data[4]; pad-&gt;buttonStatus = pad-&gt;buttonStatus &lt;&lt; 8; pad-&gt;buttonStatus |= data[3]; pad-&gt;rightJoyX = data[5]; pad-&gt;rightJoyY = data[6]; pad-&gt;leftJoyX = data[7]; pad-&gt;leftJoyY = data[8]; default: buf = stdpar[pad_num]; buf[2] = pad-&gt;buttonStatus; buf[3] = pad-&gt;buttonStatus &gt;&gt; 8; if (padstate[pad_num].PadMode == 1) { buf[4] = pad-&gt;rightJoyX; buf[5] = pad-&gt;rightJoyY; buf[6] = pad-&gt;leftJoyX; buf[7] = pad-&gt;leftJoyY; } else { CmdLen = 4; } return padstate[pad_num].PadID; } }</span></span></code> </pre><br>  Wenn der aktuelle Befehl gelesen wird, wird das Gamepad abgefragt und die Daten werden in Variablen geschrieben, und der Emulator selbst √ºbernimmt sie. <br><br>  Das ist alles, es bleibt nur das Projekt zu kompilieren.  Damit der Compiler die wirigPi-Bibliothek abrufen kann, m√ºssen Sie im Makefile des Projekts einen Link dazu einf√ºgen.  Dies reicht zu Beginn aus. <br><br><pre> <code class="cpp hljs"># Makefile <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> PCSX ReARMed <span class="hljs-meta"><span class="hljs-meta"># default stuff goes here, so that config can override TARGET ?= pcsx CFLAGS += -Wall -ggdb -Ifrontend -ffast-math -I/usr/</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> -I/usr/</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta">/SDL LDLIBS += -lpthread -lSDL -lpng -lwiringPi </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> DEBUG CFLAGS += -DNDEBUG -g </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> CXXFLAGS += $(CFLAGS) #DRC_DBG = 1 #PCNT = 1</span></span></code> </pre><br>  Und es ist wichtig.  Um ein analoges Gamepad verwenden zu k√∂nnen, muss der Emulator in den verwendeten Einstellungen angeben. <br><br>  Ich habe nicht viele Spiele f√ºr PS1, ich habe irgendwo nach 7 gesucht. Es hat bei Tomb Raider2 und Nuclear Strike nicht funktioniert, aber das ist offensichtlich, weil diese Spiele nicht wissen, was ein analoges Gamepad ist.  Wahrscheinlich m√ºssen Sie den Standard in den Einstellungen ausw√§hlen und versuchen. <br><br>  PS Der Emulator selbst l√§sst sich besser mit Optimierungsflags zusammenbauen.  Es ist hier gut beschrieben. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de403753/">https://habr.com/ru/post/de403753/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de403743/index.html">Google AIY: Maker Kit f√ºr Sprachsteuerungs-Gadgets</a></li>
<li><a href="../de403745/index.html">RD-180 Ersatzwettbewerb: Leidenschaft</a></li>
<li><a href="../de403747/index.html">Der digitale Assistent von Amazon verwandelt sich in einen Assistenten des Wissenschaftslabors</a></li>
<li><a href="../de403749/index.html">Steuervorbereitung 1950: ‚ÄûProgrammieren‚Äú des IBM 403 mithilfe eines Plug-In-Panels</a></li>
<li><a href="../de403751/index.html">Leben in der Luft Ozean. Was passiert auf 326 Metern √ºber Petersburg</a></li>
<li><a href="../de403755/index.html">Papiercomputer</a></li>
<li><a href="../de403757/index.html">Magische Gesten als Herausforderung f√ºr einen Elektronikingenieur</a></li>
<li><a href="../de403759/index.html">Chinesische Wissenschaftler haben dem neuronalen Netzwerk beigebracht, zu verstehen, was eine Person aus Scans der Gehirnaktivit√§t sieht</a></li>
<li><a href="../de403761/index.html">Bitcoin: Kommen wir zur√ºck zum Anfang?</a></li>
<li><a href="../de403763/index.html">Zeichnen mit zwei unabh√§ngigen Achsen in Matlab</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>