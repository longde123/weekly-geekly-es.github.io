<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🆓 🔮 👨‍👩‍👦 Schnittstellen als abstrakte Datentypen in Go 🌥️ 👨🏽 👩‍🚒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor nicht allzu langer Zeit hat ein Kollege einen ausgezeichneten Beitrag über die Verwendung von Go-Schnittstellen retweetet. Es werden einige Fehler...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Schnittstellen als abstrakte Datentypen in Go</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450386/"> Vor nicht allzu langer Zeit hat ein Kollege einen ausgezeichneten Beitrag <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">über die Verwendung von Go-Schnittstellen</a> retweetet.  Es werden einige Fehler bei der Verwendung der Schnittstellen in Go erläutert und einige Empfehlungen zur weiteren Verwendung dieser Schnittstellen gegeben. <br><br>  In dem oben erwähnten Artikel zitiert der Autor die Schnittstelle aus dem <b>Sortierpaket</b> der Standardbibliothek als Beispiel für einen abstrakten Datentyp.  Es scheint mir jedoch, dass ein solches Beispiel die Idee bei realen Anwendungen nicht wirklich offenbart.  Insbesondere bei Anwendungen, die die Logik eines Geschäftsfelds implementieren oder reale Probleme lösen. <br><br>  Bei der Verwendung von Schnittstellen in Go wird häufig über Overengineering diskutiert.  Und es kommt auch vor, dass Menschen nach dem Lesen dieser Art von Empfehlungen nicht nur aufhören, Schnittstellen zu missbrauchen, sondern versuchen, sie fast vollständig aufzugeben, wodurch sie sich der Verwendung eines der stärksten Programmierkonzepte im Prinzip (und einer der Stärken von Go in) entziehen insbesondere).  Zum Thema typische Fehler in Go gibt es übrigens einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">guten Bericht</a> von Stive Francia von Docker.  Dort werden insbesondere Schnittstellen mehrfach erwähnt. <br><br>  Im Allgemeinen stimme ich dem Autor des Artikels zu.  Trotzdem schien es mir, dass das Thema der Verwendung von Schnittstellen als abstrakte Datentypen darin eher oberflächlich aufgedeckt wurde, daher möchte ich es ein wenig weiterentwickeln und mit Ihnen über dieses Thema nachdenken. <br><a name="habracut"></a><br><h3>  Beziehen Sie sich auf das Original </h3><br>  Zu Beginn des Artikels gibt der Autor ein kleines Codebeispiel an, mit dessen Hilfe er auf Fehler bei der Verwendung von Schnittstellen hinweist, die Entwickler häufig erstellen.  Hier ist der Code. <br><br><pre><code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> animal <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Animal <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Speaks() <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-comment"><span class="hljs-comment">// implementation of Animal type Dog struct{} func (a Dog) Speaks() string { return "woof" }</span></span></code> </pre> <br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"animal"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Perform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a animal.Animal)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Speaks() }</code> </pre><br>  Der Autor nennt diesen Ansatz <i>"Java-artige Schnittstellenverwendung"</i> .  Wenn wir eine Schnittstelle deklarieren, implementieren wir den einzigen Typ und die einzigen Methoden, die diese Schnittstelle erfüllen.  Ich stimme dem Autor zu, der Ansatz ist mittelmäßig. Der idiomatischere Code im Originalartikel lautet wie folgt: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> animal <span class="hljs-comment"><span class="hljs-comment">// implementation of Animal type Dog struct{} func (a Dog) Speaks() string { return "woof" }</span></span></code> </pre><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Speaker <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Speaks() <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Perform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a Speaker)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Speaks() }</code> </pre><br>  Hier ist im Allgemeinen alles klar und verständlich.  Die Grundidee: <i>„Deklarieren Sie zuerst die Typen und erst dann die Schnittstellen am Verwendungsort</i> . <i>“</i>  Das ist richtig.  Lassen Sie uns nun eine kleine Idee entwickeln, wie Sie Schnittstellen als abstrakte Datentypen verwenden können.  Der Autor weist übrigens darauf hin, dass es in einer solchen Situation nichts Falsches gibt, die Schnittstelle <i>„im Voraus“</i> zu deklarieren.  Wir werden mit dem gleichen Code arbeiten. <br><br><h3>  Spielen wir mit Abstraktionen </h3><br>  Wir haben also einen Zirkus und es gibt Tiere.  Im Zirkus gibt es eine ziemlich abstrakte Methode <i>namens "Perform"</i> , die die " <i>Speaker" -Schnittstelle</i> verwendet und das Haustier Geräusche machen lässt.  Zum Beispiel lässt er den Hund aus dem obigen Beispiel bellen.  Erstellen Sie einen Tierbändiger.  Da er hier nicht dumm ist, können wir ihn auch generell dazu bringen, Geräusche zu machen.  Unsere Oberfläche ist ziemlich abstrakt.  :) :) <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Tamer <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t *Tamer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Speaks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"WAT?"</span></span> }</code> </pre><br>  So weit, so gut.  Wir gehen weiter.  Lassen Sie uns unserem Zahmer beibringen, Haustieren Befehle zu erteilen.  Bisher haben wir einen <i>Sprachbefehl</i> .  :) :) <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ( ActVoice = <span class="hljs-literal"><span class="hljs-literal">iota</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t *Tamer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, a Speaker)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> action { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ActVoice: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Speaks() } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"animal"</span></span> <span class="hljs-string"><span class="hljs-string">"circus"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { d := &amp;animal.Dog{} t := &amp;circus.Tamer{} t2 := &amp;circus.Tamer{} t.Command(circus.ActVoice, d) <span class="hljs-comment"><span class="hljs-comment">// woof t.Command(circus.ActVoice, t2) // WAT? }</span></span></code> </pre><br>  Mmmm, interessant ist es nicht?  Es scheint, dass unser Kollege nicht glücklich ist, dass er in diesem Zusammenhang ein Haustier geworden ist?  : D Was tun?  <i>Sprecher</i> scheint hier eine Abstraktion nicht sehr geeignet zu sein.  Wir werden eine geeignetere erstellen (oder besser gesagt, wir werden auf irgendeine Weise die erste Version aus dem <i>„falschen Beispiel“ zurückgeben</i> ), wonach wir die Methodennotation ändern werden. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Animal <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Speaker } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t *Tamer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, a Animal)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre><br>  Das ändert nichts, Sie sagen, der Code wird trotzdem ausgeführt, weil  Beide Schnittstellen implementieren eine Methode, und Sie haben im Allgemeinen Recht. <br><br>  Dieses Beispiel zeigt jedoch eine wichtige Idee.  Wenn wir über abstrakte Datentypen sprechen, ist der Kontext entscheidend.  Zumindest die Einführung einer neuen Schnittstelle machte den Code um eine Größenordnung offensichtlicher und lesbarer. <br><br>  Übrigens besteht eine der Möglichkeiten, den Zahmer zu zwingen, den Befehl <i>„Sprache“</i> nicht auszuführen, darin, einfach eine Methode hinzuzufügen, die er nicht haben sollte.  Fügen wir eine solche Methode hinzu, die Auskunft darüber gibt, ob das Haustier trainierbar ist. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Animal <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Speaker IsTrained() <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> }</code> </pre><br>  Jetzt kann der Zahmer nicht mehr anstelle eines Haustieres eingesetzt werden. <br><br><h3>  Verhalten erweitern </h3><br>  Wir werden unsere Haustiere zur Abwechslung zwingen, andere Befehle auszuführen. Außerdem fügen wir eine Katze hinzu. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> animal <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Dog <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d Dog)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsTrained</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d Dog)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Speaks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"woof"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d Dog)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Jump</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"jumps"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d Dog)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"sit"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Cat <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c Cat)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsTrained</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c Cat)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Speaks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"meow!"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c Cat)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Jump</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"meow!!"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c Cat)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"meow!!!"</span></span> }</code> </pre><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ( ActVoice = <span class="hljs-literal"><span class="hljs-literal">iota</span></span> ActSit ActJump ) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Animal <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Speaker IsTrained() <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Jump() <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Sit() <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t *Tamer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, a Animal)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> action { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ActVoice: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Speaks() <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ActSit: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Sit() <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ActJump: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Jump() } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre><br>  Großartig, jetzt können wir unseren Tieren verschiedene Befehle geben, und sie werden sie ausführen.  Bis zu dem einen oder anderen Grad ...: D. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"animal"</span></span> <span class="hljs-string"><span class="hljs-string">"circus"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { t := &amp;circus.Tamer{} d := &amp;animal.Dog{} t.Command(circus.ActVoice, d) <span class="hljs-comment"><span class="hljs-comment">// "woof" t.Command(circus.ActJump, d) // "jumps" t.Command(circus.ActSit, d) // "sit" t2 := &amp;circus.Tamer{} c := &amp;animal.Cat{} t2.Command(circus.ActVoice, c) // "meow" t2.Command(circus.ActJump, c) // "meow!!" t2.Command(circus.ActSit, c) // "meow!!!" }</span></span></code> </pre><br>  Unsere Hauskatzen sind für das Training nicht besonders geeignet.  Deshalb werden wir dem Zahmer helfen und sicherstellen, dass er nicht mit ihnen leidet. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t *Tamer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, a Animal)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !a.IsTrained() { <span class="hljs-built_in"><span class="hljs-built_in">panic</span></span>(<span class="hljs-string"><span class="hljs-string">"Sorry but this animal doesn't understand your commands"</span></span>) } <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre><br>  Das ist besser  Im Gegensatz zur ursprünglichen <i>Animal-</i> Schnittstelle, die <i>Speaker</i> dupliziert, haben wir jetzt die <i>"Animal"</i> -Schnittstelle (die im Wesentlichen ein abstrakter Datentyp ist), die ein recht aussagekräftiges Verhalten implementiert. <br><br><h3>  Lassen Sie uns die Schnittstellengrößen diskutieren </h3><br>  Lassen Sie uns nun über ein Problem wie die Verwendung breiter Schnittstellen nachdenken. <br><br>  Dies ist eine Situation, in der wir Schnittstellen mit einer Vielzahl von Methoden verwenden.  In diesem Fall lautet die Empfehlung ungefähr so: <i>„Funktionen sollten Schnittstellen akzeptieren, die die von ihnen benötigten Methoden enthalten</i> . <i>“</i> <br><br>  Im Allgemeinen stimme ich zu, dass die Schnittstellen klein sein sollten, aber in diesem Fall ist der Kontext wieder wichtig.  Kehren wir zu unserem Code zurück und bringen unserem Zahmer bei, sein Haustier zu <i>„loben“</i> . <br><br>  Als Antwort auf das Lob wird das Haustier eine Stimme abgeben. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t *Tamer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Praise</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a Speaker)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Speaks() }</code> </pre><br>  Es scheint, dass alles in Ordnung ist, wir verwenden die minimal notwendige Schnittstelle.  Es ist nichts überflüssig.  Aber auch hier das Problem.  Verdammt, jetzt können wir <i>den</i> anderen Trainer <i>"loben"</i> und er <i>wird "eine Stimme geben"</i> .  : D Schnapp es dir? .. Der Kontext ist immer wichtig. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"animal"</span></span> <span class="hljs-string"><span class="hljs-string">"circus"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { t := &amp;circus.Tamer{} t2 := &amp;circus.Tamer{} d := &amp;animal.Dog{} c := &amp;animal.Cat{} t.Praise(d) <span class="hljs-comment"><span class="hljs-comment">// woof t.Praise(c) // meow! t.Praise(t2) // WAT? }</span></span></code> </pre><br>  Warum bin ich  In diesem Fall wäre die beste Lösung immer noch die Verwendung einer breiteren Schnittstelle (die den abstrakten Datentyp <i>"pet"</i> darstellt).  Da wir lernen wollen, wie man ein Haustier lobt, kann keine Kreatur Geräusche machen. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-comment"><span class="hljs-comment">// Now we are using Animal interface here. func (t *Tamer) Praise(a Animal) string { return a.Speaks() }</span></span></code> </pre><br>  So viel besser.  Wir können das Haustier loben, aber wir können den Zahmer nicht loben.  Der Code wurde wieder einfacher und offensichtlicher. <br><br><h3>  Nun ein wenig zum Gesetz des Bettes </h3><br>  Der letzte Punkt, den ich ansprechen möchte, ist die Empfehlung, einen abstrakten Typ zu akzeptieren und eine bestimmte Struktur zurückzugeben.  Im Originalartikel wird diese Erwähnung in dem Abschnitt gegeben, der das sogenannte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Postelsche Gesetz beschreibt</a> . <br><br>  Der Autor zitiert das Gesetz selbst :. <br><blockquote>  "Sei konservativ mit dem, was du tust, sei liberal mit dir, akzeptiere" </blockquote><br>  Und interpretiert es in Bezug auf die Go-Sprache <br><blockquote>  "Go": "Schnittstellen akzeptieren, Strukturen zurückgeben" </blockquote> <code>func funcName(a INTERFACETYPE) CONCRETETYPE</code> <br> <br>  Sie stimmen im Allgemeinen zu, ich stimme zu, es ist eine gute Praxis.  Ich möchte jedoch noch einmal betonen.  Nimm es nicht wörtlich.  Der Teufel steckt im Detail.  Wie immer ist der Kontext wichtig. <br>  Nicht immer sollte eine Funktion einen bestimmten Typ zurückgeben.  Das heißt,  Wenn Sie einen abstrakten Typ benötigen, geben Sie ihn zurück.  Sie müssen nicht versuchen, Code neu zu schreiben, ohne die Abstraktion zu vermeiden. <br><br>  Hier ist ein kleines Beispiel.  Ein Elefant erschien in einem nahe gelegenen <i>„afrikanischen“</i> Zirkus, und Sie haben die Zirkusbesitzer gebeten, einen Elefanten für eine neue Show zu leihen.  In diesem Fall ist es für Sie nur wichtig, dass der Elefant dieselben Befehle wie andere Haustiere ausführen kann.  Die Größe eines Elefanten oder das Vorhandensein eines Stammes spielt in diesem Zusammenhang keine Rolle. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> african <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"circus"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Elephant <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e Elephant)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Speaks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"pawoo!"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e Elephant)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Jump</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"o_O"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e Elephant)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"sit"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e Elephant)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsTrained</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetElephant</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">circus</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Animal</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &amp;Elephant{} }</code> </pre><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"african"</span></span> <span class="hljs-string"><span class="hljs-string">"circus"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { t := &amp;circus.Tamer{} e := african.GetElephant() t.Command(circus.ActVoice, e) <span class="hljs-comment"><span class="hljs-comment">// "pawoo!" t.Command(circus.ActJump, e) // "o_O" t.Command(circus.ActSit, e) // "sit" }</span></span></code> </pre><br>  Wie Sie sehen können, verwenden wir möglicherweise die Abstraktion, da wir uns nicht um die spezifischen Parameter eines Elefanten kümmern, die ihn von anderen Haustieren unterscheiden. In diesem Fall ist es durchaus angebracht, die Schnittstelle zurückzugeben. <br><br><h3>  Zusammenfassend </h3><br>  Der Kontext ist entscheidend, wenn es um Abstraktionen geht.  Vernachlässigen Sie Abstraktionen nicht und haben Sie Angst vor ihnen, so wie Sie sie nicht missbrauchen sollten.  Sie sollten Empfehlungen nicht als Regeln nehmen.  Es gibt Ansätze, die im Laufe der Zeit getestet wurden, es gibt Ansätze, die noch getestet werden müssen.  Ich hoffe, ich konnte das Thema der Verwendung von Schnittstellen als abstrakte Datentypen etwas vertiefen und mich von den üblichen Beispielen aus der Standardbibliothek entfernen. <br><br>  Natürlich mag dieser Beitrag für manche Menschen zu offensichtlich erscheinen, und Beispiele werden aus dem Finger gesaugt.  Für andere mögen meine Gedanken kontrovers und die Argumente nicht überzeugend sein.  Trotzdem kann jemand inspiriert sein und anfangen, nicht nur über den Code, sondern auch über das Wesentliche der Dinge sowie über Abstraktionen im Allgemeinen ein wenig tiefer nachzudenken. <br><br>  Die Hauptsache, Freunde, ist, dass Sie sich ständig weiterentwickeln und echte Freude an der Arbeit haben.  Gut zu allen! <br><br>  PS.  Beispielcode und die endgültige Version finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auf GitHub</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de450386/">https://habr.com/ru/post/de450386/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de450372/index.html">Wie Amazon-Algorithmen bestimmen, wer es ist, zu verwerfen</a></li>
<li><a href="../de450374/index.html">RAM-Erweiterungskarte für Apple IIgs</a></li>
<li><a href="../de450376/index.html">Wie Yandex.Taxi nach Autos sucht, wenn sie es nicht sind</a></li>
<li><a href="../de450378/index.html">GitLab 11.10</a></li>
<li><a href="../de450384/index.html">Die Geschichte einer kleinen Legacy-Code-Studie</a></li>
<li><a href="../de450394/index.html">Untersuchung eines unbekannten Archivs</a></li>
<li><a href="../de450396/index.html">So verbessern Sie Ihr schriftliches Englisch: praktische Tipps und nützliche Tools</a></li>
<li><a href="../de450398/index.html">Die furchtlosesten Gifte</a></li>
<li><a href="../de450410/index.html">Terraformer - Infrastruktur zum Codieren</a></li>
<li><a href="../de450416/index.html">Wie Shareware-VPN-Anbieter Ihre Daten verkaufen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>