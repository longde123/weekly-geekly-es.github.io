<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐จ๐พโโ๏ธ ๐ด๓ง๓ข๓ท๓ฌ๓ณ๓ฟ ๐ช Serverless CI / CD ุนูู AWS โ๏ธ ๐ฉ๐ปโ๐ง ๐ฅจ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุณูููู ูู ุงูุฑุงุฆุน ุฃู ูููู ูุดุฑ ูุณุฎ ุงููุตู ุดูุฆูุง ูู ุงููุงุถู ุ ูููู ุ ููุฃุณู ุ ูุงูุช ุงูุฃููุฑ ูุฎุชููุฉ. ูุญุฏุซ ุฃู ุงููุทูุฑูู ููุถููู ุทุฑููุฉ ุงูุชุณููู ูุฐู. ุนูู ุงูุฑุบู ูู ุงูุข...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Serverless CI / CD ุนูู AWS</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/440756/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/pr/ok/p2/prokp20fn2bwrkeqzq4ojxzx9gi.jpeg"><br><br>  ุณูููู ูู ุงูุฑุงุฆุน ุฃู ูููู ูุดุฑ ูุณุฎ ุงููุตู ุดูุฆูุง ูู ุงููุงุถู ุ ูููู ุ ููุฃุณู ุ ูุงูุช ุงูุฃููุฑ ูุฎุชููุฉ.  ูุญุฏุซ ุฃู ุงููุทูุฑูู ููุถููู ุทุฑููุฉ ุงูุชุณููู ูุฐู.  ุนูู ุงูุฑุบู ูู ุงูุขู ุงูุชุจ ููุงููุง ุนู ุณุจุจ ุนุฏู ูุฐุง ุงูุฃูุฑ ุ ูููู ุชุนุฑู ูู ุดูุก ุจุฏููู.  ูุน ุงูุงุชุฌุงู ูุญู ููุฏุณุฉ ุจุฏูู ุฎุงุฏู ุ ุชูุนุจ ุฎุทูุท ุฃูุงุจูุจ CI / CD ุฏูุฑูุง ููููุง ูู ุชุณููู ุงูุชุทุจูู.  ูุชุจุช ุฃูุถูุง ุนููู ูู ุงูููุงู " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">3 ุฃูุถู ุงููุตุงุฆุญ ููุดุฑูุนู ุจุฏูู ุฎุงุฏู ุงูุชุงูู</a> ." </p><br><p style=";text-align:right;direction:rtl">  ููุฏ ููุช ููุชููุง ุจููุถูุน CI ู CD ููุฐ ูุชุฑุฉ ุทูููุฉ ุ ููุฃูู ูุฑุฉ ุงูุชููุช ุจู ููุฐ ุนุฏุฉ ุณููุงุช - ุจูุถู TeamCity.  ุญุงูููุง ุ ูุง ูุฒุงู TeamCity ูุณุชุฎุฏู ููุนุธู ุฎุทูุท ุฃูุงุจูุจ CI / CD ุงูุฎุงุตุฉ ุจูุง.  TeamCity ูุนูู ุจุดูู ุฑุงุฆุน ุ ููุณ ูุฏู ุฃู ุดูุก ุถุฏู ุ ููููู ุฏุงุฆูุงู ุฃุณุนู ูุชุญุณูู ุงูุนูู.  ุนูู ุณุจูู ุงููุซุงู ุ ุณูููู ูู ุงูุฌูุฏ ุฌูุน ุฎุทูุท ุฃูุงุจูุจ ูู ุดูู ููุฏ - ููุฐุง ุฃุญุฏ ุงููุฌุงูุงุช ุงูุชู ููุณุช ูููุง TeamCity ุฌูุฏุฉ. </p><br><p style=";text-align:right;direction:rtl">  ููุฏ ุชุนููุช ุฃุฏูุงุช ุงูุชูุงูู ูุงูุชุณููู ูู AWS ููุฐ ุจุนุถ ุงูููุช ุ ูุนูู ุงูุฑุบู ูู ุฃููุง ูุณุชุฎุฏู CodeDeploy ููุดุฑูุน ุขุฎุฑ ูุนูู ุนูู EC2 ุ ุฅูุง ุฃููู ูู ุฃูู ุจูุดุฑ ูุดุฑูุน ุจุฏูู ุฎุงุฏู ูุนูู.  ุจุนุฏ ูุฑุงุฌุนุฉ ุงูุฃุฏูุงุช ูุฑุฉ ุฃุฎุฑู ุ ูุงุญุธุช ูุฐุง: ุงูุขู ููุงู ูุธููุฉ ุชูุงูู ูุถููุฉ ููุดุฑ CloudFormation ู Lambda ุ ุจูุงุกู ุนูู SAM AWS ุ  ูุณุชุฎุฏู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฅุทุงุฑ ุนูู</a> ุจุฏูู ุฎุงุฏู - ูููู ุจุฅูุดุงุก ููุงูุจ CloudFormation ุ ูููู ูุง ูุนูู ุฎุงุฑุฌ ุงูุตูุฏูู ุจุงุณุชุฎุฏุงู ุฃุฏูุงุช AWS. </p><a name="habracut"></a><br><h3 id="podgotovka" style=";text-align:right;direction:rtl">  ุงูุชุญุถูุฑ </h3><br><p style=";text-align:right;direction:rtl">  ูููููู ุงุณุชุฎุฏุงู ุฎุฏูุงุช AWS ุงูุชุงููุฉ: EC2 ุ Docker ุ ECR ุ S3 ุ IAM ุ CodeBuild ุ CodePipeline ุ CloudWatch ุ CloudTrail.  ูู ุฃุฌู ููุงูุจุฉ ุฐูู ุ ุนููู ุฃู ุชููู ุนูู ุงูุฃูู ูุณุชูู ุฃุณุงุณู ูุง ุชููู ุจู ูู ูู ูุฐู ุงูุฎุฏูุงุช. </p><br><p style=";text-align:right;direction:rtl">  ุจุดูู ุฃุณุงุณู ุ ุฃูุชุจ ุงูุฑูุฒ ุงูุฌุงูุจู ููุฎุงุฏู ูู .NET ุ ููุนุชูุฏ ูุฐุง ุงูุฏููู ุฃูุถูุง ุนูู ูุฐุง ุงููุธุงู ุงูุฃุณุงุณู.  ูุง ุชุญุชูู ุฃู ูู ุตูุฑ CodeBuild ูุณุจูุฉ ุงูุตูุน ุนูู ููุช ุชุดุบูู .NET ู NodeJS ูู ููุณ ุงูููุช (ููุงู ุญุงุฌุฉ ุฅูู NodeJS ูุฅุทุงุฑ ุนูู ุจุฏูู ุฎุงุฏู).  ุฅุฐุง ูุงูุช ูุธุงุฆู Lambda ููุชูุจุฉ ูู NodeJS ุ ูุฅู ุชูููู ุฎุท ุฃูุงุจูุจ ุงููุดุฑ ุฃุจุณุท ุจูุซูุฑ ุ ูุฃู ูุฐู ูู ุจูุฆุฉ ุงูุชุดุบูู ุงููุญูุฏุฉ ุงููุทููุจุฉ ููุชุซุจูุช ูู ุตูุฑุฉ Docker (ุฅุฐุง ูุงูุช ูุถูุชู ุ ูุง ุชุชุฑุฏุฏ ูู ุชุฎุทู ูุนุธู ุงูุฏููู).  ูููุฑุฉ ุงูุซุงููุฉ ุ ูุงูุช ูุฐู ุฃูู ุชุฌุฑุจุฉ ูู ูุน ุงูุญุงููุงุช ุ ูุฃูุง ุณุนูุฏ ุจุชุนูู ุดูุก ุฌุฏูุฏ. </p><br><p style=";text-align:right;direction:rtl">  ุฃุฌุฑุค ุนูู ุงูุชุฑุงุถ ุฃู ุงูุฑูุฒ ุงูุฎุงุต ุจู ูู ูุณุชูุฏุน ูุนูู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุจูุงุจุฉ.  ููุญุตูู ุนูู ุฅุฑุดุงุฏุงุช ุ ูููู ุจุจุณุงุทุฉ ุจุชุญููู ููู ูุญุชูู ุนูู ุญุฒูุฉ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูููุดุฑ ุฅูู S3 ุ  ููู ุชุญุตู ุนููู ุงูุฃูุฑ ูุชุฑูู ูู.  ุจุฃุฎุฐ ุนููู ูุฃุณุงุณ ุ ููููู ุฏุงุฆููุง ุงููุถู ูุฏููุง ูู ุฎูุงู ุชูุตูู ุฎุท ุงูุฃูุงุจูุจ ุงูุฎุงุต ุจู ุจูุณุชูุฏุนุงุช ูุซู github ุฃู CodeCommit. </p><br><h3 id="1-sozdayte-ekzemplyar-ec2-i-ustanovite-docker" style=";text-align:right;direction:rtl">  1. ุฅูุดุงุก ูุซูู EC2 ูุชุซุจูุช Docker </h3><br><p style=";text-align:right;direction:rtl">  ูู ุจุชุดุบูู ูุซูู ููุงุณู ูู AWS Linux 2 EC2 - ูุฌุจ ุฃู ูููู ูุฐุง ูุงุถุญูุง ุฏูู ุชูุถูุญ.  ุชุณุฌูู ุงูุฏุฎูู ูุชุซุจูุช Docker ุจุงุณุชุฎุฏุงู ุงูุฃูุงูุฑ: </p><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">sudo yum update -y sudo amazon-linux-extras install docker sudo service docker start</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุญุชุงุฌ ุฃูุถูุง ุฅูู ุฅุถุงูุฉ ec2 ูููุณุชุฎุฏู ุฅูู ูุฌููุนุฉ ุนุงูู ูููุงุก ูุชูููุฐ ุฃูุงูุฑ Docker ุฏูู ุงุณุชุฎุฏุงู sudo: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">sudo usermod -a -G docker ec2-user</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนูุฏ ุงูุชูุงู ุงูุฃูุฑ ุ ูู ุจุชุณุฌูู ุงูุฎุฑูุฌ ุซู ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู ุฅูู ูุซูู EC2 ุงูุฎุงุต ุจู ุจุญูุซ ูุชููู ูุณุชุฎุฏู ec2 ุฃุฐููุงุช ุฌุฏูุฏุฉ.  ุชุฃูุฏ ูู ููุงู ูุณุชุฎุฏู ec2 ุจุชุดุบูู ุฃูุงูุฑ Docker ุฏูู sudo: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">docker info</code> </pre> <br><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/i-/aq/r_/i-aqr_g3enpgmdd4clpawaaykmu.png"></a> <br>  <em><code>docker info</code> ุฅุฎุฑุงุฌ <code>docker info</code></em> </p><br><h3 id="2-sozdayte-obraz-docker-i-pomestite-v-ecr" style=";text-align:right;direction:rtl">  2. ุฅูุดุงุก ุตูุฑุฉ ุนุงูู ุงููููุงุก ููุถุนู ูู ECR </h3><br><p style=";text-align:right;direction:rtl">  ุงูุชุฑุถ ุฃู ุงูุฎุทูุฉ ุงูุณุงุจูุฉ ูุงุฌุญุฉ ุ  ุงูุฎุทูุฉ ุงูุชุงููุฉ ูู ุฅูุดุงุก ุตูุฑุฉ Docker ุชูุงุณุจูุง ูู ECR.  ุชูุฏู AWS ุงูุตูุฑ ุงูุฃุณุงุณูุฉ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">CodeBuild ุนูู github</a> ุ ููุฐุง ูุฌุนู ูู ุงูุณูู ุฅูุดุงุก ุตูุฑุชู ุงูุฎุงุตุฉ. </p><br><p style=";text-align:right;direction:rtl">  ููุฏ ูุดุฑุช ุงูุตูุฑุฉ ุฃูุถูุง ุนูู github - ูู ุญุงูุฉ ุนุฏู ุฑุบุจุชู ูู ุงุชุจุงุน ูุฐู ุงูุฎุทูุงุช ูุฅูุดุงุก ุงูุฎุงุตุฉ ุจู: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/effectivedigital/serverless-deployment-image</a> </p><br><p style=";text-align:right;direction:rtl">  ุงูุณุฎ ุงูุตูุฑ ูุงูุชูู ุฅูู ุฏููู .NET Core 2.1: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">git clone https://github.com/aws/aws-codebuild-docker-images.git cd aws-codebuild-docker-images cd ubuntu/dot-net/core-2.1/</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุชุญ Dockerfile ูู ูุญุฑุฑ ุงููุตูุต ุงูููุถู ูุฏูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">nano Dockerfile</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃุถู ุงูุฃูุงูุฑ ูุชุซุจูุช NodeJS ูุงูุฅุทุงุฑ ุจุฏูู ุฎุงุฏู ูู ููุงูุฉ ุงูุฃูุงูุฑ ุงูุฃุฎุฑู ุงููุชููุฑุฉ ุจุงููุนู ูู Dockerfile.  ุญุตูุช ุนูู ูุนุธู ูุฐู ุงูุฃูุงูุฑ ูู ุตูุฑุฉ NodeJS Docker ูู ููุณ ูุณุชูุฏุน AWS: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># Install Node Dependencies ENV NODE_VERSION="10.14.1" # gpg keys listed at https://github.com/nodejs/node#release-team RUN set -ex \ &amp;&amp; for key in \ 94AE36675C464D64BAFA68DD7434390BDBE9B9C5 \ B9AE9905FFD7803F25714661B63B535A4C206CA9 \ 77984A986EBC2AA786BC0F66B01FBB92821C587A \ 56730D5401028683275BD23C23EFEFE93C4CFFFE \ 71DCFD284A79C3B38668286BC97EC7A07EDE3FC1 \ FD3A5288F042B6850C66B31F09FE44734EB7990E \ 8FCCA13FEF1D0C2E91008E09770F7A9A5AE15600 \ C4F0DFFF4E8C1A8236409D08E73BC641CC11F4C8 \ DD8F2338BAE7501E3DD5AC78C273792F7D83545D \ 4ED778F539E3634C779C87C6D7062848A1AB005C \ A48C2BEE680E841632CD4E44F07496B3EB3C1762 \ ; do \ gpg - keyserver hkp://p80.pool.sks-keyservers.net:80 - recv-keys "$key" || \ gpg - keyserver hkp://ipv4.pool.sks-keyservers.net - recv-keys "$key" || \ gpg - keyserver hkp://pgp.mit.edu:80 - recv-keys "$key" ; \ done RUN set -ex \ &amp;&amp; wget "https://nodejs.org/download/release/v$NODE_VERSION/node-v$NODE_VERSION-linux-x64.tar.gz" -O node-v$NODE_VER$ &amp;&amp; wget "https://nodejs.org/download/release/v$NODE_VERSION/SHASUMS256.txt.asc" -O SHASUMS256.txt.asc \ &amp;&amp; gpg - batch - decrypt - output SHASUMS256.txt SHASUMS256.txt.asc \ &amp;&amp; grep " node-v$NODE_VERSION-linux-x64.tar.gz\$" SHASUMS256.txt | sha256sum -c - \ &amp;&amp; tar -xzf "node-v$NODE_VERSION-linux-x64.tar.gz" -C /usr/local - strip-components=1 \ &amp;&amp; rm "node-v$NODE_VERSION-linux-x64.tar.gz" SHASUMS256.txt.asc SHASUMS256.txt \ &amp;&amp; ln -s /usr/local/bin/node /usr/local/bin/nodejs \ &amp;&amp; rm -fr /var/lib/apt/lists/* /tmp/* /var/tmp/* RUN npm set unsafe-perm true CMD [ "node" ] # Install Serverless Framework RUN set -ex \ &amp;&amp; npm install -g serverless</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ูููู ุจุฌูุน ูุชูููุฒ ุงูุตูุฑุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">docker build -t aws/codebuild/dot-net .</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุงูุงูุชูุงุก ูู ุงูุชุฌููุน ุ ูู ุจุชุดุบูู ุงูุตูุฑุฉ - ุชุฃูุฏ ูู ุฃู ูู ุดูุก ูุนูู ูุฃูู ุชู ุชุซุจูุช ุงูุฅุทุงุฑ ุจุฏูู ุฎุงุฏู ุจุดูู ุตุญูุญ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">docker run -it --entrypoint sh aws/codebuild/dot-net -c bash sls -v</code> </pre> <br><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/ji/vh/da/jivhda2vzvu3vwc4uyltgyz0mza.png"></a> <br>  <em>ุชุดุบูู <code>sls -v</code> ุฏุงุฎู ุญุงููุฉ ุฌุฏูุฏุฉ</em> </p><br><p style=";text-align:right;direction:rtl">  ุซู ูู ุจุฅูุดุงุก ุงููุณุชูุฏุน ูู ECR ุจุงุณุชุฎุฏุงู AWS CLI.  ุจุนุฏ ุชุดุบูู ุงูุฃูุฑ ุ ุณูุชู ุนุฑุถ ูุณุชูุฏุน ุงูุชุฎุฒูู ุงูุฌุฏูุฏ ูู ูุญุฏุฉ ุงูุชุญูู AWS: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">aws ecr create-repository --repository-name codebuild-dotnet-node</code> </pre> <br><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/qc/bq/-g/qcbq-gsw-afhdbp2q9meo1nsqrk.png"></a> <br>  <em>ุงุณุชุฌุงุจุฉ AWS CLI ูุฅูุดุงุก ูุณุชูุฏุน ูู ECR</em> </p><br><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/2q/sf/_v/2qsf_v-jbgorara_qbzwi2lavoc.png"></a> </p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ูู ุจุชูููุฒ ุตูุฑุฉ <em>aws / codebuild / dot-net ุงูุชู</em> ุชู ุฅูุดุงุคูุง ุณุงุจููุง <em>ุจุงุณุชุฎุฏุงู</em> repositoryUri ูู ุงูุฎุทูุฉ ุงูุณุงุจูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">docker tag aws/codebuild/dot-net &lt;ACCOUNTID&gt;.dkr.ecr.ap-southeast-2.amazonaws.com/codebuild-dotnet-node</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุจุชุดุบูู ุงูุฃูุฑ get-login ููุญุตูู ุนูู ุณุทุฑ ุฃูุงูุฑ ูุตุงุฏูุฉ ุชุณุฌูู ุงูุฏุฎูู ุฅูู ุนุงูู ูููุงุก ุณุฌู ุงูุญุงููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">aws ecr get-login --no-include-email</code> </pre> <br><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/6l/w9/2d/6lw92dgbv2c7fvicbjvoz-afxwo.png"></a> </p><br><p style=";text-align:right;direction:rtl">  ูู ุจุชุดุบูู ุฃูุฑ ุชุณุฌูู ุฏุฎูู ุนุงูู ูููุงุก ุตุงุฏุฑ ุนู ุงูุฃูุฑ get-login ุฃุซูุงุก ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">docker login -u AWS -p eyJwYXlsb2FkIjoiNGZnd0dSaXM1L2svWWRLMmhJT1c0WWpOZEcxamJFeFJOK2VvT0Y5[...] https://&lt;ACCOUNTID&gt;.dkr.ecr.ap-southeast-2.amazonaws.com</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุฌุญ ุชุณุฌูู ุงูุฏุฎูู ุ ูุถุน ุตูุฑุฉ ุนุงูู ุงูููู ูู ุงููุณุชูุฏุน ุงูุฐู ุชู ุฅูุดุงุคู ูู ECR.  ูุฏ ูุณุชุบุฑู ูุฐุง ุนุฏุฉ ุฏูุงุฆู (ุญุณุจ ุญุฌู ุงูุตูุฑุฉ ุงูููุชููุฉ). </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">docker push &lt;ACCOUNTID&gt;.dkr.ecr.ap-southeast-2.amazonaws.com/codebuild-dotnet-node</code> </pre> <br><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/qc/bq/-g/qcbq-gsw-afhdbp2q9meo1nsqrk.png"></a> <br>  <em>ุนุงูู ุงููููุงุก ุนูู EC2 ูุฎูู ุตูุฑุชูุง</em> </p><br><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/k-/me/2l/k-me2lgrhindh4_2p9tl24e0qau.png"></a> <br>  <em>ุตูุฑุฉ ุนุงูู ุงููููุงุก ูู ECR</em> </p><br><p style=";text-align:right;direction:rtl">  ุซู ูููููุง ูุชุญ ุงููุตูู ุฅูู ุงูุตูุฑุฉ ูู ECR ูุฃู ุดุฎุต.  ูุฌุจ ุญุธุฑ ุงูุฅุฐู ูู ุจูุฆุฉ ุงูุนูู ุ ูููู ูู ูุฐุง ุงููุซุงู ุณููุชุญู.  ุงูุชูู ุฅูู ุนูุงูุฉ ุชุจููุจ ุงูุฃุฐููุงุช ูู ูุญุฏุฉ ุงูุชุญูู AWS ุ ุญุฏุฏ "ุชุบููุฑ ุณูุงุณุฉ JSON" ูุฃุฏุฎู ุงูุนูุตุฑ ุงูุชุงูู ูู ุงูุณูุงุณุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">{ "Version": "2008-10-17", "Statement": [ { "Sid": "EnableAccountAccess", "Effect": "Allow", "Principal": "*", "Action": [ "ecr:BatchCheckLayerAvailability", "ecr:BatchGetImage", "ecr:DescribeImages", "ecr:DescribeRepositories", "ecr:GetAuthorizationToken", "ecr:GetDownloadUrlForLayer", "ecr:GetRepositoryPolicy", "ecr:ListImages" ] } ] }</code> </pre> <br><h3 id="3-sozdayte-payplayn" style=";text-align:right;direction:rtl">  3. ุฅูุดุงุก ุฎุท ุฃูุงุจูุจ </h3><br><p style=";text-align:right;direction:rtl">  ููุฏ ุญุงู ุงูููุช ูุฌูุน ุงูุฃูุงุจูุจ.  ูุชุจุณูุท ุงูุนูููุฉ ุ ูุฌุนููุง ูุชุนุฏุฏุฉ ุงููุดุฑ ุ ูุงูุชูุณู ุจุงูุดูู ุงููุงุฑุซู ููููุฏุณุฉ ุงููุนูุงุฑูุฉ ุจุฏูู ุฎุงุฏู ุ ููุช ุจุจูุงุก ุฎุท ุฃูุงุจูุจ ุจุงุณุชุฎุฏุงู ุฅุทุงุฑ ุนูู ุจุฏูู ุฎุงุฏู.  ููููู ุชุญููู ููุณ ุงููุชูุฌุฉ ูู ุฎูุงู ุงูุจูุงุก ูู CloudFormation. </p><br><p style=";text-align:right;direction:rtl">  ูู ุฃูุณุฎ ุงููุตุฏุฑ ุจุงููุงูู ูู ููู serverless.yml - ุงูุณุฎู ูู github: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/effectivedigital/serverless-deployment-pipeline</a> </p><br><p style=";text-align:right;direction:rtl">  ุชุญูู ูู ุงููุงูุจ ุจุฏูู ุฎุงุฏู ููุนุฑูุฉ ูุง ุงูุฐู ุณุชูุนูู ุจุงูุถุจุท ุ ูููู ุจุงุฎุชุตุงุฑ ุ ูููู ุจุฅุนุฏุงุฏ ุงูุนูุงุตุฑ ุงูุชุงููุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  3 ุดุฑุงุฆุญ S3 </li><li style=";text-align:right;direction:rtl">  ุณูุงุณุฉ ุงูุฌุฒุก 1 </li><li style=";text-align:right;direction:rtl">  3 ุฃุฏูุงุฑ IAM </li><li style=";text-align:right;direction:rtl">  1 ูุดุฑูุน CodeBuild </li><li style=";text-align:right;direction:rtl">  1 ุฎุท ุฃูุงุจูุจ CodePipeline </li><li style=";text-align:right;direction:rtl">  ุญุฏุซ CloudWatch ูุงุญุฏ </li><li style=";text-align:right;direction:rtl">  1 ุชุชุจุน CloudTrail </li></ul><br><p style=";text-align:right;direction:rtl">  ุซู ูู ุจุชุญุฏูุซ <em>DockerImageArn ูุตูุฑุชู</em> ูู ECR.  ุฅุฐุง ููุช ุชุฑุบุจ ูู ุฅูุดุงุก ุญุฒู ูุดุฑ ุจุงุณู ุบูุฑ <em>Deployment.zip</em> ุ ูุนููู ุฃูุถูุง ุชุญุฏูุซ <em>DeploymentFilename</em> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">DockerImageArn: &lt;ACCOUNTID&gt;.dkr.ecr.ap-southeast-2.amazonaws.com/codebuild-dotnet-node:latest DeploymentFilename: Deployment.zip</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐุง ูู ุดูุก ุ ุฎุท ุงูุฃูุงุจูุจ ุฌุงูุฒ ูููุดุฑ.  ูู ุจุชุดุบูู ุฃูุฑ ุงููุดุฑ ุจุฏูู ุฎุงุฏู ูุงูุชุธุฑ ุญุชู ูุชู ุชููููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">sls deploy -v</code> </pre> <br><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/hi/wk/ys/hiwkysbgka2zessqrdqkb4nir1g.png"></a> <br>  <em>ุฎูู ุฅุทุงุฑ serverless ูููุฉ CloudFormation</em> </p><br><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/hc/r6/yr/hcr6yrezormgpobpu2bdu-_tvj4.png"></a> <br>  <em>ุงูุชู ุฃูุดุฃุชูุง ุฎุงุฏู ุฎุท ุฃูุงุจูุจ ุงูุฅุทุงุฑ CodePipeline</em> </p><br><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/ef/ax/ad/efaxaddb_yspsbdxrl1azf5e1oo.png"></a> <br>  <em>ุงูุชู ุฃูุดุฃุชูุง ูุดุฑูุน ุฅุทุงุฑ serverless ูุดุฑูุน CodeBuild</em> </p><br><h3 id="4-dobavte-buildspecyml-v-svoe-prilozhenie" style=";text-align:right;direction:rtl">  4. ุฅุถุงูุฉ buildSpec.yml ุฅูู ุงูุชุทุจูู ุงูุฎุงุต ุจู </h3><br><p style=";text-align:right;direction:rtl">  ุนูุฏูุง ููุชุดู CodePipeline ุชุบููุฑูุง ูู ููู ุงููุดุฑ ูู S3 ุ ูุฅูู ูุฎุจุฑ CodeBuild ุฃู ูุจุฏุฃ ููุญุงูู ุฅูุดุงุก ุงูุชุทุจูู ููุดุฑู.  ููุน ุฐูู ุ ูุฌุจ ุฃู ูุนุฑู CodeBuild ุฃูุถูุง ุงูุฃูุงูุฑ ุงูุชู ูุฌุจ ุชูููุฐูุง ูุฅูุดุงุก ุงูุชุทุจูู ููุดุฑู ุ ููุญุชูู buildSpec.yml ุนูู ุฅุฑุดุงุฏุงุช ุณูุชุจุนูุง CodeBuild. </p><br><p style=";text-align:right;direction:rtl">  ููุฏ ููุช ุจุฅูุดุงุก ุชุทุจูู "Hello world" ุจุณูุท ููุบุงูุฉ ูุชุถูู ูุซุงูุงู ุนูู ููู buildSpec.yml ุงูุฐู ููููู ุงุณุชุฎุฏุงูู: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/effectivedigital/serverless-deployment-app</a> <br>  ุฃู ูู ุจุฅูุดุงุก ููู buildSpec.yml ูู ุงูุชุทุจููุงุช ุงูุญุงููุฉ ูุงููุฃู ููููุง ููุชุนูููุงุช ุงูุชุงููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">version: 0.2 phases: pre_build: commands: - chmod a+x * build: commands: - ./build.sh post_build: commands: - sls deploy -v -s $STAGE</code> </pre> <br><h3 id="5-proverka-payplayna" style=";text-align:right;direction:rtl">  5. ูุญุต ุฎุทูุท ุงูุฃูุงุจูุจ </h3><br><p style=";text-align:right;direction:rtl">  ูู ุดูุก ุฌุงูุฒ ุงูุขู ููุฅุทูุงู ุงูุฃูู ูุฎุท ุงูุฃูุงุจูุจ ุงูุฎุงุต ุจู.  ูู ุจุฅูุดุงุก ุญุฒูุฉ ุชุณูู <em>Deployment.zip</em> ุ ููุฌุจ ุฃู ุชุชุถูู ุฌููุน ุงููููุงุช ุงูุฎุงุตุฉ ุจุงูุชุทุจูู ุจุฏูู ุฎุงุฏู ูููู buildSpec.yml. </p><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ูุญุธุงุช ููููุฉ ุ ูุฌุจ ุนูู CloudTrail ุชุณุฌูู ุญุฏุซ PutObject ูุชูุดูุท ูุงุนุฏุฉ ุญุฏุซ CloudWatch ุ ุงูุชู ุชููู ุจุนุฏ ุฐูู ุจุชูุดูุท ูุดุบู CodePipeline. </p><br><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/zg/r4/ii/zgr4iikop3ujbabsgtsfbyjex4o.png"></a> <br>  <em>ุชู ูุดุฑ Deployment.zip ูู S3</em> </p><br><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/ak/xd/iz/akxdizdzjomaespfhmnygedoqia.png"></a> <br>  <em>ุฃุทููุช CodePipeline ุ ุจูุงุก ุนูู</em> </p><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ุงูุชูููุง ุฅูู ุชูุงุตูู ุฎุทูุฉ AWS CodeBuild ุ ููููููุง ุฑุคูุฉ ุนูููุฉ ุงูุฅูุดุงุก ูุงููุดุฑ: </p><br><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/gv/sx/cb/gvsxcbcpmbcnj18k9rwbqbm_bhu.png"></a> <br>  <em>ุณุชุชููู CodeBuild ุงูุฅุฎุฑุงุฌ ูู ุงูุจููุฉ ููุดุฑ ุตูุฑุฉ Docker</em> </p><br><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/l3/ec/xm/l3ecxm5cjedmhtpxne0nklzdzlm.png"></a> <br>  <em>ูุดุฑ ูุงุฌุญ!</em> </p><br><p style=";text-align:right;direction:rtl">  ูุธูุฑ ุงูุชุทุจูู ุงูุฌุฏูุฏ ุงูุฐู ุชู ูุดุฑู ุจูุงุณุทุฉ ุฎุท ุงูุฃูุงุจูุจ ูุฏููุง ูู CloudFormation: </p><br><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/r6/2s/xl/r62sxlivtmrg8vn3yze2xe0ez3y.png"></a> </p><br><p style=";text-align:right;direction:rtl">  ููููู ุงุฎุชุจุงุฑ ููุทุฉ ููุงูุฉ ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูุชู ุชู ุฅูุดุงุคูุง ูู ุชุทุจูููุง ุงูุจุณูุท (ุนููุงู URL ูู ุฅุฎุฑุงุฌ CodeBuild ุฃู ูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุงูุจูุงุจุฉ) ูุงูุชุฃูุฏ ูู ุฃู ุงูุชุทุจูู ูุนูู ุจูุฌุงุญ: </p><br><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/h4/s3/gh/h4s3ghrxxwlpxaf3ssdwhfx30sy.png"></a> <br>  <em>ุณุงุนู ุงูุจุฑูุฏ ููุงุชุตุงู API</em> </p><br><h3 id="kratkie-vyvody" style=";text-align:right;direction:rtl">  ุงุณุชูุชุงุฌุงุช ููุฌุฒุฉ </h3><br><p style=";text-align:right;direction:rtl">  ูุณูุญ ูู CodePipeline ุจุฅูุดุงุก ุฎุท ุฃูุงุจูุจ CI / CD ูุงุจู ููุชุทููุฑ ููุฑู ูุบูุฑ ูููู ุ ููุณุงุนุฏ ูู ุญู ุจุนุถ ุงููุดููุงุช ุงููุฑุชุจุทุฉ ุจุฎุทูุท ุงูุฃูุงุจูุจ ุงูุชูููุฏูุฉ ุงูุชู ุชู ุฅูุดุงุคูุง ุนูู ุงูุฎูุงุฏู. <br>  ุฃุฑุบุจ ูู ุงููุถู ูุฏููุง ูุฅุถุงูุฉ ุงุฎุชุจุงุฑ ุงููุญุฏุฉ ุจุนุฏ ุงููุดุฑ ุฅูู ุงููุฒูุฌ ุ ููู ุงูููุถูุน ูุณุชุญู ููุงูุฉ ูููุตูุฉ - ููุฐู ููุงุณุจุฉ ููุฑุงุกุชูุง ูู ุงููุณุชูุจู! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar440756/">https://habr.com/ru/post/ar440756/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar440744/index.html">PHP ูููุจุชุฏุฆูู. ุฎุทุฃ ูู ุงูุชุนุงูู</a></li>
<li><a href="../ar440746/index.html">ุฏูุฑุงุช Gartner ูุชูููููุฌูุง ุฅุฏุงุฑุฉ ุงููุนุฑูุฉ ุจุงุณุชุฎุฏุงู ุฏุฑุงุณุงุช ุงูุญุงูุฉ ูู KnowledgeConf</a></li>
<li><a href="../ar440748/index.html">ุฃุณุฑุน ุญุงุณูุจ ุนููุงู ูู ุงูุนุงูู ูุญุทู ุงูุฑูู ุงูููุงุณู ูููุธูุฉ ุงูุนูู ุงูุฏูููุฉ</a></li>
<li><a href="../ar440752/index.html">ุงุฎุชูุงุฑ ุงููุณุชุฎุฏู ุทูุจ ุงูุฃููููุฉ</a></li>
<li><a href="../ar440754/index.html">ูุงุฆุฏุฉ ุนุจุฑ ููุตุฉ ุงูุฅูุฌููุฒูุฉ ูุนุฑุถ ุดูุงุฏุงุช ุงููุคูููู ุงูุฑูุณูุฉ X509</a></li>
<li><a href="../ar440758/index.html">ุงูุฐูุงุจ ููุชูุจ ูู ุฃูุฑูููุณ! (ููุณูู ุ ููุชุฒ ุจุงุฑู)</a></li>
<li><a href="../ar440760/index.html">ุงูุนุตุฑ ุงูุฐูุจู ุงูุฌุฏูุฏ ูููุฏุณุฉ ุงูููุจููุชุฑ</a></li>
<li><a href="../ar440762/index.html">ูุฑุงุฌุนุงุช ุตุงุญุจ ุงูุนูู: ุทุจูุนุฉ ูุนุฏู ูุฌูุฏ ูุฑุงุฌุนุงุช ูู ุงููุฌููููู</a></li>
<li><a href="../ar440766/index.html">ูู ุงููููุณูู ุฅูู ุงููููุณูู: ูุฏุงูุง ูู 23 ูุจุฑุงูุฑ</a></li>
<li><a href="../ar440772/index.html">ุชุตููู ูุญุฑูู ุงููุฌุงู: ูุตูุฉ ูุงูุจุฑุงุบูุงุชูุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>