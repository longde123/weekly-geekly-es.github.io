<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛡️ 🚭 ✏️ MIGS哈希算法漏洞 👩‍👩‍👧 🤸🏼 🧘🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="随着信用卡和互联网的出现，购物变得更加容易，并且正如他们所说的，更加安全。 只需点击几下，您所需的产品就已经在回家的路上。 但是，并非所有系统都是理想的，或者没有理想的系统。 您总是会发现某种错误，这是一个漏洞，攻击者可以利用它来做自己的肮脏事。 今天，我想提请您注意一个非常有才华的程序员Yohan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>MIGS哈希算法漏洞</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/406949/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/cb/6a/59cb6abc2e97c467874554.jpeg"></div><br> 随着信用卡和互联网的出现，购物变得更加容易，并且正如他们所说的，更加安全。 只需点击几下，您所需的产品就已经在回家的路上。 但是，并非所有系统都是理想的，或者没有理想的系统。 您总是会发现某种错误，这是一个漏洞，攻击者可以利用它来做自己的肮脏事。 今天，我想提请您注意一个非常有才华的程序员Yohanes Nugroho的研究，他谈到了MIGS系统中的漏洞。 <a name="habracut"></a><br><br> 本文是漏洞研究人员Yohanes Nugroho自己的文字的翻译。 祝你玩得愉快。 <br><br>  <b>MIGS哈希算法漏洞</b> <br><br> 去年，我发现MIGS（万事达卡Internet网关服务）使用的基于MD5的哈希算法出错。 它允许您更改事务的大小。 该公司奖励我发现了这个问题。 同年，MIGS转向使用HMAC-SHA256，但存在一些漏洞。 <br><br>  <b>什么是MIGS？</b> <br><br> 当您在网站上付款时，其所有者通常将其系统连接到中间付款网关（过渡到另一个页面）。 然后，该支付网关连接到特定国家/地区中可用的多个支付系统。 对于信用卡，许多网关都连接到其他网关（其中一个是MIGS），后者与许多银行合作以提供3DSecure。 <br><br>  <b>如何运作？</b> <br><br> 如果使用MIGS，则付款顺序通常如下所示： <br><br><ol><li> 您在网站上选择一种产品。 </li><li> 输入您的信用卡号。 </li><li> 对卡号，支付大小和其他参数进行签名，然后返回到浏览器，该浏览器将自动生成一个POST请求到中间支付网关。 </li><li>该网关将信息转换为MIGS支持的格式，使用MIGS密钥进行签名并将其返回给浏览器。 之后，浏览器向MIGS服务器本身生成另一个POST请求。 </li><li> 如果未启用3DSecure，则跳过此步骤。 否则，MIGS会将请求转移到发行卡的银行。 银行请求OTP并生成HTML，HTML为MIGS服务器生成POST请求。 </li><li>  MIGS将签名的数据返回到浏览器，并为中间支付网关创建POST请求。 </li><li> 中间支付网关对数据和签名的验证。 如果数据不正确，则会生成错误页面。 </li><li> 基于MIGS响应，支付网关将支付状态发送给卖方。 </li></ol><br>  <b>MD5哈希算法中的漏洞</b> <br><br> 这个错误很简单。 哈希方法使用以下公式： <br><br>  <i>MD5（秘密+数据）</i> <br><br> 但是，哈希扩展没有漏洞（已执行一些检查来防止这种情况）。 数据以这种方式形成：对所有以vpc_开头的请求参数进行排序，然后以无分隔的方式连接值。 例如，我们有以下数据： <br><br> 姓名：乔 <br> 数量：10000 <br> 卡：1234567890123456 <br><br>  vpc_Name =乔＆Vpc_Amount = 10000＆vpc_Card = 1234567890123456 <br><br> 应用排序： <br><br>  vpc_Amount = 10000 <br>  vpc_Card = 1234567890123456 <br>  vpc_Name =乔 <br><br> 我们连接值： <br><br>  100001234567890123456Joe <br><br> 请注意是否更改了参数： <br><br>  vpc_Name =乔＆Vpc_Amount = 1＆vpc_Card = 1234567890123456＆vpc_B = 0000 <br><br> 应用排序： <br><br>  vpc_Amount = 1 <br>  vpc_B = 0000 <br>  vpc_Card = 1234567890123456 <br>  vpc_Name =乔 <br><br> 我们连接值： <br><br>  100001234567890123456Joe <br><br> 该MD5值将相同。 也就是说，实际上，当数据传输到MIGS时，我们可以在付款金额之后添加一个附加参数以删除最后一位，或者在其之前添加-删除第一位。 您可以为MacBook支付2美元而不是2000美元。 <br><br> 中间网关和商家可以通过始终检查MIGS返回的付款金额是否与请求的金额匹配来避免此漏洞。 <br><br> 万事达卡奖励我识别出此错误的费用为8500美元。 <br><br>  <b>HMAC-SHA256哈希漏洞</b> <br><br> 如果我们将不正确的值注入中间支付网关，则新的HMAC-SHA256具有一个可以利用的漏洞。 我在其中一个付款网关（融合付款）上检查了此错误。 他们为此支付了我500美元的奖金。 此漏洞还可能影响连接到MIGS的其他支付网关。 <br><br> 在新版本中，添加了字段之间的定界符（＆），字段名（不仅是值），当然还添加了HMAC-SHA256。 对于与之前相同的数据，哈希线如下所示： <br><br>  Vpc_Amount = 10000＆vpc_Card = 1234567890123456＆vpc_Name = Joe <br><br> 我们什么也做不了；该计划中的一切都井井有条。 但是，如果值包含字符＆或=或其他字符怎么办？ <br><br> 阅读《 MiGS虚拟支付客户集成参考》文档后，我发现： <br><br>  <i>“注意：出于哈希目的，所有名称/值对中的值都不得包含URL字符”</i> <br><br> 我专注于<b>NOT</b> 。 这意味着如果我们具有以下字段： <br><br> 数量= 100 <br> 卡= 1234 <br>  CVV = 555 <br><br> 哈希将如下所示：HMAC（金额= 100＆卡= 1234＆CVV = 555） <br><br> 如果字段是这样的（使用＆和=）： <br><br> 数量= 100＆卡= 1234 <br>  CVV = 555 <br><br> 哈希看起来像这样：HMAC（金额= 100＆卡= 1234＆CVV = 555） <br><br> 以同样的方式。 但是到目前为止，还不是这样的问题。 <br><br> 当然，我认为官方文档中可能存在问题，也许仍应使用URL字符。 但是我检查了MIGS服务器的行为，一切都与文档中的一样。 也许他们不想使用其他编码（例如+而不是％20）。 <br><br> 看来应该没有问题，MIGS会检查不正确的值并给出错误信息（例如，错误的付款金额将被拒绝）。 <br><br> 但是我注意到，在某些支付网关中，它们没有在服务器端检查输入的数据，而是仅签名并将所有内容重定向到MIGS。 在客户端测试JavaScript，在服务器端对数据签名，然后让MIGS决定卡号是否正确，CVV是否应由3或4位数字组成，卡是否正确到期等等，这要容易得多。 逻辑是这样的：MIGS将仔细检查数据并使其更好。 <br><br> 在Fusion Payments，我发现是这样的：他们允许您输入任意长度的CVV代码（仅在JavaScript中进行验证），然后签署请求并将其发送给MIGS。 <br><br>  <b>利用</b> <br><br> 要利用此漏洞，我们需要创建一个字符串，该字符串将是正确的请求，并从MIGS服务器获得正确的响应。 我们不需要与MIGS服务器进行通信，我们只需要使客户端签署正确的数据即可。 <br><br> 基本要求： <br><br>  vpc_AccessCode = 9E33F6D7＆vpc_Amount = 25＆vpc_Card = Visa＆vpc_CardExp = 1717＆vpc_CardNum = 4599777788889999＆vpc_CardSecurityCode = 999＆vpc_OrderInfo = vdchecfurecurecururecurecurecure <br><br> 服务器的基本响应将是这样的： <br><br>  vpc_Message =已批准＆vpc_OrderInfo = ORDERINFO＆vpc_ReceiptNo = 722819658213＆vpc_TransactionNo = 2000834062＆vpc_TxnResponseCode = 0＆vpc_SecureHash = THEHASH＆vpc_Secure25Shecpe2525ecpe2525 <br><br> 对于Fusion Payment，该漏洞利用是通过实现vpc_CardSecurityCode（CVV）来实现的 <br><br>  vpc_AccessCode = 9E33F6D7＆vpc_Amount = 25＆vpc_Card =签证和vpc_CardExp = 1717＆vpc_CardNum = 4599777788889999＆vpc_CardSecurityCode = 999％26vpc_Message％3DApproved％26vpc_OrderInfo％3DORDERINFO％26vpc_ReceiptNo％3D722819658213％26vpc_TransactionNo％3D2000834062％26vpc_TxnResponseCode％3D0％26vpc_Z％物3Da＆vpc_OrderInfo =订单信息＆vpc_SecureHash = THEHASH＆vpc_SecureHashType = SHA256 <br><br> 客户/支付网关为此行生成正确的哈希。 <br><br> 现在我们可以将此数据输入到客户端本身（无需以任何方式与MIGS服务器进行交互），但是我们将对其进行一些更改，以便客户端识别必要的变量（大多数客户端仅检查vpc_TxnResponseCode和vpc_TransactionNo）： <br><br>  vpc_AccessCode = 9E33F6D7％26vpc_Amount％3D25％26vpc_Card％3DVisa％26vpc_CardExp％3D1717％26vpc_CardNum％3D4599777788889999％26vpc_CardSecurityCode％3D999＆vpc_Message =批准＆vpc_OrderInfo =订单信息＆vpc_ReceiptNo = 722819658213＆vpc_TransactionNo = 2000834062＆vpc_TxnResponseCode = 0＆vpc_Z =一％26vpc_OrderInfo％3DORDERINFO＆vpc_SecureHash = THEHASH＆vpc_SecureHashType = SHA256 <br><br> 注意事项： <br><br> 散列将与以前的数据相同。 <br> 客户端将忽略vpc_AccessCode及其值。 <br> 假定事务正确，客户端将处理vpc_TxnResponseCode等。 <br><br> 可以说这是MIGS客户端错误，但是万事达卡使用的哈希方法允许存在此错误。 如果对值进行了编码，则此漏洞将不存在。 <br><br>  <b>MIGS的回复</b> <br><br> 万事达卡未对HMAC-SHA256中的此错误做出响应。 我联系了以前联系过的有关先前漏洞的几个人。 没有答案。 甚至以“我们测试它”的样式退订。 如果要与我联系，他们有我的Facebook（因为有关MD5的信件）。 <br><br> 显然有人假装他们没有看到我的报告，但我在信上加了密码。 万事达卡IP地址至少有3个视图。 同时，由于您需要有意识地输入密码，因此这些点击不是未经阅读的随机点击。 我每周给他们写信。 <br><br> 我的期望是，他们将警告连接到系统的每个人，以检查和过滤嵌入式数据。 <br><br>  <b>支付网关中的空白</b> <br><br> 另外，我想说：尽管支付网关处理金钱，但它们并不像看起来那样安全。 在我的渗透测试（渗透测试）期间，我在几个中间网关的支付协议中发现了几个漏洞。 不幸的是，我无法透露细节（如果我说“最细”，则属于保密协议）。 <br><br> 我也发现实现错误。 例如，哈希扩展攻击，XML，签名验证错误等。 我在Fusion Payments中发现的最简单的错误之一。 我发现的第一个错误是：他们甚至不检查MIGS的签名。 这意味着我们可以简单地修改MIGS返回的数据并将事务标记为成功。 这仅意味着更改一个字符：从F（不成功）更改为0（成功）。 <br><br> 也就是说，实际上，我们可以输入任何卡号，从MIGS收到错误的回复，将其更改，然后突然付款就可以成功了。 这是一家预算为2000万美元的公司，我从他们那里得到了400美元。 这不是唯一一个存在此类漏洞的支付网关，在笔试期间，我在其他网关中发现了这一漏洞。 尽管奖励很小，但Fusion Payments是我目前联系的唯一付款网关，在奖励程序中很明显地发现了bug。 他们对我的消息做出了快速回应，并迅速修复了他们的错误。 <br><br>  <b>结论</b> <br><br> 支付网关并不像您想象的那样安全。 如此低的报酬（在某些情况下，我获得了$ 0），我不知道有多少人已经利用了支付网关中的这些漏洞。 <br><br>  <b>译者的话</b> <br><br> 我想从我自己的角度对研究作者的结论说几句话。 首先，这项研究是对卖方的警告和警告，因为发现的漏洞使卖方成为入侵者的受害者。 但是还有许多其他可能对客户有害的错误（持卡人，支付系统的用户等）。 在未经验证的网站上输入您的个人帐单信息时，请务必小心。 更妙的是，您可以使用一张单独的银行卡，上面有您在Internet上进行购买所需的金额。 <br><br> 您是否在支付系统中遇到任何错误，或者您甚至是此类错误的受害者？ 在评论中分享有关如何保护自己的经验，观点和提示。 祝您有美好的一天并安全购物。 <br><br>  <b>作为广告。</b> 促销！ 直到现在<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">为止，在荷兰和美国</a> （ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">带有VPS（KVM）的</a>配置-E5-2650v4（6核）/ 10GB DDR4 / 240GB SSD或4TB HDD / 1Gbps 10TB-$ 29 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">），最多可以免费使用VPS（KVM）4个月。</a> /月及以上，提供RAID1和RAID10选件）</b> ，这是专用服务器的完整模拟，订购1-12个月的产品时， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处的操作条款在此处，</a>现有订户可获得2个月的奖励！ <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">如何建立建筑物的基础设施。</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用价格为9000欧元的Dell R730xd E5-2650 v4服务器的上等课程？</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN406949/">https://habr.com/ru/post/zh-CN406949/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN406937/index.html">那不是开采的：世界上哪些国家禁止使用加密货币</a></li>
<li><a href="../zh-CN406939/index.html">广播听众和广播主持人讨厌什么</a></li>
<li><a href="../zh-CN406941/index.html">Wynd-无论身在何处，个人新鲜空气</a></li>
<li><a href="../zh-CN406943/index.html">理查德·斯托曼（Richard Stallman）关注微软对Linux的热爱</a></li>
<li><a href="../zh-CN406947/index.html">在纽约，准备在拍卖测试版面“ Sputnik-1”中放置一个无线电模块</a></li>
<li><a href="../zh-CN406951/index.html">Marea：来自Microsoft和Facebook的跨大西洋电缆完成</a></li>
<li><a href="../zh-CN406953/index.html">元头灯</a></li>
<li><a href="../zh-CN406955/index.html">流动性管理以及应收款和应付账款的自动化是小型企业的重要创新</a></li>
<li><a href="../zh-CN406957/index.html">戴尔帮助Pixomondo打造惊艳的视觉效果</a></li>
<li><a href="../zh-CN406959/index.html">健全的生态系统：它是什么以及如何使用它</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>