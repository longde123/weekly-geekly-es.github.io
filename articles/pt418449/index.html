<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö¥ üìì üë¶üèæ M√≥dulos bin√°rios para Python ü§Ω üòπ üßõüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Python √© incr√≠vel. Dizemos "instala√ß√£o do pip" e provavelmente a biblioteca necess√°ria ser√° entregue. Mas √†s vezes a resposta ser√°: "falha na compila√ß...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>M√≥dulos bin√°rios para Python</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/418449/">  Python √© incr√≠vel.  Dizemos "instala√ß√£o do pip" e provavelmente a biblioteca necess√°ria ser√° entregue.  Mas √†s vezes a resposta ser√°: "falha na compila√ß√£o", porque existem m√≥dulos bin√°rios.  Eles sofrem com algum tipo de dor em quase todas as linguagens modernas, porque h√° muitas arquiteturas, algo precisa ser montado para uma m√°quina espec√≠fica, algo precisa estar vinculado a outras bibliotecas.  Em geral, uma pergunta interessante, mas pouco estudada: como eles podem ser feitos e que problemas existem?  Dmitry Zhiltsov ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">zaabjuda</a> ) tentou responder a essa pergunta no MoscowPython Conf no ano passado. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/P7ihyyIDtME" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Abaixo do corte, est√° a vers√£o em texto do relat√≥rio de Dmitry.  Vamos pensar brevemente em quando os m√≥dulos bin√°rios s√£o necess√°rios e quando √© melhor abandon√°-los.  Vamos discutir as regras que devem ser seguidas ao escrev√™-las.  Considere cinco op√ß√µes de implementa√ß√£o poss√≠veis: <br><br><ul><li>  Extens√£o nativa C / C ++ </li><li>  Swig </li><li>  Cython </li><li>  Ctypes </li><li>  Ferrugem </li></ul><br>  <strong>Sobre o palestrante</strong> : Dmitry Zhiltsov se desenvolve h√° mais de 10 anos.  Ele trabalha na CIAN como arquiteto de sistemas, ou seja, √© respons√°vel por solu√ß√µes t√©cnicas e controle de tempo.  Na minha vida, eu tentei o assembler, Haskell, C e, durante os √∫ltimos 5 anos, tenho programado ativamente em Python. <a name="habracut"></a><br><br><h2>  Sobre empresa <br></h2><br>  Muitos que vivem em Moscou e alugam moradias provavelmente conhecem o CIAN.  CYAN √© de 7 milh√µes de compradores e inquilinos por m√™s.  Todos esses usu√°rios todos os meses, usando nosso servi√ßo, encontram um lugar para morar. <br><br>  Cerca de 75% dos moscovitas conhecem nossa empresa, e isso √© muito legal.  Em S√£o Petersburgo e Moscou, somos praticamente considerados monopolistas.  No momento, estamos tentando entrar nas regi√µes e, portanto, o desenvolvimento cresceu 8 vezes nos √∫ltimos 3 anos.  Isso significa que a equipe aumentou 8 vezes, a velocidade de entrega de valores ao usu√°rio aumentou 8 vezes, ou seja,  desde uma ideia de produto at√© como a m√£o de um engenheiro implementou uma constru√ß√£o para produ√ß√£o.  Aprendemos em nossa grande equipe a desenvolver muito rapidamente e entender muito rapidamente o que est√° acontecendo no momento, mas hoje falaremos um pouco sobre outra coisa. <br><br>  Vou falar sobre m√≥dulos bin√°rios.  Agora, quase 50% das bibliotecas Python possuem algum tipo de m√≥dulo bin√°rio.  E, como se viu, muitas pessoas n√£o est√£o familiarizadas com elas e acreditam que isso √© algo transcendental, algo sombrio e desnecess√°rio.  E outras pessoas sugerem escrever melhor um microsservi√ßo separado e n√£o usar m√≥dulos bin√°rios. <br><br>  O artigo ser√° composto de duas partes. <br><br><ol><li> Minha experi√™ncia: por que eles s√£o necess√°rios, quando s√£o mais bem utilizados e quando n√£o s√£o. <br></li><li>  Ferramentas e tecnologias com as quais voc√™ pode implementar um m√≥dulo bin√°rio para Python. <br></li></ol><br><h2>  Por que s√£o necess√°rios m√≥dulos bin√°rios? <br></h2><br>  Todos sabemos perfeitamente que Python √© uma linguagem interpretada.  √â quase a mais r√°pida das linguagens interpretadas, mas, infelizmente, sua <strong>velocidade nem sempre √© suficiente</strong> para c√°lculos matem√°ticos pesados.  Imediatamente surge o pensamento de que C ser√° mais r√°pido. <br><br>  Mas o Python tem mais uma dor - √© o <strong>GIL</strong> .  Um grande n√∫mero de artigos foi escrito sobre ele e foram feitos relat√≥rios sobre como contorn√°-lo. <br><br>  Tamb√©m precisamos de extens√µes bin√°rias para <strong>reutilizar a l√≥gica</strong> .  Por exemplo, encontramos uma biblioteca que possui todas as funcionalidades de que precisamos e por que n√£o us√°-la.  Ou seja, voc√™ n√£o precisa reescrever o c√≥digo, apenas pegamos o c√≥digo finalizado e o reutilizamos. <br><br>  Muitas pessoas acreditam que usando extens√µes bin√°rias voc√™ pode <strong>ocultar o c√≥digo fonte</strong> .  A quest√£o √© muito, muito controversa, √© claro, com a ajuda de algumas pervers√µes selvagens, isso pode ser alcan√ßado, mas n√£o h√° 100% de garantia.  O m√°ximo que voc√™ pode obter √© n√£o deixar o cliente descompilar e ver o que acontece no c√≥digo que voc√™ passou. <br><br><h3>  Quando as extens√µes bin√°rias s√£o realmente necess√°rias? <br></h3><br>  Sobre velocidade e Python, √© claro - quando alguma fun√ß√£o funciona muito lentamente e ocupa 80% do tempo de execu√ß√£o de todo o c√≥digo, come√ßamos a pensar em escrever uma extens√£o bin√°ria.  Mas, para tomar essas decis√µes, voc√™ precisa come√ßar, como disse um famoso orador, pensar com seu c√©rebro. <br><br>  Para escrever extens√µes de extens√£o, √© preciso levar em considera√ß√£o que isso, em primeiro lugar, ser√° longo.  Primeiro, voc√™ precisa "lamber" seus algoritmos, ou seja,  veja se existem ombreiras. <br><br><blockquote>  Em 90% dos casos, ap√≥s uma verifica√ß√£o completa do algoritmo, a necessidade de escrever algumas extens√µes desaparece. <br></blockquote><br>  O segundo caso em que as extens√µes bin√°rias s√£o realmente necess√°rias √© o <strong>uso de multiencadeamento para opera√ß√µes simples</strong> .  Agora isso n√£o √© t√£o relevante, mas ainda permanece na empresa sangrenta, em alguns integradores de sistemas, onde o Python 2.6 ainda est√° escrito.  N√£o h√° assincronia, e mesmo para coisas simples, por exemplo, ao enviar um monte de fotos, o multi-threading aumenta.  Parece que inicialmente isso n√£o incorre em nenhuma despesa de rede, mas quando carregamos a imagem no buffer, o mal-intencionado GIL chega e algum tipo de freio √© iniciado.  Como mostra a pr√°tica, essas coisas s√£o melhor resolvidas usando bibliotecas das quais o Python n√£o sabe nada. <br><br>  Se voc√™ precisar implementar algum protocolo espec√≠fico, pode ser conveniente criar um c√≥digo C / C ++ simples e livrar-se de muita dor.  Fiz isso no meu tempo em uma operadora de telecomunica√ß√µes, j√° que n√£o havia uma biblioteca pronta - tive que escrever sozinha.  Mas repito, agora isso n√£o √© muito relevante, porque existe ass√≠ncio, e para a maioria das tarefas isso √© suficiente. <br><br>  Sobre <strong>opera√ß√µes</strong> obviamente <strong>dif√≠ceis,</strong> eu j√° disse com anteced√™ncia.  Quando h√° falhas, matrizes grandes e similares, faz sentido que voc√™ precise fazer uma extens√£o para C / C ++.  Quero observar que algumas pessoas pensam que n√£o precisamos de extens√µes bin√°rias aqui, √© melhor fazer um microsservi√ßo em alguma " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">linguagem super r√°pida</a> " e transferir matrizes enormes pela rede.  N√£o, √© melhor n√£o fazer isso. <br><br>  Outro bom exemplo de quando eles podem e devem ser tomados √© quando voc√™ tem uma <strong>l√≥gica estabelecida do m√≥dulo</strong> .  Se voc√™ j√° tem um m√≥dulo ou biblioteca Python em sua empresa h√° 3 anos, h√° altera√ß√µes uma vez por ano e depois duas linhas, por que n√£o transform√°-lo em uma biblioteca C normal se houver tempo e recursos livres.  No m√≠nimo, obtenha um aumento de produtividade.  E tamb√©m haver√° um entendimento de que, se algumas altera√ß√µes cardinais forem necess√°rias na biblioteca, isso n√£o √© t√£o simples e, talvez, valha a pena pensar novamente com o c√©rebro e usar essa biblioteca de uma maneira diferente. <br><br><h3>  5 regras de ouro <br></h3><br>  Eu derivei essas regras na minha pr√°tica.  Eles dizem respeito n√£o apenas ao Python, mas tamb√©m a outras linguagens para as quais voc√™ pode usar extens√µes bin√°rias.  Voc√™ pode discutir com eles, mas tamb√©m pode pensar e trazer o seu. <br><br><ol><li>  <strong>Somente fun√ß√µes de exporta√ß√£o</strong> .  A constru√ß√£o de classes em Python em bibliotecas bin√°rias consome bastante tempo: voc√™ precisa descrever muitas interfaces, revisar muita integridade de refer√™ncia no pr√≥prio m√≥dulo.  √â mais f√°cil escrever uma pequena interface para a fun√ß√£o. <br></li><li>  <strong>Use classes de wrapper</strong> .  Alguns gostam muito de OOP e realmente querem aulas.  De qualquer forma, mesmo que n√£o sejam classes, √© melhor escrever um wrapper Python: criar uma classe, definir um m√©todo de classe ou regular, chamar fun√ß√µes nativas de C / C ++.  No m√≠nimo, isso ajuda a manter a integridade da arquitetura de dados.  Se voc√™ usar algum tipo de extens√£o de terceiros do C / C ++ que n√£o possa ser corrigida, no inv√≥lucro poder√° cort√°-la para que tudo funcione. <br></li><li>  <strong>Voc√™ n√£o pode passar argumentos do Python para uma extens√£o - isso</strong> nem √© uma regra, mas um requisito.  Em alguns casos, isso pode funcionar, mas geralmente √© uma m√° id√©ia.  Portanto, em seu c√≥digo, voc√™ deve primeiro criar um manipulador que projete o tipo Python para o tipo C. E somente depois disso chamar√° qualquer fun√ß√£o nativa que j√° funcione com os tipos s.  O mesmo manipulador recebe uma resposta de uma fun√ß√£o execut√°vel e a transforma em tipos de dados Python, e a lan√ßa no c√≥digo Python. <br></li><li>  <strong>Leve em considera√ß√£o a coleta de lixo</strong> .  O Python possui um GC bem conhecido, e voc√™ n√£o deve esquec√™-lo.  Por exemplo, passamos um grande peda√ßo de texto por refer√™ncia e tentamos encontrar alguma palavra na biblioteca.  Queremos paralelizar isso, passamos o link para essa √°rea de mem√≥ria e para o lan√ßamento de v√°rios threads.  Nesse momento, o GC simplesmente pega e decide que nada mais se refere a esse objeto e o remove da √°rea de mem√≥ria.  No mesmo c√≥digo, obtemos apenas uma refer√™ncia nula, e isso geralmente √© uma falha de segmenta√ß√£o.  N√£o devemos esquecer esse recurso do coletor de lixo e passar os tipos de dados mais simples para as bibliotecas de char: char, integer etc. <br><br>  Por outro lado, o idioma em que a extens√£o est√° escrita pode ter seu pr√≥prio coletor de lixo.  A combina√ß√£o de Python e a biblioteca C # √© uma dor nesse sentido. <br></li><li>  <strong>Defina explicitamente os argumentos da fun√ß√£o exportada</strong> .  Com isso, quero dizer que essas fun√ß√µes precisar√£o ser anotadas qualitativamente.  Se aceitarmos a fun√ß√£o PyObject, e em qualquer caso a aceitarmos em nossa biblioteca, precisaremos indicar explicitamente quais argumentos pertencem a quais tipos.  Isso √© √∫til porque se passarmos o tipo de dados errado, obteremos um erro na biblioteca.  Ou seja, voc√™ precisa para sua conveni√™ncia. <br></li></ol><br><h3>  Arquitetura de extens√£o bin√°ria <br></h3><br><img src="https://habrastorage.org/webt/xq/q1/-0/xqq1-0l_omlmuok-v8yqryqkvku.png"><br><br>  Na verdade, n√£o h√° nada complicado na arquitetura de extens√µes bin√°rias.  Existe o Python, existe uma fun√ß√£o de chamada que chega a um inv√≥lucro que chama nativamente o c√≥digo.  Essa chamada, por sua vez, se baseia em uma fun√ß√£o que √© exportada para Python e que pode ser chamada diretamente.  √â nessa fun√ß√£o que voc√™ precisa converter tipos de dados para tipos de dados do seu idioma.  E somente depois que essa fun√ß√£o nos traduz tudo, chamamos a fun√ß√£o nativa, que faz a l√≥gica principal, retorna o resultado na dire√ß√£o oposta e o lan√ßa no Python, convertendo os tipos de dados de volta. <br><br><h2>  Tecnologia e Ferramentas <br></h2><br>  A maneira mais famosa de escrever extens√µes bin√°rias √© a extens√£o Native C / C ++.  S√≥ porque √© a tecnologia Python padr√£o. <br><br><h3>  Extens√£o nativa C / C ++ <br></h3><br>  O pr√≥prio Python √© implementado em C, e os m√©todos e estruturas do python.h s√£o usados ‚Äã‚Äãpara escrever extens√µes.  A prop√≥sito, isso tamb√©m √© bom porque √© muito f√°cil implement√°-lo em um projeto existente.  Basta especificar xt_modules em setup.py e dizer que, para construir o projeto, voc√™ precisa compilar essas fontes com esses sinalizadores de compila√ß√£o.  Abaixo est√° um exemplo. <br><br><pre><code class="cpp hljs">name = <span class="hljs-string"><span class="hljs-string">'DateTime.mxDateTime.mxDateTime'</span></span> src = <span class="hljs-string"><span class="hljs-string">'mxDateTime/mxDateTime.c'</span></span> extra_compile_args=[<span class="hljs-string"><span class="hljs-string">'-g3'</span></span>, <span class="hljs-string"><span class="hljs-string">'-o0'</span></span>, <span class="hljs-string"><span class="hljs-string">'-DDEBUG=2'</span></span>, <span class="hljs-string"><span class="hljs-string">'-UNDEBUG'</span></span>, <span class="hljs-string"><span class="hljs-string">'-std=c++11'</span></span>, <span class="hljs-string"><span class="hljs-string">'-Wall'</span></span>, <span class="hljs-string"><span class="hljs-string">'-Wextra'</span></span>] setup ( ... ext_modules = [(name, { <span class="hljs-string"><span class="hljs-string">'sources'</span></span>: [src], <span class="hljs-string"><span class="hljs-string">'include_dirs'</span></span>: [<span class="hljs-string"><span class="hljs-string">'mxDateTime'</span></span>] , extra_compile_args: extra_compile_args } )] )</code> </pre> <br>  Pr√≥s da extens√£o nativa C / C ++ <br><br><ul><li>  Tecnologia nativa. </li><li>  √â facilmente integrado √† montagem do projeto. </li><li>  A maior quantidade de documenta√ß√£o. </li><li>  Permite criar seus pr√≥prios tipos de dados. </li></ul><br>  Contras da extens√£o C / C ++ nativa <br><br><ul><li>  Limite de entrada alto. </li><li>  √â necess√°rio conhecimento de C. </li><li>  Boost.Python. </li><li>  Falha na segmenta√ß√£o. </li><li>  Dificuldades na depura√ß√£o. </li></ul><br>  De acordo com essa tecnologia, uma enorme quantidade de documenta√ß√£o √© gravada, tanto em publica√ß√µes padr√£o quanto em blogs.  Uma grande vantagem √© que podemos criar nossos pr√≥prios tipos de dados Python e construir nossas classes. <br><br>  Essa abordagem tem grandes desvantagens.  Primeiro, √© o limite de entrada - nem todo mundo sabe C o suficiente para codificar para produ√ß√£o.  Voc√™ precisa entender que, para isso, n√£o basta ler o livro e executar para escrever extens√µes nativas.  Se voc√™ quiser fazer isso, ent√£o: primeiro, aprenda C;  ent√£o comece a escrever utilit√°rios de comando;  somente depois disso, continue escrevendo extens√µes. <br><br>  O Boost.Python √© muito bom para C ++, permite abstrair quase completamente todos esses wrappers que usamos no Python.  Mas o menos, eu acho, √© que voc√™ precisa suar muito para tomar parte dele e import√°-lo para o projeto sem baixar o Boost inteiro. <br><br>  Listando as dificuldades na depura√ß√£o nos pontos negativos, quero dizer que agora todos est√£o acostumados a usar um depurador gr√°fico e, com m√≥dulos bin√°rios, isso n√£o funciona.  Provavelmente voc√™ precisa instalar o GDB com um plug-in para Python. <br><br>  Vejamos um exemplo de como criamos isso. <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Python.h&gt; static PyObject*addList_add(Pyobject* self, Pyobject* args){ PyObject * listObj; if (! PyARg_Parsetuple( args, "", &amp;listObj)) return NULL; long length = PyList_Size(listObj) int i, sum =0; //   return Py_BuildValue("i", sum); }</span></span></span></span></code> </pre><br>  Para come√ßar, inclu√≠mos os arquivos de cabe√ßalho Python.  Depois disso, descrevemos a fun√ß√£o addList_add que o Python usar√°.  O mais importante √© nomear a fun√ß√£o corretamente; nesse caso, addList √© o nome do m√≥dulo, _add √© o nome da fun√ß√£o que ser√° usada no Python.  Passamos o pr√≥prio m√≥dulo PyObject e passamos os argumentos usando o PyObject tamb√©m.  Depois disso, realizamos verifica√ß√µes padr√£o.  Nesse caso, estamos tentando analisar o argumento da tupla e dizer que √© um objeto - o literal "O" deve ser especificado explicitamente.  Depois disso, sabemos que passamos listObj como um objeto e tentamos descobrir seu comprimento usando m√©todos padr√£o do Python: PyList_Size.  Observe que aqui ainda n√£o podemos usar chamadas para descobrir a dura√ß√£o desse vetor, mas usar a funcionalidade Python.  N√≥s omitimos a implementa√ß√£o, ap√≥s a qual √© necess√°rio retornar todos os valores de volta ao Python.  Para fazer isso, chame Py_BuildValue, especifique qual tipo de dados estamos retornando; neste caso, "i" √© um n√∫mero inteiro e a pr√≥pria vari√°vel sum. <br><br>  Nesse caso, todos entendem - encontramos a soma de todos os elementos da lista.  Vamos um pouco mais longe. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt; length; i++){ <span class="hljs-comment"><span class="hljs-comment">//     //   Python- PyObject* temp = PyList_GetItem(listObj, i); //  ,      //     C long long elem= PyLong_AsLong(temp); sum += elem; }</span></span></code> </pre><br>  √â a mesma coisa: no momento, listObj √© um objeto Python.  E, neste caso, estamos tentando pegar os itens da lista.  Python.h tem tudo o que voc√™ precisa para isso. <br><br>  Depois que temos temperatura, tentamos prolong√°-la por muito tempo.  E somente depois disso voc√™ pode fazer algo em C. <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  static char addList_docs[] = "add( ): add all elements of the list\n"; //    static PyMethodDef addList_funcs[] = { {"add", (PyCFunction)addList_add, METH_VARARGS, addList_docs}, {NULL, NULL, 0, NULL} };</span></span></code> </pre><br>  Depois de implementarmos toda a fun√ß√£o, √© necess√°rio escrever a documenta√ß√£o.  <strong>A documenta√ß√£o √© sempre boa</strong> , e este kit de ferramentas tem tudo para uma manuten√ß√£o conveniente.  Ap√≥s a conven√ß√£o de nomenclatura, nomeamos o m√≥dulo addList_docs e salvamos a descri√ß√£o l√°.  Agora voc√™ precisa registrar o m√≥dulo, para isso existe uma estrutura especial PyMethodDef.  Descrevendo as propriedades, dizemos que a fun√ß√£o √© exportada para Python com o nome "add", que essa fun√ß√£o chama PyCFunction.  METH_VARARGS significa que uma fun√ß√£o pode potencialmente levar qualquer n√∫mero de vari√°veis.  Tamb√©m escrevemos linhas adicionais e descrevemos uma verifica√ß√£o padr√£o, caso apenas import√°ssemos o m√≥dulo, mas n√£o us√°ssemos nenhum m√©todo para que n√£o ca√≠sse. <br><br>  Depois que anunciamos tudo isso, tentamos fazer um m√≥dulo.  Criamos um moduledef e colocamos tudo o que fizemos l√°. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PyModuleDef</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">moduledef</span></span></span><span class="hljs-class"> = {</span></span> PyModuleDef_HEAD_INIT, <span class="hljs-string"><span class="hljs-string">"addList example module"</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, adList_funcs, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> };</code> </pre><br>  PyModuleDef_HEAD_INIT √© uma constante padr√£o do Python que voc√™ deve sempre usar.  -1 indica que nenhuma mem√≥ria adicional precisa ser alocada no est√°gio de importa√ß√£o. <br><br>  Quando criamos o pr√≥prio m√≥dulo, precisamos inicializ√°-lo.  O Python est√° sempre procurando init, portanto, crie um PyInit_addList para addList.  Agora, a partir da estrutura montada, voc√™ pode chamar PyModule_Create e, finalmente, criar o pr√≥prio m√≥dulo.  Em seguida, adicione as meta-informa√ß√µes e retorne o pr√≥prio m√≥dulo. <br><br><pre> <code class="cpp hljs">PyInit_addList(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>){ PyObject *<span class="hljs-keyword"><span class="hljs-keyword">module</span></span> = PyModule_Create(&amp;mdef); If (<span class="hljs-keyword"><span class="hljs-keyword">module</span></span> == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; PyModule_AddStringConstant(<span class="hljs-keyword"><span class="hljs-keyword">module</span></span>, <span class="hljs-string"><span class="hljs-string">"__author__"</span></span>, <span class="hljs-string"><span class="hljs-string">"Bruse Lee&lt;brus@kf.ch&gt;:"</span></span>); PyModule_addStringConstant (Module, <span class="hljs-string"><span class="hljs-string">"__version__"</span></span>, <span class="hljs-string"><span class="hljs-string">"1.0.0"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>; }</code> </pre><br>  Como voc√™ j√° notou, h√° muitas coisas a serem transformadas.  Voc√™ deve sempre se lembrar do Python quando escrevermos em C / C ++. <br><br>  Por isso, para facilitar a vida de um programador mortal comum, h√° cerca de 15 anos, a tecnologia SWIG apareceu. <br><br><h3>  Swig <br></h3><br>  Essa ferramenta permite abstrair das liga√ß√µes do Python e escrever c√≥digo nativo.  Tem os mesmos pr√≥s e contras que o C / C ++ nativo, mas h√° exce√ß√µes. <br><br>  Profissionais do SWIG: <br><br><ul><li>  Tecnologia est√°vel. </li><li>  Uma grande quantidade de documenta√ß√£o. </li><li>  Resumos da liga√ß√£o ao Python. </li></ul><br>  Contras de SWIG: <br><br><ul><li>  Configura√ß√£o longa. </li><li>  Conhecimento C. </li><li>  Falha na segmenta√ß√£o. </li><li>  Dificuldades na depura√ß√£o. </li><li>  A complexidade da integra√ß√£o na montagem do projeto. </li></ul><br>  O primeiro ponto negativo √© que, <strong>enquanto voc√™ o configura, voc√™ perde a cabe√ßa</strong> .  Quando o configurei pela primeira vez, passei um dia e meio para lan√ß√°-lo.  Ent√£o, √© claro, √© mais f√°cil.  O SWIG 3.x se tornou mais f√°cil. <br><br>  Para n√£o entrar mais no c√≥digo, considere o esquema geral do SWIG. <br><br><img src="https://habrastorage.org/webt/93/4h/ul/934huleqgml-qurdnxrw8k0gjes.png"><br><br>  example.c √© um m√≥dulo C que n√£o sabe nada sobre Python.  H√° um arquivo de interface example.i, descrito no formato SWIG.  Depois disso, execute o utilit√°rio SWIG, que cria example_wrap.c a partir do arquivo de interface - este √© o mesmo wrapper que costum√°vamos fazer com nossas m√£os.  Ou seja, o SWIG apenas cria um inv√≥lucro de arquivo para n√≥s, a chamada ponte.  Depois disso, usando o GCC, compilamos dois arquivos e obtemos dois arquivos de objeto (example.o e example_wrap.o) e somente ent√£o criamos nossa biblioteca.  Tudo √© simples e claro. <br><br><h3>  Cython <br></h3><br>  Andrey Svetlov fez um excelente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">relat√≥rio</a> no Moscow Python Conf, ent√£o vou apenas dizer que esta √© uma tecnologia popular com boa documenta√ß√£o. <br><br>  Pr√≥s Cython: <br><br><ul><li>  Tecnologia popular. </li><li>  Bastante est√°vel. </li><li>  √â facilmente integrado √† montagem do projeto. </li><li>  Boa documenta√ß√£o. </li></ul><br>  Contras do Cython: <br><br><ul><li>  Sintaxe pr√≥pria. </li><li>  Conhecimento C. </li><li>  Falha na segmenta√ß√£o. </li><li>  Dificuldades na depura√ß√£o. </li></ul><br>  Contras, como sempre, √©.  A principal √© a sua pr√≥pria sintaxe, que √© semelhante ao C / C ++, e muito ao Python. <br><br>  Mas quero ressaltar que o c√≥digo Python pode ser acelerado usando o Cython escrevendo c√≥digo nativo. <br><br><img src="https://habrastorage.org/webt/tk/8t/sh/tk8tshw1gla6nevwcjda4c9iq20.png"><br><br>  Como voc√™ pode ver, h√° muitos decoradores, e isso n√£o √© muito bom.  Se voc√™ deseja usar o Cython - consulte o relat√≥rio de Andrei Svetlov. <br><br><h3>  CTypes <br></h3><br>  CTypes √© a biblioteca Python padr√£o que funciona com a Interface de Fun√ß√£o Estrangeira.  FFI √© uma biblioteca de baixo n√≠vel.  Esta √© uma tecnologia nativa, √© muito usada em c√≥digo, com sua ajuda, √© f√°cil de implementar entre plataformas. <br><br>  Mas o FFI carrega muita sobrecarga porque todas as pontes, todos os manipuladores em tempo de execu√ß√£o s√£o criados dinamicamente.  Ou seja, carregamos a biblioteca din√¢mica e, atualmente, o Python n√£o sabe o que √© a biblioteca.  Somente quando uma biblioteca √© chamada na mem√≥ria essas pontes s√£o constru√≠das dinamicamente. <br><br>  Pr√≥s de CTypes: <br><br><ul><li>  Tecnologia nativa. </li><li>  F√°cil de usar no c√≥digo. </li><li>  F√°cil de implementar em v√°rias plataformas. </li><li>  Voc√™ pode usar quase qualquer idioma. </li></ul><br>  Contras CTypes: <br><br><ul><li>  Carrega em cima. </li><li>  Dificuldades na depura√ß√£o. </li></ul><br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ctypes <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-comment"><span class="hljs-comment">#load the shared object file Adder = CDLL('./adder.so') #Calculate factorial res_int = adder.fact(4) print("Fact of 4 = " + str(res_int))</span></span></code> </pre><br>  Eles pegaram adder.so e o chamaram em tempo de execu√ß√£o.  Podemos at√© passar em tipos nativos de Python. <br><br>  Depois de tudo isso, a pergunta √©: "De alguma forma √© complicado, em todo lugar C, o que fazer?". <br><br><h3>  Ferrugem <br></h3><br>  Ao mesmo tempo, n√£o dei a devida aten√ß√£o ao idioma, mas agora praticamente me volto a ele. <br><br>  Profissionais da ferrugem: <br><br><ul><li>  Linguagem segura. </li><li>  Poderosas garantias est√°ticas de comportamento correto. </li><li>  Integra-se facilmente √†s constru√ß√µes do projeto ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PyO3</a> ). </li></ul><br>  Contras de ferrugem: <br><br><ul><li>  Limite de entrada alto. </li><li>  Configura√ß√£o longa. </li><li>  Dificuldades na depura√ß√£o. </li><li>  H√° pouca documenta√ß√£o. </li><li>  Em alguns casos, sobrecarga. </li></ul><br>  Ferrugem √© uma linguagem segura com prova autom√°tica de trabalho.  A pr√≥pria sintaxe e o pr√©-processador de linguagem n√£o permitem que um erro expl√≠cito seja cometido.  Ao mesmo tempo, concentra-se na variabilidade, ou seja, deve processar qualquer resultado da execu√ß√£o da ramifica√ß√£o de c√≥digo. <br><br>  Gra√ßas √† equipe do PyO3, existem bons binders do Python para o Rust e ferramentas para integra√ß√£o no projeto. <br><br>  Por outro lado, considero que, para um programador despreparado, leva muito tempo para configur√°-lo.  Pouca documenta√ß√£o, mas em vez de contras, n√£o temos uma falha de segmenta√ß√£o.  No Rust, em um bom sentido, em 99% dos casos, um programador pode obter uma falha de segmenta√ß√£o apenas se ele indicar explicitamente desembrulhar e apenas pontuar. <br><br>  Um pequeno exemplo de c√≥digo, o mesmo m√≥dulo que examinamos anteriormente. <br><br><pre> <code class="rust hljs"><span class="hljs-meta"><span class="hljs-meta">#![feature(proc_macro)]</span></span> <span class="hljs-meta"><span class="hljs-meta">#[macro_use]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">crate</span></span> pyo3; Use pyo3::prelude::*; <span class="hljs-comment"><span class="hljs-comment">/// Module documentation string 1 #[py::modinit(_addList)] fn init(py: Python, m: PyModule) -&gt; PyResult &lt;()&gt;{ py_exception!(_addList, EmptyListError); /// Function documentation string 1 #[pufn(m, "run", args= "*", kwargs="**" )] fn run_py(_py: Python, args: &amp;PyTuple, kwargs: Option&lt;&amp;PyDict&gt;) -&gt; PyResult&lt;()&gt; { run(args, kwargs) } #[pyfn(m, "run", args="*", kwatgs="**")] fn run_py(_py: Python, args: &amp;PyTuple, kwargs: Option&lt;&amp;PyDict&gt;) -&gt; PyResult&lt;()&gt;{ run(args,kwargs) } #[pyfn(m,"add")] fn add(_py: Python, py_list: &amp;PyList) -&gt; PyResult&lt;i32&gt;{ let mut sum : i32 = 0 match py_list.len() { /// Some code Ok(sum) } Ok(()) }</span></span></code> </pre><br>  O c√≥digo tem uma sintaxe espec√≠fica, mas voc√™ se acostuma muito rapidamente.  De fato, tudo √© o mesmo aqui.  Usando macros, fazemos modinit, que, para n√≥s, faz todo o trabalho adicional de gerar todos os tipos de ligantes para Python.  Lembre-se de que eu disse, voc√™ precisa fazer um wrapper de manipulador, aqui est√° o mesmo.  run_py converte tipos, ent√£o chamamos o c√≥digo nativo. <br><br>  Como voc√™ pode ver, para exportar alguma fun√ß√£o, h√° a√ß√∫car sint√°tico.  Apenas dizemos que precisamos da fun√ß√£o add e n√£o descrevemos nenhuma interface.  Aceitamos list, que √© exatamente py_list, n√£o Object, porque o pr√≥prio Rust configurar√° os binders necess√°rios no momento da compila√ß√£o.  Se passarmos o tipo de dados errado, como nas extens√µes, um TypeError ocorrer√°.  Depois que chegamos √† lista, come√ßamos a process√°-la. <br><br>  Vamos ver com mais detalhes o que ele est√° come√ßando a fazer. <br><br><pre> <code class="rust hljs"><span class="hljs-meta"><span class="hljs-meta">#[pyfn(m, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"add"</span></span></span><span class="hljs-meta">, py_list=</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"*"</span></span></span><span class="hljs-meta">)]</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span></span>(_py: Python, py_list: &amp;PyList) -&gt; PyResult&lt;<span class="hljs-built_in"><span class="hljs-built_in">i32</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> py_list.len() { <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt;<span class="hljs-literal"><span class="hljs-literal">Err</span></span>(EmptyListError::new(<span class="hljs-string"><span class="hljs-string">"List is empty"</span></span>)), _ =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> sum : <span class="hljs-built_in"><span class="hljs-built_in">i32</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> py_list.iter() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> temp:<span class="hljs-built_in"><span class="hljs-built_in">i32</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> item.extract() { <span class="hljs-literal"><span class="hljs-literal">Ok</span></span>(v) =&gt; v, <span class="hljs-literal"><span class="hljs-literal">Err</span></span>(_) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> err_msg: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">format!</span></span>(<span class="hljs-string"><span class="hljs-string">"List item {} is not int"</span></span>, item); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">Err</span></span>(ItemListError::new(err_msg)) } }; sum += temp; } <span class="hljs-literal"><span class="hljs-literal">Ok</span></span>(sum) } } }</code> </pre><br>  O mesmo c√≥digo que estava em C / C ++ / Ctypes, mas apenas em Rust.  L√°, tentei converter o PyObject por algum tempo.  O que aconteceria se list√°ssemos, com exce√ß√£o dos n√∫meros, obter√≠amos uma string?  Sim, obter√≠amos um SystemEerror.  Nesse caso, atrav√©s de <strong>let mut</strong> sum <strong>: i32 =</strong> 0;  tamb√©m estamos tentando obter um valor da lista e convert√™-lo para i32.  Ou seja, n√£o conseguiremos escrever esse c√≥digo sem item.extract (), inconscientemente e convertido para o tipo desejado.  Quando escrevemos o i32, no caso de um erro de Ferrugem, no est√°gio de compila√ß√£o, ele diz: ‚ÄúManuseie o caso quando n√£o o i32‚Äù.  Nesse caso, se tivermos i32, retornamos um valor, se for um erro, lan√ßamos uma exce√ß√£o. <br><br><h2>  O que escolher <br></h2><br>  Ap√≥s esse breve passeio, pensaremos sobre o que escolher no final? <br><br>  A resposta √© realmente o seu gosto e cor. <br><br>  N√£o promoverei nenhuma tecnologia espec√≠fica. <br><br><img src="https://habrastorage.org/webt/hu/kt/bn/huktbnnsqfoydatdp7gzsisysjg.png"><br><br>  Apenas resuma o que foi dito: <br><br><ul><li>  No caso de SWIG e C / C ++, voc√™ precisa conhecer muito bem o C / C ++, entender que o desenvolvimento deste m√≥dulo implicar√° em alguma sobrecarga adicional.  Mas um m√≠nimo de ferramentas ser√° usado, e trabalharemos na tecnologia nativa do Python, que √© suportada pelos desenvolvedores. </li><li>  No caso do Cython, temos um pequeno limiar de entrada, uma alta velocidade de desenvolvimento e esse tamb√©m √© um gerador de c√≥digo comum. </li><li>  √Ä custa dos CTypes, quero alert√°-lo sobre a sobrecarga relativamente grande.  O carregamento din√¢mico da biblioteca, quando n√£o sabemos que tipo de biblioteca √©, pode causar muitos problemas. </li><li>  Eu aconselho o Rust a levar algu√©m que n√£o conhece bem o C / C ++.  A ferrugem na produ√ß√£o realmente traz menos problemas. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Links √∫teis</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/zaabjuda/moscowpythonconf2017</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://docs.python.org/3/extending/building.html</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://cython.org</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://docs.python.org/376/library/ctypes.html</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://www.swig.org</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://www.rust-land.org/en-US/</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/PyO3</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://www.youtube.com/watch?v=5-WoT4X17sk</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://packaging.python.org/tutorials/distributing-packages/#platformwheels</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/PushAMP/pamagent</a> (exemplo de combate de co-uso) </div></div><br><blockquote>  Chamada de trabalhos <br><br>  Aceitamos aplicativos para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Moscow Python Conf ++</a> at√© 7 de setembro - escreva desta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">forma</a> simples que voc√™ conhece sobre Python e que realmente precisa compartilhar com a comunidade. <br><br>  Para aqueles que est√£o mais interessados ‚Äã‚Äãem ouvir, posso falar sobre relat√≥rios interessantes. <br><br><ul><li>  <strong>Donald Whyte</strong> adora falar sobre a acelera√ß√£o da matem√°tica em Python e est√° preparando uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nova hist√≥ria</a> para n√≥s: como tornar a matem√°tica 10 vezes mais r√°pida usando bibliotecas populares, truques e insidiosidade, e o c√≥digo √© claro e suportado. <br></li><li>  <strong>Artyom Malyshev</strong> reuniu todos os seus muitos anos de experi√™ncia no desenvolvimento do Django e est√° apresentando um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">guia de relat√≥rios</a> sobre o framework!  Tudo o que acontece entre receber uma solicita√ß√£o HTTP e enviar uma p√°gina da Web finalizada: expor magia, um mapa dos mecanismos internos da estrutura e muitas dicas √∫teis para seus projetos. <br></li></ul><br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt418449/">https://habr.com/ru/post/pt418449/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt418439/index.html">No√ß√µes b√°sicas progressivas sobre aplicativos da Web</a></li>
<li><a href="../pt418441/index.html">No√ß√µes b√°sicas de escalonamento de privil√©gios do Windows</a></li>
<li><a href="../pt418443/index.html">GObject: encapsulamento, instancia√ß√£o, introspec√ß√£o</a></li>
<li><a href="../pt418445/index.html">Canais do Django - a resposta para a web moderna</a></li>
<li><a href="../pt418447/index.html">Por que o Moscow Python Conf √© agora ++</a></li>
<li><a href="../pt418451/index.html">Aulas de impress√£o 3D. Suporte eficaz e altera√ß√£o da altura da camada na pr√°tica do 3Dtool</a></li>
<li><a href="../pt418453/index.html">As observa√ß√µes do GRAVITY validam ainda mais a relatividade geral</a></li>
<li><a href="../pt418455/index.html">Semin√°rio on-line aberto ‚ÄúEspecialista no comando: primeira experi√™ncia e erros‚Äù</a></li>
<li><a href="../pt418457/index.html">Thanks post: dia do administrador do sistema</a></li>
<li><a href="../pt418459/index.html">Desenvolvimento do scaler LVDS com duas interfaces DisplayPort</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>