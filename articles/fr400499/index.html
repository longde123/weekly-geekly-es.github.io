<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👼🏾 👝 🔁 Serre intelligente dans Telegram 🎴 👏🏾 👹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bon après-midi Sur notre site il y a une serre. Son principal problème est la surchauffe par temps chaud, car conçu principalement pour le printemps s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Serre intelligente dans Telegram</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/400499/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bon après-midi </font><font style="vertical-align: inherit;">Sur notre site il y a une serre. </font><font style="vertical-align: inherit;">Son principal problème est la surchauffe par temps chaud, car </font><font style="vertical-align: inherit;">conçu principalement pour le printemps sibérien. </font><font style="vertical-align: inherit;">La seule issue est d'ouvrir / fermer constamment les portes et les fenêtres pour maintenir la température. </font><font style="vertical-align: inherit;">Mais ce n'est pas toujours possible. </font><font style="vertical-align: inherit;">Et si cela n'est pas fait, la température monte à +50 degrés, ce qui n'est clairement pas bon. </font><font style="vertical-align: inherit;">Et le soir, tout peut être congelé. </font><font style="vertical-align: inherit;">Et c'est ainsi qu'a commencé son automatisation.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/dad/e37/ae3/dade37ae3afba69377f7d7ac53a94b3b.jpg" alt="image"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, nous avons acheté un Raspberry Pi 2. Après l'avoir réglé, nous avons connecté le capteur DS18B20 pour cet </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ensuite, deux fenêtres de voiture d'occasion ont été achetées. Comme tous les moteurs à courant continu, ils se déplacent en fonction de la polarité. Par conséquent, nous connectons deux relais à chaque moteur: un pour l'ouverture, l'autre pour la fermeture. Nous connectons déjà ces relais via des transistors aux ports GPIO eux-mêmes. Et nous alimentons le tout avec une batterie 12V. De plus, afin de ne pas brûler les moteurs, des interrupteurs de fin de course ont été installés dans les positions extrêmes de la fenêtre, et si la fenêtre s'ouvrait / se fermait, le réseau était complètement déchiré. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/976/39f/9d2/97639f9d24e51af037d3baca1200359e.jpg" alt="image"><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/1ec/ed9/824/1eced98242cb39b2a74d3d8babb31a19.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et pour la communication, nous utilisons l'adaptateur WiFi TP-LINK avec l'antenne Double Square avancée pour une réception fiable du </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WIFI voisin</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">routeur WIFI à domicile, qui est situé à une distance de 40 mètres. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/a7a/c93/db7/a7ac93db7ed2017891be1ded712e1e25.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous écrivons maintenant un programme pour contrôler ces disques. </font><font style="vertical-align: inherit;">Python a été choisi, car il prend en charge normalement les ports Raspberry Pi et spécifiquement GPIO. </font><font style="vertical-align: inherit;">Pour ouvrir la fenêtre, nous devons appliquer + 3,3 V au transistor, ce qui active le relais, puis il commencera à ouvrir la fenêtre. </font><font style="vertical-align: inherit;">Pour le fermer, nous faisons de même, seulement dans ce cas notre relais est connecté en face du variateur. </font><font style="vertical-align: inherit;">Mais sur Raspberry, nous appliquons simplement le courant à un port ou à l'autre. </font><font style="vertical-align: inherit;">Nous avons décidé que si la température est supérieure à 26, nous ouvrons la fenêtre pendant 1 seconde. </font><font style="vertical-align: inherit;">Ensuite, nous attendons 3 minutes. </font><font style="vertical-align: inherit;">S'il fait à nouveau chaud, ouvrez la seconde fenêtre en une seconde. </font><font style="vertical-align: inherit;">Nous attendons encore 3 minutes et recommençons. </font><font style="vertical-align: inherit;">La même chose avec la fermeture, seulement ici, la température doit être inférieure à 24 degrés. </font><font style="vertical-align: inherit;">Et voici le code:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">temp.py</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RPi.GPIO <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> GPIO
<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time
<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os
<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime

GPIO.setmode(GPIO.BOARD)
GPIO.cleanup()
GPIO.setup(<span class="hljs-number"><span class="hljs-number">31</span></span>, GPIO.OUT)
GPIO.setup(<span class="hljs-number"><span class="hljs-number">33</span></span>, GPIO.OUT)
GPIO.setup(<span class="hljs-number"><span class="hljs-number">35</span></span>, GPIO.OUT)
GPIO.setup(<span class="hljs-number"><span class="hljs-number">37</span></span>, GPIO.OUT)

<span class="hljs-comment"><span class="hljs-comment"># </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gettemp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> os.path.isdir(<span class="hljs-string"><span class="hljs-string">"id "</span></span>): <span class="hljs-comment"><span class="hljs-comment">#  ,   </span></span>
    tfile2=open(<span class="hljs-string"><span class="hljs-string">"/sys/bus/w1/devices/id "</span></span>)
    ttext2=tfile2.read()
    tfile2.close()
    temp2=ttext2.split(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>].split(<span class="hljs-string"><span class="hljs-string">" "</span></span>)[<span class="hljs-number"><span class="hljs-number">9</span></span>]
    t2=float(temp2[<span class="hljs-number"><span class="hljs-number">2</span></span>:])/<span class="hljs-number"><span class="hljs-number">1000</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> t2
  <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-comment"><span class="hljs-comment"># ,   </span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">'File not found'</span></span>)
    t2==<span class="hljs-number"><span class="hljs-number">24</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> t2

t2=<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-comment"><span class="hljs-comment">#    </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>:  
t2=gettemp()
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>    t2&lt;<span class="hljs-number"><span class="hljs-number">24</span></span>: <span class="hljs-comment"><span class="hljs-comment">#   24,      </span></span>
 
        GPIO.output(<span class="hljs-number"><span class="hljs-number">37</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"close1"</span></span>)
        time.sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>)
        GPIO.output(<span class="hljs-number"><span class="hljs-number">37</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)

  <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span>  t2&gt;<span class="hljs-number"><span class="hljs-number">26</span></span>: <span class="hljs-comment"><span class="hljs-comment">#  26,      </span></span>
        GPIO.output(<span class="hljs-number"><span class="hljs-number">35</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"open1"</span></span>)
        time.sleep(<span class="hljs-number"><span class="hljs-number">2</span></span>)
        GPIO.output(<span class="hljs-number"><span class="hljs-number">35</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)
        
  <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-comment"><span class="hljs-comment">#   </span></span>
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"none1"</span></span>)
  time.sleep(<span class="hljs-number"><span class="hljs-number">180</span></span>)<span class="hljs-comment"><span class="hljs-comment"># 3 </span></span>

<span class="hljs-comment"><span class="hljs-comment">#  </span></span>
t2=gettemp()

<span class="hljs-comment"><span class="hljs-comment">#   ,    .</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>    t2&lt;<span class="hljs-number"><span class="hljs-number">24</span></span>:
        GPIO.output(<span class="hljs-number"><span class="hljs-number">33</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"close2"</span></span>)
        time.sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>)
        GPIO.output(<span class="hljs-number"><span class="hljs-number">33</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)

  <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span>  t2&gt;<span class="hljs-number"><span class="hljs-number">26</span></span>:
  
        GPIO.output(<span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"open2"</span></span>)
        time.sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>)
        GPIO.output(<span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)
     

  <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"none2"</span></span>)


<span class="hljs-comment"><span class="hljs-comment">#  3 </span></span>
  time.sleep(<span class="hljs-number"><span class="hljs-number">180</span></span>)
</code></pre><br>
</div></div><br>
<br>
<b>     ,    .</b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir installé Apache sur la distribution Raspbian, nous n'avons pas pu accéder à la page depuis Internet pendant un mois. Ce qui n'a tout simplement pas fonctionné. Configurez les ports, ouvrez-les, rien n'y fait. De plus, tout fonctionnait sur le réseau local. Puis nous avons appris la triste vérité: nous sommes derrière NAT. Et notre opérateur ne fournit pas de services IP dédiés (Bonjour aux employés de la région Telecom). Trié par de nombreuses solutions de contournement, mais rien n'en est sorti. J'ai essayé de faire une interface web sur l'hébergement, mais j'ai également besoin d'IP pour synchroniser la base de données. Le courtier IPv6 avait déjà fermé à ce moment-là. Et faire un VPN coûte cher, car vous voulez tout gratuitement. Et puis ils ont décidé d'utiliser le bot Telegram. En fait, il a deux modes: l'interrogation constante du serveur et l'envoi direct de messages à nous. La première option était appropriée, car ne nécessite pas d'adresse IP. En fouillant sur Internet, j'ai trouvé une bibliothèque:pytelegrambotapi. Et commencer à écrire du code. Certes, il y avait des problèmes. La bibliothèque MySQL à peine trouvée a refusé d'écrire dans la base de données, mais a tout lu normalement. J'ai dû faire une béquille: transférer des données vers un fichier stocké dans la RAM, puis exécuter un script bash qui lit les données et les stocke dans la base de données.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous créons le fichier config.ini, nous le jetons là:</font></font><br>
<br>
<pre><code class="hljs pgsql">[mysql]<font></font>
host = localhost<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">database</span></span> = telegram
<span class="hljs-keyword"><span class="hljs-keyword">user</span></span> = root
<span class="hljs-keyword"><span class="hljs-keyword">password</span></span> = secret</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N'oubliez pas de remplacer les données par les vôtres. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Créez un fichier python_mysql_dbconfig.py avec le contenu suivant:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> configparser <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ConfigParser<font></font>
 <font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_db_config</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filename=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'config.ini'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, section=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'mysql'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span>
    <span class="hljs-string"><span class="hljs-string">""" Read database configuration file and return a dictionary object
    :param filename: name of the configuration file
    :param section: section of database configuration
    :return: a dictionary of database parameters
    """</span></span>
    <span class="hljs-comment"><span class="hljs-comment"># create parser and read ini configuration file</span></span><font></font>
    parser = ConfigParser()<font></font>
    parser.read(filename)<font></font>
 <font></font>
    <span class="hljs-comment"><span class="hljs-comment"># get section, default to mysql</span></span><font></font>
    db = {}<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> parser.has_section(section):<font></font>
        items = parser.items(section)<font></font>
        <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> items:<font></font>
            db[item[<span class="hljs-number"><span class="hljs-number">0</span></span>]] = item[<span class="hljs-number"><span class="hljs-number">1</span></span>]
    <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:
        <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> Exception(<span class="hljs-string"><span class="hljs-string">'{0} not found in the {1} file'</span></span>.format(section, filename))<font></font>
 <font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> db</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous devons également créer le fichier python_mysql_connect2.py, avec ce contenu:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> mysql.connector <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MySQLConnection, Error
<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> python_mysql_dbconfig <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> read_db_config<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>
    <span class="hljs-string"><span class="hljs-string">""" Connect to MySQL database """</span></span><font></font>
<font></font>
    db_config = read_db_config()<font></font>
<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>:<font></font>
        print(<span class="hljs-string"><span class="hljs-string">'Connecting to MySQL database...'</span></span>)<font></font>
        conn = MySQLConnection(**db_config)<font></font>
<font></font>
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> conn.is_connected():<font></font>
            print(<span class="hljs-string"><span class="hljs-string">'connection established.'</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:<font></font>
            print(<span class="hljs-string"><span class="hljs-string">'connection failed.'</span></span>)<font></font>
<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Error <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> error:<font></font>
        print(error)<font></font>
<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span>:<font></font>
        conn.close()<font></font>
        print(<span class="hljs-string"><span class="hljs-string">'Connection closed.'</span></span>)<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>:<font></font>
    connect()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons maintenant tout préparé pour travailler avec la base de données. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Écartons un peu de la base de données et passons directement à la communication avec le bot. </font><font style="vertical-align: inherit;">Eh bien, comme d'habitude, écrivez @BotFather et prenez-lui un jeton. </font><font style="vertical-align: inherit;">Créez le fichier config.py et écrivez-y deux lignes:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- coding: utf-8 -*-</span></span>
token = <span class="hljs-string"><span class="hljs-string">' '</span></span>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai décidé d'implémenter trois fonctions dans le bot:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtenir la température</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prendre des instantanés</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gestion des fenêtres</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Avec le premier, tout est simple, sur demande nous lisons le fichier de température, et l'envoyons à l'utilisateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec des photos plus difficiles. J'utilise l'utilitaire Motion. Dans ses paramètres, demandez à mettre des images dans un dossier en RAM, eh bien, disons toutes les 30 secondes. Et nous créons des fichiers avec des noms identiques, et ils se remplacent simplement les uns les autres. Et puis, sur demande, nous envoyons le fichier à l'utilisateur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, le troisième module, le plus complexe: la gestion des fenêtres. </font><font style="vertical-align: inherit;">Ma tâche principale: pour que l'automatisation fonctionne, mais si nécessaire, nous pouvons la désactiver. </font><font style="vertical-align: inherit;">Je l'ai fait comme ça. </font><font style="vertical-align: inherit;">Créé un autre fichier dans la RAM. </font><font style="vertical-align: inherit;">Lorsque nous envoyons une demande pour ouvrir / fermer, ouvrir légèrement, fermer la fenêtre ou activer / désactiver l'automatisation, le bot écrit le numéro de commande dans ce fichier. </font><font style="vertical-align: inherit;">Toutes les cinq secondes, le programme de gestion des fenêtres lit ce fichier et s’il reconnaît la commande, l’exécute. </font><font style="vertical-align: inherit;">Après exécution, il écrit dans le même fichier que tout s'est bien passé. </font><font style="vertical-align: inherit;">Le bot relit le fichier et nous informe que la commande est terminée. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, maintenant le code source. </font><font style="vertical-align: inherit;">Tout d'abord, le même programme d'ouverture de fenêtres, refait uniquement pour un bot (temp.py):</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">temp.py</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RPi.GPIO <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> GPIO
<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time
<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os
<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime

GPIO.setmode(GPIO.BOARD)
GPIO.cleanup()
GPIO.setup(<span class="hljs-number"><span class="hljs-number">31</span></span>, GPIO.OUT)
GPIO.setup(<span class="hljs-number"><span class="hljs-number">33</span></span>, GPIO.OUT)
GPIO.setup(<span class="hljs-number"><span class="hljs-number">35</span></span>, GPIO.OUT)
GPIO.setup(<span class="hljs-number"><span class="hljs-number">37</span></span>, GPIO.OUT)

<span class="hljs-comment"><span class="hljs-comment">#  ,    </span></span>
f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>)
f.write(<span class="hljs-string"><span class="hljs-string">'OK'</span></span>)
f.close()

<span class="hljs-comment"><span class="hljs-comment">#,   </span></span>
f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/pos'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>)
f.write(<span class="hljs-string"><span class="hljs-string">'1'</span></span>)
f.close()

<span class="hljs-comment"><span class="hljs-comment"># </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gettemp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> os.path.isdir(<span class="hljs-string"><span class="hljs-string">"/sys/bus/w1/devices/id "</span></span>): <span class="hljs-comment"><span class="hljs-comment">#  ,   </span></span>
    tfile2=open(<span class="hljs-string"><span class="hljs-string">"/sys/bus/w1/devices/id /w1_slave"</span></span>)
    ttext2=tfile2.read()
    tfile2.close()
    temp2=ttext2.split(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>].split(<span class="hljs-string"><span class="hljs-string">" "</span></span>)[<span class="hljs-number"><span class="hljs-number">9</span></span>]
    t2=float(temp2[<span class="hljs-number"><span class="hljs-number">2</span></span>:])/<span class="hljs-number"><span class="hljs-number">1000</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> t2
  <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-comment"><span class="hljs-comment"># ,   </span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">'File not found'</span></span>)
    t2==<span class="hljs-number"><span class="hljs-number">24</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> t2

<span class="hljs-comment"><span class="hljs-comment">#   </span></span>
i=<span class="hljs-number"><span class="hljs-number">1</span></span>
<span class="hljs-comment"><span class="hljs-comment"># </span></span>
t2=<span class="hljs-number"><span class="hljs-number">24</span></span>

<span class="hljs-comment"><span class="hljs-comment">#   </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">info</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>
    f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>)
    com = f.read()
    f.close()
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> com

<span class="hljs-comment"><span class="hljs-comment"># ,   </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ans</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>
    f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>)
    f.write(<span class="hljs-string"><span class="hljs-string">'OK'</span></span>)
    f.close()
    <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"OK"</span></span>)

<span class="hljs-comment"><span class="hljs-comment"># </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rob</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>
    c = info()
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> c==<span class="hljs-string"><span class="hljs-string">"10"</span></span>:
        GPIO.output(<span class="hljs-number"><span class="hljs-number">37</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"close1"</span></span>)
        time.sleep(<span class="hljs-number"><span class="hljs-number">3</span></span>)
        GPIO.output(<span class="hljs-number"><span class="hljs-number">37</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)
        ans()
    <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> c==<span class="hljs-string"><span class="hljs-string">"11"</span></span>:
        GPIO.output(<span class="hljs-number"><span class="hljs-number">35</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"open1"</span></span>)
        time.sleep(<span class="hljs-number"><span class="hljs-number">2</span></span>)
        GPIO.output(<span class="hljs-number"><span class="hljs-number">35</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)
        ans()
    <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> c==<span class="hljs-string"><span class="hljs-string">"12"</span></span>:
        GPIO.output(<span class="hljs-number"><span class="hljs-number">37</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"close1"</span></span>)
        time.sleep(<span class="hljs-number"><span class="hljs-number">3</span></span>)
        GPIO.output(<span class="hljs-number"><span class="hljs-number">37</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)
        ans()
    <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> c==<span class="hljs-string"><span class="hljs-string">"13"</span></span>:
        GPIO.output(<span class="hljs-number"><span class="hljs-number">35</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"open1"</span></span>)
        time.sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>)
        GPIO.output(<span class="hljs-number"><span class="hljs-number">35</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)
        ans()
    <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> c==<span class="hljs-string"><span class="hljs-string">"20"</span></span>:
        GPIO.output(<span class="hljs-number"><span class="hljs-number">33</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"close2"</span></span>)
        time.sleep(<span class="hljs-number"><span class="hljs-number">3</span></span>)
        GPIO.output(<span class="hljs-number"><span class="hljs-number">33</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)
        ans()
    <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> c==<span class="hljs-string"><span class="hljs-string">"21"</span></span>:
        GPIO.output(<span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"open2"</span></span>)
        time.sleep(<span class="hljs-number"><span class="hljs-number">3</span></span>)
        GPIO.output(<span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)
        ans()
    <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> c==<span class="hljs-string"><span class="hljs-string">"22"</span></span>:
        GPIO.output(<span class="hljs-number"><span class="hljs-number">33</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"close2"</span></span>)
        time.sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>)
        GPIO.output(<span class="hljs-number"><span class="hljs-number">33</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)
        ans()
    <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> c==<span class="hljs-string"><span class="hljs-string">"23"</span></span>:
        GPIO.output(<span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"open2"</span></span>)
        time.sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>)
        GPIO.output(<span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)
        ans()
    <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> c==<span class="hljs-string"><span class="hljs-string">"30"</span></span>:
        <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> i
        i=<span class="hljs-number"><span class="hljs-number">0</span></span>
        ans()
        f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/pos'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>)
        f.write(<span class="hljs-string"><span class="hljs-string">'0'</span></span>)
        f.close()
        print(<span class="hljs-string"><span class="hljs-string">'30'</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> i
        i=<span class="hljs-number"><span class="hljs-number">0</span></span>
        ans()
    <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> c==<span class="hljs-string"><span class="hljs-string">"31"</span></span>:
        f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/pos'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>)
        f.write(<span class="hljs-string"><span class="hljs-string">'1'</span></span>)
        f.close()
        print(<span class="hljs-string"><span class="hljs-string">'31'</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> i
        i=<span class="hljs-number"><span class="hljs-number">1</span></span>
        ans()
        
<span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>:

<span class="hljs-comment"><span class="hljs-comment">#   </span></span>
 rob()

<span class="hljs-comment"><span class="hljs-comment">#,   </span></span>
 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i==<span class="hljs-number"><span class="hljs-number">1</span></span>:

  gettemp()

  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>    t2&lt;<span class="hljs-number"><span class="hljs-number">24</span></span>:
 
        GPIO.output(<span class="hljs-number"><span class="hljs-number">37</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"close1"</span></span>)
        time.sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>)
        GPIO.output(<span class="hljs-number"><span class="hljs-number">37</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)

  <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span>  t2&gt;<span class="hljs-number"><span class="hljs-number">26</span></span>:

        GPIO.output(<span class="hljs-number"><span class="hljs-number">35</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"open1"</span></span>)
        time.sleep(<span class="hljs-number"><span class="hljs-number">2</span></span>)
        GPIO.output(<span class="hljs-number"><span class="hljs-number">35</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)

  <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"none1"</span></span>)
       
  <span class="hljs-comment"><span class="hljs-comment"># 3 ,       </span></span>
  j=<span class="hljs-number"><span class="hljs-number">0</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(j&lt;<span class="hljs-number"><span class="hljs-number">36</span></span>):
      rob()
      time.sleep(<span class="hljs-number"><span class="hljs-number">5</span></span>)
      j=j+<span class="hljs-number"><span class="hljs-number">1</span></span>
      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i==<span class="hljs-number"><span class="hljs-number">0</span></span>:
          <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>
  gettemp()

  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>    t2&lt;<span class="hljs-number"><span class="hljs-number">24</span></span>:
        GPIO.output(<span class="hljs-number"><span class="hljs-number">33</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"close2"</span></span>)
        time.sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>)
        GPIO.output(<span class="hljs-number"><span class="hljs-number">33</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)
       
  <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span>  t2&gt;<span class="hljs-number"><span class="hljs-number">26</span></span>:
  
        GPIO.output(<span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"open2"</span></span>)
        time.sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>)
        GPIO.output(<span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)

  <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:

        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"none2"</span></span>)

  j=<span class="hljs-number"><span class="hljs-number">0</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(j&lt;<span class="hljs-number"><span class="hljs-number">36</span></span>):
      rob()
      time.sleep(<span class="hljs-number"><span class="hljs-number">5</span></span>)
      j=j+<span class="hljs-number"><span class="hljs-number">1</span></span>
      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i==<span class="hljs-number"><span class="hljs-number">0</span></span>:
          <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>
</code></pre><br>
<br>
</div></div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais maintenant, parlons du bot lui-même. Comme je l'ai dit, j'utilise la bibliothèque PyTelegramBotApi. Si vous consultez la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentation sur GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , vous pouvez comprendre que le bot utilise des gestionnaires pour traiter les commandes. Le gestionnaire est un événement de notre programme qui définit une action. Dans notre cas, il s'agit d'une phrase spécifique dans le message. Et l'action est tout ce que nous pouvons faire en python. Dans ce cas, nous enverrons des informations à l'utilisateur ou nous écrirons des commandes pour Windows dans un fichier. Fondamentalement, notre programme se compose de ces mêmes gestionnaires et de la commande d'interrogation du serveur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais j'ai également écrit et ajouté une autre chose intéressante: le bloc d'autorisation. </font><font style="vertical-align: inherit;">Eh bien, comme son nom l'indique, il est fait pour protéger notre serre contre tout accès non autorisé. </font><font style="vertical-align: inherit;">Cela fonctionne simplement. </font><font style="vertical-align: inherit;">La première fois que vous vous connectez au bot, il nous demande un mot de passe. </font><font style="vertical-align: inherit;">Si nous le saisissons correctement, le bot nous ajoute à la base de données et lors des prochaines connexions, nous n'avons plus besoin de nous connecter. </font><font style="vertical-align: inherit;">Le bot nous reconnaît en utilisant chat-id. </font><font style="vertical-align: inherit;">Nous stockons le chat-id du dernier utilisateur dans une variable afin de ne pas tirer la base de données tout le temps. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Créez maintenant le fichier daba.py et écrivez ceci:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">daba.py</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> mysql.connector <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MySQLConnection, Error
<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> python_mysql_dbconfig <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> read_db_config
<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getkey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#   </span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>:
        dbconfig = read_db_config()
        conn = MySQLConnection(**dbconfig)
        cursor = conn.cursor()
        cursor.execute(<span class="hljs-string"><span class="hljs-string">"SELECT key2 FROM tkey where id=0"</span></span>)

        row = cursor.fetchone()

        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> row
        print(row)
  

    <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Error <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> e:
        print(e)

    <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span>:
        cursor.close()
        conn.close()
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#    ( )</span></span>
    stime=time.time()
    query = <span class="hljs-string"><span class="hljs-string">"INSERT INTO uptime(datetime, also) "</span></span> \
    <span class="hljs-string"><span class="hljs-string">"VALUES(now(), 20)"</span></span>
    args=(stime)
    <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>:
        dbconfig = read_db_config()
        conn = MySQLConnection(**dbconfig)
        cursor = conn.cursor()
        cursor.execute(query)

        row = cursor.fetchone()

        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(row)
        print(row)
  

    <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Error <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> e:
        print(e)

    <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span>:
        cursor.close()
        conn.close()
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(idi)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#   id   </span></span>
    query=<span class="hljs-string"><span class="hljs-string">"SELECT accecpt FROM users WHERE chatid ='"</span></span>+str(idi)+<span class="hljs-string"><span class="hljs-string">"'"</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>:
        dbconfig = read_db_config()
        conn = MySQLConnection(**dbconfig)
        cursor = conn.cursor()
        cursor.execute(query)

        row = cursor.fetchone()
        <span class="hljs-comment"><span class="hljs-comment">#print (str(row))</span></span>
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> str(row)==<span class="hljs-string"><span class="hljs-string">"None"</span></span>:
            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>;
            <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:
            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>;

  

    <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Error <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> e:
        print(e)

    <span class="hljs-comment"><span class="hljs-comment">#finally:</span></span>
        <span class="hljs-comment"><span class="hljs-comment">#cursor.close()</span></span>
        <span class="hljs-comment"><span class="hljs-comment">#conn.close()</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newuser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(idi)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#    </span></span>
    query = (<span class="hljs-string"><span class="hljs-string">"INSERT INTO users SET `chatid`='12345'"</span></span>)
    <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>:
        dbconfig = read_db_config()
        conn = MySQLConnection(**dbconfig)
        cursor = conn.cursor()
        cursor.execute(query)

        row = cursor.fetchone()

        print(row)
  

    <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Error <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> e:
        print(e)
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(e)

    <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span>:
        cursor.close()
        conn.close()

<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>:
    query_with_fetchone()
</code></pre><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aussi, faisons tout de suite quelques scripts d'aide. </font><font style="vertical-align: inherit;">Créez un fichier newuser.sh et écrivez-y:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta"><span class="hljs-meta">#!/bin/bash</span></span><font></font>
a=`cat /mnt/raw/user`<font></font>
cat /dev/null &gt; /mnt/raw/user<font></font>
<font></font>
mysql -u root -pkoshak &lt;&lt; EOF<font></font>
use telegram;<font></font>
INSERT INTO users(chatid) VALUES(<span class="hljs-string"><span class="hljs-string">'$a'</span></span>);<font></font>
EOF<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et créez deux scripts pour lancer le bot et le programme Windows:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta"><span class="hljs-meta">#!/bin/bash</span></span><font></font>
i=0<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">while</span></span> [ <span class="hljs-variable"><span class="hljs-variable">$i</span></span> = 0 ]
<span class="hljs-keyword"><span class="hljs-keyword">do</span></span>
<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> New python<font></font>
sleep 5<font></font>
python3 bot.py<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">done</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et encore un:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta"><span class="hljs-meta">#!/bin/bash</span></span><font></font>
i=0<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">while</span></span> [ <span class="hljs-variable"><span class="hljs-variable">$i</span></span> = 0 ]
<span class="hljs-keyword"><span class="hljs-keyword">do</span></span>
<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> New python<font></font>
sleep 5<font></font>
python3 temp.py<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">done</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 "Pourquoi faisons-nous cela?" </font><font style="vertical-align: inherit;">demandez-vous. </font><font style="vertical-align: inherit;">Et ici, le fait est que parfois en raison d'une connexion Internet instable ou d'une erreur sur le serveur Telegram, le programme peut se bloquer. </font><font style="vertical-align: inherit;">Et le script le conduit dans un cycle éternel: il a volé - il a recommencé après 5 secondes. </font><font style="vertical-align: inherit;">Et pour les fenêtres, je l'ai fait pour chaque pompier: soudain aussi, à cause d'un dysfonctionnement, le programme va planter, mais nous ne sommes pas dans la serre, nous reviendrons et nous aurons de la soupe de tomate ou de la glace à la tomate. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien et maintenant la chose la plus importante est le script du bot lui-même:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bot.py</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- coding: utf-8 -*-</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> config
<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> telebot
<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> subprocess
<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time
<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> telebot <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> types
<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime
<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os
<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> daba <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> getkey
<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> daba <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sendup
<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> daba <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> getid
<span class="hljs-comment"><span class="hljs-comment">#from daba import newuser</span></span>
<span class="hljs-comment"><span class="hljs-comment">#from temp import tep</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os

<span class="hljs-comment"><span class="hljs-comment"># </span></span>
f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/user'</span></span>, <span class="hljs-string"><span class="hljs-string">'tw'</span></span>, encoding=<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)
f.close()

<span class="hljs-keyword"><span class="hljs-keyword">global</span></span> par
par=<span class="hljs-number"><span class="hljs-number">0</span></span>

<span class="hljs-comment"><span class="hljs-comment">#   </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">global</span></span> a
a=<span class="hljs-string"><span class="hljs-string">"  .    /auth []"</span></span>

<span class="hljs-comment"><span class="hljs-comment">#  </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_temp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> os.path.isdir(<span class="hljs-string"><span class="hljs-string">"/sys/bus/w1/devices/id "</span></span>):

    tfile2=open(<span class="hljs-string"><span class="hljs-string">"/sys/bus/w1/devices/id /w1_slave"</span></span>)
    ttext2=tfile2.read()
    tfile2.close()
    temp2=ttext2.split(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>].split(<span class="hljs-string"><span class="hljs-string">" "</span></span>)[<span class="hljs-number"><span class="hljs-number">9</span></span>]
    t2=float(temp2[<span class="hljs-number"><span class="hljs-number">2</span></span>:])/<span class="hljs-number"><span class="hljs-number">1000</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> t2

  <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:
    <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">'File not found'</span></span>)
  
<span class="hljs-comment"><span class="hljs-comment">#</span></span>
keyword=str(getkey())[<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">-3</span></span>]

<span class="hljs-comment"><span class="hljs-comment"># </span></span>
bot = telebot.TeleBot(config.token)
<span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (sendup())
<span class="hljs-comment"><span class="hljs-comment">#  </span></span>

<span class="hljs-comment"><span class="hljs-comment">######################### ##########################################</span></span>
markup2 = types.ReplyKeyboardMarkup(row_width=<span class="hljs-number"><span class="hljs-number">1</span></span>, resize_keyboard=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-comment"><span class="hljs-comment">#, ,     </span></span>
markdown = types.ReplyKeyboardHide() <span class="hljs-comment"><span class="hljs-comment">#</span></span>
itembtn5 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">' '</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  5</span></span>
markup2.add(itembtn5) <span class="hljs-comment"><span class="hljs-comment">#   </span></span>
<span class="hljs-comment"><span class="hljs-comment">######################### ##########################################</span></span>


<span class="hljs-comment"><span class="hljs-comment">#########################  ##########################################</span></span>
markup = types.ReplyKeyboardMarkup(row_width=<span class="hljs-number"><span class="hljs-number">3</span></span>, resize_keyboard=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-comment"><span class="hljs-comment">#, ,     </span></span>
itembtn1 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'  '</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  1</span></span>
itembtn4 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'  '</span></span>)
itembtn2 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'  '</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  2</span></span>
markup.add(itembtn1, itembtn4, itembtn2) <span class="hljs-comment"><span class="hljs-comment">#   </span></span>
<span class="hljs-comment"><span class="hljs-comment">#########################  ##########################################</span></span>


<span class="hljs-comment"><span class="hljs-comment">######################### ##########################################</span></span>

markup3 = types.ReplyKeyboardMarkup(row_width=<span class="hljs-number"><span class="hljs-number">2</span></span>, resize_keyboard=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-comment"><span class="hljs-comment">#, ,     </span></span>
itembtn10 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'   '</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  10</span></span>
itembtn11 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'️  '</span></span>)
itembtn12 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">' '</span></span>)
markup3.add(itembtn10, itembtn11, itembtn12) <span class="hljs-comment"><span class="hljs-comment">#   </span></span>

markup4 = types.ReplyKeyboardMarkup(row_width=<span class="hljs-number"><span class="hljs-number">2</span></span>, resize_keyboard=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-comment"><span class="hljs-comment">#, ,     </span></span>
itembtn13 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'   '</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  13</span></span>
markup4.add(itembtn13, itembtn11, itembtn12) <span class="hljs-comment"><span class="hljs-comment">#   </span></span>

markup5 = types.ReplyKeyboardMarkup(row_width=<span class="hljs-number"><span class="hljs-number">2</span></span>, resize_keyboard=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-comment"><span class="hljs-comment">#, ,     </span></span>
itembtn14 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'  '</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  14</span></span>
itembtn15 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'  '</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  15</span></span>
itembtn16 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'️ '</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  16</span></span>
markup5.add(itembtn14, itembtn15, itembtn16) <span class="hljs-comment"><span class="hljs-comment">#   </span></span>

markup6 = types.ReplyKeyboardMarkup(row_width=<span class="hljs-number"><span class="hljs-number">2</span></span>, resize_keyboard=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-comment"><span class="hljs-comment">#, ,     </span></span>
itembtn17 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'️   '</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  17</span></span>
itembtn18 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'️   '</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  18</span></span>
itembtn19 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'   '</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  19</span></span>
itembtn20 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'   '</span></span>) <span class="hljs-comment"><span class="hljs-comment"># 20</span></span>
itembtn21 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'️ '</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  21</span></span>
markup6.add(itembtn17, itembtn18, itembtn19, itembtn20, itembtn21) <span class="hljs-comment"><span class="hljs-comment">#   </span></span>

markup7 = types.ReplyKeyboardMarkup(row_width=<span class="hljs-number"><span class="hljs-number">2</span></span>, resize_keyboard=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-comment"><span class="hljs-comment">#, ,     </span></span>
itembtn22 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'️   '</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  22</span></span>
itembtn23 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'️   '</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  23</span></span>
itembtn24 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'   '</span></span>) <span class="hljs-comment"><span class="hljs-comment"># 24</span></span>
itembtn25 = types.KeyboardButton(<span class="hljs-string"><span class="hljs-string">'   '</span></span>) <span class="hljs-comment"><span class="hljs-comment"># 25</span></span>
markup7.add(itembtn22, itembtn23, itembtn24, itembtn25, itembtn21) <span class="hljs-comment"><span class="hljs-comment">#   </span></span>
<span class="hljs-comment"><span class="hljs-comment">######################### ##########################################</span></span>
bot.send_message(<span class="hljs-number"><span class="hljs-number">45215125</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)<span class="hljs-comment"><span class="hljs-comment">#   chat-id</span></span>


    
<span class="hljs-comment"><span class="hljs-comment">#   </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>
    f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/pos'</span></span>)
    com = f.read()
    f.close()
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> com

<span class="hljs-comment"><span class="hljs-comment">#</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">avtor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(idi)</span></span></span><span class="hljs-function">:</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> par<span class="hljs-comment"><span class="hljs-comment">#      </span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> par==idi:
            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:<span class="hljs-comment"><span class="hljs-comment">#    ,    ,  0</span></span>
            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> getid(str(idi))==<span class="hljs-number"><span class="hljs-number">20</span></span>:
                par=idi<span class="hljs-comment"><span class="hljs-comment">#   </span></span>
                <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>
            <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:<span class="hljs-comment"><span class="hljs-comment">#     </span></span>
                bot.send_message(idi, <span class="hljs-string"><span class="hljs-string">"  .    /auth []"</span></span>, reply_markup=markup2)
                <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>    
        


<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(regexp=" ")</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">auth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
    bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">" /auth []"</span></span>)

<span class="hljs-comment"><span class="hljs-comment"># </span></span>
<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(commands=['auth'])</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> message.text[<span class="hljs-number"><span class="hljs-number">6</span></span>:]==keyword:<span class="hljs-comment"><span class="hljs-comment">#   </span></span>
      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> getid(str(message.chat.id))==<span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-comment"><span class="hljs-comment">#    ,         20</span></span>
        bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">"  "</span></span>)
      <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:
        <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> par
        bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">""</span></span>, reply_markup=markup)
        par=message.chat.id
        <span class="hljs-comment"><span class="hljs-comment"># chat-id   </span></span>
        f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/user'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>)
        f.write(str(message.chat.id))
        f.close()
        os.system(<span class="hljs-string"><span class="hljs-string">'newuser.sh'</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (message.chat.id)
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (par)
    <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:
        bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">""</span></span>)
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (keyword)
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (message.text[<span class="hljs-number"><span class="hljs-number">6</span></span>:])
        <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (message.chat.id)


<span class="hljs-comment"><span class="hljs-comment">#  /start</span></span>
<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(commands=['start'])</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
     <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> par
     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)!=<span class="hljs-number"><span class="hljs-number">0</span></span>:
         <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (par)
         bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">"   .    /auth []"</span></span>, reply_markup=markup2)
     <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:
	     bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">"   .  /help,  ,    ."</span></span>)



<span class="hljs-comment"><span class="hljs-comment">#   - /help</span></span>
<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(commands=['help'])</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">help</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>:
     mas=<span class="hljs-string"><span class="hljs-string">'       . \n    ,    :  \n   - /help \n       :)'</span></span>
     bot.send_message(message.chat.id, mas, reply_markup=markup)
     <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (message.chat.id, message.text)

	
 
<span class="hljs-comment"><span class="hljs-comment">#     </span></span>
<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(commands=['show'])</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>:
     mas=<span class="hljs-string"><span class="hljs-string">' '</span></span>
     bot.send_message(message.chat.id, mas, reply_markup=markup)
     <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (message.chat.id, message.text)



<span class="hljs-comment"><span class="hljs-comment"># </span></span>
<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(regexp="  ")</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">temp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>:
     tp=get_temp()
     mas=<span class="hljs-string"><span class="hljs-string">'    : '</span></span>+str(tp)+<span class="hljs-string"><span class="hljs-string">'°C'</span></span>
     bot.send_message(message.chat.id, mas)
     <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (message.chat.id, message.text)
    

<span class="hljs-comment"><span class="hljs-comment"># </span></span>
<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(regexp="  ")</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">photo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span> 
     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>: 
         path=<span class="hljs-string"><span class="hljs-string">'/mnt/raw/photo/foto.jpg'</span></span> <span class="hljs-comment"><span class="hljs-comment">#    </span></span>
         <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>:
             f = open(path, <span class="hljs-string"><span class="hljs-string">'rb'</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  - </span></span>
             bot.send_photo(message.chat.id, f) <span class="hljs-comment"><span class="hljs-comment"># </span></span>
             <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (message.chat.id, message.text)
         <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>:
             bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">"  :("</span></span>)


<span class="hljs-comment"><span class="hljs-comment">#   </span></span>
<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(regexp="  ")</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>:
       <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"window"</span></span>)
       <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (pos())
       <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> str(pos())[<span class="hljs-number"><span class="hljs-number">0</span></span>]==<span class="hljs-string"><span class="hljs-string">'1'</span></span>:
           bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">""</span></span>, reply_markup=markup3)<span class="hljs-comment"><span class="hljs-comment">#  ,      « »</span></span>
       <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: 
           bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">""</span></span>, reply_markup=markup4)<span class="hljs-comment"><span class="hljs-comment">#     </span></span>

<span class="hljs-comment"><span class="hljs-comment"># </span></span>
<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(regexp=" ")</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>:
       bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">""</span></span>,  reply_markup=markup)

<span class="hljs-comment"><span class="hljs-comment"># </span></span>
<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(regexp="   ")</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>:
       f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>)<span class="hljs-comment"><span class="hljs-comment"># </span></span>
       f.write(<span class="hljs-string"><span class="hljs-string">'30'</span></span>)<span class="hljs-comment"><span class="hljs-comment">#   ,     30</span></span>
       f.close()<span class="hljs-comment"><span class="hljs-comment"># </span></span>
       k=<span class="hljs-string"><span class="hljs-string">"No"</span></span><span class="hljs-comment"><span class="hljs-comment">#  </span></span>
       <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> k[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>]!=<span class="hljs-string"><span class="hljs-string">"OK"</span></span>:<span class="hljs-comment"><span class="hljs-comment">#  </span></span>
           time.sleep(<span class="hljs-number"><span class="hljs-number">5</span></span>)<span class="hljs-comment"><span class="hljs-comment"># 5 </span></span>
           f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>)<span class="hljs-comment"><span class="hljs-comment"># </span></span>
           k = f.read()<span class="hljs-comment"><span class="hljs-comment"># </span></span>
           f.close()<span class="hljs-comment"><span class="hljs-comment">#</span></span>
           print(k[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>])
       bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">""</span></span>,  reply_markup=markup4)

<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(regexp="   ")</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>:
       f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>)
       f.write(<span class="hljs-string"><span class="hljs-string">'31'</span></span>)
       f.close()
       k=<span class="hljs-string"><span class="hljs-string">"No"</span></span>
       <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> k[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>]!=<span class="hljs-string"><span class="hljs-string">"OK"</span></span>:
           time.sleep(<span class="hljs-number"><span class="hljs-number">5</span></span>)           
           f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>)
           k = f.read()
           f.close()
           print(k[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>])
       bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">""</span></span>,  reply_markup=markup3)

<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(regexp="️  ")</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>:
       bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">""</span></span>,  reply_markup=markup5)

<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(regexp="️ ")</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>:
       <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> str(pos())[<span class="hljs-number"><span class="hljs-number">0</span></span>]==<span class="hljs-string"><span class="hljs-string">'1'</span></span>:
           bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">""</span></span>, reply_markup=markup3)
       <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: 
           bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">""</span></span>, reply_markup=markup4)

<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(regexp="️ ")</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>:
       bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">""</span></span>,  reply_markup=markup5)

<span class="hljs-comment"><span class="hljs-comment">#  </span></span>
<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(regexp="  ")</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>:
       bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">""</span></span>,  reply_markup=markup6)
<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(regexp="  ")</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>:
       bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">""</span></span>,  reply_markup=markup7)

<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(regexp="️   ")</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>:
       f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>)
       f.write(<span class="hljs-string"><span class="hljs-string">'11'</span></span>)
       f.close()
       k=<span class="hljs-string"><span class="hljs-string">"No"</span></span>
       <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> k[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>]!=<span class="hljs-string"><span class="hljs-string">"OK"</span></span>:
           time.sleep(<span class="hljs-number"><span class="hljs-number">5</span></span>)           
           f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>)
           k = f.read()
           f.close()
           print(k[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>])
       bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">""</span></span>,  reply_markup=markup6)

<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(regexp="️   ")</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>:
       f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>)
       f.write(<span class="hljs-string"><span class="hljs-string">'10'</span></span>)
       f.close()
       k=<span class="hljs-string"><span class="hljs-string">"No"</span></span>
       <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> k[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>]!=<span class="hljs-string"><span class="hljs-string">"OK"</span></span>:
           time.sleep(<span class="hljs-number"><span class="hljs-number">5</span></span>)           
           f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>)
           k = f.read()
           f.close()
           print(k[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>])
       bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">""</span></span>,  reply_markup=markup6)

<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(regexp="   ")</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>:
       f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>)
       f.write(<span class="hljs-string"><span class="hljs-string">'13'</span></span>)
       f.close()
       k=<span class="hljs-string"><span class="hljs-string">"No"</span></span>
       <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> k[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>]!=<span class="hljs-string"><span class="hljs-string">"OK"</span></span>:
           time.sleep(<span class="hljs-number"><span class="hljs-number">5</span></span>)           
           f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>)
           k = f.read()
           f.close()
           print(k[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>])
       bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">""</span></span>,  reply_markup=markup6)

<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(regexp="   ")</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>:
       f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>)
       f.write(<span class="hljs-string"><span class="hljs-string">'12'</span></span>)
       f.close()
       k=<span class="hljs-string"><span class="hljs-string">"No"</span></span>
       <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> k[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>]!=<span class="hljs-string"><span class="hljs-string">"OK"</span></span>:
           time.sleep(<span class="hljs-number"><span class="hljs-number">5</span></span>)           
           f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>)
           k = f.read()
           f.close()
           print(k[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>])
       bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">""</span></span>,  reply_markup=markup6)

<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(regexp="️   ")</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>:
       f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>)
       f.write(<span class="hljs-string"><span class="hljs-string">'21'</span></span>)
       f.close()
       k=<span class="hljs-string"><span class="hljs-string">"No"</span></span>
       <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> k[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>]!=<span class="hljs-string"><span class="hljs-string">"OK"</span></span>:
           time.sleep(<span class="hljs-number"><span class="hljs-number">5</span></span>)           
           f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>)
           k = f.read()
           f.close()
           print(k[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>])
       bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">""</span></span>,  reply_markup=markup7)

<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(regexp="️   ")</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>:
       f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>)
       f.write(<span class="hljs-string"><span class="hljs-string">'20'</span></span>)
       f.close()
       k=<span class="hljs-string"><span class="hljs-string">"No"</span></span>
       <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> k[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>]!=<span class="hljs-string"><span class="hljs-string">"OK"</span></span>:
           time.sleep(<span class="hljs-number"><span class="hljs-number">5</span></span>)           
           f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>)
           k = f.read()
           f.close()
           print(k[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>])
       bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">""</span></span>,  reply_markup=markup7)

<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(regexp="   ")</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>:
       f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>)
       f.write(<span class="hljs-string"><span class="hljs-string">'23'</span></span>)
       f.close()
       k=<span class="hljs-string"><span class="hljs-string">"No"</span></span>
       <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> k[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>]!=<span class="hljs-string"><span class="hljs-string">"OK"</span></span>:
           time.sleep(<span class="hljs-number"><span class="hljs-number">5</span></span>)           
           f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>)
           k = f.read()
           f.close()
           print(k[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>])
       bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">""</span></span>,  reply_markup=markup7)

<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(regexp="   ")</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>:
       f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>)
       f.write(<span class="hljs-string"><span class="hljs-string">'22'</span></span>)
       f.close()
       k=<span class="hljs-string"><span class="hljs-string">"No"</span></span>
       <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> k[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>]!=<span class="hljs-string"><span class="hljs-string">"OK"</span></span>:
           time.sleep(<span class="hljs-number"><span class="hljs-number">5</span></span>)           
           f = open(<span class="hljs-string"><span class="hljs-string">'/mnt/raw/wind'</span></span>)
           k = f.read()
           f.close()
           print(k[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>])
       bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">""</span></span>,  reply_markup=markup7)

<span class="hljs-comment"><span class="hljs-comment">#  ,   </span></span>
<span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(content_types=["text"])</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">repeat_all_messages</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span>
   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> avtor(message.chat.id)==<span class="hljs-number"><span class="hljs-number">0</span></span>:
         bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">"    .  /help,    "</span></span>)
         <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (message.chat.id, message.text)

<span class="hljs-comment"><span class="hljs-comment">#     </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>:
        bot.polling()</code></pre><br>
<br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N'oubliez pas d'indiquer ici l'ID du capteur, le chat-id et le chemin d'accès à la section en RAM. </font><font style="vertical-align: inherit;">Maintenant, nous avons presque tout prêt. </font><font style="vertical-align: inherit;">Nous téléchargeons ce </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vidage</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , remplissons la base de données sur notre serveur, et n'oubliez pas de monter la partition en RAM, je pense que 10 Mo suffisent au cou. </font><font style="vertical-align: inherit;">Nous lançons deux de nos scripts de démarrage et nous nous réjouissons. </font><font style="vertical-align: inherit;">Le mot de passe par défaut est telbot. </font><font style="vertical-align: inherit;">Modifiez-le dans la table tkey de la base de données.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Information par SMS</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il en a été de même pour les SMS en cas de surchauffe. </font><font style="vertical-align: inherit;">Créez le fichier sms.py:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sms.py</font></font></b><div class="spoiler_text"><pre><code class="hljs python"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python</span></span>
<span class="hljs-comment"><span class="hljs-comment"># -*- coding: utf8 -*-</span></span>
 
<span class="hljs-string"><span class="hljs-string">"""   .. t_aleksandr_v@inbox.ru 17.02.2015 """</span></span>
 
<span class="hljs-string"><span class="hljs-string">"""        sms.ru """</span></span>
<span class="hljs-string"><span class="hljs-string">"""   :"""</span></span>
 
<span class="hljs-string"><span class="hljs-string">""" -i  --idsender - id   sms.ru"""</span></span>
<span class="hljs-string"><span class="hljs-string">""" -t  --to -      79219996660"""</span></span>
<span class="hljs-string"><span class="hljs-string">""" -s  --subject -    """</span></span>
 
 
<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> urllib2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> urlopen
<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> optparse <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> OptionParser
 
 
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendsms</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(idsender,subject,to)</span></span></span><span class="hljs-function">:</span></span>
 
    subject = subject.replace(<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">"+"</span></span>)
    url=<span class="hljs-string"><span class="hljs-string">"http://sms.ru/sms/send?api_id=%s&amp;text=%s&amp;to=%s"</span></span> %(idsender,subject,to)
    res=urlopen(url)
 
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>:
 
    parser = OptionParser()
 
    parser.add_option(<span class="hljs-string"><span class="hljs-string">"-i"</span></span>, <span class="hljs-string"><span class="hljs-string">"-- "</span></span>, dest=<span class="hljs-string"><span class="hljs-string">"idsender"</span></span>, default=<span class="hljs-string"><span class="hljs-string">" "</span></span>, help=<span class="hljs-string"><span class="hljs-string">"ID user on sms.ru"</span></span>, metavar=<span class="hljs-string"><span class="hljs-string">"IDSENDER"</span></span>)
    parser.add_option(<span class="hljs-string"><span class="hljs-string">"-t"</span></span>, <span class="hljs-string"><span class="hljs-string">"-- "</span></span>, dest=<span class="hljs-string"><span class="hljs-string">"to"</span></span>, default=<span class="hljs-string"><span class="hljs-string">" "</span></span>, help=<span class="hljs-string"><span class="hljs-string">"to telephone number"</span></span>, metavar=<span class="hljs-string"><span class="hljs-string">"TO"</span></span>)
    parser.add_option(<span class="hljs-string"><span class="hljs-string">"-s"</span></span>, <span class="hljs-string"><span class="hljs-string">"--temperatyra 32"</span></span>, dest=<span class="hljs-string"><span class="hljs-string">"subject"</span></span>, default=<span class="hljs-string"><span class="hljs-string">"Jara tut, otkroy okno"</span></span>, help=<span class="hljs-string"><span class="hljs-string">"Name of subject"</span></span>, metavar=<span class="hljs-string"><span class="hljs-string">"SUBJECT"</span></span>)
 
    (options, args) = parser.parse_args()
 
    sendsms(options.idsender,options.subject,options.to)</code></pre><br>
<br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous nous inscrivons sur sms.ru et y prenons la clé API dans la section pour les programmeurs. </font><font style="vertical-align: inherit;">N'oubliez pas non plus d'indiquer votre numéro de téléphone dans le script. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le programme de gestion des fenêtres, nous déclarons une variable:</font></font><br>
<br>
<pre><code class="hljs">Vr=0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Insérez ensuite ce code dans la boucle perpétuelle:</font></font><br>
<br>
<pre><code class="hljs pgsql">d = datetime.today()<font></font>
V = d.strftime(<span class="hljs-string"><span class="hljs-string">'%H'</span></span>)<font></font>
V = <span class="hljs-type"><span class="hljs-type">int</span></span>(V)
 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>    (t2&gt;<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> Vr!=V): <font></font>
        print (V)<font></font>
        Vr=V<font></font>
        os.<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>(<span class="hljs-string"><span class="hljs-string">'/home/samba/sms.py'</span></span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour le moment, la température seuil est de 32, un SMS sera envoyé en cas de température élevée une fois par heure, jusqu'à ce qu'elle baisse. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> prévoit pour l'avenir d'installer un chauffage contrôlé et d'arroser automatiquement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Merci à tous ceux qui ont lu jusqu'au bout.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr400499/">https://habr.com/ru/post/fr400499/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr400489/index.html">MediaTek présente le chipset MT2533D: la toute dernière technologie pour les casques, écouteurs et haut-parleurs intelligents</a></li>
<li><a href="../fr400491/index.html">Je déteste quand quelqu'un me traite</a></li>
<li><a href="../fr400493/index.html">A propos de l'utilisation du système cognitif IBM Watson Analytics pour analyser les données de performances cardiaques</a></li>
<li><a href="../fr400495/index.html">Le choix entre la programmation visuelle et textuelle pour les enfants</a></li>
<li><a href="../fr400497/index.html">L'onde dépasse l'horizon: la ligne de communication du relais radio troposphérique soviétique "Nord"</a></li>
<li><a href="../fr400501/index.html">Un astéroïde découvert il y a seulement deux jours a volé près de la Terre</a></li>
<li><a href="../fr400503/index.html">Blagues à huit bits 3</a></li>
<li><a href="../fr400505/index.html">Comment se lever et bâiller pour obtenir un investissement? Conseils du marché Jedi Venture</a></li>
<li><a href="../fr400507/index.html">Le Pentagone a testé avec succès un essaim de 103 drones</a></li>
<li><a href="../fr400509/index.html">Difficultés rencontrées dans la création de clubs de robotique</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>