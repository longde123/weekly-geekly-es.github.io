<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⚽️ 🛌🏻 🎨 "Gummi-Host-Suche in der Alibaba Cloud": Host-Elasticsearch in Alibaba Cloud-Einrichtungen ➗ 👨‍👩‍👦‍👦 😩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor einiger Zeit habe ich über unsere Erfahrungen bei der Lösung komplexer Probleme mit Elasticsearch gesprochen. Es war eine Geschichte über Wurst , ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>"Gummi-Host-Suche in der Alibaba Cloud": Host-Elasticsearch in Alibaba Cloud-Einrichtungen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420927/"><img src="https://habrastorage.org/webt/uq/9z/lr/uq9zlr4cxk0jr9im5sqmw5rbybo.jpeg"><br><br>  Vor einiger Zeit habe ich über unsere Erfahrungen bei der Lösung komplexer Probleme mit Elasticsearch gesprochen.  Es war eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Geschichte über Wurst</a> , in der wir eine Suche in einer Datenbank mit mindestens 50.000 Dokumenten entwickelt haben, mit der Sie nach Inhaltsstoffen in Produkten suchen und daraus automatisch Produktbeschreibungen erstellen können. <br><br>  Kürzlich kam ein interessantes Projekt in unser Unternehmen, das den Einsatz von Elasticsearch erforderte.  Dieses Mal standen wir vor der Aufgabe, ES für die Arbeit in der Anwendung auf der chinesischen Cloud-Plattform Alibaba Cloud bereitzustellen.  Hier stießen wir neben technischen Problemen auf so etwas Unerwartetes wie die chinesische Mentalität. <br><br>  Dieser Artikel konzentriert sich ausschließlich auf unsere persönlichen Erfahrungen mit Alibaba Cloud und nicht auf die Benutzeroberfläche oder Standardoptionen.  Ich werde Ihnen erzählen, was ich in der Kommunikation mit Vertretern der Elasticsearch- und Alibaba Cloud-Plattformen herausgefunden habe und wie wir es zur Lösung unseres Problems verwendet haben. <br><a name="habracut"></a><br><h3>  Schaukel nach China </h3><br>  Zu Beginn des Projekts gab der Kunde bekannt, dass der erste Start der Anwendung in China erfolgen wird.  Dies erschwerte die Aufgabe erheblich: Das chinesische Recht bereitet Entwicklern und Website-Eigentümern erhebliche Unannehmlichkeiten.  Der bloße Erhalt einer Domain aufgrund lokaler Bürokratie dauert drei Monate.  Aber was ist, wenn Sie eine Anwendung außerhalb Chinas hosten?  - Du fragst.  Und als Antwort wünsche ich Ihnen viel Glück beim Start in der chinesischen Zone, denn solche Tricks sind dort praktisch illegal. <br><br>  Wir erhielten Zugriff auf den Client-Server in der Alibaba Cloud und wurden gebeten, Docker-Container mit der Anwendung darauf bereitzustellen.  Dies war das erste, aber nicht das Hauptproblem.  Wir haben die Zugriffe vom Container an das Dateisystem weitergeleitet, um auf Serverebene auf die Projektdateien zugreifen zu können, und hier bestand das Problem darin, dass auf dem Server selbst nichts anderes als Docker vorhanden war: weder Git noch Nginx oder PHP.  Alles wurde auf Containerebene erledigt, und der Server war nur ein Data Warehouse.  Aus einem einfachen Git-Pull wurde daher Folgendes: <br><br><pre><code class="hljs perl">docker <span class="hljs-keyword"><span class="hljs-keyword">exec</span></span> -it b33aee747c5e git pull</code> </pre> <br>  Aus diesem Grund mussten wir für jeden Container ein Bash-Skript mit dem Namen git schreiben: <br><br><pre> <code class="hljs powershell">docker exec <span class="hljs-literal"><span class="hljs-literal">-it</span></span> b33aee747c5e git <span class="hljs-variable"><span class="hljs-variable">$</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">@</span></span></code> </pre> <br>  Außerdem wurde das Abenteuer nur noch komplizierter: Wir mussten die ES irgendwie darauf installieren.  Über die Alibaba Cloud Management Console haben wir das Elasticsearch 6.0.0-Image installiert und ... <br>  ... und nach einiger Zeit fingen sie an, Fehler zu fangen.  Entweder schwört das X-Pack-Zugriffskontrollsystem, dass nach 28 Tagen die Lizenz abläuft, und der Arbeitsspeicher endet, wenn etwa 500 Dokumente indiziert sind.  Nicht "aufgestiegen". <br><br><h3>  Laovai Probleme </h3><br>  Die ganze Zeit dachten wir, dass der Grund für den Fehler das X-Pack war, dass er es war, der uns daran hinderte, normal zu arbeiten. <br><br>  "Nun, was können wir tun", sagte der Kunde, nachdem er unsere Version angehört hatte.  - Also werden wir eine X-Pack Lizenz kaufen.  Schreiben Sie an Elasticsearch, vielleicht raten sie selbst etwas. "  Ich schrieb an den Kontodienst, und der Berater des niederländischen Büros, Driton Khalili, antwortete mir (wenn Sie zufällig mit ihm zusammenarbeiten, sagen Sie mir Hallo, er ist cool).  Ja, Osteuropa und Russland haben ein niederländisches Büro, in dem die Türken arbeiten. <br><br>  Der Berater erzählte mir von dem X-Pack-Lizenzzahlungssystem und fragte, wo wir hosten. <br>  In China antwortete ich. <br><br>  "Das ist ein Problem", sagte er.  - Ihr Kunde muss an unsere chinesische Niederlassung schreiben, um ihm bei diesem Problem zu helfen. <br>  - Gibt es noch andere Möglichkeiten?  Ich fragte. <br>  - Wenden Sie sich an Alibaba Cloud.  Tatsache ist, dass wir kürzlich eine Partnerschaftsvereinbarung mit ihnen geschlossen haben und sie nun Elasticsearch als Service anbieten. <br>  "Also hosten wir sie", sagte ich. <br>  - Warum quälst du dich dann mit dem Container, anstatt ihn direkt zu nehmen ?! <br>  Nachdem ich das Gespräch beendet habe, erzähle ich dem Kunden alles nach. <br>  - Ich meine - hat Alibaba Elasticsearch als Service ?!  - Die Empörung des Klienten kannte keine Grenzen.  Danach sprach er mit den „chinesischen Kollegen“ und sagte am nächsten Tag Folgendes: <br>  - Diese Leute sagten, ich sei "liebevoll", und aus meiner "liebevollen" Rechnung sollte ich keine Elasticsearch haben. <br>  Es ist nicht schwer zu erraten, dass Laovianer die Ausländer die Chinesen nennen und dieses Wort oft mit einer abweisenden Konnotation verwenden.  Wir können sagen, dass dies die Chinesen sind, "die in großer Zahl kommen". <br>  - Sie haben dort Puer getrunken, oder was? <br>  - Ich weiß nichts über Puer, aber nach meiner inspirierenden Rede, dass sie etwas falsch sind und für die ich ihnen überhaupt Geld bezahle, gaben sie mir einen "geheimen" Link zu Elasticsearch, der jetzt in unserer Cloud-Konsole angezeigt wird.  Richten Sie ein und wir werden umziehen. <br><br><h3>  Was tun, um "abzuheben"? </h3><br>  Drei Wochen später wurde im Menü der Steuerkonsole (im Abschnitt DTplus ganz unten) ein Link zur Alibaba Cloud Elasticsearch angezeigt. <br><br><img src="https://habrastorage.org/webt/k6/-d/nl/k6-dnlxehlliuqjxg1yvtjuxnks.png"><br><br>  Daraus können wir schließen, dass Sie, wenn die Chinesen Ihnen dennoch einen Link geben, eine Weile auf den Zugriff warten müssen (ich kann nicht sicher sagen, welchen Preis dies meiner Meinung nach die Kosten für das Abonnement für uns nicht erhöht hat). <br><br>  Und noch etwas: Natürlich erhalten Sie Zugriff auf die Einstellungen, eine normale URL, Kibana zur Überwachung.  Nur wenn Sie versuchen, ES von einem anderen Ort aus zu erreichen, erhalten Sie 505. <br><br>  Wie habe ich dieses Problem gelöst? <br><br>  Standardmäßig kann auf Elasticsearch von Alibaba Cloud Console nur von Kibana aus zugegriffen werden, und Proxy-Anrufe von dort an 127.0.0.1 auf dem Server, auf dem sich ES befindet.  Dann dachte ich: Welche IP-Adressen haben wir zwischen den Containern?  Ich ging in die Einstellungen und sah, dass wir uns alle in einem ziemlich vertrauten Subnetz 192.168.0 drehen. *.  Ich war mir nicht ganz sicher, also schrieb ich mir noch ein paar Adressen, falls ich nicht "hochfliegen" sollte. <br><br>  Ich dachte auch darüber nach, was passieren würde, wenn ich selbst Anfragen von meiner Workstation an ES senden müsste, und schrieb meine IP-Adresse auf ein Blatt Papier. <br><br>  Führen Sie als Nächstes die folgenden Schritte aus. <br><br>  Gehen Sie zur Alibaba Cloud Console und öffnen Sie Cluster -&gt; Verwalten -&gt; Netzwerk und Snapshots -&gt; Cluster-Netzwerkeinstellungen -&gt; Whitelist für öffentliche IP-Adressen -&gt; Aktualisieren.  Und wir speichern hier alle Adressen, die nützlich sind - sowohl persönliche als auch öffentliche.  Danach können Sie ES bereits sowohl aus Containern mit der Anwendung als auch von anderen Stellen aus bearbeiten und an ES klopfen. <br><br><img src="https://habrastorage.org/webt/ho/mi/gu/homigujirp4lwf6xh9vptwfbmnm.png"><br><br>  Der Umzug dauerte weniger als zwei Stunden.  Zwar war ich eine weitere Woche lang paranoid darüber, dass alles fallen könnte, aber bisher ist nichts gefallen.  Seit drei Monaten ist es nie gefallen. <br><br>  Insgesamt haben wir ungefähr drei Wochen lang versucht, ein Problem zu lösen, das es nicht gibt.  Es ist nur so, dass die Chinesen sehr gerissen sind und keinem „Laov“ Zugang zu ihren Diensten gewähren wollen.  Für eine Person mit unserer oder westlicher Mentalität ist dies seltsam, wir haben uns jedoch mit diesem Problem befasst, und es war eine ziemlich interessante Erfahrung. <br><br>  Vielen Dank für Ihre Aufmerksamkeit! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de420927/">https://habr.com/ru/post/de420927/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de420909/index.html">Russische Fernsehunternehmen werfen Yandex Piraterie vor</a></li>
<li><a href="../de420913/index.html">Führen Sie Kubernetes in LXC aus</a></li>
<li><a href="../de420915/index.html">RFM-Analyse mit einem Klick oder wie wir unseren Kunden das Leben leichter gemacht haben</a></li>
<li><a href="../de420919/index.html">Animierte Zahlen auf Android</a></li>
<li><a href="../de420923/index.html">Meta-Fähigkeiten von Softwareentwicklern</a></li>
<li><a href="../de420929/index.html">Ausführen, testen, ausführen. Apropos Mobile Testing Meetup</a></li>
<li><a href="../de420931/index.html">Wie man Kernkraftwerke testet</a></li>
<li><a href="../de420935/index.html">Alles, was Sie über die Ausrichtung in Flexbox wissen müssen</a></li>
<li><a href="../de420937/index.html">Über tragen SSD an realen Beispielen</a></li>
<li><a href="../de420939/index.html">Eine Geschichte über das Karrierewachstum oder warum ich mich als guten Manager betrachte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>