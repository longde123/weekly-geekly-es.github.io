<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßôüèº üë©üèø‚Äçüíª üí∫ ModelMapper: pulang pergi üëâ üëáüèæ üë©üèø‚Äçüíº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Untuk alasan yang sudah diketahui, backend tidak dapat mengembalikan data dari repositori apa adanya. Yang paling terkenal - ketergantungan esensial t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ModelMapper: pulang pergi</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438808/"><img src="https://habrastorage.org/webt/pv/af/jp/pvafjpvwzjks_dgn_429dotjm5g.jpeg" alt="gambar"><br><br>  Untuk alasan yang sudah diketahui, backend tidak dapat mengembalikan data dari repositori apa adanya.  Yang paling terkenal - ketergantungan esensial tidak diambil dari dasar dalam bentuk di mana bagian depan dapat memahaminya.  Di sini Anda dapat menambahkan kesulitan dengan parsing enum (jika bidang enum berisi parameter tambahan), dan banyak kesulitan lain yang timbul dari casting tipe otomatis (atau ketidakmampuan untuk secara otomatis melemparkannya).  Ini menyiratkan kebutuhan untuk menggunakan Obyek Transfer Data - DTO, yang dapat dimengerti untuk bagian belakang dan depan. <a name="habracut"></a><br>  Mengkonversi entitas ke DTO dapat dilakukan dengan berbagai cara.  Anda dapat menggunakan perpustakaan, Anda dapat (jika proyek ini kecil) mengumpulkan sesuatu seperti ini: <br><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ItemMapperImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ItemMapper</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> OrderRepository orderRepository; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ItemMapperImpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(OrderRepository orderRepository)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.orderRepository = orderRepository; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Item </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toEntity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ItemDto dto)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Item( dto.getId(), obtainOrder(dto.getOrderId()), dto.getArticle(), dto.getName(), dto.getDisplayName(), dto.getWeight(), dto.getCost(), dto.getEstimatedCost(), dto.getQuantity(), dto.getBarcode(), dto.getType() ); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ItemDto </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDto</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Item item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ItemDto( item.getId(), obtainOrderId(item), item.getArticle(), item.getName(), item.getDisplayName(), item.getWeight(), item.getCost(), item.getEstimatedCost(), item.getQuantity(), item.getBarcode(), item.getType() ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Long </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">obtainOrderId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Item item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Objects.nonNull(item.getOrder()) ? item.getOrder().getId() : <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Order </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">obtainOrder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long orderId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Objects.nonNull(orderId) ? orderRepository.findById(orderId).orElse(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) : <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } }</code> </pre> <br>  Pemetaan yang ditulis sendiri semacam itu memiliki kelemahan yang jelas: <br><br><ol><li>  Jangan mengukur. </li><li>  Saat menambahkan / menghapus bahkan bidang yang paling tidak penting, Anda harus mengedit mapper. </li></ol><br>  Oleh karena itu, solusi yang benar adalah dengan menggunakan pustaka mapper.  Saya tahu modelmapper dan mapstruct.  Karena saya bekerja dengan modelmapper, saya akan membicarakannya, tetapi jika Anda, pembaca saya, sangat mengenal mapstruct dan dapat mengetahui semua seluk beluk aplikasinya, silakan tulis artikel tentang itu, dan saya akan menjadi orang pertama yang menulisnya kepada saya (perpustakaan ini juga sangat menarik, tetapi belum ada waktu untuk memasukinya). <br><br>  Jadi modelmapper. <br><br>  Saya ingin segera mengatakan bahwa jika ada sesuatu yang tidak jelas bagi Anda, Anda dapat mengunduh proyek yang sudah selesai dengan tes yang berfungsi, tautan di akhir artikel. <br><br>  Langkah pertama, tentu saja, menambahkan ketergantungan.  Saya menggunakan gradle, tetapi mudah bagi Anda untuk menambahkan ketergantungan pada proyek pakar Anda. <br><br><pre> <code class="java hljs">compile group: <span class="hljs-string"><span class="hljs-string">'org.modelmapper'</span></span>, name: <span class="hljs-string"><span class="hljs-string">'modelmapper'</span></span>, version: <span class="hljs-string"><span class="hljs-string">'2.3.2'</span></span></code> </pre> <br>  Ini sudah cukup bagi mapper untuk bekerja.  Selanjutnya, kita perlu membuat bin. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ModelMapper </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">modelMapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ModelMapper mapper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ModelMapper(); mapper.getConfiguration() .setMatchingStrategy(MatchingStrategies.STRICT) .setFieldMatchingEnabled(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) .setSkipNullEnabled(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) .setFieldAccessLevel(PRIVATE); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mapper; }</code> </pre> <br>  Biasanya cukup dengan mengembalikan ModelMapper baru, tetapi tidak akan terlalu berlebihan untuk mengkonfigurasi mapper untuk kebutuhan kita.  Saya menetapkan strategi pencocokan ketat, mengaktifkan pemetaan bidang, melewatkan bidang nol, dan mengatur tingkat akses pribadi ke bidang tersebut. <br><br>  Selanjutnya, buat struktur entitas berikut.  Kami akan memiliki Unicorn, yang akan memiliki sejumlah droid dalam pengajuannya, dan setiap droid akan memiliki jumlah Cupcakes tertentu. <br><br><div class="spoiler">  <b class="spoiler_title">Entitas</b> <div class="spoiler_text"><blockquote>  Induk abstrak: </blockquote><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@MappedSuperclass</span></span> <span class="hljs-meta"><span class="hljs-meta">@Setter</span></span> <span class="hljs-meta"><span class="hljs-meta">@EqualsAndHashCode</span></span> <span class="hljs-meta"><span class="hljs-meta">@NoArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractEntity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ Long id; LocalDateTime created; LocalDateTime updated; <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Long </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id; } <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"created"</span></span>, updatable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> LocalDateTime </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCreated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> created; } <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"updated"</span></span>, insertable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> LocalDateTime </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUpdated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> updated; } <span class="hljs-meta"><span class="hljs-meta">@PrePersist</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ setCreated(LocalDateTime.now()); } <span class="hljs-meta"><span class="hljs-meta">@PreUpdate</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ setUpdated(LocalDateTime.now()); } }</code> </pre> <br><blockquote>  Unicorn: </blockquote><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"unicorns"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@EqualsAndHashCode</span></span>(callSuper = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Setter</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@NoArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Unicorn</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractEntity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Droid&gt; droids; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Color color; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Unicorn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name, Color color)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.color = color; } <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"name"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name; } <span class="hljs-meta"><span class="hljs-meta">@OneToMany</span></span>(fetch = FetchType.EAGER, cascade = CascadeType.ALL, mappedBy = <span class="hljs-string"><span class="hljs-string">"unicorn"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Droid&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDroids</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> droids; } <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"color"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Color </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getColor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> color; } }</code> </pre> <br><blockquote>  Droid: </blockquote><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Setter</span></span> <span class="hljs-meta"><span class="hljs-meta">@EqualsAndHashCode</span></span>(callSuper = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"droids"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@NoArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Droid</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractEntity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Unicorn unicorn; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Cupcake&gt; cupcakes; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Boolean alive; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Droid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name, Unicorn unicorn, Boolean alive)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.unicorn = unicorn; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.alive = alive; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Droid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name, Boolean alive)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.alive = alive; } <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"name"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name; } <span class="hljs-meta"><span class="hljs-meta">@ManyToOne</span></span>(fetch = FetchType.EAGER) <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"unicorn_id"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Unicorn </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUnicorn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> unicorn; } <span class="hljs-meta"><span class="hljs-meta">@OneToMany</span></span>(fetch = FetchType.EAGER, cascade = CascadeType.ALL, mappedBy = <span class="hljs-string"><span class="hljs-string">"droid"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Cupcake&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCupcakes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cupcakes; } <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"alive"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAlive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> alive; } }</code> </pre> <br><blockquote>  Cupcake: </blockquote><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"cupcakes"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Setter</span></span> <span class="hljs-meta"><span class="hljs-meta">@EqualsAndHashCode</span></span>(callSuper = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@NoArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cupcake</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractEntity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Filling filling; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Droid droid; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"filling"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Filling </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFilling</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> filling; } <span class="hljs-meta"><span class="hljs-meta">@ManyToOne</span></span>(fetch = FetchType.EAGER) <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"droid_id"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Droid </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDroid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> droid; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Cupcake</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Filling filling)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filling = filling; } }</code> </pre> <br></div></div><br>  Kami akan mengonversi entitas ini ke DTO.  Setidaknya ada dua pendekatan untuk mengubah dependensi dari entitas ke DTO.  Satu menyiratkan hanya menyimpan ID bukan entitas, tetapi kemudian setiap entitas dari ketergantungan, jika perlu, kami akan menarik ID tambahan.  Pendekatan kedua melibatkan menjaga ketergantungan DTO.  Jadi, dalam pendekatan pertama, kami akan mengonversi Daftar droid menjadi Daftar droid (kami hanya menyimpan ID di daftar baru), dan dalam pendekatan kedua, kami akan menyimpan dalam Daftar droid. <br><br><div class="spoiler">  <b class="spoiler_title">DTO</b> <div class="spoiler_text"><blockquote>  Induk abstrak: </blockquote><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractDto</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id; <span class="hljs-meta"><span class="hljs-meta">@JsonFormat</span></span>(shape = JsonFormat.Shape.STRING, pattern = <span class="hljs-string"><span class="hljs-string">"yyyy-MM-dd HH:mm:ss.SSS"</span></span>) LocalDateTime created; <span class="hljs-meta"><span class="hljs-meta">@JsonFormat</span></span>(shape = JsonFormat.Shape.STRING, pattern = <span class="hljs-string"><span class="hljs-string">"yyyy-MM-dd HH:mm:ss.SSS"</span></span>) LocalDateTime updated; }</code> </pre> <br><blockquote>  Unicorn: </blockquote><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@EqualsAndHashCode</span></span>(callSuper = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-meta"><span class="hljs-meta">@NoArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UnicornDto</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractDto</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;DroidDto&gt; droids; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String color; }</code> </pre> <br><blockquote>  DroidDto: </blockquote><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@EqualsAndHashCode</span></span>(callSuper = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-meta"><span class="hljs-meta">@NoArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DroidDto</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractDto</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;CupcakeDto&gt; cupcakes; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> UnicornDto unicorn; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Boolean alive; }</code> </pre> <br><blockquote>  CupcakeUntuk: </blockquote><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@EqualsAndHashCode</span></span>(callSuper = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-meta"><span class="hljs-meta">@NoArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CupcakeDto</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractDto</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String filling; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> DroidDto droid; }</code> </pre> <br></div></div><br>  Untuk menyesuaikan mapper dengan kebutuhan kita, kita perlu membuat kelas wrapper kita sendiri dan mendefinisikan kembali logika untuk memetakan koleksi.  Untuk melakukan ini, kita membuat kelas komponen UnicornMapper, memetakan mapper kita secara otomatis di sana dan mendefinisikan kembali metode yang kita butuhkan. <br><br>  Versi kelas pembungkus yang paling sederhana terlihat seperti ini: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UnicornMapper</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ModelMapper mapper; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Unicorn </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toEntity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UnicornDto dto)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Objects.isNull(dto) ? <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> : mapper.map(dto, Unicorn.class); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UnicornDto </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDto</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Unicorn entity)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Objects.isNull(entity) ? <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> : mapper.map(entity, UnicornDto.class); } }</code> </pre> <br>  Sekarang cukup bagi kita untuk autowire mapper kita ke beberapa layanan dan menarik menggunakan metode toDto dan toEntity.  Mapper akan mengubah entitas yang ditemukan di objek menjadi DTO, DTO - menjadi entitas. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Service</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UnicornServiceImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UnicornService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> UnicornRepository repository; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> UnicornMapper mapper; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UnicornServiceImpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UnicornRepository repository, UnicornMapper mapper)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.repository = repository; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mapper = mapper; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UnicornDto </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UnicornDto dto)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mapper.toDto(repository.save(mapper.toEntity(dto))); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UnicornDto </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mapper.toDto(repository.getOne(id)); } }</code> </pre> <br>  Tetapi jika kita mencoba mengonversi sesuatu dengan cara ini, dan memanggil, misalnya, ke Strtring, maka kita akan mendapatkan StackOverflowException, dan inilah alasannya: UnicornDto berisi daftar DroidDto, yang berisi UnicornDto, yang berisi DroidDto, dan seterusnya hingga saat itu sampai memori tumpukan habis.  Oleh karena itu, untuk dependensi terbalik, saya biasanya menggunakan unicorn UnicornDto, tetapi Long unicornId.  Dengan cara ini, kami tetap berhubungan dengan Unicorn, tetapi memotong ketergantungan siklik.  Mari kita perbaiki DTO kita sehingga alih-alih membalikkan DTO, mereka menyimpan ID dependensi mereka. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@EqualsAndHashCode</span></span>(callSuper = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-meta"><span class="hljs-meta">@NoArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DroidDto</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractDto</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-comment"><span class="hljs-comment">//private UnicornDto unicorn; private Long unicornId; ... }</span></span></code> </pre> <br>  dan sebagainya. <br><br>  Tetapi sekarang, jika kita memanggil DroidMapper, kita mendapatkan unicornId == null.  Ini karena ModelMapper tidak dapat menentukan dengan tepat Long.  Dan itu tidak mengganggunya.  Dan kita harus mengatur pembuat peta yang diperlukan untuk mengajari mereka cara memetakan entitas dalam ID. <br><br>  Kami ingat bahwa dengan setiap nampan setelah inisialisasi, Anda dapat bekerja secara manual. <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@PostConstruct</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupMapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mapper.createTypeMap(Droid.class, DroidDto.class) .addMappings(m -&gt; m.skip(DroidDto::setUnicornId)).setPostConverter(toDtoConverter()); mapper.createTypeMap(DroidDto.class, Droid.class) .addMappings(m -&gt; m.skip(Droid::setUnicorn)).setPostConverter(toEntityConverter()); }</code> </pre> <br>  Di @PostConstruct kita akan menetapkan aturan di mana kita menunjukkan bidang mana yang tidak boleh disentuh oleh mapper, karena bagi mereka kita akan menentukan logika sendiri.  Dalam kasus kami, ini adalah definisi unicornId di DTO dan definisi Unicorn pada intinya (karena mapper juga tidak tahu apa yang harus dilakukan dengan Long unicornId). <br><br>  TypeMap - ini adalah aturan di mana kami menentukan semua nuansa pemetaan, dan juga, mengatur konverter.  Kami menunjukkan bahwa untuk mengkonversi dari Droid ke DroidDto, kami melewatkan setUnicornId, dan dalam konversi terbalik, kami melewati setUnicorn.  Kita semua akan mengonversi di toDtoConverter () converter untuk UnicornDto dan toEntityConverter () untuk Unicorn.  Kita harus menggambarkan konverter ini di komponen kami. <br><br>  Post-converter yang paling sederhana terlihat seperti ini: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-function">Converter&lt;UnicornDto, Unicorn&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toEntityConverter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MappingContext::getDestination; }</code> </pre> <br>  Kami perlu memperluas fungsinya: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Converter&lt;UnicornDto, Unicorn&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toEntityConverter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context -&gt; { UnicornDto source = context.getSource(); Unicorn destination = context.getDestination(); mapSpecificFields(source, destination); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context.getDestination(); }; }</code> </pre> <br>  Kami melakukan hal yang sama dengan konverter terbalik: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Converter&lt;Unicorn, UnicornDto&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDtoConverter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context -&gt; { Unicorn source = context.getSource(); UnicornDto destination = context.getDestination(); mapSpecificFields(source, destination); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context.getDestination(); }; }</code> </pre> <br>  Bahkan, kami cukup memasukkan metode tambahan ke setiap post-converter, di mana kami menulis logika kami sendiri untuk bidang yang hilang. <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapSpecificFields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Droid source, DroidDto destination)</span></span></span><span class="hljs-function"> </span></span>{ destination.setUnicornId(Objects.isNull(source) || Objects.isNull(source.getId()) ? <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> : source.getUnicorn().getId()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapSpecificFields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DroidDto source, Droid destination)</span></span></span><span class="hljs-function"> </span></span>{ destination.setUnicorn(unicornRepository.findById(source.getUnicornId()).orElse(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)); }</code> </pre> <br>  Saat memetakan di DTO, kami menetapkan ID entitas.  Saat memetakan di DTO, kami mendapatkan entitas dari repositori dengan ID. <br><br>  Dan itu dia. <br><br>  Saya menunjukkan minimum yang diperlukan untuk mulai bekerja dengan modelmapper dan tidak secara khusus memperbaiki kode.  Jika Anda, pembaca, memiliki sesuatu untuk ditambahkan ke artikel saya, saya akan senang mendengar kritik yang membangun. <br><br>  Proyek ini dapat dilihat di sini: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Proyek di GitHub.</a> <br><br>  Penggemar kode bersih mungkin sudah melihat peluang untuk mengarahkan banyak komponen kode ke dalam abstraksi.  Jika Anda salah satunya, saya sarankan di bawah kucing. <br><br><div class="spoiler">  <b class="spoiler_title">Naikkan tingkat abstraksi</b> <div class="spoiler_text">  Untuk memulainya, kita mendefinisikan antarmuka untuk metode dasar kelas wrapper. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mapper</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">E</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractEntity</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">D</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractDto</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-function">E </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toEntity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(D dto)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">D </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDto</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(E entity)</span></span></span></span>; }</code> </pre> <br>  Kami mewarisinya dari kelas abstrak. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractMapper</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">E</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractEntity</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">D</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractDto</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mapper</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">E</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">D</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> ModelMapper mapper; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Class&lt;E&gt; entityClass; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Class&lt;D&gt; dtoClass; AbstractMapper(Class&lt;E&gt; entityClass, Class&lt;D&gt; dtoClass) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.entityClass = entityClass; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dtoClass = dtoClass; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> E </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toEntity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(D dto)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Objects.isNull(dto) ? <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> : mapper.map(dto, entityClass); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> D </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDto</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(E entity)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Objects.isNull(entity) ? <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> : mapper.map(entity, dtoClass); } <span class="hljs-function"><span class="hljs-function">Converter&lt;E, D&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDtoConverter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context -&gt; { E source = context.getSource(); D destination = context.getDestination(); mapSpecificFields(source, destination); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context.getDestination(); }; } <span class="hljs-function"><span class="hljs-function">Converter&lt;D, E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toEntityConverter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context -&gt; { D source = context.getSource(); E destination = context.getDestination(); mapSpecificFields(source, destination); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context.getDestination(); }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapSpecificFields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(E source, D destination)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapSpecificFields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(D source, E destination)</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre> <br>  Konverter pasca dan metode untuk mengisi bidang tertentu dapat dengan aman dikirim ke sana.  Juga, buat dua objek bertipe Class dan sebuah konstruktor untuk menginisialisasi mereka: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Class&lt;E&gt; entityClass; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Class&lt;D&gt; dtoClass; AbstractMapper(Class&lt;E&gt; entityClass, Class&lt;D&gt; dtoClass) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.entityClass = entityClass; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dtoClass = dtoClass; }</code> </pre> <br>  Sekarang jumlah kode di DroidMapper dikurangi menjadi sebagai berikut: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DroidMapper</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractMapper</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Droid</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DroidDto</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ModelMapper mapper; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> UnicornRepository unicornRepository; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DroidMapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ModelMapper mapper, UnicornRepository unicornRepository)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(Droid.class, DroidDto.class); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mapper = mapper; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.unicornRepository = unicornRepository; } <span class="hljs-meta"><span class="hljs-meta">@PostConstruct</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupMapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mapper.createTypeMap(Droid.class, DroidDto.class) .addMappings(m -&gt; m.skip(DroidDto::setUnicornId)).setPostConverter(toDtoConverter()); mapper.createTypeMap(DroidDto.class, Droid.class) .addMappings(m -&gt; m.skip(Droid::setUnicorn)).setPostConverter(toEntityConverter()); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapSpecificFields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Droid source, DroidDto destination)</span></span></span><span class="hljs-function"> </span></span>{ destination.setUnicornId(getId(source)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Long </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Droid source)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Objects.isNull(source) || Objects.isNull(source.getId()) ? <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> : source.getUnicorn().getId(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapSpecificFields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DroidDto source, Droid destination)</span></span></span><span class="hljs-function"> </span></span>{ destination.setUnicorn(unicornRepository.findById(source.getUnicornId()).orElse(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)); } }</code> </pre> <br>  Seorang mapper tanpa bidang tertentu umumnya tampak sederhana: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UnicornMapper</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractMapper</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Unicorn</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UnicornDto</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UnicornMapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(Unicorn.class, UnicornDto.class); } }</code> </pre> <br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id438808/">https://habr.com/ru/post/id438808/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id438798/index.html">Cara bekerja dengan data intelijen dunia maya: kami belajar mengumpulkan dan mengidentifikasi indikator kompromi sistem</a></li>
<li><a href="../id438800/index.html">PHP Pear Diretas dan Tidak Tersedia</a></li>
<li><a href="../id438802/index.html">Program musim panas untuk 2019 untuk mengajar program remaja di luar negeri</a></li>
<li><a href="../id438804/index.html">Menunggu semua orang di CocoaHeads Meetup berikutnya</a></li>
<li><a href="../id438806/index.html">Masalah terjemahan sastra</a></li>
<li><a href="../id438810/index.html">HTTP / 3: dari root ke ujung</a></li>
<li><a href="../id438812/index.html">Kualitas kode front-end HH</a></li>
<li><a href="../id438814/index.html">Pandangan sadar pada Helm 2: "Itulah apa itu ..."</a></li>
<li><a href="../id438818/index.html">UDB. Apa ini Bagian 5. Datapath. Hal-hal kecil yang bermanfaat</a></li>
<li><a href="../id438820/index.html">Manajemen pengetahuan: dokumen apa yang dibutuhkan dan apa yang harus diperbaiki di dalamnya</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>