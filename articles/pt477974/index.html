<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè§ üó°Ô∏è ‚Ü©Ô∏è Vivado: modo Picasso ü¶é üë©‚Äçüë¶ ü§∏üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anota√ß√£o 


 Madness All Ages Submissive 


 Ao projetar qualquer m√≥dulo em FPGAs, √†s vezes vem √† mente a id√©ia de um uso n√£o padr√£o do pr√≥prio ambien...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Vivado: modo Picasso</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/477974/"><h2 id="annotaciya">  Anota√ß√£o </h2><br><p>  <em>Madness All Ages Submissive</em> </p><br><p>  Ao projetar qualquer m√≥dulo em FPGAs, √†s vezes vem √† mente a id√©ia de um uso n√£o padr√£o do pr√≥prio ambiente de design e as ferramentas que ele fornece para o design.  Neste breve artigo, veremos como, com a ajuda da ferramenta de gerenciamento ambiental implementada no Tcl, podemos literalmente desenhar fotografias, pinturas, retratos e memes no FPGA. </p><br><p>  Uma ‚Äúrota de design‚Äù t√£o incomum foi implementada h√° um ano e meio, mas s√≥ agora surgiu a id√©ia de organiz√°-la na forma de uma nota, na qual h√° pouca pr√°tica no uso de scripts Tcl para gerenciar o ambiente de design, neste caso o Vivado.  No entanto, com pequenas modifica√ß√µes, tudo pode ser facilmente adaptado a outros ambientes de desenvolvimento, por exemplo, o Quartus II. </p><br><p><img src="https://habrastorage.org/webt/32/h7/xr/32h7xruuubk_cai37jn18jgf8ca.png"></p><a name="habracut"></a><br><h2 id="vvedenie">  1. Introdu√ß√£o </h2><br><p>  Obviamente, a ideia n√£o veio √† mente do nada.  Sua apar√™ncia foi promovida pelo meu emprego em projetos de processamento de imagem e gerenciamento de fluxo de v√≠deo no FPGA.  Acontece a todos que, ao se debru√ßarem sobre a solu√ß√£o de um problema, toda heresia vem √† mente por que ela n√£o funciona ou funciona exatamente como deveria, mas n√£o como esperamos. </p><br><p>  Ao resolver o problema, tive que recorrer a uma das ferramentas do ambiente Vivado, a saber, colorir os componentes e m√≥dulos correspondentes no projeto ap√≥s a coloca√ß√£o, o rastreio e a observa√ß√£o dos intermin√°veis ‚Äã‚Äãdiagramas de tempo. </p><br><p>  Como resultado, eu pintei v√°rios blocos l√≥gicos configur√°veis ‚Äã‚Äãde CLB em v√°rias cores, e ocorreu-me - esses s√£o os pixels da imagem, para que eu possa tentar desenhar qual fio a imagem √©, combinando cada pixel com seu pr√≥prio CLB colorido? ... bem, ele come√ßou </p><br><h2 id="chem-nam-pomozhet-tcl">  Como a Tcl nos ajudar√°? </h2><br><p>  Suponha que tenhamos uma imagem pequena de tamanho 100x100 pixels.  Agora, suponha que, para colorir o CLB, precisamos fazer duas coisas: selecione o CLB e selecione a cor.  Na imagem 100x100, temos 10.000 pixels e fazer essa colora√ß√£o manualmente √© bastante tedioso, principalmente porque as a√ß√µes s√£o iguais e repetitivas.  Portanto, pintar manualmente cada CLB n√£o √© uma op√ß√£o e voc√™ precisa usar Tcl e scripts.  Mas por onde come√ßar? </p><br><p>  A primeira coisa que veio √† mente foi encontrar a equipe certa respons√°vel por atribuir cores ao elemento selecionado.  Felizmente, ao executar a√ß√µes manualmente, o Vivado exibe os comandos Tcl apropriados no console, e parece que o problema de pesquisa deve ser resolvido o mais r√°pido poss√≠vel.  No entanto, n√£o estava l√°.  O Vivado simplesmente ignora a sa√≠da do comando para destacar os elementos selecionados, e a √∫nica op√ß√£o para encontr√°-lo, e eu tinha certeza absoluta de que deveria, √© mergulhar de cabe√ßa no guia Tcl dispon√≠vel no Vivado, e isso √© quase 2000 p√°ginas [1]. </p><br><p>  N√£o se desespere, a palavra-chave "destacar" encontrou rapidamente o comando correspondente, chamado de destaque_objetos.  Este comando destaca os objetos especificados ou selecionados em uma cor espec√≠fica, especificada usando as op√ß√µes.  As op√ß√µes para o comando destacar_objetos s√£o as seguintes: </p><br><p>  - <em>color_index</em> - (opcional) o valor v√°lido do argumento da op√ß√£o deve ser um n√∫mero de 1 a 20. A cor na qual o objeto selecionado ser√° pintado √© determinada pelo n√∫mero de s√©rie da paleta de cores predefinida, que pode ser encontrada em Cores ‚Üí Destaque na se√ß√£o do menu Ferramentas ‚Üí Configura√ß√µes . <br>  - <em>rgb</em> - (opcional) define a cor do objeto selecionado no formato RGB <br>  - <em>cor</em> - (opcional) destaca o objeto selecionado em uma das seguintes cores: vermelho, verde, azul, magenta, amarelo, ciano e laranja </p><br><p>  As op√ß√µes restantes do comando est√£o relacionadas √†s configura√ß√µes do sistema do pr√≥prio comando e n√£o ser√£o √∫teis para n√≥s.  No entanto, ao usar o comando align_objects, lembre-se de que duas ou mais op√ß√µes de cores n√£o podem ser aplicadas ao mesmo tempo. <br>  Obviamente, uma op√ß√£o que define uma cor arbitr√°ria no formato RGB √© adequada para a nossa tarefa - a op√ß√£o <em>rgb</em> </p><br><p>  Agora n√£o seria ruim obter os valores de pixel da imagem, mas n√£o consegui encontrar a imagem que seria apresentada no formato bitmap.  Ao abrir cada arquivo com um editor de texto, n√£o foi poss√≠vel encontrar linhas com um valor de pixel.  Obviamente, eu n√£o escrevi um programa para converter imagens em formato bitmap, mas simplesmente subi na Internet para procurar uma solu√ß√£o pronta.  N√£o demorou muito para pesquisar.  Como se viu, a tarefa de converter uma imagem em um formato de bitmap (ou seja, quando vemos os valores de pixel de uma imagem n√£o compactada) √© bastante relevante (provavelmente, essa tarefa √© dada aos alunos-programadores como uma li√ß√£o de casa para trabalhos de laborat√≥rio).  Uma breve pesquisa resultou no github, de onde o programa Image2Bitmap foi baixado [2]. </p><br><p>  O programa requer uma entrada de imagem e gera valores de pixel na forma de uma matriz s com valores hexadecimais de pixel no formato RGB565.  Esse formato diz que a codifica√ß√£o de cores para o componente vermelho usa 5 bits, verde 6 bits e azul 5 bits.  Isso acabou sendo suficiente para o trabalho.  Agora, tudo o que √© necess√°rio √© mapear os valores obtidos diretamente para as se√ß√µes pintadas (fatia). </p><br><h2 id="vybor-plis">  Sele√ß√£o FPGA </h2><br><p>  Quanto maior o FPGA, mais recursos l√≥gicos nele e, portanto, o "campo da criatividade" √© maior e a imagem ser√° mais clara.  Deve-se notar imediatamente que ‚Äúdecorar‚Äù √© um processo bastante longo e pode levar uma quantidade decente de tempo, dependendo do tamanho da imagem.  Para o teste, vale a pena escolher um FPGA com uma pequena quantidade de recursos.  Por exemplo, a fam√≠lia Spartan-7.  Ap√≥s o teste, voc√™ pode alterar o FPGA para mais "gordo", por exemplo, da fam√≠lia Ultrascale +. </p><br><ol><li><p>  Come√ßamos o Vivado e criamos o projeto </p><br></li><li><p>  Selecionamos o cristal xc7s6cpga196-2, no qual desenharemos a imagem de teste <br><br><img src="https://habrastorage.org/webt/vk/zj/do/vkzjdo6hklo098bevkxuz7qvjhu.png"></p><br></li><li><p>  Para exibir o desenho, precisamos abrir a imagem do pr√≥prio cristal, no entanto, isso pode ser feito ap√≥s a etapa de s√≠ntese ou elaborado.  No Vivado, para isso, precisamos criar um m√≥dulo fict√≠cio em qualquer idioma. <br><br><img src="https://habrastorage.org/webt/nb/ss/7k/nbss7kzptxr8ify9ot4ctpijx8u.png"></p><br></li><li><p>  Adicione um script ao projeto Tcl. <br>  a.  Para fazer isso, crie um arquivo com a extens√£o ‚Äú.tcl‚Äù na pasta com o projeto, por exemplo, ‚Äúfpga_painter.tcl‚Äù <br><br><img src="https://habrastorage.org/webt/x9/k8/is/x9k8ismf9abat7cjtkl6kqto-lg.png"></p><br><p>  b.  V√° para Vivado e adicione este arquivo ao projeto. <br><br><img src="https://habrastorage.org/webt/zs/we/gd/zswegdciaq_qyj-8x56ar2wfzom.png"></p><br><p>  c.  Ap√≥s atualizar a hierarquia do projeto, torne o arquivo inativo. <br><br><img src="https://habrastorage.org/webt/ut/h6/-p/uth6-puy3u6amils-egmrxs8cqo.png"></p><br></li><li><p>  Ap√≥s a cria√ß√£o do m√≥dulo, ele aparecer√° na janela da hierarquia do projeto e o bot√£o Open Elaborate Design estar√° dispon√≠vel para n√≥s.  Empurre. <br><br><img src="https://habrastorage.org/webt/g8/cy/mk/g8cymkxi_hdpdwm32k7mld50t_s.png"></p><br></li><li><p>  Ap√≥s abrir o Elaborate Design, v√° para Window ‚Üí Device.  Uma exibi√ß√£o do campo do nosso FPGA ser√° exibida. <br><br><img src="https://habrastorage.org/webt/sz/_n/cd/sz_ncdlckd-5rqbvicyshqmulxu.png"></p><br></li><li><p>  A prepara√ß√£o est√° conclu√≠da, come√ßamos a escrever um script. </p><br></li></ol><br><h2 id="opredelenie-parametrov-i-procedur">  Defini√ß√£o de par√¢metros e procedimentos </h2><br><h3 id="testovoe-izobrazhenie">  Imagem de teste </h3><br><p>  Primeiro, vamos depurar o algoritmo / c√≥digo em uma imagem pequena, digamos 5x3, e depois execut√°-lo "ao m√°ximo". </p><br><ol><li><p>  Abra o Paint, limite o campo da imagem a 5x3 pixels (voc√™ pode tirar qualquer cor).  Salve o arquivo como "5x3.png" <br><br><img src="https://habrastorage.org/webt/nh/vg/l6/nhvgl6sub5ywa74hvrn-p5xq8hm.png"></p><br></li><li><p>  Abra o programa Image2Bitmap e converta nossa imagem em uma matriz RGB565. <br><br><img src="https://habrastorage.org/webt/aq/vb/u9/aqvbu9m6zhzrjakwux_1clytapk.png"></p><br></li><li><p>  Ap√≥s a convers√£o, o programa nos fornecer√° uma matriz de 15 pixels </p><br></li></ol><br><pre><code class="plaintext hljs">*uint16_t image = { 0xf800, 0x07e0, 0x001f, 0x8410, 0x8010, 0xfbe4, 0xff80, 0x2589, 0x051d, 0x3a59, 0xa254, 0xbbca, 0xfd79, 0xef36, 0x9edd, };*</code> </pre> <br><h3 id="podgotovka-dannyh">  Prepara√ß√£o de dados </h3><br><p>  Antes de prosseguir com o processamento de pixels, transformamos os dados gerados pelo Image2Bitmap em uma lista simples na qual os valores hexadecimais de pixels s√£o gravados.  Vamos copiar os dados do programa e salv√°-los no arquivo pic_array.dat, que deve estar localizado na pasta do projeto. </p><br><p><img src="https://habrastorage.org/webt/1b/xm/dj/1bxmdjjzyzhrqxqchlngx8qmpiu.png"></p><br><p>  Ao iniciar o script criado, temos que processar o arquivo "pic_array.dat".  Vale ressaltar que o n√∫mero de elementos na linha retornada pelo Image2Bitmap n√£o corresponde ao n√∫mero de pixels na linha da imagem convertida; por esse motivo, criaremos uma lista separada de "pixels". </p><br><p><img src="https://habrastorage.org/webt/rj/xl/pc/rjxlpcpleobp3ekmfwp4z_sofe0.png"></p><br><p>  Ao ler um arquivo, voc√™ deve ignorar a primeira linha "uint16_t image = {" e a √∫ltima "};".  Para pular a primeira linha ao ler um arquivo, basta colocar a linha antes do ciclo de leitura do arquivo inteiro. </p><br><p><img src="https://habrastorage.org/webt/p0/j0/cl/p0j0clka4-dt-ggaskumsj5zkd8.png"></p><br><p>  Depois de ler o arquivo inteiro, veremos que a √∫ltima linha do arquivo ‚Äú};‚Äù se tornou um elemento da lista, que √© simplesmente exclu√≠da. </p><br><p><img src="https://habrastorage.org/webt/zm/sc/ao/zmscaotma7373mbpnknpxh4xn5m.png"></p><br><p>  Isso completa a forma√ß√£o da lista com valores hexadecimais de pixel.  Agora vamos come√ßar a process√°-los. </p><br><h3 id="opredelenie-razmera-izobrazheniya">  Dimensionamento da imagem </h3><br><p>  Mais uma vez, d√™ uma olhada no campo FPGA e na imagem.  O campo FPGA √© dividido em se√ß√µes (SLICE), que possuem as coordenadas horizontais correspondentes ‚ÄúX‚Äù e vertical ‚ÄúY‚Äù.  Por exemplo, SLICE_X6Y36. </p><br><p><img src="https://habrastorage.org/webt/hm/iz/du/hmizdutpp0x-mieimj5ma07rgnk.png"></p><br><p>  A imagem, por sua vez, possui pixels, tamb√©m com coordenadas horizontais e verticais.  Ao sobrepor a imagem no FPGA, devemos combinar o pixel superior esquerdo com a se√ß√£o superior esquerda do FPGA.  Nesse caso, o cristal selecionado possui uma se√ß√£o superior com a coordenada X0Y49. </p><br><p><img src="https://habrastorage.org/webt/0h/ip/b-/0hipb-wldjghc-p2xs5-uafdtxe.png"></p><br><p>  O tamanho da imagem ser√° determinado pelo n√∫mero de se√ß√µes no FPGA horizontal e verticalmente.  Para o cristal selecionado, a coordenada horizontal das se√ß√µes varia de X0 a X131 e a coordenada vertical de Y49 a Y0.  Segue-se que teoricamente podemos desenhar uma imagem do tamanho de 132x50 no cristal selecionado. </p><br><h3 id="nachalnye-parametry">  Par√¢metros iniciais </h3><br><p>  Resumindo: os par√¢metros iniciais do nosso script ser√£o: </p><br><ol><li><p>  X posi√ß√£o inicial da se√ß√£o: nome da vari√°vel start_x <br><br><img src="https://habrastorage.org/webt/l8/qr/gh/l8qrghklltffibctylxjcczbwqk.png"></p><br></li><li><p>  Posi√ß√£o inicial da se√ß√£o no eixo y: nome da vari√°vel start_y <br><br><img src="https://habrastorage.org/webt/yf/23/kf/yf23kfl9uxrt5zekli3n16zpzew.png"></p><br></li><li><p>  Largura da imagem (a imagem de teste √© 5): vari√°vel w <br><br><img src="https://habrastorage.org/webt/cs/oi/un/csoiunryjazlcstfmab_g3ee9r0.png"></p><br></li><li><p>  Altura da imagem (a imagem de teste √© 3): vari√°vel h <br><br><img src="https://habrastorage.org/webt/oz/d2/09/ozd209wjyznbgt2uvcb7fvrhd2c.png"></p><br></li></ol><br><h3 id="korrektirovka-cveta-piksela">  Ajuste de cor de pixel </h3><br><p>  O Image2Bitmap fornece uma matriz de pixels no formato RGB565 como um n√∫mero de 16 bits gravado no formato hexadecimal.  Dever√≠amos: </p><br><ol><li><p>  Converta o valor do pixel em formato bin√°rio.  Isso pode ser feito usando o procedimento hex2bin, que pode ser encontrado em [3] <br><br><img src="https://habrastorage.org/webt/fv/su/mt/fvsumtam5vrnkkm0uucn5vx4brc.png"></p><br></li><li><p>  Combine os bits com os componentes de cores correspondentes: <br>  ‚Ä¢ O componente vermelho de R [15:11] <br><br><img src="https://habrastorage.org/webt/tj/mh/2k/tjmh2k-ihvuroxwduqm6_ugqmxi.png"></p><br><p>  ‚Ä¢ Componente verde G [10: 5] <br><br><img src="https://habrastorage.org/webt/y6/g0/yd/y6g0ydaosk3gkzzlylaenkh_oxm.png"></p><br><p>  ‚Ä¢ Componente azul B [4: 0] <br><br><img src="https://habrastorage.org/webt/3i/97/vh/3i97vhrm4ivfevdr-xqwjzi9bzg.png"></p><br></li></ol><br><p>  <em>Explica√ß√£o: a ordem √© alterada devido ao fato de o procedimento hex2bin retornar uma sequ√™ncia na qual a numera√ß√£o de elementos come√ßa com 0, ou seja, o 15¬∫ bit corresponde ao 0¬∫ elemento da sequ√™ncia e o 0¬∫ bit corresponde ao 15¬∫ elemento da sequ√™ncia</em> </p><br><ol><li><p>  Converta o valor do componente de cor de bin√°rio em decimal.  Isso pode ser feito usando o procedimento bin2dec, que pode ser encontrado [3]: <br><br><img src="https://habrastorage.org/webt/hc/1n/em/hc1nemkiw4byzq2yc-vka0gckmq.png"><br><br><img src="https://habrastorage.org/webt/hi/td/uy/hitduy-sypn4d7bv7kidwic2g2m.png"></p><br></li><li><p>  Converta valores de pixel do formato RGB565 para RGB888, para uma exibi√ß√£o mais suave da imagem.  Isso √© feito usando duas listas, que podem ser encontradas em [4].  Como funciona: <br>  ‚Ä¢ A resolu√ß√£o dos componentes de cor R e B √© de 5 bits.  Tomando o valor decimal do componente, comparamos com a posi√ß√£o do n√∫mero escrito na lista t5, e o valor do componente muda para o valor da tabela <br><br><img src="https://habrastorage.org/webt/lk/vw/_a/lkvw_abrbpyeylfdoggm5pbpxns.png"><br><br><img src="https://habrastorage.org/webt/ao/mw/tv/aomwtv2q6hz9bg-_lmszmig7euq.png"><br><br><img src="https://habrastorage.org/webt/uy/qh/16/uyqh16vi-qkh9vpfrzcovq-zugs.png"></p><br><p>  ‚Ä¢ Da mesma forma para o componente G e a tabela t6 <br><br><img src="https://habrastorage.org/webt/ti/is/lh/tiislhhogy2om7xxhvj_676dm5s.png"><br><br><img src="https://habrastorage.org/webt/pa/bh/3d/pabh3dqnk_3sk3sn6zt5big0t0e.png"></p><br></li></ol><br><h3 id="opredelenie-nalichiya-sekcii">  Se√ß√£o Disponibilidade </h3><br><p>  Dentro de alguns FPGAs, existem recursos ou vazios especiais que podem interromper a numera√ß√£o seq√ºencial das coordenadas da se√ß√£o.  Por exemplo, na figura abaixo, voc√™ pode ver que a numera√ß√£o da se√ß√£o est√° interrompida (cristal xc7s50) <br><br><img src="https://habrastorage.org/webt/uq/er/yq/uqeryqyfckyqezufafrp-vrxbgi.png"></p><br><p>  Por esse motivo, antes da colora√ß√£o, verificamos primeiro a exist√™ncia da se√ß√£o.  Se existir, pinte, se n√£o existir, v√° para o pr√≥ximo pixel <br><br><img src="https://habrastorage.org/webt/zx/a8/lt/zxa8lt_n0pb6o7s3ztrfozkuu2k.png"></p><br><h3 id="okrashivanie-sekcii">  Colora√ß√£o de se√ß√£o </h3><br><p>  Cor da se√ß√£o definida, se√ß√£o verificada.  Agora a cor precisa ser atribu√≠da √†s se√ß√µes usando o comando align_objects: <br><br><img src="https://habrastorage.org/webt/5i/fv/lp/5ifvlpcm5e70ur9sg7mufhmh4e0.png"></p><br><h3 id="vektor-dvuhmernyy-massiv">  Vetor ‚Üí Matriz bidimensional </h3><br><p>  No in√≠cio, convertemos os dados da imagem em uma lista de pixels, que armazena uma varredura progressiva da imagem.  Para organizar a imagem, introduzimos duas vari√°veis, x e y, que corresponder√£o √† posi√ß√£o dos pixels na imagem.  Ao ler sequencialmente os elementos da lista de pixels, formaremos uma imagem usando dois para loops: um pelo n√∫mero de linhas, o segundo pela posi√ß√£o do pixel na linha <br><br><img src="https://habrastorage.org/webt/fk/pu/wa/fkpuwau81hpppxfxkgvvzuvdtr0.png"><br><br><img src="https://habrastorage.org/webt/hf/bj/jh/hfbjjhugkpxwqd2zdtrn0seyzse.png"></p><br><h3 id="polnyy-listing-skripta">  Listagem completa de scripts </h3><br><div class="spoiler">  <b class="spoiler_title">Listagem Fpga_painter.tcl</b> <div class="spoiler_text"><pre> <code class="vhdl hljs">#https://tcl.tk/ #http://www.tune-it.ru/web/il/home/-/blogs/-rgb888-&lt;-&gt;-rgb565----- #https://github.com/FoxExe/Image2Bitmap/releases/tag/<span class="hljs-number"><span class="hljs-number">0.5</span></span> #        set start_x <span class="hljs-number"><span class="hljs-number">0</span></span>; # set start_y <span class="hljs-number"><span class="hljs-number">49</span></span>; # set w <span class="hljs-number"><span class="hljs-number">5</span></span>; #  (   ) set h <span class="hljs-number"><span class="hljs-number">3</span></span>; #  ( ) proc hex2bin hex { set t [list <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0001</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0010</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0011</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">0100</span></span> \ <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">0101</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">0110</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">0111</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">1001</span></span> \ a <span class="hljs-number"><span class="hljs-number">1010</span></span> b <span class="hljs-number"><span class="hljs-number">1011</span></span> c <span class="hljs-number"><span class="hljs-number">1100</span></span> d <span class="hljs-number"><span class="hljs-number">1101</span></span> e <span class="hljs-number"><span class="hljs-number">1110</span></span> f <span class="hljs-number"><span class="hljs-number">1111</span></span> \ A <span class="hljs-number"><span class="hljs-number">1010</span></span> B <span class="hljs-number"><span class="hljs-number">1011</span></span> C <span class="hljs-number"><span class="hljs-number">1100</span></span> D <span class="hljs-number"><span class="hljs-number">1101</span></span> E <span class="hljs-number"><span class="hljs-number">1110</span></span> F <span class="hljs-number"><span class="hljs-number">1111</span></span>] regsub {^<span class="hljs-number"><span class="hljs-number">0</span></span>[xX]} $hex {} hex <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">map</span></span> -nocase $t $hex] } proc bin2dec bin { #returns <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> equivalent <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> $bin set res <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {$bin == <span class="hljs-number"><span class="hljs-number">0</span></span>} { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> } elseif {[<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> match -* $bin]} { set sign - set bin [<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> $bin[set bin {}] <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>] } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { set sign {} } foreach i [split $bin {}] { set res [expr {$res*<span class="hljs-number"><span class="hljs-number">2</span></span>+$i}] } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $sign$res } ############### #RGB565 -&gt; RGB888 using tables set t5 [list <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">41</span></span> <span class="hljs-number"><span class="hljs-number">49</span></span> <span class="hljs-number"><span class="hljs-number">58</span></span> <span class="hljs-number"><span class="hljs-number">66</span></span> <span class="hljs-number"><span class="hljs-number">74</span></span> <span class="hljs-number"><span class="hljs-number">82</span></span> <span class="hljs-number"><span class="hljs-number">90</span></span> <span class="hljs-number"><span class="hljs-number">99</span></span> <span class="hljs-number"><span class="hljs-number">107</span></span> <span class="hljs-number"><span class="hljs-number">115</span></span> <span class="hljs-number"><span class="hljs-number">123</span></span> <span class="hljs-number"><span class="hljs-number">132</span></span>\ <span class="hljs-number"><span class="hljs-number">140</span></span> <span class="hljs-number"><span class="hljs-number">148</span></span> <span class="hljs-number"><span class="hljs-number">156</span></span> <span class="hljs-number"><span class="hljs-number">165</span></span> <span class="hljs-number"><span class="hljs-number">173</span></span> <span class="hljs-number"><span class="hljs-number">181</span></span> <span class="hljs-number"><span class="hljs-number">189</span></span> <span class="hljs-number"><span class="hljs-number">197</span></span> <span class="hljs-number"><span class="hljs-number">206</span></span> <span class="hljs-number"><span class="hljs-number">214</span></span> <span class="hljs-number"><span class="hljs-number">222</span></span> <span class="hljs-number"><span class="hljs-number">230</span></span> <span class="hljs-number"><span class="hljs-number">239</span></span> <span class="hljs-number"><span class="hljs-number">247</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span>] set t6 [list <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">45</span></span> <span class="hljs-number"><span class="hljs-number">49</span></span> <span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">57</span></span> <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">65</span></span> <span class="hljs-number"><span class="hljs-number">69</span></span>\ <span class="hljs-number"><span class="hljs-number">73</span></span> <span class="hljs-number"><span class="hljs-number">77</span></span> <span class="hljs-number"><span class="hljs-number">81</span></span> <span class="hljs-number"><span class="hljs-number">85</span></span> <span class="hljs-number"><span class="hljs-number">89</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">97</span></span> <span class="hljs-number"><span class="hljs-number">101</span></span> <span class="hljs-number"><span class="hljs-number">105</span></span> <span class="hljs-number"><span class="hljs-number">109</span></span> <span class="hljs-number"><span class="hljs-number">113</span></span> <span class="hljs-number"><span class="hljs-number">117</span></span> <span class="hljs-number"><span class="hljs-number">121</span></span> <span class="hljs-number"><span class="hljs-number">125</span></span> <span class="hljs-number"><span class="hljs-number">130</span></span> <span class="hljs-number"><span class="hljs-number">134</span></span> <span class="hljs-number"><span class="hljs-number">138</span></span>\ <span class="hljs-number"><span class="hljs-number">142</span></span> <span class="hljs-number"><span class="hljs-number">146</span></span> <span class="hljs-number"><span class="hljs-number">150</span></span> <span class="hljs-number"><span class="hljs-number">154</span></span> <span class="hljs-number"><span class="hljs-number">158</span></span> <span class="hljs-number"><span class="hljs-number">162</span></span> <span class="hljs-number"><span class="hljs-number">166</span></span> <span class="hljs-number"><span class="hljs-number">170</span></span> <span class="hljs-number"><span class="hljs-number">174</span></span> <span class="hljs-number"><span class="hljs-number">178</span></span> <span class="hljs-number"><span class="hljs-number">182</span></span> <span class="hljs-number"><span class="hljs-number">186</span></span> <span class="hljs-number"><span class="hljs-number">190</span></span> <span class="hljs-number"><span class="hljs-number">194</span></span> <span class="hljs-number"><span class="hljs-number">198</span></span>\ <span class="hljs-number"><span class="hljs-number">202</span></span> <span class="hljs-number"><span class="hljs-number">206</span></span> <span class="hljs-number"><span class="hljs-number">210</span></span> <span class="hljs-number"><span class="hljs-number">215</span></span> <span class="hljs-number"><span class="hljs-number">219</span></span> <span class="hljs-number"><span class="hljs-number">223</span></span> <span class="hljs-number"><span class="hljs-number">227</span></span> <span class="hljs-number"><span class="hljs-number">231</span></span> <span class="hljs-number"><span class="hljs-number">235</span></span> <span class="hljs-number"><span class="hljs-number">239</span></span> <span class="hljs-number"><span class="hljs-number">243</span></span> <span class="hljs-number"><span class="hljs-number">247</span></span> <span class="hljs-number"><span class="hljs-number">251</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span>] ############### #  .         set script_path [get_property DIRECTORY [get_projects *]] cd $script_path #       set fId [<span class="hljs-keyword"><span class="hljs-keyword">open</span></span> {pic_array.dat} r] # ,       set pixels [list ] #    .    gets $fId <span class="hljs-literal"><span class="hljs-literal">line</span></span> #  .     . <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> {[gets $fId <span class="hljs-literal"><span class="hljs-literal">line</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>} { set pixels [concat $pixels $<span class="hljs-literal"><span class="hljs-literal">line</span></span>] } #   pixels   <span class="hljs-string"><span class="hljs-string">"};"</span></span>,    Image2Bitmap set pixels [lrange $pixels <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>] #    pixels set pix_num <span class="hljs-number"><span class="hljs-number">0</span></span>; #      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> {set y <span class="hljs-number"><span class="hljs-number">0</span></span>} { $y &lt; $h } {incr y} { #    ( ) set Y [expr {$start_y - $y}] #    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> {set x <span class="hljs-number"><span class="hljs-number">0</span></span>} { $x &lt; $w } {incr x } { set pix_val [lindex $pixels $pix_num]; incr pix_num #   binary  set pix_bin [hex2bin $pix_val] ; #     set R_bin [<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> $pix_bin <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>] #    set R_dec [ bin2dec $R_bin ] #       t5 set R [lindex $t5 $R_dec] #       set G_bin [<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> $pix_bin <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>] set G [lindex $t6 [ bin2dec $G_bin ]] set B_bin [<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> $pix_bin <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span>] set B [lindex $t5 [ bin2dec $B_bin ] ] #    set X [expr {$start_x + $x}] #,      set cond [get_sites <span class="hljs-string"><span class="hljs-string">"SLICE_X${X}Y${Y}"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {$cond ne <span class="hljs-string"><span class="hljs-string">""</span></span>} { #  highlight_objects [get_sites <span class="hljs-string"><span class="hljs-string">"SLICE_X${X}Y${Y}"</span></span>] -rgb <span class="hljs-string"><span class="hljs-string">"$R $G $B"</span></span> } puts <span class="hljs-string"><span class="hljs-string">"X = $XY = $Y; $R $G $B"</span></span> } } close $fId puts <span class="hljs-string"><span class="hljs-string">"Complete::Check FPGA field::Window-&gt;Device"</span></span></code> </pre> </div></div><br><h2 id="testirovanie">  Teste </h2><br><ol><li><p>  Para iniciar o teste, verifique se o campo FPGA est√° dispon√≠vel para voc√™, ou seja,  uma das etapas do projeto est√° aberta: elaborada, s√≠ntese ou implementada.  Para exibir o campo FPGA, selecione Janela ‚Üí Dispositivo <br><br><img src="https://habrastorage.org/webt/sz/_n/cd/sz_ncdlckd-5rqbvicyshqmulxu.png"></p><br></li><li><p>  Abra o arquivo pic_array.dat e copie os dados do Image2Bitmap no arquivo.  Salvar arquivo <br><br><img src="https://habrastorage.org/webt/gf/bo/qk/gfboqkmege_xbatauuqznugutls.png"></p><br></li><li><p>  Vamos abrir o script.  Defina a coordenada do pixel superior esquerdo 0 e 49, o tamanho da imagem de teste √© 5 por 3 e execute o script.  Para fazer isso, clique com o bot√£o direito do mouse no campo de script e selecione Executar. <br><br><img src="https://habrastorage.org/webt/z6/ku/xk/z6kuxks3efxqgcg6w-ml18pwaic.png"></p><br></li><li><p>  V√° para o console Tcl e verifique se o script foi executado. <br><br><img src="https://habrastorage.org/webt/km/of/qr/kmofqrtlejamixfiwexviemy4ay.png"></p><br></li><li><p>  V√° para a guia Dispositivo e verifique se as c√©lulas est√£o coloridas na cor apropriada. <br><br><img src="https://habrastorage.org/webt/xv/ba/nf/xvbanfmjcmx9lqxxofnq04wxwf0.png"></p><br></li><li><p>  Agora podemos tirar qualquer imagem, convert√™-la no tamanho desejado e preencher o campo FPGA.  Abaixo est√£o alguns exemplos. </p><br></li></ol><br><p>  <em>PS: a atribui√ß√£o de cores personalizada substitui a configura√ß√£o de cores padr√£o do Vivado</em> <br><br><img src="https://habrastorage.org/webt/oz/hx/f4/ozhxf4slhbnycmhqmpfxbsb7fby.png"></p><br><h2 id="spisok-literatury">  Refer√™ncias </h2><br><ol><li>  UG835.  Vivado Design Suite TclCommand Guia de Refer√™ncia </li><li>  <a href="">https://github.com/FoxExe/Image2Bitmap/releases/tag/0.5</a> </li><li>  <a href="https://tcl.tk/">https://tcl.tk</a> </li><li>  <a href="http://www.tune-it.ru/web/il/home/-/blogs/%25D0%25BF%25D1%2580%25D0%25B5%25D0%25BE%25D0%25B1%25D1%2580%25D0%25B0%25D0%25B7%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5-rgb888">http://www.tune-it.ru/web/il/home/-/blogs/conversion-rgb888</a> - &lt;-&gt; -rgb565-and-protection-mushrooms-from-fading </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt477974/">https://habr.com/ru/post/pt477974/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt477956/index.html">JavaScript em 3D: uma introdu√ß√£o ao Three.js</a></li>
<li><a href="../pt477958/index.html">As 10 principais tend√™ncias do novo relat√≥rio de tend√™ncias de crimes de alta tecnologia e tecnologia 2019/2020 Group-IB</a></li>
<li><a href="../pt477964/index.html">Dois meses desde a ideia at√© a primeira venda: experi√™ncia em equipe Genesis</a></li>
<li><a href="../pt477966/index.html">HolyJS 2019 Moscow atrav√©s dos olhos do participante</a></li>
<li><a href="../pt477968/index.html">Cair em uma toca de coelho: uma hist√≥ria sobre um erro de reinicializa√ß√£o de um verniz - Parte 1</a></li>
<li><a href="../pt477976/index.html">Visualiza√ß√£o e an√°lise da estrutura da comunidade usando gr√°ficos</a></li>
<li><a href="../pt478472/index.html">Biblioteca de kernel do Linux: kernel do Linux em fator de forma dll ou dll</a></li>
<li><a href="../pt478474/index.html">O irm√£o Pablo Escobar tamb√©m lan√ßou um smartphone flex√≠vel</a></li>
<li><a href="../pt478480/index.html">Intelig√™ncia artificial, ITSM e, em geral, onde LEAN?</a></li>
<li><a href="../pt478482/index.html">O desenvolvedor abriu um bar para desenvolvedores e organiza reuni√µes sobre Angular, layout, PHP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>