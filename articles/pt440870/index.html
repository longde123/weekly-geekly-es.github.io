<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéì üëÑ üîÇ Como eu remendei o Universo ü•ò ü§üüèæ ‚óΩÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Existem muitos artigos sobre o desenvolvimento de jogos no Habr√©, mas entre eles existem muito poucos artigos relacionados a t√≥picos dos bastidores. U...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como eu remendei o Universo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440870/"><img src="https://habrastorage.org/webt/qx/ux/p6/qxuxp6yfki43hwobitxc9pte6jm.jpeg" alt="imagem"><br><br>  <i>Existem muitos artigos sobre o desenvolvimento de jogos no Habr√©, mas entre eles existem muito poucos artigos relacionados a t√≥picos dos bastidores.</i>  <i>Um desses t√≥picos √© a organiza√ß√£o da entrega, de fato, do jogo para um grande n√∫mero de usu√°rios por um longo tempo (um, dois, tr√™s).</i>  <i>Apesar do fato de que, para alguns, a tarefa pode parecer trivial, decidi compartilhar minha experi√™ncia de fazer o trabalho de rake nesse assunto para um projeto espec√≠fico.</i>  <i>Algu√©m interessado - por favor.</i> <br><a name="habracut"></a><br>  <i>Uma pequena digress√£o sobre a divulga√ß√£o de informa√ß√µes.</i>  <i>A maioria das empresas sente muita inveja de que a ‚Äúcozinha interna‚Äù n√£o se torne acess√≠vel ao p√∫blico em geral.</i>  <i>Por que - eu n√£o sei, mas o que √© - √© isso.</i>  <i>Neste projeto em particular - The Universim - tive sorte e o CEO da Crytivo Inc.</i>  <i>(anteriormente Crytivo Games Inc.) Alex Koshelkov mostrou-se absolutamente sensato nesse assunto, por isso tenho a oportunidade de compartilhar minha experi√™ncia com outras pessoas.</i> <br><br><h3>  Um pouco sobre patcher em si </h3><br>  Estou envolvido no desenvolvimento de jogos h√° muito tempo.  Em alguns - como designer e programador de jogos, em alguns - como uma fus√£o do administrador e programador do sistema (n√£o gosto do termo "devops", pois ele n√£o reflete com precis√£o a ess√™ncia das tarefas que realizo em tais projetos). <br><br>  No final de 2013 (o horror de como o tempo passa), pensei em entregar novas vers√µes (compila√ß√µes) aos usu√°rios.  Obviamente, naquela √©poca havia muitas solu√ß√µes para essa tarefa, mas o desejo de fabricar um produto e a sede de "constru√ß√£o de bicicletas" venceram.  Al√©m disso, eu queria aprender C # mais profundamente - ent√£o decidi criar meu pr√≥prio patcher.  Olhando para o futuro, direi que o projeto foi um sucesso, mais de uma d√∫zia de empresas o utilizaram e o est√£o usando em seus projetos, algumas pediram para fazer uma vers√£o levando em considera√ß√£o exatamente seus desejos. <br><br>  A solu√ß√£o cl√°ssica envolve a cria√ß√£o de pacotes delta (ou diffs) de vers√£o para vers√£o.  No entanto, essa abordagem √© inconveniente para jogadores testadores e desenvolvedores - em um caso, para obter a vers√£o mais recente do jogo, voc√™ precisa passar por toda a cadeia de atualiza√ß√µes.  I.e.  o jogador precisa reunir sequencialmente uma certa quantidade de dados que ele (a) nunca usar√°, e o desenvolvedor para armazenar em seu servidor (ou servidores) um monte de dados desatualizados que alguns dos jogadores podem precisar uma vez. <br><br>  Em outro caso - voc√™ precisa baixar o patch da sua vers√£o para a vers√£o mais recente, mas o desenvolvedor precisa manter todo esse zool√≥gico de patches em casa.  Algumas implementa√ß√µes de sistemas de patches exigem determinado software e alguma l√≥gica nos servidores - o que tamb√©m cria uma dor de cabe√ßa adicional para os desenvolvedores.  Al√©m disso, muitas vezes os desenvolvedores de jogos n√£o querem fazer nada que n√£o esteja diretamente relacionado ao desenvolvimento do pr√≥prio jogo.  Vou dizer ainda mais - a maioria n√£o √© especialista em configurar servidores para distribui√ß√£o de conte√∫do - essa simplesmente n√£o √© sua √°rea de atividade. <br><br>  Com tudo isso em mente, eu queria criar uma solu√ß√£o o mais simples poss√≠vel para usu√°rios (que querem jogar mais r√°pido e n√£o dan√ßar com patches de vers√µes diferentes), bem como para desenvolvedores que precisam escrever um jogo e n√£o descobrir o que e por qu√™ n√£o atualizado pelo pr√≥ximo usu√°rio. <br><br>  Sabendo como alguns protocolos de sincroniza√ß√£o de dados funcionam - quando os dados s√£o analisados ‚Äã‚Äãno cliente e apenas as mudan√ßas do servidor s√£o transmitidas -, decidi usar a mesma abordagem. <br>  Al√©m disso, na pr√°tica, de vers√£o para vers√£o durante todo o per√≠odo de desenvolvimento, muitos arquivos de jogos mudam um pouco - a textura existe, o modelo em si, alguns sons. <br><br>  Como resultado, parecia l√≥gico considerar cada arquivo no diret√≥rio do jogo como um conjunto de blocos de dados.  Quando a pr√≥xima vers√£o √© lan√ßada, a compila√ß√£o do jogo √© analisada, um mapa de blocos √© constru√≠do e os arquivos do jogo s√£o compactados bloco por bloco.  O cliente analisa os blocos existentes e apenas a diferen√ßa √© baixada. <br><br>  Inicialmente, o patcher foi planejado como um m√≥dulo no Unity3D, no entanto, um detalhe desagrad√°vel surgiu que me fez reconsiderar isso.  O fato √© que o Unity3D √© um aplicativo (mecanismo) completamente independente do seu c√≥digo.  E enquanto o mecanismo est√° em execu√ß√£o, v√°rios arquivos est√£o abertos, o que cria problemas quando voc√™ deseja atualiz√°-los. <br><br>  Nos sistemas do tipo Unix, a substitui√ß√£o de um arquivo aberto (a menos que esteja especificamente bloqueado) n√£o apresenta problemas, mas no Windows, sem dan√ßar com um pandeiro, esse "fingimento com orelhas" n√£o funciona.  Foi por isso que criei o patcher como um aplicativo separado que n√£o carrega nada al√©m de bibliotecas do sistema.  De fato, o pr√≥prio patcher acabou sendo um utilit√°rio completamente independente do mecanismo Unity3D, o que n√£o impediu, no entanto, adicion√°-lo √† loja Unity3D. <br><br><h3>  Algoritmo de Patcher </h3><br>  Portanto, os desenvolvedores lan√ßam novas vers√µes com uma certa frequ√™ncia.  Os jogadores querem que essas vers√µes cheguem.  O objetivo do desenvolvedor √© fornecer esse processo com custos m√≠nimos e com dor de cabe√ßa m√≠nima para os jogadores. <br><br><h3>  Do desenvolvedor </h3><br>  Ao preparar um patch, o algoritmo para as a√ß√µes do patcher fica assim: <br><br>  ‚óã Crie uma √°rvore de arquivos do jogo com seus atributos e somas de verifica√ß√£o SHA512 <br>  ‚óã Para cada arquivo: <br>  ‚ñ∫ Divida o conte√∫do em blocos. <br>  ‚ñ∫ Salve a soma de verifica√ß√£o SHA256. <br>  ‚ñ∫ Compactar um bloco e adicion√°-lo ao mapa de blocos de arquivos. <br>  ‚ñ∫ Salve o endere√ßo do bloco no √≠ndice. <br>  ‚óã Salve a √°rvore de arquivos com suas somas de verifica√ß√£o. <br>  ‚óã Salve o arquivo de dados da vers√£o. <br><br>  O desenvolvedor precisa fazer o upload dos arquivos recebidos no servidor. <br><br><h4>  Lado do jogador </h4><br>  No cliente, o patcher faz o seguinte: <br>  ‚óã Copia-se para um arquivo com um nome diferente.  Isso atualizar√° o arquivo execut√°vel do patcher, se necess√°rio.  Em seguida, o controle √© transferido para a c√≥pia e o original √© conclu√≠do. <br>  ‚óã Baixe o arquivo de vers√£o e compare com o arquivo de vers√£o local. <br>  ‚óã Se a compara√ß√£o n√£o revelou nenhuma diferen√ßa - voc√™ pode jogar, temos a vers√£o mais recente.  Se houver alguma diferen√ßa, v√° para o pr√≥ximo item. <br>  ‚óã Baixe uma √°rvore de arquivos com suas somas de verifica√ß√£o. <br>  ‚óã Para cada arquivo na √°rvore do servidor: <br>  ‚ñ∫ Se houver um arquivo, ele considera sua soma de verifica√ß√£o (SHA512).  Caso contr√°rio, ele considera que √©, mas est√° vazio (ou seja, consiste em zeros s√≥lidos) e tamb√©m considera sua soma de verifica√ß√£o. <br>  ‚ñ∫ Se a soma do arquivo local n√£o corresponder √† soma de verifica√ß√£o do arquivo da vers√£o mais recente: <br>  ‚ñ∫ Cria um mapa de blocos local e o compara com o mapa de blocos do servidor. <br>  ‚ñ∫ Para cada bloco local diferente do remoto, ele baixa um bloco compactado do servidor e o substitui localmente. <br>  ‚óã Se n√£o houver erros, atualize o arquivo de vers√£o. <br><br>  Fiz o tamanho do bloco de dados m√∫ltiplo de 1024 bytes. Ap√≥s um certo n√∫mero de testes, decidi que era mais f√°cil operar com blocos de 64 KB.  Embora a universalidade no c√≥digo permane√ßa: <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#region DQPatcher class public class DQPatcher { </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// some internal constants // 1 minute timeout by default private const int DEFAULT_NETWORK_TIMEOUT = 60000; // maximum number of compressed blocks, which we will download at once private const UInt16 MAX_COMPRESSED_BLOCKS = 1000; // default block size, you can use range from 4k to 64k, //depending on average size of your files in the project tree private const uint DEFAULT_BLOCK_SIZE = 64 * 1024; ... #region public constants and vars section // X * 1024 bytes by default for patch creation public static uint blockSize = DEFAULT_BLOCK_SIZE; ... #endregion ....</span></span></span></span></code> </pre> <br>  Se voc√™ reduzir os blocos, o cliente precisar√° de menos altera√ß√µes quando as altera√ß√µes forem poucas.  No entanto, surge outro problema - o tamanho do arquivo de √≠ndice aumenta inversamente com a diminui√ß√£o no tamanho do bloco - ou seja,  se operarmos com blocos de 8 KB, o arquivo de √≠ndice ser√° 8 vezes maior que com blocos de 64 KB. <br><br>  Eu escolhi o SHA256 / 512 para arquivos e blocos das seguintes considera√ß√µes: a velocidade difere um pouco em compara√ß√£o com o (obsoleto) MD5 / SHA128, mas voc√™ ainda precisa ler blocos e arquivos.  E a probabilidade de colis√µes com o SHA256 / 512 √© significativamente menor do que com o MD5 / SHA128.  Para ser completamente chato - √© neste caso, mas √© t√£o pequeno que essa probabilidade pode ser negligenciada. <br><br>  Al√©m disso, o cliente leva em considera√ß√£o os seguintes pontos: <br>  ‚ñ∫ Os blocos de dados podem ser deslocados em diferentes vers√µes, ou seja,  localmente, temos o n√∫mero 10 e, no servidor, o n√∫mero 12 ou vice-versa.  Isso √© levado em considera√ß√£o para n√£o baixar dados extras. <br>  ‚ñ∫ Os blocos s√£o solicitados n√£o um de cada vez, mas em grupos - o cliente tenta combinar os intervalos dos blocos necess√°rios e solicita-os ao servidor usando o cabe√ßalho Range.  Isso tamb√©m minimiza a carga do servidor: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// get compressed remote blocks of data and return it to the caller // Note: we always operating with compressed data, so all offsets are in the _compressed_ data file!! // Throw an exception, if fetching compressed blocks failed public byte[] GetRemoteBlocks(string remoteName, UInt64 startByteRange, UInt64 endByteRange) { if (verboseOutput) Console.Error.WriteLine("Getting partial content for [" + remoteName + "]"); if (verboseOutput) Console.Error.WriteLine("Range is [" + startByteRange + "-" + endByteRange + "]"); int bufferSize = 1024; byte[] remoteData; byte[] buffer = new byte[bufferSize]; HttpWebRequest httpRequest = (HttpWebRequest)WebRequest.Create(remoteName); httpRequest.KeepAlive = true; httpRequest.AddRange((int)startByteRange, (int)endByteRange); httpRequest.Method = WebRequestMethods.Http.Get; httpRequest.ReadWriteTimeout = this.networkTimeout; try { // Get back the HTTP response for web server HttpWebResponse httpResponse = (HttpWebResponse)httpRequest.GetResponse(); if (verboseOutput) Console.Error.WriteLine("Got partial content length: " + httpResponse.ContentLength); remoteData = new byte[httpResponse.ContentLength]; Stream httpResponseStream = httpResponse.GetResponseStream(); if (!((httpResponse.StatusCode == HttpStatusCode.OK) || (httpResponse.StatusCode == HttpStatusCode.PartialContent))) // rise an exception, we expect partial content here { RemoteDataDownloadingException pe = new RemoteDataDownloadingException("While getting remote blocks:\n" + httpResponse.StatusDescription); throw pe; } int bytesRead = 0; int rOffset = 0; while ((bytesRead = httpResponseStream.Read(buffer, 0, bufferSize)) &gt; 0) { // if(verboseOutput) Console.Error.WriteLine("Got ["+bytesRead+"] bytes of remote data block."); Array.Copy(buffer, 0, remoteData, rOffset, bytesRead); rOffset += bytesRead; } if (verboseOutput) Console.Error.WriteLine("Total got: [" + rOffset + "] bytes"); httpResponse.Close(); } catch (Exception ex) { if (verboseOutput) Console.Error.WriteLine(ex.ToString()); PatchException pe = new PatchException("Unable to fetch URI " + remoteName, ex); throw pe; } return remoteData; }</span></span></code> </pre> <br>  Obviamente, o cliente pode ser interrompido a qualquer momento e, ap√≥s o lan√ßamento subsequente, continuar√° de fato seu trabalho e n√£o far√° o download de tudo do zero. <br><br>  Aqui voc√™ pode assistir a um v√≠deo que ilustra o trabalho do patcher no projeto de exemplo Angry Bots: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/lTyeYJcKbzo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  Sobre como o patch do universo do jogo foi organizado </h3><br>  Em setembro de 2015, Alex Koshelkov entrou em contato comigo e se ofereceu para ingressar no projeto - eles precisavam de uma solu√ß√£o que proporcionasse atualiza√ß√µes mensais a 30 mil jogadores (com uma cauda).  O tamanho inicial do jogo no arquivo morto √© de 600 megabytes.  Antes de entrar em contato comigo, houve tentativas de criar sua pr√≥pria vers√£o usando o Electron, mas tudo se deparou com o mesmo problema de arquivos abertos (a prop√≥sito, a vers√£o atual do Electron pode fazer isso) e alguns outros.  Al√©m disso, nenhum dos desenvolvedores entendeu como tudo isso funcionaria - eles me forneceram v√°rios designs de bicicletas, a parte do servidor estava ausente - eles queriam fazer isso depois que todas as outras tarefas fossem resolvidas. <br><br>  Al√©m disso, foi necess√°rio resolver o problema de como evitar o vazamento das chaves dos jogadores - o fato √© que as chaves eram para a plataforma Steam, embora o pr√≥prio jogo no Steam ainda n√£o estivesse dispon√≠vel ao p√∫blico.  A distribui√ß√£o do jogo era exigida estritamente pela chave - embora houvesse uma chance de os jogadores compartilharem a chave do jogo com os amigos, isso poderia ser negligenciado, pois se o jogo aparecesse no Steam, a chave poderia ser ativada apenas uma vez. <br><br>  Na vers√£o normal do patcher, a √°rvore de dados do patch se parece com: <br><pre> ./
 | - linux
 |  | - 1.0.0
 |  `- version.txt
 | - macosx
 |  | - 1.0.0
 |  `- version.txt
 `- janelas
     | - 1.0.0
     `- version.txt
</pre><br><br>  Eu precisava ter certeza de que apenas aqueles com a chave correta tivessem acesso. <br><br>  Eu vim com a seguinte solu√ß√£o - para cada chave obtemos seu hash (SHA1), ent√£o a usamos como um caminho para acessar os dados do patch no servidor.  No servidor, transferimos os dados do patch para um n√≠vel superior ao docroot e adicionamos links simb√≥licos ao diret√≥rio com os dados do patch no pr√≥prio docroot.  Os links simb√≥licos t√™m os mesmos nomes que os hashes de chave, divididos apenas em v√°rios n√≠veis (para facilitar a opera√ß√£o do sistema de arquivos), ou seja,  o hash 0f99e50314d63c30271 ... ... ade71963e7ff ser√° representado como <br><pre> ./0f/99/e5/0314d63c30271.....ade71963e7ff -----&gt; / full / path / to / patch-data /
</pre><br>  Portanto, n√£o √© necess√°rio distribuir as chaves para algu√©m que oferecer√° suporte aos servidores de atualiza√ß√£o - basta transferir seus hashes, que s√£o absolutamente in√∫teis para os pr√≥prios jogadores. <br><br>  Para adicionar novas chaves (ou excluir antigas) - basta adicionar / remover o link simb√≥lico correspondente. <br><br>  Com essa implementa√ß√£o, a verifica√ß√£o da chave em si obviamente n√£o √© executada em nenhum lugar; o recebimento de erros 404 no cliente indica que a chave est√° incorreta (ou foi desativada). <br><br>  Deve-se observar que o acesso √† chave n√£o √© uma prote√ß√£o completa de DRM - essas s√£o apenas restri√ß√µes no est√°gio dos testes alfa e beta (fechados).  E a pesquisa √© facilmente cortada pelos pr√≥prios servidores da Web (pelo menos no Nginx, que eu uso). <br><br>  No m√™s de lan√ßamento, apenas 2,5 TB de tr√°fego foram entregues apenas no primeiro dia, nos dias seguintes, aproximadamente a mesma quantidade √© distribu√≠da em m√©dia por m√™s: <br><br><img src="https://habrastorage.org/webt/nl/a8/xn/nla8xn_apxlj7gfk20fyhdtm5xi.png" alt="imagem"><br><br>  Portanto, se voc√™ planeja distribuir muito conte√∫do, √© melhor calcular com anteced√™ncia quanto vai custar.  De acordo com observa√ß√µes pessoais - o tr√°fego mais barato dos hosters europeus, o mais caro (eu diria "ouro") da Amazon e do Google. <br><br>  Na pr√°tica, as economias de tr√°fego por ano, em m√©dia, na The Universim s√£o enormes - compare os n√∫meros acima.  Obviamente, se o usu√°rio n√£o tiver um jogo ou estiver muito desatualizado, um milagre n√£o acontecer√° e ele ter√° que baixar muitos dados do servidor - se for do zero, um pouco mais do que o jogo leva no arquivo morto.  No entanto, com atualiza√ß√µes mensais, as coisas ficam realmente boas.  Em menos de 6 meses, o espelho americano forneceu pouco mais de 10 TB de tr√°fego, sem o uso de um remendador esse valor teria crescido significativamente. <br><br>  √â assim que o tr√°fego anual do projeto se parece: <br><br><img src="https://habrastorage.org/webt/1f/h_/e4/1fh_e4-xudejikja5ekk_9iixti.png" alt="imagem"><br><br>  Algumas palavras sobre o "rake" mais memor√°vel que tivemos que trabalhar no processo de cria√ß√£o de um patch personalizado para o jogo "The Universim": <br><br>  ‚óè O maior problema estava me esperando dos antiv√≠rus.  Bem, eles n√£o gostam de aplicativos que baixam algo da Internet, modificam arquivos (incluindo execut√°veis) e tamb√©m tentam executar o download.  Alguns antiv√≠rus n√£o apenas bloquearam o acesso a arquivos locais - eles tamb√©m bloquearam as chamadas para o servidor de atualiza√ß√£o, obtendo diretamente os dados que o cliente baixou.  A solu√ß√£o foi usar uma assinatura digital v√°lida para o patcher - isso reduz drasticamente a paran√≥ia dos antiv√≠rus e o uso do protocolo HTTPS em vez do HTTP - elimina rapidamente alguns dos erros associados √† curiosidade dos antiv√≠rus. <br><br>  Atualiza√ß√£o de progresso.  Muitos usu√°rios (e clientes) desejam ver o progresso da atualiza√ß√£o.  √â preciso improvisar, pois nem sempre √© poss√≠vel mostrar de maneira confi√°vel o progresso sem a necessidade de um trabalho extra.  Sim, e a hora exata do final do processo do patch tamb√©m n√£o pode ser exibida, pois o pr√≥prio patcher n√£o possui dados nos quais os arquivos precisam ser atualizados com anteced√™ncia. <br><br>  ‚óè Um grande n√∫mero de usu√°rios dos EUA tem velocidades de conex√£o com servidores da Europa n√£o muito altas.  A migra√ß√£o do servidor de atualiza√ß√£o para os EUA resolveu esse problema.  Para usu√°rios de outros continentes, deixamos o servidor na Alemanha.  A prop√≥sito, o tr√°fego nos EUA √© muito mais caro que o europeu, em alguns casos - v√°rias dezenas de vezes. <br><br>  ‚óè A Apple n√£o est√° muito confort√°vel com esse m√©todo de instala√ß√£o de aplicativos.  Pol√≠tica oficial - os aplicativos devem ser instalados apenas em sua loja.  Mas o problema √© que os aplicativos nos est√°gios alfa e beta n√£o s√£o permitidos na loja.  E ainda mais, n√£o h√° nada a falar sobre a venda de aplicativos brutos do acesso antecipado.  Portanto, voc√™ deve escrever instru√ß√µes sobre como dan√ßar em papoulas.  A op√ß√£o com AppAnnie (ent√£o eles ainda eram independentes) n√£o foi considerada devido ao limite no n√∫mero de testadores. <br><br>  ‚óè A rede √© bastante imprevis√≠vel.  Para que o aplicativo n√£o desista imediatamente, tive que inserir um contador de erros.  As nove exce√ß√µes capturadas permitem que voc√™ informe firmemente ao usu√°rio que ele tem problemas com a rede. <br><br>  ‚óè Os sistemas operacionais de 32 bits t√™m restri√ß√µes no tamanho dos arquivos que s√£o exibidos na mem√≥ria (MMF) para cada segmento de execu√ß√£o e para o processo como um todo.  As primeiras vers√µes do patcher usavam o MMF para acelerar o trabalho, mas como os arquivos de recursos do jogo podem ser enormes, tive que abandonar essa abordagem e usar fluxos de arquivos comuns.  A prop√≥sito, uma perda de desempenho especial n√£o foi observada - provavelmente devido √† leitura proativa do sistema operacional. <br><br>  ‚óè Voc√™ precisa estar preparado para os usu√°rios reclamarem.  N√£o importa o qu√£o bom seja o seu produto, sempre haver√° quem n√£o estiver satisfeito.  E quanto mais usu√°rios do seu produto (no caso da Universim houver mais de 50 mil no momento) - mais quantitativamente haver√° reclama√ß√µes a voc√™.  Em termos percentuais, este √© um n√∫mero muito pequeno, mas em termos quantitativos ... <br><br>  Apesar do sucesso do projeto como um todo, ele tem algumas desvantagens: <br><br>  ‚óè Apesar de inicialmente ter retirado toda a l√≥gica principal separadamente, a parte da GUI √© diferente na implementa√ß√£o para MAC e Windows.  A vers√£o Linux n√£o causou problemas - todos os problemas ocorreram principalmente apenas ao usar uma constru√ß√£o monol√≠tica que n√£o exigia o Mono Runtime Environment - MRE.  Mas como voc√™ precisa de uma licen√ßa adicional para distribuir esses arquivos execut√°veis, foi decidido abandonar as constru√ß√µes monol√≠ticas e simplesmente exigir o MRE.  A vers√£o Linux difere da vers√£o Windows apenas no suporte a atributos de arquivo espec√≠ficos para sistemas * nix.  Para o meu segundo projeto, que ser√° mais do que apenas um patcher, planejo usar uma abordagem modular na forma de um processo do kernel que √© executado em segundo plano e permite gerenciar tudo na interface local.  E o controle em si pode ser realizado a partir de um aplicativo baseado no Electron e similares (ou simplesmente a partir de um navegador).  Com qualquer coisinha.  Antes de falar sobre o tamanho da distribui√ß√£o de tais aplicativos - veja o tamanho dos jogos.  As vers√µes demo (!!!) de algumas ocupam 5 ou mais gigabytes no arquivo (!!!). <br><br>  ‚óè As estruturas usadas agora n√£o economizam espa√ßo quando o jogo √© lan√ßado para 3 plataformas - de fato, voc√™ precisa manter 3 c√≥pias de dados quase id√™nticos, embora compactados. <br><br>  ‚óè A vers√£o atual do patcher n√£o armazena em cache seu trabalho - sempre que todas as somas de verifica√ß√£o de todos os arquivos s√£o recalculadas.  Seria poss√≠vel reduzir significativamente o tempo se o patcher colocasse em cache os resultados para os arquivos que j√° est√£o no cliente.  Mas h√° um dilema - se o arquivo estiver danificado (ou ausente), mas a entrada de cache desse arquivo for salva, o patcher o ignorar√°, o que causar√° problemas. <br><br>  ‚óè A vers√£o atual n√£o sabe trabalhar simultaneamente com v√°rios servidores (a menos que voc√™ fa√ßa round-robin usando DNS) - eu gostaria de mudar para uma tecnologia ‚Äúsemelhante a torrent‚Äù para poder usar v√°rios servidores ao mesmo tempo.  N√£o h√° d√∫vida de usar clientes como fonte de dados, pois isso levanta muitos problemas legais e √© mais f√°cil recusar desde o in√≠cio. <br><br>  ‚óè Se voc√™ deseja restringir o acesso a atualiza√ß√µes, essa l√≥gica precisar√° ser implementada independentemente.  Na verdade, isso dificilmente pode ser chamado de desvantagem, pois todos podem ter seus pr√≥prios desejos em rela√ß√£o √†s restri√ß√µes.  A restri√ß√£o de chave mais simples - sem nenhuma parte do servidor - √© bastante simples, como mostrei acima. <br><br>  ‚óè Um patcher √© criado para apenas um projeto por vez.  Se voc√™ deseja criar algo semelhante ao Steam, j√° √© necess√°rio um sistema completo de entrega de conte√∫do.  E este √© um projeto de um n√≠vel completamente diferente. <br><br>  Eu pretendo colocar o patcher em dom√≠nio p√∫blico depois que a "segunda gera√ß√£o" for implementada - um sistema de entrega de conte√∫do de jogos que incluir√° n√£o apenas o patcher desenvolvido, mas tamb√©m um m√≥dulo de telemetria (j√° que os desenvolvedores precisam saber o que os jogadores est√£o fazendo), M√≥dulo Cloud Savings e alguns outros m√≥dulos. <br><br>  Se voc√™ tem um projeto sem fins lucrativos e precisa de um remendador, escreva-me os detalhes do seu projeto e eu darei uma c√≥pia gratuitamente.  N√£o haver√° links aqui, pois esse n√£o √© o hub "PR". <br><br>  Ficarei feliz em responder suas perguntas. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt440870/">https://habr.com/ru/post/pt440870/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt440856/index.html">Como o espa√ßo e o tempo podem ser um c√≥digo qu√¢ntico de corre√ß√£o de erros</a></li>
<li><a href="../pt440858/index.html">Existem muitos programas para aprender ingl√™s, mas vale a pena us√°-los se voc√™ √© um programador?</a></li>
<li><a href="../pt440862/index.html">Padr√µes e anti-padr√µes de CI / CD. Parte 1</a></li>
<li><a href="../pt440864/index.html">A hist√≥ria tr√°gica de namoro poppler</a></li>
<li><a href="../pt440866/index.html">Telefones p√∫blicos na R√∫ssia querem complementar o Minist√©rio de Situa√ß√µes de Emerg√™ncia</a></li>
<li><a href="../pt440872/index.html">PostGIS e JPA</a></li>
<li><a href="../pt440874/index.html">Implementando o movimento livre de part√≠culas no ReactJS</a></li>
<li><a href="../pt440878/index.html">An√°lise da Web para empresas</a></li>
<li><a href="../pt440880/index.html">Os 10 principais sensores de IoT em 2019</a></li>
<li><a href="../pt440882/index.html">Fuja do Crypto Pro. Edi√ß√£o GOST 34.10-2012</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>