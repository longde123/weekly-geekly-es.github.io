<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤹🏼 🔢 🚞 Analyse du code source Emby avec l'analyseur PVS-Studio 👩‍👩‍👧‍👦 👨🏿‍💻 🔈</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Emby est un serveur multimédia assez bien connu, avec Plex et Kodi. Dans cet article, nous allons essayer de vérifier son code source à l'aide de l'an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Analyse du code source Emby avec l'analyseur PVS-Studio</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/484050/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/rr/ar/h3/rrarh3smm2vkgpopwdn2fgqan0s.png" alt="Image 3"></div><br>  Emby est un serveur multimédia assez bien connu, avec Plex et Kodi.  Dans cet article, nous allons essayer de vérifier son code source à l'aide de l'analyseur statique PVS-Studio.  Sur le site officiel d'Emby, il y a une petite marque «Built with ReSharper».  Eh bien, c'est encore plus intéressant. <br><a name="habracut"></a><br><h2>  Analyseur de code PVS-Studio </h2><br>  PVS-Studio fonctionne sur des systèmes 64 bits sous Windows, Linux et macOS.  Il sait rechercher les erreurs dans le code source des programmes écrits en C, C ++, C # et Java. <br><br><h2>  Projet audité </h2><br>  Emby est un serveur multimédia dont le code source se trouve sur <a href="https://github.com/MediaBrowser/Emby">GitHub</a> .  Il vous permet d'organiser des diffusions et permet d'accéder au contenu multimédia (vidéo, audio, photos) depuis n'importe quel appareil.  Squeeze depuis le site officiel d' <a href="https://emby.media/">Emby</a> : <br><br><ul><li>  Emby convertit automatiquement vos médias à la volée pour les lire sur n'importe quel appareil; </li><li>  Des contrôles parentaux étendus facilitent le contrôle de l'accès au contenu, qui sera pertinent pour les familles avec de jeunes enfants; </li><li>  Emby organise vos médias en présentations simples et élégantes.  Ils ne se ressembleront jamais; </li><li>  Streaming de données avec synchronisation dans le cloud; </li><li>  Partagez facilement vos fichiers multimédias avec vos amis et votre famille; </li><li>  Et bien plus. </li></ul><br><h2>  Morceaux de code qui ont retenu l'attention lors de l'examen d'un rapport d'analyseur </h2><br>  <b>PVS-Studio Warning:</b> <a href="https://www.viva64.com/ru/w/v3001/">V3001</a> Il existe des sous-expressions identiques 'c! =' &lt;'' À gauche et à droite de l'opérateur '&amp;&amp;'.  HttpListenerRequest.Managed.cs 49 <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetRequestLine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> req</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((ic &gt;= <span class="hljs-string"><span class="hljs-string">'A'</span></span> &amp;&amp; ic &lt;= <span class="hljs-string"><span class="hljs-string">'Z'</span></span>) || (ic &gt; <span class="hljs-number"><span class="hljs-number">32</span></span> &amp;&amp; c &lt; <span class="hljs-number"><span class="hljs-number">127</span></span> &amp;&amp; c != <span class="hljs-string"><span class="hljs-string">'('</span></span> &amp;&amp; c != <span class="hljs-string"><span class="hljs-string">')'</span></span> &amp;&amp; c != <span class="hljs-string"><span class="hljs-string">'&lt;'</span></span> &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">// &lt;= c != '&lt;' &amp;&amp; c != '&gt;' &amp;&amp; c != '@' &amp;&amp; c != ',' &amp;&amp; c != ';' &amp;&amp; // &lt;= c != ':' &amp;&amp; c != '\\' &amp;&amp; c != '"' &amp;&amp; c != '/' &amp;&amp; c != '[' &amp;&amp; c != ']' &amp;&amp; c != '?' &amp;&amp; c != '=' &amp;&amp; c != '{' &amp;&amp; c != '}')) continue; .... }</span></span></code> </pre> <br>  L'analyseur a détecté une sous-expression en double <i>c! = '&lt;'</i> .  Peut-être qu'une erreur s'est glissée dans ce code, et quelque chose d'autre aurait dû être à la place de <i>«&lt;»</i> .  Ou, plus probablement, la deuxième sous-expression est superflue et il vous suffit de la supprimer. <br><br>  <b>Avertissement PVS-Studio:</b> <a href="https://www.viva64.com/ru/w/v3001/">V3001</a> Il existe des sous-expressions identiques «SmbConstants.AttrHidden» à gauche et à droite de «|»  opérateur.  SmbComDelete.cs 29 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SmbComDelete</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileName</span></span></span><span class="hljs-function">)</span></span> { Path = fileName; Command = SmbComDelete; _searchAttributes = SmbConstants.AttrHidden | SmbConstants.AttrHidden | SmbConstants.AttrSystem; }</code> </pre> <br>  L'analyseur a de nouveau trouvé une faute de frappe associée à des sous-expressions répétées.  Pour l'avenir, je dirai que dans ce projet, il y a un peu trop d'erreurs similaires faites par négligence.  Je ne reproche pas du tout aux créateurs d'Emby, nous sommes parfois parfois dispersés de cette façon ( <a href="https://www.viva64.com/ru/examples/v501/">exemples</a> , <a href="https://www.viva64.com/ru/examples/v3001/">exemples</a> , <a href="https://www.viva64.com/ru/examples/v6001/">exemples</a> ), et pour être à l'abri de telles erreurs, il n'y a qu'une analyse statique. <br><br>  <b>PVS-Studio Warning:</b> <a href="https://www.viva64.com/ru/w/v3004/">V3004</a> L' <a href="https://www.viva64.com/ru/w/v3004/">instruction</a> 'then' est équivalente à l'instruction 'else'.  SqliteItemRepository.cs 5648 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> QueryResult&lt;Tuple&lt;BaseItem, ItemCounts&gt;&gt; GetItemValues(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (typesToCount.Length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { whereText += <span class="hljs-string"><span class="hljs-string">" And CleanName In (Select CleanValue from ItemValues where "</span></span> + typeClause + <span class="hljs-string"><span class="hljs-string">" AND ItemId in (select guid from TypedBaseItems"</span></span> + innerWhereText + <span class="hljs-string"><span class="hljs-string">"))"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">//whereText += " And itemTypes not null"; whereText += " And CleanName In (Select CleanValue from ItemValues where " + typeClause + " AND ItemId in (select guid from TypedBaseItems" + innerWhereText + "))"; } .... }</span></span></code> </pre> <br>  Et cela est très similaire au problème qui est apparu en raison du copier-coller, car  <i>si</i> et <i>sinon</i> les corps de bloc sont complètement identiques.  Pourquoi avez-vous eu besoin de vérifier les tailles du tableau <i>typesToCount</i> si, quel que soit le nombre d'éléments qui y sont écrits, le même code sera exécuté - il n'est connu que des développeurs. <br><br>  <b>PVS-Studio Warning:</b> <a href="https://www.viva64.com/ru/w/v3005/">V3005</a> La variable '_validProviderIds' est assignée à elle-même.  BaseNfoParser.cs 77 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; _validProviderIds; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Fetch</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... _validProviderIds = _validProviderIds = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;....&gt;(....); .... }</code> </pre> <br>  Encore une fois, une faute de frappe, qui impliquait l'affectation d'une variable à elle-même.  Il vaut la peine de revérifier ce morceau de code. <br><br>  <b>PVS-Studio Warning:</b> <a href="https://www.viva64.com/ru/w/v3008/">V3008</a> La variable 'Chapitres' se voit attribuer des valeurs deux fois de suite.  C'est peut-être une erreur.  Lignes de contrôle: 29, 28. Title.cs 29 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Title</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> titleNum</span></span></span><span class="hljs-function">)</span></span> { ProgramChains = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ProgramChain&gt;(); Chapters = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Chapter&gt;(); Chapters = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Chapter&gt;(); TitleNumber = titleNum; }</code> </pre> <br>  Inattention et fautes de frappe, encore une fois ... La variable <i>Chapitres se voit</i> attribuer une valeur deux fois.  Il est clair que ce code supplémentaire ne menace rien de mauvais, mais néanmoins.  Cela n'a aucun sens de s'attarder sur cet exemple, passons à autre chose. <br><br>  <b>Avertissement PVS-Studio:</b> <a href="https://www.viva64.com/ru/w/v3013/">V3013</a> Il est étrange que le corps de la fonction 'Lecture' soit entièrement équivalent au corps de la fonction 'Ecriture' (407, ligne 415).  BaseSqliteRepository.cs 407 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IDisposable </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Read</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ReaderWriterLockSlim obj</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WriteLockToken(obj); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IDisposable </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Write</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ReaderWriterLockSlim obj</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WriteLockToken(obj); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WriteLockToken</span></span> : <span class="hljs-title"><span class="hljs-title">IDisposable</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ReaderWriterLockSlim _sync; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteLockToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ReaderWriterLockSlim sync</span></span></span><span class="hljs-function">)</span></span> { _sync = sync; sync.EnterWriteLock(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dispose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_sync != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _sync.ExitWriteLock(); _sync = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br>  Les corps des fonctions de <i>lecture</i> et d' <i>écriture</i> sont absolument identiques les uns aux autres, comme en témoigne le texte d'avertissement de l'analyseur.  La méthode <a href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlockslim.enterwritelock%3Fview%3Dnetframework-4.8"><i>EnterWriteLock est</i></a> nécessaire pour entrer le verrou en mode écriture.  Pour le mode de lecture, il vaut la peine d'utiliser la méthode <i>EnterReadLock</i> , qui permet de lire une ressource simultanément dans plusieurs threads. <br><br>  Le développeur devrait examiner de plus près cette section du code, il y a peut-être une erreur.  De plus, la classe suivante a été rencontrée dans le code, qui n'est pas utilisée: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ReadLockToken</span></span> : <span class="hljs-title"><span class="hljs-title">IDisposable</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ReaderWriterLockSlim _sync; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadLockToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ReaderWriterLockSlim sync</span></span></span><span class="hljs-function">)</span></span> { _sync = sync; sync.EnterReadLock(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dispose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_sync != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _sync.ExitReadLock(); _sync = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br>  <b>PVS-Studio Warning:</b> <a href="https://www.viva64.com/ru/w/v3021/">V3021</a> Il existe deux instructions 'if' avec des expressions conditionnelles identiques.  La première instruction «if» contient la méthode return.  Cela signifie que la deuxième instruction «si» est insensée SkiaEncoder.cs 537 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EncodeImage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> inputPath, DateTime dateModified, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> outputPath, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> autoOrient, ImageOrientation? orientation, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> quality, ImageProcessingOptions options, ImageFormat selectedOutputFormat</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(inputPath)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-string"><span class="hljs-string">"inputPath"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(inputPath)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-string"><span class="hljs-string">"outputPath"</span></span>); } .... }</code> </pre> <br>  Ici, apparemment, le développeur a copié les quatre premières lignes, mais a oublié de changer la variable testée de <i>inputPath</i> en <i>outputPath</i> .  Il y a plusieurs lignes dans le code qui utilisent <i>outputPath</i> sans vérifier la valeur <i>null</i> , ce qui peut entraîner la levée d'une exception. <br><br>  <b>Avertissements de PVS-Studio:</b> <br><br><ul><li>  V3022 L'expression 'processUnsupportedFrame (frame, CloseStatusCode.PolicyViolation, null)' est toujours false.  WebSocket.cs 462 </li><li>  V3022 L'expression 'processCloseFrame (frame)' est toujours fausse.  WebSocket.cs 461 </li><li>  V3022 Expression 'frame.IsClose?  processCloseFrame (frame): processUnsupportedFrame (frame, CloseStatusCode.PolicyViolation, null) 'est toujours false.  WebSocket.cs 460 </li><li>  V3022 L'expression 'processPongFrame (frame)' est toujours vraie.  WebSocket.cs 459 </li><li>  V3022 L'expression 'processPingFrame (frame)' est toujours vraie.  WebSocket.cs 457 </li><li>  V3022 L'expression 'processDataFrame (frame)' est toujours vraie.  WebSocket.cs 455 </li><li>  V3022 L'expression est toujours fausse.  WebSocket.cs 448 </li></ul><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processWebSocketFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WebSocketFrame frame</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> frame.IsCompressed &amp;&amp; _compression == CompressionMethod.None ? processUnsupportedFrame(....) : frame.IsFragmented ? processFragmentedFrame(frame) : frame.IsData ? processDataFrame(frame) : frame.IsPing ? processPingFrame(frame) : frame.IsPong ? processPongFrame(frame) : frame.IsClose ? processCloseFrame(frame) : processUnsupportedFrame(....); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processUnsupportedFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { processException(....); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDataFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WebSocketFrame frame</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processPingFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WebSocketFrame frame</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mask = Mask.Unmask; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processPongFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WebSocketFrame frame</span></span></span><span class="hljs-function">)</span></span> { _receivePong.Set(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processCloseFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WebSocketFrame frame</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> payload = frame.PayloadData; close(payload, !payload.ContainsReservedCloseStatusCode, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  Dans mon compte, il n'y en a pas tellement, en comparaison avec le reste de l'équipe PVS-Studio, vérifié par l'analyseur de projet, et peut-être que cela est en quelque sorte lié au fait que je vois d'abord que pas moins de 13 avertissements d'analyseur sont émis sur 13 lignes de code (un peu plus que toutes les deux lignes).  Par conséquent, je pense que ce code mérite d'être inclus dans l'article.  Ensuite, je vais écrire ce que l'analyseur jure spécifiquement. <br><br><ol><li>  Tout d'abord, l'expression <i>frame.IsCompressed &amp;&amp; _compression == CompressionMethod.None est prise en compte</i> et, si l'expression est vraie, la méthode <i>processUnsupportedFrame</i> sera exécutée, ce qui en tout cas renvoie <i>false</i> (d'où le premier avertissement de l'analyseur).  Si c'était faux, passez au point suivant. </li><li>  Ensuite, la valeur de <i>frame.IsFragmented est vérifiée</i> .  Il n'y a aucun problème, alors passons à autre chose. </li><li>  Ici, la valeur de <i>frame.IsData est vérifiée</i> .  Si vrai, la méthode <i>processDataFrame</i> retournera quand même <i>vrai</i> .  D'où le deuxième avertissement de l'analyseur. </li><li>  Ensuite, nous vérifions <i>frame.IsPing</i> .  True - <i>processPingFrame</i> renvoie <i>true</i> .  Il s'agit du troisième avertissement de l'analyseur. </li><li>  Nous regardons <i>frame.IsPong</i> .  Tout est similaire au précédent. </li><li>  Et le dernier: <i>frame.IsClose</i> .  <i>processCloseFrame</i> et <i>processUnsupportedFrame retournent</i> dans tous les cas <i>false</i> . </li></ol><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/sq/ut/pe/squtpenxx02rmgsg31uyqk7yt6q.png" alt="Image 1"></div><br>  J'espère que je ne t'ai pas ennuyé.  Ce sera encore plus simple. <br><br>  <b>Avertissement PVS-Studio:</b> <a href="https://www.viva64.com/ru/w/v3085/">V3085</a> Le nom du champ 'RtpHeaderBytes' dans un type imbriqué est ambigu.  Le type externe contient un champ statique avec un nom identique.  HdHomerunUdpStream.cs 200 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HdHomerunUdpStream</span></span> : <span class="hljs-title"><span class="hljs-title">LiveStream</span></span>, <span class="hljs-title"><span class="hljs-title">IDirectStreamProvider</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> RtpHeaderBytes = <span class="hljs-number"><span class="hljs-number">12</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UdpClientStream</span></span> : <span class="hljs-title"><span class="hljs-title">Stream</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> RtpHeaderBytes = <span class="hljs-number"><span class="hljs-number">12</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> PacketSize = <span class="hljs-number"><span class="hljs-number">1316</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> MediaBrowser.Model.Net.ISocket _udpClient; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> disposed; .... } .... }</code> </pre> <br>  La classe imbriquée <i>UdpClientStream</i> utilise un champ avec un nom similaire à celui utilisé dans la classe externe <i>HdHomerunUdpStream</i> .  Ce n'est pas une erreur, mais c'est une bonne raison de vérifier si tout va bien avec ce code.  Son problème est qu'il y a une chance de confondre ces deux variables, et le code ne fonctionnera pas comme prévu par le développeur, bien qu'il ne provoque pas de plaintes du compilateur. <br><br>  <b>Avertissements de PVS-Studio:</b> <br><br><ul><li>  V3090 Verrouillage non sécurisé sur un type.  Toutes les instances d'un type auront le même objet 'Type'.  Lmhosts.cs 49 </li><li>  V3090 Verrouillage non sécurisé sur un type.  Toutes les instances d'un type auront le même objet 'Type'.  Lmhosts.cs 57 </li></ul><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Lmhosts</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> NbtAddress </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetByName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> host</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Lmhosts)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetByName(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Name(host, <span class="hljs-number"><span class="hljs-number">0x20</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>)); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> NbtAddress </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetByName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Name name</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Lmhosts)) { .... } } }</code> </pre> <br>  L'analyseur avertit qu'un verrou non sécurisé est utilisé dans ce fragment de code.  L'utilisation de <i>verrou est</i> indésirable car l'objet utilisé pour le verrouillage est partagé et peut être utilisé pour verrouiller ailleurs à l'insu du développeur qui a utilisé cet objet pour la première fois.  Le résultat sera un blocage sur le même objet. <br><br>  Idéalement, vous devez utiliser un champ privé pour le verrouillage, par exemple, comme ceci: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Object locker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> NbtAddress </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetByName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> host</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (locker) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetByName(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Name(host, <span class="hljs-number"><span class="hljs-number">0x20</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>)); } }</code> </pre> <br>  <b>Avertissement PVS-Studio:</b> V3142 Code inaccessible détecté.  Il est possible qu'une erreur soit présente.  HdHomerunHost.cs 621 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;ILiveStream&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetChannelStream</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> enableHttpStream = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (enableHttpStream) { mediaSource.Protocol = MediaProtocol.Http; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> httpUrl = channelInfo.Path; <span class="hljs-comment"><span class="hljs-comment">// If raw was used, the tuner doesn't support params if (!string.IsNullOrWhiteSpace(profile) &amp;&amp; !string.Equals(profile, "native", StringComparison.OrdinalIgnoreCase)) { httpUrl += "?transcode=" + profile; } mediaSource.Path = httpUrl; return new SharedHttpStream(....); } return new HdHomerunUdpStream(....); }</span></span></code> </pre> <br>  L'analyseur indique que la dernière ligne de ce fragment de code ne sera jamais exécutée.  Et pourquoi le développeur déclare et définit la variable enableHttpStream sur true, puis vérifie immédiatement cette variable dans l'instruction if? <br><br>  Peut-être que ce code est simplement redondant.  Dans tous les cas, cela mérite une double vérification. <br><br>  <b>Avertissement PVS-Studio:</b> <a href="https://www.viva64.com/ru/w/v3083/">V3083 Appel</a> non sécurisé de l'événement 'RefreshStarted', NullReferenceException est possible.  Pensez à affecter un événement à une variable locale avant de l'invoquer.  ProviderManager.cs 943 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnRefreshStart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BaseItem item</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (RefreshStarted != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { RefreshStarted(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GenericEventArgs&lt;BaseItem&gt;(item)); } }</code> </pre> <br>  Cette méthode utilise un appel potentiellement dangereux au <i>gestionnaire d'</i> événements <i>RefreshStarted</i> , comme l'indique l'analyseur. <br><br>  Je vais maintenant expliquer pourquoi l'analyseur a considéré cet appel <i>RefreshStarted</i> dans le code comme non sûr.  Supposons, au moment entre la vérification de <i>null</i> et l'appel direct du gestionnaire d'événements dans le corps <i>if</i> , une désinscription de l'événement dans un autre thread est effectuée.  Et, s'il n'y a plus d'abonnés, <i>RefreshStarted</i> sera <i>nul</i> .  Mais dans un autre thread, où une vérification <i>nulle</i> s'est déjà produite, la ligne suivante sera exécutée: <br><pre> <code class="cs hljs">RefreshStarted(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GenericEventArgs&lt;BaseItem&gt;(item));</code> </pre> <br>  Cela <i>lèvera</i> une <i>exception NullReferenceException</i> . <br><br>  <b>Avertissement PVS-Studio:</b> <a href="https://www.viva64.com/ru/w/v3029/">V3029</a> Les expressions conditionnelles des instructions «if» situées côte à côte sont identiques.  Vérifiez les lignes: 142, 152. LocalImageProvider.cs 142 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PopulateImages</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-comment"><span class="hljs-comment">// Logo if (!isEpisode &amp;&amp; !isSong &amp;&amp; !isPerson) { added = AddImage(....); if (!added) { added = AddImage(....); } } // Art if (!isEpisode &amp;&amp; !isSong &amp;&amp; !isPerson) { AddImage(....); } .... }</span></span></code> </pre> <br>  Dans ce morceau de code côte à côte se trouvent deux <i>instructions if</i> avec les mêmes conditions.  Les corps des <i>instructions if</i> sont différents.  Difficile de dire s'il s'agit d'une erreur ou d'un code redondant.  Peut-être que tout va bien et que l'auteur voulait juste séparer logiquement deux actions différentes, dont l'une est associée à un certain «Logo» et la seconde à un certain «Art». <br><br>  <b>PVS-Studio Warning:</b> <a href="https://www.viva64.com/ru/w/v3041/">V3041</a> L'expression a été implicitement <a href="https://www.viva64.com/ru/w/v3041/">convertie</a> du type 'int' en type 'double'.  Pensez à utiliser un transtypage de type explicite pour éviter la perte d'une partie fractionnaire.  Un exemple: double A = (double) (X) / Y;.  LiveTvManager.cs 1085 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RefreshChannelsInternal</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> progressPerService = _services.Length == <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-number"><span class="hljs-number">0</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span> / _services.Length; .... }</code> </pre> <br>  Ce code contient l'opération de division des types de données entiers.  La valeur résultante est implicitement convertie en un type à virgule flottante, ce qui est extrêmement suspect. <br><br>  En fait, la variable <i>progressPerService</i> ne sera égale à 1.0 que si <i>_services.Length = 1</i> .  Pour toute autre valeur <i>_services.Length</i> , le résultat sera <i>0,0</i> . <br><br>  Apparemment, il devrait être écrit ici: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span> progressPerService = _services.Length == <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-number"><span class="hljs-number">0</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)<span class="hljs-number"><span class="hljs-number">1</span></span> / _services.Length;</code> </pre> <br><br>  <b>Avertissement PVS-Studio:</b> <a href="https://www.viva64.com/ru/w/v3050/">V3050</a> Peut-être un HTML incorrect.  La balise de fermeture &lt;/u&gt; a été rencontrée, tandis que la balise &lt;/i&gt; était attendue.  SrtParserTests.cs 64 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestParse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> expectedSubs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SubtitleTrackInfo { TrackEvents = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SubtitleTrackEvent[] { .... <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SubtitleTrackEvent { Id = <span class="hljs-string"><span class="hljs-string">"6"</span></span>, StartPositionTicks = <span class="hljs-number"><span class="hljs-number">330000000</span></span>, EndPositionTicks = <span class="hljs-number"><span class="hljs-number">339990000</span></span>, Text = <span class="hljs-string"><span class="hljs-string">"This contains nested &lt;b&gt;bold, &lt;i&gt;italic, &lt;u&gt;underline&lt;/u&gt; and &lt;s&gt;strike-through&lt;/s&gt;&lt;/u&gt;&lt;/i&gt;&lt;/b&gt; HTML tags"</span></span> }, .... } }; }</code> </pre> <br>  Faites attention à la ligne <br><br><pre> <code class="cs hljs">&lt;u&gt;underline&lt;/u&gt;</code> </pre> <br>  Il a déjà une balise de fermeture <i>&lt;/u&gt;</i> .  Ensuite, nous voyons ce texte: <br><pre> <code class="cs hljs">&lt;/s&gt;&lt;/u&gt;&lt;/i&gt;&lt;/b&gt; HTML tags<span class="hljs-string"><span class="hljs-string">"</span></span></code> </pre> <br>  Ici, la balise de fermeture <i>&lt;/u&gt; est</i> superflue, comme l'indique l'analyseur. <br>  <b>Avertissement PVS-Studio:</b> <a href="https://www.viva64.com/ru/w/v3051/">V3051</a> Une vérification de type excessive.  L'objet est déjà du type 'Exception'.  SmbFileInputStream.cs 107 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> IOException </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SeToIoe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SmbException se</span></span></span><span class="hljs-function">)</span></span> { IOException ioe = se; Exception root = se.GetRootCause(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (root <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> TransportException) { ioe = (TransportException)root; root = ((TransportException)ioe).GetRootCause(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (root <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Exception) { ioe = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IOException(root.Message); ioe.InitCause(root); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ioe; }</code> </pre> <br>  Et ici, franchement, ce n'est pas tout à fait clair ce que le développeur voulait généralement réaliser.  L'analyseur avertit que la deuxième <i>instruction if</i> vérifie la compatibilité de l'objet <i>racine</i> avec son propre type.  Il s'agit très probablement d'un code redondant, mais il semble suspect, le développeur devrait y regarder de plus près. <br><br><h2>  Conclusion </h2><br>  Dans tous les sens, les développeurs ont fait un excellent travail en créant Emby (le projet a 215 539 lignes de code, 4,6% - commentaires).  Ils sont super, vraiment.  Cependant, l'analyseur a également essayé en émettant des avertissements des <a href="https://www.viva64.com/ru/m/0007/">niveaux</a> élevé - 113, moyen - 213 et bas - 112. Certains d'entre eux étaient des faux positifs, mais la plupart des erreurs n'apparaissaient pas dans l'article parce qu'elles se ressemblaient. <br><br>  Par exemple, les avertissements <a href="https://www.viva64.com/ru/w/v3022/">V3022 seuls</a> (l'expression est toujours fausse / vraie) ont marqué 106 pièces.  Vous pouvez, bien sûr, vérifier quelle partie d'entre eux était de faux positifs et ajouter le reste à l'article, mais cela se révélera un texte très ennuyeux que personne ne lira. <br><br>  J'espère avoir réussi à démontrer l'utilité de l'analyseur statique dans le développement.  Bien sûr, les contrôles ponctuels ne suffisent pas et un analyseur statique doit être utilisé de façon continue.  Vous pouvez en savoir plus à ce sujet dans l'article <a href="https://www.viva64.com/ru/b/0594/">Godot: Sur l'utilisation régulière des analyseurs de code statique</a> . <br><br><p> <a href="https://habr.com/en/company/pvs-studio/blog/484046/"><img src="https://habrastorage.org/getpro/habr/post_images/898/3b6/5a7/8983b65a74adb29a2113eba12fbec3f1.png" align="left"></a> </p><br><br>  Si vous souhaitez partager cet article avec un public anglophone, veuillez utiliser le lien vers la traduction: Ekaterina Nikiforova.  <a href="https://habr.com/en/company/pvs-studio/blog/484046/">Vérification d'Emby avec PVS-Studio</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr484050/">https://habr.com/ru/post/fr484050/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr484028/index.html">Horseshoe Bend - tablette convertible avec écran rabattable</a></li>
<li><a href="../fr484034/index.html">Mise en œuvre du plan de travail de stockage ciblé des marchandises basé sur l'unité de comptabilité d'entrepôt «1C Integrated Automation 2»</a></li>
<li><a href="../fr484036/index.html">Un nouveau groupe industriel crée une norme universelle pour les maisons intelligentes</a></li>
<li><a href="../fr484046/index.html">Vérification d'Emby avec PVS-Studio</a></li>
<li><a href="../fr484048/index.html">PHP et expressions régulières: les bases pour les débutants</a></li>
<li><a href="../fr484052/index.html">Tâches pour la base lunaire</a></li>
<li><a href="../fr484056/index.html">Votre projet a-t-il vraiment besoin de tests?</a></li>
<li><a href="../fr484062/index.html">Apprendre l'anglais par MEMASICS</a></li>
<li><a href="../fr484064/index.html">Comment préparer un jeu pour la localisation? 10 règles de base</a></li>
<li><a href="../fr484066/index.html">L'argent contre l'équipe. Pas les aspects les plus évidents de la relation entre entrepreneurs, fondateurs et investisseurs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>