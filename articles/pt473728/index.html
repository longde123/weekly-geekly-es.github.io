<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöì üï¥üèø üé¨ Implementa√ß√£o t√≠pica de monitoramento. Nikolay Sivko üòΩ üôåüèº üò¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Decodifica√ß√£o do relat√≥rio ‚ÄúImplementa√ß√£o t√≠pica de monitoramento‚Äù por Nikolay Sivko. 


 Meu nome √© Nikolai Sivko. Eu tamb√©m fa√ßo monitoramento. Okme...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Implementa√ß√£o t√≠pica de monitoramento. Nikolay Sivko</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473728/"><p>  Decodifica√ß√£o do relat√≥rio ‚ÄúImplementa√ß√£o t√≠pica de monitoramento‚Äù por Nikolay Sivko. </p><br><p>  Meu nome √© Nikolai Sivko.  Eu tamb√©m fa√ßo monitoramento.  Okmeter √© o 5 monitoramento que eu fa√ßo.  Decidi salvar todas as pessoas do inferno do monitoramento e salvar algu√©m desse sofrimento.  Eu sempre tento n√£o anunciar um okmeter nas minhas apresenta√ß√µes.  Naturalmente, as imagens ser√£o de l√°.  Mas a id√©ia do que quero dizer √© que tornamos o monitoramento uma abordagem um pouco diferente da que todos costumam fazer.  N√≥s conversamos muito sobre isso.  Quando tentamos convencer cada pessoa disso, no final, ele se convence.  Eu quero falar sobre nossa abordagem precisamente para que, se voc√™ mesmo fa√ßa o monitoramento, evite nosso rake. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/btKYOueAAzc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br><p><img src="https://habrastorage.org/webt/za/jq/fi/zajqfi-zfkopot4qxgmw79zgnp8.png"></p><br><p>  Sobre o Okmeter em poucas palavras.  Fazemos o mesmo que voc√™, mas existem todos os tipos de chips.  Fichas: </p><br><ul><li>  detalhamento; </li><li>  um grande n√∫mero de gatilhos pr√©-configurados com base nos problemas de nossos clientes; </li><li>  Configura√ß√£o autom√°tica </li></ul><br><p><img src="https://habrastorage.org/webt/nj/n0/vs/njn0vsnh6hfcyvjuejxy7qtopek.png"></p><br><p>  Um cliente t√≠pico vem at√© n√≥s.  Ele tem duas tarefas: </p><br><p>  1) entender que tudo quebrou com o monitoramento, quando n√£o h√° nada. </p><br><p>  2) conserte-o rapidamente. </p><br><p>  Ele vem para monitorar as respostas do que est√° acontecendo com ele. </p><br><p><img src="https://habrastorage.org/webt/ig/ff/fl/igffflnnpqwybqqxxw1yd0nb9tw.png"></p><br><p>  A primeira coisa que as pessoas que n√£o t√™m nada a fazer √© colocar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://www.pingdom.com/</a> e outros servi√ßos para verifica√ß√£o.  A vantagem desta solu√ß√£o √© que ela pode ser feita em 5 minutos.  Voc√™ n√£o aprender√° mais sobre o problema atrav√©s de chamadas de clientes.  Existem problemas de precis√£o para que eles ignorem os problemas.  Mas para sites simples, isso √© suficiente. </p><br><p><img src="https://habrastorage.org/webt/cz/hb/td/czhbtddbrnh7n0msqxzrqxn8_wq.png"></p><br><p>  A segunda coisa que defendemos √© contar pelos logs de acordo com estat√≠sticas de usu√°rios reais.  √â assim que um usu√°rio em particular obt√©m erros 5xx.  Qual √© o tempo de resposta dos usu√°rios.  Existem desvantagens, mas, em geral, isso funciona. </p><br><p><img src="https://habrastorage.org/webt/4g/ka/bk/4gkabkle1j9w96av-pkspnlwtis.png"></p><br><p>  Sobre o nginx: fizemos isso para que qualquer cliente que vier imediatamente coloque o agente no frontend e tudo seja captado automaticamente por ele, ele come√ßar√° a analisar, os erros come√ßar√£o a aparecer e assim por diante.  Ele n√£o tem quase nada para configurar. </p><br><p><img src="https://habrastorage.org/webt/cf/ef/5p/cfef5pftq8hwwmmb1zqfwiqyf7m.png"></p><br><p>  Mas a maioria dos clientes n√£o possui timers nos logs nginx padr√£o.  Esses 90% dos clientes n√£o querem saber o tempo de resposta do site.  Somos confrontados com isso o tempo todo.  √â necess√°rio expandir o log nginx.  Ent√£o, fora da caixa, automaticamente come√ßamos a mostrar histogramas fora da caixa.  Este √© provavelmente um aspecto importante do fato de que o tempo deve ser medido. </p><br><p><img src="https://habrastorage.org/webt/qv/yx/_x/qvyx_xrqm7dg8vqcxkonum__aws.png"></p><br><p>  O que estamos tirando de l√°?  Na pr√°tica, adotamos m√©tricas em tais dimens√µes.  Essas n√£o s√£o m√©tricas planas.  A m√©trica √© chamada index.request.rate - o n√∫mero de consultas por segundo.  √â detalhado por: </p><br><ul><li>  o host do qual voc√™ removeu os logs; </li><li>  o log do qual esses dados foram obtidos; </li><li>  http por m√©todo; </li><li>  status http; </li><li>  status do cache. </li></ul><br><p>  Este N√ÉO √© todo URL espec√≠fico com todos os argumentos.  N√£o queremos remover 100.000 m√©tricas do log. </p><br><p><img src="https://habrastorage.org/webt/u6/ah/0r/u6ah0rgp43jp3mnzdrqjpet5sza.png"></p><br><p>  Queremos tomar 1000 m√©tricas.  Portanto, estamos tentando normalizar a URL, se poss√≠vel.  Pegue o URL principal.  E para URLs significativos, mostramos um gr√°fico de barras separado, separadamente 5xx. </p><br><p><img src="https://habrastorage.org/webt/ij/dr/ir/ijdrirnx6vwpo9jfteyepp3ax_e.png"></p><br><p>  Aqui est√° um exemplo de como essa m√©trica simples se transforma em gr√°ficos utiliz√°veis.  Este √© o nosso DSL no topo.  Eu tentei esse DSL para explicar a l√≥gica aproximada.  Pegamos todas as solicita√ß√µes de nginx por segundo e as distribu√≠mos em todas as m√°quinas que possu√≠mos.  Obteve conhecimento sobre como equilibramos, quanto temos RPS total (solicita√ß√£o por segundo, solicita√ß√µes por segundo). </p><br><p><img src="https://habrastorage.org/webt/mc/hv/sv/mchvsvendei8dswx2umciwkg8qu.png"></p><br><p>  Por outro lado, podemos filtrar essa m√©trica e mostrar apenas 4xx.  Em um gr√°fico 4xx, eles podem ser dispostos de acordo com o status real.  Lembro que essa √© a mesma m√©trica. </p><br><p><img src="https://habrastorage.org/webt/uk/14/vc/uk14vcumvrmenkg4mubhonkv5gu.png"></p><br><p>  No gr√°fico, voc√™ pode mostrar 4xx por URL.  Essa √© a mesma m√©trica. </p><br><p><img src="https://habrastorage.org/webt/1l/n4/g8/1ln4g8sgwvteebpsdsbg_xmtly8.png"></p><br><p>  Tamb√©m gravamos um histograma dos logs.  Um histograma √© a m√©trica response_time.histrogram, que na verdade √© RPS com um par√¢metro de n√≠vel adicional.  Este √© apenas um tempo limite no qual a solicita√ß√£o √© recebida. </p><br><p><img src="https://habrastorage.org/webt/cb/3b/nh/cb3bnh0wosk9il_ntyywe3z1kiq.png"></p><br><p>  Desenhamos uma solicita√ß√£o: resuma todo o histograma e classifique-o em n√≠veis: </p><br><ul><li>  Pedidos lentos </li><li>  pedidos r√°pidos; </li><li>  consultas m√©dias; </li></ul><br><p>  Temos uma imagem que j√° foi resumida pelos servidores.  A m√©trica √© a mesma.  Seu significado f√≠sico √© compreens√≠vel.  Mas tiramos vantagem disso de maneiras completamente diferentes. </p><br><p><img src="https://habrastorage.org/webt/og/_q/0a/og_q0acmw4ianhc6n5sc3z4aokq.png"></p><br><p>  No gr√°fico, voc√™ pode mostrar o histograma apenas pelo URL come√ßando com "/ api".  Assim, examinamos o histograma separadamente.  N√≥s olhamos o quanto neste momento.  Vemos quantos RPS estavam no URL "/ api".  A mesma m√©trica, mas um aplicativo diferente. </p><br><p><img src="https://habrastorage.org/webt/lt/jw/46/ltjw46topobrcyeyyhkkigncknm.png"></p><br><p>  Algumas palavras sobre hor√°rios no nginx.  H√° request_time, que inclui o hor√°rio desde o in√≠cio da solicita√ß√£o at√© a transfer√™ncia do √∫ltimo byte para o soquete para o cliente.  E h√° upstream_response_time.  Eles precisam ser medidos ambos.  Se simplesmente removermos request_time, voc√™ ver√° atrasos devido a problemas de conectividade do cliente com o seu servidor; voc√™ ver√° atrasos se houver um pedido limite c burst configurado e o cliente no banho.  Voc√™ n√£o entender√° se precisa reparar o servidor ou ligar para o hoster.  Por conseguinte, removemos ambos e √© aproximadamente claro o que est√° acontecendo. </p><br><p><img src="https://habrastorage.org/webt/uy/xy/a9/uyxya9gyu-fr0ccab75sa7fjt3q.png"></p><br><p>  Com a tarefa de entender se o site est√° funcionando ou n√£o, acredito que tenhamos resolvido mais ou menos isso.  Existem erros.  Existem imprecis√µes.  Os princ√≠pios gerais s√£o os seguintes. </p><br><p>  Agora, sobre o monitoramento da arquitetura multicamada.  Porque at√© a loja on-line mais simples tem pelo menos um front-end, seguido por um bitrix e uma base.  J√° existem muitos links.  O ponto geral √© que voc√™ precisa disparar em alguns indicadores de cada n√≠vel.  Ou seja, o usu√°rio est√° pensando em frontend.  O front-end est√° pensando em back-end.  O back-end pensa no back-end vizinho.  E todos pensam na base.  Ent√£o, por camadas, por depend√™ncias, examinamos.  Cobrimos tudo com algum tipo de m√©trica.  Temos algo na sa√≠da. </p><br><p><img src="https://habrastorage.org/webt/nq/ov/rx/nqovrxw3la9pl8bkrufpklydrii.png"></p><br><p>  Por que n√£o se limitar a uma camada?  Normalmente, entre as camadas h√° uma rede.  Uma grande rede sob carga √© uma subst√¢ncia extremamente inst√°vel.  Portanto, tudo acontece l√°.  Al√©m disso, as medidas que voc√™ faz em qual camada pode estar.  Se voc√™ realizar medi√ß√µes na camada "A" e na camada "B", e se elas interagirem uma com a outra atrav√©s da rede, voc√™ poder√° comparar suas leituras, encontrar algumas anomalias e inconsist√™ncias. </p><br><p><img src="https://habrastorage.org/webt/7a/kq/ov/7akqovksuz3bhdmaxez5vcibepk.png"></p><br><p>  Sobre back-end.  Queremos entender como monitorar o back-end.  O que fazer com ele para entender rapidamente o que est√° acontecendo.  Lembro que j√° passamos √† tarefa de minimizar o tempo de inatividade.  E sobre o back-end, sugerimos padronizar o entendimento: </p><br><ul><li>  Quanto esse recurso come? </li><li>  Somos esbarrados em algum limite? </li><li>  O que est√° acontecendo com o tempo de execu√ß√£o?  Por exemplo, a plataforma de tempo de execu√ß√£o da JVM, o tempo de execu√ß√£o Golang e outro tempo de execu√ß√£o. </li><li>  Quando j√° cobrimos tudo isso, √© interessante para n√≥s j√° mais perto do nosso c√≥digo.  Podemos usar intrumetria autom√°tica (statsd, * -metric), o que nos mostrar√° tudo isso.  Ou instrua-se definindo temporizadores, contadores, etc. </li></ul><br><p><img src="https://habrastorage.org/webt/wk/xq/6p/wkxq6ptxbigdvp3evm4t2mqh3lq.png"></p><br><p>  Sobre os recursos.  Nosso agente padr√£o remove o consumo de recursos por todos os processos.  Portanto, para o back-end, n√£o precisamos capturar dados separadamente.  Tomamos e vemos quanto a CPU consome o processo, por exemplo, Python nos servidores mascarados.  Mostramos todos os servidores no cluster no mesmo gr√°fico, porque queremos entender se temos desequil√≠brios e se algo explodiu na mesma m√°quina.  Vemos o consumo total de ontem a hoje. </p><br><p><img src="https://habrastorage.org/webt/t0/fl/oe/t0floe26e2hgev70o5fs18yf4ua.png"></p><br><p>  O mesmo vale para a mem√≥ria.  Quando a desenhamos assim.  Selecionamos o Python RSS (RSS √© o tamanho das p√°ginas de mem√≥ria alocadas ao processo pelo sistema operacional e atualmente localizadas na RAM).  Soma por host.  N√£o olhamos para lugar nenhum a mem√≥ria flui.  Em todos os lugares, a mem√≥ria √© distribu√≠da uniformemente.  Em princ√≠pio, recebemos uma resposta para nossas perguntas. </p><br><p><img src="https://habrastorage.org/webt/zl/cu/yz/zlcuyz_bgzybypkgcndsotzdcsk.png"></p><br><p>  Exemplo de tempo de execu√ß√£o.  Nosso agente est√° escrito em Golang.  O agente Golang envia para si pr√≥prio m√©tricas de seu tempo de execu√ß√£o.  Esse √©, em particular, o n√∫mero de segundos gastos pelo coletor de lixo de Golang na coleta de lixo por segundo.  Vemos aqui que alguns servidores t√™m m√©tricas diferentes de outros servidores.  Vimos uma anomalia.  Estamos tentando explicar isso. </p><br><p><img src="https://habrastorage.org/webt/oj/ir/pu/ojirpuokww_ym6e1hg1yrwz_8ao.png"></p><br><p>  H√° outra m√©trica de tempo de execu√ß√£o.  Quanta mem√≥ria √© alocada por unidade de tempo.  Vemos que agentes com um tipo que est√° no topo alocam mais mem√≥ria do que agentes que baixam.  Abaixo est√£o os agentes com um Garbage Collector menos agressivo.  Isso √© l√≥gico.  Quanto mais mem√≥ria passa por voc√™, √© alocada e liberada, maior a carga no Garbage Collector.  Al√©m disso, de acordo com nossas m√©tricas internas, entendemos por que queremos tanta mem√≥ria nessas m√°quinas e menos nessas m√°quinas. </p><br><p><img src="https://habrastorage.org/webt/8h/4s/yq/8h4syq_g35fjhfdztsheuybzyrc.png"></p><br><p>  Quando falamos sobre instrumenta√ß√£o, todos os tipos de ferramentas como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://pinba.org/</a> para php v√™m.  O Pinba √© uma extens√£o para php do Badoo, que voc√™ instala e conecta ao php.  Ele permite remover e enviar imediatamente o protobuf pelo UDP.  Eles t√™m um servidor pinba.  Mas criamos um servidor Pinba incorporado no agente.  O PHP envia para si mesmo quanto gastou CPU e mem√≥ria para esses scripts, quanto tr√°fego √© fornecido por esses scripts e assim por diante.  Aqui est√° um exemplo com o Pinba.  Mostramos os 5 principais scripts sobre o consumo da CPU.  Vemos um outlier violeta que √© um ponto borrado do PHP.  Vamos reparar o ponto manchado do PHP ou entender por que ele consome a CPU.  J√° reduzimos o escopo do problema para entendermos as etapas a seguir.  Vamos examinar o c√≥digo e repar√°-lo. </p><br><p><img src="https://habrastorage.org/webt/kx/el/vv/kxelvvi9xxzv4bfefhf4m0xbhay.png"></p><br><p>  O mesmo vale para o tr√°fego.  N√≥s olhamos para os 5 principais scripts de tr√°fego.  Se isso √© importante para n√≥s, ent√£o vamos entender. </p><br><p><img src="https://habrastorage.org/webt/nz/io/zs/nziozsp_7pzn3ej88j8t3bdpenk.png"></p><br><p>  Este √© um gr√°fico sobre nossas ferramentas internas.  Quando definimos o cron√¥metro atrav√©s do statsd e medimos as m√©tricas.  Fizemos isso para que a quantidade de tempo total gasto na CPU ou na antecipa√ß√£o de algum recurso seja definida de acordo com o manipulador que estamos processando atualmente e de acordo com os est√°gios importantes do seu c√≥digo: eles esperaram pelo cassander, aguardaram pela elasticsearch.  O gr√°fico mostra os cinco principais est√°gios do manipulador / metric / query.  No gr√°fico, voc√™ pode mostrar os 5 principais manipuladores para consumo de CPU, ent√£o o que est√° acontecendo l√° dentro.  Est√° claro o que consertar. </p><br><p>  Sobre o back-end, voc√™ pode ir mais fundo.  H√° coisas que fazem rastreamento.  Ou seja, voc√™ pode ver essa solicita√ß√£o de usu√°rio espec√≠fica com um cookie e o IP e assim gerados tantas solicita√ß√µes para o banco de dados, que esperaram tanto tempo.  N√£o somos capazes de rastrear.  N√≥s n√£o estamos rastreando.  Ainda podemos acreditar que n√£o fazemos aplicativos e monitoramento de desempenho. </p><br><p><img src="https://habrastorage.org/webt/pr/zy/yf/przyyfqriaulwy_fe4swdvq2bco.png"></p><br><p>  Sobre o banco de dados.  A mesma coisa  Bancos de dados s√£o o mesmo processo.  Ele consome recursos.  Se a base for muito sens√≠vel √† lat√™ncia, haver√° recursos ligeiramente diferentes.  Sugerimos verificar se n√£o h√° menos recursos, n√£o h√° degrada√ß√£o de recursos.  √â ideal entender que, se a base come√ßar a consumir mais do que consumia, entenda o que exatamente mudou no seu c√≥digo. </p><br><p><img src="https://habrastorage.org/webt/az/zc/lj/azzcljm0hkvcfxc1lgeqeukrdgq.png"></p><br><p>  Sobre os recursos.  Da mesma forma, olhamos o quanto o processo MySQL gera em nosso disco.  Vemos que, em m√©dia, h√° muito, mas alguns picos acontecem.  Por exemplo, muitas inser√ß√µes entram e come√ßam a gravar no disco √†s 15.15, 16.15, 17.15. </p><br><p><img src="https://habrastorage.org/webt/u8/vb/rc/u8vbrcgbovxfcalnkk7sph4rw2i.png"></p><br><p>  Sobre a degrada√ß√£o de recursos.  Por exemplo, uma bateria RAID entrou no modo de manuten√ß√£o.  Ela deixou de ser um controlador como uma bateria viva.  Nesse ponto, o cache de grava√ß√£o √© desconectado, o tempo de lat√™ncia dos discos de grava√ß√£o aumenta.  Nesse momento, se o banco de dados come√ßar a ficar sem gra√ßa enquanto aguarda o disco, e voc√™ souber aproximadamente que com a mesma carga na grava√ß√£o na lat√™ncia do disco era diferente, verifique a bateria no RAID. </p><br><p><img src="https://habrastorage.org/webt/j_/ap/qb/j_apqbgrlnp5zkiopa794hq0v4y.png"></p><br><p>  Recursos sob Demanda.  N√£o √© t√£o simples aqui.  Depende da base.  A base deve ser capaz de dizer sobre si mesma: quais solicita√ß√µes gasta recursos, etc.  O l√≠der nisso √© o PostgreSQL.  Ele tem pg_stat_statements.  Voc√™ pode entender que tipo de solicita√ß√£o voc√™ tem usando muita CPU, disco de leitura e grava√ß√£o e tr√°fego. </p><br><p>  No MySQL, para ser sincero, tudo √© muito pior.  Possui performance_schema.  De alguma forma, funciona a partir da vers√£o 5.7.  Diferentemente de uma √∫nica visualiza√ß√£o no PostgreSQL, performance_schema √© uma tabela de visualiza√ß√£o do sistema de 27 ou 23 no MySQL.  √Äs vezes, se voc√™ fizer consultas nas tabelas erradas (na vis√£o errada), poder√° desperdi√ßar o MySQL. </p><br><p>  Redis tem estat√≠sticas da equipe.  Voc√™ v√™ que um determinado comando usa muita CPU, etc. </p><br><p>  Cassandra tem tempo para consultar tabelas espec√≠ficas.  Por√©m, como o cassandra foi projetado para que um tipo de consulta seja feito na tabela, isso √© suficiente para o monitoramento. </p><br><p><img src="https://habrastorage.org/webt/qx/gt/wo/qxgtwoplv8i3wnce0ncygyipfgw.png"></p><br><p>  Este √© Redis.  Vemos que o roxo usa muita CPU.  Violet √© um setex.  Setex - registro de chave com instala√ß√£o TTL.  Se isso √© importante para n√≥s, vamos lidar com isso.  Se isso n√£o for importante para n√≥s, apenas sabemos para onde v√£o todos os recursos. </p><br><p><img src="https://habrastorage.org/webt/78/x_/ng/78x_nghhya3bc-3zd2xtgd2kyxy.png"></p><br><p>  Cassandra.  Vemos as 5 principais tabelas para solicita√ß√µes de leitura pelo tempo total de resposta.  N√≥s vemos essa onda.  Essas s√£o consultas √† tabela, e entendemos aproximadamente que uma consulta nessa tabela cria um peda√ßo de c√≥digo.  Cassandra n√£o √© um banco de dados SQL no qual podemos fazer consultas diferentes em tabelas.  Cassandra est√° se tornando cada vez mais infeliz. </p><br><p><img src="https://habrastorage.org/webt/z3/ho/s3/z3hos3wz7mgt5yvh3jbw9sgodxi.png"></p><br><p>  Algumas palavras sobre o fluxo de trabalho funcionam com incidentes.  Como eu vejo. </p><br><p>  Sobre alerta.  Nossa vis√£o do fluxo de trabalho de incidentes √© diferente do que geralmente √© aceito. </p><br><p><img src="https://habrastorage.org/webt/px/zd/n4/pxzdn4r9vdjznfd6hrr2x63nmxi.png"></p><br><p>  Severy Critical.  Notificamos voc√™ por SMS e todos os canais de comunica√ß√£o em tempo real. </p><br><p>  Severy Info √© uma l√¢mpada que pode ajud√°-lo com alguma coisa ao trabalhar com incidentes.  As informa√ß√µes n√£o s√£o notificadas em nenhum lugar.  A informa√ß√£o simplesmente trava e informa que algo est√° acontecendo. </p><br><p>  Severy Warning √© algo que pode ser notificado, talvez n√£o. </p><br><p><img src="https://habrastorage.org/webt/op/hd/az/ophdazu-e1tchrtymsdxetidpq8.png"></p><br><p>  Exemplos cr√≠ticos. </p><br><p>  O site n√£o funciona de todo.  Por exemplo, 5xx 100% ou o tempo de resposta aumentou e os usu√°rios come√ßaram a sair. </p><br><p>  Erros de l√≥gica de neg√≥cios.  O que √© cr√≠tico.  √â necess√°rio medir dinheiro por segundo.  Dinheiro por segundo √© uma boa fonte de dados para a Critical.  Por exemplo, o n√∫mero de pedidos, promo√ß√£o de an√∫ncios e outros. </p><br><p><img src="https://habrastorage.org/webt/it/n3/em/itn3emdzqhe7lapptysa1nvlwjy.png"></p><br><p>  Fluxo de trabalho com Cr√≠tico, para que este incidente n√£o possa ser adiado.  Voc√™ n√£o pode clicar em OK e voltar para casa.  Se a Critical veio at√© voc√™ e voc√™ est√° pegando o metr√¥, deve sair do metr√¥, sair, tomar um banco e come√ßar a consertar.  Caso contr√°rio, n√£o √© cr√≠tico.  A partir dessas considera√ß√µes, constru√≠mos a gravidade restante para o atributo residual. </p><br><p><img src="https://habrastorage.org/webt/pq/ct/ww/pqctww-7nkjkjjdvmujjl9ntjrm.png"></p><br><p>  Aten√ß√£o.  Exemplos de aviso. </p><br><ul><li>  O espa√ßo em disco acaba. </li><li>  O servi√ßo interno funciona por um longo tempo, mas se voc√™ n√£o tiver um Critical, isso significa que voc√™ √© condicional de qualquer maneira. </li><li>  Muitos erros na interface de rede. </li><li>  O mais controverso √© o servidor n√£o estar dispon√≠vel.  De fato, se voc√™ tiver mais de um servidor e o servidor estiver indispon√≠vel, isso √© Aviso.  Se voc√™ n√£o possui um back-end em 100, √© est√∫pido acordar do SMS e voc√™ receber√° administradores nervosos. </li></ul><br><p>  Todos os outros Severy foram projetados para ajud√°-lo a lidar com a Critical. </p><br><p><img src="https://habrastorage.org/webt/ze/rv/je/zervjevqnr3gnnaqugze3h1jf-g.png"></p><br><p>  Aten√ß√£o.  Defendemos essa abordagem para trabalhar com o Warning.  De prefer√™ncia Aviso fechado durante o dia.  A maioria dos nossos clientes desativou a notifica√ß√£o de aviso.  Assim, eles n√£o t√™m a chamada cegueira de monitoramento.  Isso significa dobrar letras no correio sem ler um diret√≥rio separado.  Os clientes desativaram o alerta de aviso. </p><br><p>  (Pelo que entendi, o monitoramento puro s√£o alertas e gatilhos desnecess√°rios adicionados a exce√ß√µes - observa√ß√£o do autor da postagem) </p><br><p>  Se voc√™ usar a t√©cnica de monitoramento puro, se tiver 5 novos avisos, poder√° repar√°-los em um modo silencioso.  Eles n√£o tiveram tempo para corrigi-lo hoje, mas adiaram para amanh√£, se n√£o de forma cr√≠tica.  Se o Aviso acender e se extinguir, isso deve ser distorcido no monitoramento, para que voc√™ n√£o se incomode mais.  Ent√£o voc√™ ser√° mais tolerante com eles e, consequentemente, a vida melhorar√°. </p><br><p><img src="https://habrastorage.org/webt/xp/92/lv/xp92lvui1q6xbawczc9ltl0osys.png"></p><br><p>  Exemplos de informa√ß√µes.  √â discut√≠vel que a alta utiliza√ß√£o da CPU de muitos cr√≠ticos.  De fato, se nada afetar, voc√™ poder√° ignorar esta notifica√ß√£o. </p><br><p><img src="https://habrastorage.org/webt/xb/nn/p1/xbnnp13tktiqtspilpycu2oaxba.png"></p><br><p>  Aten√ß√£o (talvez eu veja Info - uma observa√ß√£o do autor do post) estas s√£o as luzes que acendem quando voc√™ vem para reparar o Critical.  Voc√™ v√™ dois sinais de aviso lado a lado (talvez haja um link Informa√ß√µes - observa√ß√£o do autor da postagem).  Eles podem ajud√°-lo a resolver o incidente com o Critical.  Por que n√£o est√° claro o alto uso da CPU separadamente no SMS ou em uma carta. </p><br><p>  Informa√ß√µes in√∫teis tamb√©m s√£o ruins.  Se voc√™ configur√°-los como uma exce√ß√£o, adorar√° demais o Info. </p><br><p><img src="https://habrastorage.org/webt/ra/rc/uc/rarcucyuedf9vp6v6keycnnjbz4.png"></p><br><p>  Princ√≠pios gerais para design de alerta.  O alerta deve mostrar o motivo.  Isto √© perfeito.  Mas isso √© dif√≠cil de conseguir.  Aqui estamos trabalhando em tempo integral na tarefa e isso resulta em alguma parte do sucesso. </p><br><p>  Todo mundo est√° falando sobre a necessidade de depend√™ncia, auto-magia.  De fato, se voc√™ n√£o receber notifica√ß√µes de algo que n√£o lhe interessa, n√£o haver√° muito.  Na minha pr√°tica, as estat√≠sticas mostram que uma pessoa olha no momento de um incidente cr√≠tico com os olhos cerca de cem l√¢mpadas na diagonal.  Ele encontrar√° o caminho certo e n√£o pensar√° que a depend√™ncia ocultou l√¢mpadas que me ajudariam agora.  Na pr√°tica, isso funciona.  Tudo o que voc√™ precisa fazer √© limpar alertas desnecess√°rios. </p><br><p><img src="https://habrastorage.org/webt/wq/i8/mm/wqi8mmyravgx7yllannlhsgdvg8.png"></p><br><p>  (Aqui o v√≠deo foi ignorado - nota do autor da publica√ß√£o) </p><br><p><img src="https://habrastorage.org/webt/ys/t_/0d/yst_0dqqfwqnra1yz0krnccw7ae.png"></p><br><p>  Seria bom classificar esses per√≠odos de inatividade para que voc√™ possa trabalhar com eles mais tarde.  Por exemplo, tire conclus√µes organizacionais.  Voc√™ precisa entender por que estava mentindo.  Propomos classificar / dividir nas seguintes classes: </p><br><ul><li>  homem feito </li><li>  configura√ß√£o do hoster </li><li>  veio bots </li></ul><br><p>  Se voc√™ os classificar, todos ser√£o felizes. </p><br><p><img src="https://habrastorage.org/webt/_c/kz/ll/_ckzllbldi_jkamyonco194favy.png"></p><br><p>  O SMS chegou.  O que estamos fazendo?  Primeiro, corremos para consertar tudo.  At√© agora, nada √© importante para n√≥s, exceto o t√©rmino do tempo de inatividade.  Porque somos motivados a mentir menos.  Ent√£o, quando o incidente foi fechado, ele deveria ser fechado para o sistema de monitoramento.  Acreditamos que o incidente deve ser verificado pelo monitoramento.  Se o seu monitoramento n√£o estiver configurado, basta garantir que o problema acabou.  Isso deve ser torcido.  Depois que o incidente √© fechado, ele n√£o √© realmente fechado.  Ele espera enquanto voc√™ chega ao fundo da raz√£o.  De fato, qualquer l√≠der precisa antes de tudo garantir que os problemas n√£o se repitam.  Para que os problemas n√£o se repitam, voc√™ precisa entender o motivo.  Depois de entendermos o motivo, temos dados para classific√°-los.  Analisamos as raz√µes.  Ent√£o, ao chegarmos ao ponto mais baixo, precisamos fazer isso no futuro para que o incidente n√£o se repita: </p><br><ul><li>  s√£o necess√°rias duas pessoas por quarto para escrever essa e essa l√≥gica no back-end. </li><li>  precisa colocar mais r√©plicas. </li></ul><br><p>  √â necess√°rio garantir que exatamente o mesmo incidente n√£o ocorra.  Quando voc√™ trabalha nesse fluxo de trabalho por meio de N itera√ß√µes, a felicidade espera por voc√™, um bom tempo de atividade. </p><br><p>  Por que os classificamos?  Podemos pegar as estat√≠sticas do trimestre e entender o que o tempo de inatividade deu a voc√™.  Ent√£o trabalhe nessa dire√ß√£o.  Voc√™ pode trabalhar em todas as frentes n√£o ser√° muito eficaz, especialmente se voc√™ tiver poucos recursos l√°. </p><br><p><img src="https://habrastorage.org/webt/b9/os/oh/b9osohrb-qilf4mcb7ddcqjckju.png"></p><br><p>  Calculamos que ficamos por tanto tempo, por exemplo 90% por causa do hoster.  Cobramos que mudemos este hoster.  Se as pessoas mexem conosco, n√≥s as enviamos para os cursos.   ,      - ‚Äî  .   .     ,     .    ,    . </p><br><p><img src="https://habrastorage.org/webt/js/gl/wp/jsglwpchvythu9tvkjnbruwtcr8.png"></p><br><p>  .      : </p><br><ul><li>  . </li><li>  . </li></ul><br><p>     ,    ,    .      ,    ,  . </p><br><p><img src="https://habrastorage.org/webt/nn/rb/fl/nnrbflbnglbwbwggjdxuipfuxss.png"></p><br><p> :    ,  .     : ,  ,    .   False Positive ( ),   ,    .       ? </p><br><p> :      .    10- frontend ,      .    9 frontend     nginx,   10-  ,     warning alert  .            .     ,     .          .    . </p><br><p> :       . ,      ,   load avarage 4  , -   load avarage 20  . </p><br><p> :        load avarage.      100       .   CPU usage   Hadoop  .          .       .    .     ,       ,     .      PostgreSQL    autovacuum,  worker autovacuum      .          99  . Warning     .  Critical     .    Critical 10 5  ,     Critical. </p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pergunta: Em que momento e como o limite √© determinado? </font><font style="vertical-align: inherit;">Quem est√° fazendo isso?</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resposta: Voc√™ vem at√© n√≥s e diz: queremos perguntar a alguns cr√≠ticos do nosso projeto. </font><font style="vertical-align: inherit;">Se voc√™ colocar 10 5xx por segundo agora, quantas notifica√ß√µes voc√™ receber√° uma semana atr√°s.</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pergunta: Qual √© o √¥nus de todo esse bom monitoramento? </font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resposta: Em geral, geralmente √© invis√≠vel. </font><font style="vertical-align: inherit;">Mas se voc√™ analisar 50.000 RPS, ser√° de 1% a 10% de uma CPU. </font><font style="vertical-align: inherit;">Como estamos apenas monitorando, otimizamos nosso agente. </font><font style="vertical-align: inherit;">Medimos o desempenho do agente. </font><font style="vertical-align: inherit;">Se voc√™ n√£o tiver os recursos para monitorar no servidor, estar√° fazendo algo errado. </font><font style="vertical-align: inherit;">Sempre deve haver recursos para monitorar. </font><font style="vertical-align: inherit;">Caso contr√°rio, voc√™ ficar√° cego ao administrar seu projeto.</font></font></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt473728/">https://habr.com/ru/post/pt473728/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt473716/index.html">Widgets acionados por mouse. Arraste e solte dentro da janela</a></li>
<li><a href="../pt473718/index.html">Como adicionar cheques ao NoVerify sem escrever uma √∫nica linha de c√≥digo Go</a></li>
<li><a href="../pt473720/index.html">Duas maneiras de fazer testes de unidade confi√°veis</a></li>
<li><a href="../pt473722/index.html">Isolamento remoto, ansiedade e depress√£o</a></li>
<li><a href="../pt473726/index.html">N√£o basta saber o que s√£o Mutex, Sem√°foro e Async / Wait. Voc√™ precisa saber tudo, desde quanta</a></li>
<li><a href="../pt473732/index.html">O hist√≥rico de fraudes na constru√ß√£o de uma rede a cabo no √Årtico por US $ 1 bilh√£o</a></li>
<li><a href="../pt473740/index.html">CreateRemoteThread para Linux</a></li>
<li><a href="../pt473742/index.html">Impressoras de engenharia Epson para CAD e GIS e algumas palavras sobre "design robusto"</a></li>
<li><a href="../pt473748/index.html">Curva de Bezier a servi√ßo dos economistas do trabalho</a></li>
<li><a href="../pt473750/index.html">Stereopi + WebRTC = telepresense em casa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>