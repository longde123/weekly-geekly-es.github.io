<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø üë¥üèæ üíáüèæ Automatisieren der Erstellung eines Qt-Projekts unter Windows in Travis CI ü•ù üí∑ üê∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor kurzem war ich bei QtProtobuf verwirrt , als ich ein Bossy-CI einrichtete, um aka Pull-Anforderungen zu √ºberpr√ºfen und nat√ºrlich ein modisches Abz...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Automatisieren der Erstellung eines Qt-Projekts unter Windows in Travis CI</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485034/"><p>  Vor <a href="https://github.com/semlanik/qtprotobuf" rel="nofollow">kurzem war</a> ich bei <a href="https://github.com/semlanik/qtprotobuf" rel="nofollow">QtProtobuf</a> verwirrt <a href="https://github.com/semlanik/qtprotobuf" rel="nofollow">, als</a> ich ein Bossy-CI <a href="https://github.com/semlanik/qtprotobuf" rel="nofollow">einrichtete,</a> um aka Pull-Anforderungen zu √ºberpr√ºfen und nat√ºrlich ein modisches Abzeichen in die README-Datei des Projekts einzuf√ºgen.  Die Wahl fiel auf <a href="https://github.com/features/actions" rel="nofollow">GitHub Actions</a> und <a href="https://travis-ci.com/" rel="nofollow">Travis CI</a> .  Ehrlich gesagt, ich wollte nicht suchen, vergleichen, analysieren, sondern einfach und schnell eine sehr einfache Aufgabe l√∂sen.  Zuerst habe ich das CI f√ºr GitHub-Aktionen herausgefunden und die Build- und Komponententest√ºberpr√ºfung √ºber den Docker-Container eingerichtet.  Aufgrund der Vielzahl von Einschr√§nkungen war GitHub Actions jedoch nicht f√ºr die √úberpr√ºfung eines Projekts unter Windows geeignet.  Ich musste mich an Travis CI wenden. </p><br><p>  <em>KDPV_not_found.png</em> </p><a name="habracut"></a><br><p>  Zum Zeitpunkt des Schreibens dieses Artikels in Travis CI gab es einen solchen Haftungsausschluss: </p><br><blockquote>  Windows-Builds befinden sich in einem fr√ºhen Zugriffsstadium.  Besuchen Sie das Travis CI Community-Forum, um Hilfe zu erhalten oder Ideen zu ver√∂ffentlichen. </blockquote><p>  Dies gab Anlass zur Sorge, da ich anfangs versuchte, alles √ºber den Docker-Container zu konfigurieren und in die GitHub-Aktionen einzuf√ºgen, was jedoch aufgrund von Einschr√§nkungen hinsichtlich Gr√∂√üe, Art der Container usw. fehlschlug.  auf Github. </p><br><h2 id="k-delu">  Zum Gesch√§ft </h2><br><p> Um zu beginnen, m√ºssen Sie Travis CI auf GitHub autorisieren. Anschlie√üend wird die Travis CI- <a href="https://github.com/settings/installations" rel="nofollow">Anwendung</a> in Ihren Profileinstellungen angezeigt.  Praktischerweise k√∂nnen Sie Repositorys definieren, auf die Travis CI zugreifen kann: </p><br><p><img src="https://habrastorage.org/webt/x-/rl/lc/x-rllc93_hpbwe6vsoyqhd6ckj8.png"></p><br><p>  Der n√§chste Schritt ist die Konfiguration der Travis CI-Trigger.  Diese Prozedur wird bereits im Administrationsbereich von Travis CI selbst ausgef√ºhrt und zum Zeitpunkt des Schreibens waren die folgenden Ausl√∂ser verf√ºgbar: </p><br><ul><li>  Push-Start f√ºr jeden Projektbrunch </li><li>  Wird beim Erstellen von Zusammenf√ºhrungsanforderungen ausgef√ºhrt </li><li>  Zeitgesteuerter Trigger (Cron) </li></ul><br><p>  Grunds√§tzlich ein anst√§ndiges Set zum Bauen von CI. </p><br><p>  Nachdem Sie die Trigger zum Ausf√ºhren der Builds ausgew√§hlt haben, m√ºssen Sie die <em>Datei .travis.yml</em> mit einer Beschreibung der <em>Buildprozedur</em> erstellen und diese Datei in Abh√§ngigkeit von den verf√ºgbaren Triggern im Repository <em>ablegen</em> .  Die verstreute und unsystematische Dokumentation von Travis CI selbst zu <em>.travis.yml wurde</em> sofort verwirrt, aber Sie k√∂nnen es herausfinden, wenn Sie m√∂chten. </p><br><p>  Die Hauptaufgabe bestand darin, die Umgebung f√ºr die Montage vorzubereiten, da die Montage selbst und die √úberpr√ºfung Sache von CMake ist. </p><br><h2 id="opisyvaem-proceduru-sborki-v-travisyml">  Wir beschreiben die Montageprozedur in <em>.travis.yml</em> </h2><br><p>  Zun√§chst m√ºssen Sie ein Betriebssystem ausw√§hlen, das als virtuelle Maschine auf Travis CI-Servern ausgef√ºhrt wird, sowie eine Programmiersprache. </p><br><pre><code class="plaintext hljs">os: windows language: C++ ...</code> </pre> <br><p>  <em>die sprache</em> automatisiert nach meinem verst√§ndnis einige schritte, wenn sie nicht explizit spezifiziert sind, aber ihre bindung ist mir ein r√§tsel.  Ich dachte, dass es ohne MSVC kein vorinstalliertes MSVC geben w√ºrde, aber w√§hrend der Experimente stellte sich heraus, dass es auch f√ºr andere Sprachen vorhanden war. </p><br><p>  Der n√§chste Schritt ist das Herunterladen und Installieren der erforderlichen Abh√§ngigkeiten.  F√ºr QtProtobuf sind dies: </p><br><ul><li>  Qt 5.12.3 oder h√∂her </li><li>  cmake-3.1 oder h√∂her </li><li>  Strawberry Perl 5.28 oder h√∂her </li><li>  GoLang 1.10 oder h√∂her </li><li>  Yasm 1.3 oder h√∂her </li><li>  Visual Studio Compiler 14.16.x </li></ul><br><p>  Und hier hat mir Travis CI sehr <a href="https://docs.travis-ci.com/user/reference/windows/" rel="nofollow">geholfen</a> .  Unter den vorinstallierten Paketen befanden sich nicht nur Git und MSVC, sondern auch cmake, wget und <a href="https://chocolatey.org/" rel="nofollow">chocolatey</a> .  In prisnip in Gegenwart von chocolatey wird die weitere Installation von Abh√§ngigkeiten erheblich erleichtert.  Es bleibt mir ein R√§tsel, warum Qt noch nicht an chocolatey geliefert wurde. </p><br><p>  Laden Sie zun√§chst das vollst√§ndige Qt-Installationsprogramm aus dem offiziellen Repository herunter: </p><br><pre> <code class="plaintext hljs">... before_install: - wget -q https://download.qt.io/official_releases/qt/5.13/5.13.2/qt-opensource-windows-x86-5.13.2.exe ...</code> </pre> <br><blockquote>  <em>Hinweis:</em> Beim Herunterladen erstellt wget eine gro√üe Anzahl von Protokollen mit dem Download-Fortschritt.  Travis CI hat wie GitHub ein Limit f√ºr die Gr√∂√üe des Build-Protokolls, daher sollten unn√∂tige Protokolle vermieden werden.  Die Option -q aka --quite verbirgt die Ausgabe von wget-Protokollen. </blockquote><p>  Wir machen die Installation der notwendigen Abh√§ngigkeiten: </p><br><pre> <code class="plaintext hljs">... install: - choco install golang - choco install yasm - ./qt-opensource-windows-x86-5.13.2.exe --script ./.ci/qt_installer_windows.qs ...</code> </pre> <br><p>  Bei der Installation von GoLang und Yasm sollte es meiner Meinung nach keine Fragen geben.  Aber beim Start des Qt-Installers werde ich mehr aufpassen. </p><br><p>  <a href="https://doc.qt.io/qtinstallerframework/index.html" rel="nofollow">QtInstallerFramework</a> unterst√ºtzt die Automatisierung des Installationsprozesses durch das Schreiben von <a href="https://doc.qt.io/qtinstallerframework/noninteractive.html" rel="nofollow">Skripten</a> . </p><br><p>  Vorgefertigte Skripte f√ºr die Installation einer bestimmten Version von Qt sind ganz einfach zu googeln. Ich werde nur einen Link zu meiner vorhandenen geben und auf die Auswahl der zu installierenden Komponenten achten: </p><br><pre> <code class="plaintext hljs">... Controller.prototype.ComponentSelectionPageCallback = function() { var widget = gui.currentPageWidget(); widget.deselectAll(); widget.selectComponent("qt.qt5.5132.win32_msvc2017"); gui.clickButton(buttons.NextButton); } ...</code> </pre> <br><p>  Hier schalte ich alle Checkbox-Komponenten aus, indem <code>widget.deselectAll();</code>  und <em>f√ºgen Sie</em> die " <em>qt.qt5.5132.win32_msvc2017</em> " hinzu, die f√ºr die Konstruktion erforderlich ist.  Es gibt zwei Aspekte, die beim Schreiben dieser Prozedur wichtig sind: </p><br><ul><li>  selectComponent funktioniert genauso wie die grafische Komponente, und daher werden Abh√§ngigkeiten und Unterkomponenten nach derselben Logik ausgew√§hlt, als ob wir sie in der grafischen Oberfl√§che ausgew√§hlt h√§tten.  Das ist der Grund, warum Sie sich keine Sorgen um das Aufl√∂sen von Abh√§ngigkeiten machen m√ºssen. </li><li>  Die Namen der Komponenten k√∂nnen im "verbalen" Installationsmodus angezeigt werden.  Zu diesem <code>widget.selectAll();</code> ich <code>widget.selectAll();</code> in einer der Iterationen ausgef√ºhrt <code>widget.selectAll();</code>  und startete die Installation mit dem <code>- ./qt-opensource-windows-x86-5.13.2.exe --verbose --script ./.ci/qt_installer_windows.qs</code> .  In den Protokollen k√∂nnen Sie einfach alle ben√∂tigten Komponenten finden und deren Installation mithilfe von widget.selectComponent / widget.deselectComponent moderieren. </li></ul><br><p>  Und der letzte wichtige Punkt, den ich in diesem Tutorial behandeln werde, ist die Build-Umgebung.  Aufgrund der Tatsache, dass die Installation von Abh√§ngigkeiten und die Assembly in derselben Shell erfolgen, ist nach dem Festlegen von Go und Yasm in unserer Shell vor den ausf√ºhrbaren Dateien kein PATH registriert.  Daher m√ºssen Sie PATH, GOROOT vor der Niederwerfung manuell registrieren: </p><br><pre> <code class="plaintext hljs">script: ... - setx path "%path%;C:\Qt\5.13.2\msvc2017\bin;C:\Go\bin;C:\ProgramData\chocolatey\lib\yasm\tools" - set GOROOT="c:\Go" - set PATH="%PATH%;C:\Qt\5.13.2\msvc2017\bin;C:\Go\bin;C:\ProgramData\chocolatey\lib\yasm\tools" - cmake -DCMAKE_PREFIX_PATH="C:\Qt\5.13.2\msvc2017;C:\Go\bin;C:\ProgramData\chocolatey\lib\yasm\tools" .. ...</code> </pre> <br><p>  Ich m√∂chte auch darauf achten, dass Sie in CMAKE_PREFIX_PATH analog den Pfad zu Go und Yasm angeben m√ºssen, damit die Funktion find_program ordnungsgem√§√ü funktioniert. </p><br><p>  Vielleicht beschreibe ich sp√§ter die Erstellung eines Docker-Containers f√ºr den Bau mit Qt an Bord. </p><br><p>  Alle Skripte finden Sie <a href="https://github.com/semlanik/qtprotobuf" rel="nofollow">hier.</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de485034/">https://habr.com/ru/post/de485034/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de485024/index.html">Was verbirgt sich hinter den Optimierungen des GraalVM-Compilers?</a></li>
<li><a href="../de485026/index.html">Georgiens Chancen f√ºr IT-Profis</a></li>
<li><a href="../de485028/index.html">CRM 2020</a></li>
<li><a href="../de485030/index.html">Top 8 IEO Geb√ºhren und deren Aktivierung jetzt</a></li>
<li><a href="../de485032/index.html">Schnelleres Reagieren mit staatlichem Co-Hosting</a></li>
<li><a href="../de485036/index.html">Warum brauche ich instrumentelle Unterst√ºtzung f√ºr die Schl√ºsselpagination?</a></li>
<li><a href="../de485042/index.html">Aufgrund der obligatorischen 5G-Unterst√ºtzung werden Smartphones mit Snapdragon 865 im Jahr 2020 schlechter sein</a></li>
<li><a href="../de485044/index.html">Wir zerlegen die Digitaluhr vom Sojus-Raumschiff</a></li>
<li><a href="../de485046/index.html">So planen Sie eine erfolgreiche Produktstrategie</a></li>
<li><a href="../de485050/index.html">Hypercube. Wie wir Entwicklern Testger√§te zur Verf√ºgung gestellt haben und diese nicht verloren haben</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>