<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ß ‚òéÔ∏è üëö Chatbot-Entwicklung (Laravel + Botman) ‚õ©Ô∏è üõÑ üëÅ‚Äçüó®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Willkommen! Als Junior Full Stack Entwickler hatte ich viele Probleme beim Versuch, einen Bot mit Laravel und Botman zu schreiben. Erstens kann ich ni...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Chatbot-Entwicklung (Laravel + Botman)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456240/"><p>  Willkommen!  Als Junior Full Stack Entwickler hatte ich viele Probleme beim Versuch, einen Bot mit Laravel und Botman zu schreiben.  Erstens kann ich nicht viel Englisch, aber es gibt nur sehr wenige Artikel zu diesem Thema auf Russisch und solche, die mir nicht bei der L√∂sung meiner Probleme helfen.  Der Artikel zeigt und zeigt, wie man einen Chatbot auf Laravel + Botman f√ºr ein Telegramm entwickelt.  Ich selbst habe Bots (kommerziell) f√ºr Viber und Telegramm entwickelt.  Als Telegrammentwickler mag ich am meisten. </p><br><p><img src="https://habrastorage.org/webt/lt/zr/fm/ltzrfmykbxry39tsl6ni82onor8.png" alt="Bild"></p><br><p> Ich werde nicht zeigen, wie man Laravel installiert und den Server so konfiguriert, dass er funktioniert.  Wenn Sie dies noch nie zuvor getan haben, ist es einfacher, openserver zu installieren, Composer (Paketmanager f√ºr PHP) ist darin integriert und der lokale Server f√ºr Laravel ist bereits konfiguriert.  Sie m√ºssen nur Code in .htaccess schreiben.  Genau das arbeite ich zu Hause.  In dem Artikel werde ich eine der M√∂glichkeiten zeigen, einen Chat-Bot zu entwickeln, den Bot f√ºr die Arbeit in Telegrammen zu konfigurieren und am Ende Links zu n√ºtzlichen Artikeln √ºber Laravel'e und Botman'e zu hinterlassen. </p><br><h2>  Design / Vorbereitung </h2><br><p>  Ich schlage vor, wie alle normalen Entwickler einen Bot zu entwickeln, indem ich eine Aufgabe entwerfe, setze und erkl√§re, wie Laravel funktioniert.  Vorher werde ich sagen, dass ich Code in phpStrom schreibe.  Sie k√∂nnen in jede andere IDE schreiben, aber ich benutze sie. </p><br><p>  Laravel implementiert das MVC-Muster (Model View Controller).  Dies bedeutet nicht, dass Sie nur unter mvc schreiben m√ºssen, Sie k√∂nnen Schei√üe schreiben, aber es ist besser, die Vorteile des Frameworks zu nutzen.  Wenn Sie mit mvc vertraut sind, es aber nicht wie ich verwendet haben, ist die Entwicklung mit laravel der beste Weg, um Wissen zu festigen. </p><a name="habracut"></a><br><h3>  Was soll unser Bot tun: </h3><br><ul><li>  Fragen Sie den Benutzer nach dem Benutzernamen </li><li>  Fragen Sie, ob der Benutzer das Wetter mag oder nicht. </li><li>  Schreiben Sie auch die Antwort in die Datenbank </li><li>  Verabschieden Sie sich und senden Sie ein Bild </li></ul><br><p>  Ein bisschen √ºber MVC.  Wenn wir √ºber Befehle (URL-URL) auf unsere Software zugreifen, m√ºssen wir diese Befehle akzeptieren und verarbeiten und verstehen, was der Benutzer ben√∂tigt.  Hierf√ºr gibt es Routen, sogenannte Routen.  Routen legen fest, welcher Controller verwendet werden soll. Der Controller greift bei Bedarf √ºber das Modell auf die Datenbank zu.  Model kontaktiert die Datenbank und gibt das ben√∂tigte Ergebnis zur√ºck.  Im Bot wird keine Ansicht ben√∂tigt, weil  Alle Arbeiten werden √ºber die Messenger-Oberfl√§che ausgef√ºhrt.  Nach dem Empfang von Daten aus dem Modell gibt der Controller diese Ansichtsdaten aus. In unserem Fall handelt es sich um eine Blade-Vorlage (sie wird von Laravel verwendet).  Daten k√∂nnen an eine normale PHP-Seite gesendet werden, dies ist jedoch besser √ºber Blade-Vorlagen m√∂glich.  Wir benutzen die Messenger-Oberfl√§che, dann senden wir sofort Daten an sie. </p><br><h2>  Entwicklung </h2><br><p>  Um ein Projekt zu erstellen, geben Sie einfach den folgenden Befehl in die Konsole ein </p><br><p><code>composer create-project --prefer-dist botman/studio botelegram</code> </p> <br><p>  Der Einstiegspunkt ist rout "/ start".  Es gibt mehrere Routenimplementierungen in Botman.  Weil  Wir werden √ºber einen Bot in einem Telegramm auf Routen zugreifen, dann brauchen wir "botman.php". </p><br><p><img src="https://habrastorage.org/webt/hs/mw/tj/hsmwtj9-twdd9ktlk6ve5py4iwq.png" alt="Bild"></p><br><p>  Darin m√ºssen wir die n√§chste Zeile schreiben </p><br><pre> <code class="php hljs">$botman-&gt;hears(<span class="hljs-string"><span class="hljs-string">'/start'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $bot )</span></span></span><span class="hljs-function"> </span></span>{ $bot-&gt;startConversation ( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> mainConversation ); } );</code> </pre> <br><p>  Das Telegramm selbst bietet an, √ºber den Befehl "start" mit dem Bot zu arbeiten. In diesem Fall k√∂nnen wir die Interaktion mit dem Bot erleichtern, indem wir den anf√§nglichen Einstiegspunkt auf "/ start" setzen und sofort mit ihm arbeiten. </p><br><p>  Verwenden von $ bot-&gt; startConversation (neue mainConversation);  Wir geben an, welcher Controller f√ºr die Arbeit verantwortlich ist.  Au√üerdem registrieren wir die Verwendung unseres Controllers. Dazu m√ºssen wir diesen Code in die Pfaddatei einf√ºgen: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Conversations</span></span>\<span class="hljs-title"><span class="hljs-title">mainConversation</span></span>;</code> </pre> <br><p>  Fahren wir fort.  Wir m√ºssen eine Datenbank und den Controller selbst erstellen.  Ich meine, Sie verwenden OpenServer.  Die Datenbank kann √ºber die Konsole oder mit phpMyAdmin erstellt werden, das in openserver integriert ist. </p><br><p>  Nun ein paar Konfigurationen.  Wir m√ºssen die Datenbankdaten in die Laravel-Konfigurationsdatei eingeben.  Es liegt im Stammverzeichnis des Projekts und hei√üt .env </p><br><p><img src="https://habrastorage.org/webt/ya/j9/al/yaj9algdv_3ugct8rqt-ua2fy1a.png" alt="Bild"></p><br><p>  Suchen Sie die mit der Datenbank verkn√ºpften Zeilen </p><br><pre> <code class="plaintext hljs">DB_CONNECTION=mysql DB_HOST=127.0.0.1 DB_PORT=3306 DB_DATABASE=botelegram DB_USERNAME=root DB_PASSWORD=</code> </pre> <br><p>  Hier interessieren uns nur der Name der Datenbank, der Benutzername und das Passwort.  Wenn Sie openserver verwenden, k√∂nnen Sie in den Stammnamen schreiben und das Kennwort leer lassen. Der Name der Datenbank h√§ngt von Ihnen ab. </p><br><p>  Jetzt hat unsere Anwendung Zugriff auf die Datenbank.  Als n√§chstes m√ºssen wir ein Modell erstellen und migrieren.  Wir schreiben in die Konsole: </p><br><p> <code>php artisan make:model messengerUser -m</code> </p> <br><p>  Das Flag -m erstellt eine Migration f√ºr die Datenbank und ordnet sie unserem Modell zu.  Lassen Sie uns unsere Migration sofort einrichten, um nicht mehr darauf zur√ºckzukommen. </p><br><p>  Es ist besser, dies nicht zu tun, aber um nicht eine Reihe von Dateien zu erstellen, schreiben wir alle Daten in eine Tabelle. <br>  Wir m√ºssen: </p><br><ul><li>  Chat-ID </li><li>  Benutzername </li><li>  Gutes Wetter oder nicht </li></ul><br><p>  Dies reicht aus, um die grundlegenden F√§higkeiten von Botman zu demonstrieren.  √ñffnen Sie die neu erstellte Migration, die sich in der Datenbank / migrations / created_create_messanger_users_table.php befindet </p><br><p><img src="https://habrastorage.org/webt/dz/kq/sv/dzkqsvxyblhrqhm62erj_cd2xao.png" alt="Bild"></p><br><p>  Schlie√üen Sie die Up-Methode in dieser Migration ab. Sie sollte folgenderma√üen aussehen: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">up</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Schema::create(<span class="hljs-string"><span class="hljs-string">'messenger_users'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Blueprint $table)</span></span></span><span class="hljs-function"> </span></span>{ $table-&gt;increments(<span class="hljs-string"><span class="hljs-string">'id'</span></span>); $table-&gt;string(<span class="hljs-string"><span class="hljs-string">"id_chat"</span></span>); $table-&gt;string(<span class="hljs-string"><span class="hljs-string">"name"</span></span>); $table-&gt;string(<span class="hljs-string"><span class="hljs-string">'response'</span></span>); $table-&gt;timestamps(); }); }</code> </pre> <br><p>  Jetzt m√ºssen wir die Migration starten, damit unsere Tabelle in der Datenbank vorhanden ist.  In der Konsole m√ºssen Sie sich registrieren: </p><br><p> <code>php artisan migrate</code> </p> <br><p>  Hinweis: Wenn Sie w√§hrend des Entwicklungsprozesses die Felder in der Tabelle √§ndern m√ºssen, aber Daten in der Tabelle vorhanden sind und diese nicht ben√∂tigt werden, k√∂nnen Sie die Tabellen mit dem Befehl <code>php artisan migrate:refresh</code> aktualisieren. </p><br><p>  Ergebnis: </p><br><p><img src="https://habrastorage.org/webt/2k/wy/5e/2kwy5ennah0pz8us1oyljum6ftw.png" alt="Bild"></p><br><p>  Laravel hat 3 Migrationen durchgef√ºhrt, aber wir sind seitdem nur an der 3. Migration interessiert  Hier werden wir unsere Daten aufzeichnen. </p><br><p>  Es ist Zeit, einen Controller zu erstellen, unser Modell daran anzuschlie√üen und die Logik zu schreiben. </p><br><p>  Im Allgemeinen ist es besser, alle Dateien √ºber die Konsole zu erstellen. Da wir jedoch botman verwenden und ich bereits daran gew√∂hnt bin, erstellen wir manuell einen Controller.  In Botman hei√üt der Controller Konversation, vielleicht gibt es signifikante Unterschiede zwischen ihnen, aber ich habe das nicht verstanden - es gab keine Notwendigkeit.  Erstellen Sie im Ordner app / Conversations eine Datei mit dem Namen mainConversation.php. </p><br><p>  Auf dem Bildschirm sehen Sie eine minimale Konfiguration der Konversation </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Conversations</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">Conversations</span></span>\<span class="hljs-title"><span class="hljs-title">Conversation</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mainConversation</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">conversation</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre> <br><p>  Ihre Klasse muss √ºber eine √∂ffentliche Ausf√ºhrungsmethode verf√ºgen. Dies ist der Einstiegspunkt f√ºr den Controller. </p><br><p>  Schlie√üen Sie unser Modell an die Steuerung an: </p><br><p> <code>use app\messengerUser;</code> <br>  Schreiben wir die anf√§ngliche Logik.  Die run-Methode f√ºhrt eine private Methode aus, die nach dem Namen des Benutzers fragt, seine ID und seinen Namen in id_chat und den Namen unserer Tabelle schreibt. </p><br><p>  Um zu beginnen, schreiben Sie: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">messengerUser</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">database</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">Attachments</span></span>\<span class="hljs-title"><span class="hljs-title">Image</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">Conversations</span></span>\<span class="hljs-title"><span class="hljs-title">Conversation</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">Incoming</span></span>\<span class="hljs-title"><span class="hljs-title">Answer</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">BotManAnswer</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">Outgoing</span></span>\<span class="hljs-title"><span class="hljs-title">Actions</span></span>\<span class="hljs-title"><span class="hljs-title">Button</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">Outgoing</span></span>\<span class="hljs-title"><span class="hljs-title">OutgoingMessage</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">Outgoing</span></span>\<span class="hljs-title"><span class="hljs-title">Question</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">BotManQuestion</span></span>;</code> </pre> <br><p>  Dadurch k√∂nnen wir die Methoden von botman anwenden </p><br><p>  Und jetzt werden wir √Ñnderungen an unserem Controller vornehmen: </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mainConversation</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">conversation</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $response = []; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setName(); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $question = BotManQuestion::create(<span class="hljs-string"><span class="hljs-string">"!   ?"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;ask( $question, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( BotManAnswer $answer )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( $answer-&gt;getText () != <span class="hljs-string"><span class="hljs-string">''</span></span> ){ array_push (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;response, $answer-&gt;getText()); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;askWeather (); } }); } }</code> </pre> <br><p>  run () startet die Methode, die wir brauchen, es ist setName ().  Bereits in setName () fragen wir nach dem Benutzernamen, schreiben den Namen in das Array und f√ºhren dann die n√§chste Methode aus, die den Benutzer nach dem Wetter fragt. </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">askWeather</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $question = BotManQuestion::create(<span class="hljs-string"><span class="hljs-string">"    ?"</span></span>); $question-&gt;addButtons( [ Button::create(<span class="hljs-string"><span class="hljs-string">''</span></span>)-&gt;value(<span class="hljs-number"><span class="hljs-number">1</span></span>), Button::create(<span class="hljs-string"><span class="hljs-string">''</span></span>)-&gt;value(<span class="hljs-number"><span class="hljs-number">2</span></span>) ]); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;ask($question, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BotManAnswer $answer)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      ,       array_push ($this-&gt;response, $answer); $this-&gt;exit(); }); }</span></span></code> </pre> <br><p>  askWeather () hat eine √§hnliche Struktur, aber hier verwenden wir Schaltfl√§chen, um die Auswahlm√∂glichkeiten der Benutzer einzuschr√§nken und uns das Leben zu erleichtern.  Schaltfl√§chen entfernen viele Fehler, die ein Benutzer erstellen kann.  Hier erstellen wir auch eine Frage, indem wir mit Hilfe von addButtons () Schaltfl√§chen an die Frage anh√§ngen. Sp√§ter rufen wir die angegebene Frage auf, verarbeiten die Antwort und gehen zur letzten Methode. </p><br><p>  Die exit () -Methode schreibt alle Daten in die Datenbank (kann in einer separaten Methode herausgenommen werden), verabschiedet sich vom Benutzer und sendet ihm auch ein Bild. </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">exit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $db = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> database(); $db-&gt;id_chat = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;bot-&gt;getUser()-&gt;getId(); $db-&gt;name = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;response[<span class="hljs-number"><span class="hljs-number">0</span></span>]; $db-&gt;response = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;response[<span class="hljs-number"><span class="hljs-number">1</span></span>]; $db-&gt;save(); $attachment = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Image(<span class="hljs-string"><span class="hljs-string">'https://gykov.ru/projects/botelegram.png'</span></span>); $message = OutgoingMessage::create(<span class="hljs-string"><span class="hljs-string">'  !'</span></span>) -&gt;withAttachment($attachment); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;bot-&gt;reply($message); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre><br><p>  Mit OutgoingMessage :: create ('Bis bald!') -&gt; withAttachment ($ Anhang) erstellen wir eine neue Nachricht und h√§ngen ein Bild daran an.  Im Allgemeinen werden alle √∂ffentlichen Dateien, die der Benutzer sehen sollte, im √∂ffentlichen Ordner abgelegt, aber in meinem letzten Bot gab es ein Problem damit und ich musste sie in einem separaten Ordner auf dem Server ablegen (nicht projektbezogen).  Hier habe ich das gleiche getan. </p><br><p>  Die Logik unseres Bots ist fertig.  Um es zu testen, √∂ffnen Sie die Site einfach √ºber openserver. Zuvor m√ºssen Sie jedoch eine .htiaccess-Datei mit den folgenden Inhalten erstellen </p><br><pre> <code class="plaintext hljs">&lt;IfModule mod_rewrite.c&gt; RewriteEngine On RewriteRule ^(.*)$ public/$1 [L] &lt;/IfModule&gt;</code> </pre> <br><p>  Die Datei sollte sich im Stammverzeichnis der Site befinden.  Jetzt werden alle Anfragen in den √∂ffentlichen Ordner √ºbertragen.  So funktioniert Laravel.  Wir √∂ffnen die Seite und testen den Bot. Vergessen Sie nicht, dass Sie zuerst "/ start" eingeben m√ºssen. </p><br><p>  Nachdem Sie sichergestellt haben, dass alles funktioniert, k√∂nnen Sie es an Telegramme anh√§ngen.  Erstellen Sie dazu einen neuen Bot bei @botfather und kopieren Sie den Bot-Schl√ºssel an das Ende der .env-Datei.  Es sieht so aus: </p><br><p> <code>TELEGRAM_KEY=key_bot</code> </p> <br><p>  Jetzt m√ºssen wir in unser Projekt einen Treiber f√ºr die gemeinsame Arbeit unseres Logik- und Telegramm-Bots einf√ºgen.  Dies geschieht mit nur einem Befehl in der Konsole: </p><br><p> <code>composer require botman/driver-telegram</code> </p> <br><p>  Sie m√ºssen den Bot auch in Laravel registrieren. </p><br><p> <code>php artisan botman:telegram:register</code> </p> <br><p>  Wir werden gebeten, die Adresse einzugeben, unter der unser Bot verf√ºgbar sein wird. </p><br><p><img src="https://habrastorage.org/webt/7t/pg/uv/7tpguvu21qjnqlotwj3nbkmy6c8.png" alt="Bild"></p><br><p>  Wenn Sie einen Bot auf dem Server entwickeln, f√ºgen Sie einfach <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https: // url_site / botman hinzu.</a> Nach diesem Bot k√∂nnen Sie ihn im Messenger selbst testen.  Beachten Sie jedoch, dass Laravel spezielle Servereinstellungen ben√∂tigt und Sie diese h√∂chstwahrscheinlich selbst konfigurieren m√ºssen.  Ich werde am Ende des Artikels einen Link zur Konfiguration des Servers hinterlassen. </p><br><p>  Vielleicht ist das alles.  Wenn Sie bis zum Ende lesen, dann herzlichen Gl√ºckwunsch, jetzt k√∂nnen Sie mit Botman Chat-Bots f√ºr Laravel entwickeln.  Wenn Sie Fragen haben, beantworte ich diese gerne in den Kommentaren sowie in den versprochenen Links: </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Quellen zu Github</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Botman-Dokumentation</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Server-Setup</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ein Artikel, auf dem ich meinen ersten Bot erstellt habe</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">En Artikel √ºber Botman</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de456240/">https://habr.com/ru/post/de456240/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de456230/index.html">Iobroker-Suche nach Quests in Reality-Spielen</a></li>
<li><a href="../de456232/index.html">Anleitung: Aktualisieren von Schnittstellen mit Standardmitgliedern in C # 8.0</a></li>
<li><a href="../de456234/index.html">Warum kauft Cisco Splunk nicht oder spricht nicht dar√ºber, wie die Cisco-Plattform f√ºr die Bedrohungssuche funktioniert?</a></li>
<li><a href="../de456236/index.html">Peter - Insider Dev Tour: Insiderkonferenz f√ºr Entwickler von Microsoft</a></li>
<li><a href="../de456238/index.html">Tutorial: Aktualisieren Sie Schnittstellen mit Standardschnittstellenmitgliedern in C # 8.0</a></li>
<li><a href="../de456242/index.html">Ein bisschen mehr √ºber Multitasking in Mikrocontrollern</a></li>
<li><a href="../de456246/index.html">Nullelement</a></li>
<li><a href="../de456248/index.html">Wie ich gefangen habe: vor Stilen f√ºr ein Fokuselement</a></li>
<li><a href="../de456250/index.html">Anwendungslokalisierung und RTL-Unterst√ºtzung. Bericht Yandex.Taxi</a></li>
<li><a href="../de456256/index.html">Handbuch zur Android-Anwendungsarchitektur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>