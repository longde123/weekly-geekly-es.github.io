<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍🤝‍👨🏿 😛 🦕 Zwei rote Knöpfe, Lötkolben und React: Wie wir uns für eine IT-Konferenz entschieden haben 🏇🏾 👩🏼‍🏭 👂🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Badoo nimmt regelmäßig mit einem Stand an Ausstellungen von IT-Konferenzen teil. Aus diesem Grund haben wir uns jedes Jahr mit Kollegen - Ingenieuren ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zwei rote Knöpfe, Lötkolben und React: Wie wir uns für eine IT-Konferenz entschieden haben</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/482028/"><p>  Badoo nimmt regelmäßig mit einem Stand an Ausstellungen von IT-Konferenzen teil.  Aus diesem Grund haben wir uns jedes Jahr mit Kollegen - Ingenieuren und Entwicklern - etwas einfallen lassen, um zwischen den Berichten keine Langeweile aufkommen zu lassen. </p><br><p>  Mein Name ist Ivan, ich bin ein Frontend-Entwickler.  In diesem Artikel erzählen wir Ihnen zusammen mit unserem <a href="https://habr.com/ru/users/lilek/" class="user_link">Lilek-</a> Kollegen und DIY-Enthusiasten Yuri Lilekov, wie wir mit zwei roten Knöpfen, einem Mikrocontroller, einem React-Code und 250 Wörtern für ein IT-Thema das Spiel „IT-Ratespiel“ erstellt und eine gemütliche Party auf Highload ++ zusammengestellt haben und Heisenbug. </p><br><p><img src="https://habrastorage.org/webt/op/k9/r9/opk9r9az9g7eovtbqkgcra83ntm.png"></p><a name="habracut"></a><br><h1 id="soderzhanie">  Inhalt: </h1><br><p>  <a href="https://habr.com/ru/company/badoo/blog/482028/">Nichttriviale TK</a> <br>  <a href="https://habr.com/ru/company/badoo/blog/482028/">Spielmechanik und Wertung</a> <br>  <a href="https://habr.com/ru/company/badoo/blog/482028/">Animation</a> <br>  <a href="https://habr.com/ru/company/badoo/blog/482028/">Frontend</a> <br>  <a href="https://habr.com/ru/company/badoo/blog/482028/">Hardware: zwei rote Knöpfe</a> <br>  <a href="https://habr.com/ru/company/badoo/blog/482028/">Ergebnis</a> </p><br><h1 id="netrivialnoe-tz">  Nichttriviale TK </h1><br><p>  IT-Konferenzen haben ihre eigene Atmosphäre: Es gibt viele Leute, es ist nicht einfach, ihre Aufmerksamkeit auf den Stand zu lenken.  Damit sie genau in den Pausen zwischen den Berichten zu uns kommen, müssen wir ihnen eine interessante, aber unkomplizierte Lektion anbieten. </p><br><p>  Inspiriert vom Erfolg des IT-Alias ​​vom letzten Jahr haben wir die folgenden Anforderungen für das neue Spiel formuliert: </p><br><ul><li>  Es muss ein Mehrbenutzer sein.  Die Kommunikation der Teilnehmer ist die Hauptaufgabe.  Wir wissen, dass viele allein kommen und nicht immer leicht mit Fremden ins Gespräch kommen.  Das Spiel sollte Gelegenheit geben, sich untereinander und mit den Badoo-Ingenieuren zu unterhalten. </li><li>  Die Sitzungen sollten kurz sein.  Es könnten ein bis dreitausend Personen an der Konferenz teilnehmen, und wir wollten so viele Teilnehmer wie möglich erreichen. </li><li> Das Spiel sollte spektakulär sein.  Wenn eine Person nicht am Spiel teilnimmt, sollte sie es zumindest sehen.  Dies weckt Interesse, hilft, das Wesentliche zu verstehen und sich für eine Teilnahme zu entscheiden. </li><li>  Das einfachste Management.  Wie wir alle wissen, wenn etwas kaputt gehen kann, wird es mit Sicherheit kaputt gehen. </li><li>  Ohne Registrierung und SMS! </li></ul><br><p>  Nach einem Brainstorming, einem Traumdenken und dem Versuch, sich inspirieren zu lassen, entwickelten wir ein „IT-Ratespiel“ - ein einfaches Spiel mit Worten zu IT-Themen. </p><br><p><img src="https://habrastorage.org/webt/8r/p4/5f/8rp45fdtczsizalimesfrnb9kc4.jpeg"></p><br><p>  Was ist die Essenz von: </p><br><ul><li>  Zwei Teilnehmer spielen gleichzeitig. </li><li>  Die Aufgabe besteht darin, die Taste schneller als der Gegner zu drücken und das auf dem Bildschirm angezeigte verschlüsselte Wort zu erraten. </li><li>  Zwei Stufen: die einfache („Shortcuts“), bei der die Wörter von hinten nach vorne geschrieben werden, und die schwierige („Stirrers“), bei der alle Buchstaben in den Wörtern gemischt werden. </li><li>  Wenn die Antwort richtig ist, wird dem Antwortenden ein Punkt gezählt.  Falsch - das Ergebnis geht an den Gegner. </li><li>  Wer mindestens N Punkte erzielt, kann an der Verlosung cooler Kopfhörer mit Geräuschunterdrückung teilnehmen. </li></ul><br><p>  Es scheint, dass alles recht einfach und einfach ist, aber es lagen Schwierigkeiten vor uns. </p><br><h1 id="mehanika-igry-i-podschyot-ballov">  Spielmechanik und Wertung </h1><br><p><img src="https://habrastorage.org/webt/wf/vr/e_/wfvre_npwrjlh4duabj8kkxb6og.gif"></p><br><p>  Aus diesem GIF ist ziemlich klar, wie der runde Prozess aussieht: </p><br><ol><li>  Ein verschlüsseltes Wort wird angezeigt. </li><li>  Der Timer startet für 10 Sekunden. </li><li>  Wenn einer der Spieler den Knopf drückt, stoppt dieser Timer und der andere startet stattdessen - für 3 Sekunden.  Während dieser Zeit muss dem Spieler eine Antwort gegeben werden, ansonsten wird die Punktzahl dem Gegner gutgeschrieben. </li><li>  Wenn niemand die Taste drückt, ändert sich das Wort automatisch und der gesamte Vorgang wird erneut wiederholt. </li></ol><br><p>  Das Hauptproblem, mit dem wir konfrontiert sind, besteht darin, die Punktzahl zu halten und die Spieler aufzunehmen.  Wir wollten das Spiel so schnell wie möglich machen und die Teilnehmer nicht zwingen, sich irgendwo anzumelden.  Es war jedoch notwendig zu verstehen, wer von ihnen eine bestimmte Anzahl von Punkten erzielte und den Hauptpreis erhalten konnte. </p><br><p>  Wir haben uns die Berechnungsmechanik nicht zum ersten Mal ausgedacht.  Erst nach mehreren Tests wurde klar, wie das Spiel bequem und einfach zu gestalten ist - sowohl für die Teilnehmer als auch für die Gastgeber. </p><br><h2 id="provalnye-i-genialnye-idei">  Fehlgeschlagene und geniale Ideen </h2><br><h3 id="ideya-1-odin-ball--odna-malenkaya-shokoladka">  Idee Nr. 1: Ein Punkt = eine kleine Tafel Schokolade </h3><br><p>  Für jede richtige Antwort haben wir uns zunächst entschieden, einen Schokoriegel zu geben.  Am Ende bringt der Teilnehmer Pralinen (oder zumindest Bonbonpapier aus den gegessenen "Punkten") und das war's!  Wir zählen Trophäen, wir erkennen den Gewinner. </p><br><p>  Es gibt jedoch einige Punkte. </p><br><p>  Erstens: es ist unpraktisch.  Es stellte sich heraus, dass es nicht möglich war, das Spiel zu moderieren und gleichzeitig Punkte zu berechnen, es wurde ein zweiter Assistent benötigt.  Dies ist zu kostspielig in Bezug auf die Kraft und Zeit der Jungs am Stand.  Und angesichts der Geschwindigkeit des Spiels müsste ich den Teilnehmern im wahrsten Sinne des Wortes Schokolade zuwerfen. </p><br><p>  Der zweite Punkt - wie unterscheide ich meine Pralinen von den Pralinen anderer Leute?  Die Spieler könnten zusammenarbeiten und Pralinen oder Bonbonpapier von ihnen stapeln.  Die Schaltung funktioniert also nicht!  Darüber hinaus sind die Konferenzen zweitägig und Sie können endlos Pralinen sammeln. </p><br><p>  Dritter Punkt: Sie brauchen zu viele Pralinen.  Wir haben experimentell überprüft, wie viele Punkte ein durchschnittlicher Spieler erzielt, und festgestellt, dass mindestens ein Wagen Schokolade braucht.  Und wir hatten nur einen kleinen Karren. </p><br><p><img src="https://habrastorage.org/webt/1h/j_/8z/1hj_8zp8amb6-taaowqum3y54gm.jpeg"></p><br><h3 id="ideya-2-turnirnaya-tablica">  Idee Nr. 2: Wertung </h3><br><p>  Während einige spielen, nehmen andere sich selbst in der Gesamtwertung auf.  In diesem Fall würden wir auf alle möglichen Probleme stoßen: Namensvetter, Namensvetter, Schreibfehler, unleserliches Schreiben (oder die Notwendigkeit, einen anderen großen Monitor und Laptop für die Eingabe zu verwenden), Unwillen, Ihre Kontakte zu verlassen und vieles mehr. </p><br><p>  Deshalb haben wir weiter gesucht. </p><br><h3 id="ideya-3-otmetki-na-beydzhah-uchastnikov">  Idee Nr. 3: Markierungen auf den Teilnehmerausweisen </h3><br><p>  Um das Problem der Registrierung von Spielern zu beseitigen, haben wir eine vorgefertigte Lösung verwendet: Abzeichen, die an alle Teilnehmer verteilt wurden.  Dies ist etwas, das niemand verlieren wird und das jeder Teilnehmer hat.  Wir haben beschlossen, einen Account direkt an sie zu schreiben.  Der Teilnehmer kam zur Zählung, schaute auf das Abzeichen, zählte die Punkte und bestimmte den Sieger.  Aber es gab auch einen Haken in diesem Schema: Die Spieler konnten das Endergebnis auf ihren Abzeichen „vortäuschen“. </p><br><p>  Dann haben wir die Idee, die Partitur aufzunehmen, komplett aufgegeben.  Lassen Sie diejenigen, die den Schwellenwert von Punkten erreichen, eine besondere Markierung im Abzeichen - einen Stempel in Form unseres Herzens - erhalten, die sie in den Kreis der "Auserwählten" eingetragen haben.  Und zwischen diesen Teilnehmern werden die Hauptpreise nach dem Zufallsprinzip gezogen.  Und der Rest bekommt noch Geschenke: unsere Sticker, Notizbücher, Karteninhaber und Entscheider. </p><br><p><img src="https://habrastorage.org/webt/_m/hz/u7/_mhzu7f8w8nizwmtpq57u-zdew4.jpeg" alt="Natürlich haben die Mitarbeiter von Badoo nicht am Gewinnspiel teilgenommen."><br>  <em>Natürlich haben die Mitarbeiter von Badoo nicht am Gewinnspiel teilgenommen.</em> </p><br><p>  Das Schema ist wie folgt: </p><br><ol><li>  Ein Gast ist auf dem Abzeichen mit einem Teilnahmestempel gekennzeichnet: Schwarz, um 20 Punkte zu erreichen, oder Violett, nur um zu spielen.  Pro Tag konnten drei Versuche unternommen und drei Herzen gewonnen werden. </li><li>  Alle Gewinner mit schwarzen Flecken versammeln sich zu einer bestimmten Zeit am Stand und mit Hilfe einer warmen Rohrlotterietrommel spielen wir Kopfhörer zwischen ihnen. </li></ol><br><p><img src="https://habrastorage.org/webt/gd/ui/bn/gduibngslf724dhlrpftt2ivxua.png"></p><br><p>  Nachdem wir das Spiel an lebenden Personen getestet hatten, errechneten wir die Schwelle: Es war nicht einfach, im Spiel 20 Punkte zu erzielen.  Aber in jedem der beiden Tage von Highload ++ waren ungefähr 15 Leute die Gewinner! </p><br><p>  Zwar gab es in der Wortliste einige Begriffe, die der Entwickler zuallererst verstand, so dass wir uns für die Heisenbug-QS-Konferenz auf eine Schwelle von 15 Punkten geeinigt hatten.  Vielleicht umsonst: Die Halbfinalisten waren um ein Vielfaches stärker, was bedeutet, dass die Gewinnchancen für Kopfhörer geringer sind. </p><br><p>  PS In der Anfangsphase haben wir entschieden, dass der Teilnehmer mit der falschen Antwort die Schokoladentafel-Punktzahl verliert.  Aber niemand mag etwas beraubt werden.  „Das ist meine Tafel Schokolade, das habe ich mir verdient!“ - die ersten Spieletester waren empört.  Deshalb begannen wir als Strafe, einem Gegner einen Punkt zu geben. </p><br><p><img src="https://habrastorage.org/webt/ry/yo/y5/ryyoy50ox1-o3zo-hyth8bae_pc.jpeg"></p><br><h1 id="animaciya">  Animation </h1><br><p>  Ein erratenes Wort sollte mit einer Art Animation erscheinen.  Dies gibt uns zwei Vorteile: </p><br><ol><li>  Eine Art "Prügel" zwischen Wörtern.  Es ist für die Spieler viel einfacher, von einem Wort zum anderen zu wechseln, wenn zwischen ihnen eine Aktion stattfindet.  Erinnern Sie sich an die alten Kampfspiele.  Jede neue Runde begann mit „3..2..1..FIGHT!“.  Ich wollte hier keinen weiteren Timer machen - wir haben sie bereits in loser Schüttung. </li><li>  Visuelle Vielfalt.  Wir haben versucht, das Spiel so einfach wie möglich zu gestalten. Wir hatten keine animierten Hintergründe und Übergänge zwischen den Levels.  Wir konnten auch keinen Ton verwenden, um andere Konferenzteilnehmer nicht zu stören.  Daher war eine Animation notwendig. </li></ol><br><p>  Bei ihr lief nicht alles auf Anhieb reibungslos.  Bei den Testläufen gab es schlaue Typen, die nicht auf das Ende der Animation gewartet und zuvor auf den Button geklickt haben.  Um die Tricks zu lehren, haben wir begonnen, das Wort nicht mehr anzuzeigen, wenn einer der Spieler vorzeitig einen Knopf gedrückt hat.  Der Teil des Wortes, der noch keine Zeit hatte zu erscheinen, blieb in diesem Fall hinter den Zeichen verborgen.  Ob der Spieler es wollte oder nicht, er musste antworten.  Es ist schwierig, ein Wort mit mehreren Buchstaben zu erraten, daher bekam der Gegner einen Punkt. </p><br><p>  So sieht das Wort aus, wenn Sie vorher auf die Schaltfläche klicken: </p><br><p><img src="https://habrastorage.org/webt/nv/gy/cb/nvgycbadg6xh84ufckataq_izri.gif"></p><br><p>  Der zweite schwierige Moment ist die Dauer der Animation.  Es dauerte immer die gleiche Zeit - 1,5 Sekunden.  Wenn Sie "den Rhythmus erfassen", können Sie den Dreh raus haben, einen Knopf schneller als der Gegner zu drücken.  Um das Problem zu lösen, haben wir eine Zufallsvariable zwischen 0 und 500 ms hinzugefügt.  In diesem Fall ist die Anpassung an den Rhythmus sehr viel schwieriger geworden. </p><br><h1 id="frontend">  Frontend </h1><br><p>  Ich werde Ihnen ein wenig über den Softwareteil erzählen.  Wenn Sie nicht interessiert sind, lesen Sie gleich die <a href="https://habr.com/ru/company/badoo/blog/482028/">Geschichte, wie wir nach den roten Knöpfen gesucht haben</a> . </p><br><p> Die Spielmechanik erwies sich als recht einfach, und ich wollte das Rad nicht neu erfinden.  Nahm <code>create-react-app</code> für die Client-Seite.  Aber die Herausforderung wurde noch gebraucht. </p><br><p>  Also hakt!  Lange Zeit tauchten Haken am Horizont auf, doch ihre Anwendung in den wichtigsten Badoo-Produkten erforderte ein gründliches Überdenken des Entwicklungsprozesses.  Ein kleines Nebenprojekt war ein großartiges Sprungbrett für ihre Verwendung. </p><br><p>  Kein Redux!  Redux ist eine großartige Sache, und wir setzen sie jeden Tag in unserer Arbeit ein.  Für eine so kleine Anwendung war die Verwendung von Redux jedoch nicht gerechtfertigt.  Außerdem gibt es einen neuen <code>useContext</code> Hook. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { score, changeScore } = useContext(SessionContext); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { next } = useContext(QuestionsContext); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> steps = useContext(StepsContext);</code> </pre> <br><p>  Ja, statt einer globalen Geschichte haben wir drei Kontexte, die sich überhaupt nicht überschnitten haben. </p><br><p>  <code>SessionContext</code> erzielt. <br>  <code>StepsContext</code> war für das Umschalten der Anwendungsbildschirme verantwortlich: Intro, Loop, Outro ... <br>  <code>QuestionsContext</code> wusste alles über die Fragen: Welche wurden beantwortet, welche Frage wird als nächstes gestellt, wie viel ist noch übrig? </p><br><h2 id="provider">  Provider </h2><br><p>  Jeder Kontext benötigt einen Anbieter, der Daten an die endgültigen Komponenten liefert.  Als Beispiel verwenden wir einen einfachen Anbieter für das Scoring. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> increment = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">score</span></span></span><span class="hljs-function"> =&gt;</span></span> score + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SessionProvider = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [leftPlayerScore, changeLeftPlayerScore] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [rightPlayerScore, changeRightPlayerScore] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> resetScore = useCallback(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { changeLeftPlayerScore(<span class="hljs-number"><span class="hljs-number">0</span></span>); changeRightPlayerScore(<span class="hljs-number"><span class="hljs-number">0</span></span>); }, []); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> changeScore = useCallback(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">player</span></span></span><span class="hljs-function"> =&gt;</span></span> { player === <span class="hljs-string"><span class="hljs-string">'left'</span></span> ? changeLeftPlayerScore(increment) : changeRightPlayerScore(increment); }, []); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> score = { <span class="hljs-attr"><span class="hljs-attr">left</span></span>: leftPlayerScore, <span class="hljs-attr"><span class="hljs-attr">right</span></span>: rightPlayerScore }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">SessionContext.Provider</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">score</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">changeScore</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">resetScore</span></span></span></span><span class="xml"><span class="hljs-tag"> }}&gt;</span></span></span><span class="xml"> {props.children} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">SessionContext.Provider</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ); };</span></span></code> </pre> <br><p>  Wie Sie dem Code entnehmen können, verfolgen wir Punkte unabhängig voneinander.  Es gibt einen separaten Status für die Spieler "links" und "rechts".  Sowie Funktionen zur Verwaltung des Kontos: Konto zurücksetzen und ändern. </p><br><p>  Die resultierende Provider-API ist sehr einfach.  Im Allgemeinen war fast die gesamte Logik der Anbieter sehr einfach, sodass wir uns nicht darauf konzentrieren werden. </p><br><h2 id="taymery">  Timer </h2><br><p>  Die Komponente der Hauptrunde des Spiels erwies sich als interessant: Es gab mehrdeutige Momente.  Die Komponente ist für beide Modi gleich (Reverse und Shuffle - „Shortcuts“ und „Mixer“). </p><br><p>  Aus der Beschreibung der Runde geht hervor, dass es viel Wechselwirkung mit der Zeit gibt. </p><br><p>  Erstens gibt es einen Timer, der für die Dauer des Wortes auf dem Bildschirm verantwortlich ist: 10 Sekunden, um eine Taste zu drücken.  Wenn niemand die Taste gedrückt hat, erscheint automatisch das nächste Wort. </p><br><p>  Zweitens ein Timer, der startet, wenn einer der Spieler auf eine Schaltfläche klickt.  Dann hat er 3 Sekunden Zeit, um das Wort zu erraten. </p><br><p>  Es scheint, dass dies nichts Kompliziertes ist, also schreiben wir solch scheinbar offensichtlichen Code: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [time, nextTick] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> id = setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { nextTick(time + <span class="hljs-number"><span class="hljs-number">1</span></span>); }, <span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> clearInterval(id); }, []);</code> </pre> <br><p>  Aber wie Sie sich denken können, hat dies nicht funktioniert.  Es hat einfach überhaupt nicht funktioniert! </p><br><p>  Der Timer erreichte 1 und blieb dabei stehen.  Tatsache ist, dass der alte Zeitwert innerhalb der Funktion des Handlers "gesperrt" wurde.  Daher bezog sich <code>setInterval</code> bei jedem Häkchen auf den Zeitwert ab dem ersten Rendern. </p><br><p>  Es gab eine Lösung für das Problem, eine Funktion anstelle eines direkten Werts zu verwenden: </p><br><pre> <code class="javascript hljs">nextTick(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">currentTime</span></span></span><span class="hljs-function"> =&gt;</span></span> currentTime + <span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br><p>  Ja, so hatten wir immer einen "frischen" Wert für den Timer.  Aber wir konnten zum Beispiel keine "frischen" <code>props</code> bekommen. </p><br><p>  Offensichtlich musste ein anderer Ansatz gefunden werden.  Und die sicherste Entscheidung war, die Handlerfunktion veränderbar zu machen.  React hat dafür einen speziellen <code>useRef</code> Haken. </p><br><p>  Am häufigsten wird es zum Arbeiten mit DOM-Elementen verwendet, dies ist jedoch nicht die einzige Anwendung.  Wir können uns jede Variable in der <code>current</code> Eigenschaft merken und sie bei jedem Rendern aktualisieren. </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">callback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ setCount(count + <span class="hljs-number"><span class="hljs-number">1</span></span>); } useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { savedCallback.current = callback; }); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ savedCallback.current(); } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> id = setInterval(tick, <span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> clearInterval(id); }, []);</code> </pre> <br><p>  Es gibt einen guten Artikel von Dan Abramov über die Arbeit mit <code>setInterval</code> und React-Hooks: <a href="https://overreacted.io/making-setinterval-declarative-with-react-hooks/">setInterval mit React-Hooks deklarieren</a> .  Er beschrieb perfekt alle Fallstricke und alle Phasen der Reflexion über die Implementierung des <code>useInterval</code> Hakens, den wir als Lösung für unser Problem verwendeten. </p><br><p>  Da der Stand während der gesamten Konferenz geöffnet war, war eine kontinuierliche Sitzung mit dem Spiel sehr groß.  Die Seite wurde überhaupt nicht aktualisiert (F5), daher war es sehr wichtig, den Speicher in der Entwicklungsphase zu überwachen.  Wie Sie wissen, gehen Lecks mit Timern einher, und wenn dies alles mit Re-Renderings der Reaktion gewürzt ist, dann wäre es ziemlich einfach, Code zu schreiben, der sehr, sehr viel Speicher benötigt. </p><br><p>  <code>Countdown</code> wurde Dutzende (oder sogar Hunderte) Mal in einer Spielsitzung gestartet, gestoppt, zurückgesetzt und neu gestartet.  Um uns nicht mit Schecks zu beschäftigen, die eigentlich viel hätten sein müssen, haben wir einen einfachen „Trick“ angewendet - wir haben dieser Komponente <code>key</code> hinzugefügt. </p><br><pre> <code class="javascript hljs">&lt;QuestionCountdown key={question.text} onComplete={nextQuestion} /&gt;</code> </pre> <br><p>  Wir werden nicht im Detail darauf eingehen, Dan Abramov hat eine umfassende Beschreibung des Prozesses der Abstimmung der Reaktion: <a href="https://overreacted.io/react-as-a-ui-runtime/">Reagieren als UI-Laufzeit</a> . </p><br><h1 id="apparatnaya-chast-dve-krasnye-knopki">  Hardware: zwei rote Knöpfe </h1><br><p>  Wir haben also bereits einige der Anforderungen für das Spiel erfüllt: Es war im Mehrspielermodus, schnell und mit einfacher Mechanik.  Es bleibt zu ihrer Unterhaltung hinzuzufügen.  Die Geschichte wird von Yura Lilekov <a href="https://habr.com/ru/users/lilek/" class="user_link">Lilek verfolgt</a> - unserem DIY-Enthusiasten, einem ständigen Sprecher der Community, dem Schöpfer des fliegenden Flügels und anderen Do-it-yourself-Geräten. </p><br><p>  Wir wollten unbedingt zwei große mechanische Knöpfe finden.  Und um sicher zu gehen, dass die roten - wie in diesem Meme mit Agutin. </p><br><p>  Leider war alles, was in Online-Shops zu finden war, entweder zu klein (5 cm Durchmesser) oder es gab überhaupt keine Knöpfe.  Natürlich gab es ein gutes, altes AliExpress, aber es gab keine Zeit, auf die Lieferung zu warten. </p><br><p>  Als Ergebnis fanden wir die richtigen Schaltflächen auf der Website einer Kreativagentur.  Knöpfe irgendwo in den Vororten hatte Alexander (anscheinend Absolvent der Fakultät für Radioelektronik).  Wir haben angerufen, gefragt, welcher Mikrocontroller in die Box eingenäht ist, und gefragt, ob wir darauf zugreifen dürfen, weil wir ihn neu programmieren müssen. </p><br><p>  Alexander war, gelinde gesagt, über solche Fragen überrascht.  Als wir fragten, ob die Tasten dem Druck begeisterter Programmierer standhalten würden, versicherte er uns, dass sich solche Tasten in den Spielautomaten von "Cosmic" befinden und den Kinderfluss perfekt bewältigen.  Mit Blick auf die Zukunft werde ich sagen, dass die Heizungsingenieure auch die Knöpfe behalten haben (nur die Batterie musste einmal gewechselt werden). </p><br><p><img src="https://habrastorage.org/webt/bh/hb/bd/bhhbbdvztsnypogvlbn3jpo3nvg.png"></p><br><h2 id="nachinka">  Füllung </h2><br><p>  Leider hatte das fertige Gerät nicht alle Eigenschaften, die wir brauchten.  Und wenn Sie die Soundeffekte immer noch beseitigen könnten, indem Sie das Kabel zum Lautsprecher abschneiden, wäre es keine leichte Aufgabe, automatisch festzustellen, welche Taste gedrückt wurde.  Es bot sich eine einfache Möglichkeit an: Schließen Sie das Gerät an den Computer an und übersetzen Sie das Drücken dieser Tasten in die Tastenanschläge auf der Tastatur. </p><br><p>  Die Lösung ohne Schnickschnack - die alte USB-Tastatur zu nehmen und ein paar Tasten mit zusätzlichen Kabeln von der Tastatur zum Gerät zu bringen - wird sofort als "kollektive Farm" abgetan.  Und schloss die Macht der DIY. </p><br><p>  Nach einiger Überlegung entschieden wir uns, das Arduino Pro Micro Board auf Basis des ATmega32u4-Mikrocontrollers der AVmel-Familie von Atmel mit der erforderlichen Bindung zu verwenden.  Auf dieser Karte sind unter anderem I / O- und MicroUSB-Ports getrennt.  Und was am wichtigsten ist: Der ATmega32u4-Mikrocontroller kann als HID-Gerät fungieren, dh in unserem Fall können Tastatureingaben unter bestimmten Bedingungen emuliert werden. </p><br><p><img src="https://habrastorage.org/webt/me/pn/d9/mepnd9yvzya5fkqdxqgbsvtwgjo.png" alt="(Das Foto wurde von einem der Verkäufer von AliExpress.com gemacht"></p><br><p>  Um diesen Mikrocontroller zu programmieren, benötigen Sie nur den üblichen MicroUSB-Draht und die Arduino IDE-Entwicklungsumgebung. </p><br><p>  Nach der Installation der Entwicklungsumgebung sind die einfachsten Codebeispiele sofort verfügbar. </p><br><p>  Hier befindet sich beispielsweise ein Programm, das das Schreiben auf einer Tastatur emuliert, wenn eine Taste gedrückt wird (verbunden mit einem Eingabe- / Ausgabeport): </p><br><p>  Datei-&gt; Beispiele-&gt; USB-&gt; Tastatur-&gt; KeyboardMessage </p><br><p>  Die Emulation von Tastenanschlägen ist sehr einfach: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#include "Keyboard.h" //      void setup() { Keyboard.begin(); //   } void loop() { Keyboard.print("Test"); //   4  delay(1000); //   1  }</span></span></code> </pre> <br><p>  Das Lesen des Eingangsportstatus ist auch kein Schnickschnack: </p><br><pre> <code class="cmake hljs">int button_pin = <span class="hljs-number"><span class="hljs-number">7</span></span>; //  ,     void setup() { pinMode(button_pin, INPUT); //     } void loop() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(button_pin)) { //   } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { //    } }</code> </pre> <br><p>  Da der Port durch Spannung und nicht durch Strom geöffnet wird, können die kleinsten induzierten Ströme in den Drähten, die vom Knopf zum Port gehen, falsch positive Ergebnisse liefern.  Wir empfehlen daher, die Eingangsanschlüsse mit hochohmigen Widerständen "hochzuziehen": Der induzierte Strom fließt sofort durch sie in die "Masse", wodurch verhindert wird, dass eine hohe Spannungsdifferenz zwischen dem Eingang und der "Masse" auftritt und somit keine falsche Auslösung erfolgt.  Für diese Zwecke reicht ein 5-10 kΩ Widerstand, der zwischen den Eingang des Mikrocontrollers und dessen "Masse" geschaltet ist. </p><br><p>  Somit erhalten wir das folgende Schema: </p><br><p><img src="https://habrastorage.org/webt/gt/na/3l/gtna3lp5_d3iag_lzxh115oug6s.png"></p><br><p>  Das Arduino Pro Micro Board wird über microUSB mit einem Laptop mit dem Softwareteil des Spiels verbunden, zwei Tasten verbinden sich mit zwei Eingängen des Boards und der allgemeinen Stromversorgung.  Auch diese beiden Eingänge werden von zwei Widerständen auf Masse gezogen. </p><br><p>  Wenn eine der Tasten gedrückt wird, fließt der Strom vom Stromversorgungsausgang der Karte über die Taste zum entsprechenden Eingang der Karte - daher sehen wir eine logische „Einheit“ am Eingang. </p><br><p>  Im Softwareteil haben wir uns entschlossen, die Tastenanschläge „linker Pfeil“ und „rechter Pfeil“ zu emulieren und nach dem Ermitteln des Drucks eine Verzögerung von 4 Sekunden einzuhalten, um wiederholte Klicks von Teilnehmern oder Klappern von Kontakten in den Tasten zu vermeiden. </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#include &lt;Keyboard.h&gt; char leftKey = KEY_LEFT_ARROW; char rightKey = KEY_RIGHT_ARROW; int btn1pin = 7; int btn1value = 0; int btn2pin = 8; int btn2value = 0; void setup() { pinMode(btn1pin, INPUT); pinMode(btn2pin, INPUT); Keyboard.begin(); } void loop() { btn1value = digitalRead(btn1pin); btn2value = digitalRead(btn2pin); if (btn1value == 1 &amp;&amp; btn2value == 1) { //    =    } else if (btn1value == 0 &amp;&amp; btn2value == 0) { //    =    } else if (btn1value == 1) { //    =       4  Keyboard.press(leftKey); delay(100); Keyboard.releaseAll(); delay(4000); } else if (btn2value == 1) { //    =       4  Keyboard.press(rightKey); delay(100); Keyboard.releaseAll(); delay(4000); } }</span></span></code> </pre> <br><p>  So haben wir mit Hilfe einfacher Geräte die Tasten gelehrt, den Spieler zu identifizieren, der schneller als der Gegner darauf klickt, und dies dem Moderator zu signalisieren. </p><br><h2 id="upravlenie">  Management </h2><br><p>  Vollständig manuell und so einfach wie möglich: </p><br><ul><li>  <strong>Leertaste</strong> - Nächstes Wort </li><li>  <strong>Enter</strong> - zeigt das richtige Wort </li><li>  <strong>+</strong> - wahr (1 Punkt) </li><li>  <strong>0</strong> - falsch (Punkt zum Gegner) </li><li>  Linke <strong>Umschalttaste</strong> - Nächster Schritt </li><li>  Rechtsverschiebung - vorheriger Schritt </li></ul><br><h1 id="rezultat">  Ergebnis </h1><br><p>  Alle vier Konferenztage (zwei auf Highload ++, zwei auf Heisenbug) am Badoo-Stand spielten ununterbrochen das „IT-Ratespiel“.  Alle unsere Hoffnungen haben sich erfüllt: </p><br><ul><li>  Das Spiel zog sowohl Teilnehmer als auch Zuschauer an: Eine ganze Reihe von Menschen versammelte sich am Stand.  Besonders erfreulich ist, dass am zweiten Konferenztag die Teilnehmerzahl nicht gesunken ist. </li><li>  Knöpfe sind die Spitze!  Addiere +100 zur Aufregung.  Auch wenn die Rivalen einander fremd waren, verursachte das Spiel viele Emotionen. </li><li>  Die Idee mit den Markierungen auf dem Abzeichen ging auf: Es war kein Problem, Gewinner zu finden und Kontakte zu sammeln.  Ein paar Leute baten darum, ihren Ausweis sauber zu lassen, also haben wir unsere Handgelenke mit Markierungen versehen (sie ließen sich leicht löschen). </li><li>  Wir verteilten 14 Kopfhörer und mehrere hundert kleine Preise.  Niemand wurde ohne ein Geschenk verlassen! </li></ul><br><p><img src="https://habrastorage.org/webt/zd/fd/vh/zdfdvheuxobpk3y0st_kbzpkgl0.jpeg"></p><br><div class="spoiler">  <b class="spoiler_title">Für die Teilnahme am Spiel auf der Konferenz haben wir einen coolen Merch vorgestellt</b> <div class="spoiler_text"><p>  <strong>Entscheider auf einen Magneten.</strong>  Sie wissen nicht, was Sie mit der Aufgabe anfangen sollen - drehen Sie die magische Scheibe!  Wir haben nur noch ein paar Fotos übrig, da wir alles verteilt haben: </p><br><p><img src="https://habrastorage.org/webt/qe/yc/fw/qeycfwgjxk5wad7b4slq5uqgmy0.jpeg"><br>  <em>Für QS-Ingenieure</em> </p><br><p><img src="https://habrastorage.org/webt/wy/so/ct/wysoct41vwjzn6qd-lzog7nmo7o.jpeg"><br>  <em>Für Entwickler</em> </p><br><p>  <strong>IT-Vorhersage-Cookies</strong> <br>  Vorhersagen wurden selbst erfunden (52 Optionen).  Erfüllen Sie sich mit einer Wahrscheinlichkeit von bis zu 100%. </p><br><p><img src="https://habrastorage.org/webt/ni/c9/vu/nic9vu9vf1xqh3xb7dyyli-mqni.png"></p><br><p><img src="https://habrastorage.org/webt/av/nf/vm/avnfvmkteect_rwrelfazf8kuau.png"></p></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de482028/">https://habr.com/ru/post/de482028/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de482010/index.html">"Neue Epen". Für Entwickler, Ops und Neugierige</a></li>
<li><a href="../de482012/index.html">Raspberry Pi und iperf - Bandbreitentester für Smart Home- und IoT-Geräte</a></li>
<li><a href="../de482014/index.html">Akzeptieren und dekodieren Sie analoges Fernsehen mit SDR und Python</a></li>
<li><a href="../de482020/index.html">R, Monte Carlo und Unternehmensaufgaben</a></li>
<li><a href="../de482022/index.html">Schau einfach! 20 Filme über Wissenschaft und Wissenschaftler</a></li>
<li><a href="../de482030/index.html">Vue.js: Lifecycle-Hooks für Ihre und Komponenten von Drittanbietern</a></li>
<li><a href="../de482034/index.html">Yandex: Es gibt alles ... über Benutzer</a></li>
<li><a href="../de482038/index.html">Wir fassen die Ergebnisse von 2019 bei Haber Career zusammen</a></li>
<li><a href="../de482040/index.html">Enthält Profiling-Programme in C ++</a></li>
<li><a href="../de482042/index.html">Arbeiten mit der Newtonsoft.Json-Bibliothek anhand eines realen Beispiels. Teil 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>