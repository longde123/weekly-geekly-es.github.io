<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï∫üèæ üíÉüèª ü§õüèæ Atributos y protocolo de manejo en Python üöÉ üîà üí±</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Considere el siguiente c√≥digo: 


class Foo: def __init__(self): self.bar = 'hello!' foo = Foo() print(foo.bar)  


 Hoy analizaremos la respuesta a l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Atributos y protocolo de manejo en Python</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479824/"><p>  Considere el siguiente c√≥digo: </p><br><pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.bar = <span class="hljs-string"><span class="hljs-string">'hello!'</span></span> foo = Foo() print(foo.bar)</code> </pre> <br><p>  Hoy analizaremos la respuesta a la pregunta: "¬øQu√© sucede exactamente cuando escribimos <b>foo.bar</b> ?" </p><br><hr><br><p>  Es posible que ya sepa que la mayor√≠a de los objetos tienen un diccionario interno <b>__dict__ que</b> contiene todos sus atributos.  Y lo que es especialmente agradable es lo f√°cil que es estudiar esos detalles de bajo nivel en Python: </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>foo = Foo() &gt;&gt;&gt; foo.__dict__ {<span class="hljs-string"><span class="hljs-string">'bar'</span></span>: <span class="hljs-string"><span class="hljs-string">'hello!'</span></span>}</code> </pre> <br><p>  Comencemos tratando de formular esta hip√≥tesis (incompleta): </p><br><blockquote><p>  <b>foo.bar es</b> equivalente a <b>foo .__ dict __ ['bar']</b> . </p></blockquote><br><p>  Si bien suena como la verdad: </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>foo = Foo() &gt;&gt;&gt; foo.__dict__[<span class="hljs-string"><span class="hljs-string">'bar'</span></span>] <span class="hljs-string"><span class="hljs-string">'hello!'</span></span></code> </pre> <br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d4/37d/f92/1d437df921081d6342ec3842312e5942.png"></div><a name="habracut"></a><br><p>  Ahora suponga que ya sabe que <a href="https://amir.rachum.com/blog/2016/10/05/python-dynamic-attributes/">los atributos din√°micos se pueden declarar</a> en clases: </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> ... self.bar = <span class="hljs-string"><span class="hljs-string">'hello!'</span></span> ... ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__getattr__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, item)</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'goodbye!'</span></span> ... ... foo = Foo() &gt;&gt;&gt; foo.bar <span class="hljs-string"><span class="hljs-string">'hello!'</span></span> &gt;&gt;&gt; foo.baz <span class="hljs-string"><span class="hljs-string">'goodbye!'</span></span> &gt;&gt;&gt; foo.__dict__ {<span class="hljs-string"><span class="hljs-string">'bar'</span></span>: <span class="hljs-string"><span class="hljs-string">'hello!'</span></span>}</code> </pre> <br><p>  Hmm ... est√° bien.  Se puede ver que <b>__getattr__</b> puede emular el acceso a los atributos "falsos", pero no funcionar√° si ya hay una variable declarada (como <b>foo.bar</b> que devuelve <b>'¬°hola!'</b> Y no <b>'¬°adi√≥s!'</b> ).  Todo parece ser un poco m√°s complicado de lo que parec√≠a al principio. </p><br><p>  Y de hecho: hay un m√©todo m√°gico que se llama cada vez que intentamos obtener un atributo, pero, como lo mostr√≥ el ejemplo anterior, este no es <b>__getattr__</b> .  El m√©todo llamado se llama <b>__getattribute__</b> , e intentaremos entender c√≥mo funciona exactamente observando varias situaciones. </p><br><p>  Hasta ahora, modificamos nuestra hip√≥tesis de la siguiente manera: </p><br><blockquote><p>  <b>foo.bar es</b> equivalente a <b>foo .__ getattribute __ ('bar')</b> , que m√°s o menos funciona as√≠: </p><br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__getattribute__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, item)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.__dict__: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.__dict__[item] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.__getattr__(item)</code> </pre> </blockquote><br><p>  Lo probaremos implementando este m√©todo (con un nombre diferente) y llam√°ndolo directamente: </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> ... self.bar = <span class="hljs-string"><span class="hljs-string">'hello!'</span></span> ... ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__getattr__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, item)</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'goodbye!'</span></span> ... ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">my_getattribute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, item)</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.__dict__: ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.__dict__[item] ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.__getattr__(item) &gt;&gt;&gt; foo = Foo() &gt;&gt;&gt; foo.bar <span class="hljs-string"><span class="hljs-string">'hello!'</span></span> &gt;&gt;&gt; foo.baz <span class="hljs-string"><span class="hljs-string">'goodbye!'</span></span> &gt;&gt;&gt; foo.my_getattribute(<span class="hljs-string"><span class="hljs-string">'bar'</span></span>) <span class="hljs-string"><span class="hljs-string">'hello!'</span></span> &gt;&gt;&gt; foo.my_getattribute(<span class="hljs-string"><span class="hljs-string">'baz'</span></span>) <span class="hljs-string"><span class="hljs-string">'goodbye!'</span></span></code> </pre> <br><p>  Se ve bien, ¬øverdad? </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f5b/608/b1d/f5b608b1dc3497cb2406f746ea2836a7.png"></div><br><p>  Bueno, todo lo que queda es verificar que la asignaci√≥n de variables sea compatible, despu√©s de lo cual puede irse a casa ... </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>foo.baz = <span class="hljs-number"><span class="hljs-number">1337</span></span> &gt;&gt;&gt; foo.baz <span class="hljs-number"><span class="hljs-number">1337</span></span> &gt;&gt;&gt; foo.my_getattribute(<span class="hljs-string"><span class="hljs-string">'baz'</span></span>) = <span class="hljs-string"><span class="hljs-string">'h4x0r'</span></span> SyntaxError: can<span class="hljs-string"><span class="hljs-string">'t assign to function call</span></span></code> </pre> <br><p>  El infierno </p><br><p>  <b>my_getattribute</b> devuelve un objeto.  Podemos cambiarlo si es mutable, pero no podemos reemplazarlo con otro usando el operador de asignaci√≥n.  Que hacer  Despu√©s de todo, si <b>foo.baz</b> es el equivalente de llamar a una funci√≥n, ¬øc√≥mo podemos asignar un nuevo valor a un atributo en principio? </p><br><p>  Cuando miramos una expresi√≥n como <b>foo.bar = 1</b> , hay m√°s que solo llamar a una funci√≥n para obtener el valor de <b>foo.bar</b> .  <strong>Asignar un valor a un</strong> atributo parece ser fundamentalmente diferente de <strong>obtener un valor de</strong> atributo.  Y la verdad: podemos implementar <b>__setattr__</b> para ver esto: </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> ... self.__dict__[<span class="hljs-string"><span class="hljs-string">'my_dunder_dict'</span></span>] = {} ... self.bar = <span class="hljs-string"><span class="hljs-string">'hello!'</span></span> ... ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__setattr__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, item, value)</span></span></span><span class="hljs-function">:</span></span> ... self.my_dunder_dict[item] = value ... ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__getattr__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, item)</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.my_dunder_dict[item] &gt;&gt;&gt; foo = Foo() &gt;&gt;&gt; foo.bar <span class="hljs-string"><span class="hljs-string">'hello!'</span></span> &gt;&gt;&gt; foo.bar = <span class="hljs-string"><span class="hljs-string">'goodbye!'</span></span> &gt;&gt;&gt; foo.bar <span class="hljs-string"><span class="hljs-string">'goodbye!'</span></span> &gt;&gt;&gt; foo.baz Traceback (most recent call last): File <span class="hljs-string"><span class="hljs-string">"&lt;pyshell#75&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;module&gt; foo.baz File <span class="hljs-string"><span class="hljs-string">"&lt;pyshell#70&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> __getattr__ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.my_dunder_dict[item] KeyError: <span class="hljs-string"><span class="hljs-string">'baz'</span></span> &gt;&gt;&gt; foo.baz = <span class="hljs-number"><span class="hljs-number">1337</span></span> &gt;&gt;&gt; foo.baz <span class="hljs-number"><span class="hljs-number">1337</span></span> &gt;&gt;&gt; foo.__dict__ {<span class="hljs-string"><span class="hljs-string">'my_dunder_dict'</span></span>: {<span class="hljs-string"><span class="hljs-string">'bar'</span></span>: <span class="hljs-string"><span class="hljs-string">'goodbye!'</span></span>, <span class="hljs-string"><span class="hljs-string">'baz'</span></span>: <span class="hljs-number"><span class="hljs-number">1337</span></span>}}</code> </pre> <br><p>  Un par de cosas a tener en cuenta con respecto a este c√≥digo: </p><br><ol><li>  <b>__setattr__</b> no tiene contraparte con <b>__getattribute__</b> (es decir, el m√©todo m√°gico <b>__setattribute__</b> no existe). </li><li>  <b>__setattr__</b> se llama dentro de <b>__init__</b> , por lo que nos vemos obligados a hacer <b>uno mismo .__ dict __ ['my_dunder_dict'] = {} en</b> lugar de <b>self.my_dunder_dict = {}</b> .  De lo contrario, nos encontrar√≠amos con una recursi√≥n infinita. </li></ol><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cba/a41/b98/cbaa41b980b0c9a6f9628d9461ba3568.jpg"></div><br><p>  Pero tambi√©n tenemos <b>propiedades</b> (y sus amigos).  Un decorador que permite que los m√©todos act√∫en como atributos. </p><br><p>  Tratemos de entender c√≥mo sucede esto. </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__getattribute__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, item)</span></span></span><span class="hljs-function">:</span></span> ... print(<span class="hljs-string"><span class="hljs-string">'__getattribute__ was called'</span></span>) ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> super().__getattribute__(item) ... ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__getattr__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, item)</span></span></span><span class="hljs-function">:</span></span> ... print(<span class="hljs-string"><span class="hljs-string">'__getattr__ was called'</span></span>) ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> super().__getattr__(item) ... ... @property ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> ... print(<span class="hljs-string"><span class="hljs-string">'bar property was called'</span></span>) ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span> &gt;&gt;&gt; f = Foo() &gt;&gt;&gt; f.bar __getattribute__ was called bar property was called</code> </pre> <br><p>  Solo por diversi√≥n, ¬øqu√© tenemos en <b>f .__ dict__</b> ? </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>f.__dict__ __getattribute__ was called {}</code> </pre> <br><p>  No <b>hay</b> una tecla de <b>barra</b> en <b>__dict__</b> , pero <b>__getattr__</b> no se llama por alguna raz√≥n.  <a href="https://www.destroyallsoftware.com/talks/wat">Wat?</a> </p><br><p>  <b>bar</b> es un m√©todo que tambi√©n toma <strong>self</strong> como par√°metro, solo este m√©todo est√° en la clase y no en la instancia de la clase.  Y esto es f√°cil de ver: </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>Foo.__dict__ mappingproxy({<span class="hljs-string"><span class="hljs-string">'__dict__'</span></span>: &lt;attribute <span class="hljs-string"><span class="hljs-string">'__dict__'</span></span> of <span class="hljs-string"><span class="hljs-string">'Foo'</span></span> objects&gt;, <span class="hljs-string"><span class="hljs-string">'__doc__'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'__getattr__'</span></span>: &lt;function Foo.__getattr__ at <span class="hljs-number"><span class="hljs-number">0x038308A0</span></span>&gt;, <span class="hljs-string"><span class="hljs-string">'__getattribute__'</span></span>: &lt;function Foo.__getattribute__ at <span class="hljs-number"><span class="hljs-number">0x038308E8</span></span>&gt;, <span class="hljs-string"><span class="hljs-string">'__module__'</span></span>: <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>, <span class="hljs-string"><span class="hljs-string">'__weakref__'</span></span>: &lt;attribute <span class="hljs-string"><span class="hljs-string">'__weakref__'</span></span> of <span class="hljs-string"><span class="hljs-string">'Foo'</span></span> objects&gt;, <span class="hljs-string"><span class="hljs-string">'bar'</span></span>: &lt;property object at <span class="hljs-number"><span class="hljs-number">0x0381EC30</span></span>&gt;})</code> </pre> <br><p>  La clave de la <b>barra</b> est√° en el diccionario de atributos de clase.  Para entender c√≥mo <b>funciona __getattribute__</b> , debemos responder a la pregunta: ¬ø <b>A</b> qui√©n se llama <b>__getattribute__</b> antes, una clase o una instancia? </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>f.__dict__[<span class="hljs-string"><span class="hljs-string">'bar'</span></span>] = <span class="hljs-string"><span class="hljs-string">'will we see this printed?'</span></span> __getattribute__ was called &gt;&gt;&gt; f.bar __getattribute__ was called bar property was called <span class="hljs-number"><span class="hljs-number">100</span></span></code> </pre> <br><p>  Se puede ver que lo primero que hace la verificaci√≥n es en la clase <b>__dict__</b> , es decir  tiene prioridad sobre la instancia. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e86/62f/4f1/e8662f4f14405a95339c4c79272afbfc.gif"></div><br><p>  Espera un minuto, ¬øcu√°ndo llamamos al m√©todo de la <b>barra</b> ?  Quiero decir, nuestro pseudoc√≥digo para <b>__getattribute__</b> nunca llama a un objeto.  Que esta pasando </p><br><p>  Conoce <a href="https://docs.python.org/3/howto/descriptor.html">el protocolo descriptor</a> : </p><br><blockquote><p>  <b>descr .__ get __ (self, obj, type = None) -&gt; value</b> </p><br><p>  <b>descr .__ set __ (self, obj, value) -&gt; Ninguno</b> </p><br><p>  <b>descr .__ delete __ (self, obj) -&gt; Ninguno</b> </p><br><br><p>  Todo el punto est√° aqu√≠.  Implemente cualquiera de estos tres m√©todos para que el objeto se convierta en un descriptor y pueda cambiar el comportamiento predeterminado cuando se trata como un atributo. </p><br><br><p>  Si un objeto declara <b>__get __ ()</b> y <b>__set __ ()</b> , se llama descriptor de datos.  Los descriptores que implementan solo <b>__get __ ()</b> se denominan descriptores que no son de datos. </p><br><br><p>  Ambos tipos de descriptores difieren en c√≥mo se sobrescriben los elementos del diccionario de atributos del objeto.  Si el diccionario contiene una clave con el mismo nombre que el descriptor de datos, entonces el descriptor de datos tiene prioridad (es decir, se <b>llama __set __ ()</b> ).  Si el diccionario contiene una clave con el mismo nombre que el descriptor sin datos, entonces el diccionario tiene prioridad (es decir, se sobrescribe el elemento del diccionario). </p><br><br><p>  Para crear un descriptor de datos de solo lectura, declare tanto <b>__get __ ()</b> como <b>__set __ ()</b> , donde <b>__set __ ()</b> arroja un <strong>AttributeError</strong> cuando se llama.  Implementar este <b>__set __ () es</b> suficiente para crear un descriptor de datos. </p></blockquote><br><p>  En resumen, si declaraste alguno de estos m√©todos <b>__get__</b> , <b>__set__</b> o <b>__delete__</b> , implementaste soporte para el protocolo descriptor.  Y esto es exactamente lo que hace el decorador de <b>propiedades</b> : declara un descriptor de solo lectura que se llamar√° en <b>__getattribute__</b> . </p><br><p>  √öltimo cambio en nuestra implementaci√≥n: </p><br><blockquote><p>  <b>foo.bar es</b> equivalente a <b>foo .__ getattribute __ ('bar')</b> , que m√°s o menos funciona as√≠: </p><br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__getattribute__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, item)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.__class__.__dict__: v = self.__class__.__dict__[item] <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.__dict__: v = self.__dict__[item] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: v = self.__getattr__(item) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> hasattr(v, <span class="hljs-string"><span class="hljs-string">'__get__'</span></span>): v = v.__get__(self, type(self)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> v</code> </pre> </blockquote><br><p>  Tratemos de demostrar en la pr√°ctica: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class">:</span></span> class_attr = <span class="hljs-string"><span class="hljs-string">"I'm a class attribute!"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.dict_attr = <span class="hljs-string"><span class="hljs-string">"I'm in a dict!"</span></span> @property <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">property_attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"I'm a read-only property!"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__getattr__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, item)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"I'm dynamically returned!"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">my_getattribute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, item)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.__class__.__dict__: print(<span class="hljs-string"><span class="hljs-string">'Retrieving from self.__class__.__dict__'</span></span>) v = self.__class__.__dict__[item] <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.__dict__: print(<span class="hljs-string"><span class="hljs-string">'Retrieving from self.__dict__'</span></span>) v = self.__dict__[item] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: print(<span class="hljs-string"><span class="hljs-string">'Retrieving from self.__getattr__'</span></span>) v = self.__getattr__(item) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> hasattr(v, <span class="hljs-string"><span class="hljs-string">'__get__'</span></span>): print(<span class="hljs-string"><span class="hljs-string">"Invoking descriptor's __get__"</span></span>) v = v.__get__(self, type(self)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> v</code> </pre> <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>foo = Foo() ... ... print(foo.class_attr) ... print(foo.dict_attr) ... print(foo.property_attr) ... print(foo.dynamic_attr) ... ... print() ... ... print(foo.my_getattribute(<span class="hljs-string"><span class="hljs-string">'class_attr'</span></span>)) ... print(foo.my_getattribute(<span class="hljs-string"><span class="hljs-string">'dict_attr'</span></span>)) ... print(foo.my_getattribute(<span class="hljs-string"><span class="hljs-string">'property_attr'</span></span>)) ... print(foo.my_getattribute(<span class="hljs-string"><span class="hljs-string">'dynamic_attr'</span></span>)) I<span class="hljs-string"><span class="hljs-string">'m a class attribute! I'</span></span>m <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a dict! I<span class="hljs-string"><span class="hljs-string">'m a read-only property! I'</span></span>m dynamically returned! Retrieving <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> self.__class__.__dict__ I<span class="hljs-string"><span class="hljs-string">'m a class attribute! Retrieving from self.__dict__ I'</span></span>m <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a dict! Retrieving <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> self.__class__.__dict__ Invoking descripto<span class="hljs-string"><span class="hljs-string">r's __get__ I'</span></span>m a read-only property! Retrieving <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> self.__getattr__ I<span class="hljs-string"><span class="hljs-string">'m dynamically returned!</span></span></code> </pre> <br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c65/c9e/8d0/c65c9e8d0963e7e73e53434b88a8125a.jpg"></div><br><p>  Acabamos de ara√±ar un poco la superficie de la implementaci√≥n del atributo en Python.  Aunque nuestro √∫ltimo intento de emular <b>foo.bar</b> es generalmente correcto, tenga en cuenta que siempre puede haber peque√±os detalles implementados de manera diferente. </p><br><p>  Espero que, adem√°s de saber c√≥mo funcionan los atributos, tambi√©n logr√© transmitir la belleza del lenguaje que lo alienta a experimentar.  Pague parte de la <a href="https://habr.com/ru/post/310158/">deuda de conocimiento</a> hoy. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/479824/">https://habr.com/ru/post/479824/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../479814/index.html">Problema de privacidad de datos de Active Directory</a></li>
<li><a href="../479816/index.html">Combinatoria en Python</a></li>
<li><a href="../479818/index.html">C√≥mo evaluar el dominio del ingl√©s</a></li>
<li><a href="../479820/index.html">¬øQu√© poner debajo de un √°rbol de TI? Reloj binario</a></li>
<li><a href="../479822/index.html">Gatos en cajas o estructuras de datos compactas</a></li>
<li><a href="../479828/index.html">10 complementos √∫tiles de c√≥digo de Visual Studio</a></li>
<li><a href="../479832/index.html">Entrevista de juego</a></li>
<li><a href="../479836/index.html">La Duma del Estado ha adoptado enmiendas a la ley sobre electricidad en t√©rminos de microgeneraci√≥n. ¬øLas alternativas ser√°n felices?</a></li>
<li><a href="../479842/index.html">La Universidad de Bata cre√≥ una neurona anal√≥gica electr√≥nica.</a></li>
<li><a href="../479844/index.html">Re√∫na un equipo de dise√±adores UX y pierda 7 millones debido a errores de contrataci√≥n</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>