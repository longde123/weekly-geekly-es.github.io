<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏖️ 👨‍👩‍👧 👇🏾 Percepat Ansible dengan Mitogen 🤷🏻 🥤 🗜️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ansible telah menjadi salah satu sistem Manajemen Konfigurasi yang paling populer. Setelah Red Hat dibeli pada 2015, jumlah peserta proyek melebihi ri...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Percepat Ansible dengan Mitogen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453520/"><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Ansible telah</a> menjadi salah satu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sistem Manajemen Konfigurasi yang</a> paling populer.  Setelah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Red Hat dibeli</a> pada 2015, jumlah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">peserta proyek</a> melebihi ribuan dan Ansible mungkin merupakan sistem penyebaran dan orkestrasi yang paling banyak digunakan.  Aplikasi luasnya sangat mengesankan. </p><br><p> Kemungkinan bekerja melalui koneksi SSH ke host jarak jauh.  Ini membuka sesi SSH, membuat login, menyalin kode Python melalui jaringan dan menulisnya ke file sementara yang terpisah.  Setelah itu, ia menjalankan file ini di mesin jarak jauh.  Keseluruhan urutan operasi ini cukup panjang dan membosankan, jadi ada berbagai cara untuk mengoptimalkannya. </p><a name="habracut"></a><br><p> Salah satu metode ini adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">saluran pipa SSH</a> yang memungkinkan Anda untuk menggunakan satu sesi SSH untuk menjalankan instruksi, daripada membuka sesi baru setiap kali, yang dapat menghemat banyak waktu bagi kami.  (Ingatlah untuk menonaktifkan pengaturan yang diperlukan untuk sudo di <code>/etc/sudoers</code> pada mesin jarak jauh) </p><br><p>  Cara baru untuk "overclock" Ansible adalah dengan perpustakaan python yang disebut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mitogen</a> .  jika seseorang belum pernah mendengarnya, maka saya akan menjelaskan secara singkat fungsinya.  Ini memungkinkan eksekusi kode python dengan cepat pada mesin jarak jauh, dan Ansible hanyalah satu kasus penggunaan.  Mitogen menggunakan pipa UNIX pada mesin jarak jauh dan melewati kode python yang dikompresi zlib dan diserialisasi menggunakan acar.  Ini membantu untuk mengeksekusinya lebih cepat dan menghemat lalu lintas.  Jika Anda tertarik dengan penjelasan yang lebih terperinci, yang terbaik adalah membacanya di halaman <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Cara Kerja</a> .  Tapi hari ini kita akan fokus hanya pada perpustakaan dengan Ansible. </p><br><p>  Mitogen dalam keadaan tertentu dapat mempercepat kode Ansible Anda beberapa kali dan secara signifikan mengurangi konsumsi lalu lintas.  Mari kita periksa kasus penggunaan paling populer dan lihat bagaimana ini membantu kita. </p><br><p>  Kebanyakan dari semua saya menggunakan Ansible untuk: membuat file konfigurasi pada mesin jarak jauh, menginstal paket, menyalin file ke dan dari mesin jarak jauh.  Mungkin Anda punya contoh lain - tulis di komentar. </p><br><p>  Ayo pergi! </p><br><p>  Konfigurasi Mitogen for Ansible sangat sederhana: <br>  Instal perpustakaan Mitogen: </p><br><pre> <code class="bash hljs">pip install mitogen</code> </pre> <br><p>  Sekarang ada dua cara yang setara - baik untuk mengkonfigurasi opsi dalam file konfigurasi ansible.cfg, atau untuk mengatur variabel lingkungan yang diperlukan. </p><br><p>  Misalkan jalur ke Mitogen yang terinstal adalah <code>/usr/lib/python2.7/site-packages/ansible_mitogen/plugins/strategy</code> .  Lalu: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ANSIBLE_STRATEGY_PLUGINS=/usr/lib/python2.7/site-packages/ansible_mitogen/plugins/strategy <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ANSIBLE_STRATEGY=mitogen_linear</code> </pre> <br><p>  atau </p><br><pre> <code class="plaintext hljs">[defaults] strategy = mitogen_linear strategy_plugins = /usr/lib/python2.7/site-packages/ansible_mitogen/plugins/strategy</code> </pre> <br><p>  Instal Ansible di virtualenv, dengan dan tanpa Mitogen: </p><br><pre> <code class="bash hljs">virtualenv mitogen_ansible ./mitogen_ansible/bin/pip install ansible==2.7.10 mitogen virtualenv pure_ansible ./pure_ansible/bin/pip install ansible==2.7.10</code> </pre> <br><p>  <strong>Harap dicatat bahwa Mitogen 0.2.7 tidak berfungsi dengan Ansible 2.8 (pada Mei 2019)</strong> </p><br><p>  Kami melakukan alias: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> pure-ansible-playbook=<span class="hljs-string"><span class="hljs-string">'$(pwd)/pure_ansible/bin/ansible-playbook'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> mitogen-ansible-playbook=<span class="hljs-string"><span class="hljs-string">'ANSIBLE_STRATEGY_PLUGINS=$(pwd)/mitogen_ansible/lib/python3.7/site-packages/ansible_mitogen/plugins/strategy ANSIBLE_STRATEGY=mitogen_linear $(pwd)/mitogen_ansible/bin/ansible-playbook'</span></span></code> </pre> <br><p>  Sekarang coba jalankan playbook membuat file di mesin jarak jauh: </p><br><pre> <code class="plaintext hljs">--- - hosts: all gather_facts: false tasks: - name: Create files with copy content module copy: content: | test file {{ item }} dest: ~/file_{{ item }} with_sequence: start=1 end={{ n }}</code> </pre> <br><p>  Dan jalankan dengan dan tanpa Mitogen untuk membuat 10 file: </p><br><pre> <code class="bash hljs">time mitogen-ansible-playbook file_creation.yml -i hosts -en=10 &amp;&gt;/dev/null real 0m2.603s user 0m1.152s sys 0m0.096s time pure-ansible-playbook file_creation.yml -i hosts -en=10 &amp;&gt;/dev/null real 0m5.908s user 0m1.745s sys 0m0.643s</code> </pre> <br><p>  Kami melihat peningkatan 2 kali lipat.  Mari kita periksa 20, 30, ..., 100 file: </p><br><pre> <code class="bash hljs">time pure-ansible-playbook file_creation.yml -i hosts -en=100 &amp;&gt;/dev/null real 0m51.775s user 0m8.039s sys 0m6.305s time mitogen-ansible-playbook file_creation.yml -i hosts -en=100 &amp;&gt;/dev/null real 0m4.331s user 0m1.903s sys 0m0.197s</code> </pre> <br><p>  Akibatnya, kami mempercepat eksekusi lebih dari 10 kali! <br>  Sekarang mari kita coba berbagai skenario dan lihat seberapa cepat semuanya bekerja untuk kita: </p><br><ul><li><p>  Script untuk menyalin file ke host jarak jauh dari lokal (dengan modul <code>copy</code> ): <br><img src="https://habrastorage.org/getpro/habr/post_images/4e8/349/44b/4e834944bcfe865814d0cdb6538b61c5.svg" alt="Mengunggah file"></p><br></li><li><p>  Script untuk membuat file pada host jarak jauh dengan modul <code>copy</code> : <br><img src="https://habrastorage.org/getpro/habr/post_images/5dc/3db/ec2/5dc3dbec26ec1f9502e0a270aee5ef2d.svg" alt="Membuat file"></p><br></li><li><p>  Skenario dengan mengunduh file dari host jarak jauh ke host lokal: <br><img src="https://habrastorage.org/getpro/habr/post_images/dfb/fe8/385/dfbfe838521a915708a2f543715c7e25.svg" alt="Mengambil file"></p><br></li><li><p>  Script dengan membuat template pada host khusus dengan beberapa variabel dan perhitungan di Jinja <br><img src="https://habrastorage.org/getpro/habr/post_images/f79/2bc/9c0/f792bc9c070d064e768d8c3c55313aa0.svg" alt="File templat"></p><br></li></ul><br><p>  Mari kita coba skenario dengan beberapa (3) mesin jarak jauh, misalnya, skenario dengan menyalin file ke host jarak jauh: <br><img src="https://habrastorage.org/getpro/habr/post_images/eef/f89/d91/eeff89d9135f5c8890d57e18ec052b8a.svg" alt="Mengunggah file ke banyak host"></p><br><p>  Seperti yang Anda lihat, Mitogen menghemat waktu dan lalu lintas kami dalam skenario ini.  Tetapi jika "bottleneck" tidak dalam Ansible, tetapi misalnya dalam disk I / O atau jaringan, atau di tempat lain, maka sulit untuk berharap bahwa Mitogen akan membantu kami. </p><br><p>  Mari kita coba skrip untuk menginstal paket dengan modul yum / dnf dan python menggunakan pip.  Paket di-cache agar tidak bergantung pada gangguan dalam jaringan: </p><br><pre> <code class="plaintext hljs">--- - hosts: all gather_facts: false tasks: - name: Install packages become: true package: name: - samba - httpd - nano - ruby state: present - name: Install pip modules become: true pip: name: - pytest-split-tests - bottle - pep8 - flask state: present</code> </pre><br><p>  Dengan Mitogen, butuh 12 detik, karena tanpa itu. <br>  Pada halaman <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mitogen for Ansible,</a> Anda dapat melihat tolok ukur dan tes lain.  Sebagaimana dinyatakan pada halaman: </p><br><blockquote>  Mitogen tidak dapat mempercepat modul saat dijalankan.  Itu hanya dapat membuat eksekusi modul ini secepat mungkin. </blockquote><p>  Oleh karena itu, penting untuk menemukan kemacetan Anda dalam penerapan dan jika mereka disebabkan oleh Ansible, maka Mitogen akan membantu Anda menyelesaikannya dan secara signifikan mempercepat pelaksanaan buku pedoman Anda. </p><br><p>  <strong>sunting:</strong> Menambahkan skrip dengan templat </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id453520/">https://habr.com/ru/post/id453520/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id453508/index.html">Manusia tanpa smartphone</a></li>
<li><a href="../id453510/index.html">Semua milik Anda: Tutorial cara membuat tindakan baru untuk UiPath RPA</a></li>
<li><a href="../id453512/index.html">Transfer gaya</a></li>
<li><a href="../id453514/index.html">Panduan Pengantar Penawaran di iOS</a></li>
<li><a href="../id453516/index.html">Otomatisasi untuk yang terkecil. Bagian nol. Perencanaan</a></li>
<li><a href="../id453522/index.html">Selamat Ulang Tahun, Habr ❤</a></li>
<li><a href="../id453524/index.html">Intisari materi menarik untuk pengembang ponsel # 299 (pada 20 - 26 Mei)</a></li>
<li><a href="../id453526/index.html">ITSM - apa itu dan di mana memulai implementasi</a></li>
<li><a href="../id453528/index.html">Psion SIBO - PDA yang bahkan tidak perlu ditiru</a></li>
<li><a href="../id453532/index.html">Xamarin API Docs: Buka Sumber dan Tersedia Sekarang</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>