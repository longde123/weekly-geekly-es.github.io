<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìü ‚òùüèæ üåá Viagem ao centro ... imagem do docker. Ou como baixar uma imagem do registro sem janela de encaixe üíß üèïÔ∏è üçµ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tr√™s dias antes do ano novo, havia uma tarefa de transferir nosso software para o cliente atrav√©s do gerente, em uma unidade flash. O software √© uma p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Viagem ao centro ... imagem do docker. Ou como baixar uma imagem do registro sem janela de encaixe</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484374/"><p>  Tr√™s dias antes do ano novo, havia uma tarefa de transferir nosso software para o cliente atrav√©s do gerente, em uma unidade flash.  O software √© uma plataforma de microsservi√ßo com v√°rias dezenas de imagens de docker com muitas configura√ß√µes e um gr√°fico de leme com um quil√¥metro de comprimento.  O que t√≠nhamos: </p><br><ul><li>  Gerente em Moscou (n√£o sou de l√°) </li><li>  Windows </li><li>  N√£o h√° intera√ß√£o direta (e, se fosse, realmente n√£o ajudava) </li><li>  estivador n√£o </li></ul><br><p>  Pff, pensei!  Vou pegar Golang, escrever um programa, compilar para Windows. <br>  ... e cinco horas depois eu percebi a pressa das minhas conclus√µes.  Nesse momento, o riso de Nelson se lembrou pela primeira vez.  HA HA  O que me assombrava o tempo todo que passava estudando a quest√£o. <a name="habracut"></a></p><br><p>  A maioria dos exemplos que encontrei requer dockerd.  Dois scripts que n√£o usam dockerd, encontrados ap√≥s uma hora de pesquisa no Google, <a href="" rel="nofollow">um</a> e <a href="https://github.com/NotGlop/docker-drag" rel="nofollow">dois</a> .  A primeira op√ß√£o me ajudou a entender o processo de obten√ß√£o de todas as camadas de imagem e arquivos de configura√ß√£o, mas √© imposs√≠vel us√°-lo no Windows.  E a segunda op√ß√£o indicava que n√£o eram apenas v√°rios hashes piscando na tela, especificamente este <a href="https://github.com/NotGlop/docker-drag/blob/69b2bae59c6c0a5cbdf224feb9c067e3edcc6068/docker_pull.py" rel="nofollow">FIXME</a> .  Pode-se, √© claro, parar por a√≠, funciona!  Transferir para ir n√£o √© dif√≠cil.  Mas como verificar se as imagens do gerente estavam na mesma forma que em nosso registro?  Mas de jeito nenhum!  Portanto, enviei apenas imagens para o armazenamento compartilhado, baixei usando o comando docker save e compartilhei o link.  E se acalmou com isso. </p><br><p>  No quarto dia de f√©rias, bastante cansada deles, a id√©ia de baixar e montar a imagem do docker me tomou novamente, e eu mergulhei no c√≥digo <a href="https://github.com/moby/moby" rel="nofollow">moby</a> por algumas horas. </p><br><p>  O que eu tive desta vez: </p><br><ul><li>  Entendendo como obter todas as camadas </li></ul><br><p>  Tomando o Python "na m√£o" e com base nesse <a href="https://github.com/NotGlop/docker-drag" rel="nofollow">script</a> , decidi corrigi-lo.  No segundo dia, decidi escrever um roteiro do zero.  Lembrando-me dos meus trabalhos para autoriza√ß√£o autom√°tica, simplesmente copiei parte do c√≥digo de l√°, mais os desenvolvimentos j√° feitos por mim ao editar o script.  N√£o houve problemas com a autoriza√ß√£o e o download desses dados, mas surgiram quest√µes: </p><br><ul><li>  quais s√£o os hashes exibidos quando o comando pull do docker √© executado? </li><li>  quais s√£o os hashes usados ‚Äã‚Äãpara nomear diret√≥rios dentro do tarball da imagem? </li><li>  Como construir um arquivo tar para que a soma da verifica√ß√£o corresponda √† imagem original? </li></ul><br><p> Para estudar, escolhi uma imagem do ubuntu: 18.04 <br>  imagem sha256sum salva por meio do <code>docker save</code> - 257cab9137419a53359d0ed76f680fe926ed3645238357bdcdb84070a8f26cd0. </p><br><pre> <code class="plaintext hljs">&gt; docker pull ubuntu:18.04 18.04: Pulling from library/ubuntu 2746a4a261c9: Downloading [==============&gt; ] 6.909MB/26.69MB 4c1d20cdee96: Download complete 0d3160e1d0de: Download complete c8e37668deea: Download complete Digest: sha256:250cc6f3f3ffc5cdaa9d8f4946ac79821aafb4d3afc93928f0de9336eba21aa4 Status: Downloaded newer image for ubuntu:18.04 docker.io/library/ubuntu:18.04</code> </pre> <br><p>  <strong>Conte√∫do do tarball da imagem</strong> </p><br><pre> <code class="plaintext hljs">tar tvf ubuntu.tar drwxr-xr-x 0 root root 0 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/ -rw-r--r-- 0 root root 3 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/VERSION -rw-r--r-- 0 root root 477 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/json -rw-r--r-- 0 root root 991232 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/layer.tar drwxr-xr-x 0 root root 0 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/ -rw-r--r-- 0 root root 3 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/VERSION -rw-r--r-- 0 root root 477 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/json -rw-r--r-- 0 root root 15872 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/layer.tar -rw-r--r-- 0 root root 3411 Dec 19 11:21 549b9b86cb8d75a2b668c21c50ee092716d070f129fd1493f95ab7e43767eab8.json drwxr-xr-x 0 root root 0 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/ -rw-r--r-- 0 root root 3 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/VERSION -rw-r--r-- 0 root root 1264 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/json -rw-r--r-- 0 root root 3072 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/layer.tar drwxr-xr-x 0 root root 0 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/ -rw-r--r-- 0 root root 3 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/VERSION -rw-r--r-- 0 root root 401 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/json -rw-r--r-- 0 root root 65571328 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/layer.tar -rw-r--r-- 0 root root 432 Jan 1 1970 manifest.json -rw-r--r-- 0 root root 88 Jan 1 1970 repositories</code> </pre> <br><p>  <strong>Configura√ß√£o da imagem</strong> </p><br><pre> <code class="json hljs">{ ... <span class="hljs-attr"><span class="hljs-attr">"rootfs"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"layers"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"diff_ids"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"sha256:2dc9f76fb25b31e0ae9d36adce713364c682ba0d2fa70756486e5cedfaf40012"</span></span>, <span class="hljs-string"><span class="hljs-string">"sha256:9f3bfcc4a1a8a676da07287a1aa6f2dcc8e869ea6f054c337593481a5bb1345e"</span></span>, <span class="hljs-string"><span class="hljs-string">"sha256:27dd43ea46a831c39d224e7426794145fba953cd7309feccf4d5ea628072f6a2"</span></span>, <span class="hljs-string"><span class="hljs-string">"sha256:918efb8f161b4cbfa560e00e8e0efb737d7a8b00bf91bb77976257cd0014b765"</span></span> ] } ... }</code> </pre> <br><p>  A primeira pergunta foi resolvida com bastante rapidez, com a ajuda da documenta√ß√£o <a href="" rel="nofollow">https://github.com/opencontainers/image-spec/blob/master/config.md</a> .  Os hashes que aparecem quando voc√™ executa o comando docker pull s√£o chainIDs calculados na lista diff_ids do manifesto image-config, onde o primeiro chainID √© sempre o primeiro da lista diff_ids e os subseq√ºentes s√£o somas de hash da cadeia de caracteres <code>(chain_id[i-1] + " " + diff_id[i])</code>  C√≥digo para criar chainID chainID: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chain_ids</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ids: list)</span></span></span><span class="hljs-function"> -&gt; list:</span></span> chain = list() chain.append(ids[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(ids) &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ids nxt = list() nxt.append(<span class="hljs-string"><span class="hljs-string">"sha256:"</span></span> + hashlib.sha256(<span class="hljs-string"><span class="hljs-string">f'</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{ids[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">0</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{ids[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">'</span></span>.encode()).hexdigest()) nxt.extend(ids[<span class="hljs-number"><span class="hljs-number">2</span></span>:]) chain.extend(chain_ids(nxt)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> chain</code> </pre> <br><p>  A adi√ß√£o de um prefixo com o nome do algoritmo, neste caso "sha256:", √© obrigat√≥ria e est√° inclu√≠da nos requisitos do padr√£o opencontainers, ou seja,  a string deve estar no formato "algoritmo: hash". </p><br><p>  Ele passou duas noites em uma pergunta sobre como nomear um diret√≥rio.  Por um longo tempo, observei o c√≥digo-fonte do docker-daemon e o Oh!  um milagre!  Consegui encontrar o c√≥digo de gera√ß√£o <a href="" rel="nofollow">aqui</a> e <a href="" rel="nofollow">aqui</a> .  Para gerar o nome do diret√≥rio, √© necess√°rio calcular o hash na configura√ß√£o da camada json.  O Docker possui v√°rias vers√µes de configura√ß√£o e, antes do docker engine 1.9, as configura√ß√µes da vers√£o v1 eram usadas.  Mal disse o que fez!  E novamente, a silhueta de Nelson surge.  Ap√≥s uma pequena depura√ß√£o, percebi que o problema estava oculto na gera√ß√£o de json.  No Python, a ordem dos dados em um dicion√°rio pode diferir da ordem dos dados em json gerados a partir deste dicion√°rio.  A ordem dos dados em json ser√° diferente e, portanto, seu hash tamb√©m ser√° diferente.  Eu tive que ir para OrderedDict, pr√©-registrar a ordem de dados desejada neles.  Isso aumentou o tamanho do c√≥digo em uma vez e meia. </p><br><p>  Parece que tudo est√° corrigido, eu corro o script e ... em algum lugar l√° no fundo, o not√≥rio HA-HA aparece!  O √∫ltimo hash n√£o corresponde.  Mais uma vez, estudo o c√≥digo e <a href="" rel="nofollow">vejo</a> , e essa √© outra v1-config que cont√©m todas as informa√ß√µes sobre a imagem, que podem ser vistas usando o <code>docker inspect</code> .  Adicione outro OrderDict especificamente para ele, complemente o c√≥digo e ... HA HA! <br>  J√° eram cinco da manh√£ e minha cabe√ßa realmente n√£o pensava; ent√£o, depois de dormir, voltei a visualizar o c√≥digo.  Observar repetidamente o c√≥digo de gera√ß√£o encontrou uma <a href="" rel="nofollow">linha</a> .  Como fiquei feliz em ver isso.  Antes de v√™-la, havia pensamentos de construir minha janela de encaixe com <del>  Jack preto e </del>  registro de dados.  <code>docker save</code> o debug, executo o <code>docker save</code> e ... n√£o √© nada engra√ßado, no docker-desktop para mac os h√° um limite no comprimento da linha no log de 947 caracteres e a configura√ß√£o gerada √© interrompida para <code>\"</code> . Ap√≥s executar todas essas etapas no Linux, consegui obter a configura√ß√£o camada da primeira vers√£o, com base na qual escrevi o c√≥digo, e consegui obter o hash desejado da √∫ltima camada. Os hashes para todos os arquivos s√£o iguais, os diret√≥rios s√£o nomeados da mesma maneira que a imagem original. √â hora de coletar o arquivo tar ... HAHA! </p><br><p>  O tamanho do arquivo n√£o corresponde, leia <a href="" rel="nofollow">https://github.com/opencontainers/image-spec/blob/master/layer.md</a> e o formato de <a href="https://www.gnu.org/software/tar/manual/html_node/Standard.html" rel="nofollow">arquivo tar</a> .  <a href="https://github.com/python/cpython/blob/f04750bb7af45cb6efab8d92d1ff063f0bf2833d/Lib/tarfile.py" rel="nofollow">O valor padr√£o √©</a> 10240 bytes, e o tamanho do arquivo morto que eu coletei √© 9216 bytes maior.  Inicialmente, pensei que era necess√°rio reduzir o tamanho do bloco para 1024 bytes, o que resultou incorreto e, como resultado, o tamanho do bloco de 512 bytes igualou o tamanho dos arquivos. </p><br><pre> <code class="python hljs">tarfile.RECORDSIZE = <span class="hljs-number"><span class="hljs-number">512</span></span></code> </pre> <br><p>  A primeira linha do arquivo rec√©m-criado cont√©m a pasta raiz "/".  Esta op√ß√£o n√£o √© adequada, portanto, complemento o c√≥digo, verificando o conte√∫do da pasta e adicionando-o individualmente ao arquivo, depois de o ter classificado anteriormente. </p><br><p>  Finalmente, conseguimos obter o mesmo tamanho de arquivo, uma apar√™ncia uniforme de diret√≥rios, mas isso n√£o √© tudo.  Arquivos e diret√≥rios, com exce√ß√£o de manifest.json e respoitories, devem ter atributos st_atime no archive, st_mtime igual a st_ctime.  Para arquivos manifest.json e respoitories, os atributos st_atime, st_mtime e st_ctime devem estar datados do in√≠cio da era <code>1970-01-01 00:00</code> .  Todas as datas devem ser definidas de acordo com o fuso hor√°rio, respectivamente.  Desde que realizei todo o trabalho no Mac OS, notei uma diferen√ßa.  Ao salvar a imagem no Linux, a lista de arquivos no arquivo ficou assim: </p><br><pre> <code class="plaintext hljs">tar tvf ubuntu.tar drwxr-xr-x 0/0 0 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/ -rw-r--r-- 0/0 3 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/VERSION -rw-r--r-- 0/0 477 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/json -rw-r--r-- 0/0 991232 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/layer.tar drwxr-xr-x 0/0 0 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/ -rw-r--r-- 0/0 3 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/VERSION -rw-r--r-- 0/0 477 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/json -rw-r--r-- 0/0 15872 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/layer.tar -rw-r--r-- 0/0 3411 Dec 19 11:21 549b9b86cb8d75a2b668c21c50ee092716d070f129fd1493f95ab7e43767eab8.json drwxr-xr-x 0/0 0 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/ -rw-r--r-- 0/0 3 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/VERSION -rw-r--r-- 0/0 1264 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/json -rw-r--r-- 0/0 3072 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/layer.tar drwxr-xr-x 0/0 0 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/ -rw-r--r-- 0/0 3 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/VERSION -rw-r--r-- 0/0 401 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/json -rw-r--r-- 0/0 65571328 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/layer.tar -rw-r--r-- 0/0 432 Jan 1 1970 manifest.json -rw-r--r-- 0/0 88 Jan 1 1970 repositories</code> </pre> <br><p>  Diferentemente da lista no in√≠cio do artigo, no Linux, o arquivo √© salvo com o sinalizador somente num√©rico.  Existem duas vari√°veis ‚Äã‚Äãno objeto tarinfo respons√°veis ‚Äã‚Äãpor isso, tarinfo.uname e tarinfo.gname.  E o segundo problema com o mac os √© a falta de um grupo raiz, ele √© corrigido usando a vari√°vel tarinfo.gid no mesmo objeto tarinfo.  Bem, tudo parece estar criando um arquivo ... </p><br><p><img src="https://habrastorage.org/webt/hp/p8/pl/hpp8plcgi09ybuarim4bb5awcga.jpeg"></p><br><p>  Para todos os arquivos, o hash converge, os nomes dos diret√≥rios e arquivos s√£o os mesmos, os atributos st_atime, st_mtime e st_ctime convergem para o original, os direitos para os arquivos s√£o exatamente os mesmos.  A abertura dos dois arquivos em um editor hexadecimal viu uma pequena diferen√ßa: </p><br><p><img src="https://habrastorage.org/webt/qc/j6/xm/qcj6xmv9ghzaesgeaaq5owvaxnm.png"><br>  A janela superior √© o original, o arquivo inferior que eu coletei. </p><br><p>  Compreendendo o formato tar.  Depois do nome do diret√≥rio est√° o valor dos direitos para o arquivo (ret√¢ngulo laranja).  A diferen√ßa √© que as informa√ß√µes sobre o objeto que est√° sendo adicionado ao arquivo morto n√£o s√£o adicionadas aos direitos do diret√≥rio.  Um valor 40755 indicado nos direitos indica que este √© um diret√≥rio com permiss√µes de 755 e 100644 √© um arquivo com direitos de 644. O ret√¢ngulo vermelho √© uma sequ√™ncia m√°gica e, a julgar pelo c√≥digo do arquivo <code>ustar\000</code> sequ√™ncia m√°gica <code>ustar\000</code> , √© usado apenas nos formatos PAX e USTAR.  O formato PAX n√£o se encaixa, ele usa um tipo especial de cabe√ßalho.  O ret√¢ngulo azul √© uma soma de verifica√ß√£o e difere devido ao uso de diferentes formatos para direitos de grava√ß√£o em um arquivo e cabe√ßalho m√°gico. </p><br><p>  Mudo o formato de arquivo para USTAR, mas n√£o est√° claro o que fazer com as permiss√µes de grava√ß√£o de arquivos.  Aqui e <a href="https://github.com/python/cpython/blob/f04750bb7af45cb6efab8d92d1ff063f0bf2833d/Lib/tarfile.py" rel="nofollow">aqui</a> , a m√°gica est√° acontecendo para mim, nunca trabalhei com o sistema octal e n√£o entendo por que o e comercial √© necess√°rio aqui (algu√©m pode compartilhar seu conhecimento nos coment√°rios).  Eu tive que adicionar v√°rias impress√µes para ver quais dados chegam com argumentos e quais dados s√£o usados ‚Äã‚Äãpara formar o bloco de arquivamento.  Tomando um n√∫mero inteiro da segunda posi√ß√£o do bloco de dados, era 16877 e levando-o ao c√°lculo octal, descobriu-se que esse valor √© <code>0o40755</code> , que √© <code>0o40755</code> que eu preciso.  Substituindo as fun√ß√µes get_info e _create_header, excluindo <code>&amp; 0o7777</code> delas (nada mais me ocorreu), consegui coletar um arquivo tar com um hash sha256 que coincidia com o original. </p><br><p>  PS Enquanto escrevia um artigo, a imagem do ubuntu foi atualizada: 18.04 em hub.docker.com.  Ent√£o eu tive que baixar a imagem no Digest.  Os valores de hash n√£o correspondem mais ao original devido ao fato de o Digest ter sido gravado em vez da tag, caso contr√°rio, eram imagens id√™nticas. </p><br><p>  A segunda descoberta para mim foi a aus√™ncia de um arquivo de reposit√≥rios no archive ao salvar uma imagem com uma tag ausente usando o <code>docker save</code> . </p><br><p>  C√≥digo de funcionamento completo aqui: <a href="https://github.com/myback/docker_pull" rel="nofollow">https://github.com/myback/docker_pull</a> </p><br><p>  Imagem de Nelson Manz, bem como sua risada "HA-HA" √© propriedade da FOX :) </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt484374/">https://habr.com/ru/post/pt484374/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt484358/index.html">Gerenciamento de portf√≥lio em R</a></li>
<li><a href="../pt484364/index.html">Aos 26 anos, Yana Harlan lidera o desenvolvimento de um motor espacial. No pr√≥ximo ano, eles planejam lan√ß√°-lo.</a></li>
<li><a href="../pt484368/index.html">Como eu fiz um mecanismo de pesquisa para o Telegram</a></li>
<li><a href="../pt484370/index.html">Slurm SRE - aprenda a garantir a felicidade do usu√°rio</a></li>
<li><a href="../pt484372/index.html">Casa inteligente com Xiaomi no exemplo de uma sauna</a></li>
<li><a href="../pt484376/index.html">Samsung Moscow Center for Artificial Intelligence nas hist√≥rias de funcion√°rios</a></li>
<li><a href="../pt484378/index.html">SwayWM - UnixPorn voc√™ mesmo</a></li>
<li><a href="../pt484382/index.html">Algoritmo de Bellman-Ford</a></li>
<li><a href="../pt484386/index.html">Meetup sobre AWS_Ru em Raiffeisenbank</a></li>
<li><a href="../pt484388/index.html">VVVVVV ??? VVVVVV !!! :)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>