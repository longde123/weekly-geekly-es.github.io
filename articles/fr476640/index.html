<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçü§ù‚Äçüë®üèª üêæ ü§≤üèº Protection de Zimbra OSE contre la force brute et les attaques DoS üèµÔ∏è üò© ‚úÇÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Zimbra Collaboration Suite Open-Source Edition poss√®de dans son arsenal plusieurs outils puissants pour assurer la s√©curit√© des informations. Parmi eu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Protection de Zimbra OSE contre la force brute et les attaques DoS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/zimbra/blog/476640/">  Zimbra Collaboration Suite Open-Source Edition poss√®de dans son arsenal plusieurs outils puissants pour assurer la s√©curit√© des informations.  Parmi eux, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Postscreen</a> est une solution pour prot√©ger le serveur de messagerie contre les attaques de botnets, ClamAV est un antivirus qui peut analyser les fichiers et les lettres entrants pour d√©tecter les infections de logiciels malveillants, et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SpamAssassin</a> est l'un des meilleurs filtres anti-spam √† ce jour.  Cependant, ces outils ne sont pas en mesure de prot√©ger le Zimbra OSE contre une forme d'attaque telle que la force brute.  L'√©num√©ration des mots de passe la plus √©l√©gante, mais toujours assez efficace dans un dictionnaire sp√©cial est lourde non seulement de la probabilit√© d'un piratage r√©ussi avec toutes les cons√©quences qui en d√©coulent, mais aussi de la cr√©ation d'une charge importante sur le serveur, qui traite toutes les tentatives infructueuses de pirater le serveur avec Zimbra OSE. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e98/93d/7d9/e9893d7d9f995c2a24dce02df7fa5d51.png" alt="image"><br><a name="habracut"></a><br>  En principe, vous pouvez vous prot√©ger de la force brute √† l'aide des outils Zimbra OSE standard.  Les param√®tres de strat√©gie de s√©curit√© par mot de passe vous permettent de d√©finir le nombre de tentatives de mot de passe ayant √©chou√©, apr√®s quoi le compte potentiellement attaqu√© est bloqu√©.  Le principal probl√®me avec cette approche est que des situations surviennent dans lesquelles les comptes d'un ou plusieurs employ√©s peuvent √™tre bloqu√©s en raison d'une attaque par force brute, √† laquelle ils n'ont rien √† faire, et le simple travail qui en r√©sulte pour les employ√©s peut entra√Æner de grandes pertes pour l'entreprise.  C'est pourquoi cette option de protection contre la force brute est pr√©f√©rable de ne pas s'appliquer. <br><br><img src="https://habrastorage.org/webt/gz/cn/kg/gzcnkguoq2isuxplbgetg-y1ft4.png"><br><br>  Pour se prot√©ger contre la force brute, un outil sp√©cial appel√© DoSFilter est bien meilleur, qui est int√©gr√© √† Zimbra OSE et peut se d√©connecter automatiquement de Zimbra OSE via HTTP.  En d'autres termes, le principe de fonctionnement de DoSFilter est similaire au principe de fonctionnement de PostScreen, uniquement utilis√© pour un autre protocole.  Con√ßu √† l'origine pour limiter le nombre d'actions qu'un seul utilisateur peut effectuer, DoSFilter peut √©galement fournir une protection contre la force brute.  Sa principale diff√©rence avec l'outil int√©gr√© de Zimbra est qu'apr√®s un certain nombre de tentatives infructueuses, il bloque non pas l'utilisateur lui-m√™me, mais l'adresse IP √† partir de laquelle plusieurs tentatives sont faites pour se connecter √† l'un ou l'autre compte.  Gr√¢ce √† cela, l'administrateur syst√®me peut non seulement se prot√©ger de la force brute, mais aussi √©viter de bloquer les employ√©s de l'entreprise en ajoutant simplement le r√©seau interne de son entreprise √† la liste des adresses IP et des sous-r√©seaux de confiance. <br><br>  Le gros avantage de DoSFilter est qu'en plus de nombreuses tentatives de connexion √† l'un ou l'autre compte, cet outil vous permet de bloquer automatiquement les cybercriminels qui ont pris possession des donn√©es d'authentification de l'employ√©, puis se sont connect√©s avec succ√®s √† son compte et ont commenc√© √† envoyer des centaines de demandes au serveur. <br><br>  Vous pouvez configurer DoSFilter √† l'aide des commandes de console suivantes: <br><br><ul><li>  <b>zimbraHttpDosFilterMaxRequestsPerSec</b> - Avec cette commande, vous pouvez d√©finir le nombre maximal de connexions autoris√©es pour un utilisateur.  Par d√©faut, cette valeur est de 30 connexions. </li><li>  <b>zimbraHttpDosFilterDelayMillis</b> - En utilisant cette commande, vous pouvez d√©finir le d√©lai en millisecondes pour les connexions qui d√©passent la limite d√©finie par la commande pr√©c√©dente.  En plus des valeurs enti√®res, l'administrateur peut sp√©cifier 0 pour qu'il n'y ait aucun d√©lai, et √©galement -1 pour que toutes les connexions qui d√©passent la limite sp√©cifi√©e soient simplement interrompues.  Par d√©faut, cette valeur est -1. </li><li> <b>zimbraHttpThrottleSafeIPs</b> - En utilisant cette commande, l'administrateur peut sp√©cifier des adresses IP et des sous-r√©seaux approuv√©s qui ne seront pas affect√©s par les restrictions ci-dessus.  Notez que la syntaxe de cette commande peut varier en fonction du r√©sultat souhait√©.  Ainsi, par exemple, en entrant la commande <b>zmprov mcf zimbraHttpThrottleSafeIPs 127.0.0.1</b> , vous r√©√©crivez compl√®tement la liste enti√®re et ne laissez qu'une seule adresse IP dedans.  Si vous entrez la commande <b>zmprov mcf + zimbraHttpThrottleSafeIPs 127.0.0.1</b> , l'adresse IP que vous avez entr√©e sera ajout√©e √† la liste blanche.  De m√™me, en utilisant un signe de soustraction, vous pouvez supprimer n'importe quelle adresse IP de la liste des autoris√©s. </li></ul><br>  Notez que DoSFilter peut provoquer un certain nombre de probl√®mes lors de l'utilisation des extensions Zextras Suite Pro.  Afin de les √©viter, nous vous recommandons d'augmenter le nombre de connexions simultan√©es de 30 √† 100 √† l'aide de la commande <b>zmprov mcf zimbraHttpDosFilterMaxRequestsPerSec 100</b> .  De plus, nous recommandons d'ajouter le r√©seau interne de l'entreprise √† la liste des autoris√©s.  Cela peut √™tre fait en utilisant la commande <b>zmprov mcf + zimbraHttpThrottleSafeIPs 192.168.0.0/24</b> .  Apr√®s avoir apport√© des modifications √† DoSFilter, assurez-vous de red√©marrer le serveur de messagerie √† l'aide de la commande de <b>red√©marrage zmmailboxdctl</b> . <br><br>  Le principal inconv√©nient de DoSFilter est qu'il fonctionne au niveau de l'application et ne peut donc que limiter la capacit√© des attaquants √† effectuer diverses actions sur le serveur, sans limiter la possibilit√© de se connecter au nord.  Pour cette raison, les demandes d'authentification ou d'envoi de lettres envoy√©es au serveur, bien qu'il s'agisse manifestement d'√©checs, resteront une bonne vieille attaque DoS, qui ne peut pas √™tre arr√™t√©e √† un niveau aussi √©lev√©. <br><br>  Afin de s√©curiser compl√®tement votre serveur d'entreprise avec Zimbra OSE, vous pouvez utiliser une solution telle que Fail2ban, qui est un cadre qui peut constamment surveiller les journaux du syst√®me d'information pour les actions r√©p√©t√©es et bloquer l'intrus en modifiant les param√®tres du pare-feu.  Le blocage √† un niveau aussi bas vous permet de d√©sactiver les attaquants au stade de la connexion IP au serveur.  Ainsi, Fail2Ban peut parfaitement compl√©ter la protection construite avec DoSFilter.  Voyons comment vous pouvez devenir ami avec Fail2Ban avec Zimbra OSE et ainsi augmenter la s√©curit√© de l'infrastructure informatique de votre entreprise. <br><br>  Comme toute autre application de classe entreprise, Zimbra Collaboration Suite Open-Source Edition conserve des journaux d√©taill√©s de son travail.  La plupart d'entre eux sont stock√©s dans le dossier <b>/ opt / zimbra / log /</b> sous forme de fichiers.  En voici quelques-unes: <br><br><ul><li>  mailbox.log - Journaux du service de messagerie Jetty </li><li>  audit.log - journaux d'authentification </li><li>  clamd.log - journaux antivirus </li><li>  freshclam.log - journaux de mise √† jour antivirus </li><li>  convertd.log - journaux du convertisseur de pi√®ces jointes </li><li>  zimbrastats.csv - journaux de performances du serveur </li></ul><br>  Les journaux de Zimbra peuvent √©galement √™tre trouv√©s dans le fichier <b>/var/log/zimbra.log</b> , o√π les journaux de Postfix et de Zimbra lui-m√™me sont conserv√©s. <br><br>  Afin de prot√©ger notre syst√®me contre la force brute, nous surveillerons <b>mailbox.log</b> , <b>audit.log</b> et <b>zimbra.log</b> . <br><br>  Pour que tout fonctionne, il est n√©cessaire que Fail2Ban et iptables soient install√©s sur votre serveur avec Zimbra OSE.  Si vous utilisez Ubuntu, vous pouvez le faire en utilisant les <b>commandes dpkg -s fail2ban</b> , mais si vous utilisez CentOS, vous pouvez le v√©rifier en utilisant les <b>commandes fail2ban install√©es par yum list</b> .  Si vous ne disposez pas de Fail2Ban, son installation ne sera pas un probl√®me, car ce package se trouve dans presque tous les r√©f√©rentiels standard. <br><br>  Une fois tous les logiciels n√©cessaires install√©s, vous pouvez proc√©der √† la configuration de Fail2Ban.  Pour ce faire, cr√©ez un fichier de configuration <b>/etc/fail2ban/filter.d/zimbra.conf</b> , dans lequel nous √©crivons des expressions r√©guli√®res pour les journaux Zimbra OSE qui correspondront √† des tentatives de connexion incorrectes et d√©clencheront des m√©canismes Fail2Ban.  Voici un exemple du contenu de zimbra.conf avec un ensemble d'expressions r√©guli√®res correspondant √† diverses erreurs g√©n√©r√©es par Zimbra OSE lorsqu'une tentative d'authentification √©choue: <br><br><pre><code class="plaintext hljs"># Fail2Ban configuration file [Definition] failregex = \[ip=&lt;HOST&gt;;\] account - authentication failed for .* \(no such account\)$ \[ip=&lt;HOST&gt;;\] security - cmd=Auth; .* error=authentication failed for .*, invalid password;$ ;oip=&lt;HOST&gt;;.* security - cmd=Auth; .* protocol=soap; error=authentication failed for .* invalid password;$ ;oip=&lt;HOST&gt;;.* security - cmd=Auth; .* protocol=imap; error=authentication failed for .* invalid password;$ \[oip=&lt;HOST&gt;;.* SoapEngine - handler exception: authentication failed for .*, account not found$ WARN .*;ip=&lt;HOST&gt;;ua=ZimbraWebClient .* security - cmd=AdminAuth; .* error=authentication failed for .*;$ ignoreregex =</code> </pre> <br>  Une fois les expressions r√©guli√®res de Zimbra OSE compil√©es, il est temps de commencer √† modifier la configuration de Fail2ban lui-m√™me.  Les param√®tres de cet utilitaire se trouvent dans le fichier <b>/etc/fail2ban/jail.conf</b> .  Juste au cas o√π, nous allons le sauvegarder en utilisant la commande <b>cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.conf.bak</b> .  Apr√®s cela, apportons ce fichier au format suivant: <br><br><pre> <code class="plaintext hljs"># Fail2Ban configuration file [DEFAULT] ignoreip = 192.168.0.1/24 bantime = 600 findtime = 600 maxretry = 5 backend = auto [ssh-iptables] enabled = false filter = sshd action = iptables[name=SSH, port=ssh, protocol=tcp] sendmail-whois[name=SSH, dest=admin@company.ru, sender=fail2ban@company.ru] logpath = /var/log/messages maxretry = 5 [sasl-iptables] enabled = false filter = sasl backend = polling action = iptables[name=sasl, port=smtp, protocol=tcp] sendmail-whois[name=sasl, dest=support@company.ru] logpath = /var/log/zimbra.log [ssh-tcpwrapper] enabled = false filter = sshd action = hostsdeny sendmail-whois[name=SSH, dest=support@ company.ru] ignoreregex = for myuser from logpath = /var/log/messages [zimbra-account] enabled = true filter = zimbra action = iptables-allports[name=zimbra-account] sendmail[name=zimbra-account, dest=support@company.ru ] logpath = /opt/zimbra/log/mailbox.log bantime = 600 maxretry = 5 [zimbra-audit] enabled = true filter = zimbra action = iptables-allports[name=zimbra-audit] sendmail[name=Zimbra-audit, dest=support@company.ru] logpath = /opt/zimbra/log/audit.log bantime = 600 maxretry = 5 [zimbra-recipient] enabled = true filter = zimbra action = iptables-allports[name=zimbra-recipient] sendmail[name=Zimbra-recipient, dest=support@company.ru] logpath = /var/log/zimbra.log bantime = 172800 maxretry = 5 [postfix] enabled = true filter = postfix action = iptables-multiport[name=postfix, port=smtp, protocol=tcp] sendmail-buffered[name=Postfix, dest=support@company.ru] logpath = /var/log/zimbra.log bantime = -1 maxretry = 5</code> </pre> <br>  Bien que cet exemple soit assez universel, il convient d'expliquer certains param√®tres que vous souhaiterez peut-√™tre modifier lors de la configuration de Fail2Ban vous-m√™me: <br><br><ul><li>  <b>Ignoreip</b> - avec ce param√®tre, vous pouvez sp√©cifier une adresse IP ou un sous-r√©seau sp√©cifique, l'adresse √† partir de laquelle Fail2Ban ne doit pas v√©rifier.  En r√®gle g√©n√©rale, le r√©seau interne de l'entreprise et d'autres adresses approuv√©es sont ajout√©s √† la liste ignor√©e. </li><li>  <b>Bantime</b> - Le temps pendant lequel l'intrus va interdire.  Mesur√© en quelques secondes.  Une valeur de -1 signifie une interdiction illimit√©e. </li><li>  <b>Maxretry</b> - Le nombre maximum de fois qu'une adresse IP peut essayer d'acc√©der au serveur. </li><li>  <b>Sendmail</b> - Un param√®tre qui vous permet d'envoyer automatiquement des alertes par e-mail sur le fonctionnement de Fail2Ban. </li><li>  <b>Findtime</b> - Un param√®tre qui vous permet de d√©finir l'intervalle de temps apr√®s lequel l'adresse IP peut √† nouveau essayer d'acc√©der au serveur apr√®s que le nombre maximum de tentatives infructueuses a √©t√© √©puis√© (param√®tre maxretry) </li></ul><br>  Apr√®s avoir enregistr√© le fichier avec les param√®tres Fail2Ban, il ne reste plus qu'√† red√©marrer cet utilitaire √† l'aide de la <b>commande service fail2ban restart</b> .  Apr√®s le red√©marrage, les principaux journaux Zimbra commenceront √† √™tre constamment surveill√©s pour v√©rifier leur conformit√© avec les expressions r√©guli√®res.  Gr√¢ce √† cela, l'administrateur sera en mesure d'√©liminer virtuellement toute possibilit√© qu'un intrus p√©n√®tre non seulement dans les bo√Ætes aux lettres Zimbra Collaboration Suite Open-Source Edition, mais √©galement de prot√©ger tous les services ex√©cut√©s dans Zimbra OSE, ainsi que d'√™tre au courant de toute tentative d'acc√®s non autoris√©. <br><br>  Pour toutes questions relatives √† la Suite Zextras, vous pouvez contacter la repr√©sentante de Zextras, Ekaterina Triandafilidi, par e-mail katerina@zextras.com </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr476640/">https://habr.com/ru/post/fr476640/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr476620/index.html">SP701 + PCAM-5C + 15 minutes + VITIS = Easy MIPI sur FPGA</a></li>
<li><a href="../fr476624/index.html">Pipelines de qualit√© dans le d√©veloppement mobile, partie 1: Android</a></li>
<li><a href="../fr476626/index.html">PVS-Studio dans les nuages: GitLab CI / CD</a></li>
<li><a href="../fr476628/index.html">PVS-Studio passe aux nuages: GitLab CI / CD</a></li>
<li><a href="../fr476636/index.html">Optimisation de Firebird et Linux pour une base de donn√©es de 691 Go avec plus de 1000 utilisateurs</a></li>
<li><a href="../fr476644/index.html">Couches linguistiques</a></li>
<li><a href="../fr476646/index.html">Fusion √† 3 voies dans werf: d√©ploiement dans Kubernetes avec Helm "sous st√©ro√Ødes"</a></li>
<li><a href="../fr476648/index.html">Lenovo √† FINOPOLIS 2019</a></li>
<li><a href="../fr476650/index.html">La place de l'√©num√©ration dans le monde en mutation d'aujourd'hui</a></li>
<li><a href="../fr476656/index.html">26 novembre, Moscou - Alfa JS MeetUP # 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>