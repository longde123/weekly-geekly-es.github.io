<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“‹ ğŸ‘¨â€â¤ï¸â€ğŸ‘¨ ğŸš… HTMLæ–‡ä»¶æ¸²æŸ“ï¼šSkyengæ’°å†™çš„ã€Š ReactPHP for Beginnersã€‹ä¸€ç«  âœŠ ğŸ‘¨ğŸ¾â€ğŸ³ ğŸ§’ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Skyengç§»åŠ¨åº”ç”¨ç¨‹åºåç«¯å¼€å‘äººå‘˜Sergey Zhukç»§ç»­å†™å¥½ä¹¦ã€‚ è¿™æ¬¡ï¼Œä»–ä¸ºä¿„è¯­ç²¾é€šçš„è¯»è€…å‘è¡Œäº†ä¿„æ–‡æ•™ç§‘ä¹¦ã€‚ æˆ‘è¯·è°¢å°”ç›–ï¼ˆSergeyï¼‰åˆ†äº«ä¹¦ä¸­æœ‰ç”¨çš„è‡ªç»™è‡ªè¶³ç« èŠ‚ï¼Œå¹¶ä¸ºå“ˆå¸ƒæ‹‰ï¼ˆHabraï¼‰è¯»è€…æä¾›æŠ˜æ‰£ä»£ç ã€‚ ä¸‹é¢æ˜¯ä¸¤è€…ã€‚ 
 é¦–å…ˆï¼Œè®©æˆ‘ä»¬å‘Šè¯‰æ‚¨å‰é¢å‡ ç« ä¸­æˆ‘ä»¬åœæ­¢è¿‡çš„å†…å®¹ã€‚ 

æˆ‘ä»¬å·²ç»ç”¨PHP...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>HTMLæ–‡ä»¶æ¸²æŸ“ï¼šSkyengæ’°å†™çš„ã€Š ReactPHP for Beginnersã€‹ä¸€ç« </h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/skyeng/blog/416003/"><p><img src="https://habrastorage.org/webt/6v/oi/xx/6voixx5vd9au0asabvgmnckfj90.png"></p><br><p>  Skyengç§»åŠ¨åº”ç”¨ç¨‹åºåç«¯å¼€å‘äººå‘˜Sergey Zhukç»§ç»­å†™å¥½ä¹¦ã€‚ è¿™æ¬¡ï¼Œä»–ä¸ºä¿„è¯­ç²¾é€šçš„è¯»è€…å‘è¡Œäº†ä¿„æ–‡æ•™ç§‘ä¹¦ã€‚ æˆ‘è¯·è°¢å°”ç›–ï¼ˆSergeyï¼‰åˆ†äº«ä¹¦ä¸­æœ‰ç”¨çš„è‡ªç»™è‡ªè¶³ç« èŠ‚ï¼Œå¹¶ä¸ºå“ˆå¸ƒæ‹‰ï¼ˆHabraï¼‰è¯»è€…æä¾›æŠ˜æ‰£ä»£ç ã€‚ ä¸‹é¢æ˜¯ä¸¤è€…ã€‚ </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">é¦–å…ˆï¼Œè®©æˆ‘ä»¬å‘Šè¯‰æ‚¨å‰é¢å‡ ç« ä¸­æˆ‘ä»¬åœæ­¢è¿‡çš„å†…å®¹ã€‚</b> <div class="spoiler_text"><p>æˆ‘ä»¬å·²ç»ç”¨PHPç¼–å†™äº†ç®€å•çš„HTTPæœåŠ¡å™¨ã€‚ æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸»è¦çš„<code>index.php</code>æ–‡ä»¶-å¯åŠ¨æœåŠ¡å™¨çš„è„šæœ¬ã€‚ è¿™æ˜¯æœ€é«˜çº§åˆ«çš„ä»£ç ï¼šæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œé…ç½®HTTPæœåŠ¡å™¨çš„è¡Œä¸ºå¹¶å¼€å§‹å¾ªç¯ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">React</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Server</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Psr</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">ServerRequestInterface</span></span>; $loop = React\EventLoop\Factory::create(); $router = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Router(); $router-&gt;load(<span class="hljs-string"><span class="hljs-string">'routes.php'</span></span>); $server = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Server( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ServerRequestInterface $request)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($router)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $router($request); } ); $socket = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> React\Socket\Server(<span class="hljs-number"><span class="hljs-number">8080</span></span>, $loop); $server-&gt;listen($socket); $loop-&gt;run();</code> </pre> <br><p> è¦è·¯ç”±è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä½¿ç”¨è·¯ç”±å™¨ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// src/Router.php use Psr\Http\Message\ServerRequestInterface; use React\Http\Response; class Router { private $routes = []; public function __invoke(ServerRequestInterface $request) { $path = $request-&gt;getUri()-&gt;getPath(); echo "Request for: $path\n"; $handler = $this-&gt;routes[$path] ?? $this-&gt;notFound($path); return $handler($request); } public function load($filename) { $routes = require $filename; foreach ($routes as $path =&gt; $handler) { $this-&gt;add($path, $handler); } } public function add($path, callable $handler) { $this-&gt;routes[$path] = $handler; } private function notFound($path) { return function () use ($path) { return new Response( 404, ['Content-Type' =&gt; 'text/html; charset=UTF-8'], "No request handler found for $path" ); }; } }</span></span></code> </pre> <br><p> æ¥è‡ª<code>routes.php</code>æ–‡ä»¶çš„è·¯ç”±è¢«åŠ è½½åˆ°<code>routes.php</code> ã€‚ ç°åœ¨ï¼Œè¿™é‡Œä»…å®£å¸ƒäº†ä¸¤æ¡è·¯çº¿ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">React</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Response</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Psr</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">ServerRequestInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'/'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ServerRequestInterface $request)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Response( <span class="hljs-number"><span class="hljs-number">200</span></span>, [<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>], <span class="hljs-string"><span class="hljs-string">'Main page'</span></span> ); }, <span class="hljs-string"><span class="hljs-string">'/upload'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ServerRequestInterface $request)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Response( <span class="hljs-number"><span class="hljs-number">200</span></span>, [<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>], <span class="hljs-string"><span class="hljs-string">'Upload page'</span></span> ); }, ];</code> </pre> <br><p> åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€åˆ‡éƒ½å¾ˆç®€å•ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„å¼‚æ­¥åº”ç”¨ç¨‹åºå¯ä»¥æ”¾å…¥å‡ ä¸ªæ–‡ä»¶ä¸­ã€‚ </p></div></div><br><p> æˆ‘ä»¬ä¼ é€’ç»™æ›´å¤šâ€œæœ‰ç”¨â€çš„ä¸œè¥¿ã€‚ æˆ‘ä»¬ä»å‰å‡ ç« ä¸­å­¦åˆ°çš„çº¯æ–‡æœ¬ä¸­çš„å‡ ä¸ªå•è¯çš„ç­”æ¡ˆçœ‹èµ·æ¥å¹¶ä¸å¸å¼•äººã€‚ æˆ‘ä»¬éœ€è¦è¿”å›çœŸå®çš„å†…å®¹ï¼Œä¾‹å¦‚HTMLé¡µé¢ã€‚ </p><br><p> é‚£ä¹ˆï¼Œæˆ‘ä»¬å°†HTMLæ”¾åœ¨å“ªé‡Œï¼Ÿ å½“ç„¶ï¼Œæ‚¨å¯ä»¥åœ¨è·¯ç”±æ–‡ä»¶ä¸­å¯¹ç½‘é¡µçš„å†…å®¹è¿›è¡Œç¡¬ç¼–ç ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// routes.php return [ '/' =&gt; function (ServerRequestInterface $request) { $html = &lt;&lt;&lt;HTML &lt;!DOCTYPE html&gt; &lt;html lang=â€enâ€&gt; &lt;head&gt; &lt;meta charset=â€UTF-8â€&gt; &lt;title&gt;ReactPHP App&lt;/title&gt; &lt;/head&gt; &lt;body&gt; Hello, world &lt;/body&gt; &lt;/html&gt; HTML; return new Response( 200, ['Content-Type' =&gt; 'text/html'], $html ); }, '/upload' =&gt; function (ServerRequestInterface $request) { return new Response( 200, ['Content-Type' =&gt; 'text/plain'], 'Upload page' ); }, ];</span></span></code> </pre> <br><p> ä½†æ˜¯ä¸è¦é‚£æ ·åšï¼ æ‚¨ä¸èƒ½å°†ä¸šåŠ¡é€»è¾‘ï¼ˆè·¯ç”±ï¼‰ä¸æ¼”ç¤ºæ–‡ç¨¿ï¼ˆHTMLé¡µé¢ï¼‰æ··åˆä½¿ç”¨ã€‚ æ€ä¹ˆäº† å‡è®¾æ‚¨éœ€è¦æ›´æ”¹HTMLä»£ç ä¸­çš„æŸäº›å†…å®¹ï¼Œä¾‹å¦‚æŒ‰é’®çš„é¢œè‰²ã€‚ å“ªä¸ªæ–‡ä»¶éœ€è¦æ›´æ”¹ï¼Ÿ ä¸è·¯ç”±æ–‡ä»¶<code>router.php</code> ï¼Ÿ å¬èµ·æ¥å¾ˆæ€ªå§ï¼Ÿ æ›´æ”¹è·¯ç”±ä»¥æ›´æ”¹æŒ‰é’®çš„é¢œè‰²... </p><br><p> å› æ­¤ï¼Œæˆ‘ä»¬å°†ä¸ç†ä¼šè¿™äº›è·¯ç”±ï¼Œå¯¹äºHTMLé¡µé¢ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ç›®å½•ã€‚ åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œæ·»åŠ ä¸€ä¸ªåä¸ºpagesçš„æ–°ç›®å½•ã€‚ ç„¶ååœ¨å…¶ä¸­åˆ›å»º<code>index.html</code>æ–‡ä»¶ã€‚ è¿™å°†æ˜¯æˆ‘ä»¬çš„ä¸»é¡µã€‚ å…¶å†…å®¹å¦‚ä¸‹ï¼š </p><br><pre> <code class="php hljs">&lt;!DOCTYPE html&gt; &lt;html lang=<span class="hljs-string"><span class="hljs-string">"en"</span></span>&gt; &lt;head&gt; &lt;meta charset=<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>&gt; &lt;title&gt;ReactPHP App&lt;/title&gt; &lt;link rel=<span class="hljs-string"><span class="hljs-string">"stylesheet"</span></span> href=<span class="hljs-string"><span class="hljs-string">"https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"</span></span> &gt; &lt;/head&gt; &lt;body&gt; &lt;div <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">container</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">row</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">action</span></span></span><span class="hljs-class">="/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">upload</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">method</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">POST</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">justify</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">content</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">center</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">group</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">label</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text</span></span></span><span class="hljs-class">"&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Text</span></span></span><span class="hljs-class">&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">label</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">textarea</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">control</span></span></span><span class="hljs-class">"&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">button</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">submit</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">btn</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">btn</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">primary</span></span></span><span class="hljs-class">"&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Submit</span></span></span><span class="hljs-class">&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">button</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">body</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">html</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre> <br><p> è¯¥é¡µé¢éå¸¸ç®€å•ï¼Œå®ƒä»…åŒ…å«ä¸€ä¸ªå…ƒç´ -è¡¨å•ã€‚ é‡Œé¢çš„è¡¨å•æœ‰ä¸€ä¸ªæ–‡æœ¬æ¡†å’Œä¸€ä¸ªæäº¤æŒ‰é’®ã€‚ æˆ‘è¿˜æ·»åŠ äº†Bootstrapæ ·å¼ï¼Œä»¥ä½¿æˆ‘ä»¬çš„é¡µé¢çœ‹èµ·æ¥æ›´å¥½ã€‚ </p><br><h4 id="chtenie-faylov-kak-ne-nado-delat"> æ­£åœ¨è¯»å–æ–‡ä»¶ã€‚ æ€ä¹ˆåš </h4><br><p> æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯è¯»å–è¯·æ±‚å¤„ç†ç¨‹åºä¸­æ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶å°†è¯¥å†…å®¹ä½œä¸ºå“åº”æ­£æ–‡è¿”å›ã€‚ åƒè¿™æ ·ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// routes.php return [ '/' =&gt; function (ServerRequestInterface $request) { return new Response( 200, ['Content-Type' =&gt; 'text/html'], file_get_contents('pages/index.html') ); }, // ... ];</span></span></code> </pre> <br><p> é¡ºä¾¿è¯´ä¸€å¥ï¼Œå®ƒå°†èµ·ä½œç”¨ã€‚ æ‚¨å¯ä»¥è‡ªå·±å°è¯•ï¼šé‡æ–°å¯åŠ¨æœåŠ¡å™¨ï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸­é‡æ–°åŠ è½½é¡µé¢<code>http://127.0.0.1:8080/</code> ã€‚ </p><br><p><img src="https://habrastorage.org/webt/zq/dc/91/zqdc91cvy7a971jkniyw8hpxgzi.png"></p><br><p> é‚£æ€ä¹ˆäº† ä¸ºä»€ä¹ˆä¸è¿™æ ·åšå‘¢ï¼Ÿ ç®€è€Œè¨€ä¹‹ï¼Œå› ä¸ºå¦‚æœæ–‡ä»¶ç³»ç»Ÿå¼€å§‹å˜æ…¢ï¼Œå°†ä¼šå‡ºç°é—®é¢˜ã€‚ </p><br><h4 id="blokiruyuschie-i-neblokiruyuschie-vyzovy"> é˜»å¡å’Œéé˜»å¡å‘¼å« </h4><br><p> è®©æˆ‘å‘æ‚¨å±•ç¤ºâ€œé˜»å¡â€è°ƒç”¨çš„å«ä¹‰ï¼Œä»¥åŠå…¶ä¸­ä¸€ä¸ªè¯·æ±‚å¤„ç†ç¨‹åºåŒ…å«é˜»å¡ä»£ç æ—¶å¯èƒ½å‘ç”Ÿçš„æƒ…å†µã€‚ åœ¨è¿”å›å“åº”å¯¹è±¡ä¹‹å‰ï¼Œè¯·æ·»åŠ ä¸€ä¸ªå¯¹<code>sleep()</code>å‡½æ•°çš„è°ƒç”¨ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// routes.php return [ '/' =&gt; function (ServerRequestInterface $request) { sleep(10); return new Response( 200, ['Content-Type' =&gt; 'text/html'], file_get_contents('pages/index.html') ); }, '/upload' =&gt; function (ServerRequestInterface $request) { return new Response( 200, ['Content-Type' =&gt; 'text/plain'], 'Upload page' ); }, ];</span></span></code> </pre> <br><p> è¿™å°†ä½¿è¯·æ±‚å¤„ç†ç¨‹åºå†»ç»“10ç§’é’Ÿï¼Œç„¶åå®ƒæ‰èƒ½è¿”å›å¸¦æœ‰HTMLé¡µé¢å†…å®¹çš„å“åº”ã€‚ è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æ²¡æœ‰è§¦æ‘¸<code>/upload</code>åœ°å€çš„å¤„ç†ç¨‹åºã€‚ é€šè¿‡è°ƒç”¨<code>sleep(10)</code>å‡½æ•°ï¼Œæˆ‘æ¨¡æ‹Ÿäº†æŸç§é˜»å¡æ“ä½œçš„æ‰§è¡Œã€‚ </p><br><p> é‚£æˆ‘ä»¬æœ‰ä»€ä¹ˆå‘¢ï¼Ÿ å½“æµè§ˆå™¨è¯·æ±‚é¡µé¢<code>/</code> ï¼Œå¤„ç†ç¨‹åºå°†ç­‰å¾…10ç§’é’Ÿï¼Œç„¶åè¿”å›HTMLé¡µé¢ã€‚ å½“æˆ‘ä»¬æ‰“å¼€<code>/upload</code>åœ°å€æ—¶ï¼Œå…¶å¤„ç†ç¨‹åºåº”ç«‹å³è¿”å›å¸¦æœ‰å­—ç¬¦ä¸²â€œ Upload pageâ€çš„å“åº”ã€‚ </p><br><p> ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ç°å®ä¸­ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ ä¸å¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬é‡æ–°å¯åŠ¨æœåŠ¡å™¨ã€‚ ç°åœ¨ï¼Œè¯·åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€å¦ä¸€ä¸ªçª—å£ã€‚ åœ¨åœ°å€æ ä¸­ï¼Œè¾“å…¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http://127.0.0.1:8080/upload</a> ï¼Œä½†ä¸è¦ç«‹å³æ‰“å¼€æ­¤é¡µé¢ã€‚ åªéœ€å°†æ­¤åœ°å€æš‚æ—¶ç•™åœ¨åœ°å€æ ä¸­ã€‚ ç„¶åè½¬åˆ°ç¬¬ä¸€ä¸ªæµè§ˆå™¨çª—å£ï¼Œå¹¶åœ¨å…¶ä¸­æ‰“å¼€é¡µé¢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http://127.0.0.1:8080/</a> ã€‚ åœ¨åŠ è½½æ­¤é¡µé¢æ—¶ï¼ˆè¯·è®°ä½ï¼Œæ­¤è¿‡ç¨‹å°†éœ€è¦10ç§’é’Ÿï¼‰ï¼Œè¯·å¿«é€Ÿè½¬åˆ°ç¬¬äºŒä¸ªçª—å£å¹¶æŒ‰â€œ Enterâ€ä»¥åŠ è½½åœ°å€æ ä¸­å‰©ä½™çš„åœ°å€ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http://127.0.0.1:8080/upload</a> ï¼‰ ã€‚ </p><br><p> æˆ‘ä»¬å¾—åˆ°äº†ä»€ä¹ˆï¼Ÿ æ˜¯çš„ï¼Œåœ°å€/ç¬¦åˆé¢„æœŸï¼Œéœ€è¦10ç§’é’ŸåŠ è½½ã€‚ ä½†æ˜¯ï¼Œä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œå°½ç®¡æˆ‘ä»¬æ²¡æœ‰å‘å…¶æ·»åŠ ä»»ä½•<code>sleep()</code>è°ƒç”¨ï¼Œä½†ç¬¬äºŒé¡µèŠ±è´¹äº†ç›¸åŒçš„æ—¶é—´æ¥åŠ è½½ã€‚ çŸ¥é“ä¸ºä»€ä¹ˆä¼šè¿™æ ·å—ï¼Ÿ </p><br><p>  ReactPHPåœ¨å•ä¸ªçº¿ç¨‹ä¸­è¿è¡Œã€‚ ä¼¼ä¹åœ¨å¼‚æ­¥åº”ç”¨ç¨‹åºä¸­ï¼Œä»»åŠ¡æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œä½†å®é™…ä¸Šå¹¶éå¦‚æ­¤ã€‚ å¹¶è¡Œçš„é”™è§‰æ˜¯ç”±ä¸€ç³»åˆ—äº‹ä»¶æ„æˆçš„ï¼Œè¿™äº›äº‹ä»¶ä¸æ–­åœ°åœ¨å„ç§ä»»åŠ¡ä¹‹é—´åˆ‡æ¢å¹¶æ‰§è¡Œå®ƒä»¬ã€‚ ä½†æ˜¯åœ¨æŸä¸ªæ—¶é—´ç‚¹ï¼Œæ€»æ˜¯åªæ‰§è¡Œä¸€é¡¹ä»»åŠ¡ã€‚ è¿™æ„å‘³ç€ï¼Œå¦‚æœè¿™äº›ä»»åŠ¡ä¹‹ä¸€èŠ±è´¹çš„æ—¶é—´å¤ªé•¿ï¼Œå®ƒå°†é˜»æ­¢äº‹ä»¶å¾ªç¯ï¼Œè¿™å°†æ— æ³•æ³¨å†Œæ–°äº‹ä»¶å¹¶ä¸ºå…¶è°ƒç”¨å¤„ç†ç¨‹åºã€‚ æœ€ç»ˆå¯¼è‡´æ•´ä¸ªåº”ç”¨ç¨‹åºâ€œå†»ç»“â€ï¼Œå®ƒåªä¼šå¤±å»å¼‚æ­¥æ€§ã€‚ </p><br><p> å¯ä»¥ï¼Œä½†æ˜¯è¿™ä¸è°ƒç”¨<code>file_get_contents('pages/index.h')</code>ä»€ä¹ˆå…³ç³»ï¼Ÿ è¿™é‡Œçš„é—®é¢˜æ˜¯æˆ‘ä»¬æ­£åœ¨ç›´æ¥è®¿é—®æ–‡ä»¶ç³»ç»Ÿã€‚ ä¸å…¶ä»–æ“ä½œï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨å†…å­˜æˆ–è®¡ç®—ï¼‰ç›¸æ¯”ï¼Œä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿå¯èƒ½ä¼šéå¸¸æ…¢ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœç»“æœè¯æ˜æ–‡ä»¶å¤ªå¤§æˆ–ç£ç›˜æœ¬èº«å¾ˆæ…¢ï¼Œåˆ™è¯»å–æ–‡ä»¶å¯èƒ½ä¼šèŠ±è´¹ä¸€äº›æ—¶é—´ï¼Œå› æ­¤ä¼šé˜»å¡äº‹ä»¶å¾ªç¯ã€‚ </p><br><p> åœ¨æ ‡å‡†åŒæ­¥æ¨¡å‹ä¸­ï¼Œè¯·æ±‚-å“åº”ä¸æ˜¯é—®é¢˜ã€‚ å¦‚æœå®¢æˆ·ç«¯è¯·æ±‚çš„æ–‡ä»¶å¤ªé‡ï¼Œå®ƒå°†ç­‰å¾…ä¸‹è½½æ­¤æ–‡ä»¶ã€‚ å¦‚æ­¤ç¹é‡çš„è¯·æ±‚ä¸ä¼šå½±å“å…¶ä»–å®¢æˆ·ã€‚ ä½†å°±æˆ‘ä»¬è€Œè¨€ï¼Œæˆ‘ä»¬æ­£åœ¨å¤„ç†ä¸€ä¸ªå¼‚æ­¥çš„é¢å‘äº‹ä»¶çš„æ¨¡å‹ã€‚ æˆ‘ä»¬å¯åŠ¨äº†ä¸€ä¸ªHTTPæœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨å¿…é¡»ä¸æ–­å¤„ç†ä¼ å…¥çš„è¯·æ±‚ã€‚ å¦‚æœä¸€ä¸ªè¯·æ±‚èŠ±è´¹å¤ªå¤šæ—¶é—´æ‰èƒ½å®Œæˆï¼Œé‚£ä¹ˆè¿™å°†å½±å“æ‰€æœ‰å…¶ä»–æœåŠ¡å™¨å®¢æˆ·ç«¯ã€‚ </p><br><p> é€šå¸¸ï¼Œè¯·è®°ä½ï¼š </p><br><ul><li> æ‚¨æ°¸è¿œä¸èƒ½é˜»æ­¢äº‹ä»¶å¾ªç¯ã€‚ </li></ul><br><p> é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•å¼‚æ­¥è¯»å–æ–‡ä»¶å‘¢ï¼Ÿ è¿™æ˜¯ç¬¬äºŒæ¡è§„åˆ™ï¼š </p><br><ul><li> å½“æ— æ³•é¿å…é˜»å¡æ“ä½œæ—¶ï¼Œåº”å°†å…¶åˆ†å‰åˆ°å­è¿›ç¨‹ä¸­ï¼Œå¹¶åœ¨ä¸»çº¿ç¨‹ä¸­ç»§ç»­å¼‚æ­¥æ‰§è¡Œã€‚ </li></ul><br><p> å› æ­¤ï¼Œåœ¨å­¦ä¹ äº†å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ä¹‹åï¼Œè®©æˆ‘ä»¬è®¨è®ºæ­£ç¡®çš„éé˜»å¡è§£å†³æ–¹æ¡ˆã€‚ </p><br><h4 id="docherniy-process"> å­è¿›ç¨‹ </h4><br><p> ä¸å¼‚æ­¥åº”ç”¨ç¨‹åºä¸­æ–‡ä»¶ç³»ç»Ÿçš„æ‰€æœ‰é€šä¿¡éƒ½å¿…é¡»åœ¨å­è¿›ç¨‹ä¸­æ‰§è¡Œã€‚ è¦åœ¨ReactPHPåº”ç”¨ç¨‹åºä¸­ç®¡ç†å­è¿›ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…å¦ä¸€ä¸ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">â€œå­è¿›ç¨‹â€</a>ç»„ä»¶ã€‚ è¯¥ç»„ä»¶ä½¿æ‚¨å¯ä»¥è®¿é—®æ“ä½œç³»ç»Ÿçš„åŠŸèƒ½ï¼Œä»¥åœ¨å­è¿›ç¨‹ä¸­è¿è¡Œä»»ä½•ç³»ç»Ÿå‘½ä»¤ã€‚ è¦å®‰è£…æ­¤ç»„ä»¶ï¼Œè¯·åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­æ‰“å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š </p><br><p> <code>composer require react/child-process</code> </p> <br><h4 id="sovmestimost-s-windows">  <em>Windowså…¼å®¹æ€§</em> </h4><br><p>  <em>åœ¨Windowsæ“ä½œç³»ç»Ÿä¸­ï¼ŒSTDINï¼ŒSTDOUTå’ŒSTDERRçº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€ï¼Œè¿™æ„å‘³ç€å­è¿›ç¨‹ç»„ä»¶å°†æ— æ³•æ­£å¸¸å·¥ä½œã€‚</em>  <em>å› æ­¤ï¼Œè¯¥ç»„ä»¶ä¸»è¦è®¾è®¡ä¸ºä»…åœ¨nixç³»ç»Ÿä¸Šå·¥ä½œã€‚</em>  <em>å¦‚æœæ‚¨å°è¯•åœ¨Windowsç³»ç»Ÿä¸Šåˆ›å»ºProcessç±»çš„å¯¹è±¡ï¼Œåˆ™å°†å¼•å‘å¼‚å¸¸ã€‚</em>  <em>ä½†æ˜¯è¯¥ç»„ä»¶å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Linuxçš„Windowså­ç³»ç»Ÿï¼ˆWSLï¼‰ä¸‹å·¥ä½œ</a> ã€‚</em>  <em>å¦‚æœæ‰“ç®—åœ¨Windowsä¸‹ä½¿ç”¨æ­¤ç»„ä»¶ï¼Œåˆ™éœ€è¦å®‰è£…WSLã€‚</em> </p><br><p> ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å­è¿›ç¨‹ä¸­æ‰§è¡Œä»»ä½•shellå‘½ä»¤ã€‚ æ‰“å¼€<code>routes.php</code>æ–‡ä»¶ï¼Œç„¶åæ›´æ”¹<code>/</code>è·¯ç”±çš„å¤„ç†ç¨‹åºã€‚ åˆ›å»ºä¸€ä¸ª<code>React\ChildProcess\Process</code>ç±»çš„å¯¹è±¡ï¼Œå¹¶ä½œä¸ºå‘½ä»¤ï¼Œå°†<code>ls</code>ä¼ é€’ç»™å®ƒä»¥è·å–å½“å‰ç›®å½•çš„å†…å®¹ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// routes.php use Psr\Http\Message\ServerRequestInterface; use React\ChildProcess\Process; use React\Http\Response; return [ '/' =&gt; function (ServerRequestInterface $request) { $childProcess = new Process('ls'); return new Response( 200, ['Content-Type' =&gt; 'text/html'], file_get_contents('pages/index.html') ); }, // ... ];</span></span></code> </pre> <br><p> ç„¶åï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡è°ƒç”¨<code>start()</code>æ–¹æ³•æ¥å¯åŠ¨è¯¥è¿‡ç¨‹ã€‚ é—®é¢˜åœ¨äº<code>start()</code>æ–¹æ³•éœ€è¦ä¸€ä¸ªäº‹ä»¶å¾ªç¯å¯¹è±¡ã€‚ ä½†æ˜¯åœ¨<code>routes.php</code>æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰æ­¤å¯¹è±¡ã€‚ æˆ‘ä»¬å¦‚ä½•å°†äº‹ä»¶å¾ªç¯ä»<code>index.php</code>ä¼ é€’åˆ°ç›´æ¥è·¯ç”±åˆ°è¯·æ±‚å¤„ç†ç¨‹åºçš„è·¯ç”±ï¼Ÿ è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯â€œä¾èµ–æ³¨å…¥â€ã€‚ </p><br><h4 id="inekciya-zavisimostey"> ä¾èµ–æ³¨å…¥ </h4><br><p> å› æ­¤ï¼Œæˆ‘ä»¬çš„ä¸€æ¡è·¯çº¿éœ€è¦ä¸€ä¸ªäº‹ä»¶å¾ªç¯æ‰èƒ½èµ·ä½œç”¨ã€‚ åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ï¼Œåªæœ‰ä¸€ä¸ªç»„ä»¶çŸ¥é“è·¯ç”±çš„å­˜åœ¨<code>Router</code>ç±»ã€‚ äº‹å®è¯æ˜ï¼Œä¸ºè·¯çº¿æä¾›äº‹ä»¶å¾ªç¯æ˜¯ä»–çš„è´£ä»»ã€‚ æ¢å¥è¯è¯´ï¼Œè·¯ç”±å™¨éœ€è¦ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œæˆ–è€…å®ƒå–å†³äºäº‹ä»¶å¾ªç¯ã€‚ æˆ‘ä»¬å¦‚ä½•åœ¨ä»£ç ä¸­æ˜ç¡®è¡¨è¾¾è¿™ç§ä¾èµ–æ€§ï¼Ÿ å¦‚ä½•ä½¿å³ä½¿ä¸ä¼ é€’äº‹ä»¶å¾ªç¯ä¹Ÿæ— æ³•åˆ›å»ºè·¯ç”±å™¨ï¼Ÿ å½“ç„¶ï¼Œé€šè¿‡<code>Router</code>ç±»çš„æ„é€ å‡½æ•°ã€‚ æ‰“å¼€<code>Router.php</code>å¹¶å°†æ„é€ å‡½æ•°æ·»åŠ åˆ°<code>Router</code>ç±»ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Psr</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">ServerRequestInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">React</span></span>\<span class="hljs-title"><span class="hljs-title">EventLoop</span></span>\<span class="hljs-title"><span class="hljs-title">LoopInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">React</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Response</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Router</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $routes = []; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> LoopInterface */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $loop; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LoopInterface $loop)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loop = $loop; } <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p> åœ¨æ„é€ å‡½æ•°å†…éƒ¨ï¼Œå°†ä¼ é€’çš„äº‹ä»¶å¾ªç¯ä¿å­˜åœ¨private <code>$loop</code>å±æ€§ä¸­ã€‚ å½“æˆ‘ä»¬ä¸ºç±»æä¾›å®ƒéœ€è¦åœ¨å¤–éƒ¨å·¥ä½œçš„å¯¹è±¡æ—¶ï¼Œè¿™å°±æ˜¯ä¾èµ–æ³¨å…¥ã€‚ </p><br><p> ç°åœ¨æœ‰äº†è¿™ä¸ªæ–°çš„æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°è·¯ç”±å™¨çš„åˆ›å»ºã€‚ æ‰“å¼€<code>index.php</code>æ–‡ä»¶ï¼Œå¹¶æ›´æ­£æˆ‘ä»¬åˆ›å»º<code>Router</code>ç±»å¯¹è±¡çš„è¡Œï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// index.php $loop = React\EventLoop\Factory::create(); $router = new Router($loop); $router-&gt;load('routes.php');</span></span></code> </pre> <br><p> åšå®Œäº† è¿”å›<code>routes.php</code> ã€‚ æ‚¨å¯èƒ½å·²ç»çŒœåˆ°äº†ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥å°†ç›¸åŒçš„æƒ³æ³•ä¸<strong>ä¾èµ–é¡¹æ³¨å…¥ç»“åˆä½¿ç”¨</strong> ï¼Œå¹¶å°†äº‹ä»¶å¾ªç¯ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°æ·»åŠ åˆ°æŸ¥è¯¢å¤„ç†ç¨‹åºä¸­ã€‚ æ›´æ”¹ç¬¬ä¸€ä¸ªå›è°ƒå¹¶æ·»åŠ ç¬¬äºŒä¸ªå‚æ•°ï¼šå®ç°<code>LoopInterface</code>çš„å¯¹è±¡ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// routes.php use Psr\Http\Message\ServerRequestInterface; use React\EventLoop\LoopInterface; use React\ChildProcess\Process; use React\Http\Response; return [ '/' =&gt; function (ServerRequestInterface $request, LoopInterface $loop) { $childProcess = new Process('ls'); $childProcess-&gt;start($loop); return new Response( 200, ['Content-Type' =&gt; 'text/html'], file_get_contents('pages/index.html') ); }, '/upload' =&gt; function (ServerRequestInterface $request) { return new Response( 200, ['Content-Type' =&gt; 'text/plain'], 'Upload page' ); }, ];</span></span></code> </pre> <br><p> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å°†äº‹ä»¶å¾ªç¯ä¼ é€’ç»™å­è¿›ç¨‹çš„<code>start()</code>æ–¹æ³•ã€‚ å¤„ç†ç¨‹åºä»å“ªé‡Œè·å–äº‹ä»¶å¾ªç¯ï¼Ÿ å®ƒå·²ç»å­˜å‚¨åœ¨è·¯ç”±å™¨çš„private <code>$loop</code>å±æ€§ä¸­ã€‚ æˆ‘ä»¬åªéœ€è¦åœ¨è°ƒç”¨å¤„ç†ç¨‹åºæ—¶ä¼ é€’å®ƒå³å¯ã€‚ </p><br><p>  <code>__invoke()</code>æ‰“å¼€<code>Router</code>ç±»å¹¶æ›´æ–°<code>__invoke()</code>æ–¹æ³•ï¼Œå°†ç¬¬äºŒä¸ªå‚æ•°æ·»åŠ åˆ°è¯·æ±‚å¤„ç†ç¨‹åºè°ƒç”¨ä¸­ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ServerRequestInterface $request)</span></span></span><span class="hljs-function"> </span></span>{ $path = $request-&gt;getUri()-&gt;getPath(); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Request for: $path\n"</span></span>; $handler = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;routes[$path] ?? <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;notFound($path); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $handler($request, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loop); }</code> </pre> <br><p> ä»…æ­¤è€Œå·²ï¼ è¿™å¯èƒ½è¶³å¤Ÿ<strong>ä¾èµ–æ³¨å…¥</strong> ã€‚ äº‹ä»¶å‘¨æœŸå‘ç”Ÿäº†ä¸€æ®µç›¸å½“å¤§çš„æ—…ç¨‹ï¼Œå¯¹ä¸å¯¹ï¼Ÿ ä»<code>index.php</code>æ–‡ä»¶åˆ°<code>Router</code>ç±»ï¼Œç„¶åå†ä»<code>Router</code>ç±»åˆ°callbackså†…éƒ¨çš„<code>Router</code> <code>routes.php</code>æ–‡ä»¶ã€‚ </p><br><p> å› æ­¤ï¼Œè¦ç¡®è®¤å­è¿›ç¨‹å°†æ‰§è¡Œå…¶éé˜»å¡é­”æœ¯ï¼Œè®©æˆ‘ä»¬ç”¨æ›´é‡çš„<code>ping 8.8.8.8</code>æ›¿æ¢ç®€å•çš„<code>ls</code> ã€‚ é‡æ–°å¯åŠ¨æœåŠ¡å™¨ï¼Œç„¶åå†æ¬¡å°è¯•åœ¨ä¸¤ä¸ªä¸åŒçš„çª—å£ä¸­æ‰“å¼€ä¸¤ä¸ªé¡µé¢ã€‚ é¦–å…ˆï¼Œ <code>http://127.0.0.1:8080/</code> <code>/upload</code> ï¼Œç„¶å<code>/upload</code> ã€‚ å°½ç®¡<code>ping</code>å‘½ä»¤åœ¨åå°çš„ç¬¬ä¸€ä¸ªå¤„ç†ç¨‹åºä¸­æ‰§è¡Œï¼Œä½†ä¸¤ä¸ªé¡µé¢éƒ½å¯ä»¥å¿«é€Ÿæ‰“å¼€ï¼Œæ²¡æœ‰ä»»ä½•å»¶è¿Ÿã€‚ é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ´¾é£ä»»ä½•æ˜‚è´µçš„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œå¤„ç†å¤§æ–‡ä»¶ï¼‰ï¼Œè€Œä¸ä¼šé˜»å¡ä¸»åº”ç”¨ç¨‹åºã€‚ </p><br><h4 id="svyazyvaem-docherniy-process-i-otvet-s-pomoschyu-potokov"> ä½¿ç”¨çº¿ç¨‹ç»‘å®šå­è¿›ç¨‹å’Œå“åº” </h4><br><p> è®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚ å› æ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå­è¿›ç¨‹ï¼Œå°†å…¶å¯åŠ¨ï¼Œä½†æ˜¯æˆ‘ä»¬çš„æµè§ˆå™¨ä¸ä¼šä»¥ä»»ä½•æ–¹å¼æ˜¾ç¤ºåˆ†å‰æ“ä½œçš„ç»“æœã€‚ è®©æˆ‘ä»¬ä¿®å¤å®ƒã€‚ </p><br><p> æˆ‘ä»¬å¦‚ä½•ä¸å­è¿›ç¨‹è¿›è¡Œæ²Ÿé€šï¼Ÿ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„<code>ls</code> ï¼Œè¯¥<code>ls</code>æ˜¾ç¤ºå½“å‰ç›®å½•çš„å†…å®¹ã€‚ æˆ‘ä»¬å¦‚ä½•è·å¾—è¯¥ç»“è®ºï¼Œç„¶åå°†å…¶å‘é€ç»™ç­”æ¡ˆæ­£æ–‡ï¼Ÿ ç®€çŸ­çš„ç­”æ¡ˆæ˜¯ï¼šçº¿ç¨‹ã€‚ </p><br><p> è®©æˆ‘ä»¬è°ˆè°ˆæµç¨‹ã€‚ æ‚¨æ‰§è¡Œçš„ä»»ä½•Shellå‘½ä»¤éƒ½å…·æœ‰ä¸‰ä¸ªæ•°æ®æµï¼šSTDINï¼ŒSTDOUTå’ŒSTDERRã€‚ æµå¼ä¼ è¾“åˆ°æ ‡å‡†è¾“å‡ºå’Œè¾“å…¥ï¼Œä»¥åŠæµå¼ä¼ è¾“é”™è¯¯ã€‚ ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ<code>ls</code> ï¼Œè¯¥<code>ls</code>çš„ç»“æœç›´æ¥å‘é€åˆ°STDOUTï¼ˆåœ¨ç»ˆç«¯å±å¹•ä¸Šï¼‰ã€‚ å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è·å–æµç¨‹çš„è¾“å‡ºï¼Œåˆ™éœ€è¦è®¿é—®è¾“å‡ºæµã€‚ è¿™å°±åƒç‚®å‡»æ¢¨ä¸€æ ·å®¹æ˜“ã€‚ åœ¨åˆ›å»ºå“åº”å¯¹è±¡æ—¶ï¼Œç”¨<code>$childProcess-&gt;stdout</code>æ›¿æ¢<code>file_get_contents()</code>è°ƒç”¨ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Response( <span class="hljs-number"><span class="hljs-number">200</span></span>, [<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>], $childProcess-&gt;stdout );</code> </pre> <br><p> æ‰€æœ‰å­è¿›ç¨‹éƒ½å…·æœ‰ä¸<code>stdio</code>æµç›¸å…³çš„ä¸‰ä¸ªå±æ€§ï¼š <code>stdout</code> ï¼Œ <code>stdin</code>å’Œ<code>stderr</code> ã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æƒ³åœ¨ç½‘é¡µä¸Šæ˜¾ç¤ºæµç¨‹çš„è¾“å‡ºã€‚ æˆ‘ä»¬ä¼ é€’ä¸€ä¸ªæµä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œè€Œä¸æ˜¯<code>Response</code>ç±»çš„æ„é€ å‡½æ•°ä¸­çš„å­—ç¬¦ä¸²ã€‚  <code>Response</code>ç±»è¶³å¤Ÿèªæ˜ï¼Œå¯ä»¥æ„è¯†åˆ°å®ƒå·²æ¥æ”¶åˆ°æµå¹¶è¿›è¡Œäº†ç›¸åº”å¤„ç†ã€‚ </p><br><p> å› æ­¤ï¼Œåƒå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬é‡æ–°å¯åŠ¨æœåŠ¡å™¨ï¼Œç„¶åçœ‹çœ‹æˆ‘ä»¬åšäº†ä»€ä¹ˆã€‚ è®©æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€é¡µé¢<code>http://127.0.0.1:8080/</code> ï¼šæ‚¨åº”è¯¥çœ‹åˆ°é¡¹ç›®æ ¹æ–‡ä»¶å¤¹çš„æ–‡ä»¶åˆ—è¡¨ã€‚ </p><br><p><img src="https://habrastorage.org/webt/mm/ui/za/mmuizadmcw-fzg1cekm0d1jpz3e.png"></p><br><p> æœ€åä¸€æ­¥æ˜¯ç”¨æ›´æœ‰ç”¨çš„<code>ls</code>æ›¿æ¢<code>ls</code> ã€‚ æˆ‘ä»¬é€šè¿‡ä½¿ç”¨<code>file_get_contents()</code>å‡½æ•°å‘ˆç°<code>pages/index.html</code>æ–‡ä»¶æ¥å¼€å§‹æœ¬ç« ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç»å¯¹å¼‚æ­¥åœ°è¯»å–è¯¥æ–‡ä»¶ï¼Œè€Œä¸å¿…æ‹…å¿ƒå®ƒå°†é˜»å¡æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚ ç”¨<code>cat pages/index.html</code>æ›¿æ¢<code>ls</code> ã€‚ </p><br><p> å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰<code>cat</code> ï¼Œé‚£ä¹ˆå®ƒå°†ç”¨äºè¿æ¥å’Œè¾“å‡ºæ–‡ä»¶ã€‚ é€šå¸¸ï¼Œæ­¤å‘½ä»¤ç”¨äºè¯»å–æ–‡ä»¶å¹¶å°†å…¶å†…å®¹è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚  <code>cat pages/index.html</code>å‘½ä»¤è¯»å–<code>cat pages/index.html</code>æ–‡ä»¶å¹¶å°†å…¶å†…å®¹æ‰“å°åˆ°STDOUTã€‚ å¹¶ä¸”æˆ‘ä»¬å·²ç»å°†<code>stdout</code>å‘é€ä¸ºå“åº”ä¸»ä½“ã€‚ è¿™æ˜¯<code>routes.php</code>æ–‡ä»¶çš„æœ€ç»ˆç‰ˆæœ¬ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// routes.php use Psr\Http\Message\ServerRequestInterface; use React\EventLoop\LoopInterface; use React\ChildProcess\Process; use React\Http\Response; return [ '/' =&gt; function (ServerRequestInterface $request, LoopInterface $loop) { $childProcess = new Process('cat pages/index.html'); $childProcess-&gt;start($loop); return new Response( 200, ['Content-Type' =&gt; 'text/html'], $childProcess-&gt;stdout ); }, '/upload' =&gt; function (ServerRequestInterface $request) { return new Response( 200, ['Content-Type' =&gt; 'text/plain'], 'Upload page' ); }, ];</span></span></code> </pre> <br><p> ç»“æœï¼Œåªéœ€è¦æ›¿æ¢æ‰€æœ‰å¯¹<code>file_get_contents()</code>å‡½æ•°çš„è°ƒç”¨å°±å¯ä»¥ä½¿ç”¨æ‰€æœ‰è¿™äº›ä»£ç ã€‚ ä¾èµ–æ³¨å…¥ï¼Œä¼ é€’äº‹ä»¶å¾ªç¯å¯¹è±¡ï¼Œæ·»åŠ å­è¿›ç¨‹ä»¥åŠä½¿ç”¨çº¿ç¨‹ã€‚ æ‰€æœ‰è¿™äº›åªæ˜¯æ›¿æ¢ä¸€ä¸ªå‡½æ•°è°ƒç”¨ã€‚ å€¼å¾—å—ï¼Ÿ ç­”ï¼šæ˜¯çš„ï¼Œå€¼å¾—ã€‚ å½“æŸäº›ä¸œè¥¿å¯ä»¥é˜»æ­¢äº‹ä»¶å¾ªç¯ï¼Œè€Œæ–‡ä»¶ç³»ç»Ÿå¯ä»¥é˜»æ­¢æ—¶ï¼Œè¯·ç¡®ä¿å®ƒæœ€ç»ˆå°†åœ¨æœ€ä¸é€‚å½“çš„æ—¶åˆ»è¢«é˜»æ­¢ã€‚ </p><br><p> æ¯æ¬¡æˆ‘ä»¬éœ€è¦è®¿é—®æ–‡ä»¶ç³»ç»Ÿæ—¶åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹å¯èƒ½çœ‹èµ·æ¥ä¼šäº§ç”Ÿé¢å¤–çš„å¼€é”€ï¼Œè¿™ä¼šå½±å“åº”ç”¨ç¨‹åºçš„é€Ÿåº¦å’Œæ€§èƒ½ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œåœ¨PHPä¸­ï¼Œæ²¡æœ‰å…¶ä»–æ–¹æ³•å¯ä»¥å¼‚æ­¥å¤„ç†æ–‡ä»¶ç³»ç»Ÿã€‚ æ‰€æœ‰å¼‚æ­¥PHPåº“éƒ½ä½¿ç”¨å­è¿›ç¨‹ï¼ˆæˆ–æŠ½è±¡å®ƒä»¬çš„æ‰©å±•ï¼‰ã€‚ </p><br><p>  Habraçš„è¯»è€…å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é€šè¿‡æ­¤é“¾æ¥</a>ä»¥æŠ˜æ‰£ä»·è´­ä¹°æ•´æœ¬ä¹¦ã€‚ </p><br><p> æˆ‘ä»¬æé†’æ‚¨ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯»æ‰¾ä¼˜ç§€çš„å¼€å‘äººå‘˜</a> ï¼ æ¥å§ï¼Œæˆ‘ä»¬ç©å¾—å¼€å¿ƒï¼ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN416003/">https://habr.com/ru/post/zh-CN416003/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN415993/index.html">è¿œç¨‹å¤„ç†ï¼Œä½ æ— æƒ…çš„é¢ç²‰</a></li>
<li><a href="../zh-CN415995/index.html">ä»å†…éƒ¨å¼€å‘CROCï¼šäººï¼Œé¸­å­å’Œè®¸å¤šå·¥ä½œ</a></li>
<li><a href="../zh-CN415997/index.html">Pythonæœºå™¨å­¦ä¹ è½¯ä»¶</a></li>
<li><a href="../zh-CN415999/index.html">ä»€ä¹ˆæ˜¯Appleå¥–å­¦é‡‘ï¼Ÿä¸ºä»€ä¹ˆä¸ä»…æ˜¯WWDCé—¨ç¥¨ï¼Ÿ</a></li>
<li><a href="../zh-CN416001/index.html">æ¥è‡ªVKç½‘ç«™çš„æ¶ˆæ¯-ç®€å•æœ‰æ•ˆ-PHP + CUrl</a></li>
<li><a href="../zh-CN416005/index.html">16ä¸ªé¢å‘ç•Œé¢å¼€å‘äººå‘˜çš„Reactå·¥å…·</a></li>
<li><a href="../zh-CN416007/index.html">ç®€ç›´å¤ªå¤æ‚äº†ã€‚ åˆ›å»ºæ— çº¿â€œæ™ºèƒ½å®¶å±…â€çš„å¼€å§‹ã€‚ åŸºäºLinuxæŠ€æœ¯ï¼ŒZ-Waveå’ŒMajorDoMoè½¯ä»¶</a></li>
<li><a href="../zh-CN416009/index.html">å°è¯•å…”å­çš„ç²ªä¾¿ï¼Œå®ƒä¼šéå¸¸æœ‰æ´»åŠ›ï¼Œå¹¶ä¸”ä¼šæŠ“ä½-è¯ç†å­¦æå–ç‰©</a></li>
<li><a href="../zh-CN416011/index.html">BIFæ¨¡å¼ï¼šå¹²å‡€çš„å‰ç«¯ä»£ç ï¼Œæ–¹ä¾¿å¤„ç†æœåŠ¡å™¨æ•°æ®</a></li>
<li><a href="../zh-CN416013/index.html">å¦‚ä½•å¼€å§‹æŠ•èµ„å¹¶èŠ‚çœèµ„é‡‘ï¼šé“ç¼æ–¯ä¸“å®¶æŒ‡å‡ºæ–°æ‰‹äº¤æ˜“è€…çš„äº”ä¸ªä¸»è¦é”™è¯¯</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>