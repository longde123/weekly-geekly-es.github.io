<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ üêú ü§≤üèø Module de contr√¥leur universel pour l'Internet des objets. Test FatFs üê≥ üíÇ üà∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, je vais d√©montrer les projets de test de la biblioth√®que FatFs port√©s sur le module K66BLEZ1. La biblioth√®que open source FatFs est ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Module de contr√¥leur universel pour l'Internet des objets. Test FatFs</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/392955/"><a href=""><img align="left" width="1010" src="https://habrastorage.org/getpro/geektimes/post_images/a10/d19/e62/a10d19e628ece2a53ba5c69e85db3f1f.png"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, je vais d√©montrer les projets de test de la biblioth√®que FatFs port√©s sur le module K66BLEZ1. La biblioth√®que open source FatFs est bien connue des programmeurs de microcontr√¥leurs et impl√©mente la prise en charge du syst√®me de fichiers FAT32 sur les cartes SD et MMC. Une chose indispensable dans le d√©veloppement des enregistreurs, contr√¥leurs logiques programmables, enregistreurs sonores, trackers, etc. Mais parfois, cela peut devenir un goulot d'√©tranglement dans les syst√®mes en temps r√©el.</font></font><br>
<br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La pr√©sentation du module K66BLEZ1 a √©t√© lanc√©e dans cet article: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Module contr√¥leur universel pour l'Internet des objets. </font><font style="vertical-align: inherit;">Respirer la vie</font></font></a><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
L'article mentionne la suite logicielle (SDK) pour la famille de microcontr√¥leurs K66. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En particulier, dans le SDK, vous pouvez trouver un exemple pour tester les FatFs. </font><font style="vertical-align: inherit;">L'exemple est tr√®s simple et je l'ai donc modifi√© pour plus de praticit√©.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organisation de la sortie des informations de d√©bogage.</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour que l'exemple d'origine du SDK fonctionne sur la carte K66BLEZ1, vous n'avez pas besoin de le modifier. Mais il y a une chose, mais! Il n'y aura aucune sortie vers le terminal de d√©bogage. √âtant donn√© que la carte du module n'a pas de connecteur sp√©cial pour la sortie de d√©bogage avec l'interface RS232. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le d√©bogage de module est con√ßu pour un travail serr√© via l'interface SWD et en utilisant la technologie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTT (Real Time Terminal)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d√©crite dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cet article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cependant, cette approche peut ne pas plaire aux propri√©taires d'adaptateurs de d√©bogage incompatibles avec J-Link. Par cons√©quent, je n'ai pas corrig√© le code de sortie de d√©bogage dans l'application, mais je l'ai redirig√© vers UART4. L√† encore, pour √©viter le prototypage, j'ai profit√© de J-Link. Les signaux RX et TX du convertisseur de port COM virtuel UART &lt;-&gt; int√©gr√© sont √©mis vers cet adaptateur sur le connecteur SWD. Je les ai utilis√©s. Ainsi, le premier r√©glage est apparu sur la carte du module. Elle est repr√©sent√©e dans le sch√©ma ci-dessous en rouge. </font></font><br>
<a href=""><img align="left" width="339" src="https://habrastorage.org/getpro/geektimes/post_images/0e2/386/683/0e238668328e7f13f2c490b162f075a5.png"><br clear="left">
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Cliquez pour agrandir)</font></font></em></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
i.e. sur la carte K66BLEZ1, soudez la connexion des signaux rouges du connecteur de d√©bogage avec les signaux n√©cessaires provenant du microcontr√¥leur. </font></font><br>
<a href=""><img align="left" width="490" src="https://habrastorage.org/getpro/geektimes/post_images/acb/481/159/acb481159081f57a5250f3cd5fff64e0.png"><br clear="left">
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Cliquer pour agrandir)</font></font></em></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ci-dessous, un sch√©ma de l'adaptateur du connecteur J-Link au connecteur de d√©bogage de la carte K66BLEZ1 pour comprendre d'o√π proviennent les signaux de l'adaptateur. </font></font><br>
<a href=""><img align="left" width="711" src="https://habrastorage.org/getpro/geektimes/post_images/0b9/348/fd0/0b9348fd0b4b27ce8cc79aa33b7f43ee.png"><br clear="left">
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Cliquer pour agrandir)</font></font></em></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organisation de projets.</font></font></h1><br>
      <b>IAR Embedded Workbench for ARM 7.40.7</b><br>
      FatFs   <b>SDK</b>  . <br>
    ,        SDK  ,                 .<br>
<br>
     UART   <b>board.h</b>. <br>
       <b>sdcard_FatFs.c</b>   <b>BOARD_BootClockRUN</b>  <b>BOARD_BootClockHSRUN</b>, ..     <b>180</b>   <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">120</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MHz </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le projet </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se trouve ici, le</font></font></a> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
deuxi√®me est bas√© sur le premier, mais avec des ajouts importants. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce projet vous permet de tester la vitesse d'ouverture, de cr√©ation, d'√©criture, de lecture, de fermeture et de suppression de fichiers. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le projet </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est ici</font></font></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description du test</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous compilons le projet dans IAR et programmons via l'adaptateur JTAG / SWD dans le microcontr√¥leur MK66FN2M0VLQ18 sur la carte. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s le d√©marrage du programme, un menu du type suivant s'affiche dans le terminal: </font></font><br>
<a href=""><img align="left" width="450" src="https://habrastorage.org/getpro/geektimes/post_images/2a3/7e5/482/2a37e5482fc1811f8d52ec1b23974938.png"><br clear="left">
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Cliquez pour agrandir) Le</font></font></em></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
menu propose d'ex√©cuter l'un des trois tests et la possibilit√© de modifier plusieurs param√®tres de test. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le test num√©ro 1</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √©crit s√©quentiellement le nombre sp√©cifi√© de fichiers avec la taille sp√©cifi√©e. Des donn√©es al√©atoires obtenues par la fonction rand sont enregistr√©es. Chaque enregistrement est accompagn√© d'une mesure des heures d'ouverture, d'enregistrement et de fermeture du dossier. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, les fichiers sont lus s√©quentiellement et leur contenu est v√©rifi√©, le temps d'ouverture, de lecture et de fermeture du fichier est √©galement mesur√©. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si l'indicateur Erase est d√©fini, les fichiers sont ensuite supprim√©s et le temps n√©cessaire pour supprimer les fichiers est mesur√©.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour 3 groupes d'op√©rations: cr√©ation de fichier, lecture invers√©e et suppression, les statistiques sont r√©sum√©es. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici √† quoi ressemble la fen√™tre de test d'√©criture, de lecture, de suppression de 5 fichiers de taille 8192 baht. </font></font><br>
<a href=""><img align="left" width="459" src="https://habrastorage.org/getpro/geektimes/post_images/15a/c45/0dc/15ac450dc99132e90ecb742aa1891aa0.png"><br clear="left">
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Cliquez pour agrandir) Le</font></font></em></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
nombre de fichiers et leur taille peuvent √™tre modifi√©s arbitrairement. Si les valeurs sont trop grandes, le programme affichera un message sur la m√©moire insuffisante. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le test num√©ro 2</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cr√©e, √©crit, lit, supprime un fichier d'une taille donn√©e et r√©p√®te ce nombre de fois. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le nom du fichier change √† chaque fois. Ici, le nombre d'entr√©es peut √™tre tr√®s important. Le test vous permet de tester les cartes pour l'usure compl√®te et en m√™me temps voir une image de la d√©gradation des vitesses d'√©criture et de lecture. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Num√©ro d'essai 3</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cr√©e un fichier et y √©crit le nombre sp√©cifi√© (valeur Files Cnt) fois les blocs de la taille sp√©cifi√©e. </font><font style="vertical-align: inherit;">Ensuite, la proc√©dure est r√©p√©t√©e pour un autre fichier. </font><font style="vertical-align: inherit;">Ce sc√©nario vous permet de tester le mode d'enregistrement continu typique des appareils d'enregistrement audio avec des changements de volume.</font></font><br>
 <br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©sultats</font></font></h1><br>
  K66BLEZ1  FatFs    . <br>
<br>
   8GB microSD  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GOOD RAM SDU8GDMGR</a> (10- )<br>
<br>
     32768  ‚Äî 5.1 /<br>
     32768  ‚Äî 11.8 /<br>
<br>
     32768  ‚Äî 15.9 /<br>
     32768  ‚Äî 16.2 /<br>
<br>
    1  100 .<br>
<br>
 ,              . <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, avec un grand nombre de fichiers, le temps d'ouverture des fichiers commence √† influencer la vitesse globale, qui augmente de deux ordres de grandeur lorsque le nombre de fichiers passe de un √† cent. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La valeur pratique des tests est qu'ils vous permettent de trouver les options de formatage de carte optimales, les tailles de fichier optimales, ainsi que d'optimiser les tailles de bloc des fichiers enregistr√©s pour des performances maximales. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les m√™mes tests aideront √† voir et √† √©valuer les retards d'enregistrement sporadiques caract√©ristiques des cartes SD et MMC en relation avec le fonctionnement de leur m√©canisme interne pour niveler l'usure des secteurs de la m√©moire. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tous les mat√©riaux li√©s √† ce projet sont stock√©s ici</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/Indemsys/K66BLEZ1</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr392955/">https://habr.com/ru/post/fr392955/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr392945/index.html">Les climatologues sont enfin d'accord: le r√©chauffement climatique est caus√© par les activit√©s humaines</a></li>
<li><a href="../fr392947/index.html">Opera Dragonfly –≤ offline: –º–∞–ª–µ–Ω—å–∫–æ–µ –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ</a></li>
<li><a href="../fr392949/index.html">Historique des applications Office: Partie I</a></li>
<li><a href="../fr392951/index.html">Veuillez payer un suppl√©ment: pourquoi les smartphones sont priv√©s de la prise en charge des cartes m√©moire</a></li>
<li><a href="../fr392953/index.html">Nous vous invitons √† la r√©union-discussion "Peur de la physique" dans le cadre de rencontres scientifiques populaires "Science Is Not Flour"</a></li>
<li><a href="../fr392957/index.html">Les pirates ont pirat√© l'iPhone terroriste ne se pr√©cipitent pas pour partager des secrets</a></li>
<li><a href="../fr392959/index.html">Revue Moto 360 2e g√©n√©ration</a></li>
<li><a href="../fr392963/index.html">MDI i5 - projecteur DLP portable sur Android</a></li>
<li><a href="../fr392965/index.html">Oui, vous pouvez ex√©cuter des applications Linux de bureau sous Windows 10</a></li>
<li><a href="../fr392967/index.html">Programmation en tableaux classiques</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>