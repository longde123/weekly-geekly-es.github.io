<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßñüèΩ üìÖ üëâ G√©n√©ration de niveau proc√©dural üöé üëÑ üöÉ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le travail sur la programmation, les graphismes et les sons dans certains nouveaux jeux est termin√© - seuls les niveaux restent. Travail facile et agr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>G√©n√©ration de niveau proc√©dural</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418685/"><p><img src="https://habrastorage.org/webt/2m/0y/gv/2m0ygvmlc1izxgmo4chumrammxi.png"></p><br><p>  Le travail sur la programmation, les graphismes et les sons dans <em>certains nouveaux jeux est</em> termin√© - seuls les niveaux restent.  Travail facile et agr√©able, mais pour une raison quelconque, il est tr√®s difficile.  Peut-√™tre l'effet de la fatigue g√©n√©rale. </p><br><p>  Pensant √† simplifier sa vie, l'id√©e de g√©n√©ration proc√©durale lui est venue √† l'esprit.  Bien s√ªr, il faudra aussi l'√©crire, mais comme il a √©t√© dit dans un ouvrage bien connu, "il vaut mieux perdre une journ√©e, puis voler en cinq minutes". </p><br><p>  <strong>Attention!</strong>  <strong>Sous la coupe, beaucoup de texte et de gifs "gras".</strong> </p><a name="habracut"></a><br><h2 id="vvodnaya">  Introduction </h2><br><p>  Les niveaux seront toujours polis manuellement, il n'y a donc pas d'exigences particuli√®res pour la m√©moire, la vitesse ou m√™me la qualit√© des niveaux r√©sultants. </p><br><p>  Initialement, je pr√©voyais que le g√©n√©rateur ne lance que des pi√®ces et des portes, et tout autre raffinement (intrigue, paysage et ennemis) sera effectu√© en mode manuel.  Mais pour l'instant, je pense que le g√©n√©rateur peut faire beaucoup plus.  N√©anmoins, le r√©glage manuel restera - il est n√©cessaire que les joueurs sentent qu'au moins un peu d'amour est investi dans les niveaux. </p><br><p>  J'ai regard√© ma base de connaissances sur le d√©veloppement de jeux et j'ai r√©dig√© des liens vers des articles sur la g√©n√©ration de proc√©dures dans un document s√©par√©.  La plupart, bien s√ªr, concernent la g√©n√©ration de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">labyrinthes classiques</a> ou la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">g√©n√©ration de terrain</a> (au fait, les r√©sultats sont tr√®s impressionnants), ce qui ne convient pas √† un tireur 3D.  Mais certains √©taient proches de ce dont j'avais besoin (avec un ast√©risque j'ai not√© ceux qui me semblaient les plus adapt√©s): </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.progamer.ru/dev/procedural-dungeon-generation.htm</a> (*) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://habr.com/post/333692/</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://www.gamasutra.com/blogs/GrahamDavis/20170130/290326/Procedural_Level_Generation_in_Unity_for_MERC_part_1_of_2.php</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://ijdykeman.github.io/ml/2017/10/12/wang-tile-procedural-generation.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://habr.com/post/332832/</a> (*) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://habr.com/post/184818/</a> (*) </li></ul><br><p>  J'ai d√©cid√© de commencer par les deux derniers - ils viennent d'√™tre mis en ≈ìuvre et donnent de bons r√©sultats. </p><br><h2 id="struktura-generatora">  Structure du g√©n√©rateur </h2><br><p>  En fait, je ne suis pas venu tout de suite dans cette structure, mais dans le processus de nombreuses refactoring et r√©√©criture, mais j'√©cris tout de suite pour que ce soit clair: </p><br><ol><li>  G√©n√©ration de la g√©om√©trie initiale (au choix - "BSP" ou disposition de la pi√®ce). </li><li>  Effacement des sections d'ordures (ces sections qui ne peuvent pas exister dans le jeu). </li><li>  √âtablir des connexions. </li><li>  Effacement des sous-graphiques d'ordures (ces groupes de sections qui sont interconnect√©s, mais il n'y a pas de connexion avec les sections restantes). </li><li>  Suppression des connexions inutiles (construction d'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">arbre couvrant</a> , un lien est donn√© √† l'arbre couvrant <strong>minimum</strong> , car il y a une image l√†, mais pour le g√©n√©rateur il n'y a pas besoin du minimum). </li><li>  La randomisation des connexions est la restauration de certaines connexions distantes (pour un type de niveau plus ¬´humain¬ª), ainsi que la transformation de certaines autres en passages entre sections (qui fusionne plusieurs sections en une seule forme plus complexe). </li><li>  G√©n√©ration de chambre secr√®te. </li><li>  G√©n√©ration d'un ¬´sc√©nario¬ª (o√π seront les sections initiales et finales, et quel chemin devra √™tre franchi pour passer de l'initiale √† la finale). </li><li>  Optimisation de la connexion. </li><li>  Cr√©ation de portes et fen√™tres. </li><li>  Le choix de l'action √† effectuer dans cette section (appuyez sur l'interrupteur, relevez la cl√© ou trouvez le mur secret). </li></ol><br><p>  Il y a encore quelque part environ 12 points, mais ils ne sont pas encore termin√©s (quand j'aurai fini, j'√©crirai un article s√©par√© √† leur sujet). </p><br><h2 id="generaciya-iznachalnoy-geometrii-bsp">  G√©n√©ration initiale de la g√©om√©trie: "BSP" </h2><br><p><img src="https://habrastorage.org/webt/zn/j4/_k/znj4_kemnzlvr4cfr45tqtzami8.gif"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cette traduction a</a> √©t√© prise comme base.  Je ne sais pas combien ce qui se passe dans cet algorithme est proche du vrai BSP, donc j'√©cris "BSP" entre guillemets. </p><br><p>  L'algorithme est assez simple.  Initialement, cr√©ez un rectangle de la taille de l'ensemble du terrain de jeu: </p><br><p><img src="https://habrastorage.org/webt/fh/mx/x-/fhmxx-boo4euwsc4dl2g0gfc2nk.png"></p><br><p>  Ensuite, nous le divisons au hasard en deux parties - horizontalement ou verticalement.  O√π la ligne de s√©paration aura lieu, nous choisissons √©galement au hasard: </p><br><p><img src="https://habrastorage.org/webt/ml/lo/jm/mllojmhd2qxiga7ma_skqxqoera.png"></p><br><p>  Nous faisons r√©cursivement la m√™me chose pour les nouveaux rectangles: </p><br><p><img src="https://habrastorage.org/webt/ew/sw/wf/ewswwfagu3jcskhcebem5sd-jo8.png"></p><br><p>  Et encore et encore, dans une certaine mesure: </p><br><p><img src="https://habrastorage.org/webt/fl/s-/hd/fls-hd2xm17ghbjbvnwpyhwzd_m.png"></p><br><p>  Ensuite, dans chaque rectangle, nous s√©lectionnons une ¬´pi√®ce¬ª - un rectangle de la m√™me taille que l'original ou plus petit (mais pas moins de 3x3 - plus sur celui ci-dessous). </p><br><p><img src="https://habrastorage.org/webt/r8/h1/_y/r8h1_yacj5bpuux_xmmxuwzdlo0.png"></p><br><p>  Ensuite, les chambres sont reli√©es par des couloirs.  Mais pas chacun, mais un peu d√©licat, car ils sont stock√©s dans une structure de type "BSP" (voir l'algorithme d'origine pour plus de d√©tails). </p><br><p><img src="https://habrastorage.org/webt/5t/y6/3e/5ty63ewmz5eey4oaphja4uixjuu.png"><br>  <em>Le couloir reliant les sections violettes et blanches.</em> </p><br><p>  Dans l'algorithme d'origine, les pi√®ces et les couloirs sont de la m√™me couleur (c'est-√†-dire qu'ils sont √©quivalents), donc les couloirs sont simplement dessin√©s au-dessus des pi√®ces.  Dans mon cas, les pi√®ces d'origine doivent √™tre conserv√©es, de sorte que les couloirs soient dessin√©s comme ¬´derri√®re¬ª les pi√®ces. </p><br><p>  De plus, si la pi√®ce (turquoise sur la figure) traverse le couloir, elle doit la diviser en deux sections diff√©rentes (par cons√©quent, le m√™me couloir peut √™tre dessin√© de diff√©rentes couleurs): </p><br><p><img src="https://habrastorage.org/webt/5n/wr/51/5nwr510wdeg8x9iw3cgy_eorsau.png"></p><br><p>  Et voici le r√©sultat: </p><br><p><img src="https://habrastorage.org/webt/q4/hq/7r/q4hq7rocs2amqbt-guzspzcmbp4.png"></p><br><p>  Commence alors la phase de marquage des poubelles: </p><br><p><img src="https://habrastorage.org/webt/f0/ob/sc/f0obscdf1tabhec9mxv4m-wrj5s.png"></p><br><p>  Comme je l'ai d√©j√† √©crit, aucun secteur ne peut √™tre inf√©rieur √† 3x3 cellules.  Cela est d√ª au fait que le secteur doit √™tre entour√© de murs (au moins 1 cellule de chaque c√¥t√©) et qu'il doit avoir au moins une cellule d'espace libre: </p><br><p><img src="https://habrastorage.org/webt/iy/e8/ne/iye8ne6qltvzxtwrpgrtjgmgeae.png"></p><br><p>  Par cons√©quent, toutes les cellules qui ne correspondent pas √† cette r√®gle sont √©tiquet√©es.  Mais prenez-le et vous ne pouvez pas les supprimer - tant de connexions disparaissent et le niveau est tr√®s limit√©. </p><br><p>  Au lieu de cela, pour chaque cellule √©tiquet√©e, le secteur auquel elle peut se joindre est recherch√© (en respectant la r√®gle 3x3): </p><br><p><img src="https://habrastorage.org/webt/nc/6q/-y/nc6q-yh8jlkx_rhlilpamtzt27s.png"><br>  <em>Si la cellule ne peut toujours pas √™tre attribu√©e √† un secteur, elle sera supprim√©e (mais pas dans ce cas - tout va bien ici).</em> </p><br><p>  √Ä la derni√®re √©tape, cette belle image est vectoris√©e, et les secteurs dessin√©s se transforment en poly-bo√Ætes - de tels polygones dans lesquels chaque bord est soit strictement vertical soit strictement horizontal (il y a probablement un nom plus scientifique): </p><br><p><img src="https://habrastorage.org/webt/xx/8x/8v/xx8x8vpyawz-uricpycndaadgfy.png"></p><br><h2 id="generaciya-iznachalnoy-geometrii-planirovka-pomescheniy">  G√©n√©ration initiale de la g√©om√©trie: disposition de la pi√®ce </h2><br><p><img src="https://habrastorage.org/webt/7w/jh/nb/7wjhnbk6xzc6zmdaqyiufpq7t5m.gif"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un autre article a</a> √©t√© pris comme base.  Cet algorithme est un peu plus compliqu√© que le pr√©c√©dent, mais pas non plus la science des fus√©es. </p><br><p>  Tout d'abord, le terrain de jeu est rempli d'une certaine valeur d'arr√™t, puis une zone rectangulaire est effac√©e au hasard dessus: </p><br><p><img src="https://habrastorage.org/webt/4n/24/py/4n24pyropjvmm0d8gsmzj9znte0.png"></p><br><p>  L'√©tape de nettoyage d'un rectangle al√©atoire est effectu√©e un certain nombre de fois (√©galement al√©atoire), et en cons√©quence, les contours externes du niveau sont obtenus: </p><br><p><img src="https://habrastorage.org/webt/np/4v/fi/np4vfi_iumlrznv8bsy8ba3babk.png"></p><br><p>  Dans l'espace libre, les points de croissance des pi√®ces sont dispers√©s de fa√ßon al√©atoire (la taille minimale de la pi√®ce est de 3x3): </p><br><p><img src="https://habrastorage.org/webt/2y/wm/3n/2ywm3n3lgak23tcn0dmyshbicne.png"></p><br><p>  La premi√®re √©tape de la croissance de la pi√®ce commence - pour chaque pi√®ce, le plus grand c√¥t√© est s√©lectionn√©, qui peut encore grandir, et il cro√Æt de 1 cellule (s'il y a plusieurs c√¥t√©s de la m√™me longueur - un au hasard).  Les pi√®ces sont d√©plac√©es √† tour de r√¥le afin qu'il n'y ait pas d'intersections. </p><br><p><img src="https://habrastorage.org/webt/-b/4r/cd/-b4rcdczwe-_hu8xvha_cko1ihk.gif"></p><br><p>  Les pi√®ces sont ensuite converties en polyboxes: </p><br><p><img src="https://habrastorage.org/webt/pd/j8/qo/pdj8qos36_hf4slo-jlm2eailsw.png"></p><br><p>  Et la deuxi√®me √©tape de la croissance commence - √† ce stade, le c√¥t√© peut √™tre divis√© en plusieurs parties.  Contrairement √† la premi√®re √©tape, il ne fait pas pousser une cellule √† la fois, mais imm√©diatement √† l'arr√™t maximum - cela √©vite l '"√©chelle" au niveau des joints des pi√®ces.  Si apr√®s le passage dans toutes les pi√®ces il y a encore des cellules vides, le cycle se r√©p√®te. </p><br><p>  Le r√©sultat est un espace enti√®rement rempli: </p><br><p><img src="https://habrastorage.org/webt/mi/8j/zf/mi8jzfzhpksr2cz7jzd1_k3gmng.png"></p><br><p>  Ensuite, les polyboxes sont dessin√©es sous la forme d'un raster, et (comme dans le cas du g√©n√©rateur ¬´BSP¬ª), l'√©tape de marquage des cellules ¬´ordures¬ª commence: </p><br><p><img src="https://habrastorage.org/webt/ev/na/ru/evnaruhyjwsei7hfbywiiuxyzq4.png"></p><br><p>  Et en les associant aux secteurs existants: </p><br><p><img src="https://habrastorage.org/webt/1h/yv/kf/1hyvkfcnerw5yu30txvbztecfzw.png"><br>  <em>Ici, il n'a pas √©t√© possible de fixer toutes les cellules - les cellules suppl√©mentaires ont √©t√© supprim√©es.</em> </p><br><p>  Le r√©sultat est reconverti en polybox: </p><br><p><img src="https://habrastorage.org/webt/ji/l3/yq/jil3yqqnbqpf4cfjyx-sklb_g8w.png"></p><br><h2 id="ochistka-ot-musornyhsekciy">  Nettoyage des sections de d√©chets </h2><br><p>  Parfois, des sections apparaissent √† l'int√©rieur desquelles la r√®gle 3x3 n'est pas respect√©e: </p><br><p><img src="https://habrastorage.org/webt/6v/zx/2v/6vzx2vnhvhn_kkxvqp1jyzenh6g.png"></p><br><p>  Vous pouvez essayer de "restaurer" de telles sections, mais je suis all√© de la mani√®re la plus simple et je les ai simplement supprim√©es: </p><br><p><img src="https://habrastorage.org/webt/gc/5s/4y/gc5s4yzeywvc6pi1kh0apfk90pm.png"></p><br><h2 id="postroenie-soedineniy">  √âtablir des connexions </h2><br><p><img src="https://habrastorage.org/webt/af/3m/w2/af3mw25mgkjtqwskriypbpzzaeo.gif"></p><br><p>  Pour chaque section, ses voisins sont recherch√©s et dans les lieux de contact de ces sections, des connexions sont cr√©√©es.  Des connexions sont cr√©√©es des deux c√¥t√©s - si la section A est en contact avec la section B, alors il y aura une connexion de A √† B et de B √† A. Le r√©sultat est un graphique bidirectionnel. </p><br><h2 id="ochistka-ot-musornyh-podgrafov">  Effacement des sous-graphiques d'ordures </h2><br><p>  Parfois, √† la suite du nettoyage des sections d'ordures, nous obtenons non pas un graphique, mais plusieurs graphiques ind√©pendants, comme dans cet exemple: </p><br><p><img src="https://habrastorage.org/webt/yi/s5/5u/yis55urvft0bohq8x0dsurgyyam.png"></p><br><p>  Dans ce cas, le sous-graphique est s√©lectionn√© comme principal, la "zone" des sections est maximale et le reste est supprim√© (la "zone" est entre guillemets, car bien qu'il soit possible de calculer la zone r√©elle de la zone poly, j'ai simplifi√© la t√¢che et je consid√®re la zone de la zone de d√©limitation - c'est faux, mais adapt√© √† un g√©n√©rateur). </p><br><h2 id="ochistka-ot-izlishnih-soedineniy">  √âliminer les compos√©s en exc√®s </h2><br><p>  S'il y a un passage de chaque secteur √† chacun avec lequel il est connect√©, alors il y aura trop de portes au niveau, et on sentira plus fortement qu'il est g√©n√©r√©.  Par cons√©quent, √† ce stade, les connexions en exc√®s sont supprim√©es: </p><br><p><img src="https://habrastorage.org/webt/oa/sh/oy/oashoyuavho98281lo_s4hpc-ks.gif"></p><br><p>  Pour plus de randomisation, je ne g√©n√®re pas d'arbre couvrant dans le nombre minimum de passes, mais plut√¥t, je supprime un bord al√©atoire √† la fois (en le choisissant au hasard parmi tous les possibles √† l'√©tape en cours). </p><br><p>  <em>Bien que, lorsque j'√©cris ceci, l'id√©e est apparue qu'il serait assez al√©atoire de s√©lectionner le secteur initial et de supprimer les bords d√©j√† plus efficaces.</em> </p><br><h2 id="randomizaciya-soedineniy">  Randomisation de connexion </h2><br><p><img src="https://habrastorage.org/webt/ok/zl/vk/okzlvk4rclc7x3imkpjnjza3kje.gif"><br>  <em>Ci-apr√®s, les illustrations proviendront d'une autre g√©n√©ration, car</em>  <em>dans le pr√©c√©dent, il y avait une erreur dans le g√©n√©rateur, √† cause de laquelle les autres images √©taient incorrectes.</em> </p><br><p>  Mais un niveau dans lequel il n'y a pas une seule connexion superflue ne semble pas non plus tr√®s humain, donc un peu de chaos est introduit: </p><br><ol><li>  Certains bords supprim√©s sont restaur√©s. </li><li>  Et certains se transforment en all√©es. </li></ol><br><p>  De plus, les sections entre lesquelles les passages ont √©t√© form√©s fusionnent en une seule: </p><br><p><img src="https://habrastorage.org/webt/nh/j_/uj/nhj_ujd0n7sqjdnddlvs9uozq5u.gif"><br>  <em>S'il vous a sembl√© que dans cette illustration, les connexions supprim√©es √† l'√©tape pr√©c√©dente sont r√©apparues - il vous semble :).</em>  <em>Quand j'ai lu le texte, cela m'a sembl√© aussi, mais apr√®s avoir soigneusement regard√© l'illustration pr√©c√©dente, il devient clair que tout va bien.</em> </p><br><h2 id="generaciya-sekretnyh-komnat">  G√©n√©ration de chambre secr√®te </h2><br><p>  Les secteurs qui n'ont qu'une seule connexion sont s√©lectionn√©s sur le graphique: </p><br><p><img src="https://habrastorage.org/webt/xt/ku/qw/xtkuqweqgctwcbcckilick4-es4.png"></p><br><p>  S'il existe plusieurs secteurs de ce type, ils se regroupent tous dans un tableau et sont tri√©s par "zone".  Ensuite, ce tableau est tronqu√© de mani√®re al√©atoire (mais de sorte qu'au moins un √©l√©ment y reste).  Ces secteurs deviendront des salles secr√®tes: </p><br><p><img src="https://habrastorage.org/webt/pf/w0/yu/pfw0yufvv3orwiw_xohtfii8gqi.png"></p><br><h2 id="generaciya-scenariya">  G√©n√©ration de script </h2><br><p><img src="https://habrastorage.org/webt/p2/ql/dn/p2qldn0n-scgjotykszlvsvd05a.gif"></p><br><p>  Tout d'abord, les secteurs avec le nombre minimum de connexions libres (c'est-√†-dire ceux les plus proches du "bord" du graphique) sont s√©lectionn√©s: </p><br><p><img src="https://habrastorage.org/webt/lc/iw/7v/lciw7vahyrhoirla-hyahd7jzhu.png"><br>  <em>Dans cette illustration, un secteur est s√©lectionn√©, mais s'il y en avait plus, de toute fa√ßon, un serait s√©lectionn√© (au hasard).</em> </p><br><p>  <em>NB.</em>  <em>Au cours de la relecture de l'article, j'ai pu trouver une situation o√π un secteur avec un nombre minimum de connexions libres ne sera pas seulement √† la limite, mais lui assigner un script conduira √† un niveau infranchissable.</em>  <em>En fait, vous pouvez choisir n'importe quel secteur, mais un seul, apr√®s quoi le graphique ne tomberait pas dans plusieurs sous-graphiques.</em> </p><br><p>  Ensuite, s√©lectionnez les secteurs qui sont connect√©s au secteur actuel et qui n'ont qu'une seule connexion gratuite.  Ils, avec une certaine probabilit√©, seront utilis√©s pour continuer le script.  Par exemple, si le graphique √©tait le m√™me que dans l'illustration ci-dessous, alors le secteur indiqu√© par la question pourrait √™tre inclus dans la liste. </p><br><p><img src="https://habrastorage.org/webt/6u/b6/vf/6ub6vfbxncsmbug4optzec19gyw.png"><br>  <em>La salle secr√®te est marqu√©e en gris, les croix sont les connexions qui auraient d√ª √™tre supprim√©es dans le graphique d'origine et le secteur source est un plus.</em> </p><br><p>  <em>NB.</em>  <em>Lors de la relecture de l'article, il m'a sembl√© que la condition de pr√©sence d'une seule connexion √©tait trop stricte, la m√™me que dans l'√©tape pr√©c√©dente suffirait - pour qu'apr√®s suppression de ce secteur, le graphique ne se d√©compose pas.</em> </p><br><p>  Ensuite, le num√©ro de script est attribu√© √† cette liste de secteurs (juste un num√©ro, √† ce stade, cela ne signifie rien de sp√©cifique), et les connexions aux fronti√®res de cette liste de secteurs sont marqu√©es comme ferm√©es par ce script. </p><br><p><img src="https://habrastorage.org/webt/tw/4w/3w/tw4w3wxhybxndd5_94mw-l0e1zc.png"><br>  <em>Dans ces illustrations, diff√©rents sc√©narios auront des couleurs de remplissage de secteur diff√©rentes.</em>  <em>Ils n'ont rien √† voir avec la couleur de la fronti√®re du secteur (dans les prochaines √©tapes cela sera corrig√©, mais dans cette √©tape c'est plus pratique pour moi).</em> </p><br><p>  Ensuite, le secteur suivant est s√©lectionn√©, une liste est compil√©e et cette liste est marqu√©e avec un nouveau sc√©nario: </p><br><p><img src="https://habrastorage.org/webt/qo/01/qw/qo01qww9cg-s2km6vfrjvoqb_vk.png"></p><br><p>  Faites attention aux petits points bleus √† l'int√©rieur des carr√©s rouges - c'est ainsi que l'ouvreur de sc√©nario est dessin√© - c'est-√†-dire  quelque part dans la section avec le script rouge, il y aura une cl√© ou un interrupteur qui ouvrira le passage aux secteurs avec un script bleu. </p><br><p>  Cela continue jusqu'√† ce qu'il ne reste plus de secteurs libres: </p><br><p><img src="https://habrastorage.org/webt/5f/ok/yn/5fokynxff0gfpspu7-d8paaw7wi.png"></p><br><p>  Le secteur le plus r√©cent ne se voit pas attribuer de script, mais uniquement un ouvre-sc√©nario.  Ce secteur sera le secteur dans lequel le joueur commence la partie. </p><br><p>  Pour ce niveau: </p><br><ul><li>  Le joueur commence dans le secteur de d√©part, quelque part l√† o√π il trouve un ¬´d√©capsuleur¬ª pour le secteur jaune, y va. </li><li>  Dans le secteur jaune, ouvre le secteur bleu, y va. </li><li>  Dans le secteur bleu s'ouvre vert, va l√†-bas. </li><li>  Dans le secteur vert s'ouvre le violet, y va. </li><li>  En violet s'ouvre le rouge. </li><li>  En rouge - bleu. </li><li>  O√π il trouve l'interrupteur de niveau final. </li></ul><br><p>  Sch√©matiquement, cela peut √™tre montr√© comme suit: </p><br><p><img src="https://habrastorage.org/webt/c7/6o/xd/c76oxdwcgff53io6pv3sfcptpuu.png"></p><br><p>  Un ¬´ouvre-porte¬ª peut √™tre soit une cl√©, soit un interrupteur, ou autre chose, par exemple, une t√¢che pour d√©truire tous les ennemis dans n'importe quel secteur (mais je ne pr√©vois pas que dans un avenir proche le g√©n√©rateur ou le moteur le supportera). </p><br><h2 id="optimizaciya-soedineniy">  Optimisation de la connexion </h2><br><p><img src="https://habrastorage.org/webt/5q/vl/gw/5qvlgwjtnablead4upxcwph7m6k.gif"></p><br><p>  √Ä cette √©tape, pour chaque connexion, un c√¥t√© est s√©lectionn√© (comme vous vous en souvenez, les connexions sont initialement g√©n√©r√©es dans les deux sens).  Cela est n√©cessaire pour rendre le niveau plus ¬´manuel¬ª et pour simplifier les √©tapes suivantes <em>(mais pour un type de niveau encore plus int√©ressant, je pr√©vois dans un avenir proche de ¬´d√©soptimiser¬ª certaines connexions)</em> . </p><br><h2 id="sozdanie-dverey-iokon">  Cr√©ation de portes et fen√™tres </h2><br><p><img src="https://habrastorage.org/webt/xr/je/m5/xrjem5kqzr7ncka2vuf8nsukw2c.gif"></p><br><p>  Pour chaque secteur, toutes ses connexions sont visualis√©es (qui apr√®s l'√©tape pr√©c√©dente ne regardent que dans une seule direction), et des portes et fen√™tres sont plac√©es sur chaque connexion visualis√©e. </p><br><ul><li>  Tout d'abord, un point est s√©lectionn√© √† la jonction, de pr√©f√©rence plus pr√®s du centre. </li><li>  Ensuite, √† ce stade, une porte ou une fen√™tre est plac√©e (et s'il s'agit d'une connexion √† une pi√®ce secr√®te, alors un mur secret). </li><li>  Si une porte est plac√©e, elle peut avoir de 1 √† 3 cellules (une est une porte ordinaire, deux ou trois sont une porte herm√©tique √©paisse, qui s'ouvre apr√®s avoir appuy√© sur un interrupteur). </li><li>  De plus, la connexion est divis√©e en deux parties: la partie avant le point s√©lectionn√© et la partie apr√®s.  Et, s'il reste de l'espace avant ou apr√®s, la fonction est appel√©e r√©cursivement. </li></ul><br><p>  Pour rendre le niveau plus int√©ressant, √† diff√©rentes √©tapes, il existe une probabilit√© diff√©rente de placer une porte ou une fen√™tre: </p><br><ol><li>  √Ä la premi√®re √©tape, la porte est toujours plac√©e, car  √† quoi sert de se connecter s'il n'y a que des fen√™tres. </li><li>  √Ä la deuxi√®me √©tape, avec <strong>une</strong> probabilit√© plus √©lev√©e (75%), une fen√™tre est plac√©e qu'une porte. </li><li>  S'il y a une troisi√®me √©tape (par exemple, la connexion est longue), une fen√™tre doit √™tre plac√©e dessus. </li><li>  Dans le cas de la 4√®me √©tape, la porte ou la fen√™tre est plac√©e de mani√®re similaire. </li><li>  Si la connexion est extra longue, le g√©n√©rateur revient √† la deuxi√®me √©tape. </li></ol><br><h2 id="vybor-deystviya">  S√©lection d'actions </h2><br><p>  Bien que cela ne soit pas li√© √† la g√©n√©ration, la visualisation change √† cette √©tape - maintenant la bordure du secteur est peinte dans la couleur du script: </p><br><p><img src="https://habrastorage.org/webt/rc/6y/xv/rc6yxvsq6duv-xdujaamzq0fdry.png"><br>  <em>Le secteur de d√©part est gris clair, le secteur final est bleu.</em>  <em>Notez √©galement qu'au lieu de la porte de la salle secr√®te (gris fonc√© √† gauche) un mur est dessin√© - tout est correct, c'est un mur secret.</em> </p><br><p>  S√©lectionnez ensuite les secteurs dans lesquels vous pouvez placer les cl√©s: </p><br><p><img src="https://habrastorage.org/webt/kl/os/jz/klosjzmyvv_tl2djbz5v6b9sqze.png"></p><br><p>  Ils sont s√©lectionn√©s tout simplement: </p><br><ul><li>  S'il s'agit d'une pi√®ce secr√®te, il ne peut y avoir aucun "ouvre-porte" et la cl√© ne peut pas y √™tre plac√©e. </li><li>  Vous ne pouvez pas non plus placer la cl√© dans le secteur final, car elle est d√©finitive. </li><li>  De plus, la cl√© ne peut pas ouvrir les portes doubles et triples - en raison des caract√©ristiques du moteur, elles ne peuvent √™tre ouvertes qu'√† l'aide de l'interrupteur <em>(il n'y a pas de tels secteurs dans l'illustration ci-dessus)</em> . </li></ul><br><p>  Apr√®s cela, le nombre de cl√©s √† un niveau (de z√©ro √† trois) est s√©lectionn√© au hasard, puis, au hasard, dans la liste des secteurs disponibles, ceux dans lesquels il y aura des cl√©s sont s√©lectionn√©s. </p><br><p>  Dans les autres secteurs, il y aura des commutateurs. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr418685/">https://habr.com/ru/post/fr418685/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr418675/index.html">Comment je suis all√© √† Droidcon Berlin</a></li>
<li><a href="../fr418677/index.html">Toute la v√©rit√© sur RTOS. Article # 6. Autres services RTOS</a></li>
<li><a href="../fr418679/index.html">Nous √©crivons un composant avec des boutons ¬´mat√©riel¬ª pour Svelte</a></li>
<li><a href="../fr418681/index.html">Journ√©e de l'amiti√© - 50% de r√©duction sur tous les IDE JetBrains pour nos amis</a></li>
<li><a href="../fr418683/index.html">Cr√©ation d'une machine d'arcade d'√©mulation. 2e partie</a></li>
<li><a href="../fr418687/index.html">R√©volution 3,5 ": d√©tails d'un petit boom de disquettes avec vapeurs</a></li>
<li><a href="../fr418689/index.html">Comment cr√©er des biblioth√®ques de composants dans Figma, √©conomiser un budget, en utilisant l'exemple d'une vente aux ench√®res en ligne</a></li>
<li><a href="../fr418691/index.html">Rancher: Kubernetes en 5 minutes sur du m√©tal nu</a></li>
<li><a href="../fr418693/index.html">Pourquoi le bonheur est-il si difficile √† d√©tecter dans le cerveau</a></li>
<li><a href="../fr418695/index.html">Anti-Piracy Wars - L'Empire contre-attaque</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>