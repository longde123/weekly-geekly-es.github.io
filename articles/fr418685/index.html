<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧖🏽 📅 👉 Génération de niveau procédural 🚎 👄 🚃</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le travail sur la programmation, les graphismes et les sons dans certains nouveaux jeux est terminé - seuls les niveaux restent. Travail facile et agr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Génération de niveau procédural</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418685/"><p><img src="https://habrastorage.org/webt/2m/0y/gv/2m0ygvmlc1izxgmo4chumrammxi.png"></p><br><p>  Le travail sur la programmation, les graphismes et les sons dans <em>certains nouveaux jeux est</em> terminé - seuls les niveaux restent.  Travail facile et agréable, mais pour une raison quelconque, il est très difficile.  Peut-être l'effet de la fatigue générale. </p><br><p>  Pensant à simplifier sa vie, l'idée de génération procédurale lui est venue à l'esprit.  Bien sûr, il faudra aussi l'écrire, mais comme il a été dit dans un ouvrage bien connu, "il vaut mieux perdre une journée, puis voler en cinq minutes". </p><br><p>  <strong>Attention!</strong>  <strong>Sous la coupe, beaucoup de texte et de gifs "gras".</strong> </p><a name="habracut"></a><br><h2 id="vvodnaya">  Introduction </h2><br><p>  Les niveaux seront toujours polis manuellement, il n'y a donc pas d'exigences particulières pour la mémoire, la vitesse ou même la qualité des niveaux résultants. </p><br><p>  Initialement, je prévoyais que le générateur ne lance que des pièces et des portes, et tout autre raffinement (intrigue, paysage et ennemis) sera effectué en mode manuel.  Mais pour l'instant, je pense que le générateur peut faire beaucoup plus.  Néanmoins, le réglage manuel restera - il est nécessaire que les joueurs sentent qu'au moins un peu d'amour est investi dans les niveaux. </p><br><p>  J'ai regardé ma base de connaissances sur le développement de jeux et j'ai rédigé des liens vers des articles sur la génération de procédures dans un document séparé.  La plupart, bien sûr, concernent la génération de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">labyrinthes classiques</a> ou la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">génération de terrain</a> (au fait, les résultats sont très impressionnants), ce qui ne convient pas à un tireur 3D.  Mais certains étaient proches de ce dont j'avais besoin (avec un astérisque j'ai noté ceux qui me semblaient les plus adaptés): </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.progamer.ru/dev/procedural-dungeon-generation.htm</a> (*) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://habr.com/post/333692/</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://www.gamasutra.com/blogs/GrahamDavis/20170130/290326/Procedural_Level_Generation_in_Unity_for_MERC_part_1_of_2.php</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://ijdykeman.github.io/ml/2017/10/12/wang-tile-procedural-generation.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://habr.com/post/332832/</a> (*) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://habr.com/post/184818/</a> (*) </li></ul><br><p>  J'ai décidé de commencer par les deux derniers - ils viennent d'être mis en œuvre et donnent de bons résultats. </p><br><h2 id="struktura-generatora">  Structure du générateur </h2><br><p>  En fait, je ne suis pas venu tout de suite dans cette structure, mais dans le processus de nombreuses refactoring et réécriture, mais j'écris tout de suite pour que ce soit clair: </p><br><ol><li>  Génération de la géométrie initiale (au choix - "BSP" ou disposition de la pièce). </li><li>  Effacement des sections d'ordures (ces sections qui ne peuvent pas exister dans le jeu). </li><li>  Établir des connexions. </li><li>  Effacement des sous-graphiques d'ordures (ces groupes de sections qui sont interconnectés, mais il n'y a pas de connexion avec les sections restantes). </li><li>  Suppression des connexions inutiles (construction d'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">arbre couvrant</a> , un lien est donné à l'arbre couvrant <strong>minimum</strong> , car il y a une image là, mais pour le générateur il n'y a pas besoin du minimum). </li><li>  La randomisation des connexions est la restauration de certaines connexions distantes (pour un type de niveau plus «humain»), ainsi que la transformation de certaines autres en passages entre sections (qui fusionne plusieurs sections en une seule forme plus complexe). </li><li>  Génération de chambre secrète. </li><li>  Génération d'un «scénario» (où seront les sections initiales et finales, et quel chemin devra être franchi pour passer de l'initiale à la finale). </li><li>  Optimisation de la connexion. </li><li>  Création de portes et fenêtres. </li><li>  Le choix de l'action à effectuer dans cette section (appuyez sur l'interrupteur, relevez la clé ou trouvez le mur secret). </li></ol><br><p>  Il y a encore quelque part environ 12 points, mais ils ne sont pas encore terminés (quand j'aurai fini, j'écrirai un article séparé à leur sujet). </p><br><h2 id="generaciya-iznachalnoy-geometrii-bsp">  Génération initiale de la géométrie: "BSP" </h2><br><p><img src="https://habrastorage.org/webt/zn/j4/_k/znj4_kemnzlvr4cfr45tqtzami8.gif"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cette traduction a</a> été prise comme base.  Je ne sais pas combien ce qui se passe dans cet algorithme est proche du vrai BSP, donc j'écris "BSP" entre guillemets. </p><br><p>  L'algorithme est assez simple.  Initialement, créez un rectangle de la taille de l'ensemble du terrain de jeu: </p><br><p><img src="https://habrastorage.org/webt/fh/mx/x-/fhmxx-boo4euwsc4dl2g0gfc2nk.png"></p><br><p>  Ensuite, nous le divisons au hasard en deux parties - horizontalement ou verticalement.  Où la ligne de séparation aura lieu, nous choisissons également au hasard: </p><br><p><img src="https://habrastorage.org/webt/ml/lo/jm/mllojmhd2qxiga7ma_skqxqoera.png"></p><br><p>  Nous faisons récursivement la même chose pour les nouveaux rectangles: </p><br><p><img src="https://habrastorage.org/webt/ew/sw/wf/ewswwfagu3jcskhcebem5sd-jo8.png"></p><br><p>  Et encore et encore, dans une certaine mesure: </p><br><p><img src="https://habrastorage.org/webt/fl/s-/hd/fls-hd2xm17ghbjbvnwpyhwzd_m.png"></p><br><p>  Ensuite, dans chaque rectangle, nous sélectionnons une «pièce» - un rectangle de la même taille que l'original ou plus petit (mais pas moins de 3x3 - plus sur celui ci-dessous). </p><br><p><img src="https://habrastorage.org/webt/r8/h1/_y/r8h1_yacj5bpuux_xmmxuwzdlo0.png"></p><br><p>  Ensuite, les chambres sont reliées par des couloirs.  Mais pas chacun, mais un peu délicat, car ils sont stockés dans une structure de type "BSP" (voir l'algorithme d'origine pour plus de détails). </p><br><p><img src="https://habrastorage.org/webt/5t/y6/3e/5ty63ewmz5eey4oaphja4uixjuu.png"><br>  <em>Le couloir reliant les sections violettes et blanches.</em> </p><br><p>  Dans l'algorithme d'origine, les pièces et les couloirs sont de la même couleur (c'est-à-dire qu'ils sont équivalents), donc les couloirs sont simplement dessinés au-dessus des pièces.  Dans mon cas, les pièces d'origine doivent être conservées, de sorte que les couloirs soient dessinés comme «derrière» les pièces. </p><br><p>  De plus, si la pièce (turquoise sur la figure) traverse le couloir, elle doit la diviser en deux sections différentes (par conséquent, le même couloir peut être dessiné de différentes couleurs): </p><br><p><img src="https://habrastorage.org/webt/5n/wr/51/5nwr510wdeg8x9iw3cgy_eorsau.png"></p><br><p>  Et voici le résultat: </p><br><p><img src="https://habrastorage.org/webt/q4/hq/7r/q4hq7rocs2amqbt-guzspzcmbp4.png"></p><br><p>  Commence alors la phase de marquage des poubelles: </p><br><p><img src="https://habrastorage.org/webt/f0/ob/sc/f0obscdf1tabhec9mxv4m-wrj5s.png"></p><br><p>  Comme je l'ai déjà écrit, aucun secteur ne peut être inférieur à 3x3 cellules.  Cela est dû au fait que le secteur doit être entouré de murs (au moins 1 cellule de chaque côté) et qu'il doit avoir au moins une cellule d'espace libre: </p><br><p><img src="https://habrastorage.org/webt/iy/e8/ne/iye8ne6qltvzxtwrpgrtjgmgeae.png"></p><br><p>  Par conséquent, toutes les cellules qui ne correspondent pas à cette règle sont étiquetées.  Mais prenez-le et vous ne pouvez pas les supprimer - tant de connexions disparaissent et le niveau est très limité. </p><br><p>  Au lieu de cela, pour chaque cellule étiquetée, le secteur auquel elle peut se joindre est recherché (en respectant la règle 3x3): </p><br><p><img src="https://habrastorage.org/webt/nc/6q/-y/nc6q-yh8jlkx_rhlilpamtzt27s.png"><br>  <em>Si la cellule ne peut toujours pas être attribuée à un secteur, elle sera supprimée (mais pas dans ce cas - tout va bien ici).</em> </p><br><p>  À la dernière étape, cette belle image est vectorisée, et les secteurs dessinés se transforment en poly-boîtes - de tels polygones dans lesquels chaque bord est soit strictement vertical soit strictement horizontal (il y a probablement un nom plus scientifique): </p><br><p><img src="https://habrastorage.org/webt/xx/8x/8v/xx8x8vpyawz-uricpycndaadgfy.png"></p><br><h2 id="generaciya-iznachalnoy-geometrii-planirovka-pomescheniy">  Génération initiale de la géométrie: disposition de la pièce </h2><br><p><img src="https://habrastorage.org/webt/7w/jh/nb/7wjhnbk6xzc6zmdaqyiufpq7t5m.gif"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un autre article a</a> été pris comme base.  Cet algorithme est un peu plus compliqué que le précédent, mais pas non plus la science des fusées. </p><br><p>  Tout d'abord, le terrain de jeu est rempli d'une certaine valeur d'arrêt, puis une zone rectangulaire est effacée au hasard dessus: </p><br><p><img src="https://habrastorage.org/webt/4n/24/py/4n24pyropjvmm0d8gsmzj9znte0.png"></p><br><p>  L'étape de nettoyage d'un rectangle aléatoire est effectuée un certain nombre de fois (également aléatoire), et en conséquence, les contours externes du niveau sont obtenus: </p><br><p><img src="https://habrastorage.org/webt/np/4v/fi/np4vfi_iumlrznv8bsy8ba3babk.png"></p><br><p>  Dans l'espace libre, les points de croissance des pièces sont dispersés de façon aléatoire (la taille minimale de la pièce est de 3x3): </p><br><p><img src="https://habrastorage.org/webt/2y/wm/3n/2ywm3n3lgak23tcn0dmyshbicne.png"></p><br><p>  La première étape de la croissance de la pièce commence - pour chaque pièce, le plus grand côté est sélectionné, qui peut encore grandir, et il croît de 1 cellule (s'il y a plusieurs côtés de la même longueur - un au hasard).  Les pièces sont déplacées à tour de rôle afin qu'il n'y ait pas d'intersections. </p><br><p><img src="https://habrastorage.org/webt/-b/4r/cd/-b4rcdczwe-_hu8xvha_cko1ihk.gif"></p><br><p>  Les pièces sont ensuite converties en polyboxes: </p><br><p><img src="https://habrastorage.org/webt/pd/j8/qo/pdj8qos36_hf4slo-jlm2eailsw.png"></p><br><p>  Et la deuxième étape de la croissance commence - à ce stade, le côté peut être divisé en plusieurs parties.  Contrairement à la première étape, il ne fait pas pousser une cellule à la fois, mais immédiatement à l'arrêt maximum - cela évite l '"échelle" au niveau des joints des pièces.  Si après le passage dans toutes les pièces il y a encore des cellules vides, le cycle se répète. </p><br><p>  Le résultat est un espace entièrement rempli: </p><br><p><img src="https://habrastorage.org/webt/mi/8j/zf/mi8jzfzhpksr2cz7jzd1_k3gmng.png"></p><br><p>  Ensuite, les polyboxes sont dessinées sous la forme d'un raster, et (comme dans le cas du générateur «BSP»), l'étape de marquage des cellules «ordures» commence: </p><br><p><img src="https://habrastorage.org/webt/ev/na/ru/evnaruhyjwsei7hfbywiiuxyzq4.png"></p><br><p>  Et en les associant aux secteurs existants: </p><br><p><img src="https://habrastorage.org/webt/1h/yv/kf/1hyvkfcnerw5yu30txvbztecfzw.png"><br>  <em>Ici, il n'a pas été possible de fixer toutes les cellules - les cellules supplémentaires ont été supprimées.</em> </p><br><p>  Le résultat est reconverti en polybox: </p><br><p><img src="https://habrastorage.org/webt/ji/l3/yq/jil3yqqnbqpf4cfjyx-sklb_g8w.png"></p><br><h2 id="ochistka-ot-musornyhsekciy">  Nettoyage des sections de déchets </h2><br><p>  Parfois, des sections apparaissent à l'intérieur desquelles la règle 3x3 n'est pas respectée: </p><br><p><img src="https://habrastorage.org/webt/6v/zx/2v/6vzx2vnhvhn_kkxvqp1jyzenh6g.png"></p><br><p>  Vous pouvez essayer de "restaurer" de telles sections, mais je suis allé de la manière la plus simple et je les ai simplement supprimées: </p><br><p><img src="https://habrastorage.org/webt/gc/5s/4y/gc5s4yzeywvc6pi1kh0apfk90pm.png"></p><br><h2 id="postroenie-soedineniy">  Établir des connexions </h2><br><p><img src="https://habrastorage.org/webt/af/3m/w2/af3mw25mgkjtqwskriypbpzzaeo.gif"></p><br><p>  Pour chaque section, ses voisins sont recherchés et dans les lieux de contact de ces sections, des connexions sont créées.  Des connexions sont créées des deux côtés - si la section A est en contact avec la section B, alors il y aura une connexion de A à B et de B à A. Le résultat est un graphique bidirectionnel. </p><br><h2 id="ochistka-ot-musornyh-podgrafov">  Effacement des sous-graphiques d'ordures </h2><br><p>  Parfois, à la suite du nettoyage des sections d'ordures, nous obtenons non pas un graphique, mais plusieurs graphiques indépendants, comme dans cet exemple: </p><br><p><img src="https://habrastorage.org/webt/yi/s5/5u/yis55urvft0bohq8x0dsurgyyam.png"></p><br><p>  Dans ce cas, le sous-graphique est sélectionné comme principal, la "zone" des sections est maximale et le reste est supprimé (la "zone" est entre guillemets, car bien qu'il soit possible de calculer la zone réelle de la zone poly, j'ai simplifié la tâche et je considère la zone de la zone de délimitation - c'est faux, mais adapté à un générateur). </p><br><h2 id="ochistka-ot-izlishnih-soedineniy">  Éliminer les composés en excès </h2><br><p>  S'il y a un passage de chaque secteur à chacun avec lequel il est connecté, alors il y aura trop de portes au niveau, et on sentira plus fortement qu'il est généré.  Par conséquent, à ce stade, les connexions en excès sont supprimées: </p><br><p><img src="https://habrastorage.org/webt/oa/sh/oy/oashoyuavho98281lo_s4hpc-ks.gif"></p><br><p>  Pour plus de randomisation, je ne génère pas d'arbre couvrant dans le nombre minimum de passes, mais plutôt, je supprime un bord aléatoire à la fois (en le choisissant au hasard parmi tous les possibles à l'étape en cours). </p><br><p>  <em>Bien que, lorsque j'écris ceci, l'idée est apparue qu'il serait assez aléatoire de sélectionner le secteur initial et de supprimer les bords déjà plus efficaces.</em> </p><br><h2 id="randomizaciya-soedineniy">  Randomisation de connexion </h2><br><p><img src="https://habrastorage.org/webt/ok/zl/vk/okzlvk4rclc7x3imkpjnjza3kje.gif"><br>  <em>Ci-après, les illustrations proviendront d'une autre génération, car</em>  <em>dans le précédent, il y avait une erreur dans le générateur, à cause de laquelle les autres images étaient incorrectes.</em> </p><br><p>  Mais un niveau dans lequel il n'y a pas une seule connexion superflue ne semble pas non plus très humain, donc un peu de chaos est introduit: </p><br><ol><li>  Certains bords supprimés sont restaurés. </li><li>  Et certains se transforment en allées. </li></ol><br><p>  De plus, les sections entre lesquelles les passages ont été formés fusionnent en une seule: </p><br><p><img src="https://habrastorage.org/webt/nh/j_/uj/nhj_ujd0n7sqjdnddlvs9uozq5u.gif"><br>  <em>S'il vous a semblé que dans cette illustration, les connexions supprimées à l'étape précédente sont réapparues - il vous semble :).</em>  <em>Quand j'ai lu le texte, cela m'a semblé aussi, mais après avoir soigneusement regardé l'illustration précédente, il devient clair que tout va bien.</em> </p><br><h2 id="generaciya-sekretnyh-komnat">  Génération de chambre secrète </h2><br><p>  Les secteurs qui n'ont qu'une seule connexion sont sélectionnés sur le graphique: </p><br><p><img src="https://habrastorage.org/webt/xt/ku/qw/xtkuqweqgctwcbcckilick4-es4.png"></p><br><p>  S'il existe plusieurs secteurs de ce type, ils se regroupent tous dans un tableau et sont triés par "zone".  Ensuite, ce tableau est tronqué de manière aléatoire (mais de sorte qu'au moins un élément y reste).  Ces secteurs deviendront des salles secrètes: </p><br><p><img src="https://habrastorage.org/webt/pf/w0/yu/pfw0yufvv3orwiw_xohtfii8gqi.png"></p><br><h2 id="generaciya-scenariya">  Génération de script </h2><br><p><img src="https://habrastorage.org/webt/p2/ql/dn/p2qldn0n-scgjotykszlvsvd05a.gif"></p><br><p>  Tout d'abord, les secteurs avec le nombre minimum de connexions libres (c'est-à-dire ceux les plus proches du "bord" du graphique) sont sélectionnés: </p><br><p><img src="https://habrastorage.org/webt/lc/iw/7v/lciw7vahyrhoirla-hyahd7jzhu.png"><br>  <em>Dans cette illustration, un secteur est sélectionné, mais s'il y en avait plus, de toute façon, un serait sélectionné (au hasard).</em> </p><br><p>  <em>NB.</em>  <em>Au cours de la relecture de l'article, j'ai pu trouver une situation où un secteur avec un nombre minimum de connexions libres ne sera pas seulement à la limite, mais lui assigner un script conduira à un niveau infranchissable.</em>  <em>En fait, vous pouvez choisir n'importe quel secteur, mais un seul, après quoi le graphique ne tomberait pas dans plusieurs sous-graphiques.</em> </p><br><p>  Ensuite, sélectionnez les secteurs qui sont connectés au secteur actuel et qui n'ont qu'une seule connexion gratuite.  Ils, avec une certaine probabilité, seront utilisés pour continuer le script.  Par exemple, si le graphique était le même que dans l'illustration ci-dessous, alors le secteur indiqué par la question pourrait être inclus dans la liste. </p><br><p><img src="https://habrastorage.org/webt/6u/b6/vf/6ub6vfbxncsmbug4optzec19gyw.png"><br>  <em>La salle secrète est marquée en gris, les croix sont les connexions qui auraient dû être supprimées dans le graphique d'origine et le secteur source est un plus.</em> </p><br><p>  <em>NB.</em>  <em>Lors de la relecture de l'article, il m'a semblé que la condition de présence d'une seule connexion était trop stricte, la même que dans l'étape précédente suffirait - pour qu'après suppression de ce secteur, le graphique ne se décompose pas.</em> </p><br><p>  Ensuite, le numéro de script est attribué à cette liste de secteurs (juste un numéro, à ce stade, cela ne signifie rien de spécifique), et les connexions aux frontières de cette liste de secteurs sont marquées comme fermées par ce script. </p><br><p><img src="https://habrastorage.org/webt/tw/4w/3w/tw4w3wxhybxndd5_94mw-l0e1zc.png"><br>  <em>Dans ces illustrations, différents scénarios auront des couleurs de remplissage de secteur différentes.</em>  <em>Ils n'ont rien à voir avec la couleur de la frontière du secteur (dans les prochaines étapes cela sera corrigé, mais dans cette étape c'est plus pratique pour moi).</em> </p><br><p>  Ensuite, le secteur suivant est sélectionné, une liste est compilée et cette liste est marquée avec un nouveau scénario: </p><br><p><img src="https://habrastorage.org/webt/qo/01/qw/qo01qww9cg-s2km6vfrjvoqb_vk.png"></p><br><p>  Faites attention aux petits points bleus à l'intérieur des carrés rouges - c'est ainsi que l'ouvreur de scénario est dessiné - c'est-à-dire  quelque part dans la section avec le script rouge, il y aura une clé ou un interrupteur qui ouvrira le passage aux secteurs avec un script bleu. </p><br><p>  Cela continue jusqu'à ce qu'il ne reste plus de secteurs libres: </p><br><p><img src="https://habrastorage.org/webt/5f/ok/yn/5fokynxff0gfpspu7-d8paaw7wi.png"></p><br><p>  Le secteur le plus récent ne se voit pas attribuer de script, mais uniquement un ouvre-scénario.  Ce secteur sera le secteur dans lequel le joueur commence la partie. </p><br><p>  Pour ce niveau: </p><br><ul><li>  Le joueur commence dans le secteur de départ, quelque part là où il trouve un «décapsuleur» pour le secteur jaune, y va. </li><li>  Dans le secteur jaune, ouvre le secteur bleu, y va. </li><li>  Dans le secteur bleu s'ouvre vert, va là-bas. </li><li>  Dans le secteur vert s'ouvre le violet, y va. </li><li>  En violet s'ouvre le rouge. </li><li>  En rouge - bleu. </li><li>  Où il trouve l'interrupteur de niveau final. </li></ul><br><p>  Schématiquement, cela peut être montré comme suit: </p><br><p><img src="https://habrastorage.org/webt/c7/6o/xd/c76oxdwcgff53io6pv3sfcptpuu.png"></p><br><p>  Un «ouvre-porte» peut être soit une clé, soit un interrupteur, ou autre chose, par exemple, une tâche pour détruire tous les ennemis dans n'importe quel secteur (mais je ne prévois pas que dans un avenir proche le générateur ou le moteur le supportera). </p><br><h2 id="optimizaciya-soedineniy">  Optimisation de la connexion </h2><br><p><img src="https://habrastorage.org/webt/5q/vl/gw/5qvlgwjtnablead4upxcwph7m6k.gif"></p><br><p>  À cette étape, pour chaque connexion, un côté est sélectionné (comme vous vous en souvenez, les connexions sont initialement générées dans les deux sens).  Cela est nécessaire pour rendre le niveau plus «manuel» et pour simplifier les étapes suivantes <em>(mais pour un type de niveau encore plus intéressant, je prévois dans un avenir proche de «désoptimiser» certaines connexions)</em> . </p><br><h2 id="sozdanie-dverey-iokon">  Création de portes et fenêtres </h2><br><p><img src="https://habrastorage.org/webt/xr/je/m5/xrjem5kqzr7ncka2vuf8nsukw2c.gif"></p><br><p>  Pour chaque secteur, toutes ses connexions sont visualisées (qui après l'étape précédente ne regardent que dans une seule direction), et des portes et fenêtres sont placées sur chaque connexion visualisée. </p><br><ul><li>  Tout d'abord, un point est sélectionné à la jonction, de préférence plus près du centre. </li><li>  Ensuite, à ce stade, une porte ou une fenêtre est placée (et s'il s'agit d'une connexion à une pièce secrète, alors un mur secret). </li><li>  Si une porte est placée, elle peut avoir de 1 à 3 cellules (une est une porte ordinaire, deux ou trois sont une porte hermétique épaisse, qui s'ouvre après avoir appuyé sur un interrupteur). </li><li>  De plus, la connexion est divisée en deux parties: la partie avant le point sélectionné et la partie après.  Et, s'il reste de l'espace avant ou après, la fonction est appelée récursivement. </li></ul><br><p>  Pour rendre le niveau plus intéressant, à différentes étapes, il existe une probabilité différente de placer une porte ou une fenêtre: </p><br><ol><li>  À la première étape, la porte est toujours placée, car  à quoi sert de se connecter s'il n'y a que des fenêtres. </li><li>  À la deuxième étape, avec <strong>une</strong> probabilité plus élevée (75%), une fenêtre est placée qu'une porte. </li><li>  S'il y a une troisième étape (par exemple, la connexion est longue), une fenêtre doit être placée dessus. </li><li>  Dans le cas de la 4ème étape, la porte ou la fenêtre est placée de manière similaire. </li><li>  Si la connexion est extra longue, le générateur revient à la deuxième étape. </li></ol><br><h2 id="vybor-deystviya">  Sélection d'actions </h2><br><p>  Bien que cela ne soit pas lié à la génération, la visualisation change à cette étape - maintenant la bordure du secteur est peinte dans la couleur du script: </p><br><p><img src="https://habrastorage.org/webt/rc/6y/xv/rc6yxvsq6duv-xdujaamzq0fdry.png"><br>  <em>Le secteur de départ est gris clair, le secteur final est bleu.</em>  <em>Notez également qu'au lieu de la porte de la salle secrète (gris foncé à gauche) un mur est dessiné - tout est correct, c'est un mur secret.</em> </p><br><p>  Sélectionnez ensuite les secteurs dans lesquels vous pouvez placer les clés: </p><br><p><img src="https://habrastorage.org/webt/kl/os/jz/klosjzmyvv_tl2djbz5v6b9sqze.png"></p><br><p>  Ils sont sélectionnés tout simplement: </p><br><ul><li>  S'il s'agit d'une pièce secrète, il ne peut y avoir aucun "ouvre-porte" et la clé ne peut pas y être placée. </li><li>  Vous ne pouvez pas non plus placer la clé dans le secteur final, car elle est définitive. </li><li>  De plus, la clé ne peut pas ouvrir les portes doubles et triples - en raison des caractéristiques du moteur, elles ne peuvent être ouvertes qu'à l'aide de l'interrupteur <em>(il n'y a pas de tels secteurs dans l'illustration ci-dessus)</em> . </li></ul><br><p>  Après cela, le nombre de clés à un niveau (de zéro à trois) est sélectionné au hasard, puis, au hasard, dans la liste des secteurs disponibles, ceux dans lesquels il y aura des clés sont sélectionnés. </p><br><p>  Dans les autres secteurs, il y aura des commutateurs. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr418685/">https://habr.com/ru/post/fr418685/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr418675/index.html">Comment je suis allé à Droidcon Berlin</a></li>
<li><a href="../fr418677/index.html">Toute la vérité sur RTOS. Article # 6. Autres services RTOS</a></li>
<li><a href="../fr418679/index.html">Nous écrivons un composant avec des boutons «matériel» pour Svelte</a></li>
<li><a href="../fr418681/index.html">Journée de l'amitié - 50% de réduction sur tous les IDE JetBrains pour nos amis</a></li>
<li><a href="../fr418683/index.html">Création d'une machine d'arcade d'émulation. 2e partie</a></li>
<li><a href="../fr418687/index.html">Révolution 3,5 ": détails d'un petit boom de disquettes avec vapeurs</a></li>
<li><a href="../fr418689/index.html">Comment créer des bibliothèques de composants dans Figma, économiser un budget, en utilisant l'exemple d'une vente aux enchères en ligne</a></li>
<li><a href="../fr418691/index.html">Rancher: Kubernetes en 5 minutes sur du métal nu</a></li>
<li><a href="../fr418693/index.html">Pourquoi le bonheur est-il si difficile à détecter dans le cerveau</a></li>
<li><a href="../fr418695/index.html">Anti-Piracy Wars - L'Empire contre-attaque</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>