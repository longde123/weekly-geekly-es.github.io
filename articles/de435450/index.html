<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåÑ üëäüèª ü§± Frohes Neues Jahr, Frohes Neues MQTT / UDP üå´Ô∏è üö• üöµüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo. 

 Wie ich k√ºrzlich schrieb ( erster kurzer Artikel √ºber MQTT / UDP ), ist MQTT / UDP ein Protokoll, das auf MQTT basiert, aber: 



- Geht √ºbe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Frohes Neues Jahr, Frohes Neues MQTT / UDP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435450/">  Hallo. <br><br>  Wie ich k√ºrzlich schrieb ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">erster kurzer Artikel √ºber MQTT / UDP</a> ), ist MQTT / UDP ein Protokoll, das auf MQTT basiert, aber: <br><br><ul><li>  Geht √ºber UDP-Broadcast hinaus (kein Broker erforderlich, fast keine Konfiguration erforderlich) </li><li>  Die Implementierung ist relativ einfach (10 Zeilen auf dem C + UDP / IP-Stapel - und Sie senden Daten vom Sensor). </li><li>  Jeder h√∂rt jeden </li></ul><br>  In gewisser Weise ist dies CAN, aber zus√§tzlich zu Ethernet. <br><br>  Warum. <br><a name="habracut"></a><br>  Meine Wohnung lebt tats√§chlich seit mehreren Jahren unter der Kontrolle eines Systems wie "Das Haus ist nicht vollst√§ndig oligophren".  Es w√§re √ºberfl√ºssig, es Intelligenz zu nennen, aber das Licht und das Klima sind automatisiert.  Um sich das Ausma√ü der Katastrophe vorzustellen - das System belegt ein volles, √ºberf√ºlltes Rack mit einer Breite von etwa 19 Zoll und einer H√∂he von zwei Metern.  Zwei W√§nde des Racks sind fast bis zum Boden besetzt. <br><br>  Als ich das alles entwarf, stand das Problem der Fehlertoleranz an erster Stelle.  Mehrere Jahre Betrieb haben gezeigt: Es ist wahr.  Verweigert alles.  Fr√ºher oder sp√§ter.  Elektromechanische Relais sind jedoch noch nicht ausgefallen, und es ist die letzte Stufe des Schutzes vor Ausf√§llen. <br><br>  Das n√§chste Problem nach der Fehlertoleranz ist der Zoo.  Aufgrund des nat√ºrlichen Lebensverlaufs, meiner Neugier und meiner dringenden Bed√ºrfnisse lebt das √ºbliche Unix auf einem normalen PC, Aries PLC, Raspberr + Orange PI, Atmega-Module, NodeMCU-basierte Module (ESP8266) im System und all dies geht √ºber Modbus miteinander 485, Modbus TCP, http und an der Seite h√§ngt ein unruhiger MQTT-Broker, als Erbe eines erfolglosen Versuchs, mit einem ganzen Lager dorthin zu wechseln. <br><br>  Warum der Versuch, zu MQTT zu wechseln, nicht erfolgreich ist.  Erstens ist ein Teil des Eisens schwer oder kompliziert.  Auf dem Fragment von Pascal, das sich in der CodeSys-SPS versteckt, kann nur ein Masochist MQTT schreiben.  Aber dann m√ºssen Sie debuggen.  √Ñhnlich bei atmega: man kann stopfen, aber eng.  Aber das ist nicht das ganze Problem. <br><br>  MQTT, wie es ist (und √ºberall akzeptabel ist 3.1.1), besteht darauf, ein PUBLISH-Paket (dh unsere Nachricht an den Broker) an alle Empf√§nger, einschlie√ülich des Absenders, zu senden.  Der Effekt dieses Wahnsinns ist bezaubernd - dasselbe OpenHAB kann keine Daten in MQTT unter demselben Namen senden und empfangen.  Dies bedeutet, dass es unm√∂glich ist, einen Bus basierend auf MQTT zu organisieren (mehrere Module, die den Wert desselben Objekts aktualisieren und verwenden).  Und genau so sollte die SPS-Kommunikation organisiert sein, in der die Hauptlichtsteuerung lebt, OpenHAB, die das Licht von der Weboberfl√§che und der mobilen Anwendung steuert, und intelligente Schalter, die ich hier und hier hinzuf√ºgen m√∂chte.  Das hei√üt, dieses Problem kann nat√ºrlich umgangen werden, aber tats√§chlich bedeutet es, ein eigenes Protokoll SURFACE MQTT zu erstellen, und dies scheint bereits zu viel zu sein. <br><br>  Was brauche ich gleichzeitig?  Senden Sie eine Aktualisierung des Parameterwerts und holen Sie ihn an allen interessierten Stellen ab.  F√ºr was in der Tat haben Gro√üv√§ter UDP an der Rundfunkadresse gemacht. <br><br>  Nach dem letzten Beitrag √ºber Habr√© warf mir einer der Leser lange Zeit die Unzuverl√§ssigkeit des UDP-Protokolls vor.  Ich antwortete ihm spekulativ, dass UDP f√ºr IoT zuverl√§ssiger ist als TCP: Bei einem Paketverlust von 50% in einem Netzwerk legt sich TCP nicht nur hin, sondern im Allgemeinen, und der Temperatursensor, der Messungen √ºber UDP sendet, verliert einfach die H√§lfte der Anzahl, was sich auswirkt den Betrieb des Systems in irgendeiner Weise.  Im Allgemeinen. <br><br>  Aber es war spekulativ.  Die Neujahrsfeiertage wurden jedoch auch einer Person gegeben, um das Trinken von Champagner zu beenden und sich zu fragen: Werden wir heute unser Heim-LAN auf Schaufeln stellen?  Und egal was. <br><br>  Ich nahm MQTT / UDP und schrieb einen primitiven Test.  Eine Seite sendet so oft wie m√∂glich aufeinanderfolgende Pakete ohne Pause zwischen den Paketen.  Die zweite ber√ºcksichtigt Geschwindigkeit und Paketverlust.  Das Experiment war einfach: Wir starten diesen Spott und parallel zeigen zwei HD-Fernseher Filme aus dem Internet, und der Desktop-Computer schreibt eine riesige Datei auf den NAS. <br><br>  Bewerten Sie das Ergebnis.  Ich habe auf alles gewartet, aber ... der maximale Verlust f√ºr UDP erreichte ein halbes Prozent, und beide Fernseher h√∂rten auf zu zeigen.  Ich war also immer noch ein Pessimist.  In einem echten Heimnetzwerk ist die Zuverl√§ssigkeit der UDP-Bereitstellung nahezu absolut.  Trotzdem werde ich wahrscheinlich eine Version mit Best√§tigungen erstellen und Pakete erneut senden.  Es gibt nur wenige Schwierigkeiten, aber die Frage ist vollst√§ndig beseitigt. <br><br>  Die zweite Frage ist die Sicherheit, aber richtig, wenn sie in mein Heimnetzwerk eindringen, ist der Datenverlust von Temperatursensoren das Letzte, wor√ºber ich mich Sorgen machen werde.  Wiederum ist die Aufgabe des digitalen Signierens von Paketen im Issue-Tracker vorhanden, und ich verstehe bereits, wie MQTT-Pakete f√ºr die Implementierung erweitert werden k√∂nnen. <br><br>  Im Allgemeinen plane ich, dass das erste Ger√§tepaar im Heimnetzwerk erst neulich zu MQTT / UDP wechselt. <br><br>  Und ich schlage vor, Sie versuchen es in Ihren Programmen und Ger√§ten: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Repository</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation in Englisch</a> . <br><br>  Was ist verf√ºgbar: <br><br>  Ziemlich vollst√§ndige Implementierungen in Java, Python und C.  Grundlegende Implementierung auf Lua.  Bisher nur f√ºr Arduino und CodeSys PLC senden (getestet und funktioniert auf Aries, aber es sollte alles tun). <br><br>  GUI-Tool, um zu sehen, was passiert und einzugreifen: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f04/333/9c9/f043339c94a34a24a3887043f095baae.png" alt="Bild"><br><br>  Programme zum Senden und Empfangen von Daten in Python, Lua und Java. <br><br>  Python-Konnektoren zur Integration in regul√§res MQTT und direkt in OpenHAB.  Sie erarbeiten einen Schutz gegen Zyklen und verbieten die R√ºck√ºbertragung der Nachricht f√ºr 5 Sekunden, nachdem sie in Vorw√§rtsrichtung weitergeleitet wurden.  Dar√ºber hinaus gibt es eine Bibliothek, um den Fluss wiederholter Daten zu begrenzen.  Sie pr√ºft, ob dieses Thema f√ºr die angegebene Zeit bereits aktualisiert wurde, und √ºberspringt das neue Update nur, wenn sich die Daten ge√§ndert haben. <br><br>  Ich habe vor, schrittweise vollst√§ndig auf dieses Protokoll umzusteigen, und hier ist ein Beispiel daf√ºr, was ich mit Sensoren erreichen m√∂chte: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3dc/6ed/528/3dc6ed528bb36067f12038fad62857c7.png"><br><br>  In einem Raum befinden sich drei Sensoren (oder auf der Stra√üe spielt das keine Rolle).  Sie senden Proben √ºber MQTT / UDP.  Diese Messwerte werden gleichzeitig vom Haupt-Smart-Home-System (OpenHAB), einer historischen Datenbank und einem Wandmonitor empfangen, der die Temperatur f√ºr die Bewohner anzeigt. <br><br>  Der ganze Reiz von MQTT / UDP besteht darin, dass in einem solchen Schema der Ausfall eines Blocks keine Probleme f√ºr alle anderen verursacht.  Und das mit der bezaubernden Einfachheit des Protokolls. <br><br>  Dar√ºber hinaus k√∂nnen redundante Steuerschemata mit Duplizierung leicht in demselben Schema implementiert werden.  Der Datenbankserver kann problemlos dupliziert werden.  Es wird schwieriger sein, die Module zu duplizieren, die sich mit der Verwaltung befassen.  Wenn Sie beispielsweise auf die Temperatur h√∂ren, werden die Heizk√∂rper gesteuert.  Aber wahrscheinlich ist dies die n√§chste Geschichte.  Heute m√∂chte ich mich darauf konzentrieren, Signale von Sensoren zu sammeln und zwischen den Modulen eines Smart Homes auszutauschen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de435450/">https://habr.com/ru/post/de435450/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de435438/index.html">PHP: √Ñnderung der Datenbankstruktur in der Teamentwicklung</a></li>
<li><a href="../de435442/index.html">Trichter der Ver√§nderung</a></li>
<li><a href="../de435444/index.html">Wir implementieren OSGI auf der Karaf-Plattform</a></li>
<li><a href="../de435446/index.html">Verhuff-Algorithmus f√ºr ein beliebiges System mit geraden Zahlen</a></li>
<li><a href="../de435448/index.html">√úber die Erfahrung der Kommunikation mit einem Signalgenerator √ºber QTcpSocket und SCPI</a></li>
<li><a href="../de435452/index.html">End-to-End-Tests von Microservices mit Catcher</a></li>
<li><a href="../de435454/index.html">AOP vs Funktionen</a></li>
<li><a href="../de435456/index.html">Ist es sch√§dlich, nachts ein Smartphone neben sich zu lassen?</a></li>
<li><a href="../de435460/index.html">Coworkidea Coworking Fototour (Barcelona)</a></li>
<li><a href="../de435462/index.html">Testen von Node.js-Projekten. Teil 1. Testanatomie und Testtypen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>