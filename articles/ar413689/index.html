<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐พ โ๏ธ Debian + Postfix + Dovecot + Multidomain + SSL + IPv6 + OpenVPN + Multi-interfaces + SpamAssassin-learn + Bind ๐ธ ๐ฅ โ๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุชุชูุงูู ูุฐู ุงูููุงูุฉ ููููุฉ ุฅุนุฏุงุฏ ุฎุงุฏู ุจุฑูุฏ ุญุฏูุซ. 
 Postfix + Dovecot. SPF + DKIM + rDNS. ูุน IPv6. 
 ูุน ุชุดููุฑ TLS. ูุน ุฏุนู ูุทุงูุงุช ูุชุนุฏุฏุฉ - ุฌุฒุก ูุน ุดูุงุฏุฉ SS...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Debian + Postfix + Dovecot + Multidomain + SSL + IPv6 + OpenVPN + Multi-interfaces + SpamAssassin-learn + Bind</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413689/" style=";text-align:right;direction:rtl">  ุชุชูุงูู ูุฐู ุงูููุงูุฉ ููููุฉ ุฅุนุฏุงุฏ ุฎุงุฏู ุจุฑูุฏ ุญุฏูุซ. <br>  Postfix + Dovecot.  SPF + DKIM + rDNS.  ูุน IPv6. <br>  ูุน ุชุดููุฑ TLS.  ูุน ุฏุนู ูุทุงูุงุช ูุชุนุฏุฏุฉ - ุฌุฒุก ูุน ุดูุงุฏุฉ SSL ุญููููุฉ. <br>  ูุน ุงูุญูุงูุฉ ุถุฏ ุงูุจุฑูุฏ ุงูุนุดูุงุฆู ูุงูุชุตููู ุงูุนุงูู ูููุงูุญุฉ ุงูุจุฑูุฏ ุงูุนุดูุงุฆู ุนูู ุฎูุงุฏู ุงูุจุฑูุฏ ุงูุฃุฎุฑู. <br>  ูุน ุฏุนู ูุงุฌูุงุช ูุงุฏูุฉ ูุชุนุฏุฏุฉ. <br>  ูุน OpenVPN ุ ุงูุฐู ูุชุตู ูู ุฎูุงู IPv4 ุ ูุงูุฐู ูุนุทู IPv6. <br><br>  ุฅุฐุง ููุช ูุง ุชุฑุบุจ ูู ุชุนูู ูู ูุฐู ุงูุชูููุงุช ุ ููููู ุชุฑูุฏ ุชูููู ูุซู ูุฐุง ุงูุฎุงุฏู ุ ูุฅู ูุฐู ุงูููุงูุฉ ููุงุณุจุฉ ูู. <br><br>  ูุง ุชูุฌุฏ ูุญุงููุงุช ูุดุฑุญ ูู ุงูุชูุงุตูู ูู ุงูููุงูุฉ.  ูุฐูุจ ุงูุชูุณูุฑ ุฅูู ูุง ูู ูุชู ุชููููู ุจุดูู ููุงุณู ุฃู ููู ูู ูุฌูุฉ ูุธุฑ ุงููุณุชููู. <br><a name="habracut"></a><br>  ุญููู ุงููุฏูู ูู ุฅูุดุงุก ุฎุงุฏู ุจุฑูุฏ.  ูุฏ ูุจุฏู ุงูุฃูุฑ ุณุฎูููุง ุ ููู IMHO ุ ุฃูุถู ุจูุซูุฑ ูู ุงูุญูู ุจุณูุงุฑุฉ ุฌุฏูุฏุฉ ูุนูุงูุชู ุงูุชุฌุงุฑูุฉ ุงูููุถูุฉ. <br><br>  ุงูุฏุงูุน ูุชูููู IPv6 ูู ุงุซูุงู.  ูุญุชุงุฌ ูุชุฎุตุตู ุชูููููุฌูุง ุงููุนูููุงุช ุฅูู ุชุนูู ุงูุชูููุงุช ุงูุฌุฏูุฏุฉ ุจุงุณุชูุฑุงุฑ ูู ุฃุฌู ุงูุจูุงุก.  ุฃูุฏ ุฃู ุฃูุฏู ูุณุงููุชู ุงููุชูุงุถุนุฉ ูู ููุงูุญุฉ ุงูุฑูุงุจุฉ. <br><br>  ุงูุฏุงูุน ูุฅุนุฏุงุฏ OpenVPN ูู ููุท ูู IPv6 ููุนูู ุนูู ุงูุฌูุงุฒ ุงููุญูู. <br>  ุงูุฏุงูุน ูุฅุนุฏุงุฏ ุงูุนุฏูุฏ ูู ุงููุงุฌูุงุช ุงููุงุฏูุฉ ูู ุฃู ูุงุฌูุฉ ูุงุญุฏุฉ ุนูู ุงูุฎุงุฏู ุงูุฎุงุต ุจู "ุจุทูุฆุฉ ูููููุง ุบูุฑ ูุญุฏูุฏุฉ" ูุงูุฃุฎุฑู "ุณุฑูุนุฉ ุ ูููู ูุน ุชุนุฑููุฉ". <br><br>  ุงูุฏุงูุน ูุฅุนุฏุงุฏ ุฅุนุฏุงุฏุงุช Bind ูู ุฃู ูุฒูุฏ ุงูุฎุฏูุฉ ุงูุฎุงุต ุจู ูููุฑ ุฎุงุฏู DNS ุบูุฑ ูุณุชูุฑ ุ ูุชุนุทู Google ุฃูุถูุง.  ุฃุฑูุฏ ุฎุงุฏู DNS ูุณุชูุฑ ููุงุณุชุฎุฏุงู ุงูุดุฎุตู. <br><br>  ุงูุฏุงูุน ููุชุงุจุฉ ููุงู - ุชูุช ูุชุงุจุฉ ูุณูุฏุฉ ูุจู 10 ุฃุดูุฑ ุ ููุฏ ูุธุฑุช ูููุง ุจุงููุนู ูุฑุชูู.  ุฅุฐุง ูุงู ุงููุคูู ูุญุชุงุฌ ุฅูู ุฐูู ุจุงูุชุธุงู ุ ูููุงู ุงุญุชูุงู ูุจูุฑ ุจุฃู ุงูุขุฎุฑูู ุณูุญุชุงุฌูู ุฅููู. <br><br>  ูุง ููุฌุฏ ุญู ุนุงููู ูุฎุงุฏู ุงูุจุฑูุฏ.  ูููู ุณุฃุญุงูู ุฃู ุฃูุชุจ ุดูุฆูุง ูุซู "ุงูุนููุง ุนูู ูุฐุง ุงููุญู ุ ูุจุนุฏ ุฐูู ุ ุนูุฏูุง ูุนูู ูู ุดูุก ููุง ููุจุบู - ุงูุชุฎูุต ูู ุงููุงุฆุถ". <br><br>  ููุงู ุฎุงุฏู ููููู ูู tech.ru.  ูู ุงููููู ุงูููุงุฑูุฉ ูุน OVH ู Hetzner ู AWS.  ูุญู ูุฐู ุงููุดููุฉ ุ ุณูููู ุงูุชุนุงูู ูุน tech.ru ุฃูุซุฑ ูุนุงููุฉ. <br><br>  ุฏุจูุงู 9 ูุซุจุช ุนูู ุงูุฎุงุฏู. <br><br>  ููุฌุฏ ุนูู ุงูุฎุงุฏู ูุงุฌูุชุงู `eno1` ู` eno2`.  ุงูุฃูู ุบูุฑ ูุญุฏูุฏ ุ ูุงูุซุงูู ุณุฑูุน ุ ุนูู ุงูุชูุงูู. <br><br>  ููุงู 3 ุนูุงููู IP ุซุงุจุชุฉ ุ XX.XX.XX.X0 ู XX.XX.XX.X1 ู XX.XX.XX.X2 ุนูู ุงููุงุฌูุฉ `eno1` ู XX.XX.XX.X5 ุนูู ุงููุงุฌูุฉ` eno2`. <br><br>  ููุฌุฏ XXXX: XXXX: XXXX: XXXX :: XXXX: / 64 ูุฌููุนุฉ ูู ุนูุงููู IPv6 ุงูุชู ุชู ุชุฎุตูุตูุง ูููุงุฌูุฉ `eno1` ูููู XXXX: XXXX: XXXX: XXXX: XXXX: 1: 2 :: / 96 ุ ุจูุงุกู ุนูู ุทูุจู ุ ุชู ุชุนููููุง ูู` eno2`. <br><br>  ููุงู 3 ูุทุงูุงุช `domain1.com` ุ` domain2.com` ุ `domain3.com`.  ุจุงููุณุจุฉ ูู `domain1.com` ู` domain3.com` ุ ุชูุฌุฏ ุดูุงุฏุฉ SSL. <br><br>  ููุงู ุญุณุงุจ ุฌูุฌู ุชุฑูุฏ ุฑุจุท ุตูุฏูู ุงูุจุฑูุฏ `vasya.pupkin @ domain1.com` (ุชููู ุงูุจุฑูุฏ ูุฅุฑุณุงู ุงูุจุฑูุฏ ูุจุงุดุฑุฉ ูู ูุงุฌูุฉ gmail). <br>  ูุฌุจ ุฃู ูููู ููุงู ุตูุฏูู ุจุฑูุฏ `support @ domain2.com` ุ ูุณุฎุฉ ูู ุงูุจุฑูุฏ ุงูุฐู ุฃุฑูุฏ ุฑุคูุชู ูู ุฎูุงู gmail ุงูุฎุงุต ุจู.  ููุงุฏุฑุง ูุง ูููู ูู ุงููููู ุฅุฑุณุงู ุดูุก ููุงุจุฉ ุนู `support @ domain2.com` ูู ุฎูุงู ูุงุฌูุฉ ุงูููุจ. <br><br>  ูุฌุจ ุฃู ูููู ููุงู ุตูุฏูู ุจุฑูุฏ `ivanov @ domain3.com` ุ ูุงูุฐู ุณูุณุชุฎุฏูู ุฅููุงููู ูู ุฌูุงุฒ iPhone ุงูุฎุงุต ุจู. <br><br>  ูุฌุจ ุฃู ุชุชูุงูู ุงูุฑุณุงุฆู ุงููุฑุณูุฉ ูุน ุฌููุน ูุชุทูุจุงุช ููุงูุญุฉ ุงูุจุฑูุฏ ุงูุนุดูุงุฆู ุงูุญุงููุฉ. <br>  ูุฌุจ ุฃู ูููู ููุงู ุฃุนูู ูุณุชูู ูู ุงูุชุดููุฑ ุงูููุฏู ุนูู ุงูุดุจูุงุช ุงูุนุงูุฉ. <br>  ูุฌุจ ุฃู ูููู ููุงู ุฏุนู IPv6 ูุฅุฑุณุงู ูุงุณุชูุจุงู ุฑุณุงุฆู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู. <br>  ูุฌุจ ุฃู ูููู ููุงู SpamAssassin ูู ูุญุฐู ุฑุณุงุฆู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุฃุจุฏูุง.  ูุณูููู ุฅูุง ุจุงุฑุชุฏุงุฏ ูุฌูุฏ ุงูุจุฑูุฏ ุงูุนุดูุงุฆู ุฃู ุชุฎุทูู ุฃู ุฅุฑุณุงูู ุฅูู IMAP. <br>  ูุฌุจ ุชูููู ุงูุชุนูู ุงูุชููุงุฆู ูู SpamAssassin: ุฅุฐุง ููุช ุจููู ุงูุฑุณุงูุฉ ุฅูู ูุฌูุฏ ุงูุจุฑูุฏ ุงูุนุดูุงุฆู ุ ูุณูู ุฃุชุนูู ูู ูุฐุง ุ  ุฅุฐุง ููุช ุจููู ุงูุฑุณุงูุฉ ูู ูุฌูุฏ ุงูุฑุณุงุฆู ุบูุฑ ุงููุฑุบูุจ ูููุง ุ ูุณูู ุฃุชุนูู ูู ุฐูู.  ูุชุงุฆุฌ ุงูุชุนูู SpamAssassin - ูุฌุจ ุฃู ุชุคุซุฑ ุนูู ูุฏู ูุตูู ุงูุฑุณุงูุฉ ูู ูุฌูุฏ ุงูุจุฑูุฏ ุงููุฒุนุฌ. <br>  ูุฌุจ ุฃู ุชููู ุงูุจุฑุงูุฌ ุงููุตูุฉ Php ูุงุฏุฑุฉ ุนูู ุฅุฑุณุงู ุงูุจุฑูุฏ ููุงุจุฉ ุนู ุฃู ูุฌุงู ุนูู ูุฐุง ุงูุฎุงุฏู. <br>  ูุฌุจ ุฃู ุชููู ููุงู ุฎุฏูุฉ openvpn ูุน ุฅููุงููุฉ ุงุณุชุฎุฏุงู IPv6 ุนูู ุนููู ููุณ ูุฏูู IPv6. <br><br>  ุชุญุชุงุฌ ุฃููุงู ุฅูู ุชูููู ุงููุงุฌูุงุช ูุงูุชูุฌูู ุ ุจูุง ูู ุฐูู IPv6. <br>  ุซู ุณุชุญุชุงุฌ ุฅูู ุชูููู OpenVPN ุ ูุงูุฐู ุณูุชุตู ุนุจุฑ IPv4 ูุณูุฒูุฏ ุงูุนููู ุจุนููุงู IPv6 ุซุงุจุช.  ุณูุชููู ูุฐุง ุงูุนููู ูู ุงููุตูู ุฅูู ุฌููุน ุฎุฏูุงุช IPv6 ุนูู ุงูุฎุงุฏู ูุงููุตูู ุฅูู ุฃู ููุงุฑุฏ IPv6 ุนูู ุงูุฅูุชุฑูุช. <br>  ุซู ุณูููู ูู ุงูุถุฑูุฑู ุชูููู Postfix ูุฅุฑุณุงู ุฑุณุงุฆู + SPF + DKIM + rDNS ูุบูุฑูุง ูู ุงูุชูุงูุงุช ุงูููุงุซูุฉ. <br>  ุซู ุณุชุญุชุงุฌ ุฅูู ุชูููู Dovecot ูุชูููู Multidomain. <br>  ุซู ุณุชุญุชุงุฌ ุฅูู ุชูููู SpamAssassin ูุชูููู ุงูุชุฏุฑูุจ. <br>  ุฃุฎูุฑูุง ุ ูู ุจุชุซุจูุช Bind. <br><br><h2 style=";text-align:right;direction:rtl">  ============== ูุงุฌูุงุช ูุชุนุฏุฏุฉ ============== </h2><br>  ูุชููุฆุฉ ุงููุงุฌูุงุช ุ ุชุญุชุงุฌ ุฅูู ุชุณุฌูู ุฐูู ูู "/ etc / network / interfaces". <br><br><pre style=";text-align:right;direction:rtl"><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># The loopback network interface auto lo iface lo inet loopback # The primary network interface allow-hotplug eno1 iface eno1 inet static address XX.XX.XX.X0/24 gateway XX.XX.XX.1 dns-nameservers 127.0.0.1 213.248.1.6 post-up ip route add XX.XX.XX.0/24 dev eno1 src XX.XX.XX.X0 table eno1t post-up ip route add default via XX.XX.XX.1 table eno1t post-up ip rule add table eno1t from XX.XX.XX.X0 post-up ip rule add table eno1t to XX.XX.XX.X0 auto eno1:1 iface eno1:1 inet static address XX.XX.XX.X1 netmask 255.255.255.0 post-up ip rule add table eno1t from XX.XX.XX.X1 post-up ip rule add table eno1t to XX.XX.XX.X1 post-up ip route add 10.8.0.0/24 dev tun0 src XX.XX.XX.X1 table eno1t post-down ip route del 10.8.0.0/24 dev tun0 src XX.XX.XX.X1 table eno1t auto eno1:2 iface eno1:2 inet static address XX.XX.XX.X2 netmask 255.255.255.0 post-up ip rule add table eno1t from XX.XX.XX.X2 post-up ip rule add table eno1t to XX.XX.XX.X2 iface eno1 inet6 static address X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:1::/64 gateway X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">:1 up ip -6 addr add X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:1:1:1/64 dev $IFACE up ip -6 addr add X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:1:1:2/64 dev $IFACE down ip -6 addr del X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:1:1:1/64 dev $IFACE down ip -6 addr del X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:1:1:2/64 dev $IFACE # The secondary network interface allow-hotplug eno2 iface eno2 inet static address XX.XX.XX.X5 netmask 255.255.255.0 post-up ip route add XX.XX.XX.0/24 dev eno2 src XX.XX.XX.X5 table eno2t post-up ip route add default via XX.XX.XX.1 table eno2t post-up ip rule add table eno2t from XX.XX.XX.X5 post-up ip rule add table eno2t to XX.XX.XX.X5 post-up ip route add 10.8.0.0/24 dev tun0 src XX.XX.XX.X5 table eno2t post-down ip route del 10.8.0.0/24 dev tun0 src XX.XX.XX.X5 table eno2t iface eno2 inet6 static address X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:2::/96 up ip -6 addr add X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:2:1:1/64 dev $IFACE up ip -6 addr add X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:2:1:2/64 dev $IFACE down ip -6 addr del X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:2:1:1/64 dev $IFACE down ip -6 addr del X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:2:1:2/64 dev $IFACE # OpenVPN network iface tun0 inet6 static address X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:3::/80</span></span></code> </pre> <br>  ูููู ุชุทุจูู ูุฐู ุงูุฅุนุฏุงุฏุงุช ุนูู ุฃู ุฎุงุฏู ูู tech.ru (ูุน ุงููููู ูู ุงูุชูุณูู ูุน ุงูุฏุนู) ูุณุชุนูู ุนูู ุงูููุฑ ููุง ููุจุบู. <br><br>  ุฅุฐุง ูุงูุช ุชุฌุฑุจุฉ ุฅุนุฏุงุฏ ุฃุดูุงุก ููุงุซูุฉ ูู Hetzner ุ OVH - ููุงู ุตุฏููุฉ.  ุฃุตุนุจ. <br><br>  eno1 ูู ุงุณู ุจุทุงูุฉ ุงูุดุจูุฉ ุฑูู 1 (ุจุทูุก ููููู ุบูุฑ ูุญุฏูุฏ). <br>  eno2 ูู ุงุณู ุจุทุงูุฉ ุงูุดุจูุฉ ุฑูู 2 (ุณุฑูุน ุ ูููู ูุน ุชุนุฑููุฉ). <br>  tun0 ูู ุงุณู ุจุทุงูุฉ ุงูุดุจูุฉ ุงูุงูุชุฑุงุถูุฉ ูู OpenVPN. <br>  XX.XX.XX.X0 - IPv4 # 1 ุนูู eno1. <br>  XX.XX.XX.X1 - IPv4 # 2 ุนูู eno1. <br>  XX.XX.XX.X2 - IPv4 # 3 ุนูู eno1. <br>  XX.XX.XX.X5 - IPv4 # 1 ุนูู eno2. <br>  XX.XX.XX.1 - ุจูุงุจุฉ IPv4. <br>  XXXX: XXXX: XXXX: XXXX :: / 64 - IPv6 ุฅูู ุงูุฎุงุฏู ุจุงููุงูู. <br>  XXXX: XXXX: XXXX: XXXX: 1: 2 :: / 96 - IPv6 ูู eno2 ุ ูู ุดูุก ุขุฎุฑ ูุฐูุจ ุฅูู eno1 ูู ุงูุฎุงุฑุฌ. <br>  XXXX: XXXX: XXXX: XXXX :: 1 - ุจูุงุจุฉ IPv6 (ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃูู ููููู / ุชุญุชุงุฌ ุฅูู ุชูููู ุตุฏูู ููุง. ุญุฏุฏ ููุชุงุญ IPv6). <br>  dns-nameservers - 127.0.0.1 ูุญุฏุฏุฉ (ูุฃูู ุชู ุชุซุจูุช ุฑุจุท ูุญูููุง) ู 213.248.1.6 (ูุฐุง ูู tech.ru). <br><br>  "Table eno1t" ู "table eno2t" - ูุนูู ููุงุนุฏ ุงูุทุฑูู ูุฐู ูู ุฃู ุญุฑูุฉ ุงููุฑูุฑ ุงูุชู ุชูุฑ ุนุจุฑ eno1 -&gt; ุชูุฑ ุฎูุงููุง ุ ูุญุฑูุฉ ุงููุฑูุฑ ุงูุชู ุชูุฑ ุนุจุฑ eno2 -&gt; ุชูุฑ ุนุจุฑูุง.  ูุฃูุถูุง ุณูู ุชูุฑ ุงูุงุชุตุงูุงุช ุงูุชู ูุจุฏุฃูุง ุงูุฎุงุฏู ุนุจุฑ eno1. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">ip route add default via XX.XX.XX.1 table eno1t</code> </pre> <br>  ูู ุฎูุงู ูุฐุง ุงูุฃูุฑ ุ ูููุง ุจุชุนููู ุฃู ุญุฑูุฉ ูุฑูุฑ ุบูุฑ ูููููุฉ ุชูุน ุชุญุช ุฃู ูุงุนุฏุฉ ูุน ูุถุน ุนูุงูุฉ "ุฌุฏูู eno1t" -&gt; ุฅุฑุณุงู ุฅูู ูุงุฌูุฉ eno1. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">ip route add XX.XX.XX.0/24 dev eno1 src XX.XX.XX.X0 table eno1t</code> </pre> <br>  ูู ุฎูุงู ูุฐุง ุงูุฃูุฑ ุ ูููุง ุจุชุนููู ุฃู ุญุฑูุฉ ูุฑูุฑ ูุชู ุจุฏุก ุชุดุบูููุง ุจูุงุณุทุฉ ุงูุฎุงุฏู ุฅูู ูุงุฌูุฉ eno1. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">ip rule add table eno1t from XX.XX.XX.X0 ip rule add table eno1t to XX.XX.XX.X0</code> </pre> <br>  ูู ุฎูุงู ูุฐุง ุงูุฃูุฑ ุ ูุถุน ุงูููุงุนุฏ ูุชูููุฒ ุญุฑูุฉ ุงููุฑูุฑ ุจุฃููุณูุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">auto eno1:2 iface eno1:2 inet static address XX.XX.XX.X2 netmask 255.255.255.0 post-up ip rule add table eno1t from XX.XX.XX.X2 post-up ip rule add table eno1t to XX.XX.XX.X2</code> </pre> <br>  ุชุญุฏุฏ ูุฐู ุงููุชูุฉ IPv4 ุงูุซุงูู ูููุงุฌูุฉ eno1. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">ip route add 10.8.0.0/24 dev tun0 src XX.XX.XX.X1 table eno1t</code> </pre> <br>  ุจุงุณุชุฎุฏุงู ูุฐุง ุงูุฃูุฑ ุ ูููู ุจุชุนููู ุงููุณุงุฑ ูู ุนููุงุก OpenVPN ุฅูู IPv4 ุงููุญูู ุจุงุณุชุซูุงุก XX.XX.XX.X0. <br>  ููุงุฐุง ูุฐุง ุงูุฃูุฑ ูุงูู ูุฌููุน IPv4 - ูุง ุฒูุช ูุง ุฃููู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">iface eno1 inet6 static address XXXX:XXXX:XXXX:XXXX:1:1::/64 gateway XXXX:XXXX:XXXX:XXXX::1</code> </pre> <br>  ูุฐุง ูุถุนูุง ุนููุงู ุงููุงุฌูุฉ ููุณูุง.  ุณูุณุชุฎุฏูู ุงูุฎุงุฏู ูุนููุงู "ุตุงุฏุฑ".  ูู ูุชู ุงุณุชุฎุฏุงููุง ุจุนุฏ ุงูุขู. <br><br>  ููุงุฐุง ูู ููุถุญ ": 1: 1 ::" ูุนูุฏ ููุบุงูุฉุ  ุนูู OpenVPN ุจุดูู ุตุญูุญ ููุฐุง ุงูุบุฑุถ ููุท.  ุงููุฒูุฏ ุนู ูุฐุง ูุงุญููุง. <br><br>  ุญูู ููุถูุน ุงูุจูุงุจุฉ - ูุนูู ูุฐุง ุนูู ูุง ูุฑุงู.  ูููู ุจุงูุทุฑููุฉ ุงูุตุญูุญุฉ - ููุง ูุฌุจ ุนููู ุชุญุฏูุฏ ููุชุงุญ IPv6 ุงูุฐู ูุชุตู ุจู ุงูุฎุงุฏู. <br><br>  ููุน ุฐูู ุ ูุณุจุจ ูุง ุ ูุชููู IPv6 ุนู ุงูุนูู ุฅุฐุง ููุช ุจุฐูู.  ุฑุจูุง ูุฐู ุจุนุถ ูุดุงูู tech.ru. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">ip -6 addr add XXXX:XXXX:XXXX:XXXX:1:1:1:1/64 dev <span class="hljs-variable"><span class="hljs-variable">$IFACE</span></span></code> </pre> <br>  ูุฐุง ูุถูู ุนูุงููู IPv6 ุฅูู ุงููุงุฌูุฉ.  ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ูุงุฆุฉ ุนููุงู ุ ููุฐุง ูุนูู ูุงุฆุฉ ุณุทุฑ ูู ูุฐุง ุงูููู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">iface eno1 inet6 static address XXXX:XXXX:XXXX:XXXX:1:1::/64 ... iface eno2 inet6 static address XXXX:XXXX:XXXX:XXXX:1:2::/96 ... iface tun0 inet6 static address XXXX:XXXX:XXXX:XXXX:1:3::/80</code> </pre> <br><blockquote style=";text-align:right;direction:rtl">  ูุถุน ุนูุงูุฉ ุนูู ุงูุนูุงููู ูุงูุดุจูุงุช ุงููุฑุนูุฉ ูุฌููุน ุงููุงุฌูุงุช ุจุญูุซ ุชููู ูุงุถุญุฉ. <br>  eno1 - ูุฌุจ ุฃู ุชููู "/ 64" - ูุฃู ูุฐุง ูู ูุฌููุน ุนูุงููููุง ุจุงููุงูู. <br>  tun0 - ูุฌุจ ุฃู ุชููู ุงูุดุจูุฉ ุงููุฑุนูุฉ ุฃูุจุฑ ูู eno1.  ุฎูุงู ุฐูู ุ ูุง ููููู ุชูููู ุจูุงุจุฉ IPv6 ูุนููุงุก OpenVPN. <br>  eno2 - ูุฌุจ ุฃู ุชููู ุงูุดุจูุฉ ุงููุฑุนูุฉ ุฃูุจุฑ ูู tun0.  ุฎูุงู ุฐูู ุ ูู ูุชููู ุนููุงุก OpenVPN ูู ุงูุญุตูู ุนูู ุนูุงููู IPv6 ุงููุญููุฉ. <br>  ููุชูุถูุญ ุ ุงุฎุชุฑุช ุฎุทูุฉ ุงูุดุจูุฉ ุงููุฑุนูุฉ 16 ุ ูููู ููููู ุญุชู ุงุชุฎุงุฐ ุงูุฎุทูุฉ "1" ุฅุฐุง ููุช ุชุฑุบุจ ูู ุฐูู. <br>  ูุจุงูุชุงูู ุ 64 + 16 = 80 ุ ู 80 + 16 = 96. <br><br>  ููุฒูุฏ ูู ุงููุถูุญ: <br>  XXXX: XXXX: XXXX: XXXX: XXXX: 1: 1: YYYY: YYYY - ูุฐู ุนูุงููู ูุฌุจ ุชุนููููุง ูููุงูุน ุฃู ุฎุฏูุงุช ูุญุฏุฏุฉ ุนูู ูุงุฌูุฉ eno1. <br>  XXXX: XXXX: XXXX: XXXX: XXXX: 1: 2: YYYY: YYYY - ูุฐู ุนูุงููู ูุฌุจ ุชุนููููุง ูููุงูุน ุฃู ุฎุฏูุงุช ูุนููุฉ ุนูู ูุงุฌูุฉ eno2. <br>  XXXX: XXXX: XXXX: XXXX: 1: 3: YYYY: YYYY ูู ุนูุงููู ูุฌุจ ุชุนููููุง ูุนููุงุก OpenVPN ุฃู ุงุณุชุฎุฏุงููุง ูุนูุงููู ุฎุฏูุฉ OpenVPN. </blockquote><br><br>  ูุชูููู ุงูุดุจูุฉ - ูุฌุจ ุฃู ูููู ูู ุงููููู ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู. <br>  ูุชู ุงูุชูุงุท ุชุบููุฑุงุช IPv4 ุฃุซูุงุก ุงูุชูููุฐ (ุชุฃูุฏ ูู ูููุง ูู ุงูุดุงุดุฉ - ูุฅูุง ูุณูุคุฏู ูุฐุง ุงูุฃูุฑ ุจุจุณุงุทุฉ ุฅูู ุฅุณูุงุท ุงูุดุจูุฉ ุนูู ุงูุฎุงุฏู): <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">/etc/init.d/networking restart</code> </pre> <br>  ูู ููู "/ etc / iproute2 / rt_tables" ุฃุถู ูู ุงูููุงูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">100 eno1t 101 eno2t</code> </pre> <br>  ุจุฏูู ูุฐุง ุ ูุง ููููู ุงุณุชุฎุฏุงู ุงูุฌุฏุงูู ุงููุฎุตุตุฉ ูู ุงูููู "/ etc / network / interfaces". <br>  ูุฌุจ ุฃู ุชููู ุงูุฃุฑูุงู ูุฑูุฏุฉ ูุฃูู ูู 65535. <br><br>  ุชุชุบูุฑ ุชุบููุฑุงุช IPv6 ุจุณูููุฉ ุฏูู ุฅุนุงุฏุฉ ุงูุชุดุบูู ุ ูููู ููุฐุง ุชุญุชุงุฌ ุฅูู ุชุนูู ุซูุงุซุฉ ุฃูุงูุฑ ุนูู ุงูุฃูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">ip -6 addr ... ip -6 route ... ip -6 neigh ...</code> </pre> <br>  ุฅุนุฏุงุฏ "/etc/sysctl.conf" <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Uncomment the next line to enable packet forwarding for IPv4 net.ipv4.ip_forward = 1 # Do not accept ICMP redirects (prevent MITM attacks) net.ipv4.conf.all.accept_redirects = 0 net.ipv6.conf.all.accept_redirects = 0 # Do not send ICMP redirects (we are not a router) net.ipv4.conf.all.send_redirects = 0 # For receiving ARP replies net.ipv4.conf.all.arp_filter = 0 net.ipv4.conf.default.arp_filter = 0 # For sending ARP net.ipv4.conf.all.arp_announce = 0 net.ipv4.conf.default.arp_announce = 0 # Enable IPv6 net.ipv6.conf.all.disable_ipv6 = 0 net.ipv6.conf.default.disable_ipv6 = 0 net.ipv6.conf.lo.disable_ipv6 = 0 # IPv6 configuration net.ipv6.conf.all.autoconf = 1 net.ipv6.conf.all.accept_ra = 0 # For OpenVPN net.ipv6.conf.all.forwarding = 1 net.ipv6.conf.all.proxy_ndp = 1 # For nginx on boot net.ipv6.ip_nonlocal_bind = 1</span></span></code> </pre> <br>  ูุฐู ูู ุฅุนุฏุงุฏุงุช sysctl ูุฎุงุฏูู.  ุฃูุงุญุธ ุงูููู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">net.ipv4.ip_forward = 1</code> </pre> <br>  ุจุฏูู ูุฐุง ุ ูู ูุนูู OpenVPN ุจุฃู ุดูู ูู ุงูุฃุดูุงู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">net.ipv6.ip_nonlocal_bind = 1</code> </pre> <br>  ุฃู ุดุฎุต ูุญุงูู ุงูููุงู ุจุฑุจุท IPv6 (ุนูู ุณุจูู ุงููุซุงู nginx) ูุจุงุดุฑุฉ ุจุนุฏ ุชุดุบูู ุงููุงุฌูุฉ ุณูุญุตู ุนูู ุฎุทุฃ.  ุฃู ูุซู ูุฐุง ุงูุนููุงู ุบูุฑ ูุชููุฑ. <br><br>  ูุชุฌูุจ ูุซู ูุฐุง ุงููููู ุ ูุชู ุฅุฌุฑุงุก ูุซู ูุฐุง ุงูุฅุนุฏุงุฏ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">net.ipv6.conf.all.forwarding = 1 net.ipv6.conf.all.proxy_ndp = 1</code> </pre> <br>  ุจุฏูู ุฅุนุฏุงุฏุงุช IPv6 ูุฐู ุ ูุง ุชูุชูู ุญุฑูุฉ ุงููุฑูุฑ ูู ุนููู OpenVPN ุฅูู ุงูุนุงูู. <br><br>  ุงูุฅุนุฏุงุฏุงุช ุงูุฃุฎุฑู ุฅูุง ุบูุฑ ุฐุงุช ุตูุฉ ุฃู ูุง ุฃุชุฐูุฑ ุณุจุจ ุฐูู. <br>  ูููู ููุท ูู ุญุงูุฉ ุ ุฃุชุฑู "ููุง ูู". <br><br>  ูู ุฃุฌู ุงูุชูุงุท ุงูุชุบููุฑุงุช ูู ูุฐุง ุงูููู ุฏูู ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู ุ ุชุญุชุงุฌ ุฅูู ุชุดุบูู ุงูุฃูุฑ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">sysctl -p</code> </pre> <br>  ูุฒูุฏ ูู ุงูุชูุงุตูู ุญูู ููุงุนุฏ "ุงูุฌุฏูู": <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">habr.com/post/108690</a> <br><br><h2 style=";text-align:right;direction:rtl">  ============== OpenVPN ============== </h2><br>  ูุง ูุนูู OpenVPN IPv4 ุจุฏูู iptables. <br><br>  ูุฏู ูุฐู iptables ูู VPN: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">iptables -A INPUT -p udp -s YY.YY.YY.YY --dport 1194 -j ACCEPT iptables -A FORWARD -i tun0 -o eno1 -j ACCEPT iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eno1 -j SNAT --to-source XX.XX.XX.X0 <span class="hljs-comment"><span class="hljs-comment">##iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eno1 -j MASQUERADE iptables -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT iptables -A INPUT -p udp --dport 1194 -j DROP iptables -A FORWARD -p udp --dport 1194 -j DROP</span></span></code> </pre> <br>  YY.YY.YY.YY ูู ุนููุงู IPv4 ุงูุซุงุจุช ุงูุฎุงุต ุจุงูุฌูุงุฒ ุงููุญูู. <br>  10.8.0.0/24 - ุดุจูุฉ IPv4 openvpn.  ุนูุงููู IPv4 ูุนููุงุก openvpn. <br>  ุชุณูุณู ุงูููุงุนุฏ ููู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">iptables -A INPUT -p udp -s YY.YY.YY.YY --dport 1194 -j ACCEPT iptables -A FORWARD -i tun0 -o eno1 -j ACCEPT ... iptables -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT iptables -A INPUT -p udp --dport 1194 -j DROP iptables -A FORWARD -p udp --dport 1194 -j DROP</code> </pre> <br>  ูุฐุง ููุฏ ุจุญูุซ ูููููู ููุท ุงุณุชุฎุฏุงู OpenVPN ูู ุนููุงู IP ุงูุซุงุจุช ุงูุฎุงุต ุจู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eno1 -j SNAT --to-source XX.XX.XX.X0 --  -- iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eno1 -j MASQUERADE</code> </pre> <br>  ูุฅุนุงุฏุฉ ุชูุฌูู ุญุฒู IPv4 ุจูู ุนููุงุก OpenVPN ูุงูุฅูุชุฑูุช ุ ุชุญุชุงุฌ ุฅูู ุชุณุฌูู ุฃุญุฏ ูุฐู ุงูุฃูุงูุฑ. <br><br>  ูู ุงูุญุงูุงุช ุงููุฎุชููุฉ ุ ุฃุญุฏ ุงูุฎูุงุฑุงุช ุบูุฑ ููุงุณุจ. <br>  ููุง ุงููุฑูููู ููุงุณุจ ูุญุงูุชู. <br>  ุจุนุฏ ูุฑุงุกุฉ ุงููุซุงุฆู ุ ุงุฎุชุฑุช ุงูุฎูุงุฑ ุงูุฃูู ุ ูุฃูู ูุฃูู ุฃูู ูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ. <br><br>  ุจุญูุซ ูุชู ุงูุชูุงุท ุฌููุน ุฅุนุฏุงุฏุงุช iptables ุจุนุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู - ุชุญุชุงุฌ ุฅูู ุญูุธูุง ูู ููุงู ูุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">iptables-save &gt; /etc/iptables/rules.v4 ip6tables-save &gt; /etc/iptables/rules.v6</code> </pre> <br>  ูู ูุชู ุงุฎุชูุงุฑ ูุฐู ุงูุฃุณูุงุก ุนู ุทุฑูู ุงูุตุฏูุฉ.  ุชุณุชุฎุฏููุง ุญุฒูุฉ iptables-persistent. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">apt-get install iptables-persistent</code> </pre> <br>  ุชุซุจูุช ุญุฒูุฉ OpenVPN ุงูุฑุฆูุณูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">apt-get install openvpn easy-rsa</code> </pre> <br>  ูู ุจุฅุนุฏุงุฏ ูุงูุจ ููุดูุงุฏุงุช (ุงุณุชุจุฏู ูููู): <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">make-cadir ~/openvpn-ca <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/openvpn-ca ln -s openssl-1.0.0.cnf openssl.cnf</code> </pre> <br>  ุฏุนููุง ูููู ุจุชุญุฑูุฑ ุฅุนุฏุงุฏุงุช ูุงูุจ ุงูุดูุงุฏุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">mcedit vars</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">... <span class="hljs-comment"><span class="hljs-comment"># These are the default values for fields # which will be placed in the certificate. # Don't leave any of these fields blank. export KEY_COUNTRY="RU" export KEY_PROVINCE="Krasnodar" export KEY_CITY="Dinskaya" export KEY_ORG="Own" export KEY_EMAIL="admin@domain1.com" export KEY_OU="VPN" # X509 Subject Field export KEY_NAME="server" ...</span></span></code> </pre> <br>  ุฅูุดุงุก ุดูุงุฏุฉ ุฎุงุฏู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/openvpn-ca <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> vars ./clean-all ./build-ca ./build-key-server server ./build-dh openvpn --genkey --secret keys/ta.key</code> </pre> <br>  ุณูููู ุจุชุญุถูุฑ ุงููุฑุตุฉ ูุฅูุดุงุก ูููุงุช "ุงุณู ุงูุนููู .opvn" ุงููุงุชุฌุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">mkdir -p ~/client-configs/files chmod 700 ~/client-configs/files cp /usr/share/doc/openvpn/examples/sample-config-files/client.conf ~/client-configs/base.conf mcedit ~/client-configs/base.conf</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Client mode client # Interface tunnel type dev tun # TCP protocol proto tcp-client # Address/Port of VPN server remote XX.XX.XX.X0 1194 # Don't bind to local port/address nobind # Don't need to re-read keys and re-create tun at restart persist-key persist-tun # Remote peer must have a signed certificate remote-cert-tls server ns-cert-type server # Enable compression comp-lzo # Custom ns-cert-type server tls-auth ta.key 1 cipher DES-EDE3-CBC</span></span></code> </pre> <br>  ุณูููู ุจุฅุนุฏุงุฏ ุจุฑูุงูุฌ ูุตู ูููู ุจุชุฌููุน ุฌููุน ุงููููุงุช ูู ููู opvn ูุงุญุฏ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">mcedit ~/client-configs/make_config.sh chmod 700 ~/client-configs/make_config.sh</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # First argument: Client identifier KEY_DIR=~/openvpn-ca/keys OUTPUT_DIR=~/client-configs/files BASE_CONFIG=~/client-configs/base.conf cat ${BASE_CONFIG} \ &lt;(echo -e '&lt;ca&gt;') \ ${KEY_DIR}/ca.crt \ &lt;(echo -e '&lt;/ca&gt;\n&lt;cert&gt;') \ ${KEY_DIR}/${1}.crt \ &lt;(echo -e '&lt;/cert&gt;\n&lt;key&gt;') \ ${KEY_DIR}/${1}.key \ &lt;(echo -e '&lt;/key&gt;\n&lt;tls-auth&gt;') \ ${KEY_DIR}/ta.key \ &lt;(echo -e '&lt;/tls-auth&gt;') \ &gt; ${OUTPUT_DIR}/${1}.ovpn</span></span></code> </pre> <br>  ูููู ุจุฅูุดุงุก ุฃูู ุนููู OpenVPN: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/openvpn-ca <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> vars ./build-key client-name <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/client-configs ./make_config.sh client-name</code> </pre> <br>  ูุชู ุฅุฑุณุงู ุงูููู "~ / client-configs / files / client-name.ovpn" ุฅูู ุงูุนููู. <br><br>  ูุนููุงุก iOS ุ ุณุชุญุชุงุฌ ุฅูู ุงูููุงู ุจุงูุฎุฏุนุฉ: <br>  ูุฌุจ ุฃู ุชููู ูุญุชููุงุช ุนูุงูุฉ tls-auth ุจุฏูู ุชุนููู. <br>  ููุฐูู ูุถุน "ููุชุงุญ ุงูุงุชุฌุงู 1" ูุจุงุดุฑุฉ ูุจู ุงูุนูุงูุฉ "tls-auth". <br><br>  ุชูููู ุชูููู ุฎุงุฏู OpenVPN: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/openvpn-ca/keys cp ca.crt ca.key server.crt server.key ta.key dh2048.pem /etc/openvpn gunzip -c /usr/share/doc/openvpn/examples/sample-config-files/server.conf.gz | tee /etc/openvpn/server.conf mcedit /etc/openvpn/server.conf</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Listen port port 1194 # Protocol proto tcp-server # IP tunnel dev tun0 tun-ipv6 push tun-ipv6 # Master certificate ca ca.crt # Server certificate cert server.crt # Server private key key server.key # Diffie-Hellman parameters dh dh2048.pem # Allow clients to communicate with each other client-to-client # Client config dir client-config-dir /etc/openvpn/ccd # Run client-specific script on connection and disconnection script-security 2 client-connect "/usr/bin/sudo -u root /etc/openvpn/server-clientconnect.sh" client-disconnect "/usr/bin/sudo -u root /etc/openvpn/server-clientdisconnect.sh" # Server mode and client subnets server 10.8.0.0 255.255.255.0 server-ipv6 X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:3::/80 topology subnet # IPv6 routes push "route-ipv6 X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">:/64" push "route-ipv6 2000::/3" # DNS (for Windows) # These are OpenDNS push "dhcp-option DNS 208.67.222.222" push "dhcp-option DNS 208.67.220.220" # Configure all clients to redirect their default network gateway through the VPN push "redirect-gateway def1 bypass-dhcp" push "redirect-gateway ipv6" #For iOS # Don't need to re-read keys and re-create tun at restart persist-key persist-tun # Ping every 10s. Timeout of 120s. keepalive 10 120 # Enable compression comp-lzo # User and group user vpn group vpn # Log a short status status openvpn-status.log # Logging verbosity ##verb 4 # Custom config tls-auth ta.key 0 cipher DES-EDE3-CBC</span></span></code> </pre> <br>  ูุนุฏ ุฐูู ุถุฑูุฑููุง ูุชุนููู ุนููุงู ุซุงุจุช ููู ุนููู (ุบูุฑ ุถุฑูุฑู ุ ูููู ุฃุณุชุฎุฏูู): <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Client config dir client-config-dir /etc/openvpn/ccd</span></span></code> </pre> <br>  ุงูุชูุงุตูู ุงูุฃูุซุฑ ุตุนูุจุฉ ูุงูููุชุงุญ. <br><br>  ูุณูุก ุงูุญุธ ุ ูุฅู OpenVPN ุบูุฑ ูุงุฏุฑ ุญุชู ุงูุขู ุนูู ุชูููู ุจูุงุจุฉ IPv6 ููุนููุงุก ุจุดูู ูุณุชูู. <br>  ุนูููุง ุฅุนุงุฏุฉ ุชูุฌูู ูุฐุง ูุฏูููุง ููู ุนููู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Run client-specific script on connection and disconnection script-security 2 client-connect "/usr/bin/sudo -u root /etc/openvpn/server-clientconnect.sh" client-disconnect "/usr/bin/sudo -u root /etc/openvpn/server-clientdisconnect.sh"</span></span></code> </pre> <br>  ููู "/etc/openvpn/server-clientconnect.sh": <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # Check client variables if [ -z "$ifconfig_pool_remote_ip" ] || [ -z "$common_name" ]; then echo "Missing environment variable." exit 1 fi # Load server variables . /etc/openvpn/variables ipv6="" # Find out if there is a specific config with fixed IPv6 for this client if [ -f "/etc/openvpn/ccd/$common_name" ]; then # Get fixed IPv6 from client config file ipv6=$(sed -nr 's/^.*ifconfig-ipv6-push[ \t]+([0-9a-fA-F\\:]+).*$/\1/p' "/etc/openvpn/ccd/$common_name") echo $ipv6 fi # Get IPv6 from IPv4 if [ -z "$ipv6" ]; then ipp=$(echo "$ifconfig_pool_remote_ip" | cut -d. -f4) if ! [ "$ipp" -ge 2 -a "$ipp" -le 254 ] 2&gt;/dev/null; then echo "Invalid IPv4 part." exit 1 fi hexipp=$(printf '%x' $ipp) ipv6="$prefix$hexipp" fi # Create proxy rule /sbin/ip -6 neigh add proxy $ipv6 dev eno1</span></span></code> </pre> <br><br>  ููู "/etc/openvpn/server-clientdisconnect.sh": <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # Check client variables if [ -z "$ifconfig_pool_remote_ip" ] || [ -z "$common_name" ]; then echo "Missing environment variable." exit 1 fi # Load server variables . /etc/openvpn/variables ipv6="" # Find out if there is a specific config with fixed IPv6 for this client if [ -f "/etc/openvpn/ccd/$common_name" ]; then # Get fixed IPv6 from client config file ipv6=$(sed -nr 's/^.*ifconfig-ipv6-push[ \t]+([0-9a-fA-F\\:]+).*$/\1/p' "/etc/openvpn/ccd/$common_name") fi # Get IPv6 from IPv4 if [ -z "$ipv6" ]; then ipp=$(echo "$ifconfig_pool_remote_ip" | cut -d. -f4) if ! [ "$ipp" -ge 2 -a "$ipp" -le 254 ] 2&gt;/dev/null; then echo "Invalid IPv4 part." exit 1 fi hexipp=$(printf '%x' $ipp) ipv6="$prefix$hexipp" fi # Delete proxy rule /sbin/ip -6 neigh del proxy $ipv6 dev eno1</span></span></code> </pre> <br>  ูุณุชุฎุฏู ููุง ุงููุตูู ุงูููู "/ etc / openvpn / variables": <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Subnet prefix=X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">2: # netmask prefixlen=112</span></span></code> </pre> <br>  ููุงุฐุง ุชูุช ูุชุงุจุชูุง ููุง - ุฃุฌุฏ ุตุนูุจุฉ ูู ุชุฐูุฑูุง. <br><br>  ุงูุขู ูุจุฏู ููุงุน ุงูุดุจูุฉ ุงูุบุฑูุจ = 112 (ูุฌุจ ุฃู ูููู ููุงู 96). <br>  ูุงูุจุงุฏุฆุฉ ุบุฑูุจุฉ ุ ููุง ุชุชุทุงุจู ูุน ุดุจูุฉ tun0. <br>  ููู ุญุณููุง ุ ุฃุชุฑููุง "ููุง ูู". <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">cipher DES-EDE3-CBC</code> </pre> <br>  ูุฐุง ุฃุญุฏ ุงูููุงุฉ - ุงุฎุชุฑุช ูุฐู ุงูุทุฑููุฉ ูุชุดููุฑ ุงูุงุชุตุงู. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุฒูุฏ ุนู ุฅุนุฏุงุฏ OpenVPN IPv4.</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุฒูุฏ ุนู ุฅุนุฏุงุฏ OpenVPN IPv6.</a> <br><br><h2 style=";text-align:right;direction:rtl">  ============== Postfix ============== </h2><br>  ุชุซุจูุช ุงูุญุฒูุฉ ุงูุฑุฆูุณูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">apt-get install postfix</code> </pre> <br>  ุนูุฏ ุงูุชุซุจูุช ุ ุญุฏุฏ "ูููุน ุงูุฅูุชุฑูุช". <br><br>  ูุจุฏู "/etc/postfix/main.cf" ููุง ููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">smtpd_banner = <span class="hljs-variable"><span class="hljs-variable">$myhostname</span></span> ESMTP <span class="hljs-variable"><span class="hljs-variable">$mail_name</span></span> (Debian/GNU) biff = no <span class="hljs-comment"><span class="hljs-comment"># appending .domain is the MUA's job. append_dot_mydomain = no readme_directory = no # See http://www.postfix.org/COMPATIBILITY_README.html -- default to 2 on # fresh installs. compatibility_level = 2 # TLS parameters smtpd_tls_cert_file=/etc/ssl/domain1.com.2018.chained.crt smtpd_tls_key_file=/etc/ssl/domain1.com.2018.key smtpd_use_tls=yes smtpd_tls_auth_only = yes smtp_bind_address = XX.XX.XX.X0 smtp_bind_address6 = X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:1:1:1 smtp_tls_security_level = may smtp_tls_ciphers = export smtp_tls_protocols = !SSLv2, !SSLv3 smtp_tls_loglevel = 1 smtpd_relay_restrictions = permit_mynetworks permit_sasl_authenticated defer_unauth_destination myhostname = domain1.com alias_maps = hash:/etc/aliases alias_database = hash:/etc/aliases myorigin = domain1.com mydestination = localhost relayhost = mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128 mailbox_size_limit = 0 recipient_delimiter = + inet_interfaces = all inet_protocols = ipv4 internal_mail_filter_classes = bounce # Storage type virtual_transport = lmtp:unix:private/dovecot-lmtp virtual_mailbox_domains = mysql:/etc/postfix/mysql-virtual-mailbox-domains.cf virtual_mailbox_maps = mysql:/etc/postfix/mysql-virtual-mailbox-maps.cf virtual_alias_maps = mysql:/etc/postfix/mysql-virtual-alias-maps.cf # SMTP-Auth settings smtpd_sasl_type = dovecot smtpd_sasl_path = private/auth smtpd_sasl_auth_enable = yes smtpd_recipient_restrictions = permit_sasl_authenticated, permit_mynetworks, #reject_invalid_hostname, #reject_unknown_recipient_domain, reject_unauth_destination, reject_rbl_client sbl.spamhaus.org, check_policy_service unix:private/policyd-spf smtpd_helo_restrictions = #reject_invalid_helo_hostname, #reject_non_fqdn_helo_hostname, reject_unknown_helo_hostname smtpd_client_restrictions = permit_mynetworks, permit_sasl_authenticated, reject_non_fqdn_helo_hostname, permit # SPF policyd-spf_time_limit = 3600 # OpenDKIM milter_default_action = accept milter_protocol = 6 smtpd_milters = unix:var/run/opendkim/opendkim.sock non_smtpd_milters = unix:var/run/opendkim/opendkim.sock # IP address per domain sender_dependent_default_transport_maps = pcre:/etc/postfix/sdd_transport.pcre</span></span></code> </pre> <br>  ุฏุนููุง ููุธุฑ ูู ุชูุงุตูู ูุฐุง ุงูุชูููู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">smtpd_tls_cert_file=/etc/ssl/domain1.com.2018.chained.crt smtpd_tls_key_file=/etc/ssl/domain1.com.2018.key</code> </pre> <br><br><hr><blockquote style=";text-align:right;direction:rtl"><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููููุง ูููุงุทูู ุฎุงุจุฑููุณู ุ ุชุญุชูู ูุฐู ุงููุชูุฉ ุนูู `` ูุนูููุงุช ุฎุงุทุฆุฉ ูุฃุทุฑูุญุงุช ูุงุฐุจุฉ ''.</b> <div class="spoiler_text" style=";text-align:right;direction:rtl">  ุจุนุฏ 8 ุณููุงุช ููุท ูู ุจุฏุงูุฉ ูุณูุฑุชู ุ ุจุฏุฃุช ุฃููู ููู ุชุนูู SSL. <br><br>  ูุฐูู ุ ุณูู ุฃุชุญุฑุฑ ูู ูุตู ููููุฉ ุงุณุชุฎุฏุงู SSL (ุจุฏูู ุงูุฅุฌุงุจุฉ ุนูู ุงูุฃุณุฆูุฉ "ููู ุชุนููุ" ู "ููุงุฐุง ุชุนููุ"). <br><br>  ุฃุณุงุณ ุงูุชุดููุฑ ุงูุญุฏูุซ ูู ุฅูุดุงุก ุฒูุฌ ุฑุฆูุณู (ุณุทุฑูู ุทููููู ูู ุงูุดุฎุตูุงุช). <br><br>  ุฃุญุฏ "ุงูููุงุชูุญ" ุฎุงุต ูุงูุขุฎุฑ "ุนุงู".  ูุญู ูุญุชูุธ ุจุงูููุชุงุญ ุงูุฎุงุต ุจุนูุงูุฉ ุดุฏูุฏุฉ ูู ุงูุณุฑ.  ููุฒุน ุงูููุชุงุญ ุงูุนุงู ุนูู ุงูุฌููุน. <br><br>  ุจุงุณุชุฎุฏุงู ููุชุงุญ ุนุงู ุ ููููู ุชุดููุฑ ุณูุณูุฉ ูุตูุฉ ุจุญูุซ ูุง ูููู ูู ุชุดููุฑ ุณูู ูุงูู ุงูููุชุงุญ ุงูุฎุงุต. <br>  ุญุณููุง ุ ูุฐุง ูู ุฃุณุงุณ ุงูุชูููููุฌูุง ุจุงููุงูู. <br><br>  ุงูุฎุทูุฉ # 1 - ููุงูุน https. <br>  ุนูุฏ ุงููุตูู ุฅูู ุงููููุน ุ ูุชุนูู ุงููุณุชุนุฑุถ ูู ุฎุงุฏู ุงูููุจ ุฃู ุงููููุน https ูุจุงูุชุงูู ูุทูุจ ููุชุงุญูุง ุนุงููุง. <br>  ุฎุงุฏู ุงูููุจ ูุนุทู ุงูููุชุงุญ ุงูุนุงู.  ุจุงุณุชุฎุฏุงู ุงูููุชุงุญ ุงูุนุงู ุ ูููู ุงููุชุตูุญ ุจุชุดููุฑ ุทูุจ http ูุฅุฑุณุงูู. <br>  ูููู ูุฑุงุกุฉ ูุญุชูู http-request ููุท ูู ูุจู ุดุฎุต ูุฏูู ููุชุงุญ ุฎุงุต ุ ุฃู ุงูุฎุงุฏู ุงูุฐู ูุชู ุฅุฌุฑุงุก ุงูููุงููุฉ ุฅููู ููุท. <br>  ูุญุชูู ุทูุจ Http ุนูู URI ุนูู ุงูุฃูู.  ูุฐูู ุ ุฅุฐุง ูุงูุช ุงูุฏููุฉ ุชุญุงูู ุชูููุฏ ุงููุตูู ููุณ ุฅูู ุงููููุน ุจุฃูููู ุ ูููู ุฅูู ุตูุญุฉ ูุญุฏุฏุฉ ุ ููุง ูููู ุงูููุงู ุจุฐูู ุจุงููุณุจุฉ ูููุงูุน https. <br><br>  ุงูุฎุทูุฉ ุฑูู 2 ูู ุงูุฌูุงุจ ุงููุดูุฑ. <br>  ูููุฑ ุฎุงุฏู ุงูููุจ ุฅุฌุงุจุฉ ูููู ูุฑุงุกุชูุง ุจุณูููุฉ ุนูู ุทูู ุงูุทุฑูู. <br>  ุงูุญู ุจุณูุท ููุบุงูุฉ - ูููู ุงููุชุตูุญ ูุญูููุง ุจุฅูุดุงุก ููุณ ุฒูุฌ ุงูููุงุชูุญ ุงูุฎุงุตุฉ ูุงูุนุงูุฉ ููู ูููุน https. <br>  ูุฅูู ุฌุงูุจ ุทูุจ ุงูููุชุงุญ ุงูุนุงู ูููููุน ุ ูุฑุณู ููุชุงุญู ุงูุนุงู ุงููุญูู. <br>  ูุชุฐูุฑู ุฎุงุฏู ุงูููุจ ุ ูุนูุฏ ุฅุฑุณุงู ุงุณุชุฌุงุจุฉ http ุ ูุชู ุชุดููุฑ ูุฐุง ุงูููุชุงุญ ุงูุนุงู ูุนููู ูุนูู. <br>  ูููู ุงูุขู ูู ุชุดููุฑ ุงุณุชุฌุงุจุฉ http ููุท ุจูุงุณุทุฉ ูุงูู ุงูููุชุงุญ ุงูุฎุงุต ููุชุตูุญ ุงูุนููู (ุฃู ุงูุนููู ููุณู). <br><br>  ุงูุฎุทูุฉ ุฑูู 3 - ุฅูุดุงุก ุงุชุตุงู ุขูู ูู ุฎูุงู ููุงุฉ ุนุงูุฉ. <br>  ูู ุงููุซุงู ุฑูู 2 ุ ููุงู ุซุบุฑุฉ ุฃูููุฉ - ูุง ุดูุก ูููุน ูู ูุฑุบุจูู ูู ุงุนุชุฑุงุถ ุทูุจ http ูุชุญุฑูุฑ ูุนูููุงุช ุงูููุชุงุญ ุงูุนุงู. <br>  ูุจุงูุชุงูู ุ ุณูุดุงูุฏ ุงููุณูุท ุชูุฑูุจูุง ูู ูุญุชูู ุงูุฑุณุงุฆู ุงููุฑุณูุฉ ูุงููุณุชููุฉ ุญุชู ุชุชุบูุฑ ููุงุฉ ุงูุงุชุตุงู. <br>  ููุงูุญุฉ ูุฐุง ุฃูุฑ ุจุณูุท ููุบุงูุฉ - ููุท ุฃุฑุณู ุงูููุชุงุญ ุงูุนุงู ูููุชุตูุญ ูุฑุณุงูุฉ ูุดูุฑุฉ ุจุงูููุชุงุญ ุงูุนุงู ูุฎุงุฏู ุงูููุจ. <br>  ูุฑุณู ุฎุงุฏู ุงูููุจ ุฃููุงู ุฑุฏูุง ูุซู "ููุชุงุญู ุงูุนุงู ููุฐุง" ููุดููุฑ ูุฐู ุงูุฑุณุงูุฉ ุจููุณ ุงูููุชุงุญ ุงูุนุงู. <br>  ููุธุฑ ุงููุณุชุนุฑุถ ุฅูู ุงูุฅุฌุงุจุฉ - ุฅุฐุง ุชู ุชููู ุงูุฑุณุงูุฉ "ููุชุงุญู ุงูุนุงู ููุฐุง" - ููุฐุง ุถูุงู ุจูุณุจุฉ 100ูช ุฃู ููุงุฉ ุงูุงุชุตุงู ูุฐู ุขููุฉ. <br>  ูุง ูุฏู ุฃูุงููุงุ <br>  ูุญุฏุซ ุฅูุดุงุก ููุงุฉ ุงูุงุชุตุงู ุงูุขููุฉ ูุฐู ุจููุณ ุณุฑุนุฉ ping * 2.  ุนูู ุณุจูู ุงููุซุงู ุ 20 ูููู ุซุงููุฉ. <br>  ูุฌุจ ุฃู ูููู ููููุงุฌู ุฅูุง ููุชุงุญ ุฎุงุต ูุฃุญุฏ ุงูุทุฑููู ููุฏููุง.  ุฃู ุงุญุตู ุนูู ููุชุงุญ ุฎุงุต ูุจุถุน ุซูุงู. <br>  ุฅู ุงุฎุชุฑุงู ููุชุงุญ ุฎุงุต ุญุฏูุซ ุณูุณุชุบุฑู ุนููุฏูุง ุนูู ุงูููุจููุชุฑ ุงูุนููุงู. <br><br>  ุงูุฎุทูุฉ # 4 - ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุนุงูุฉ ููููุงุชูุญ ุงูุนุงูุฉ. <br>  ูู ุงููุงุถุญ ุ ูู ูุฐู ุงููุตุฉ ุจุฃููููุง ุ ููุงู ุงุญุชูุงู ูููุงุฌู ูุฌูุณ ุนูู ููุงุฉ ุงูุงุชุตุงู ุจูู ุงูุนููู ูุงูุฎุงุฏู. <br>  ููุฏู ุงูุฎุงุฏู ุงููุฑุตุฉ ููุนููู ุ ูููุฎุงุฏู ุงูุฐู ุณููุฏูู ุงูุนููู.  ููุญุงูุงุฉ ุฒูุฌ ุงูููุงุชูุญ ูู ููุง ุงูุงุชุฌุงููู. <br>  ุซู ุณูุฑู ุงูููุงุฌู ูู ุญุฑูุฉ ุงููุฑูุฑ ูุณูููู ูุงุฏุฑูุง ุนูู "ุชุนุฏูู" ุญุฑูุฉ ุงููุฑูุฑ. <br>  ุนูู ุณุจูู ุงููุซุงู ุ ูู ุจุชุบููุฑ ุงูุนููุงู ุงูุฐู ุชุฑูุฏ ุฅุฑุณุงู ุงูุฃููุงู ุฅููู ุฃู ูุณุฎ ูููุฉ ุงููุฑูุฑ ูู ุงูุจูู ุนุจุฑ ุงูุฅูุชุฑูุช ุฃู ุญุธุฑ ุงููุญุชูู "ุงููุฑููุถ". <br>  ููุญุงุฑุจุฉ ูุคูุงุก ุงูููุงุฌููู ุ ุชูุตููุง ุฅูู ูุงุนุฏุฉ ุจูุงูุงุช ุนุงูุฉ ูุน ููุงุชูุญ ุนุงูุฉ ููู ูููุน https. <br>  ูู ูุชุตูุญ "ูุนุฑู" ุจูุฌูุฏ ุญูุงูู 200 ูู ููุงุนุฏ ุงูุจูุงูุงุช ูุฐู.  ูุฐุง ูุซุจุช ูุณุจููุง ูู ูู ูุชุตูุญ. <br>  ูุชู ุฏุนู "ุงููุนุฑูุฉ" ุจูุงุณุทุฉ ููุชุงุญ ุนุงู ููู ุดูุงุฏุฉ.  ุฃู ุฃูู ูู ุงููุณุชุญูู ุชุฒููู ุงูุงุชุตุงู ูุน ูู ูุฑุฌุน ูุตุฏู ูุญุฏุฏ. <br><br>  ุงูุขู ููุงู ููู ุจุณูุท ูููููุฉ ุงุณุชุฎุฏุงู SSL ูู https. <br>  ุฅุฐุง ููุช ุจุชุญุฑูู ุนููู ุ ูุณูู ูุชุถุญ ููู ูููู ููุฎุฏูุงุช ุงูุฎุงุตุฉ ูุณุฑ ุดูุก ูุง ูู ูุฐุง ุงูุชุตููู.  ูููู ุณูููููู ุฐูู ุฌููุฏูุง ูุงุฆูุฉ. <br>  ูุงูููุธูุงุช ุงูุฃุตุบุฑ ูู ููุงูุฉ ุงูุฃูู ุงููููู ุฃู ููุงูุฉ ุงููุฎุงุจุฑุงุช ุงููุฑูุฒูุฉ - ููุงุฏ ูููู ูู ุงููุณุชุญูู ูุณุฑ ูุณุชูู ุงูุญูุงูุฉ ุงูุญุงูู ุ ุญุชู ุจุงููุณุจุฉ ููุจุงุฑ ุงูุดุฎุตูุงุช. <br><br>  ุณุฃุถูู ุฃูุถูุง ุญูู ุงุชุตุงูุงุช ssh.  ูุง ุชูุฌุฏ ููุงุชูุญ ุนุงูุฉ ุ ูุงุฐุง ุชูุนู.  ูุชู ุญู ุงููุดููุฉ ุจุทุฑููุชูู. <br>  ุฎูุงุฑ ูููุฉ ูุฑูุฑ Ssh: <br>  ุนูุฏ ุฃูู ุงุชุตุงู ุ ูุฌุจ ุฃู ูุญุฐุฑ ุนููู ssh ูู ุฃูู ูุฏููุง ููุง ููุชุงุญ ุนุงู ุฌุฏูุฏ ูู ุฎุงุฏู ssh. <br>  ููุน ุงููุฒูุฏ ูู ุงูุงุชุตุงูุงุช ุ ุฅุฐุง ุธูุฑ ุงูุชุญุฐูุฑ "ููุชุงุญ ุนุงู ุฌุฏูุฏ ูู ุฎุงุฏู ssh" ุ ููุฐุง ูุนูู ุฃููู ูุญุงูููู ุงูุงุณุชูุงุน ุฅููู. <br>  ุฃู ูู ุฃูู ุงุชุตุงู ุชู ุงูุงุณุชูุงุน ุฅููู ุ ูุงูุขู ุชุชุญุฏุซ ุฅูู ุงูุฎุงุฏู ุจุฏูู ูุณุทุงุก. <br>  ูู ุงููุงูุน ุ ูุธุฑูุง ูุฃู ุญูููุฉ ุงูุชูุตุช ุนูู ุงูููุงููุงุช ุงููุงุชููุฉ ูุชู ูุดููุง ุจุณูููุฉ ูุณุฑุนุฉ ูุจุฏูู ุนูุงุก ุ ูุชู ุงุณุชุฎุฏุงู ูุฐุง ุงููุฌูู ููุท ูู ุญุงูุงุช ุฎุงุตุฉ ูุนููู ูุนูู. <br><br>  ุฎูุงุฑ ููุชุงุญ SSH: <br>  ูุฃุฎุฐ ูุญุฑู ุฃูุฑุงุต ูุญููู ุ ูููุชุจ ููุชุงุญูุง ุฎุงุตูุง ูุฎุงุฏู ssh ุนููู (ููุฐุง ุชูุฌุฏ ูุตุทูุญุงุช ููุฌููุนุฉ ูู ุงููุฑูู ุงูุฏูููุฉ ุงููููุฉ ุ ููููู ุฃูุชุจ ุจุฑูุงูุฌูุง ุชุนูููููุง ุ ูููุณ ุชุนูููุงุช ููุงุณุชุฎุฏุงู). <br>  ูุชุฑู ุงูููุชุงุญ ุงูุนุงู ุนูู ุงูุฌูุงุฒ ุญูุซ ุณูููู ุนููู ssh ููุญุงูุธ ุนููู ุฃูุถูุง ุณุฑุงู. <br>  ูููู ุจุฅุญุถุงุฑ ูุญุฑู ุงูุฃูุฑุงุต ุงููุญููู ุฅูู ุงูุฎุงุฏู ุ ููููู ุจุฅุฏุฎุงู ุงูููุชุงุญ ุงูุฎุงุต ููุณุฎู ุ ูุญุฑู ูุญุฑู ุงูุฃูุฑุงุต ุงููุญููู ููุซุฑ ุงูุบุจุงุฑ ูู ุงูุฑูุญ (ุฃู ุนูู ุงูุฃูู ุชูุณููู ุจุงูุฃุตูุงุฑ). <br>  ูุฐุง ูู ุดูุก - ุจุนุฏ ูุฐู ุงูุนูููุฉ ุณูููู ูู ุงููุณุชุญูู ูุทุน ุงุชุตุงู ssh.  ุจุงูุทุจุน ุ ุนูู ูุฏุงุฑ 10 ุณููุงุช ุ ููููู ุฑุคูุฉ ุญุฑูุฉ ุงููุฑูุฑ ุนูู ุฌูุงุฒ ููุจููุชุฑ ูุงุฆู - ูููู ูุฐู ูุตุฉ ูุฎุชููุฉ. <br><br>  ุฃุนุชุฐุฑ ุนู ุงูุญูู ูุงูููุงุฏุฉ. <br></div></div></blockquote>  ุญุชู ุงูุขู ุฃู ุงููุธุฑูุฉ ูุนุฑููุฉ.  ุณุฃููู ุนู ุชุฏูู ุฅูุดุงุก ุดูุงุฏุฉ SSL. <br><br>  ุจุงุณุชุฎุฏุงู "opensl genrsa" ูููู ุจุฅูุดุงุก ููุชุงุญ ุฎุงุต ู "ูุฑุงุบุงุช" ููููุชุงุญ ุงูุนุงู. <br>  ูุฑุณู "ุงููุฑุงุบุงุช" ุฅูู ุดุฑูุฉ ุฎุงุฑุฌูุฉ ุ ูุฏูุน ููุง ุญูุงูู 9 ุฏููุงุฑุงุช ุฃูุฑูููุฉ ููุญุตูู ุนูู ุฃุจุณุท ุดูุงุฏุฉ. <br><br>  ูู ุบุถูู ุณุงุนุชูู ุ ูุชููู ูู ูุฐู ุงูุดุฑูุฉ ุงูุฎุงุฑุฌูุฉ ููุชุงุญูุง "ุงูุนุงู" ููุฌููุนุฉ ุฃุฎุฑู ูู ุงูุนุฏูุฏ ูู ุงูููุงุชูุญ ุงูุนุงูุฉ. <br><br>  ููุงุฐุง ูุฌุจ ุฃู ุชุฏูุน ุดุฑูุฉ ุทุฑู ุซุงูุซ ูุฅุตุฏุงุฑ ููุชุงุญู ุงูุนุงู - ูุถูุฉ ูููุตูุฉ ุ ูู ููุธุฑ ูููุง ููุง. <br><br>  ุงูุขู ุฃุตุจุญ ูู ุงููุงุถุญ ูุง ูุนูู ุงูููุด: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">smtpd_tls_key_file=/etc/ssl/domain1.com.2018.key</code> </pre> <br>  ูู ูุฌูุฏ "/ etc / ssl" ูุชู ุชุฎุฒูู ุฌููุน ุงููููุงุช ุงูุฎุงุตุฉ ุจุฃุณุฆูุฉ SSL. <br>  domain1.com - ุงุณู ุงููุฌุงู. <br>  2018 ูู ุนุงู ุฅูุดุงุก ุงูููุงุชูุญ. <br>  "ููุชุงุญ" - ุชุนููู ุฃู ุงูููู ูู ููุชุงุญ ุฎุงุต. <br><br>  ููุนูู ูุฐุง ุงูููู: <br><br>  smtpd_tls_cert_file = / etc / ssl / domain1.com.2018.chained.crt <br>  domain1.com - ุงุณู ุงููุฌุงู. <br>  2018 ูู ุนุงู ุฅูุดุงุก ุงูููุงุชูุญ. <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุณูุณูุฉ - ุฅุดุงุฑุฉ ุฅูู ูุฌูุฏ ุณูุณูุฉ ูู ุงูููุงุชูุญ ุงูุนุงูุฉ (ุงูุฃูู ูู ููุชุงุญูุง ุงูุนุงู ูุงูุจุงูู ูู ูุง ุฌุงุก ูู ุงูุดุฑูุฉ ุงูุชู ุฃุตุฏุฑุช ุงูููุชุงุญ ุงูุนุงู). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crt - ุงูุชุนููู ุจุฃู ููุงู ุดูุงุฏุฉ ุฌุงูุฒุฉ (ููุชุงุญ ุนูููู ูุน ุชูุณูุฑุงุช ูููุฉ).</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">smtp_bind_address = XX.XX.XX.X0 smtp_bind_address6 = XXXX:XXXX:XXXX:XXXX:1:1:1:1</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ูุชู ุงุณุชุฎุฏุงู ูุฐุง ุงูุฅุนุฏุงุฏ ูู ูุฐู ุงูุญุงูุฉ ุ ููููู ููุชูุจ ููุซุงู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฃู ุฎุทุฃ ูู ูุฐู ุงููุนููุฉ ุณูุคุฏู ุฅูู ุฅุฑุณุงู ุงูุจุฑูุฏ ุงููุฒุนุฌ ูู ุงูุฎุงุฏู ุงูุฎุงุต ุจู (ุจุฏูู ุฅุฑุงุฏุชู). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุซู ุฃุซุจุช ููุฌููุน ุฃูู ูุณุช ูููููุง.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">recipient_delimiter = +</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑุจูุง ูุง ูุนุฑู ุงููุซูุฑูู ุ ูุฐูู ูุนุฏ ูุฐุง ุฑูุฒูุง ููุงุณููุง ููุฑุนู ุ ููุฐุง ูุฏุนูู ูู ูุจู ูุนุธู ุฎูุงุฏู ุงูุจุฑูุฏ ุงูุญุฏูุซุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ูุงู ูุฏูู ุตูุฏูู ุจุฑูุฏ "username@gmail.com" ุ ูุญุงูู ุฅุฑุณุงูู ุฅูู "username+spam@gmail.com" - ุงูุธุฑ ูุง ูุญุฏุซ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">inet_protocols = ipv4</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑุจูุง ุณูููู ูุฐุง ูุฑุจูุง. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู ูุฐุง ููุณ ููุท. </font><font style="vertical-align: inherit;">ูู ูุฌุงู ุฌุฏูุฏ ูู ุจุดูู ุงูุชุฑุงุถู IPv4 ููุท ุ ุซู ุฃููู ุจุชูููู IPv6 ููู ูุฌุงู ุนูู ุญุฏุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">virtual_transport = lmtp:unix:private/dovecot-lmtp virtual_mailbox_domains = mysql:/etc/postfix/mysql-virtual-mailbox-domains.cf virtual_mailbox_maps = mysql:/etc/postfix/mysql-virtual-mailbox-maps.cf virtual_alias_maps = mysql:/etc/postfix/mysql-virtual-alias-maps.cf</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง ูุถุน ุฃู ูู ุงูุจุฑูุฏ ุงููุงุฑุฏ ูุฐูุจ ุฅูู dovecot. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุงุนุฏ ุงููุฌุงู ุ ุตูุฏูู ุงูุจุฑูุฏ ุ ุงูุงุณู ุงููุณุชุนุงุฑ - ุงุจุญุซ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/postfix/mysql-virtual-mailbox-domains.cf</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">user = usermail password = mailpassword hosts = 127.0.0.1 dbname = servermail query = SELECT 1 FROM virtual_domains WHERE name=<span class="hljs-string"><span class="hljs-string">'%s'</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> /etc/postfix/mysql-virtual-mailbox-maps.cf </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">user = usermail password = mailpassword hosts = 127.0.0.1 dbname = servermail query = SELECT 1 FROM virtual_users WHERE email=<span class="hljs-string"><span class="hljs-string">'%s'</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> /etc/postfix/mysql-virtual-alias-maps.cf </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">user = usermail password = mailpassword hosts = 127.0.0.1 dbname = servermail query = SELECT destination FROM virtual_aliases WHERE <span class="hljs-built_in"><span class="hljs-built_in">source</span></span>=<span class="hljs-string"><span class="hljs-string">'%s'</span></span></code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># SMTP-Auth settings smtpd_sasl_type = dovecot smtpd_sasl_path = private/auth smtpd_sasl_auth_enable = yes</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนุฑู postfix ุงูุขู ุฃูู ููููู ููุท ูุจูู ุงูุจุฑูุฏ ูุฅุฑุณุงู ุงููุฒูุฏ ุนู ุทุฑูู ุงูุชูููุถ ูุน dovecot. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃูุง ุญูุง ูุง ุฃููู ุญูุง ููุงุฐุง ูุชู ุชูุฑุงุฑ ูุฐุง ููุง. </font><font style="vertical-align: inherit;">ููุฏ ุฃุดุฑูุง ุจุงููุนู ูู virtual_transport ูู ูุง ูู ูุทููุจ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู ูุธุงู postfix ูุฏูู ุฌุฏูุง - ุฑุจูุง ูููู ุงูููุงุน ูู ุงูุฃูุงู ุงูุฎูุงูู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">smtpd_recipient_restrictions = ... smtpd_helo_restrictions = ... smtpd_client_restrictions = ...</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชู ุชูููู ูุฐุง ููู ุฎุงุฏู ุจุฑูุฏ ุจุทุฑููุชู ุงูุฎุงุตุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฏู 3 ุฎูุงุฏู ุจุฑูุฏ ุชุญุช ุชุตุฑูู ููุฐู ุงูุฅุนุฏุงุฏุงุช ูุฎุชููุฉ ุฌุฏูุง ุจุณุจุจ ูุชุทูุจุงุช ุงูุงุณุชุฎุฏุงู ุงููุฎุชููุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุจ ุนููู ุงูุชููุฆุฉ ุจุนูุงูุฉ - ูุฅูุง ูุฅู ุงูุจุฑูุฏ ุงูุนุดูุงุฆู ุณูุบุฑูู ุฃู ุฃุณูุฃ ูู ุฐูู ุ ุณูุบุฑูู ุงูุจุฑูุฏ ุงูุนุดูุงุฆู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># SPF policyd-spf_time_limit = 3600</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชูููู ููุน ูู ุงูููููุงุช ุงูุฅุถุงููุฉ ุงููุชุนููุฉ ุจุงูุชุญูู ูู ูุธุงู ุงูุชุนุฑู ุนูู ูููุฉ ุงููุฑุณู (SPF) ููุฑุณุงุฆู ุงููุงุฑุฏุฉ. </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># OpenDKIM milter_default_action = accept milter_protocol = 6 smtpd_milters = unix:var/run/opendkim/opendkim.sock non_smtpd_milters = unix:var/run/opendkim/opendkim.sock</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชูููู ุฃู ุฌููุน ุงูุฑุณุงุฆู ุงูุตุงุฏุฑุฉ ูุฌุจ ุฃู ููุฏู ุชูููุน DKIM. </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># IP address per domain sender_dependent_default_transport_maps = pcre:/etc/postfix/sdd_transport.pcre</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐู ุชูุงุตูู ุฑุฆูุณูุฉ ูู ุชูุฌูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุนูุฏ ุฅุฑุณุงู ุฑุณุงุฆู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูู ุงูุจุฑุงูุฌ ุงููุตูุฉ php. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู "/etc/postfix/sdd_transport.pcre":</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">/^www-domain1@domain1\.com$/ domain1: /^www-domain2@domain1\.com$/ domain2: /^www-domain3@domain1\.com$/ domain3: /@domain1\.com$/ domain1: /@domain2\.com$/ domain2: /@domain3\.com$/ domain3:</code> </pre> <br><blockquote style=";text-align:right;direction:rtl">  โ  .  โ ,   . <br> Postfix     โ        . <br><br>     postfix    โ    ยซmaster.cfยป. <br><br>  4, 5, 6 โ  .       โ    . <br>     php       ยซfromยป.      . <br><br>     โ       nginx+fpm. <br><br>  โ       linux-user .    fpm-pool. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณุชุฎุฏู Fpm-pool ุฃู ุฅุตุฏุงุฑ ูู php (ูุนุฏ ูุฐุง ุฑุงุฆุนูุง ุนูุฏูุง ููููู ุงุณุชุฎุฏุงู ุฅุตุฏุงุฑ ูุฎุชูู ูู php ูุญุชู php.ini ูุฎุชูู ุนูู ููุณ ุงูุฎุงุฏู ููููุงูุน ุงููุฌุงูุฑุฉ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐุง ุ ูุฅู ูุณุชุฎุฏู www-domain2 ุฎุงุต ุจู Linux ูุฏูู ูููุน domain2.com. </font><font style="vertical-align: inherit;">ูุญุชูู ูุฐุง ุงููููุน ุนูู ุฑูุฒ ูุฅุฑุณุงู ุงูุฑุณุงุฆู ุฏูู ุชุญุฏูุฏ ุงูุญูู ูู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐูู ุญุชู ูู ูุฐู ุงูุญุงูุฉ ุ ุณุชุฎุชูู ุงูุฑุณุงุฆู ุจุดูู ุตุญูุญ ููู ุชุฏุฎู ุฃุจุฏูุง ูู ุงูุฑุณุงุฆู ุบูุฑ ุงููุฑุบูุจ ูููุง.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุจุฏู "/etc/postfix/master.cf" ููุง ููู: </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">... smtp inet n - y - - smtpd -o content_filter=spamassassin ... submission inet n - y - - smtpd -o syslog_name=postfix/submission -o smtpd_tls_security_level=encrypt -o smtpd_sasl_auth_enable=yes -o smtpd_client_restrictions=permit_sasl_authenticated,reject ... policyd-spf unix - nn - 0 spawn user=policyd-spf argv=/usr/bin/policyd-spf spamassassin unix - nn - - pipe user=spamd argv=/usr/bin/spamc -f -e /usr/sbin/sendmail -oi -f <span class="hljs-variable"><span class="hljs-variable">${sender}</span></span> <span class="hljs-variable"><span class="hljs-variable">${recipient}</span></span> ... domain1 unix - - n - - smtp -o smtp_bind_address=XX.XX.XX.X1 -o smtp_helo_name=domain1.com -o inet_protocols=all -o smtp_bind_address6=XXXX:XXXX:XXXX:XXXX:1:1:1:1 -o syslog_name=postfix-domain1 domain2 unix - - n - - smtp -o smtp_bind_address=XX.XX.XX.X5 -o smtp_helo_name=domain2.com -o inet_protocols=all -o smtp_bind_address6=XXXX:XXXX:XXXX:XXXX:1:2:1:1 -o syslog_name=postfix-domain2 domain3 unix - - n - - smtp -o smtp_bind_address=XX.XX.XX.X2 -o smtp_helo_name=domain3 -o inet_protocols=all -o smtp_bind_address6=XXXX:XXXX:XXXX:XXXX:1:1:5:1 -o syslog_name=postfix-domain3</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูุชู ุชูุฏูู ุงูููู ุจุงููุงูู - ููู ูุจูุฑ ุฌุฏูุง ุจุงููุนู. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุญุธุช ููุท ูุง ุชู ุชุบููุฑู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">smtp inet n - y - - smtpd -o content_filter=spamassassin ... spamassassin unix - nn - - pipe user=spamd argv=/usr/bin/spamc -f -e /usr/sbin/sendmail -oi -f <span class="hljs-variable"><span class="hljs-variable">${sender}</span></span> <span class="hljs-variable"><span class="hljs-variable">${recipient}</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฐู ูู ุงูุฅุนุฏุงุฏุงุช ุงููุชุนููุฉ ุจุงูุณุจุงูุงุณูู ูู ููุช ูุงุญู. </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">submission inet n - y - - smtpd -o syslog_name=postfix/submission -o smtpd_tls_security_level=encrypt -o smtpd_sasl_auth_enable=yes -o smtpd_client_restrictions=permit_sasl_authenticated,reject</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญู ูุณูุญ ูู ุจุงูุงุชุตุงู ุจุฎุงุฏู ุงูุจุฑูุฏ ุนุจุฑ ุงููููุฐ 587. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููููุงู ุจุฐูู ุ ุชุฃูุฏ ูู ุชุณุฌูู ุงูุฏุฎูู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">policyd-spf unix - nn - 0 spawn user=policyd-spf argv=/usr/bin/policyd-spf</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุจุชุดุบูู ุงูุชุญูู ูู ูุธุงู ุงูุชุนุฑู ุนูู ูููุฉ ุงููุฑุณู (SPF). </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">apt-get install postfix-policyd-spf-python</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุจุชุซุจูุช ุงูุญุฒูุฉ ููุญูุตุงุช ูุธุงู ุงูุชุนุฑู ุนูู ูููุฉ ุงููุฑุณู (SPF) ุฃุนูุงู. </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">domain1 unix - - n - - smtp -o smtp_bind_address=XX.XX.XX.X1 -o smtp_helo_name=domain1.com -o inet_protocols=all -o smtp_bind_address6=XXXX:XXXX:XXXX:XXXX:1:1:1:1 -o syslog_name=postfix-domain1</code> </pre> <br><blockquote style=";text-align:right;direction:rtl">    .          IPv4/IPv6 . <br><br>    rDNS. rDNS โ   -   IP . <br>         ,  helo   rDNS  ,    email. <br><br>  helo    ,      โ   . <br><br> Helo   rDNS โ    . <br>        IP . <br>  OVH โ      rDNS. <br>  tech.ru โ    . <br>  AWS โ    . <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Inet_protocols" ู "smtp_bind_address6" - ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ูุชูุญ ุจูุง ุฏุนู IPv6. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงููุณุจุฉ ูู IPv6 ุ ุชุญุชุงุฌ ุฃูุถูุง ุฅูู ุชุณุฌูู rDNS. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Syslog_name" - ููุฐุง ูู ุฃุฌู ุฑุงุญุฉ ูุฑุงุกุฉ ุงูุณุฌูุงุช.</font></font></blockquote><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃูุตู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุดุฑุงุก ุงูุดูุงุฏุงุช </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">ููุง</font></a><font style="vertical-align: inherit;"> . </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูุดุงุก ูุฌููุนุฉ ูู postfix + dovecot ููุง</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุนุฏุงุฏ ูุธุงู ุงูุชุนุฑู ุนูู ูููุฉ ุงููุฑุณู (SPF).</font></font></a> <br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ============== Dovecot ============== </font></font></h2><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">apt-get install dovecot-imapd dovecot-pop3d dovecot-lmtpd dovecot-mysql dovecot-antispam</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูููู ุงูุฎููุฉ ุ ุชุซุจูุช ุงูุญุฒู ุจุฃููุณูู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู "/etc/dovecot/conf.d/10-auth.conf"</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">disable_plaintext_auth = yes auth_mechanisms = plain login</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชูููุถ ูุดูุฑ ููุท. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู "/etc/dovecot/conf.d/10-mail.conf"</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">mail_location = maildir:/var/mail/vhosts/%d/%n</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง ูุดูุฑ ุฅูู ูููุน ุงูุญุฑูู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุฑูุฏ ุชุฎุฒูููุง ูู ูููุงุช ูุชุฌููุนูุง ุญุณุจ ุงููุฌุงู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู "/etc/dovecot/conf.d/10-master.conf"</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">service imap-login { inet_listener imap { port = 0 } inet_listener imaps { address = XX.XX.XX.X1, XX.XX.XX.X2, XX.XX.XX.X5, [XXXX:XXXX:XXXX:XXXX:1:1:1:1], [XXXX:XXXX:XXXX:XXXX:1:2:1:1], [XXXX:XXXX:XXXX:XXXX:1:1:5:1] port = 993 ssl = yes } } service pop3-login { inet_listener pop3 { port = 0 } inet_listener pop3s { address = XX.XX.XX.X1, XX.XX.XX.X2, XX.XX.XX.X5, [XXXX:XXXX:XXXX:XXXX:1:1:1:1], [XXXX:XXXX:XXXX:XXXX:1:2:1:1], [XXXX:XXXX:XXXX:XXXX:1:1:5:1] port = 995 ssl = yes } } service lmtp { unix_listener /var/spool/postfix/private/dovecot-lmtp { mode = 0600 user = postfix group = postfix } } service imap { } service pop3 { } service auth { unix_listener auth-userdb { mode = 0600 user = vmail } unix_listener /var/spool/postfix/private/auth { mode = 0666 user = postfix group = postfix } user = dovecot } service auth-worker { user = vmail } service dict { unix_listener dict { } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐุง ูู ููู ุฅุนุฏุงุฏุงุช dovecot ุงูุฑุฆูุณู. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญู ููุง ููุทุน ุงูุงุชุตุงู ุบูุฑ ุงูุขูู. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชูููู ุงูุงุชุตุงูุงุช ุงูุขููุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู "/etc/dovecot/conf.d/10-ssl.conf"</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">ssl = required ssl_cert = &lt;/etc/nginx/ssl/domain1.com.2018.chained.crt ssl_key = &lt;/etc/nginx/ssl/domain1.com.2018.key <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> XX.XX.XX.X5 { ssl_cert = &lt;/etc/nginx/ssl/domain2.com.2018.chained.crt ssl_key = &lt;/etc/nginx/ssl/domain2.com.2018.key }</code> </pre> <br><blockquote style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูููู SSL. </font><font style="vertical-align: inherit;">ูุดูุฑ ุฅูู ุฃู SSL ูุทููุจ. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงูุดูุงุฏุฉ ููุณูุง. </font><font style="vertical-align: inherit;">ูุชูุตูู ููู ูู ุงูุชูุฌูู "ุงููุญูู". </font><font style="vertical-align: inherit;">ูุดูุฑ ุนูุฏ ุงูุงุชุตุงู ุจุฃู IPv4 ูุญูู - ุฃู ุดูุงุฏุฉ SSL ูุงุณุชุฎุฏุงููุง. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงูููุงุณุจุฉ ุ ูู ูุชู ุชูููู IPv6 ููุง ุ ุณูู ุฃููู ุจุชุตุญูุญ ูุฐุง ุงูุฅุบูุงู ูููุถูุน ูู ููุช ูุงุญู. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XX.XX.XX.X5 (ุงููุฌุงู 2) - ูุง ุชูุฌุฏ ุดูุงุฏุฉ. </font><font style="vertical-align: inherit;">ูุฑุจุท ุงูุนููุงุก ุ ูุฌุจ ุชุญุฏูุฏ domain1.com. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XX.XX.XX.X2 (domain3) - ููุงู ุดูุงุฏุฉ ุ ููููู ุชุญุฏูุฏ domain1.com ุฃู domain3.com ูุชูุตูู ุงูุนููุงุก.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููู "/etc/dovecot/conf.d/15-lda.conf" </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">protocol lda { mail_plugins = <span class="hljs-variable"><span class="hljs-variable">$mail_plugins</span></span> sieve }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณุชููู ููุงู ุญุงุฌุฉ ูู ุงููุณุชูุจู ู spamassassin. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู "/etc/dovecot/conf.d/20-imap.conf"</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">protocol imap { mail_plugins = <span class="hljs-variable"><span class="hljs-variable">$mail_plugins</span></span> antispam }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐุง ูู ุงูุจุฑูุงูุฌ ุงููุณุงุนุฏ ูููุงูุญุฉ ุงูุจุฑูุฏ ุงูุชุทููู. </font><font style="vertical-align: inherit;">ูู ุงูุถุฑูุฑู ุชุฏุฑูุจ spamassasin ูู ููุช ุงูููู ูู / ุฅูู ูุฌูุฏ Spam. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู "/etc/dovecot/conf.d/20-pop3.conf"</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">protocol pop3 { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุท ูุซู ูุฐุง ุงูููู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู "/etc/dovecot/conf.d/20-lmtp.conf"</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">protocol lmtp { mail_plugins = <span class="hljs-variable"><span class="hljs-variable">$mail_plugins</span></span> sieve postmaster_address = admin@domain1.com }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูููู lmtp. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู "/etc/dovecot/conf.d/90-antispam.conf"</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">plugin { antispam_backend = pipe antispam_trash = Trash;trash antispam_spam = Junk;Spam;SPAM antispam_pipe_program_spam_arg = --spam antispam_pipe_program_notspam_arg = --ham antispam_pipe_program = /usr/bin/sa-learn antispam_pipe_program_args = --username=%Lu }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุนุฏุงุฏุงุช ุงูุชุฏุฑูุจ ุนูู Spamassasin ูู ููุช ุงูููู ูู / ุฅูู ูุฌูุฏ ุงูุจุฑูุฏ ุงูุนุดูุงุฆู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู "/etc/dovecot/conf.d/90-sieve.conf"</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">plugin { sieve = ~/.dovecot.sieve sieve_dir = ~/sieve sieve_after = /var/lib/dovecot/sieve/default.sieve }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู ูุดูุฑ ุฅูู ูุง ูุฌุจ ูุนูู ุจุฑุณุงุฆู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุงููุงุฑุฏุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู "/var/lib/dovecot/sieve/default.sieve"</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">require [<span class="hljs-string"><span class="hljs-string">"fileinto"</span></span>, <span class="hljs-string"><span class="hljs-string">"mailbox"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> header :contains <span class="hljs-string"><span class="hljs-string">"X-Spam-Flag"</span></span> <span class="hljs-string"><span class="hljs-string">"YES"</span></span> { fileinto :create <span class="hljs-string"><span class="hljs-string">"Spam"</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูุถุฑูุฑู ุชุฑุฌูุฉ ุงูููู: "sievec default.sieve". </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู "/etc/dovecot/conf.d/auth-sql.conf.ext"</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">passdb { driver = sql args = /etc/dovecot/dovecot-sql.conf.ext } userdb { driver = static args = uid=vmail gid=vmail home=/var/mail/vhosts/%d/%n }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุญุฏูุฏ ูููุงุช sql ููุชูููุถ. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงูููู ููุณู ูู ุทุฑููุฉ ุงูุชูููุถ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู "/etc/dovecot/dovecot-sql.conf.ext"</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">driver = mysql connect = host=127.0.0.1 dbname=servermail user=usermail password=password default_pass_scheme = SHA512-CRYPT password_query = SELECT email as user, password FROM virtual_users WHERE email=<span class="hljs-string"><span class="hljs-string">'%u'</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐุง ูุชูุงูู ูุน ููุณ ุฅุนุฏุงุฏุงุช postfix. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู "/etc/dovecot/dovecot.conf"</font></font><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">protocols = imap lmtp pop3 listen = *, :: dict { } !include conf.d/*.conf !include_try local.conf</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู ุงูุชูููู ุงูุฑุฆูุณู. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุดูุก ุงูููู ูู ุชุญุฏูุฏ ููุง ุ ุฅุถุงูุฉ ุจุฑูุชููููุงุช.</font></font><br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ============== SpamAssassin ============== </font></font></h2><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">apt-get install spamassassin spamc</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุจุชุซุจูุช ุงูุญุฒู. </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">adduser spamd --disabled-login</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฃุถู ูุณุชุฎุฏููุง ููุงุจุฉ ุนูู. </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> spamassassin.service</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุจุชุดุบูู ุฎุฏูุฉ spamassassin ุงูุชูุฒูู ุงูุชููุงุฆู ุนูุฏ ุงูุชูููุฏ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู "/ etc / default / spamassassin":</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">CRON=1</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุจุชุดุบูู ุงูุชุญุฏูุซ ุงูุชููุงุฆู ููููุงุนุฏ ุจุดูู ุงูุชุฑุงุถู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู "/etc/spamassassin/local.cf":</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">report_safe 0 use_bayes 1 bayes_auto_learn 1 bayes_auto_expire 1 bayes_store_module Mail::SpamAssassin::BayesStore::MySQL bayes_sql_dsn DBI:mysql:sa:localhost:3306 bayes_sql_username sa bayes_sql_password password</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูุถุฑูุฑู ุฌุนู ูุงุนุฏุฉ ุงูุจูุงูุงุช "sa" ูู ุงูุฎููุฉ ูุน ุงููุณุชุฎุฏู "sa" ุจูููุฉ ุงููุฑูุฑ "ูููุฉ ุงููุฑูุฑ" (ุงุณุชุจุฏููุง ุจุดูุก ููุงุณุจ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">report_safe - ุจุฏูุงู ูู ุงูุฑุณุงูุฉ ุ ุณูุชู ุฅุฑุณุงู ุชูุฑูุฑ ุญูู ุฑุณุงูุฉ ุงูุจุฑูุฏ ุงูุนุดูุงุฆู. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">use_bayes ูู ุฅุนุฏุงุฏุงุช ุชุนูููู ุงูุขูุฉ ุจูุงุณุทุฉ ุงูุจุฑูุฏ ุงูุนุดูุงุฆู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชู ุชุทุจูู ุฅุนุฏุงุฏุงุช spamassassin ุงููุชุจููุฉ ุณุงุจููุง ูู ุงูููุงูุฉ. </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฅุนุฏุงุฏ ุงูุนุงู ูู spamassassin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญูู ููู ุฑุณุงุฆู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุงูุนุดูุงุฆูุฉ ุงูุฌุฏูุฏุฉ ุฅูู ูุฌูุฏ IMAP Spam</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนู ูุฌููุนุฉ ุจุณูุทุฉ ูู Dovecot + SpamAssassin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃูุตู ุจูุฑุงุกุฉ ูุธุฑูุฉ ุชุนูู spamassasin ุนูุฏ ููู ุงูุญุฑูู ูู ูุฌูุฏุงุช imap (ููุง ุฃูุตู ุจุงุณุชุฎุฏุงููุง)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ============== ุงูุงุชุตุงู ุจุงููุฌุชูุน ============== </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃูุฏ ุฃูุถูุง ุฃู ุฃุทุฑุญ ููุฑุฉ ุนูู ุงููุฌุชูุน ุญูู ููููุฉ ุฒูุงุฏุฉ ูุณุชูู ุฃูุงู ุงูุฑุณุงุฆู ุงููุนุงุฏ ุชูุฌูููุง. </font><font style="vertical-align: inherit;">ูุฃููู ููุบูุณ ุจุดุฏุฉ ูู ููุถูุน ุงูุจุฑูุฏ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุชู ูุชููู ุงููุณุชุฎุฏู ูู ุฅูุดุงุก ุฒูุฌ ููุงุชูุญ ุนูู ุนูููู (outlook ุ thunderbird ุ browser-plugin ุ ...). </font><font style="vertical-align: inherit;">ุนุงู ูุฎุงุต. </font><font style="vertical-align: inherit;">ุนุงู - ุฅุฑุณุงู ุฅูู DNS. </font><font style="vertical-align: inherit;">ุฎุงุต - ุญูุธ ููุนููู. </font><font style="vertical-align: inherit;">ูููู ูุฎูุงุฏู ุงูุจุฑูุฏ ุงุณุชุฎุฏุงู ุงูููุชุงุญ ุงูุนุงู ููุฅุฑุณุงู ุฅูู ูุณุชูู ูุญุฏุฏ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุญูุงูุฉ ูู ุงูุฑุณุงุฆู ุบูุฑ ุงููุฑุบูุจ ูููุง ุจูุซู ูุฐู ุงูุฑุณุงุฆู ุงูุฅููุชุฑูููุฉ (ูุนู ุ ูู ูุชููู ุฎุงุฏู ุงูุจุฑูุฏ ูู ุฑุคูุฉ ุงููุญุชูู) - ุณูููู ูู ุงูุถุฑูุฑู ุชูุฏูู 3 ููุงุนุฏ:</font></font><br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชูููุน DKIM ุญูููู ุฅูุฒุงูู ุ SPF ุฅูุฒุงูู ุ rDNS ุฅูุฒุงูู. </font></font></li><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุดุจูุฉ ุนุตุจูุฉ ุญูู ููุถูุน ุงูุชุฏุฑูุจ ุนูู ููุงูุญุฉ ุงูุจุฑูุฏ ุงูุนุดูุงุฆู + DB ุนููู ูู ุฌุงูุจ ุงูุนููู. </font></font></li><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฌุจ ุฃู ุชููู ุฎูุงุฑุฒููุฉ ุงูุชุดููุฑ ุจุญูุซ ูุฌุจ ุนูู ุงูุฌุงูุจ ุงููุฑุณู ุฃู ูููู ุทุงูุฉ ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุฃูุซุฑ ูู 100 ูุฑุฉ ุนูู ุงูุชุดููุฑ ูู ุฌุงูุจ ุงูุงุณุชูุจุงู. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงูุฅุถุงูุฉ ุฅูู ุงูุฑุณุงุฆู ุงูุนุงูุฉ - ููุถุน ุฎุทุงุจ ุฏุนูุฉ ููุงุณู "ูุจุฏุก ุงููุฑุงุณูุงุช ุงูุขููุฉ". </font><font style="vertical-align: inherit;">ูุฑุณู ุฃุญุฏ ุงููุณุชุฎุฏููู (ุตูุฏูู ุงูุจุฑูุฏ) ุฑุณุงูุฉ ุฅูู ุตูุฏูู ุงูุจุฑูุฏ ุงูุขุฎุฑ ูุน ูุฑูู. </font><font style="vertical-align: inherit;">ูู ุงูุฑุณุงูุฉ ุ ุงูุชุฑุงุญ ุงููุต ูุจุฏุก ููุงุฉ ุงุชุตุงู ุขููุฉ ูููุฑุงุณูุงุช ูุงูููุชุงุญ ุงูุนุงู ูุตุงุญุจ ุตูุฏูู ุงูุจุฑูุฏ (ูุน ุงูููุชุงุญ ุงูุฎุงุต ุนูู ุฌุงูุจ ุงูุนููู).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููููู ุฃูุถูุง ุนูู ุฒูุฌ ูู ุงูููุงุชูุญ ุฎุตูุตูุง ููู ูุฑุงุณูุงุช. ูููู ูููุณุชุฎุฏู ุงููุณุชูู ูุจูู ูุฐุง ุงูุนุฑุถ ูุฅุฑุณุงู ููุชุงุญู ุงูุนูููู (ุงููุตูู ุฎุตูุตูุง ููุฐู ุงููุฑุงุณูุงุช). ุจุนุฏ ุฐูู ุ ูุฑุณู ุงููุณุชุฎุฏู ุงูุฃูู ุฑุณุงูุฉ ุชุญูู ุจุงูุฎุฏูุฉ (ูุดูุฑุฉ ุจุงูููุชุงุญ ุงูุนุงู ูููุณุชุฎุฏู ุงูุซุงูู) - ุนูุฏ ุงูุงุณุชูุงู ูููู ูููุณุชุฎุฏู ุงูุซุงูู ุงุนุชุจุงุฑ ููุงุฉ ุงูุงุชุตุงู ุงููุดููุฉ ููุซููุฉ. ุซู ูุฑุณู ุงููุณุชุฎุฏู ุงูุซุงูู ุฎุทุงุจ ุชุญูู - ุซู ูููู ูููุณุชุฎุฏู ุงูุฃูู ุฃูุถูุง ุงุนุชุจุงุฑ ุงูููุงุฉ ุงููุดููุฉ ูุญููุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุงูุญุฉ ุงุนุชุฑุงุถ ุงูููุงุชูุญ ุนูู ุงูุทุฑูู - ูู ุงูุถุฑูุฑู ูู ุงูุจุฑูุชูููู ุชูููุฑ ุฅููุงููุฉ ุฅุฑุณุงู ููุชุงุญ ุนุงู ูุงุญุฏ ุนูู ุงูุฃูู ุจุงุณุชุฎุฏุงู ูุญุฑู ุฃูุฑุงุต ูุญููู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงูุฃูู ูู ุฐูู ุฃู ูู ุดูุก ูุนูู (ุงูุณุคุงู ูู "ูู ุณูุฏูุน ุซูููุ"):</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุฏูู ุดูุงุฏุงุช ุจุฑูุฏูุฉ ุจูููุฉ 10 ุฏููุงุฑุงุช ููุฏุฉ 3 ุณููุงุช. </font><font style="vertical-align: inherit;">ููุง ูุณูุญ ูููุฑุณู ุจุงูุฅุดุงุฑุฉ ูู ูุธุงู ุฃุณูุงุก ุงููุทุงูุงุช ุฅูู ุฃู "ููุงุชูุญู ุงูุนุงูุฉ ููุฌูุฏุฉ". </font><font style="vertical-align: inherit;">ูุณูุนุทูู ุงููุฑุตุฉ ูุจุฏุก ุงุชุตุงู ุขูู. </font><font style="vertical-align: inherit;">ูู ููุณ ุงูููุช ุ ุฎุฐ ูุฐู ุงููุฑูุจุงุช ูุฌุงููุง. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุฎูุฑุง ูุณุชุซูุฑ gmail ูุณุชุฎุฏููู. </font><font style="vertical-align: inherit;">ููุงุจู 10 ุฏููุงุฑุงุช ูู 3 ุณููุงุช - ุงูุญู ูู ุฅูุดุงุก ูููุงุช ุงููุฑุงุณูุงุช ุงูุขููุฉ.</font></font><br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ============== ุงูุฎูุงุตุฉ ============== </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฎุชุจุงุฑ ุงูููุงูุฉ ุจุฃููููุง ุ ููุช ุณุฃุณุชุฃุฌุฑ ุฎุงุฏููุง ูุฎุตุตูุง ููุฏุฉ ุดูุฑ ูุดุฑุงุก ูุทุงู ุจุดูุงุฏุฉ SSL. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู ุธุฑูู ุงูุญูุงุฉ ุชุทูุฑุช ูุฐุง ุงุณุชูุฑุช ูุฐู ุงููุดููุฉ ููุฏุฉ ุดูุฑูู. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนูุฏูุง ุธูุฑ ููุช ุงููุฑุงุบ ูุฑุฉ ุฃุฎุฑู - ูุฑุฑุช ูุดุฑ ุงูููุงูุฉ ููุง ูู ุ ููุง ุฃุฎุงุทุฑ ุจุชุฃุฎูุฑ ุงููุดุฑ ููุฏุฉ ุนุงู ุขุฎุฑ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุฐุง ูุงู ููุงู ุงููุซูุฑ ูู ุงูุฃุณุฆูุฉ ูุซู "ูููู ูุฐุง ูู ูุชู ูุตูู ุจุชูุงุตูู ูุงููุฉ" - ููู ุงููุญุชูู ุฃู ุชููู ููุงู ููู ูุฃุฎุฐ ุฎุงุฏู ูุฎุตุต ูุน ูุทุงู ุฌุฏูุฏ ูุดูุงุฏุฉ SSL ุฌุฏูุฏุฉ ูุงููุตู ุจูุฒูุฏ ูู ุงูุชูุงุตูู ูุงูุฃูู ูู ุฐูู - ุชุญุฏูุฏ ุฌููุน ุงูุชูุงุตูู ุงููููุฉ ุงูููููุฏุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุฑุบุจ ุฃูุถูุง ูู ุชููู ุชุนูููุงุช ุญูู ููุถูุน ุงูุฃููุงุฑ ุญูู ุดูุงุฏุงุช ุงูุจุฑูุฏ. ุฅุฐุง ููุช ุชุญุจ ุงูููุฑุฉ ุ ูุณุฃุญุงูู ุงูุนุซูุฑ ุนูู ุงูููุฉ ููุชุงุจุฉ ูุณูุฏุฉ ูู rfc.</font></font><br><br> <b>     โ     . <br>       โ     . <br>           .</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar413689/">https://habr.com/ru/post/ar413689/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar413675/index.html">ุฌููุฑ 2018: ูุงุฏู ูุทูุฑู ุฌุงูุง ุงููุฌููููู</a></li>
<li><a href="../ar413677/index.html">ุฅุทูุงู ROS ุนูู ุงูุฑูุจูุช EduMIP ุฐุงุชู ุงูุชูุงุฒู</a></li>
<li><a href="../ar413679/index.html">ุงูุฒุงูู 6. ุณูุทุฉ ุงูููุงู ุงูููุณุทูููุฉ. ูุญุฏุงุช ุงูุชุญููู ุงูุจุทูุฆุฉ. ุงููุดุฑ ุงูุชููุงุฆู ูู Firebase</a></li>
<li><a href="../ar413681/index.html">ุชูููุฉ ุชุทููุฑ ุฎูุงุฏู ููุซูู ุจูุง ููุบุงูุฉ ุนูู Go</a></li>
<li><a href="../ar413683/index.html">ูุงู ILV ุจุฅูุบุงุก ุญุธุฑ 7 ููุงููู ุนููุงู IP. ุชุจูู ููููุฉ 4 ููุงููู</a></li>
<li><a href="../ar413691/index.html">ุงุจุฏุฃ</a></li>
<li><a href="../ar413693/index.html">ุตูุงุนุฉ ูุฏููุฉ: ููุญุฉ ููุงุชูุญ ูุงุจูุฉ ููุจุฑูุฌุฉ ููุชุฏุงูู ุจููุณู ุนุจุฑ ุงูุฅูุชุฑูุช</a></li>
<li><a href="../ar413695/index.html">ุฃูุงู Messenger: ููุงุฐุง ูุฏ ูููู ุชุฎุฒูู ุงูุฑุณุงุฆู ุนูู blockchain ููุฑุฉ ุฌูุฏุฉ</a></li>
<li><a href="../ar413697/index.html">ููู ูุง ุชูุชุจ ุงูุฑูุฒ</a></li>
<li><a href="../ar413699/index.html">"ูู ูุซูุฑ ุงููุงุก - 2": ุฃู ูู ูุง ุชุฑูุฏ ูุนุฑูุชู ุนู ุงูุชูุงุถุญ ุงูุนูุณู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>