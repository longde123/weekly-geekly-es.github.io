<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚èπÔ∏è üå°Ô∏è üë®üèø‚Äç‚úàÔ∏è Sprechen Sie √ºber PostgreSQL. Interview mit Alexei Lesovsky im Podcast von Zinc Prod. Teil eins üïò üöï üìΩÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="K√ºrzlich haben wir Alexei Lesovsky von Data Egret eingeladen, Zinc Sale zu √ºbertragen . Das Gespr√§ch erwies sich als interessant und informativ, daher...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sprechen Sie √ºber PostgreSQL. Interview mit Alexei Lesovsky im Podcast von Zinc Prod. Teil eins</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485322/"><blockquote>  K√ºrzlich haben wir Alexei Lesovsky von <a href="https://www.dataegret.ru/" rel="nofollow">Data Egret</a> eingeladen, <a href="https://soundcloud.com/znprod" rel="nofollow">Zinc Sale zu √ºbertragen</a> .  Das Gespr√§ch erwies sich als interessant und informativ, daher biete ich Ihnen die Niederschrift dieser Ausgabe an.  Aufgrund des beeindruckenden Volumens war es notwendig, den Text in Teile zu zerlegen.  Wenn Sie zu faul sind, um auf die Fortsetzung zu warten, k√∂nnen Sie sich hier einfach die Audioversion anh√∂ren. </blockquote><p>  Hallo allerseits, dies ist die vierzigste Ausgabe des Zinc Prod-Podcasts, und Anton Okolelov, Nikita Vasilchenko und Oleg Gritsak sind st√§ndige Gastgeber bei uns im Studio. </p><br><p>  <strong>Anton</strong> : Also, heute haben wir einen Gast, Alexey Lesovsky.  Lesha, bitte stell dich vor, wer du bist, was du tust und so weiter. </p><a name="habracut"></a><br><p> <strong>Alexei</strong> : Hallo zusammen, mein Name ist Alexei Lesovsky, wie Antokha mich bereits vorgestellt hat.  Ich verwalte Postgres, ich bin PostgreSQL DBA (Datenbankadministrator), ich arbeite jeden Tag, 7 Tage die Woche mit dem Login und verwalte Client-Datenbanken.  Wir haben ein B√ºro - es ist ein Beratungsunternehmen, es ist mit Verwaltung, Support und Support besch√§ftigt.  Und sehr unterschiedliche Leute kommen mit ihren Datenbanken zu uns, in der Regel sind dies Unternehmen - klein, gro√ü, klein, ganz unterschiedlich - sie haben Probleme mit der Datenbank, wir analysieren diese Probleme und versuchen sie irgendwie zu beheben.  Tats√§chlich l√∂sen wir die Probleme anderer Menschen, anderer Unternehmen.  Irgendwie so. </p><br><p>  Nun, in meiner Freizeit mache ich gerne verschiedene Dinge, gehe durch den Wald, gehe snowboarden, wandern, trinke Bier </p><br><p>  <strong>Anton</strong> : trink ger√§uchertes Bier </p><br><p>  <strong>Nikita</strong> : Vor der Ver√∂ffentlichung sprach Lyokha √ºber ger√§uchertes Bier </p><br><p>  <strong>Alexei</strong> : Ja, ger√§uchertes Bier, es gibt so ein leckeres, empfehle ich.  Rauchbier Merzen. </p><br><p>  <strong>Anton</strong> : Ok, bitte sag mir, du Dbshnik, du arbeitest schon lange, mehrere Jahre.  Wie schwer ist es  Sie rufen dich nachts an und bitten dich, die Basis zu reparieren.  Ich habe dich vor ungef√§hr einem oder einem halben Jahr um f√ºnf Uhr morgens angerufen. </p><br><p>  <strong>Alexei</strong> : Ja, es war eine Frage. </p><br><p>  <strong>Anton</strong> : Wie √ºberlebst du? Sag es mir </p><br><p>  <strong>Alexey</strong> : H√∂r zu, ich arbeite seit 2014.  Bis 2014 war ich als Linux-Administrator in der Webentwicklung t√§tig.  Der Administrator hat eine Menge Dinge, wir hatten KVM-Virtualisierung, es gab eine Menge Linux, es gab alle Arten von Ruby-on-Rails, Nginxs, PHP, Rails ... </p><br><p>  <strong>Oleg</strong> : Docker schon? </p><br><p>  <strong>Alexey</strong> : docker hat gerade erst begonnen, wir haben es nirgendwo in der Produktion eingef√ºhrt, aber die Tendenzen daf√ºr haben bereits begonnen. </p><br><p>  Und es gab viele Postgres in unserem B√ºro.  Dann jagte ich einen langen Rubel und entschied, dass ich gleichzeitig an zwei Jobs arbeiten k√∂nnte.  Und er begann als Administrator in einem Moskauer B√ºro zu arbeiten.  Ich habe zwei Werke zusammengefasst, da nur die Datenbanken von Postgresql consulting verwaltet wurden.  Es gab Max Boguk, Ilya Kosmodemyansky, und als Administrator begann ich, einen Teil der mit der Botschaft verbundenen Aufgaben zu erledigen.  Nun, d.h.  Ich fing leise an, ihr Brot zu nehmen.  Und irgendwann sagt Max zu mir: H√∂r zu und lass dich mit uns an die Arbeit machen.  Sie werden alle Ihre Arbeit verlassen, Teilzeitjobs, Sie werden f√ºr Vollzeit zu uns kommen. </p><br><p>  Nun, ich stimmte zu, ich z√∂gerte nicht, im Prinzip wurde mir ein vergleichbares Gehalt angeboten, und ich bekam einen Job und fing an, von zu Hause aus zu arbeiten, und nun, seit 2014, stellte sich heraus, arbeite ich seit 5 Jahren, ich arbeite speziell mit dem Vater. Auf die alte Art arbeite ich aus Gewohnheit mit allen m√∂glichen Admin-Themen.  Das hei√üt  Wenn es in unserer Firma ein Problem mit etwas gibt, das von der Administratorseite zu verstehen ist, werfen sie mich ab, ich verstehe </p><br><p>  <strong>Anton</strong> : Aber im Allgemeinen ist es notwendig, diese Admin-Sachen zu kennen?  Es ist nicht nur da, die Basis befindet sich im luftleeren Raum, es dreht sich irgendwo, Sie m√ºssen das Betriebssystem konfigurieren, oder? </p><br><p>  <strong>Alexei</strong> : Ja, ja, genau deshalb, weil er sich im Allgemeinen stark auf die Betriebssystem-Subsysteme, den virtuellen Speicher und die Datentr√§gerverwaltung verl√§sst, d. H.  Es ist, als ob er selbst keine Ressourcen direkt bedient, als ob er all diese Arbeiten auf das Betriebssystem entl√§dt, und er selbst verwaltet die Datentr√§ger-E / A, die Speicherseitenverwaltung, das ist alles, die Prozessumschaltung, und dementsprechend m√ºssen Sie, wenn Sie auf ein Herunterfahren von Postgres sto√üen Es gibt auch einen kleinen Hack im Betriebssystem, wie alles dort funktioniert und wie es an der Schnittstelle mit Postgres funktioniert. </p><br><p>  Wenn zum Beispiel mit Oracle verglichen wird, hat Oracle zum Beispiel seine eigenen Subsysteme, die mit Eingabe-Ausgabe arbeiten, d.h.  Sie sind hinter dem Betriebssystem, sie k√∂nnen direkt mit der Festplatte arbeiten, aber in Posgres ist dies nicht, Sie m√ºssen wissen, wie das Betriebssystem mit der Datenbank funktioniert. </p><br><p>  <strong>Oleg</strong> : Musstest du postgres unter Windows unterst√ºtzen? </p><br><p>  <strong>Alexei</strong> : Ja, ich musste, wir haben einen Kunden, sie arbeiten mit Windows, wir haben in einer Art St. Petersburg-B√ºro gearbeitet und eine Pr√ºfung der Datenbank f√ºr sie durchgef√ºhrt.  Ihre Basis war Windows, es war im Allgemeinen be√§ngstigend, wir haben √ºber das Terminalprotokoll eine Verbindung zu einem Protokoll hergestellt, Remote Desktop ge√∂ffnet und dort einige Dinge im Zusammenhang mit der Aufzeichnung der Leistung gestartet.  Kurz gesagt, es war schwer, be√§ngstigend, wie ein schrecklicher Traum jetzt erinnert wird.  Und jetzt sitzen die Kunden im Grunde alle auf Linux.  Praktisch niemand ist unter Windows. </p><br><p>  <strong>Oleg</strong> : Was ist der Hauptschmerz bei Postgre, den jeder bemerken kann? </p><br><p>  <strong>Alexey</strong> : Viele Leute wollen einen Auto-Filer und einen Multi-Master.  Na ja, Multimaster nat√ºrlich so etwas, unerreichbar.  Aber alle haben mit Galera (mit Mysql) gearbeitet und sie sagen: Warum wollen wir auch einen Multimaster im Gange? </p><br><p>  Nun, im Fortschritt gibt es solche Dinge, aber nicht im progressiven Kern selbst, es gibt solche Dinge, die den Multimaster-Typ implementieren, aber noch gar nicht produziert wurden.  Aber die Leute wollen einen Multimaster.  Und die Leute wollen auch einen Auto-Filer.  Aber jetzt, Gott sei Dank, ist Patroni aufgetaucht. Auf Patroni k√∂nnen Sie einen Auto-Filer erstellen. Die Leute f√ºhren ihn langsam ein.  Nun, aus meiner Sicht ist Patroni im Allgemeinen zum De-facto-Standard geworden.  Viele gro√üe Unternehmen setzen es bereits um.  Das gleiche Gitlab, sie haben k√ºrzlich Berichte erstellt, sie verwenden Patroni, sie sind mit allem zufrieden, jeder ist gl√ºcklich. </p><br><p>  <strong>Anton</strong> : H√∂ren Sie, k√∂nnen Sie uns auf den Punkt bringen, was Kunden f√ºr einfache Programmierer sind?  Wir h√∂ren haupts√§chlich Teamleitern und Programmierern zu </p><br><p>  <strong>Nikita</strong> : Warte, darf ich dich t√∂ten, und ich werde Nicht-Programmierer noch mehr bitten, zu erkl√§ren, was ein Multimaster ist </p><br><p>  <strong>Alexei</strong> : Sehen Sie, stellen Sie sich jetzt vor, Antokha ist ein Programmierer, er schreibt Anwendungen und die Anwendung muss ihre Daten irgendwo speichern.  Er legt sie in die Basis, in die Botschaft.  Irgendwann befindet sich die Datenbank auf einem Server und dann einmal auf dem Server - und funktioniert nicht mehr.  Das Netzteil ist durchgebrannt und die Anwendung muss mit der Basisstation weiterarbeiten.  Und hier ergibt sich die Option, dass wir eine Art Kopie der Datenbank ben√∂tigen, um weiter damit arbeiten zu k√∂nnen.  Wechseln Sie entweder dorthin, und f√ºhren Sie im Idealfall keinen Wechsel durch, damit unsere Anwendung von dieser zweiten Basis wei√ü und weiterhin darauf schreibt. </p><br><p>  Dies ist eigentlich ein Multimaster, wenn wir mehrere Knoten zum Lesen und Schreiben zur Verf√ºgung haben und unsere Anwendung gleichzeitig damit arbeiten und Daten auf einen dieser Knoten schreiben und Daten von diesen Knoten lesen kann, aber die Natur ist so angeordnet, dass es so ist nicht ganz im Idealfall erreicht, und es gibt Vor- und Nachteile, es gibt Nachteile, eigene Anwendungsf√§lle f√ºr die Verwendung des Multimasters.  Das h√§ufigste Beispiel ist, dass Sie nicht relativ gesehen dieselben Daten in zwei Instanzen schreiben k√∂nnen, z. B. mit derselben Tabelle arbeiten, √ºber zwei Server in dieselbe Tabelle schreiben, Konflikte auftreten und diese gel√∂st werden m√ºssen. Dies ist ein Problem Daher ist es notwendig zu schreiben, wenn wir in eine Tabelle schreiben, dann schreiben wir nur √ºber einen Server. </p><br><p>  <strong>Nikita</strong> : und das h√§ngt direkt mit dem Auto-Fan zusammen, ja, ist er verbunden? </p><br><p>  <strong>Alexei</strong> : Ja, und das liegt am Autofeldspieler, hier folgt sozusagen einer aus dem anderen.  Wenn wir uns keinen Multimaster leisten k√∂nnen, wollen wir einen transparenten Mechanismus, der den Ersatzknoten in den Master-Modus schaltet, d. H.  Wir haben eine Anwendung, die funktioniert, und sobald die Anwendung aus der Datenbank entfernt wurde, m√∂chte der Entwickler die Konfiguration dieser Anwendung nicht √§ndern und die neue Datenbankadresse dort angeben. Starten Sie die Anwendung neu, insbesondere, wenn viele Anwendungen vorhanden sind.  Ich m√∂chte eine Art transparenten Mechanismus, der irgendwo unter der Haube funktioniert, die Datenbank wechselt und unsere Anwendung mit derselben Adresse arbeitet und weiter aus dieser Datenbank liest.  Zu diesem Zweck ben√∂tigen Sie bereits einen Auto-Filer, der den Ersatzknoten transparent in den Assistentenmodus versetzt. Hierzu wird nur Patroni verwendet </p><br><p>  <strong>Anton</strong> : Ist Patroni ein reiner Schalter oder eine Gabel aus Postgres, eine Art Add-On? </p><br><p>  <strong>Alexei</strong> : Dies ist sozusagen ein separater Dienst, ein separater Prozess, der auf einem Host mit einer Datenbank ausgef√ºhrt wird.  Und er √ºberwacht den Status des Post-Cluster-Clusters.  Dabei werden zwei Ziele verfolgt - Autofailover und Cluster-Management.  In diesem Fall erhalten wir jedoch einen verteilten Cluster, der jedoch mehrere Knoten, einen Master und mehrere Replikate enth√§lt.  Dementsprechend m√ºssen Sie den Status des Clusters st√§ndig √ºberwachen und feststellen, ob der Master am Leben ist.  Wenn er pl√∂tzlich stirbt, m√ºssen Sie in die Rolle eines "Masters" eines anderen Servers wechseln.  Und daf√ºr gibt es im Allgemeinen zwei Ans√§tze, wie man diesen Ansichtscluster unterst√ºtzt, die Darstellung in dem Cluster, wie er im Moment leben soll.  Es gibt eine Option, wenn die Clusterknoten sich gegenseitig √ºberpr√ºfen.  Und Sie k√∂nnen diesen Zustand au√üerhalb speichern, d.h.  Au√üerhalb des Clusters.  Und nur Patroni nutzt diesen Ansatz und speichert den Zustand des Clusters im dritten System.  Dies ist normalerweise eine Art DCS (Distributed Storage System Configuration).  Es kann etcd, consul oder es kann kuberenetesovsky etcd sein.  Das hei√üt  je nachdem was die infrastruktur ist.  Nun und dementsprechend speichert Patroni einfach einen Clusterstatus in diesem DCS-System und aktualisiert ihn. </p><br><p>  Wenn pl√∂tzlich einer der Knoten pl√∂tzlich ausf√§llt, wird ein neuer Knoten ausgew√§hlt.  F√§llt dieser Master beispielsweise aus, wird ein neuer Master ausgew√§hlt und dieser Zustand in DCS erneut aktualisiert.  Und hier unterst√ºtzt Patroni auf Kosten von DCS die Gesundheit des Clusters. </p><br><p>  <strong>Anton</strong> : Und wenn das Netzwerk zwischen Patroni und der Basis blinzelte? </p><br><p>  <strong>Alexei</strong> : Nun, sehen Sie, es gibt eine Datenbank, es ist entweder eine Art Server, oder es kann, sagen wir, in den Kubernetes eine Art Sub sein.  Angenommen, es handelt sich um einen Server.  Auf demselben Server wird eine Datenbank ausgef√ºhrt, und auf demselben Server wird der Patroni-Agent ausgef√ºhrt.  Dies ist ein einfacher Prozess, sie arbeiten auf demselben Host und kommunizieren relativ sprechend auf localhost.  Unser Netzwerk blinkt m√∂glicherweise zwischen dem DCS-Repository und dem Host, auf dem die Basis und Patroni arbeiten. </p><br><p>  Es kann verschiedene M√∂glichkeiten geben.  Abh√§ngig davon, wie stark dieses Netzwerkblinken ist.  Wenn es sich um einen Master handelte und sich herausstellte, dass er isoliert war, stellen die anderen Knoten fest, dass der Master nicht mehr vorhanden ist.  Sie w√§hlen einfach einen neuen Master aus, und er sieht den alten Master, von dem er isoliert ist, und Patroni startet ihn im schreibgesch√ºtzten Modus neu.  Nun, damit es kein gespaltenes Gehirn gibt.  Es ist schlecht, wenn unsere Anwendung gleichzeitig auf zwei Knoten schreibt.  Dann m√ºssen die Entwickler die Daten rechen, und dies ist eine sehr schwierige Arbeit - um diese Daten in einer konsistenten Form zu sammeln.  Daher startet das Spannfutter den Knoten nur mit Lesezugriff neu und das wars und es funktioniert.  Sobald das Netzwerk wiederhergestellt ist, wird Patroni in der Lage sein, DCS zu erreichen, die Cluster-Ansicht dort weiter zu koordinieren und eine vereinbarte L√∂sung zu finden.  H√∂chstwahrscheinlich wird dieser isolierte Knoten, der ein alter Master war, als Replikat mit dem neuen Master verbunden ... </p><br><p>  <strong>Anton</strong> .  Wie funktioniert das in der Praxis?  Gibt es irgendwelche Probleme, Fallstricke.  Damit Oleg beispielsweise Patroni √ºbernehmen und umsetzen kann, muss er eine Entscheidung treffen. </p><br><p>  <strong>Oleg</strong> .  Ja, sofort </p><br><p>  <strong>Alexey</strong> .  Schauen Sie, wir setzen Patroni seit letztem Jahr bei Kunden ein.  Wir haben den ersten Kunden meiner Meinung nach im November 2018 erschienen.  Und zu diesem Zeitpunkt hatten wir noch keine sehr gute Vorstellung davon, wie wir damit arbeiten sollten, aber f√ºr das Jahr, in dem wir gearbeitet haben, passt im Prinzip alles zu uns.  Wir haben gelernt, wie man es kocht.  Grunds√§tzlich sind, um es in Erinnerung zu rufen, nicht viele Schritte erforderlich, buchst√§blich zwei oder drei Aktionen von der Seite von postgres, von der Seite der Benutzerkonfigurationen, und all dies funktioniert ziemlich gut. </p><br><p>  Das St√ºck ist zuverl√§ssig.  Es ist zun√§chst einfach, es ist in Python geschrieben, es verbraucht wenig Speicher und arbeitet im Prinzip zuverl√§ssig.  Das einzige in der Infrastruktur sollte dieses DCS sein.  Aber in der Regel ist entweder Consul oder etcd notwendig.  Aber f√ºr viele Unternehmen wird dieses Ding bereits f√ºr die unterschiedlichsten Service-Discovery-Vorg√§nge verwendet, daher gibt es in der Regel keine Probleme damit. </p><br><p>  Und was f√ºr Probleme entstehen: Das grundlegendste Problem, das die Leute nicht sofort haben, ist, dass wir mit dem Auto-Filer einen Teil der Daten verlieren k√∂nnen </p><br><p>  <strong>Oleg</strong> : wegen der Replikationsverz√∂gerung? </p><br><p>  <strong>Alexei</strong> : Stellen Sie sich eine Situation vor, in der ein Auto-Filer w√§hrend der Replikation auftritt. Der alte Master ist offline gegangen, aber wir haben immer noch einen Teil der Daten in ihn geschrieben.  Angenommen, es liegt eine Replikationsverz√∂gerung vor, ein neuer Master wird aus anderen Replikaten ausgew√§hlt.  Ein neuer Master wird ausgel√∂st, und wenn Patroni so konfiguriert ist, dass der ausgefallene Knoten automatisch in den Cluster aufgenommen wird, z. B., dass der Autostart von Diensten aktiviert wird. Wenn der alte Master ausgel√∂st wird, stellt er fest, dass er kein Master mehr ist und sich mit dem neuen Master verbindet und werde sein Stichwort.  In diesem Moment f√ºhrt er den Befehl pg_rewind aus. </p><br><p>  Dieser Befehl spult das Transaktionsprotokoll auf dem alten Knoten (dem alten Master) zur√ºck, bis eine Verbindung zum neuen Master hergestellt werden kann, dh das Transaktionsprotokoll wird √ºberschrieben.  An diesem Punkt k√∂nnen wir einige der Daten verlieren.  In Patroni selbst gibt es wenig Schutz, es gibt einige Wendungen, die es Repliken erm√∂glichen, nicht an Wahlen mit gro√üem R√ºckstand teilzunehmen.  Wenn beispielsweise alle Replikate eine gro√üe Verz√∂gerung aufweisen, werden die Wahlen einfach nicht eingeleitet, und der Administrator muss manuell eingreifen, damit der Administrator die automatische Datei von Hand starten kann.  Oder sie warten alle, bis der alte Meister aufsteht.  Bis seine Arbeit wiederhergestellt ist.  Und sie werden bereits damit verbunden sein und es weiterhin fangen. </p><br><p>  Nun, das hei√üt, in Patroni gibt es Mechanismen, die es Ihnen erm√∂glichen, keine Daten zu verlieren, aber es gibt ein Risiko, also m√ºssen Sie vorsichtig sein </p><br><p>  <strong>Anton</strong> : Was ist mit der synchronen Replikation? </p><br><p>  <strong>Alexei</strong> : Sie sehen, wenn wir die synchrone Replikation verwenden, verlieren wir die Leistung.  Nicht jeder kann diesen Deal machen.  Wenn wir jedoch die synchrone Replikation verwenden, wird das Risiko eines Datenverlusts verringert.  Wenn wir jedoch mehrere Knoten verwenden, z. B. mehr als zwei, m√ºssen wir die Option weiterhin in Betracht ziehen, wenn sowohl auf dem Master als auch auf dem synchronen Replikat ein Unfall aufgetreten ist.  Und wir haben noch eine zweite Replik, und es k√∂nnte sich herausstellen, dass wir sie einfangen und einige Daten wieder verlieren k√∂nnen.  Verschiedene Optionen sind m√∂glich, sie m√ºssen bewertet, betrachtet und verstanden werden, ob ein solches Verhalten zu uns passt oder nicht. </p><br><p>  <strong>Anton</strong> : H√∂r zu, nur zwei Server fallen ab - es ist wie eine Invasion von Au√üerirdischen </p><br><p>  <strong>Aleksey</strong> : und die alte Frau hat einen Slammer </p><br><p>  <strong>Oleg</strong> : Erinnern Sie sich noch an denselben Anruf um f√ºnf Uhr morgens nach Lesha zum letzten Mal, mit dem es interessanterweise zu tun hatte, Anton, und nicht, dass wir sofort zwei St√ºtzpunkte verloren haben? </p><br><p>  <strong>Anton</strong> : Es war ein menschlicher Faktor.  Nun ja, das passiert. </p><br><p>  <strong>Alexey</strong> : Ich kann mich √ºbrigens nicht an den Grund f√ºr den Anruf erinnern </p><br><p>  <strong>Anton</strong> : Wir haben zwei Server dorthin transferiert, sie haben parallel gearbeitet, Daten aufgezeichnet, das ist egal.  Und die Systeme k√∂nnten auf einem funktionieren, aber eines wurde in ein anderes Rechenzentrum √ºbertragen und eingeschaltet.  Der zweite wurde so weit transportiert, und dort wurde zum Zeitpunkt der Installation eine Art Verkabelung ber√ºhrt, und der alte wurde ebenfalls abgeschnitten - sie mischten etwas durch.  Im Allgemeinen fielen wir zwei Server aus, begannen zu steigen, und da sie f√ºr die Aufzeichnung starr konfiguriert waren, hatten sie sehr seltene Checkpoints oder √§hnliches.  Es hat lange angefangen, wir haben nicht verstanden, was geschah </p><br><p>  <strong>Oleg</strong> : einhundert Gigs Wal-Logs </p><br><p>  <strong>Anton</strong> : Wir haben nicht verstanden, was passiert ist, warum es nicht gestartet ist, und deshalb musste ich einen Anruf t√§tigen.  Naja, eigentlich gab es nichts besonderes zu tun ... </p><br><p>  <strong>Alexei</strong> : Nun, es gibt das Einzige, was wir wahrscheinlich verbunden haben. Wir haben gesehen, dass alles in Ordnung ist </p><br><p>  <strong>Oleg</strong> : best√§tigte den Tod des Patienten </p><br><p>  <strong>Anton</strong> : Tats√§chlich musstest du im Gro√üen und Ganzen nur warten. </p><br><p>  <strong>Alexey</strong> .  Ja, das ist ein bekanntes Problem.  Bei einigen Einstellungen sind die Pr√ºfpunkte lang.  Es gibt so ein Problem. </p><br><p>  Aber wenn Sie sich an diesen Nachtanruf erinnern, haben wir in der Praxis selten einen Nachtanruf, sondern eine spezielle Automatisierung eingerichtet - im Einsatz ist alles so, wie es sein sollte, ausgew√§hlt nach einem speziellen Zeitplan.  Also, wenn Sie sich erinnern, wird vielleicht einmal alle sechs Monate jemand anrufen </p><br><p>  <strong>Oleg</strong> : Alles aus unserer Firma ist wahrscheinlich </p><br><p>  <strong>Alexey</strong> : Nein, anders </p><br><p>  <strong>Anton</strong> : Oleg, ruf √∂fter an </p><br><p>  <strong>Oleg</strong> : Wir werden heute umstellen. Ich werde wahrscheinlich anrufen </p><br><p>  <strong>Alexey</strong> : Wir haben Leute, ihre Abendzeit geht zu Ende, sie werden einfach arbeiten </p><br><p>  <strong>Anton</strong> : H√∂r zu, Lech, du hast gesagt, Patroni hat einige Analoga.  Wie unterscheiden sie sich, was sind sie? </p><br><p>  <strong>Alexey</strong> : Grunds√§tzlich gibt es zwei M√∂glichkeiten, es gibt repmgr, diese Sache ist vor langer Zeit aufgetaucht, vor ungef√§hr 10 Jahren.  Es implementiert einen Mechanismus, wenn die Knoten eines Post-Grace-Clusters sich gegenseitig √ºberpr√ºfen, wer lebt, wer nicht lebt.  Aber meiner Meinung nach ist das nicht sehr, ich mag dieses Arbeitsschema nicht wirklich. </p><br><p>  Und es ist kein Auto-Filer im Auslieferungszustand, repmgr wurde urspr√ºnglich speziell f√ºr die Verwaltung des Clusters und f√ºr die manuelle Umschaltung f√ºr die Umschaltung gesch√§rft.  Und wenn Sie direkt automatisch filern m√∂chten, m√ºssen Sie die Demoversion repmgrd separat installieren, und, wie sich herausstellt, wird die automatische Datei hier gestartet.  Die Sache ist praktisch, gut, aber ja - wir haben keinen Auto-Filer im Auslieferungszustand.  Sie m√ºssen es separat setzen.  Im Allgemeinen ist das Ding gut, praktisch, in dem Sinne, dass es gut konfigurierbar ist, es ist praktisch, clusterbasierte Cluster zu verwalten.  Sie ist so flexibel, anpassbar.  Repliken k√∂nnen auf verschiedene Arten gegossen werden.  Von Backups, von Replikaten bis zu anderen, vom Master.  Kurz gesagt, so eine flexible Sache, weil 10 Jahre.  Und viele verschiedene Features wurden eingebaut, es ist sehr gut. </p><br><p>  Eine weitere Option ist Stolon.  Er erschien ungef√§hr zur gleichen Zeit wie Patroni, etwas sp√§ter.  Es ist auf Go geschrieben. </p><br><p>  Aber es hat eine verzweigtere Architektur.  Wenn Sie die Projektwebsite √∂ffnen, werden Bilder angezeigt, und Stolon selbst besteht aus mehreren Komponenten.  Er hat Keeper-Knoten, die mit Datenbanken arbeiten, die Postges ausl√∂sen.  Dann gibt es die sogenannten Sentinel-Knoten.  Sie √ºberwachen den Status des Clusters, √ºberpr√ºfen dessen Verf√ºgbarkeit und stellen sicher, dass die Knoten aktiv oder nicht aktiv sind.  Sie verwalten den Status des Clusters und konfigurieren ihn neu, wenn etwas passiert. </p><br><p>  Und es gibt sogenannte Proxy-Knoten, √ºber die der gesamte Datenverkehr l√§uft.  Die Client-Anwendung arbeitet mit Proxys.   -,  -   ,       .  Das hei√üt    .  ,   , Stolon     DCS,    consul, etcd.  -       . </p><br><p>    ,      -  ,    bare metal  ,  ,       - ,   .       .        (   -)    ,       ,       . </p><br><p>      ,     .      . ,           . ,         .     oltp-      .   Stolon    ,       . </p><br><p>     ,  6  8,    .     ,    ,  .   ,     ‚Äî wal_keep_segments ‚Äî   - ,   ,    , .      ,    -  . ,        .       .  Das hei√üt        ,    . , ,    .   ,     ‚Äî     .      . </p><br><p> <strong></strong> : , ,   -  Citus?   ,    . </p><br><p> <strong></strong> : Citus ‚Äî    . Citus   ,      CitusDB, -.       ,      ,     ,     </p><br><p> <strong></strong> :  ? </p><br><p> <strong></strong> :  ,  ,    .      .           ,  pg autofailover.       ,      .    ,      ,   . ,      ,        .    ,   ,  .    ,       ,        .  Das hei√üt         . </p><br><p> <strong></strong> :  Citus.    ,       ,          .   ‚Äî   ,    ... </p><br><p> <strong></strong> : , ,  </p><br><p> <strong></strong> : ,     ,           ,  ,   ,  </p><br><p> <strong></strong> :  ,     ,      .  ,   ,  ,   .     "in the wild"  .        ,    . </p><br><p>          ,       <a href="https://soundcloud.com/znprod" rel="nofollow">" "</a> ,   ! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de485322/">https://habr.com/ru/post/de485322/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de485300/index.html">Neuer Ausbruch von H2Miner-W√ºrmern, die Redis RCE ausnutzen, entdeckt</a></li>
<li><a href="../de485304/index.html">Ein paar Tricks mit Iframe-Elementen</a></li>
<li><a href="../de485312/index.html">DevOps f√ºr Mobile Apps</a></li>
<li><a href="../de485316/index.html">Alle Google-SERPs sehen jetzt wie Anzeigen aus</a></li>
<li><a href="../de485318/index.html">Hinzuf√ºgen von Sch√∂nheit und Interaktivit√§t zu Jupyter Notebooks</a></li>
<li><a href="../de485324/index.html">Multithreading in Qt-Widgets</a></li>
<li><a href="../de485326/index.html">Erstellen von Micro-Frontends mit Winkelelementen: Ein Leitfaden f√ºr Anf√§nger</a></li>
<li><a href="../de485328/index.html">Angaben zu Steroiden</a></li>
<li><a href="../de485330/index.html">Wie man seelenlosen Zufall in Roguelike-Spielen besiegt</a></li>
<li><a href="../de485334/index.html">Sitzungsumfrage</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>