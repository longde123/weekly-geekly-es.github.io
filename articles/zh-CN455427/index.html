<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>♓️ 👋🏾 🚰 我们如何学会预测用户的请求并加快搜索结果的负荷 👂 🚛 👈🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="搜索提示（sjest）不仅是一项用户服务，还是一种非常强大的语言模型，可以存储数十亿个搜索查询，支持模糊搜索，个性化等等。 我们了解了如何在查询“查找”按钮之前使用最有趣的方法来预测用户的最终查询并加载搜索结果。 


 这项技术的引入-预渲染器-在移动开发，搜索运行时，日志和指标的开发中需要许多有...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>我们如何学会预测用户的请求并加快搜索结果的负荷</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/455427/"><p> 搜索提示（sjest）不仅是一项用户服务，还是一种非常强大的语言模型，可以存储数十亿个搜索查询，支持模糊搜索，个性化等等。 我们了解了如何在查询“查找”按钮之前使用最有趣的方法来预测用户的最终查询并加载搜索结果。 </p><br><p> 这项技术的引入-预渲染器-在移动开发，搜索运行时，日志和指标的开发中需要许多有趣的解决方案。 而且，当然，我们需要一个很酷的分类器来确定是否提前加载搜索查询：该分类器必须在下载加速，额外流量和搜索负载之间取得平衡。 今天，我将谈论我们如何设法创建这样的分类器。 </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/ei/dx/0s/eidx0szyy2cvdzcwwtar86_h6bw.png"><br></a> </p><a name="habracut"></a><br><h2 id="1-srabotaet-li-ideya">  <strong>1.这个想法行得通吗？</strong> </h2><br><p> 在研究任务中，事先很少有一个好的解决方案。 在我们的案例中，我们最初也不知道要建立足够好的分类器需要什么数据。 在这种情况下，从几个非常简单的模型入手非常有用，这将使您能够评估开发的潜在收益。 </p><br><p> 最简单的想法如下：我们将在搜索建议的第一个提示处加载搜索结果； 当提示更改时，我们将放弃先前的下载，然后开始下载新的候选者。 事实证明，这种算法效果很好，几乎所有请求都可以预加载，但是搜索后端的负载相应增加，用户流量也相应增加。 显然，这种解决方案无法实现。 </p><br><p> 以下想法也非常简单：并非在所有情况下都必须加载可能的搜索提示，而只有在我们有足够的信心确实需要它们时才加载。 最简单的解决方案是分类器，该分类器将根据sajest已拥有的数据在运行时直接运行。 </p><br><p> 第一个分类器仅使用十个因素构建。 这些因素取决于提示集上的概率分布（想法：第一个提示的“权重”越大，输入的可能性就越大）和输入的长度（想法：用户必须输入的字母越少，预加载就越安全）。 该分类器的优点还在于，为了构建它，没有必要发布任何东西。 可以通过在最简单的守护程序中发出一个http请求来收集候选者的必要因素，并且目标基于最简单的日志：如果用户的总请求完全匹配该候选者，则该候选者被视为“良好”。 可以在短短几个小时内组装一个这样的库，训练几个逻辑回归并构建散点图。 </p><br><p>预渲染器的度量没有像通常的二进制分类中那样完整地排列。 只有两个参数很重要，但这不是准确性或完整性。 </p><br><p> 让 <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; />" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0" height="0.25ex" viewBox="0 -53.9 0 107.7" role="img" focusable="false" style="vertical-align: -0.125ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"></math></span></span><script type="math/tex" id="MathJax-Element-1"> </script>  -请求总数， <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>p</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.259ex" height="1.817ex" viewBox="-38.5 -520.7 542 782.1" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMATHI-70" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-2"> p </script>  -所有装扮者的总数， <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>e</mi><mi>p</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.253ex" height="1.817ex" viewBox="0 -520.7 970 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMATHI-65" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMATHI-70" x="466" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-3"> ep </script>  -成功渲染的总数，即 最终匹配用户输入的内容。 然后计算出两个有趣的特征，如下所示： </p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x5F00;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x9500;</mo></mrow><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>p</mi><mo>+</mo><mi>r</mi><mo>&amp;#x2212;</mo><mi>e</mi><mi>p</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>r</mi></mrow><mo>&amp;#x2212;</mo><mn>1</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="27.302ex" height="2.419ex" viewBox="0 -780.1 11754.9 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">开</text><g transform="translate(829,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">销</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMAIN-3D" x="1937" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMATHI-66" x="3244" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMATHI-72" x="3794" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMATHI-61" x="4246" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMATHI-63" x="4775" y="0"></use><g transform="translate(5209,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMATHI-70" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMAIN-2B" x="725" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMATHI-72" x="1726" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMAIN-2212" x="2400" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMATHI-65" x="3400" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMATHI-70" x="3867" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMATHI-72" x="9579" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMAIN-2212" x="10253" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMAIN-31" x="11254" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mo>开</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>销</mo></mrow><mo>=</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>p</mi><mo>+</mo><mi>r</mi><mo>−</mo><mi>e</mi><mi>p</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>r</mi></mrow><mo>−</mo><mn>1</mn></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-4">开销= \ frac {p + r-ep} {r}-1 </script></p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x6548;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x7387;</mo></mrow><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>e</mi><mi>p</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>r</mi></mrow></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="15.4ex" height="2.419ex" viewBox="0 -780.1 6630.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">效</text><g transform="translate(829,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">率</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMAIN-3D" x="1937" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMATHI-66" x="3244" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMATHI-72" x="3794" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMATHI-61" x="4246" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMATHI-63" x="4775" y="0"></use><g transform="translate(5209,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMATHI-65" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMATHI-70" x="466" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMATHI-72" x="6179" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mo>效</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>率</mo></mrow><mo>=</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>e</mi><mi>p</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>r</mi></mrow></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-5">效率= \ frac {ep} {r} </script></p><br><p> 例如，如果每个请求仅发出一个预渲染，并且成功完成了一半的预渲染，则该预渲染的效率将为50％，这意味着可以加快一半请求的加载速度。 同时，对于那些成功执行了请求的请求，不会创建额外的流量； 对于那些预提交失败的请求，必须设置另一个请求； 因此请求的总数是原始请求的一倍半，“额外”请求是原始请求数的50％，因此 <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x5F00;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x9500;</mo></mrow><mo>=</mo><mn>0.5</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.926ex" height="2.298ex" viewBox="0 -780.1 4273.5 989.6" role="img" focusable="false" style="vertical-align: -0.487ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">开</text><g transform="translate(829,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">销</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMAIN-3D" x="1937" y="0"></use><g transform="translate(2994,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/yandex/blog/455427/&amp;usg=ALkJrhiHAQ7b_0vUU5VLqsaxLAMtpspsRw#MJMAIN-35" x="779" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mo>开</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>销</mo></mrow><mo>=</mo><mn>0.5</mn></math></span></span><script type="math/tex" id="MathJax-Element-6">开销= 0.5 </script>  。 </p><br><p> 在这些坐标中，我绘制了第一个散点图。 他看起来像这样： </p><br><p><img src="https://habrastorage.org/webt/7z/vk/z6/7zvkz6wapvyzyd_wv56iyu1u-r4.png"></p><br><p> 这些值包含相当多的假设，但至少已经很清楚，一个好的分类器很有可能会起作用：将数十％的请求的加载速度加快，将数十％的负载增加，这是一个有趣的变化。 </p><br><p> 观察分类器如何工作很有趣。 实际上，事实证明，请求的长度是一个非常重要的因素：如果用户几乎已经输入了第一个提示，并且很有可能同时输入，则可以进行预取。 因此，分类器的预测在查询结束时会急剧增加。 </p><br><pre><code class="plaintext hljs">margin prefix candidate -180.424   -96.096    -67.425    -198.641    -138.851    -123.803    -109.841    -96.805    -146.568     -135.725     -125.448     -58.615      31.414     -66.754      1.716        </code> </pre> <br><p> 即使在输入请求的最后一个字母时发生预渲染，它也将很有用。 事实是，用户在输入请求后仍需要花费一些时间单击“查找”按钮。 此时间也可以保存。 </p><br><h2 id="2-pervoe-vnedrenie">  <strong>2.第一次实施</strong> </h2><br><p> 一段时间后，有可能组装出一个完整的设计方案：该应用程序将搜索提示输入到最老的恶魔中。 除其他事项外，他发送了有关是否预加载第一个线索的信息。 接收到适当标志的应用程序下载了结果，如果用户输入最终与候选者一致，则呈现结果。 </p><br><p> 那时，分类器获得了新的因素，该模型不再是逻辑回归，而是一个<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CatBoost</a> 。 最初，我们为分类器推出了相当保守的阈值，但即使它们使我们能够立即加载几乎10％的搜索结果。 这是一次非常成功的发行，因为 我们设法显着地改变了SERP下载速度的次要分位数，用户注意到了这一点，并开始从统计学上显着返回搜索：搜索的显着加速影响了用户执行搜索会话的频率！ </p><br><h2 id="3-dalneyshie-uluchsheniya">  <strong>3.进一步的改进</strong> </h2><br><p> 尽管实施成功，但解决方案仍然非常不完善。 对操作日志的仔细研究表明存在一些问题。 </p><br><ol><li><p> 分类器不稳定。 例如，可能会发现，通过Yandex前缀可以预测Yandex查询，通过Yandex前缀可以预测Yandex查询，而通过Yandex前缀可以预测Yandex查询。 然后，我们的第一个简单的实现提出了两个请求，尽管可以很好地处理一个请求。 </p><br></li><li><p>  Prerender不知道如何处理口碑提示。 单击字词提示会导致请求中出现额外的空格。 例如，如果用户输入了Yandex，则他的第一个提示将是Yandex；否则，第一个提示将是Yandex。 但是如果用户使用逐字提示，则输入内容将已经是字符串“ Yandex”，而第一个提示将是“ Yandex cards”。 这将导致灾难性的后果：已经下载的Yandex请求将被丢弃，而是将加载Yandex卡请求。 之后，用户单击“查找”按钮，并且...将根据Yandex的请求等待发行的全部内容。 </p><br></li><li><p> 在某些情况下，候选人没有机会获得成功。 搜索不准确的重合会直接导致问题，例如，候选人只能包含用户输入的单词中的一个单词。 或用户可以输入错误，那么第一个提示将永远不会与其输入完全匹配。 </p><br></li></ol><br><p> 当然，即使这样有用，也要留下一个不完美的瑕疵。 逐字提示的问题使我特别生气。 我一直认为在Yandex移动搜索中<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">引入单词对单词技巧</a>是我在公司工作期间一直以来最好的实现方式之一，但是在这里，演示者不知道如何与他们合作！ 丢人，别无他法。 </p><br><p> 首先，我们解决了分类器不稳定的问题。 选择的解决方案非常简单：即使分类器返回了否定预测，我们也不会停止加载先前的候选者。 这有助于保存其他请求，因为当同一候选人下一次返回时，您无需再次下载相应的问题。 同时，由于候选人是在分类器首次为他工作时下载的，因此，您可以更快地加载结果。 </p><br><p> 然后是众所周知的线索。 临时服务器是无状态的守护程序，因此很难实现与处理同一用户的先前候选者相关的逻辑。 要同时搜索提示以查找用户请求和没有尾随空格的用户请求，实际上意味着将RPS加上最简单的守护程序加倍，因此这也不是一个好选择。 结果，我们做到了：客户端向候选参数传递了一个特殊参数，该文本现在正在加载； 如果此候选对象（最多空格）与用户输入相似，即使当前输入的候选对象已更改，我们也会将其放弃。 </p><br><p> 此版本发布后，终于可以使用逐字提示输入查询并享受预取！ 有趣的是，在此发行版之前，只有那些完成了使用键盘输入请求的用户时才使用了预取功能。 </p><br><p> 最后，我们在ML的帮助下解决了第三个问题：关于提示来源的附加因素，与用户输入的重合； 此外，得益于首次发布，我们能够收集更多统计信息并从每月数据中学习。 </p><br><h2 id="4-chto-v-itoge">  <strong>4.结果如何</strong> </h2><br><p> 这些发行版中的每一个都使即时下载量增加了百分之十。 最好的部分是，我们能够将预渲染性能提高两倍以上，而实际上没有涉及机器学习的部分，而只是提高了过程的物理性。 这是一个重要的教训：分类器的质量通常不是产品的瓶颈，但改进是最有趣的任务，因此开发会因此而分心。 </p><br><p> 不幸的是，即时<em>加载的</em> SERP并非完全成功。 仍然需要<em>渲染</em>已加载的输出，这不会立即发生。 因此，我们仍然必须努力将即时数据下载更好地转换为搜索结果的即时呈现。 </p><br><p> 幸运的是，已实现的实现已经使我们可以将预渲染器作为一个相当稳定的功能来讨论。 我们还测试了第2节中描述的实现：它们全部一起也导致了用户自己开始更频繁地进行搜索会话的事实。 这是另一个有用的教训：服务速度的显着提高可以从统计上显着影响其保留。 </p><br><p> 在下面的视频中，您可以看到预渲染器现在在我的手机上如何工作。 </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/xzFb_sy_ZUc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN455427/">https://habr.com/ru/post/zh-CN455427/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN455411/index.html">扩音器进行了技术更新...网络名称</a></li>
<li><a href="../zh-CN455413/index.html">将Pocket变成新闻源</a></li>
<li><a href="../zh-CN455419/index.html">Apple Beta Alive：在发布会上未透露Trivia</a></li>
<li><a href="../zh-CN455421/index.html">分解UICollectionViewCell</a></li>
<li><a href="../zh-CN455425/index.html">通过USB调制解调器在Mikrotik hEX S和Juniper SRX之间创建IPSec GRE隧道</a></li>
<li><a href="../zh-CN455429/index.html">《毁灭战士》如何登上超级任天堂</a></li>
<li><a href="../zh-CN455439/index.html">科学家创建的新算法使您可以与真实的人创建近乎完美的“交谈头”</a></li>
<li><a href="../zh-CN455441/index.html">6月21日，莫斯科，Deworkacy-AnalyzeIT MeetUp＃2</a></li>
<li><a href="../zh-CN455443/index.html">将订阅应用程序添加到App Store的15条提示</a></li>
<li><a href="../zh-CN455445/index.html">D类软件实现</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>