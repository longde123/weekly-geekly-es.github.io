<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üó≥Ô∏è ü§≤üèº üëæ Como fizemos o piloto autom√°tico para uma esta√ß√£o de servi√ßo üë®‚Äçüîß üò≤ üôáüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° Habr! Eu trabalho em uma pequena startup em Berlim que desenvolve pilotos autom√°ticos para carros. Estamos concluindo um projeto para esta√ß√µes de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como fizemos o piloto autom√°tico para uma esta√ß√£o de servi√ßo</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457500/"> Ol√° Habr!  Eu trabalho em uma pequena startup em Berlim que desenvolve pilotos autom√°ticos para carros.  Estamos concluindo um projeto para esta√ß√µes de servi√ßo de uma grande montadora alem√£ e eu gostaria de falar sobre isso: como fizemos, quais dificuldades encontramos e que coisas novas descobrimos.  Nesta parte, falarei sobre o m√≥dulo de percep√ß√£o e um pouco sobre a arquitetura da solu√ß√£o como um todo.  Sobre o restante dos m√≥dulos, talvez, contaremos nas seguintes partes.  Ficarei muito feliz em receber feedback e olhar de fora sobre a nossa abordagem. <br><a name="habracut"></a><br>  O comunicado de imprensa do projeto do cliente pode ser encontrado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br>  Para come√ßar, vou lhe dizer por que a montadora se voltou para n√≥s e n√£o fez o projeto por conta pr√≥pria.  √â dif√≠cil para grandes preocupa√ß√µes alem√£s alterar processos, e o formato de desenvolvimento de carro raramente √© adequado para software - as itera√ß√µes s√£o longas e requerem um bom planejamento.  Parece-me que as montadoras alem√£s entendem isso e, portanto, voc√™ pode conhecer startups que s√£o fundadas por elas, mas trabalhar como uma empresa independente (por exemplo, AID da Audi e Zenuity da Volvo).  Outras montadoras est√£o organizando eventos como o Startup Autobahn, onde est√£o procurando empreiteiros em potencial para tarefas e novas id√©ias.  Eles podem solicitar um produto ou prot√≥tipo e, ap√≥s um curto per√≠odo de tempo, obter o resultado final.  Isso pode ser mais r√°pido do que tentar fazer a mesma coisa, e n√£o custa mais do que seu pr√≥prio desenvolvimento em termos de custos.  A complexidade das altera√ß√µes do processo √© bem demonstrada pelo n√∫mero de permiss√µes necess√°rias para come√ßar a testar um carro com piloto autom√°tico nos clientes: consentimento para grava√ß√£o de v√≠deo de pessoas (mesmo que n√£o salvemos dados e usamos streaming de v√≠deo apenas de forma an√¥nima sem identificar pessoas espec√≠ficas), consentimento para grava√ß√£o de v√≠deo territ√≥rios, o consentimento do sindicato e o c√¥nsul de trabalho para testar essas tecnologias, o consentimento do servi√ßo de seguran√ßa, o consentimento do servi√ßo de TI - essa n√£o √© a lista completa. <br><br><h2>  Desafio </h2><br>  No projeto atual, o cliente quer entender se √© poss√≠vel dirigir carros em centros de servi√ßo usando "AI".  O script do usu√°rio √©: <br><br><ol><li>  O t√©cnico quer come√ßar a trabalhar com uma m√°quina que esteja em algum lugar do estacionamento fora da √°rea de teste. </li><li>  Ele seleciona o carro no tablet, seleciona a caixa de servi√ßo e clica em "Dirigir". </li><li>  O carro entra e para no ponto final (elevador, rampa ou outra coisa). </li><li>  Quando o t√©cnico termina o trabalho no carro, ele pressiona um bot√£o no tablet, o carro sai e estaciona em algum espa√ßo vazio do lado de fora. </li></ol><br>  Caracter√≠sticas: nem todos os carros t√™m c√¢meras.  Nas m√°quinas em que est√£o, n√£o temos acesso a elas.  Os √∫nicos dados na m√°quina a que temos acesso s√£o sonares e odometria <br><br><div class="spoiler">  <b class="spoiler_title">Sonares e odometria</b> <div class="spoiler_text">  Os sonares s√£o sensores de dist√¢ncia que s√£o instalados em um c√≠rculo em um carro e geralmente parecem pontos redondos; permitem estimar a dist√¢ncia do objeto, mas apenas pr√≥ximos e com baixa precis√£o.  Odometria - dados sobre a velocidade e a dire√ß√£o reais do carro.  Conhecendo esses dados e a posi√ß√£o inicial, voc√™ pode determinar com bastante precis√£o a posi√ß√£o atual da m√°quina. <br></div></div><br>  Assim, o carro deve ser controlado por sensores externos instalados na √°rea de servi√ßo. <br><br><h2>  Solu√ß√£o </h2><br>  A arquitetura do produto final √© a seguinte: <br><br><ul><li>  Na √°rea de servi√ßo, instalamos c√¢meras externas, lidares e outras coisas (ol√° Tesla). </li><li>  Os dados das c√¢meras v√£o para o Jetson TX2 (tr√™s c√¢meras cada), que est√£o envolvidos na tarefa de encontrar a m√°quina e pr√©-processar imagens das c√¢meras. </li><li>  Al√©m disso, os dados da c√¢mera chegam ao servidor central, orgulhosamente chamado de Torre de Controle, no qual se enquadram nos m√≥dulos de percep√ß√£o, rastreamento e planejamento de caminho.  Como resultado da an√°lise, √© tomada uma decis√£o sobre a dire√ß√£o adicional do movimento do carro e √© enviada ao carro. </li><li>  Nesta fase do projeto, outro Jetson TX2 √© colocado no carro, que, usando nosso driver, se conecta ao Vector, que descriptografa os dados do carro e envia comandos.  O TX2 recebe comandos de controle de um servidor central e os transmite para o carro. </li></ul><br>  Para o n√≠vel de infraestrutura, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ROS √©</a> usado. <br><br>  Eis o que acontece depois que um t√©cnico escolhe um carro e clica em "dirigir": <br><br><ol><li>  O sistema est√° procurando um carro: enviamos um comando ao carro para piscar alarmes, ap√≥s o qual podemos determinar qual dos carros no estacionamento √© selecionado pelo t√©cnico.  No est√°gio inicial de desenvolvimento, tamb√©m consideramos a op√ß√£o de determinar a m√°quina pela chapa de matr√≠cula, mas em algumas √°reas do carro estacionado o n√∫mero pode n√£o ser vis√≠vel.  Al√©m disso, se fiz√©ssemos a determina√ß√£o do carro pelo n√∫mero de registro, a resolu√ß√£o das fotos teria que ser bastante aumentada, o que afetaria negativamente a produtividade, e usamos a mesma imagem para pesquisar e dirigir.  Esse est√°gio ocorre uma vez e √© repetido apenas se, por algum motivo, perdemos o carro no rastreamento. </li><li>  Assim que o carro √© encontrado, soltamos as imagens das c√¢meras que o carro atinge no m√≥dulo de percep√ß√£o, que segmenta o espa√ßo e fornece as coordenadas de todos os objetos, sua orienta√ß√£o e tamanho.  Esse processo est√° em andamento, rodando a cerca de 30 quadros por segundo.  Os processos subsequentes tamb√©m s√£o constantes e s√£o executados at√© a m√°quina chegar ao ponto final. </li><li>  O m√≥dulo de rastreamento recebe informa√ß√µes da percep√ß√£o, sonares e odometria, mant√©m na mem√≥ria todos os objetos encontrados, combina-os, refina a localiza√ß√£o, prediz a posi√ß√£o e a velocidade dos objetos. </li><li>  Em seguida, o planejador de caminho, dividido em duas partes: planejador de caminho global para a rota global e planejador de caminho local para o local (respons√°vel por evitar obst√°culos), cria um caminho e decide para onde ir em nosso carro, envia um comando. </li><li>  Jetson pega o comando de carro e o transmite para o carro. </li></ol><br>  A partida ocorre da mesma maneira que a chegada. <br><br><h2>  Percep√ß√£o </h2><br>  Um dos principais e, na minha opini√£o, o m√≥dulo mais interessante √© a percep√ß√£o.  Este m√≥dulo descreve os dados dos sensores de forma que voc√™ possa tomar uma decis√£o precisa sobre o movimento.  Em nosso projeto, fornece as coordenadas, a orienta√ß√£o e os tamanhos de todos os objetos que caem na c√¢mera.  Ao projetar este m√≥dulo, decidimos come√ßar com algoritmos que permitiriam analisar a imagem de uma s√≥ vez.  Tentamos: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">VAE desembara√ßado</a> .  Uma pequena modifica√ß√£o feita no Œ≤-VAE nos permitiu treinar a rede para que vetores latentes armazenassem informa√ß√µes da imagem em uma vista esquem√°tica de cima para baixo. </li><li>  GAN condicional (a implementa√ß√£o mais famosa √© o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pix2pix</a> ).  Esta rede pode ser usada para construir mapas.  Tamb√©m o usamos para criar uma vis√£o esquem√°tica de cima, colocando dados de uma ou todas as c√¢meras nele ao mesmo tempo e aguardando uma vis√£o esquem√°tica de cima na sa√≠da. </li></ol><br>  <i>Uma das itera√ß√µes GAN Condicionais para uma c√¢mera, da esquerda para a direita: imagem de entrada, previs√£o de rede, resultado esperado</i> <br><br><img src="https://habrastorage.org/webt/w1/m9/ax/w1m9ax7idlos-x3jawcob3kmxzm.png"><br><br>  De fato, a id√©ia dessas abordagens √© garantir que a rede final possa entender a localiza√ß√£o e a orienta√ß√£o de todos os carros e outros objetos em movimento que ca√≠ram na c√¢mera olhando a foto de entrada uma vez.  Os dados dos objetos nesse caso ser√£o armazenados em vetores latentes.  O treinamento da rede ocorreu nos dados do simulador, que √© uma c√≥pia exata do ponto em que a demonstra√ß√£o ocorrer√°.  E conseguimos atingir certos resultados, mas decidimos n√£o usar esses m√©todos por v√°rios motivos: <br><br><ul><li>  No tempo alocado, n√£o conseguimos aprender como usar dados de vetores latentes para descrever a imagem.  O resultado da rede sempre foi uma imagem - uma vista superior com um layout esquem√°tico de objetos.  Isso √© menos preciso e tem√≠amos que essa precis√£o n√£o fosse suficiente para dirigir um carro. </li><li>  A solu√ß√£o n√£o √© escal√°vel: para todas as instala√ß√µes subseq√ºentes e para os casos em que √© necess√°rio alterar a dire√ß√£o de algumas c√¢meras, √© necess√°rio reconfigurar o simulador e repetir o treinamento completo. </li></ul><br>  No entanto, est√°vamos interessados ‚Äã‚Äãem entender as possibilidades dessas abordagens e as manteremos em mente para tarefas futuras. <br><br>  Depois disso, abordamos a tarefa, por outro lado, atrav√©s de uma pesquisa regular por objetos + uma rede para determinar a posi√ß√£o espacial dos objetos encontrados (por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">isto</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aquilo</a> ).  Essa op√ß√£o nos pareceu mais precisa.  O √∫nico ponto negativo √© que ele √© mais lento do que as abordagens propostas anteriormente, mas se encaixa em nossa estrutura de atraso poss√≠vel, j√° que a velocidade do carro na √°rea de servi√ßo n√£o passa de 5 km / h.  O trabalho mais interessante no campo de previs√£o da posi√ß√£o 3D do objeto nos pareceu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ser esse</a> , que mostra bons resultados no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">KITTI</a> .  Constru√≠mos uma rede semelhante com algumas mudan√ßas e escrevemos nosso pr√≥prio algoritmo para determinar a caixa circundante e, para ser mais preciso, um algoritmo para estimar as coordenadas do centro da proje√ß√£o do objeto no ch√£o - para tomar decis√µes sobre a dire√ß√£o do movimento, n√£o precisamos de dados sobre a altura dos objetos.  A imagem do objeto e seu tipo (carro, pedestre, ..) s√£o alimentados na entrada da rede, e suas dimens√µes e orienta√ß√£o espacial s√£o exibidas.  Em seguida, o m√≥dulo avalia o centro de proje√ß√£o e fornece dados para todos os objetos: as coordenadas do centro, a orienta√ß√£o e as dimens√µes (largura e comprimento). <br><br>  No produto final, cada imagem √© executada primeiro na rede para procurar objetos; em seguida, todos os objetos s√£o enviados para a rede 3D para prever a orienta√ß√£o e o tamanho. Depois disso, avaliamos o centro de proje√ß√£o de cada um e enviamos mais adiante os dados de orienta√ß√£o e tamanho.  Uma caracter√≠stica desse m√©todo √© que ele est√° fortemente vinculado √† precis√£o do limite da caixa de limite da rede de pesquisa de objetos.  Por esse motivo, redes como a YOLO n√£o se adequavam a n√≥s.  Encontramos o equil√≠brio ideal de desempenho e precis√£o da caixa limite na rede RetinaNet. <br><br>  Vale a pena notar uma coisa com a qual tivemos sorte neste projeto: o terreno √© plano.  Bem, isto √©, n√£o √© t√£o plano quanto uma comunidade conhecida, mas n√£o h√° curvas em nosso territ√≥rio.  Isso permite o uso de c√¢meras monoculares fixas para projetar objetos nas coordenadas do plano terrestre sem informa√ß√µes sobre a dist√¢ncia at√© o objeto.  Planos futuros incluem a introdu√ß√£o de previs√£o de profundidade monocular.  Existem muitos trabalhos sobre esse t√≥pico, por exemplo, um dos √∫ltimos e muito interessantes que estamos tentando para projetos futuros.  A previs√£o de profundidade permitir√° que voc√™ trabalhe n√£o apenas em terreno plano, mas potencialmente aumentar√° a precis√£o de determinar obst√°culos, simplifique o processo de configura√ß√£o de novas c√¢meras e elimine a necessidade de rotular cada objeto - n√£o nos importamos com o tipo de objeto, se √© algum tipo de obst√°culo. <br><br>  √â tudo, obrigado pela leitura e ficarei feliz em responder a perguntas.  Como b√¥nus, quero falar sobre um efeito negativo inesperado: o piloto autom√°tico n√£o se importa com a orienta√ß√£o do carro, para ele n√£o importa como ir - para a frente ou para tr√°s.  O principal √© dirigir da melhor maneira e n√£o colidir com ningu√©m.  Portanto, existe uma alta probabilidade de o carro percorrer parte do caminho ao contr√°rio, especialmente em pequenas √°reas onde √© necess√°ria alta manobrabilidade.  No entanto, as pessoas est√£o acostumadas com o fato de o carro estar avan√ßando principalmente e geralmente esperam o mesmo comportamento do piloto autom√°tico.  Se uma pessoa de neg√≥cios v√™ um carro que, em vez de andar na frente, dirige para tr√°s, pode considerar que o produto n√£o est√° pronto e cont√©m erros. <br><br>  <b>PS</b> Pe√ßo desculpas por n√£o haver imagens e v√≠deos com testes reais, mas n√£o posso public√°-los por motivos legais. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt457500/">https://habr.com/ru/post/pt457500/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt457476/index.html">Reduzindo o tamanho de uma imagem do Docker com um aplicativo de inicializa√ß√£o por mola</a></li>
<li><a href="../pt457480/index.html">Criando um aplicativo de escuta para visualizar o tr√°fego m√≥vel do MMORPG</a></li>
<li><a href="../pt457490/index.html">Aisioshechka de Zuckerberg - brevemente e no caso Libra</a></li>
<li><a href="../pt457494/index.html">"E se eu n√£o sei matem√°tica, sou in√∫til?" - especialistas respondem a perguntas freq√ºentes sobre profiss√µes em ci√™ncia de dados</a></li>
<li><a href="../pt457496/index.html">"Encontre as cinco diferen√ßas." Escalabilidade e diferen√ßa de gera√ß√£o - Novo lote de testes</a></li>
<li><a href="../pt457502/index.html">Como o modelo de pontua√ß√£o do RICE aprimora a prioriza√ß√£o de recursos do produto</a></li>
<li><a href="../pt457504/index.html">Por que escrever sua grade de dados de rea√ß√£o em 2019</a></li>
<li><a href="../pt457514/index.html">Nevanger</a></li>
<li><a href="../pt457516/index.html">Escrevendo um modelo de amea√ßa</a></li>
<li><a href="../pt457518/index.html">Cadeia de caixa de plasma como uma solu√ß√£o para o trilema da escalabilidade de blockchain</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>