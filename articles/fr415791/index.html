<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🦗 🙈 🔃 Optimisation des contrats intelligents. Comment les types de solidité affectent les coûts de transaction 🤰🏼 😔 🚕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="«Les programmeurs passent énormément de temps à s'inquiéter de la vitesse de leurs programmes, et les tentatives pour atteindre l'efficacité ont souve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Optimisation des contrats intelligents. Comment les types de solidité affectent les coûts de transaction</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415791/"><blockquote> <i>«Les programmeurs passent énormément de temps à s'inquiéter de la vitesse de leurs programmes, et les tentatives pour atteindre l'efficacité ont souvent un impact négatif dramatique sur la capacité de les déboguer et de les soutenir.</i>  <i>Il faut oublier les petites optimisations, disons, dans 97% des cas.</i>  <i>L'optimisation prématurée est la racine de tout mal!</i>  <i>Mais il ne faut pas perdre de vue ces 3% où c'est vraiment important! »</i> <br>  <b>Donald Knut.</b> <br></blockquote><img src="https://habrastorage.org/webt/dw/wh/fv/dwwhfvvtvsgi2ilhvtjscuk8xyc.png" alt="Ethereum gas"><br><br>  Lorsque nous réalisons des audits de contrats intelligents, nous nous demandons parfois si leur développement concerne ces 97% où il n'est pas nécessaire de penser à l'optimisation ou si nous traitons uniquement ces 3% de cas où cela est important.  À notre avis, plus probablement le second.  Contrairement à d'autres applications, les contrats intelligents ne sont pas mis à jour, ils ne peuvent pas être optimisés «à la volée» (à condition que leur algorithme ne soit pas défini, mais il s'agit d'un sujet distinct).  Le deuxième argument en faveur de l'optimisation <i>précoce des</i> contrats est que, contrairement à la plupart des systèmes où la sous-optimalité ne se manifeste que par l'échelle, liée aux spécificités du fer et de l'environnement, elle est mesurée par un grand nombre de paramètres, un contrat intelligent a essentiellement la seule mesure de performance - la consommation de gaz. <br><br>  Par conséquent, il est techniquement plus facile d'évaluer l'efficacité d'un contrat, mais les développeurs continuent souvent de s'appuyer sur leur intuition et de faire la même «optimisation prématurée» aveugle dont le professeur Knut a parlé.  Nous vérifierons le degré d'intuitivité de la solution par rapport à la réalité par l'exemple du choix de la profondeur de bits d'une variable.  Dans cet exemple, comme dans la plupart des cas pratiques, nous ne réaliserons pas d'économies, et même vice versa, notre contrat s'avérera plus cher en termes de gaz consommé. <br><a name="habracut"></a><br><h2>  Quel genre de gaz? </h2><br>  Ethereum est comme un ordinateur mondial, dont le «processeur» est la machine virtuelle EVM, le «code de programme» est une séquence de commandes et de données enregistrées dans un contrat intelligent, et les appels sont des transactions du monde extérieur.  Les transactions sont regroupées dans des structures connexes - des blocs qui se produisent toutes les quelques secondes.  Et puisque la taille du bloc est par définition limitée et que le protocole de traitement est déterministe (nécessite un traitement uniforme de toutes les transactions dans le bloc par tous les nœuds du réseau), pour satisfaire une demande potentiellement illimitée avec une ressource limitée de nœuds et se protéger contre le DoS, le système doit fournir un algorithme équitable pour choisir la demande à servir, et dont ignorer, en tant que mécanisme dans de nombreuses chaînes de blocs publiques, il existe un principe simple - l'expéditeur peut choisir le montant de la rémunération du mineur pour effectuer sa trans  ktsii et mineur dont les besoins Choisit comprennent un bloc, et dont pas, le choix le plus rentable pour eux-mêmes. <br><br>  Par exemple, dans Bitcoin, où le bloc est limité à un mégaoctet, le mineur choisit d'inclure la transaction dans le bloc ou non en fonction de sa longueur et de la commission proposée (en choisissant celles avec le rapport satoshis par octet maximum). <br><br>  Pour le protocole Ethereum plus complexe, cette approche n'est pas appropriée, car un seul octet peut représenter à la fois l'absence d'une opération (par exemple, le code STOP) et l'opération d'écriture lente et coûteuse sur le stockage (SSTORE).  Par conséquent, pour chaque op-code à l'antenne, son propre prix est fourni, en fonction de sa consommation de ressources. <br><br><div class="spoiler">  <b class="spoiler_title">Barème des frais selon la spécification du protocole</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/wb/to/i4/wbtoi4ymmqlobftzqqvykhau2iq.png" alt="Barème des frais d'Ethereum"><br>  Tableau des débits de gaz pour différents types d'opérations.  D'après la spécification du protocole <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ethereum Yellow Paper</a> . <br></div></div><br>  Contrairement à Bitcoin, l'expéditeur de la transaction Ethereum ne fixe pas la commission en crypto-monnaie, mais la quantité maximale de gaz qu'il est prêt à dépenser - <b>startGas</b> et le prix par unité de gaz - <b>gasPrice</b> .  Lorsque la machine virtuelle exécute le code, la quantité de gaz pour chaque opération suivante est soustraite de startGas jusqu'à ce que la sortie du code soit atteinte ou que le gaz s'épuise.  Apparemment, c'est pourquoi un nom si étrange est utilisé pour cette unité de travail - la transaction est remplie de gaz comme une voiture, et elle atteindra le point de destination ou non selon qu'il y a suffisamment de volume rempli dans le réservoir.  Une fois l'exécution du code terminée, la quantité d'air reçue en multipliant le gaz réellement consommé par le prix fixé par l'expéditeur ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wei</a> per gas) est débitée de l'expéditeur de la transaction.  Dans le réseau mondial, cela se produit au moment de «miner» le bloc, qui comprend la transaction correspondante, et dans l'environnement Remix, la transaction est «minée» instantanément, gratuitement et sans aucune condition. <br><br><h2>  Notre outil - Remix IDE </h2><br>  Pour le «profilage» de la consommation de gaz, nous utiliserons l'environnement en ligne pour développer les contrats Ethereum du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Remix IDE</a> .  Cet IDE contient un éditeur de code de coloration syntaxique, un visualiseur d'artefacts, un rendu d'interface de contrat, un débogueur visuel de machine virtuelle, des compilateurs JS de toutes les versions possibles et de nombreux autres outils importants.  Je recommande fortement de commencer l'étude de l'éther avec lui.  Un avantage supplémentaire est qu'il ne nécessite pas d'installation - il suffit de l'ouvrir dans un navigateur depuis le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site officiel</a> . <br><br><h2>  Sélection du type variable </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La spécification du langage Solidity</a> offre au développeur jusqu'à trente-deux bits de types entiers uint - de 8 à 256 bits.  Imaginez que vous développez un contrat intelligent conçu pour stocker l'âge d'une personne en années.  Quelle profondeur de bits choisissez-vous? <br><br>  Il serait tout à fait naturel de choisir le type minimum suffisant pour une tâche spécifique - uint8 conviendrait mathématiquement ici.  Il serait logique de supposer que plus l'objet que nous stockons sur la blockchain est petit et moins nous dépensons de mémoire pour l'exécution, moins nous avons de frais généraux, moins nous payons.  Mais dans la plupart des cas, cette hypothèse sera incorrecte. <br><br>  Pour l'expérience, nous prenons le contrat le plus simple de ce que propose la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> officielle de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Solidity</a> et le collectons en deux versions - en utilisant le type variable uint256 et le type 32 fois plus petit - uint8. <br><br><div class="spoiler">  <b class="spoiler_title">simpleStorage_uint256.sol</b> <div class="spoiler_text"><pre> <code class="hljs powershell"><code>pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>; contract SimpleStorage { //uint is alias <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> uint256 uint storedData; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint x)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span></span> { storedData = x; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> storedData; } }</code> <br></code> </pre> <code><code>pragma solidity ^0.4.0; contract SimpleStorage { //uint is alias for uint256 uint storedData; function set(uint x) public { storedData = x; } function get() public view returns (uint) { return storedData; } }</code> <br></code> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">simpleStorage_uint8.sol</b> <div class="spoiler_text"><pre> <code class="hljs powershell">pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>; contract SimpleStorage { uint8 storedData; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint8 x)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span></span> { storedData = x; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> storedData; } }</code> </pre> <br><br></div></div><br><h2>  Mesurer les «économies» </h2><br>  Ainsi, les contrats sont créés, chargés dans Remix, déployés et les appels aux méthodes .set () sont exécutés par des transactions.  Que voyons-nous?  <b>L'enregistrement d'un type long est plus cher qu'un type court</b> - 20464 contre 20205 unités à gaz!  Comment?  Pourquoi?  Voyons ça! <br><br><img src="https://habrastorage.org/webt/rq/7p/bo/rq7pbohiqrtea8mp2bem0hddqlu.png" alt="Consommation de gaz Ethereum dans Remix IDE"><br><br><h2>  Store uint8 vs uint256 </h2><br>  L'écriture sur un stockage persistant est l'une des opérations les plus coûteuses du protocole pour des raisons évidentes: premièrement, l'enregistrement de l'état augmente la taille de l'espace disque requis par le nœud complet.  La taille de ce stockage augmente constamment et plus les états sont stockés sur les nœuds, plus la synchronisation est lente, plus les besoins en infrastructure sont importants (taille de la partition, nombre d'iops).  Aux heures de pointe, ce sont les opérations d'E / S sur disque lent qui déterminent les performances de l'ensemble du réseau. <br><br>  Il serait logique de s'attendre à ce que le stockage de uint8 coûte des dizaines de fois moins cher que uint256.  Cependant, dans le débogueur, vous pouvez voir que les deux valeurs sont situées exactement de la même manière dans l'emplacement de stockage qu'une valeur de 256 bits. <br><br><img src="https://habrastorage.org/webt/7x/v-/e8/7xv-e8hrnzwrta4z0z7adgticm0.png"><br><br>  Et dans ce cas particulier, l'utilisation de uint8 ne donne aucun avantage sur le coût d'écriture sur le stockage. <br><br><h2>  Gestion de uint8 vs uint256 </h2><br>  Peut-être que nous aurons des avantages à travailler avec uint8 sinon pendant le stockage, du moins lors de la manipulation des données en mémoire?  Ce qui suit compare les instructions pour la même fonction obtenues pour différents types de variables. <br><br><img src="https://habrastorage.org/webt/wj/qq/4h/wjqq4hi8_gkc0lfxckcyhjygbu4.png"><br><br>  Vous pouvez voir que les opérations avec uint8 ont encore <b>plus d'instructions</b> que uint256.  En effet, la machine convertit la valeur 8 bits en un mot natif 256 bits et, par conséquent, le code est entouré d'instructions supplémentaires payées par l'expéditeur.  Non seulement l'écriture, mais aussi l'exécution de code avec un type uint8 dans ce cas est plus coûteuse. <br><br><h2>  Où peut-on justifier l'utilisation de types courts? </h2><br>  Notre équipe est engagée dans l'audit de contrats intelligents depuis longtemps, et jusqu'à présent, il n'y a pas eu un seul cas pratique où l'utilisation d'un petit type dans le code fourni pour l'audit entraînerait des économies.  Pendant ce temps, dans certains cas très spécifiques, des économies sont théoriquement possibles.  Par exemple, si votre contrat stocke un grand nombre de petites variables ou structures d'état, elles peuvent être regroupées dans moins d'emplacements de stockage. <br><br>  La différence sera plus apparente dans l'exemple suivant: <br><br>  1. contrat avec 32 variables uint256 <br><br><div class="spoiler">  <b class="spoiler_title">simpleStorage_32x_uint256.sol</b> <div class="spoiler_text"><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">pragma</span></span> solidity<span class="hljs-regexp"><span class="hljs-regexp"> ^0.4.0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">contract</span></span> SimpleStorage { <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData1; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData2; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData3; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData4; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData5; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData6; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData7; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData8; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData9; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData10; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData11; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData12; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData13; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData14; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData15; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData16; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData17; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData18; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData19; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData20; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData21; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData22; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData23; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData24; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData25; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData26; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData27; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData28; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData29; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData30; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData31; <span class="hljs-attribute"><span class="hljs-attribute">uint</span></span> storedData32; <span class="hljs-attribute"><span class="hljs-attribute">function</span></span> set(uint x) public { <span class="hljs-attribute"><span class="hljs-attribute">storedData1</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData2</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData3</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData4</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData5</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData6</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData7</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData8</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData9</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData10</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData11</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData12</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData13</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData14</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData15</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData16</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData17</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData18</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData19</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData20</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData21</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData22</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData23</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData24</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData25</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData26</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData27</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData28</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData29</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData30</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData31</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData32</span></span> = x; } <span class="hljs-attribute"><span class="hljs-attribute">function</span></span> get() public view returns (uint) { <span class="hljs-attribute"><span class="hljs-attribute">return</span></span> storedData1; } }</code> </pre> <br><br></div></div><br>  2. contrat avec 32 variables uint8 <br><br><div class="spoiler">  <b class="spoiler_title">simpleStorage_32x_uint8.sol</b> <div class="spoiler_text"><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">pragma</span></span> solidity<span class="hljs-regexp"><span class="hljs-regexp"> ^0.4.0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">contract</span></span> SimpleStorage { <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData1; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData2; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData3; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData4; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData5; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData6; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData7; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData8; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData9; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData10; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData11; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData12; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData13; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData14; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData15; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData16; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData17; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData18; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData19; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData20; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData21; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData22; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData23; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData24; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData25; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData26; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData27; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData28; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData29; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData30; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData31; <span class="hljs-attribute"><span class="hljs-attribute">uint8</span></span> storedData32; <span class="hljs-attribute"><span class="hljs-attribute">function</span></span> set(uint8 x) public { <span class="hljs-attribute"><span class="hljs-attribute">storedData1</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData2</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData3</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData4</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData5</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData6</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData7</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData8</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData9</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData10</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData11</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData12</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData13</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData14</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData15</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData16</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData17</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData18</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData19</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData20</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData21</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData22</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData23</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData24</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData25</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData26</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData27</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData28</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData29</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData30</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData31</span></span> = x; <span class="hljs-attribute"><span class="hljs-attribute">storedData32</span></span> = x; } <span class="hljs-attribute"><span class="hljs-attribute">function</span></span> get() public view returns (uint) { <span class="hljs-attribute"><span class="hljs-attribute">return</span></span> storedData1; } }</code> </pre> <br><br></div></div><br>  Le déploiement du premier contrat (32 uint256) coûtera moins cher - seulement 89941 gaz, mais .set () sera beaucoup plus cher car  Il occupera 256 emplacements de stockage, ce qui coûtera 640 639 gaz pour chaque appel.  Le deuxième contrat (32 uint8) sera deux fois et demie plus cher lors du déploiement (gaz 221663), mais chaque appel à la méthode .set () sera beaucoup moins cher, car  ne change qu'une seule cellule de l'étage (185291 gaz). <br><br><h2>  Faut-il appliquer une telle optimisation? </h2><br>  L'importance de l'effet de l'optimisation de type est un point discutable.  Comme vous pouvez le voir, même pour un boîtier synthétique spécialement sélectionné, nous <b>n'avons pas obtenu de</b> multiples différences.  Le choix d'utiliser uint8 ou uint256 est plutôt une illustration du fait que l'optimisation doit être appliquée de manière significative (avec une compréhension des outils, du profilage), ou ne pas y penser du tout.  Voici quelques directives générales: <br><br><ul><li>  si le contrat contient de nombreux petits nombres ou des structures compactes dans le référentiel, alors vous pouvez penser à l'optimisation; </li><li>  si vous utilisez le type "abrégé" - n'oubliez pas les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vulnérabilités de débordement / dépassement</a> ; </li><li>  pour les variables de mémoire et les arguments de fonction qui ne sont pas écrits dans le référentiel, il est toujours préférable d'utiliser le type natif uint256 (ou son alias uint).  Par exemple, cela n'a aucun sens de définir l'itérateur de liste sur uint8 - il suffit de perdre; </li><li>  L' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ordre des variables dans le contrat est</a> d'une grande importance pour le conditionnement correct dans les emplacements de stockage pour le compilateur. </li></ul><br><h2>  Les références </h2><br>  Je vais me retrouver avec des conseils qui n'ont pas de contre-indications: expérimenter avec des outils de développement, connaître les spécifications du langage, de la bibliothèque et des frameworks.  Voici les liens les plus utiles, à mon avis, pour commencer à découvrir la plate-forme Ethereum: <br><br><ul><li>  L'environnement de développement de contrats <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Remix</a> est un IDE basé sur un navigateur très fonctionnel; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La spécification du langage Solidity</a> , le lien ira spécifiquement à la section sur la disposition des variables d'état; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un référentiel</a> de contrats <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">très intéressant</a> de la célèbre équipe OpenZeppelin.  Exemples de mise en œuvre de jetons, de contrats de crowdsale et, surtout, de la bibliothèque <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SafeMath</a> , celle qui permet de travailler en toute sécurité avec les types; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ethereum Yellow Paper</a> , spécification formelle de la machine virtuelle Ethereum; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ethereum White Paper</a> , la spécification de la plateforme Ethereum, un document plus général et de haut niveau avec un grand nombre de liens; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ethereum en 25 minutes</a> , une introduction technique courte mais néanmoins vaste à Ethereum du créateur de la plateforme, Vitalik Buterin; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Etherscan blockchain explorer</a> , une fenêtre sur le monde réel de l'éther, un navigateur de blocs, de transactions, de jetons, de contrats sur le réseau principal.  Sur Etherscan, vous trouverez l'explorateur pour les réseaux de test Rinkeby, Ropsten, Kovan (réseaux avec diffusion gratuite, construits sur différents protocoles de consensus). </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr415791/">https://habr.com/ru/post/fr415791/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr415779/index.html">Mise en place d'une plateforme logicielle NAS sécurisée</a></li>
<li><a href="../fr415781/index.html">Pourquoi les physiciens pensent-ils que la théorie des cordes peut devenir "la théorie de tout"</a></li>
<li><a href="../fr415783/index.html">Les disques stellaires nous révèlent les secrets de l'apparition des planètes</a></li>
<li><a href="../fr415785/index.html">SpaceX envoie un robot d'intelligence artificielle à l'ISS</a></li>
<li><a href="../fr415789/index.html">Algorithmes de brevetage pour les programmes informatiques</a></li>
<li><a href="../fr415793/index.html">Guide complet de réapprovisionnement de domaine</a></li>
<li><a href="../fr415795/index.html">Écrire une interface utilisateur Snapchat sur Swift</a></li>
<li><a href="../fr415797/index.html">Expressions régulières + programmation logique. Quel est le résultat?</a></li>
<li><a href="../fr415801/index.html">Google: notre IA "téléphone" n'est pas assez bonne pour être dangereuse</a></li>
<li><a href="../fr415805/index.html">Modification du module barrière GSM Doorhan pour le contrôle Internet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>