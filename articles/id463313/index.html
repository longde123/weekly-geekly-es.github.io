<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥨 ✌🏼 🕵🏼 Pendekatan alternatif untuk berlangganan acara, atau apakah EventObject benar-benar diperlukan? 💆🏻 💛 🤾🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ringkasan 


 Tujuan artikel ini adalah upaya untuk melihat, dari sudut pandang yang berbeda, pada deskripsi sistem distribusi peristiwa. 

 Pada saat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pendekatan alternatif untuk berlangganan acara, atau apakah EventObject benar-benar diperlukan?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463313/"><h2 id="rezyume">  Ringkasan </h2><br><p>  Tujuan artikel ini adalah upaya untuk melihat, dari sudut pandang yang berbeda, pada deskripsi sistem distribusi peristiwa. <br><br>  Pada saat penulisan ini, sebagian besar kerangka kerja <strong>php</strong> terkemuka menerapkan sistem acara berdasarkan pada deskripsi suatu <em>EventObject</em> . <br><br>  Ini telah menjadi standar dalam php, yang baru-baru ini dikonfirmasi oleh adopsi standar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">psr / event-dispatcher</a> . <br><br>  Tetapi ternyata deskripsi objek acara tidak banyak membantu dalam mengembangkan pendengar.  Untuk detail di bawah kucing. </p><a name="habracut"></a><br><h2 id="v-chyom-problema">  Apa masalahnya? </h2><br><p>  Mari kita lihat peran dan tujuan dari mereka yang menggunakan <em>EventObject</em> dalam pengembangan. </p><br><ol><li><p>  Pengembang (A) yang menetapkan kemampuan untuk menyuntikkan instruksi pihak ketiga ke dalam prosesnya dengan membuat acara. </p><br><p>  Pengembang menjelaskan <em>EventObject</em> atau tanda tangannya melalui antarmuka. </p><br><p>  Saat mendeskripsikan <em>EventObject, tujuan</em> pengembang <em>adalah</em> untuk memberikan pengembang lain deskripsi objek data, dan dalam beberapa kasus penggunaan, untuk menggambarkan mekanisme interaksi dengan utas utama melalui objek ini. </p><br></li><li><p>  Pengembang (B) yang menggambarkan "pendengar". </p><br><p>  Pengembang berlangganan acara yang ditentukan.  Dalam kebanyakan kasus, deskripsi pendengar harus memenuhi tipe yang <strong>dapat dipanggil</strong> . </p><br><p>  Pada saat yang sama, pengembang tidak malu menyebutkan kelas atau metode pendengar.  Tetapi ada pembatasan lebih lanjut oleh konvensi bahwa pawang menerima <em>EventObject</em> sebagai argumen. </p><br></li></ol><br><p>  Ketika <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">psr / event-dispatcher</a> diadopsi oleh kelompok kerja, banyak pilihan untuk menggunakan sistem distribusi acara dianalisis. </p><br><p>  Standar psr menyebutkan kasus penggunaan berikut: </p><br><ol><li>  pemberitahuan satu arah - "Saya melakukan sesuatu jika Anda tertarik" </li><li>  perbaikan objek - "Ini ada satu hal, tolong ubah sebelum saya melakukan sesuatu dengannya" </li><li>  koleksi - "Beri aku semua barangmu sehingga aku bisa melakukan sesuatu dengan daftar ini" </li><li>  rantai alternatif - “Inilah masalahnya, yang pertama dari Anda untuk mengatasinya, lakukan, lalu berhenti” </li></ol><br><p>  Pada saat yang sama, kelompok kerja mengajukan banyak pertanyaan untuk penggunaan yang sama dari sistem distribusi acara, terkait dengan fakta bahwa masing-masing kasus penggunaan memiliki "ketidakpastian" yang tergantung pada implementasi objek <em>Dispatcher</em> . </p><br><p>  Dalam peran yang dijelaskan di atas untuk pengembang (B), tidak ada cara yang mudah dan mudah dibaca untuk memahami opsi mana dari penggunaan sistem acara yang dipilih oleh pengembang (A).  Pengembang akan selalu harus melihat ke dalam kode deskripsi tidak hanya dari <em>EventObject</em> , tetapi juga dalam kode tempat acara ini dihasilkan. </p><br><p>  Akibatnya, tanda tangan adalah deskripsi objek acara, yang dirancang untuk memudahkan pekerjaan pengembang (B) .Pekerjaan ini tidak berjalan dengan baik. </p><br><p>  Masalah lain adalah tidak selalu dibenarkan adanya objek yang terpisah, yang juga menjelaskan entitas yang sudah dijelaskan dalam sistem. </p><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyApp</span></span>\<span class="hljs-title"><span class="hljs-title">Customer</span></span>\<span class="hljs-title"><span class="hljs-title">Events</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">MyApp</span></span>\<span class="hljs-title"><span class="hljs-title">Customer</span></span>\<span class="hljs-title"><span class="hljs-title">CustomerNameInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">MyFramevork</span></span>\<span class="hljs-title"><span class="hljs-title">Event</span></span>\<span class="hljs-title"><span class="hljs-title">SomeEventInterface</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomerNameChangedEvent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeEventInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *     * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCustomerId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCustomerName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CustomerNameInterface</span></span></span></span>; }</code> </pre> <br><p>  Dalam contoh di atas, objek <em>CustomerNameInterface</em> telah dijelaskan dalam sistem. </p><br><p>  Ini mengingatkan pada pengenalan konsep baru yang berlebihan.  Lagi pula, ketika kita perlu menerapkan metode, misalnya, menulis ke log perubahan nama klien, kita tidak menggabungkan argumen metode menjadi entitas yang terpisah, kami menggunakan deskripsi standar dari metode formulir: </p><br><pre> <code class="php hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeToLogCustomerNameChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( int $customerId, CustomerNameInterface $customerName )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p>  Akibatnya, kami melihat masalah berikut: </p><br><ol><li>  tanda tangan kode pendengar yang buruk </li><li>  Ketidakpastian dispatcher </li><li>  tipe ketidakpastian kembali </li><li>  pengenalan banyak entitas tambahan seperti <em>SomeEventObject</em> </li></ol><br><h2 id="posmotrim-na-eto-s-inoy-tochki-zreniya">  Mari kita melihatnya dari perspektif yang berbeda </h2><br><p>  Jika salah satu masalahnya adalah deskripsi pendengar yang buruk, mari kita lihat sistem distribusi acara bukan dari deskripsi objek acara, tetapi dari deskripsi pendengar. </p><br><p>  Pengembang (A) menjelaskan bagaimana pendengar harus dijelaskan. </p><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyApp</span></span>\<span class="hljs-title"><span class="hljs-title">Customer</span></span>\<span class="hljs-title"><span class="hljs-title">Events</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomerNameChangedListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCustomerNameChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( int $customerId, CustomerNameInterface $customerName )</span></span></span></span>; }</code> </pre> <br><p>  Pengembang luar biasa (A) mampu menyampaikan deskripsi pendengar dan data yang dikirimkan kepada pengembang pihak ketiga. </p><br><p>  Saat menulis pendengar, pengembang (B) mengetikkan <em>CustomerNameChangedListener</em> di lingkungan <em>implement</em> dan IDE dapat menambahkan deskripsi metode pendengar ke kelasnya.  <strong>Pelengkapan kode sangat</strong> bagus. </p><br><p>  Mari kita lihat tanda tangan metode pendengar baru.  Bahkan pandangan sekilas saja sudah cukup untuk memahami bahwa versi sistem distribusi acara yang digunakan adalah: "pemberitahuan satu arah." </p><br><p>  Data input tidak ditransmisikan dengan referensi, yang berarti bahwa tidak ada cara untuk memodifikasinya dengan cara apa pun sehingga perubahan jatuh ke aliran utama.  Nilai pengembalian tidak ada, tidak ada umpan balik dari utas utama. </p><br><p>  Bagaimana dengan kasus penggunaan lainnya?  Mari bermain dengan deskripsi antarmuka pendengar acara. </p><br><hr><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyApp</span></span>\<span class="hljs-title"><span class="hljs-title">Customer</span></span>\<span class="hljs-title"><span class="hljs-title">Events</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomerNameChangedListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCustomerNameChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( int $customerId, CustomerNameInterface $customerName )</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CustomerNameInterface</span></span></span></span>; }</code> </pre> <br><p>  Ada persyaratan untuk nilai kembali, yang berarti pendengar dapat (tetapi tidak diharuskan) mengembalikan nilai yang berbeda jika cocok dengan antarmuka yang ditentukan.  Gunakan case: "peningkatan objek". </p><br><hr><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyApp</span></span>\<span class="hljs-title"><span class="hljs-title">Customer</span></span>\<span class="hljs-title"><span class="hljs-title">Events</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomerNameChangedListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> ItemInterface[] */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCustomerNameChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( int $customerId, CustomerNameInterface $customerName )</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span></span>; }</code> </pre> <br><p>  Ada persyaratan untuk nilai pengembalian jenis tertentu yang dapat dipahami bahwa ini adalah elemen koleksi.  Gunakan case: "collection". </p><br><hr><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyApp</span></span>\<span class="hljs-title"><span class="hljs-title">Customer</span></span>\<span class="hljs-title"><span class="hljs-title">Events</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomerNameChangedListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCustomerNameChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( int $customerId, CustomerNameInterface $customerName )</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VoteInterface</span></span></span></span>; }</code> </pre> <br><p>  Gunakan case: "rantai alternatif, pemungutan suara." </p><br><hr><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyFramework</span></span>\<span class="hljs-title"><span class="hljs-title">Events</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventControllInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre> <br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyApp</span></span>\<span class="hljs-title"><span class="hljs-title">Customer</span></span>\<span class="hljs-title"><span class="hljs-title">Events</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomerNameChangedListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCustomerNameChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( int $customerId, CustomerNameInterface $customerName, EventControllInterface &amp;$eventControll )</span></span></span></span>; }</code> </pre><br><p>  <em>Tanpa diskusi, menghentikan penyebaran acara itu baik atau buruk.</em> </p><br><p>  Opsi ini dibaca dengan jelas, utas utama memberikan kesempatan bagi pendengar untuk menghentikan acara. </p><br><p>  Jadi, jika kita beralih ke deskripsi pendengar, kita mendapatkan tanda tangan metode pendengar yang jauh lebih baik saat mengembangkannya. </p><br><p>  Selain itu, kami memiliki kesempatan untuk utas utama untuk secara eksplisit menunjuk ke: </p><br><ol><li>  penerimaan perubahan data yang masuk </li><li>  tipe pengembalian selain tipe yang masuk </li><li>  transfer eksplisit dari suatu objek untuk menghentikan propagasi suatu peristiwa </li></ol><br><h2 id="kak-realizovat-podpisku-na-sobytie">  Cara menerapkan langganan acara </h2><br><p>  Opsi mungkin berbeda.  Arti umum dari semua opsi datang ke fakta bahwa kita perlu entah bagaimana menginformasikan objek <em>ListenerProvider</em> (objek yang menyediakan kesempatan untuk berlangganan acara), yang merupakan acara milik antarmuka tertentu. </p><br><p>  Anda dapat mempertimbangkan konversi objek yang diteruskan ke jenis yang dapat dipanggil sebagai contoh.  Harus dipahami bahwa mungkin ada banyak pilihan untuk mendapatkan informasi meta tambahan: </p><br><ol><li>  dapat diteruskan secara eksplisit, seperti pada contoh </li><li>  dapat disimpan dalam anotasi antarmuka pendengar </li><li>  Anda dapat menggunakan nama antarmuka pendengar sebagai nama acara </li></ol><br><hr><br><p>  <strong>Contoh Implementasi Berlangganan</strong> </p><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyFramework</span></span>\<span class="hljs-title"><span class="hljs-title">Events</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ListenerProvider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $handlerAssociation = []; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addHandlerAssociation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( string $handlerInterfaceName, string $handlerMethodName, string $eventName )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;handlerAssociation[$handlerInterfaceName] = [ <span class="hljs-string"><span class="hljs-string">'methodName'</span></span> =&gt; $handlerMethodName, <span class="hljs-string"><span class="hljs-string">'eventName'</span></span> =&gt; $eventName ]; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object $handler)</span></span></span><span class="hljs-function"> </span></span>{ $hasAssociation = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;handlerAssociation <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $handlerInterfaceName =&gt; $handlerMetaData ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( $handler interfaceof $handlerInterfaceName ) { $methodName = $handlerMetaData[<span class="hljs-string"><span class="hljs-string">'methodName'</span></span>]; $eventName = $handlerMetaData[<span class="hljs-string"><span class="hljs-string">'eventName'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addListener($eventName, [$handler, $methodName]); $hasAssociation = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !$hasAssociation ) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(<span class="hljs-string"><span class="hljs-string">'Unknown handler object'</span></span>); } } }</code> </pre> <br><p>  Kami menambahkan metode konfigurasi ke objek berlangganan, yang untuk setiap antarmuka pendengar menjelaskan metadata-nya, seperti metode yang dipanggil dan nama acara. </p><br><p>  Menurut data ini, pada saat berlangganan, kami mengubah $ handler yang diteruskan menjadi objek yang dapat dipanggil yang menunjukkan metode yang dipanggil. </p><br><p>  Jika Anda perhatikan, kode ini menyiratkan bahwa satu objek $ handler dapat mengimplementasikan banyak antarmuka pendengar acara dan akan berlangganan masing-masing.  Ini adalah analog dari <em>SubscriberInterface</em> untuk berlangganan massal suatu objek ke beberapa acara.  Seperti yang Anda lihat, implementasi di atas tidak memerlukan mekanisme terpisah seperti <code>addSubscriber(SubscriberInterface $subscriber)</code> ternyata berfungsi di luar kotak. </p><br><h2 id="dispatcher">  Dispatcher </h2><br><p>  Sayangnya, pendekatan yang dijelaskan bertentangan dengan antarmuka yang diterima sebagai standar psr / event-dispatcher </p><br><p>  Karena kita tidak perlu meneruskan objek apa pun ke Dispatcher.  Ya, Anda dapat melewatkan objek seperti gula: </p><br><pre> <code class="php hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Event</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $eventName, ...$arguments)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... } public function getEventName(): string { // ... } public function getArguments(): array { // ... } }</span></span></code> </pre> <br><p>  Dan menggunakannya saat membuat acara pada antarmuka psr, tapi itu benar-benar jelek. </p><br><p>  Dalam cara yang baik, antarmuka Dispatcher akan terlihat lebih baik seperti ini: </p><br><pre> <code class="php hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventDispatcherInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispatch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $eventName, ...$arguments)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispatchStopabled</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $eventName, ...$arguments)</span></span></span></span>; }</code> </pre> <br><p>  Mengapa ada dua metode?  Sulit untuk menggabungkan semua kasus penggunaan menjadi implementasi tunggal.  Lebih baik menambahkan metode Anda sendiri untuk setiap kasus penggunaan, akan ada interpretasi yang jelas tentang bagaimana Dispatcher akan memproses nilai yang dikembalikan dari pendengar. </p><br><p>  Itu saja.  Akan menarik untuk berdiskusi dengan masyarakat apakah pendekatan yang digambarkan memiliki hak untuk hidup. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id463313/">https://habr.com/ru/post/id463313/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id463301/index.html">Gonkey - Alat Penguji Microservice</a></li>
<li><a href="../id463303/index.html">Facebook akhirnya berhenti menargetkan iklan untuk nomor telepon yang dimasukkan orang untuk 2FA</a></li>
<li><a href="../id463305/index.html">Alat untuk menganalisis dan men-debug aplikasi .NET</a></li>
<li><a href="../id463307/index.html">Studi kasus tentang komunikasi dengan klien "berat"</a></li>
<li><a href="../id463311/index.html">CTT dalam solusi server. Versi kedua + pengumuman yang ketiga, dengan kemampuan untuk menyentuh</a></li>
<li><a href="../id463317/index.html">Rincian teknis peretasan bank Capital One di AWS</a></li>
<li><a href="../id463321/index.html">Keranjang kegunaan dan checkout: analisis dari 20 toko online teratas Rusia</a></li>
<li><a href="../id463325/index.html">Game Designer Reflection: Karakter untuk Game yang Belum Keluar</a></li>
<li><a href="../id463327/index.html">Vue.js: 3 anti-pola</a></li>
<li><a href="../id463329/index.html">Pengembangan diagram pohon dinamis menggunakan SVG dan Vue.js</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>