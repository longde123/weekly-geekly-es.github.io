<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéöÔ∏è üóª üò¥ N√£o carregue - n√£o teste: como identificamos problemas com o sistema de gerenciamento de documentos VTB üë©üèΩ‚Äçüéì üë∑ üòÖ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recentemente, o VTB alterou alguns dos componentes de hardware e software do sistema de fluxo de trabalho. As mudan√ßas foram significativas demais par...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>N√£o carregue - n√£o teste: como identificamos problemas com o sistema de gerenciamento de documentos VTB</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vtb/blog/467647/">  Recentemente, o VTB alterou alguns dos componentes de hardware e software do sistema de fluxo de trabalho.  As mudan√ßas foram significativas demais para continuar trabalhando sem testes de carga em grande escala: qualquer problema com o sistema de suporte a documentos (LMS) est√° repleto de grandes perdas. <br><br><img src="https://habrastorage.org/webt/yc/vo/e5/ycvoe5se_fq1pfmmaumbgodslew.jpeg"><br><br>  Os especialistas da Intertrust testaram o VTB SDO em equipamentos da Huawei - um complexo de farm de servidores, rede de dados e armazenamento baseado em unidades de estado s√≥lido.  Para testes, criamos um ambiente que reproduzia cen√°rios reais com a carga m√°xima poss√≠vel.  Resultados e conclus√µes - sob o corte. <br><a name="habracut"></a><br><h2>  Por que precisamos de um sistema de fluxo de trabalho em um banco e por que test√°-lo </h2><br>  O LMS no VTB √© um pacote de software complexo, no qual todos os principais processos de gerenciamento est√£o vinculados.  O sistema fornece servi√ßos gerais de documenta√ß√£o, intera√ß√£o eletr√¥nica, an√°lise.  Uma circula√ß√£o bem organizada de documentos acelera as decis√µes de gest√£o, torna transparente e controlado o procedimento para sua ado√ß√£o, melhora a qualidade da gest√£o e melhora a competitividade do banco. <br><br>  O LMS deve garantir uma implementa√ß√£o clara das decis√µes, de acordo com os regulamentos estabelecidos.  Isso requer alto desempenho, toler√¢ncia a falhas e escala flex√≠vel.  O sistema possui altos requisitos para controle de acesso, o volume de documentos processados ‚Äã‚Äãsimultaneamente e o n√∫mero de usu√°rios.  Agora, existem 65 mil deles no VTB SDO, e esse n√∫mero continua a crescer. <br><br>  O sistema est√° em constante evolu√ß√£o: a arquitetura est√° mudando, as tecnologias desatualizadas est√£o sendo substitu√≠das pelas modernas.  E, recentemente, alguns dos componentes do sistema foram substitu√≠dos por independentes de importa√ß√£o, sem software propriet√°rio.  A nova arquitetura SDO baseada no software CompanyMedia e no complexo de hardware da Huawei lidar√° com o aumento da carga?  Responda sem ambiguidade a essa pergunta, sem esperar por uma situa√ß√£o semelhante na realidade, isso s√≥ foi poss√≠vel com a ajuda do teste de estresse. <br><br>  Al√©m de testar o novo produto de software quanto √† resist√™ncia ao estresse, realizamos as seguintes tarefas: <br><br><ul><li>  determinar os par√¢metros exatos do dimensionamento horizontal e vertical dos servidores para o perfil de carga do banco; <br></li><li>  verifique os componentes quanto √† toler√¢ncia a falhas em condi√ß√µes de alta carga; <br></li><li>  identificar o coeficiente de entropia da intera√ß√£o intercluster com escala horizontal; <br></li><li>  tente dimensionar solicita√ß√µes de leitura ao usar o balanceador de plataforma; <br></li><li>  determinar o coeficiente de escala horizontal de todos os n√≥s e componentes do sistema; <br></li><li>  determinar o m√°ximo poss√≠vel de par√¢metros de hardware dos servidores para v√°rios fins funcionais (escala vertical); <br></li><li>  estudar o perfil de carga da aplica√ß√£o na infraestrutura t√©cnica, aproximar os resultados para planejar o desenvolvimento do sistema de informa√ß√£o; <br></li><li>  Investigue o impacto da consolida√ß√£o de dados de aplicativos em um √∫nico sistema de armazenamento de dados na otimiza√ß√£o de recursos, melhorando a confiabilidade e o desempenho. <br></li></ul><br><h2>  Metodologia e equipamento </h2><br>  O teste de carga de sistemas de gerenciamento eletr√¥nico de documentos geralmente √© realizado de acordo com cen√°rios simplificados.  Eles simulam a localiza√ß√£o e abertura r√°pidas de cart√µes de documentos que n√£o est√£o associados a outros arquivos e n√£o t√™m um hist√≥rico de ciclo de vida.  Nesse caso, como regra geral, ningu√©m leva em considera√ß√£o os direitos de acesso e outros fatores que consomem recursos, caracter√≠sticos de condi√ß√µes reais. <br><br>  Geralmente, esses testes divorciados s√£o realizados por fornecedores de solu√ß√µes.  √â compreens√≠vel: √© importante que um fornecedor demonstre a um cliente em potencial alto desempenho e velocidade do sistema.  N√£o √© de surpreender que modelos de teste simplificados mostrem tempos de resposta recordes do sistema, mesmo que o n√∫mero de usu√°rios e documentos aumente significativamente. <br><br>  Precis√°vamos reproduzir as condi√ß√µes operacionais reais.  Portanto, no in√≠cio, coletamos estat√≠sticas para um m√™s: registramos a atividade do usu√°rio, observamos o trabalho em segundo plano de todos os servi√ßos.  Os sistemas de monitoramento integrados no LMS tornaram-se uma grande ajuda nesse assunto.  Os funcion√°rios do banco ajudaram a corrigir os dados resultantes sobre os fluxos de documentos, enquanto fizemos os ajustes para o crescimento projetado nos fluxos. <br><br>  O resultado foi uma metodologia de teste, com a ajuda da qual foi poss√≠vel simular os processos que ocorrem no sistema, levando em considera√ß√£o todas as cargas reais.  Na bancada de testes, reproduzimos - individualmente e em v√°rias combina√ß√µes - as opera√ß√µes comerciais mais comuns, bem como as solicita√ß√µes mais demoradas.  Durante o teste de desempenho, todos os componentes foram submetidos a estresse.  Foram realizadas opera√ß√µes para calcular os direitos de acesso do usu√°rio aos objetos do sistema, abrir documentos com uma hierarquia ramificada complexa e um grande n√∫mero de links, pesquisar no sistema e assim por diante. <br><br><h3>  Perfil de teste de carga: </h3><br><ul><li>  usu√°rios registrados: 65 mil com um aumento de at√© 150 mil; <br></li><li>  frequ√™ncia de logins de usu√°rios (autentica√ß√µes): 50 mil por hora; <br></li><li>  usu√°rios trabalhando simultaneamente no sistema: 10 mil; <br></li><li>  documentos registrados: 10 milh√µes por ano; <br></li><li>  volume de anexos de arquivo: 1 TB por ano; <br></li><li>  processos de aprova√ß√£o de documentos: 1,5 milh√£o por ano; <br></li><li>  vistos das partes no acordo: 7,5 milh√µes por ano; <br></li><li>  resolu√ß√µes e instru√ß√µes: 15 milh√µes por ano; <br></li><li>  relat√≥rios de resolu√ß√µes e instru√ß√µes: 15 milh√µes por ano; <br></li><li>  tarefas do usu√°rio: 18 milh√µes por ano. <br></li></ul><br>  Essas aplica√ß√µes foram consolidadas em um √∫nico sistema de armazenamento Huawei OceanStor Dorado 6000 V3 com 117 unidades SSD de 3,6 TB cada, o volume utiliz√°vel total √© superior a 300 TB.  A energia da computa√ß√£o foi colocada no sistema de servidor modular do Huawei E9000 e os dados foram transmitidos pela rede com base em comutadores do n√≠vel do datacenter da s√©rie Huawei CE.  Durante o teste, observamos 24 horas por dia todos os indicadores do sistema.  Todos os resultados, incluindo dados hist√≥ricos, foram registrados na forma de gr√°ficos e tabelas para posterior an√°lise. <br><br><h3>  Carregar servidores de infraestrutura de hardware de teste </h3><br><br><img src="https://habrastorage.org/webt/_e/2s/jw/_e2sjwzdxhukjiw-glhk_vj3j98.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/9b4/1e0/a74/9b41e0a74f08b980c948037de04d525a.png"><br><br>  Devido ao alto desempenho do sistema de armazenamento Huawei OceanStor Dorado 6000 V3, os atrasos na execu√ß√£o de qualquer solicita√ß√£o de usu√°rio raramente excederam 1 ms.  Essa velocidade do subsistema de disco do aplicativo nos inspirou a futuras pesquisas.  Decidimos, analisando dados hist√≥ricos, determinar o efeito de v√°rios tipos de cargas de trabalho na infraestrutura t√©cnica.  Os resultados obtidos nos permitem planejar com flexibilidade e precis√£o o desenvolvimento do sistema de acordo com os requisitos da plataforma de hardware. <br><br><h3>  Em termos de escala, verificamos: </h3><br><ul><li>  limite de escala vertical do <b>servidor de aplicativos (CMJ)</b> , recursos de criticidade: n√∫mero de n√∫cleos e frequ√™ncia, quantidade de RAM; <br></li><li>  suporte para dimensionamento horizontal do <b>servidor de aplicativos (CMJ)</b> duplicando servi√ßos funcionalmente id√™nticos e balanceando entre eles; <br></li><li>  limites de escala vertical e horizontal do <b>servidor do cliente (Web-GUI)</b> ; <br></li><li>  limites de escala vertical do <b>armazenamento</b> de <b>arquivos (FS)</b> , recursos de criticidade: largura de banda da rede, velocidade do disco; <br></li><li>  suporte para dimensionamento horizontal do <b>armazenamento</b> de <b>arquivos (FS)</b> devido ao sistema de arquivos distribu√≠do - CEPH, GLUSTERFS; <br></li><li>  limites de escala vertical do <b>banco</b> de <b>dados (PostgreSQL)</b> , recursos de acordo com o grau de criticidade: capacidade de RAM, velocidade do disco, n√∫mero de n√∫cleos e frequ√™ncia; <br></li><li>  suporte para escalonamento horizontal de <b>banco de dados (PostgreSQL)</b> : escalonamento da carga de leitura em servidores escravos, escalonamento da carga de grava√ß√£o com o princ√≠pio de dividir em m√≥dulos funcionais; <br></li><li>  limites de escala vertical e horizontal do <b>intermedi√°rio de mensagens (Apache Artemis)</b> ; <br></li><li>  limites de escala vertical e horizontal do <b>servidor de pesquisa (Apache Solr)</b> . <br></li></ul><br><h2>  Problemas e Solu√ß√µes </h2><br>  Uma das principais tarefas foi identificar poss√≠veis problemas com o desempenho do LMS.  Durante o trabalho, os seguintes gargalos foram identificados e foram encontradas formas de resolv√™-los. <br><br>  <b>Bloqueia o log s√≠ncrono.</b>  As opera√ß√µes de log na configura√ß√£o padr√£o do WildFly s√£o executadas de forma s√≠ncrona e afetam bastante o desempenho.  Decidiu-se mudar para um criador de logs ass√≠ncrono e, ao mesmo tempo, gravar n√£o em um disco, mas no sistema de agrega√ß√£o de logs ELK. <br><br>  <b>Inicializa√ß√£o de sess√µes desnecess√°rias ao trabalhar com um data warehouse.</b>  Cada encadeamento que recebeu dados do reposit√≥rio inicializou duas vezes uma sess√£o para autentica√ß√£o no modo SSO.  Essa opera√ß√£o consome muitos recursos e aumenta bastante o tempo de execu√ß√£o da solicita√ß√£o do usu√°rio, al√©m de reduzir a taxa de transfer√™ncia geral do servidor. <br><br>  <b>Bloqueia ao trabalhar com objetos de cache do aplicativo.</b>  O aplicativo usou bloqueios reentrantLock bastante pesados ‚Äã‚Äã(Java 7), o que afetou adversamente a velocidade de execu√ß√£o da consulta.  O tipo de bloqueio foi alterado para stampedLock, o que reduziu significativamente o tempo gasto no trabalho com objetos de cache. <br><br>  Depois disso, lan√ßamos novamente o teste de carga para determinar o tempo m√©dio das opera√ß√µes t√≠picas no sistema LMS com armazenamento relacional no perfil do banco.  Obtivemos os seguintes resultados: <br><br><ul><li>  autoriza√ß√£o do usu√°rio no sistema - 400 ms; <br></li><li>  vendo o progresso em m√©dia - 2,5 s; <br></li><li>  cria√ß√£o de um cart√£o de registro e controle - 1,4 s; <br></li><li>  registro e registro do cart√£o de controle - 600 ms; <br></li><li>  cria√ß√£o de uma resolu√ß√£o - 1 p. <br></li></ul><br><h2>  Conclus√µes </h2><br>  Al√©m de identificar problemas, o teste de estresse confirmou algumas de nossas suposi√ß√µes. <br><br><ul><li>  O sistema funciona muito melhor na fam√≠lia de sistemas operacionais Linux. <br></li><li>  Os princ√≠pios declarados de garantir a toler√¢ncia a falhas funcionam no n√≠vel de cada componente em um modo "quente". <br></li><li>  Um componente-chave - o servi√ßo de l√≥gica de neg√≥cios (aceitando solicita√ß√µes do usu√°rio) - possui "espelhamento" de escala horizontal e escala quase linear de taxa de transfer√™ncia com um aumento no n√∫mero de inst√¢ncias. <br></li><li>  Dimensionamento ideal do servi√ßo de l√≥gica de neg√≥cios para 1200 usu√°rios simult√¢neos - 8 vCPU para o servi√ßo e 1,5 vCPU para o DBMS. <br></li><li>  A consolida√ß√£o dos dados do aplicativo em um √∫nico sistema de armazenamento aumenta significativamente a produtividade e a confiabilidade, aumenta a escalabilidade. <br></li></ul><br>  Teremos o maior prazer em responder √†s suas perguntas nos coment√°rios - talvez voc√™ esteja interessado em aprender mais sobre alguns aspectos dos testes. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt467647/">https://habr.com/ru/post/pt467647/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt467629/index.html">O livro ‚ÄúRealidade irreal. Viajando pelo la√ßo qu√¢ntico ¬ª</a></li>
<li><a href="../pt467631/index.html">Visualiza√ß√µes de contexto JavaScript</a></li>
<li><a href="../pt467633/index.html">Peti√ß√£o: Relat√≥rio e pagamento autom√°ticos de impostos sobre o rendimento da FLP (Ucr√¢nia)</a></li>
<li><a href="../pt467639/index.html">Semana 38 de seguran√ßa: rastreamento de dispositivos m√≥veis via cart√£o SIM</a></li>
<li><a href="../pt467645/index.html">Ap√≥s o Angular Meetup # 15</a></li>
<li><a href="../pt467653/index.html">Habrastatistics: analisando os coment√°rios dos leitores</a></li>
<li><a href="../pt467655/index.html">Como passei o ver√£o com C # 8</a></li>
<li><a href="../pt467657/index.html">Invent√°rio de I a Z. Contamos licen√ßas de software</a></li>
<li><a href="../pt467659/index.html">Acelere significativamente a execu√ß√£o de tarefas pelo exemplo de configura√ß√£o adicional da mem√≥ria HyperX FURY DDR4 atualizada</a></li>
<li><a href="../pt467661/index.html">Dos√≠metro para Seryozha. Parte I. Polimaster - Ca√ßadores de Nucl√≠deos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>