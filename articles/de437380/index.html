<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙎🏾 🦕 🌭 Jeder schimpft mit selbstgeschriebenen Test-Frameworks. Und wir sind zufrieden mit unserem 👨🏼‍⚖️ 🙈 👨🏼‍💼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mein Name ist Elena Rastorgueva, ich bin verantwortlich für das Faktor-Produkt bei HFLabs . Der Faktor ist ein verdammt komplexes algorithmisches Unte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Jeder schimpft mit selbstgeschriebenen Test-Frameworks. Und wir sind zufrieden mit unserem</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/hflabs/blog/437380/"><img src="https://habrastorage.org/webt/nt/p-/0f/ntp-0fxrjpsarus7awbwtsdgdhu.jpeg"><br><br>  Mein Name ist Elena Rastorgueva, ich bin verantwortlich für das Faktor-Produkt bei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">HFLabs</a> .  Der Faktor ist ein verdammt komplexes algorithmisches Unternehmen, das Daten im industriellen Maßstab verarbeitet. <br><br>  In diesem Artikel werde ich Ihnen erzählen, wie wir mit dem Testen des "Faktors" begonnen haben, wie wir automatische Tests entwickelt haben und warum wir zu den selbst geschriebenen Frameworks gekommen sind. <br><a name="habracut"></a><br><h2>  Was für ein Produkt ist das - "Faktor" </h2><br>  "Faktor" bereinigt Daten in Datenbanken mit Millionen von Kunden: Entfernt Tippfehler in Namen, Telefon und E-Mail, überprüft Pässe und macht vieles mehr.  Am schwierigsten ist es, die Postanschriften zu korrigieren. <br><br><img src="https://habrastorage.org/webt/sc/le/g8/scleg8hmrcclix90ouwukypheke.png"><br>  <sub>Adressen werden auf Hunderte von Arten geschrieben, sodass der Faktor einen starken algorithmischen Apparat unter der Haube hat</sub> <br><br>  "Faktor" funktioniert als Dienst: Eingabedaten - Ausgabedaten. <br><br>  Dies ist ein zustandsloses System, bei dem jeder Anruf unabhängig von den vorherigen ist.  Staatenlos vereinfacht das Leben des Testers erheblich.  Es ist viel schwieriger, ein Stateful-System zu testen, wenn eine Abfolge von Aktionen wichtig ist. <br><br>  Das Produkt muss als ISS zuverlässig sein, da es von Banken, Mobilfunkbetreibern, Versicherungen und Einzelhändlern der Lenta-Ebene verwendet wird.  Wir antworten auf Fehler mit unserem Kopf, soweit das Fehlen von Fehlern Teil des SLA im Vertrag mit dem Kunden ist. <br><br>  Aufgrund der Zuverlässigkeitsanforderungen von Autotests haben wir von Anfang an geschrieben.  Eines der Kriterien für die Bereitschaft der Aufgabe ist "AutoTests hinzugefügt". <br><br><h2>  Begonnen mit manuellen Überprüfungen und Autotests </h2><br>  Wir haben den Faktor 2005 auf den Markt gebracht und ihn zuerst mit unseren Händen getestet.  Am Morgen führte der Tester automatische Tests für eine Datei mit Fällen durch und verglich das Ergebnis der Datenverarbeitung mit dem Ergebnis des Vortages: Was hat sich nach dem gestrigen Code-Commit geändert? <br><br>  Der Vorgang konnte einen halben Tag dauern, diese Ausrichtung war nicht gut.  Aus diesem Grund haben wir die Mindestanzahl von Tests für die Schlüsselfunktionalität durchgeführt und Unit-Tests durchgeführt.  Diese Tests sind schnell und wurden vom Entwickler selbst ausgeführt, bevor sie festgeschrieben wurden. <br><br>  Unit-Tests sind so bequem und schnell, dass wir Tausende davon hinzugefügt haben.  Und dann sind wir darauf gestoßen: Wenn die Tests wie ein Blatt mit Tausenden von Codeteilen aussehen, ist es nicht einfach, an die richtige Stelle zu scrollen.  Ganz zu schweigen vom Hinzufügen oder Aktualisieren. <br><br><img src="https://habrastorage.org/webt/vd/a5/ua/vda5uatnzsl6du95r_x_jjbpsle.png"><br>  <sub>Unit-Test zur Überprüfung des SNILS-Formats</sub> <br><br>  Außerdem erscheint in den Industriedaten plötzlich etwas Unerwartetes, das keine Unit-Tests abdeckt.  Zum Beispiel kam ein neuer Kunde mit neuen Funktionen in Adressen, Unit-Tests decken diese Funktionen nicht ab.  Sie müssen sich hinsetzen und sehen, welche Tests für neue Daten hinzugefügt werden sollen.  Wir haben das immer noch manuell gemacht. <br><br><h2>  Erstellen Sie Ihr eigenes Framework </h2><br>  Bei herkömmlichen Komponententests werden Daten und Code verwechselt. Es ist schwierig, die richtigen Teile zu finden. <br><br>  Daher haben wir Autotests im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DDT-</a> Paradigma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">(Data Driven Testing)</a> versucht.  DDT ist, wenn Daten zum Testen getrennt vom Code zum Testen gespeichert werden. <br><br>  Fälle wurden aus einer Excel-Datei geladen, sie befanden sich in den Spalten "Rohdaten" und "Erwartetes Ergebnis".  DDT war ein Durchbruch: Das Aktualisieren von Fällen in der "Exelnik" ist unbeschreiblich einfacher. <br><br>  Nach und nach entwickelten wir einen Ansatz und entwickelten unser eigenes Test-Framework.  Es empfängt Textdateien als Eingabe, in denen sich die Quelldaten und das erwartete Ergebnis befinden. <br><br><img src="https://habrastorage.org/webt/4z/ux/b2/4zuxb2hzdkjzampel0ioln9qksa.png"><br>  <sub>Wir haben Excel-Dateien als Speicher abgelehnt: Textdateien werden schneller geöffnet, ändern den Inhalt nicht, es ist einfacher, Daten von ihnen zu sammeln</sub> <br><br>  Das Framework wird durch Standardtools unterstützt: <br><br><ul><li>  TeamCity führt jede Nacht automatisch Tests durch. </li><li>  testNG vergleicht erwartete und tatsächliche Ergebnisse. </li></ul><br><img src="https://habrastorage.org/webt/js/3p/3x/js3p3xatz9q9u7qhd1hk7ahinfq.png"><br>  <sub>Wenn das Ergebnis anders als erwartet ist, wird der Test in TeamCity rot.</sub>  <sub>Wenn alles so ist, wie es sollte, ist der Test grün</sub> <br><br><h2>  Das Framework für sich selbst geändert </h2><br>  Seitdem sind 12 Jahre vergangen.  In dieser Zeit ist das Framework mit Funktionen überfüllt, die nicht in Standardlösungen enthalten sind. <br><br>  <b>Berücksichtigung des Aufgabenstatus in Jira.</b>  HFLabs hält an der testgesteuerten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Entwicklung fest</a> : Zuerst schreiben wir einen Test oder fügen Testfälle für neues Verhalten hinzu und ändern erst dann die Funktionalität. <br><br>  Wir haben neue Fälle ausgeschaltet, indem wir die Zeile auskommentiert haben.  Andernfalls fielen sie zuerst und störten, weil Fälle zuvor Funktionen oder Fehlerbehebungen hinzugefügt hatten. <br><br>  Möglicherweise kann die Aufgabe den entsprechenden Testfall jedoch nicht abschließen: Der Fehler wird sich als äußerst selten herausstellen oder der Kunde wird etwas Wichtigeres mitbringen.  Einige Aufgaben hingen monatelang mit niedriger Priorität, und es häuften sich getrennte Fälle.  Gleichzeitig ist unklar, zu welcher Aufgabe jeder Fall gehört, ob dieser Fall gelöscht werden kann. <br><br>  Aus diesem Grund haben wir den getrennten Fällen eine Aufgabennummer hinzugefügt und ein wenig Automatisierung vermasselt.  Jetzt funktioniert alles so: <br><br><ul><li>  Der Testfall wird deaktiviert, indem er mit einer offenen Aufgabe in Jira abgeglichen wird. <br><br><img src="https://habrastorage.org/webt/ny/xd/rb/nyxdrbvmz4np0kkgjgn5srct-cw.png"><br>  <sub>Um einen Fall an eine Aufgabe anzuhängen, schreiben Sie davor <i>#</i> und Aufgabennummer</sub> <br></li><li>  Das Framework führt Tests auch in deaktivierten Fällen aus.  Ignoriert jedoch Abstürze, während die Aufgabe in Jira geöffnet ist. </li><li>  Sobald die Aufgabe geschlossen ist, beginnt der Test auf die damit verbundenen Fälle zu fallen.  Dies ist ein Signal: Sie haben die Aufgabe bestanden, aber vergessen, die Fälle einzuschalten. </li><li>  Wenn der Test für den getrennten Fall plötzlich mit einer offenen Aufgabe zu bestehen begann, wird das Framework auch darüber informieren.  Vielleicht ist es an der Zeit, den Fall einzuschalten oder die damit verbundene Aufgabe zu schließen (plus Versionshinweise zu aktualisieren und Kunden zu informieren). <br><br><img src="https://habrastorage.org/webt/ah/eb/vt/ahebvthx1cfsge12a5ofyjms408.png"><br>  <sub>Das Framework sagt, dass der getrennte Fall durchlaufen wird.</sub>  <sub>Vielleicht hat jemand den Code als Teil einer anderen Aufgabe korrigiert, und jetzt funktioniert alles</sub> <br></li></ul><br>  Also haben wir TDD gerettet und Vergesslichkeit bei der Verwaltung von Testfällen besiegt. <br><br><img src="https://habrastorage.org/webt/8s/df/1w/8sdf1wf1xib-di08-upv-njfwd8.png"><br>  <sub>Wir haben alle Optionen mit dem Status von Testfällen und verwandten Aufgaben dokumentiert, um nicht zu vergessen</sub> <br><br>  <b>Aktualisieren von Testfällen im halbautomatischen Modus.</b>  Wenn der Test abstürzt, suchen Sie anscheinend nach einem Fehler im Code.  Für uns ist dies jedoch nicht immer der Fall.  Es kommt manchmal vor, dass Testfälle aktualisiert werden müssen, da sich die Anforderungen an das Ergebnis geändert haben. <br><br>  Zum Beispiel, bevor der Kunde in der gelöschten Adresse "g.  Moskau “in einem Bereich.  Jetzt hat er die Architektur der Datenbank geändert, er will die "Stadt" in einem Bereich, "Moskau" in einem anderen.  Es ist Zeit, die Testfälle zu ändern. <br><br>  Für den gefallenen Test zeigt TeamCity den Unterschied zwischen den erwarteten und tatsächlichen Ergebnissen.  Zuvor haben wir diesen Unterschied kopiert und Testfälle mit unseren Händen aktualisiert.  Für massive Veränderungen - eine sehr teure Veranstaltung. <br><br><img src="https://habrastorage.org/webt/2g/cv/iu/2gcviu56ac4pgtbtb3me4k5cc_0.png"><br>  <sub>Ein lebendiges Beispiel: Wir haben „Faktor“ beigebracht, ein Land anhand der Telefonnummer zu bestimmen. Die Tests in TeamCity fielen.</sub>  <sub>Ein neuer Benchmark kann aus dem tatsächlichen Ergebnis entnommen werden, dies dauert jedoch lange</sub> <br><br>  Wir haben das Framework den Benchmark selbst aktualisieren lassen.  Zu diesem Zweck werden nach dem Ausführen der Tests die erwarteten Reinigungsergebnisse im Standard durch die tatsächlichen ersetzt, bei denen sie nicht übereinstimmen.  Das Ergebnis wird in Artefakten als Fallaktualisierungsdatei gespeichert. <br><br><img src="https://habrastorage.org/webt/6e/ok/dp/6eokdpdk8hqlbsggw2e2zxsyxty.png"><br>  <sub>Die erste Datei ist ein neuer Benchmark, bei dem das Framework die erwarteten Ergebnisse aktualisiert hat.</sub>  <sub>Die verbleibenden Dateien sind die Eingabedaten, der alte Standard und die tatsächlichen Daten für die abgelegten Fälle.</sub> <br><br>  Mit dem neuen Benchmark aktualisiert der Tester die Fälle in drei Schritten. <br><br><ol><li>  Laden Sie die generierte Datei herunter. </li><li>  Überprüft alle Zusammenführungswerkzeuge, welche Änderungen im neuen Benchmark vorgenommen wurden.  Lässt nur das Notwendige. </li><li>  Festschreiben </li></ol><br><img src="https://habrastorage.org/webt/wp/o8/xn/wpo8xnrbcyzdhqkbif0mafezhbs.png"><br>  <sub>Der Tester prüft, ob die Aktualisierungen im neuen Standard korrekt sind, und schreibt sie fest</sub> <br><br>  Ja, wenn gedankenlos aktualisiert, wird nichts Gutes daraus.  Bei manueller Arbeit besteht jedoch die Gefahr einer gedankenlosen Aktualisierung. <br><br>  <b>Stabilisierung von Testdaten mit Stichleitungen.</b>  "Faktor" gibt verarbeitete Daten in Dutzenden von Feldern zurück.  Es gibt eine Reihe von Komponenten in nur einer Adresse: Index, Region, Regionstyp, Stadttyp, Stadt, Straßentyp, Haus, Gebäude, Gebäude, Wohnung.  Für sie fängt der „Faktor“ IFTS, OKATO, OKTMO und sogar die kleinen Dinge ein.  So werden aus einer Zeile am Eingang Dutzende von Werten erhalten. <br><br>  Nicht alle Felder aus dem Ergebnis müssen mit Testfällen überprüft werden.  Beispielsweise hängt die Erkennung derselben Adresse direkt vom Statusverzeichnis FIAS ab.  Und darin ändern sich die Felder regelmäßig, für unsere Aufgaben sind sie völlig irrelevant.  Durch die Aktualisierung einiger CLADR-Codes für Häuser wurden Hunderte von Testfällen gelöscht. <br><br>  Wir haben dem erwarteten Ergebnis Stubs hinzugefügt, als wir feststellten, dass wir unsere Zeit damit verschwenden, unwichtige Stürze zu analysieren. <br><br>  Wenn das Feld überhaupt nicht überprüft werden muss, schreibt der Tester ein Symbol in das erwartete Ergebnis: <i>$$ DNV $$</i> .  Wann das Feld ausgefüllt werden soll, aber der Wert selbst ist nicht wichtig: <i>$$ NE $$</i> . <br><br><img src="https://habrastorage.org/webt/ol/v6/e_/olv6e_wixlpjexljoquxpcgo4l8.png"><br>  <sub>Die FIAS-ID befindet sich immer in der Adresse, daher überprüfen wir sie bei allen Tests.</sub>  <sub>Wenn das Feld leer ist, stimmt etwas nicht.</sub>  <sub>Der Index ist jedoch möglicherweise nicht vorhanden. Daher ignorieren wir den Index, wenn wir die FIAS-ID überprüfen</sub> <br><br>  Sie könnten auch in die andere Richtung gehen und die Tests trennen: Jedes Feld hat sein eigenes.  Aber es ist schwierig, weil nicht alles isoliert werden kann.  Zum Beispiel sind "Stadt" und "Straße" Teile einer Adresse und ohne einander keinen Sinn. <br><br><h2>  Ein selbst geschriebenes Framework ist bequemer </h2><br>  Daher halte ich die Schaffung eines eigenen Rahmens überhaupt nicht für ein dummes Unterfangen.  Wenn wir kein eigenes Tool erstellt hätten, hätten wir nicht so viele neue Möglichkeiten und Flexibilität erhalten. <br><br>  Das Deaktivieren des Textfalls nach Aufgabenstatus, das Generieren eines neuen Benchmarks und Stubs für das Ergebnis sind die Dinge, die unsere Tester jetzt in anderen Frameworks fragen.  Wenn wir Standardlösungen nehmen würden, wären wir dazu niemals in der Lage. <br><br>  <i>Wenn Sie komplexe Dinge im Unternehmen erledigen möchten, kommen Sie zu uns.</i>  <i>Jetzt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">suchen wir einen Java-Entwickler</a> , Gehalt ab 135 000 ₽ ohne Einkommenssteuer.</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de437380/">https://habr.com/ru/post/de437380/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de437368/index.html">MOSDROID # 15 Phosphor</a></li>
<li><a href="../de437372/index.html">Drei einfache Tricks zum Reduzieren von Docker-Bildern</a></li>
<li><a href="../de437374/index.html">Facebook-Nutzer vermieten ihre Konten mit Geld und kostenlosen Laptops</a></li>
<li><a href="../de437376/index.html">Neugierige Perversionen aus der Welt der IT - 2</a></li>
<li><a href="../de437378/index.html">Was ist ARCore? Alles was Sie wissen müssen</a></li>
<li><a href="../de437382/index.html">Theorie des Feuerwerks. Kosmologische Fantasie</a></li>
<li><a href="../de437384/index.html">Das Ministerium für Arbeit und Rostelecom ging bei der Bewertung der Anzahl der Beamten, die Smartphones auf dem inländischen OS Sailfish erhalten, auseinander</a></li>
<li><a href="../de437386/index.html">Interviews - Interviewer Look</a></li>
<li><a href="../de437390/index.html">"Geheimnisse" DPAPI. Schau dir den Esel an</a></li>
<li><a href="../de437396/index.html">Warum wird CarPrice von künstlicher Intelligenz angetrieben?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>