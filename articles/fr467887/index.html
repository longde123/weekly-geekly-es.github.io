<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé∂ üßò üëâüèø R√©flexions caustiques r√©alistes üåì üê∏ üö∂üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La plupart des artistes techniques √† un moment donn√© de leur carri√®re essaient de cr√©er des reflets plausibles des caustiques. Si vous √™tes un d√©velop...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>R√©flexions caustiques r√©alistes</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/467887/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/hd/an/yo/hdanyowyfitt8zvoj7vaeu3drdi.gif"></div><br>  La plupart des artistes techniques √† un moment donn√© de leur carri√®re essaient de cr√©er des reflets plausibles des caustiques.  Si vous √™tes un d√©veloppeur de jeux, l'une des principales raisons de lire Twitter est le flot incessant d'inspiration que vous pouvez en tirer.  Il y a quelques jours, Florian Gelzenlichter ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener noreferrer">kolyaTQ</a> sur Twitter) a publi√© un GIF de l'effet caustique cr√©√© dans Unity √† l'aide de shaders.  La publication (pr√©sent√©e ci-dessous) a rapidement gagn√© 1,5 mille likes, ce qui montre un int√©r√™t sinc√®re pour ce type de contenu. <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1165251296720576512"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  Bien que je sois g√©n√©ralement plus attir√© par des s√©ries d'articles plus longues et techniquement complexes (par exemple, sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener noreferrer">la diffusion volum√©trique de la lumi√®re atmosph√©rique</a> [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">traduction</a> sur Habr√©] et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener noreferrer">la cin√©matique inverse</a> [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">premi√®re</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">deuxi√®me</a> parties de la traduction sur Habr√©), je n'ai pas pu r√©sister √† la tentation d'√©crire un tutoriel court et mignon sur les effets de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener noreferrer">Florian</a> . <br><br>  √Ä la fin de cet article, il y a un lien pour t√©l√©charger le package Unity et tous les actifs n√©cessaires. <br><a name="habracut"></a><br><h2>  Qu'est-ce que caustique </h2><br>  Vous ne <em>connaissez</em> peut-√™tre <em>pas le</em> concept des <em>caustiques</em> , bien que vous rencontriez cet effet quotidiennement.  Les caustiques sont des reflets de lumi√®re caus√©s par des surfaces courbes.  Dans le cas g√©n√©ral, toute surface incurv√©e peut se comporter comme une lentille, focalisant la lumi√®re √† certains points et la diffusant √† d'autres.  Les m√©dias les plus courants fournissant un tel effet sont le verre et l'eau, qui g√©n√®rent les <strong>ondes</strong> dites <strong>caustiques</strong> (voir ci-dessous). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2cf/dcc/0c7/2cfdcc0c727f1637ffc5c360fd816a8f.jpg"></div><br>  Les caustiques peuvent prendre d'autres formes.  Un arc-en-ciel, par exemple, est un ph√©nom√®ne optique qui se produit lorsque la lumi√®re est r√©fract√©e dans les gouttes de pluie.  Par cons√©quent, √† proprement parler, c'est caustique. <br><br><h2>  Anatomie de l'effet </h2><br>  Une caract√©ristique reconnaissable des ondes caustiques est la fa√ßon dont elles se d√©placent;  vous l'avez probablement vu si vous avez d√©j√† regard√© le fond de la piscine.  Recr√©er un v√©ritable caustique est tr√®s co√ªteux car il n√©cessite la simulation de nombreux rayons lumineux. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener noreferrer">Florian a</a> r√©ussi √† cr√©er un effet plausible, √† commencer par une seule texture caustique.  Pour cr√©er mon tutoriel, j'ai utilis√© la texture illustr√©e ci-dessous, tir√©e d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener noreferrer">OpenGameArt</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c3a/418/def/c3a418defd9ff05890f63c4c35e728ad.gif" width="250" height="250"></div><br>  Une propri√©t√© importante qui permet de r√©aliser cet effet est que le motif caustique illustr√© ci-dessus est <strong>sans couture</strong> .  Cela signifie que vous pouvez placer deux images l'une √† c√¥t√© de l'autre et qu'il n'y aura pas de couture visible entre elles.  Puisque nous voulons utiliser cet effet sur de grandes surfaces, il est important que nous ayons la possibilit√© d'√©tirer cette texture sans larmes qui peuvent d√©truire l'illusion. <br><br>  Ayant re√ßu la texture, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener noreferrer">Florian</a> sugg√®re de suivre trois √©tapes: <br><br><ul><li>  Appliquer un motif caustique deux fois sur la surface du mod√®le, √† chaque fois en utilisant diff√©rentes tailles et vitesses </li><li> M√©langer deux motifs avec l'op√©rateur <code>min</code> </li><li>  S√©parez les canaux RVB lors de l'√©chantillonnage. </li></ul><br>  Voyons comment vous pouvez impl√©menter chacune des √©tapes dans Unity. <br><br><h2>  Cr√©ation de shader </h2><br>  La premi√®re √©tape consiste √† cr√©er un nouveau shader.  √âtant donn√© que cet effet est susceptible d'√™tre utilis√© dans un jeu 3D qui dispose √©galement d'un v√©ritable √©clairage, il est pr√©f√©rable de commencer avec un <strong>shader de surface</strong> .  Les shaders de surface sont l'un des nombreux types de shaders pris en charge par Unity (tels que les <strong>shaders de vertex et de fragments</strong> pour les mat√©riaux non √©clair√©s, <strong>les shaders d'√©cran</strong> pour les effets de post-traitement et <strong>les shaders de calcul</strong> pour les simulations hors √©cran). <br><br>  Le nouveau shader de surface n'a que quelques fonctionnalit√©s.  Pour cr√©er cet effet, nous devons transf√©rer des informations vers le shader.  Le premier est la texture caustique.  Deuxi√®mement, il s'agit du param√®tre utilis√© pour le mettre √† l'√©chelle et le compenser. <br><br>  Cr√©ons deux <em>propri√©t√©s de shader</em> : <br><br><pre> <code class="cpp hljs">Properties { ... [Header(Caustics)] _CausticsTex(<span class="hljs-string"><span class="hljs-string">"Caustics (RGB)"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} <span class="hljs-comment"><span class="hljs-comment">// Tiling X, Tiling Y, Offset X, Offset Y _Caustics_ST("Caustics ST", Vector) = (1,1,0,0) }</span></span></code> </pre> <br>  et les <em>variables Cg</em> correspondantes: <br><br><pre> <code class="cpp hljs">sampler2D _CausticsTex; float4 _Caustics_ST;</code> </pre> <br>  <em>Les propri√©t√©s du shader</em> correspondent aux champs affich√©s dans l'inspecteur de mat√©riaux Unity.  Les <em>variables Cg</em> correspondantes sont les valeurs elles-m√™mes, qui peuvent √™tre utilis√©es dans le code du shader. <br><br>  Comme vous pouvez le voir dans le code ci-dessus, <code>_Caustics_ST</code> est <code>float4</code> , c'est-√†-dire qu'il contient quatre valeurs.  Nous les utiliserons pour contr√¥ler l'√©chantillonnage de la texture caustique.  √Ä savoir: <br><br><ul><li>  <code>_Caustics_ST.x</code> : √©chelle de la texture caustique le long de l'axe X; </li><li>  <code>_Caustics_ST.y</code> : √©chelle de la texture caustique le long de l'axe Y; </li><li>  <code>_Caustics_ST.z</code> : d√©placement de la texture caustique le long de l'axe X; </li><li>  <code>_Caustics_ST.w</code> : d√©placement de la texture caustique le long de l'axe Y <code>_Caustics_ST.w</code> </li></ul><br><div class="spoiler">  <b class="spoiler_title">Pourquoi la variable s'appelle _Caustics_ST?</b> <div class="spoiler_text">  Si vous avez d√©j√† un peu d'exp√©rience avec les shaders, vous avez d√©j√† vu d'autres propri√©t√©s se terminant par le suffixe <code>_ST</code> .  Dans Unity, <code>_ST</code> peut √™tre utilis√© pour ajouter des informations suppl√©mentaires sur la fa√ßon dont la texture est √©chantillonn√©e. <br><br>  Par exemple, si vous cr√©ez la variable Cg <code>_MainTex_ST</code> , vous pouvez l'utiliser pour d√©finir la taille et le d√©calage lors de l'application de la texture au mod√®le. <br><br>  Les variables <code>_ST</code> pas besoin de propri√©t√©s car elles sont automatiquement affich√©es dans l'inspecteur.  Cependant, dans ce cas particulier, nous ne pouvons pas nous y fier car nous devons √©chantillonner la texture deux fois, √† chaque fois avec une √©chelle et un d√©calage diff√©rents.  √Ä l'avenir, nous devons dupliquer cette variable en deux variables diff√©rentes. </div></div><br><h2>  Texture d'√©chantillonnage </h2><br>  Chaque <em>shader de surface</em> contient une fonction, commun√©ment appel√©e <code>surf</code> , qui est utilis√©e pour d√©terminer la couleur de chaque pixel rendu.  La fonction de <code>surf</code> ¬´standard¬ª ressemble √† ceci: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">surf</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Input IN, inout SurfaceOutputStandard o)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Albedo comes from a texture tinted by color fixed4 c = tex2D (_MainTex, IN.uv_MainTex) * _Color; o.Albedo = c.rgb; // Metallic and smoothness come from slider variables o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; }</span></span></code> </pre> <br>  La couleur finale est d√©termin√©e par le nombre de champs que le shader doit initialiser et renvoyer dans une structure appel√©e <code>SurfaceOutputStandard</code> .  Nous devons changer l' <code>Albedo</code> , qui correspond √† peu pr√®s √† la couleur de l'objet √©clair√© par la lumi√®re blanche. <br><br>  Dans le shader de surface nouvellement cr√©√©, l'alb√©do est extrait d'une texture appel√©e <code>_MainTex</code> .  √âtant donn√© que l'effet caustique est superpos√© √† la texture existante, nous devrons effectuer un √©chantillonnage suppl√©mentaire de la texture dans <code>_CausticsTex</code> . <br><br>  Une technique appel√©e <strong>superposition UV</strong> vous permet de comprendre quelle partie de la texture doit √™tre √©chantillonn√©e en fonction de la partie de la g√©om√©trie qui doit √™tre rendue.  Cela se fait en utilisant <code>uv_MainTex</code> - la variable <code>float2</code> , stock√©e √† chaque sommet du mod√®le 3D et indiquant la coordonn√©e de la texture. <br><br>  Notre id√©e est d'utiliser <code>_Caustics_ST</code> pour <code>_Caustics_ST</code> √† l'√©chelle et compenser <code>uv_MainTex</code> pour √©tirer et d√©placer la texture caustique √† travers le mod√®le. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">surf</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Input IN, inout SurfaceOutputStandard o)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Albedo comes from a texture tinted by color fixed4 c = tex2D (_MainTex, IN.uv_MainTex) * _Color; o.Albedo = c.rgb; // Caustics sampling fixed2 uv = IN.uv_MainTex * _Caustics_ST.xy + _Caustics_ST.zw; fixed3 caustics = tex2D(_CausticsTex, uv).rgb; // Add o.Albedo.rgb += caustics; // Metallic and smoothness come from slider variables o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; }</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Que se passe-t-il si Albedo d√©passe 1?</b> <div class="spoiler_text">  Dans le code ci-dessus, nous ajoutons deux textures.  La couleur est g√©n√©ralement comprise entre <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>0</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="2.074ex" viewBox="0 -772.3 500.5 892.8" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/467887/&amp;usg=ALkJrhjyMZBUYcoZUzJApRZ7xnFB3I0ClQ#MJMAIN-30" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-1"> 0 </script>  avant <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>1</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="2.074ex" viewBox="0 -772.3 500.5 892.8" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/467887/&amp;usg=ALkJrhjyMZBUYcoZUzJApRZ7xnFB3I0ClQ#MJMAIN-31" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-2"> 1 </script>  Cependant, rien ne garantit qu'en cons√©quence, certaines valeurs ne d√©passeront pas cet intervalle. <br><br>  Dans les shaders plus anciens, cela pourrait provoquer un probl√®me.  Ici, c'est en fait une <em>fonctionnalit√©</em> .  Si la valeur de couleur des pixels d√©passe l'unit√©, cela signifie que son influence devrait ¬´s'√©tendre¬ª au-del√† de ses fronti√®res et affecter les pixels voisins. <br><br>  C'est exactement ce qui se produit lorsque des r√©flexions sp√©culaires tr√®s lumineuses sont obtenues.  Cependant, cet effet ne doit pas √™tre cr√©√© uniquement par un ombrage de surface.  Pour que l'effet fonctionne, la cam√©ra doit avoir le <strong>HDR</strong> activ√©.  Cette propri√©t√© signifie <strong>High Dynamic Range</strong> ;  il permet aux valeurs de couleur de d√©passer <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>1</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="2.074ex" viewBox="0 -772.3 500.5 892.8" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/467887/&amp;usg=ALkJrhjyMZBUYcoZUzJApRZ7xnFB3I0ClQ#MJMAIN-31" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-3"> 1 </script>  .  De plus, pour brouiller une quantit√© excessive de couleurs sur les pixels voisins, un effet de post-traitement est requis. <br><br>  Unity a sa propre pile de post-traitement, qui a un filtre de floraison qui fait exactement cela.  Vous pouvez en savoir plus √† ce sujet sur le blog Unity: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener noreferrer">PostFX v2 - Incroyable visuels, mis √† niveau</a> . </div></div><br>  Les r√©sultats pr√©liminaires sont pr√©sent√©s ci-dessous: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9d5/16f/1de/9d516f1de5a00d84b60e95674cf35650.png" width="843" height="406"></div><br><h2>  Caustiques anim√©s </h2><br>  L'une des caract√©ristiques les plus importantes des caustiques est leur mouvement.  Pour le moment, ils sont simplement projet√©s statiquement sur la surface du mod√®le en tant que seconde texture. <br><br>  L'animation des mat√©riaux dans les shaders peut √™tre impl√©ment√©e √† l'aide de la propri√©t√© Unity <code>_Time</code> .  Il peut √™tre utilis√© pour acc√©der au temps de jeu actuel, c'est-√†-dire ajouter du temps aux √©quations. <br><br>  Le moyen le plus simple consiste √† simplement d√©caler la texture en fonction de l'heure actuelle. <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Caustics UV fixed2 uv = IN.uv_MainTex * _Caustics_ST.xy + _Caustics_ST.zw; uv += _CausticsSpeed * _Time.y; // Sampling fixed3 caustics = tex2D(_CausticsTex, uv).rgb; // Add o.Albedo.rgb += caustics;</span></span></code> </pre> <br>  Le champ <code>_Time.y</code> contient le temps de lecture actuel en <em>secondes</em> .  Si la r√©flexion se d√©place trop rapidement, vous pouvez la multiplier par un facteur.  Pour cela, la variable <code>_CausticsSpeed</code> de type <code>float2</code> utilis√©e dans le code pr√©sent√© ci-dessus. <br><br>  Vous devrez peut-√™tre faire vibrer la texture caustique dans une sinuso√Øde √† vos fins.  Il est important de comprendre ici qu'il n'y a pas de moyen standard de r√©aliser l'effet.  Selon vos besoins, vous pouvez faire bouger les r√©flexions caustiques de mani√®re compl√®tement diff√©rente. <br><br>  Les r√©sultats ci-dessous sont encore assez m√©diocres.  C'est normal: nous avons encore beaucoup √† faire pour rendre les reflets magnifiques. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b6e/37d/d6b/b6e37dd6b3d6e172c342c7902845f60d.gif"></div><br><h2>  √âchantillonnage multiple </h2><br>  L'effet devient vivant si vous √©chantillonnez la texture caustique non pas une, mais deux fois.  Si vous les posez les uns sur les autres et les d√©placez √† des vitesses diff√©rentes, le r√©sultat sera compl√®tement diff√©rent. <br><br>  Tout d'abord, nous <code>_CausticsSpeed</code> propri√©t√©s <code>_Caustics_ST</code> et <code>_CausticsSpeed</code> afin que les √©chantillons des deux textures aient des √©chelles, des d√©placements et des vitesses diff√©rents: <br><br><pre> <code class="cpp hljs">[Header(Caustics)] _CausticsTex(<span class="hljs-string"><span class="hljs-string">"Caustics (RGB)"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} <span class="hljs-comment"><span class="hljs-comment">// Tiling X, Tiling Y, Offset X, Offset Y _Caustics1_ST("Caustics 1 ST", Vector) = (1,1,0,0) _Caustics2_ST("Caustics 1 ST", Vector) = (1,1,0,0) // Speed X, Speed Y _Caustics1_Speed("Caustics 1 Speed", Vector) = (1, 1, 0 ,0) _Caustics2_Speed("Caustics 2 Speed", Vector) = (1, 1, 0 ,0)</span></span></code> </pre> <br>  Maintenant que nous avons deux √©chantillons caustiques, ils peuvent √™tre m√©lang√©s √† l'aide de l'op√©rateur <code>min</code> .  Si vous prenez simplement la valeur moyenne, le r√©sultat ne sera pas tr√®s bon. <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Caustics samplings fixed3 caustics1 = ... fixed3 caustics2 = ... // Blend o.Albedo.rgb += min(caustics1, caustics2);</span></span></code> </pre> <br>  Un si petit changement fait une √©norme diff√©rence: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ea/c9d/444/3eac9d4448485555980e10424e3f4ad5.gif"></div><br>  Pour garder le code beau, vous pouvez √©galement envelopper le code d'√©chantillonnage caustique dans votre propre fonction: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Caustics fixed3 c1 = causticsSample(_CausticsTex, IN.uv_MainTex, _Caustics1_ST, _Caustics1_Speed); fixed3 c2 = causticsSample(_CausticsTex, IN.uv_MainTex, _Caustics2_ST, _Caustics2_Speed); o.Albedo.rgb += min(c1, c2);</span></span></code> </pre> <br><h2>  S√©paration RVB </h2><br>  Pour que les reflets caustiques semblent bons, vous devez faire le dernier tour.  En passant √† travers une tranche, la lumi√®re de diff√©rentes longueurs d'onde est r√©fract√©e diff√©remment.  Cela signifie que lorsque vous vous d√©placez dans l'eau, la lumi√®re peut "se diviser" en diff√©rentes couleurs. <br><br>  Pour simuler cet effet, nous pouvons diviser chaque √©chantillon caustique en trois, un pour chaque canal de couleur.  En √©chantillonnant les canaux rouge, vert et bleu avec un l√©ger biais, nous obtenons un d√©calage de couleur. <br><br>  Commen√ßons par ajouter la propri√©t√© <code>_SplitRGB</code> , qui indique la force de l'effet de <code>_SplitRGB</code> - <code>_SplitRGB</code> : <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Caustics UV fixed2 uv = IN.uv_MainTex * _Caustics_ST.xy + _Caustics_ST.zw; uv += _CausticsSpeed * _Time.y; // RGB split fixed s = _SplitRGB; fixed r = tex2D(tex, uv + fixed2(+s, +s)).r; fixed g = tex2D(tex, uv + fixed2(+s, -s)).g; fixed b = tex2D(tex, uv + fixed2(-s, -s)).b; fixed3 caustics = fixed3(r, g, b);</span></span></code> </pre> <br>  La quantit√© de d√©calage des canaux RVB peut √™tre s√©lectionn√©e arbitrairement, mais m√™me avec ce d√©calage simple, une image tr√®s convaincante est obtenue: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a96/ccc/bd8/a96cccbd861252130d289d9362ef0ec0.gif"></div><br><h2>  Conclusion et t√©l√©chargements </h2><br>  Si vous √™tes int√©ress√© √† apprendre √† cr√©er des textures caustiques sans couture, alors vous devriez lire l'article int√©ressant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener noreferrer">Textures caustiques p√©riodiques</a> . <br><br>  Pendant ce temps, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener noreferrer">Florian</a> continue de travailler sur son shader caustique et a apport√© des am√©liorations assez int√©ressantes qui peuvent √™tre vues. <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-1" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1167866285369131008"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  Un package complet pour ce tutoriel est disponible sur Patreon, il comprend tous les atouts n√©cessaires pour recr√©er cette technique.  Le package a √©t√© export√© depuis Unity 2019.2 et n√©cessite la pile de post-traitement v2. <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√âl√©ment standard</a> : fichier <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Shader</a> uniquement </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Actifs payants</a> : sc√®ne compl√®te, y compris la texture et les mat√©riaux caustiques. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr467887/">https://habr.com/ru/post/fr467887/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr467875/index.html">Ne soyez pas timide, moins</a></li>
<li><a href="../fr467877/index.html">Android pour l'ing√©nieur radio (et pas seulement)</a></li>
<li><a href="../fr467881/index.html">Meetup Tutu.ru backend</a></li>
<li><a href="../fr467883/index.html">Kubernetes 1.16 - comment mettre √† niveau et ne rien casser</a></li>
<li><a href="../fr467885/index.html">Mines de produits et de segments</a></li>
<li><a href="../fr467891/index.html">FAQ sur la signature [√©lectronique] du cloud</a></li>
<li><a href="../fr467893/index.html">Juste un autre wrapper Qt pour gRPC et protobuf</a></li>
<li><a href="../fr467895/index.html">Quels mod√®les les r√©seaux de neurones trouvent-ils?</a></li>
<li><a href="../fr467897/index.html">Outils de test automatique, int√©gration de Yandex Mapkit 3, design sympa et approche d'interface utilisateur pilot√©e par le serveur - Annonce Mitap Android</a></li>
<li><a href="../fr467901/index.html">R√©futez quatre st√©r√©otypes sur le langage de programmation Rust</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>