<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👎🏻 🤚🏻 ♉️ DocumentFragment: qu'est-ce que c'est et comment (pas) le combattre 👩🏽‍🤝‍👩🏻 👨🏽‍🏫 🏂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Clause de non-responsabilité  Il semble que je commence une nouvelle série d'articles - un peu ennuyeux et purement utilitaire. Ils expliqueront les p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DocumentFragment: qu'est-ce que c'est et comment (pas) le combattre</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413287/"><div class="spoiler">  <b class="spoiler_title">Clause de non-responsabilité</b> <div class="spoiler_text"><blockquote>  Il semble que je commence une nouvelle série d'articles - un peu ennuyeux et purement utilitaire.  Ils expliqueront les points qui causent souvent des difficultés à mes élèves.  Si vous êtes un développeur Web chevronné, vous ne serez probablement pas intéressé.  Si vous attendez des perversions au pouvoir de la JS de vendredi, elles ne seront hélas pas là. </blockquote><br></div></div><br>  DocumentFragment est une des choses que les étudiants ont régulièrement du mal à comprendre.  En général, je ne peux pas leur en vouloir.  Avec une simplicité externe, il possède plusieurs propriétés non évidentes et même contre-intuitives.  Dans cet article, je veux rassembler tout ce qu'un débutant doit savoir sur lui. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e78/763/714/e78763714fde55d53538cc188fdbec85.jpg" alt="image"><br><a name="habracut"></a><br><h3>  Qu'est ce que c'est </h3><br>  Un DocumentFragment est un conteneur qui peut contenir un nombre arbitraire d'éléments DOM.  Si tout simplement, vous pouvez l'imaginer comme un seau.  Les éléments y sont empilés de sorte qu'au bon moment, ils puissent être immédiatement vidés. <br><br><h3>  Comment créer </h3><br>  Élémentaire. <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fragment = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createDocumentFragment();</code> </pre> <br>  Il existe également d'autres moyens, mais à leur sujet ci-dessous. <br><br><h3>  Pourquoi ai-je besoin </h3><br>  Comme je l'ai écrit ci-dessus, afin de stocker des éléments DOM.  "Mais ils peuvent être stockés dans une diva ordinaire", peut objecter le lecteur.  Certes, cependant, le fragment a une propriété unique qui en fait le meilleur candidat pour ce rôle.  Considérez le code suivant: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fragment = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createDocumentFragment(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parentDiv = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">"div"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> div1 = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">"div"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> div2 = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">"div"</span></span>); fragment.appendChild(div1); fragment.appendChild(div2); <span class="hljs-comment"><span class="hljs-comment">//   parentDiv.appendChild(fragment); console.log(parentDiv.children);</span></span></code> </pre><br>  Que nous dira la console?  Une personne peu familière avec DocumentFragment pourrait penser que <code>parentDiv</code> aura un enfant - <code>fragment</code> .  Mais en fait, il aura deux enfants - <code>div1</code> et <code>div2</code> .  Le fait est que le fragment lui-même n'est pas un élément DOM, c'est seulement un conteneur pour les éléments DOM.  Et quand il est passé en argument à des méthodes comme <code>appendChild</code> ou <code>insertBefore</code> , il ne s'intègre pas dans l'arborescence DOM, mais y incorpore son contenu. <br><br><h3>  Mais pourquoi en avez-vous besoin? </h3><br>  La propriété «bucket» est, bien sûr, bonne, mais en quoi est-elle utile en pratique?  DocumentFragment a deux principaux domaines d'application. <br><br>  <b>1. Stockage de morceaux de HTML qui n'ont pas d'ancêtre commun.</b> <br><br>  Il y a des situations où nous devons remplacer le contenu d'un élément, mais ne touchez pas l'élément lui-même.  Supposons que nous utilisons la délégation d'événements et que tous les gestionnaires d'événements qui se produisent sur des éléments internes soient suspendus sur un div externe.  Dans ce cas, DocumentFragment est idéal pour nous: <br><br><pre> <code class="javascript hljs">div.innerHTML = <span class="hljs-string"><span class="hljs-string">""</span></span>; div.appendChild(fragmentWithAllContent);</code> </pre><br>  "Mais pouvons-nous simplement ajouter des éléments à la div dès que nous les créons?"  - demandera le lecteur corrosif.  Nous pouvons, mais cela n'en vaut pas la peine, et c'est pourquoi. <br><br>  <b>2. Amélioration des performances dans le cas d'inserts multiples.</b> <br><br>  Le fait est que chaque fois que nous changeons quelque chose dans l'arborescence DOM active, le navigateur doit faire un tas de calculs.  Vous pouvez en savoir plus à ce sujet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> , par exemple.  Dans cet article, nous nous limitons à mentionner qu'il y a une telle bête terrible - refusion.  Lorsque nous ajoutons un élément à la page, cette bête se réveille et mange un morceau de temps processeur.  Si nous ajoutons cent éléments à tour de rôle, la bête se réveillera cent fois et fera une piqûre cent fois.  Pour l'utilisateur, cela peut déjà être un «gel» assez visible. <br><br>  Lorsque nous ajoutons un élément à DocumentFragment, cela ne provoque pas de redistribution, car le fragment ne fait pas (et ne peut fondamentalement pas) faire partie de l'arborescence DOM active.  Et le plus important: lorsque nous insérons le contenu d'un fragment à l'aide d' <code>appendChild</code> ou d'autres méthodes similaires, quel que soit le nombre d'éléments à l'intérieur du fragment, la <b>redistribution n'est appelée qu'une seule fois</b> . <br><br>  Pour plus de clarté, j'ai fait une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">référence simple</a> afin que le lecteur puisse personnellement voir la différence. <br><br>  Mise à jour: le camarade <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">nuit a</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dit</a> que pour Chrome moderne, mes mots ne sont plus vrais.  Dans ce document, la redistribution n'est pas exécutée plus tôt que nécessaire, et grâce à cela, le code sans DocumentFragment fonctionne réellement <b>plus rapidement</b> , et avec d'autres navigateurs, ce n'est pas si évident.  Donc, avant de décider d'utiliser des fragments, vous avez besoin d'un profilage et d'une recherche sur le public cible du site. <br><br><h3>  Nuances </h3><br>  Il existe deux fonctionnalités qui rendent les novices souvent difficiles à utiliser des fragments.  Premièrement: comme je l'ai écrit ci-dessus, un fragment n'est <b>pas un élément DOM</b> .  Cela signifie qu'il lui manque de nombreuses méthodes et propriétés familières, en particulier - <code>innerHTML</code> .  Par conséquent, vous ne pouvez pas simplement transformer une chaîne en contenu d'un fragment.  Comment faire cela n'est pas facile, sera décrit ci-dessous. <br><br>  La deuxième caractéristique: le fragment lors de l'utilisation de "butin".  Plus précisément, il est vidé.  Lorsque nous <code>div.appendChild(fragment)</code> , tous les enfants du fragment sont <code>div.appendChild(fragment)</code> dans un <code>div</code> .  Et puisqu'un élément ne peut pas avoir plus d'un parent, cela signifie qu'ils sont supprimés du fragment!  Pour éviter ce comportement lorsqu'il n'est pas souhaitable, vous pouvez utiliser <code>cloneNode</code> . <br><br><h3>  balise &lt;template&gt; </h3><br>  Il existe un endroit où vous pouvez rencontrer DocumentFragment sans le créer via JS.  Il s'agit de la propriété de <code>content</code> de l'élément de modèle. <br><br>  La <code>&lt;template&gt;</code> inventée spécifiquement pour stocker des morceaux de code HTML, mais pas pour charger le navigateur à l'avance.  Ce qui se trouve à l'intérieur de cette balise ne fait pas partie de l'arborescence DOM active.  En particulier (les nouveaux arrivants rencontrent souvent cela aussi), ils ne peuvent pas être trouvés en utilisant <code>querySelector</code> .  Les éléments créés à partir de code HTML à l'intérieur de la <code>&lt;template&gt;</code> n'en deviennent pas des enfants.  Au lieu de cela, JavaScript peut y accéder via la propriété de <code>content</code> , ce qui est - une surprise!  - juste DocumentFragment. <br><br>  À l'aide de l'élément de modèle, vous pouvez créer un fragment à partir d'une chaîne: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createFragmentFromString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">str</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> template = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">"template"</span></span>); template.innerHTML = str; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> template.content; }</code> </pre><br><h3>  Épilogue </h3><br>  Si vous êtes nouveau dans le développement Web, j'espère que vous avez beaucoup appris.  Si vous êtes un développeur expérimenté, vous voudrez peut-être compléter cet article avec quelque chose, auquel cas n'hésitez pas à en parler dans les commentaires.  Merci d'avoir lu et bonne journée. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413287/">https://habr.com/ru/post/fr413287/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr413277/index.html">JSFiddle - nouvelle version</a></li>
<li><a href="../fr413279/index.html">L'application mobile calcule la teneur en calories des plats dans les restaurants</a></li>
<li><a href="../fr413281/index.html">Les principales tendances de la WWDC selon Redmadrobot</a></li>
<li><a href="../fr413283/index.html">Six expériences Skyscanner qui ont fait croître l'application mobile</a></li>
<li><a href="../fr413285/index.html">Télégraphe, Western Union et guerre nucléaire. Comment les États-Unis ont discrètement créé un système d'alerte à la menace nucléaire</a></li>
<li><a href="../fr413289/index.html">Automatisation des centres de données ou "rébellion des machines"</a></li>
<li><a href="../fr413291/index.html">Le livre "Deep Learning in Python"</a></li>
<li><a href="../fr413293/index.html">Grand exode de l'industrie du jeu vidéo</a></li>
<li><a href="../fr413297/index.html">Polices Web variables</a></li>
<li><a href="../fr413303/index.html">L'histoire d'un problème: le plus court mémo JavaScript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>