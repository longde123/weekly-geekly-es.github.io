<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯжО ЁЯСйЁЯП┐тАНтЪЦя╕П ЁЯТО рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рджреВрд░реА рдХреЗ рдЦреЗрддреЛрдВ рдкрд░ 2 рдбреА рдЫрд╛рдпрд╛ ЁЯС╢ЁЯП╛ ЁЯУХ ЁЯСНЁЯП┐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдЕрдм рдЬрдм рд╣рдо рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХрд┐рдП рдЧрдП рджреВрд░рд╕реНрде рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд╕рдВрдпреЛрдЬрди рдХреА рдореВрд▓ рдмрд╛рддреЗрдВ рдЬрд╛рдирддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЙрдиреНрд╣реЗрдВ рдардВрдбреА рдЪреАрдЬреЗрдВ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдореЗрдВ, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рджреВрд░реА рдХреЗ рдЦреЗрддреЛрдВ рдкрд░ 2 рдбреА рдЫрд╛рдпрд╛</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438942/"> рдЕрдм рдЬрдм рд╣рдо рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХрд┐рдП рдЧрдП рджреВрд░рд╕реНрде рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд╕рдВрдпреЛрдЬрди рдХреА рдореВрд▓ рдмрд╛рддреЗрдВ рдЬрд╛рдирддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЙрдиреНрд╣реЗрдВ рдардВрдбреА рдЪреАрдЬреЗрдВ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдореЗрдВ, рд╣рдо рдЙрдиреНрд╣реЗрдВ рд╕реЙрдлреНрдЯ рдЯреВ-рдбрд╛рдпрдореЗрдВрд╢рдирд▓ рд╢реИрдбреЛ рд░реЗрдВрдбрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред  рдпрджрд┐ рдЖрдкрдиреЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рджреВрд░реА рдХреЗ рдХреНрд╖реЗрддреНрд░реЛрдВ (рдПрд╕рдбреАрдПрдл) рдкрд░ рдореЗрд░реЗ рдкрд┐рдЫрд▓реЗ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдХреЛ рдирд╣реАрдВ рдкрдврд╝рд╛ рд╣реИ, рддреЛ рдореИрдВ рдЖрдкрдХреЛ рдЕрддреНрдпрдзрд┐рдХ рдЕрдзреНрдпрдпрди рдХрд░рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреЗрддрд╛ рд╣реВрдВ, рдЬреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рд╛рдзрд╛рд░рдг рдЖрдХреГрддрд┐рдпреЛрдВ рдкрд░</a> рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдХреЗ</a> рд╕рд╛рде рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yl/el/eh/ylelehlfeymk9yzxs5eezpyzyfq.gif"></div><br>  [GIF рдкреБрдирд░реНрд╕рдВрд░рдЪрдирд╛ рдХреЗ рджреМрд░рд╛рди рдЕрддрд┐рд░рд┐рдХреНрдд рдХрд▓рд╛рдХреГрддрд┐рдпреЛрдВ рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред] <br><a name="habracut"></a><br><h2>  рдореВрд▓ рд╡рд┐рдиреНрдпрд╛рд╕ </h2><br>  рдореИрдВрдиреЗ рдПрдХ рдХрдорд░реЗ рдХреЗ рд╕рд╛рде рдПрдХ рд╕рд░рд▓ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдмрдирд╛рдпрд╛, рдпрд╣ рдкрд┐рдЫрд▓реЗ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдореЗрдВ рд╡рд░реНрдгрд┐рдд рддрдХрдиреАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред  рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ, рдореИрдВрдиреЗ рдпрд╣ рдЙрд▓реНрд▓реЗрдЦ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдерд╛ рдХрд┐ рдореИрдВрдиреЗ x рдФрд░ y рдХреБрд▓реНрд╣рд╛рдбрд╝рд┐рдпреЛрдВ рдХреЗ рд╕рд╛рдкреЗрдХреНрд╖ рд╕реНрдерд┐рддрд┐ рдХреЛ рдкреНрд░рддрд┐рдмрд┐рдВрдмрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡реЗрдХреНрдЯрд░ 2 рдХреЗ рд▓рд┐рдП рдПрдмреНрд╕ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдерд╛, рдФрд░ рдпрд╣ рднреА рдХрд┐ рдореИрдВрдиреЗ рдЖрдВрддрд░рд┐рдХ рдФрд░ рдмрд╛рд╣рд░реА рднрд╛рдЧреЛрдВ рдХреЛ рд╕реНрд╡реИрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдХреГрддрд┐ рдХреА рджреВрд░реА рдХреЛ рдЙрд▓рдЯрд╛ рдХрд░ рджрд┐рдпрд╛ред <br><br>  рд╣рдо shader рдХреЗ рд╕рд╛рде рдПрдХ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдкрд┐рдЫрд▓реЗ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рд╕реЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">2D_SDF.cginc</a> рдлрд╛рдЗрд▓ рдХреЙрдкреА рдХрд░реЗрдВрдЧреЗ, рдЬрд┐рд╕реЗ рд╣рдо рдЗрд╕ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдореЗрдВ рд▓рд┐рдЦреЗрдВрдЧреЗред <br><br><pre> <code class="cpp hljs">Shader <span class="hljs-string"><span class="hljs-string">"Tutorial/037_2D_SDF_Shadows"</span></span>{ Properties{ } SubShader{ <span class="hljs-comment"><span class="hljs-comment">//the material is completely non-transparent and is rendered at the same time as the other opaque geometry Tags{ "RenderType"="Opaque" "Queue"="Geometry"} Pass{ CGPROGRAM #include "UnityCG.cginc" #include "2D_SDF.cginc" #pragma vertex vert #pragma fragment frag struct appdata{ float4 vertex : POSITION; }; struct v2f{ float4 position : SV_POSITION; float4 worldPos : TEXCOORD0; }; v2f vert(appdata v){ v2f o; //calculate the position in clip space to render the object o.position = UnityObjectToClipPos(v.vertex); //calculate world position of vertex o.worldPos = mul(unity_ObjectToWorld, v.vertex); return o; } float scene(float2 position) { float bounds = -rectangle(position, 2); float2 quarterPos = abs(position); float corner = rectangle(translate(quarterPos, 1), 0.5); corner = subtract(corner, rectangle(position, 1.2)); float diamond = rectangle(rotate(position, 0.125), .5); float world = merge(bounds, corner); world = merge(world, diamond); return world; } fixed4 frag(v2f i) : SV_TARGET{ float dist = scene(i.worldPos.xz); return dist; } ENDCG } } FallBack "Standard" //fallback adds a shadow pass so we get shadows on other objects }</span></span></code> </pre> <br>  рдпрджрд┐ рд╣рдо рдЕрднреА рднреА рдкрд┐рдЫрд▓реЗ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рд╕реЗ рд╡рд┐рдЬрд╝реБрдЕрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдВрдХрдбрд╝рд╛ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ff/2cc/aee/5ff2ccaee5f12c0f87a1b7ae455bc044.png"></div><br><h2>  рд╕рд░рд▓ рдЫрд╛рдпрд╛ </h2><br>  рддреЗрдЬ рдЫрд╛рдпрд╛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдирдореВрдиреЗ рдХреА рд╕реНрдерд┐рддрд┐ рд╕реЗ рдкреНрд░рдХрд╛рд╢ рд╕реНрд░реЛрдд рдХреА рд╕реНрдерд┐рддрд┐ рддрдХ рдЪрд╛рд░реЛрдВ рдУрд░ рдЬрд╛рддреЗ рд╣реИрдВред  рдпрджрд┐ рд╣рдореЗрдВ рд░рд╛рд╕реНрддреЗ рдореЗрдВ рдХреЛрдИ рд╡рд╕реНрддреБ рдорд┐рд▓рддреА рд╣реИ, рддреЛ рд╣рдо рддрдп рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдкрд┐рдХреНрд╕реЗрд▓ рдХреЛ рдЫрд╛рдпрд╛рдВрдХрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдФрд░ рдпрджрд┐ рд╣рдо рдмрд┐рдирд╛ рдмрд╛рдзрд╛ рдХреЗ рд╕реНрд░реЛрдд рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рдХрд╣рддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рдЫрд╛рдпрд╛рдВрдХрд┐рдд рдирд╣реАрдВ рд╣реИред <br><br>  рд╣рдо рдмреАрдо рдХреЗ рдореВрд▓ рдорд╛рдкрджрдВрдбреЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░рдХреЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред  рдмреАрдо рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдмрд┐рдВрджреБ (рдкрд┐рдХреНрд╕реЗрд▓ рдХреА рд╕реНрдерд┐рддрд┐ рд╣рдо рдкреНрд░рджрд╛рди рдХрд░ рд░рд╣реЗ рд╣реИрдВ) рдФрд░ рдПрдХ рд▓рдХреНрд╖реНрдп рдмрд┐рдВрджреБ (рдкреНрд░рдХрд╛рд╢ рд╕реНрд░реЛрдд рдХреА рд╕реНрдерд┐рддрд┐) рд╣реИред  рд╣рдореЗрдВ рдПрдХ рд▓рдВрдмрд╛рдИ рдФрд░ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рджрд┐рд╢рд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рд╢реБрд░реБрдЖрдд рд╕реЗ рдЕрдВрдд рддрдХ рдШрдЯрд╛рдХрд░ рдФрд░ рдкрд░рд┐рдгрд╛рдо рдХреЛ рд╕рд╛рдорд╛рдиреНрдп рдХрд░рдХреЗ рджрд┐рд╢рд╛ рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред  рд▓рдВрдмрд╛рдИ рдХреЛ рдкрджреЛрдВ рдХреЛ рдШрдЯрд╛рдХрд░ рдФрд░ <code>length</code> рд╡рд┐рдзрд┐ рдХреЗ рдорд╛рди рдХреЛ рдкрд╛рд╕ рдХрд░рдХреЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">traceShadow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(float2 position, float2 lightPosition)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> direction = normalise(lightPosition - position); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distance = length(lightPosition - position); }</code> </pre> <br>  рдлрд┐рд░ рд╣рдо рдкреБрдирд░рд╛рд╡реГрддрд┐ рд▓реВрдк рдореЗрдВ рдХрд┐рд░рдг рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдШреВрдорддреЗ рд╣реИрдВред  рд╣рдо рдкрд░рд┐рднрд╛рд╖рд┐рдд рдШреЛрд╖рдгрд╛ рдореЗрдВ рд▓реВрдк рдХреА рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐рдпреЛрдВ рдХреЛ рд╕реЗрдЯ рдХрд░реЗрдВрдЧреЗ, рдФрд░ рдпрд╣ рд╣рдореЗрдВ рдмрд╛рдж рдореЗрдВ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐рдпреЛрдВ рдХреА рдЕрдзрд┐рдХрддрдо рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛, рдФрд░ рдХрдВрдкрд╛рдЗрд▓рд░ рдХреЛ рд▓реВрдк рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░рдХреЗ рд╢реЗрдбрд░ рдХреЛ рдереЛрдбрд╝рд╛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред <br><br>  рд▓реВрдк рдореЗрдВ, рд╣рдореЗрдВ рдЙрд╕ рд╕реНрдерд┐рддрд┐ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬреЛ рд╣рдо рдЕрднреА рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕реЗ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдореВрд▓реНрдп 0. рдХреЗ рд╕рд╛рде рд▓реВрдк рдХреЗ рдмрд╛рд╣рд░ рдШреЛрд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВред рд▓реВрдк рдореЗрдВ, рд╣рдо рдмреАрдо рдХреА рджрд┐рд╢рд╛ рдХреЛ рдЖрдзрд╛рд░ рд╕реНрдерд┐рддрд┐ рдХреЗ рд╕рд╛рде рдмреАрдо рдХреА рджрд┐рд╢рд╛ рд╕реЗ рдЧреБрдгрд╛ рдХрд░рдХреЗ рдирдореВрдирд╛ рдХреА рд╕реНрдерд┐рддрд┐ рдХреА рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдлрд┐рд░ рд╣рдо рдЧрдгрдирд╛ рдХреА рдЧрдИ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рджреВрд░реА рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдирдореВрдирд╛ рд▓реЗрддреЗ рд╣реИрдВред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// outside of function #define SAMPLES 32 // in shadow function float rayDistance = 0; for(int i=0 ;i&lt;SAMPLES; i++){ float sceneDist = scene(pos + direction * rayDistance); //do other stuff and move the ray further }</span></span></code> </pre> <br>  рдлрд┐рд░ рд╣рдо рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪ рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЙрд╕ рдмрд┐рдВрджреБ рдкрд░ рд╣реИрдВ рдЬрд╣рд╛рдВ рд╣рдо рдЪрдХреНрд░ рдХреЛ рд░реЛрдХ рд╕рдХрддреЗ рд╣реИрдВред  рдпрджрд┐ рд╕рдВрдХреЗрдд рдХреЗ рд╕рд╛рде рджреВрд░реА рдлрд╝рдВрдХреНрд╢рди рдХреЗ рджреГрд╢реНрдп рдХреА рджреВрд░реА 1 рдХреЗ рдХрд░реАрдм рд╣реИ, рддреЛ рд╣рдо рдорд╛рди рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдмреАрдо рдПрдХ рдЖрдВрдХрдбрд╝рд╛ рджреНрд╡рд╛рд░рд╛ рдЕрд╡рд░реБрджреНрдз рд╣реИ рдФрд░ рд╡рд╛рдкрд╕ 0. рдпрджрд┐ рдХрд┐рд░рдг рдкреНрд░рдХрд╛рд╢ рд╕реНрд░реЛрдд рд╕реЗ рджреВрд░реА рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЖрдЧреЗ рдлреИрд▓рддреА рд╣реИ, рддреЛ рд╣рдо рдпрд╣ рдорд╛рди рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдо рдмрд┐рдирд╛ рд╕реНрд░реЛрддреЛрдВ рдХреЗ рдкрд╣реБрдВрдЪ рдЧрдП рдФрд░ рдорд╛рди рд▓реМрдЯрд╛рдПрдВ 1ред <br><br>  рдпрджрд┐ рд░рд┐рдЯрд░реНрди рд╕рдлрд▓ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдирдореВрдиреЗ рдХреА рдЕрдЧрд▓реА рд╕реНрдерд┐рддрд┐ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдпрд╣ рдмреАрдо рдЙрдиреНрдирддрд┐ рджреГрд╢реНрдп рдореЗрдВ рджреВрд░реА рдЬреЛрдбрд╝рдХрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рдпрд╣ рд╣реИ рдХрд┐ рджреГрд╢реНрдп рдореЗрдВ рджреВрд░реА рд╣рдореЗрдВ рдирд┐рдХрдЯрддрдо рдЖрдВрдХрдбрд╝реЗ рд╕реЗ рджреВрд░реА рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рд╣рдо рдмреАрдо рдореЗрдВ рдЗрд╕ рдорд╛рди рдХреЛ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рд╕рдВрднрд╡рддрдГ рдмреАрдо рдХреЛ рдирд┐рдХрдЯрддрдо рдЖрдВрдХрдбрд╝реЗ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ, рдпрд╛ рдЙрд╕рд╕реЗ рдкрд░реЗ рднреА рдирд╣реАрдВ рдлреЗрдВрдХ рдкрд╛рдПрдВрдЧреЗ, рдЬрд┐рд╕рд╕реЗ рдЫрд╛рдпрд╛ рдХрд╛ рдкреНрд░рд╡рд╛рд╣ рд╣реЛрдЧрд╛ред <br><br>  рдЗрд╕ рдШрдЯрдирд╛ рдореЗрдВ рдХрд┐ рд╣рдордиреЗ рдХреБрдЫ рднреА рд╕рд╛рдордирд╛ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдФрд░ рдЬрдм рддрдХ рдирдореВрдирд╛ рдХрд╛ рд╕реНрдЯреЙрдХ рдкреВрд░рд╛ рдирд╣реАрдВ рд╣реБрдЖ (рдЪрдХреНрд░ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЧрдпрд╛) рддрдХ рдкреНрд░рдХрд╛рд╢ рд╕реНрд░реЛрдд рддрдХ рдирд╣реАрдВ рдкрд╣реБрдВрдЪрд╛, рддреЛ рд╣рдореЗрдВ рдореВрд▓реНрдп рд╡рд╛рдкрд╕ рдХрд░рдиреЗ рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЪреВрдВрдХрд┐ рдпрд╣ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдЖрдХреГрддрд┐рдпреЛрдВ рдХреЗ рдмрдЧрд▓ рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ, рдХреБрдЫ рд╕рдордп рдкрд╣рд▓реЗ рдкрд┐рдХреНрд╕реЗрд▓ рдХреЛ рдЕрднреА рднреА рдЫрд╛рдпрд╛рдВрдХрд┐рдд рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпрд╣рд╛рдБ рд╣рдо 0 рдХреЗ рд░рд┐рдЯрд░реНрди рдорд╛рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> SAMPLES 32 float traceShadows(float2 position, float2 lightPosition){ float2 direction = normalize(lightPosition - position); float lightDistance = length(lightPosition - position); float rayProgress = 0; for(int i=0 ;i</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SAMPLES; i++){ float sceneDist = scene(position + direction * rayProgress); if(sceneDist &lt;= 0){ return 0; } if(rayProgress &gt; lightDistance){ return 1; } rayProgress = rayProgress + sceneDist; } return 0; }</span></span></span></span></code> </pre> <br>  рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЗрд╕реЗ рдкрд┐рдХреНрд╕реЗрд▓ рдХреА рд╕реНрдерд┐рддрд┐ рдФрд░ рдкреНрд░рдХрд╛рд╢ рд╕реНрд░реЛрдд рдХреА рд╕реНрдерд┐рддрд┐ рдХреЗ рд╕рд╛рде рдПрдХ рдЯреБрдХрдбрд╝рд╛ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдХрд╣рддреЗ рд╣реИрдВред  рдлрд┐рд░ рд╣рдо рдкреНрд░рдХрд╛рд╢ рд╕реНрд░реЛрддреЛрдВ рдХреЗ рд░рдВрдЧ рдХреЗ рд╕рд╛рде рдорд┐рд╢реНрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░рд┐рдгрд╛рдо рдХреЛ рдХрд┐рд╕реА рднреА рд░рдВрдЧ рд╕реЗ рдЧреБрдгрд╛ рдХрд░рддреЗ рд╣реИрдВред <br><br>  рдореИрдВрдиреЗ рдЬреНрдпрд╛рдорд┐рддрд┐ рдХреА рдХрд▓реНрдкрдирд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрд░рдиреЗ рдХреЗ</a> рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдХ рд╕рдВрдХреЗрдд рдХреЗ рд╕рд╛рде рджреВрд░рд╕реНрде рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рдмрд╛рд░реЗ</a> рдореЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд╣рд▓реЗ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдореЗрдВ</a> рд╡рд░реНрдгрд┐рдд рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред  рдлрд┐рд░ рдореИрдВрдиреЗ рдмрд╕ рдЬреЛрдбрд╝ рджрд┐рдпрд╛ рдФрд░ рдЬреНрдпрд╛рдорд┐рддрд┐ред  рдпрд╣рд╛рдВ рд╣рдо рдХреЗрд╡рд▓ рдЬреЛрдбрд╝ рдСрдкрд░реЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рд░реИрдЦрд┐рдХ рдкреНрд░рдХреНрд╖реЗрдк рдпрд╛ рдЗрд╕реА рддрд░рд╣ рдХреЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдЖрдХрд╛рд░ рд╣рд░ рдЬрдЧрд╣ рдХрд╛рд▓рд╛ рд╣реИ рдЬрд╣рд╛рдВ рдЖрдХрд╛рд░ рдирд╣реАрдВ рд╣реИ, рдФрд░ рдЬрд╣рд╛рдВ рднреА рдЖрдХреГрддрд┐ рд╣реИ рд╡рд╣рд╛рдВ рдЫрд╛рдпрд╛ рдХрд╛рд▓реА рд╣реИред <br><br> <code>fixed4 frag(v2f i) : SV_TARGET{ float2 position = i.worldPos.xz;</code> <br> <br><pre> <code class="cpp hljs">float2 lightPos; sincos(_Time.y, lightPos.x <span class="hljs-comment"><span class="hljs-comment">/*sine of time*/</span></span>, lightPos.y <span class="hljs-comment"><span class="hljs-comment">/*cosine of time*/</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> shadows = traceShadows(position, lightPos); float3 light = shadows * float3(<span class="hljs-number"><span class="hljs-number">.6</span></span>, <span class="hljs-number"><span class="hljs-number">.6</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sceneDistance = scene(position); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distanceChange = fwidth(sceneDistance) * <span class="hljs-number"><span class="hljs-number">0.5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> binaryScene = smoothstep(distanceChange, -distanceChange, sceneDistance); float3 geometry = binaryScene * float3(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0.3</span></span>, <span class="hljs-number"><span class="hljs-number">0.1</span></span>); float3 col = geometry + light; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> float4(col, <span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3e5/29f/0cc/3e529f0cc0c90767d42bf4c14916f377.gif"></div><br><h2>  рд╢реАрддрд▓ рдЫрд╛рдпрд╛ </h2><br>  рдЗрди рдХрдареЛрд░ рдЫрд╛рдпрд╛рдУрдВ рд╕реЗ рдирд░рдо рдФрд░ рдЕрдзрд┐рдХ рдпрдерд╛рд░реНрдерд╡рд╛рджреА рддрдХ рдЬрд╛рдирд╛ рдХрд╛рдлреА рдЖрд╕рд╛рди рд╣реИред  рдЗрд╕реА рд╕рдордп, shader рдЕрдзрд┐рдХ рдХрдореНрдкреНрдпреВрдЯреЗрд╢рдирд▓ рд░реВрдк рд╕реЗ рдорд╣рдВрдЧрд╛ рдирд╣реАрдВ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рдмрд╕ рдкреНрд░рддреНрдпреЗрдХ рдирдореВрдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдХрдЯрддрдо рджреГрд╢реНрдп рд╡рд╕реНрддреБ рд╕реЗ рджреВрд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рд╣рдо рдмрд╛рдИрдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдирд┐рдХрдЯрддрдо рдХрд╛ рдЪрдпрди рдХрд░рддреЗ рд╣реИрдВред  рдлрд┐рд░ рдЬрд╣рд╛рдВ рд╣рдо 1 рд▓реМрдЯрд╛рддреЗ рдереЗ, рд╡рд╣рд╛рдВ рд╕реЗ рдирд┐рдХрдЯрддрдо рдЖрдХреГрддрд┐ рдХреА рджреВрд░реА рдХреЛ рд╡рд╛рдкрд╕ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛрдЧрд╛ред  рддрд╛рдХрд┐ рдЫрд╛рдпрд╛ рдХреА рдЪрдордХ рдмрд╣реБрдд рдЕрдзрд┐рдХ рди рд╣реЛ рдФрд░ рдЕрдЬреАрдм рд░рдВрдЧреЛрдВ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреА рдУрд░ рди рдмрдврд╝реЗ, рд╣рдо рдЗрд╕реЗ <code>saturate</code> рд╡рд┐рдзрд┐ рд╕реЗ рдкрд╛рд░рд┐рдд рдХрд░реЗрдВрдЧреЗ, рдЬреЛ рдЗрд╕реЗ 0 рд╕реЗ 1 рддрдХ рдХреЗ рдЕрдВрддрд░рд╛рд▓ рддрдХ рд╕реАрдорд┐рдд рдХрд░рддрд╛ рд╣реИред рд╣рдо рд╡рд░реНрддрдорд╛рди рдирд┐рдХрдЯрддрдо рдЖрдХреГрддрд┐ рдХреЗ рдмреАрдЪ рдПрдХ рдиреНрдпреВрдирддрдо рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЕрдЧрд▓реЗ рджрд┐рди рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рдмрд╛рдж рдХрд┐ рдкреНрд░рдХрд╛рд╢ рд╕реНрд░реЛрдд рдХрд╛ рдХрд┐рд░рдг рд╡рд┐рддрд░рдг рдкрд╣рд▓реЗ рд╣реА рдкрд╣реБрдВрдЪ рдЪреБрдХрд╛ рд╣реИред рдЕрдиреНрдпрдерд╛, рд╣рдо рдирдореВрдиреЗ рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдкреНрд░рдХрд╛рд╢ рд╕реНрд░реЛрдд рд╕реЗ рдкрд░реЗ рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдЕрдЬреАрдм рдХрд▓рд╛рдХреГрддрд┐рдпреЛрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">traceShadows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(float2 position, float2 lightPosition)</span></span></span></span>{ float2 direction = normalize(lightPosition - position); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> lightDistance = length(lightPosition - position); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rayProgress = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> nearest = <span class="hljs-number"><span class="hljs-number">9999</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span> ;i&lt;SAMPLES; i++){ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sceneDist = scene(position + direction * rayProgress); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sceneDist &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rayProgress &gt; lightDistance){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> saturate(nearest); } nearest = min(nearest, sceneDist); rayProgress = rayProgress + sceneDist; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6af/953/680/6af9536801d8eba4596b10e55aba7c3b.png"></div><br>  рдЗрд╕рдХреЗ рдмрд╛рдж рдкрд╣рд▓реА рдЪреАрдЬ рдЬреЛ рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ, рд╡рд╣ рдЫрд╛рдпрд╛ рдореЗрдВ рдЕрдЬреАрдм "рджрд╛рдВрдд" рд╣реИред  рд╡реЗ рдЙрдарддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рджреГрд╢реНрдп рд╕реНрд░реЛрдд рд╕реЗ рдкреНрд░рдХрд╛рд╢ рд╕реНрд░реЛрдд рдХреА рджреВрд░реА 1 рд╕реЗ рдХрдо рд╣реИред рдореИрдВрдиреЗ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рд╕реЗ рдЗрд╕рдХрд╛ рдореБрдХрд╛рдмрд▓рд╛ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреА, рд▓реЗрдХрд┐рди рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВ рдорд┐рд▓рд╛ред  рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдЫрд╛рдпрд╛ рдХреЗ рддреЗрдЬ рдХреЛ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╢реИрдбреЛ рдлрдВрдХреНрд╢рди рдореЗрдВ рд╢рд╛рд░реНрдкрдиреЗрд╕ рдПрдХ рдФрд░ рдкреИрд░рд╛рдореАрдЯрд░ рд╣реЛрдЧрд╛ред  рд▓реВрдк рдореЗрдВ, рд╣рдо рддреАрд╡реНрд░рддрд╛ рд╕реЗ рджреГрд╢реНрдп рдореЗрдВ рджреВрд░реА рдХреЛ рдЧреБрдгрд╛ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ 2 рдХреЗ рддреЗрдЬ рдХреЗ рд╕рд╛рде, рдЫрд╛рдпрд╛ рдХрд╛ рдирд░рдо, рдЧреНрд░реЗ рд╣рд┐рд╕реНрд╕рд╛ рдЖрдзрд╛ рд╣реЛ рдЬрд╛рдПрдЧрд╛ред  рддреАрдЦреЗрдкрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп, рдкреНрд░рдХрд╛рд╢ рд╕реНрд░реЛрдд рддреЗрдЬ рд╕реЗ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрдо рд╕реЗ рдХрдо 1 рдХреА рджреВрд░реА рдкрд░ рдЖрдВрдХрдбрд╝реЗ рд╕реЗ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЕрдиреНрдпрдерд╛ рдХрд▓рд╛рдХреГрддрд┐рдпрд╛рдВ рджрд┐рдЦрд╛рдИ рджреЗрдВрдЧреАред  рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдк 20 рдХреА рддреАрд╡реНрд░рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рджреВрд░реА рдХрдо рд╕реЗ рдХрдо 0.05 рдЗрдХрд╛рдИ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">traceShadows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(float2 position, float2 lightPosition, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hardness)</span></span></span></span>{ float2 direction = normalize(lightPosition - position); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> lightDistance = length(lightPosition - position); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rayProgress = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> nearest = <span class="hljs-number"><span class="hljs-number">9999</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span> ;i&lt;SAMPLES; i++){ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sceneDist = scene(position + direction * rayProgress); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sceneDist &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rayProgress &gt; lightDistance){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> saturate(nearest); } nearest = min(nearest, hardness * sceneDist); rayProgress = rayProgress + sceneDist; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//in fragment function float shadows = traceShadows(position, lightPos, 20);</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/610/70b/5a4/61070b5a42c96ac0d121b8aa7f2130ae.png"></div><br>  рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рдХрдо рдХрд░рдХреЗ, рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрд░ рдзреНрдпрд╛рди рджреЗрддреЗ рд╣реИрдВ: рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдЙрди рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рднреА рдЬрд┐рдиреНрд╣реЗрдВ рдЫрд╛рдпрд╛рдВрдХрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдХрдордЬреЛрд░ рд╣реЛрдирд╛ рдЕрднреА рднреА рджреАрд╡рд╛рд░реЛрдВ рдХреЗ рдкрд╛рд╕ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЫрд╛рдпрд╛ рдХреА рдХреЛрдорд▓рддрд╛ рдкреВрд░реЗ рдЫрд╛рдпрд╛ рдХреЗ рд▓рд┐рдП рд╕рдорд╛рди рдкреНрд░рддреАрдд рд╣реЛрддреА рд╣реИ, рдФрд░ рдЖрдХреГрддрд┐ рд╕реЗ рджреВрд░ рдЬрд╛рдиреЗ рдкрд░ рдЖрдХреГрддрд┐ рдФрд░ рдирд░рдо рдХреЗ рдмрдЧрд▓ рдореЗрдВ рддреЗрдЬ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ, рдЬреЛ рдЫрд╛рдпрд╛ рд╕реЗ рдирд┐рдХрд▓рдиреЗ рд╡рд╛рд▓реА рд╡рд╕реНрддреБ рд╕реЗ рджреВрд░ рдЬрд╛рддреА рд╣реИред <br><br>  рд╣рдо рдмреАрдо рдкреНрд░рд╕рд╛рд░ рджреНрд╡рд╛рд░рд╛ рджреГрд╢реНрдп рдореЗрдВ рджреВрд░реА рдХреЛ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдХреЗ рдЗрд╕реЗ рдареАрдХ рдХрд░реЗрдВрдЧреЗред  рдЗрд╕рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж, рд╣рдо рдмреАрдо рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рджреВрд░реА рдХреЛ рдмрд╣реБрдд рдХрдо рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░реЗрдВрдЧреЗ, рдЕрд░реНрдерд╛рдд, рд╣рдо рдЕрднреА рднреА рдЙрдЪреНрдЪ рдореВрд▓реНрдпреЛрдВ рдФрд░ рдПрдХ рд╕реБрдВрджрд░ рд╕реНрдкрд╖реНрдЯ рдЫрд╛рдпрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВрдЧреЗред  рдЬрдм рд╣рдо рдХрд┐рд░рдг рдореЗрдВ рдмрд╛рдж рдХреЗ рдмрд┐рдВрджреБрдУрдВ рдкрд░ рдХрд┐рд░рдг рдХреЗ рдирд┐рдХрдЯрддрдо рдмрд┐рдВрджреБ рдХреЛ рдкрд╛рддреЗ рд╣реИрдВ, рддреЛ рдирд┐рдХрдЯрддрдо рдмрд┐рдВрджреБ рдХреЛ рдПрдХ рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рд╕реЗ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдЫрд╛рдпрд╛ рдХреЛ рдирд░рдо рдмрдирд╛рддрд╛ рд╣реИред  рдЪреВрдВрдХрд┐ рдпрд╣ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рдмрд╕реЗ рдЫреЛрдЯреА рджреВрд░реА рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЪрд░ рдХреЛ <code>shadow</code> рдмрджрд▓ рджреЗрдВрдЧреЗред <br><br>  рд╣рдо рдПрдХ рдФрд░ рдорд╛рдореВрд▓реА рдмрджрд▓рд╛рд╡ рднреА рдХрд░реЗрдВрдЧреЗ: рдЪреВрдВрдХрд┐ рд╣рдо рд░реЗрдкреНрд░реЛрдЧреНрд░реЗрдб рджреНрд╡рд╛рд░рд╛ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдЖрдкрдХреЛ 0 рд╕реЗ рд╢реБрд░реВ рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП (рд╢реВрдиреНрдп рд╕реЗ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдирд╛ рд▓рдЧрднрдЧ рд╣рдореЗрд╢рд╛ рд╡рд┐рднрд╛рдЬрди рдХрд╛ рдПрдХ рдмреБрд░рд╛ рд╡рд┐рдЪрд╛рд░ рд╣реИ)ред  рдПрдХ рд╢реБрд░реБрдЖрдд рдХреЗ рд░реВрдк рдореЗрдВ, рдЖрдк рдХрд┐рд╕реА рднреА рдмрд╣реБрдд рдЫреЛрдЯреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдЪреБрди рд╕рдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">traceShadows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(float2 position, float2 lightPosition, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hardness)</span></span></span></span>{ float2 direction = normalize(lightPosition - position); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> lightDistance = length(lightPosition - position); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rayProgress = <span class="hljs-number"><span class="hljs-number">0.0001</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> shadow = <span class="hljs-number"><span class="hljs-number">9999</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span> ;i&lt;SAMPLES; i++){ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sceneDist = scene(position + direction * rayProgress); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sceneDist &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rayProgress &gt; lightDistance){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> saturate(shadow); } shadow = min(shadow, hardness * sceneDist / rayProgress); rayProgress = rayProgress + sceneDist; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e46/715/305/e46715305ef51c3016c4d56b34f47a8d.png"></div><br><h2>  рдПрдХрд╛рдзрд┐рдХ рдкреНрд░рдХрд╛рд╢ рд╕реНрд░реЛрдд </h2><br>  рдЗрд╕ рд╕рд░рд▓ рдПрдХрд▓-рдХреЛрд░ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ, рдХрдИ рдкреНрд░рдХрд╛рд╢ рд╕реНрд░реЛрддреЛрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рд╣реИ, рдЙрдиреНрд╣реЗрдВ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ рдЧрдгрдирд╛ рдХрд░рдирд╛ рдФрд░ рдкрд░рд┐рдгрд╛рдо рдЬреЛрдбрд╝рдирд╛ред <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">fixed4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">frag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(v2f i)</span></span></span><span class="hljs-function"> : SV_TARGET</span></span>{ float2 position = i.worldPos.xz; float2 lightPos1 = float2(<span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(_Time.y), <span class="hljs-number"><span class="hljs-number">-1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> shadows1 = traceShadows(position, lightPos1, <span class="hljs-number"><span class="hljs-number">20</span></span>); float3 light1 = shadows1 * float3(<span class="hljs-number"><span class="hljs-number">.6</span></span>, <span class="hljs-number"><span class="hljs-number">.6</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); float2 lightPos2 = float2(-<span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(_Time.y) * <span class="hljs-number"><span class="hljs-number">1.75</span></span>, <span class="hljs-number"><span class="hljs-number">1.75</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> shadows2 = traceShadows(position, lightPos2, <span class="hljs-number"><span class="hljs-number">10</span></span>); float3 light2 = shadows2 * float3(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">.6</span></span>, <span class="hljs-number"><span class="hljs-number">.6</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sceneDistance = scene(position); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distanceChange = fwidth(sceneDistance) * <span class="hljs-number"><span class="hljs-number">0.5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> binaryScene = smoothstep(distanceChange, -distanceChange, sceneDistance); float3 geometry = binaryScene * float3(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0.3</span></span>, <span class="hljs-number"><span class="hljs-number">0.1</span></span>); float3 col = geometry + light1 + light2; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> float4(col, <span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a3b/b70/6ce/a3bb706cec13c16a54d8d740b0d91589.gif"></div><br><h2>  рд╕реНрд░реЛрдд рдХреЛрдб </h2><br><h3>  рджреЛ-рдЖрдпрд╛рдореА рдПрд╕рдбреАрдПрдл рдкреБрд╕реНрддрдХрд╛рд▓рдп (рдирд╣реАрдВ рдмрджрд▓рд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣рд╛рдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ) </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/037_SDF_2D_Shadows/2D_SDF.cginc</a> </li></ul><br><h3>  рджреНрд╡рд┐-рдЖрдпрд╛рдореА рдирд░рдо рдЫрд╛рдпрд╛ </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/037_SDF_2D_Shadows/2D_SDF_Shadows.shader</a> </li></ul><br><pre> <code class="cpp hljs">Shader <span class="hljs-string"><span class="hljs-string">"Tutorial/037_2D_SDF_Shadows"</span></span>{ Properties{ } SubShader{ <span class="hljs-comment"><span class="hljs-comment">//the material is completely non-transparent and is rendered at the same time as the other opaque geometry Tags{ "RenderType"="Opaque" "Queue"="Geometry"} Pass{ CGPROGRAM #include "UnityCG.cginc" #include "2D_SDF.cginc" #pragma vertex vert #pragma fragment frag struct appdata{ float4 vertex : POSITION; }; struct v2f{ float4 position : SV_POSITION; float4 worldPos : TEXCOORD0; }; v2f vert(appdata v){ v2f o; //calculate the position in clip space to render the object o.position = UnityObjectToClipPos(v.vertex); //calculate world position of vertex o.worldPos = mul(unity_ObjectToWorld, v.vertex); return o; } float scene(float2 position) { float bounds = -rectangle(position, 2); float2 quarterPos = abs(position); float corner = rectangle(translate(quarterPos, 1), 0.5); corner = subtract(corner, rectangle(position, 1.2)); float diamond = rectangle(rotate(position, 0.125), .5); float world = merge(bounds, corner); world = merge(world, diamond); return world; } #define STARTDISTANCE 0.00001 #define MINSTEPDIST 0.02 #define SAMPLES 32 float traceShadows(float2 position, float2 lightPosition, float hardness){ float2 direction = normalize(lightPosition - position); float lightDistance = length(lightPosition - position); float lightSceneDistance = scene(lightPosition) * 0.8; float rayProgress = 0.0001; float shadow = 9999; for(int i=0 ;i&lt;SAMPLES; i++){ float sceneDist = scene(position + direction * rayProgress); if(sceneDist &lt;= 0){ return 0; } if(rayProgress &gt; lightDistance){ return saturate(shadow); } shadow = min(shadow, hardness * sceneDist / rayProgress); rayProgress = rayProgress + max(sceneDist, 0.02); } return 0; } fixed4 frag(v2f i) : SV_TARGET{ float2 position = i.worldPos.xz; float2 lightPos1 = float2(sin(_Time.y), -1); float shadows1 = traceShadows(position, lightPos1, 20); float3 light1 = shadows1 * float3(.6, .6, 1); float2 lightPos2 = float2(-sin(_Time.y) * 1.75, 1.75); float shadows2 = traceShadows(position, lightPos2, 10); float3 light2 = shadows2 * float3(1, .6, .6); float sceneDistance = scene(position); float distanceChange = fwidth(sceneDistance) * 0.5; float binaryScene = smoothstep(distanceChange, -distanceChange, sceneDistance); float3 geometry = binaryScene * float3(0, 0.3, 0.1); float3 col = geometry + light1 + light2; return float4(col, 1); } ENDCG } } FallBack "Standard" }</span></span></code> </pre> <br>  рдпрд╣ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рджреВрд░реА рдХреЗ рдЦреЗрддреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдХрдИ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред  рдЕрдм рддрдХ рд╡реЗ рдмрд▓реНрдХрд┐ рдмреЛрдЭрд┐рд▓ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рд╕рднреА рдЖрдХреГрддрд┐рдпреЛрдВ рдХреЛ shader рдореЗрдВ рдкрдВрдЬреАрдХреГрдд рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдпрд╛ shader рдХреЗ рдЧреБрдгреЛрдВ рд╕реЗ рдЧреБрдЬрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рд▓реЗрдХрд┐рди рдореЗрд░реЗ рдкрд╛рд╕ рдХреБрдЫ рд╡рд┐рдЪрд╛рд░ рд╣реИрдВ рдХрд┐ рднрд╡рд┐рд╖реНрдп рдХреЗ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдХреЗ рд▓рд┐рдП рдЙрдиреНрд╣реЗрдВ рдФрд░ рдЕрдзрд┐рдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдХреИрд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛рдПред </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi438942/">https://habr.com/ru/post/hi438942/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi438930/index.html">рдкреНрд░рд╛рдзрд┐рдХрд╛рд░реА рдореМрд▓рд┐рдХ рд░реВрдк рд╕реЗ рдЗрдВрдЯрд░рдиреЗрдЯ рдирд┐рдпрдВрддреНрд░рдг рд░рдгрдиреАрддрд┐ рдмрджрд▓рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi438932/index.html">Aidetic рдХреГрддреНрд░рд┐рдо рдмреБрджреНрдзрд┐рдорддреНрддрд╛ рдореЗрдВ рдкреИрдЯрд░реНрди рдорд╛рдиреНрдпрддрд╛</a></li>
<li><a href="../hi438934/index.html">рд╡рд┐рдВрдбреЛрдЬ рдкрд░ Jupyter рдиреЛрдЯрдмреБрдХ рдФрд░ рд▓реИрдм рдХреЗ рдкреЛрд░реНрдЯреЗрдмрд▓ рдирд┐рд░реНрдорд╛рдг рдХреЛ рдмрдирд╛рдПрдВ рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВред рднрд╛рдЧ 1</a></li>
<li><a href="../hi438936/index.html">рдмреЙрдЯрдореИрди рдПрдХреНрд╡рд╛рдпрдВрдЯреЗрдВрд╕</a></li>
<li><a href="../hi438940/index.html">рдУрдкрди рдХреЛрд░реНрд╕ "рдЙрдВрдЧрд▓рд┐рдпреЛрдВ рдкрд░ рдЧрд╣рд░рд╛ рд╕реАрдЦрдирд╛"</a></li>
<li><a href="../hi438946/index.html">DateTimeOffset (рд╕рдЦреНрдд)</a></li>
<li><a href="../hi438948/index.html">рд╣рдореЗрдВ рдПрд▓реНрдмреНрд░рд╕ рдкрд░ рдирд┐рдореНрди-рд╕реНрддрд░ рдХреЗ рдЕрдиреБрдХреВрд▓рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреНрдпреЛрдВ рд╣реИ рдпрд╛ рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рдгрд╛рд▓реА рдХреЛ рдбреЗрдврд╝ рдЧреБрдирд╛ рдХрд░рдиреЗ рдХреА рдЧрддрд┐ рдХреИрд╕реЗ рд╣реИ</a></li>
<li><a href="../hi438950/index.html">рд╕реЗрдВрдЯреНрд░рд▓ рдмреИрдВрдХ рдиреЗ рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдХрдорд╛рдИ рдХреА рдпреЛрдЬрдирд╛рдУрдВ рдХреА рдЦреЛрдЬ рдХреЗ рд▓рд┐рдП рдПрдХ рд░реЛрдмреЛрдЯ рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛</a></li>
<li><a href="../hi438952/index.html">рд╡рд┐рднрд┐рдиреНрди рдмреНрд░рд╛рдЙрдЬрд╝рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдСрдбрд┐рдпреЛ рдкреНрд▓реЗрдпрд░ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддреЗ рд╕рдордп рдЖрдк рдХреНрдпрд╛ рд╕реАрдЦ рд╕рдХрддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi438954/index.html">2 рдбреА рдореЗрдВ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рджреВрд░реА рдХреЗ рдХреНрд╖реЗрддреНрд░</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>