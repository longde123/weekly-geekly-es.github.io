<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè¶ üë©‚Äç‚ù§Ô∏è‚Äçüë© üéöÔ∏è Escribimos nuestro lenguaje de programaci√≥n, parte 2: representaci√≥n intermedia de programas üìó üÜô ü§õüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduccion 
 Saludos a todos los que vinieron a leer mi pr√≥ximo art√≠culo. 

 Repito, describo la creaci√≥n de un lenguaje de lenguaje de programaci√≥n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Escribimos nuestro lenguaje de programaci√≥n, parte 2: representaci√≥n intermedia de programas</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435258/"><img src="https://habrastorage.org/getpro/habr/post_images/a7b/73c/8de/a7b73c8de7e52b3cd9fa2869bae47119.png" alt="imagen"><br><br><h3>  Introduccion </h3><br>  Saludos a todos los que vinieron a leer mi pr√≥ximo art√≠culo. <br><br>  Repito, describo la creaci√≥n de un lenguaje de lenguaje de programaci√≥n basado en trabajos previos, cuyos resultados se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">describen en esta publicaci√≥n</a> . <br><br>  En la primera parte (enlace: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">habr.com/post/435202</a> ) describ√≠ las etapas de dise√±o y escritura de un lenguaje VM que ejecutar√° nuestras aplicaciones futuras en nuestro idioma futuro. <br>  En este art√≠culo, planeo describir las etapas principales de la creaci√≥n de un lenguaje de programaci√≥n intermedio que se ensamblar√° en un bytecode abstracto para ejecuci√≥n directa en nuestra VM. <br><br>  Creo que no est√° de m√°s proporcionar enlaces de inmediato al sitio web del proyecto y su repositorio. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sitio</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Repositorio</a> <br><a name="habracut"></a><br>  Debo decir de inmediato que todo el c√≥digo est√° escrito en FPC y dar√© ejemplos al respecto. <br><br>  Entonces, comenzamos nuestra iluminaci√≥n. <br><br><h3>  ¬øPor qu√© rendimos el lenguaje intermedio? </h3><br>  Vale la pena entender que convertir un programa de un lenguaje de alto nivel inmediatamente a un bytecode ejecutable, que consiste en un conjunto limitado de instrucciones, es tan trivial que es mejor simplificarlo en un orden de magnitud agregando un lenguaje intermedio al proyecto.  Es mucho mejor simplificar el c√≥digo gradualmente que presentar inmediatamente expresiones, estructuras y clases matem√°ticas con un conjunto de c√≥digos de operaci√≥n.  Por cierto, esta es la forma en que funcionan la mayor√≠a de los traductores y compiladores de terceros. <br><br>  En mi art√≠culo anterior, escrib√≠ sobre c√≥mo implementar un lenguaje VM.  Ahora necesitamos implementar un lenguaje similar al ensamblador para √©l y funcionalidad para seguir escribiendo el traductor.  En estas etapas, sentamos las bases para el futuro proyecto.  Vale la pena entender que cuanto mejor sea la base, m√°s empinada ser√° la construcci√≥n. <br><br><h3>  Damos el primer paso para realizar este milagro. </h3><br>  Para empezar, vale la pena establecer una meta.  ¬øQu√© escribiremos realmente?  ¬øQu√© caracter√≠sticas debe tener el c√≥digo final y qu√© debe hacer? <br><br>  Puedo crear una lista de las principales partes funcionales en las que debe consistir esta parte del proyecto: <br><br><ul><li>  Ensamblador simple.  Convierte instrucciones simples en un conjunto de c√≥digos de operaci√≥n para m√°quinas virtuales. </li><li>  La implementaci√≥n b√°sica del funcional para implementar variables. </li><li>  La implementaci√≥n b√°sica de lo funcional para trabajar con constantes. </li><li>  Funcionalidad para admitir puntos de entrada a m√©todos y calcular sus direcciones en la etapa de traducci√≥n. </li><li>  Quiz√°s un par de bollos m√°s funcionales. </li></ul><br>  La ilustraci√≥n anterior muestra un fragmento de c√≥digo en un lenguaje intermedio que se convierte en c√≥digo para una VM por un traductor primitivo, que se discutir√°. <br><br>  Entonces, los objetivos est√°n establecidos, procedamos a la implementaci√≥n. <br><br><h3>  Escribir un ensamblador simple </h3><br>  Nos preguntamos qu√© es ensamblador? <br><br>  De hecho, este es un programa que realiza la sustituci√≥n de c√≥digos de operaci√≥n en lugar de sus descripciones textuales. <br><br>  Considera este c√≥digo: <br><br><pre><code class="bash hljs">push 0 push 1 add peek 2 pop</code> </pre> <br>  Despu√©s de procesar el c√≥digo del ensamblador, obtenemos el c√≥digo ejecutable para la VM. <br><br>  Vemos que las instrucciones pueden ser monosil√°bicas y bisil√°bicas.  No m√°s instrucciones complicadas para la VM apilada. <br><br>  Necesitamos un c√≥digo que pueda extraer tokens de una cadena (tenemos en cuenta que puede haber cadenas entre ellos). <br><br>  Lo escribimos: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">; w: word)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (length(s) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (w &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-string"><span class="hljs-string">'"'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Delete(s, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); Result := copy(s, <span class="hljs-number"><span class="hljs-number">1</span></span>, pos(<span class="hljs-string"><span class="hljs-string">'"'</span></span>, s) - <span class="hljs-number"><span class="hljs-number">1</span></span>); Delete(s, <span class="hljs-number"><span class="hljs-number">1</span></span>, pos(<span class="hljs-string"><span class="hljs-string">'"'</span></span>, s)); s := trim(s); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Pos(<span class="hljs-string"><span class="hljs-string">' '</span></span>, s) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := copy(s, <span class="hljs-number"><span class="hljs-number">1</span></span>, pos(<span class="hljs-string"><span class="hljs-string">' '</span></span>, s) - <span class="hljs-number"><span class="hljs-number">1</span></span>); Delete(s, <span class="hljs-number"><span class="hljs-number">1</span></span>, pos(<span class="hljs-string"><span class="hljs-string">' '</span></span>, s)); s := trim(s); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := s; s := <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; Dec(w); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Ok, ahora necesitamos implementar algo as√≠ como una construcci√≥n de may√∫sculas y min√∫sculas para cada declaraci√≥n, y nuestro ensamblador simple est√° listo. <br><br><h3>  Variables </h3><br>  Recuerde que nuestra VM tiene una variedad de punteros para admitir variables y, en consecuencia, direccionamiento est√°tico.  Esto significa que lo funcional para trabajar con variables se puede representar como una TStringList, en la que las cadenas son los nombres de las variables y sus √≠ndices son sus direcciones est√°ticas.  Debe entenderse que la duplicaci√≥n de nombres de variables en esta lista es inaceptable.  Creo que puedes imaginar el c√≥digo necesario y / o incluso escribirlo t√∫ mismo. <br><br>  Si desea ver la implementaci√≥n finalizada, entonces es bienvenido: /lang/u_variables.pas <br><br><h3>  Constantes </h3><br>  El principio aqu√≠ es el mismo que con las variables, pero hay una cosa.  Para optimizar, es mejor vincular no a los nombres de las constantes, sino a sus valores.  Es decir  cada valor constante puede tener una TStringList, que servir√° para almacenar los nombres de las constantes con este valor. <br>  Para las constantes, debe especificar el tipo de datos y, en consecuencia, para agregarlos al idioma, deber√° escribir un peque√±o analizador. <br><br>  Implementaci√≥n: /lang/u_consts.pas <br><br><h3>  M√©todo Puntos de entrada </h3><br>  Para implementar el bloqueo de c√≥digo, soporte para diferentes dise√±os, etc.  El soporte para esta funcionalidad debe implementarse a nivel de ensamblador. <br><br>  Considere un ejemplo de c√≥digo: <br><br><pre> <code class="bash hljs">Summ: peek 0 pop peek 1 pop push 0 new peek 2 mov push 2 push 0 add jr</code> </pre> <br>  Lo anterior es un ejemplo de traducci√≥n del m√©todo Summ: <br><br><pre> <code class="ruby hljs">func Summ(a, b): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  Debe entenderse que no hay c√≥digos de operaci√≥n para los puntos de entrada.  ¬øQu√© es un punto de entrada al m√©todo Summ?  Este n√∫mero primo es el desplazamiento del siguiente punto de entrada del c√≥digo de operaci√≥n.  (el desplazamiento del c√≥digo de operaci√≥n es el n√∫mero del c√≥digo de operaci√≥n relativo al comienzo del c√≥digo de bytes abstracto ejecutable).  Ahora tenemos una tarea: necesitamos calcular este desplazamiento en la etapa de compilaci√≥n y, como opci√≥n, declarar la constante Summ como este n√∫mero. <br><br>  Escribimos para esto un cierto contador de peso para cada operador.  Tenemos operadores monosil√°bicos simples, por ejemplo, "pop".  Ocupan 1 byte.  Hay otros m√°s complejos, por ejemplo, "push 123": ocupan 5 bytes, 1 para el c√≥digo de operaci√≥n y 4 para el tipo int sin signo. <br><br>  La esencia del c√≥digo para agregar soporte para el ensamblador de puntos de entrada: <br><br><ol><li>  Tenemos un contador, digamos i = 0. </li><li>  Revisamos el c√≥digo, si tenemos una construcci√≥n del tipo "push 123", luego le agregamos 5, si el c√≥digo de operaci√≥n simple es 1. Si tenemos un punto de entrada, elim√≠nelo del c√≥digo y declare la constante correspondiente con el valor del contador y el nombre del punto de entrada. </li></ol><br><h3>  Otra funcionalidad </h3><br>  Esto, por ejemplo, es una conversi√≥n de c√≥digo simple antes del procesamiento. <br><br><h3>  Resumen </h3><br>  Hemos implementado nuestro peque√±o ensamblador.  Lo necesitaremos para implementar un traductor m√°s complejo basado en √©l.  Ahora podemos escribir peque√±os programas para nuestra VM.  En consecuencia, en otros art√≠culos se describir√° el proceso de escribir un traductor m√°s complejo. <br><br>  Gracias por leer hasta el final si lo hiciste. <br><br>  Si algo no est√° claro para usted, entonces estoy esperando sus comentarios. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es435258/">https://habr.com/ru/post/es435258/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es435248/index.html">Navegaci√≥n dentro de la aplicaci√≥n de Android</a></li>
<li><a href="../es435250/index.html">C√≥mo funciona la Universidad ITMO: un recorrido por nuestro laboratorio ciberf√≠sico</a></li>
<li><a href="../es435252/index.html">Jessica Livingston: ‚ÄúC√≥mo creamos Y Combinator. El componente emocional "</a></li>
<li><a href="../es435254/index.html">Manejo de errores funcionales en Kotlin usando Arrow</a></li>
<li><a href="../es435256/index.html">Calificamos a los reclutadores por letras fr√≠as</a></li>
<li><a href="../es435260/index.html">Implementaci√≥n de una recarga en caliente de c√≥digo C ++ en Linux</a></li>
<li><a href="../es435262/index.html">Li-Fi: el futuro de Internet</a></li>
<li><a href="../es435264/index.html">Edici√≥n de precios en RMK. 1C: Gesti√≥n comercial 11</a></li>
<li><a href="../es435268/index.html">No me trates doctor</a></li>
<li><a href="../es435270/index.html">Mantenga seguras las llaves SSH</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>