<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë® üí± üéÖüèø Cr√©ation d'un plugin pour Clang Static Analyzer pour rechercher les d√©bordements d'entiers üçÉ üåã üîß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Auteur de l'article: 0x64rem 
 Entr√©e 


 Il y a un an et demi, j'ai eu l'id√©e de r√©aliser mon phaser dans le cadre de la th√®se √† l'universit√©. J'ai c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cr√©ation d'un plugin pour Clang Static Analyzer pour rechercher les d√©bordements d'entiers</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/473412/"><p><img src="https://habrastorage.org/getpro/habr/post_images/e69/d01/efb/e69d01efbeff395f19dbb543055a5493.jpg" title="fig. 1"></p><br><p>  <em>Auteur de l'article: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">0x64rem</a></em> </p><br><h2 id="vstuplenie">  Entr√©e </h2><br><p>  Il y a un an et demi, j'ai eu l'id√©e de r√©aliser mon phaser dans le cadre de la th√®se √† l'universit√©.  J'ai commenc√© √† √©tudier des mat√©riaux sur les graphiques de flux de contr√¥le, les graphiques de flux de donn√©es, l'ex√©cution symbolique, etc.  Ensuite, une recherche d'outils, un √©chantillon de diff√©rentes biblioth√®ques (Angr, Triton, Pin, Z3).  Rien de concret ne s'est finalement produit, jusqu'√† cet √©t√©, je suis all√© au programme Summer of Hack 2019 de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Digital Security</a> , o√π l'on m'a propos√© l'extension de Clang Static Analyzer comme th√®me du projet.  Il m'a sembl√© que ce sujet m'aiderait √† mettre mes connaissances th√©oriques sur les tablettes, √† commencer √† mettre en ≈ìuvre quelque chose de substantiel et √† obtenir des recommandations de mentors exp√©riment√©s.  Ensuite, je vais vous expliquer comment s'est d√©roul√© le processus d'√©criture du plug-in et d√©crire le cours de mes r√©flexions pendant le mois de stage. </p><a name="habracut"></a><br><h2 id="clang-static-analyzer">  Analyseur statique Clang </h2><br><p>  Pour le d√©veloppement, Clang propose trois options d'interface pour l'interaction: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LibClang</a> est une interface C de haut niveau qui vous permet d'interagir avec AST, mais pas compl√®tement.  Une bonne option si vous avez besoin d'une interaction avec une autre langue (par exemple, l'impl√©mentation de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">liaisons</a> ) ou une interface stable. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Clang Plugins</a> - biblioth√®ques dynamiques appel√©es au moment de la compilation.  Vous permet de manipuler compl√®tement l'AST. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LibTooling</a> - une biblioth√®que pour cr√©er des outils s√©par√©s bas√©s sur Clang.  Donne √©galement un acc√®s complet √† l'interaction avec AST.  Le code r√©sultant peut √™tre ex√©cut√© en dehors de l'environnement de g√©n√©ration du projet v√©rifi√©. </li></ul><br><p>  Puisque nous allons √©tendre les capacit√©s de Clang Static Analyzer, nous choisissons l'impl√©mentation du plugin.  Vous pouvez √©crire du code pour le plugin en C ++ ou Python. </p><br><p>  Pour ce dernier, il existe des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">classeurs</a> qui vous permettent d'analyser le code source, d'it√©rer sur les n≈ìuds de l'arborescence de syntaxe abstraite r√©sultante, d'avoir √©galement acc√®s aux propri√©t√©s des n≈ìuds et de mapper le n≈ìud √† la ligne du code source.  Un tel ensemble convient √† un simple contr√¥leur.  Voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le r√©f√©rentiel llvm pour</a> plus de d√©tails. </p><br><p>  Ma t√¢che n√©cessite une analyse d√©taill√©e du code, donc C ++ a √©t√© choisi pour le d√©veloppement.  Voici une introduction √† l'outil. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Clang Staic Analyzer</a> (ci-apr√®s CSA) est un outil d'analyse statique du code C / C ++ / Objective-C, bas√© sur l'ex√©cution symbolique.  L'analyseur peut √™tre appel√© via l'interface frontale Clang en ajoutant les indicateurs -cc1 et -analyze √† la commande de g√©n√©ration, ou via un binaire de g√©n√©ration de num√©risation distinct.  En plus de l'analyse elle-m√™me, CSA permet de g√©n√©rer des rapports html visuels. </p><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ,      clang' clang -cc1 --help #  CSA  ‚Ññ1 clang++ -cc1 -x c++ -load path/to/Checker.so -analyze -analyzer-checker=test.Me -analyzer-config $BUILD_OPTIONS Checker.cpp</span></span></code> </pre> <br><pre> <code class="bash hljs"> <span class="hljs-comment"><span class="hljs-comment">#  CSA  ‚Ññ2 scan-build -load-plugin path/to/Checker.so -enable-checker test.Me $BUILD_COMMAND</span></span></code> </pre> <br><pre> <code class="bash hljs"> <span class="hljs-comment"><span class="hljs-comment">#       DivideZero clang++ -cc1 -analyze -analyzer-checker=core.DivideZero -o reports div-by-zero-test.cpp</span></span></code> </pre> <br><p><img src="https://habrastorage.org/getpro/habr/post_images/6dd/b8e/302/6ddb8e302c62b6cc58c4533a894d49e9.jpg" alt=" " title="fig. 2"></p><br><p>  CSA a une excellente biblioth√®que pour analyser le code source en utilisant AST (Abstract Syntax Tree), CFG (Control Flow Graph).  A partir des structures, vous pouvez voir plus loin les d√©clarations de variables, leurs types, l'utilisation d'op√©rateurs binaires et unaires, vous pouvez obtenir des expressions symboliques, etc.  Mon plugin utilisera les fonctionnalit√©s des classes AST, ce choix sera justifi√© davantage.  Ce qui suit est une liste de classes qui a √©t√© utilis√©e dans la mise en ≈ìuvre du plugin, la liste aidera √† obtenir une compr√©hension primaire des capacit√©s de CSA: </p><br><ul><li><p>  Stmt - cela inclut les op√©rations binaires. </p><br></li><li><p>  Decl - d√©claration de variables. </p><br></li><li><p>  Expr - stocke les parties gauche et droite des expressions, leur type. </p><br></li><li><p>  ASTContext - informations sur l'arbre, le n≈ìud actuel. </p><br></li><li><p>  Gestionnaire de sources - informations sur le code r√©el qui correspond √† la partie de l'arborescence. </p><br></li><li><p>  RecursiveASTVisitor, ASTMatcher - classes pour parcourir un arbre. </p><br><p>  Je r√©p√®te que CSA offre au d√©veloppeur la possibilit√© d'examiner en d√©tail la structure du code, et les classes r√©pertori√©es ci-dessus ne sont qu'une petite partie de celles disponibles.  Je vous recommande vivement de parcourir la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation de</a> votre version de Clang si vous ne savez pas comment extraire de donn√©es;  tr√®s probablement, quelque chose de convenable a d√©j√† √©t√© √©crit. </p><br></li></ul><br><h2 id="poisk-celochislennyh-perepolneniy">  Recherche de d√©passement d'entier </h2><br><p>  Pour commencer √† impl√©menter le plugin, vous devez choisir la t√¢che √† r√©soudre.  Dans ce cas, le site Web llvm fournit des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">listes de v√©rificateurs potentiels</a> ; vous pouvez √©galement modifier les v√©rificateurs <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">stables</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">alpha</a> existants.  Lors de l'examen du code des v√©rificateurs disponibles, il est devenu clair que pour un d√©veloppement plus r√©ussi de libclang, il est pr√©f√©rable d'√©crire votre v√©rificateur √† partir de z√©ro, donc le choix a √©t√© fait √† partir d'une liste d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">id√©es non r√©alis√©es</a> .  En cons√©quence, l'option a √©t√© choisie pour cr√©er un v√©rificateur pour la d√©tection de d√©passement d'entier.  Clang a d√©j√† des fonctionnalit√©s pour emp√™cher cette vuln√©rabilit√© (les drapeaux -ftrapv, -fwrapv et similaires sont indiqu√©s pour son utilisation), il est int√©gr√© au compilateur, et cet √©chappement est vers√© dans des avertissements, et il n'y est pas souvent recherch√©.  Il y a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">toujours UBSan</a> , mais ce sont des d√©sinfectants, tout le monde ne les utilise pas, et cette m√©thode consiste √† identifier les probl√®mes lors de l'ex√©cution, et le plug-in CSA fonctionne au moment de la compilation, en analysant les sources. </p><br><p>  Vient ensuite la collecte de mat√©riel sur la vuln√©rabilit√© s√©lectionn√©e.  Le d√©bordement d'entier √©tait autrefois simple et pas grave.  En fait, la vuln√©rabilit√© est divertissante et peut avoir des cons√©quences impressionnantes. <br>  Les d√©bordements d'entiers sont un type de vuln√©rabilit√© qui pourrait entra√Æner des donn√©es de type entier dans le code prenant des valeurs inattendues.  D√©bordement - si la variable est devenue plus grande que pr√©vu, D√©bordement - inf√©rieur √† son type d'origine.  De telles erreurs peuvent appara√Ætre √† la fois √† cause du programmeur et √† cause du compilateur. </p><br><p>  En C ++, lors d'une op√©ration de comparaison arithm√©tique, les valeurs enti√®res sont converties dans le m√™me type, le plus souvent en une plus grande en termes de profondeur de bits.  Et de tels fant√¥mes se produisent partout et constamment, ils peuvent √™tre explicites ou implicites.  Il existe plusieurs r√®gles selon lesquelles les fant√¥mes se produisent [1]: </p><br><ul><li>  Conversion d'un sign√© √† un type avec un bit sign√©, mais plus grand: ajoutez simplement l'ordre √©lev√©. </li><li>  Conversion d'un entier sign√© en un entier non sign√© de m√™me capacit√©: le n√©gatif est converti en positif et prend un nouveau sens.  Un exemple d'une erreur similaire dans DirectFB est <a href="">CVE-2014-2977</a> . </li><li>  Conversion d'un entier sign√© en un entier non sign√© d'une plus grande capacit√© en bits: d'abord, la capacit√© en bits augmentera, puis si le nombre est n√©gatif, alors il modifiera incorrectement la valeur.  Par exemple: 0xff (-1) devient 0xffffffff. </li><li>  Un entier non sign√© avec un signe de m√™me capacit√© binaire: un nombre peut changer la valeur, en fonction de la valeur du bit haut. </li><li>  Un entier non sign√© avec un entier avec un signe de plus grande capacit√©: d'abord, la capacit√© d'un nombre non sign√© augmente, puis la conversion en un nombre sign√©. </li><li>  Conversion descendante: les bits sont juste tronqu√©s.  Cela peut rendre les valeurs non sign√©es n√©gatives, etc.  Un exemple d'une telle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vuln√©rabilit√© en PHP</a> . </li></ul><br><p>  C'est-√†-dire  le d√©clencheur de la vuln√©rabilit√© peut √™tre une entr√©e utilisateur non s√ªre, une arithm√©tique incorrecte, une conversion de type incorrecte provoqu√©e par un programmeur ou un compilateur lors de l'optimisation.  L'option bombe √† retardement est √©galement possible, lorsqu'un morceau de code est inoffensif avec une version du compilateur, mais avec la sortie d'un nouvel algorithme d'optimisation ¬´explose¬ª et provoque un comportement inattendu.  Dans l'histoire, il y a d√©j√† eu un tel cas avec la classe SafeInt (tr√®s ironique) [5, 6.5.2]. </p><br><p>  Les d√©bordements entiers ouvrent un large vecteur: il est possible de forcer l'ex√©cution √† prendre un chemin diff√©rent (si le d√©bordement affecte les instructions conditionnelles), provoquer un d√©bordement de tampon.  Pour plus de clart√©, vous pouvez vous familiariser avec des CVE sp√©cifiques, voir leurs causes, leurs cons√©quences.  Naturellement, il est pr√©f√©rable de rechercher un d√©bordement d'entier dans les produits open source, afin de lire non seulement la description, mais √©galement le code. </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CVE-2019-3560</a> - Un d√©bordement d'entier dans Fizz (un projet impl√©mentant TLS pour Facebook) pourrait exploiter une vuln√©rabilit√© DoS √† l'aide d'un paquet r√©seau exigu. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CVE-2018-14618</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">D√©bordement de</a> tampon dans Curl provoqu√© par un d√©bordement d'entier d√ª √† la longueur du mot de passe. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CVE-2018-6092</a> - Sur les syst√®mes 32 bits, une vuln√©rabilit√© dans WebAssembly pour Chrome a permis d'impl√©menter RCE via une page HTML sp√©ciale. </li></ul><br><p>  Afin de ne pas r√©inventer la roue, le code de d√©tection du d√©bordement d'entier dans l'analyseur statique <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CppCheck a</a> √©t√© pris en compte.  Son approche est la suivante: </p><br><ol><li>  D√©terminez si une expression est un op√©rateur binaire. </li><li>  Si oui, v√©rifiez si les deux arguments sont de type entier. </li><li>  D√©terminez la taille des types. </li><li>  V√©rifier au moyen de calculs si la valeur peut d√©passer ses limites maximales ou minimales. <br>  Mais √† ce stade, cela n'a pas donn√© de clart√©.  Il en r√©sulte de nombreuses histoires diff√©rentes, et √† partir de cette syst√©matisation de l'information devient plus difficile.  Tout √† sa place a mis la liste des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CWE</a> .  Au total, il existe 9 types de d√©passement d'entier allou√©s sur le site: <br><ul><li>  190 - d√©bordement d'entier </li><li>  191 - sous-d√©passement d'entier </li><li>  192 - erreur de coh√©sion enti√®re </li><li>  193 - un par un </li><li>  194 - Extension de signe inattendue </li><li>  195 - Erreur de conversion sign√©e √† non sign√©e </li><li>  196 - Erreur de conversion non sign√© en sign√© </li><li>  197 - Erreur de troncature num√©rique </li><li>  198 - Utilisation d'une commande d'octets incorrecte </li></ul></li></ol><br><p>  Nous consid√©rons la raison de chaque option et comprenons que les d√©bordements se produisent avec des transtypages explicites / implicites incorrects.  Et parce que  tous les moulages sont affich√©s dans la structure de l'arbre de syntaxe abstraite, nous utiliserons AST pour l'analyse.  Dans la figure ci-dessous (Fig.3), on peut voir que toute op√©ration qui provoque un transtypage dans l'arborescence est un n≈ìud distinct et, en se promenant dans l'arborescence, nous pouvons v√©rifier toutes les conversions de type en fonction d'une table avec des transformations qui peuvent provoquer une erreur. </p><br><div class="scrollable-table"><table><thead><tr><th></th><th>  Signe g </th><th>  Signe l </th><th>  Signe e </th><th>  Annuler la signature g </th><th>  Annuler la signature l </th><th>  Annuler la signature e </th></tr></thead><tbody><tr><td>  Signe </td><td>  + </td><td>  - </td><td>  + </td><td>  - </td><td>  - </td><td>  - </td></tr><tr><td>  Annuler la signature </td><td>  + </td><td>  - </td><td>  - </td><td>  - </td><td>  - </td><td>  + </td></tr></tbody></table></div><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e72/315/acb/e72315acbeaf57dcf7ea2f85670fe4e0.jpg" title="fig. 3"></p><br><p>  Plus pr√©cis√©ment, l'algorithme ressemble √† ceci: nous faisons le tour des mod√®les et examinons IntegralCast (conversions enti√®res).  Si vous trouvez un n≈ìud appropri√©, regardez les descendants √† la recherche d'une op√©ration binaire ou Decl (d√©claration de variable).  Dans le premier cas, vous devez v√©rifier le signe et la profondeur de bits utilis√©s par l'op√©ration binaire.  Dans le second cas, comparez uniquement le type de d√©claration. </p><br><h2 id="realizaciya-chekera">  Impl√©mentation de Checker </h2><br><p>  Passons √† la mise en ≈ìuvre.  Nous avons besoin d'un squelette pour un v√©rificateur, qui peut √™tre une biblioth√®que autonome, ou peut √™tre assembl√© dans le cadre de Clang.  Dans le code, la diff√©rence sera petite.  Si vous pr√©voyez d√©j√† d'√©crire votre propre plugin, je vous recommande de lire imm√©diatement un petit pdf: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Clang Static Analyzer: A Checker Developer's Guide"</a> , les choses de base y sont bien d√©crites, bien que quelque chose ne soit plus pertinent, la biblioth√®que est mise √† jour r√©guli√®rement, mais vous saisir tout de suite. </p><br><p>  Si vous souhaitez ajouter votre v√©rificateur √† votre assemblage de clang, vous devez: </p><br><ol><li><p>  √âcrivez le v√©rificateur lui-m√™me avec approximativement le contenu suivant: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SuperChecker</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Checker&lt;check::PreStmt&lt;BinaryOperator&gt;&gt; { <span class="hljs-comment"><span class="hljs-comment">//       ,    .       struct CheckerOpts { //       string FlagOne; int FlagTwo; }; CheckerOpts Opts; //cool code }; } void ento::registerSuperChecker(CheckerManager &amp;mgr) { auto checker = mgr.registerChecker&lt;SuperChecker&gt;(); //       ,   4    //       ,  stand-alone    . AnalyzerOptions &amp;AnOpts = mgr.getAnalyzerOptions(); SuperChecker::CheckerOpts &amp;ChOpts = checker-&gt;Opts; ChOpts.FlagOne = AnOpts.getCheckerStringOption("Inp1", "", checker); ChOpts.FlagTwo = AnOpts.getCheckerIntegerOption("Inp2", 0, checker); // getCheckerIntegerOption:  ,  ,   }</span></span></code> </pre> <br></li><li><p>  Ensuite, dans le code source de Clang, vous devrez modifier les fichiers <code>CMakeLists.txt</code> et <code>Checkers.td</code> .  Vivez ici <code>${llvm-source-path}/clang/lib/StaticAnalyzer/Checkers/CMakeLists.txt</code> <br>  et ici <code>${llvm-source-path}/clang/include/clang/StaticAnalyzer/Checkers/Checkers.td</code> . <br>  Dans le premier, il vous suffit d'ajouter le nom du fichier avec le code, dans le second, vous devez ajouter une description structurelle: </p><br><pre> <code class="cpp hljs"> #Checkers.td def SuperChecker : Checker&lt;<span class="hljs-string"><span class="hljs-string">"SuperChecker"</span></span>&gt;, HelpText&lt;<span class="hljs-string"><span class="hljs-string">"test checker"</span></span>&gt;, Documentation&lt;HasDocumentation&gt;;</code> </pre> <br></li></ol><br><p>  Si ce n'est pas clair, alors dans le fichier <code>Checkers.td</code> il y a suffisamment d'exemples de comment et quoi faire. </p><br><p>  Vous ne voudrez probablement pas reconstruire Clang, et vous aurez recours √† l'option avec l'assembly de biblioth√®que (so / dll).  Ensuite, dans le code du v√©rificateur devrait √™tre quelque chose comme ceci: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SuperChecker</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Checker&lt;check::PreStmt&lt;BinaryOperator&gt;&gt; { <span class="hljs-comment"><span class="hljs-comment">//       ,    .       struct CheckerOpts { string FlagOne; int FlagTwo; }; CheckerOpts Opts; //cool code }; } void initializationFunction(CheckerManager &amp;mgr){ SuperChecker *checker = mgr.registerChecker&lt;SuperChecker&gt;(); //       ,   4    AnalyzerOptions &amp;AnOpts = mgr.getAnalyzerOptions(); TestChecker::CheckerOpts &amp;ChOpts = checker-&gt;Opts; ChOpts.FlagOne = AnOpts.getCheckerStringOption("Inp1", "", checker); ChOpts.FlagTwo = AnOpts.getCheckerIntegerOption("Inp2", 0, checker); // getCheckerIntegerOption:  ,  ,   } extern "C" void clang_registerCheckers (CheckerRegistry &amp;registry) { registry.addChecker(&amp;initializationFunction, "test.Me", "SuperChecker description", "doc_link"); } extern "C" const char clang_analyzerAPIVersionString [] = "8.0.1";</span></span></code> </pre> <br><p>  Ensuite, collectez votre code, vous pouvez √©crire votre propre script pour l'assemblage, mais si vous avez des probl√®mes avec cela (comme l'auteur l'avait :)), vous pouvez alors utiliser le Makefile dans le code source de clang et cr√©er la commande clangStaticAnalyzerCheckers d'une mani√®re √©trange. </p><br><p>  Ensuite, appelez le v√©rificateur: </p><br><ul><li><p>  pour les dames int√©gr√©es </p><br><pre> <code class="bash hljs">clang++ -cc1 -analyze -analyzer-checker=core.DivideZero test.cpp</code> </pre> <br></li><li><p>  pour externe </p><br><pre> <code class="bash hljs">clang++ -cc1 -load <span class="hljs-variable"><span class="hljs-variable">${PATH_TO_CHECKER}</span></span>/SuperChecker.so -analyze -analyzer-checker=test.Me -analyzer-config test.Me:UsrInp1=<span class="hljs-string"><span class="hljs-string">"foo"</span></span> test.Me:Inp1=<span class="hljs-string"><span class="hljs-string">"bar"</span></span> -analyzer-config test.Me:Inp2=123 test.cpp</code> </pre> <br><p>  √Ä ce stade, nous avons d√©j√† une sorte de r√©sultat (Fig. 4), mais le code √©crit ne peut d√©tecter que les d√©bordements potentiels.  Et cela signifie un grand nombre de faux positifs. </p><br></li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ac1/79d/29b/ac179d29b330efd513343fdd5f9a2ddd.jpg" title="fig. 4"></p><br><p>  Pour r√©soudre ce probl√®me, nous pouvons: </p><br><ul><li>  Faire le tour du graphique d'avant en arri√®re et v√©rifier les valeurs sp√©cifiques des variables pour les cas o√π nous avons un d√©bordement potentiel. </li><li>  Pendant la travers√©e AST, enregistrez imm√©diatement les valeurs sp√©cifiques des variables et v√©rifiez-les si n√©cessaire. </li><li>  Utilisez l'analyse des souillures. </li></ul><br><p>  Pour √©tayer d'autres arguments, il convient de mentionner que lors de l'analyse de Clang, tous les fichiers sp√©cifi√©s dans la directive <code>#include</code> analysent √©galement, en cons√©quence, la taille de l'AST r√©sultant augmente.  En cons√©quence, parmi les options propos√©es, une seule est rationnelle concernant une t√¢che sp√©cifique: </p><br><ul><li>  Tout d'abord, cela prend beaucoup de temps.  Marcher dans un arbre, rechercher et compter tout ce dont vous avez besoin prendra beaucoup de temps, il peut devenir difficile d'analyser un grand projet avec un tel code.  Pour parcourir l'arborescence dans le code, nous utiliserons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la classe</a> <code>clang::RecursiveASTVisitor</code> , qui effectue une recherche de profondeur r√©cursive.  Une estimation du temps de cette approche sera <img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/a7cf317fbe3965ae3164f28c1f6858696adb23f4" title="niveau de difficult√©">  , o√π V est l'ensemble des sommets et E est l'ensemble des ar√™tes du graphique. </li><li>  La seconde - vous pouvez certainement stocker, mais nous ne savons pas ce dont nous aurons besoin et ce qui ne le sera pas.  De plus, les structures arborescentes elles-m√™mes, que nous utilisons dans l'analyse, n√©cessitent beaucoup de m√©moire, donc d√©penser de telles ressources pour autre chose est une mauvaise id√©e. </li><li>  La troisi√®me est une bonne id√©e, pour cette m√©thode, vous pouvez trouver suffisamment de recherches et d'exemples.  Mais dans CSA, il n'y a pas de souillure pr√™te.  Il y a un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">v√©rificateur</a> , qui a √©t√© ajout√© plus tard √† la liste des v√©rificateurs alpha (alpha.security.taint.TaintPropagation) dans les sources, il est d√©crit dans le fichier <code>GenericTaintChecker.cpp</code> .  Le v√©rificateur est bon, mais ne convient que pour les fonctions d'E / S non s√©curis√©es connues de C, il ne "marque" que les variables qui √©taient des arguments ou des r√©sultats de fonctions dangereuses.  En plus des options d√©crites, il convient de consid√©rer les variables globales, les champs de classe, etc., afin de restaurer correctement le mod√®le de "distribution". </li></ul><br><p>  Le temps restant pour le stage a √©t√© pass√© √† lire <code>GenericTaintChecker.cpp</code> et √† essayer de le refaire en fonction de vos besoins.  Il n'a pas fonctionn√© avec succ√®s √† la fin du mandat, mais il est rest√© une t√¢che de perfectionnement d√©j√† au-del√† de la port√©e de la formation chez DSec.  Au cours du d√©veloppement, il est √©galement devenu clair que l'identification des fonctions dangereuses est une t√¢che distincte, les endroits dangereux du projet ne proviennent pas toujours de certaines fonctions standard, donc un indicateur a √©t√© ajout√© au v√©rificateur pour indiquer une liste de fonctions qui seront consid√©r√©es comme ¬´empoisonn√©es¬ª / ¬´marqu√©es¬ª lors de l'analyse des souillures. <br>  De plus, une v√©rification a √©t√© ajout√©e pour d√©terminer si la variable est un champ de bits.  Par les outils CSA standard, la taille est d√©termin√©e par type, et si nous travaillons avec un champ de bits, alors sa taille aura la valeur du type de bit de tout le champ, et non le nombre de bits sp√©cifi√© dans la d√©claration de variable. </p><br><h2 id="chto-v-itoge">  Quel est le r√©sultat? </h2><br><p>  √Ä l'heure actuelle, un simple v√©rificateur a √©t√© mis en ≈ìuvre qui ne peut avertir que des d√©bordements d'entiers potentiels.  Une classe modifi√©e pour l'analyse des souillures, qui a encore beaucoup de travail √† faire.  Apr√®s cela, vous devez utiliser SMT pour d√©terminer les d√©bordements.  Pour cela, le solveur Z3 SMT convient, qui a √©t√© ajout√© √† l'assemblage Clang dans la version 5.0.0 (√† en juger par les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notes de publication</a> ).  Pour utiliser le solveur, il est n√©cessaire que Clang soit construit avec l'option <code>CLANG_ANALYZER_BUILD_Z3=ON</code> , et lorsque le plug-in CSA est appel√© directement, les <code>-Xanalyzer -analyzer-constraints=z3</code> sont transmis. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">R√©f√©rentiel de r√©sultats GitHub</a> </p><br><h2 id="ssylki">  R√©f√©rences: </h2><br><ol><li><p>  Howard M., Leblanc D., Viega J. "Les 24 p√©ch√©s de la s√©curit√© informatique" </p><br></li><li><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment √©crire un v√©rificateur en 24 heures</a> </p><br></li><li><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Clang Static Analyzer: A Checker Developer's Guide</a> </p><br></li><li><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Manuel de d√©veloppement du v√©rificateur CSA</a> </p><br></li><li><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dietz W. et al.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comprendre le d√©passement d'entier en C / C ++</a> </p><br></li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr473412/">https://habr.com/ru/post/fr473412/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr473394/index.html">Vous mentez tous! √Ä propos de la publicit√© CRM</a></li>
<li><a href="../fr473396/index.html">Nous avons besoin d'une autre bitrix</a></li>
<li><a href="../fr473400/index.html">Technologie de synth√®se vocale de haute qualit√©, l√©g√®re et adaptable utilisant LPCNet</a></li>
<li><a href="../fr473406/index.html">Marathon gratuit "Data Science et IA: apprendre √† la machine √† √©crire le script de la s√©rie"</a></li>
<li><a href="../fr473408/index.html">D√©bogage des fuites de m√©moire cach√©es dans Ruby</a></li>
<li><a href="../fr473416/index.html">Programme de la conf√©rence ZeroNights 2019</a></li>
<li><a href="../fr473418/index.html">OSCP - S√©curit√© offensive</a></li>
<li><a href="../fr473420/index.html">Nous ouvrons la saison des PHP-Meetups √† Nizhny Novgorod le 2 novembre</a></li>
<li><a href="../fr473424/index.html">ARM annonce les solutions graphiques Mali-G57 Valhall et Mali-D37, les neuroprocesseurs Ethos-N57 et N37</a></li>
<li><a href="../fr473426/index.html">Automatisation des tests End-2-End d'un syst√®me d'information int√©gr√©. Partie 1. Organisationnelle</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>