<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§“ ğŸ¤·ğŸ¿ ğŸ¤· ä½¿ç”¨Redux Thunkç»„ç»‡å’Œæµ‹è¯•ä»£ç çš„æ–¹æ³•çš„æè¿° ğŸ”ª â¹ï¸ ğŸ•µğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¤§å®¶å¥½ï¼ 


 åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æƒ³åˆ†äº«æˆ‘åœ¨Reacté¡¹ç›®ä¸­ä½¿ç”¨Redux Thunkç»„ç»‡å’Œæµ‹è¯•ä»£ç çš„æ–¹æ³•ã€‚ 


 é€šå¾€ä¹‹è·¯æ¼«é•¿è€Œæ£˜æ‰‹ï¼Œæ‰€ä»¥æˆ‘å°†å°è¯•è¯æ˜å¯¼è‡´æœ€ç»ˆå†³å®šçš„æ€è·¯å’ŒåŠ¨åŠ›ã€‚ 
 åº”ç”¨è¯´æ˜å’Œé—®é¢˜é™ˆè¿° 


 é¦–å…ˆï¼Œæœ‰ä¸€ç‚¹èƒŒæ™¯ã€‚ 


 ä¸‹å›¾æ˜¾ç¤ºäº†æˆ‘ä»¬é¡¹ç›®ä¸­å…¸å‹é¡µé¢çš„å¸ƒå±€ã€‚ 





 ä¸ºäº†ï¼š 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨Redux Thunkç»„ç»‡å’Œæµ‹è¯•ä»£ç çš„æ–¹æ³•çš„æè¿°</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/epam_systems/blog/469371/"><p> å¤§å®¶å¥½ï¼ </p><br><p> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æƒ³åˆ†äº«æˆ‘åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">React</a>é¡¹ç›®ä¸­ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Redux Thunk</a>ç»„ç»‡å’Œæµ‹è¯•ä»£ç çš„æ–¹æ³•ã€‚ </p><br><p> é€šå¾€ä¹‹è·¯æ¼«é•¿è€Œæ£˜æ‰‹ï¼Œæ‰€ä»¥æˆ‘å°†å°è¯•è¯æ˜å¯¼è‡´æœ€ç»ˆå†³å®šçš„æ€è·¯å’ŒåŠ¨åŠ›ã€‚ </p><a name="habracut"></a><br><h2 id="opisanie-prilozheniya-i-postanovka-problemy"> åº”ç”¨è¯´æ˜å’Œé—®é¢˜é™ˆè¿° </h2><br><p> é¦–å…ˆï¼Œæœ‰ä¸€ç‚¹èƒŒæ™¯ã€‚ </p><br><p> ä¸‹å›¾æ˜¾ç¤ºäº†æˆ‘ä»¬é¡¹ç›®ä¸­å…¸å‹é¡µé¢çš„å¸ƒå±€ã€‚ </p><br><p><img src="https://habrastorage.org/webt/rk/je/ac/rkjeacwa1f4shulpc5ge5y4oi6q.jpeg"></p><br><p> ä¸ºäº†ï¼š </p><br><ul><li> è¯¥è¡¨ï¼ˆç¬¬1å·ï¼‰åŒ…å«çš„æ•°æ®å¯èƒ½éå¸¸ä¸åŒï¼ˆçº¯æ–‡æœ¬ï¼Œé“¾æ¥ï¼Œå›¾ç‰‡ç­‰ï¼‰ã€‚ </li><li> æ’åºé¢æ¿ï¼ˆç¬¬2å·ï¼‰æŒ‰åˆ—è®¾ç½®è¡¨ä¸­çš„æ•°æ®æ’åºè®¾ç½®ã€‚ </li><li> è¿‡æ»¤é¢æ¿ï¼ˆç¬¬3å·ï¼‰æŒ‰è¡¨æ ¼åˆ—è®¾ç½®å„ç§è¿‡æ»¤å™¨ã€‚ </li><li> åˆ—é¢æ¿ï¼ˆç¬¬4å·ï¼‰å…è®¸æ‚¨è®¾ç½®è¡¨åˆ—çš„æ˜¾ç¤ºï¼ˆæ˜¾ç¤º/éšè—ï¼‰ã€‚ </li><li> æ¨¡æ¿é¢æ¿ï¼ˆç¼–å·5ï¼‰å…è®¸æ‚¨é€‰æ‹©ä»¥å‰åˆ›å»ºçš„è®¾ç½®æ¨¡æ¿ã€‚ æ¨¡æ¿åŒ…æ‹¬ç¬¬2å·ï¼Œç¬¬3å·ï¼Œç¬¬4å·é¢æ¿çš„æ•°æ®ï¼Œä»¥åŠå…¶ä»–ä¸€äº›æ•°æ®ï¼Œä¾‹å¦‚åˆ—çš„ä½ç½®ï¼Œå…¶å¤§å°ç­‰ã€‚ </li></ul><br><p> å•å‡»ç›¸åº”æŒ‰é’®å¯æ‰“å¼€é¢æ¿ã€‚ </p><br><p> è¡¨çš„å…ƒæ•°æ®ä¸­åŒ…å«æœ‰å…³è¡¨ä¸­å“ªäº›åˆ—å¯ä»¥æ˜¯ä»€ä¹ˆï¼Œæ•°æ®ä¸­å¯ä»¥åŒ…å«å“ªäº›æ•°æ®ï¼Œåº”å¦‚ä½•æ˜¾ç¤ºå®ƒä»¬ï¼Œè¿‡æ»¤å™¨å¯ä»¥åŒ…å«å“ªäº›å€¼ä»¥åŠå…¶ä»–ä¿¡æ¯çš„æ•°æ®ï¼Œè¿™äº›ä¿¡æ¯åœ¨é¡µé¢åŠ è½½å¼€å§‹æ—¶å°±ä¸æ•°æ®æœ¬èº«åˆ†å¼€è¯·æ±‚ã€‚ </p><br><p> äº‹å®è¯æ˜ï¼Œè¡¨åŠå…¶ä¸­çš„æ•°æ®çš„å½“å‰çŠ¶æ€å–å†³äºä¸‰ä¸ªå› ç´ ï¼š </p><br><ul><li> æ¥è‡ªè¡¨å…ƒæ•°æ®çš„æ•°æ®ã€‚ </li><li> å½“å‰æ‰€é€‰æ¨¡æ¿çš„è®¾ç½®ã€‚ </li><li> è‡ªå®šä¹‰è®¾ç½®ï¼ˆæœ‰å…³æ‰€é€‰æ¨¡æ¿çš„ä»»ä½•æ›´æ”¹éƒ½ä»¥â€œè‰ç¨¿â€çš„å½¢å¼ä¿å­˜ï¼Œå¯ä»¥å°†å…¶è½¬æ¢ä¸ºæ–°æ¨¡æ¿ï¼Œæˆ–è€…ä½¿ç”¨æ–°è®¾ç½®æ›´æ–°å½“å‰æ¨¡æ¿ï¼Œæˆ–è€…åˆ é™¤å®ƒä»¬å¹¶å°†æ¨¡æ¿æ¢å¤ä¸ºåŸå§‹çŠ¶æ€ï¼‰ã€‚ </li></ul><br><p> å¦‚ä¸Šæ‰€è¿°ï¼Œè¿™æ ·çš„é¡µé¢æ˜¯å…¸å‹çš„ã€‚ å¯¹äºæ¯ä¸ªè¿™æ ·çš„é¡µé¢ï¼ˆæˆ–æ›´ç¡®åˆ‡åœ°è¯´ï¼Œå¯¹äºå…¶ä¸­çš„è¡¨ï¼‰ï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨å…¶æ•°æ®å’Œå‚æ•°åœ¨Reduxå­˜å‚¨åº“ä¸­åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„å®ä½“ã€‚ </p><br><p> ä¸ºäº†èƒ½å¤Ÿè®¾ç½®åŒè´¨çš„åŠ¨ä½œåˆ›å»ºè€…å’ŒåŠ¨ä½œåˆ›å»ºè€…é›†åˆå¹¶æ›´æ–°ç‰¹å®šå®ä½“ä¸Šçš„æ•°æ®ï¼Œä½¿ç”¨äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»¥ä¸‹æ–¹æ³•</a> ï¼ˆä¸€ç§å·¥å‚ï¼‰ï¼š </p><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionsCreator = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">prefix, getCurrentStore, entityModel</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* --- ACTIONS BLOCK --- */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchTotalCounterStart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_START`</span></span> }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchTotalCounterSuccess</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">payload</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_SUCCESS`</span></span>, payload }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchTotalCounterError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_ERROR`</span></span>, error }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applyFilterSuccess</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">payload</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">APPLY_FILTER_SUCCESS`</span></span>, payload }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applyFilterError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">APPLY_FILTER_ERROR`</span></span>, error }; } <span class="hljs-comment"><span class="hljs-comment">/* --- THUNKS BLOCK --- */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchTotalCounter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> dispatch =&gt; { dispatch(fetchTotalCounterStart()); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload } } = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> entityModel.fetchTotalCounter(filter); dispatch(fetchTotalCounterSuccess(payload)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (error) { dispatch(fetchTotalCounterError(error)); } }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter, dispatch</span></span></span><span class="hljs-function">) </span></span>{ dispatch(fetchTotalCounter(filter)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> entityModel.fetchData(filter); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applyFilter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newFilter</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (dispatch, getStore) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = getStore(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> currentStore = getCurrentStore(store); <span class="hljs-comment"><span class="hljs-comment">// 'getFilter' comes from selectors. const filter = newFilter || getFilter(currentStore); const { data: { payload } } = await fetchData(filter, dispatch); dispatch(applyFilterSuccess(payload)); } catch (error) { dispatch(applyFilterError(error)); } }; } return { fetchTotalCounterStart, fetchTotalCounterSuccess, fetchTotalCounterError, applyFilterSuccess, applyFilterError, fetchTotalCounter, fetchData, applyFilter, }; };</span></span></code> </pre> <br><p> å…¶ä¸­ï¼š </p><br><ul><li>  <code>prefix</code> -Reduxå­˜å‚¨åº“ä¸­çš„å®ä½“å‰ç¼€ã€‚ å®ƒæ˜¯å½¢å¼ä¸ºâ€œ CATS _â€ï¼Œâ€œ MICE_â€ç­‰çš„å­—ç¬¦ä¸²ã€‚ </li><li>  <code>getCurrentStore</code>ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œå®ƒä»Reduxå­˜å‚¨åº“è¿”å›å®ä½“ä¸Šçš„å½“å‰æ•°æ®ã€‚ </li><li>  <code>entityModel</code>å®ä½“æ¨¡å‹ç±»çš„å®ä¾‹ã€‚ ä¸€æ–¹é¢ï¼Œé€šè¿‡æ¨¡å‹è®¿é—®ä¸€ä¸ªapiï¼Œä»¥åˆ›å»ºå¯¹æœåŠ¡å™¨çš„è¯·æ±‚ï¼Œå¦ä¸€æ–¹é¢ï¼Œæè¿°äº†ä¸€äº›å¤æ‚çš„ï¼ˆæˆ–å¹¶éå¦‚æ­¤ï¼‰æ•°æ®å¤„ç†é€»è¾‘ã€‚ </li></ul><br><p> å› æ­¤ï¼Œè¯¥å·¥å‚å…è®¸æ‚¨çµæ´»åœ°æè¿°Reduxå­˜å‚¨åº“ä¸­ç‰¹å®šå®ä½“çš„æ•°æ®å’Œå‚æ•°ç®¡ç†ï¼Œå¹¶å°†å…¶ä¸å¯¹åº”äºè¯¥å®ä½“çš„è¡¨ç›¸å…³è”ã€‚ </p><br><p> ç”±äºæ­¤ç³»ç»Ÿçš„ç®¡ç†å­˜åœ¨è®¸å¤šç»†å¾®å·®åˆ«ï¼Œå› æ­¤thunkå¯èƒ½æ˜¯å¤æ‚ï¼Œåºå¤§ï¼Œæ··ä¹±ä¸”å…·æœ‰é‡å¤æ€§çš„éƒ¨åˆ†ã€‚ ä¸ºäº†ç®€åŒ–å®ƒä»¬å¹¶é‡ç”¨ä»£ç ï¼Œå°†å¤æ‚çš„thunkåˆ†è§£ä¸ºæ›´ç®€å•çš„thunkï¼Œå¹¶ç»„åˆä¸ºä¸€ä¸ªç»„åˆã€‚ ç»“æœï¼Œç°åœ¨å¯èƒ½å‘ç°ä¸€ä¸ªthunkè°ƒç”¨äº†å¦ä¸€ä¸ªthunkï¼Œåè€…å·²ç»å¯ä»¥åˆ†æ´¾å¸¸è§„<code>applyFilter</code> ï¼ˆä¾‹å¦‚ä¸Šä¾‹ä¸­çš„<code>applyFilter</code>æ†ç»‘åŒ…<code>fetchTotalCounter</code> ï¼‰ã€‚ å½“è€ƒè™‘åˆ°æ‰€æœ‰è¦ç‚¹å¹¶æè¿°äº†æ‰€æœ‰å¿…è¦çš„é‡å‡»å’ŒåŠ¨ä½œåˆ›å»ºè€…åï¼ŒåŒ…å«<code>actionsCreator</code>å‡½æ•°çš„æ–‡ä»¶å°†åŒ…å«çº¦1200è¡Œä»£ç ï¼Œå¹¶ç»è¿‡äº†éå¸¸å‡ºè‰²çš„æµ‹è¯•ã€‚ æµ‹è¯•æ–‡ä»¶ä¹Ÿæœ‰å¤§çº¦1200è¡Œï¼Œä½†è¦†ç›–ç‡æœ€å¤šä¸º40-50ï¼…ã€‚ </p><br><p> å½“ç„¶ï¼Œåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ— è®ºä»é‡å‡»çš„æ•°é‡è¿˜æ˜¯å…¶å†…éƒ¨é€»è¾‘ä¸Šéƒ½å¤§å¤§ç®€åŒ–äº†ç¤ºä¾‹ï¼Œä½†è¿™è¶³ä»¥è¯´æ˜é—®é¢˜ã€‚ </p><br><p> åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œè¯·æ³¨æ„ä¸¤ç§ç±»å‹çš„thunkï¼š </p><br><ul><li>  <code>fetchTotalCounter</code>åˆ†æ´¾<code>fetchTotalCounter</code> ã€‚ </li><li>  <code>applyFilter</code>é™¤äº†åˆ†é…å±äºå®ƒçš„<code>applyFilter</code> ï¼ˆ <code>applyFilterSuccess</code> ï¼Œ <code>applyFilterError</code> ï¼‰å¤–ï¼Œdispatch-itä¹Ÿæ˜¯å¦ä¸€ä¸ª<code>fetchTotalCounter</code> ï¼ˆ <code>fetchTotalCounter</code> ï¼‰ã€‚ <br> æˆ‘ä»¬ç¨åå†è¿”å›ã€‚ </li></ul><br><p> æ‰€æœ‰è¿™äº›éƒ½<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æŒ‰ä»¥ä¸‹æ–¹å¼</a>è¿›è¡Œäº†æµ‹è¯•ï¼ˆè¯¥æ¡†æ¶ç”¨äºæµ‹è¯•<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Jest</a> ï¼‰ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> configureMockStore <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-mock-store'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> thunk <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-thunk'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { actionsCreator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'actionsCreator'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> defaultState = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> middlewares = [thunk]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mockStore = configureMockStore(middlewares); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> prefix = <span class="hljs-string"><span class="hljs-string">'TEST_'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getCurrentStore = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> defaultState; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> entityModel = { <span class="hljs-attr"><span class="hljs-attr">fetchTotalCounter</span></span>: jest.fn(), <span class="hljs-attr"><span class="hljs-attr">fetchData</span></span>: jest.fn(), }; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> actions; beforeEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { actions = actionsCreator(prefix, getCurrentStore, entityModel); }); describe(<span class="hljs-string"><span class="hljs-string">'fetchTotalCounter'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'should dispatch correct actions on success'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filter = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> payload = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = mockStore(defaultState); entityModel.fetchTotalCounter.mockResolvedValueOnce({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload }, }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> expectedActions = [ { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_START`</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_SUCCESS`</span></span>, payload, } ]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> store.dispatch(actions.fetchTotalCounter(filter)).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { expect(store.getActions()).toEqual(expectedActions); }); }); it(<span class="hljs-string"><span class="hljs-string">'should dispatch correct actions on error'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filter = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> error = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = mockStore(defaultState); entityModel.fetchTotalCounter.mockRejectedValueOnce(error); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> expectedActions = [ { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_START`</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_ERROR`</span></span>, error, } ]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> store.dispatch(actions.fetchTotalCounter(filter)).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { expect(store.getActions()).toEqual(expectedActions); }); }); }); describe(<span class="hljs-string"><span class="hljs-string">'applyFilter'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'should dispatch correct actions on success'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> payload = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newFilter = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = mockStore(defaultState); entityModel.fetchData.mockResolvedValueOnce({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload } }); entityModel.fetchTotalCounter.mockResolvedValueOnce({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: counter }, }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> expectedActions = [ <span class="hljs-comment"><span class="hljs-comment">// fetchTotalCounter actions { type: `${prefix}FETCH_TOTAL_COUNTER_START` }, { type: `${prefix}FETCH_TOTAL_COUNTER_SUCCESS`, payload: counter, }, // applyFilter actions { type: `${prefix}APPLY_FILTER_SUCCESS`, payload, } ]; return store.dispatch(actions.applyFilter(newFilter)).then(() =&gt; { expect(store.getActions()).toEqual(expectedActions); }); }); it('should dispatch correct actions on error', () =&gt; { const error = {}; const counter = 0; const newFilter = {}; const store = mockStore(defaultState); entityModel.fetchData.mockRejectedValueOnce(error); entityModel.fetchTotalCounter.mockResolvedValueOnce({ data: { payload: counter }, }); const expectedActions = [ // fetchTotalCounter actions { type: `${prefix}FETCH_TOTAL_COUNTER_START` }, { type: `${prefix}FETCH_TOTAL_COUNTER_SUCCESS`, payload: counter, }, // applyFilter actions { type: `${prefix}APPLY_FILTER_ERROR`, error, } ]; return store.dispatch(actions.applyFilter(newFilter)).then(() =&gt; { expect(store.getActions()).toEqual(expectedActions); }); }); }); });</span></span></code> </pre> <br><p> å¦‚æ‚¨æ‰€è§ï¼Œæµ‹è¯•ç¬¬ä¸€ç§ç±»å‹çš„thunkå¹¶æ²¡æœ‰é—®é¢˜-æ‚¨åªéœ€è¦é’©æŒ‚å®ä½“æ¨¡å‹æ¨¡å‹<code>entityModel</code> ï¼Œä½†æ˜¯ç¬¬äºŒç§ç±»å‹æ›´å¤æ‚-æ‚¨å¿…é¡»æ“¦é™¤æ•´ä¸ªç§°ä¸ºthunkçš„é“¾å’Œç›¸åº”æ¨¡å‹æ–¹æ³•çš„æ•°æ®ã€‚ å¦åˆ™ï¼Œæµ‹è¯•å°†è½åœ¨æ•°æ®ä¸­æ–­ï¼ˆ <strong>{dataï¼š{payload}}</strong> ï¼‰ä¸Šï¼Œå¹¶ä¸”å¯ä»¥æ˜¾å¼åœ°æˆ–éšå¼åœ°è¿›è¡Œï¼ˆæµ‹è¯•æˆåŠŸé€šè¿‡ï¼Œä½†æ˜¯ç»è¿‡ä»”ç»†ç ”ç©¶ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°åœ¨ç¬¬äºŒ/ç¬¬ä¸‰éƒ¨åˆ†ï¼‰ç”±äºç¼ºå°‘é”å®šæ•°æ®ï¼Œæµ‹è¯•é“¾ä¸‹é™äº†ï¼‰ã€‚ å•ä¸ªåŠŸèƒ½çš„å•å…ƒæµ‹è¯•å˜æˆä¸€ç§é›†æˆï¼Œå¹¶ä¸”å˜å¾—ç´§å¯†ç›¸å…³ä¹Ÿæ˜¯ä¸å¥½çš„ã€‚ </p><br><p> å‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœ<strong>å·²ç»</strong>ä¸ºå®ƒç¼–å†™äº†å•ç‹¬çš„è¯¦ç»†æµ‹è¯•ï¼Œä¸ºä»€ä¹ˆåœ¨<code>applyFilter</code>å‡½æ•°ä¸­æ£€æŸ¥<code>fetchTotalCounter</code>å‡½æ•°çš„<code>fetchTotalCounter</code> ï¼Ÿ å¦‚ä½•ä½¿ç¬¬äºŒç§ç±»å‹çš„thunkæµ‹è¯•æ›´åŠ ç‹¬ç«‹ï¼Ÿ æœ‰æœºä¼šæµ‹è¯•ä¸€ä¸‹<strong>thunk</strong> ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º<code>fetchTotalCounter</code> ï¼‰æ˜¯<strong>ä½¿ç”¨æ­£ç¡®çš„å‚æ•°è°ƒç”¨çš„ï¼Œ</strong>è¿™å°†æ˜¯éå¸¸æ£’çš„ï¼Œå¹¶ä¸”ä¸éœ€è¦æ‹…å¿ƒmoksæ‰èƒ½æ­£å¸¸å·¥ä½œã€‚ </p><br><p> ä½†æ˜¯æ€ä¹ˆåšå‘¢ï¼Ÿ ä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„å†³å®šæµ®ç°åœ¨è„‘æµ·ï¼šæŒ‚æ¥åˆ°applyFilterä¸­è°ƒç”¨çš„fetchDataå‡½æ•°ï¼Œæˆ–è€…é”å®š<code>fetchTotalCounter</code> ï¼ˆå› ä¸ºé€šå¸¸ç›´æ¥è°ƒç”¨å¦ä¸€ä¸ªthunkï¼Œè€Œä¸æ˜¯é€šè¿‡è¯¸å¦‚<code>fetchData</code>å…¶ä»–å‡½æ•°ï¼‰ã€‚ </p><br><p> è®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å°†ä»…æ›´æ”¹æˆåŠŸçš„è„šæœ¬ã€‚ </p><br><ul><li> é€‰ä»¶ç¼–å·1ã€‚ æ¨¡æ‹Ÿ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>fetchData</code></a>å‡½æ•°ï¼š </li></ul><br><pre> <code class="diff hljs">describe('applyFilter', () =&gt; { it('should dispatch correct actions on success', () =&gt; { const payload = {}; - const counter = 0; const newFilter = {}; const store = mockStore(defaultState); - entityModel.fetchData.mockResolvedValueOnce({ data: { payload } }); - entityModel.fetchTotalCounter.mockResolvedValueOnce({ - data: { payload: counter }, - }); + const fetchData = jest.spyOn(actions, 'fetchData'); + // or fetchData.mockImplementationOnce(Promise.resolve({ data: { payload } })); + fetchData.mockResolvedValueOnce({ data: { payload } }); const expectedActions = [ - // Total counter actions - { type: `${prefix}FETCH_TOTAL_COUNTER_START` }, - { - type: `${prefix}FETCH_TOTAL_COUNTER_SUCCESS`, - payload: counter, - }, - // apply filter actions { type: `${prefix}APPLY_FILTER_SUCCESS`, payload, } ]; return store.dispatch(actions.applyFilter(newFilter)).then(() =&gt; { expect(store.getActions()).toEqual(expectedActions); + expect(actions.fetchTotalCounter).toBeCalledWith(newFilter); }); }); });</code> </pre> <br><p> åœ¨è¿™é‡Œï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>jest.spyOn</code></a>æ–¹æ³•å¤§è‡´ï¼ˆä¹Ÿè®¸æ­£å¥½ï¼‰æ›¿æ¢äº†ä»¥ä¸‹å®ç°ï¼š </p><br><pre> <code class="javascript hljs">actions.fetchData = jest.fn(actions.fetchData);</code> </pre> <br><p> è¿™ä½¿æˆ‘ä»¬å¯ä»¥â€œç›‘è§†â€è¯¥å‡½æ•°å¹¶äº†è§£å®ƒæ˜¯å¦è¢«è°ƒç”¨ä»¥åŠå¸¦æœ‰ä»€ä¹ˆå‚æ•°ã€‚ </p><br><p> æˆ‘ä»¬æ”¶åˆ°ä»¥ä¸‹é”™è¯¯ï¼š </p><br><pre> <code class="diff hljs">Difference: - Expected + Received Array [ Object { - "payload": Object {}, - "type": "TEST_APPLY_FILTER_SUCCESS", + "type": "TEST_FETCH_TOTAL_COUNTER_START", }, + Object { + "error": [TypeError: Cannot read property 'data' of undefined], + "type": "TEST_FETCH_TOTAL_COUNTER_ERROR", + }, + Object { + "error": [TypeError: Cannot read property 'data' of undefined], + "type": "TEST_APPLY_FILTER_ERROR", + }, ]</code> </pre> <br><p> å¥‡æ€ªçš„æ˜¯ï¼Œæˆ‘ä»¬éšè—äº†fetchDataå‡½æ•°ï¼Œ <code>fetchData</code>æˆ‘ä»¬çš„å®ç°æ‹¬èµ·æ¥ </p><br><pre> <code class="javascript hljs">fetchData.mockResolvedValueOnce({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload } })</code> </pre> <br><p> ä½†æ˜¯è¯¥å‡½æ•°çš„å·¥ä½œåŸç†ä¸ä»¥å‰å®Œå…¨ç›¸åŒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¨¡æ‹Ÿæ— æ³•æ­£å¸¸å·¥ä½œï¼ è®©æˆ‘ä»¬å°è¯•ä¸åŒçš„æ–¹æ³•ã€‚ </p><br><ul><li> é€‰ä»¶ç¼–å·2ã€‚ æ¨¡æ‹Ÿ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>fetchTotalCounter</code></a>å‡½æ•°ï¼š </li></ul><br><pre> <code class="diff hljs">describe('applyFilter', () =&gt; { it('should dispatch correct actions on success', () =&gt; { const payload = {}; - const counter = 0; const newFilter = {}; const store = mockStore(defaultState); entityModel.fetchData.mockResolvedValueOnce({ data: { payload } }); - entityModel.fetchTotalCounter.mockResolvedValueOnce({ - data: { payload: counter }, - }); + const fetchTotalCounter = jest.spyOn(actions, 'fetchTotalCounter'; + fetchTotalCounter.mockImplementation(() =&gt; {}); const expectedActions = [ - // Total counter actions - { type: `${prefix}FETCH_TOTAL_COUNTER_START` }, - { - type: `${prefix}FETCH_TOTAL_COUNTER_SUCCESS`, - payload: counter, - }, - // apply filter actions { type: `${prefix}APPLY_FILTER_SUCCESS`, payload, } ]; return store.dispatch(actions.applyFilter(newFilter)).then(() =&gt; { expect(store.getActions()).toEqual(expectedActions); + expect(actions.fetchTotalCounter).toBeCalledWith(newFilter); }); }); });</code> </pre> <br><p> æˆ‘ä»¬å¾—åˆ°å®Œå…¨ç›¸åŒçš„é”™è¯¯ã€‚ ç”±äºæŸäº›åŸå› ï¼Œæˆ‘ä»¬çš„mokaså¹¶ä¸èƒ½æ›¿ä»£åŠŸèƒ½çš„åŸå§‹å®ç°ã€‚ </p><br><p> æˆ‘è‡ªå·±ç ”ç©¶äº†è¿™ä¸ªé—®é¢˜å¹¶åœ¨Internetä¸Šæ‰¾åˆ°äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸€äº›</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¿¡æ¯å</a> ï¼Œæˆ‘æ„è¯†åˆ°è¿™ä¸ªé—®é¢˜ä¸ä»…å­˜åœ¨äºæˆ‘è‡ªå·±ï¼Œè€Œä¸”ï¼ˆåœ¨æˆ‘çœ‹æ¥ï¼‰å·²è¢«å®Œå…¨è§£å†³ã€‚ æ­¤å¤–ï¼Œè¿™äº›èµ„æ–™ä¸­æè¿°çš„ç¤ºä¾‹éƒ½æ˜¯å¥½çš„ï¼Œç›´åˆ°å®ƒä»¬æˆä¸ºå°†å®ƒä»¬è¿æ¥åˆ°å•ä¸ªç³»ç»Ÿä¸­çš„ä¸€éƒ¨åˆ†ï¼ˆåœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰å‚æ•°çš„å·¥å‚ï¼‰ã€‚ </p><br><p> åœ¨æˆ‘ä»¬ä½äºJenkins piplineçš„é¡¹ç›®ä¸­ï¼ŒSonarQubeè¿›è¡Œäº†ä»£ç æ£€æŸ¥ï¼Œè¯¥æ£€æŸ¥è¦æ±‚è¦†ç›–ä¿®æ”¹åçš„æ–‡ä»¶ï¼ˆåœ¨åˆå¹¶/æå–è¯·æ±‚ä¸­ï¼‰ <code>&gt; 60%</code> ã€‚ å¦‚å‰æ‰€è¿°ï¼Œç”±äºè¯¥å·¥å‚çš„è¦†ç›–èŒƒå›´ä¸ä»¤äººæ»¡æ„ï¼Œå¹¶ä¸”éå¸¸éœ€è¦è¦†ç›–æ­¤ç±»æ–‡ä»¶æ‰å¯¼è‡´æ²®ä¸§ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»å¯¹æ­¤åšäº›äº‹æƒ…ï¼Œå¦åˆ™æ–°åŠŸèƒ½çš„äº¤ä»˜å¯èƒ½ä¼šéšç€æ—¶é—´çš„æµé€è€Œå˜æ…¢ã€‚ ä¸ºäº†ä½¿è¦†ç›–ç‡è¾¾åˆ°æ‰€éœ€çš„æ ‡è®°ï¼Œä»…ä¿å­˜äº†åŒä¸€åˆå¹¶/æå–è¯·æ±‚ä¸­å…¶ä»–æ–‡ä»¶ï¼ˆç»„ä»¶ï¼ŒåŠŸèƒ½ï¼‰çš„æµ‹è¯•è¦†ç›–ç‡ï¼Œä½†æ˜¯ï¼Œå®é™…ä¸Šï¼Œè¿™æ˜¯ä¸€ç§è§£å†³æ–¹æ³•ï¼Œè€Œä¸æ˜¯é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚ å¥½ä¸€ä¼šå„¿ï¼Œåœ¨å†²åˆºä¸­èŠ±äº†ä¸€ç‚¹æ—¶é—´ï¼Œæˆ‘å¼€å§‹æ€è€ƒå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ </p><br><h2 id="popytka-resheniya-problemy-1-ya-chto-to-slyshal-pro-redux-saga"> å°è¯•è§£å†³é—®é¢˜ç¼–å·1ã€‚ æˆ‘å¬è¯´è¿‡Redux-Sagaçš„äº‹... </h2><br><p>  ...å¹¶ä¸”ä»–ä»¬å‘Šè¯‰æˆ‘ä½¿ç”¨æ­¤ä¸­é—´ä»¶æ—¶ï¼Œæµ‹è¯•ä¼šå¤§å¤§ç®€åŒ–ã€‚ </p><br><p> ç¡®å®ï¼Œå¦‚æœæ‚¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æŸ¥çœ‹æ–‡æ¡£</a> ï¼Œæ‚¨ä¼šå¯¹ä»£ç çš„æµ‹è¯•å¦‚æ­¤ç®€å•æ„Ÿåˆ°æƒŠè®¶ã€‚ æœæ±æœ¬èº«çš„äº‹å®æ˜¯ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•æ ¹æœ¬æ²¡æœ‰é—®é¢˜ï¼Œå› ä¸ºæŸäº›ä¼ å¥‡å¯ä»¥è°ƒç”¨å¦ä¸€ä¸ªä¼ å¥‡-æˆ‘ä»¬å¯ä»¥å¼„æ¹¿å¹¶â€œç›‘å¬â€ä¸­é—´ä»¶æä¾›çš„åŠŸèƒ½ï¼ˆ <code>put</code> ï¼Œ <code>take</code>ç­‰ï¼‰ï¼Œå¹¶ä¸”éªŒè¯å®ƒä»¬æ˜¯å¦è¢«è°ƒç”¨ï¼ˆå¹¶ä½¿ç”¨æ­£ç¡®çš„å‚æ•°è°ƒç”¨ï¼‰ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥å‡½æ•°ä¸ä¼šç›´æ¥è®¿é—®å¦ä¸€ä¸ªå‡½æ•°ï¼Œè€Œæ˜¯ä»åº“ä¸­å¼•ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åè¯¥åº“å°†è°ƒç”¨å…¶ä»–å¿…éœ€çš„å‡½æ•°/ sagasã€‚ </p><br><p>  â€œä¸ºä»€ä¹ˆä¸å°è¯•è¿™ç§ä¸­é—´ä»¶ï¼Ÿâ€ æˆ‘æƒ³ï¼Œå°±å»ä¸Šç­ã€‚ ä»–åœ¨å‰æ‹‰ï¼ˆJiraï¼‰å¼€å§‹äº†ä¸€ä¸ªæŠ€æœ¯å†å²ï¼Œåœ¨å…¶ä¸­åˆ›å»ºäº†å‡ ä¸ªä»»åŠ¡ï¼ˆä»ç ”ç©¶åˆ°æ•´ä¸ªç³»ç»Ÿçš„ä½“ç³»ç»“æ„çš„å®ç°å’Œæè¿°ï¼‰ï¼Œè·å¾—äº†â€œåè¶…â€ï¼Œå¹¶å¼€å§‹ä½¿ç”¨æ–°æ–¹æ³•å¯¹å½“å‰ç³»ç»Ÿè¿›è¡Œæœ€å°åŒ–å¤åˆ¶ã€‚ </p><br><p> ä¸€å¼€å§‹ï¼Œä¸€åˆ‡è¿›å±•é¡ºåˆ©ã€‚ åœ¨ä¸€ä½å¼€å‘äººå‘˜çš„å»ºè®®ä¸‹ï¼Œç”šè‡³æœ‰å¯èƒ½åˆ›å»ºä¸€ä¸ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å…¨å±€ä¼ å¥‡ï¼Œ</a>ä»¥ä¸€ç§æ–°æ–¹æ³•<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åŠ è½½æ•°æ®å¹¶è¿›è¡Œé”™è¯¯å¤„ç†</a> ã€‚ ä½†æ˜¯ï¼Œåœ¨æŸäº›æ—¶å€™<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æµ‹è¯•å­˜åœ¨é—®é¢˜</a> ï¼ˆé¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œåˆ°ç›®å‰ä¸ºæ­¢è¿˜æ²¡æœ‰è§£å†³ï¼‰ã€‚ æˆ‘è®¤ä¸ºè¿™å¯èƒ½ä¼šç ´åå½“å‰å¯ç”¨çš„æ‰€æœ‰æµ‹è¯•å¹¶äº§ç”Ÿå¤§é‡é”™è¯¯ï¼Œå› æ­¤æˆ‘å†³å®šæ¨è¿Ÿå®Œæˆæ­¤ä»»åŠ¡çš„å·¥ä½œï¼Œç›´åˆ°æ‰¾åˆ°è§£å†³é—®é¢˜çš„åŠæ³•ï¼Œç„¶åå†æ‰§è¡Œäº§å“ä»»åŠ¡ã€‚ </p><br><p> ä¸€ä¸¤ä¸ªæœˆè¿‡å»äº†ï¼Œæ²¡æœ‰æ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼Œåœ¨æŸä¸ªæ—¶å€™ï¼Œä¸ä»–ä»¬è¿›è¡Œäº†è®¨è®ºã€‚ ç”±äºé¢†å¯¼ï¼ˆç¼ºå°‘ï¼‰è¯¥ä»»åŠ¡çš„è¿›åº¦ï¼Œä»–ä»¬å†³å®šæ”¾å¼ƒRedux-Sagaåœ¨è¯¥é¡¹ç›®ä¸­çš„å®æ–½ï¼Œå› ä¸ºåˆ°é‚£æ—¶ï¼Œå®ƒåœ¨äººå·¥æˆæœ¬å’Œå¯èƒ½çš„bugæ•°é‡ä¸Šå·²ç»å˜å¾—å¤ªæ˜‚è´µäº†ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬æœ€ç»ˆå†³å®šä½¿ç”¨Redux Thunkã€‚ </p><br><h2 id="popytka-resheniya-problemy-2-thunk-moduli"> å°è¯•è§£å†³é—®é¢˜ç¼–å·2ã€‚  Thunkæ¨¡å— </h2><br><p> æ‚¨å¯ä»¥å°†æ‰€æœ‰thunkæ’åºåˆ°ä¸åŒçš„æ–‡ä»¶ä¸­ï¼Œåœ¨ä¸€ä¸ªthunkè°ƒç”¨å¦ä¸€ä¸ªï¼ˆå¯¼å…¥ï¼‰çš„æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>jest.mock</code></a>æ–¹æ³•æˆ–ç›¸åŒçš„<code>jest.spyOn</code>æ“¦é™¤æ­¤å¯¼å…¥ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†å®Œæˆä¸Šé¢çš„ä»»åŠ¡ï¼Œä»¥éªŒè¯æ˜¯å¦ä½¿ç”¨å¿…è¦çš„å‚æ•°<strong>è°ƒç”¨</strong>äº†ä¸€äº›å¤–éƒ¨thunkï¼Œè€Œæ— éœ€ä¸ºæ­¤æ‹…å¿ƒã€‚ å¦å¤–ï¼Œæœ€å¥½æ ¹æ®å®ƒä»¬çš„åŠŸèƒ½ç›®çš„æ¥åˆ†è§£æ‰€æœ‰çš„thunkï¼Œä»¥å…å°†å®ƒä»¬å…¨éƒ¨ä¿ç•™åœ¨ä¸€ä¸ªå †ä¸­ã€‚ å› æ­¤ï¼ŒåŒºåˆ†äº†ä¸‰ä¸ªè¿™æ ·çš„ç‰©ç§ï¼š </p><br><ul><li> ä¸ä½¿ç”¨æ¨¡æ¿æœ‰å…³- <code>templates</code> ã€‚ </li><li> ä¸ä½¿ç”¨è¿‡æ»¤å™¨ï¼ˆæ’åºï¼Œæ˜¾ç¤ºåˆ—ï¼‰æœ‰å…³<code>filter</code> ã€‚ </li><li> ä¸ä½¿ç”¨è¡¨æœ‰å…³ï¼ˆæ»šåŠ¨æ—¶åŠ è½½æ–°æ•°æ®ï¼Œå› ä¸ºè¯¥è¡¨å…·æœ‰è™šæ‹Ÿæ»šåŠ¨ï¼ŒåŠ è½½å…ƒæ•°æ®ï¼Œé€šè¿‡è¡¨ä¸­çš„è®°å½•è®¡æ•°å™¨åŠ è½½æ•°æ®ç­‰ï¼‰ <code>table</code> ã€‚ </li></ul><br><p> å»ºè®®ä½¿ç”¨ä»¥ä¸‹æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ç»“æ„ï¼š </p><br><pre> <code class="bash hljs">src/ |-- store/ | |-- filter/ | | |-- actions/ | | | |-- thunks/ | | | | |-- __tests__/ | | | | | |-- applyFilter.test.js | | | | |-- applyFilter.js | | | |-- actionCreators.js | | | |-- index.js | |-- table/ | | |-- actions/ | | | |-- thunks/ | | | | |-- __tests__/ | | | | | |-- fetchData.test.js | | | | | |-- fetchTotalCounter.test.js | | | | |-- fetchData.js | | | | |-- fetchTotalCounter.js | | | |-- actionCreators.js | | | |-- index.js (main file with actionsCreator)</code> </pre> <br><p> è¿™ç§æ¶æ„çš„ä¸€ä¸ªä¾‹å­åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™é‡Œ</a> ã€‚ </p><br><p> åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">applyFilter</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æµ‹è¯•æ–‡ä»¶ä¸­ï¼Œ</a>æ‚¨å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»è¾¾åˆ°äº†æˆ‘ä»¬è¿½æ±‚çš„ç›®æ ‡-æ‚¨æ— æ³•ç¼–å†™mokasæ¥ç»´æŠ¤<code>fetchData</code> / <code>fetchTotalCounter</code>çš„æ­£ç¡®æ“ä½œã€‚ ä½†æ˜¯è¦ä»˜å‡ºä»€ä¹ˆä»£ä»·... </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>applyFilter.js</code></a> ï¼š </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { applyFilterSuccess, applyFilterError } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { fetchData } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../../table/actions'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// selector const getFilter = store =&gt; store.filter; export function applyFilter(prefix, getCurrentStore, entityModel) { return newFilter =&gt; { return async (dispatch, getStore) =&gt; { try { const store = getStore(); const currentStore = getCurrentStore(store); const filter = newFilter || getFilter(currentStore); const { data: { payload } } = await fetchData(prefix, entityModel)(filter, dispatch); dispatch(applyFilterSuccess(prefix)(payload)); } catch (error) { dispatch(applyFilterError(prefix)(error)); } }; }; }</span></span></code> </pre> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>actionsCreator</code></a> ï¼š </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> filterActions <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./filter/actions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> tableActions <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./table/actions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionsCreator = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">prefix, getCurrentStore, entityModel</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">fetchTotalCounterStart</span></span>: tableActions.fetchTotalCounterStart(prefix), <span class="hljs-attr"><span class="hljs-attr">fetchTotalCounterSuccess</span></span>: tableActions.fetchTotalCounterSuccess(prefix), <span class="hljs-attr"><span class="hljs-attr">fetchTotalCounterError</span></span>: tableActions.fetchTotalCounterError(prefix), <span class="hljs-attr"><span class="hljs-attr">applyFilterSuccess</span></span>: filterActions.applyFilterSuccess(prefix), <span class="hljs-attr"><span class="hljs-attr">applyFilterError</span></span>: filterActions.applyFilterError(prefix), <span class="hljs-attr"><span class="hljs-attr">fetchTotalCounter</span></span>: tableActions.fetchTotalCounter(prefix, entityModel), <span class="hljs-attr"><span class="hljs-attr">fetchData</span></span>: tableActions.fetchData(prefix, entityModel), <span class="hljs-attr"><span class="hljs-attr">applyFilter</span></span>: filterActions.applyFilter(prefix, getCurrentStore, entityModel) }; };</code> </pre> <br><p> å¯¹äºæµ‹è¯•çš„æ¨¡å—åŒ–ï¼Œæˆ‘ä¸å¾—ä¸ä»˜å‡ºé‡å¤ä»£ç å’Œå¯¹thunkå½¼æ­¤éå¸¸ä¾èµ–çš„ä»£ä»·ã€‚ è°ƒç”¨é“¾ä¸­çš„ä»»ä½•ç»†å¾®å˜åŒ–éƒ½ä¼šå¯¼è‡´ç¹é‡çš„é‡æ„ã€‚ </p><br><p> åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæ¼”ç¤ºäº†<code>table</code>å’Œ<code>filter</code>ç¤ºä¾‹ï¼Œä»¥ä¿æŒç»™å®šç¤ºä¾‹çš„ä¸€è‡´æ€§ã€‚ å®é™…ä¸Šï¼Œé‡æ„æ˜¯ä»<code>templates</code>å¼€å§‹çš„ï¼ˆäº‹å®è¯æ˜å®ƒå¾ˆç®€å•ï¼‰ï¼Œå¹¶ä¸”é™¤äº†ä¸Šé¢çš„é‡æ„ä¹‹å¤–ï¼Œä½¿ç”¨æ¨¡æ¿çš„æ¦‚å¿µä¹Ÿæœ‰æ‰€å˜åŒ–ã€‚ ä½œä¸ºä¸€ç§å‡è®¾ï¼Œå·²ç»æ¥å—äº†ä¸€ä¸ªé¡µé¢ï¼ˆå¦‚è¡¨æ ¼ï¼‰ä¸Šåªèƒ½æœ‰ä¸€ä¸ªæ¨¡æ¿é¢æ¿ã€‚ å½“æ—¶å°±æ˜¯è¿™æ · <del> é—æ¼ </del> è¯¥å‡è®¾ä½¿æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ é™¤<code>prefix</code>æ¥ç®€åŒ–ä»£ç ã€‚ <br> å°†æ›´æ”¹æ³¨å…¥ä¸»å¼€å‘åˆ†æ”¯å¹¶è¿›è¡Œæµ‹è¯•åï¼Œæˆ‘å¸¦ç€é•‡å®šçš„å¿ƒå»åº¦å‡ï¼Œä»¥ä¾¿åœ¨è¿”å›åç»§ç»­å°†å…¶ä½™ä»£ç è½¬ç§»åˆ°æ–°æ–¹æ³•ä¸­ã€‚ </p><br><p> ä¼‘å‡å›æ¥åï¼Œæˆ‘æƒŠè®¶åœ°å‘ç°æˆ‘çš„æ›´æ”¹è¢«æ’¤æ¶ˆäº†ã€‚ åŸæ¥ï¼Œå‡ºç°äº†ä¸€ä¸ªé¡µé¢ï¼Œä¸Šé¢å¯èƒ½æœ‰å‡ ä¸ªç‹¬ç«‹çš„è¡¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå…ˆå‰æ‰€åšçš„å‡è®¾ç ´åäº†æ‰€æœ‰å†…å®¹ã€‚ æ‰€ä»¥æ‰€æœ‰çš„å·¥ä½œéƒ½æ˜¯å¾’åŠ³çš„... </p><br><p> å¥½å§ï¼Œå·®ä¸å¤šã€‚ å®é™…ä¸Šï¼Œå¯ä»¥é‡æ–°æ‰§è¡Œæ‰€æœ‰ç›¸åŒçš„æ“ä½œï¼ˆåˆå¹¶/æ‹‰å–è¯·æ±‚çš„å¥½å¤„å¹¶æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹æ¶ˆå¤±ï¼Œè€Œæ˜¯ä¿ç•™åœ¨å†å²ä¸­ï¼‰ï¼Œä½¿æ¨¡æ¿ä½“ç³»ç»“æ„çš„æ–¹æ³•ä¿æŒä¸å˜ï¼Œå¹¶ä¸”ä»…æ›´æ”¹ç»„ç»‡thunk-sçš„æ–¹æ³•ã€‚ ä½†æ˜¯ï¼Œç”±äºè¿™ç§æ–¹æ³•çš„è¿è´¯æ€§å’Œå¤æ‚æ€§ï¼Œå®ƒä»ç„¶æ²¡æœ‰æ¿€å‘äººä»¬çš„ä¿¡å¿ƒã€‚ å°½ç®¡è¿™è§£å†³äº†æµ‹è¯•ä¸­æŒ‡å‡ºçš„é—®é¢˜ï¼Œä½†å¹¶ä¸æƒ³è¿”å›å®ƒã€‚ æœ‰å¿…è¦æå‡ºä¸€äº›æ›´ç®€å•ï¼Œæ›´å¯é çš„å»ºè®®ã€‚ </p><br><h2 id="popytka-resheniya-problemy-3-kto-ischet-tot-naydyot"> å°è¯•è§£å†³é—®é¢˜ç¼–å·3ã€‚ å¯»æ±‚çš„äººä¼šå‘ç° </h2><br><p> å…¨å±€åœ°çœ‹ä¸€ä¸‹å¦‚ä½•ç¼–å†™é’ˆå¯¹thunkçš„æµ‹è¯•ï¼Œæˆ‘æ³¨æ„åˆ°<code>entityModel</code>æ–¹æ³•ï¼ˆå®é™…ä¸Šæ˜¯å¯¹è±¡å­—æ®µï¼‰ <code>entityModel</code>å®¹æ˜“å¹¶ä¸”æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚ </p><br><p> ç„¶åè¿™ä¸ªæƒ³æ³•æµ®å‡ºæ°´é¢ï¼šä¸ºä»€ä¹ˆä¸åˆ›å»ºä¸€ä¸ªç±»ï¼Œè¯¥ç±»çš„æ–¹æ³•å¾ˆç¬¨æ‹™ï¼Œè€ŒåŠ¨ä½œåˆ›å»ºè€…å‘¢ï¼Ÿ ä¼ é€’ç»™å·¥å‚çš„å‚æ•°å°†ä¼ é€’ç»™æ­¤ç±»çš„æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡<code>this</code>è¿›è¡Œè®¿é—®ã€‚ æ‚¨å¯ä»¥ç«‹å³ä¸ºåŠ¨ä½œåˆ›å»ºè€…åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ç±»ï¼Œä¸ºthunkåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ç±»ï¼Œç„¶åä»å¦ä¸€ä¸ªç»§æ‰¿ä¸€ä¸ªï¼Œä»è€Œç«‹å³è¿›è¡Œå°çš„ä¼˜åŒ–ã€‚ å› æ­¤ï¼Œè¿™äº›ç±»å°†ä½œä¸ºä¸€ä¸ªç±»å·¥ä½œï¼ˆåœ¨åˆ›å»ºç»§æ‰¿äººç±»çš„å®ä¾‹æ—¶ï¼‰ï¼Œä½†åŒæ—¶æ¯ä¸ªç±»éƒ½å°†æ›´æ˜“äºé˜…è¯»ï¼Œç†è§£å’Œæµ‹è¯•ã€‚ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™</a>æ˜¯æ¼”ç¤ºæ­¤æ–¹æ³•çš„ä»£ç ã€‚ </p><br><p> è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°è€ƒè™‘å‡ºç°å’Œæ›´æ”¹çš„æ¯ä¸ªæ–‡ä»¶ã€‚ </p><br><ul><li> åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>FilterActionCreators.js</code></a>æ–‡ä»¶ä¸­ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>FilterActionCreators.js</code></a>å£°æ˜ä¸€ä¸ªç±»ï¼Œå…¶ä¸­çš„æ–¹æ³•æ˜¯æ“ä½œåˆ›å»ºè€…ï¼š </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FilterActionCreators</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(config) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.prefix = config.prefix; } applyFilterSuccess = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">payload</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.prefix}</span></span></span><span class="hljs-string">APPLY_FILTER_SUCCESS`</span></span>, payload, }); applyFilterError = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.prefix}</span></span></span><span class="hljs-string">APPLY_FILTER_ERROR`</span></span>, error, }); }</code> </pre> <br><ul><li> åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>FilterActions.js</code></a>æ–‡ä»¶ä¸­ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>FilterActions.js</code></a>ä»<code>FilterActionCreators</code>ç±»ç»§æ‰¿ï¼Œå¹¶å°†thunk <code>applyFilter</code>å®šä¹‰ä¸º<code>applyFilter</code>çš„æ–¹æ³•ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒåŠ¨ä½œ<code>applyFilterSuccess</code>å’Œ<code>applyFilterError</code>å°†é€šè¿‡<code>this</code>åœ¨å…¶ä¸­å¯ç”¨ï¼š </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { FilterActionCreators } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'/FilterActionCreators'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// selector const getFilter = store =&gt; store.filter; export class FilterActions extends FilterActionCreators { constructor(config) { super(config); this.getCurrentStore = config.getCurrentStore; this.entityModel = config.entityModel; } applyFilter = ({ fetchData }) =&gt; { return newFilter =&gt; { return async (dispatch, getStore) =&gt; { try { const store = getStore(); const currentStore = this.getCurrentStore(store); const filter = newFilter || getFilter(currentStore); const { data: { payload } } = await fetchData(filter, dispatch); // Comes from FilterActionCreators dispatch(this.applyFilterSuccess(payload)); } catch (error) { // Comes from FilterActionCreators dispatch(this.applyFilterError(error)); } }; }; }; }</span></span></code> </pre> <br><ul><li> åœ¨åŒ…å«æ‰€æœ‰thunkå’Œaction <code>FilterActions</code>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸»æ–‡ä»¶ä¸­</a> ï¼Œæˆ‘ä»¬åˆ›å»º<code>FilterActions</code>ç±»çš„å®ä¾‹ï¼Œå¹¶å‘<code>FilterActions</code>ä¼ é€’å¿…è¦çš„é…ç½®å¯¹è±¡ã€‚ å¯¼å‡ºå‡½æ•°æ—¶ï¼ˆåœ¨<code>applyFilter</code>å‡½æ•°çš„æœ€åï¼‰ï¼Œä¸è¦å¿˜è®°é‡å†™<code>applyFilter</code>æ–¹æ³•ä»¥å°†<code>fetchData</code>ä¾èµ–é¡¹ä¼ é€’ç»™<code>fetchData</code> ï¼š </li></ul><br><pre> <code class="diff hljs"><span class="hljs-addition"><span class="hljs-addition">+ import { FilterActions } from './filter/actions/FilterActions'; - // selector - const getFilter = store =&gt; store.filter; export const actionsCreator = (prefix, getCurrentStore, entityModel) =&gt; { + const config = { prefix, getCurrentStore, entityModel }; + const filterActions = new FilterActions(config); /* --- ACTIONS BLOCK --- */ function fetchTotalCounterStart() { return { type: `${prefix}FETCH_TOTAL_COUNTER_START` }; } function fetchTotalCounterSuccess(payload) { return { type: `${prefix}FETCH_TOTAL_COUNTER_SUCCESS`, payload }; } function fetchTotalCounterError(error) { return { type: `${prefix}FETCH_TOTAL_COUNTER_ERROR`, error }; } - function applyFilterSuccess(payload) { - return { type: `${prefix}APPLY_FILTER_SUCCESS`, payload }; - } - - function applyFilterError(error) { - return { type: `${prefix}APPLY_FILTER_ERROR`, error }; - } /* --- THUNKS BLOCK --- */ function fetchTotalCounter(filter) { return async dispatch =&gt; { dispatch(fetchTotalCounterStart()); try { const { data: { payload } } = await entityModel.fetchTotalCounter(filter); dispatch(fetchTotalCounterSuccess(payload)); } catch (error) { dispatch(fetchTotalCounterError(error)); } }; } function fetchData(filter, dispatch) { dispatch(fetchTotalCounter(filter)); return entityModel.fetchData(filter); } - function applyFilter(newFilter) { - return async (dispatch, getStore) =&gt; { - try { - const store = getStore(); - const currentStore = getCurrentStore(store); - // 'getFilter' comes from selectors. - const filter = newFilter || getFilter(currentStore); - const { data: { payload } } = await fetchData(filter, dispatch); - - dispatch(applyFilterSuccess(payload)); - } catch (error) { - dispatch(applyFilterError(error)); - } - }; - } return { fetchTotalCounterStart, fetchTotalCounterSuccess, fetchTotalCounterError, - applyFilterSuccess, - applyFilterError, fetchTotalCounter, fetchData, - applyFilter + ...filterActions, + applyFilter: filterActions.applyFilter({ fetchData }), }; };</span></span></code> </pre> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æµ‹è¯•</a>åœ¨å®ç°å’Œé˜…è¯»æ–¹é¢éƒ½å˜å¾—å®¹æ˜“ä¸€äº›ï¼š </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { FilterActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../FilterActions'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'FilterActions'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> prefix = <span class="hljs-string"><span class="hljs-string">'TEST_'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getCurrentStore = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">store</span></span></span><span class="hljs-function"> =&gt;</span></span> store; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> entityModel = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = { prefix, getCurrentStore, entityModel }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FilterActions(config); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dispatch = jest.fn(); beforeEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { dispatch.mockClear(); }); describe(<span class="hljs-string"><span class="hljs-string">'applyFilter'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getStore = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> ({}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newFilter = {}; it(<span class="hljs-string"><span class="hljs-string">'should dispatch correct actions on success'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> payload = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fetchData = jest.fn().mockResolvedValueOnce({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload } }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> applyFilterSuccess = jest.spyOn(actions, <span class="hljs-string"><span class="hljs-string">'applyFilterSuccess'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> actions.applyFilter({ fetchData })(newFilter)(dispatch, getStore); expect(fetchData).toBeCalledWith(newFilter, dispatch); expect(applyFilterSuccess).toBeCalledWith(payload); }); it(<span class="hljs-string"><span class="hljs-string">'should dispatch correct actions on error'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> error = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fetchData = jest.fn().mockRejectedValueOnce(error); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> applyFilterError = jest.spyOn(actions, <span class="hljs-string"><span class="hljs-string">'applyFilterError'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> actions.applyFilter({ fetchData })(newFilter)(dispatch, getStore); expect(fetchData).toBeCalledWith(newFilter, dispatch); expect(applyFilterError).toBeCalledWith(error); }); }); });</code> </pre><br><p> åŸåˆ™ä¸Šï¼Œåœ¨æµ‹è¯•ä¸­ï¼Œæ‚¨å¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼æ›¿æ¢æœ€åä¸€ä¸ªæ£€æŸ¥ï¼š </p><br><pre> <code class="diff hljs"><span class="hljs-deletion"><span class="hljs-deletion">- expect(applyFilterSuccess).toBeCalledWith(payload); + expect(dispatch).toBeCalledWith(applyFilterSuccess(payload)); - expect(applyFilterError).toBeCalledWith(error); + expect(dispatch).toBeCalledWith(applyFilterError(error));</span></span></code> </pre> <br><p> è¿™æ ·å°±ä¸éœ€è¦ç”¨<code>jest.spyOn</code>å®ƒä»¬äº†ã€‚    ,  ,            .        thunk,       .    ,    ... </p><br><p>    ,  ,    ,     -: ,  thunk-  action creator-      ,    ,   .        ,   .         <code>actionsCreator</code> -   ,   : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { FilterActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./filter/actions/FilterActions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { TemplatesActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./templates/actions/TemplatesActions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { TableActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./table/actions/TableActions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionsCreator = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">prefix, getCurrentStore, entityModel</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = { prefix, getCurrentStore, entityModel }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filterActions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FilterActions(config); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> templatesActions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TemplatesActions(config); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tableActions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TableActions(config); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...filterActions, ...templatesActions, ...tableActions, }; };</code> </pre> <br><p>     .     <code>filterActions</code>          <code>templatesActions</code>  <code>tableActions</code> ,   ,   ,     <code>filterActions</code> ?           ,    .           .         - ,      ,    . </p><br><p>   .      ,     back-end  (  Java),      .   ,  Java/Spring      ,   .         - ? </p><br><p>      : </p><br><ul><li>    thunk-   <code>setDependencies</code> ,        â€” <code>dependencies</code> : </li></ul><br><pre> <code class="diff hljs">export class FilterActions extends FilterActionCreators { constructor(config) { super(config); this.getCurrentStore = config.getCurrentStore; this.entityModel = config.entityModel; } + setDependencies = dependencies =&gt; { + this.dependencies = dependencies; + };</code> </pre> <br><ul><li>                     : </li></ul><br><pre> <code class="diff hljs">import { FilterActions } from './filter/actions/FilterActions'; import { TemplatesActions } from './templates/actions/TemplatesActions'; import { TableActions } from './table/actions/TableActions'; export const actionsCreator = (prefix, getCurrentStore, entityModel) =&gt; { const config = { prefix, getCurrentStore, entityModel }; const filterActions = new FilterActions(config); const templatesActions = new TemplatesActions(config); const tableActions = new TableActions(config); + const actions = { + ...filterActions, + ...templatesActions, + ...tableActions, + }; + + filterActions.setDependencies(actions); + templatesActions.setDependencies(actions); + tableActions.setDependencies(actions); + return actions; - return { - ...filterActions, - ...templatesActions, - ...tableActions, - }; };</code> </pre> <br><ul><li>     <code>this.dependencies</code> : </li></ul><br><pre> <code class="javascript hljs">applyFilter = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newFilter</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { fetchData } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dependencies; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (dispatch, getStore) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = getStore(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> currentStore = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getCurrentStore(store); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filter = newFilter || getFilter(currentStore); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload } } = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> fetchData(filter, dispatch); <span class="hljs-comment"><span class="hljs-comment">// Comes from FilterActionCreators dispatch(this.applyFilterSuccess(payload)); } catch (error) { // Comes from FilterActionCreators dispatch(this.applyFilterError(error)); } }; };</span></span></code> </pre> <br><p>    ,        <code>applyFilter</code>   ,   -  <code>this.dependencies</code>    .         ,         . </p><br><ul><li>   : </li></ul><br><pre> <code class="diff hljs">import { FilterActions } from '../FilterActions'; describe('FilterActions', () =&gt; { const prefix = 'TEST_'; const getCurrentStore = store =&gt; store; const entityModel = {}; + const dependencies = { + fetchData: jest.fn(), + }; const config = { prefix, getCurrentStore, entityModel }; const actions = new FilterActions(config); + actions.setDependencies(dependencies); const dispatch = jest.fn(); beforeEach(() =&gt; { dispatch.mockClear(); }); describe('applyFilter', () =&gt; { const getStore = () =&gt; ({}); const newFilter = {}; it('should dispatch correct actions on success', async () =&gt; { const payload = {}; - const fetchData = jest.fn().mockResolvedValueOnce({ data: { payload } }); + dependencies.fetchData.mockResolvedValueOnce({ data: { payload } }); const applyFilterSuccess = jest.spyOn(actions, 'applyFilterSuccess'); - await actions.applyFilter({ fetchData })(newFilter)(dispatch, getStore); + await actions.applyFilter(newFilter)(dispatch, getStore); - expect(fetchData).toBeCalledWith(newFilter, dispatch); + expect(dependencies.fetchData).toBeCalledWith(newFilter, dispatch); expect(applyFilterSuccess).toBeCalledWith(payload); }); it('should dispatch correct actions on error', async () =&gt; { const error = {}; - const fetchData = jest.fn().mockRejectedValueOnce(error); + dependencies.fetchData.mockRejectedValueOnce(error); const applyFilterError = jest.spyOn(actions, 'applyFilterError'); - await actions.applyFilter({ fetchData })(newFilter)(dispatch, getStore); + await actions.applyFilter(newFilter)(dispatch, getStore); - expect(fetchData).toBeCalledWith(newFilter, dispatch); + expect(dependencies.fetchData).toBeCalledWith(newFilter, dispatch); expect(applyFilterError).toBeCalledWith(error); }); }); });</code> </pre> <br><p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a> . </p><br><p>       ,   ,            : </p><br><ul><li>   : </li></ul><br><pre> <code class="diff hljs">import { FilterActions } from './filter/actions/FilterActions'; import { TemplatesActions } from './templates/actions/TemplatesActions'; import { TableActions } from './table/actions/TableActions'; - export const actionsCreator = (prefix, getCurrentStore, entityModel) =&gt; { + export const actionsCreator = (prefix, getCurrentStore, entityModel, ExtendedActions) =&gt; { const config = { prefix, getCurrentStore, entityModel }; const filterActions = new FilterActions(config); const templatesActions = new TemplatesActions(config); const tableActions = new TableActions(config); + const extendedActions = ExtendedActions ? new ExtendedActions(config) : undefined; const actions = { ...filterActions, ...templatesActions, ...tableActions, + ...extendedActions, }; filterActions.setDependencies(actions); templatesActions.setDependencies(actions); tableActions.setDependencies(actions); + if (extendedActions) { + extendedActions.setDependencies(actions); + } return actions; };</code> </pre> <br><ul><li>   <code>ExtendedActions</code>    ,     : </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExtendedActions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(config) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getCurrentStore = config.getCurrentStore; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.entityModel = config.entityModel; } setDependencies = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dependencies</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dependencies = dependencies; }; <span class="hljs-comment"><span class="hljs-comment">// methods to re-define }</span></span></code> </pre> <br><p>  ,    ,   : </p><br><ul><li>    ,     . </li><li>      . </li><li>     ,   ,     thunk-         . </li><li>   ,      ,   thunk-/action creator-      99-100%. </li></ul><br><h2 id="bonus">  </h2><br><p>   action creator-     ( <code>filter</code> , <code>templates</code> , <code>table</code> ),   reducer-   -  ,        ,    <code>actionsCreator</code> - ,         reducer-  ~400-500  . </p><br><p>      : </p><br><ul><li>   reducer-: </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> isNull <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash/isNull'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { getDefaultState } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../getDefaultState'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { templatesReducerConfigurator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'src/store/templates/reducers/templatesReducerConfigurator'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { filterReducerConfigurator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'src/store/filter/reducers/filterReducerConfigurator'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { tableReducerConfigurator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'src/store/table/reducers/tableReducerConfigurator'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createTableReducer = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> prefix, initialState = getDefaultState(</span></span></span><span class="hljs-function">), </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entityModel</span></span></span><span class="hljs-function">, ) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = { prefix, initialState, entityModel }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> templatesReducer = templatesReducerConfigurator(config); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filterReducer = filterReducerConfigurator(config); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tableReducer = tableReducerConfigurator(config); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = initialState, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> templatesState = templatesReducer(state, action); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isNull(templatesState)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> templatesState; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filterState = filterReducer(state, action); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isNull(filterState)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> filterState; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tableState = tableReducer(state, action); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isNull(tableState)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tableState; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; }; };</code> </pre> <br><ul><li> <code>tableReducerConfigurator</code> ( ): </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tableReducerConfigurator = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ prefix, entityModel }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_START`</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">isLoading</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, }; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_SUCCESS`</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">isLoading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">counter</span></span>: action.payload, }; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_ERROR`</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">isLoading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: action.error, }; } <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }; };</code> </pre> <br><p>  : </p><br><ol><li>   <code>reducerConfigurator</code> -    action type-,   Â«Â».  action type      case,    <em>null</em> (). </li><li>   <code>reducerConfigurator</code> -      ,  <em>null</em> ,     <code>reducerConfigurator</code> -  <em>!null</em> .    ,    <code>reducerConfigurator</code> -   case,      <code>reducerConfigurator</code> -. </li><li>   ,      <code>reducerConfigurator</code> -    case-   action type-,     (  reducer-). </li></ol><br><p>    ,    <code>actionsCreator</code> -,     ,      ,  ,  . </p><br><p>   ,   ! <br> ,             Redux Thunk. </p><br><p>   ,    Redux Thunk      .   ,    . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN469371/">https://habr.com/ru/post/zh-CN469371/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN469355/index.html">æ— èŠçš„NumPyæ•™ç¨‹</a></li>
<li><a href="../zh-CN469357/index.html">å¿«è·‘ï¼Œåœ°é¼ ï¼Œå¿«è·‘ï¼ -æˆ‘ä»¬å°†åœ¨GolangConfä¸Šè°ˆè®ºä»€ä¹ˆ</a></li>
<li><a href="../zh-CN469361/index.html">ç–¼ç—›å’Œçœ¼æ³ªåœ¨Svelte 3</a></li>
<li><a href="../zh-CN469367/index.html">åœ¨Windowsä¸‹çš„STM32CubeIDEä¸­æœ¬åœ°è¿è¡Œå•å…ƒæµ‹è¯•</a></li>
<li><a href="../zh-CN469369/index.html">9æœˆ30æ—¥è‡³10æœˆ6æ—¥åœ¨è«æ–¯ç§‘ä¸¾è¡Œçš„æ•°å­—æ´»åŠ¨</a></li>
<li><a href="../zh-CN469373/index.html">ä¸ºå®Œå…¨ç˜«ç—ªæ‚£è€…åˆ›å»ºç¥ç»æ¥å£çš„é¡¹ç›®ç»“æœä»¤äººè´¨ç–‘</a></li>
<li><a href="../zh-CN469375/index.html">ä¸ºä»€ä¹ˆMozillaï¼ŒCoilå’ŒCreative Commonsä¸ºå¼€æºé¡¹ç›®åˆ†é…1äº¿ç¾å…ƒï¼Ÿ</a></li>
<li><a href="../zh-CN469379/index.html">å½¢å¼åŒ–æ¨¡å‹éªŒè¯æ–¹æ³•åœ¨UIä¸­çš„åº”ç”¨</a></li>
<li><a href="../zh-CN469381/index.html">ç‹¬è‡ªåˆ›å»ºä¸€ä¸ªå¤šç”¨æˆ·æ¸¸æˆæœåŠ¡å™¨ã€‚ å»ºç­‘ä¸å®‰è£…</a></li>
<li><a href="../zh-CN469383/index.html">è¶…èåˆè§£å†³æ–¹æ¡ˆAERODISK vAIRã€‚ åŸºç¡€-ARDFSæ–‡ä»¶ç³»ç»Ÿ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>