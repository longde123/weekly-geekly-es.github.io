<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíè üñáÔ∏è üßìüèº Toute la v√©rit√© sur RTOS. Article # 22. Bo√Ætes aux lettres: services auxiliaires et structures de donn√©es üë®üèΩ‚Äçüöí üéª üè•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article poursuit l'examen des bo√Ætes aux lettres qui a commenc√© dans l'article pr√©c√©dent de la s√©rie ¬´La v√©rit√© sur RTOS¬ª. 

 Articles pr√©c√©dents ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Toute la v√©rit√© sur RTOS. Article # 22. Bo√Ætes aux lettres: services auxiliaires et structures de donn√©es</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431118/"><img src="https://habrastorage.org/webt/j-/7m/ne/j-7mne20kyhq0wia5-mxp4lotsq.jpeg"><br><br>  Cet article poursuit l'examen des bo√Ætes aux lettres qui a commenc√© dans l'article pr√©c√©dent de la s√©rie ¬´La v√©rit√© sur RTOS¬ª. <br><a name="habracut"></a><br>  Articles pr√©c√©dents de la s√©rie: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 21.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bo√Ætes aux lettres: introduction et services de base</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 20.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">S√©maphores: services auxiliaires et structures de donn√©es</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 19.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">S√©maphores: introduction et services de base</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 18.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Groupes d'indicateurs d'√©v√©nements: services d'assistance et structures de donn√©es</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 17.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Groupes de drapeaux d'√©v√©nements: introduction et services de base</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 16.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Signaux</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 15.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partitions de m√©moire: services et structures de donn√©es</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 14.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sections de m√©moire: introduction et services de base</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 13.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Structures de donn√©es de t√¢che et appels d'API non pris en charge</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 12.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Services pour travailler avec des t√¢ches</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 11.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">T√¢ches: configuration et introduction √† l'API</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 10.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Scheduler: fonctionnalit√©s avanc√©es et pr√©servation du contexte</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 9.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Scheduler: impl√©mentation</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 8.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nucleus SE: conception interne et d√©ploiement</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 7.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nucleus SE: Introduction</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 6.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Autres services RTOS</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 5.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Interaction et synchronisation des t√¢ches</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">T√¢ches, changement de contexte et interruptions</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">T√¢ches et planification</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RTOS: Structure et mode temps r√©el</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RTOS: introduction.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><br></a> <br><br><h2>  Services auxiliaires de bo√Ætes aux lettres </h2><br>  Nucleus RTOS dispose de quatre appels d'API qui fournissent des fonctions auxiliaires li√©es aux bo√Ætes aux lettres: vidage d'une bo√Æte aux lettres, r√©cup√©ration d'informations sur une bo√Æte aux lettres, r√©cup√©ration du nombre de bo√Ætes aux lettres dans une application et r√©cup√©ration de pointeurs vers toutes les bo√Ætes aux lettres d'une application.  Les trois premi√®res de ces fonctionnalit√©s sont impl√©ment√©es dans Nucleus SE. <br><br><h3>  R√©initialisation de la bo√Æte aux lettres </h3><br>  Cet appel de service API r√©initialise la bo√Æte aux lettres √† son √©tat initial non utilis√©.  Le message stock√© dans la bo√Æte aux lettres sera perdu.  Toutes les t√¢ches suspendues sur la bo√Æte aux lettres reprendront avec le code retour <b>NUSE_MAILBOX_WAS_RESET</b> . <br><br>  <b><i>Appel pour r√©initialiser une bo√Æte aux lettres dans Nucleus RTOS</i></b> <br>  Prototype d'appel de service: <br>  <b>STATUS NU_Reset_Mailbox (bo√Æte aux lettres NU_MAILBOX *);</b> <br><br>  Param√®tres: <br>  <b>bo√Æte aux lettres</b> - un pointeur vers l'unit√© de contr√¥le de bo√Æte aux lettres. <br><br>  Valeur de retour: <br>  <b>NU_SUCCESS</b> - l'appel s'est termin√© avec succ√®s; <br>  <b>NU_INVALID_MAILBOX</b> - pointeur de bo√Æte aux lettres non valide. <br><br>  <b><i>Appel pour r√©initialiser une bo√Æte aux lettres dans Nucleus SE</i></b> <br>  Cet appel de service d'API prend en charge la fonctionnalit√© de base de l'API Nucleus RTOS. <br><br>  Prototype d'appel de service: <br>  <b>STATUS NUSE_Mailbox_Reset (bo√Æte aux lettres NUSE_MAILBOX);</b> <br><br>  Param√®tres: <br>  <b>bo√Æte aux lettres</b> - index (ID) de la bo√Æte aux lettres vid√©e. <br><br>  <b>Valeur de retour:</b> <br>  <b>NUSE_SUCCESS</b> - l'appel s'est termin√© avec succ√®s; <br>  <b>NUSE_INVALID_MAILBOX</b> - index de bo√Æte aux lettres non valide. <br><br>  <b><i>Impl√©menter la r√©initialisation de la bo√Æte aux lettres dans Nucleus SE</i></b> <br>  Le code d'option pour la fonction <b>NUSE_Mailbox_Reset</b> (apr√®s v√©rification des param√®tres) est s√©lectionn√© √† l'aide de la compilation conditionnelle, selon que la prise en charge des t√¢ches de blocage (pause) est activ√©e ou non.  Nous consid√©rerons ces deux options. <br><br>  Si le verrou n'est pas activ√©, le code de cette fonction API est assez simple.  La bo√Æte aux lettres est marqu√©e comme inutilis√©e en d√©finissant le param√®tre <b>NUSE_Mailbox_Status []</b> sur <b>FALSE</b> . <br><br>  Si le verrou est activ√©, le code devient plus complexe: <br><br><pre><code class="plaintext hljs">while (NUSE_Mailbox_Blocking_Count[mailbox] != 0) { U8 index; /* check whether any tasks are blocked */ /* on this mailbox */ for (index=0; index&lt;NUSE_TASK_NUMBER; index++) { if ((LONIB(NUSE_Task_Status[index]) == NUSE_MAILBOX_SUSPEND) &amp;&amp; (HINIB(NUSE_Task_Status[index]) == mailbox)) { NUSE_Task_Blocking_Return[index] = NUSE_MAILBOX_WAS_RESET; NUSE_Task_Status[index] = NUSE_READY; break; } } NUSE_Mailbox_Blocking_Count[mailbox]--; } #if NUSE_SCHEDULER_TYPE == NUSE_PRIORITY_SCHEDULER NUSE_Reschedule(NUSE_NO_TASK); #endif</code> </pre> <br>  La bo√Æte aux lettres est r√©initialis√©e √† l'√©tat ¬´Vide¬ª. <br><br>  Chaque t√¢che suspendue dans la bo√Æte aux lettres se voit attribuer le statut ¬´Pr√™t¬ª avec le code retour <b>NUSE_MAILBOX_WAS_RESET</b> .  Une fois ce processus termin√©, si le planificateur de priorit√© est utilis√©, l'appel de service <b>NUSE_Reschedule ()</b> est <b>effectu√©</b> , car une ou plusieurs t√¢ches avec une priorit√© plus √©lev√©e peuvent devenir pr√™tes et attendre la permission de s'ex√©cuter. <br><br><h3>  R√©cup√©ration des informations de bo√Æte aux lettres </h3><br>  Cet appel de service fournit un ensemble d'informations sur la bo√Æte aux lettres.  L'impl√©mentation de cet appel dans Nucleus SE diff√®re de Nucleus RTOS en ce qu'il renvoie moins d'informations, car la d√©nomination des objets et l'ordre de pause ne sont pas pris en charge et la pause de t√¢che peut √™tre d√©sactiv√©e. <br><br>  <b><i>Appelez pour obtenir des informations sur la bo√Æte aux lettres Nucleus RTOS</i></b> <br>  Cet appel d'API prend en charge la fonctionnalit√© principale de l'API Nucleus RTOS. <br><br>  Prototype d'appel de service: <br>  <b>STATUS NU_Mailbox_Information (bo√Æte aux lettres NU_MAILBOX *, nom CHAR *, OPTION * suspend_type, DATA_ELEMENT * message_present, UNSIGNED * tasks_waiting, NU_TASK ** first_task);</b> <br><br>  Param√®tres: <br><br>  <b>bo√Æte aux lettres</b> - pointeur vers l'unit√© de commande de bo√Æte aux lettres; <br>  <b>nom</b> - un pointeur de 8 caract√®res sur le nom de la bo√Æte aux lettres.  L'octet nul de fin est √©galement inclus dans cette zone; <br>  <b>suspend_type</b> - pointeur sur la variable dans laquelle le type de suspension de la t√¢che est stock√©.  Il peut prendre les valeurs <b>NU_FIFO</b> et <b>NU_PRIORITY</b> ; <br>  <b>message_present</b> - un pointeur vers une variable qui prendra la valeur <b>NU_TRUE</b> ou <b>NU_FALSE</b> , selon que la bo√Æte aux lettres est pleine ou non; <br>  <b>tasks_waiting</b> - un pointeur sur une variable qui prendra le nombre de t√¢ches suspendues sur cette bo√Æte aux lettres; <br>  <b>first_task</b> - un pointeur vers un pointeur de t√¢che qui prendra un pointeur vers la premi√®re t√¢che suspendue. <br><br>  Valeur de retour: <br><br>  <b>NU_SUCCESS</b> - l'appel s'est termin√© avec succ√®s; <br>  <b>NU_INVALID_MAILBOX</b> - pointeur de bo√Æte aux lettres non valide. <br><br>  <b><i>Appelez pour obtenir des informations sur la bo√Æte aux lettres Nucleus SE</i></b> <br>  Cet appel de service d'API prend en charge la fonctionnalit√© de base de l'API Nucleus RTOS. <br><br>  Prototype d'appel de service: <br><br>  <b>STATUS NUSE_Mailbox_Information (bo√Æte aux lettres NUSE_MAILBOX, U8 * message_present, U8 * tasks_waiting, NUSE_TASK * first_task);</b> <br><br>  Param√®tres: <br><br>  <b>bo√Æte aux lettres</b> - index de la bo√Æte aux lettres pour laquelle des informations sont demand√©es; <br>  <b>message_present</b> - un pointeur vers une variable qui prend la valeur <b>TRUE</b> ou <b>FALSE</b> , selon que la bo√Æte aux lettres est pleine ou non; <br>  <b>tasks_waiting</b> - un pointeur sur une variable qui prendra le nombre de t√¢ches suspendues sur cette bo√Æte aux lettres (rien n'est retourn√© si la suspension des t√¢ches est d√©sactiv√©e); <br>  <b>first_task</b> - un pointeur vers une variable de type <b>NUSE_TASK</b> , qui prendra l'index de la premi√®re t√¢che suspendue (rien n'est retourn√© si la suspension de la t√¢che est d√©sactiv√©e). <br><br>  Valeur de retour: <br><br>  <b>NUSE_SUCCESS</b> - l'appel s'est termin√© avec succ√®s; <br>  <b>NUSE_INVALID_MAILBOX</b> - index de bo√Æte aux lettres non valide; <br>  <b>NUSE_INVALID_POINTER</b> - un ou plusieurs param√®tres de pointeur sont incorrects. <br><br>  <b><i>Impl√©mentation des informations de bo√Æte aux lettres dans Nucleus SE</i></b> <br><br>  L'impl√©mentation de cet appel API est assez simple: <br><br><pre> <code class="plaintext hljs">*message_present = NUSE_Mailbox_Status[mailbox]; #if NUSE_BLOCKING_ENABLE *tasks_waiting = NUSE_Mailbox_Blocking_Count[mailbox]; if (NUSE_Mailbox_Blocking_Count[mailbox] != 0) { U8 index; for (index=0; index&lt;NUSE_TASK_NUMBER; index++) { if ((LONIB(NUSE_Task_Status[index]) == NUSE_MAILBOX_SUSPEND) &amp;&amp; (HINIB(NUSE_Task_Status[index]) == mailbox)) { *first_task = index; break; } } } else { *first_task = 0; } #else *tasks_waiting = 0; *first_task = 0; #endif return NUSE_SUCCESS;</code> </pre><br>  La fonction renvoie l'√©tat de la bo√Æte aux lettres.  Ensuite, si des appels de service pour bloquer des t√¢ches sont activ√©s, le nombre de t√¢ches suspendues et l'index de la premi√®re sont renvoy√©s (sinon, ces param√®tres sont d√©finis sur 0). <br><br><h3>  Obtenir le nombre de bo√Ætes aux lettres </h3><br>  Cet appel d'utilitaire renvoie le nombre de bo√Ætes aux lettres dans l'application.  Alors que dans Nucleus RTOS, leur nombre peut changer au fil du temps, et la valeur de retour montrera le nombre actuel de bo√Ætes aux lettres, dans Nucleus SE, le nombre de bo√Ætes aux lettres est d√©fini au stade de la construction et ne peut pas √™tre modifi√©. <br><br>  <b><i>Appel d'un compteur de bo√Ætes aux lettres dans Nucleus RTOS</i></b> <br>  Cet appel d'API prend en charge la fonctionnalit√© principale de l'API Nucleus RTOS. <br><br>  Prototype d'appel de service: <br>  <b>UNSIGNED NU_Established_Mailboxes (VOID);</b> <br><br>  Param√®tres: <br>  Sont absents. <br><br>  Valeur de retour: <br>  Le nombre de bo√Ætes aux lettres cr√©√©es dans l'application. <br><br>  <b><i>Appel d'un compteur de bo√Ætes aux lettres dans Nucleus SE</i></b> <br>  Cet appel d'API prend en charge la fonctionnalit√© principale de l'API Nucleus RTOS. <br><br>  Prototype d'appel de service: <br>  <b>U8 NUSE_Mailbox_Count (void);</b> <br><br>  Param√®tres: <br>  Sont absents. <br><br>  Valeur de retour: <br>  Nombre de bo√Ætes aux lettres configur√©es dans l'application. <br><br>  <b><i>Impl√©mentation d'un compteur de bo√Ætes aux lettres dans Nucleus SE</i></b> <br>  L'impl√©mentation de cet appel API est extr√™mement simple: la valeur de la directive <b>#define</b> <b>NUSE_MAILBOX_NUMBER</b> est <b>retourn√©e</b> . <br><br><h2>  Structures de donn√©es </h2><br>  Les bo√Ætes aux lettres utilisent deux ou trois tableaux de structures de donn√©es (toutes situ√©es dans la RAM), qui, comme les autres objets Nucleus SE, sont un ensemble de tables dont la taille d√©pend du nombre de bo√Ætes aux lettres configur√©es et de leurs param√®tres. <br><br>  Je recommande fortement que le code d'application n'utilise pas un acc√®s direct √† ces structures de donn√©es, mais s'y r√©f√®re via les fonctions API fournies.  Cela √©vite l'incompatibilit√© avec les futures versions de Nucleus SE et les effets secondaires ind√©sirables, et simplifie √©galement le portage de l'application vers Nucleus RTOS.  Ce qui suit est un aper√ßu d√©taill√© des structures de donn√©es pour une meilleure compr√©hension du fonctionnement du code d'appel de service et pour le d√©bogage. <br><br><h3>  Donn√©es RAM </h3><br>  Ces donn√©es ont la structure suivante: <br><br>  <b>NUSE_Mailbox_Data []</b> - un tableau de type <b>ADDR</b> , qui a une entr√©e pour chaque bo√Æte aux lettres configur√©e, il stocke les donn√©es de bo√Æte aux lettres. <br>  <b>NUSE_Mailbox_Status []</b> est un tableau <b>U8</b> qui a une entr√©e pour chaque bo√Æte aux lettres configur√©e, il surveille l'utilisation des bo√Ætes aux lettres.  Une valeur non nulle ( <b>TRUE</b> ) indique que la bo√Æte aux lettres est pleine. <br>  <b>NUSE_Mailbox_Blocking_Count []</b> - un tableau de type <b>U8</b> , il contient un compteur de t√¢ches bloqu√©es pour chaque bo√Æte aux lettres.  Ce tableau est cr√©√© uniquement si la fonctionnalit√© de blocage d'appels API est activ√©e. <br><br>  Ces structures de donn√©es sont initialis√©es avec des z√©ros dans la fonction <b>NUSE_Init_Mailbox () au</b> d√©marrage de Nucleus SE.  C'est logique, car chaque bo√Æte aux lettres est cr√©√©e vide (inutilis√©e). <br><br>  Voici les d√©finitions de ces structures de donn√©es du fichier <b>nuse_init.c</b> . <br><br><pre> <code class="plaintext hljs">RAM ADDR NUSE_Mailbox_Data[NUSE_MAILBOX_NUMBER]; RAM U8 NUSE_Mailbox_Status[NUSE_MAILBOX_NUMBER]; #if NUSE_BLOCKING_ENABLE RAM U8 NUSE_Mailbox_Blocking_Count[NUSE_MAILBOX_NUMBER]; #endif</code> </pre><br><h3>  Donn√©es ROM </h3><br>  Pour l'impl√©mentation des bo√Ætes aux lettres, les donn√©es en ROM ne sont pas utilis√©es. <br><br><h3>  La quantit√© de m√©moire pour les bo√Ætes aux lettres </h3><br>  Comme pour tous les objets du noyau Nucleus SE, la quantit√© de m√©moire requise pour les bo√Ætes aux lettres est connue √† l'avance. <br><br>  La quantit√© de m√©moire pour les donn√©es dans la ROM pour toutes les bo√Ætes aux lettres de l'application est de 0. <br><br>  La quantit√© de donn√©es dans la RAM pour toutes les bo√Ætes aux lettres de l'application (en octets) avec des appels d'API activ√©s pour bloquer les t√¢ches peut √™tre calcul√©e comme suit: <br>  <b>NUSE_MAILBOX_NUMBER * (taille de (ADDR) +2)</b> <br><br>  Sinon: <br>  <b>NUSE_MAILBOX_NUMBER * (taille de (ADDR) +1)</b> <br><br><h2>  Appels d'API non r√©alis√©s </h2><br>  Les quatre appels d'utilitaires disponibles dans Nucleus RTOS ne sont pas impl√©ment√©s dans Nucleus SE. <br><br><h3>  Cr√©er une bo√Æte aux lettres </h3><br>  Cet appel de service API cr√©e une bo√Æte aux lettres.  Nucleus SE n'en a pas besoin, car les bo√Ætes aux lettres sont cr√©√©es statiquement. <br><br>  Prototype d'appel de service: <br>  <b>STATUS NU_Create_Mailbox (bo√Æte aux lettres NU_MAILBOX *, nom CHAR *, UNSIGNED OPTION suspend_type);</b> <br><br>  Param√®tres: <br><br>  <b>bo√Æte aux lettres</b> - un pointeur vers l'unit√© de commande de bo√Æte aux lettres fourni par l'utilisateur;  Utilis√© pour g√©rer les bo√Ætes aux lettres dans d'autres appels d'API <br>  <b>nom</b> - pointeur vers le <b>nom</b> √† 7 caract√®res de la bo√Æte aux lettres avec z√©ro octet de fin; <br>  <b>suspend_type</b> - Indique le principe de la suspension d'une t√¢che sur une bo√Æte aux lettres.  Il peut prendre les valeurs <b>NU_FIFO</b> et <b>NU_PRIORITY</b> , qui d√©signent respectivement le principe de FIFO (First-In-First-Out) ou le principe de priorit√© de suspension des t√¢ches. <br><br>  Valeur de retour: <br><br>  <b>NU_SUCCESS</b> - l'appel s'est termin√© avec succ√®s; <br>  <b>NU_INVALID_MAILBOX</b> - pointeur nul vers l'unit√© de contr√¥le de bo√Æte aux lettres ( <b>NULL</b> ), ou le pointeur est d√©j√† utilis√©; <br>  <b>NU_INVALID_SUSPEND</b> - param√®tre <b>suspend_type</b> non <b>valide</b> . <br><br><h3>  Supprimer une bo√Æte aux lettres </h3><br>  Cet appel de service API supprime une bo√Æte aux lettres cr√©√©e pr√©c√©demment.  Nucleus SE n'en a pas besoin, car les bo√Ætes aux lettres sont cr√©√©es statiquement et ne peuvent pas √™tre supprim√©es. <br><br>  Prototype d'appel de service: <br><br>  <b>STATUS NU_Delete_Mailbox (bo√Æte aux lettres NU_MAILBOX *);</b> <br><br>  Param√®tres: <br><br>  <b>bo√Æte aux lettres</b> - un pointeur vers l'unit√© de contr√¥le de bo√Æte aux lettres. <br><br>  Valeur de retour: <br><br>  <b>NU_SUCCESS</b> - l'appel s'est termin√© avec succ√®s; <br>  <b>NU_INVALID_MAILBOX</b> - pointeur de bo√Æte aux lettres non valide. <br><br><h3>  Pointeurs de bo√Æte aux lettres </h3><br>  Cet appel d'API constitue une liste s√©quentielle de pointeurs vers toutes les bo√Ætes aux lettres du syst√®me.  Nucleus SE n'en a pas besoin, car les bo√Ætes aux lettres sont identifi√©es par un simple index, et non par un pointeur. <br><br>  Prototype d'appel de service: <br><br>  <b>UNSIGNED NU_Mailbox_Pointers (NU_MAILBOX ** pointer_list, UNSIGNED maximum_pointers);</b> <br><br>  Param√®tres: <br><br>  <b>pointer_list</b> - pointeur vers un tableau de pointeurs <b>NU_MAILBOX</b> ;  ce tableau sera rempli de pointeurs vers des bo√Ætes aux lettres cr√©√©es dans le syst√®me; <br>  <b>maximum_pointers</b> - le nombre maximum de pointeurs dans le tableau. <br><br>  Valeur de retour: <br><br>  Nombre de pointeurs <b>NU_MAILBOX</b> dans le tableau. <br><br><h3>  Enregistrer un message dans la bo√Æte aux lettres pour distribution √† tous les destinataires </h3><br>  Cet appel de service envoie un message √† toutes les t√¢ches qui attendent des messages d'une bo√Æte aux lettres sp√©cifique.  Dans Nucleus SE, cet appel d'utilitaire n'est pas impl√©ment√©, car il ajouterait une complexit√© inutile. <br><br>  Prototype d'appel de service: <br><br>  <b>STATUS NU_Broadcast_To_Mailbox (bo√Æte aux lettres NU_MAILBOX *, message VOID *, suspension UNSIGNED);</b> <br><br>  Param√®tres: <br><br>  <b>bo√Æte aux lettres</b> - pointeur vers l'unit√© de commande de bo√Æte aux lettres; <br>  <b>message</b> - pointeur vers le message transmis; <br>  <b>suspend</b> - indique s'il faut suspendre la t√¢che d'appel si la bo√Æte aux lettres contient d√©j√† un message;  peut √™tre <b>NU_NO_SUSPEND</b> , <b>NU_SUSPEND</b> ou une valeur de d√©lai d'expiration. <br><br>  Valeur de retour: <br><br>  <b>NU_SUCCESS</b> - l'appel s'est termin√© avec succ√®s; <br>  <b>NU_INVALID_MAILBOX</b> - pointeur de bo√Æte aux lettres non valide; <br>  <b>NU_INVALID_POINTER</b> - pointeur nul vers un message ( <b>NULL</b> ); <br>  <b>NU_INVALID_SUSPEND</b> - tentative de suspension √† partir d'un thread non li√© √† une t√¢che; <br>  <b>NU_MAILBOX_FULL</b> - la bo√Æte aux lettres contient d√©j√† un message; <br>  <b>NU_TIMEOUT</b> - une fois le d√©lai expir√©, la bo√Æte aux lettres est toujours pleine; <br>  <b>NU_MAILBOX_DELETED</b> - La bo√Æte aux lettres a √©t√© supprim√©e lors de la suspension de la t√¢che. <br>  <b>NU_MAILBOX_RESET</b> - la bo√Æte aux lettres a √©t√© r√©initialis√©e alors que la t√¢che a √©t√© suspendue. <br><br><h2>  Compatible avec Nucleus RTOS </h2><br>  Comme pour tous les autres objets Nucleus SE, mon objectif √©tait de maximiser la compatibilit√© du code d'application avec Nucleus RTOS.  Les bo√Ætes aux lettres ne font pas exception et, du point de vue de l'utilisateur, elles sont impl√©ment√©es de la m√™me mani√®re que dans Nucleus RTOS.  Il y a aussi une certaine incompatibilit√©, que j'ai jug√©e acceptable √©tant donn√© qu'en cons√©quence, le code deviendra plus compr√©hensible et plus efficace en termes de quantit√© de m√©moire requise.  Sinon, les appels d'API Nucleus RTOS peuvent √™tre directement port√©s vers Nucleus SE. <br><br><h3>  Identificateurs d'objet </h3><br>  Dans Nucleus RTOS, tous les objets sont d√©crits par des structures de donn√©es (unit√©s de contr√¥le) d'un type sp√©cifique.  Un pointeur vers cette unit√© de contr√¥le sert d‚Äôidentifiant √† la bo√Æte aux lettres.  J'ai d√©cid√© que dans Nucleus SE, une approche diff√©rente est n√©cessaire pour une utilisation efficace de la m√©moire: tous les objets du noyau sont d√©crits par un ensemble de tables en RAM et / ou ROM.  La taille de ces tables est d√©termin√©e par le nombre d'objets configur√©s de chaque type.  L'identifiant d'un objet particulier est l'index dans ce tableau.  J'ai donc d√©fini <b>NUSE_MAILBOX</b> comme l'√©quivalent de <b>U8</b> , une variable (pas un pointeur) de ce type sert d'identifiant de la bo√Æte aux lettres.  Cette l√©g√®re incompatibilit√© est facile √† g√©rer si le code est port√© de Nucleus SE vers Nucleus RTOS et vice versa.  En r√®gle g√©n√©rale, aucune op√©ration n'est effectu√©e sur les identificateurs d'objet autres que le d√©placement et le stockage. <br><br>  Nucleus RTOS prend √©galement en charge la d√©nomination des bo√Ætes aux lettres.  Ces noms sont utilis√©s uniquement pour le d√©bogage.  Je les ai exclus de Nucleus SE pour √©conomiser de la m√©moire. <br><br><h3>  Taille et type du message </h3><br>  Dans Nucleus RTOS, un message de bo√Æte aux lettres se compose de quatre mots de 32 bits.  Dans Nucleus SE, j'ai d√©cid√© de r√©duire cette valeur √† une variable de type <b>ADDR</b> .  Cette modification entra√Æne des √©conomies de m√©moire importantes et un temps d'ex√©cution des t√¢ches r√©duit.  Il sugg√®re √©galement que l'utilisation habituelle d'une bo√Æte aux lettres consiste √† transmettre des informations d'une t√¢che √† une autre.  Cette incompatibilit√© ne causera pas de gros probl√®mes lors du portage d'applications vers Nucleus RTOS.  Nucleus SE peut √™tre modifi√© si un format de message diff√©rent est n√©cessaire. <br><br><h3>  Appels d'API non r√©alis√©s </h3><br>  Nucleus RTOS prend en charge neuf appels de bureau de bo√Æte aux lettres.  Parmi ceux-ci, quatre ne sont pas impl√©ment√©s dans Nucleus SE.  Les d√©tails de ces d√©fis, ainsi que les raisons pour lesquelles ils ont √©t√© exclus de Nucleus SE, sont d√©crits ci-dessus. <br><br>  Le prochain article examinera les files d'attente. <br><br>  <b>√Ä propos de l'auteur:</b> Colin Walls travaille dans l'industrie √©lectronique depuis plus de trente ans, consacrant la majeure partie de son temps au micrologiciel.  Il est maintenant ing√©nieur firmware chez Mentor Embedded (une division de Mentor Graphics).  Colin Walls intervient souvent lors de conf√©rences et s√©minaires, auteur de nombreux articles techniques et de deux livres sur le firmware.  Vit au Royaume-Uni.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Blog</a> professionnel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de Colin</a> , e-mail: colin_walls@mentor.com. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr431118/">https://habr.com/ru/post/fr431118/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr431106/index.html">Combien d'argent les Am√©ricains ont d√©pens√© ce Black Friday et qu'est-ce que les smartphones ont √† voir avec √ßa?</a></li>
<li><a href="../fr431108/index.html">Comment transformer l'imagerie satellite en cartes. Vision par ordinateur dans Yandex</a></li>
<li><a href="../fr431110/index.html">Arr√™tez de nourrir les √©diteurs. L'UE √©labore des r√®gles pour le libre acc√®s obligatoire √† la recherche</a></li>
<li><a href="../fr431112/index.html">Comment utiliser les m√©thodes des moindres carr√©s pour √©valuer les ressources et surveiller les bases de donn√©es Oracle</a></li>
<li><a href="../fr431116/index.html">Envie d'√©trange: bilan de la prochaine conf√©rence DartUP √† Saint-P√©tersbourg</a></li>
<li><a href="../fr431120/index.html">La souffrance au travail n'est pas n√©cessaire</a></li>
<li><a href="../fr431122/index.html">Grafana, un autre outil de suivi technique de nos logiciels</a></li>
<li><a href="../fr431124/index.html">"La science des donn√©es, comme les math√©matiques et la physique, est une autre fa√ßon d'explorer le monde qui vous entoure."</a></li>
<li><a href="../fr431126/index.html">Pourquoi vous ne devriez pas √©conomiser sur les MP professionnels</a></li>
<li><a href="../fr431128/index.html">Piratage DDR3 SPD</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>