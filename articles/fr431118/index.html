<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💏 🖇️ 🧓🏼 Toute la vérité sur RTOS. Article # 22. Boîtes aux lettres: services auxiliaires et structures de données 👨🏽‍🚒 🎻 🏥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article poursuit l'examen des boîtes aux lettres qui a commencé dans l'article précédent de la série «La vérité sur RTOS». 

 Articles précédents ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Toute la vérité sur RTOS. Article # 22. Boîtes aux lettres: services auxiliaires et structures de données</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431118/"><img src="https://habrastorage.org/webt/j-/7m/ne/j-7mne20kyhq0wia5-mxp4lotsq.jpeg"><br><br>  Cet article poursuit l'examen des boîtes aux lettres qui a commencé dans l'article précédent de la série «La vérité sur RTOS». <br><a name="habracut"></a><br>  Articles précédents de la série: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 21.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Boîtes aux lettres: introduction et services de base</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 20.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sémaphores: services auxiliaires et structures de données</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 19.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sémaphores: introduction et services de base</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 18.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Groupes d'indicateurs d'événements: services d'assistance et structures de données</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 17.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Groupes de drapeaux d'événements: introduction et services de base</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 16.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Signaux</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 15.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partitions de mémoire: services et structures de données</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 14.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sections de mémoire: introduction et services de base</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 13.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Structures de données de tâche et appels d'API non pris en charge</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 12.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Services pour travailler avec des tâches</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 11.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tâches: configuration et introduction à l'API</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 10.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Scheduler: fonctionnalités avancées et préservation du contexte</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 9.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Scheduler: implémentation</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 8.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nucleus SE: conception interne et déploiement</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 7.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nucleus SE: Introduction</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 6.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Autres services RTOS</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 5.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Interaction et synchronisation des tâches</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tâches, changement de contexte et interruptions</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tâches et planification</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RTOS: Structure et mode temps réel</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RTOS: introduction.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><br></a> <br><br><h2>  Services auxiliaires de boîtes aux lettres </h2><br>  Nucleus RTOS dispose de quatre appels d'API qui fournissent des fonctions auxiliaires liées aux boîtes aux lettres: vidage d'une boîte aux lettres, récupération d'informations sur une boîte aux lettres, récupération du nombre de boîtes aux lettres dans une application et récupération de pointeurs vers toutes les boîtes aux lettres d'une application.  Les trois premières de ces fonctionnalités sont implémentées dans Nucleus SE. <br><br><h3>  Réinitialisation de la boîte aux lettres </h3><br>  Cet appel de service API réinitialise la boîte aux lettres à son état initial non utilisé.  Le message stocké dans la boîte aux lettres sera perdu.  Toutes les tâches suspendues sur la boîte aux lettres reprendront avec le code retour <b>NUSE_MAILBOX_WAS_RESET</b> . <br><br>  <b><i>Appel pour réinitialiser une boîte aux lettres dans Nucleus RTOS</i></b> <br>  Prototype d'appel de service: <br>  <b>STATUS NU_Reset_Mailbox (boîte aux lettres NU_MAILBOX *);</b> <br><br>  Paramètres: <br>  <b>boîte aux lettres</b> - un pointeur vers l'unité de contrôle de boîte aux lettres. <br><br>  Valeur de retour: <br>  <b>NU_SUCCESS</b> - l'appel s'est terminé avec succès; <br>  <b>NU_INVALID_MAILBOX</b> - pointeur de boîte aux lettres non valide. <br><br>  <b><i>Appel pour réinitialiser une boîte aux lettres dans Nucleus SE</i></b> <br>  Cet appel de service d'API prend en charge la fonctionnalité de base de l'API Nucleus RTOS. <br><br>  Prototype d'appel de service: <br>  <b>STATUS NUSE_Mailbox_Reset (boîte aux lettres NUSE_MAILBOX);</b> <br><br>  Paramètres: <br>  <b>boîte aux lettres</b> - index (ID) de la boîte aux lettres vidée. <br><br>  <b>Valeur de retour:</b> <br>  <b>NUSE_SUCCESS</b> - l'appel s'est terminé avec succès; <br>  <b>NUSE_INVALID_MAILBOX</b> - index de boîte aux lettres non valide. <br><br>  <b><i>Implémenter la réinitialisation de la boîte aux lettres dans Nucleus SE</i></b> <br>  Le code d'option pour la fonction <b>NUSE_Mailbox_Reset</b> (après vérification des paramètres) est sélectionné à l'aide de la compilation conditionnelle, selon que la prise en charge des tâches de blocage (pause) est activée ou non.  Nous considérerons ces deux options. <br><br>  Si le verrou n'est pas activé, le code de cette fonction API est assez simple.  La boîte aux lettres est marquée comme inutilisée en définissant le paramètre <b>NUSE_Mailbox_Status []</b> sur <b>FALSE</b> . <br><br>  Si le verrou est activé, le code devient plus complexe: <br><br><pre><code class="plaintext hljs">while (NUSE_Mailbox_Blocking_Count[mailbox] != 0) { U8 index; /* check whether any tasks are blocked */ /* on this mailbox */ for (index=0; index&lt;NUSE_TASK_NUMBER; index++) { if ((LONIB(NUSE_Task_Status[index]) == NUSE_MAILBOX_SUSPEND) &amp;&amp; (HINIB(NUSE_Task_Status[index]) == mailbox)) { NUSE_Task_Blocking_Return[index] = NUSE_MAILBOX_WAS_RESET; NUSE_Task_Status[index] = NUSE_READY; break; } } NUSE_Mailbox_Blocking_Count[mailbox]--; } #if NUSE_SCHEDULER_TYPE == NUSE_PRIORITY_SCHEDULER NUSE_Reschedule(NUSE_NO_TASK); #endif</code> </pre> <br>  La boîte aux lettres est réinitialisée à l'état «Vide». <br><br>  Chaque tâche suspendue dans la boîte aux lettres se voit attribuer le statut «Prêt» avec le code retour <b>NUSE_MAILBOX_WAS_RESET</b> .  Une fois ce processus terminé, si le planificateur de priorité est utilisé, l'appel de service <b>NUSE_Reschedule ()</b> est <b>effectué</b> , car une ou plusieurs tâches avec une priorité plus élevée peuvent devenir prêtes et attendre la permission de s'exécuter. <br><br><h3>  Récupération des informations de boîte aux lettres </h3><br>  Cet appel de service fournit un ensemble d'informations sur la boîte aux lettres.  L'implémentation de cet appel dans Nucleus SE diffère de Nucleus RTOS en ce qu'il renvoie moins d'informations, car la dénomination des objets et l'ordre de pause ne sont pas pris en charge et la pause de tâche peut être désactivée. <br><br>  <b><i>Appelez pour obtenir des informations sur la boîte aux lettres Nucleus RTOS</i></b> <br>  Cet appel d'API prend en charge la fonctionnalité principale de l'API Nucleus RTOS. <br><br>  Prototype d'appel de service: <br>  <b>STATUS NU_Mailbox_Information (boîte aux lettres NU_MAILBOX *, nom CHAR *, OPTION * suspend_type, DATA_ELEMENT * message_present, UNSIGNED * tasks_waiting, NU_TASK ** first_task);</b> <br><br>  Paramètres: <br><br>  <b>boîte aux lettres</b> - pointeur vers l'unité de commande de boîte aux lettres; <br>  <b>nom</b> - un pointeur de 8 caractères sur le nom de la boîte aux lettres.  L'octet nul de fin est également inclus dans cette zone; <br>  <b>suspend_type</b> - pointeur sur la variable dans laquelle le type de suspension de la tâche est stocké.  Il peut prendre les valeurs <b>NU_FIFO</b> et <b>NU_PRIORITY</b> ; <br>  <b>message_present</b> - un pointeur vers une variable qui prendra la valeur <b>NU_TRUE</b> ou <b>NU_FALSE</b> , selon que la boîte aux lettres est pleine ou non; <br>  <b>tasks_waiting</b> - un pointeur sur une variable qui prendra le nombre de tâches suspendues sur cette boîte aux lettres; <br>  <b>first_task</b> - un pointeur vers un pointeur de tâche qui prendra un pointeur vers la première tâche suspendue. <br><br>  Valeur de retour: <br><br>  <b>NU_SUCCESS</b> - l'appel s'est terminé avec succès; <br>  <b>NU_INVALID_MAILBOX</b> - pointeur de boîte aux lettres non valide. <br><br>  <b><i>Appelez pour obtenir des informations sur la boîte aux lettres Nucleus SE</i></b> <br>  Cet appel de service d'API prend en charge la fonctionnalité de base de l'API Nucleus RTOS. <br><br>  Prototype d'appel de service: <br><br>  <b>STATUS NUSE_Mailbox_Information (boîte aux lettres NUSE_MAILBOX, U8 * message_present, U8 * tasks_waiting, NUSE_TASK * first_task);</b> <br><br>  Paramètres: <br><br>  <b>boîte aux lettres</b> - index de la boîte aux lettres pour laquelle des informations sont demandées; <br>  <b>message_present</b> - un pointeur vers une variable qui prend la valeur <b>TRUE</b> ou <b>FALSE</b> , selon que la boîte aux lettres est pleine ou non; <br>  <b>tasks_waiting</b> - un pointeur sur une variable qui prendra le nombre de tâches suspendues sur cette boîte aux lettres (rien n'est retourné si la suspension des tâches est désactivée); <br>  <b>first_task</b> - un pointeur vers une variable de type <b>NUSE_TASK</b> , qui prendra l'index de la première tâche suspendue (rien n'est retourné si la suspension de la tâche est désactivée). <br><br>  Valeur de retour: <br><br>  <b>NUSE_SUCCESS</b> - l'appel s'est terminé avec succès; <br>  <b>NUSE_INVALID_MAILBOX</b> - index de boîte aux lettres non valide; <br>  <b>NUSE_INVALID_POINTER</b> - un ou plusieurs paramètres de pointeur sont incorrects. <br><br>  <b><i>Implémentation des informations de boîte aux lettres dans Nucleus SE</i></b> <br><br>  L'implémentation de cet appel API est assez simple: <br><br><pre> <code class="plaintext hljs">*message_present = NUSE_Mailbox_Status[mailbox]; #if NUSE_BLOCKING_ENABLE *tasks_waiting = NUSE_Mailbox_Blocking_Count[mailbox]; if (NUSE_Mailbox_Blocking_Count[mailbox] != 0) { U8 index; for (index=0; index&lt;NUSE_TASK_NUMBER; index++) { if ((LONIB(NUSE_Task_Status[index]) == NUSE_MAILBOX_SUSPEND) &amp;&amp; (HINIB(NUSE_Task_Status[index]) == mailbox)) { *first_task = index; break; } } } else { *first_task = 0; } #else *tasks_waiting = 0; *first_task = 0; #endif return NUSE_SUCCESS;</code> </pre><br>  La fonction renvoie l'état de la boîte aux lettres.  Ensuite, si des appels de service pour bloquer des tâches sont activés, le nombre de tâches suspendues et l'index de la première sont renvoyés (sinon, ces paramètres sont définis sur 0). <br><br><h3>  Obtenir le nombre de boîtes aux lettres </h3><br>  Cet appel d'utilitaire renvoie le nombre de boîtes aux lettres dans l'application.  Alors que dans Nucleus RTOS, leur nombre peut changer au fil du temps, et la valeur de retour montrera le nombre actuel de boîtes aux lettres, dans Nucleus SE, le nombre de boîtes aux lettres est défini au stade de la construction et ne peut pas être modifié. <br><br>  <b><i>Appel d'un compteur de boîtes aux lettres dans Nucleus RTOS</i></b> <br>  Cet appel d'API prend en charge la fonctionnalité principale de l'API Nucleus RTOS. <br><br>  Prototype d'appel de service: <br>  <b>UNSIGNED NU_Established_Mailboxes (VOID);</b> <br><br>  Paramètres: <br>  Sont absents. <br><br>  Valeur de retour: <br>  Le nombre de boîtes aux lettres créées dans l'application. <br><br>  <b><i>Appel d'un compteur de boîtes aux lettres dans Nucleus SE</i></b> <br>  Cet appel d'API prend en charge la fonctionnalité principale de l'API Nucleus RTOS. <br><br>  Prototype d'appel de service: <br>  <b>U8 NUSE_Mailbox_Count (void);</b> <br><br>  Paramètres: <br>  Sont absents. <br><br>  Valeur de retour: <br>  Nombre de boîtes aux lettres configurées dans l'application. <br><br>  <b><i>Implémentation d'un compteur de boîtes aux lettres dans Nucleus SE</i></b> <br>  L'implémentation de cet appel API est extrêmement simple: la valeur de la directive <b>#define</b> <b>NUSE_MAILBOX_NUMBER</b> est <b>retournée</b> . <br><br><h2>  Structures de données </h2><br>  Les boîtes aux lettres utilisent deux ou trois tableaux de structures de données (toutes situées dans la RAM), qui, comme les autres objets Nucleus SE, sont un ensemble de tables dont la taille dépend du nombre de boîtes aux lettres configurées et de leurs paramètres. <br><br>  Je recommande fortement que le code d'application n'utilise pas un accès direct à ces structures de données, mais s'y réfère via les fonctions API fournies.  Cela évite l'incompatibilité avec les futures versions de Nucleus SE et les effets secondaires indésirables, et simplifie également le portage de l'application vers Nucleus RTOS.  Ce qui suit est un aperçu détaillé des structures de données pour une meilleure compréhension du fonctionnement du code d'appel de service et pour le débogage. <br><br><h3>  Données RAM </h3><br>  Ces données ont la structure suivante: <br><br>  <b>NUSE_Mailbox_Data []</b> - un tableau de type <b>ADDR</b> , qui a une entrée pour chaque boîte aux lettres configurée, il stocke les données de boîte aux lettres. <br>  <b>NUSE_Mailbox_Status []</b> est un tableau <b>U8</b> qui a une entrée pour chaque boîte aux lettres configurée, il surveille l'utilisation des boîtes aux lettres.  Une valeur non nulle ( <b>TRUE</b> ) indique que la boîte aux lettres est pleine. <br>  <b>NUSE_Mailbox_Blocking_Count []</b> - un tableau de type <b>U8</b> , il contient un compteur de tâches bloquées pour chaque boîte aux lettres.  Ce tableau est créé uniquement si la fonctionnalité de blocage d'appels API est activée. <br><br>  Ces structures de données sont initialisées avec des zéros dans la fonction <b>NUSE_Init_Mailbox () au</b> démarrage de Nucleus SE.  C'est logique, car chaque boîte aux lettres est créée vide (inutilisée). <br><br>  Voici les définitions de ces structures de données du fichier <b>nuse_init.c</b> . <br><br><pre> <code class="plaintext hljs">RAM ADDR NUSE_Mailbox_Data[NUSE_MAILBOX_NUMBER]; RAM U8 NUSE_Mailbox_Status[NUSE_MAILBOX_NUMBER]; #if NUSE_BLOCKING_ENABLE RAM U8 NUSE_Mailbox_Blocking_Count[NUSE_MAILBOX_NUMBER]; #endif</code> </pre><br><h3>  Données ROM </h3><br>  Pour l'implémentation des boîtes aux lettres, les données en ROM ne sont pas utilisées. <br><br><h3>  La quantité de mémoire pour les boîtes aux lettres </h3><br>  Comme pour tous les objets du noyau Nucleus SE, la quantité de mémoire requise pour les boîtes aux lettres est connue à l'avance. <br><br>  La quantité de mémoire pour les données dans la ROM pour toutes les boîtes aux lettres de l'application est de 0. <br><br>  La quantité de données dans la RAM pour toutes les boîtes aux lettres de l'application (en octets) avec des appels d'API activés pour bloquer les tâches peut être calculée comme suit: <br>  <b>NUSE_MAILBOX_NUMBER * (taille de (ADDR) +2)</b> <br><br>  Sinon: <br>  <b>NUSE_MAILBOX_NUMBER * (taille de (ADDR) +1)</b> <br><br><h2>  Appels d'API non réalisés </h2><br>  Les quatre appels d'utilitaires disponibles dans Nucleus RTOS ne sont pas implémentés dans Nucleus SE. <br><br><h3>  Créer une boîte aux lettres </h3><br>  Cet appel de service API crée une boîte aux lettres.  Nucleus SE n'en a pas besoin, car les boîtes aux lettres sont créées statiquement. <br><br>  Prototype d'appel de service: <br>  <b>STATUS NU_Create_Mailbox (boîte aux lettres NU_MAILBOX *, nom CHAR *, UNSIGNED OPTION suspend_type);</b> <br><br>  Paramètres: <br><br>  <b>boîte aux lettres</b> - un pointeur vers l'unité de commande de boîte aux lettres fourni par l'utilisateur;  Utilisé pour gérer les boîtes aux lettres dans d'autres appels d'API <br>  <b>nom</b> - pointeur vers le <b>nom</b> à 7 caractères de la boîte aux lettres avec zéro octet de fin; <br>  <b>suspend_type</b> - Indique le principe de la suspension d'une tâche sur une boîte aux lettres.  Il peut prendre les valeurs <b>NU_FIFO</b> et <b>NU_PRIORITY</b> , qui désignent respectivement le principe de FIFO (First-In-First-Out) ou le principe de priorité de suspension des tâches. <br><br>  Valeur de retour: <br><br>  <b>NU_SUCCESS</b> - l'appel s'est terminé avec succès; <br>  <b>NU_INVALID_MAILBOX</b> - pointeur nul vers l'unité de contrôle de boîte aux lettres ( <b>NULL</b> ), ou le pointeur est déjà utilisé; <br>  <b>NU_INVALID_SUSPEND</b> - paramètre <b>suspend_type</b> non <b>valide</b> . <br><br><h3>  Supprimer une boîte aux lettres </h3><br>  Cet appel de service API supprime une boîte aux lettres créée précédemment.  Nucleus SE n'en a pas besoin, car les boîtes aux lettres sont créées statiquement et ne peuvent pas être supprimées. <br><br>  Prototype d'appel de service: <br><br>  <b>STATUS NU_Delete_Mailbox (boîte aux lettres NU_MAILBOX *);</b> <br><br>  Paramètres: <br><br>  <b>boîte aux lettres</b> - un pointeur vers l'unité de contrôle de boîte aux lettres. <br><br>  Valeur de retour: <br><br>  <b>NU_SUCCESS</b> - l'appel s'est terminé avec succès; <br>  <b>NU_INVALID_MAILBOX</b> - pointeur de boîte aux lettres non valide. <br><br><h3>  Pointeurs de boîte aux lettres </h3><br>  Cet appel d'API constitue une liste séquentielle de pointeurs vers toutes les boîtes aux lettres du système.  Nucleus SE n'en a pas besoin, car les boîtes aux lettres sont identifiées par un simple index, et non par un pointeur. <br><br>  Prototype d'appel de service: <br><br>  <b>UNSIGNED NU_Mailbox_Pointers (NU_MAILBOX ** pointer_list, UNSIGNED maximum_pointers);</b> <br><br>  Paramètres: <br><br>  <b>pointer_list</b> - pointeur vers un tableau de pointeurs <b>NU_MAILBOX</b> ;  ce tableau sera rempli de pointeurs vers des boîtes aux lettres créées dans le système; <br>  <b>maximum_pointers</b> - le nombre maximum de pointeurs dans le tableau. <br><br>  Valeur de retour: <br><br>  Nombre de pointeurs <b>NU_MAILBOX</b> dans le tableau. <br><br><h3>  Enregistrer un message dans la boîte aux lettres pour distribution à tous les destinataires </h3><br>  Cet appel de service envoie un message à toutes les tâches qui attendent des messages d'une boîte aux lettres spécifique.  Dans Nucleus SE, cet appel d'utilitaire n'est pas implémenté, car il ajouterait une complexité inutile. <br><br>  Prototype d'appel de service: <br><br>  <b>STATUS NU_Broadcast_To_Mailbox (boîte aux lettres NU_MAILBOX *, message VOID *, suspension UNSIGNED);</b> <br><br>  Paramètres: <br><br>  <b>boîte aux lettres</b> - pointeur vers l'unité de commande de boîte aux lettres; <br>  <b>message</b> - pointeur vers le message transmis; <br>  <b>suspend</b> - indique s'il faut suspendre la tâche d'appel si la boîte aux lettres contient déjà un message;  peut être <b>NU_NO_SUSPEND</b> , <b>NU_SUSPEND</b> ou une valeur de délai d'expiration. <br><br>  Valeur de retour: <br><br>  <b>NU_SUCCESS</b> - l'appel s'est terminé avec succès; <br>  <b>NU_INVALID_MAILBOX</b> - pointeur de boîte aux lettres non valide; <br>  <b>NU_INVALID_POINTER</b> - pointeur nul vers un message ( <b>NULL</b> ); <br>  <b>NU_INVALID_SUSPEND</b> - tentative de suspension à partir d'un thread non lié à une tâche; <br>  <b>NU_MAILBOX_FULL</b> - la boîte aux lettres contient déjà un message; <br>  <b>NU_TIMEOUT</b> - une fois le délai expiré, la boîte aux lettres est toujours pleine; <br>  <b>NU_MAILBOX_DELETED</b> - La boîte aux lettres a été supprimée lors de la suspension de la tâche. <br>  <b>NU_MAILBOX_RESET</b> - la boîte aux lettres a été réinitialisée alors que la tâche a été suspendue. <br><br><h2>  Compatible avec Nucleus RTOS </h2><br>  Comme pour tous les autres objets Nucleus SE, mon objectif était de maximiser la compatibilité du code d'application avec Nucleus RTOS.  Les boîtes aux lettres ne font pas exception et, du point de vue de l'utilisateur, elles sont implémentées de la même manière que dans Nucleus RTOS.  Il y a aussi une certaine incompatibilité, que j'ai jugée acceptable étant donné qu'en conséquence, le code deviendra plus compréhensible et plus efficace en termes de quantité de mémoire requise.  Sinon, les appels d'API Nucleus RTOS peuvent être directement portés vers Nucleus SE. <br><br><h3>  Identificateurs d'objet </h3><br>  Dans Nucleus RTOS, tous les objets sont décrits par des structures de données (unités de contrôle) d'un type spécifique.  Un pointeur vers cette unité de contrôle sert d’identifiant à la boîte aux lettres.  J'ai décidé que dans Nucleus SE, une approche différente est nécessaire pour une utilisation efficace de la mémoire: tous les objets du noyau sont décrits par un ensemble de tables en RAM et / ou ROM.  La taille de ces tables est déterminée par le nombre d'objets configurés de chaque type.  L'identifiant d'un objet particulier est l'index dans ce tableau.  J'ai donc défini <b>NUSE_MAILBOX</b> comme l'équivalent de <b>U8</b> , une variable (pas un pointeur) de ce type sert d'identifiant de la boîte aux lettres.  Cette légère incompatibilité est facile à gérer si le code est porté de Nucleus SE vers Nucleus RTOS et vice versa.  En règle générale, aucune opération n'est effectuée sur les identificateurs d'objet autres que le déplacement et le stockage. <br><br>  Nucleus RTOS prend également en charge la dénomination des boîtes aux lettres.  Ces noms sont utilisés uniquement pour le débogage.  Je les ai exclus de Nucleus SE pour économiser de la mémoire. <br><br><h3>  Taille et type du message </h3><br>  Dans Nucleus RTOS, un message de boîte aux lettres se compose de quatre mots de 32 bits.  Dans Nucleus SE, j'ai décidé de réduire cette valeur à une variable de type <b>ADDR</b> .  Cette modification entraîne des économies de mémoire importantes et un temps d'exécution des tâches réduit.  Il suggère également que l'utilisation habituelle d'une boîte aux lettres consiste à transmettre des informations d'une tâche à une autre.  Cette incompatibilité ne causera pas de gros problèmes lors du portage d'applications vers Nucleus RTOS.  Nucleus SE peut être modifié si un format de message différent est nécessaire. <br><br><h3>  Appels d'API non réalisés </h3><br>  Nucleus RTOS prend en charge neuf appels de bureau de boîte aux lettres.  Parmi ceux-ci, quatre ne sont pas implémentés dans Nucleus SE.  Les détails de ces défis, ainsi que les raisons pour lesquelles ils ont été exclus de Nucleus SE, sont décrits ci-dessus. <br><br>  Le prochain article examinera les files d'attente. <br><br>  <b>À propos de l'auteur:</b> Colin Walls travaille dans l'industrie électronique depuis plus de trente ans, consacrant la majeure partie de son temps au micrologiciel.  Il est maintenant ingénieur firmware chez Mentor Embedded (une division de Mentor Graphics).  Colin Walls intervient souvent lors de conférences et séminaires, auteur de nombreux articles techniques et de deux livres sur le firmware.  Vit au Royaume-Uni.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Blog</a> professionnel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de Colin</a> , e-mail: colin_walls@mentor.com. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr431118/">https://habr.com/ru/post/fr431118/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr431106/index.html">Combien d'argent les Américains ont dépensé ce Black Friday et qu'est-ce que les smartphones ont à voir avec ça?</a></li>
<li><a href="../fr431108/index.html">Comment transformer l'imagerie satellite en cartes. Vision par ordinateur dans Yandex</a></li>
<li><a href="../fr431110/index.html">Arrêtez de nourrir les éditeurs. L'UE élabore des règles pour le libre accès obligatoire à la recherche</a></li>
<li><a href="../fr431112/index.html">Comment utiliser les méthodes des moindres carrés pour évaluer les ressources et surveiller les bases de données Oracle</a></li>
<li><a href="../fr431116/index.html">Envie d'étrange: bilan de la prochaine conférence DartUP à Saint-Pétersbourg</a></li>
<li><a href="../fr431120/index.html">La souffrance au travail n'est pas nécessaire</a></li>
<li><a href="../fr431122/index.html">Grafana, un autre outil de suivi technique de nos logiciels</a></li>
<li><a href="../fr431124/index.html">"La science des données, comme les mathématiques et la physique, est une autre façon d'explorer le monde qui vous entoure."</a></li>
<li><a href="../fr431126/index.html">Pourquoi vous ne devriez pas économiser sur les MP professionnels</a></li>
<li><a href="../fr431128/index.html">Piratage DDR3 SPD</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>