<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ™ğŸ¾ ğŸ”§ ğŸ¦ƒ procfsè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿçš„æ•ˆç‡å¦‚ä½•ï¼Œå¹¶ä¸”æœ‰å¯èƒ½å¯¹å…¶è¿›è¡Œä¼˜åŒ– ğŸ”‡ ğŸš ğŸ‘©ğŸ¼â€ğŸ’¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="procæ–‡ä»¶ç³»ç»Ÿï¼ˆä»¥ä¸‹ç®€ç§°ä¸ºprocfsï¼‰æ˜¯æä¾›æœ‰å…³è¿›ç¨‹ä¿¡æ¯çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿã€‚ å¥¹æ˜¯éµå¾ªâ€œä¸€åˆ‡éƒ½æ˜¯æ–‡ä»¶â€èŒƒå¼çš„æ¥å£çš„â€œå¾ˆå¥½â€ç¤ºä¾‹ã€‚ Procfsæ˜¯å¾ˆä¹…ä»¥å‰å¼€å‘çš„ï¼šå½“æ—¶æœåŠ¡å™¨å¹³å‡ä¸ºæ•°åä¸ªè¿›ç¨‹æä¾›æœåŠ¡ï¼Œè€Œæ‰“å¼€æ–‡ä»¶å¹¶è¯»å–è¿›ç¨‹ä¿¡æ¯åˆ™ä¸æ˜¯é—®é¢˜ã€‚ ä½†æ˜¯ï¼Œæ—¶é—´å¹¶ä¸ä¼šåœæ»ä¸å‰ï¼Œç°åœ¨æœåŠ¡å™¨å¯ä»¥åŒæ—¶æœåŠ¡æ•°åä¸‡ä¸ªç”šè‡³æ›´å¤šçš„...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>procfsè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿçš„æ•ˆç‡å¦‚ä½•ï¼Œå¹¶ä¸”æœ‰å¯èƒ½å¯¹å…¶è¿›è¡Œä¼˜åŒ–</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/virtuozzo/blog/418715/"><p>  procæ–‡ä»¶ç³»ç»Ÿï¼ˆä»¥ä¸‹ç®€ç§°ä¸ºprocfsï¼‰æ˜¯æä¾›æœ‰å…³è¿›ç¨‹ä¿¡æ¯çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿã€‚ å¥¹æ˜¯éµå¾ªâ€œä¸€åˆ‡éƒ½æ˜¯æ–‡ä»¶â€èŒƒå¼çš„æ¥å£çš„â€œå¾ˆå¥½â€ç¤ºä¾‹ã€‚  Procfsæ˜¯å¾ˆä¹…ä»¥å‰å¼€å‘çš„ï¼šå½“æ—¶æœåŠ¡å™¨å¹³å‡ä¸ºæ•°åä¸ªè¿›ç¨‹æä¾›æœåŠ¡ï¼Œè€Œæ‰“å¼€æ–‡ä»¶å¹¶è¯»å–è¿›ç¨‹ä¿¡æ¯åˆ™ä¸æ˜¯é—®é¢˜ã€‚ ä½†æ˜¯ï¼Œæ—¶é—´å¹¶ä¸ä¼šåœæ»ä¸å‰ï¼Œç°åœ¨æœåŠ¡å™¨å¯ä»¥åŒæ—¶æœåŠ¡æ•°åä¸‡ä¸ªç”šè‡³æ›´å¤šçš„è¿›ç¨‹ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œâ€œä¸ºæ¯ä¸ªè¿›ç¨‹æ‰“å¼€æ–‡ä»¶ä»¥å‡å»æ„Ÿå…´è¶£çš„æ•°æ®â€çš„æƒ³æ³•ä¸å†é‚£ä¹ˆå¸å¼•äººäº†ï¼Œæƒ³åˆ°åŠ å¿«è¯»å–é€Ÿåº¦çš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯ä¸€æ¬¡è¿­ä»£åœ°è·å–æœ‰å…³ä¸€ç»„è¿›ç¨‹çš„ä¿¡æ¯ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å°è¯•æ‰¾åˆ°å¯ä»¥ä¼˜åŒ–çš„procfså…ƒç´ ã€‚ </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/7c7/55c/f6b/7c755cf6b80f5b20ab194e548c3c99be.jpg" alt="å›¾ç‰‡"></p><a name="habracut"></a><br><p> å½“æˆ‘ä»¬å‘ç°CRIUä»…èŠ±è´¹å¤§é‡æ—¶é—´è¯»å–procfsæ–‡ä»¶æ—¶ï¼Œå°±äº§ç”Ÿäº†æ”¹è¿›procfsçš„æƒ³æ³•ã€‚ æˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•è§£å†³å¥—æ¥å­—çš„ç±»ä¼¼é—®é¢˜ï¼Œå¹¶å†³å®šåšä¸€äº›ç±»ä¼¼äºsock-diagæ¥å£çš„æ“ä½œï¼Œä½†åªé’ˆå¯¹procfsã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬å‡è®¾è¦æ›´æ”¹å†…æ ¸ä¸­é•¿æœŸå­˜åœ¨ä¸”å®Œå–„çš„ç•Œé¢ï¼Œä½¿ç¤¾åŒºç›¸ä¿¡æ¸¸æˆå€¼å¾—æ¥å—......è¿™å°†æ˜¯å¤šä¹ˆå›°éš¾......æˆ‘ä»¬ä¸ºæ”¯æŒåˆ›å»ºæ–°ç•Œé¢çš„äººæ•°è€Œæ„Ÿåˆ°æƒŠè®¶ã€‚ ä¸¥æ ¼æ¥è¯´ï¼Œæ²¡æœ‰äººçŸ¥é“æ–°ç•Œé¢çš„å¤–è§‚ï¼Œä½†æ˜¯æ¯«æ— ç–‘é—®ï¼Œprocfsä¸èƒ½æ»¡è¶³å½“å‰çš„æ€§èƒ½è¦æ±‚ã€‚ ä¾‹å¦‚ï¼Œè¿™ç§æƒ…å†µï¼šæœåŠ¡å™¨å¯¹è¯·æ±‚çš„å“åº”æ—¶é—´è¿‡é•¿ï¼Œvmstatæ˜¾ç¤ºå†…å­˜å·²è¿›è¡Œäº¤æ¢ï¼Œå¹¶ä¸”â€œ ps axâ€ä»10ç§’æˆ–æ›´é•¿æ—¶é—´å¼€å§‹ï¼Œtopæ ¹æœ¬ä¸æ˜¾ç¤ºä»»ä½•å†…å®¹ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä¸è€ƒè™‘ä»»ä½•ç‰¹å®šçš„æ–°æ¥å£ï¼›è€Œæ˜¯ï¼Œæˆ‘ä»¬å°†å°è¯•æè¿°é—®é¢˜åŠå…¶è§£å†³æ–¹æ¡ˆã€‚ </p><br><p>æ¯ä¸ªæ‰§è¡Œçš„procfsè¿›ç¨‹éƒ½ç”±/ proc / <code>&lt;pid&gt;</code>ç›®å½•è¡¨ç¤ºã€‚ <br> åœ¨æ¯ä¸ªè¿™æ ·çš„ç›®å½•ä¸­ï¼Œæœ‰è®¸å¤šæ–‡ä»¶å’Œå­ç›®å½•å¯æä¾›å¯¹æœ‰å…³è¯¥è¿‡ç¨‹çš„æŸäº›ä¿¡æ¯çš„è®¿é—®ã€‚ å­ç›®å½•æŒ‰åŠŸèƒ½åˆ†ç»„æ•°æ®ã€‚ ä¾‹å¦‚ï¼ˆ <code>$$</code>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„shellå˜é‡ï¼Œä»¥pidæ‰©å±•-å½“å‰è¿›ç¨‹çš„æ ‡è¯†ç¬¦ï¼‰ï¼š </p><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> ls <span class="hljs-operator"><span class="hljs-operator">-F</span></span> /proc/<span class="hljs-variable"><span class="hljs-variable">$</span></span><span class="hljs-variable"><span class="hljs-variable">$</span></span> attr/ exe<span class="hljs-selector-tag"><span class="hljs-selector-tag">@</span></span> mounts projid_map status autogroup fd/ mountstats root<span class="hljs-selector-tag"><span class="hljs-selector-tag">@</span></span> syscall auxv fdinfo/ net/ sched task/ cgroup gid_map ns/ schedstat timers clear_refs io numa_maps sessionid timerslack_ns cmdline limits oom_adj setgroups uid_map comm loginuid oom_score smaps wchan coredump_filter map_files/ oom_score_adj smaps_rollup cpuset maps pagemap stack cwd<span class="hljs-selector-tag"><span class="hljs-selector-tag">@</span></span> mem patch_state stat environ mountinfo personality statm</code> </pre> <br><p> æ‰€æœ‰è¿™äº›æ–‡ä»¶ä»¥ä¸åŒçš„æ ¼å¼è¾“å‡ºæ•°æ®ã€‚ å¤§å¤šæ•°éƒ½æ˜¯ASCIIæ ¼å¼çš„æ–‡æœ¬ï¼Œå¾ˆå®¹æ˜“è¢«äººç±»æ„ŸçŸ¥ã€‚ å¥½å§ï¼Œå‡ ä¹å¾ˆå®¹æ˜“ï¼š </p><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> cat /proc/<span class="hljs-variable"><span class="hljs-variable">$</span></span><span class="hljs-variable"><span class="hljs-variable">$</span></span>/stat <span class="hljs-number"><span class="hljs-number">24293</span></span> (bash) S <span class="hljs-number"><span class="hljs-number">21811</span></span> <span class="hljs-number"><span class="hljs-number">24293</span></span> <span class="hljs-number"><span class="hljs-number">24293</span></span> <span class="hljs-number"><span class="hljs-number">34854</span></span> <span class="hljs-number"><span class="hljs-number">24876</span></span> <span class="hljs-number"><span class="hljs-number">4210688</span></span> <span class="hljs-number"><span class="hljs-number">6325</span></span> <span class="hljs-number"><span class="hljs-number">19702</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">47892016</span></span> <span class="hljs-number"><span class="hljs-number">135487488</span></span> <span class="hljs-number"><span class="hljs-number">3388</span></span> <span class="hljs-number"><span class="hljs-number">18446744073709551615</span></span> <span class="hljs-number"><span class="hljs-number">94447405350912</span></span> <span class="hljs-number"><span class="hljs-number">94447406416132</span></span> <span class="hljs-number"><span class="hljs-number">140729719486816</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">65536</span></span> <span class="hljs-number"><span class="hljs-number">3670020</span></span> <span class="hljs-number"><span class="hljs-number">1266777851</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">94447408516528</span></span> <span class="hljs-number"><span class="hljs-number">94447408563556</span></span> <span class="hljs-number"><span class="hljs-number">94447429677056</span></span> <span class="hljs-number"><span class="hljs-number">140729719494655</span></span> <span class="hljs-number"><span class="hljs-number">140729719494660</span></span> <span class="hljs-number"><span class="hljs-number">140729719494660</span></span> <span class="hljs-number"><span class="hljs-number">140729719496686</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p> ä¸ºäº†ç†è§£è¯¥é›†åˆçš„æ¯ä¸ªå…ƒç´ çš„å«ä¹‰ï¼Œè¯»è€…å¿…é¡»æ‰“å¼€man procï¼ˆ5ï¼‰æˆ–å†…æ ¸æ–‡æ¡£ã€‚ ä¾‹å¦‚ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯æ‹¬å·ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶çš„åç§°ï¼Œç¬¬åä¹ä¸ªå…ƒç´ æ˜¯æ‰§è¡Œä¼˜å…ˆçº§çš„å½“å‰å€¼ï¼ˆniceï¼‰ã€‚ </p><br><p> æŸäº›æ–‡ä»¶æœ¬èº«å¾ˆå®¹æ˜“é˜…è¯»ï¼š </p><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> cat /proc/<span class="hljs-variable"><span class="hljs-variable">$</span></span><span class="hljs-variable"><span class="hljs-variable">$</span></span>/status | head <span class="hljs-literal"><span class="hljs-literal">-n</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> Name: bash Umask: <span class="hljs-number"><span class="hljs-number">0002</span></span> State: S (sleeping) Tgid: <span class="hljs-number"><span class="hljs-number">24293</span></span> Ngid: <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p> ä½†æ˜¯ï¼Œç”¨æˆ·æœ‰å¤šå°‘æ¬¡ç›´æ¥ä»procfsæ–‡ä»¶ä¸­è¯»å–ä¿¡æ¯ï¼Ÿ å†…æ ¸éœ€è¦å¤šé•¿æ—¶é—´å°†äºŒè¿›åˆ¶æ•°æ®è½¬æ¢ä¸ºæ–‡æœ¬æ ¼å¼ï¼Ÿ  procfsçš„å¼€é”€æ˜¯å¤šå°‘ï¼Ÿ è¯¥ç•Œé¢å¯¹äºçŠ¶æ€ç›‘æ§ç¨‹åºæœ‰å¤šæ–¹ä¾¿ï¼Œå®ƒä»¬èŠ±è´¹å¤šå°‘æ—¶é—´æ¥å¤„ç†æ­¤æ–‡æœ¬æ•°æ®ï¼Ÿ åœ¨ç´§æ€¥æƒ…å†µä¸‹å¦‚æ­¤ç¼“æ…¢çš„å®æ–½æœ‰å¤šé‡è¦ï¼Ÿ </p><br><p> å¾ˆæœ‰å¯èƒ½è¯´ç”¨æˆ·å–œæ¬¢ä½¿ç”¨topæˆ–psä¹‹ç±»çš„ç¨‹åºï¼Œè€Œä¸æ˜¯ç›´æ¥ä»procfsä¸­è¯»å–æ•°æ®ï¼Œè¿™ä¸æ˜¯é”™è¯¯çš„ã€‚ </p><br><p> ä¸ºäº†å›ç­”å…¶ä½™é—®é¢˜ï¼Œæˆ‘ä»¬å°†è¿›è¡Œå‡ ä¸ªå®éªŒã€‚ é¦–å…ˆï¼Œæ‰¾åˆ°å†…æ ¸åœ¨å“ªé‡ŒèŠ±è´¹æ—¶é—´æ¥ç”Ÿæˆprocfsæ–‡ä»¶ã€‚ </p><br><p> ä¸ºäº†ä»ç³»ç»Ÿä¸­çš„æ‰€æœ‰è¿›ç¨‹ä¸­è·å–æŸäº›ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†å¿…é¡»éå†/ proc /ç›®å½•å¹¶é€‰æ‹©å…¶åç§°ä»¥åè¿›åˆ¶æ•°å­—è¡¨ç¤ºçš„æ‰€æœ‰å­ç›®å½•ã€‚ ç„¶åï¼Œåœ¨æ¯ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ‰“å¼€æ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶å¹¶å°†å…¶å…³é—­ã€‚ </p><br><p> æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬å°†è¿›è¡Œä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œå…¶ä¸­ä¸€ä¸ªå°†åˆ›å»ºæ–‡ä»¶æè¿°ç¬¦ï¼ˆåœ¨å†…æ ¸ä¸­ï¼Œæ–‡ä»¶æè¿°ç¬¦ä¸ä¸€ç»„å†…éƒ¨å¯¹è±¡ç›¸å…³è”ï¼Œå¹¶ä¸ºå…¶åˆ†é…äº†é¢å¤–çš„å†…å­˜ï¼‰ã€‚  openï¼ˆï¼‰å’Œcloseï¼ˆï¼‰ç³»ç»Ÿè°ƒç”¨æœ¬èº«ä¸ä¼šæä¾›ä»»ä½•ä¿¡æ¯ï¼Œå› æ­¤å¯ä»¥å°†å®ƒä»¬å½’å› äºprocfsæ¥å£å¼€é”€ã€‚ </p><br><p> è®©æˆ‘ä»¬å°è¯•ä¸ºç³»ç»Ÿä¸­çš„æ¯ä¸ªè¿›ç¨‹æ‰“å¼€ï¼ˆï¼‰å’Œå…³é—­ï¼ˆï¼‰ï¼Œä½†æˆ‘ä»¬ä¸ä¼šè¯»å–æ–‡ä»¶çš„å†…å®¹ï¼š </p><br><pre> <code class="hljs go">$ time ./task_proc_all --noread stat tasks: <span class="hljs-number"><span class="hljs-number">50290</span></span> <span class="hljs-built_in"><span class="hljs-built_in">real</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>m0<span class="hljs-number"><span class="hljs-number">.177s</span></span> user <span class="hljs-number"><span class="hljs-number">0</span></span>m0<span class="hljs-number"><span class="hljs-number">.012s</span></span> sys <span class="hljs-number"><span class="hljs-number">0</span></span>m0<span class="hljs-number"><span class="hljs-number">.162s</span></span></code> </pre> <br><pre> <code class="hljs go">$ time ./task_proc_all --noread loginuid tasks: <span class="hljs-number"><span class="hljs-number">50289</span></span> <span class="hljs-built_in"><span class="hljs-built_in">real</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>m0<span class="hljs-number"><span class="hljs-number">.176s</span></span> user <span class="hljs-number"><span class="hljs-number">0</span></span>m0<span class="hljs-number"><span class="hljs-number">.026s</span></span> sys <span class="hljs-number"><span class="hljs-number">0</span></span>m0<span class="hljs-number"><span class="hljs-number">.145</span></span></code> </pre> <br><p>  <em>task-proc-all-ä¸€ä¸ªå°å‹å®ç”¨ç¨‹åºï¼Œå…¶ä»£ç å¯åœ¨ä¸‹é¢çš„é“¾æ¥ä¸­æ‰¾åˆ°</em> </p><br><p> æ‰“å¼€å“ªä¸ªæ–‡ä»¶éƒ½æ²¡æœ‰å…³ç³»ï¼Œå› ä¸ºå®é™…æ•°æ®ä»…åœ¨readï¼ˆï¼‰æ—¶ç”Ÿæˆã€‚ </p><br><p> ç°åœ¨çœ‹ä¸€ä¸‹perf core profilerçš„è¾“å‡ºï¼š </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 92<span class="hljs-selector-class"><span class="hljs-selector-class">.18</span></span>% 0<span class="hljs-selector-class"><span class="hljs-selector-class">.00</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">task_proc_all</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[unknown]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">x8000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 64<span class="hljs-selector-class"><span class="hljs-selector-class">.01</span></span>% __<span class="hljs-selector-tag"><span class="hljs-selector-tag">GI___libc_open</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 50<span class="hljs-selector-class"><span class="hljs-selector-class">.71</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">entry_SYSCALL_64_fastpath</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">do_sys_open</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 48<span class="hljs-selector-class"><span class="hljs-selector-class">.63</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">do_filp_open</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">path_openat</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 19<span class="hljs-selector-class"><span class="hljs-selector-class">.60</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">link_path_walk</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 14<span class="hljs-selector-class"><span class="hljs-selector-class">.23</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">walk_component</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 13<span class="hljs-selector-class"><span class="hljs-selector-class">.87</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">lookup_fast</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 7<span class="hljs-selector-class"><span class="hljs-selector-class">.55</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">pid_revalidate</span></span> 4<span class="hljs-selector-class"><span class="hljs-selector-class">.13</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">get_pid_task</span></span> + 1<span class="hljs-selector-class"><span class="hljs-selector-class">.58</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">security_task_to_inode</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">task_dump_owner</span></span> 3<span class="hljs-selector-class"><span class="hljs-selector-class">.63</span></span>% __<span class="hljs-selector-tag"><span class="hljs-selector-tag">d_lookup_rcu</span></span> + 3<span class="hljs-selector-class"><span class="hljs-selector-class">.42</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">security_inode_permission</span></span> + 14<span class="hljs-selector-class"><span class="hljs-selector-class">.76</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">proc_pident_lookup</span></span> + 4<span class="hljs-selector-class"><span class="hljs-selector-class">.39</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">d_alloc_parallel</span></span> + 2<span class="hljs-selector-class"><span class="hljs-selector-class">.93</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">get_empty_filp</span></span> + 2<span class="hljs-selector-class"><span class="hljs-selector-class">.43</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">lookup_fast</span></span> + 0<span class="hljs-selector-class"><span class="hljs-selector-class">.98</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">do_dentry_open</span></span> 2<span class="hljs-selector-class"><span class="hljs-selector-class">.07</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">syscall_return_via_sysret</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.60</span></span>% 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">xfffffe000008a01b</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.97</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">kmem_cache_alloc</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.61</span></span>% 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">xfffffe000008a01e</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 16<span class="hljs-selector-class"><span class="hljs-selector-class">.45</span></span>% __<span class="hljs-selector-tag"><span class="hljs-selector-tag">getdents64</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 15<span class="hljs-selector-class"><span class="hljs-selector-class">.11</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">entry_SYSCALL_64_fastpath</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sys_getdents</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">iterate_dir</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">proc_pid_readdir</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 7<span class="hljs-selector-class"><span class="hljs-selector-class">.18</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">proc_fill_cache</span></span> + 3<span class="hljs-selector-class"><span class="hljs-selector-class">.53</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">d_lookup</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.59</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">filldir</span></span> + 6<span class="hljs-selector-class"><span class="hljs-selector-class">.82</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">next_tgid</span></span> + 0<span class="hljs-selector-class"><span class="hljs-selector-class">.61</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">snprintf</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 9<span class="hljs-selector-class"><span class="hljs-selector-class">.89</span></span>% __<span class="hljs-selector-tag"><span class="hljs-selector-tag">close</span></span> + 4<span class="hljs-selector-class"><span class="hljs-selector-class">.03</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">entry_SYSCALL_64_fastpath</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.98</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">syscall_return_via_sysret</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.85</span></span>% 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">xfffffe000008a01b</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.61</span></span>% 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">xfffffe000008a01e</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">syscall_return_via_sysret</span></span></code> </pre> <br><p> å†…æ ¸èŠ±è´¹äº†å°†è¿‘75ï¼…çš„æ—¶é—´æ¥åˆ›å»ºå’Œåˆ é™¤æ–‡ä»¶æè¿°ç¬¦ï¼Œå¹¶èŠ±è´¹äº†å¤§çº¦16ï¼…çš„æ—¶é—´æ¥åˆ—å‡ºè¿›ç¨‹ã€‚ </p><br><p> å°½ç®¡æˆ‘ä»¬çŸ¥é“æ¯ä¸ªè¿›ç¨‹çš„openï¼ˆï¼‰å’Œcloseï¼ˆï¼‰è°ƒç”¨éœ€è¦å¤šé•¿æ—¶é—´ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶æ— æ³•ä¼°è®¡å®ƒçš„é‡è¦æ€§ã€‚ æˆ‘ä»¬éœ€è¦å°†è·å¾—çš„å€¼ä¸æŸäº›å€¼è¿›è¡Œæ¯”è¾ƒã€‚ è®©æˆ‘ä»¬å°è¯•å¯¹æœ€è‘—åçš„æ–‡ä»¶æ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚ é€šå¸¸ï¼Œå½“æ‚¨éœ€è¦åˆ—å‡ºè¿›ç¨‹æ—¶ï¼Œå°†ä½¿ç”¨psæˆ–topå®ç”¨ç¨‹åºã€‚ å®ƒä»¬éƒ½ä¸ºç³»ç»Ÿä¸Šçš„æ¯ä¸ªè¿›ç¨‹è¯»å–/ proc / <code>&lt;pid&gt;</code> / statå’Œ/ proc / <code>&lt;pid&gt;</code> /çŠ¶æ€ã€‚ </p><br><p> è®©æˆ‘ä»¬ä»/ proc / <code>&lt;pid&gt;</code> / statuså¼€å§‹-è¿™æ˜¯ä¸€ä¸ªå…·æœ‰å›ºå®šå­—æ®µæ•°çš„åºå¤§æ–‡ä»¶ï¼š </p><br><pre> <code class="hljs go">$ time ./task_proc_all status tasks: <span class="hljs-number"><span class="hljs-number">50283</span></span> <span class="hljs-built_in"><span class="hljs-built_in">real</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>m0<span class="hljs-number"><span class="hljs-number">.455s</span></span> user <span class="hljs-number"><span class="hljs-number">0</span></span>m0<span class="hljs-number"><span class="hljs-number">.033s</span></span> sys <span class="hljs-number"><span class="hljs-number">0</span></span>m0<span class="hljs-number"><span class="hljs-number">.417s</span></span></code> </pre> <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 93<span class="hljs-selector-class"><span class="hljs-selector-class">.84</span></span>% 0<span class="hljs-selector-class"><span class="hljs-selector-class">.00</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">task_proc_all</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[unknown]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[k]</span></span> 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">x0000000000008000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">x8000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 61<span class="hljs-selector-class"><span class="hljs-selector-class">.20</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">read</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 53<span class="hljs-selector-class"><span class="hljs-selector-class">.06</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">entry_SYSCALL_64_fastpath</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sys_read</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 52<span class="hljs-selector-class"><span class="hljs-selector-class">.80</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">vfs_read</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 52<span class="hljs-selector-class"><span class="hljs-selector-class">.22</span></span>% __<span class="hljs-selector-tag"><span class="hljs-selector-tag">vfs_read</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">seq_read</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 50<span class="hljs-selector-class"><span class="hljs-selector-class">.43</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">proc_single_show</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 50<span class="hljs-selector-class"><span class="hljs-selector-class">.38</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">proc_pid_status</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 11<span class="hljs-selector-class"><span class="hljs-selector-class">.34</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">task_mem</span></span> + <span class="hljs-selector-tag"><span class="hljs-selector-tag">seq_printf</span></span> + 6<span class="hljs-selector-class"><span class="hljs-selector-class">.99</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">seq_printf</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 5<span class="hljs-selector-class"><span class="hljs-selector-class">.77</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">seq_put_decimal_ull</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.94</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">strlen</span></span> + 1<span class="hljs-selector-class"><span class="hljs-selector-class">.42</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">num_to_str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 5<span class="hljs-selector-class"><span class="hljs-selector-class">.73</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">cpuset_task_status_allowed</span></span> + <span class="hljs-selector-tag"><span class="hljs-selector-tag">seq_printf</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 5<span class="hljs-selector-class"><span class="hljs-selector-class">.37</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">render_cap_t</span></span> + 5<span class="hljs-selector-class"><span class="hljs-selector-class">.31</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">seq_printf</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 5<span class="hljs-selector-class"><span class="hljs-selector-class">.25</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">render_sigset_t</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.84</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">seq_putc</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.73</span></span>% __<span class="hljs-selector-tag"><span class="hljs-selector-tag">task_pid_nr_ns</span></span> + 0<span class="hljs-selector-class"><span class="hljs-selector-class">.63</span></span>% __<span class="hljs-selector-tag"><span class="hljs-selector-tag">lock_task_sighand</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.53</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">hugetlb_report_usage</span></span> + 0<span class="hljs-selector-class"><span class="hljs-selector-class">.68</span></span>% _<span class="hljs-selector-tag"><span class="hljs-selector-tag">copy_to_user</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">number</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.05</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">seq_put_decimal_ull</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.84</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">vsnprintf</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.79</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">format_decode</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.73</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">syscall_return_via_sysret</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.52</span></span>% 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">xfffffe000003201b</span></span> + 20<span class="hljs-selector-class"><span class="hljs-selector-class">.95</span></span>% __<span class="hljs-selector-tag"><span class="hljs-selector-tag">GI___libc_open</span></span> + 6<span class="hljs-selector-class"><span class="hljs-selector-class">.44</span></span>% __<span class="hljs-selector-tag"><span class="hljs-selector-tag">getdents64</span></span> + 4<span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span>% __<span class="hljs-selector-tag"><span class="hljs-selector-tag">close</span></span></code> </pre> <br><p> å¯ä»¥çœ‹å‡ºï¼Œåªæœ‰å¤§çº¦60ï¼…çš„æ—¶é—´èŠ±è´¹åœ¨readï¼ˆï¼‰ç³»ç»Ÿè°ƒç”¨å†…ã€‚ å¦‚æœæ‚¨æ›´ä»”ç»†åœ°æŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼Œç»“æœå‘ç°æœ‰45ï¼…çš„æ—¶é—´æ˜¯åœ¨å†…æ ¸å‡½æ•°seq_printfï¼Œseq_put_decimal_ullä¸­ä½¿ç”¨çš„ã€‚ å› æ­¤ï¼Œä»äºŒè¿›åˆ¶æ ¼å¼è½¬æ¢ä¸ºæ–‡æœ¬æ ¼å¼æ˜¯ä¸€é¡¹éå¸¸æ˜‚è´µçš„æ“ä½œã€‚ å“ªä¸ªæå‡ºäº†ä¸€ä¸ªæœ‰æ ¹æ®çš„é—®é¢˜ï¼šæˆ‘ä»¬çœŸçš„éœ€è¦ä¸€ä¸ªæ–‡æœ¬æ¥å£æ¥ä»å†…æ ¸ä¸­æå–æ•°æ®å—ï¼Ÿ ç”¨æˆ·æƒ³å¤šä¹…ä½¿ç”¨ä¸€æ¬¡åŸå§‹æ•°æ®ï¼Ÿ ä¸ºä»€ä¹ˆtopå’Œpså®ç”¨ç¨‹åºå¿…é¡»å°†æ­¤æ–‡æœ¬æ•°æ®è½¬æ¢å›äºŒè¿›åˆ¶æ–‡ä»¶ï¼Ÿ </p><br><p> å¦‚æœç›´æ¥ä½¿ç”¨äºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶ä¸”ä¸éœ€è¦ä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œé‚£ä¹ˆçŸ¥é“è¾“å‡ºå°†æœ‰å¤šå¿«å¯èƒ½ä¼šå¾ˆæœ‰è¶£ã€‚ </p><br><p> å·²ç»å°è¯•åˆ›å»ºè¿™æ ·çš„æ¥å£ã€‚ åœ¨2004å¹´ï¼Œæˆ‘ä»¬å°è¯•ä½¿ç”¨netlinkå¼•æ“ã€‚ </p><br><pre> <code class="hljs markdown">[<span class="hljs-string"><span class="hljs-string">0/2</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">ANNOUNCE</span></span>] nproc: netlink access to /proc information (https://lwn.net/Articles/99600/) nproc is an attempt to address the current problems with /proc. In short, it exposes the same information via netlink (implemented for a small subset).</code> </pre> <br><p> ä¸å¹¸çš„æ˜¯ï¼Œç¤¾åŒºå¯¹æ­¤å·¥ä½œå¹¶æ²¡æœ‰è¡¨ç°å‡ºå¤ªå¤§å…´è¶£ã€‚ çº æ­£è¿™ç§æƒ…å†µçš„æœ€åå°è¯•ä¹‹ä¸€æ˜¯ä¸¤å¹´å‰ã€‚ </p><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">PATCH 0/15</span></span>] task_diag: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">add</span></span></span><span class="hljs-function"> a new </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">interface</span></span></span><span class="hljs-function"> to </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">get</span></span></span><span class="hljs-function"> information about </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processes</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">https://lwn.net/Articles/</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">683371</span></span></span></span><span class="hljs-function"><span class="hljs-params">/</span></span></span><span class="hljs-function">)</span></span></code> </pre> <br><p> ä»»åŠ¡è¯Šæ–­ç•Œé¢åŸºäºä»¥ä¸‹åŸåˆ™ï¼š </p><br><ul><li> äº¤æ˜“ï¼šå‘é€è¯·æ±‚ï¼Œæ”¶åˆ°å“åº”ï¼› </li><li> æ¶ˆæ¯çš„æ ¼å¼ä¸ºnetlinkçš„å½¢å¼ï¼ˆä¸æ¥å£sock_diagç›¸åŒï¼šäºŒè¿›åˆ¶ä¸”å¯æ‰©å±•ï¼‰ï¼› </li><li> åœ¨ä¸€ä¸ªå‘¼å«ä¸­è¯·æ±‚æœ‰å…³è®¸å¤šè¿›ç¨‹çš„ä¿¡æ¯çš„èƒ½åŠ›ï¼› </li><li> ä¼˜åŒ–çš„å±æ€§åˆ†ç»„ï¼ˆç»„ä¸­çš„ä»»ä½•å±æ€§éƒ½ä¸åº”å¢åŠ å“åº”æ—¶é—´ï¼‰ã€‚ </li></ul><br><p> æ­¤æ¥å£å·²åœ¨å¤šä¸ªä¼šè®®ä¸Šä»‹ç»è¿‡ã€‚ ä½œä¸ºå®éªŒï¼Œå®ƒå·²é›†æˆåˆ°pstoolsï¼ŒCRIUå®ç”¨ç¨‹åºä¸­ï¼Œè€ŒDavid Ahernå°†task_diagé›†æˆåˆ°perfä¸­ã€‚ </p><br><p> å†…æ ¸å¼€å‘ç¤¾åŒºå·²ç»å¯¹task_diagæ¥å£æ„Ÿå…´è¶£ã€‚ è®¨è®ºçš„ä¸»è¦ä¸»é¢˜æ˜¯å†…æ ¸å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´ä¼ è¾“çš„é€‰æ‹©ã€‚ ä½¿ç”¨netlinkå¥—æ¥å­—çš„æœ€åˆæƒ³æ³•è¢«æ‹’ç»äº†ã€‚ éƒ¨åˆ†åŸå› æ˜¯netlinkå¼•æ“æœ¬èº«çš„ä»£ç ä¸­æœªè§£å†³çš„é—®é¢˜ï¼Œéƒ¨åˆ†åŸå› æ˜¯è®¸å¤šäººè®¤ä¸ºnetlinkæ¥å£æ˜¯ä¸“é—¨ä¸ºç½‘ç»œå­ç³»ç»Ÿè®¾è®¡çš„ã€‚ ç„¶åæå‡ºäº†åœ¨procfsä¸­ä½¿ç”¨äº‹åŠ¡æ€§æ–‡ä»¶çš„æ–¹æ³•ï¼Œå³ç”¨æˆ·æ‰“å¼€æ–‡ä»¶ï¼Œå°†è¯·æ±‚å†™å…¥å…¶ä¸­ï¼Œç„¶åç®€å•åœ°è¯»å–ç­”æ¡ˆã€‚ åƒå¾€å¸¸ä¸€æ ·ï¼Œæœ‰äººåå¯¹è¿™ç§æ–¹æ³•ã€‚ ä¸€ä¸ªäººäººéƒ½å¸Œæœ›æ‰¾åˆ°çš„è§£å†³æ–¹æ¡ˆã€‚ </p><br><p> è®©æˆ‘ä»¬å°†task_diagæ€§èƒ½ä¸procfsè¿›è¡Œæ¯”è¾ƒã€‚ </p><br><p>  task_diagå¼•æ“å…·æœ‰ä¸€ä¸ªéå¸¸é€‚åˆæˆ‘ä»¬çš„å®éªŒçš„æµ‹è¯•å®ç”¨ç¨‹åºã€‚ å‡è®¾æˆ‘ä»¬è¦è¯·æ±‚è¿›ç¨‹æ ‡è¯†ç¬¦åŠå…¶æƒé™ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªè¿‡ç¨‹çš„è¾“å‡ºï¼š </p><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> ./task_diag_all one <span class="hljs-literal"><span class="hljs-literal">-c</span></span> <span class="hljs-literal"><span class="hljs-literal">-p</span></span> <span class="hljs-variable"><span class="hljs-variable">$</span></span><span class="hljs-variable"><span class="hljs-variable">$</span></span> pid <span class="hljs-number"><span class="hljs-number">2305</span></span> tgid <span class="hljs-number"><span class="hljs-number">2305</span></span> ppid <span class="hljs-number"><span class="hljs-number">2299</span></span> sid <span class="hljs-number"><span class="hljs-number">2305</span></span> pgid <span class="hljs-number"><span class="hljs-number">2305</span></span> comm bash uid: <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span> gid: <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span> CapInh: <span class="hljs-number"><span class="hljs-number">0000000000000000</span></span> CapPrm: <span class="hljs-number"><span class="hljs-number">0000000000000000</span></span> CapEff: <span class="hljs-number"><span class="hljs-number">0000000000000000</span></span> CapBnd: <span class="hljs-number"><span class="hljs-number">0000003</span></span>fffffffff</code> </pre> <br><p> ç°åœ¨ï¼Œå¯¹äºç³»ç»Ÿä¸­çš„æ‰€æœ‰è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯»å–/ proc / pid / statusæ–‡ä»¶æ—¶å¯¹procfså®éªŒæ‰€åšçš„ç›¸åŒæ“ä½œï¼š </p><br><pre> <code class="hljs pgsql">$ <span class="hljs-type"><span class="hljs-type">time</span></span> ./task_diag_all <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> -c <span class="hljs-type"><span class="hljs-type">real</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>m0<span class="hljs-number"><span class="hljs-number">.048</span></span>s <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>m0<span class="hljs-number"><span class="hljs-number">.001</span></span>s sys <span class="hljs-number"><span class="hljs-number">0</span></span>m0<span class="hljs-number"><span class="hljs-number">.046</span></span>s</code> </pre> <br><p> ä»…èŠ±è´¹0.05ç§’å³å¯è·å¾—æ•°æ®æ¥æ„å»ºæµç¨‹æ ‘ã€‚ ä½¿ç”¨procfsï¼Œæ¯ä¸ªè¿‡ç¨‹åªéœ€è¦èŠ±è´¹0.177ç§’å³å¯æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œæ— éœ€è¯»å–æ•°æ®ã€‚ </p><br><p>  task_diagæ¥å£çš„Perfè¾“å‡ºï¼š </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 82<span class="hljs-selector-class"><span class="hljs-selector-class">.24</span></span>% 0<span class="hljs-selector-class"><span class="hljs-selector-class">.00</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">task_diag_all</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[kernel.vmlinux]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[k]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">entry_SYSCALL_64_fastpath</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">entry_SYSCALL_64_fastpath</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 81<span class="hljs-selector-class"><span class="hljs-selector-class">.84</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">sys_read</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">vfs_read</span></span> __<span class="hljs-selector-tag"><span class="hljs-selector-tag">vfs_read</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">proc_reg_read</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">task_diag_read</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">taskdiag_dumpit</span></span> + 33<span class="hljs-selector-class"><span class="hljs-selector-class">.84</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">next_tgid</span></span> 13<span class="hljs-selector-class"><span class="hljs-selector-class">.06</span></span>% __<span class="hljs-selector-tag"><span class="hljs-selector-tag">task_pid_nr_ns</span></span> + 6<span class="hljs-selector-class"><span class="hljs-selector-class">.63</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">ptrace_may_access</span></span> + 5<span class="hljs-selector-class"><span class="hljs-selector-class">.68</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">from_kuid_munged</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> 4<span class="hljs-selector-class"><span class="hljs-selector-class">.19</span></span>% __<span class="hljs-selector-tag"><span class="hljs-selector-tag">get_task_comm</span></span> 2<span class="hljs-selector-class"><span class="hljs-selector-class">.90</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">strncpy</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.29</span></span>% _<span class="hljs-selector-tag"><span class="hljs-selector-tag">raw_spin_lock</span></span> 3<span class="hljs-selector-class"><span class="hljs-selector-class">.03</span></span>% __<span class="hljs-selector-tag"><span class="hljs-selector-tag">nla_reserve</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.73</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">nla_reserve</span></span> + 1<span class="hljs-selector-class"><span class="hljs-selector-class">.30</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">skb_copy_datagram_iter</span></span> + 1<span class="hljs-selector-class"><span class="hljs-selector-class">.21</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">from_kgid_munged</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.12</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">strncpy</span></span></code> </pre> <br><p> é™¤äº†æ²¡æœ‰æ˜æ˜¾çš„å‡½æ•°é€‚åˆä¼˜åŒ–ä¹‹å¤–ï¼Œæ¸…å•æœ¬èº«æ²¡æœ‰ä»€ä¹ˆæœ‰è¶£çš„ä¸œè¥¿ã€‚ </p><br><p> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¯»å–æœ‰å…³ç³»ç»Ÿä¸­æ‰€æœ‰è¿›ç¨‹çš„ä¿¡æ¯æ—¶çš„perfè¾“å‡ºï¼š </p><br><pre> <code class="hljs pgsql"> $ perf trace -s ./task_diag_all <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> -c -q <span class="hljs-keyword"><span class="hljs-keyword">Summary</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> events: task_diag_all (<span class="hljs-number"><span class="hljs-number">54326</span></span>), <span class="hljs-number"><span class="hljs-number">185</span></span> events, <span class="hljs-number"><span class="hljs-number">95.4</span></span>% syscall calls total min avg max stddev (msec) (msec) (msec) (msec) (%) <span class="hljs-comment"><span class="hljs-comment">--------------- -------- --------- --------- --------- --------- ------ read 49 40.209 0.002 0.821 4.126 9.50% mmap 11 0.051 0.003 0.005 0.007 9.94% mprotect 8 0.047 0.003 0.006 0.009 10.42% openat 5 0.042 0.005 0.008 0.020 34.86% munmap 1 0.014 0.014 0.014 0.014 0.00% fstat 4 0.006 0.001 0.002 0.002 10.47% access 1 0.006 0.006 0.006 0.006 0.00% close 4 0.004 0.001 0.001 0.001 2.11% write 1 0.003 0.003 0.003 0.003 0.00% rt_sigaction 2 0.003 0.001 0.001 0.002 15.43% brk 1 0.002 0.002 0.002 0.002 0.00% prlimit64 1 0.001 0.001 0.001 0.001 0.00% arch_prctl 1 0.001 0.001 0.001 0.001 0.00% rt_sigprocmask 1 0.001 0.001 0.001 0.001 0.00% set_robust_list 1 0.001 0.001 0.001 0.001 0.00% set_tid_address 1 0.001 0.001 0.001 0.001 0.00%</span></span></code> </pre> <br><p> å¯¹äºprocfsï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œ150,000æ¬¡ä»¥ä¸Šçš„ç³»ç»Ÿè°ƒç”¨ä»¥è·å–æœ‰å…³æ‰€æœ‰è¿›ç¨‹çš„ä¿¡æ¯ï¼Œå¯¹äºtask_diagï¼Œåˆ™éœ€è¦è¿›è¡Œ50æ¬¡ä»¥ä¸Šçš„è°ƒç”¨ã€‚ </p><br><p> è®©æˆ‘ä»¬çœ‹çœ‹ç°å®ç”Ÿæ´»ä¸­çš„æƒ…å†µã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦æ˜¾ç¤ºä¸€ä¸ªè¿›ç¨‹æ ‘ä»¥åŠæ¯ä¸ªå‘½ä»¤è¡Œçš„å‘½ä»¤è¡Œå‚æ•°ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦æå–è¿›ç¨‹çš„pidï¼Œå…¶çˆ¶è¿›ç¨‹çš„pidå’Œå‘½ä»¤è¡Œå‚æ•°æœ¬èº«ã€‚ </p><br><p> å¯¹äºtask_diagæ¥å£ï¼Œç¨‹åºå‘é€ä¸€ä¸ªè¯·æ±‚ä»¥ä¸€æ¬¡è·å–æ‰€æœ‰å‚æ•°ï¼š </p><br><pre> <code class="hljs go">$ time ./task_diag_all all --cmdline -q <span class="hljs-built_in"><span class="hljs-built_in">real</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>m0<span class="hljs-number"><span class="hljs-number">.096s</span></span> user <span class="hljs-number"><span class="hljs-number">0</span></span>m0<span class="hljs-number"><span class="hljs-number">.006s</span></span> sys <span class="hljs-number"><span class="hljs-number">0</span></span>m0<span class="hljs-number"><span class="hljs-number">.090s</span></span></code> </pre> <br><p> å¯¹äºåŸå§‹çš„procfsï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªè¿›ç¨‹è¯»å–/ proc //çŠ¶æ€å’Œ/ proc // cmdlineï¼š <br></p><pre> <code class="hljs go">$ time ./task_proc_all status tasks: <span class="hljs-number"><span class="hljs-number">50278</span></span> <span class="hljs-built_in"><span class="hljs-built_in">real</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>m0<span class="hljs-number"><span class="hljs-number">.463s</span></span> user <span class="hljs-number"><span class="hljs-number">0</span></span>m0<span class="hljs-number"><span class="hljs-number">.030s</span></span> sys <span class="hljs-number"><span class="hljs-number">0</span></span>m0<span class="hljs-number"><span class="hljs-number">.427s</span></span></code> </pre> <br><pre> <code class="hljs go">$ time ./task_proc_all cmdline tasks: <span class="hljs-number"><span class="hljs-number">50281</span></span> <span class="hljs-built_in"><span class="hljs-built_in">real</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>m0<span class="hljs-number"><span class="hljs-number">.270s</span></span> user <span class="hljs-number"><span class="hljs-number">0</span></span>m0<span class="hljs-number"><span class="hljs-number">.028s</span></span> sys <span class="hljs-number"><span class="hljs-number">0</span></span>m0<span class="hljs-number"><span class="hljs-number">.237s</span></span></code> </pre> <br><p> å¾ˆå®¹æ˜“æ³¨æ„åˆ°task_diagæ¯”procfså¿«7å€ï¼ˆ0.096å¯¹0.27 + 0.46ï¼‰ã€‚ é€šå¸¸ï¼Œå°†æ€§èƒ½æé«˜å‡ ä¸ªç™¾åˆ†ç‚¹å·²ç»æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç»“æœï¼Œä½†æ˜¯è¿™é‡Œçš„é€Ÿåº¦å‡ ä¹æé«˜äº†ä¸€ä¸ªæ•°é‡çº§ã€‚ </p><br><p> è¿˜å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå†…éƒ¨å†…æ ¸å¯¹è±¡çš„åˆ›å»ºä¹Ÿä¼šæå¤§åœ°å½±å“æ€§èƒ½ã€‚ ç‰¹åˆ«æ˜¯åœ¨å†…å­˜å­ç³»ç»Ÿæ‰¿å—é‡è´Ÿè½½æ—¶ã€‚ æ¯”è¾ƒä¸ºprocfså’Œtask_diagåˆ›å»ºçš„å¯¹è±¡æ•°ï¼š </p><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> perf trace -<span class="hljs-literal"><span class="hljs-literal">-event</span></span> <span class="hljs-string"><span class="hljs-string">'kmem:*alloc*'</span></span> ./task_proc_all status <span class="hljs-number"><span class="hljs-number">2</span></span>&gt;&amp;<span class="hljs-number"><span class="hljs-number">1</span></span> | grep kmem | wc <span class="hljs-literal"><span class="hljs-literal">-l</span></span> <span class="hljs-number"><span class="hljs-number">58184</span></span> <span class="hljs-variable"><span class="hljs-variable">$</span></span> perf trace -<span class="hljs-literal"><span class="hljs-literal">-event</span></span> <span class="hljs-string"><span class="hljs-string">'kmem:*alloc*'</span></span> ./task_diag_all all <span class="hljs-literal"><span class="hljs-literal">-q</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>&gt;&amp;<span class="hljs-number"><span class="hljs-number">1</span></span> | grep kmem | wc <span class="hljs-literal"><span class="hljs-literal">-l</span></span> <span class="hljs-number"><span class="hljs-number">188</span></span></code> </pre> <br><p> å¦å¤–ï¼Œæ‚¨è¿˜éœ€è¦æ‰¾å‡ºåœ¨å¯åŠ¨ä¸€ä¸ªç®€å•è¿‡ç¨‹æ—¶åˆ›å»ºäº†å¤šå°‘ä¸ªå¯¹è±¡ï¼Œä¾‹å¦‚ï¼ŒçœŸæ­£çš„å®ç”¨ç¨‹åºï¼š </p><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> perf trace -<span class="hljs-literal"><span class="hljs-literal">-event</span></span> <span class="hljs-string"><span class="hljs-string">'kmem:*alloc*'</span></span> true <span class="hljs-number"><span class="hljs-number">2</span></span>&gt;&amp;<span class="hljs-number"><span class="hljs-number">1</span></span> | wc <span class="hljs-literal"><span class="hljs-literal">-l</span></span> <span class="hljs-number"><span class="hljs-number">94</span></span></code> </pre> <br><p>  Procfsåˆ›å»ºçš„å¯¹è±¡æ¯”task_diagå¤š600å€ã€‚ è¿™æ˜¯å½“å†…å­˜è´Ÿè½½å¾ˆé‡æ—¶procfså¦‚æ­¤ç³Ÿç³•çš„åŸå› ä¹‹ä¸€ã€‚ è‡³å°‘å› æ­¤å€¼å¾—å¯¹å…¶è¿›è¡Œä¼˜åŒ–ã€‚ </p><br><p> æˆ‘ä»¬å¸Œæœ›æœ¬æ–‡å°†å¸å¼•æ›´å¤šçš„å¼€å‘äººå‘˜æ¥ä¼˜åŒ–å†…æ ¸å­ç³»ç»Ÿçš„procfsçŠ¶æ€ã€‚ </p><br><p> éå¸¸æ„Ÿè°¢David Ahernï¼ŒAndy Lutomirskiï¼ŒStephen Hemmingï¼ŒOleg Nesterovï¼ŒW.Trevor Kingï¼ŒArnd Bergmannï¼ŒEric W.Biedermanä»¥åŠå…¶ä»–è®¸å¤šå¸®åŠ©å¼€å‘å’Œæ”¹è¿›task_diagç•Œé¢çš„äººã€‚ </p><br><p> æ„Ÿè°¢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">cromer</a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">k001</a>å’ŒStanislav Kinsburskyæ’°å†™æœ¬æ–‡çš„å¸®åŠ©ã€‚ </p><br><h1 id="ssylki"> å‚è€ƒæ–‡çŒ® </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://github.com/avagin/linux-task-diag/tree/v4.16-task-diag-20180427/tools/testing/selftests/task_diag</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://lwn.net/Articles/685791/</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://www.slideshare.net/KirKolyshkin/time-to-rethink-proc</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://www.slideshare.net/kolyshkin/speeding-up-ps-and-top</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://blog.linuxplumbersconf.org/2016/ocw/system/presentations/4599/original/Netlink-issues.pdf</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN418715/">https://habr.com/ru/post/zh-CN418715/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN418705/index.html">FutexåŸºç¡€</a></li>
<li><a href="../zh-CN418707/index.html">KDispatcher-è½»å·§æ–¹ä¾¿çš„æ—¥å¸¸äº‹ä»¶æ€»çº¿</a></li>
<li><a href="../zh-CN418709/index.html">éœ€è¦å¼ºè¿«è‡ªå·±ï¼šé©±åŠ¨ç¨‹åºå’Œç•Œé¢éšœç¢</a></li>
<li><a href="../zh-CN418711/index.html">ä»¤ç‰Œç®¡ç†å¯„å­˜å™¨1.0</a></li>
<li><a href="../zh-CN418713/index.html">æ”¹å–„ç»´åŸºç™¾ç§‘è´¨é‡çš„æ¸¸æˆ</a></li>
<li><a href="../zh-CN418717/index.html">Unicodeå¹½çµ</a></li>
<li><a href="../zh-CN418721/index.html">ç—…æ¯’å·¥ç¨‹ä¼ å¥‡ï¼šæˆ˜äº‰çš„å¼€å§‹</a></li>
<li><a href="../zh-CN418723/index.html">ä¿®è¡¥AndroidX</a></li>
<li><a href="../zh-CN418725/index.html">é­”æ³•å¸¸æ•°</a></li>
<li><a href="../zh-CN418729/index.html">æ‚¨é•¿æœŸä»¥æ¥åœ¨ä¸€ä¸ªç‰ˆæœ¬ä¸­è¦æ±‚çš„æ‰€æœ‰å†…å®¹-CLion 2018.2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>