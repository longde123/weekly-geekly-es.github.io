<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëØ ü§£ ‚òòÔ∏è D√©mo de d√©veloppement pour NES - HEOHdemo üë©üèΩ‚Äçü§ù‚Äçüë®üèº ‚õ≤Ô∏è üèöÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'histoire des festivals d'art informatique, √©galement connue sous le nom de demopati, existe depuis un quart de si√®cle dans notre pays. Des gens de p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>D√©mo de d√©veloppement pour NES - HEOHdemo</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474960/">  L'histoire des festivals d'art informatique, √©galement connue sous le nom de demopati, existe depuis un quart de si√®cle dans notre pays.  Des gens de partout dans le pays se rassemblent pour montrer leurs exercices pour extraire l'impossible des ordinateurs anciens ou modernes et des quantit√©s ultra-petites de code.  Au cours de la premi√®re p√©riode de cinq ans, le <i>CAFe</i> (du coup, <i>Computer Art Festival</i> ), qui s'est tenu √† Kazan de 1999 √† 2003, est devenu l'une des principales d√©mopathies du pays.  Plus tard, il a longtemps disparu des radars, donnant la paume aux plus c√©l√®bres <i>Constructions Chaos</i> et <i>DiHalt</i> , et cette ann√©e son retour a √©t√© assez triomphant - sinon par l'ampleur de l'√©v√©nement, puis par le nombre d'≈ìuvres diverses, qui ont dur√© jusqu'√† six heures du matin.  Parmi eux se trouvait la mienne, dont la cr√©ation sera discut√©e dans cet article. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/338r2BRYg3A" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  Sur la demoscene, je suis plus sympathique qu'un participant actif.  Mes int√©r√™ts principaux sont dans le d√©veloppement de jeux r√©tro et de logiciels sonores.  Plus t√¥t, je n'ai fait qu'une seule <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©mo</a> conditionnelle compl√®te <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pour un t√©l√©phone rouge</a> , qui est depuis devenu un m√®me de sc√®ne, et environ une douzaine de petites intros pour diff√©rentes plates-formes.  Les organisateurs de la <i>CAFe</i> , qui avaient commenc√© √† <i>agiter</i> personnellement les auteurs √† l'avance, d'abord √† distance, par le biais d'amis communs, puis lors de r√©unions personnelles, m'ont finalement motiv√© √† cr√©er mon premier v√©ritable travail √† part enti√®re dans la cat√©gorie d√©mo compl√®te.  En fait, sur une autre plate-forme pas la plus populaire - la console de jeu <i>NES</i> / <i>Famicom</i> , connue par la plupart sous le nom de Dandy. <br><br><h2>  Planification </h2><br>  Au d√©part, j'allais faire une d√©mo con√ßue depuis longtemps pour une autre plate-forme 8 bits plus populaire.  Mais pour sa mise en ≈ìuvre, il a fallu effectuer une quantit√© importante de travaux de recherche, c'est-√†-dire qu'il n'y avait aucune compr√©hension ni du calendrier, ni de la faisabilit√© fondamentale de l'id√©e, ni de la qualit√© du r√©sultat possible.  Par cons√©quent, des actions sp√©cifiques ont √©t√© prises tr√®s lentement.  Les d√©lais ont commenc√© √† s'√©puiser de mani√®re significative, et il est devenu clair que si je veux tenir la promesse de participation, il est urgent de choisir un autre projet, plus pr√©visible en cours d'ex√©cution.  Apr√®s avoir r√©fl√©chi √† la deuxi√®me id√©e, pour la cat√©gorie <i>Wild</i> , qui n√©cessitait √©galement de l'exp√©rimentation, j'ai d√©cid√© de revenir aux blancs de d√©monstration de longue date pour <i>NES</i> , r√©alis√©s il y a trois ans, puis pour le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Multimatograph</a> .  En cons√©quence, elles-m√™mes n'√©taient pas vraiment utilis√©es, mais la direction du travail a finalement √©t√© d√©termin√©e. <br><br>  Le plan de travail sp√©cifique pour <i>NES a</i> finalement <i>√©t√©</i> approuv√© d√©but octobre, jusqu'√† <i>ce</i> que <i>CAFe</i> soit dans environ trois semaines.  Le dossier du projet a √©t√© cr√©√© le 5 octobre, mais certains mouvements ont eu lieu avant cela. <br><br>  La premi√®re question √† r√©soudre √©tait de savoir combien d'effets (sc√®nes) √©taient n√©cessaires pour que la dur√©e de la d√©mo soit suffisante pour revendiquer une grande forme, plut√¥t qu'une simple intro.  Il fallait √©galement comprendre quelle √©tait cette dur√©e suffisante. <br>  Pour cela, entre autres, les meilleurs travaux actuels pour la plate-forme s√©lectionn√©e sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Pouet ont √©t√© examin√©s</a> et les deux meilleurs ont √©t√© analys√©s - <i>High Hopes</i> et <i>NESPECCY</i> .  Le dernier, qui est une invitation √† la m√™me d√©mopati, a √©t√© publi√© en d√©cembre 2018, et jusqu'√† ce moment-l√†, je n'avais pas attir√© mon attention.  Au d√©but, cela a m√™me quelque peu touch√© la motivation, car j'ai initialement suppos√© un niveau plus facile pour mon travail futur. <br><br>  Selon les r√©sultats de l'analyse, il s'est av√©r√© que dans <i>High Hopes il y a</i> environ six effets et une dur√©e de 2:45, et dans <i>NESPECCY</i> environ 11 effets et une dur√©e de 3:45.  C'est une moyenne d'environ 25 secondes par effet.  J'ai sugg√©r√© qu'en moyenne, 10 √† 15 effets suffiraient, en supposant que seulement 3 √† 5 d'entre eux seraient relativement compliqu√©s techniquement, et le reste peut √™tre simple mais assez satisfaisant.  Afin de ne pas retarder l'affichage de sc√®nes simples, il se passera en moyenne environ 15 secondes par effet, avec la dur√©e totale de la d√©mo en environ deux ou trois minutes. <br><br>  Cela a √©t√© suivi d'un calcul du temps qui peut √™tre consacr√© √† la cr√©ation de chaque effet.  Il s'est av√©r√© un jour et demi √† deux jours, sans compter les nombreuses autres ≈ìuvres n√©cessaires, telles que la musique, le graphisme, une sorte d'id√©e, et juste pr√©parer une base technique qui combine les effets.  Un tel calendrier ne semblait pas tr√®s r√©aliste, mais j'ai d√©cid√© de faire autant d'effets que possible, en essayant de tenir dans deux jours pour chacun. <br><br>  Ainsi, la t√¢che prioritaire a √©t√© d√©termin√©e - √™tre capable de faire dans le temps au moins quelque chose qui convient √† la participation √† la comp√©tition, ainsi que le mode de d√©veloppement dans le style ¬´pas de temps pour expliquer¬ª.  Cela a √©galement exclu le journal de d√©veloppement, et maintenant vous devez r√©cup√©rer les √©v√©nements de la m√©moire, en essayant de ne pas trop mentir. <br><br>  La t√¢che de faire le travail, revendiquant la premi√®re place, n'a pas √©t√© pos√©e.  L'essentiel n'est pas la victoire, mais la participation et tout √ßa, et en g√©n√©ral la victoire principale est au-dessus de soi.  Je n'ai pas fait de pr√©visions sp√©ciales sur la base des r√©sultats du concours pour l'impopularit√© de la cat√©gorie s√©lectionn√©e, en m'attendant √† ce que dans le pire (meilleur) cas de participation au concours de plusieurs travaux assez forts, le mien deviendra des compo fillers, qui sont √©galement n√©cessaires et importants, et s'il n'y a pas de travaux, alors je le referai un gagnant parmi lui, comme cela s'est d√©j√† produit dans d'autres disciplines.  Bien s√ªr, je voulais gagner un combat d√©cent, mais j'ai moi-m√™me √©valu√© mon travail moins que ce que le public avait finalement estim√©. <br><br><h2>  Code </h2><br>  Apr√®s que les d√©lais ont √©t√© fix√©s, il est devenu clair que pour avoir le temps de soulever un tel projet, il fallait se rattacher √† un perfectionnisme inappropri√© et ne pas essayer de faire le code de d√©monstration le plus technologique ou le plus compact.  Plus c'est simple et rapide, mieux c'est, tout en conservant un effet ext√©rieur suffisant. <br><br>  Il a √©t√© d√©cid√© de choisir une configuration assez puissante et m√™me redondante - un mappeur <i>MMC3</i> avec 256 kilo-octets de code ROM et 256 kilo-octets de graphiques graphiques, et essayez de ne pas craindre que son plein potentiel reste inexploit√©.  Cette configuration n'est pas la plus avanc√©e de l'existant et encore plus possible, elle a √©t√© largement utilis√©e dans les jeux commerciaux, √† commencer par <i>Super Mario Bros.</i>  <i>3</i> (1988), mais auparavant, les auteurs de la d√©mo pour <i>NES se</i> limitaient √† des mappeurs plus simples et √† moins de m√©moire.  En cons√©quence, 80% du volume du code ROM a √©t√© utilis√© et un peu moins des deux tiers du volume des graphiques ROM.  La quantit√© excessive de m√©moire nous a permis de ne pas perdre de temps suppl√©mentaire √† r√©soudre le probl√®me de compression des donn√©es, bien qu'il ne puisse pas s'en passer. <br><br>  La m√©thode de d√©veloppement √©tait √©galement √©vidente - principalement en C, avec des insertions d'assembleur au besoin, principalement la copie dans la m√©moire vid√©o, les gestionnaires d'interruption et un lecteur de musique.  J'utilise depuis longtemps et avec succ√®s cette approche sur des plateformes r√©tro.  Cela √©conomise beaucoup de temps de d√©veloppement, car le prototypage de code peut √™tre fait localement: impl√©mentez-le d'abord en C et obtenez imm√©diatement un r√©sultat qui fonctionne sur <i>NES</i> , puis, s'il ne fonctionne pas assez rapidement, r√©√©crivez-le en pi√®ces dans l'assembleur selon un mod√®le d√©j√† pr√©par√©, jusqu'√† La vitesse requise a √©t√© atteinte. <br><br><img src="https://habrastorage.org/webt/tm/ii/gj/tmiigjgzmohxusl9gll2p7hqrqe.png"><br><br>  L'un des principaux probl√®mes attendus, qui, cependant, n'a pas caus√© beaucoup de probl√®mes dans la pratique, √©tait la quantit√© de RAM principale - √† <i>NES,</i> ce n'est que de 2 kilo-octets, et dans mon travail, j'ai d√©cid√© de ne pas l'√©tendre, bien que le mappeur ait essentiellement permis ce mouvement.  La m√©moire des syst√®mes bas√©s sur le <i>processeur 6502,</i> compte tenu de sa capacit√© totale de huit bits, est souvent consid√©r√©e comme des pages de 256 octets, et la r√©partition de la RAM s'est r√©v√©l√©e comme suit: <br><br><ul><li>  Une page pour les variables ¬´rapides¬ª; </li><li>  Une page pour la pile et la palette mat√©rielles (une partie importante de la pile n'est pas utilis√©e); </li><li>  Une page pour le tampon de liste de sprites (les fonctionnalit√©s de l'architecture du contr√¥leur vid√©o l'exigent); </li><li>  Une page pour une liste des mises √† jour de la m√©moire vid√©o; </li><li>  Une page pour une liste de param√®tres pour les effets raster. </li></ul><br>  Les deux derniers sont d√©clar√©s dans le programme sous la forme de tableaux de caract√®res non sign√©s ordinaires de 256 octets et, √† certains endroits, sont √©galement r√©utilis√©s √† d'autres fins.  Les trois pages restantes sont donn√©es sous la pile du programme <i>cc65</i> , c'est-√†-dire sous les variables globales et locales du programme C. <br><br>  Il est √† noter que l'allocation dynamique de m√©moire (malloc / free) sur de telles plateformes n'est pratiquement pas utilis√©e, une solution statique √©tait n√©cessaire.  Au d√©but, j'ai adh√©r√© √† la m√©thode d'utilisation d'autant de variables locales que possible, ce qui m'a permis de r√©utiliser automatiquement la m√©moire de la pile logicielle pour elles.  Mais les variables locales fonctionnent beaucoup plus lentement, et en cons√©quence, le volume disponible pour les variables globales a commenc√© √† manquer, et il √©tait simplement inconfortable d'√©crire du code de cette mani√®re, en utilisant √† plusieurs reprises des variables du m√™me nom.  J'ai ensuite appliqu√© une solution inutilis√©e auparavant: une annonce dans la configuration de l'√©diteur de liens de plusieurs segments de RAM situ√©s physiquement aux m√™mes adresses.  Des groupes de variables utilis√©es dans le m√™me effet ont √©t√© plac√©s √† l'aide de directives de compilation dans ces segments, permettant la r√©utilisation de la m√™me m√©moire. <br><br>  Un autre probl√®me - la distribution du code du programme C par les banques de m√©moire de code ( <i>NES</i> utilise l'adressage de page pour la m√©moire √©tendue) - a √©t√© r√©solu par moi dans d'autres projets et n'a pas caus√© de probl√®mes.  Le code de placement dans les pages est limit√© √† 16 kilo-octets (la taille de la fen√™tre de m√©moire commutable) dans une section fonctionnellement compl√©t√©e et est appel√© par la m√©thode de superposition: la page souhait√©e est connect√©e, le code est trait√©, l'ex√©cution revient √† la page principale et l'acc√®s √† la m√©moire entre les pages est impossible.  Les fonctions sont allou√©es aux banques manuellement, via les directives du compilateur.  Le code requis dans toutes les parties du programme, comme un lecteur de musique, une sortie de sprite et des gestionnaires d'interruption, se trouve dans la fen√™tre de m√©moire non commutable sup√©rieure, √©galement de 16 kilo-octets. <br><br>  En travaillant sur le dernier effet, le couloir avec Mario, je suis tomb√© sur un message d'erreur de compilation divertissant: <i>d√©bordement d'√©tiquette locale</i> .  Si je comprends bien, le compilateur a une limite interne sur le nombre d'√©tiquettes locales g√©n√©r√©es (apparemment 65536) √† l'int√©rieur d'un module objet, mais j'ai utilis√© un module commun pour simplifier la gestion de la m√©moire partag√©e.  L'une des solutions possibles √©tait de diviser le code en plusieurs modules, et j'avais d√©j√† pr√©vu de l'appliquer, cependant, apr√®s avoir d√©plac√© un tableau de constantes de la source vers C dans la partie assembleur ( <i>incbin</i> avec une √©tiquette externe), le probl√®me a √©t√© r√©solu par lui-m√™me, la limite a cess√© d'√™tre d√©pass√©e, et m√™me apr√®s l'ajout quelques centaines de lignes de code suppl√©mentaires, un message d'erreur ne s'est plus produit. <br><br><h2>  D√©veloppement </h2><br>  Dans le choix des effets, il √©tait pr√©vu de nous limiter √† une utilisation simple, mais toujours fluide, √† pleine vitesse d'affichage (60 images par seconde).  Les effets de d√©monstration traditionnels tels que le plasma et les rotateurs de zoom n'ont pas √©t√© initialement pris en compte, car ils ne cadrent pas bien avec l'architecture du d√©codeur, qui a des restrictions importantes sur l'acc√®s √† la m√©moire vid√©o - cela aurait l'air moche par rapport aux plates-formes o√π de tels effets sont impl√©ment√©s √† plusieurs reprises dans toute sa splendeur. <br><br>  Au d√©but, je voulais faire la majeure partie des effets selon un plan vieux de trois ans, bas√© sur des manipulations ligne par ligne avec le raster affich√© - en changeant le d√©placement vertical et horizontal de chaque ligne, ainsi que les banques du graphique affich√©, pendant que le rayon traverse le raster.  Une telle approche pourrait fonctionner sur la base d'un bloc de code commun, ce qui permettrait de gagner du temps de d√©veloppement, mais les effets se r√©v√©leraient assez uniformes, et √©galement assez traditionnels, que l'on trouve dans de nombreux autres travaux.  De plus, il y avait des difficult√©s √† d√©boguer ce bloc g√©n√©ral de code, et en cons√©quence, la d√©mo ne comprenait qu'un seul effet de ce type, une cartouche rotative. <br><br>  Jouant avec quelques effets bas√©s sur de vieilles id√©es, dont l'un est finalement devenu l'effet Kirby, et le second n'est pas entr√© dans la d√©mo, j'ai commenc√© √† √©crire un document texte o√π j'ai not√© toutes les id√©es qui me venaient √† la t√™te, √† la fois pour les effets individuels et pour le concept g√©n√©ral.  Cette liste comprenait plus de 40 effets, tandis que dans le travail final, moins de 15 ont √©t√© mis en ≈ìuvre. En m√™me temps, la plupart des effets sont des animations d'un type ou d'un autre, bien que chacune de ses variantes soit assez unique et utilise diverses astuces pour assurer une consommation de m√©moire acceptable et le bon fonctionnement requis. .  Il est √©galement arriv√© involontairement que le type d'effets pr√©dominant soit la rotation de quelque chose.  En principe, c'est une bonne co√Øncidence, car une sorte d'unit√© conceptuelle est apparue. <br><br>  Une intro avec un √©l√©phant a √©t√© con√ßue et r√©alis√©e, comme une blague sur le sujet de mon travail pr√©c√©dent, puis un effet avec des rayures color√©es et des interf√©rences.  Sans beaucoup de r√©flexion, le titre de travail, <i>HEOHdemo</i> , a √©t√© choisi comme une continuation de la blague de l'introduction (HE IS NOT HE).  Quand il est venu √† la r√©alisation de la sc√®ne avec la pr√©sentation du nom, il a √©t√© approuv√© comme final, car il n'y avait plus d'id√©es r√©ussies √† ce moment-l√† et il n'y avait pas de temps pour les proposer. <br><br>  Une d√©cision spontan√©e avec la d√©mo du nom a incit√© le concept final de tout le travail, qui a finalement pris forme dix jours avant la date limite.  Cela impliquait l'utilisation de jeux vid√©o et de mat√©riel de culture pop reconnaissables, tels que des personnages, des logos, des sc√®nes de jeux, mais modifi√©s de mani√®re √† rendre les originaux un peu diff√©rents (comme ¬´pas eux¬ª).  Il a √©galement √©t√© d√©cid√© de diffuser l'humour des sc√®nes initiales et finales √† l'ensemble de la d√©mo, compensant ainsi le niveau technique pas tr√®s √©lev√©, ce qui est tout √† fait dans l'esprit de l'√©poque cit√©e (milieu des ann√©es 90), et fait appel √† un public plus large - apr√®s tout, les anciennes consoles de jeu ont leur propre, pas entrecoup√© de la demoscene et pas tr√®s √©clair√© en technologie, mais un public tr√®s vaste.  √Ä peu pr√®s √† la m√™me √©poque, il a √©t√© d√©cid√© d'utiliser la d√©mo inh√©rente des ann√©es 90 divis√©e en sc√®nes ind√©pendantes distinctes, car elles sont plus faciles √† faire dans le temps disponible, ce qui a ensuite grandement aid√© avec la partie musicale et la synchronisation des effets avec elle. <br><br>  Les id√©es de sc√®nes avec Vid, un logo rotatif et en partie avec Mario dans le couloir sont √©galement apparues naturellement pendant le travail.  Ils ont √©t√© fabriqu√©s √† leur tour, comme une sorte de procrastination - jusqu'√† ce que les principaux effets pr√©vus soient coll√©s. <br><br><h2>  Assemblage </h2><br>  Au d√©part, il √©tait clair que le temps le plus long dans le chronom√©trage prendrait part √† l'introduction, au titre, aux salutations et au g√©n√©rique final.  Le travail sur eux a √©t√© effectu√© en premier lieu, donc √† un moment donn√©, il s'est av√©r√© que la d√©mo avait d√©j√† un d√©but et une fin complets (les m√™mes que dans la version finale), mais il n'y a presque pas de terrain d'entente pour lequel un seul √©tait plus ou moins pr√™t effet.  Les d√©lais tiraient √† leur fin.  Le travail sur le projet s'est transform√© en un marathon de plusieurs heures, occupant tout le temps possible, et pas trop libre.  Les effets restants dans les plans ont √©t√© class√©s par complexit√©, toutes les id√©es ont √©t√© simplifi√©es autant que possible.  Des envahisseurs spatiaux ont √©t√© cr√©√©s, des probl√®mes avec une cartouche rotative ont √©t√© vaincus et une tour facile √† mettre en ≈ìuvre avec un craquement a √©t√© achev√©e (exp√©riment√©e avec l'apparence).  Les effets √©tant pr√™ts, la s√©quence de leur affichage a √©t√© d√©termin√©e. <br><br>  Chaque bagatelle a pris trois fois plus de temps qu'il n'y paraissait au d√©but, et quelques jours avant la date limite, alors qu'il n'y avait toujours pas la moiti√© des effets ou de la musique, il y avait un fort sentiment que cela ne marcherait pas.  Le plan B a √©t√© envisag√©, pour achever et exposer les travaux d√©j√† sur une autre d√©mopati, ou √† l'ext√©rieur.  Mais ensuite, une d√©cision plus efficace a √©t√© prise: rassembler et achever de toute urgence tout ce qui existe d√©j√†, au moins dans un semblant de produit pr√™t √† sortir, m√™me compl√®tement stupide, pour √©crire de la musique pour cela, et s'il reste encore du temps apr√®s cela, essayez d'ajouter plus d'effets.  Parmi ces sc√®nes ajout√©es au dernier moment se trouvaient Pakman et le couloir, tous deux dans la version la plus simplifi√©e par rapport aux id√©es originales. <br><br>  Cette m√©thode d'assemblage a conduit √† une incoh√©rence notable des effets au milieu de la d√©mo et √† un changement complet de musique entre de nombreuses sc√®nes.  Cependant, cela a permis de gagner beaucoup de temps et, en fait, le travail √©tait compl√®tement pr√™t √† √™tre publi√© un jour avant la date limite.  Ce temps suppl√©mentaire a √©t√© consacr√© √† la finalisation de diverses bagatelles dans toutes les parties et en musique.  En particulier, c'est √† cette √©poque que les envahisseurs et le crapaud ont acquis leur apparence alternative. <br><br><h2>  D√©bogage </h2><br>  Faute de capacit√©s de d√©bogage sur du mat√©riel r√©el, ainsi que sur le mat√©riel lui-m√™me, la d√©mo a √©t√© d√©bogu√©e exclusivement dans des √©mulateurs.  Le travail principal √©tait dans l'√©mulateur <i>FCEUX</i> .  Ce n'est pas tr√®s pr√©cis, mais il a un bon d√©bogueur et il d√©marre tr√®s rapidement, ce qui est important avec la m√©thode de d√©veloppement consistant √† "ajouter quelques lignes, ex√©cuter, v√©rifier".  Les effets critiques ont √©galement √©t√© d√©bogu√©s dans <i>Mesen</i> , <i>punes</i> et <i>Nestopia,</i> beaucoup plus pr√©cis mais moins pratiques. <br><br>  √âtant donn√© que le format de d√©monstration lui-m√™me implique le d√©sir d'obtenir de la plate-forme ce que personne ne faisait auparavant, il teste la pr√©cision des √©mulateurs pour la force, y compris en montrant leur d√©saccord sur divers cas extr√™mes.  Apr√®s avoir d√©bogu√© l'effet dans un √©mulateur, vous pouvez y ins√©rer des artefacts dans d'autres √©mulateurs.  Pour cette raison, et √©galement en raison des caract√©ristiques de l'architecture <i>NES</i> , de nombreux effets li√©s √† des temporisations pr√©cises ont d√ª √™tre d√©bogu√©s plusieurs fois.  Par cons√©quent, j'ai configur√© la d√©mo pour un travail propre dans l'√©mulateur <i>FCEUX</i> populaire, avec lequel elle a √©t√© envoy√©e au concours, et pour un travail normal dans tous les autres √©mulateurs. <br><br>  Parmi les erreurs int√©ressantes trouv√©es lors du d√©bogage, il y avait un probl√®me dans la sc√®ne avec un logo rotatif, se manifestant exclusivement dans l'√©mulateur <i>Mesen</i> .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Initialement, dans cet effet, le rendu a √©t√© d√©sactiv√© imm√©diatement sous l'inscription inspir√©e par le transfert d'un grand bloc de donn√©es vers la m√©moire vid√©o et ne s'est r√©activ√© qu'au d√©but de l'image suivante. Cela a bien fonctionn√© dans tous les √©mulateurs, mais √† </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mesen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , d' </font><i><font style="vertical-align: inherit;">une</font></i><font style="vertical-align: inherit;"> mani√®re incompr√©hensible, l'affichage de sprites de pi√®ces volantes a compl√®tement cess√© de fonctionner normalement. L'activation du rendu apr√®s le transfert a r√©solu ce probl√®me. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La d√©mo prend directement en charge uniquement la </font><font style="vertical-align: inherit;">version </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTSC</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la console, car la prise en charge </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PAL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cela augmenterait consid√©rablement la quantit√© de travail et le temps consacr√© au d√©bogage - certains effets n√©cessitent des param√®tres tr√®s diff√©rents, et pour pr√©server la dur√©e de la d√©mo et la vitesse de la musique, vous devrez cr√©er deux ensembles de donn√©es musicales et effectuer deux fois l'ajustement manuel des effets. Par cons√©quent, au d√©marrage, une d√©termination du syst√®me est effectu√©e et si une </font><font style="vertical-align: inherit;">version </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PAL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est d√©tect√©e, un avertissement est √©mis concernant un √©ventuel mauvais fonctionnement. La d√©mo elle-m√™me d√©marre, mais fonctionne avec de puissants artefacts visuels dans certains effets et est 17% plus lente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s la sortie, certains t√©l√©spectateurs ont ex√©cut√© des d√©mos sur diverses consoles r√©elles - l'American </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NES</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Famicom AV</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et m√™me </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pegasus</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (un analogue de notre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dendy Classic 2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en Pologne, en R√©publique tch√®que et dans certains autres pays). Il s'est av√©r√© que sur toutes les consoles, la d√©mo fonctionne g√©n√©ralement normalement, mais avec des probl√®mes visuels dans certaines sc√®nes, et plus int√©ressant encore, ces probl√®mes sont diff√©rents pour tout le monde. Certains d'entre eux sont probablement li√©s √† la mise en ≈ìuvre insuffisamment pr√©cise du </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mappeur</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MMC3 </font><font style="vertical-align: inherit;">dans les </font><font style="vertical-align: inherit;">cartouches </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flash</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> populaires </font><font style="vertical-align: inherit;">, car le moins de probl√®mes sont survenus sur une cartouche conventionnelle avec un vrai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MMC3</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . La configuration la moins probl√©matique suivante √©tait </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pegasus</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, bien que la d√©mo l√†-bas n'aurait pas d√ª fonctionner normalement en principe - elle ne montre qu'un petit artefact sur la sc√®ne avec Mario. √Ä ma grande surprise, l'effet le plus difficile √† d√©boguer et √† synchroniser - la cartouche rotative - fonctionne de mani√®re stable sur n'importe quelle configuration de fer de test. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les probl√®mes rencontr√©s sur le mat√©riel ne sont pas critiques, et finalement la version finale sera publi√©e, o√π ils seront corrig√©s. Mais pour cela, il reste √† voir lequel des probl√®mes se rapporte sp√©cifiquement au code de d√©monstration, et laquelle des fonctionnalit√©s des configurations de test. Apr√®s cela, les informations obtenues peuvent √™tre utilis√©es pour am√©liorer la qualit√© des √©mulateurs et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cartouches </font><i><font style="vertical-align: inherit;">Flash</font></i><font style="vertical-align: inherit;"> .</font></font><br><br><h2>  La musique </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le travail sur la musique a commenc√© par la s√©lection d'un th√®me du programme "New Reality" et tente de le croiser avec "Glory". Ce processus a pris un temps ind√©cent. Ensuite, AON a inspir√© l'id√©e de faire des tambours dans la premi√®re partie de la d√©mo sous la forme de signaux saccad√©s simples de deux hauteurs diff√©rentes, et un fragment de musique avec de tels tambours pour un effet appel√© d√©mo a √©t√© grossi√®rement esquiss√©. L'id√©e a √©galement surgi que le m√™me fragment, mais dans un arrangement diff√©rent, pourrait √™tre utilis√© dans la partie avec des salutations, comme un semblant d'un th√®me musical g√©n√©ral. Pour la plupart, le travail sur la musique s'est arr√™t√© l√†, et le reste a √©t√© √©crit deux jours avant la date limite. Dans le m√™me temps, un ajustement conjoint des effets et du mat√©riel musical a √©t√© effectu√©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Malgr√© les modestes capacit√©s du syst√®me audio </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NES</font></font></i> ,       ,     ,       -.       ,   ,      ,       ,    ,      .               ,            . <br><br>      Reaper   MIDI-,         ,    <i>FamiTracker</i> .          MIDI-,   Reaper,  <i>FamiTracker</i>      . <br><br><img src="https://habrastorage.org/webt/_9/ey/on/_9eyonr2ehc6tms7pumjf6_suww.png"><br><br>     <i>FamiTracker</i>     <i>NES</i> ,      ,      ,              ‚Äî  ,     .     ,      .      , ¬´¬ª   <i>FamiTracker</i> ' <i>NSF</i> -        .  ,        ,   <i>NES</i>         . <br><br>             .            .     <i>FamiTracker</i>  <i>Zxx</i> ,          . <br><br><h2>   </h2><br><h3>    </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le code est emprunt√© √† un ancien projet. </font><font style="vertical-align: inherit;">La partie apparaissant de la ligne est affich√©e avec des sprites avec diff√©rentes palettes, puis imprim√©e en arri√®re-plan. </font><font style="vertical-align: inherit;">L'inscription ¬´bas√©e sur des effets r√©els¬ª laisse entendre que d'autres effets ne sont pas comme √ßa, c'est une blague sur le sujet d'un d√©bat constant sur l'acceptabilit√© et le r√¥le de l'animation dans la d√©mo.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Intro avec √©l√©phant et ligne rampante </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'id√©e de l'effet a √©volu√© d'un court encart commen√ßant imm√©diatement par une ligne en cours d'ex√©cution √† une sc√®ne √† part enti√®re. </font><font style="vertical-align: inherit;">Le premier personnage est donc apparu dans la d√©mo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Techniquement, la sc√®ne est tr√®s simple, la principale difficult√© est la conversion des </font><font style="vertical-align: inherit;">graphiques </font><font style="vertical-align: inherit;">dessin√©s dans </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Graphics Gale</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en un sprite multicouche pour y fournir un nombre inhabituellement √©lev√© de couleurs (10). </font><font style="vertical-align: inherit;">Seulement quatre couches, chacune avec sa propre palette. </font><font style="vertical-align: inherit;">Les couches </font><font style="vertical-align: inherit;">sont </font><font style="vertical-align: inherit;">converties </font><font style="vertical-align: inherit;">individuellement </font><font style="vertical-align: inherit;">en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NES Screen Tool</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et empil√©es manuellement dans un sprite commun dans l'√©diteur de m√©tasprite.</font></font><br><img src="https://habrastorage.org/webt/17/du/6q/17du6q0j7ycr-12h2port8vl3fe.png"><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Interf√©rence </font></font></h3><br>       ,        ,   ,     .     ,     ,   . <br><br>    8      32 ,     PC.        .    MMC3,      (   ),         ,    .       ,     . <br><br><img src="https://habrastorage.org/webt/bp/hf/rg/bphfrggmjg8mugiw5ftm3e4egzq.png"><br><br><h3>   </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le premier effet √† part enti√®re qui a √©t√© √©crit pour la d√©mo. En fait, il se compose de deux parties - une minuterie s'affiche tout d'abord, montrant la synchronisation de d√©monstration actuelle proche de la r√©alit√©, puis l'effet passe √† une animation de bandes croissantes.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bien que la minuterie soit visuellement tr√®s simple et que vous ne puissiez pas le remarquer d'un coup d'≈ìil, elle fait √©galement quelque chose d'inhabituel dans le cadre de la plate-forme. Les nombres sont de 12 x 16 pixels, mais la couche d'arri√®re-plan est constitu√©e de carreaux 8 x 8, et les images-objets ne peuvent pas couvrir plus d'un quart de la largeur de l'√©cran - tandis que le minuteur prend les deux tiers. Pour avoir la possibilit√© d'afficher une police qui ne rentre pas dans la grille, une astuce a √©t√© appliqu√©e - un graphique de toutes les paires de chiffres de 00 √† 99 a √©t√© pr√©par√©, puis converti en un ensemble de tuiles en supprimant les doublons - afin qu'il tienne dans une centaine et demi de tuiles. L'effet de chute de la minuterie est r√©alis√© par un simple d√©filement vertical. √âtant donn√© que les graphiques des barres de couleur sont un remplissage de couleur unie, leur mouvement n'appara√Æt pas visuellement.</font></font><br><br><img src="https://habrastorage.org/webt/ja/df/cd/jadfcdjkmvbebxayxhljf7sesye.png"><br><br>  ,    ,      MMC3,     ,                  . <br><br>          ,      32  .   238 ,      7 .        ,       ,     ,   53.    ,         PC,      ,           . <br><img src="https://habrastorage.org/webt/el/6k/0k/el6k0kaduc7xipn96mj54w39u3k.png"><br><br><h3>  Le titre </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au d√©but, deux autres effets plus complexes avec les m√™mes lettres pr√©tendaient √† cette sc√®ne; en cons√©quence, la troisi√®me option plus facile √† mettre en ≈ìuvre a √©t√© choisie. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La police est rectangulaire pour faciliter l'animation. Chaque lettre a essentiellement une hauteur de cinq pixels conventionnels et une largeur de quatre. Il existe cinq combinaisons diff√©rentes de pixels sur chaque ligne de la lettre. Blender a pr√©par√© une animation de rotation douce du bord au plan des cinq combinaisons. Les images sont combin√©es en un seul fichier, la couleur est r√©duite √† trois couleurs, apr√®s quoi l'image a √©t√© import√©e dans l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">outil d'√©cran NES</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - cela a donn√© un ensemble de 82 tuiles et une carte de tuiles pour l'animation elle-m√™me. En fait, il existe deux ensembles de ce type, pour faire pivoter les lettres dans des directions diff√©rentes.</font></font><br><br><img src="https://habrastorage.org/webt/gq/xs/wn/gqxswnend5wkbvqw3xea0i9l8zm.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La lettre rotative est affich√©e sur la carte des tuiles; elle est compos√©e de cinq bandes anim√©es requises. </font><font style="vertical-align: inherit;">Comme une seule animation de lettre est visible √† la fois, la couleur du visage peut √™tre modifi√©e, ce qui cr√©e l'illusion du multicolore. </font><font style="vertical-align: inherit;">Les lettres arrivant √† l'√©cran sur le bord sont affich√©es par des sprites, leurs coordonn√©es et vitesses sont s√©lectionn√©es tr√®s pr√©cis√©ment manuellement pour cr√©er la fluidit√© n√©cessaire et les changements de vitesse des objets. </font><font style="vertical-align: inherit;">Une fois que le sprite atteint l'emplacement souhait√© sur l'√©cran, il est remplac√© par une animation sur le calque d'arri√®re-plan. </font></font><br><br><img src="https://habrastorage.org/webt/9c/va/e_/9cvae_5fl8mhrfj7umgt_faqmhi.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les bandes horizontales volant √† des vitesses diff√©rentes sont r√©alis√©es via le gestionnaire d'interruption </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MMC3</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cette fois il d√©finit le d√©calage horizontal horizontal des pixels de la couche d'arri√®re-plan pour chaque ligne de tuiles.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Envahisseurs spatiaux </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'id√©e de cette sc√®ne tr√®s simple avec la rotation de grands pixels rassembl√©s dans une certaine image est venue plus pr√®s du d√©but du travail, et en m√™me temps </font><font style="vertical-align: inherit;">plusieurs options pour la rotation de l'animation ont √©t√© dessin√©es manuellement </font><font style="vertical-align: inherit;">dans </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gale</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">La sc√®ne elle-m√™me a √©t√© r√©alis√©e beaucoup plus tard, lorsque le concept de la d√©mo a finalement √©t√© √©tabli, et l'id√©e a sembl√© montrer des personnages cultes. </font></font><br><br><img src="https://habrastorage.org/webt/58/nv/ld/58nvldcfaj6upgcaap3x5fpbfsg.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les tuiles sont sorties en enregistrant dans la m√©moire vid√©o dans la couche d'arri√®re-plan. </font><font style="vertical-align: inherit;">Les √©toiles sont affich√©es par des sprites. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le caract√®re prolong√© de la sc√®ne s'explique par sa synchronisation avec la musique, selon l'image par battement. </font><font style="vertical-align: inherit;">Il n'y avait pas d'√©laboration sp√©ciale du temps pour montrer les effets, et sans y penser, il semblait que cela n'avait pas l'air tr√®s ennuyeux.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Logo rotatif </font></font></h3><br>  En raison du manque d'effets et du temps pour les d√©velopper, j'ai d√©cid√© de r√©utiliser une petite intro √©crite il y a quelques ann√©es, dans laquelle les lettres volaient le long du m√™me chemin autour d'un logo statique.  R√©cemment, je me suis de nouveau int√©ress√© au pr√©fixe <i>N64</i> , que j'ai n√©glig√© √† la fin des ann√©es 90, et dans le processus de travail sur d'autres effets, une id√©e spontan√©e est venue avec l'animation de la rotation du c√©l√®bre logo, qui semblait tr√®s simple √† mettre en ≈ìuvre - ces deux pens√©es se sont rencontr√©es, mais la mise en ≈ìuvre a pris beaucoup plus de temps que pr√©vu. <br><br>  La principale complexit√© technique de la sc√®ne est la r√©duction de la quantit√© de m√©moire requise pour une animation aussi fluide et large.  Si vous stockez ses images sans compression, une image occuperait un ensemble de 4 kilo-octets (puisque deux images ne tiendraient pas dans 256 tuiles), et cela prendrait 256 kilo-octets de ROM graphique, c'est-√†-dire tout le volume utilis√© dans le volume de d√©monstration.  Pour r√©soudre ce probl√®me, trois astuces ont √©t√© appliqu√©es √† la fois: animation de rotation √† seulement 90 degr√©s (64 images), apr√®s quoi deux couleurs de visage sont √©chang√©es;  conversion graphique avec perte pour placer des groupes de quatre images dans des ensembles de 256 tuiles;  ainsi que la mise √† jour de la m√©moire vid√©o dans la partie visible du raster.  Ainsi, l'animation a pris quatre fois moins d'espace. <br><br>  Le mod√®le de lettre et l'animation de rotation sont r√©alis√©s dans <i>Blender</i> .  Au cours de son miroir votre id√©e est venue qui correspond au concept de d√©monstration, et il √©tait dr√¥le - la sc√®ne dit: ¬´ et et et et et et. ¬ª  Les images d'animation sont regroup√©es, la profondeur de couleur est r√©duite √† 4 et ces images sont converties par la fonction d'importation avec perte dans l' <i>outil d'√©cran NES</i> .  Cette fonction est peut-√™tre mon arme secr√®te principale - si la limite de tuiles est d√©pass√©e pendant la compression, elle recherche les tuiles visuelles les plus similaires et les combine jusqu'√† ce que le nombre requis de tuiles reste.  Bien s√ªr, cela donne des artefacts de conversion visuelle et n√©cessite un raffinement manuel ult√©rieur, mais vous permet de presser des images plus complexes avec moins de travail dans la limite. <br><br><img src="https://habrastorage.org/webt/ar/iu/to/ariutocxeivq50tx_frpvh2zfxu.png"><br><br>  Pour l'animation du logo, les ensembles de tuiles sont commut√©s et la fen√™tre de 14 par 14 tuiles dans la carte de tuiles d'arri√®re-plan est mise √† jour, pour laquelle l'interruption MMC3, qui est d√©clench√©e avant une ligne de texte, est utilis√©e.  La ligne n√©cessite √©galement de basculer l'ensemble graphique vers la police, apr√®s quoi il y a un retard dans le code pendant le temps que les lignes de l'inscription sont affich√©es, puis l'affichage s'√©teint (la couleur d'arri√®re-plan est constamment affich√©e) et les donn√©es sont transf√©r√©es dans la m√©moire vid√©o. <br><br>  Les pi√®ces sont affich√©es par des sprites et volent le long d'un chemin calcul√© plus ou moins honn√™tement (en utilisant un point fixe).  L'ancien code a √©t√© modifi√© pour que la rotation se d√©roule, si possible sans intersection avec le logo plus grand, ainsi que pour que les pi√®ces apparaissent et disparaissent progressivement aux bons moments.  Ils vont au-del√† des graphiques du logo en utilisant le drapeau de priorit√© de chaque image-objet. <br><br><h3>  Cartouche rotative </h3><br>  L'impl√©mentation de l'effet est tr√®s simple en mots, mais elle a n√©cessit√© un long d√©bogage.  Le gestionnaire d'interruption lance un effet raster sur la ligne souhait√©e (pour laisser du temps au thread principal).  Ensuite, le code avec des minutages s√©lectionn√©s tr√®s pr√©cis√©ment est ex√©cut√© pour d√©finir le d√©calage vertical pixel par pixel de la carte de tuiles affich√©e pour chaque ligne de l'√©cran.  Cela n√©cessite un sch√©ma d'√©criture tr√®s d√©licat dans les registres <i>PPU</i> , et certains d'entre eux doivent exactement tomber √† un certain endroit sur la ligne.  Dans la version <i>NTSC</i> du d√©codeur, la vitesse d'horloge du processeur et le taux de r√©p√©tition des pixels ne sont pas multiples, et le temps d'ex√©cution du code peut varier l√©g√®rement en fonction de plusieurs facteurs, de sorte que les synchronisations de chaque ligne s'√©loignent progressivement et n√©cessitent une correction. <br><br>  La partie principale des graphiques de cette sc√®ne a √©t√© dessin√©e il y a plusieurs ann√©es pour une tentative pr√©c√©dente de faire une d√©mo pour <i>NES</i> , mais maintenant elle a √©t√© compl√©t√©e par d'autres faces de cartouche et un logo de d√©mo.  L'image originale est empil√©e en hauteur sur un seul √©cran.  Pour simplifier le code d'effet, les m√™mes lignes sont dupliqu√©es plusieurs fois √† l'arri√®re de la cartouche. <br><br><img src="https://habrastorage.org/webt/x8/in/3u/x8in3uasevydgdsbn2knytfzseq.png"><br><br>  L'animation de rotation est enti√®rement calcul√©e √† l'avance √† l'aide d'un programme PC et prend une quantit√© importante de code ROM - trois banques de 16 kilo-octets chacune, dans lesquelles pour chacune des 256 images de l'animation, une table est stock√©e dans 176 num√©ros des lignes raster affich√©es.  Il √©tait possible de faire un effet en temps r√©el, j'ai d√©j√† fait une d√©mo similaire pour une autre plateforme, mais dans ce cas il y avait assez de m√©moire libre et il n'y avait pas de temps suppl√©mentaire. <br><br><h3>  Pacman </h3><br>  Initialement, une sc√®ne plus complexe √©tait pr√©vue, mais en raison du manque total de temps, elle est entr√©e dans la d√©mo dans la version la plus minimaliste, sous la forme d'une d√©composition des sc√®nes lors du changement de musique. <br><br>  Le principal probl√®me √©tait de trouver un moyen de cr√©er rapidement des animations.  Tout d'abord, l'id√©e est venue d'utiliser √† nouveau <i>Blender</i> ou d'autres programmes graphiques.  Mais apr√®s les premi√®res tentatives et quelques calculs, il est devenu clair que seulement huit images de l'animation d'ouverture de la bouche d'une position compl√®tement ferm√©e √† une position compl√®tement ouverte seraient suffisantes, et elles seraient beaucoup plus faciles et plus rapides √† dessiner manuellement dans <i>Gale</i> . <br><br>  Ensuite, un programme a √©t√© √©crit pour le PC, prenant une s√©quence d'images d'un cycle d'animation complet et trouvant des images qui ont chang√© entre les tuiles.  Les adresses de ces tuiles dans la carte des tuiles dans la m√©moire vid√©o sont enregistr√©es sous forme de listes de longueur variable, l'effet dans la d√©mo met simplement √† jour les sections modifi√©es de ces listes.  Les graphiques de tous les cadres tiennent dans un seul jeu de tuiles et ne changent pas pendant l'effet. <br><br><img src="https://habrastorage.org/webt/vd/q6/au/vdq6au_yo_kcamlr_axpg3mki5k.png"><br><br><h3>  Kirby </h3><br>  Cet effet a √©t√© d√©bogu√© sur mon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">ancienne photo</a> <i>Catrix</i> .  Il y avait un plan pour changer l'image du visage d'un chat en une image alternative avec un chat du Cheshire √† travers une sorte d'effet visuel.  Lorsque l'id√©e est venue d'ajouter des personnages du jeu √† la d√©mo, apr√®s une courte √©lection - il √©tait urgent de dessiner deux nouvelles images en plein √©cran - il a √©t√© d√©cid√© de prendre Kirby et d'en faire une version ¬´Cheshire¬ª.  L'effet de la modification des images dans le processus a √©t√© simplifi√© en un court scintillement. <br><br>  Les blocs d'images en mouvement sont affich√©s sous forme de sprites et imprim√©s sur la carte de tuiles lorsqu'ils arrivent au bon endroit.  De m√™me, une suppression de bloc se produit. <br><br><h3>  La tour </h3><br>  J'ai toujours aim√© l'effet dans le dernier niveau du jeu <i>Battletoads</i> , et j'ai longtemps voulu le r√©p√©ter.  Dans la d√©mo, il est venu √† un endroit de la sc√®ne avec des salutations. <br><br>  La partie technique est tr√®s simple, il s'agit d'un d√©filement vertical normal d'un calque d'arri√®re-plan.  L'effet de rotation est obtenu par l'animation des graphiques des tuiles, tandis que la carte des tuiles reste inchang√©e.  Pour l'animation, le mode <i>MMC3</i> est <i>utilis√©</i> avec quatre fen√™tres <i>CHR</i> commutables.  La premi√®re fen√™tre contient des tuiles de la partie statique, tandis que les trois autres commutent √† des vitesses diff√©rentes.  L'une des fen√™tres modifie √©galement en douceur la direction de l'animation.  √âtant donn√© que 64 tuiles sont plac√©es dans chaque fen√™tre, et l'√©l√©ment anim√© ne n√©cessite que 28, les graphiques des tuiles sont dupliqu√©s dans chaque fen√™tre pour recevoir l'animation dans la direction oppos√©e. <br><br><img src="https://habrastorage.org/webt/xf/pd/x2/xfpdx2ueqnid-jkhnpc2lr-7mke.png"><img src="https://habrastorage.org/webt/qm/dj/f_/qmdjf_ixlpbx3eiwc9_li-u5ndc.png"><img src="https://habrastorage.org/webt/y2/z2/ed/y2z2edauh83qgvyleevszwn9pic.png"><br><br>  Le principal probl√®me pour r√©aliser l'effet √©tait la pr√©paration de l'animation.  Il a √©t√© ex√©cut√© par un programme sur un PC qui prend une texture 16x16 et une table de vitesse pour chaque colonne de pixels en entr√©e, et g√©n√®re un bloc de 16 images d'animation sous la forme d'un ensemble de 256 tuiles (dont certaines sont vides).  Les ensembles sont convertis au format souhait√© dans l' <i>outil d'√©cran NES</i> et distribu√©s aux banques de graphiques ROM avec les d√©calages souhait√©s via les options de la directive assembleur <i>incbin</i> . <br><br>  Une autre t√¢che importante concernant les salutations √©tait de ne pas oublier de les transmettre √† tous ceux qui le souhaiteraient.  Depuis ce nombre tend vers l'infini, et une sc√®ne trop longue serait ennuyeuse.  J'ai d√©cid√© de ne me limiter qu'√† ceux avec qui je croisais depuis un an.  Noms recueillis dans un fichier texte au fur et √† mesure qu'ils me venaient √† l'esprit.  Bien s√ªr, apr√®s avoir termin√© le travail, il s'est av√©r√© que j'avais encore oubli√© de mentionner beaucoup de gens. <br><br><h3>  Couloir </h3><br>  Il y avait un d√©sir de faire une sorte de sc√®ne avec une perspective, comme un tunnel classique.  Les tunnels classiques ou un v√©ritable rakester <i>Wolfenstein 3D</i> ont disparu en raison de la complexit√©.  De plus, <i>NES a</i> d√©j√† plusieurs vrais rakasters, y compris des textures, mais ils ne semblent pas tous tr√®s impressionnants en raison de la vitesse extr√™mement basse. <br><br>  Je suis tr√®s int√©ress√© par les graphiques pseudo-tridimensionnels dans les premiers jeux, et parmi les anciens d√©veloppements il y avait d√©j√† un couloir de sprites avec une animation fluide des virages, inspir√© du jeu <i>Zig Zag</i> pour le <i>ZX Spectrum</i> .  Il a √©t√© d√©cid√© de l'utiliser.  Comme le couloir abstrait lui-m√™me n'est pas tr√®s int√©ressant, une intrigue interne de la sc√®ne avec Mario et l'humour des toilettes a √©t√© invent√©e, qui le compl√®te logiquement, ainsi que la d√©mo dans son ensemble.  La sc√®ne a √©t√© r√©alis√©e la toute derni√®re, et malgr√© l'utilisation de blancs, le travail a dur√© plus de 11 heures d'affil√©e, sans compter les travaux pr√©paratoires lors de la planification. <br><br>  Toutes les images anim√©es sont trac√©es manuellement dans Gale.  C'est le seul effet dans la d√©mo, allant √† une vitesse inf√©rieure √† 60 images par seconde, bien qu'il puisse fonctionner √† cette vitesse sans aucun probl√®me.  Pour des raisons de lisibilit√© visuelle et de synchronisation avec la musique lors du lancement dans le couloir, le taux de rafra√Æchissement de l'√©cran √©tait limit√© √† 30 images par seconde, comme alternative √† l'ajout de phases interm√©diaires de mouvement, pour la pr√©paration desquelles il n'y avait plus de temps. <br><br>  Les cadres graphiques ont pris deux ensembles de tuiles.  Aux moments n√©cessaires de l'animation, le calque d'arri√®re-plan est mis √† jour, l'ensemble de graphiques souhait√© est connect√© et deux couleurs sont d√©finies dans deux palettes (pour la moiti√© sup√©rieure et inf√©rieure de l'√©cran), car lorsque vous tournez √† 90 degr√©s, les couleurs des murs changent de place. <br><br>  Les cartes de tuiles d'animation sont d'abord copi√©es dans la RAM par un code dans une banque fixe √† partir de l'une des deux banques inf√©rieures enfichables de la ROM.  Pendant l'affichage du raster juste en dessous de la fen√™tre affich√©e de l'effet, le rendu est d√©sactiv√© et les donn√©es sont transf√©r√©es de la RAM vers la m√©moire vid√©o.  La d√©sactivation du rendu sert √©galement de limite inf√©rieure de l'√©cr√™tage visuel du sprite Mario. <br><br><h3>  L√©gendes </h3><br>  Cette sc√®ne a √©t√© l'une des premi√®res, apr√®s les barres de couleur, bas√©e sur le code d'un des anciens projets.  Il avait d√©j√† pris en charge deux polices, des palettes diff√©rentes et des ralentissements √† la fin.  Pour la d√©mo, de nouvelles polices ont √©t√© dessin√©es, qui sont utilis√©es partout, et un effet a √©t√© ajout√© sur les bords de l'√©cran. <br><br>  Au d√©but, je voulais que les bords s'assombrissent en douceur, mais pendant les exp√©riences pr√©liminaires, j'ai essay√© des options avec un d√©calage de ligne horizontal, j'ai aim√© le r√©sultat et j'ai d√©cid√© de ne pas passer de temps suppl√©mentaire.  Un l√©ger ombrage est ajout√© √† l'aide de la fonction controvers√©e du <i>contr√¥leur</i> vid√©o <i>NES</i> , la r√©duction du gain des composants de couleur.  La controverse r√©side dans le fait que dans diff√©rentes versions r√©gionales et clones de la console, cette fonction fonctionne diff√©remment, mais dans cette application, il ne devrait pas y avoir de probl√®mes particuliers (sans compter le soi-disant <i>PPU RVB</i> , o√π les bords seront remplis de blanc). <br><br><h3>  Afficher </h3><br>  √Ä peu pr√®s au moment o√π la sc√®ne de sous-titrage a √©t√© r√©alis√©e, l'id√©e de cette sc√®ne a surgi spontan√©ment.  L'id√©e initiale √©tait de l'ins√©rer √† un moment al√©atoire, mais √† la fin il a r√©ussi √† s'ins√©rer dans la fin.  Malgr√© la courte dur√©e, la sc√®ne se compose de trois √©l√©ments: la simulation de la mise √† l'√©chelle du sprite, l'augmentation du nombre de nuances de gris en alternant deux images et la lecture programm√©e d'un √©chantillon <i>DPCM</i> . <br><br>  Pour simuler la mise √† l'√©chelle, le fait que tous les grands sprites sur <i>NES sont</i> compos√©s de petits, dans ce cas 8x16, est utilis√©.  Si vous les d√©placez les uns par rapport aux autres, vous pouvez obtenir l'effet de mise √† l'√©chelle ou de distorsion, qui semble assez d√©cent avec de petites valeurs de changements.  Pour cet effet, vous devez multiplier le d√©calage de chaque image-objet par rapport au centre par une √©chelle, mais comme le processeur <i>NES</i> ne peut pas faire face √† un grand nombre de multiplications enti√®res paires, l'astuce est appliqu√©e - au d√©but du cadre, la grille de coordonn√©es le long des axes X et Y est prise en compte et la sortie de l'image-objet utilise ces valeurs pr√©-calcul√©es .  Ainsi, le nombre de multiplications n√©cessaires est consid√©rablement r√©duit - avec une pulv√©risation composite de 8x8 √©l√©ments (64 sprites), seules 16 (8 + 8) multiplications sont n√©cessaires au lieu de 128 (8 * 8 * 2). <br><br>  <i>NES</i> ne peut afficher que 4 nuances de gris, y compris le blanc et le noir.  L'effet imite 7 d√©grad√©s: si vous affichez un pixel blanc et blanc √† travers le cadre, il sera blanc, si gris et gris il sera gris, et si vous alternez blanc et gris, alors visuellement cela ressemblera √† une gradation interm√©diaire entre blanc et gris.  La principale difficult√© est encore une fois la pr√©paration des graphiques, √† savoir deux demi-images de l'image, qui a √©t√© effectu√©e par un certain nombre de manipulations manuelles dans <i>Gale</i> et <i>GIMP</i> .  Pour r√©duire le scintillement, les lignes des demi-images alternent. <br><br><img src="https://habrastorage.org/webt/yc/1r/uf/yc1ruf7bi7cr6cmhz3rp5ryf_4w.png"><img src="https://habrastorage.org/webt/gr/fp/ky/grfpkygmrgieh8xy0nl75kbmh_q.png"><br><br>  La lecture programmatique de <i>DPCM √©tait</i> n√©cessaire car il n'y avait pas de place pour un √©chantillon dans de meilleurs formats, le support mat√©riel ne pouvait pas lire les √©chantillons de la moiti√© inf√©rieure de la m√©moire, mais il n'y avait pas d'espace pour un √©chantillon d'une telle longueur dans la m√©moire sup√©rieure non commutable.  Le fragment de son lui-m√™me ne provient pas de l'√©conomiseur d'√©cran d'origine, mais d'un jingle de son assez similaire du jeu bien connu avec une finition cruelle, qui sonne au moment de la finition proprement dite. <br><br><h3>  Carte m√©moire </h3><br>  En cours de d√©veloppement, l'utilitaire NES Space Checker a √©t√© constamment utilis√©, ce qui permet de visualiser le remplissage des banques de m√©moire.  Il est assez int√©ressant de voir un bon exemple de quoi et o√π se trouve √† l'int√©rieur du programme. <br><br><img src="https://habrastorage.org/webt/2o/wm/vi/2owmvixodm0fwzxlnofl0k83mew.png"><br><br>  <b>PRG00</b> ... <b>PRG02</b> - donn√©es musicales <br>  <b>PRG03</b> - exemple pour une sc√®ne avec une vue <br>  <b>PRG04</b> ... <b>PRG06</b> - donn√©es d'animation de rotation de cartouche <br>  <b>PRG07</b> - animation de tuiles profond√©ment dans le couloir <br>  <b>PRG08</b> - animation de rotation des carreaux dans le couloir <br>  <b>PRG09</b> - code de sc√®ne de tour <br>  <b>PRG0A</b> - code de sc√®ne avec logo rotatif <br>  <b>PRG0B</b> - code de sc√®ne avec un nom et un couloir <br>  <b>PRG0C</b> - code de sc√®ne avec cartouche rotative, Kirby, View, envahisseurs, Pakman <br>  <b>PRG0D</b> - code de sc√®ne avec intros, bruit, barres de couleur, l√©gendes <br>  <b>PRG0E</b> - la banque principale du code, contient uniquement les appels de toutes les sc√®nes <br>  <b>PRG0F</b> - banque de code fixe, lecteur de musique, sortie sprite, gestionnaires d'interruption <br><br>  <b>CHR00</b> - b√©b√© √©l√©phant et tuiles pour rayures color√©es <br>  <b>CHR01</b> - police et bruit <br>  <b>CHR02</b> - Afficher le sprite et les tuiles de lettres tournantes dans le nom <br>  <b>CHR03</b> - <b>Tuiles</b> Kirby normales <br>  <b>CHR04</b> - <b>Tuiles</b> Cheshire Kirby <br>  <b>CHR05</b> - graphiques pour une sc√®ne avec une cartouche rotative <br>  <b>CHR06</b> ... <b>CHR0D</b> - animation du logo rotatif <br>  <b>CHR0E</b> - une police pour les salutations et l'animation des tuiles envahissantes <br>  <b>CHR0F</b> - <b>Tuiles</b> Pakman <br>  <b>CHR10</b> ... <b>CHR13</b> - animation de texture de tour <br>  <b>CHR14</b> - <b>Carreaux de</b> couloir <br>  <b>CHR15</b> - <b>Sprite</b> Mario <br>  <b>CHR16</b> ... <b>CHR1F</b> - non utilis√© <br><br><h2>  Au lieu d'une conclusion </h2><br>  Je terminerai par un m√®me combo: dans toute situation incompr√©hensible, √©crivez des sc√®nes de d√©monstration, messieurs! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr474960/">https://habr.com/ru/post/fr474960/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr474948/index.html">Y a-t-il une perspective pour ¬´Orlan¬ª ou notre ¬´Orlan¬ª contre ¬´IBM¬ª</a></li>
<li><a href="../fr474950/index.html">Artem Svetlov: ¬´Chaque jour au travail, je vois comment OSM aide une vari√©t√© d'entreprises¬ª</a></li>
<li><a href="../fr474954/index.html">Algorithme d'apprentissage machine binaire avec structure dynamique</a></li>
<li><a href="../fr474956/index.html">Que fait un film d'action am√©ricain sans poursuite? Toby Galicki et ses 60 secondes</a></li>
<li><a href="../fr474958/index.html">Notes sur le Zadroth: Omnipotence Framework</a></li>
<li><a href="../fr474962/index.html">Platform Developers Conf by Miro: diffusion en direct</a></li>
<li><a href="../fr474964/index.html">Synchronisation simul√©e avec des impl√©mentations r√©elles</a></li>
<li><a href="../fr474966/index.html">Comment √©crire un contrat Python intelligent sur le r√©seau Ontology. Partie 1: Blockchain & Block API</a></li>
<li><a href="../fr474968/index.html">RxDart pour les plus petits ... projets</a></li>
<li><a href="../fr474970/index.html">Comment √©crire un contrat intelligent avec Python sur l'ontologie? Partie 5: API native</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>