<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ½ â˜‘ï¸ ğŸ•¤ QtQML / panel korelasi cepat ğŸ‘¨ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ¼ ğŸ›ŒğŸ¾ ğŸŒ‰</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya! Saya adalah pemimpin tim untuk pengembangan aplikasi desktop di perusahaan Rogia Europe. Kami mengembangkan solusi perangkat lunak untu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>QtQML / panel korelasi cepat</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480334/"><p>  Halo semuanya!  Saya adalah pemimpin tim untuk pengembangan aplikasi desktop di perusahaan Rogia Europe.  Kami mengembangkan solusi perangkat lunak untuk industri minyak dan gas. </p><br><p>  Kebetulan produk unggulan kami StarSteer tidak memiliki panel korelasi - alat klasik untuk panduan yang baik.  Tugas itu ditunda untuk waktu yang lama karena tugas lain yang lebih prioritas, tetapi musim gugur yang lalu kami akhirnya bisa memulainya. </p><br><p> Memotong pertanyaan dari basis kode warisan - saya akan menyebutkannya di artikel - ada satu pertanyaan mendasar - teknologi apa yang harus saya gunakan?  Kami benar-benar membutuhkan OpenGL - yang sudah digunakan dalam tampilan MapView dan 3d berdasarkan OpenSceneGraph - tetapi jelas bahwa itu tidak terbuka, dan dengan elemen antarmuka grafis.  OSG jatuh = (. Sebuah teknologi yang memenuhi dua persyaratan - grafik adegan dan GUI pada OpenGL - Saya hanya tahu satu - Qt QML / Cepat. Tentang apa yang kami dapatkan dan apa yang harus kami bagikan - di dalam. <a name="habracut"></a></p><br><h3 id="vstuplenie">  Entri </h3><br><p>  Kami mulai mengembangkan produk pada musim gugur 2013.  Kumpulan perpustakaan apa yang digunakan untuk saya, sebagai penggemar Qt, bahkan bukan pertanyaan.  Pada saat itu, mungkin muncul pertanyaan: gunakan versi Qt ke-4 atau ke-5 (masih terbilang baru).  Kami telah memilih penerbangan kelima dan dari ketinggian penerbangan kami, saya hanya bisa mengatakan: terima kasih Tuhan! </p><br><p>  Seluruh tampilan dikembangkan di QtGui / Widget.  Semua adegan di mana grafik ditampilkan (gamma, porositas, resistensi, dll.) Dibuat di QGraphicsScene / View.  Saran saya - jangan gunakan bundel ini untuk hal-hal serius!  Argumen: gulir Bar dan tidak terputus dari luar (itu di luar tanpa edit Qt <a href="">sendiri</a> ) logika untuk memusatkan adegan ( <a href="">qgraphicsview.cpp +458</a> dan di atas dalam metode yang sama untuk horizontal; <a href="">qgraphicsview.cpp +3816</a> - apa kontrol atas matriks).  Jika ini tidak mengganggu Anda, maka gunakan - banyak potongan nyaman dari kotak. </p><br><p>  Apa lagi yang tidak boleh digunakan?  NSIS. </p><br><p>  Semuanya sempurna, produk berkembang, tugas sedang dikerjakan, jumlah pelanggan bertambah.  Refactoring ... Secara umum, setelah beberapa waktu, QGraphicsScene mulai mengganggu kami - kami tidak terburu-buru untuk mengoptimalkan gambar grafik 40.000 poin, ketika garis tebal dihidupkan - semua hal ini pada CPU sangat lambat. </p><br><p>  Sepanjang jalan, kami bosan mengembangkan GUY pada widget.  Baik dengan tangan Anda sepenuhnya dalam kode, atau sedikit di perancang (dari Creator, <em>.ui +</em> .cpp).  Saya menginginkan barang-barang modern, seperti deskripsi deklaratif dari antarmuka grafis. </p><br><p>  Membuat daftar teknologi yang akan kami lakukan: </p><br><ul><li>  cara kuno di QGraphicsView / Scene; </li><li>  untuk setiap lagu gunakan QOpenGLWidget kosong yang terpisah; </li><li>  mengimplementasikan seluruh jendela pada QOpenGLWidget, tetapi GUI sendiri (atau menemukan sesuatu); </li><li>  dua poin sebelumnya + OSG masing-masing; </li><li>  Qt QML / Cepat, </li></ul><br><p>  hanya enam poin;  dibahas.  Karisma saya melebihi dan memutuskan untuk mencoba melihat bagaimana prototipe di QML berperilaku. </p><br><h3 id="prototip">  Prototipe </h3><br><p>  Saya membuka contoh scenegraph \ graph.  Terlihat dan ditutup =).  Saya bermain selama beberapa hari, melihat contoh-contoh lain, tetapi tidak ada yang mendekati tujuan saya. </p><br><p>  Dan apa yang dibutuhkan saat itu?  Seperti apa panel korelasinya: </p><br><ul><li>  contoh pertama: <a href="">Nah korelasi1.png</a> (dari halaman <a href="https://geosteering.ru/software/geosteering-office.html">https://geosteering.ru/software/geosteering-office.html</a> ); </li><li>  kedua: <a href="">cp_1.png</a> (dari halaman <a href="https://geosteertech.com/products/geonaft/correlation-panel/">https://geosteertech.com/products/geonaft/correlation-panel/</a> ); </li><li>  Tentu saja, Petrel raksasa memilikinya; </li><li>  juga google berdasarkan permintaan (baik) panel korelasi. </li></ul><br><p>  Struktur yang cukup sederhana adalah daftar trek yang baik, di dalamnya trek untuk kurva, skala;  Ya, hal-hal kecil.  Banyak teks, di masa depan, beberapa kontrol - tombol, daftar drop-down, bidang input, dan banyak lagi. </p><br><p>  Saya melihat sgengine, belajar cara membuat dua grafik adegan dan menggambarnya di viewport yang ditunjuk.  Kemudian saya menyadari bahwa dengan opsi ini, QML / Quick tidak akan, lalu mengapa saya membutuhkan semua ini? </p><br><p>  Sebenarnya, saya tidak ingat obat apa, tetapi karena alasan tertentu saya memutuskan untuk beralih ke dasar-dasar grafik komputer.  Jadi pada tahap terakhir rasterisasi, semua koordinat adegan ditransfer ke NKU (Koordinat Perangkat Normalisasi; lebih dikenal sebagai NDC = Koordinat Perangkat Normalisasi).  Ya, saya mendengar bahwa output dari vertex shader sebenarnya adalah ruang klip dan setelah itu masih ada distorsi affine, tetapi semua ini adalah untuk representasi tiga dimensi, dan dalam 2D â€‹â€‹selalu ada w = 1 dan oleh karena itu kita dapat mengasumsikan bahwa output segera ke NDC. </p><br><p>  OKE, NDC, apa selanjutnya?  Bahwa jika lebar jendela Anda adalah 800 piksel, maka koordinat NDC dari pusat piksel nol adalah -1;  koordinat pusat dari 799 adalah 1. Singkatnya, ndcX = -1 + 2 * i / 799. Sekarang bayangkan bahwa ada persegi panjang dari 100 hingga 300 dan saya ingin menggambar seluruh adegan tidak ke dalam seluruh jendela, tetapi ke dalamnya.  Menggunakan pengetahuan yang terpisah-pisah ini, saya akan menghitung ndcX100, ndcX300, kemudian membuangnya ke vertex shader dan di sana, setelah standar </p><br><pre><code class="plaintext hljs">gl_Position = matrix * position;</code> </pre> <br><p>  linear "bungkus" gl_Position.x dalam [ndcX100;  ndcX300].  Kami melakukan hal yang sama untuk komponen vertikal.  Trik ini akan memungkinkan Anda untuk memunculkan adegan di setiap persegi panjang adegan yang dipilih.  Dengan pengetahuan ini, contoh grafik mulai mengalami perubahan.  Anda dapat melihat paroki di sini - <a href="https://github.com/rogii-com/graph">grafik</a> ;  semua garam di <code>shaders/line.vsh</code> . </p><br><h3 id="sceneitemscene">  SceneItem / Adegan </h3><br><p>  Tiga bulan berikutnya adalah penulisan TK, ternyata 12 lembar A4 =).  Secara paralel, kami mempertimbangkan arsitektur.  Mereka mengambil MVC ... itu MVP ... itu Hierarchical MVC / MVP ... atau bahkan PAC - semua ini adalah konvensi, dekomposisi yang baik adalah penting. </p><br><p>  Secara umum, kami telah menyiapkan contoh adegan.  Sumber tersedia di sini - <a href="https://github.com/rogii-com/SceneSample">Contoh Scene</a> .  Ternyata kerangka kerja tertentu untuk membuat aplikasi dengan grafik di QtQML / Cepat.  Tolong jangan lupa bahwa kode ini masih bertindak sebagai contoh.  Ya, sudah setengah jadi dan terlihat kurang lebih rapi, tetapi belum siap. </p><br><p>  Adegan adalah pemain utama.  Kelas ini memonitor koordinat NDC-nya dan memperbarui matriks yang sesuai.  SceneCamera berteman dekat dengannya.  Entitas berikutnya yang layak disebutkan adalah SceneItem.  Itu tidak berguna dalam dirinya sendiri, itu hanya mengandung beberapa logika dasar;  mewarisinya - seperti LineStrip - dan terapkan apa yang Anda butuhkan.  Pada saat yang sama, di <code>updatePaintNode</code> Anda harus menggunakan turunan dari SceneMaterial - FlatColorMaterial sebagai referensi.  Entitas yang tersisa juga melakukan sesuatu =), semua jenis manipulator, alat.  Banyak kelas tidak dilemparkan ke QML, dan Anda tidak dapat melakukannya tanpa C ++;  Anda ingat apa yang belum siap? </p><br><p>  Kesulitan kedua adalah bahwa jika kita ingin menggunakan kontrol di dalam adegan baru, kita tidak akan dapat melakukan ini.  Kami berpikir, memutuskan bahwa kami tidak membutuhkannya, dan dengan tenang melanjutkan pengembangannya. </p><br><p>  Keuntungan dari pendekatan: </p><br><ul><li>  semuanya digambar dalam satu kolom adegan; </li><li>  kami tidak memperbaiki Qt - masih memungkinkan untuk menambahkan kontrol QML reguler ke Stage sehingga z-order antara mereka dan kurva (atau SceneItem lainnya) benar; </li><li>  konsumsi memori lebih rendah dibandingkan dengan pendekatan lain. </li></ul><br><p>  Cons </p><br><ul><li>  urbermachine kompleks; </li><li>  pengetahuan tentang OpenGL dan GLSL diperlukan; </li><li>  solusi setengah jadi. </li></ul><br><p>  Tentu saja, kami mengalami beberapa kesulitan selama pengembangan.  Salah satunya </p><br><h3 id="bag-s-z-order">  Bug dengan z-order </h3><br><p>  Ketika kami pertama kali mencoba menampilkan adegan dengan kurva, kami melihat gambar-gambar tersebut: <br><img src="https://habrastorage.org/webt/wc/qb/mi/wcqbmirtmjya6uaqdsqhgegqhci.jpeg"></p><br><p><img src="https://habrastorage.org/webt/el/_e/xo/el_exofkaclv-pdkv83yi-jybhs.jpeg"></p><br><p>  Sekilas tidak jelas, "kami melakukan semuanya dengan benar!"  Samar-samar diduga bahwa gl_Position.z entah bagaimana keliru, tapi mengapa sulit untuk memahami mengapa di malam hari.  Kami tidak menyerah: kami melihat bahwa Qt mengoreksi shader dan menambahkan kode untuk mengubah gl_Position.z, kami pikir.  Setelah beberapa saat, kami sadar: kami mengacaukan data matriks dengan perubahan z, dan Qt mentransfer nilainya kepada mereka!  Dengan demikian, nilai item.z dari QML dipetakan ke z dari OpenGL ( <a href="">SceneMaterial.cpp +20</a> ): </p><br><p><img src="https://habrastorage.org/webt/bd/bg/jr/bdbgjroxi-khledimuejjj-f7pw.jpeg"></p><br><h3 id="bag-s-clip-true">  Bug dengan klip: true </h3><br><p>  Sekali dalam obrolan, tim bisnis mengirim layar di mana garis kiri kotak koordinat menghilang. </p><br><p><img src="https://habrastorage.org/webt/k9/df/sm/k9dfsml6hlop-oa8hegvygeaa_8.jpeg"></p><br><p>  Tanya Jawab kami menyiksa program dan menemukan langkah-langkah untuk pemutaran yang stabil: kami mengatur penskalaan untuk monitor agar tidak kelipatan 100% dan garis-garis "berkedip".  Artyom duduk, berpikir, dan menemukan bahwa ketika <code>clip: true</code> dan item berbentuk persegi panjang, glScissor digunakan, tetapi argumennya adalah koordinat pixel integer!  Pada item QML mereka nyata dan ternyata rasterisasi garis jatuh ke piksel berikutnya / sebelumnya, dan gunting dipotong ke arus. </p><br><p>  Kami memperbaiki adegan seperti ini: <code>width: Math.round(metrics.width + leftPadding + 2 * rightPadding + 0.5)</code> .  Karenanya, item pemandangan harus selalu memiliki koordinat bilangan bulat untuk menghindari artefak tersebut. </p><br><p>  Kesimpulannya, saya akan membawa KDPV </p><br><p><img src="https://habrastorage.org/webt/1v/jm/hn/1vjmhn-nmmfitmvq4cjqccfaf_m.jpeg"></p><br><p>  Terima kasih atas perhatian Anda! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id480334/">https://habr.com/ru/post/id480334/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id480324/index.html">Implementasi Tipe String di CPython</a></li>
<li><a href="../id480326/index.html">F5 Networks Corporation mengirimkan surat kepada pelanggannya untuk memberi tahu mereka tentang situasi saat ini dengan NGINX</a></li>
<li><a href="../id480328/index.html">Bagaimana cara berteman PyTorch dan C ++. Menggunakan TorchScript</a></li>
<li><a href="../id480330/index.html">Alat penilaian karyawan yang ideal</a></li>
<li><a href="../id480332/index.html">Analisis data pemungutan suara blockchain 2019 di Duma Kota Moskow</a></li>
<li><a href="../id480338/index.html">Cara kerja rendering game 3D: rasterization dan ray tracing</a></li>
<li><a href="../id480340/index.html">Saya menentang manajer yang tidak kompeten, dan kemudian dia dipromosikan</a></li>
<li><a href="../id480342/index.html">Paradigma pembangunan melalui komentar</a></li>
<li><a href="../id480348/index.html">Deep Fake Science, krisis reproduktifitas dan dari mana repositori kosong berasal</a></li>
<li><a href="../id480350/index.html">Intisari materi menarik untuk pengembang ponsel # 326 (pada 9 - 15 Desember)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>