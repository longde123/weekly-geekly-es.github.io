<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå´Ô∏è üî¨ üà∫ AWS Elasticsearch: produit fondamentalement d√©fectueux üòØ üëÉüèΩ üèáüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Traduction du Nick Price 

 Je travaille actuellement sur un grand projet de journalisation qui a √©t√© initialement impl√©ment√© √† l'aide d'AWS Elasticse...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>AWS Elasticsearch: produit fondamentalement d√©fectueux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473976/"><img src="https://habrastorage.org/webt/gr/2i/4f/gr2i4fdf6rxq5mh3uwosssdp4uq.jpeg"><br><br>  Traduction du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nick Price</a> <br><br>  Je travaille actuellement sur un grand projet de journalisation qui a √©t√© initialement impl√©ment√© √† l'aide d'AWS Elasticsearch.  Ayant travaill√© avec les clusters dorsaux Elasticsearch √† grande √©chelle pendant plusieurs ann√©es, je suis compl√®tement submerg√© par la qualit√© de la mise en ≈ìuvre d'AWS et je ne comprends pas pourquoi ils ne l'ont pas corrig√© ou du moins am√©lior√©. <br><a name="habracut"></a><br><h2>  R√©sum√© </h2><br>  Elasticsearch stocke les donn√©es dans divers index que vous cr√©ez explicitement ou qui peuvent √™tre cr√©√©s automatiquement apr√®s l'envoi des donn√©es.  Les entr√©es de chaque index sont divis√©es en un certain nombre de fragments, qui sont ensuite √©quilibr√©s entre les n≈ìuds de votre cluster (aussi uniform√©ment que possible si le nombre de vos fragments n'est pas divis√© √©galement par le nombre de n≈ìuds).  Il existe deux principaux types de fragments dans ElasticSearch: les fragments de base et les fragments de r√©plique.  Les fragments de r√©plique offrent une tol√©rance aux pannes en cas de d√©faillance d'un n≈ìud, et les utilisateurs peuvent d√©finir le nombre de fragments de r√©plique s√©par√©ment pour chaque index. <br><br><h2>  Le travail de Elasticsearch standard </h2><br>  Elasticsearch - Il est √©lastique.  Parfois, cela peut √™tre assez difficile, mais, en g√©n√©ral, vous pouvez ajouter des n≈ìuds au cluster ou les supprimer.  Et si dans le cas de la suppression d'un n≈ìud, il existe un nombre appropri√© de r√©pliques, Elasticsearch distribuera des fragments et √©quilibrera m√™me la charge sur les n≈ìuds du cluster.  Cela fonctionne g√©n√©ralement. <br><br>  L'ex√©cution de requ√™tes co√ªteuses peut parfois entra√Æner la chute de n≈ìuds et similaires, mais un grand nombre de param√®tres permet de maintenir le travail.  Avec un nombre suffisant de fragments de r√©plique, si le n≈ìud tombe, cela n'affecte pas le travail dans son ensemble. <br><br>  Standard Elasticsearch propose √©galement un certain nombre de modules compl√©mentaires, notamment le X-Pack, les fonctions d'audit, les listes de contr√¥le d'acc√®s granulaires, la surveillance et les alertes.  La plupart du X-Pack est r√©cemment devenu gratuit, probablement en r√©ponse √† la nouvelle politique de licence Splunk. <br><br><h2>  Amazon Elasticsearch Work </h2><br>  Comme d'habitude, Amazon a pris le code open source pour une partie d'Elasticsearch, a cr√©√© un hard fork et a commenc√© √† le vendre comme son propre service, introduisant progressivement ses propres versions de fonctions qui, depuis de nombreuses ann√©es, sont disponibles d'une mani√®re ou d'une autre dans la version principale d'Elasticsearch. <br>  Le produit Amazon manque de beaucoup de choses, telles que: RBAC et audit, ce qui est particuli√®rement probl√©matique pour nous, car nous acceptons les journaux de diff√©rentes √©quipes et souhaitons les s√©parer les uns des autres.  √Ä l'heure actuelle, tout utilisateur ayant acc√®s √† Elasticsearch dispose de tous les droits d'acc√®s et peut supprimer accidentellement les donn√©es de quelqu'un d'autre, changer la fa√ßon dont elles sont r√©pliqu√©es sur les n≈ìuds et cesser compl√®tement de recevoir des donn√©es en ajoutant le mauvais mod√®le d'indexation. <br><br>  C'est frustrant, mais ce n'est pas le plus gros probl√®me avec le service.  Le r√©√©quilibrage des fragments - le concept central d'Elasticsearch - ne fonctionne pas dans l'impl√©mentation AWS, ce qui annule presque tout ce qui est bon dans Elasticsearch. <br><br>  En r√®gle g√©n√©rale, lorsque des donn√©es sont ajout√©es aux n≈ìuds, on peut remplir plus que les autres.  Cela est attendu car il n'y a aucune garantie que les enregistrements charg√©s auront la m√™me taille ou que le nombre de fragments sera toujours r√©parti uniform√©ment sur tous les n≈ìuds du cluster.  Ce n'est pas critique, car Elasticsearch peut r√©√©quilibrer les fragments entre les n≈ìuds, et si un n≈ìud est vraiment plein, les autres n≈ìuds commenceront volontiers √† recevoir des donn√©es au lieu d'√™tre remplis. <br><br>  Ce n'est pas pris en charge sur Amazon.  Certains n≈ìuds peuvent se remplir (beaucoup) plus rapidement que d'autres. <br><br>  De plus, <b>dans Amazon, si un n≈ìud de votre cluster Elasticsearch n'a pas assez d'espace libre, le cluster entier cesse de recevoir des donn√©es</b> , il s'arr√™te compl√®tement.  La solution d'Amazon consiste √† laisser les utilisateurs passer par le cauchemar de changer p√©riodiquement le nombre de fragments dans leurs mod√®les d'indexation, puis de r√©indexer les donn√©es pr√©c√©demment cr√©√©es dans de nouveaux index, supprimer les index pr√©c√©dents et, si n√©cessaire, inverser l'indexation des donn√©es dans la structure pr√©c√©dente.  Ceci est compl√®tement redondant et n√©cessite, en plus des co√ªts de calcul importants, qu'une copie non trait√©e des donn√©es t√©l√©charg√©es soit enregistr√©e avec l'enregistrement analys√©, car une copie non trait√©e sera n√©cessaire pour la r√©indexation.  Et, bien s√ªr, cela double la quantit√© de m√©moire n√©cessaire pour un travail ¬´normal¬ª sur AWS. <br><br>  ¬´Oups!  Je n'ai pas r√©index√© le cluster entier assez souvent, et le n≈ìud √©tait plein!  Que faire? " <br><br>  Vous avez deux options.  Tout d'abord, supprimez autant de donn√©es que n√©cessaire pour ramener le cluster √† la vie, puis commencez √† r√©indexer avec l'espoir que rien ne s'effondrera.  Avez-vous une sauvegarde de ce que vous souhaitez supprimer? <br><br>  La deuxi√®me option consiste √† ajouter plus de n≈ìuds au cluster ou √† redimensionner les n≈ìuds existants √† une taille d'instance plus grande. <br><br>  Mais attendez, comment ajouter des n≈ìuds ou apporter des modifications si les fragments ne peuvent pas √™tre r√©√©quilibr√©s? <br><br>  La solution d'Amazon est un d√©ploiement bleu-vert.  Ils font tourner un tout nouveau cluster, copient tout le contenu du cluster pr√©c√©dent dans un nouveau, puis basculent et d√©truisent l'ancien cluster. <br><br>  De telles t√¢ches de redimensionnement peuvent prendre des jours, pour les grands clusters, comme vous pouvez l'imaginer, la duplication de plusieurs billions d'enregistrements peut prendre un certain temps.  Cela cr√©e √©galement une charge folle sur le cluster existant (d√©passant probablement d√©j√† la capacit√©) et peut en fait entra√Æner l'√©chec du cluster.  J'ai effectu√© plusieurs op√©rations similaires sur plus de 30 clusters dans AWS et une seule fois j'ai observ√© une r√©ussite en mode automatique. <br><br>  Vous avez donc essay√© de redimensionner votre cluster et la t√¢che ne s'est pas termin√©e.  Et maintenant <br><br><h2>  Interactions avec Amazon </h2><br>  Votre t√¢che de redimensionnement du cluster a √©t√© interrompue (pour le service que vous avez probablement choisi de ne pas traiter avec un tel article), vous ouvrez donc le ticket au support technique AWS avec la priorit√© la plus √©lev√©e.  Bien s√ªr, ils se plaindront de la quantit√© ou de la taille de votre fragment et ajouteront gentiment un lien vers les "meilleures pratiques" que vous avez d√©j√† lues 500 fois.  Et puis vous attendez qu'il soit corrig√©.  Et attends.  Et attends.  La derni√®re fois que j'ai essay√© de redimensionner le cluster, et il a √©t√© bloqu√©, ce qui a entra√Æn√© de graves dysfonctionnements, il a fallu SEPT JOURS pour tout renvoyer en ligne.  Ils ont restaur√© le cluster lui-m√™me en quelques jours, mais quand tout s'est arr√™t√©, il est √©vident que les n≈ìuds sur lesquels Kibana s'ex√©cute ont perdu le contact avec le cluster principal.  Le support AWS a pass√© encore quatre jours √† essayer de r√©parer quelque chose tout en se demandant si Kibana fonctionnait.  Ils ne savaient m√™me pas s'ils avaient r√©solu le probl√®me, et j'ai d√ª v√©rifier s'ils avaient r√©tabli la communication entre leurs propres syst√®mes.  Depuis lors, j'ai cess√© de faire autre chose que de supprimer des donn√©es si le n≈ìud est plein. <br><br>  Les co√ªts de notre organisation sur AWS sont √©normes.  Cela nous donne l'occasion de rencontrer p√©riodiquement leurs experts dans divers domaines, de discuter des strat√©gies de mise en ≈ìuvre et de traiter une vari√©t√© de probl√®mes techniques.  Nous avons pris rendez-vous avec un repr√©sentant d'Elasticsearch, au cours duquel j'ai pass√© la majeure partie de la r√©union √† expliquer les bases d'Elasticsearch et √† d√©crire ... les caprices ... de leur produit.  L'expert √©tait compl√®tement choqu√© que tout s'effondre lorsque le n≈ìud est plein.  Si l'expert envoy√© ne conna√Æt pas les bases de son produit, il n'est pas surprenant que l'√©quipe de support ait besoin de sept jours pour reprendre le cluster de production. <br><br><h2>  Enfin des pens√©es </h2><br>  Dans le projet d'exploitation foresti√®re, dans lequel j'ai plong√©, il y a une part d'erreurs architecturales et de faibles d√©cisions de conception sur lesquelles nous travaillons actuellement.  Et bien s√ªr, je m'attendais √† ce qu'AWS Elasticsearch soit diff√©rent du produit d'origine.  Cependant, dans AWS Elasticsearch, de nombreuses fonctions fondamentales sont d√©sactiv√©es ou manquantes, ce qui aggrave presque tous les probl√®mes que nous rencontrons. <br><br>  Pour une utilisation facile et de petits clusters, AWS Elasticsearch fonctionne plut√¥t bien, mais pour les clusters de taille p√©taoctet, c'√©tait un cauchemar sans fin. <br><br>  Je suis tr√®s curieux de savoir pourquoi l'impl√©mentation d'Amazon Elasticsearch ne peut pas √©quilibrer les fragments;  il s'agit d'une fonctionnalit√© Elasticsearch assez fondamentale.  M√™me avec des limitations par rapport √† Elasticsearch principal, ce serait certainement un produit acceptable pour les grands clusters s'il fonctionnait correctement.  Je ne peux pas comprendre pourquoi Amazon propose quelque chose d'aussi cass√©, et pourquoi ils n'ont pas corrig√© la situation depuis plus de deux ans. <br><br>  Comme d'autres l'ont sugg√©r√©, et cela semble raisonnable, ce comportement est un signe de l'impl√©mentation d'AWS, con√ßue comme un cluster multi-locataire g√©ant, essayant de fournir l'isolement pour le faire ressembler √† un cluster autonome pour les utilisateurs finaux.  M√™me avec des options telles que les donn√©es chiffr√©es au repos et le transfert de donn√©es chiffr√©es, cela semble plausible.  Ou peut-√™tre que leurs outils et configurations sont simplement l'h√©ritage d'une architecture beaucoup plus ancienne. <br><br>  Et, comme mon ami l'a fait remarquer, il est assez dr√¥le qu'ils l'appellent toujours ¬´Flexible¬ª lorsque vous ne pouvez pas ajouter ou supprimer des n≈ìuds de vos clusters sans en cr√©er un nouveau et transf√©rer toutes vos donn√©es. <br><br>  Note de bas de page: lorsque j'ai √©crit ce texte, j'ai trouv√© un article il y a deux ans avec de nombreuses all√©gations similaires: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">read.acloud.guru/things-you-should-know-before-using-awss-elasticsearch-service-7cd70c9afb4f</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr473976/">https://habr.com/ru/post/fr473976/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr473960/index.html">Strat√©gies de localisation de contenu</a></li>
<li><a href="../fr473962/index.html">Le mode sombre est maintenant partout. Est-ce si utile? (√† la fin de l'enqu√™te post√©rieure)</a></li>
<li><a href="../fr473966/index.html">√Ä la demande des d√©veloppeurs int√©gr√©s: d√©tection des erreurs dans Amazon FreeRTOS</a></li>
<li><a href="../fr473972/index.html">Par ordre des d√©veloppeurs Embedded: recherche de bogues dans Amazon FreeRTOS</a></li>
<li><a href="../fr473974/index.html">Intercom'19 - une conf√©rence sur l'automatisation des communications de Voximplant aura lieu le 14 novembre</a></li>
<li><a href="../fr473978/index.html">Une telle douleur, une telle douleur, une caisse enregistreuse 2: 0</a></li>
<li><a href="../fr473980/index.html">La technologie et le monde r√©el: 4 start-ups qui changent l'avenir du design d'int√©rieur</a></li>
<li><a href="../fr473982/index.html">NB-IoT: comment √ßa marche? Partie 3: SCEF - une fen√™tre d'acc√®s unique aux services de l'op√©rateur</a></li>
<li><a href="../fr473984/index.html">Data Science Digest (octobre 2019)</a></li>
<li><a href="../fr473986/index.html">¬´Mon r√™ve est de voir une personne √† travers les arbres¬ª - fondatrice de Lisa Alert sur les technologies de recherche modernes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>