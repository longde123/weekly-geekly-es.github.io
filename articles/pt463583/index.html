<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëèüèª üßóüèª ‚úåüèº Fantastic plugins, vol. 1. Teoria üì§ üìº üë©üèΩ‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A vida com um projeto de v√°rios m√≥dulos n√£o √© t√£o simples. Para evitar a rotina de cria√ß√£o de um novo m√≥dulo, criamos nosso pr√≥prio plug-in para o And...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fantastic plugins, vol. 1. Teoria</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/hh/blog/463583/"><p>  A vida com um projeto de v√°rios m√≥dulos n√£o √© t√£o simples.  Para evitar a rotina de cria√ß√£o de um novo m√≥dulo, criamos nosso pr√≥prio plug-in para o Android Studio.  No processo de implementa√ß√£o, encontramos uma falta de documenta√ß√£o pr√°tica, tentamos v√°rias abordagens e descobrimos muitas armadilhas.  Foram publicados dois artigos: ‚ÄúTeoria‚Äù e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">‚ÄúPr√°tica‚Äù</a> .  Me encontre! </p><br><p><img src="https://habrastorage.org/webt/an/fg/dp/anfgdpffwxapeeei7coineoxdvk.png" alt="imagem"></p><a name="habracut"></a><br><h1 id="o-chem-budu-govorit">  Sobre o que vou falar? </h1><br><ul><li>  Por que um plugin?  Por que um plugin? <br><ul><li>  Elaborando uma lista de verifica√ß√£o </li><li>  Op√ß√µes de automa√ß√£o da lista de verifica√ß√£o </li></ul></li><li>  No√ß√µes b√°sicas de desenvolvimento de plugins <br><ul><li>  Ac√ß√µes </li><li>  Desenvolvimento de UI em plugins </li><li>  Conclus√µes </li></ul></li><li>  Internos da IDEA: componentes, PSI <br><ul><li>  Unidade Interna da IDEA </li><li>  PSI </li><li>  Conclus√µes </li></ul></li></ul><br><h1 id="zachem-plagin-pochemu-plagin">  Por que um plugin?  Por que um plugin? </h1><br><p>  Se voc√™ estiver desenvolvendo um projeto Android com v√°rios m√≥dulos, saber√° que tipo de rotina √© criar um novo m√≥dulo a cada vez.  Voc√™ precisa criar um m√≥dulo, configurar o Gradle nele, adicionar depend√™ncias, esperar pela sincroniza√ß√£o, n√£o se esque√ßa de consertar algo no m√≥dulo do aplicativo - tudo isso leva muito tempo.  Quer√≠amos automatizar a rotina e come√ßamos compilando uma lista de verifica√ß√£o do que fazemos cada vez que criamos um novo m√≥dulo. </p><br><p>  1. Primeiramente, criamos o pr√≥prio m√≥dulo atrav√©s do menu Arquivo -&gt; Novo -&gt; Novo m√≥dulo -&gt; Biblioteca Android. </p><br><p><img src="https://habrastorage.org/webt/eo/nt/tk/eonttksy33ofpojuctkl8aoghuo.png" alt="imagem"></p><br><p>  2. Escrevemos os caminhos para o m√≥dulo no arquivo settings.gradle, porque temos v√°rios tipos de m√≥dulos - m√≥dulos principais e m√≥dulos de recursos, que est√£o em pastas diferentes. </p><br><div class="spoiler">  <b class="spoiler_title">Escrevemos caminhos para os m√≥dulos</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// settings.gradle include ':analytics project(':analytics').projectDir = new File(settingsDir, 'core/framework-metrics/analytics) ... include ':feature-worknear' project(':feature-worknear').projectDir = new File(settingsDir, 'feature/feature-worknear')</span></span></code> </pre> </div></div><br><p>  3. <em>Alteramos</em> as constantes <em>compileSdk</em> , <em>minSdk</em> , <em>targetSdk</em> no <em>build.gradle</em> gerado: as substitu√≠mos pelas constantes definidas na raiz <em>build.gradle</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Alterando constantes no build.gradle do novo m√≥dulo</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Feature module build.gradle ‚Ä¶ android { compileSdkVersion rootProject.ext.targetSdkVersion defaultConfig { minSdkVersion rootProject.ext.minSdkVersion targetSdkVersion rootProject.ext.targetSdkVersion ... } }</span></span></code> </pre> </div></div><br><p>  Nota: removemos recentemente esta parte do nosso trabalho para o plugin Gradle, que ajuda a configurar todos os par√¢metros necess√°rios do arquivo <em>build.gradle</em> em v√°rias linhas. </p><br><p>  4. Como estamos escrevendo todo o novo c√≥digo no Kotlin, como padr√£o, conectamos dois plugins: <em>kotlin-android</em> e <em>kotlin-kapt</em> .  Se o m√≥dulo estiver de alguma forma conectado √† interface do usu√°rio, conectamos adicionalmente o <em>m√≥dulo kotlin-android-extensions</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Conectar plugins Kotlin</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Feature module build.gradle apply plugin: 'com.android.library' apply plugin: 'kotlin-android' apply plugin: 'kotlin-android-extensions' apply plugin: 'kotlin-kapt'</span></span></code> </pre></div></div><br><p>  5. Conectamos as bibliotecas gerais e m√≥dulos principais.  Os m√≥dulos principais s√£o, por exemplo, criador de logs, an√°lises, alguns utilit√°rios gerais e bibliotecas - RxJava, Moxy e muitos outros. </p><br><div class="spoiler">  <b class="spoiler_title">Conectamos bibliotecas e m√≥dulos compartilhados</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Feature module build.gradle dependencies { def libraries = rootProject.ext.deps compileOnly project(':logger') compileOnly project(':analytics') ‚Ä¶ // Kotlin compileOnly libraries.kotlin // DI compileOnly libraries.toothpick kapt libraries.toothpickCompiler }</span></span></code> </pre></div></div><br><p>  6. Configure o kapt para palito.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Palito de dente</a> √© a nossa estrutura principal de DI.  Provavelmente voc√™ sabe: para usar a gera√ß√£o de c√≥digo em vez de refletir na vers√£o, voc√™ precisa configurar o processador de anota√ß√µes para que ele entenda onde obter as f√°bricas dos objetos que est√£o sendo criados: </p><br><div class="spoiler">  <b class="spoiler_title">Configurando o Processador de Anota√ß√£o para o Palito</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Feature module build.gradle defaultConfig { ... javaCompileOptions { annotationProcessorOptions { arguments = [ toothpick_registry_package_name: "ru.hh.feature_worknear" ] } } ...</span></span></code> </pre> </div></div><br><p>  Nota: no hh.ru, usamos a primeira vers√£o do Toothpick, na segunda, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">removemos a capacidade de usar a gera√ß√£o de c√≥digo</a> . </p><br><p>  7. N√≥s configuramos o kapt para Moxy dentro do m√≥dulo criado.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O Moxy</a> √© nossa principal estrutura para criar MVP em um aplicativo, e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">voc√™ precisa torcer um pouco para</a> que ele possa funcionar em um projeto de v√°rios m√≥dulos.  Em particular, registre o pacote do m√≥dulo criado nos argumentos do kapt: </p><br><div class="spoiler">  <b class="spoiler_title">Configurando o kapt para Moxy</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Feature module build.gradle android { ... kapt { arguments { arg("moxyReflectorPackage", "ru.hh.feature_worknear") } } ...</span></span></code> </pre></div></div><br><p>  Nota: j√° mudamos para a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nova vers√£o do Moxy</a> , e essa parte da gera√ß√£o de c√≥digo perdeu sua relev√¢ncia. </p><br><p>  8. Geramos um monte de novos arquivos.  N√£o me refiro aos arquivos criados automaticamente (AndroidManifest.xml, build.gradle, .gitignore), mas √† estrutura geral do novo m√≥dulo: interatores, reposit√≥rios, m√≥dulos DI, apresentadores, fragmentos.  Existem muitos desses arquivos, eles t√™m a mesma estrutura no in√≠cio e cri√°-los √© uma rotina. </p><br><p><img src="https://habrastorage.org/webt/j2/f5/sz/j2f5szalxm1nmgg4yj9kivxpdfs.png" alt="imagem"></p><br><p>  9. Conectamos nosso m√≥dulo criado ao m√≥dulo de aplicativo.  Nesta etapa, voc√™ deve se lembrar de configurar o Toothpick no arquivo build.gradle do m√≥dulo de aplicativo.  Para fazer isso, adicionamos o pacote do m√≥dulo criado ao processador de anota√ß√£o de argumento especial - <em>toothpick_registry_children_package_names</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Palito de Sintonia</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// App module build.gradle defaultConfig { ‚Ä¶ javaCompileOptions { annotationProcessorOptions { arguments = [ toothpick_registry_package_name: "ru.hh.android", toothpick_registry_children_package_names: [ "ru.hh.analytics", "ru.hh.feature_worknear", ... ].join(",") ] } } ‚Ä¶</span></span></code> </pre></div></div><br><p>  Depois disso, configuramos o Moxy no m√≥dulo de aplicativo.  Temos uma classe que √© marcada com a anota√ß√£o <strong>@RegisterMoxyReflectorPackages</strong> - a√≠ adicionamos o nome do pacote do m√≥dulo criado: </p><br><div class="spoiler">  <b class="spoiler_title">Configurar o MoxyReflectorStub</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// App module file @RegisterMoxyReflectorPackages( "ru.hh.feature_force_update", "ru.hh.feature_profile", "ru.hh.feature_worknear" ... ) class MoxyReflectorStub</span></span></code> </pre> </div></div><br><p>  E, no final, n√£o esque√ßa de conectar o m√≥dulo criado ao bloco de <em>depend√™ncias</em> do m√≥dulo de aplicativo: </p><br><div class="spoiler">  <b class="spoiler_title">Adicionando depend√™ncias</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Application module build.gradle dependencies { def libraries = rootProject.ext.deps implementation project(':logger') implementation project(':dependency-handler') implementation project(':common') implementation project(':analytics') implementation project(':feature_worknear') ...</span></span></code> </pre> </div></div><br><p>  Temos uma lista de verifica√ß√£o de nove pontos. </p><br><p>  Como existem muitos pontos, √© prov√°vel que esque√ßa algo.  Depois, passe horas imaginando o que aconteceu e por que o projeto n√£o est√° indo. </p><br><p>  Decidimos que voc√™ n√£o pode viver assim e precisa mudar alguma coisa. </p><br><h2 id="varianty-avtomatizacii-chek-lista">  Op√ß√µes de automa√ß√£o da lista de verifica√ß√£o </h2><br><p>  Ap√≥s compilar a lista de verifica√ß√£o, come√ßamos a procurar op√ß√µes para automatizar seus itens. </p><br><p>  A primeira op√ß√£o foi uma tentativa de fazer <strong>"Ctrl + C, Ctrl + V"</strong> .  Tentamos encontrar uma implementa√ß√£o para criar o m√≥dulo Biblioteca Android, que est√° dispon√≠vel para n√≥s "pronto para uso".  Na pasta com o Android Studio (para MacOs: <em>/ Aplicativos / Android \ Studio.app/Contents/plugins/android/lib/templates/gradle-projects/</em> ), voc√™ pode encontrar uma pasta especial com modelos dos projetos que v√™ quando seleciona Arquivo - &gt; Novo -&gt; Novo m√≥dulo.  Tentamos copiar o modelo NewAndroidModule alterando o ID dentro do arquivo <em>template.xml.ftl</em> .  Em seguida, eles lan√ßaram o IDE, come√ßaram a criar um novo m√≥dulo e ... O Android Studio falhou porque a lista de m√≥dulos que voc√™ v√™ no menu para criar um novo m√≥dulo √© codificada, n√£o √© poss√≠vel alter√°-la com uma c√≥pia-colagem primitiva.  Quando voc√™ tenta capturar e adicionar, excluir ou alterar um elemento, o Android Studio trava. </p><br><p><img src="https://habrastorage.org/webt/ym/ww/sw/ymwwsw1rzibvaxwrhkqkwd5fqyk.png" alt="imagem"></p><br><p>  A segunda op√ß√£o para automatizar a lista de verifica√ß√£o foi o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mecanismo de modelo FreeMarker</a> .  Ap√≥s uma tentativa malsucedida de copiar e colar, decidimos examinar mais de perto os modelos de m√≥dulo e encontramos modelos do FreeMarker sob o cap√¥. </p><br><p>  N√£o vou contar o que √© o FreeMarker em detalhes - h√° um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bom artigo do RedMadRobot</a> e um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">v√≠deo do MosDroid de Lesha Bykov</a> .  Mas, resumindo, este √© um mecanismo para gerar arquivos usando modelos e objetos java Map-ki especiais.  Voc√™ alimenta modelos, objetos e o FreeMarker gera c√≥digo na sa√≠da. </p><br><p>  Mas olhe novamente para a lista de verifica√ß√£o: </p><br><p><img src="https://habrastorage.org/webt/nf/hl/81/nfhl811qacot1f4j_pt2fhsmm8k.png" alt="imagem"></p><br><p>  Se voc√™ observar atentamente, poder√° ver que ele est√° dividido em dois grandes grupos de tarefas: </p><br><ul><li>  As tarefas de gerar um novo c√≥digo (1, 3, 4, 5, 6, 7, 8) e </li><li>  Tarefas para modificar um c√≥digo existente (2, 7, 8, 9) </li></ul><br><p>  E se o FreeMarker lida com tarefas do primeiro grupo com um estrondo, ele n√£o lida com o segundo.  Como um pequeno exemplo: na implementa√ß√£o atual da integra√ß√£o do FreeMarker no Android Studio, quando voc√™ tenta inserir uma linha no arquivo settings.gradle que n√£o come√ßa com a palavra 'include', o <a href="">est√∫dio trava</a> .  Aqui pegamos o triste e decidimos abandonar o uso do FreeMarker. </p><br><p>  Ap√≥s uma falha no FreeMarker, surgiu a id√©ia de escrever meu pr√≥prio utilit√°rio de console para executar uma lista de verifica√ß√£o.  Dentro do Intellij IDEA, √© poss√≠vel usar um terminal. Por que n√£o?  Vamos escrever um script sobre o neg√≥cio total do bash: </p><br><p><img src="https://habrastorage.org/webt/t0/2h/ki/t02hki4jlkvs_7eaqisfbuqnyb0.png" alt="imagem"></p><br><p>  Por√©m, como queremos configurar de forma flex√≠vel o m√≥dulo criado, teremos que inserir muitos sinalizadores diferentes, o que n√£o ser√° muito conveniente para imprimir no console. </p><br><p>  Depois disso, demos um passo atr√°s e lembramos que est√°vamos trabalhando dentro da Intellij IDEA.  E como √© organizado?  H√° um certo n√∫cleo de classes, um mecanismo ao qual muitos plug-ins est√£o conectados, que adicionam a funcionalidade necess√°ria. </p><br><p>  Quantos de voc√™s v√™em na captura de tela mais de dois plugins conectados? </p><br><p><img src="https://habrastorage.org/webt/rf/fr/dm/rffrdmuui00uxtruelogjpor_le.png" alt="imagem"></p><br><div class="spoiler">  <b class="spoiler_title">Para onde olhar?</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/0m/uw/ua/0muwuamgty0p8kri2ywhq3dsbaw.png" alt="imagem"></p></div></div><br><p>  Aqui eles est√£o conectados pelo menos tr√™s.  Se voc√™ trabalha com o Kotlin, tem o plugin Kotlin ativado.  Se voc√™ estiver trabalhando em um projeto com Gradle, o plug-in Gradle tamb√©m ser√° inclu√≠do.  Se voc√™ estiver trabalhando em um projeto com um sistema de controle de vers√£o - Git, SVN ou qualquer outra coisa - voc√™ ter√° o plug-in apropriado inclu√≠do para integrar este VCS. </p><br><p>  Analisamos o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reposit√≥rio oficial de plugins</a> JetBrains e constatamos que j√° existem mais de 4000 plugins registrados oficialmente!  Quase todo o mundo escreve plugins, e esses plugins podem fazer qualquer coisa: come√ßando pela integra√ß√£o de uma linguagem de programa√ß√£o no IDEA e terminando com ferramentas espec√≠ficas que podem ser executadas no IDEA. </p><br><p>  Resumindo, decidimos escrever nosso pr√≥prio plugin. </p><br><h1 id="osnovy-razrabotki-plaginov">  No√ß√µes b√°sicas de desenvolvimento de plugins </h1><br><p>  Passamos ao b√°sico do desenvolvimento de plugins.  Para come√ßar, voc√™ s√≥ precisa de tr√™s coisas: </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">IntelliJ IDEA</a> , m√≠nimo Community Edition (voc√™ pode trabalhar na vers√£o Ultimate, mas n√£o oferecer√° vantagens especiais ao desenvolver plugins); </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O plugin DevKit</a> conectado a ele √© um plugin especial que adiciona a capacidade de escrever outros plugins; </li><li>  E qualquer linguagem da JVM na qual voc√™ deseja escrever um plugin.  Pode ser Kotlin, Java, Groovy - qualquer coisa. </li></ol><br><p>  Come√ßamos criando um projeto de plugin.  Selecionamos <strong>Novo projeto</strong> , aponte <strong>Gradle</strong> , assinalamos o <strong>IntelliJ Platform Plugin</strong> e criamos o projeto. </p><br><p><img src="https://habrastorage.org/webt/je/rf/wd/jerfwdeqfmpzdef-_cypw4wahw8.png" alt="imagem"></p><br><p>  Nota: Se voc√™ n√£o encontrar a caixa de sele√ß√£o IntelliJ Platform Plugin, significa que voc√™ n√£o possui o Plugin DevKit instalado. </p><br><p>  Ap√≥s preencher os campos obrigat√≥rios, veremos uma estrutura de plug-in vazia. </p><br><p><img src="https://habrastorage.org/webt/i2/sy/59/i2sy59dpr0pi8nlmhfyhson20h8.png" alt="imagem"></p><br><p>  Vamos dar uma olhada mais de perto.  Consiste em: </p><br><ul><li>  Pastas nas quais voc√™ escrever√° o c√≥digo para o projeto futuro;  ( <em>main / java</em> , <em>main / kotlin</em> , etc); </li><li>  arquivo <em>build.gradle</em> , no qual voc√™ declarar√° as depend√™ncias do seu plugin em algumas bibliotecas e tamb√©m configurar√° algo como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>gradle-intellij-plugin</em></a> . </li></ul><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>gradle-intellij-plugin</em></a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>plugin</em></a> Gradle que permite usar o Gradle como um sistema de cria√ß√£o de plugins.  Isso √© conveniente porque quase todos os desenvolvedores do Android est√£o familiarizados com o Gradle e sabem como trabalhar com ele.  Al√©m disso, o gradle-intellij-plugin adiciona tarefas gradle √∫teis ao seu projeto, em particular: </p><br><ul><li>  runIde - esta tarefa inicia uma inst√¢ncia IDEA separada com um plug-in que voc√™ est√° desenvolvendo para poder depur√°-la; </li><li>  buildPlugin - coleta o arquivo zip do seu plug-in para que voc√™ possa distribu√≠-lo localmente ou atrav√©s do reposit√≥rio oficial da IDEA; </li><li>  confirmPlugin - esta tarefa verifica se h√° erros graves no plug-in que podem n√£o permitir a integra√ß√£o no Android Studio ou em outra IDEA. </li></ul><br><p>  O que mais est√° <em>dando o gradle-intellij-plugin</em> ?  Com sua ajuda, fica mais f√°cil adicionar depend√™ncias em outros plugins, mas falaremos sobre isso um pouco mais tarde, mas por enquanto posso dizer que <em>gradle-intellij-plugin</em> √© seu irm√£o, use-o. </p><br><p>  Voltar para a estrutura do plugin.  O arquivo mais importante de qualquer plug-in √© o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>plugin.xml</em></a> . </p><br><div class="spoiler">  <b class="spoiler_title">plugin.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">idea-plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>com.experiment.simple.plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>Hello, world<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vendor</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">email</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"myemail@yourcompany.com"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">url</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.mycompany.com"</span></span></span><span class="hljs-tag">&gt;</span></span> My company <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vendor</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>&lt;![CDATA[ My first ever plugin - try to open Hello world dialog&lt;br&gt; ]]&gt;<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span>com.intellij.modules.lang<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span>org.intellij.groovy<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">idea-version</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">since-build</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"163"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">actions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">description</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"My actions"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MyActionGroup"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"My actions"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">separator</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.experiment.actions.OpenHelloWorldAction"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.experiment.actions.OpenHelloWorldAction"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Show Hello world"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">description</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Open dialog"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add-to-group</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">group-id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"NewGroup"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">anchor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"last"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">actions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">idea-plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br><p>  Este √© um arquivo que cont√©m: </p><br><ul><li>  Os metadados do seu plug-in: identificador, nome, descri√ß√£o, informa√ß√µes do fornecedor, log de altera√ß√µes </li><li>  Descri√ß√£o de depend√™ncias em outros plugins; </li><li>  Aqui voc√™ tamb√©m pode especificar a vers√£o do IDEA com a qual seu plug-in funcionar√° corretamente </li><li>  <em>As a√ß√µes</em> tamb√©m s√£o descritas aqui. </li></ul><br><h3 id="actions">  Ac√ß√µes </h3><br><p>  O que s√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a√ß√µes</a> ?  Suponha que voc√™ abra um menu para criar um novo arquivo.  De fato, cada elemento deste menu foi adicionado por algum tipo de plugin: </p><br><p><img src="https://habrastorage.org/webt/al/8y/kg/al8ykgojltbksqkuqu5l8cww4fw.png" alt="imagem"></p><br><p>  A√ß√µes s√£o os pontos de entrada do seu plug-in para os usu√°rios.  Cada vez que o usu√°rio clica em um item de menu, voc√™ obt√©m controle dentro do plug-in, pode responder a esse clique e fazer o que for necess√°rio. <br>  Como s√£o criadas as a√ß√µes?  Vamos escrever uma a√ß√£o simples que exibir√° uma caixa de di√°logo com a mensagem "Ol√°, mundo". </p><br><div class="spoiler">  <b class="spoiler_title">OpenHelloWorldAction</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OpenHelloWorldAction</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AnAction</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionPerformed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(actionEvent: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">AnActionEvent</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> project = actionEvent.project Messages.showMessageDialog( project, <span class="hljs-string"><span class="hljs-string">"Hello world!"</span></span>, <span class="hljs-string"><span class="hljs-string">"Greeting"</span></span>, Messages.getInformationIcon() ) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">AnActionEvent</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.update(e) <span class="hljs-comment"><span class="hljs-comment">// TODO - Here we can update our action (for example, disable it) } override fun beforeActionPerformedUpdate(e: AnActionEvent) { super.beforeActionPerformedUpdate(e) // TODO - This method calls right before 'actionPerformed' } }</span></span></code> </pre> </div></div><br><p>  Para criar uma a√ß√£o, primeiro criamos uma classe que herda da classe <em>AnAction</em> .  Em segundo lugar, devemos redefinir o m√©todo actionPerformed, onde o par√¢metro especial da classe <em>AnActionEvent vem</em> .  Este par√¢metro cont√©m informa√ß√µes sobre o contexto de execu√ß√£o da sua a√ß√£o.  O contexto refere-se ao projeto em que voc√™ est√° trabalhando, o arquivo que est√° aberto para o usu√°rio no editor de c√≥digo, os elementos selecionados na √°rvore do projeto e outros dados que podem ajudar no processamento de suas tarefas. </p><br><p>  Para mostrar a caixa de di√°logo "Ol√°, mundo", primeiro obtemos o projeto (apenas a partir do par√¢metro <em>AnActionEvent</em> ) e depois usamos a classe de utilit√°rio <em>Messages</em> para exibir a caixa de di√°logo. </p><br><p>  Quais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">recursos adicionais</a> temos dentro da a√ß√£o?  Podemos substituir dois m√©todos: <em>update</em> e <em>beforeActionPerformedUpdate</em> . </p><br><p>  O m√©todo de <em>atualiza√ß√£o</em> √© chamado sempre que o contexto de execu√ß√£o da sua a√ß√£o √© alterado.  Por que pode ser √∫til para voc√™: por exemplo, para atualizar o item de menu que foi adicionado pelo seu plugin.  Suponha que voc√™ escreveu uma A√ß√£o que s√≥ pode funcionar com arquivos Kotlin e que o usu√°rio abriu o arquivo Groovy.  Em seguida, no m√©todo de atualiza√ß√£o, voc√™ pode tornar sua a√ß√£o inacess√≠vel. </p><br><p>  O m√©todo <em>beforeActionPerformedUpdate √©</em> semelhante ao m√©todo update, mas √© chamado logo antes do <em>actionPerformed</em> .  Esta √© a √∫ltima oportunidade de influenciar sua a√ß√£o.  A documenta√ß√£o recomenda que voc√™ n√£o execute nada "pesado" neste m√©todo, para que seja executado o mais r√°pido poss√≠vel. </p><br><p>  Voc√™ tamb√©m pode vincular a√ß√µes a certos elementos da interface IDEA e atribuir combina√ß√µes de teclas padr√£o para chamadas - eu recomendo ler mais sobre isso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </p><br><h3 id="razrabotka-ui-v-plaginah">  Desenvolvimento de UI em plugins </h3><br><p>  Se voc√™ precisar de seu pr√≥prio design de di√°logo, precisar√° trabalhar duro.  Desenvolvemos nossa interface do usu√°rio porque quer√≠amos ter uma interface gr√°fica conveniente na qual seria poss√≠vel marcar alguns ticks, ter um seletor para valores de enumera√ß√£o e assim por diante. </p><br><p>  O plug-in DevKit para desenvolvimento da interface do usu√°rio adiciona algumas a√ß√µes, como o <em>formul√°rio da GUI</em> e o <em>Di√°logo</em> .  O primeiro cria um formul√°rio vazio para n√≥s, o segundo - um formul√°rio com dois bot√µes: <em>Ok</em> e <em>Cancelar</em> . </p><br><p><img src="https://habrastorage.org/webt/wd/bx/3r/wdbx3rhggovpfv-fey53fucs2aw.png" alt="imagem"></p><br><p>  Ok, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">existe um designer de formul√°rios</a> , mas ele √© ... mais ou menos.  Em compara√ß√£o, at√© o designer de Layout do Android Studio parece confort√°vel e bom.  A interface do usu√°rio inteira √© desenvolvida em uma biblioteca como o Java Swing.  Este designer de formul√°rio gera um arquivo XML leg√≠vel por humanos.  Se voc√™ n√£o pode fazer algo no designer de formul√°rios (exemplo: inserir v√°rios controles na mesma c√©lula da grade e ocultar todos os controles, exceto um), √© necess√°rio acessar este arquivo e alter√°-lo - o IDEA selecionar√° essas altera√ß√µes. </p><br><p>  Quase todos os formul√°rios consistem em dois arquivos: o primeiro possui a extens√£o <em>.form</em> , este √© apenas o arquivo XML, o segundo √© a chamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>classe Bound</em></a> , que pode ser escrita em Java, Kotlin, mas o que voc√™ quiser.  Ele atua como um controlador de formul√°rio.  Inesperadamente, mas escrever em Java √© muito mais f√°cil do que em outras linguagens.  Porque, por exemplo, o ajuste para Kotlin ainda n√£o √© t√£o perfeito.  Ao adicionar novos componentes ao trabalhar com a classe Java, esses componentes s√£o automaticamente adicionados √† classe e, quando voc√™ altera o nome do componente no designer, ele √© automaticamente puxado.  Mas no caso do Kotlin, os componentes n√£o s√£o adicionados - nenhuma integra√ß√£o ocorre, voc√™ pode esquecer algo e n√£o entender por que nada funciona. </p><br><h3 id="rezyumiruem-osnovy">  Resumimos o b√°sico </h3><br><ul><li>  Para criar um plugin, voc√™ precisar√°: IDEA Community Edition, Plugin DevKit e Java conectado a ele. </li><li>  gradle-intellij-plugin √© seu irm√£o, isso simplificar√° bastante sua vida, eu recomendo us√°-lo. </li><li>  N√£o escreva sua pr√≥pria interface do usu√°rio, a menos que seja necess√°rio.  Existem muitas classes de utilit√°rios no IDEA que permitem criar sua pr√≥pria interface do usu√°rio imediatamente.  Se voc√™ precisar de algo complicado - prepare-se para trabalhar duro. </li><li>  O plug-in pode ter qualquer n√∫mero de a√ß√µes.  O mesmo plugin pode adicionar muitas funcionalidades √† sua IDEA. </li></ul><br><h1 id="vnutrennosti-idea-komponenty-psi">  Internos da IDEA: componentes, PSI </h1><br><p>  Vamos falar sobre o intestino da IDEA, sobre como ele √© organizado no interior.  Estou lhe dizendo para que nada desmorone na sua cabe√ßa quando explico a parte pr√°tica, e para que voc√™ entenda de onde vem. </p><br><p>  Como √© organizado o IDEA?  No primeiro n√≠vel da hierarquia, h√° uma classe como <a href=""><em>Aplicativo</em></a> .  Esta √© uma inst√¢ncia separada da IDEA.  Para cada inst√¢ncia do IDEA, um objeto de classe Aplicativo √© criado.  Por exemplo, se voc√™ executar o AppCode, Intellij IDEA, Android Studio ao mesmo tempo, obter√° tr√™s inst√¢ncias separadas da classe Application.  Esta classe foi projetada para lidar com o fluxo de entrada / sa√≠da. </p><br><div class="spoiler">  <b class="spoiler_title">Coloque o aplicativo na hierarquia</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/rw/_y/vm/rw_yvmpfn1hyekftipxwuq-qxn8.png" alt="imagem"></p></div></div><br><p>  O pr√≥ximo n√≠vel √© a classe <a href=""><em>Projeto</em></a> .  Esse √© o conceito mais pr√≥ximo do que voc√™ v√™ ao abrir um novo projeto no IDEA.  Geralmente, √© necess√°rio um projeto para obter outros componentes dentro do IDEA: classes de utilidade, gerentes e muito mais. </p><br><div class="spoiler">  <b class="spoiler_title">Lugar do projeto na hierarquia</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/xv/ku/z6/xvkuz6ezzzd5w5_c9suloyafcza.png" alt="imagem"></p></div></div><br><p>  O pr√≥ximo n√≠vel de detalhe √© a classe <a href=""><em>Module</em></a> .  Em geral, um m√≥dulo √© uma hierarquia de classes agrupadas em uma pasta.  Mas aqui por m√≥dulos queremos dizer m√≥dulos Maven, m√≥dulos Gradle.  Essa classe √© necess√°ria, primeiro, para determinar as depend√™ncias entre os m√≥dulos e, em segundo lugar, para procurar classes dentro desses m√≥dulos. </p><br><div class="spoiler">  <b class="spoiler_title">Coloque o m√≥dulo em uma hierarquia</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/zr/vs/ah/zrvsahicec7gak2sfqhox2ldts0.png" alt="imagem"></p></div></div><br><p>  O pr√≥ximo n√≠vel de detalhe √© a classe <a href=""><em>VirtualFile</em></a> .  Esta √© uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">abstra√ß√£o sobre o arquivo real</a> que est√° no seu disco.  V√°rias inst√¢ncias do <em>VirtualFile</em> podem corresponder a cada arquivo real, mas s√£o todas iguais.  Ao mesmo tempo, se o arquivo real for exclu√≠do, o <em>VirtualFile</em> n√£o ser√° exclu√≠do por si s√≥, mas simplesmente se tornar√° inv√°lido. </p><br><div class="spoiler">  <b class="spoiler_title">Local da hierarquia do VirtualFile</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/z8/4y/hq/z84yhqyl6tzv-1uwc_ersyhmqv0.png" alt="imagem"></p></div></div><br><p>  <em>Uma</em> entidade como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>Document</em></a> est√° associada a cada <em>VirtualFile</em> .  √â uma abstra√ß√£o sobre o texto do seu arquivo.  <em>O documento √©</em> necess√°rio para que voc√™ possa rastrear eventos relacionados a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">altera√ß√µes no texto do arquivo</a> : o usu√°rio inseriu uma linha, excluiu uma linha, etc., etc. </p><br><div class="spoiler">  <b class="spoiler_title">Colocar documento na hierarquia</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/fr/nc/qg/frncqgrdpc3xgtnn_txrhlvdcv0.png" alt="imagem"></p></div></div><br><p>  Um pouco ao lado dessa hierarquia √© a classe <a href=""><em>Editor</em></a> - √© um editor de c√≥digo.  Cada projeto pode ter um <em>editor</em> .  √â necess√°rio para que voc√™ possa rastrear eventos relacionados ao editor de c√≥digo: o usu√°rio destacou a linha onde est√° o cursor, e assim por diante. </p><br><div class="spoiler">  <b class="spoiler_title">Lugar do editor na hierarquia</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/fk/kj/l-/fkkjl-c-t5nyehcwt6j-ywdhwf0.png" alt="imagem"></p></div></div><br><p>  A √∫ltima coisa que eu queria falar √© sobre <a href=""><em>PsiFile</em></a> .  Isso tamb√©m √© uma abstra√ß√£o sobre arquivos reais, mas do ponto de vista da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">representa√ß√£o de elementos de c√≥digo</a> .  PSI significa Program Structure Interface. </p><br><div class="spoiler">  <b class="spoiler_title">Lugar do PsiFile na hierarquia</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ho/kn/l0/hoknl08rk2giwbxure86b3pqcva.png" alt="imagem"></p></div></div><br><p>  E em que consiste cada programa?  Considere uma classe Java regular. </p><br><div class="spoiler">  <b class="spoiler_title">Classe Java simples</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.experiment; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.inject.Inject; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeClass</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> String injectedString; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">someMethod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(injectedString); } }</code> </pre> </div></div><br><p>  Consiste em especificar um pacote, importa√ß√µes, classes, campos, m√©todos, anota√ß√µes, palavras-chave, tipos de dados, modificadores, identificadores, refer√™ncias de m√©todos, express√µes e tokens.  E para cada elemento, h√° uma abstra√ß√£o do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>PsiElement</em></a> .  Ou seja, cada um dos seus programas consiste em <em>PsiElements</em> . </p><br><p><img src="https://habrastorage.org/webt/ps/oa/2t/psoa2timve59g__naf1rrskzfdm.png" alt="imagem"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O PsiFile</a> , por sua vez, √© uma estrutura em √°rvore na qual cada elemento pode ter um pai e muitos descendentes. </p><br><p><img src="https://habrastorage.org/webt/mi/4j/f2/mi4jf2mdcqjc1huurmu2ca0hsfi.png" alt="imagem"></p><br><p>  Eu gostaria de mencionar que o PSI n√£o √© igual a uma <strong>√°rvore de sintaxe abstrata</strong> .  Uma √°rvore de sintaxe abstrata √© uma √°rvore de representa√ß√£o do seu programa depois que o analisador passou no programa e √© <strong>desanexada</strong> de qualquer linguagem de programa√ß√£o.  O PSI, ao contr√°rio, est√° <strong>vinculado</strong> a uma linguagem de programa√ß√£o espec√≠fica.  Quando voc√™ trabalha com uma classe Java, est√° lidando com PsiElements Java.  Ao trabalhar com uma classe Groovy - com Groovy PsiElements e assim por diante.   ,         PSI-  -  ,      ,   , ‚Äì    . </p><br><p>      PSI ‚Äì   PSI-   IDEA.            ,    ,        ,   .         . </p><br><h3 id="rezyumiruem-chast-pro-vnutrennosti-idea">     IDEA </h3><br><ul><li> PSI      IDEA; </li><li> PSI-   IDEA,            ; </li><li>         PsiElement-. </li></ul><br><p>      ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> .            . </p><br><h2 id="dopolnitelnye-materialy-po-plaginostroeniyu">     </h2><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre a cria√ß√£o de um plug-in para rastreamento de tempo</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In√≠cio de uma grande s√©rie de artigos complementando a documenta√ß√£o do plug-in</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criando sua pr√≥pria janela da ferramenta</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre como expandir a funcionalidade do editor de c√≥digo</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pequeno exemplo de cria√ß√£o de seu pr√≥prio plugin</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">      IntelliJ IDEA</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">       IDEA</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">      IntelliJ IDEA</a> </li><li>   , , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>     .    ,     . </li><li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  Droidcon Italy 2017</a> ,  ,   , ,        FreeMarker- .        ,      . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   KotlinConf</a> ,     Square       SQLDelight,        Java,   Kotlin. </li></ul></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt463583/">https://habr.com/ru/post/pt463583/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt463573/index.html">O primeiro chip para data centers baseado na arquitetura Zen 2</a></li>
<li><a href="../pt463575/index.html">Treinamento Cisco 200-125 CCNA v3.0. Dia 22. Terceiro CCNA: continue estudando o PIR</a></li>
<li><a href="../pt463577/index.html">Plasticidade e resist√™ncia: endurecimento do intermet√°lico sem √™nfase na luxa√ß√£o</a></li>
<li><a href="../pt463579/index.html">Windows: descubra quem est√° conectado onde</a></li>
<li><a href="../pt463581/index.html">Treinamento Cisco 200-125 CCNA v3.0. Dia 23. Tecnologias avan√ßadas de roteamento</a></li>
<li><a href="../pt463585/index.html">Treinamento Cisco 200-125 CCNA v3.0. Dia 24. IPv6</a></li>
<li><a href="../pt463587/index.html">ConfigureAwait, quem √© o culpado e o que fazer?</a></li>
<li><a href="../pt463591/index.html">BlueKeep-2 - todas as novas vers√µes do Windows agora est√£o vulner√°veis</a></li>
<li><a href="../pt463595/index.html">Controlamos o foco ou uma pitada de C # e STM32 para uma webcam</a></li>
<li><a href="../pt463597/index.html">Usando a API de contexto no React para criar um design de aplicativo responsivo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>