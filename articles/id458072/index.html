<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👾 🎅🏽 🎍 PVS-Studio pergi ke awan - meluncurkan analisis tentang Travis CI 🌼 📳 ↗️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saat ini, sistem cloud CI adalah layanan yang sangat populer. Pada artikel ini kami akan memberitahu caranya, menggunakan alat yang ada yang tersedia ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PVS-Studio pergi ke awan - meluncurkan analisis tentang Travis CI</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/458072/">  Saat ini, sistem cloud CI adalah layanan yang sangat populer.  Pada artikel ini kami akan memberitahu caranya, menggunakan alat yang ada yang tersedia di PVS-Studio, Anda dapat mengintegrasikan analisis kode sumber dengan platform cloud CI, menggunakan layanan Travis CI sebagai contoh. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee1/252/191/ee125219104f0ff7d27f8c9dfc2db8bf.png" alt="Gambar 1"></div><br><a name="habracut"></a><br>  Mengapa kita melihat awan pihak ketiga dan tidak membuat awan kita sendiri?  Ada beberapa alasan, dan yang utama adalah bahwa SaaS adalah prosedur yang agak mahal dan sulit.  Bahkan, mengintegrasikan analisis PVS-Studio secara langsung dengan platform cloud pihak ketiga (apakah itu platform terbuka seperti CircleCI, Travis CI, GitLab, atau beberapa solusi perusahaan khusus yang digunakan hanya dalam satu perusahaan tertentu) adalah tugas yang cukup sederhana dan sepele.  Artinya, kita dapat mengatakan bahwa <i>PVS-Studio sudah tersedia "di awan"</i> .  Masalah yang sama sekali berbeda adalah organisasi dan penyediaan infrastruktur untuk pekerjaan tersebut 24/7.  Ini adalah tugas yang sama sekali berbeda, dan PVS-Studio tidak memiliki rencana untuk menyediakan platform cloud sendiri secara langsung untuk menjalankan analisis di atasnya. <br><br><h2>  Informasi tentang perangkat lunak yang digunakan </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Travis CI</a> adalah layanan untuk membangun dan menguji perangkat lunak yang menggunakan GitHub sebagai penyimpanan.  Travis CI tidak perlu mengubah kode program untuk menggunakan layanan ini, semua pengaturan terjadi dalam file <i>.travis.yml yang</i> terletak di root repositori. <br><br>  Kami akan menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">LXC</a> (Linux Containers) sebagai proyek uji untuk pengujian dengan PVS-Studio.  Ini adalah sistem virtualisasi tingkat sistem operasi untuk menjalankan beberapa contoh sistem operasi Linux pada satu node. <br><br>  Proyek ini kecil, tetapi lebih dari cukup untuk ditunjukkan.  Output dari perintah cloc: <br><div class="scrollable-table"><table><tbody><tr><td>  Bahasa <br></td><td>  file <br></td><td>  kosong <br></td><td>  komentar <br></td><td>  kode <br></td></tr><tr><td>  C <br></td><td>  124 <br></td><td>  11937 <br></td><td>  6758 <br></td><td>  50836 <br></td></tr><tr><td>  C / C ++ Header <br></td><td>  65 <br></td><td>  1117 <br></td><td>  3676 <br></td><td>  3774 <br></td></tr></tbody></table></div>  <b>Catatan:</b> Pengembang LXC sudah menggunakan Travis CI, jadi kami akan mengambil file konfigurasi mereka sebagai basis dan mengeditnya untuk tujuan kami. <br><br><h2>  Kustomisasi </h2><br>  Untuk memulai dengan Travis CI, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ikuti tautan</a> dan autentikasi menggunakan akun GitHub. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ba/8fc/c5a/1ba8fcc5a0caf41da255093cf4feaa8e.png" alt="Gambar 17"></div><br>  Di jendela yang terbuka, Anda perlu mengesahkan Travis CI. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d7/aec/13d/2d7aec13dec45022c952ff0498a6acae.png" alt="Gambar 16"></div><br>  Setelah otorisasi, pengalihan ke halaman pembuka “Pertama kali di sini?  Mari kita mulai! "  <b>,</b> yang menjelaskan secara singkat apa yang perlu dilakukan selanjutnya untuk memulai: <br><br><ul><li>  mengaktifkan repositori; </li><li>  tambahkan file .travis.yml ke repositori; </li><li>  jalankan build pertama. </li></ul><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/29c/17f/c83/29c17fc830db9fad9d6d9dcb7fa047d7.png" alt="Gambar 18"></div><br>  Kami akan mulai melaksanakan poin-poin ini. <br><br>  Untuk menambahkan repositori kami ke Travis CI, buka pengaturan profil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">melalui tautan</a> dan klik tombol "Activate". <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ab8/1f7/75e/ab81f775edc51c92b3238bf30b40527d.png" alt="Gambar 19"></div><br>  Setelah mengklik, sebuah jendela terbuka dengan pilihan repositori yang dapat diakses oleh aplikasi Travis CI. <br>  <b>Catatan:</b> untuk memberikan akses ke repositori, akun harus memiliki hak administrator untuk itu. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e8/4fe/351/1e84fe351a57fcff37b5b70ec77e9cc5.png" alt="Gambar 38"></div><br>  Kami memilih repositori yang diinginkan, mengonfirmasi pilihan dengan tombol "Setuju &amp; Instal", dan kami akan diarahkan kembali ke halaman pengaturan profil. <br><br>  Segera buat variabel yang akan kita gunakan untuk membuat file lisensi penganalisa dan mengirimkan laporannya.  Untuk melakukan ini, buka halaman pengaturan - tombol "Pengaturan" di sebelah kanan repositori yang diinginkan. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d35/f44/907/d35f449074bd079c1b35140dd8336173.png" alt="Gambar 39"></div><br>  Jendela pengaturan akan terbuka. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfe/c5f/1a8/cfec5f1a8ea19bf2c6e9e63c7af4c68c.png" alt="Gambar 41"></div><br>  Deskripsi singkat pengaturan: <br><br><ul><li>  Bagian "Umum" - pengaturan pemicu untuk tugas autorun; </li><li>  Bagian "Pembatalan Otomatis" - memungkinkan Anda untuk mengkonfigurasi rakitan membatalkan otomatis; </li><li>  Bagian "Variabel Lingkungan" - memungkinkan Anda untuk menentukan variabel lingkungan yang berisi informasi publik dan rahasia, seperti kredensial, kunci ssh; </li><li>  Bagian “Pekerjaan Cron” - mengatur jadwal peluncuran tugas. </li></ul><br>  Di bagian "Variabel Lingkungan" kami membuat variabel <i>PVS_USERNAME</i> dan <i>PVS_KEY</i> yang masing-masing berisi nama pengguna dan kunci lisensi untuk penganalisa statis.  Jika Anda tidak memiliki lisensi PVS-Studio permanen, maka Anda dapat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">meminta lisensi uji coba</a> . <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8aa/731/483/8aa731483fc391273980c7de338f83be.png" alt="Gambar 5"></div><br>  Segera buat variabel <i>MAIL_USER</i> dan <i>MAIL_PASSWORD yang</i> berisi nama pengguna dan kata sandi kotak surat, yang akan kami gunakan untuk mengirim laporan. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/37d/a42/9b4/37da429b49812239ab900e3b6fe5a90d.png" alt="Gambar 4"></div><br>  Ketika tugas diluncurkan, Travis CI mengambil instruksi dari file .travis.yml yang terletak di root repositori. <br><br>  Menggunakan Travis CI, kita dapat menjalankan analisis statis secara langsung di mesin virtual, atau menggunakan wadah yang telah dikonfigurasi untuk ini.  Hasil pendekatan ini tidak berbeda satu sama lain, tetapi menggunakan wadah pra-konfigurasi bisa berguna, misalnya, jika kita sudah memiliki wadah dengan beberapa lingkungan spesifik di mana produk perangkat lunak dibangun dan diuji, dan tidak ada keinginan untuk memulihkan lingkungan ini di Travis CI . <br><br>  Mari kita membuat konfigurasi untuk menjalankan analisa di mesin virtual. <br><br>  Untuk perakitan dan pengujian, kami akan menggunakan mesin virtual berbasis Ubuntu Trusty, deskripsinya dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Pertama-tama, kami menunjukkan bahwa proyek ini ditulis dalam C dan kami daftar kompiler yang akan kami gunakan untuk perakitan: <br><br><pre><code class="cpp hljs">language: c compiler: - gcc - clang</code> </pre> <br>  <b>Catatan</b> : jika Anda menentukan lebih dari satu kompiler, tugas akan diluncurkan secara paralel untuk masing-masingnya.  Baca lebih lanjut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di dokumentasi</a> . <br><br>  Sebelum memulai pembuatan, kita perlu menambahkan repositori analyzer, menginstal dependensi dan paket tambahan: <br><br><pre> <code class="cpp hljs">before_install: - sudo add-apt-repository ppa:ubuntu-lxc/daily -y - wget -q -O - https:<span class="hljs-comment"><span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | sudo apt-key add - - sudo wget -O /etc/apt/sources.list.d/viva64.list https://files.viva64.com/etc/viva64.list - sudo apt-get update -qq - sudo apt-get install -qq coccinelle parallel libapparmor-dev libcap-dev libseccomp-dev python3-dev python3-setuptools docbook2x libgnutls-dev libselinux1-dev linux-libc-dev pvs-studio libio-socket-ssl-perl libnet-ssleay-perl sendemail ca-certificates</span></span></code> </pre> <br>  Sebelum membangun proyek, Anda perlu menyiapkan lingkungan: <br><br><pre> <code class="cpp hljs">script: - ./coccinelle/run-coccinelle.sh -i - git diff --<span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>-code - <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> CFLAGS=<span class="hljs-string"><span class="hljs-string">"-Wall -Werror"</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> LDFLAGS=<span class="hljs-string"><span class="hljs-string">"-pthread -lpthread"</span></span> - ./autogen.sh - rm -Rf build - mkdir build - cd build - ../configure --enable-tests --with-distro=unknown</code> </pre> <br>  Selanjutnya, kita perlu membuat file dengan lisensi dan menjalankan analisis proyek. <br><br>  Perintah pertama membuat file lisensi untuk penganalisa.  Data untuk variabel <i>$ PVS_USERNAME</i> dan <i>$ PVS_KEY</i> diambil dari pengaturan proyek. <br><br><pre> <code class="cpp hljs">- pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic</code> </pre> <br>  Perintah berikut memulai jejak perakitan proyek: <br><br><pre> <code class="cpp hljs">- pvs-studio-analyzer trace -- make -j4</code> </pre> <br>  Setelah kami memulai analisis statis. <br>  <b>Catatan:</b> saat menggunakan lisensi percobaan, Anda harus menentukan parameter <i>--disableLicenseExpirationCheck</i> . <br><br><pre> <code class="cpp hljs"> - pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic -o PVS-Studio-${CC}.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> –-disableLicenseExpirationCheck</code> </pre> <br>  Dengan perintah terakhir, file hasil analisis dikonversi ke laporan html. <br><br><pre> <code class="cpp hljs">- plog-converter -t html PVS-Studio-${CC}.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> -o PVS-Studio-${CC}.html</code> </pre> <br>  Karena TravisCI tidak mengizinkan mengubah format pemberitahuan email, kami akan menggunakan paket sendemail untuk mengirim laporan pada langkah terakhir: <br><br><pre> <code class="cpp hljs">- sendemail -t mail@domain.com -u <span class="hljs-string"><span class="hljs-string">"PVS-Studio $CC report, commit:$TRAVIS_COMMIT"</span></span> -m <span class="hljs-string"><span class="hljs-string">"PVS-Studio $CC report, commit:$TRAVIS_COMMIT"</span></span> -s smtp.gmail.com:<span class="hljs-number"><span class="hljs-number">587</span></span> -xu $MAIL_USER -xp $MAIL_PASSWORD -o tls=yes -f $MAIL_USER -a PVS-Studio-${CC}.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> PVS-Studio-${CC}.html</code> </pre> <br>  Teks lengkap file konfigurasi untuk menjalankan alat analisa dalam mesin virtual: <br><br><pre> <code class="cpp hljs">language: c compiler: - gcc - clang before_install: - sudo add-apt-repository ppa:ubuntu-lxc/daily -y - wget -q -O - https:<span class="hljs-comment"><span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | sudo apt-key add - - sudo wget -O /etc/apt/sources.list.d/viva64.list https://files.viva64.com/etc/viva64.list - sudo apt-get update -qq - sudo apt-get install -qq coccinelle parallel libapparmor-dev libcap-dev libseccomp-dev python3-dev python3-setuptools docbook2x libgnutls-dev libselinux1-dev linux-libc-dev pvs-studio libio-socket-ssl-perl libnet-ssleay-perl sendemail ca-certificates script: - ./coccinelle/run-coccinelle.sh -i - git diff --exit-code - export CFLAGS="-Wall -Werror" - export LDFLAGS="-pthread -lpthread" - ./autogen.sh - rm -Rf build - mkdir build - cd build - ../configure --enable-tests --with-distro=unknown - pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic - pvs-studio-analyzer trace -- make -j4 - pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic -o PVS-Studio-${CC}.log --disableLicenseExpirationCheck - plog-converter -t html PVS-Studio-${CC}.log -o PVS-Studio-${CC}.html - sendemail -t mail@domain.com -u "PVS-Studio $CC report, commit:$TRAVIS_COMMIT" -m "PVS-Studio $CC report, commit:$TRAVIS_COMMIT" -s smtp.gmail.com:587 -xu $MAIL_USER -xp $MAIL_PASSWORD -o tls=yes -f $MAIL_USER -a PVS-Studio-${CC}.log PVS-Studio-${CC}.html</span></span></code> </pre> <br>  Untuk menjalankan analisis statis dalam sebuah wadah, pertama-tama buatlah menggunakan Dockerfile berikut: <br><br><pre> <code class="cpp hljs">FROM docker.io/ubuntu:trusty ENV CFLAGS=<span class="hljs-string"><span class="hljs-string">"-Wall -Werror"</span></span> ENV LDFLAGS=<span class="hljs-string"><span class="hljs-string">"-pthread -lpthread"</span></span> RUN apt-get update &amp;&amp; apt-get install -y software-properties-common wget \ &amp;&amp; wget -q -O - https:<span class="hljs-comment"><span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | sudo apt-key add - \ &amp;&amp; wget -O /etc/apt/sources.list.d/viva64.list https://files.viva64.com/etc/viva64.list \ &amp;&amp; apt-get update \ &amp;&amp; apt-get install -yqq coccinelle parallel libapparmor-dev libcap-dev libseccomp-dev python3-dev python3-setuptools docbook2x libgnutls-dev libselinux1-dev linux-libc-dev pvs-studio git libtool autotools-dev automake pkg-config clang make libio-socket-ssl-perl libnet-ssleay-perl sendemail ca-certificates \ &amp;&amp; rm -rf /var/lib/apt/lists/*</span></span></code> </pre> <br>  Dalam hal ini, file konfigurasi mungkin terlihat seperti ini: <br><br><pre> <code class="cpp hljs">before_install: - docker pull docker.io/oandreev/lxc env: - CC=gcc - CC=clang script: - docker run --rm --cap-add SYS_PTRACE -v $(pwd):/pvs -w /pvs docker.io/oandreev/lxc /bin/bash -c <span class="hljs-string"><span class="hljs-string">" ./coccinelle/run-coccinelle.sh -i &amp;&amp; git diff --exit-code &amp;&amp; ./autogen.sh &amp;&amp; mkdir build &amp;&amp; cd build &amp;&amp; ../configure CC=$CC &amp;&amp; pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic &amp;&amp; pvs-studio-analyzer trace -- make -j4 &amp;&amp; pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic -o PVS-Studio-$CC.log --disableLicenseExpirationCheck &amp;&amp; plog-converter -t html -o PVS-Studio-$CC.html PVS-Studio-$CC.log &amp;&amp; sendemail -t mail@domain.com -u 'PVS-Studio $CC report, commit:$TRAVIS_COMMIT' -m 'PVS-Studio $CC report, commit:$TRAVIS_COMMIT' -s smtp.gmail.com:587 -xu $MAIL_USER -xp $MAIL_PASSWORD -o tls=yes -f $MAIL_USER -a PVS-Studio-${CC}.log PVS-Studio-${CC}.html"</span></span></code> </pre> <br>  Seperti yang Anda lihat, dalam hal ini kami tidak melakukan apa pun di dalam mesin virtual, dan tentu saja semua tindakan untuk merakit dan menguji proyek berlangsung di dalam wadah. <br><br>  <b>Catatan</b> : saat memulai wadah, Anda harus menentukan <i>--cap-add SYS_PTRACE</i> atau <i>--security-opt seccomp: parameter tidak dikonfigurasikan</i> , karena panggilan sistem ptrace digunakan untuk mengkompilasi jejak. <br><br>  Kami memuat file konfigurasi ke dalam root repositori dan melihat bahwa Travis CI menerima pemberitahuan tentang kehadiran perubahan dalam proyek dan secara otomatis memulai perakitan. <br><br>  Informasi terperinci tentang kemajuan perakitan dan verifikasi penganalisa dapat dilihat di konsol. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/00a/846/95d/00a84695de9e00013c89760219f5292e.png" alt="Gambar 2"></div><br>  Setelah tes selesai, kami akan menerima 2 surat dalam surat: satu dengan hasil analisis statis untuk membangun proyek menggunakan gcc, dan yang kedua dengan dentang, masing-masing. <br><br><h2>  Secara singkat tentang hasil tes </h2><br>  Secara umum, proyek ini cukup bersih, analis hanya mengeluarkan 24 peringatan kritis dan 46 rata-rata.  Untuk mendemonstrasikan pekerjaan, pertimbangkan beberapa pemberitahuan menarik: <br><br><h3>  Kondisi redundan di if </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V590</a> Pertimbangkan untuk memeriksa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ekspresi</a> 'ret! = (- 1) &amp;&amp; ret == 1'.  Ekspresi berlebihan atau mengandung kesalahan cetak.  lampirkan.c 107 <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> EOF -1 static struct lxc_proc_context_info *lxc_proc_get_context_info(pid_t pid) { .... while (getline(&amp;</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">line</span></span></span><span class="hljs-meta">, &amp;line_bufsz, proc_file) != -1) { ret = sscanf(</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">line</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"CapBnd: %llx"</span></span></span><span class="hljs-meta">, &amp;info-&gt;capability_mask); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (ret != EOF &amp;&amp; ret == 1) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// &lt;= { found = true; break; } } .... }</span></span></span></span></code> </pre> <br>  Jika <i>ret == 1</i> , maka jelas tidak sama dengan -1 (EOF).  Validasi berlebihan, <i>ret! = EOF</i> dapat dihapus. <br><br>  Dua peringatan lagi dikeluarkan: <br><br><ul><li>  V590 Pertimbangkan untuk memeriksa ekspresi 'ret! = (- 1) &amp;&amp; ret == 1'.  Ekspresi berlebihan atau mengandung kesalahan cetak.  attach.c 579 </li><li>  V590 Pertimbangkan untuk memeriksa ekspresi 'ret! = (- 1) &amp;&amp; ret == 1'.  Ekspresi berlebihan atau mengandung kesalahan cetak.  attach.c 583 </li></ul><br><h3>  Hilangnya bit tinggi </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V784</a> Ukuran bit mask kurang dari ukuran operan pertama.  Ini akan menyebabkan hilangnya bit yang lebih tinggi.  conf.c 1879 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mount_opt</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *name; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> clear; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> flag; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_mntopt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *opt, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *flags, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mount_opt</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mo</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">/* If opt is found in mount_opt, set or clear flags. * Otherwise append it to data. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (mo = &amp;mount_opt[<span class="hljs-number"><span class="hljs-number">0</span></span>]; mo-&gt;name != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; mo++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(opt, mo-&gt;name, <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(mo-&gt;name)) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mo-&gt;clear) { *flags &amp;= ~mo-&gt;flag; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } else { *flags |= mo-&gt;flag; } return; } } .... }</span></span></code> </pre> <br>  Di Linux, <i>long</i> adalah variabel integer 64-bit, <i>flag-&gt;</i> adalah variabel integer 32-bit.  Menggunakan <i>flag mo-&gt;</i> sebagai bitmask akan menghasilkan hilangnya 32 bit paling signifikan.  Casting implisit bitmask ke variabel integer 64-bit setelah inversi bitwise dilakukan.  Bit tinggi topeng ini akan menjadi nol. <br><br>  Tunjukkan dengan contoh: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> y; .... x &amp;= ~y;</code> </pre> <br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1a3/59f/a71/1a359fa7163d8a99c8632ffc17cf7eb0.png" alt="Gambar 3"></div><br><br>  Kode yang benar adalah: <br><br><pre> <code class="cpp hljs">*flags &amp;= ~(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)(mo-&gt;flag);</code> </pre> <br>  Penganalisa mengeluarkan peringatan serupa lainnya: <br><br><ul><li>  V784 Ukuran bit mask kurang dari ukuran operan pertama.  Ini akan menyebabkan hilangnya bit yang lebih tinggi.  conf.c 1933 </li></ul><br><h3>  Siklus yang mencurigakan </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V612</a> Suatu 'pengembalian' tanpa syarat dalam satu lingkaran.  conf.c 3477 <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> lxc_list_for_each(__iterator, __list) \ for (__iterator = (__list)-&gt;next; __iterator != __list; \ __iterator = __iterator-&gt;next) static bool verify_start_hooks(struct lxc_conf *conf) { char path[PATH_MAX]; struct lxc_list *it; lxc_list_for_each (it, &amp;conf-&gt;hooks[LXCHOOK_START]) { int ret; char *hookname = it-&gt;elem; ret = snprintf(path, PATH_MAX, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%s%s"</span></span></span><span class="hljs-meta">, conf-&gt;rootfs.path ? conf-&gt;rootfs.mount : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta">, hookname); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (ret </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt; 0 || ret &gt;= PATH_MAX) return false; ret = access(path, X_OK); if (ret &lt; 0) { SYSERROR("Start hook \"%s\" not found in container", hookname); return false; } return true; // &lt;= } return true; }</span></span></span></span></code> </pre> <br>  Siklus dimulai dan pada iterasi pertama ia terputus.  Mungkin ini memang dimaksudkan, tapi kemudian siklusnya bisa dihilangkan. <br><br><h3>  Di luar batas </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V557</a> Array underrun dimungkinkan.  Nilai indeks 'bytes - 1' dapat mencapai -1.  network.c 2570 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lxc_create_network_unpriv_exec</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *lxcpath, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *lxcname, struct lxc_netdev *netdev, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">pid_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pid, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hooks_version)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bytes; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buffer[PATH_MAX] = {<span class="hljs-number"><span class="hljs-number">0</span></span>}; .... bytes = lxc_read_nointr(pipefd[<span class="hljs-number"><span class="hljs-number">0</span></span>], &amp;buffer, PATH_MAX); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bytes &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { SYSERROR(<span class="hljs-string"><span class="hljs-string">"Failed to read from pipe file descriptor"</span></span>); close(pipefd[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { buffer[bytes - <span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; } .... }</code> </pre> <br>  Bytes dibaca dari pipa ke buffer.  Jika terjadi kesalahan, fungsi <i>lxc_read_nointr</i> akan mengembalikan nilai negatif.  Jika semuanya berjalan dengan baik, maka terminal nol ditulis sebagai elemen terakhir.  Namun, jika 0 byte dibaca, maka buffer akan keluar dari batas, yang mengarah pada perilaku yang tidak ditentukan. <br><br>  Penganalisa mengeluarkan peringatan serupa lainnya: <br><br><ul><li>  V557 Array underrun dimungkinkan.  Nilai indeks 'bytes - 1' dapat mencapai -1.  network.c 2725 </li></ul><br><h3>  Buffer overflow </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V576</a> Format salah.  Pertimbangkan untuk memeriksa argumen aktual ketiga dari fungsi 'sscanf'.  Berbahaya menggunakan penspesifikasi string tanpa spesifikasi lebar.  Buffer overflow dimungkinkan.  lxc_unshare.c 205 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lookup_user</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *oparg, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uid_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *uid)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> name[PATH_MAX]; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">sscanf</span></span>(oparg, <span class="hljs-string"><span class="hljs-string">"%u"</span></span>, uid) &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/* not a uid -- perhaps a username */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">sscanf</span></span>(oparg, <span class="hljs-string"><span class="hljs-string">"%s"</span></span>, name) &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">// &lt;= { free(buf); return false; } .... } .... }</span></span></code> </pre> <br>  Menggunakan <i>sscanf</i> dalam hal ini bisa berbahaya, karena jika panjang buffer <i>oparq</i> lebih besar dari panjang buffer <i>nama</i> , maka ia akan pergi ke luar negeri ketika buffer <i>nama</i> terbentuk. <br><br><h2>  Kesimpulan </h2><br>  Seperti yang kita lihat, pengaturan pemeriksaan kode statis dari proyek kami di cloud adalah tugas yang cukup sederhana.  Untuk melakukan ini, Anda hanya perlu menambahkan satu file ke repositori dan menghabiskan waktu minimum menyiapkan sistem CI.  Sebagai hasilnya, kami mendapatkan alat yang memungkinkan Anda mengidentifikasi kode bermasalah pada tahap penulisan, dan tidak memungkinkan kesalahan untuk sampai ke tahap pengujian berikutnya, di mana koreksi mereka akan membutuhkan lebih banyak waktu dan sumber daya. <br><br>  Tentu saja, menggunakan PVS-Studio dalam hubungannya dengan platform cloud tidak terbatas pada Travis CI.  Dengan analogi dengan metode yang dijelaskan dalam artikel, dengan perbedaan minimal, analisis PVS-Studio dapat diintegrasikan dengan solusi CI berbasis cloud populer lainnya, seperti CircleCI, GitLab, dll. <br><br><h2>  Tautan yang bermanfaat </h2><br><ul><li>  Informasi tambahan tentang peluncuran PVS-Studio di Linux dan MacOS dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . </li><li>  Anda dapat membaca tentang membuat, mengonfigurasi, dan menggunakan wadah dengan penganalisis statis PVS-Studio yang diinstal di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dokumentasi TravisCI</a> . </li></ul><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/898/3b6/5a7/8983b65a74adb29a2113eba12fbec3f1.png" align="left"></a> </p><br><br>  Jika Anda ingin berbagi artikel ini dengan audiens yang berbahasa Inggris, silakan gunakan tautan ke terjemahan: Oleg Andreev.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PVS-Studio di Awan -Lari Analisis Travis CI</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id458072/">https://habr.com/ru/post/id458072/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id458060/index.html">Membuat shader rumput di mesin Unity</a></li>
<li><a href="../id458062/index.html">Gambaran Umum Platform UserGate</a></li>
<li><a href="../id458064/index.html">PVS-Studio di Awan - Menjalankan Analisis pada Travis CI</a></li>
<li><a href="../id458068/index.html">PVS-Studio untuk Visual Studio</a></li>
<li><a href="../id458070/index.html">PVS-Studio untuk Visual Studio</a></li>
<li><a href="../id458074/index.html">Go bahasa: pemilihan ORM</a></li>
<li><a href="../id458076/index.html">Pemasaran dengan pengambilan keputusan ML</a></li>
<li><a href="../id458080/index.html">25 Juli, Moskow - QIWI iOS Meetup</a></li>
<li><a href="../id458084/index.html">50 materi yang dipilih tentang penghasilan musisi, suara dalam game dan film, instrumen yang tidak biasa dan yang lama terlupakan</a></li>
<li><a href="../id458088/index.html">Distribusi Linux Terbaik untuk Komputer yang Lebih Lama</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>