<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçü üí© üßëüèª Introducci√≥n a la programaci√≥n reactiva. üõ∂ ‚ÜòÔ∏è üóø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola En este art√≠culo, galopar√© por Europa, es decir, te dir√© lo que quieren decir con programaci√≥n reactiva, te presentar√© a actores, flujos reactivo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Introducci√≥n a la programaci√≥n reactiva.</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/arcadia/blog/432004/">  Hola  En este art√≠culo, galopar√© por Europa, es decir, te dir√© lo que quieren decir con programaci√≥n reactiva, te presentar√© a actores, flujos reactivos y, finalmente, utilizando flujos reactivos, reconoceremos los gestos del mouse, como en la antigua Opera y su sucesor espiritual: Vivaldi . <br><br>  El objetivo es presentar los conceptos b√°sicos de la programaci√≥n reactiva y mostrar que no todo es tan complicado y aterrador como podr√≠a parecer a primera vista. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0c6/858/157/0c68581574002383d90367c3e6b996c9.jpg" alt="imagen"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fuente</a></i> <br><a name="habracut"></a><br><h2>  ¬øQu√© es la programaci√≥n reactiva? </h2><br>  Para responder a esta pregunta, nos dirigimos al <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sitio</a> .  Tiene una hermosa imagen que muestra 4 criterios principales que deben cumplir las aplicaciones reactivas. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6e5/092/390/6e5092390fa27e7843b59d57da94b8b3.svg" alt="imagen"><br><br>  La aplicaci√≥n debe ser r√°pida, tolerante a fallas y escalar bien. <br>  Parece que "somos para todos los buenos contra todos los malos", ¬øverdad? <br><br>  Qu√© se entiende por estas palabras: <br><br><ol><li> <b>Capacidad de respuesta</b> <br><br>  La aplicaci√≥n debe dar al usuario el resultado en medio segundo.  Esto tambi√©n incluye el principio de falla r√°pida: es decir, cuando algo sale mal, es mejor devolver un mensaje de error como ‚ÄúLo siento, hubo un problema.  Intente nuevamente m√°s tarde que hacer que el clima espere junto al mar.  Si la operaci√≥n es larga, le mostramos al usuario una barra de progreso.  Si es muy largo: ‚Äúsu solicitud se cumplir√° tentativamente el 18 de marzo de 2042.  Le enviaremos una notificaci√≥n por correo ". </li><li>  <b>La escalabilidad</b> es una forma de proporcionar capacidad de respuesta bajo carga.  Imagine el ciclo de vida de un servicio relativamente exitoso: <br><ol><li>  Lanzamiento: el flujo de solicitud es peque√±o, el servicio se ejecuta en una m√°quina virtual con un n√∫cleo. </li><li>  El flujo de solicitudes aumenta: los n√∫cleos se agregan a la m√°quina virtual y las solicitudes se procesan en varios subprocesos. </li><li>  A√∫n m√°s carga, conectamos por lotes, las solicitudes a la base de datos y al disco duro se agrupan. </li><li>  A√∫n m√°s carga: debe generar m√°s servidores y proporcionar trabajo en el cl√∫ster. <br>  Idealmente, el sistema en s√≠ deber√≠a aumentar o disminuir seg√∫n la carga. </li></ol></li><li>  <b>Tolerancia a fallos</b> <br><br>  Aceptamos que vivimos en un mundo imperfecto y que todo sucede.  En caso de que algo salga mal en nuestro sistema, debemos proporcionar m√©todos de manejo y recuperaci√≥n de errores </li><li>  Y finalmente, estamos invitados a lograr todo esto usando un sistema cuya arquitectura se base en <b>mensajes</b> basados ‚Äã‚Äãen mensajes </li></ol><br>  Antes de continuar, quiero detenerme en c√≥mo los sistemas basados ‚Äã‚Äãen eventos difieren de los sistemas basados ‚Äã‚Äãen mensajes. <br><br>  <b>Impulsado por eventos:</b> <br><br><ul><li>  Evento: el sistema informa que ha alcanzado un cierto estado. </li><li>  Puede haber muchos suscriptores al evento. </li><li>  La cadena de eventos suele ser corta y los controladores de eventos est√°n cerca (tanto f√≠sicamente como en c√≥digo) de la fuente. </li><li>  El origen del evento y sus controladores generalmente tienen un estado com√∫n (f√≠sicamente, usan la misma porci√≥n de RAM para el intercambio de informaci√≥n). </li></ul><br>  <b>A diferencia de los eventos, en un sistema de mensajes:</b> <br><br><ul><li>  Cada mensaje tiene un solo destinatario. </li><li>  Los mensajes son inmutables: no puede cambiar nada en el mensaje recibido para que el remitente lo sepa y pueda leer la informaci√≥n. </li><li>  Los elementos del sistema responden (o no responden) a la recepci√≥n de mensajes y pueden enviar mensajes a otros elementos del sistema. </li></ul><br>  Todo esto nos ofrece <br><br><h1>  Modelo de actor </h1><br>  Hitos del desarrollo: <br><br><ul><li>  La primera menci√≥n de actores est√° en un art√≠culo cient√≠fico de 1973: Carl Hewitt, Peter Bishop y Richard Steiger, "Un formalismo ACTOR modular universal para la inteligencia artificial". </li><li>  1986 - Aparece Erlang.  Ericson necesitaba un lenguaje para equipos de telecomunicaciones que proporcionara tolerancia a fallas y propagaci√≥n sin errores.  En el contexto de este art√≠culo, sus caracter√≠sticas principales son: <br><br><ul><li>  Todo es un proceso </li><li>  Los mensajes son la √∫nica forma de comunicaci√≥n (Erlang es un lenguaje funcional, y los mensajes en √©l no se pueden cambiar). </li></ul></li><li>  .. </li><li>  2004 - la primera versi√≥n del lenguaje Scala.  Sus caracter√≠sticas: <ul><li>  Desarrollado por JVM, </li><li>  Funcional </li><li>  Para subprocesos m√∫ltiples, se ha seleccionado un modelo de actor. </li></ul><br></li><li>  2009 - la implementaci√≥n de los actores fue asignada en una biblioteca separada - Akka </li><li>  2014 - Akka.net - fue portado a .Net. </li></ul><br><h1>  ¬øQu√© pueden hacer los actores? </h1><br>  Los actores son los mismos objetos, pero: <br><br><ul><li>  A diferencia de los objetos ordinarios, los actores no pueden llamar los m√©todos de los dem√°s. </li><li>  Los actores pueden transmitir informaci√≥n <b>solo a trav√©s de mensajes inmutables</b> . </li><li>  Al recibir el mensaje, el actor puede <br><ul><li>  Crear nuevos actores (ser√°n m√°s bajos en la jerarqu√≠a), </li><li>  Enviar mensajes a otros actores, </li><li>  Det√©n a los actores de abajo en la jerarqu√≠a y a ti mismo. </li></ul></li></ul><br>  Veamos un ejemplo. <br><br><img src="https://habrastorage.org/webt/ql/wj/cj/qlwjcjyygaw5s7iub_mshc1rbry.jpeg" alt="imagen"><br><br>  El actor A quiere enviar un mensaje al actor B. Todo lo que tiene es ActorRef (alguna direcci√≥n).  El actor B puede estar en cualquier lugar. <br>  El actor A env√≠a una letra B a trav√©s del sistema (ActorSystem).  El sistema coloca la carta en el buz√≥n del actor B y "despierta" al actor B. El actor B toma la carta del buz√≥n y hace algo. <br><br>  En comparaci√≥n con los m√©todos de llamada en otro objeto, parece innecesariamente complicado, pero el modelo de actores se adapta perfectamente al mundo real, si imagina que los actores son personas que est√°n capacitadas para hacer algo en respuesta a ciertos est√≠mulos. <br><br>  Imagina un padre y un hijo: <br><br><img src="https://habrastorage.org/webt/gk/o9/s5/gko9s5syabkkpdkg0_v_aimwwis.jpeg"><br><br>  El padre env√≠a a su hijo SMSku "Limpio en la habitaci√≥n" y contin√∫a haciendo lo suyo.  El hijo lee SMSku y comienza a limpiar.  Padre, mientras tanto, est√° jugando al p√≥ker.  El hijo termina de limpiar y env√≠a un mensaje de texto "Finalizar".  Se ve simple, ¬øverdad? <br><br>  Ahora imagine que padre e hijo no son actores, sino objetos ordinarios que pueden extraer los m√©todos del otro.  El padre tira de su hijo para el m√©todo de "limpiar la habitaci√≥n" y lo sigue, esperando hasta que el hijo termine de limpiar y transfiera el control a su padre.  Padre no puede jugar p√≥ker en este momento.  En este contexto, el modelo de actor se est√° volviendo m√°s atractivo. <br><br>  Ahora pasemos a <br><br><h1>  Akka.NET </h1><br>  Todo lo que est√° escrito a continuaci√≥n es cierto para el Akka original para la JVM, pero para m√≠, C # est√° m√°s cerca que Java, por lo que utilizar√© Akka.NET como ejemplo. <br><br><h3>  ¬øCu√°les son los beneficios de Akka? </h3><br><ul><li>  Multithreading a trav√©s de mensajes.  Ya no tiene que sufrir con todo tipo de bloqueos, sem√°foros, mutexes y otros encantos caracter√≠sticos de los subprocesos m√∫ltiples cl√°sicos con memoria compartida. </li><li>  Comunicaci√≥n transparente entre el sistema y sus componentes.  No necesita preocuparse por el c√≥digo de red complejo: el sistema mismo encontrar√° el destino del mensaje y garantizar√° la entrega del mensaje (aqu√≠ puede insertar un chiste sobre UDP vs TCP). </li><li>  Arquitectura flexible que puede escalar autom√°ticamente hacia arriba o hacia abajo.  Por ejemplo, bajo carga, el sistema puede generar nodos de cl√∫ster adicionales y distribuir la carga de manera uniforme. </li></ul><br>  Pero el tema del escalado es muy extenso y merece una publicaci√≥n separada.  Por lo tanto, contar√© con m√°s detalle solo sobre la funci√≥n, que ser√° √∫til en todos los proyectos: <br><br><h2>  Manejo de errores </h2><br>  Los actores tienen una jerarqu√≠a: se puede representar como un √°rbol.  Cada actor tiene un padre y puede tener "hijos". <br><br><img src="https://habrastorage.org/getpro/habr/post_images/99e/57e/919/99e57e919cbea8e6761b75537c3f507a.png" alt="imagen"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Documentaci√≥n de Akka.NET</a> Copyright 2013-2018 Proyecto Akka.NET</i> <br><br>  Para cada actor, puede establecer una estrategia de supervisi√≥n: qu√© hacer si algo sale mal para los "ni√±os".  Por ejemplo, "vencer" a un actor que tiene problemas, y luego crear un nuevo actor del mismo tipo y confiarle el mismo trabajo. <br><br>  Por ejemplo, hice una aplicaci√≥n en Akka.net CRUD, en la que la capa de "l√≥gica de negocios" se implementa en los actores.  El objetivo de este proyecto era descubrir si los actores deber√≠an usarse en sistemas no escalables: ¬ømejorar√°n la vida o a√±adir√°n m√°s dolor? <br><br>  C√≥mo puede ayudar el manejo de errores incorporado de Akka: <br><br><div class="spoiler">  <b class="spoiler_title">GIF</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/1f/oz/ou/1fozoulh0ufwzuyufofz4n8pvbi.gif"><br></div></div><br><ol><li>  todo est√° bien, la aplicaci√≥n funciona, </li><li>  Algo le sucedi√≥ al repositorio, y ahora da el resultado solo 1 de cada 5 veces, </li><li>  Establec√≠ la estrategia de supervisi√≥n para "probar 10 veces por segundo", </li><li>  la aplicaci√≥n vuelve a funcionar (aunque es m√°s lenta) y tengo tiempo para averiguar qu√© sucede. </li></ol><br>  Existe la tentaci√≥n de decir: "Vamos, escribir√© ese error manejando yo mismo, ¬øpor qu√© algunos actores tienen que cometer un error?"  Comentario justo, pero solo si los puntos de falla son pocos. <br><br>  Y algo de c√≥digo.  As√≠ es como se ve la inicializaci√≥n del sistema de actores en el contenedor IoC: <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Container</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { system = ActorSystem.Create(<span class="hljs-string"><span class="hljs-string">"MySystem"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> echo = system.ActorOf&lt;EchoActor&gt;(<span class="hljs-string"><span class="hljs-string">"Echo"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//stop initialization if something is wrong with actor system var alive = echo.Ask&lt;bool&gt;(true, TimeSpan.FromMilliseconds(100)).Result; container = new WindsorContainer(); //search for dependencies //register controllers //register ActorSystem propsResolver = new WindsorDependencyResolver(container, (ActorSystem)system); system.AddDependencyResolver(propsResolver); actorSystemWrapper = new ActorSystemWrapper(system, propsResolver); container.Register(Component.For&lt;IActorRefFactory&gt;().Instance(actorSystemWrapper)); container.Register(Component.For&lt;IDependencyResolver&gt;().Instance(propsResolver)); }</span></span></code> </pre> <br>  EchoActor es el actor m√°s simple que devuelve un valor al remitente: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EchoActor</span></span> : <span class="hljs-title"><span class="hljs-title">ReceiveActor</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EchoActor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Receive&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;(flag =&gt; { Sender.Tell(flag); }); } }</code> </pre><br>  Para conectar a los actores con el c√≥digo "regular", se utiliza el comando Preguntar: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;ActionResult&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ViewBag.Type = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Model); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> CrudActorRef.Ask&lt;IEnumerable&lt;Model&gt;&gt;(DataMessage.GetAll&lt;Model&gt;(), maxDelay); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(res); }</code> </pre> <br><h3>  Total </h3><br>  Ri√©ndome con los actores, puedo decir: <br><br><ul><li>  M√≠ralos si necesitas escalabilidad. </li><li>  Para una l√≥gica empresarial compleja, es mejor no usarlos debido a <ul><li>  Inyecci√≥n de dependencia extra√±a.  Para inicializar un actor con las dependencias necesarias, primero debe crear un objeto Props y luego entregarlo al ActorSystem para crear un actor del tipo deseado.  Para crear accesorios utilizando contenedores IoC (por ejemplo, Castle Windsor o Autofac) hay envoltorios listos para usar: DependencyResolvers.  Pero me enfrent√© al hecho de que el contenedor IoC estaba tratando de controlar la vida √∫til de la dependencia, y despu√©s de un tiempo el sistema se cay√≥ silenciosamente. <br><br>  * Quiz√°s, en lugar de inyectar una dependencia en un objeto, deber√≠a colocar esta dependencia como un actor secundario. </li><li>  Problemas de mecanograf√≠a.  ActorRef no sabe nada sobre el tipo de actor al que se refiere.  Es decir, en tiempo de compilaci√≥n no se sabe si un actor puede procesar un mensaje de este tipo o no. </li></ul></li></ul><br><h1>  Parte 2: corrientes en chorro </h1><br>  Ahora pasemos a un tema m√°s popular y √∫til: los flujos de chorro.  Si nunca puede reunirse con actores en el proceso de trabajo, entonces las transmisiones de Rx ser√°n √∫tiles tanto en la interfaz como en el backend.  Su implementaci√≥n est√° en casi todos los lenguajes de programaci√≥n modernos.  Dar√© ejemplos sobre RxJs, porque hoy en d√≠a incluso los programadores de backend a veces tienen que hacer algo en JavaScript. <br><br><img src="https://habrastorage.org/webt/ru/yn/g9/ruyng9clvfa1gh8bd5ai3lpnc5m.jpeg"><br>  <i>Las transmisiones Rx est√°n disponibles para todos los lenguajes de programaci√≥n populares.</i> <br><br>  <i>" <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Introducci√≥n a la programaci√≥n reactiva que te has estado perdiendo</a> " por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Andre Staltz</a> , licenciado bajo CC BY-NC 4.0</i> <br><br>  Para explicar qu√© es la corriente en chorro, comenzar√© con las colecciones pull y push. <br><table><tbody><tr><th></th><th>  Valor de retorno √∫nico </th><th>  M√∫ltiples valores de retorno </th></tr><tr><td>  Tirar <br>  S√≠ncrono <br>  Interactivo </td><td>  T </td><td>  IEnumerable &lt;T&gt; </td></tr><tr><td>  Empujar <br>  Asincr√≥nico <br>  Reactivo </td><td>  Tarea &lt;T&gt; </td><td>  IObservable &lt;T&gt; </td></tr></tbody></table><br>  Las colecciones pull son a lo que todos estamos acostumbrados en la programaci√≥n.  El ejemplo m√°s llamativo es una matriz. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> arr = [<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>];</code> </pre> <br>  Ya tiene datos, √©l mismo no cambiar√° estos datos, pero puede proporcionarlos a pedido. <br><br><pre> <code class="javascript hljs">arr.forEach(<span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log);</code> </pre> <br>  Adem√°s, antes de hacer algo con los datos, puede procesarlos de alguna manera. <br><br><pre> <code class="javascript hljs">arr.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i</span></span></span><span class="hljs-function"> =&gt;</span></span> i+<span class="hljs-number"><span class="hljs-number">1</span></span>).map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">I</span></span></span><span class="hljs-function"> =&gt;</span></span> ‚Äúmy number is ‚Äù+i).forEach(<span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log);</code> </pre> <br>  Ahora imaginemos que inicialmente no hay datos en la colecci√≥n, pero definitivamente le informar√° que han aparecido (Push).  Y al mismo tiempo, a√∫n podemos aplicar las transformaciones necesarias a esta colecci√≥n. <br><br>  Por ejemplo: <br><br><pre> <code class="javascript hljs">source.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i</span></span></span><span class="hljs-function"> =&gt;</span></span> i+<span class="hljs-number"><span class="hljs-number">1</span></span>).map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">I</span></span></span><span class="hljs-function"> =&gt;</span></span> ‚Äúmy number is ‚Äù+i).forEach(<span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log);</code> </pre> <br>  Cuando aparece un valor como 1 en la fuente, console.log generar√° "mi n√∫mero es 1". <br><br>  C√≥mo funciona <br><br>  Aparece una nueva entidad: Asunto (u Observable): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> observable = Rx.Observable.create(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">observer</span></span></span><span class="hljs-function">) </span></span>{ observer.next(<span class="hljs-number"><span class="hljs-number">1</span></span>); observer.next(<span class="hljs-number"><span class="hljs-number">2</span></span>); observer.next(<span class="hljs-number"><span class="hljs-number">3</span></span>); setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { observer.next(<span class="hljs-number"><span class="hljs-number">4</span></span>); observer.complete(); }, <span class="hljs-number"><span class="hljs-number">1000</span></span>); });</code> </pre> <br>  Esta es una colecci√≥n push que enviar√° notificaciones sobre cambios en su estado. <br><br>  En este caso, los n√∫meros 1, 2 y 3 aparecer√°n inmediatamente en √©l, en un segundo 4, y luego la colecci√≥n "terminar√°".  Este es un tipo de evento tan especial. <br><br>  La segunda entidad es Observador.  Puede suscribirse a los eventos del Asunto y hacer algo con los datos recibidos.  Por ejemplo: <br><br><pre> <code class="javascript hljs">observable.subscribe(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(x)); observable.subscribe({ <span class="hljs-attr"><span class="hljs-attr">next</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'got value '</span></span> + x), <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(<span class="hljs-string"><span class="hljs-string">'something wrong occurred: '</span></span> + err), <span class="hljs-attr"><span class="hljs-attr">complete</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'done'</span></span>), }); observable .map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">'This is '</span></span> + x) .subscribe(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(x));</code> </pre> <br>  Se puede ver que un sujeto puede tener muchos suscriptores. <br><br>  Parece f√°cil, pero a√∫n no est√° claro por qu√© es necesario.  Le dar√© 2 definiciones m√°s que necesita saber cuando trabaje con flujos reactivos, y luego le mostrar√© en la pr√°ctica c√≥mo funcionan y en qu√© situaciones se revela todo su potencial. <br><br><h4>  Observables en fr√≠o </h4><br><ul><li>  Notificar sobre eventos cuando alguien se suscribe a ellos. </li><li>  El flujo de datos completo se env√≠a nuevamente a cada suscriptor, independientemente del momento de la suscripci√≥n. </li><li>  Los datos se copian para cada suscriptor. </li></ul><br>  ¬øQu√© significa esto? Digamos que la empresa (Asunto) decidi√≥ organizar la distribuci√≥n de regalos.  Cada empleado (Observador) viene al trabajo y recibe su copia del regalo.  Nadie queda privado. <br><br><h4>  Observables calientes </h4><br><ul><li>  Intentan notificar el evento independientemente de la presencia de suscriptores.  Si en el momento del evento no hab√≠a suscriptores, los datos se pierden. </li></ul><br>  Ejemplo: en la ma√±ana, se traen pasteles calientes para los empleados a la empresa.  Cuando los traen, todas las alondras vuelan al olor y preparan los pasteles para el desayuno.  Pero los b√∫hos que vinieron despu√©s ya no reciben pasteles. <br><br><h4>  ¬øEn qu√© situaciones se utilizan las corrientes en chorro? </h4><br>  Cuando hay un flujo de datos distribuido en el tiempo.  Por ejemplo, entrada del usuario.  O registros de cualquier servicio.  En uno de los proyectos, vi un registrador hecho a s√≠ mismo que recopilaba eventos en N segundos y luego grababa simult√°neamente todo el paquete.  El c√≥digo de la bater√≠a ocupaba la p√°gina.  Si se usaran transmisiones Rx, entonces ser√≠a mucho m√°s simple: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b6e/b1a/396/b6eb1a3960bd8b422c01b6c0a5dd97f0.png" alt="imagen"><br>  <i>‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RxJs Reference / Observable</a> , documentaci√≥n bajo licencia CC BY 4.0</i> . <br>  <i>(hay muchos ejemplos e im√°genes que explican lo que hacen varias operaciones con flujos reactivos)</i> <br><br><pre> <code class="javascript hljs">source.bufferTime(<span class="hljs-number"><span class="hljs-number">2000</span></span>).subsribe(doThings);</code> </pre> <br>  Y finalmente, un ejemplo de uso. <br><br><h2>  Reconociendo gestos del mouse con transmisiones Rx </h2><br>  En la antigua Opera o su sucesor espiritual, Vivaldi, hab√≠a un control de navegador que usaba gestos del mouse. <br><br><div class="spoiler">  <b class="spoiler_title">Gif - gestos del mouse en Vivaldi</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/xs/ok/eq/xsokeqelkjbtvgrcurbv-wffmog.gif"><br></div></div><br>  Es decir, debe reconocer los movimientos del mouse hacia arriba / abajo, derecha / izquierda y sus combinaciones.  Se puede escribir sin secuencias Rx, pero el c√≥digo ser√° complejo y dif√≠cil de mantener. <br><br><h4>  Y as√≠ es como se ve con las transmisiones Rx: </h4><br>  Comenzar√© desde el final: establecer√© qu√© datos y en qu√© formato buscar√© en la secuencia original: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//gestures to look for const gestures = Rx.Observable.from([ { name: "Left", sequence: Rx.Observable.from([{ x: -1, y: 0 }]) }, { name: "Right", sequence: Rx.Observable.from([{ x: 1, y: 0 }]) }, { name: "Up", sequence: Rx.Observable.from([{ x: 0, y: -1 }]) }, { name: "Down", sequence: Rx.Observable.from([{ x: 0, y: 1 }]) }, { name: "Down+Up", sequence: Rx.Observable.from([{ x: 0, y: 1 }, { x: 0, y: -1 }]) }, { name: "Up+Right", sequence: Rx.Observable.from([{ x: 0, y: -1 }, { x: 1, y: 0 }]) } ]);</span></span></code> </pre> <br>  Estos son vectores unitarios y sus combinaciones. <br><br>  A continuaci√≥n, debe convertir los eventos del mouse en secuencias Rx.  Todas las bibliotecas Rx tienen herramientas integradas para convertir eventos est√°ndar en Observables. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mouseMoves = Rx.Observable.fromEvent(canvas, <span class="hljs-string"><span class="hljs-string">'mousemove'</span></span>), mouseDowns = Rx.Observable.fromEvent(canvas, <span class="hljs-string"><span class="hljs-string">'mousedown'</span></span>), mouseUps = Rx.Observable.fromEvent(canvas, <span class="hljs-string"><span class="hljs-string">'mouseup'</span></span>);</code> </pre> <br>  Luego, agrupo las coordenadas del mouse por 2 y encuentro su diferencia, obteniendo el desplazamiento del mouse. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mouseDiffs = mouseMoves .map(getOffset) .pairwise() .map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pair</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: pair[<span class="hljs-number"><span class="hljs-number">1</span></span>].x-pair[<span class="hljs-number"><span class="hljs-number">0</span></span>].x, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: pair[<span class="hljs-number"><span class="hljs-number">1</span></span>].y-pair[<span class="hljs-number"><span class="hljs-number">0</span></span>].y } });</code> </pre> <br>  Y agrupe estos movimientos usando los eventos 'mousedown' y 'mouseup'. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mouseGestures = mouseDiffs .bufferToggle(mouseDowns, x =&gt; mouseUps) .map(concat);</code> </pre> <br>  La funci√≥n concat corta los movimientos que son demasiado cortos y agrupa los movimientos que est√°n m√°s o menos alineados en direcci√≥n. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">concat</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">values</span></span></span><span class="hljs-function">) </span></span>{<span class="hljs-comment"><span class="hljs-comment">//summarize move in same direction return values.reduce((a, v) =&gt; { if (!a.length) { a.push(v); } else { const last = a[a.length - 1]; const lastAngle = Math.atan2(last.x, last.y); const angle = Math.atan2(vx, vy); const angleDiff = normalizeAngle(angle - lastAngle); const dist = Math.hypot(vx, vy); if (dist &lt; 1) return a;//move is too short ‚Äì ignore //moving in same direction =&gt; adding vectors if (Math.abs(angleDiff) &lt;= maxAngleDiff) { last.x += vx; last.y += vy; } else { a.push(v); } } return a; }, []); }</span></span></code> </pre> <br>  Si el movimiento en el eje X o Y es demasiado corto, se restablece a cero.  Y entonces solo queda el signo de las coordenadas de desplazamiento obtenidas.  Por lo tanto, se obtienen los vectores unitarios que est√°bamos buscando. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> normalizedMouseGestures = mouseGestures.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arr</span></span></span><span class="hljs-function"> =&gt;</span></span> arr.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dist = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.hypot(vx, vy);<span class="hljs-comment"><span class="hljs-comment">//length of vector vx = Math.abs(vx) &gt; minMove &amp;&amp; Math.abs(vx) * treshold &gt; dist ? vx : 0; vy = Math.abs(vy) &gt; minMove &amp;&amp; Math.abs(vy) * treshold &gt; dist ? vy : 0; return v; }) ).map(arr =&gt; arr .map(v =&gt; { return { x: Math.sign(vx), y: Math.sign(vy) }; }) .filter(v =&gt; Math.hypot(vx, vy) &gt; 0) );</span></span></code> </pre> <br>  Resultado: <br><br><pre> <code class="javascript hljs">gestures.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">gesture</span></span></span><span class="hljs-function"> =&gt;</span></span> normalizedMouseGestures.mergeMap( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">moves</span></span></span><span class="hljs-function"> =&gt;</span></span> Rx.Observable.from(moves) .sequenceEqual(gesture.sequence, comparer) ).filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x).mapTo(gesture.name) ).mergeAll().subscribe(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">gestureName</span></span></span><span class="hljs-function"> =&gt;</span></span> actions[gestureName]());</code> </pre> <br>  Usando secuenciaEqual, puede comparar los movimientos recibidos con los originales y, si hay una coincidencia, realizar una determinada acci√≥n. <br><br><div class="spoiler">  <b class="spoiler_title">GIF</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/lp/bx/fe/lpbxfeq_bq-mdfybskn0v7wwen8.gif"><br></div></div><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Puedes jugar con gestos aqu√≠</a> <br><br>  Tenga en cuenta que, adem√°s del reconocimiento de gestos, tambi√©n hay un dibujo de los movimientos del mouse inicial y normalizado en el lienzo HTML.  La legibilidad del c√≥digo no se ve afectada por esto. <br><br>  De lo que se desprende una ventaja m√°s: la funcionalidad escrita con la ayuda de las transmisiones Rx se puede complementar y ampliar f√°cilmente. <br><br><h2>  Resumen </h2><br><ul><li>  Las bibliotecas con transmisiones Rx est√°n disponibles para casi todos los lenguajes de programaci√≥n. </li><li>  Las transmisiones Rx deben usarse cuando hay una secuencia de eventos extendidos a lo largo del tiempo (por ejemplo, entrada del usuario). </li><li>  La funcionalidad escrita usando transmisiones Rx puede complementarse y expandirse f√°cilmente. </li><li>  No encontr√© ning√∫n defecto significativo. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Enlaces utiles</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.introtorx.com</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">getakka.net/articles/intro/what-is-akka.html</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">reactivex.io/rxjs/class/es6/Observable.js~Observable.html</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">reactivex.io/languages.html</a> </div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es432004/">https://habr.com/ru/post/es432004/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es431992/index.html">Biometr√≠a: c√≥mo est√°n las cosas con nosotros y con ellos</a></li>
<li><a href="../es431994/index.html">Discusi√≥n de la licencia gratuita de PVS-Studio para proyectos alojados en GitHub</a></li>
<li><a href="../es431996/index.html">Smart Engines Science Corporate (o c√≥mo nos dirigimos a ICMV 2018)</a></li>
<li><a href="../es431998/index.html">Conoce a Yandex.Phone - ahora oficialmente</a></li>
<li><a href="../es432002/index.html">Microsoft est√° desarrollando un navegador basado en Chromium, que se enviar√° de forma predeterminada en lugar de Edge</a></li>
<li><a href="../es432006/index.html">La historia de c√≥mo me met√≠ en el tema de la salud de la mujer.</a></li>
<li><a href="../es432008/index.html">Persiguiendo est√°ndares web</a></li>
<li><a href="../es432012/index.html">C√≥mo probar contratos inteligentes</a></li>
<li><a href="../es432014/index.html">Kali Linux para principiantes</a></li>
<li><a href="../es432016/index.html">C√≥mo la m√∫sica y el dibujo me ense√±aron a programar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>