<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõ§Ô∏è üèä üõï Tarjetas inteligentes. Parte 4. JavaCard üôèüèΩ üßöüèª üîà</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=", !
 
 JavaCard. JavaCard . , , JavaCard. , , JavaCard, .. . JavaCard.
 
 , - JavaCard ‚Äî , JavaCard Virtual Machine ( Java Virtual Machine, -) JavaCar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tarjetas inteligentes. Parte 4. JavaCard</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/380543/">, !<br>
<br>
      JavaCard.      JavaCard    .      ,        ,        JavaCard.  ,      ,       JavaCard, ..          .        JavaCard.<br>
<br>
, -   JavaCard ‚Äî  ,      JavaCard Virtual Machine (  Java Virtual Machine,   -)    JavaCard Runtime Environment (  Java Runtime Environment    ). <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En t√©rminos de terminolog√≠a, las aplicaciones se llaman Applets y est√°n contenidas en Paquetes. Los paquetes se distribuyen en archivos CAP (en lugar de archivos Jar). Los paquetes y las aplicaciones tienen su propio AID (Identificador de aplicaci√≥n). Esto es necesario para que puedan identificarse de forma exclusiva en comandos como: SELECCIONAR, INSTALAR, ELIMINAR, etc. (SELECT se describe en ISO7816-4, y JavaCard y otros comandos se describen en la Plataforma Global).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El ciclo de vida de los Applets es ligeramente diferente del ciclo de vida habitual de las aplicaciones inform√°ticas. </font><font style="vertical-align: inherit;">Un applet es cualquier clase que hereda de la clase base Applet. </font><font style="vertical-align: inherit;">Al instalar aplicaciones, se llama a su m√©todo de instalaci√≥n est√°tica. </font><font style="vertical-align: inherit;">Este m√©todo debe crear un objeto de la clase correspondiente y llamar al m√©todo de registro en √©l. </font><font style="vertical-align: inherit;">Posteriormente, el objeto se guardar√° en el sistema y recibir√° su propio AID, que se utilizar√° para una mayor comunicaci√≥n con la aplicaci√≥n. </font><font style="vertical-align: inherit;">El objeto y sus campos de datos se almacenan en NVM (memoria no vol√°til). </font><font style="vertical-align: inherit;">Cada objeto o conjunto creado por la aplicaci√≥n utilizando el "nuevo" operador tambi√©n estar√° en NVM. </font><font style="vertical-align: inherit;">Esto significa que, a diferencia de los programas de computadora tradicionales, el estado de las aplicaciones JavaCard es constante y no se pierde incluso cuando la tarjeta est√° apagada.</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comunicaci√≥n con la aplicaci√≥n.</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cualquier momento, cada canal l√≥gico abierto tiene una aplicaci√≥n activa. </font><font style="vertical-align: inherit;">Una aplicaci√≥n activa es aquella que recibe todas las APDU enviadas por el terminal. </font><font style="vertical-align: inherit;">Al recibir la APDU, la JavaCard llama al m√©todo de proceso de la aplicaci√≥n activa, que toma la APDU recibida como el √∫nico par√°metro. </font><font style="vertical-align: inherit;">Este m√©todo es el n√∫cleo del Applet, porque procesa las solicitudes del terminal. </font><font style="vertical-align: inherit;">La APDU resultante tambi√©n se usa para enviar respuestas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un applet se puede activar de dos maneras:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">al restablecer la tarjeta o al abrir un canal l√≥gico, el sistema generalmente activa la aplicaci√≥n que est√° marcada como Aplicaci√≥n predeterminada</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usando el comando SELECT con P1 = 0x04 y el AID (total o parcial) de la aplicaci√≥n en Datos</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando la aplicaci√≥n se activa utilizando el comando SELECCIONAR, inmediatamente despu√©s de la activaci√≥n se llamar√° al m√©todo de proceso con la APDU que contiene este comando. Por lo tanto, el Applet puede enviar informaci√≥n en respuesta a un comando SELECT cuando se activa. La clase Applet proporciona el m√©todo selectionApplet () para determinar si el comando recibido provoc√≥ la activaci√≥n de la aplicaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La aplicaci√≥n tambi√©n tiene la capacidad de reescribir los m√©todos select () y deselect () para inicializar respectivamente durante la activaci√≥n y des-inicializar durante la desactivaci√≥n. Se llamar√° a estos m√©todos independientemente de c√≥mo se activ√≥ la aplicaci√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los canales l√≥gicos se pueden abrir y cerrar con el comando MANAGE CHANNEL. </font><font style="vertical-align: inherit;">A trav√©s de canales l√≥gicos abiertos, puede enviar cualquier comando, incluido SELECT. </font><font style="vertical-align: inherit;">Los SELECT y MANAGE CHANNEL son los √∫nicos comandos procesados ‚Äã‚Äãdirectamente por el sistema y no por la aplicaci√≥n activa. </font><font style="vertical-align: inherit;">Aunque en el caso del comando SELECT, podemos decir que es procesado tanto por el sistema como por la aplicaci√≥n activa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las reglas completas para invocar la aplicaci√≥n y procesar el comando SELECT son bastante complejas, y existen pocas contradicciones entre JavaCard y Global Platform. </font><font style="vertical-align: inherit;">Sin embargo, tratar√© este tema en uno de mis pr√≥ximos art√≠culos. </font><font style="vertical-align: inherit;">Ahora vale la pena decir que las tarjetas a menudo siguen las reglas descritas en la Plataforma Global.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gesti√≥n de la memoria</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como dije anteriormente, los objetos y las matrices se almacenan por defecto en NVM. </font><font style="vertical-align: inherit;">Adem√°s de NVM, JavaCard tambi√©n hace posible crear matrices en RAM utilizando varios m√©todos de la clase JCSystem. </font><font style="vertical-align: inherit;">Hay 2 tipos de memoria temporal: Borrar al restablecer y Borrar al deseleccionar. </font><font style="vertical-align: inherit;">La primera se borra cuando la tarjeta se apaga o se reinicia. </font><font style="vertical-align: inherit;">El segundo se borra cuando el Applet deja de estar activo (es decir, cuando SELECCIONA otra aplicaci√≥n, apaga, reinicia, etc.). </font><font style="vertical-align: inherit;">Cabe se√±alar que, aunque los contenidos de la matriz se borran (es decir, todos los ceros o falsos se escriben all√≠), la matriz en s√≠ permanece y, por ejemplo, se puede almacenar en el campo de datos del objeto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo que se guarda en NVM:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todos los objetos y sus campos de datos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todos los arreglos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El contenido de las matrices creadas por el nuevo operador.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo que se almacena en la RAM (CLEAR_ON_RESET o CLEAR_ON_DESELECT):</font></font><br>
<ul>
<li> ,   JCSystem.makeTransient&lt;&gt;Array.  ,  ,   ,   JCSystem.makeTransientObjectArray(),      NVM.       RAM.</li>
<li>Global Arrays:  (APDU   Install Parameters ),   Global Arrays,    JCSystem.makeGlobalArray().</li>
<li>  .       .</li>
</ul><br>
<br>
,  ,          ,   .   ,  ,  :<br>
<br>
1)  ,     ,    ,  -       .<br>
2)   ‚Äî  (   ) .  ,       ,       .        .      ,     ,     (JCSystem.requestObjectDeletion()).<br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Posteriormente, el c√≥digo de la aplicaci√≥n rara vez se obtiene "limpio" en t√©rminos de programaci√≥n orientada a objetos. </font><font style="vertical-align: inherit;">Usar el byte com√∫n [] para muchas operaciones diferentes es una pr√°ctica muy com√∫n. </font><font style="vertical-align: inherit;">Las clases que consisten √∫nicamente en m√©todos est√°ticos y se ejecutan en byte [] tampoco son infrecuentes. </font><font style="vertical-align: inherit;">Adem√°s, la creaci√≥n de clases y objetos se minimiza. </font><font style="vertical-align: inherit;">Poca memoria y debe protegerse a toda costa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n vale la pena se√±alar el papel del objeto APDU. </font><font style="vertical-align: inherit;">Su b√∫fer ubicado en la RAM se borra antes de recibir cada comando. </font><font style="vertical-align: inherit;">Es habitual usarlo no solo para formar una respuesta, sino a menudo incluso como un b√∫fer temporal. </font><font style="vertical-align: inherit;">Su tama√±o es de al menos 256 bytes o mucho mayor si la tarjeta admite Longitud extendida.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cortafuegos Applet</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una caracter√≠stica importante de JavaCard que puede confundir a los programadores es la presencia del llamado Applet Firewall. </font><font style="vertical-align: inherit;">El objetivo de Firewall es evitar que cualquier Applet acceda a los datos de otro. </font><font style="vertical-align: inherit;">Debo decir de inmediato que JavaCard permite la comunicaci√≥n entre aplicaciones que usan interfaces compartibles, y tambi√©n que los paquetes son bibliotecas de clases y funciones que se pueden usar en diferentes aplicaciones. </font><font style="vertical-align: inherit;">Por eso es necesario un firewall. </font><font style="vertical-align: inherit;">Los principios b√°sicos del Applet Firewall son los siguientes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada aplicaci√≥n pertenece a un contexto. </font><font style="vertical-align: inherit;">Todas las aplicaciones del mismo paquete pertenecen al mismo contexto.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada objeto pertenece a una aplicaci√≥n o sistema.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un paquete sin aplicaciones (biblioteca) no tiene contexto. </font><font style="vertical-align: inherit;">Los objetos de sus clases pertenecen a la aplicaci√≥n que los cre√≥.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Siempre hay un contexto activo en el sistema.</font></font></li>
<li> (/         )    ,   .</li>
<li>     .</li>
<li>         .       .  ,     ,    firewall.</li>
<li>    CLEAR_ON_DESELECT   ,       .</li>
</ul><br>
  Shareable Interface             .      ,       ,   ,  Shareable Interface.  ,        ,   ,  ,  ,    byte[]     ,     .         .<br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La aplicaci√≥n tambi√©n tiene acceso a ciertos objetos que pertenecen al sistema. </font><font style="vertical-align: inherit;">Dichos objetos se denominan puntos de entrada. </font><font style="vertical-align: inherit;">Hay dos tipos de puntos de entrada: temporales y permanentes. </font><font style="vertical-align: inherit;">Los puntos de entrada permanentes son simples, se permite el acceso a ellos desde cualquier contexto. </font><font style="vertical-align: inherit;">Un ejemplo de esto son los objetos de la clase AID. </font><font style="vertical-align: inherit;">Los puntos de entrada temporales, por otro lado, tienen una restricci√≥n que impide que se almacenen en los campos de datos del objeto o en los campos est√°ticos de la clase. </font><font style="vertical-align: inherit;">Un ejemplo de un punto de entrada temporal es un objeto APDU. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A partir de JavaCard 3.0.4, tambi√©n es posible crear matrices globales utilizando el m√©todo JCSystem.makeGlobalArray (). </font><font style="vertical-align: inherit;">Su comportamiento es exactamente el mismo que el de los puntos de entrada temporales. </font><font style="vertical-align: inherit;">Se necesitan principalmente como par√°metro para los m√©todos llamados utilizando la t√©cnica de Interfaz compartible.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atomicidad y transacciones</font></font></h4><br>
JavaCard          .    ,    ( ,    NonAtomic  ).  , ,  , Util.arrayCopy     (  ),          .<br>
<br>
             ,  JavaCard    JCSystem.beginTransaction()     JCSystem.commitTransaction()   .  ,         JCSystem.beginTransaction()  JCSystem.commitTransaction(),     .    - ,      JCSystem.abortTransaction(),     .  ,        .    ,     TransactionException. <br>
<br>
<h4>RMI</h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JavaCard es compatible con la tecnolog√≠a RMI (Remote Metod Invocation). </font><font style="vertical-align: inherit;">En este art√≠culo no dedicar√© esta tecnolog√≠a. </font><font style="vertical-align: inherit;">Solo puedo decir que esta funcionalidad no es com√∫n y que muchas tarjetas no la admiten.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La mayor parte de la API JavaCard est√° dedicada a la criptograf√≠a. </font><font style="vertical-align: inherit;">Hay clases para encriptar, crear y verificar una firma digital, generar claves y n√∫meros aleatorios, calcular sumas de verificaci√≥n y hashes, y tambi√©n para implementar esquemas de intercambio de claves. </font><font style="vertical-align: inherit;">Adem√°s de la criptograf√≠a, JavaCard tambi√©n ofrece clases para almacenar y verificar PIN e incluso datos biom√©tricos. </font><font style="vertical-align: inherit;">Las clases restantes proporcionan acceso a la funcionalidad descrita en otros cap√≠tulos o son auxiliares para trabajar con cadenas, n√∫meros, TLV, etc. </font><font style="vertical-align: inherit;">En cuanto a la API, se interpretar√° en otra serie de art√≠culos.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limitaciones clave de JavaCard en comparaci√≥n con Java</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El lenguaje de programaci√≥n de la aplicaci√≥n JavaCard es Java. Casi Java Por lo tanto, los tipos char, float, double, long y enum no son compatibles. El tipo int es opcional para las tarjetas (generalmente las tarjetas modernas lo admiten) y su uso, si no se activa mediante la opci√≥n correspondiente, provocar√° un error al convertir la aplicaci√≥n en un archivo CAP. Olv√≠date de for, iterator y lambda. El convertidor admite gen√©ricos, importaci√≥n est√°tica y anotaciones (solo Runtime Invisible) desde la versi√≥n 3.0.0, como no afectan la ejecuci√≥n del c√≥digo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para compilar el c√≥digo, se utiliza un compilador JDK ordinario. Los errores de incompatibilidad ser√°n notorios solo cuando se convierte a un archivo CAP o cuando se usa el IDE inteligente para JavaCard.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El mayor problema para los programadores, de hecho, es la falta de un int por defecto. </font><font style="vertical-align: inherit;">Por lo general, realmente no son necesarios, por lo que no quiero activarlos innecesariamente. </font><font style="vertical-align: inherit;">Sin embargo, el compilador de Java tiene la costumbre de transmitir autom√°ticamente el resultado de todas las operaciones aritm√©ticas a int. </font><font style="vertical-align: inherit;">Para evitar esto, debe usar un tipo de conversi√≥n expl√≠cito para abreviar o byte en el c√≥digo, lo que hace que el c√≥digo sea menos legible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otra limitaci√≥n se produce en la inicializaci√≥n de campos est√°ticos, a saber, que pueden inicializarse solo con constantes y matrices que contienen constantes, pero no con objetos.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusi√≥n</font></font></h4><br>
      JavaCard.       ,   ,        ,      ,        .                   JavaCard.     ,  Global Platform,    .</div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es380543/">https://habr.com/ru/post/es380543/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es380531/index.html">Bus Blaster: interfaz universal de bits r√°pidos para entusiastas de los pacientes</a></li>
<li><a href="../es380533/index.html">Epson invita a todos a un picnic para geeks</a></li>
<li><a href="../es380535/index.html">El aterrizaje suave de la c√°psula de la Uni√≥n es m√°s como una explosi√≥n, pero no es un problema</a></li>
<li><a href="../es380537/index.html">Lanzamiento de Unreal Engine 4.8</a></li>
<li><a href="../es380541/index.html">Viernes "Paquete": casos inusuales y curiosidades en la entrega</a></li>
<li><a href="../es380545/index.html">Panasonic devolver√° los movimientos de las manos a los pacientes con accidente cerebrovascular decodificando las ondas cerebrales</a></li>
<li><a href="../es380547/index.html">Resumen de Apple WWDC para Internet de las cosas: podr√≠a haber sido m√°s interesante</a></li>
<li><a href="../es380549/index.html">Las barras de Zhenya y Luke: una herramienta multiplicadora de finales del siglo XIX</a></li>
<li><a href="../es380551/index.html">Revisi√≥n de DEXP Ixion ML 4.5 '': un tel√©fono inteligente de larga duraci√≥n: una semana sin salida por 4,990 rublos</a></li>
<li><a href="../es380553/index.html">Need For Speed ‚Äã‚ÄãIII Modern Patch: m√°s de 100 cambios sin c√≥digos fuente</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>