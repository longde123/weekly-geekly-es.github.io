<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤸🏻 🤘🏿 👵🏼 苹果钱包 这是什么以及如何将您的卡集成到其中 ⏯️ 👩‍👧‍👦 🧘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="众所周知，电子钱包并不是CIS中最受欢迎的服务。 但是客户已经在连续的第二个项目中设置了任务“与电子钱包进行集成”。 因此，我决定写这篇文章来讨论整个服务，并展示如何将我的产品集成到其中。 


 什么是钱包？ 它使您可以在手机中保留各种类型的卡（机票，打折卡等），从而使产品用户的生活更加轻松。 此...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>苹果钱包 这是什么以及如何将您的卡集成到其中</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/agima/blog/428437/"><p> 众所周知，电子钱包并不是CIS中最受欢迎的服务。 但是客户已经在连续的第二个项目中设置了任务“与电子钱包进行集成”。 因此，我决定写这篇文章来讨论整个服务，并展示如何将我的产品集成到其中。 </p><br><p> 什么是钱包？ 它使您可以在手机中保留各种类型的卡（机票，打折卡等），从而使产品用户的生活更加轻松。 此外，可以通过推送通知来更新有关地图的信息，但这是另一篇文章的主题。 但是，如果您有可以集成到电话中的卡/票/订阅，那么有解决方案！ 怎么做-阅读下面。 </p><a name="habracut"></a><br><p>通常，您的服务器负责创建地图。 该应用程序以.pkpass文件的形式接收卡，并且用户可以通过该应用程序将该卡添加到电子钱包中。 </p><br><h2 id="struktura-karty"> 地图结构 </h2><br><p> 从开发人员的角度来看，地图是什么？ 地图是扩展名为.pkpass的档案。 它包含显示和操作卡所需的所有数据。 存档的内容在下表中。 </p><br><table><tbody><tr><th> 档案文件 </th><th> 预约时间 </th></tr><tr><td>  background.png </td><td> 卡的背景图片。 </td></tr><tr><td>  footer.png </td><td> 条形码旁边的图像 </td></tr><tr><td>  icon.png </td><td> 通知和字母的图标 </td></tr><tr><td>  logo.png </td><td> 卡的标志。 显示在左上方 </td></tr><tr><td>  manifest.json </td><td> 所有包含文件的注册表 </td></tr><tr><td> 签名 </td><td>  PKCS7签名 </td></tr><tr><td>  pass.json </td><td> 外观和地图信息 </td></tr><tr><td>  strip.png </td><td> 该图片位于卡的主要说明后面 </td></tr><tr><td>  thumbnail.png </td><td> 附加图片（请指定） </td></tr></tbody></table><br><p> 可以使用以下类型的卡： </p><br><ul><li>  <b>登机票：</b>乘飞机或火车。 通常，优惠券只能使用一次； </li><li>  <b>优惠券：</b>用于优惠券和特别优惠； </li><li>  <b>活动票：</b>可以在一个活动和整个季节使用； </li><li>  <b>折扣卡：</b>会员卡，折扣卡或礼品卡； </li><li>  <b>普通证：</b>如果上述情况都不适用：例如地铁卡或健身房通行证。 </li></ul><br><p> 示意性地考虑不同卡的外观。 图片的最佳命名如上表所示。 </p><br><h3> 登机牌 </h3><br><img src="https://habrastorage.org/webt/8m/s6/cy/8ms6cyz55rve1igxt_xfv2e034i.png"><br><h3> 优惠券 </h3><br><img src="https://habrastorage.org/webt/-r/l-/dk/-rl-dknkbsqnkuim5-kqog6ceuu.png"><br><h3> 活动门票 </h3><br><img src="https://habrastorage.org/webt/rr/r9/jh/rrr9jh2ho29rfmht7xrf0z7pmes.png"><br><h3> 社区卡 </h3><br><img src="https://habrastorage.org/webt/az/zc/hg/azzchgo25cvpj_gcu_oof1vh1k8.png"><br><h3> 优惠卡 </h3><br><img src="https://habrastorage.org/webt/zl/zt/ft/zlztft7igalmerx8rhabnxorwfc.png"><br><h1 id="struktura-passjson">  Pass.json结构 </h1><br><p> 必填字段。 包含通行证类型ID，团队ID，组织名称等。 <br> 相关应用程序的键。 需要显示需要与地图“关联”的应用程序。 <br> 键入“到期日期”卡。 <br> 相关性的关键。 例如，可以使用地图的区域的坐标，或打算使用地图的事件的开始。 <br> 关键是风格。 本文开头列出了5种用于电子钱包的卡片。 他们每个人都有自己的风格。 这样的密钥必须严格地是一个。 <br> 卡外观设计的按键。 除了显而易见的内容外，它们还包含有关在地图上显示的条形码的信息。 <br>  Web服务密钥。 您可以使用Web服务与地图进行交互，例如，自动更新地图。 <br>  NFC密钥。 包含有关Apple Pay交易的其他信息。 </p><br><p> 现在更详细地介绍所有内容。 </p><br><h2> 必填项 </h2><br><table><tbody><tr><th>  <nobr>键入JSON</nobr> </th><th>  <nobr>资料类型</nobr> </th><th>  <nobr>内容描述</nobr> </th></tr><tr><td> 说明 </td><td> 弦乐 <br> 本地化 </td><td> 地图的简要说明。 本地化。 </td></tr><tr><td>  formatVersion </td><td> 整数 </td><td> 文件格式版本。 该值必须为1。 </td></tr><tr><td>  <nobr>机构名称</nobr> </td><td> 弦乐 <br> 本地化 </td><td> 发行卡的组织的名称。 </td></tr><tr><td>  <nobr>passTypeIdentifier</nobr> </td><td> 弦乐 </td><td> 传递类型ID和开发者帐户。 </td></tr><tr><td>  <nobr>序列号</nobr> </td><td> 弦乐 </td><td> 单卡序列号 </td></tr><tr><td>  <nobr>teamIdentifier</nobr> </td><td> 弦乐 </td><td> 开发团队的团队ID </td></tr></tbody></table><br><h2> 相关应用程序的按键 </h2><br><table><tbody><tr><th>  <nobr>键入JSON</nobr> </th><th>  <nobr>资料类型</nobr> </th><th>  <nobr>内容描述</nobr> </th></tr><tr><td>  <nobr>relatedStoreIdentifiers</nobr> </td><td>  [Int] </td><td> 可选地。 与卡关联的应用程序的ID。 始终采用与当前设备兼容的第一个。 </td></tr><tr><td>  <nobr>appLaunchURL</nobr> </td><td> 弦乐 </td><td> 打开时传递给应用程序的URL </td></tr></tbody></table><br><h2> 样式键 </h2><br><table><tbody><tr><th>  <nobr>键入JSON</nobr> </th><th>  <nobr>资料类型</nobr> </th><th>  <nobr>内容描述</nobr> </th></tr><tr><td>  <nobr>primaryFields</nobr> </td><td>  [JSON] </td><td> 有关地图的基本信息。 </td></tr><tr><td>  <nobr>次要领域</nobr> </td><td>  [JSON] </td><td> 背景信息。 </td></tr><tr><td>  <nobr>assistantFields</nobr> </td><td>  [JSON] </td><td> 有关其他信息的字段。 选配 </td></tr><tr><td>  <nobr>headerFields</nobr> </td><td>  [JSON] </td><td> 地图标题。 即使卡在列表中可见，也会显示。 </td></tr><tr><td>  <nobr>assistantFields</nobr> </td><td>  [JSON] </td><td> 有关地图的基本信息。 </td></tr><tr><td>  <nobr>运输类型</nobr> </td><td> 弦乐 </td><td> 票卡的运输类型。 它可以采用以下值： <br>  PKTransitTypeAir， <br>  PKTransitTypeBoat， <br>  PKTransitTypeBu`， <br>  PKTransitTypeGeneric， <br>  PKTransitTypeTrain。 </td></tr><tr><td>  <nobr>backFields</nobr> </td><td>  [JSON] </td><td> 负责地图背面的字段数组 </td></tr></tbody></table><br><p> 在这种情况下，JSON具有以下形式： </p><br><pre><code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"key"</span></span> : <span class="hljs-string"><span class="hljs-string">"value1"</span></span>, <span class="hljs-string"><span class="hljs-string">"label"</span></span> : <span class="hljs-string"><span class="hljs-string">"value2"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : <span class="hljs-string"><span class="hljs-string">"value3"</span></span></code> </pre> <br><p> 使用值键输入的值可以是数字或字符串。 但是，不能使用currencyCode和字符串值。 至于auxiliaryFields和secondaryFields，可以有多个，您应该监视它们中使用的行的长度。 </p><br><h2> 视觉设计的关键 </h2><br><table><tbody><tr><th>  <nobr>键入JSON</nobr> </th><th>  <nobr>资料类型</nobr> </th><th>  <nobr>内容描述</nobr> </th></tr><tr><td>  <nobr>条码</nobr> </td><td>  [JSON] </td><td> 条形码信息（请参见下文）。 </td></tr><tr><td>  <nobr>backgroundColor</nobr> </td><td> 颜色为字符串 </td><td> 背景颜色（＃Fa32e4） </td></tr><tr><td>  <nobr>前景色</nobr> </td><td> 颜色为字符串 </td><td> 标签颜色与值 </td></tr><tr><td>  <nobr>groupingIdentifier</nobr> </td><td> 弦乐 </td><td> 对于活动票和交通票是可选的。 具有相同样式的卡片-passTypeIdentifier和groupingIdentifier-将被分组 </td></tr><tr><td>  <nobr>labelColor</nobr> </td><td> 颜色为字符串 </td><td> 用字段名称标记文本 </td></tr><tr><td>  <nobr>logoText</nobr> </td><td> 可本地化的字符串 </td><td> 徽标旁边显示的文字 </td></tr></tbody></table><br><h2> 条码 </h2><br><p> 地图上最重要的部分。 卡片识别号被缝入其中（例如，物理卡号或票证号）。 扫描仪或任何其他工具能够以正确的编码读取代码很重要。 </p><br><table><tbody><tr><th>  <nobr>键入JSON</nobr> </th><th>  <nobr>资料类型</nobr> </th><th>  <nobr>内容描述</nobr> </th></tr><tr><td>  <nobr>altText</nobr> </td><td> 弦乐 </td><td> 如果未读取条形码，则会在条形码旁边显示可选文本。 </td></tr><tr><td>  <nobr>格式</nobr> </td><td> 弦乐 </td><td> 条码格式。 可以采用以下值：PKBarcodeFormatQR， <br>  PKBarcodeFormatPDF417， <br>  PKBarcodeFormatAztec， <br>  PKBarcodeFormatCode128 </td></tr><tr><td>  <nobr>讯息</nobr> </td><td> 弦乐 </td><td> 用条形码加密的代码或卡号。 </td></tr><tr><td>  <nobr>messageEncoding</nobr> </td><td> 弦乐 </td><td> 消息编码。 通常为iso-8859-1 </td></tr></tbody></table><br><h2> 所在位置 </h2><br><p> 这些钥匙负责卡的使用位置。 </p><br><table><tbody><tr><th>  <nobr>键入JSON</nobr> </th><th>  <nobr>资料类型</nobr> </th><th>  <nobr>内容描述</nobr> </th></tr><tr><td>  <nobr>高调</nobr> </td><td> 弦乐 </td><td> 如果未读取条形码，则会在条形码旁边显示可选文本。 </td></tr><tr><td>  <nobr>纬度</nobr> </td><td> 经度 </td><td> 纬度 </td></tr><tr><td>  <nobr>经度</nobr> </td><td> 双倍 </td><td> 纬度 </td></tr><tr><td>  <nobr>相关文字</nobr> </td><td> 弦乐 </td><td> 用户输入卡的范围时在锁定屏幕上显示的可选文本。 </td></tr></tbody></table><br><h2> 背面 </h2><br><p> 可以在反向信息部分放置其他信息：使用条款，自动更新策略，联系方式以及该卡所属应用程序的链接。 该图显示了pass.json中字段的对应关系以及地图背面的外观。 如果在值字段中有链接，电话号码等，它们将自动突出显示。 </p><br><p><img src="https://habrastorage.org/webt/er/gx/ow/ergxowmbtn08dmjnv2lkrqlo3ku.png"></p><br><h1 id="sozdanie-karty-chast-2"> 创建地图。 第二部分 </h1><br><p> 这样，图片准备就绪，形成了pass.json，将其放在一起即可。 为此，请填写manifest.json（请参阅表1），在其中您需要包括所有图片和pass.json。 原来是这样的： </p><br><pre> <code class="hljs go">. . . . . . <span class="hljs-string"><span class="hljs-string">"pass.json"</span></span> = <span class="hljs-number"><span class="hljs-number">303</span></span>c753abc39aa732ec74643d6db28348fe8a823; <span class="hljs-string"><span class="hljs-string">"strip.png"</span></span> = <span class="hljs-number"><span class="hljs-number">736d</span></span>01f84cb73d06e8a9932e43076d68f19461ff; <span class="hljs-string"><span class="hljs-string">"strip@2x.png"</span></span> = <span class="hljs-number"><span class="hljs-number">468f</span></span>a7bc93e6b55342b56fda09bdce7c829d7d46; . . . . . .</code> </pre> <br><p> 从这一点开始，无需更改任何内容，因为SHA将是不正确的；如果进行更改，则必须重新生成SHA。 </p><br><p> 接下来，您需要在开发人员的办公室中创建通行证类型ID并为其制作证书。 如果您以前创建过此过程，则应该或多或少熟悉该过程，例如，Provisioning配置文件。 </p><br><img src="https://habrastorage.org/webt/2b/um/hu/2bumhu9wgoawlz1lt-qhieildna.png"><br><p> 接下来，转到“钥匙串”，然后从那里导出.pem的“ Apple全球开发者关系证书”（WWDR）。 </p><br><p><img src="https://habrastorage.org/webt/jg/kk/sl/jgkksl_tfac4e23hz7bk1swxhtq.png"></p><br><p> 从那里，我们将创建的通行证类型ID导出为.p12。 此时，管家将要求您输入证书的密码。 在这种情况下，密码是可选的。 <br> 请注意，所有其他操作都必须在一个文件夹中执行，该文件夹应已位于manifest.json，pass.json和图片中。 </p><br><p> 现在您需要生成一个签名，我们将对存档进行签名。 首先，将通行证类型ID及其密钥导出为.pem。 </p><br><pre> <code class="hljs powershell">openssl pkcs12 <span class="hljs-operator"><span class="hljs-operator">-in</span></span> certificate.p12 <span class="hljs-literal"><span class="hljs-literal">-clcerts</span></span> <span class="hljs-literal"><span class="hljs-literal">-nokeys</span></span> <span class="hljs-literal"><span class="hljs-literal">-out</span></span> passcertificate.pem <span class="hljs-literal"><span class="hljs-literal">-passin</span></span> pass: your_password</code> </pre> <br><p> 和 </p><br><pre> <code class="hljs powershell">openssl pkcs12 <span class="hljs-operator"><span class="hljs-operator">-in</span></span> certificates.p12 <span class="hljs-literal"><span class="hljs-literal">-nocerts</span></span> <span class="hljs-literal"><span class="hljs-literal">-out</span></span> passkey.pem <span class="hljs-literal"><span class="hljs-literal">-passin</span></span> pass: <span class="hljs-literal"><span class="hljs-literal">-passout</span></span> pass:new_password</code> </pre> <br><p> 现在我们准备生成签名。 让我们将其作为命令： </p><br><pre> <code class="hljs powershell">openssl smime <span class="hljs-literal"><span class="hljs-literal">-binary</span></span> <span class="hljs-literal"><span class="hljs-literal">-sign</span></span> <span class="hljs-literal"><span class="hljs-literal">-certfile</span></span> WWDR.pem <span class="hljs-literal"><span class="hljs-literal">-signer</span></span> passcertificate.pem <span class="hljs-literal"><span class="hljs-literal">-inkey</span></span> passkey.pem <span class="hljs-operator"><span class="hljs-operator">-in</span></span> manifest.json <span class="hljs-literal"><span class="hljs-literal">-out</span></span> signature <span class="hljs-literal"><span class="hljs-literal">-outform</span></span> DER <span class="hljs-literal"><span class="hljs-literal">-passin</span></span> pass:___</code> </pre> <br><p> 因此，一切准备就绪，仅收集档案，我们使用以下命令执行此操作： </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">zip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nameOfPass</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pkpass</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">manifest</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.json</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pass</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.json</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">signature</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">logo</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.png</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">logo</span></span>@<span class="hljs-keyword"><span class="hljs-keyword">2x</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">png</span></span> logo@<span class="hljs-number"><span class="hljs-number">3</span></span>x.png icon.png icon@<span class="hljs-number"><span class="hljs-number">2</span></span>x.png icon@<span class="hljs-number"><span class="hljs-number">3</span></span>x.png</code> </pre> <br><p> 我提请您注意以下事实：您要在其中包括卡的数据存档（.pkpass）的所有文件都应在此处列出。 <br> 结果，我们得到一个.pkpass文件，该文件可以在计算机上打开。 我们将看到卡的预览，其外观可能与手机上的外观有所不同。 <br> 所有这些都可以轻松一点。  Apple提供了<code>signpass</code>实用程序（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Apple Wallet示例</a> <code>signpass</code> ），该实用程序负责所有SHA计算（ <code>manifest.json</code>文件可以保留）和创建签名的工作。 要使用它，您需要构建一个项目并将<code>signpass</code>文件放入具有所有必要资源的文件夹中。 </p><br><img src="https://habrastorage.org/webt/tj/jj/eo/tjjjeoqlhxzjumfr3nrg9ve8yhm.png"><br><p> 通常，结构应如下所示： </p><br><img src="https://habrastorage.org/webt/qc/pb/lr/qcpblrbdaw7piffxdehwa1whlpw.png"><br><p> 接下来，执行命令： </p><br><pre> <code class="hljs powershell">./signpass <span class="hljs-literal"><span class="hljs-literal">-p</span></span> wallet</code> </pre> <br><p> 钱包是所有资源都位于其中的文件夹的名称。 输出为wallet.pkpass。 可以通过将wallet.pkpass解压缩来查看其内容。 </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">unzip</span></span> wallet.pkpass</code> </pre> <br><p> 可能将pkpass的创建提交给后端，在这种情况下，有必要将.p12形式的通行证ID证书及其密码传送给WWDR开发人员。 </p><br><h1 id="integraciya-s-prilozheniem"> 应用整合 </h1><br><p> 为了使应用程序能够向电子钱包添加卡片，您必须在应用程序ID中启用此功能，并且还必须在项目的功能中启用此功能。 </p><br><img src="https://habrastorage.org/webt/yq/wo/py/yqwopyfu9nhk-_klilrcoczwe3m.png"><br><img src="https://habrastorage.org/webt/o-/se/ek/o-seekf9zbohe4jmwtcvnzfwes4.png"><br><p> 这对于使用Wallet进行完整正确的工作是必要的。 否则，将无法从电子钱包读取卡，例如，将无法了解是否添加了我们的卡。 同样重要的是要注意pass.json中的团队ID必须与团队ID匹配，否则您必须手动将它们添加到权利中，这样可以解决这种情况，但是我没有进行检查。 </p><br><p><img src="https://habrastorage.org/webt/82/ow/p9/82owp9rv4gyaldwm0si77b5nn8m.png"></p><br><h2 id="dobavlenie-karty"> 添加卡 </h2><br><p> 添加地图非常简单： </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passPath = <span class="hljs-type"><span class="hljs-type">Bundle</span></span>.main.path(forResource: <span class="hljs-string"><span class="hljs-string">"wallet"</span></span>, ofType: <span class="hljs-string"><span class="hljs-string">"pkpass"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error: <span class="hljs-type"><span class="hljs-type">ErrorPointer</span></span> = <span class="hljs-type"><span class="hljs-type">ErrorPointer</span></span>(nilLiteral: ()) <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passData = <span class="hljs-type"><span class="hljs-type">NSData</span></span>(contentsOfFile: passPath) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pass = <span class="hljs-type"><span class="hljs-type">PKPass</span></span>(data: passData <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-type"><span class="hljs-type">Data</span></span>, error: error) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passLibrary = <span class="hljs-type"><span class="hljs-type">PKPassLibrary</span></span>() passLibrary.addPasses([pass]) { (status) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(passLibrary.containsPass(pass)) }</code> </pre> <br><p> 但是，同样，更多时候需要从您的服务器下载.pkpass文件。 <br> 值得注意的是，PassKit会产生相当可读的错误，因此您可以轻松地了解到底做错了什么。 </p><br><h2 id="poluchenie-informacii-o-dobavlennyh-kartah"> 检索有关已添加卡的信息 </h2><br><p> 要获取有关电子钱包中可用的卡以及与您的应用程序相关的信息，您需要转到PKPassLibrary对象。 </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passLibrary = <span class="hljs-type"><span class="hljs-type">PKPassLibrary</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passes = passLibrary.passes()</code> </pre> <br><p> 因此，您可以了解是否添加了地图以及更新界面。 另外，通过PKPassLibrary可以更新和删除地图。 也可以通过Web服务来更新地图，但是在本文中我们将不考虑这种选择。 </p><br><h1 id="proverka-na-unikalnost"> 唯一性检查 </h1><br><p> 由于通常在您的服务中，卡与帐户绑定，因此在应用程序中，您很有可能必须以某种方式确定卡是否属于当前用户。 我建议通过<code>serialNumber</code>执行此操作。 例如，设置用户或卡号的<code>serialNumber</code> ID。 </p><br><h1 id="testirovanie"> 测试中 </h1><br><p> 苹果提供了针对不同类型的pkpass示例，您可以专注于它们。 <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">苹果钱包样品</a> <br> 要查看地图的外观，可以将pkpass添加到项目中（请参阅“添加地图”）。 上面已经讨论了添加/删除过程，仅需记住，如果钱包卡是在一个开发者的帐户上创建的，而开发本身是从另一个帐户（与外包公司相关）进行的，则应用程序将看不到已经添加的卡。 在这种情况下，您可以添加卡而不会出现问题。 <br> 您可以使用任何QR码扫描仪检查条形码中的信息是否正确编码。 而且绝对有必要检查此扫描仪的工作是否正确。 </p><br><h1 id="zaklyuchenie"> 结论 </h1><br><p> 本文研究了创建和设计地图的过程，以及与应用程序集成的过程和可能出现的问题。 我故意没有解决与Web服务和地图更新集成的问题，我希望在下一篇文章中做到这一点。 </p><br><h1 id="ispolzuemye-materialy"> 所用材料： </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/PassKit_PG/Creating.html</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://developer.apple.com/library/archive/documentation/UserExperience/Reference/PassKit_Bundle/Chapters/TopLevel.html#//apple_ref/doc/uid/TP40012026-CH2-SW3</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://itechroof.wordpress.com/2015/11/30/apple-wallet-part-13/</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/PassKit_PG/Updating.html</a> </p><br><p> 特别感谢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">mehdzor</a>提供的测试开发人员帐户。 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN428437/">https://habr.com/ru/post/zh-CN428437/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN428423/index.html">专家和分析师：IBM与红帽之间的340亿美元交易将如何改变IT市场</a></li>
<li><a href="../zh-CN428429/index.html">办公套件LibreOffice中的GOST R 34.10电子签名的PDF文档</a></li>
<li><a href="../zh-CN428431/index.html">不只是同心层</a></li>
<li><a href="../zh-CN428433/index.html">私人测试律师</a></li>
<li><a href="../zh-CN428435/index.html">在PHP中用俄语读什么？</a></li>
<li><a href="../zh-CN428439/index.html">没有合奏</a></li>
<li><a href="../zh-CN428441/index.html">GitHub购买已完成。 接下来会发生什么？</a></li>
<li><a href="../zh-CN428443/index.html">协调-检查分布式系统中的数据完整性</a></li>
<li><a href="../zh-CN428445/index.html">我们如何在赫尔辛基进行黑客马拉松并迷路了</a></li>
<li><a href="../zh-CN428447/index.html">云数据保护：开发人员指南</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>