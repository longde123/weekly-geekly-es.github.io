<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✊🏾 😋 👝 Simple Queues Guide bei Mikrotik 🕴🏼 🧑🏽 ✊</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Es gibt viele Artikel im Internet, die sich mit Geschwindigkeitsbegrenzung und Verkehrsfreigabe auf MikroTik-Geräten befassen, aber fast alle berücksi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Simple Queues Guide bei Mikrotik</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420117/"><p>  Es gibt viele Artikel im Internet, die sich mit Geschwindigkeitsbegrenzung und Verkehrsfreigabe auf MikroTik-Geräten befassen, aber fast alle berücksichtigen nur den Warteschlangenbaum, der ein tiefes Verständnis erfordert und bei vielen Aufgaben überflüssig ist und durch einfache Warteschlangen ersetzt werden kann. </p><a name="habracut"></a><br><p>  Vereinfachte Warteschlangen - ein Mechanismus zum Aufteilen der Kanalkapazität und zum Priorisieren des an ein bestimmtes Ziel gebundenen Datenverkehrs.  Eingehender und ausgehender Verkehr wird relativ zum Ziel berechnet. </p><br><p>  Es gibt drei Optionen für Ziele: IP, Subnetz, Schnittstelle.  Sie können mehrere Ziele für eine Regel hinzufügen. </p><br><h3 id="teoreticheskaya-chast">  Theoretischer Teil </h3><br><h4 id="sheypery-planirovschiki-i-ocheredi">  Shaper, Planer und Warteschlangen </h4><br><p>  Die Datenrate wird in Bezug auf die übertragenen Informationen in Bit pro Sekunde Zeitbit / s gemessen.  Die Biteinheit ist klein, daher werden die Präfixe Kilo (kbit / s), Mega (Mbit / s) und Gig (Gbit / s) verwendet. </p><br><p>  Die Paketübertragungsgeschwindigkeit über Kommunikationsnetzwerke entspricht immer der Übertragungsgeschwindigkeit des Mediums (z. B. 100 Mbit / s für Ethernet 100BASE-TX).  Wenn diese Geschwindigkeit verringert werden muss, sendet ein Zwischengerät wie ein Router, das Pakete von einer Schnittstelle mit maximaler Geschwindigkeit empfängt, diese mit einer bestimmten Verzögerung von einer anderen. Wenn Pakete die festgelegte Geschwindigkeitsbegrenzung überschreiten, werden sie in einer Warteschlange gespeichert und gemäß First In, First Out ( FIFO), wenn die Warteschlange voll ist (fehlende oder Nullgröße), verwirft der Router die Pakete. </p><br><p>  <strong>Limit</strong> - Administratives Tempolimit für Datenverkehr von der Schnittstelle. <br>  <strong>Shaper (Shaper)</strong> - ein Softwarealgorithmus, der überschüssige Pakete verzögert und verwirft. <br>  <strong>Scheduler (Sheduler)</strong> - Ein Algorithmus, der entscheidet, wie Pakete gespeichert und <strong>gesendet werden</strong> , die über das Limit hinausgehen. <br>  <strong>Warteschlangen</strong> - Speicher- und Priorisierungsalgorithmen für die Weiterleitung von Datenverkehr. </p><br><p>  Grafische Beispiele für die Arbeit eines Shapers und Schedulers. </p><br><p>  Verwenden eines Shaper Out of Line </p><br><p><img src="https://habrastorage.org/webt/rk/60/8_/rk608_lhdbfv_zstsgrk0t_6rpq.png"></p><br><p>  Verwenden eines Shapers mit einem Scheduler </p><br><p><img src="https://habrastorage.org/webt/ln/ry/im/lnryimsagc89acaf3pgjy9qollk.png"></p><br><h4 id="simple-queues-na-packet-flow">  Einfache Warteschlangen für den Paketfluss </h4><br><p>  Einfache Warteschlangen folgen dem Warteschlangenbaum. Manchmal werden einfache Warteschlangen verwendet, um den Datenverkehr schnell auf einen (oder mehrere) Benutzer zu beschränken, ohne den Warteschlangenbaum zu beeinträchtigen. </p><br><div class="spoiler">  <b class="spoiler_title">Vereinfachter Paketfluss für Interessierte</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/9k/yk/vr/9kykvrkaxqkpncv_hjsqc3i9ssg.png"></p></div></div><br><h4 id="mehanika-raboty-ocheredey-none-pfifo-pcq">  Warteschlangenmechanik: keine, pfifo, pcq </h4><br><p>  <strong>none</strong> - no queue; wenn das Limit überschritten wird, werden alle neuen Pakete verworfen. </p><br><p>  <strong>pfifo</strong> ist ein paketorientierter FIFO-Algorithmus.  Speichert die Anzahl der in den Einstellungen angegebenen Pakete.  Wird standardmäßig in einfachen Warteschlangen verwendet. </p><br><p><img src="https://habrastorage.org/webt/o-/af/gv/o-afgv9hsemh5ekrhrloakgatnm.png"></p><br><p>  <strong>pcq (Per Connection Queuing)</strong> - Der gesamte Datenverkehr wird abhängig von einer Reihe von Bedingungen in <strong>Unterwarteschlangen</strong> unterteilt.  Von jeder Unterwarteschlange wird abwechselnd ein Teil des Datenverkehrs gesendet.  Der frei gewordene Raum wird von neu angekommenem Verkehr belegt.  Wenn der Platz in der Unterwarteschlange leer ist, werden die dafür bestimmten Pakete verworfen. </p><br><p><img src="https://habrastorage.org/webt/0j/ya/2i/0jya2iixjm_adtvot6x5cuoa00u.png"></p><br><p>  Betrachten Sie einen kleinen Teil der Einstellungen: <br>  <strong>Rate</strong> : Geschwindigkeitsbegrenzung für jede der Unterwarteschlangen. <br>  <strong>Limit</strong> : Größe der Unterwarteschlange in Kilobyte. <br>  Gesamtlimit: Die Gesamtgröße aller Unterwarteschlangen in Kilobyte. <br>  <em>Das Verhältnis Limit / Gesamtlimit wird je nach Situation ausgewählt.</em>  <em>Standardmäßig 40 Warteschlangen (2000/50), vorbehaltlich ihrer maximalen Verkehrsfüllung.</em> <br>  <strong>Burst</strong> : über ihn wird niedriger sein. <br>  <strong>Klassifikator</strong> : basierend darauf, was den Verkehr in Warteschlangen aufteilt. <br>  Der Klassifizierer wechselt abwechselnd verschiedene Verbindungen. Wenn Sie auf [IP] -&gt; [Firewall] -&gt; [Verbindungen] klicken, können Sie feststellen, dass die meisten Verbindungen die Adresse und den Port des Absenders (src. Adresse, src. Port) und des Empfängers (src. Adresse, src. Port) enthalten. dst. Adresse, dst. Port). </p><br><p>  Wir diskutieren einfache Warteschlangen. Der Einfachheit halber werden wir berücksichtigen, dass wir nur den von der WAN-Schnittstelle kommenden Datenverkehr filtern. In diesem Fall wird der ausgehende (Upload-) Datenverkehr relativ zum Ziel von src klassifiziert.  Adresse und die eingehende (Download) von dst.  Adresse. </p><br><p>  Durch die Klassifizierung nach Port wird vermieden, dass die Warteschlange durch den Datenverkehr einer Anwendung verstopft wird. Wenn eine Anwendung viele ausgehende Verbindungen herstellt (z. B. Torrent oder Web-Browser mit einer Reihe von Registerkarten), unterscheidet sich deren Quellcode.  Port und Verkehr werden ebenfalls in Warteschlangen unterteilt. </p><br><h4 id="dinamicheskiy-sheyping-sredstvami-pcq">  Dynamische Formgebung mit PCQ </h4><br><p>  Wenn die Rate streng festgelegt ist, hat jeder Teilstrom eine bestimmte Geschwindigkeit und kann diese nicht überschreiten, bis die Gesamtgeschwindigkeit aller Teilströme den oberen Grenzwert überschreitet (in einfachen Warteschlangen ist es der Gesamtgrenzwert). In diesem Fall nimmt die Geschwindigkeit aller Teilströme ab proportional. </p><br><p><img src="https://habrastorage.org/webt/k8/z4/rb/k8z4rbxttud1n5yzgb0iapcpvom.png"></p><br><p>  Wenn Rate auf 0 gesetzt ist, wird die höhere Einschränkung von allen Teilströmen geteilt.  In der Tat ist dies eine dynamische Formgebung. </p><br><p><img src="https://habrastorage.org/webt/g-/ig/rm/g-igrm9quokfmrvbmot1fh5_g5e.png"></p><br><p>  Wenn Rate auf 0 gesetzt ist und kein Gesamtlimit für einfache Warteschlangen angegeben ist, wird die Geschwindigkeit zwischen den Unter-Threads basierend auf einem höheren Limit aufgeteilt. Wenn die Warteschlangen nicht verschachtelt sind, ist dies eine Einschränkung der physischen Schnittstelle.  Wenn Ihr Tarifplan niedriger ist, wird ein Teil des Datenverkehrs auf den Geräten des Anbieters unterbrochen, und die Warteschlangen profitieren nicht. </p><br><p><img src="https://habrastorage.org/webt/0k/um/i7/0kumi7g7yykezh0v0jlkcp3dd8u.png"></p><br><p>  <em>Die übrigen Arten von Warteschlangen (SFQ, RED) haben ihre eigenen Eigenschaften und Anwendungen und können auch für einfache Warteschlangen verwendet werden, aber jetzt sind sie für uns nicht von Interesse.</em> </p><br><h4 id="markirovka-paketov">  Verpackungskennzeichnung </h4><br><p>  Ja, in einfachen Warteschlangen können Sie beschrifteten Datenverkehr verwenden.  Dies ist keine Voraussetzung (im Gegensatz zum Warteschlangenbaum), ermöglicht es Ihnen jedoch, sich von den Einschränkungen des Ziels zu entfernen. </p><br><p> Die Verkehrsbezeichnung erfolgt in [IP] -&gt; [Firewall] -&gt; [Mangle]. Insgesamt gibt es drei Arten von Bezeichnungen: Verbindung, Paket, Route.  Jedes Paket kann ein Etikett jedes Typs enthalten.  Sobald sich die Verpackung in der Mangel befindet, wird sie nach allen Regeln einzeln übergeben. Wenn zwei geschmolzene Set-Etiketten vorhanden sind, überschreibt die untere Regel das Etikett vom oberen.  Um ein Überschreiben zu verhindern, können Sie in der ersten Regel den Durchgang eines Pakets entlang der Kette deaktivieren ( <code>passtrought=no</code> ). </p><br><p>  Beim Einrichten von Warteschlangen können Sie nur Paketbezeichnungen verwenden ( <code>action=mark-packet</code> ).  Um die Leistung zu verbessern (Verbindungsbezeichnungen werden schneller überprüft als die Bedingungen in jedem Paket überprüft), wird empfohlen, zuerst Verbindungen ( <code>action=mark-connection</code> ) und dann Pakete in dieser Verbindung ( <code>action=mark-package</code> ) zu <code>action=mark-package</code> .  <em>Die Regel mit Vormarkierungsverbindungen ist nicht immer wahr. Wenn Sie jedoch beim Erstellen von Warteschlangen zu diesem Verständnis gelangt sind, sollten Sie den Warteschlangenbaum verwenden.</em> </p><br><p>  Sie können den Transitverkehr in jeder der Paketflussketten markieren, aber in den meisten Fällen bevorzuge ich die Weiterleitung, weil  Zu diesem Zeitpunkt sind die Adressen des Empfängers mit dem Absender und die Namen der eingehenden und ausgehenden Schnittstellen bekannt. </p><br><div class="spoiler">  <b class="spoiler_title">Beispiel für eine Verkehrsbeschriftung</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/4p/fk/kk/4pfkkkzdf7nrl0eew8x7ckapnas.png"></p><br><pre> <code class="plaintext hljs">/ip firewall mangle add action=mark-connection chain=forward connection-state=new dst-port=5060,10000-20000 new-connection-mark=output-sip-and-rtp passthrough=yes protocol=udp src-address=192.168.100.0/24 add action=mark-packet chain=forward connection-mark=output-sip-and-rtp new-packet-mark=output-packet-sip-and-rtp passthrough=no</code> </pre> </div></div><br><h4 id="chto-takoe-burst">  Was ist geplatzt </h4><br><p>  Normalerweise wird die Geschwindigkeitsbegrenzung als ein bestimmter statischer Wert der Begrenzung pro Sekunde verstanden, wenn erreicht wird, welche Pakete verworfen oder in die Warteschlange gestellt werden.  Burst arbeitet mit einem Durchschnittswert pro Zeiteinheit. Dies ermöglicht die Verwendung höherer (Spitzen-) Geschwindigkeiten in kurzen Zeiträumen und begrenzt die Geschwindigkeit bei konstanter Belastung des Kanals. </p><br><p>  <strong>Max Limit</strong> ist die Hauptbeschränkung. <br>  <strong>Burst Limit</strong> - Spitzengeschwindigkeit, hat Vorrang vor Max Limit, wenn die angegebene Durchschnittsgeschwindigkeit eingehalten wird. <br>  <strong>Burst Threshold</strong> - Geschwindigkeit des Limits. <br>  <strong>Burst Time</strong> - Zeit. </p><br><p>  Das Ziel erhält die Geschwindigkeit vom Burst-Limit, aber jede Sekunde wird die Durchschnittsgeschwindigkeit für die Burst-Zeit berechnet.  Wenn die Durchschnittsgeschwindigkeit für eine bestimmte Zeit den Burst-Schwellenwert überschreitet, ist der Benutzer auf das maximale Limit beschränkt. Wenn die durchschnittliche Geschwindigkeit wieder normal ist, erhält das Ziel erneut das Burst-Limit. </p><br><div class="spoiler">  <b class="spoiler_title">Burst-Fallstudie</b> <div class="spoiler_text"><p>  Burst-Regel: </p><br><p><img src="https://habrastorage.org/webt/x8/e6/kr/x8e6krcahevnrpazzw3eo1rlrv8.png"></p><br><p>  Flussdiagramm mit Änderung der Zielgeschwindigkeit: </p><br><p><img src="https://habrastorage.org/webt/ss/u8/_i/ssu8_i_b8z-kbg9etldtnkzu9ga.png"></p><br><p>  Und wie sieht die Änderung der Zielgeschwindigkeit aus: </p><br><p><img src="https://habrastorage.org/webt/av/kz/jb/avkzjbsh7wfduzsflatk8fqutqc.png"></p></div></div><br><p>  <em>Wenn Sie sich für das Burst-Thema interessieren, empfehle ich, die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Informationen im Wiki zu</a> lesen. Es gibt Grafiken und Tabellen, anhand derer Sie besser verstehen können, wie sich die Werte für Schwellenwert und Zeit auf das Tempolimit auswirken.</em> </p><br><h4 id="razlichie-limit-at-i-max-limit">  Differenzgrenze bei und Maximalgrenze </h4><br><p><img src="https://habrastorage.org/webt/ii/n7/jh/iin7jhchctr21e2n5i1jenft-my.png"></p><br><p>  <strong>Limit bei</strong> - garantierter Geschwindigkeit für die Regel.  Es ist wünschenswert, dass die Summe aller Grenzwerte die Bandbreite des Kanals nicht überschreitet.  Immer weniger als das Maximum. <br>  <strong>Max Limit</strong> - maximale Geschwindigkeit für die Regel.  Wenn das "Budget" der Warteschlange dies zulässt, wird die maximale Bandbreite zugewiesen. </p><br><p>  Normalerweise wird in vereinfachten Warteschlangen nur die maximale Grenze angegeben, und dies funktioniert einwandfrei. In einer kaskadierten Warteschlangenkonfiguration sollten jedoch beide Grenzen angegeben werden. </p><br><h3 id="prakticheskaya-chast">  Praktischer Teil </h3><br><p>  Einfache Warteschlangen werden unter [Warteschlangen] -&gt; [Einfache Warteschlangen] konfiguriert. <br>  Regeln werden abwechselnd von oben nach unten verarbeitet, die erste geeignete Regel wird auf das übergebende Paket angewendet.  Tatsächlich kann eine Ausnahme von jeder Regel gemacht werden, indem eine spezifischere Regel oben platziert wird. </p><br><h4 id="ogranichenie-skorosti-dlya-konkretnogo-hostapodsetiinterfeysa">  Geschwindigkeitsbegrenzung für Host / Subnetz / Schnittstelle </h4><br><p>  Es wird normalerweise verwendet, wenn die Geschwindigkeit eines bestimmten Benutzers abgeschaltet werden muss. <br>  Name: ein beliebiger Name <br>  Ziel: Adresse, Subnetz oder Schnittstelle. <br>  Ziel-Upload: Ausgehende Geschwindigkeitsbegrenzung. <br>  Targer Download: Eingehende Geschwindigkeitsbegrenzung. </p><br><p>  Geschwindigkeitsbegrenzung auf 1 Mbit / s: </p><br><p><img src="https://habrastorage.org/webt/rj/0l/dy/rj0ldymsyrl-ulstludlvz6uhty.png"></p><br><pre> <code class="plaintext hljs">/queue simple add max-limit=1M/1M name=Limit-For-100.200 queue=default/default target=192.168.100.200/32</code> </pre> <br><p>  In Statistik können Sie die aktuelle Geschwindigkeit für das Ziel, die Anzahl der Pakete in der Warteschlange und die Anzahl der verworfenen Pakete anzeigen. </p><br><h4 id="ogranichenie-skorosti-dlya-udalennogo-resursa">  Geschwindigkeitsbegrenzung für eine Remote-Ressource </h4><br><p>  Option ohne Etikettierung von Paketen. </p><br><p>  Im Feld dst kann ähnlich wie bei target angegeben werden: IP, Subnetz, Schnittstelle.  Unter den Bedingungen des modernen Internets reicht dies nicht aus, kann jedoch für kleine Unternehmen und Geschwindigkeitsbegrenzungen zwischen Büros nützlich sein. </p><br><p><img src="https://habrastorage.org/webt/jo/fi/te/jofiteubgejsubajjte9e26smj0.png"></p><br><pre> <code class="plaintext hljs">/queue simple add dst=192.168.200.10/32 max-limit=10M/10M name=Limit-For-Fileserver target=192.168.100.0/24</code> </pre> <br><h4 id="ravnocennoe-delenie-kanala-mezhdu-uchastnikami-podseti-pcq">  Gleiche Kanalaufteilung zwischen Subnetzteilnehmern (pcq) </h4><br><p>  Eine Regel, die Ihr Heim- oder Büro-Subnetz vor der exklusiven Kanalerfassung (im Beispiel 50 MBit / s, Anpassung an Ihren Kanal) durch einen Benutzer schützt. </p><br><p><img src="https://habrastorage.org/webt/w_/nl/mg/w_nlmgmsen5nlddzajhh1jm3v0y.png"></p><br><p>  Die angegebenen PCQ-Warteschlangen sind in der Grundkonfiguration vorhanden, aber ich füge bei Änderungen Screenshots hinzu. </p><br><p><img src="https://habrastorage.org/webt/ki/xk/-s/kixk-svzxxq8i3c7ekpzj_tynyc.png"></p><br><pre> <code class="plaintext hljs"># /queue type add kind=pcq name=pcq-upload-default pcq-burst-rate=0 pcq-burst-threshold=0 pcq-burst-time=10s pcq-classifier=src-address pcq-dst-address-mask=32 pcq-dst-address6-mask=128 pcq-limit=50KiB pcq-rate=0 pcq-src-address-mask=32 pcq-src-address6-mask=128 pcq-total-limit=2000KiB add kind=pcq name=pcq-download-default pcq-burst-rate=0 pcq-burst-threshold=0 pcq-burst-time=10s pcq-classifier=dst-address pcq-dst-address-mask=32 pcq-dst-address6-mask=128 pcq-limit=50KiB pcq-rate=0 pcq-src-address-mask=32 pcq-src-address6-mask=128 pcq-total-limit=2000KiB # Simple queues /queue simple add max-limit=50M/50M name=Limit-Equivalent queue=pcq-upload-default/pcq-download-default target=192.168.100.0/24</code> </pre> <br><p>  Auf der Registerkarte Statistik können Sie sehen, wie viele PCQ-Threads sich derzeit in der Warteschlange befinden. </p><br><p><img src="https://habrastorage.org/webt/yz/8s/vf/yz8svfgkm1oz-veqdsihxt0t_lq.png"></p><br><h4 id="markirovannyy-trafik">  Tagged Verkehr </h4><br><p>  Die Option dst ist sehr begrenzt. Wenn Sie Domainnamen oder Adresslisten verwenden möchten, müssen Sie auf die Verkehrsmarkierung zurückgreifen.  Zum Beispiel werden wir die Einschränkungen für die Domäne yandex.ru aufheben (ja, eine Reihe von cdn'ok ist dort verbunden und andere Dinge, und für den normalen Betrieb müssen Sie sie hinzufügen). </p><br><p>  In einer neueren Version wurde es möglich, Domainnamen zu Adresslisten hinzuzufügen. Mikrotik löst sie automatisch auf und fügt dynamische Einträge hinzu. </p><br><p><img src="https://habrastorage.org/webt/sq/3h/zt/sq3hztxzt1qzmwfjeejb4seuzog.png"></p><br><p>  Markieren des http / https-Verkehrs (Verbindung und Pakete in der Verbindung) für die angegebenen Adressen: </p><br><p><img src="https://habrastorage.org/webt/xv/9e/8i/xv9e8ijrdum_l0owpnkri2mehs8.png"></p><br><p><img src="https://habrastorage.org/webt/nj/hh/xx/njhhxx9sgajhbqk2qixgosht3oi.png"></p><br><p><img src="https://habrastorage.org/webt/z_/hn/xi/z_hnxipzr3mhe3khsehfnb7l_gc.png"></p><br><p>  Regel in einfacher Warteschlange: </p><br><p><img src="https://habrastorage.org/webt/pk/2p/jx/pk2pjxppbsgbxgcpblnvppzuv7k.png"></p><br><pre> <code class="plaintext hljs">#   /ip firewall address-list add address=yandex.ru list=ForQueues add address=yastatic.net list=ForQueues #    /ip firewall mangle add action=mark-connection chain=forward connection-state=new dst-address-list=ForQueues dst-port=80,443 new-connection-mark=Mark-ForQueues passthrough=yes protocol=tcp src-address=192.168.100.0/24 add action=mark-packet chain=forward connection-mark=Mark-ForQueues new-packet-mark=Mark-Packet-ForQueues passthrough=no #  Simple Queue /queue simple add max-limit=1M/1M name=Limit-For-Yandex packet-marks=Mark-Packet-ForQueues target=192.168.100.0/24</code> </pre> <br><h4 id="kaskadnye-ocheredi">  Kaskadierende Warteschlangen </h4><br><p>  Alles, was oben gesagt wurde, bezieht sich auf die Begrenzung und Aufteilung der Geschwindigkeit zwischen Netzwerkteilnehmern. Es ist Zeit, das Thema der Verkehrspriorisierung anzusprechen.  Normalerweise ist es für interaktiven Verkehr (voip, vcs, ssh, rdp, ...) in einem begrenzten und ausgelasteten Kanal erforderlich. </p><br><p>  Für kaskadierende Warteschlangen ist der Parameter Parent verantwortlich, der sich auf die Warteschlange "parent" bezieht.  Um zu arbeiten, muss der gesamte Datenverkehr aus den "untergeordneten" Warteschlangen vom übergeordneten Element erfasst werden. </p><br><p>  Der Priority-Parameter ist dafür verantwortlich, welcher Datenverkehr früher zur Warteschlange hinzugefügt wird. Er funktioniert nur in untergeordneten Warteschlangen (oder in "parent", wenn sie kein "child" haben), kann Werte von 1 (höchste Priorität) bis 8 annehmen und hat nichts gemeinsam mit QoS-Tags (DSCP; TOS). </p><br><p>  Verkehrsvormarkierung: </p><br><p><img src="https://habrastorage.org/webt/3q/aj/wj/3qajwjqsgfsk2rjyttjox_puw_q.png"></p><br><pre> <code class="plaintext hljs">/ip firewall mangle add action=mark-connection chain=forward connection-state=related,new dst-port=5060,10000-20000 in-interface=br-lan new-connection-mark=mark-conn-voip passthrough=yes protocol=udp add action=mark-packet chain=forward connection-mark=mark-conn-voip new-packet-mark=mark-pkg-voip passthrough=no add action=mark-connection chain=forward connection-state=new dst-port=80,443 in-interface=br-lan new-connection-mark=mark-conn-web passthrough=yes protocol=tcp</code> </pre> <br><p>  Warteschlangen in SimpleQueue: </p><br><p><img src="https://habrastorage.org/webt/__/np/f0/__npf0bat-c1n1qzxtthgufnwnw.png"></p><br><p><img src="https://habrastorage.org/webt/z6/1h/kt/z61hktl_myep7moyk_l4tl4umji.png"></p><br><p><img src="https://habrastorage.org/webt/pu/uu/os/puuuosqryi6zu8_userqrvlse50.png"></p><br><p><img src="https://habrastorage.org/webt/ot/rc/dv/otrcdvd-qjwvsk7gettmlv-1qma.png"></p><br><p><img src="https://habrastorage.org/webt/0t/gg/ga/0tgggaclbuc1ar18coyvqkffplg.png"></p><br><pre> <code class="plaintext hljs">/queue simple add limit-at=24M/24M max-limit=25M/25M name=main target=10.10.10.0/24 add limit-at=5M/5M max-limit=8M/8M name=voip packet-marks=mark-pkg-voip parent=main priority=1/1 queue=pcq-upload-default/pcq-download-default target="" add limit-at=10M/10M max-limit=20M/20M name=web packet-marks=mark-pkg-web parent=main priority=2/2 queue=pcq-upload-default/pcq-download-default target="" add limit-at=10M/10M max-limit=20M/20M name=other packet-marks=mark-pkg-other parent=main priority=3/3 queue=pcq-upload-default/pcq-download-default target=""</code> </pre> <br><p>  Wenn Sie nun eine Einschränkung für eine IP vornehmen müssen, stellen Sie die Regel einfach vor die Warteschlangenkaskade. </p><br><h3 id="posleslovie">  Nachwort </h3><br><p>  Simple Queues ist ein ziemlich interessantes und funktionales Tool für Heim- und SOHO-Konfigurationen. Mit einer Regel (ohne auf Verkehrskennzeichnung zurückzugreifen) können Sie das Problem der Kanalerfassung mit einem Gerät lösen.  Wenn Sie jedoch FastTrack verwenden, vergessen Sie die Warteschlangen - der Datenverkehr wird an ihnen vorbeigehen. </p><br><p>  Für komplexere Konfigurationen gibt es einen Warteschlangenbaum (HTB-Bäume). </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de420117/">https://habr.com/ru/post/de420117/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de420107/index.html">Typegramm - Zen Blog Plattform</a></li>
<li><a href="../de420109/index.html">Elon Musk sagte, das Unternehmen könne an private Investoren verkauft werden. Es stellte sich heraus, dass es sich um einen saudischen Fonds handelte</a></li>
<li><a href="../de420111/index.html">Von Null bis zum Helden "Aktionen bei Google": Ihr Code</a></li>
<li><a href="../de420113/index.html">Die Legende vom Machtrahmen</a></li>
<li><a href="../de420115/index.html">UE4 | Ausrüstung für den Mehrspielermodus # 4 | Erstellen und Verbinden eines Containers</a></li>
<li><a href="../de420119/index.html">10 Python-Webframeworks, mit denen es sich zu arbeiten lohnt, 2018</a></li>
<li><a href="../de420121/index.html">Festigkeitstest: Termite LT450, LXI</a></li>
<li><a href="../de420123/index.html">Was ist Node.js wirklich?</a></li>
<li><a href="../de420125/index.html">Automatisierung im Finanzwesen: Bankangestellte können aufgrund von Robotern arbeitslos bleiben</a></li>
<li><a href="../de420129/index.html">Asyncio Coroutine Muster: draußen warten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>