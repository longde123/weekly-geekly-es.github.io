<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè¥‚Äç‚ò†Ô∏è üë¥üèº üï• Un article sur la fa√ßon dont CommVault sauvegarde PostgreSQL ü§òüèø üë®‚Äçüë®‚Äçüë¶‚Äçüë¶ üëÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, nous passerons en revue notre exp√©rience de l'utilisation des sauvegardes CommVault pour PostgreSQL. Pour ce faire, nous analyserons...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un article sur la fa√ßon dont CommVault sauvegarde PostgreSQL</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/softline/blog/442760/">  Dans cet article, nous passerons en revue notre exp√©rience de l'utilisation des sauvegardes CommVault pour PostgreSQL.  Pour ce faire, nous analyserons une petite partie de l'un de nos projets pass√©s, o√π nous avons mis en place une sauvegarde de la base de donn√©es PostgreSQL depuis le client. <br><br><img src="https://habrastorage.org/webt/zl/io/gr/zliogravp0udjmycafd9nm6yrow.jpeg"><a name="habracut"></a><br><br><h4>  <font color="#2e74b5">√Ä propos de CommVault</font> </h4><br>  CommVault est une plate-forme √©volutive unique qui offre une protection int√©gr√©e des donn√©es et une gestion de contenu.  La plate-forme prend en charge des modules logiciels avec des fonctions de sauvegarde et de restauration des donn√©es, leur archivage, d√©duplication, r√©plication, distribution hi√©rarchique des supports et cryptage.  Les modules de la plate-forme fonctionnent avec du contenu d'entreprise provenant de diverses sources et fournissent une r√©cup√©ration compl√®te des informations dans l'environnement d'entreprise et sa disponibilit√© constante m√™me √† partir des archives gr√¢ce √† une indexation intelligente unique des documents dans un r√©f√©rentiel virtuel.  La plateforme est √©galement √©quip√©e d'outils d'analyse avanc√©s qui g√©n√®rent des rapports sur les actions des utilisateurs et des applications et sur le fonctionnement de l'infrastructure. <br><br>  CommVault prot√®ge, restaure et g√®re les donn√©es et leur acc√®s dans des environnements physiques et virtuels. <br><br><h4>  <font color="#2e74b5">√Ä propos de la sauvegarde PostgreSQL</font> </h4><br>  Pour effectuer une sauvegarde de la base de donn√©es PostgreSQL, un agent (iDataAgent) est utilis√©, qui est install√© sur le serveur sur lequel la base de donn√©es s'ex√©cute.  L'agent est con√ßu pour g√©rer et prot√©ger efficacement les donn√©es commerciales importantes dans les bases de donn√©es PostgreSQL.  Vous pouvez utiliser cet agent pour sauvegarder et restaurer l'int√©gralit√© du serveur PostgreSQL ou des bases de donn√©es individuelles.  Si n√©cessaire, vous pouvez √©galement restaurer des tables individuelles. <br><br><h4>  <font color="#2e74b5">Caract√©ristiques cl√©s:</font> </h4><br>  PostgreSQL iDataAgent offre la flexibilit√© de sauvegarder des bases de donn√©es dans diff√©rents modes et de les restaurer en un minimum de temps.  Vous pouvez sauvegarder ou sauvegarder l'int√©gralit√© du serveur PostgreSQL, des bases de donn√©es individuelles ou des journaux archiv√©s √† tout moment. <br><br>  Les fonctionnalit√©s de sauvegarde et de restauration qui peuvent √™tre effectu√©es dans diff√©rents modes: <br><br><ul><li>  iDataAgent offre la possibilit√© de restaurer l'int√©gralit√© du serveur PostgreSQL.  Toutes les bases de donn√©es situ√©es sur le serveur source peuvent √™tre restaur√©es sur le serveur de destination. </li><li>  D√©finissez une base de donn√©es unique ou un groupe de bases de donn√©es en tant que donn√©es de sous-client et sauvegardez et restaurez. </li><li>  Sauvegardez uniquement les journaux sur le serveur PostgreSQL.  Ces fichiers journaux peuvent √™tre utilis√©s pour r√©cup√©rer les transactions de base de donn√©es perdues en raison d'un syst√®me d'exploitation ou d'une panne de disque. </li><li>  Restaurez l'int√©gralit√© de votre serveur PostgreSQL √† un moment pr√©cis pour la sauvegarde bas√©e sur le syst√®me de fichiers. </li><li>  Affichez et v√©rifiez l'√©tat des op√©rations de sauvegarde et de r√©cup√©ration √† partir de Job Controller et Event Viewer dans la console CommCell.  Suivez l'√©tat de votre travail avec des rapports que vous pouvez enregistrer et distribuer. </li><li>  Utilisez des sauvegardes de niveau bloc comme un moyen plus rapide de sauvegarder des donn√©es, car les sauvegardes sont uniquement pour les extensions (ou les parties modifi√©es de la base de donn√©es) et non pour la base de donn√©es PostgreSQL enti√®re. </li><li>  D√©duplication au niveau du bloc  La d√©duplication offre un moyen plus intelligent de stocker des donn√©es en identifiant et en supprimant les doublons dans les op√©rations de protection des donn√©es. </li></ul><br>
<h4>  <font color="#2e74b5">L'architecture</font> </h4><br>  <font color="#2e74b5"><b>Sch√©ma</b></font> <br><br><img src="https://habrastorage.org/webt/ys/ji/ct/ysjict_mkf-7kcsciptlw7du77y.png"><br><br>  <font color="#2e74b5"><b>Comment √ßa marche:</b></font> <br><br>  La plate-forme CommVault est d√©ploy√©e sur le r√©seau en tant que partie du serveur de gestion CommServe et d'un serveur MediaAgent distinct (il est recommand√© d'utiliser un serveur physique). <br><br>  Un agent (iDataAgent) est install√© sur le serveur avec la base de donn√©es PostgreSQL et ses politiques de sauvegarde sont configur√©es conform√©ment aux exigences.  iDataAgent collecte les donn√©es n√©cessaires, les compresse, les d√©doublonne, si n√©cessaire, les chiffre et les transf√®re √† MediaAgent. <br><br>  De plus, les donn√©es sont plac√©es sur le syst√®me de stockage, sur une bandoth√®que ou sur un stockage cloud. <br>  Pour la r√©cup√©ration, les donn√©es sont extraites du stockage et copi√©es sur le serveur avec PostgreSQL. <br><br>  <font color="#2e74b5"><b>Configuration dans la console CommVault</b></font> <br><br>  Voyons maintenant comment proc√©der dans la console de gestion. <br><br>  1. Pour d√©marrer la sauvegarde de la base de donn√©es pour le moment, s√©lectionnez dans la console du navigateur CommCell: <br><br>  Ordinateurs clients |  |  PostgreSQL |  |  DumpBasedBackupSet. <br><br>  Cliquez avec le bouton droit sur le dossier <b>par d√©faut</b> dans le <b>sous</b> - <b>client</b> et s√©lectionnez <b>Sauvegarder</b> . <br><br><img src="https://habrastorage.org/webt/q5/nm/uj/q5nmujdizcusqcmygdyfz_5xdtq.png"><br><br>  2. S√©lectionnez <b>Compl√®te</b> comme type de sauvegarde et s√©lectionnez <b>Imm√©diat</b> . <br><br>  3. Cliquez sur <b>OK</b> .  <b>La</b> sauvegarde <b>PostgreSQL d√©marre</b> . <br><br><img src="https://habrastorage.org/webt/zi/cn/ea/zicneazi3vlxtzvxq0nlth7whda.png"><br><br>  4. Pendant l'ex√©cution du travail, son √©tat peut √™tre surveill√© par la fen√™tre de <b>travail de la</b> console <b>CommCell</b> . <br><br><img src="https://habrastorage.org/webt/dp/wm/cl/dpwmcly1yjwuwkdthl5fdg8kom4.png"><br><br>  5. Une fois la t√¢che termin√©e, vous pouvez voir les d√©tails de la t√¢che termin√©e dans la fen√™tre <b>Historique de sauvegarde</b> .  S√©lectionnez le dossier <b>par d√©faut</b> dans le <b>sous</b> - <b>client</b> et s√©lectionnez <b>Historique de sauvegarde</b> . <br><br><img src="https://habrastorage.org/webt/f8/ye/ju/f8yeju8l0lihgvro3kowl5ntgza.png"><br><br>  6. Dans la fen√™tre <b>Historique de sauvegarde</b> , vous pouvez voir les donn√©es suivantes sur les t√¢ches termin√©es: <br><br>  - Erreurs de sauvegarde lors de l'ach√®vement d'une t√¢che; <br>  - √âl√©ments sauvegard√©s avec succ√®s; <br>  - D√©tails de la mission; <br>  - √âv√©nements; <br>  - Fichiers journaux; <br>  - M√©dia sur lequel les donn√©es sont stock√©es. <br><br>  <font color="#2e74b5"><b>Pourquoi vous pouvez sauvegarder</b></font> <br><br>  Sauvegarde bas√©e sur le vidage: <br><br><ul><li>  Bases de donn√©es syst√®me PostgreSQL; </li><li>  Bases de donn√©es utilisateurs PostgreSQL </li><li>  Sauvegarde d'un syst√®me de fichiers (sauvegarde bas√©e sur un syst√®me de fichiers). </li></ul><br>  Bases de donn√©es PostgreSQL (donn√©es et journaux) (donn√©es et journaux): <br><br><ul><li>  Fichiers journaux. </li></ul><br>  Ce qui n'est pas copi√©: <br><br><ul><li>  Fichiers d'application PostgreSQL (fichiers d'application); </li><li>  Donn√©es du syst√®me d'exploitation. </li></ul><br>  Utilisez File System iDataAgent pour sauvegarder les composants ci-dessus. <br><br><h4>  <font color="#2e74b5">D√©fi</font> </h4><br>  Le client devait d√©ployer la plateforme CommVault pour sauvegarder ses services.  L'un des services √©tait la base de donn√©es PostgreSQL, qui a √©t√© d√©ploy√©e dans une configuration en cluster de 2 n≈ìuds: Master et Standby.  Les deux fonctionnaient sur des serveurs physiques. <br><br>  <font color="#2e74b5"><b>Fonctionnalit√©s de configuration du client PostgreSQL</b></font> <br><br>  La configuration du cluster PostgreSQL a √©t√© choisie pour garantir la tol√©rance aux pannes du serveur de base de donn√©es. <br><br>  Le client a effectu√© la sauvegarde de la base de donn√©es PostgreSQL √† l'aide de pg_dump. <br><br>  Le sch√©ma de travail est pr√©sent√© dans la figure ci-dessous: <br><br><img src="https://habrastorage.org/webt/2q/cw/li/2qcwlitdhowursvmsnpc4jak7ec.png"><br><br><h4>  <font color="#2e74b5">Configurer la sauvegarde avec CommVault</font> </h4><br>  Pour unifier la plate-forme de sauvegarde et profiter du stockage de sauvegarde, nous avons d√©cid√© d'utiliser CommVault pour sauvegarder la base de donn√©es PostgreSQL. <br><br>  Parce que  le client a utilis√© la configuration du cluster PostgreSQL, pour la sauvegarde, nous avons d√©cid√© d'utiliser l'option de sauvegarde bas√©e sur le syst√®me de fichiers pour la sauvegarde de fichiers.  Dans le m√™me temps, j'ai d√ª abandonner l'utilisation de la sauvegarde par blocs (Block Level Backup), car  La version du noyau Linux utilis√©e sur laquelle PostgreSQL est d√©ploy√© est sup√©rieure √† celle de CommVault officiellement prise en charge.  En raison du fait que le service est essentiel pour l'organisation, ils ont d√©cid√© de faire un calendrier de sauvegarde selon le tableau: <br><table><tbody><tr><th><br></th><th>  Copie compl√®te <br></th><th>  Journaux des transactions <br></th></tr><tr><td>  Graphique <br></td><td>  Une fois par jour, √† 23 heures <br></td><td>  Toutes les heures pendant 24 heures </td></tr><tr><td>  Dur√©e de conservation des copies <br></td><td>  7 jours <br></td><td>  1 jour <br></td></tr></tbody></table><br>  Le volume total de la base de donn√©es √©tait sup√©rieur √† 1,5 To et afin de respecter les RTO et RPO requis, un r√©seau LAN distinct a √©t√© utilis√© pour la sauvegarde √† une vitesse de 10 Gb / s. <br><br>  La sauvegarde a √©t√© effectu√©e selon le sch√©ma ci-dessous: <br><br><img src="https://habrastorage.org/webt/b4/j-/mv/b4j-mvywwwqd0c8_1qpr9rg6-hq.png"><br><br>  Les sauvegardes ont √©t√© prises √† partir d'un serveur de secours PostgreSQL et stock√©es sur un serveur sur lequel MediaAgent est install√©.  Ensuite, une fois par mois, des copies compl√®tes ont √©t√© t√©l√©charg√©es sur le cloud Amazon pour une dur√©e de conservation d'un an. <br><br>  Tous les param√®tres n√©cessaires ont √©t√© d√©finis et la sauvegarde a r√©ussi. <br><br>  <font color="#2e74b5"><b>Fonctionnalit√©s de configuration de la sauvegarde PostgreSQL</b></font> <br><br>  Lors de l'installation et de la configuration de la sauvegarde, nous avons rencontr√© quelques difficult√©s, qui sont r√©pertori√©es ci-dessous.  Je pense qu'il sera utile de prendre en compte ces fonctionnalit√©s lors de l'ex√©cution de projets similaires et lors de la configuration des administrateurs de base de donn√©es PostgreSQL. <br><br><ol><li>  V√©rifiez que les n≈ìuds ma√Ætre et de secours ont les m√™mes param√®tres de service PostgreSQL d√©finis conform√©ment √† la documentation CommVault: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation.commvault.com/commvault/v11_sp14/article?p=21491.htm</a> </li><li>  V√©rifiez que les param√®tres sp√©cifi√©s dans le d√©pannage de sauvegarde sont coh√©rents avec ceux sp√©cifi√©s par les liens: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation.commvault.com/commvault/v11_sp14/article?p=21723.htm</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation.commvault.com/commvault/v11_sp14/article?p=21518.htm</a> </li><li>  Assurez-vous que les droits d'acc√®s au serveur de base de donn√©es et aux bases de donn√©es ont √©t√© d√©finis conform√©ment aux exigences suivantes: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation.commvault.com/commvault/v11_sp14/article?p=21523.htm</a> </li></ol><br>  <font color="#2e74b5"><b>R√©cup√©ration</b></font> <br><br>  La sauvegarde est bonne.  Naturellement, nous nous int√©ressons non seulement au processus de sa cr√©ation, mais aussi √† sa restauration.  Pour tout ce qui a √©t√© fait. <br><br>  Dans cette situation, la restauration, bas√©e sur notre exp√©rience, peut √™tre n√©cessaire pour le client dans 2 cas: <br><br><ol><li>  Restaurer la base de donn√©es √† un certain moment afin d'acc√©der √† des donn√©es qui, par exemple, pourraient √™tre supprim√©es de la base de donn√©es; </li><li>  En cas de perte de l'ensemble du cluster de base de donn√©es PostgreSQL. </li></ol><br>  Pour restaurer la base de donn√©es, lisez simplement la documentation √† ce lien: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation.commvault.com/commvault/v11_sp14/article?p=21502.htm</a> <br><br>  Nous attirons √©galement votre attention sur les fonctionnalit√©s et √©tapes suivantes lors de la r√©cup√©ration: <br><br><ol><li>  Suivez TOUJOURS la proc√©dure de r√©cup√©ration avec le DBA PostgreSQL.  Cela vous aidera √† √©viter les mauvaises actions et √† r√©soudre rapidement les probl√®mes qui surviennent pendant le processus de r√©cup√©ration; </li><li>  La r√©cup√©ration doit √™tre effectu√©e sur un n≈ìud ayant le r√¥le de ma√Ætre; </li><li>  Lors de la restauration, assurez-vous de v√©rifier que les services PostgreSQL ne d√©marrent pas une fois l'op√©ration termin√©e; </li><li>  Dans le n≈ìud restaur√©, modifiez les param√®tres en r√¥le ma√Ætre, car  dans notre cas, nous avons sauvegard√© les n≈ìuds de secours; </li><li>  D√©sactivez les services sur le n≈ìud de secours, activez-les sur le n≈ìud ma√Ætre, puis activez le n≈ìud de secours et configurez √† nouveau la r√©plication. </li></ol><br><h4>  <font color="#2e74b5">Conclusion</font> </h4><br>  Dans cet article, nous n'avons pas pris en compte la sauvegarde du syst√®me d'exploitation Linux lui-m√™me et des autres syst√®mes.  Cela devrait √™tre fait s√©par√©ment.  La documentation CommVault d√©crit cela en d√©tail.  Si notre article suscite l'int√©r√™t et que les souhaits sont nombreux, nous d√©crirons certainement comment sauvegarder d'autres syst√®mes.  √âcrivez dans les commentaires quels syst√®mes pourraient vous int√©resser. <br><br>  Nous esp√©rons que notre exp√©rience vous aidera √† mettre en place une sauvegarde par le DBA PostgreSQL. <br><br>  Auteurs: <br>  Sergey Alexandrov, chef du groupe de sauvegarde, Softline <br>  Artyom Khmelenko, ing√©nieur en chef, Softline </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr442760/">https://habr.com/ru/post/fr442760/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr442746/index.html">Fool App pour le Windows Store</a></li>
<li><a href="../fr442748/index.html">La chose √† propos du chapeau: les 10 meilleurs rapports de Heisenbug 2018 Moscou</a></li>
<li><a href="../fr442750/index.html">Djinn virtuel le 8 mars - ou comment surprendre vos employ√©s un jour de printemps</a></li>
<li><a href="../fr442754/index.html">Fonctionnement vs bases de donn√©es analytiques: stockage colonne vs stockage</a></li>
<li><a href="../fr442758/index.html">5 astuces pour optimiser les requ√™tes SQL dans Greenplum</a></li>
<li><a href="../fr442762/index.html">Stagiaire Vasya et ses histoires sur l'API idempotency</a></li>
<li><a href="../fr442764/index.html">Recueil sur la gestion des produits. Ce qui excite les produits et les sp√©cialistes du marketing en 2019</a></li>
<li><a href="../fr442770/index.html">Pr√©sentation des scanners de codes-barres JavaScript</a></li>
<li><a href="../fr442772/index.html">Math√©matiques pour Data Scientist: Sections n√©cessaires</a></li>
<li><a href="../fr442776/index.html">Index dans PostgreSQL - 3 (Hash)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>