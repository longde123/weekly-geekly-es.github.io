<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏴‍☠️ 👴🏼 🕥 Un article sur la façon dont CommVault sauvegarde PostgreSQL 🤘🏿 👨‍👨‍👦‍👦 👀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, nous passerons en revue notre expérience de l'utilisation des sauvegardes CommVault pour PostgreSQL. Pour ce faire, nous analyserons...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un article sur la façon dont CommVault sauvegarde PostgreSQL</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/softline/blog/442760/">  Dans cet article, nous passerons en revue notre expérience de l'utilisation des sauvegardes CommVault pour PostgreSQL.  Pour ce faire, nous analyserons une petite partie de l'un de nos projets passés, où nous avons mis en place une sauvegarde de la base de données PostgreSQL depuis le client. <br><br><img src="https://habrastorage.org/webt/zl/io/gr/zliogravp0udjmycafd9nm6yrow.jpeg"><a name="habracut"></a><br><br><h4>  <font color="#2e74b5">À propos de CommVault</font> </h4><br>  CommVault est une plate-forme évolutive unique qui offre une protection intégrée des données et une gestion de contenu.  La plate-forme prend en charge des modules logiciels avec des fonctions de sauvegarde et de restauration des données, leur archivage, déduplication, réplication, distribution hiérarchique des supports et cryptage.  Les modules de la plate-forme fonctionnent avec du contenu d'entreprise provenant de diverses sources et fournissent une récupération complète des informations dans l'environnement d'entreprise et sa disponibilité constante même à partir des archives grâce à une indexation intelligente unique des documents dans un référentiel virtuel.  La plateforme est également équipée d'outils d'analyse avancés qui génèrent des rapports sur les actions des utilisateurs et des applications et sur le fonctionnement de l'infrastructure. <br><br>  CommVault protège, restaure et gère les données et leur accès dans des environnements physiques et virtuels. <br><br><h4>  <font color="#2e74b5">À propos de la sauvegarde PostgreSQL</font> </h4><br>  Pour effectuer une sauvegarde de la base de données PostgreSQL, un agent (iDataAgent) est utilisé, qui est installé sur le serveur sur lequel la base de données s'exécute.  L'agent est conçu pour gérer et protéger efficacement les données commerciales importantes dans les bases de données PostgreSQL.  Vous pouvez utiliser cet agent pour sauvegarder et restaurer l'intégralité du serveur PostgreSQL ou des bases de données individuelles.  Si nécessaire, vous pouvez également restaurer des tables individuelles. <br><br><h4>  <font color="#2e74b5">Caractéristiques clés:</font> </h4><br>  PostgreSQL iDataAgent offre la flexibilité de sauvegarder des bases de données dans différents modes et de les restaurer en un minimum de temps.  Vous pouvez sauvegarder ou sauvegarder l'intégralité du serveur PostgreSQL, des bases de données individuelles ou des journaux archivés à tout moment. <br><br>  Les fonctionnalités de sauvegarde et de restauration qui peuvent être effectuées dans différents modes: <br><br><ul><li>  iDataAgent offre la possibilité de restaurer l'intégralité du serveur PostgreSQL.  Toutes les bases de données situées sur le serveur source peuvent être restaurées sur le serveur de destination. </li><li>  Définissez une base de données unique ou un groupe de bases de données en tant que données de sous-client et sauvegardez et restaurez. </li><li>  Sauvegardez uniquement les journaux sur le serveur PostgreSQL.  Ces fichiers journaux peuvent être utilisés pour récupérer les transactions de base de données perdues en raison d'un système d'exploitation ou d'une panne de disque. </li><li>  Restaurez l'intégralité de votre serveur PostgreSQL à un moment précis pour la sauvegarde basée sur le système de fichiers. </li><li>  Affichez et vérifiez l'état des opérations de sauvegarde et de récupération à partir de Job Controller et Event Viewer dans la console CommCell.  Suivez l'état de votre travail avec des rapports que vous pouvez enregistrer et distribuer. </li><li>  Utilisez des sauvegardes de niveau bloc comme un moyen plus rapide de sauvegarder des données, car les sauvegardes sont uniquement pour les extensions (ou les parties modifiées de la base de données) et non pour la base de données PostgreSQL entière. </li><li>  Déduplication au niveau du bloc  La déduplication offre un moyen plus intelligent de stocker des données en identifiant et en supprimant les doublons dans les opérations de protection des données. </li></ul><br>
<h4>  <font color="#2e74b5">L'architecture</font> </h4><br>  <font color="#2e74b5"><b>Schéma</b></font> <br><br><img src="https://habrastorage.org/webt/ys/ji/ct/ysjict_mkf-7kcsciptlw7du77y.png"><br><br>  <font color="#2e74b5"><b>Comment ça marche:</b></font> <br><br>  La plate-forme CommVault est déployée sur le réseau en tant que partie du serveur de gestion CommServe et d'un serveur MediaAgent distinct (il est recommandé d'utiliser un serveur physique). <br><br>  Un agent (iDataAgent) est installé sur le serveur avec la base de données PostgreSQL et ses politiques de sauvegarde sont configurées conformément aux exigences.  iDataAgent collecte les données nécessaires, les compresse, les dédoublonne, si nécessaire, les chiffre et les transfère à MediaAgent. <br><br>  De plus, les données sont placées sur le système de stockage, sur une bandothèque ou sur un stockage cloud. <br>  Pour la récupération, les données sont extraites du stockage et copiées sur le serveur avec PostgreSQL. <br><br>  <font color="#2e74b5"><b>Configuration dans la console CommVault</b></font> <br><br>  Voyons maintenant comment procéder dans la console de gestion. <br><br>  1. Pour démarrer la sauvegarde de la base de données pour le moment, sélectionnez dans la console du navigateur CommCell: <br><br>  Ordinateurs clients |  |  PostgreSQL |  |  DumpBasedBackupSet. <br><br>  Cliquez avec le bouton droit sur le dossier <b>par défaut</b> dans le <b>sous</b> - <b>client</b> et sélectionnez <b>Sauvegarder</b> . <br><br><img src="https://habrastorage.org/webt/q5/nm/uj/q5nmujdizcusqcmygdyfz_5xdtq.png"><br><br>  2. Sélectionnez <b>Complète</b> comme type de sauvegarde et sélectionnez <b>Immédiat</b> . <br><br>  3. Cliquez sur <b>OK</b> .  <b>La</b> sauvegarde <b>PostgreSQL démarre</b> . <br><br><img src="https://habrastorage.org/webt/zi/cn/ea/zicneazi3vlxtzvxq0nlth7whda.png"><br><br>  4. Pendant l'exécution du travail, son état peut être surveillé par la fenêtre de <b>travail de la</b> console <b>CommCell</b> . <br><br><img src="https://habrastorage.org/webt/dp/wm/cl/dpwmcly1yjwuwkdthl5fdg8kom4.png"><br><br>  5. Une fois la tâche terminée, vous pouvez voir les détails de la tâche terminée dans la fenêtre <b>Historique de sauvegarde</b> .  Sélectionnez le dossier <b>par défaut</b> dans le <b>sous</b> - <b>client</b> et sélectionnez <b>Historique de sauvegarde</b> . <br><br><img src="https://habrastorage.org/webt/f8/ye/ju/f8yeju8l0lihgvro3kowl5ntgza.png"><br><br>  6. Dans la fenêtre <b>Historique de sauvegarde</b> , vous pouvez voir les données suivantes sur les tâches terminées: <br><br>  - Erreurs de sauvegarde lors de l'achèvement d'une tâche; <br>  - Éléments sauvegardés avec succès; <br>  - Détails de la mission; <br>  - Événements; <br>  - Fichiers journaux; <br>  - Média sur lequel les données sont stockées. <br><br>  <font color="#2e74b5"><b>Pourquoi vous pouvez sauvegarder</b></font> <br><br>  Sauvegarde basée sur le vidage: <br><br><ul><li>  Bases de données système PostgreSQL; </li><li>  Bases de données utilisateurs PostgreSQL </li><li>  Sauvegarde d'un système de fichiers (sauvegarde basée sur un système de fichiers). </li></ul><br>  Bases de données PostgreSQL (données et journaux) (données et journaux): <br><br><ul><li>  Fichiers journaux. </li></ul><br>  Ce qui n'est pas copié: <br><br><ul><li>  Fichiers d'application PostgreSQL (fichiers d'application); </li><li>  Données du système d'exploitation. </li></ul><br>  Utilisez File System iDataAgent pour sauvegarder les composants ci-dessus. <br><br><h4>  <font color="#2e74b5">Défi</font> </h4><br>  Le client devait déployer la plateforme CommVault pour sauvegarder ses services.  L'un des services était la base de données PostgreSQL, qui a été déployée dans une configuration en cluster de 2 nœuds: Master et Standby.  Les deux fonctionnaient sur des serveurs physiques. <br><br>  <font color="#2e74b5"><b>Fonctionnalités de configuration du client PostgreSQL</b></font> <br><br>  La configuration du cluster PostgreSQL a été choisie pour garantir la tolérance aux pannes du serveur de base de données. <br><br>  Le client a effectué la sauvegarde de la base de données PostgreSQL à l'aide de pg_dump. <br><br>  Le schéma de travail est présenté dans la figure ci-dessous: <br><br><img src="https://habrastorage.org/webt/2q/cw/li/2qcwlitdhowursvmsnpc4jak7ec.png"><br><br><h4>  <font color="#2e74b5">Configurer la sauvegarde avec CommVault</font> </h4><br>  Pour unifier la plate-forme de sauvegarde et profiter du stockage de sauvegarde, nous avons décidé d'utiliser CommVault pour sauvegarder la base de données PostgreSQL. <br><br>  Parce que  le client a utilisé la configuration du cluster PostgreSQL, pour la sauvegarde, nous avons décidé d'utiliser l'option de sauvegarde basée sur le système de fichiers pour la sauvegarde de fichiers.  Dans le même temps, j'ai dû abandonner l'utilisation de la sauvegarde par blocs (Block Level Backup), car  La version du noyau Linux utilisée sur laquelle PostgreSQL est déployé est supérieure à celle de CommVault officiellement prise en charge.  En raison du fait que le service est essentiel pour l'organisation, ils ont décidé de faire un calendrier de sauvegarde selon le tableau: <br><table><tbody><tr><th><br></th><th>  Copie complète <br></th><th>  Journaux des transactions <br></th></tr><tr><td>  Graphique <br></td><td>  Une fois par jour, à 23 heures <br></td><td>  Toutes les heures pendant 24 heures </td></tr><tr><td>  Durée de conservation des copies <br></td><td>  7 jours <br></td><td>  1 jour <br></td></tr></tbody></table><br>  Le volume total de la base de données était supérieur à 1,5 To et afin de respecter les RTO et RPO requis, un réseau LAN distinct a été utilisé pour la sauvegarde à une vitesse de 10 Gb / s. <br><br>  La sauvegarde a été effectuée selon le schéma ci-dessous: <br><br><img src="https://habrastorage.org/webt/b4/j-/mv/b4j-mvywwwqd0c8_1qpr9rg6-hq.png"><br><br>  Les sauvegardes ont été prises à partir d'un serveur de secours PostgreSQL et stockées sur un serveur sur lequel MediaAgent est installé.  Ensuite, une fois par mois, des copies complètes ont été téléchargées sur le cloud Amazon pour une durée de conservation d'un an. <br><br>  Tous les paramètres nécessaires ont été définis et la sauvegarde a réussi. <br><br>  <font color="#2e74b5"><b>Fonctionnalités de configuration de la sauvegarde PostgreSQL</b></font> <br><br>  Lors de l'installation et de la configuration de la sauvegarde, nous avons rencontré quelques difficultés, qui sont répertoriées ci-dessous.  Je pense qu'il sera utile de prendre en compte ces fonctionnalités lors de l'exécution de projets similaires et lors de la configuration des administrateurs de base de données PostgreSQL. <br><br><ol><li>  Vérifiez que les nœuds maître et de secours ont les mêmes paramètres de service PostgreSQL définis conformément à la documentation CommVault: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation.commvault.com/commvault/v11_sp14/article?p=21491.htm</a> </li><li>  Vérifiez que les paramètres spécifiés dans le dépannage de sauvegarde sont cohérents avec ceux spécifiés par les liens: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation.commvault.com/commvault/v11_sp14/article?p=21723.htm</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation.commvault.com/commvault/v11_sp14/article?p=21518.htm</a> </li><li>  Assurez-vous que les droits d'accès au serveur de base de données et aux bases de données ont été définis conformément aux exigences suivantes: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation.commvault.com/commvault/v11_sp14/article?p=21523.htm</a> </li></ol><br>  <font color="#2e74b5"><b>Récupération</b></font> <br><br>  La sauvegarde est bonne.  Naturellement, nous nous intéressons non seulement au processus de sa création, mais aussi à sa restauration.  Pour tout ce qui a été fait. <br><br>  Dans cette situation, la restauration, basée sur notre expérience, peut être nécessaire pour le client dans 2 cas: <br><br><ol><li>  Restaurer la base de données à un certain moment afin d'accéder à des données qui, par exemple, pourraient être supprimées de la base de données; </li><li>  En cas de perte de l'ensemble du cluster de base de données PostgreSQL. </li></ol><br>  Pour restaurer la base de données, lisez simplement la documentation à ce lien: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation.commvault.com/commvault/v11_sp14/article?p=21502.htm</a> <br><br>  Nous attirons également votre attention sur les fonctionnalités et étapes suivantes lors de la récupération: <br><br><ol><li>  Suivez TOUJOURS la procédure de récupération avec le DBA PostgreSQL.  Cela vous aidera à éviter les mauvaises actions et à résoudre rapidement les problèmes qui surviennent pendant le processus de récupération; </li><li>  La récupération doit être effectuée sur un nœud ayant le rôle de maître; </li><li>  Lors de la restauration, assurez-vous de vérifier que les services PostgreSQL ne démarrent pas une fois l'opération terminée; </li><li>  Dans le nœud restauré, modifiez les paramètres en rôle maître, car  dans notre cas, nous avons sauvegardé les nœuds de secours; </li><li>  Désactivez les services sur le nœud de secours, activez-les sur le nœud maître, puis activez le nœud de secours et configurez à nouveau la réplication. </li></ol><br><h4>  <font color="#2e74b5">Conclusion</font> </h4><br>  Dans cet article, nous n'avons pas pris en compte la sauvegarde du système d'exploitation Linux lui-même et des autres systèmes.  Cela devrait être fait séparément.  La documentation CommVault décrit cela en détail.  Si notre article suscite l'intérêt et que les souhaits sont nombreux, nous décrirons certainement comment sauvegarder d'autres systèmes.  Écrivez dans les commentaires quels systèmes pourraient vous intéresser. <br><br>  Nous espérons que notre expérience vous aidera à mettre en place une sauvegarde par le DBA PostgreSQL. <br><br>  Auteurs: <br>  Sergey Alexandrov, chef du groupe de sauvegarde, Softline <br>  Artyom Khmelenko, ingénieur en chef, Softline </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr442760/">https://habr.com/ru/post/fr442760/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr442746/index.html">Fool App pour le Windows Store</a></li>
<li><a href="../fr442748/index.html">La chose à propos du chapeau: les 10 meilleurs rapports de Heisenbug 2018 Moscou</a></li>
<li><a href="../fr442750/index.html">Djinn virtuel le 8 mars - ou comment surprendre vos employés un jour de printemps</a></li>
<li><a href="../fr442754/index.html">Fonctionnement vs bases de données analytiques: stockage colonne vs stockage</a></li>
<li><a href="../fr442758/index.html">5 astuces pour optimiser les requêtes SQL dans Greenplum</a></li>
<li><a href="../fr442762/index.html">Stagiaire Vasya et ses histoires sur l'API idempotency</a></li>
<li><a href="../fr442764/index.html">Recueil sur la gestion des produits. Ce qui excite les produits et les spécialistes du marketing en 2019</a></li>
<li><a href="../fr442770/index.html">Présentation des scanners de codes-barres JavaScript</a></li>
<li><a href="../fr442772/index.html">Mathématiques pour Data Scientist: Sections nécessaires</a></li>
<li><a href="../fr442776/index.html">Index dans PostgreSQL - 3 (Hash)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>