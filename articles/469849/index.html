<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåè ü§∂ üßîüèæ El juego "Attack 51%": escribir un juego simple e independiente en la plataforma Obyte üíë üöç üë©üèª‚Äçü§ù‚Äçüë®üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En el √∫ltimo art√≠culo "Agentes aut√≥nomos" o cuando ejecutamos el c√≥digo en la criptoplataforma abierta Obyte, hablamos sobre qu√© son los Agentes aut√≥n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>El juego "Attack 51%": escribir un juego simple e independiente en la plataforma Obyte</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/obyte/blog/469849/"><img src="https://habrastorage.org/webt/zi/a-/kz/zia-kzq-ohjjej4uyjlwt7md-ga.gif"><br><br>  En el √∫ltimo art√≠culo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Agentes aut√≥nomos" o cuando ejecutamos el c√≥digo en la criptoplataforma abierta Obyte,</a> hablamos sobre qu√© son los Agentes aut√≥nomos y los comparamos con los contratos inteligentes de Ethereum.  Ahora escribamos nuestro primer Agente Aut√≥nomo (AA) usando el ejemplo de 51% de ataque.  Y al final del art√≠culo, analizaremos formas de mejorarlo: c√≥mo proteger a los jugadores de la p√©rdida / p√©rdida de fondos y c√≥mo mejorar el algoritmo para reducir el efecto de las "ballenas" con grandes dep√≥sitos en el resultado del juego. <br><a name="habracut"></a><br>  Los originales de ambos agentes independientes siempre est√°n disponibles en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">editor de c√≥digo Oscript</a> en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">l√≠nea</a> en forma de plantillas, solo selecci√≥nelos en el men√∫ desplegable: <i>"Juego de ataque del 51%"</i> y <i>"Proxy de recaudaci√≥n de fondos".</i> <br><br>  Antes de comenzar a escribir AA en Oscript, le recomiendo leer la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Gu√≠a de inicio</a> <i>(eng)</i> en nuestra documentaci√≥n para familiarizarse r√°pidamente con los principios b√°sicos de la escritura de AA. <br><br><h2>  La esencia del juego </h2><br>  Varios equipos compiten simult√°neamente entre s√≠ por el derecho a recaudar todo el conjunto de fondos recaudados.  Los jugadores del equipo hacen dep√≥sitos, lo que aumenta la cantidad total del grupo.  El equipo que ha realizado dep√≥sitos de al menos el 51% de todos los fondos recaudados y mantenido como l√≠der durante al menos un d√≠a gana.  El grupo se distribuye entre los jugadores del equipo ganador en proporci√≥n a la contribuci√≥n realizada, por lo que cada participante puede potencialmente duplicar su inversi√≥n. <br><br>  Tan pronto como cualquiera de los equipos recolecta&gt; = 51% de todos los fondos, se declara previamente ganador y sus participantes ya no pueden realizar dep√≥sitos.  Pero todos los otros equipos tienen 24 horas para superar al equipo ganador.  Tan pronto como esto suceda, el equipo de adelantamiento se convierte en el ganador y el temporizador comienza la cuenta regresiva nuevamente. <br><br>  Nuestra implementaci√≥n emitir√° "acciones" a cada depositante a cambio de bytes, en una proporci√≥n de 1 a 1, que, si el equipo gana, el participante puede cambiar por una acci√≥n en el grupo ganado.  Las acciones son un activo en la plataforma Obyte, lanzadas espec√≠ficamente para cada equipo.  Ellos, como cualquier activo, pueden ser transferidos / intercambiados, vendiendo sus ganancias potenciales a otras personas.  El precio de la acci√≥n depender√° de que el mercado eval√∫e las posibilidades de ganar del equipo. <br><br>  Cualquiera puede crear un equipo.  El creador del equipo puede establecer una comisi√≥n por ganar, que se cobrar√° a cada miembro del equipo en caso de victoria. <br><br>  Tambi√©n aplicaremos el segundo AA en nuestro juego, en nombre del creador del equipo, que "financiar√° en masa" la cantidad necesaria, y solo si se logra (en nuestro ejemplo, cuando alcanza&gt; 51% del grupo de juego) enviar√° todos los fondos recaudados a la direcci√≥n AA juegos, de lo contrario el dinero puede ser devuelto libremente. <br><br><h2>  Escribir c√≥digo oscript </h2><br>  Perm√≠tame recordarle que el c√≥digo AA se llama cada vez que una transacci√≥n llega a la direcci√≥n de este AA, el llamado  desencadenar transacci√≥n.  En realidad, AA es un c√≥digo que, en respuesta a la entrada (datos en una transacci√≥n de activaci√≥n y el estado actual de AA, almacenado en variables de estado) genera salida (otra transacci√≥n de "respuesta") o cambia su estado.  Nuestra tarea es programar las reglas de respuesta de AA a los datos de entrada.  Cualquier transacci√≥n en Obyte es un conjunto de mensajes, la mayor√≠a de las veces son mensajes de "pago" o mensajes de "datos", etc. <br><br><h3>  Inicializaci√≥n </h3><br>  Primero, inicializamos nuestro AA.  El bloque init se llama cada vez que se inicia AA, desde el principio.  En √©l estableceremos constantes locales para un acceso m√°s conveniente a los valores. <br><br><pre><code class="javascript hljs">{     <span class="hljs-attr"><span class="hljs-attr">init</span></span>: <span class="hljs-string"><span class="hljs-string">`{         $team_creation_fee = 5000;         $challenging_period = 24*3600;         $bFinished = var['finished'];     }`</span></span>,     <span class="hljs-attr"><span class="hljs-attr">messages</span></span>: { <span class="hljs-attr"><span class="hljs-attr">cases</span></span>: [ ]     } }</code> </pre> <br>  Cadena <i>$ bFinished = var ['terminado'];</i>  lee la variable <i>terminada</i> del estado AA. <br>  La matriz de los mensajes resultantes estar√° enmarcada por los <i>casos:</i> bloque <i>{}</i> , que es similar al <i>interruptor</i> habitual <i>/ caso /</i> bloque <i>predeterminado</i> , en funci√≥n de las condiciones en los bloques secundarios, solo se seleccionar√° uno de los mensajes, o si no, <i>si los</i> bloques devuelven <i>verdadero</i> , ser√° √∫ltimo mensaje seleccionado. <br><br><h3>  Creamos un equipo </h3><br>  Entonces, el primer bloque procesar√° las transacciones para crear un nuevo comando: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// create a new team; any excess amount is sent back if: `{trigger.data.create_team AND !$bFinished}`, init: `{ if (var['team_' || trigger.address || '_asset']) bounce('you already have a team'); if (trigger.output[[asset=base]] &lt; $team_creation_fee) bounce('not enough to pay for team creation'); }`, messages: [ { app: 'asset', payload: { is_private: false, is_transferrable: true, auto_destroy: false, fixed_denominations: false, issued_by_definer_only: true, cosigned_by_definer: false, spender_attested: false } }, { app: 'payment', if: `{trigger.output[[asset=base]] &gt; $team_creation_fee}`, payload: { asset: 'base', outputs: [ {address: "{trigger.address}", amount: "{trigger.output[[asset=base]] - $team_creation_fee}"} ] } }, { app: 'state', state: `{ var['team_' || trigger.address || '_founder_tax'] = trigger.data.founder_tax otherwise 0; var['team_' || trigger.address || '_asset'] = response_unit; response['team_asset'] = response_unit; }` } ]</span></span></code> </pre> <br>  Como vemos, la condici√≥n para la ejecuci√≥n de este bloque es la primera en el bloque if y es una verificaci√≥n de que la transacci√≥n desencadenante contiene un mensaje con el tipo de datos ( <i>trigger.data.create_team</i> ), que tiene una clave llamada <i>create_team</i> y que el juego a√∫n no ha terminado ( <i>! $ bFinished</i> ).  La constante local <i>$ bFinished</i> es accesible desde cualquier parte del c√≥digo si se ha inicializado en el bloque init.  Si al menos algunas de estas condiciones no se cumplieran, entonces el bloque primario de casos simplemente continuar√≠a cumpli√©ndose y verificando las condiciones para los siguientes mensajes, omitiendo este. <br><br>  En el siguiente bloque de <i>inicio</i> , no inicializamos nada, pero verificamos las condiciones necesarias, sin las cuales la transacci√≥n desencadenante se considera err√≥nea: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>[<span class="hljs-string"><span class="hljs-string">'team_'</span></span> || trigger.address || <span class="hljs-string"><span class="hljs-string">'_asset'</span></span>]) bounce(<span class="hljs-string"><span class="hljs-string">'you already have a team'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (trigger.output[[asset=base]] &lt; $team_creation_fee) bounce(<span class="hljs-string"><span class="hljs-string">'not enough to pay for team creation'</span></span>);</code> </pre> <br>  Aqu√≠ concatenamos (usando ||) la cadena con la variable del activador de la transacci√≥n e intentamos averiguar si hay una variable llamada <i>'equipo_' ||</i>  <i>trigger.address ||</i>  <i>'_asset'</i> en nuestra historia de AA. <br><br>  La llamada <i>bounce ()</i> revierte cualquier cambio realizado en el momento actual y devuelve un error a la persona que llama. <br><br>  Observe tambi√©n c√≥mo se realiza la b√∫squeda dentro de la transacci√≥n desencadenante: <i>trigger.output [[asset = base]] est√°</i> buscando resultados con <i>asset == base</i> , que devolver√° la cantidad en bytes (activo base = bytes) que se especific√≥ en la transacci√≥n desencadenante.  Y si esta cantidad no es suficiente para crear un nuevo equipo, llamamos a bounce (), comiendo silenciosamente todos los bytes entrantes menos bounce_fee, que por defecto es de 10,000 bytes. <br><br>  A continuaci√≥n, comienza la mayor parte del c√≥digo de creaci√≥n de equipo.  Brevemente, el algoritmo es el siguiente: <br><br><ol><li>  El primer mensaje lanza un nuevo activo ( <i>aplicaci√≥n: 'activo'</i> ) <br></li><li>  El segundo mensaje devuelve todo lo que es m√°s que el n√∫mero requerido de bytes para crear el comando ( <i>aplicaci√≥n: 'pago'</i> ).  Echa un vistazo al bloque if aqu√≠.  Si esta condici√≥n es falsa (el creador envi√≥ exactamente el n√∫mero requerido de bytes), entonces este mensaje no se incluir√° en la transacci√≥n resultante, sino que simplemente se descartar√°. <br></li><li>  El tercer mensaje cambia el estado de nuestro AA ( <i>aplicaci√≥n: 'estado'</i> ): escriba el <i>fundador_tax</i> pasado como argumento, o <i>config√∫relo</i> en 0 si no se pas√≥ a la transacci√≥n de activaci√≥n.  La construcci√≥n <i>var1, de lo contrario, var2</i> devuelve var1 si se convierte en verdadero; de lo contrario, devuelve var2.  Aqu√≠ nos encontramos con la variable response_unit, que siempre contiene el hash de la unidad resultante.  En este caso, porque  la unidad resultante crear√° un nuevo activo llamado activo-a y ser√° el hash de la unidad creadora.  La <i>respuesta de</i> cadena <i>['team_asset'] = response_unit</i> simplemente escribe el mismo hash (o activo para el comando dado) en la matriz <i>responseVars</i> en la unidad final.  La matriz de respuestas tambi√©n se puede leer a la persona que realiz√≥ la transacci√≥n desencadenante, as√≠ como a los oyentes de eventos suscritos a eventos con este AA. <br></li></ol><br><h3>  Aceptamos dep√≥sitos </h3><br>  Una vez finalizada la creaci√≥n del equipo, pase al siguiente bloque: procesar dep√≥sitos de los miembros del equipo. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// contribute to a team if: `{trigger.data.team AND !$bFinished}`, init: `{ if (!var['team_' || trigger.data.team || '_asset']) bounce('no such team'); if (var['winner'] AND var['winner'] == trigger.data.team) bounce('contributions to candidate winner team are not allowed'); }`, messages: [ { app: 'payment', payload: { asset: `{var['team_' || trigger.data.team || '_asset']}`, outputs: [ {address: "{trigger.address}", amount: "{trigger.output[[asset=base]]}"} ] } }, { app: 'state', state: `{ var['team_' || trigger.data.team || '_amount'] += trigger.output[[asset=base]]; if (var['team_' || trigger.data.team || '_amount'] &gt; balance[base]*0.51){ var['winner'] = trigger.data.team; var['challenging_period_start_ts'] = timestamp; } }` } ]</span></span></code> </pre> <br>  De lo nuevo que encontramos aqu√≠ es la emisi√≥n de tokens del activo del equipo seleccionado a su participante a cambio de su dep√≥sito en bytes: <br><br><pre> <code class="plaintext hljs">asset: `{var['team_' || trigger.data.team || '_asset']}`, outputs: [{address: "{trigger.address}", amount: "{trigger.output[[asset=base]]}"}</code> </pre> <br>  Como recordamos, la variable de estado <i>'equipo_' ||</i>  <i>trigger.data.team ||</i>  Guardamos el <i>'activo'</i> en la etapa de creaci√≥n del equipo, y almacena el hash de la unidad en la que creamos el activo para este equipo, es decir, el nombre de este activo-a. <br><br>  En el mismo bloque, la condici√≥n principal se verifica para el 51%: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>[<span class="hljs-string"><span class="hljs-string">'team_'</span></span> || trigger.data.team || <span class="hljs-string"><span class="hljs-string">'_amount'</span></span>] &gt; balance[base]*<span class="hljs-number"><span class="hljs-number">0.51</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span>[<span class="hljs-string"><span class="hljs-string">'winner'</span></span>] = trigger.data.team; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span>[<span class="hljs-string"><span class="hljs-string">'challenging_period_start_ts'</span></span>] = timestamp; }</code> </pre> <br>  Si despu√©s de esta transacci√≥n de activaci√≥n, el saldo del equipo especificado supera el 51%, entonces el equipo se declara ganador y registramos la marca de tiempo de Unix actual (inicia el temporizador). <br><br>  Esta marca de tiempo se verificar√° en el tercer bloque cuando recibamos una transacci√≥n de activaci√≥n con un intento de finalizar el juego: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// finish the challenging period and set the winner if: `{trigger.data.finish AND !$bFinished}`, init: `{ if (!var['winner']) bounce('no candidate winner yet'); if (timestamp &lt; var['challenging_period_start_ts'] + $challenging_period) bounce('challenging period not expired yet'); }`, messages: [ { app: 'state', state: `{ var['finished'] = 1; var['total'] = balance[base]; var['challenging_period_start_ts'] = false; response['winner'] = var['winner']; }` } ]</span></span></code> </pre> <br><h3>  Pagamos un premio </h3><br>  Y el bloque final, el m√°s divertido, es el pago del dep√≥sito completo a los ganadores: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// pay out the winnings if: `{ if (!$bFinished) return false; $winner = var['winner']; $winner_asset = var['team_' || $winner || '_asset']; $asset_amount = trigger.output[[asset=$winner_asset]]; $asset_amount &gt; 0 }`, init: `{ $share = $asset_amount / var['team_' || $winner || '_amount']; $founder_tax = var['team_' || $winner || '_founder_tax']; $amount = round(( $share * (1-$founder_tax) + (trigger.address == $winner AND !var['founder_tax_paid'] ? $founder_tax : 0) ) * var['total']); }`, messages: [ { app: 'payment', payload: { asset: "base", outputs: [ {address: "{trigger.address}", amount: "{$amount}"} ] } }, { app: 'state', state: `{ if (trigger.address == $winner) var['founder_tax_paid'] = 1; }` } ]</span></span></code> </pre> <br>  El bloque de inicializaci√≥n es interesante aqu√≠, en el que calculamos los valores necesarios por adelantado: <br><br><pre> <code class="javascript hljs"> $share = $asset_amount / <span class="hljs-keyword"><span class="hljs-keyword">var</span></span>[<span class="hljs-string"><span class="hljs-string">'team_'</span></span> || $winner || <span class="hljs-string"><span class="hljs-string">'_amount'</span></span>]; $founder_tax = <span class="hljs-keyword"><span class="hljs-keyword">var</span></span>[<span class="hljs-string"><span class="hljs-string">'team_'</span></span> || $winner || <span class="hljs-string"><span class="hljs-string">'_founder_tax'</span></span>]; $amount = round(( $share * (<span class="hljs-number"><span class="hljs-number">1</span></span>-$founder_tax) + (trigger.address == $winner AND !<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>[<span class="hljs-string"><span class="hljs-string">'founder_tax_paid'</span></span>] ? $founder_tax : <span class="hljs-number"><span class="hljs-number">0</span></span>) ) * <span class="hljs-keyword"><span class="hljs-keyword">var</span></span>[<span class="hljs-string"><span class="hljs-string">'total'</span></span>]);</code> </pre> <br>  Todos los participantes del equipo, excepto su creador, reciben un monto proporcional a su contribuci√≥n inicial (1 por 1 bytes a cambio de los tokens de activos enviados en una transacci√≥n de activaci√≥n).  El creador tambi√©n recibe una comisi√≥n (se verifica que la direcci√≥n de la <i>persona</i> que envi√≥ la transacci√≥n de activaci√≥n es igual a la direcci√≥n del creador del equipo ganador <i>trigger.address == $ ganador</i> ).  Es importante no olvidar que la comisi√≥n debe pagarse solo una vez, y el creador puede enviar infinitas transacciones desencadenantes, por lo que guardamos la bandera en el estado AA. <br><br><h2>  Comienza el juego </h2><br>  Entonces, el c√≥digo est√° listo.  Aqu√≠ hay una lista completa de la misma: <br><br><div class="spoiler">  <b class="spoiler_title">c√≥digo AA completo</b> <div class="spoiler_text"><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">init</span></span>: <span class="hljs-string"><span class="hljs-string">`{ $team_creation_fee = 5000; $challenging_period = 24*3600; $bFinished = var['finished']; }`</span></span>, <span class="hljs-attr"><span class="hljs-attr">messages</span></span>: { <span class="hljs-attr"><span class="hljs-attr">cases</span></span>: [ { <span class="hljs-comment"><span class="hljs-comment">// create a new team; any excess amount is sent back if: `{trigger.data.create_team AND !$bFinished}`, init: `{ if (var['team_' || trigger.address || '_amount']) bounce('you already have a team'); if (trigger.output[[asset=base]] &lt; $team_creation_fee) bounce('not enough to pay for team creation'); }`, messages: [ { app: 'asset', payload: { is_private: false, is_transferrable: true, auto_destroy: false, fixed_denominations: false, issued_by_definer_only: true, cosigned_by_definer: false, spender_attested: false } }, { app: 'payment', if: `{trigger.output[[asset=base]] &gt; $team_creation_fee}`, payload: { asset: 'base', outputs: [ {address: "{trigger.address}", amount: "{trigger.output[[asset=base]] - $team_creation_fee}"} ] } }, { app: 'state', state: `{ var['team_' || trigger.address || '_founder_tax'] = trigger.data.founder_tax otherwise 0; var['team_' || trigger.address || '_asset'] = response_unit; response['team_asset'] = response_unit; }` } ] }, { // contribute to a team if: `{trigger.data.team AND !$bFinished}`, init: `{ if (!var['team_' || trigger.data.team || '_asset']) bounce('no such team'); if (var['winner'] AND var['winner'] == trigger.data.team) bounce('contributions to candidate winner team are not allowed'); }`, messages: [ { app: 'payment', payload: { asset: `{var['team_' || trigger.data.team || '_asset']}`, outputs: [ {address: "{trigger.address}", amount: "{trigger.output[[asset=base]]}"} ] } }, { app: 'state', state: `{ var['team_' || trigger.data.team || '_amount'] += trigger.output[[asset=base]]; if (var['team_' || trigger.data.team || '_amount'] &gt; balance[base]*0.51){ var['winner'] = trigger.data.team; var['challenging_period_start_ts'] = timestamp; } }` } ] }, { // finish the challenging period and set the winner if: `{trigger.data.finish AND !$bFinished}`, init: `{ if (!var['winner']) bounce('no candidate winner yet'); if (timestamp &lt; var['challenging_period_start_ts'] + $challenging_period) bounce('challenging period not expired yet'); }`, messages: [ { app: 'state', state: `{ var['finished'] = 1; var['total'] = balance[base]; var['challenging_period_start_ts'] = false; response['winner'] = var['winner']; }` } ] }, { // pay out the winnings if: `{ if (!$bFinished) return false; $winner = var['winner']; $winner_asset = var['team_' || $winner || '_asset']; $asset_amount = trigger.output[[asset=$winner_asset]]; $asset_amount &gt; 0 }`, init: `{ $share = $asset_amount / var['team_' || $winner || '_amount']; $founder_tax = var['team_' || $winner || '_founder_tax']; $amount = round(( $share * (1-$founder_tax) + (trigger.address == $winner AND !var['founder_tax_paid'] ? $founder_tax : 0) ) * var['total']); }`, messages: [ { app: 'payment', payload: { asset: "base", outputs: [ {address: "{trigger.address}", amount: "{$amount}"} ] } }, { app: 'state', state: `{ if (trigger.address == $winner) var['founder_tax_paid'] = 1; }` } ] } ] } }</span></span></code> </pre> <br></div></div><br>  Verifiquemos la validez del c√≥digo e intentemos implementarlo en testnet. <br><br><ol><li>  Vaya al editor en l√≠nea: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://testnet.oscript.org</a> <br></li><li>  Pegue nuestro c√≥digo y haga clic en Validar.  Si todo es correcto, veremos un c√°lculo de la complejidad del c√≥digo: <i>AA validado, complejidad = 27, ops = 176</i> .  Aqu√≠ ops es el n√∫mero de operaciones en nuestro c√≥digo, la complejidad es la complejidad del c√≥digo.  Los AA de Obyte no tienen ciclos, pero incluso esto no permite una protecci√≥n del 100% de la red contra los AA maliciosos con c√≥digo incorrecto.  Por lo tanto, todos los AA tienen un l√≠mite superior de complejidad, complejidad = 100. La complejidad del c√≥digo se calcula en el momento de la implementaci√≥n y se tienen en cuenta todas las ramas del c√≥digo.  Algunas operaciones son relativamente f√°ciles, como ¬± y otras, pero no agregan complejidad.  Otros, como el acceso a la base de datos (modificaci√≥n del estado) o c√°lculos complejos (que llaman a algunas funciones) agregan complejidad.  Para averiguar qu√© operaciones son f√°ciles y cu√°les son complejas, consulte la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">referencia del idioma</a> . <br></li><li>  Haz clic en Implementar.  Vemos algo similar a <br></li></ol><br><pre> <code class="plaintext hljs">Check in explorer: https://testnetexplorer.obyte.org/#DiuxsmIijzkfAVgabS9chJm5Mflr74lZkTGud4PM1vI= Agent address: 6R7SF6LTCNSPLYLIJWDF57BTQVZ7HT5N</code> </pre> <br>  Le aconsejo que siga el enlace en el explorador y aseg√∫rese de que la unidad con nuestro AA est√© publicada en la red.  Explorer tambi√©n muestra el c√≥digo completo de nuestro AA, como  Todos los AA en la red Obyte son de c√≥digo abierto.  Puede estudiar el c√≥digo de cualquier agente en su direcci√≥n. <br><br><h2>  Crowdfunding </h2><br>  Y ahora a las optimizaciones prometidas.  En la implementaci√≥n actual, cada jugador env√≠a dinero inmediatamente a la direcci√≥n AA del juego, indicando su equipo.  Al mismo tiempo, el equipo nunca puede convertirse en un l√≠der, y el dinero ya ha sido enviado.  Podemos optimizar el proceso de recolecci√≥n de dinero y evitar la situaci√≥n de que enviemos dinero a un equipo que nunca se convertir√° en un ganador.  Esto se puede hacer con el segundo AA, organizar el llamado crowdfunding de fondos estableciendo un objetivo din√°mico para la cantidad de fondos recaudados igual al 51% de la cantidad en el juego. <br><br>  En Oscript, podemos leer el estado de cualquier otro AA, por lo que tenemos la oportunidad de establecer un objetivo din√°mico en nuestro AA de crowdfunding. <br><br>  El algoritmo ser√° el siguiente: el creador del equipo pide a los jugadores que env√≠en dinero no a la direcci√≥n del juego, sino a la direcci√≥n de un agente que implementa la funcionalidad de crowdfunding.  Este agente almacenar√° la cantidad recolectada de bytes en casa y los enviar√° al juego solo si recolecta&gt; = 51% de la cantidad en el juego.  E inmediatamente este equipo se convierte en un l√≠der.  Si no se recauda la cantidad necesaria, el dinero simplemente se devolver√° a los jugadores.  En la etapa de recaudaci√≥n de fondos, los jugadores recibir√°n no fichas de juego de equipo, sino fichas de crowdfunding, que en el futuro pueden ser reembolsadas o intercambiadas por fichas de juego, si tienen √©xito. <br><br>  En el siguiente art√≠culo, implementamos esta funcionalidad. <br><br><h2>  No recopilamos bytes, sino certificaciones. </h2><br>  En la forma m√°s simple del juego "Ataque 51%" estamos hablando de las cantidades de fondos recaudados.  Por lo tanto, las "ballenas" con grandes billeteras pueden llevarse la mayor parte de las ganancias. <br><br>  Para que el juego sea m√°s honesto para todos los participantes, trataremos de contar no la cantidad de bytes enviados, sino la cantidad de participantes en los equipos.  El equipo que pudo atraer el n√∫mero m√°ximo de participantes gana.  Cada jugador invertir√° una cantidad fija, digamos 1GB, y contar√° como una unidad en el grupo de equipos.  Pero nada nos impide crear un n√∫mero infinito de nuevas direcciones, por lo que la condici√≥n cr√≠tica ser√° que solo se permitan en el juego las direcciones vinculadas a otras ID, en las que se respeta la regla de "una persona - una ID".  Tal enlace se llama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">certificaci√≥n</a> .  Un ejemplo de certificaci√≥n es la aprobaci√≥n del procedimiento KYC, despu√©s del cual se env√≠a un mensaje al DAG sobre la conexi√≥n entre la direcci√≥n de Obyte y el hash de datos personales (los datos personales se almacenan en la billetera del usuario, y √©l puede divulgarlos a las contrapartes individuales si lo desea, pero para esta tarea no son necesarios, es importante solo el hecho de la uni√≥n).  Otro ejemplo de certificaci√≥n es la certificaci√≥n de correo electr√≥nico en dominios donde se respeta la regla de "una persona - un correo electr√≥nico", esto se practica, por ejemplo, en los dominios de algunas universidades, empresas y pa√≠ses.  Por lo tanto, una persona real se contar√° solo una vez. <br><br>  Los agentes aut√≥nomos pueden solicitar el estado de certificaci√≥n de direcciones en la red, por lo que habr√° un n√∫mero m√≠nimo de cambios en el c√≥digo. <br><br>  Sugiero a los lectores en los comentarios que sugieran en qu√© lugares y c√≥mo es exactamente necesario cambiar las l√≠neas de c√≥digo de la versi√≥n actual del juego para implementar esto.  Para ayudar, como siempre, a la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Referencia del lenguaje Oscript</a> . <br><br>  Nuestra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">discordia</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Twitter</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/469849/">https://habr.com/ru/post/469849/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../469833/index.html">Gesti√≥n program√°tica (y patrones)</a></li>
<li><a href="../469835/index.html">Sue√±os sovi√©ticos del futuro, parte 2. Ahora con sepulki</a></li>
<li><a href="../469837/index.html">Primera reuni√≥n de Flutter en San Petersburgo: informes en video</a></li>
<li><a href="../469839/index.html">Vulnerabilidad de spam en Pikabu</a></li>
<li><a href="../469843/index.html">"¬øD√≥nde est√°n esos j√≥venes punks que nos borrar√°n de la faz de la tierra?"</a></li>
<li><a href="../469855/index.html">Gradle + LLVM</a></li>
<li><a href="../469859/index.html">Sem√°ntica de puntero y valor para determinar el receptor de un m√©todo</a></li>
<li><a href="../469865/index.html">700 empleados y m√∫ltiples continentes: c√≥mo Alconost construy√≥ un modelo de negocio sin oficina</a></li>
<li><a href="../469867/index.html">C√≥mo se convierte en un ni√±o de escuela (y qu√© tienen que ver los juegos de mesa con √©l)</a></li>
<li><a href="../469869/index.html">Por qu√© deber√≠as overclockear RAM (¬°es f√°cil!)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>