<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª üé• ü§Ωüèª Junos PyEZ am Beispiel der Aufgabe, freie ipv4-Subnetze zu finden ‚õ¥Ô∏è üç° üë®üèª‚Äçüöí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ein Artikel √ºber die Arbeit mit Junos PyEZ - ‚ÄûPython-Mikroframework, mit dem Sie Ger√§te verwalten und automatisieren k√∂nnen, auf denen Junos OS ausgef...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Junos PyEZ am Beispiel der Aufgabe, freie ipv4-Subnetze zu finden</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481648/">  Ein Artikel √ºber die Arbeit mit Junos PyEZ - ‚ÄûPython-Mikroframework, mit dem Sie Ger√§te verwalten und automatisieren k√∂nnen, auf denen Junos OS ausgef√ºhrt wird‚Äú - alles, was wir lieben.  Das Schreiben des in diesem Artikel beschriebenen Skripts verfolgte mehrere Ziele - Lernen von Python und Automatisieren der Aufgaben des Sammelns von Informationen oder √Ñndern von Konfigurationen auf Ger√§ten, auf denen Junos OS ausgef√ºhrt wird.  Die Wahl dieses speziellen Python + Junos PyEZ-Pakets wurde aufgrund des niedrigen Schwellenwerts f√ºr die Eingabe der Python-Programmiersprache und der einfachen Verwendung der Junos PyEZ-Bibliothek getroffen, f√ºr die keine Junos OS-Kenntnisse erforderlich sind. <br><br><h4>  Herausforderung </h4><br>  Pr√ºfung firmeneigener IPv4-freier Subnetze.  Das Kriterium, dass das Subnetz frei ist, ist das Fehlen eines Datensatzes in den Routen auf dem Switch, der als Router mit Junos OS fungiert. <br><br><h4>  Implementierung </h4><br>  Python + Junos PyEZ, obwohl die Versuchung bestand, dies mit paramiko und ssh.exec_command zu tun, <a name="habracut"></a>  Infolgedessen muss das Netzwerkverwaltungsprotokoll f√ºr netconf-Ger√§te auf den √ºberwachten Ger√§ten konfiguriert werden.  Netconf arbeitet mit Ger√§ten √ºber einen Remote Procedure Call (RPC) und verwendet in diesem Beispiel XML, um die empfangenen Informationen bereitzustellen. <br><br>  Die Installation der aktuellen Version von Junos PyEZ √ºber PyPI wird mit dem folgenden Befehl ausgef√ºhrt: <br><br><pre><code class="bash hljs">$ pip install junos-eznc</code> </pre> <br>  Sie k√∂nnen auch vom Hauptzweig des Projekts auf GitHub mit dem folgenden Befehl installieren: <br><br><pre> <code class="bash hljs">$ pip install git+https://github.com/Juniper/py-junos-eznc.git</code> </pre> <br>  Und noch eine Option durch <br><br><pre> <code class="bash hljs">$ pip install -r requirements.txt</code> </pre> <br>  Dieser Befehl installiert die Bibliotheken, die f√ºr die im System nicht vorhandenen Arbeiten erforderlich sind.  In meiner Version von <b>requirements.txt</b> gibt es nur zwei davon, die letzten Versionen sind zum Zeitpunkt des Schreibens des Skripts angegeben: <br><br><pre> <code class="plaintext hljs">junos-eznc netaddr</code> </pre> <br>  Das Standard-Skript verwendet den Namen des aktuellen Benutzers im System. Sie k√∂nnen sich mit dem Schl√ºssel show_route.py -u &lt;Benutzername&gt; unter dem Namen eines anderen Benutzers anmelden. Getpass.getpass akzeptiert das Kennwort von stdin, sodass das Kennwort nicht im System verbleibt.  Um eine Verbindung zum Ger√§t herzustellen, m√ºssen Sie auf Anfrage auch dessen Hostnamen oder IP-Adresse eingeben.  Alle f√ºr die Autorisierung auf dem Ger√§t erforderlichen Daten wurden empfangen. <br><br>  Junos PyEZ unterst√ºtzt die Verbindung zu Ger√§ten, auf denen Junos OS ausgef√ºhrt wird, √ºber die Konsole, Telnet oder Netconf √ºber ssh.  Der Artikel betrachtet die letzte Option. <br><br>  F√ºr den Anschluss an das Ger√§t wird die Ger√§teklasse des Moduls jnpr.junos verwendet <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> jnpr.junos.Device(host=router, user=args.name, passwd=password) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> dev:</code> </pre> <br>  √úber alle Routen, die dem Router durch einen Remoteprozeduraufruf oder einen Aufruf von Remoteprozeduren bekannt sind, f√ºr die dies praktischer ist, wird eine Anfrage gestellt. <br><br><pre> <code class="python hljs">data = dev.rpc.get_route_information()</code> </pre> <br>  Ein √§hnlicher Befehl unter Junos OS <br><br><pre> <code class="bash hljs">user@router&gt; show route | display xml</code> </pre> <br>  Wenn Sie rpc am Ende des Befehls hinzuf√ºgen, erhalten wir das Anforderungs-Tag und k√∂nnen es mit dem Namen der RPC-Methode abgleichen. Auf diese Weise k√∂nnen Sie andere interessante Namen herausfinden.  Es ist erw√§hnenswert, dass sich die Syntax zum Schreiben eines Anforderungs-Tags vom Methodennamen unterscheidet, dh Bindestriche durch Unterstriche ersetzen. <br><br><pre> <code class="bash hljs">user@router&gt; show route | display xml rpc &lt;rpc-reply xmlns:junos=<span class="hljs-string"><span class="hljs-string">"http://xml.juniper.net/junos/15.1R1/junos"</span></span>&gt; &lt;rpc&gt; &lt;get-route-information&gt; &lt;/get-route-information&gt; &lt;/rpc&gt; &lt;/rpc-reply&gt;</code> </pre> <br>  Ich habe die <b>Routendaten</b> im XML-Format erhalten, von denen ich nur diejenigen ausgew√§hlt habe, die mich mit dem Tag <b>&lt;rt-destination&gt; xxx.xxx.xxx.xxx/yy &lt;/ rt-destination&gt;</b> interessieren, und habe sie in eine Variable als Liste im Zeichenfolgenformat geschrieben, um eine Liste zu erhalten ausgelastete Subnetze. <br><br><pre> <code class="python hljs">route_list = data.xpath(<span class="hljs-string"><span class="hljs-string">"//rt-destination/text()"</span></span>)</code> </pre> <br>  Ich habe den Rest in eine while-Schleife eingeschlossen, um die Anforderung an den Router nicht erneut auszuf√ºhren, wenn ich ein anderes Subnetz als dasjenige √ºberpr√ºfen muss, das der Router bereits kennt.  Es ist erw√§hnenswert, dass der Router, auf dem ich angefordert habe, die Routen nur √ºber OSPF kennt. Daher ist es f√ºr den Grenzrouter besser, die Anforderung ein wenig zu √§ndern, um die Skriptausf√ºhrungszeit zu verk√ºrzen <br><br><pre> <code class="python hljs">data = dev.rpc.get_ospf_route_information()</code> </pre> <br><h4>  Schauen wir uns nun den Inhalt der while-Schleife an </h4><br>  Zu Beginn wird der Benutzer aufgefordert, ein Subnetz mit einer Maske und nicht mehr als drei Oktetten aus dem Netzwerk desselben Subnetzes einzugeben. Dies ist erforderlich, um den Suchbereich festzulegen.  Ich mag diese Implementierung des Einstellens der Kriterien und des Suchbereichs nicht wirklich, aber bisher habe ich keine bessere L√∂sung gefunden.  Als n√§chstes w√§hle ich aus der erhaltenen Liste von route_list-Subnetzen unter Verwendung einer Variablen, die nicht mehr als drei Oktette enth√§lt, die f√ºr mich interessanten Subnetze aus <br><br><pre> <code class="python hljs">tmp = re.search(<span class="hljs-string"><span class="hljs-string">r'^%s\S*'</span></span> % subnet_search, route_list[i])</code> </pre> <br>  √úber IPNetwork, das netaddr-Modul, erhalte ich Subnetze als Liste von IPv4-Adressen <br><br><pre> <code class="python hljs">range_subnet = netaddr.IPNetwork(tmp.group(<span class="hljs-number"><span class="hljs-number">0</span></span>))</code> </pre> <br>  Unter Verwendung von IPNetwork aus dem vom Benutzer mit der Maske eingegebenen Netzwerk erhalte ich einen Adressbereich und bilde eine Liste aller Adressen aus diesem Bereich zum Vergleich mit der Liste der belegten Adressen. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> set(net_list).difference(set(busyip)): freeip.append(i)</code> </pre> <br>  Ich leite die erhaltene Liste der freien Adressen in Form von Subnetzen ab <br><br><pre> <code class="python hljs">print(netaddr.IPSet(freeip))</code> </pre> <br>  Unten finden Sie das vollst√§ndige Skript, das auf Switches getestet wurde, die als Router der Modelle ex4550 und ex4600 verwendet werden <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python3 # -*- coding: utf-8 -*- import argparse import getpass import netaddr import re import sys import jnpr.junos parser = argparse.ArgumentParser() parser.add_argument('-u', '--user', action='store', dest='name', help='Enter login from tacacs if it differs from the ' 'username in the system.') args = parser.parse_args() if not args.name: args.name = getpass.getuser() # Return the ‚Äúlogin name‚Äù of the user. router = input("Full routers name: ") password = getpass.getpass("Password: ") try: # Authenticates to a device running Junos, for get information about routs # into xml format and selects by tag. route_list = [] with jnpr.junos.Device(host=router, user=args.name, passwd=password) as dev: data = dev.rpc.get_route_information() route_list = data.xpath("//rt-destination/text()") except (jnpr.junos.exception.ConnectRefusedError, jnpr.junos.exception.ConnectUnknownHostError) as err: print("Equipment name or password wrong.") sys.exit(1) while True: subnet = input("Net with mask: ") subnet_search = input("Input no more three octet: ") # Gets a list of busy IP addresses from the received subnets. busyip = [] for i in range(len(route_list)): tmp = re.search(r'^%s\S*' % subnet_search, route_list[i]) if tmp: range_subnet = netaddr.IPNetwork(tmp.group(0)) for ip in range_subnet: busyip.append("%s" % ip) range_subnet = netaddr.IPNetwork(subnet) # Gets list ip adresses from subnetworks lists. net_list = [] for ip in range_subnet: net_list.append("%s" % ip) # omparing lists. freeip = [] for i in set(net_list).difference(set(busyip)): freeip.append(i) print(netaddr.IPSet(freeip)) request = input("To run request again enter yes or y, " "press 'enter', complete request: ") if request in ("yes", "y"): continue else: print('Bye') break</span></span></code> </pre></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de481648/">https://habr.com/ru/post/de481648/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de481632/index.html">Cloud-Anbieter: Wer ist der Sch√∂nste auf dem Markt?</a></li>
<li><a href="../de481634/index.html">Food Design Digest, November 2019</a></li>
<li><a href="../de481638/index.html">Warum 3D-Modelle komplexer Produktion n√ºtzlich sind</a></li>
<li><a href="../de481640/index.html">Ver√∂ffentlichung der neuen Version des DevOpsProdigy KubeGraf Plugins</a></li>
<li><a href="../de481644/index.html">So √ºberleben Sie eine SQL-Datenbank im 21. Jahrhundert: Clouds, Kubernetes und PostgreSQL Multimaster</a></li>
<li><a href="../de481652/index.html">Backdoor (?) Auf BlackBerry Android-Smartphones</a></li>
<li><a href="../de481654/index.html">Die Geschichte, wie Ihnen QA Engineer mithilfe von Test IT mithilfe des Bot Frameworks das Leben erleichtert hat</a></li>
<li><a href="../de481656/index.html">PagerDuty oder warum die Operationsabteilung nachts m√∂glicherweise nicht schl√§ft</a></li>
<li><a href="../de481662/index.html">Erprobung neuer Tools zum Erstellen und Automatisieren der Bereitstellung in Kubernetes</a></li>
<li><a href="../de481664/index.html">Serverlose Preise und Kosten: AWS Lambda</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>