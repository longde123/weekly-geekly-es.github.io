<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñ±Ô∏è üíê ü§∂üèª Dasar-dasar eskalasi hak istimewa Windows üßñüèª üïü üßû</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saya memutuskan untuk diri sendiri dan bagi mereka yang akan merasa berguna, untuk mengumpulkan semua yang saya tahu, tetapi saya tidak ingat tentang ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dasar-dasar eskalasi hak istimewa Windows</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418441/"> Saya memutuskan untuk diri sendiri dan bagi mereka yang akan merasa berguna, untuk mengumpulkan semua yang saya tahu, tetapi saya tidak ingat tentang topiknya, dalam artikel ini.  Bagikan kiat.  Sumber utama artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ini</a> adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ini</a> . <br><br>  Saya dengan bebas menerjemahkan dan menambahkan sedikit dari diri saya, apa yang saya kumpulkan dan pelajari dari sumber lain. <br><br>  Secara umum, berikut adalah cara untuk membantu kami mencapai tujuan peningkatan hak istimewa kami. <br><a name="habracut"></a><br>  Titik awal untuk artikel singkat ini adalah shell (akun) yang tidak terjangkau.  Mungkin kita menggunakan exploit atau melakukan serangan dan mendapatkan shell ini. <br><br>  Pada dasarnya, pada saat awal, kami tidak memahami mesin: apa fungsinya, terhubung ke apa, tingkat keistimewaan apa yang kami miliki, atau bahkan sistem operasi apa itu. <br><br>  Pertama, kita perlu mendapatkan informasi yang kita butuhkan untuk memahami di mana kita berada dan apa yang kita miliki: <br><br><pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">systeminfo</span></span> | findstr /B /C:<span class="hljs-string"><span class="hljs-string">" "</span></span> /C:<span class="hljs-string"><span class="hljs-string">" "</span></span></code> </pre> <br>  Perintah ini memungkinkan Anda untuk menentukan, seperti yang Anda lihat, nama dan versi OS.  Anda dapat menjalankannya tanpa parameter, maka output dari perintah akan lebih lengkap, tetapi ini sudah cukup bagi kami. <br><br>  Selanjutnya, penting untuk mengetahui nama mesin dan nama pengguna di mana kita terhubung. <br><br><ul><li>  hostname adalah nama pengguna. </li><li>  gema% nama pengguna% - nama pengguna. </li></ul><br>  Selanjutnya, mari kita lihat apa yang masih ada pada host ini dan dapatkan informasi lebih detail tentang pengguna mereka. <br><br><ul><li>  pengguna net - pengguna lain </li><li>  net user user1 - informasi terperinci tentang pengguna, di mana user1 adalah nama pengguna Anda. </li></ul><br>  Setelah menerima informasi tentang akun, kami akan melihat informasi tentang interaksi jaringan host ini. <br><br>  Pertama, lihatlah interface yang tersedia dan tabel routing. <br><br><ul><li>  ipconfig / all - informasi tentang antarmuka yang tersedia. </li><li>  cetak rute - tabel routing </li><li>  arp -A - tabel entri arp </li></ul><br>  Selanjutnya, kita akan melihat koneksi jaringan aktif dan aturan firewall. <br><br><ul><li>  netstat -ano - koneksi jaringan aktif. </li></ul><br>  -a - meluncurkan dengan parameter ini menampilkan semua koneksi TCP aktif, serta port TCP dan UDP yang didengarkan oleh sistem; <br>  -n - parameter ini memungkinkan Anda untuk menunjukkan koneksi TCP aktif dengan alamat dan nomor port; <br>  -o - sama seperti kunci sebelumnya, menampilkan koneksi TCP aktif, tetapi kode proses ditambahkan ke statistik, sudah mungkin untuk menentukan aplikasi mana yang menggunakan koneksi. <br><br><ul><li>  netsh firewall show state - status firewall </li><li>  netsh firewall show config - konfigurasi firewall </li></ul><br>  Akhirnya, kami secara singkat memeriksa apa yang berfungsi pada host yang dikompromikan: tugas yang dijadwalkan, proses yang berjalan, layanan yang berjalan, dan driver yang diinstal. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">schtasks</span></span> /query /fo LIST /v</code> </pre> <br>  dimana <br>  / query - Menampilkan data tentang semua tugas yang dijadwalkan, <br>  / fo LIST - Daftar keluaran. <br>  / v - Detail pekerjaan cetak. <br><br>  Perintah berikut ini mengaitkan proses yang berjalan dengan layanan yang berjalan. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">tasklist</span></span> /SVC</code> </pre> <br>  dimana <br>  / SVC - Layanan pemetaan untuk setiap proses. <br><br>  Lihat juga daftar menjalankan layanan Windows. <br><br><pre> <code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">net</span></span> <span class="hljs-built_in"><span class="hljs-built_in">start</span></span></code> </pre> <br>  Juga berguna untuk melihat informasi tentang driver dari sistem yang dikompromikan. <br><br><pre> <code class="hljs">DRIVERQUERY</code> </pre> <br>  Selanjutnya, saya ingin menyebutkan tentang mungkin perintah Windows yang paling berguna - wmic.  Perintah WMIC (Windows Management Instrumentation Command) digunakan untuk memperoleh informasi tentang perangkat keras dan sistem, mengelola proses dan komponennya, dan mengubah pengaturan menggunakan kemampuan Instrumentasi Manajemen Windows (Instrumentasi Manajemen Windows atau WMI).  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Deskripsi yang bagus</a> . <br><br>  Sayangnya, beberapa konfigurasi Windows tidak mengizinkan akses ke WMIC secara default jika pengguna bukan anggota grup Administrator (yang merupakan ide yang sangat bagus).  Versi XP apa pun tidak mengizinkan akses ke WMIC dari akun yang tidak memiliki hak. <br><br>  Sebaliknya, Windows 7 Professional dan Windows 8 Enterprise memungkinkan pengguna dengan hak istimewa rendah untuk menggunakan WMIC secara default. <br><br>  Seperti biasa - parameter program: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">wmic</span></span> /?</code> </pre> <br>  <a href="">Sebuah skrip yang bagus untuk mengumpulkan informasi melalui wmic.</a> <br><br>  Sebelum melanjutkan, ada baiknya menjalankan informasi yang dikumpulkan.  Penting juga untuk memperhatikan tambalan yang dipasang dalam sistem, karena setiap informasi tentang lubang dalam sistem akan memberi kami dukungan tambahan untuk meningkatkan hak istimewa kami.  HotFix dapat mencari kerentanan eskalasi hak istimewa. <br><br>  Selanjutnya, kami akan mempertimbangkan instalasi tanpa pengawasan.  Jika ada kebutuhan untuk menginstal dan mengkonfigurasi armada mesin yang besar, maka sebagai aturan, tenaga teknis tidak akan berpindah dari mesin ke mesin untuk mengonfigurasikan masing-masing pribadi.  Ada beberapa solusi untuk instalasi tanpa pengawasan.  Tidak begitu penting bagi kami apa metode ini dan bagaimana cara kerjanya, tetapi yang penting adalah mereka meninggalkan file konfigurasi yang digunakan untuk proses instalasi yang berisi banyak informasi rahasia, seperti kunci produk sistem operasi dan kata sandi administrator.  Yang paling menarik bagi kami adalah kata sandi administrator, yang dapat kami gunakan untuk meningkatkan hak istimewa kami. <br><br>  Sebagai aturan, ini adalah direktori berikut: <br><br><ul><li>  c: \ sysprep.inf </li><li>  c: \ sysprep \ sysprep.xml </li><li>  % WINDIR% \ Panther \ Unattend \ Unattended.xml </li><li>  % WINDIR% \ Panther \ Unattended.xml </li></ul><br>  Tetapi perlu memeriksa keseluruhan sistem. <br><br>  File-file ini berisi kata sandi dalam teks yang jelas atau BASE64 disandikan. <br>  Contoh: <br><br>  Sysprep.inf - kata sandi dalam teks yang jelas. <br><br><img src="https://habrastorage.org/webt/fq/1t/qm/fq1tqm53bjiwjlwsbrevzdcy6qw.png">  " <br><br>  Sysprep.xml - password disandikan base64. <br><br><img src="https://habrastorage.org/webt/rh/2r/gk/rh2rgkl3wtby-9lagcxmfrnrlgu.png">  " <br><br>  Unattended.xml - kata sandi yang disandikan base64. <br><br><img src="https://habrastorage.org/webt/5e/1p/gl/5e1pglvwtogk0kd0xn4cmey_hlo.png"><br><br>  Juga, untuk host yang terhubung ke domain, Anda dapat mencari file Group.xml, yang berisi kata sandi terenkripsi AES256, tetapi yang dapat didekripsi, karena  kuncinya diposting di msdn (https://msdn.microsoft.com/en-us/library/cc422924.aspx) dan sumber lainnya.  Tapi ini masalahnya jika kebijakan membuat pengguna lokal di host atau, misalnya, menetapkan kata sandi untuk Administrator lokal digunakan. <br><br>  Sebagai contoh, saya miliki di sini: <br><br><img src="https://habrastorage.org/webt/jy/wu/4g/jywu4g6xzymrbkwwniw4m_3uckg.png"><br><br>  Setelah membukanya, kami mencari parameter "sandi sandi". <br><br><img src="https://habrastorage.org/webt/i9/ow/hk/i9owhkwprnwlpmltga00uj-awx4.png"><br><br>  Selanjutnya, Anda perlu mendekripsi urutan ini.  Kami menggunakan, misalnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CrypTool</a> .  Pertama, dekode Base64. <br>  Fitur Base64 adalah bahwa panjangnya haruslah kelipatan 4. Karena itu, kami mempertimbangkan blok 4, dan jika tidak ada cukup karakter di blok terakhir, kami menambahkan karakter yang hilang dengan "=". <br>  Saya mendapat 2 "=". <br><br><img src="https://habrastorage.org/webt/bm/sc/73/bmsc73fsqblniktrnrsyugqowhi.png"><br><br>  Selanjutnya kita mendekripsi.  Menggunakan tombol di atas. <br><br><img src="https://habrastorage.org/webt/-f/n0/nt/-fn0ntf9um-zfyfoqpn7uwafoay.png"><br><br>  Kami menghapus poin ekstra yang memisahkan karakter dan mendapatkan kata sandi. <br><br>  Selain Group.xml, berikut adalah beberapa file preferensi kebijakan lain yang mungkin memiliki set atribut cPassword tambahan: <br><br><ul><li>  Services \ Services.xml </li><li>  ScheduledTasks \ ScheduledTasks.xml </li><li>  Printers \ Printers.xml </li><li>  Drives \ Drives.xml </li><li>  DataSources \ DataSources.xml </li></ul><br>  Namun, kami semua menyukai solusi otomatis, sehingga kami dapat mencapai garis finish secepat mungkin.  Ada dua opsi utama di sini, tergantung pada jenis shell / akses yang kita miliki.  Ada modul metasploit yang dapat dieksekusi melalui sesi yang ditetapkan (https://www.rapid7.com/db/modules/post/windows/gather/credentials/gpp) atau Anda dapat menggunakan Get-GPPPassword, yang merupakan bagian dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PowerSploit</a> . <br><br>  Oke selanjutnya.  Kami akan mencari parameter registri aneh "AlwaysInstallElevated".  Opsi ini memungkinkan pengguna yang tidak memiliki hak istimewa untuk menginstal file .msi dari NT AUTHORITY \ SYSTEM. <br><br>  Agar dapat menggunakan ini, kita harus memverifikasi bahwa kedua kunci registri diinstal, dan jika demikian, kita bisa mendapatkan shell SYSTEM.  Periksa: <br><br><pre> <code class="hljs tex">reg query HKLM<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SOFTWARE</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Policies</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Microsoft</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Windows</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Installer</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">AlwaysInstallElevated</span></span></span></span></code> </pre> <br><pre> <code class="hljs tex">reg query HKCU<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SOFTWARE</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Policies</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Microsoft</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Windows</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Installer</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">AlwaysInstallElevated</span></span></span></span></code> </pre> <br>  Metasploit menyertakan exploit modul khusus / windows / local / always_install_elevated, yang membuat file MSI dengan file executable khusus yang dibangun di dalamnya, yang diekstraksi dan dieksekusi oleh installer dengan hak istimewa sistem.  Setelah eksekusi, file msi menghentikan instalasi untuk mencegah pendaftaran tindakan dalam sistem.  Selain itu, jika Anda memulai instalasi dengan tombol / quiet, maka Anda bahkan tidak akan mendapatkan kesalahan. <br><br>  Nah, beberapa perintah pencarian yang berguna pada sistem: <br><br>  Perintah di bawah ini akan mencari sistem file untuk nama file yang mengandung kata kunci tertentu.  Anda dapat menentukan jumlah kata kunci apa saja. <br><br><pre> <code class="hljs markdown">dir /s <span class="hljs-emphasis"><span class="hljs-emphasis">*pass*</span></span> == <span class="hljs-emphasis"><span class="hljs-emphasis">*cred*</span></span> == <span class="hljs-emphasis"><span class="hljs-emphasis">*vnc*</span></span> == <span class="hljs-emphasis"><span class="hljs-emphasis">*.config*</span></span></code> </pre> <br>  Mencari jenis file tertentu dengan kata kunci, perintah ini dapat menghasilkan banyak output. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">findstr</span></span> /si password <span class="hljs-regexp"><span class="hljs-regexp">*.xml</span></span> <span class="hljs-regexp"><span class="hljs-regexp">*.ini</span></span> <span class="hljs-regexp"><span class="hljs-regexp">*.txt</span></span></code> </pre> <br>  Demikian pula, dua perintah di bawah ini dapat digunakan untuk menangkap registri untuk kata kunci, dalam hal ini, "kata sandi". <br><br><pre> <code class="hljs pgsql">reg query HKLM /f <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> /t REG_SZ /s</code> </pre> <br><pre> <code class="hljs pgsql">reg query HKCU /f <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> /t REG_SZ /s</code> </pre> <br>  Saat ini, kami sudah memiliki cukup untuk menjalankan sistem.  Tetapi ada beberapa serangan yang lebih bertarget untuk mendapatkan hasil yang diinginkan: kita akan melihat layanan Windows dan izin untuk file dan folder.  Tujuan kami di sini adalah menggunakan izin yang lemah untuk meningkatkan hak istimewa sesi. <br><br>  Kami akan memeriksa banyak hak akses, accesschk.exe, yang merupakan alat dari Microsoft Sysinternals Suite, akan membantu kami dalam hal ini.  Microsoft Sysinternals berisi banyak alat hebat.  Paket ini dapat diunduh dari situs web Microsoft technet (https://docs.microsoft.com/ru-ru/sysinternals/downloads/sysinternals-suite). <br><br>  Kami dapat memeriksa tingkat hak istimewa yang diperlukan untuk setiap layanan menggunakan accesschk. <br><br>  Kita dapat melihat izin yang dimiliki setiap level pengguna. <br><br><img src="https://habrastorage.org/webt/jo/pf/q2/jopfq2pwodrwtcexiainzaji4yk.png"><br><br>  Accesschk dapat secara otomatis memeriksa apakah kita memiliki akses tulis ke layanan Windows dengan tingkat pengguna tertentu.  Sebagai aturan, sebagai pengguna dengan hak istimewa rendah, kami ingin memeriksa "Pengguna".  Pastikan untuk memeriksa grup pengguna yang Anda ikuti. <br><br>  -c Namanya adalah layanan Windows, misalnya ssdpsrv (sebutkan "*" untuk menampilkan semua layanan) <br>  -d Hanya memproses direktori <br>  -e Hanya menampilkan tingkat integritas yang ditentukan secara eksplisit (hanya Windows Vista) <br>  -k Namanya adalah kunci registri, misalnya, hklm \ software <br>  -n Tampilkan hanya objek yang tidak memiliki aturan akses <br>  -p Nama atau pengidentifikasi proses (PID) ditentukan sebagai nama, misalnya cmd.exe (sebutkan "*" sebagai nama untuk menampilkan semua proses) <br>  -q Abaikan header <br>  -r Cetak hanya objek yang memiliki akses baca <br>  -S Pemrosesan rekursif <br>  -v Cetak informasi terperinci <br>  -w Mendaftar hanya objek yang memiliki akses tulis <br><br><img src="https://habrastorage.org/webt/4z/1r/u6/4z1ru6mikuprkxybtdzohmzgl5s.png"><br><br>  Ada juga perintah menarik lainnya: <br><br><pre> <code class="hljs dos">autorunsc.exe -a | <span class="hljs-built_in"><span class="hljs-built_in">findstr</span></span> /n /R "File\ <span class="hljs-keyword"><span class="hljs-keyword">not</span></span>\ found"</code> </pre> <br>  Memungkinkan Anda menemukan entri registri tentang file yang diluncurkan secara otomatis, tetapi sudah hilang dari sistem.  Catatan dapat tetap ada jika, misalnya, layanan dihapus dengan tidak benar.  Pada setiap awal, sistem gagal mencoba menjalankan file ini.  Anda juga dapat memanfaatkan situasi ini untuk memperluas wewenang Anda.  Cukup gantikan file ini dengan kami. <br><br>  Berikutnya, kami mempertimbangkan dua kerentanan: <br><br>  Pertama: meniru hasil pos yang ditulis oleh Parvez dari GreyHatHacker;  ‚ÄúMeninggikan hak istimewa dengan mengeksploitasi izin folder lemah‚Äù (http://www.greyhathacker.net/?p=738). <br><br>  Contoh ini adalah kasus khusus pembajakan dll.  Program biasanya tidak dapat berfungsi sendiri, mereka memiliki banyak sumber daya yang mereka butuhkan untuk terhubung (terutama dll, tetapi juga file mereka sendiri).  Jika suatu program atau layanan mengunduh file dari direktori tempat kami memiliki akses tulis, kami dapat menyalahgunakannya untuk meluncurkan shell dengan hak istimewa di mana program berjalan. <br><br>  Biasanya, aplikasi Windows akan menggunakan jalur pencarian yang telah ditentukan untuk menemukan dll, dan itu akan memeriksa jalur ini dalam urutan tertentu.  Pembajakan Dll biasanya terjadi dengan menempatkan dll berbahaya di salah satu jalur ini.  Masalah ini dapat diperbaiki dengan menunjukkan jalur absolut aplikasi ke dll yang diperlukan. <br><br>  Urutan pencarian Dll: <br><br><ol><li>  Direktori tempat aplikasi berjalan </li><li>  Direktori Sistem 32-bit (C: \ Windows \ System32) </li><li>  Direktori Sistem 16-bit (C: \ Windows \ System) </li><li>  Direktori Windows (C: \ Windows) </li><li>  Direktori kerja saat ini (CWD) </li><li>  Direktori dalam variabel lingkungan PATH (sistem lalu pengguna) </li></ol><br>  Terkadang aplikasi mencoba mengunduh file dll yang hilang pada mesin.  Ini dapat terjadi karena beberapa alasan, misalnya, jika perpustakaan dll hanya diperlukan untuk plug-in atau komponen tertentu yang tidak diinstal.  Dalam kasus ini, Parvez menemukan bahwa beberapa layanan Windows mencoba memuat pustaka dll yang tidak ada dalam pengaturan default. <br><br>  Karena dll tidak ada, kami akhirnya melalui semua jalur pencarian.  Sebagai pengguna dengan tingkat privilege rendah, kami memiliki sedikit peluang untuk menempatkan dll berbahaya dalam item 1-4, 5. Tetapi jika kami memiliki akses tulis ke direktori mana pun, maka peluang kami untuk menang sangat besar. <br><br>  Mari kita lihat bagaimana cara kerjanya, sebagai contoh kita akan menggunakan layanan IKEEXT (IPSec IKE dan modul kunci AuthIP) yang mencoba mengunduh wlbsctrl.dll. <br><br>  Direktori apa pun di "C: \" akan menyediakan akses tulis untuk pengguna yang diautentikasi, ini memberi kami peluang. <br><br><pre> <code class="hljs tex">C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Users</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span></span>1<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Desktop</span></span></span></span>&gt; accesschk.exe -dqv "C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Python</span></span></span></span>27"</code> </pre> <br><pre> <code class="hljs pgsql">C:\Python27 Medium Mandatory <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Default</span></span>) [<span class="hljs-keyword"><span class="hljs-keyword">No</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Write</span></span>-Up] RW BUILTIN\Administrators FILE_ALL_ACCESS RW NT AUTHORITY\<span class="hljs-keyword"><span class="hljs-keyword">SYSTEM</span></span> FILE_ALL_ACCESS R BUILTIN\Users FILE_LIST_DIRECTORY FILE_READ_ATTRIBUTES FILE_READ_EA FILE_TRAVERSE SYNCHRONIZE READ_CONTROL RW NT AUTHORITY\Authenticated Users FILE_ADD_FILE FILE_ADD_SUBDIRECTORY FILE_LIST_DIRECTORY FILE_READ_ATTRIBUTES FILE_READ_EA FILE_TRAVERSE FILE_WRITE_ATTRIBUTES FILE_WRITE_EA <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> SYNCHRONIZE READ_CONTROL</code> </pre><br><pre> <code class="hljs tex">C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Users</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span></span>1<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Desktop</span></span></span></span>&gt; icacls "C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Python</span></span></span></span>27"</code> </pre> <br><pre> <code class="hljs tex">C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Python</span></span></span></span>27 BUILTIN<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Administrators</span></span></span></span>:(ID)F BUILTIN<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Administrators</span></span></span></span>:(OI)(CI)(IO)(ID)F NT AUTHORITY<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SYSTEM</span></span></span></span>:(ID)F NT AUTHORITY<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SYSTEM</span></span></span></span>:(OI)(CI)(IO)(ID)F BUILTIN<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Users</span></span></span></span>:(OI)(CI)(ID)R NT AUTHORITY<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Authenticated</span></span></span></span> Users:(ID)C NT AUTHORITY<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Authenticated</span></span></span></span> Users:(OI)(CI)(IO)(ID)C</code> </pre><br>  F - akses penuh. <br>  (OI) - pewarisan benda. <br>  (CI) - warisan dengan wadah. <br>  (IO) - hanya warisan. <br>  (NP) - larangan distribusi warisan. <br>  (I) - mewarisi izin dari wadah induk. <br><br>  Sebelum melanjutkan tindakan, Anda harus memeriksa status layanan IKEEXT.  Dalam hal ini, kita dapat melihat bahwa ini disetel ke "AUTO_START"! <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sc</span></span> qc IKEEXT</code> </pre> <br><pre> <code class="hljs tex">[SC] QueryServiceConfig SUCCESS SERVICE_NAME: IKEEXT TYPE : 20 WIN32_SHARE_PROCESS START_TYPE : 2 AUTO_START ERROR_CONTROL : 1 NORMAL BINARY_PATH_NAME : C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Windows</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system</span></span></span></span>32<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svchost</span></span></span></span>.exe -k netsvcs LOAD_ORDER_GROUP : TAG : 0 DISPLAY_NAME : IKE and AuthIP IPsec Keying Modules DEPENDENCIES : BFE SERVICE_START_NAME : LocalSystem</code> </pre> <br>  Sekarang kita tahu bahwa kita memiliki kondisi yang diperlukan, dan kita dapat membuat dll jahat dan mencegat shell! <br><br>  Kami menggunakan Metasploit -&gt; msfvenom, misalnya. <br><br><img src="https://habrastorage.org/webt/ac/-m/_z/ac-m_z8lymihvi6r6g3dsxmebr8.png"><br><br>  Setelah mentransfer evil.dll ke komputer target kami, yang perlu kita lakukan adalah mengganti nama ke wlbsctrl.dll dan memindahkannya ke "C: \ Python27".  Setelah ini selesai, kita harus sabar menunggu mesin untuk restart (atau kita dapat mencoba untuk memaksa reboot), dan kita akan mendapatkan shell sistem. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">copy</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">evil</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.dll</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>:\<span class="hljs-selector-tag"><span class="hljs-selector-tag">Python27</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">wlbsctrl</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.dll</span></span></code> </pre> <br>  Setelah itu, tinggal menunggu sistem untuk reboot. <br><br>  Untuk contoh terakhir kami, kami akan mempertimbangkan tugas yang direncanakan.  Saya akan menjelaskan prinsipnya, karena  semua mungkin memiliki kasus berbeda. <br><br>  Kami menemukan proses, layanan, aplikasi yang diluncurkan oleh penjadwal tugas dari SYSTEM. <br>  Kami memeriksa hak akses ke folder tempat target kami berada. <br><br><pre> <code class="hljs powershell">accesschk.exe <span class="hljs-literal"><span class="hljs-literal">-dqv</span></span> <span class="hljs-string"><span class="hljs-string">"__"</span></span></code> </pre> <br>  Jelas bahwa ini adalah masalah konfigurasi serius, tetapi yang lebih buruk adalah kenyataan bahwa setiap Pengguna yang diotentikasi (pengguna yang diautentikasi) memiliki akses tulis ke folder ini.  Dalam contoh ini, kita bisa menimpa biner yang dapat dieksekusi dengan file yang dihasilkan oleh metasploit. <br><br>  Dapat dikodekan secara opsional. <br><br><img src="https://habrastorage.org/webt/7c/p6/qv/7cp6qviajkpgxvibpruzsgqhjv4.png"><br><br>  Sekarang yang tersisa adalah mengunduh file executable berbahaya dan menimpanya di folder file yang dapat dieksekusi.  Setelah ini selesai, kita dapat dengan aman pergi tidur dan berjalan sistemik di pagi hari. <br><br>  Dua contoh ini harus memberi kita gambaran tentang kerentanan yang harus dicari ketika mempertimbangkan izin untuk file dan folder.  Diperlukan waktu untuk mempelajari semua jalur binpath untuk layanan windows, tugas terjadwal, dan tugas autorun. <br><br>  Akhirnya, beberapa tips untuk menggunakan accesschk.exe. <br><br>  Temukan semua izin yang lemah untuk folder pada disk. <br><br><pre> <code class="hljs swift">accesschk.exe -uwdqs <span class="hljs-type"><span class="hljs-type">Users</span></span> <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>:\ accesschk.exe -uwdqs <span class="hljs-string"><span class="hljs-string">"Authenticated Users"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>:\</code> </pre><br>  Temukan semua izin yang lemah untuk file pada disk. <br><br><pre> <code class="hljs swift">accesschk.exe -uwqs <span class="hljs-type"><span class="hljs-type">Users</span></span> <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>:\*.* accesschk.exe -uwqs <span class="hljs-string"><span class="hljs-string">"Authenticated Users"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>:\*.*</code> </pre> <br>  Suka semuanya. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id418441/">https://habr.com/ru/post/id418441/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id418429/index.html">Pengalaman Kerja Saya untuk Peran Pelatih Agile di Eropa, Bagian Dua</a></li>
<li><a href="../id418431/index.html">Masalah imajiner - akar dari perangkat lunak yang buruk</a></li>
<li><a href="../id418433/index.html">4 Agustus Peter Pencarian sepeda pertama untuk programmer</a></li>
<li><a href="../id418437/index.html">Tim Oc untuk menyelamatkan</a></li>
<li><a href="../id418439/index.html">Dasar-dasar Aplikasi Web Progresif</a></li>
<li><a href="../id418443/index.html">GObject: enkapsulasi, instantiasi, introspeksi</a></li>
<li><a href="../id418445/index.html">Django Channels - jawaban untuk web modern</a></li>
<li><a href="../id418447/index.html">Mengapa Moscow Python Conf sekarang ++</a></li>
<li><a href="../id418449/index.html">Modul Biner untuk Python</a></li>
<li><a href="../id418451/index.html">Pelajaran pencetakan 3D. Dukungan efektif dan perubahan ketinggian lapisan dalam praktik dari 3Dtool</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>