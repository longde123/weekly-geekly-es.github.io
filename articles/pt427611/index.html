<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úãüèø üé∂ üë®üèª‚Äçüíº A hist√≥ria de como eu atualizei o Yandex MapKit no iOS ou mapas, dinheiro, 2 mappits üë©üèΩ‚Äçüè´ üëÜüèª üçì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pref√°cio 

 Ol√° amigos , no come√ßo, descreverei imediatamente o objetivo do artigo: economizando seu tempo se voc√™ precisar atualizar ou incorporar ma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>A hist√≥ria de como eu atualizei o Yandex MapKit no iOS ou mapas, dinheiro, 2 mappits</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427611/"><h3>  Pref√°cio </h3><br><br>  <b>Ol√° amigos</b> , no come√ßo, descreverei imediatamente o objetivo do artigo: <b>economizando seu tempo</b> se voc√™ precisar <b>atualizar ou incorporar mapas Yandex</b> em seu cliente m√≥vel iOS, al√©m do desejo de compartilhar sua experi√™ncia. <br><br>  Certa vez, criamos o aplicativo YandexMapkit (aproximadamente em outubro de 2017) em vez de cart√µes de e-mail (nada pessoal - apenas neg√≥cios).  Depois de cerca de 3 meses, em um lindo dia de inverno, a vers√£o dos cart√µes Androyd ficou fora de ordem no dia 2 por causa das teclas, o cart√£o acabou se transformando em ab√≥bora) Qual √© a dica do manual: "No android, os cart√µes estavam quebrados, eles n√£o sabem como consert√°-lo". como um cliente iOS, isso n√£o afetou.  Pobres no andr√≥ide ... desta vez os caras n√£o tinham nada a ver.  Naqueles dias <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">, muitas lojas ca√≠ram</a> : o posto da R√∫ssia, o ornitorrinco, talvez voc√™s se lembrem? <br><br><img src="https://habrastorage.org/webt/ny/sl/uk/nysluk1xq_j6lfzmv2tmusk_gci.png"><br><br>  Isso significa que, quando seu aplicativo estiver vinculado a servi√ßos de terceiros, seria bom ter um plano "B" para este caso, por exemplo, alterne para a vers√£o anterior dos cart√µes da Apple e n√£o substitua um pelo outro ... <br><br>  Depois de mais tr√™s meses, em algum lugar de mar√ßo, chegou uma carta da Yandex informando que eles finalmente haviam atualizado o sdk (muito pouco tempo se passou, 4-5 anos a partir da atualiza√ß√£o anterior): <br>  "-Atualize, desligue o antigo em um ano", em suma.  Antes disso, havia simplesmente uma vers√£o antiga 1.0 <br><br><img src="https://habrastorage.org/webt/mk/bn/el/mkbnelhsho-0yzuynyrwg8fw6by.png"><br><a name="habracut"></a><br>  Bem, √© claro, ap√≥s esse aviso, n√£o retiramos e imediatamente iniciamos a transi√ß√£o ... ap√≥s 3 meses)) em agosto. <br><br><h2>  Est√°gio de "comentar"! (Desativar funcionalidade) </h2><br>  Voc√™ diz, ha ... o que √© atualizado l√°, o pod atualizado, corrigido alguns lugares e √© tudo.  Ent√£o, n√£o, pessoal, a nova API de mapas n√£o √© absolutamente compat√≠vel com a antiga e, al√©m disso, como se viu mais tarde, existem muitas necessidades vitais que est√£o prontas para uso na vers√£o antiga e em outras bibliotecas de cart√µes! <br><br>  Portanto, o mapkit 3.0 (ao escrever um artigo vers√£o 3.1 foi lan√ßado), um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">link para a documenta√ß√£o</a> . <br><br>  E por que, al√©m de um aviso da Yandex?  Enquanto isso, em uma vers√£o beta do Xcode 10, um projeto com uma baleia velha n√£o √© estupidamente aceito, porque o C ++ √© usado em algum lugar do interior, o que √© desprezado na nova vers√£o.  √â necess√°rio renome√°-lo na sub-lista, at√© atualiz√°-lo l√°, etc., enfim, n√£o fiz isso, porque no final ainda preciso atualizar <br><br>  1) Atualizamos o sdk, em vez da vers√£o 1.0 imediatamente 3.0, √© claro que a API mudou, mas muito .... <br><br>  Portanto, o antigo protocolo YMKAnnotation est√° simplesmente ausente <br><br><img src="https://habrastorage.org/webt/0y/ma/2j/0yma2jg0ol_cmlsv5iawysjcq4c.png"><br><br><br>  No momento, parece um trecho forjado (n√£o est√° zumbindo e voc√™ sai carregando um sinal "!" Para si mesmo ... Exemplo de implementa√ß√£o de protocolo: <br><br><img src="https://habrastorage.org/webt/6_/7u/uw/6_7uuw9qsz5xa0xydgf5rqeturk.png"><br><br>  Bem, vamos escrever novamente) o nosso, somente em vez do m√©todo coordenate () criaremos as propriedades, tudo √© simples, o m√©todo √© redundante;  title! () √© substitu√≠do por um t√≠tulo n√£o formado (), por outro lado, voc√™ pode criar uma propriedade, bem, muito, onde √© necess√°rio alterar o projeto, ent√£o acabei de remover o ponto de exclama√ß√£o. <br><br>  Em nosso projeto, foi necess√°rio substituir em tr√™s controladores algumas vezes, importar o CoreLocation em outro, pois agora ele n√£o √© importado em nenhum dos cabe√ßalhos do Yandex MapPocket. <br><br>  Para n√£o renomear o familiar YMKMapCoordinate (baleia antiga) ao longo do projeto, fiz tipealias para o YMKPoint (nova baleia) <br><br><img src="https://habrastorage.org/webt/bk/xi/iv/bkxiivvenzq6k_yulfn8thesay8.png"><br><br>  2) Al√©m disso, vamos declarar algumas propriedades que precisaremos no futuro para trabalhar com o mapa, principalmente getters: <br><br><img src="https://habrastorage.org/webt/wx/15/zu/wx15zujdm2ylkpok3cujwbagzog.png"><br><br>  3) A primeira coisa a criar √© o YMKMapView (tudo est√° bem com isso, esse objeto ainda est√° dispon√≠vel).  Anteriormente, eu o inicializei imediatamente, agora voc√™ n√£o pode fazer isso, ele ir√° travar, porque primeiro voc√™ precisa colocar a chave!  A chave atual n√£o funcionar√° e voc√™ precisar√° solicitar uma nova.  Adicione ao AppDelegate, de acordo com a documenta√ß√£o.  Somente ap√≥s definir a chave, podemos criar o YMKMapView e configur√°-lo da maneira que precisamos no m√©todo setupMap () <br><br><img src="https://habrastorage.org/webt/ab/fp/8b/abfp8ba-jefubna2qmqsmsxpg7q.png"><br><br>  O que acontece aqui, analisaremos em detalhes mais adiante, no decorrer da necessidade de configura√ß√µes apropriadas <br><br>  4) O que vem a seguir?, E ent√£o t√≠nhamos o local inicial do CLLocation, mas agora para us√°-lo, voc√™ precisa adicionar a estrutura CoreLocation manualmente ou ... ou substitu√≠-la pelo YMKPoint no Yandex mapkit <br><br><img src="https://habrastorage.org/webt/jw/eo/hj/jweohjs_xdkhqdjhg5ludux4qsi.png"><br><br>  5) Al√©m disso, o mapa estava centrado nessa coordenada por um m√©todo muito simples, mas agora n√£o h√° <br><br><img src="https://habrastorage.org/webt/db/w_/sf/dbw_sf_pf_7nqkfk4wil_mlt8kw.png"><br><br>  Mas h√° um pouco mais complicado e um pouco mais profundo, o objeto do mapa) ... mapView.mapWindow.map! .Move.  Aqui aprendemos sobre a exist√™ncia de um objeto como YMKCameraPosition. <br><br><img src="https://habrastorage.org/webt/6y/hd/lt/6yhdltmfe8hap6p06qzpyk7clj8.png"><br><br>  6) Em seguida, comentamos a configura√ß√£o do mapa, uma vez que n√£o existem tais APIs / propriedades.  Agora, apenas o omitimos para come√ßar pelo menos minimamente. <br><br>  Comentamos sobre a adi√ß√£o de anota√ß√µes (prestarei aten√ß√£o em que essa √© uma funcionalidade padr√£o), tamb√©m comentamos sobre a exibi√ß√£o dos pontos mais pr√≥ximos (isso j√° √© algum tipo de nossa funcionalidade). <br><br>  E todo o YMKMapViewDelegate tamb√©m √© um coment√°rio, que n√£o encontrei na nova estrutura, e um an√°logo semelhante tamb√©m. <br><br><img src="https://habrastorage.org/webt/ug/jg/ix/ugjgixhzbdvdjtqnyz3g-vawas8.png"><br><br>  Omiti a implementa√ß√£o, apenas os m√©todos em si: <br><br>  - se deseja exibir a localiza√ß√£o do usu√°rio, <br>  - quais visualiza√ß√µes usar para pinos, <br>  - rea√ß√£o ao clicar na anota√ß√£o, <br>  - quais frases de destaque para anota√ß√£o, <br>  - A rea√ß√£o ao clicar na frase de destaque, ou seja, tudo o que costumamos usar.  No final, houve algum tipo de m√©todo, que tamb√©m usou um cart√£o API espec√≠fico. <br><br>  <b>TUDO</b> descoberto com o MapVC - esta √© a classe principal em que o mapkit foi usado <br><br>  7) Um pequeno coment√°rio sobre a frase de destaque personalizada, ela n√£o herdar√° mais o YMKCalloutView, n√£o h√° mais na nova baleia. <br><br>  Viva, agora que o projeto se reuniu, eu pude come√ßar tudo e ... ver o caderno na caixa, porque depois que ele come√ßa, voc√™ precisa dar um tempo para se aquecer))), mas eu n√£o sabia e achava que algo n√£o estava portanto, embora eu tenha sugerido que leva tempo para ativar a chave.  Acontece que a suposi√ß√£o estava correta.  Voc√™ precisa esperar cerca de uma hora (talvez algo tenha mudado agora). <br><br>  Com outra tentativa de modificar a API antiga de uma nova maneira, o mapa foi exibido. <br><br><h2>  Etapa dois - "pesquisa" (como implementar a funcionalidade antiga de uma nova maneira) </h2><br>  Vamos come√ßar a restaurar a funcionalidade perdida.  Portanto, voc√™ precisa exibir o bloqueio do usu√°rio, mas da maneira antiga, basta alterar a propriedade e definir o delegado. <br><br>  Agora isso √© feito atrav√©s da camada, consulte o m√©todo 3 do setupMap (), ponto 3. <br><br><img src="https://habrastorage.org/webt/cs/w5/c8/csw5c8t0hyasi5x87xzmgeffs60.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vamos dar uma olhada</a> no exemplo da demonstra√ß√£o ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">download do Yandex github</a> ), j√° que est√° l√°.  A prop√≥sito, voc√™ precisa prestar aten√ß√£o ao setAnchorWith.  Mais tarde vou dizer o porqu√™, est√° associado ao zoom.  Ok, a localiza√ß√£o funciona. <br><br>  2) O que vem a seguir, √© claro, anota√ß√µes.  Voc√™ n√£o pode adicionar da maneira antiga, veremos a demonstra√ß√£o novamente.  H√° uma classe l√° - MapObjectsViewController.  Na nova vers√£o, para adicionar pinos ao mapa, o delegado n√£o √© necess√°rio; para isso, √© necess√°rio acessar a propriedade mapObjects, chamar o m√©todo addPlacemark no objeto e passar a coordenada para l√° (ainda existem outras sobrecargas). <br><br><img src="https://habrastorage.org/webt/-c/au/s4/-caus4cx0bkkkniwy66g8mpqi6k.png"><br><br>  Repetimos a cole√ß√£o de anota√ß√µes (por exemplo, ap√≥s o recebimento do servidor) e adicionamos uma ao mapa.  O m√©todo, a prop√≥sito, retorna ‚ÄúplaceMark‚Äù (r√≥tulo do local), que pode ser usado para fazer configura√ß√µes adicionais, por exemplo, alterar a ordem de exibi√ß√£o atrav√©s da propriedade zIndex. <br><br>  Aqui, no entanto, eu perdi o ponto de que antes disso eu subi para procurar um delegado e n√£o o encontrei com seguran√ßa e nem um √∫nico delegado (na verdade, eles come√ßaram a ser chamados de forma diferente, agora s√£o ouvintes).  Sei pela experi√™ncia anterior com a baleia Apple e a baleia Yandex antiga que as anota√ß√µes s√£o reutilizadas, assim como nas c√©lulas, mas h√° apenas o addPlacemark na demonstra√ß√£o.  √Ä pergunta sobre o lead de cart√µes Yandex (um pequeno conhecido pessoal ajudado aqui) "- Como otimizar o uso de mem√≥ria, reutilizar objetos?"  Resposta: "Por que, ent√£o funciona bem" ... bem, mais ou menos sim, funciona. <br><br>  Nota: 1) √â importante observar que o Yandex.Maps usa um mapkit e n√£o o desenvolve.  Isso √© feito pela equipe do mapkit (apelido de Nikolai no hub - likhogrud @). <br><br>  2) Explica√ß√£o por que os objetos n√£o s√£o reutilizados: <br><br>  Na baleia antiga, annotationViews eram visualiza√ß√µes, elas foram criadas pelo usu√°rio e, √© claro, as visualiza√ß√µes precisam ser reutilizadas, porque cri√°-las n√£o √© barato.  Na nova baleia, os marcadores s√£o criados pelo mapkit diretamente no GL aberto.  E talvez eles sejam reutilizados l√°, mas isso √© impreciso.  De qualquer forma, isso √© muito mais eficiente do que criar uma exibi√ß√£o. <br><br>  3) A partir da nova, a prop√≥sito, existe a possibilidade de modificar o √≠cone de anota√ß√£o para o usu√°rio.  Implementado da seguinte forma: voc√™ precisa adicionar um ouvinte (an√°logo do delegado), implementar o protocolo apropriado - 1 de 3 m√©todos, 2 apenas deixar em branco. <br><br>  Ao mesmo tempo, recarregue o marcador com nossos √≠cones. <br><br><img src="https://habrastorage.org/webt/yq/2t/cv/yq2tcvkmlgp6mxfh5hpppwqgmk4.png"><br><br>  Al√©m disso, chamo sua aten√ß√£o para a propriedade da √¢ncora.  Depois de pressionar o bot√£o de localiza√ß√£o do usu√°rio no mapa, a c√¢mera move o foco para o centro da localiza√ß√£o.  Mas o problema √© que pressionar a a√ß√£o novamente n√£o produz.  O que?  Comentamos o m√©todo √¢ncora e tudo funciona. <br><br>  4) Agora voc√™ precisa mostrar as frases explicativas, respectivamente, para entender o clique.  Existem v√°rios m√©todos nas interfaces, o correto √© YMKMapObjectTapListener.  Existe um m√©todo interessante e importante com o qual tive que me atormentar mais tarde; ele retorna verdadeiro para n√£o integrar ainda mais se um assinante for encontrado.  Chamo sua aten√ß√£o, voc√™ precisa se inscrever primeiro, o mapObjects ser√° assinado (linha 149). <br><br><img src="https://habrastorage.org/webt/ar/2j/gp/ar2jgphtrvt_or_szwtibdupw74.png"><br><br><img src="https://habrastorage.org/webt/9f/rw/zi/9frwzi06e8ur4pyrga4jhv7cyua.png"><br><br>  Portanto, os cliques cumprem.  <b>Viva</b> .  No entanto, houve tentativas de exibir pinos apenas na zona vis√≠vel, isso √© sup√©rfluo, mostra tudo de uma s√≥ vez, ent√£o vamos deix√°-lo (apenas porque n√£o diminui a velocidade) <br><br>  5) Ent√£o eu queria fazer os bot√µes aumentar / diminuir o zoom por conveni√™ncia.  Um pouco de copiar e colar e editar por analogia com o bot√£o de localiza√ß√£o, e pronto. <br><br>  Al√©m disso, como sabemos sobre a c√¢mera, use o m√©todo de movimenta√ß√£o e, consequentemente, o zoom atual + - 1 ou 0,5, conforme necess√°rio.  Est√° tudo bem aqui. <br><br><img src="https://habrastorage.org/webt/ar/_s/-p/ar_s-pit7r4wjzzbrbgyiylgm00.png"><br><br>  6) Passamos √† chamada principal funcional (este √© um ret√¢ngulo com informa√ß√µes adicionais, com um tri√¢ngulo na parte inferior).  Acontece que n√£o h√° API (‚Äúintoxicante no ver√£o‚Äù - o Yandex reconheceu meu discurso quando leio notas de um folheto para n√£o digitar manualmente este artigo). <br><br><img src="https://habrastorage.org/webt/ck/b3/ew/ckb3ewygj9uy3itbzrlq63wqtfk.png"><br><br>  Como voc√™s est√£o?  100 500 aplicativos usam uma frase de destaque. <br><br>  Escrevemos bem em "suporte t√©cnico" (Kolya) como fazer isso manualmente, eu descubro.  Quais s√£o as suas op√ß√µes? <br><br>  <s>Converta a vista em uma imagem, j√° que voc√™ n√£o pode adicionar diretamente uma vista</s> (adicionado um arquivo no 3.1), altere o √≠cone ... <br><br><img src="https://habrastorage.org/webt/tz/w2/qd/tzw2qdppbx86whmrgmqqzmhysge.png"><br><br>  Essas muletas s√£o obtidas em um apartamento, parecia lugar. <br>  De fato, n√£o muletas, √© claro, mas simplesmente a aus√™ncia que considero a funcionalidade b√°sica <br><br>  7) Ok, vamos primeiro adicionar um texto explicativo de teste, como tal, usamos um quadrado vermelho.  Assim, clicando em nosso alfinete, o m√©todo delegado / ouvinte √© chamado, onde o ponto de clique e o objeto s√£o transferidos.  Sem esperar um truque, consideramos "point" como o ponto em que voc√™ deseja adicionar a frase de destaque.  (Aten√ß√£o, tudo foi feito corretamente: ‚ÄúEles clicaram, entenderam e amarraram?‚Äù Cerca de 80% responderam corretamente, 20% - n√£o) <br><br><img src="https://habrastorage.org/webt/9f/rw/zi/9frwzi06e8ur4pyrga4jhv7cyua.png"><br><br>  E chame o m√©todo auxiliar showCallout no corpo do m√©todo: <br><br><img src="https://habrastorage.org/webt/sq/aa/8w/sqaa8wmstqdunxobdbyr0xa0jg4.png"><br><br>  linha 544 <br>  No interior, crie uma visualiza√ß√£o de teste da cor vermelha de quarenta por quarenta, converta-a em uma imagem, declare um x constante com um valor de 0,5; ela ser√° usada para a posi√ß√£o do tri√¢ngulo da chamada no meio do ponto.  Ele recusou a ideia de mudar de posi√ß√£o, mais tarde preferiu mover a c√¢mera para que a frase de destaque selecionada fosse exibida no meio da tela do telefone. <br><br>  Em seguida, declaramos a √°rea "push" de tappableArea, existe uma propriedade no estilo de √≠cone do pino.  Bem, voc√™ pode limitar a zona de cliques, e n√≥s o faremos.  A zona varia de 0,0 a 1,1.  precisamos da parte inferior, onde supostamente existe um bot√£o que foi transformado em imagem antes (lembre-se).  Ok, isso significa a zona (0,0,5 - 1,1), pois o bot√£o est√° abaixo. <br>  A restri√ß√£o de zona funciona, mas h√° uma nuance, de tal modo que ela nega tudo.  Se houver outro pino sob a √°rea n√£o prensada, a press√£o funcionar√° nele.  O significado desta √°rea?  Eles fariam uma bandeira ou algo assim para que o clique n√£o passasse.  Ok ... <br><br>  Linha 550 <br>  vamos criar um estilo para o √≠cone, voc√™ pode especificar imediatamente a posi√ß√£o da √¢ncora no primeiro par√¢metro, por exemplo, fiz abaixo na linha 557.  A posi√ß√£o y √© 1,05 para elevar o tri√¢ngulo acima do pino novamente na vertical <br><br>  Linha 559 <br>  crie nossa frase de destaque personalizada de um determinado tamanho, <br>  configuramos os campos necess√°rios usando as informa√ß√µes da anota√ß√£o selecionada selectedAnnotation, em particular o t√≠tulo e o subt√≠tulo, a inscri√ß√£o no bot√£o para esta frase de destaque.  Ent√£o voc√™ mesmo pode fazer o que quiser.  A anota√ß√£o selecionada √© definida anteriormente no delegado.  Mas, por enquanto, adicione o quadrado vermelho criado anteriormente <br>  Em seguida, adicione um alfinete √† cole√ß√£o mapObjects, o m√©todo retornar√° o marcador adicionado para n√≥s, salve-o em uma vari√°vel, <br>  Ao clicar no texto explicativo em si, um controlador detalhado √© aberto e, assim, a nuance √© que, se no pino pop-up outro pino tamb√©m aparecer, o delegado funcionar√° novamente; portanto, √© necess√°rio alterar a ordem na hierarquia atrav√©s do zIndex.  Defina a visibilidade e mova nossa chamada de destaque para o centro na linha 564 <br><br>  <b>Nuances</b> : o marcador de vari√°vel √© um ponteiro para a frase de destaque. <br>  No come√ßo, n√£o temos, depois de clicar no alfinete, ao que parece, depois de clicar no pr√≥ximo alfinete, precisamos excluir nossa primeira frase de destaque e adicionar uma nova.  Portanto, se o marcador de vari√°vel! = Nil, voc√™ precisar√° remover a frase de destaque antiga da cole√ß√£o mapObjects) <br><br><img src="https://habrastorage.org/webt/3r/fo/dg/3rfodg0siuahk0tsvk1qzyvydae.png"><br><br>  Al√©m disso, no caso de tapas no cart√£o, voc√™ precisa ocultar a frase de destaque; portanto, no m√©todo delegado, atribu√≠mos um marcador, o observador trabalha, a frase de destaque √© exclu√≠da e a anota√ß√£o selecionada √© apagada. <br><br>  Para isso, inscrevemos-se no YMKMapInputListener anteriormente <br><br><img src="https://habrastorage.org/webt/ew/f-/a2/ewf-a2uvc7khz8okkxw-s6etxds.png"><br><br>  <s>Por sua vez, o m√©todo para converter visualiza√ß√µes √© o seguinte.</s>  (Na vers√£o 3.1, foi adicionada a capacidade de adicionar visualiza√ß√µes ao mapa) <br>  N√£o descrevo como fazer a visualiza√ß√£o), mas se houver muitos problemas (√© poss√≠vel com um tri√¢ngulo) com isso, escreva, acrescentarei esta etapa <br><br><img src="https://habrastorage.org/webt/v1/mx/nk/v1mxnkmtkahrp5j6umoevtwadlc.png"><br><br>  A m√°gica 20 adicionada √† altura √© necess√°ria para um lugar abaixo do tri√¢ngulo abaixo, que voc√™ ter√° que desenhar <br><br>  Tamb√©m queremos que o pop-up apare√ßa (seja anexado) ao pino em um local espec√≠fico (esquerda, direita, no meio), pois existe uma propriedade √¢ncora.  Definido da seguinte forma: <br>  Dividimos a √°rea vis√≠vel do mapa em 3 zonas verticais e determinamos em qual delas estamos, dependendo disso, alteramos a posi√ß√£o da encaderna√ß√£o.  No exemplo de c√≥digo, verificamos se estamos do lado esquerdo, por analogia, para o meio, se n√£o para a esquerda e para o meio, respectivamente, o ponto √† direita √© <br><br><img src="https://habrastorage.org/webt/o-/xq/ii/o-xqiijbnowv2clav2ny2tl5drc.png"><br><br>  Uma fun√ß√£o auxiliar para verificar se um ponto cai em uma regi√£o: <br><br><img src="https://habrastorage.org/webt/dr/os/5e/dros5emmil06hsac_h-rdbwk_jq.png"><br><br>  Iniciar.  Isso funciona.  Mas h√° uma nuance, parece que estamos tentando ampliar um, dois, tr√™s, e a frase de destaque voa para longe do alfinete.  O que?  Como <br><br><img src="https://habrastorage.org/webt/9v/il/7f/9vil7fru-hbitdlkvqtu6oeyhnw.gif"><br><br>  7) Come√ßamos a depura√ß√£o, as coordenadas s√£o as mesmas <br><br><img src="https://habrastorage.org/webt/tt/t1/u1/ttt1u1jgezg-_ld3n_ksj-e_m90.png"><br><br>  Houve tentativas de entender o que est√° acontecendo e como funciona, outro retorno √† demo, uma busca ainda mais atenta √†s diferen√ßas ... <br><br><img src="https://habrastorage.org/webt/oc/nb/d_/ocnbd_n89jitplbg4_dtukbnvlo.jpeg"><br><br>  Percebo que as coordenadas s√£o transmitidas diretamente, e n√£o a que est√° na torneira!  Mas eu fiquei desapontado, √© claro que as coordenadas s√£o as mesmas, ou seja, o c√≠rculo e o quadrado t√™m a mesma coordenada. <br>  Por isso, no m√©todo, n√£o acessei imediatamente o objeto, mas passei o ponto, que est√° incorreto. <br><br><img src="https://habrastorage.org/webt/9f/rw/zi/9frwzi06e8ur4pyrga4jhv7cyua.png"><br><br>  Mas voc√™ precisa converter um objeto, obter uma propriedade (em todos os lugares tudo √© chamado de maneira diferente, depois coordenar, depois apontar, aqui agora geometria) isso √© criativo ou n√£o?  493 linhas <br><br><img src="https://habrastorage.org/webt/_u/oo/5h/_uoo5hjrg5okyoodbijb7s0rzzo.png"><br><br>  Como precisamos processar duas op√ß√µes prementes: a primeira a fixar, a segunda a destacar e n√£o a processar cliques se clicarmos no mesmo pino novamente, a <b>primeira</b> coisa que fazemos √© encontrar o pino em que clicamos na cole√ß√£o de pinos, comparando coordena a linha 495; caso contr√°rio, retorne verdadeiro, dizendo que processamos o clique e n√£o precisamos ir mais longe na hierarquia <br><br>  <b>Segundo</b> : determinamos isso clicando no alfinete ou na frase de destaque, tamb√©m comparamos as coordenadas dos r√≥tulos das 499 linhas.  Teste de Igualdade: <br><br><img src="https://habrastorage.org/webt/xd/z5/lk/xdz5lkm2g-zehkggfea6rqdxkfa.png"><br><br>  <b>Al√©m disso,</b> se este √© um texto explicativo e queremos responder a um clique no bot√£o (ou simular, j√° que agora √© uma imagem), e n√£o a toda a √°rea, precisamos fazer alguns c√°lculos com canetas :) <br><br><ol><li>  Converter coordenadas mundiais na tela da linha 501 <br>  N√≥s nos consideramos: converteremos as coordenadas do mapa em tela, saberemos onde estamos localizados e, adicionando a largura e a altura da vista, obteremos os pontos de canto, mas por algum motivo eles n√£o coincidem e eu multiplico manualmente por tr√™s, no meu caso para o 10¬∫ iPhone)).  Como se viu depois, esqueci e n√£o levei em conta o n√∫mero de pixels por ponto.  Que podemos ter 1x, (um ponto 1 pixel), 2x, 3x um ponto √© tr√™s pixels. </li><li>  Vamos calcular a altura do bot√£o - a altura da frase de destaque + a altura do tri√¢ngulo multiplicado pela escala, informa√ß√µes sobre a escala (linha 498).  Em seguida, dividimos tudo isso em dois, pois a altura do bot√£o √© metade da altura da frase de destaque </li><li>  Em seguida, calculamos as coordenadas dos √¢ngulos, com base no fato de que a √¢ncora (x: 0,5, y: 1), dada a escala e a √°rea do tri√¢ngulo)) </li><li>  Em seguida, converta essas coordenadas da tela em mundo </li><li>  Crie uma √°rea vis√≠vel com base nelas, √© uma zona de bot√£o </li><li>  E verificamos se atingimos a zona dos bot√µes ou n√£o.  Se voc√™ acertar, verifique o tipo de anota√ß√£o, dependendo do tipo que chamamos de m√©todo: v√° para a tela detalhada ou selecione esta loja para entrega nos casos com StorePoint </li></ol><br>  Caso contr√°rio, √© apenas um clique no alfinete e precisamos adicionar uma frase de destaque, o que realmente fizemos acima. <br><br>  Isso √© tudo, desde que voc√™ conheceu a nova baleia. <br><br>  <s>O que mais eu quero dizer, na implementa√ß√£o atual dos mapas do mapkit, ele cont√©m muitas funcionalidades que n√£o s√£o usadas, isso tamb√©m afeta o tamanho do bin√°rio resultante.</s>  <s>Voc√™ est√° pronto para esses sacrif√≠cios? No futuro, os caras devem ser demolidos em m√≥dulos, afinal</s> .  Tamb√©m ouvi de colegas no androide do workshop que existem problemas de compatibilidade com o Kotlin. <br><br>  P.S.  Enquanto eu decidi e comecei a escrever um artigo, a atualiza√ß√£o 3.1 saiu, onde os problemas acima foram resolvidos e implementados: <br><br>  Adicionado <br><br>  Para o Android, apareceram as compila√ß√µes arm64 e x86. <br>  <b>Voc√™ pode adicionar qualquer objeto View ao mapa.</b> <b><br></b>  O roteamento de bicicletas apareceu. <br>  Adicionadas anota√ß√µes anul√°veis ‚Äã‚Äãpara o Android. <br><br>  Alterado <br><br>  <b>O MapKit √© dividido em partes:</b> <b><br></b>  MapKit - apenas um mapa; <br>  Dire√ß√µes do MapKit - roteamento de autom√≥veis; <br>  Transporte MapKit - roteamento de pedestres, roteamento de transporte p√∫blico e roteamento de bicicleta; <br>  Pesquisa no MapKit - pesquisa e geocodifica√ß√£o; <br>  MapKit Places - panoramas. <br>  Para iOS, as anota√ß√µes anul√°veis ‚Äã‚Äãse tornaram mais rigorosas. <br><br>  Fixed <br><br>  V√°rios bugs foram corrigidos. <br>  Melhor desempenho. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tech.yandex.ru/maps/doc/mapkit/3.x/concepts/versions-docpage</a> <br><br>  <b>Escreva seus coment√°rios, perguntas.</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt427611/">https://habr.com/ru/post/pt427611/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt427601/index.html">Caso 5 + 1 em que a especifica√ß√£o da API REST desempenha um grande papel</a></li>
<li><a href="../pt427603/index.html">Como finalmente come√ßar a escrever testes e n√£o se arrepender</a></li>
<li><a href="../pt427605/index.html">Como a plataforma de crowdsourcing da Yandex ajuda a treinar drones e avaliar a qualidade do servi√ßo</a></li>
<li><a href="../pt427607/index.html">Datacenter na Su√≠√ßa: trabalhar como um rel√≥gio</a></li>
<li><a href="../pt427609/index.html">Resolvendo a equa√ß√£o com divis√£o inteira sem for√ßa bruta</a></li>
<li><a href="../pt427613/index.html">10 blogs √∫teis para programadores em ingl√™s</a></li>
<li><a href="../pt427615/index.html">Pare de criar sites de rolagem infinitos«É</a></li>
<li><a href="../pt427617/index.html">Evolu√ß√£o dos vag√µes</a></li>
<li><a href="../pt427623/index.html">3 livros sobre C ++ 17 (em ingl√™s)</a></li>
<li><a href="../pt427625/index.html">Como escrever um scanner de vulnerabilidades e ganhar dinheiro com explora√ß√µes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>