<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’‡ğŸ¾ ğŸ£ ğŸ’² Balada Transfer Data ğŸ âœŠğŸ¿ ğŸ‘‚ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pada baris pertama pendarahan teks saya, saya ingin mengatakan yang berikut: Sudah banyak ditulis tentang ini, saya juga akan menulis visi saya. Antar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Balada Transfer Data</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/398791/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pada baris pertama pendarahan teks saya, saya ingin mengatakan yang berikut: Sudah banyak ditulis tentang ini, saya juga akan menulis visi saya. </font><font style="vertical-align: inherit;">Antarmuka standar untuk mengirimkan informasi sangat bagus, tetapi untuk kebutuhan saya, mereka tidak memberikan transfer data yang cukup memuaskan (baik, atau hampir). </font><font style="vertical-align: inherit;">Saya akan mencoba membuat beberapa tambahan untuk membawa ini ke keadaan yang cocok untuk saya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada 2 atau lebih perangkat pada jarak yang cukup besar (1-100 meter) di mana data harus dikirim. Setelah memeriksa beberapa antarmuka (rs232 / 422/485, I2C, Ethernet), saya sampai pada kesimpulan bahwa mereka tidak menjamin transfer data yang jelas, saya tidak suka banyak kabel juga, mereka tidak memberikan jawaban bahwa informasi diterima. Saya memutuskan untuk menggunakan antarmuka RS485 sebagai basis - ia bisa jauh dari kelebihannya, 2 kabel, Anda dapat menghubungkan banyak perangkat pada saat yang sama, sederhana, (UART) ada di hampir semua pengontrol.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Dalam kasus saya, skema klasik 1 yang memimpin para budak lainnya cocok untuk saya. Algoritma olahpesan adalah sebagai berikut: data ditransmisikan dalam siklus pertukaran, satu siklus pertukaran terdiri dari pesan yang ditransmisikan dari master ke slave, sebagai respons master menerima pesan dari slave, semua yang lain diam. Atas dasar yang sama, terapkan permintaan untuk data dari perangkat budak. </font></font><br>
<br>
<img src="https://habrastorage.org/files/e4e/48e/048/e4e48e048a5e4cd08723865418a0e25a.png" alt="gambar"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Satu siklus pertukaran.</font></font></em><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Untuk memenuhi kebutuhan transfer data saya, saya hanya perlu menyelesaikan dua pertanyaan. Pertanyaan satu: memeriksa byte yang ditransmisikan didasarkan pada antarmuka RS-485 itu sendiri, tetapi itu tidak menjamin byte yang ditransmisikan secara andal - jika byte ditemukan dalam antarmuka itu sendiri, ia dilempar keluar dari data yang diterima, tetapi masih mungkin untuk mentransfer byte yang salah - jika telah berubah (rusak) ) jumlah genap dalam satu byte. yaitu diperlukan pemeriksaan untuk jumlah byte yang dikirimkan dan validitas byte dalam data yang dikirimkan. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Pertanyaan dua: menerima pesan tanggapan dari pesan yang dikirim. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Pada pertanyaan pertama: skema ini diusulkan: byte awal, byte jumlah </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 karakter yang ditransmisikan dalam seluruh pesan, sesuatu yang lain, byte checksum (BCS), byte terakhir.</font></font><br>
 <br>
<img src="https://habrastorage.org/files/a00/e71/e60/a00e71e60f3a40d1affd859b411afe89.png" alt="gambar"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catatan: byte checksum harus dianggap modulo 2.</font></font></em><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Berdasarkan skema yang diusulkan, dapat dinilai bahwa jika jawabannya tidak kembali, maka pengikut tidak tersedia. Dalam hal ini, opsi dimungkinkan ketika pesan yang rusak mencapai pengikut dan dia tidak menanggapi, atau pesan mencapai dia dan dia mengirimkan jawabannya, tetapi jawabannya memburuk dan pemimpin mengabaikannya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk memperbaiki ini, diterima: jika jawabannya tidak datang (atau datang tetapi tidak dapat diandalkan), maka ulangi (berapa kali tanpa kegilaan) ulangi siklus pertukaran saat ini. Kesalahan berikut dapat terjadi di sini. Misalkan kita mengirim perintah yang memberi tahu perangkat bahwa Anda perlu menaikkan volume dengan +1 unit. Ketika pesan mencapai budak, ia mengeksekusi perintah untuk menaikkan volume dan mengirimkan respons "ok, saya lakukan seperti yang Anda inginkan", tetapi mungkin ternyata jawabannya memburuk dan presenter tidak mengerti bahwa perintah telah dieksekusi, dan mengirim pesan lagi. Akibatnya, setelah menerima perintah di sisi slave, volume sudah akan ditambahkan +2 unit. Untuk menghindari fenomena ini, adalah kebiasaan untuk memperkenalkan pengidentifikasi (nomor pesan NS) dari perbedaan pesan. Jika nomor pesan diulang, maka ini adalah pesan yang diulang dan perintah yang ditentukan tidak perlu dieksekusi,tetapi hanya mengirim pesan balasan sebelumnya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya juga memasukkan 2 parameter lagi di sini - ini adalah nomor (kode) perangkat yang datanya ditransmisikan dan angka (subkode) yang menunjukkan perintah mana yang harus dieksekusi (atau data apa yang ada di dalam pesan). </font></font><br>
 <br>
<img src="https://habrastorage.org/files/2ca/3d8/226/2ca3d82263eb48e6a0b566ba824c917a.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai hasilnya, saya akan menggabungkan semuanya dan menelusuri algoritma, menggunakan contoh meningkatkan ambang relai oleh suhu sebesar 5 derajat Celcius dan mengambil pembacaan suhu saat ini dari budak untuk 1 siklus pertukaran: Saya </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
menghasilkan data yang ditransmisikan dari master: </font></font><br>
<br>
<img src="https://habrastorage.org/files/c7a/172/c23/c7a172c23c3d4a9886481ce1c052304a.PNG" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika pesan diterima, budak melihat 2 byte, di mana jumlah byte yang dikirim, jika jumlah byte yang dikirim sama dengan jumlah yang diterima, maka pesannya tidak hilang byte, maka kita melihat byte awal (karakter) jika = '$', dan juga byte akhir (karakter) jika = # '- ini adalah pesan dari bepergian ke budak.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Segera saya akan mempertimbangkan opsi pesan yang mungkin dari master ke slave dengan kesalahan dalam byte awal dan akhir, serta opsi dengan kesalahan dalam jumlah byte dalam pesan. </font><font style="vertical-align: inherit;">Saya akan melakukan reservasi segera dari 3 nilai parameter yang akan saya pertimbangkan dengan benar 2 dan 3, yaitu </font><font style="vertical-align: inherit;">jika 2 parameter dari 3 kemungkinan bersamaan, saya anggap pesan tersebut valid.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. mulai byte = '$', jumlah byte yang diterima = 7 (jumlah byte yang dikirim = 7), byte akhir tidak sama dengan '#'; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 2. byte awal tidak sama dengan '$', jumlah byte yang diterima = 7 (jumlah byte yang dikirim = 7), byte terakhir = '#'; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 3. mulai byte = '$', jumlah byte yang diterima = 7 (jumlah byte yang dikirim = 7, jumlah byte yang bukan 7), byte terakhir = '#'.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, kami menghitung checksum dari 3 byte yang tersisa (byte 3, 4, 5), jika itu bertepatan dengan BCS, kami melanjutkan penguraian data, kami mencari perangkat ini untuk data ini dan apa yang harus dilakukan, dalam kasus kami kode slave adalah 55 dan subcode 2 mengatakan tentang perlunya menambahkan 5 derajat ke ambang relai dan dalam pesan respons untuk mengirim data suhu saat ini. Saya memeriksa NS jika tidak sama dengan nomor pesan sebelumnya maka saya menjalankan perintah dan menambahkan 5 derajat ke nilai saat ini dari ambang relai. Jika mereka sama (NS), maka saya tidak melakukan tindakan yang ditunjukkan, maka saya melanjutkan ke pembentukan pesan respons.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
penerapan skema ['$'] [jumlah byte yang dikirim / diterima] [...] ['#'] - dengan jaminan probabilitas tinggi bahwa kombinasi tersebut tidak akan dapat ditemukan dalam data yang dikirimkan, dan memancing pesan palsu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya membentuk data yang dikirimkan dari budak berdasarkan pesan yang diterima:</font></font><br>
<br>
<img src="https://habrastorage.org/files/f0e/f6a/e05/f0ef6ae05be5437daf087ce6681ea795.PNG" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prinsip pemrosesan adalah sebagai berikut: lihat 2 byte di mana jumlah byte yang dikirim terletak, jika jumlah byte yang dikirim sama dengan jumlah byte yang diterima dan juga byte awal = '@' dan byte akhir = '&amp;' - ini adalah pesan dari slave ke master. Jika diperlukan, saya menggunakan mekanisme 2 dari 3, mirip dengan yang dijelaskan di atas hanya untuk pesan respons (untuk karakter '@' dan '&amp;'). Saat menerima pesan ini, tuan rumah menganalisis checksum 9 (dari tanggal 3 ke 11), jika checksum cocok, data dalam pesan dianggap dapat diandalkan dan analisis data lebih lanjut berlanjut. Jika kode, subkode, dan NS dari pesan yang dikirim dan diterima bertepatan, kami terus menganalisis respons terhadap pesan yang dikirim oleh tuan rumah. Berikutnya adalah analisis data yang diterima,dalam kasus saya, pada byte ke-6, nilai 1 berarti bahwa perintah untuk meningkatkan 5 derajat ke ambang relai berhasil, 5 byte sisanya menunjukkan pembacaan suhu saat ini; byte ke-7 adalah bendera yang menunjukkan keandalan suhu yang ditransmisikan (mis. Saya mempertimbangkan opsi yang dihidupkan dan direspons oleh budak, tetapi sensor mungkin tidak berfungsi) dan 4 byte dari tipe nilai suhu float.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penggunaan 2 karakter uji di awal dan akhir pesan dengan probabilitas tinggi menjamin bahwa jika terjadi kesalahan tidak akan membingungkan pesan dari slave dan master. Juga data acak (bukan acak) di saluran tidak akan merusak pertukaran. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Sedikit tentang transmisi data dari budak ke budak, dan pesan terpusat untuk semua budak dari master.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Pertama, yang terakhir - transmisi dari master oleh slave dilakukan dengan menetapkan kode perangkat 255, yang memberi tahu slave bahwa ini adalah pesan terpusat, kemudian tetap hanya untuk menyelesaikan masalah subkode umum, juga dimungkinkan untuk dikelompokkan berdasarkan kode perangkat yaitu. menetapkan kode perangkat 254 dan 3 atau 4 perangkat akan menerima pesan menggunakan kode ini, sisanya akan mengabaikannya, tentu saja, bagian dari mengirim respons dari budak tidak boleh bekerja di sini, yaitu tidak dijamin bahwa para pengikut dengan jelas menerima pesan-pesan ini!</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Pada transmisi data dari budak ke budak, diimplementasikan oleh master mengirimkan pesan ke budak (slave1) dari mana informasi harus dikirim ke budak lain (slave2), slave1 mengirimkan respons ke master sementara slave2 mendengarkan jawaban ini mengambil data ke dirinya sendiri. Sekali lagi, tidak ada jaminan pengiriman pesan yang jelas dari slave1 ke slave2, ini harus diperhitungkan! </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemampuan antarmuka jumlah perangkat yang terhubung secara teoritis sekitar 250, perintah / tipe data hingga 248 untuk setiap perangkat, panjang informasi yang berguna dalam pesan adalah hingga 250 byte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bicara tentang perangkap:</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Semua transfer data dirancang untuk bekerja tepat waktu yaitu penundaan tertentu antar pesan harus diperhatikan. Saya juga merekomendasikan Anda untuk membuat penundaan yang tetap antara pesan yang dikirim oleh master dan respons dari slave sehingga slave dapat menghasilkan data dan sepenuhnya mengirimkannya ke saluran. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Momen pengorganisasian respons dari budak juga penting, mungkin saja budak itu sibuk dan memiliki beberapa pesan data di salurannya sekaligus, Anda harus menghindari balasan ke pesan yang sudah usang (karena pemimpin tidak lagi menunggu untuk mereka) mengabaikannya, hanya menjalankan perintah dari yang terbaru pesan dan berikan jawaban untuk itu.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Secara terpisah, saya ingin menyoroti masalah sinkronisasi perangkat berdasarkan waktu - harus diingat bahwa sinkronisasi waktu dari budak ketika menerima pesan memerlukan dengan mempertimbangkan waktu tunda untuk mengirim data ke saluran (pada kecepatan 9600, pesan 10 byte akan dikirimkan sekitar 11 ms) dan saat gangguan terputus pada akhirnya. menerima data di sisi slave, jika tidak ada gangguan, ada baiknya mempertimbangkan waktu memeriksa kedatangan data di buffer perangkat, dll. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Perlu juga dicatat bahwa pengiriman ulang loop pesan juga menambah nuansa, saya sarankan menggunakan pengiriman pesan tanpa pengulangan untuk sinkronisasi waktu, dan menulis pesan dengan NS baru. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya ragu bahwa saya menemukan sesuatu yang baru di sini, semua ini sampai batas tertentu digunakan di suatu tempat di antarmuka yang berbeda! </font><font style="vertical-align: inherit;">Dengan sedikit tangan penulis coretan ini dan penerapan protokol ini dalam perkembangan saya, saya ingin memberi nama pada protokol transfer data ini "SRDB2".</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id398791/">https://habr.com/ru/post/id398791/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id398781/index.html">STM32 debugging nirkabel</a></li>
<li><a href="../id398783/index.html">Paket Layanan Keamanan Jaringan dan Utilitas oidcalc</a></li>
<li><a href="../id398785/index.html">Di dasar Teluk Meksiko ditemukan sebuah danau beracun</a></li>
<li><a href="../id398787/index.html">Di pinggiran kota Moskow menggunakan printer 3D dalam 20 jam untuk membangun rumah</a></li>
<li><a href="../id398789/index.html">Jaringan saraf memprediksi kesan pertama seseorang oleh wajahnya</a></li>
<li><a href="../id398793/index.html">Pena untuk komputer atau komputer untuk pena?</a></li>
<li><a href="../id398795/index.html">Solusi pendidikan LEGO Education. Apa yang bisa anak-anak Anda tumbuh dewasa</a></li>
<li><a href="../id398797/index.html">EA Games and Origin melarang seluruh negara karena sanksi AS</a></li>
<li><a href="../id398801/index.html">Dunia Jejak Abadi</a></li>
<li><a href="../id398803/index.html">11.11: buaian untuk penjualan cepat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>