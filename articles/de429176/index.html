<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍿 🙇🏿 👧🏼 Stream Analytics: Schnellstart mit SAS ESP 🚶🏽 🎢 🧘🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Verwendung von Analysealgorithmen im Datenstrom ist heute eine der dringendsten Aufgaben im Bereich des Aufbaus von Analysesystemen. Viele hochprä...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Stream Analytics: Schnellstart mit SAS ESP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sas/blog/429176/">  Die Verwendung von Analysealgorithmen im Datenstrom ist heute eine der dringendsten Aufgaben im Bereich des Aufbaus von Analysesystemen.  Viele hochpräzise Vorhersagemodelle, die beispielsweise auf der Grundlage von Messwerten von Sensoren von Industrieanlagen entwickelt wurden, sind bereit, schwere Industrieunfälle zu verhindern. Dazu müssen sie jedoch an Endgeräten („Edge-Geräten“) durchgeführt werden, bei denen Messwerte von Sensoren in Echtzeit erfolgen.  Das Produkt SAS Event Stream Processing wird aufgerufen, um dieses Problem zu lösen und Analysen auf "online" zu übertragen.  In dieser Veröffentlichung möchte ich die Erfahrungen mit der Konfiguration anhand eines Beispiels für ein angewandtes Problem teilen - der Analyse von Bildern von Videokameras. <br><br><img src="https://habrastorage.org/webt/q3/v9/2k/q3v92kdx036qyngrxp-ndx7w7km.png"><br><a name="habracut"></a><br><h3>  Technologie </h3><br>  SAS ist seit vielen Jahren in der SAS-Produktlinie präsent und entwickelt eine eigene Stream-Verarbeitungslösung, SAS Event Stream Processing (im Folgenden: ESP).  Die Hauptaufgabe der Entwickler bestand darin, eine hohe Leistung zu erzielen, die um Größenordnungen höher ist als die auf dem Markt vorhandenen Lösungen.  Zu diesem Zweck haben sie während der Entwicklung von ESP die Speicherung von Zwischenberechnungen und Indizes auf der Festplatte vollständig aufgegeben.  Alle Stream-Konvertierungen werden im RAM durchgeführt, und die ereignisspezifische Nachzählung bleibt erhalten. <br><br><img src="https://habrastorage.org/webt/_f/ry/6r/_fry6rq07g-c2mwytu_n0thqpp0.png"><br>  <i>Arbeiten Sie mit dem Speicher in SAS ESP.</i>  <i>Das Ereignis-Repository im RAM speichert Zwischenergebnisse und wird bei parallelen Zugriffen auf interne oder externe Prozesse aufgrund zusätzlicher Indizes nicht blockiert.</i> <br><br>  Die Engine kann große Datenströme verarbeiten - bei mehreren Millionen Ereignissen pro Sekunde.  Gleichzeitig unter Beibehaltung einer geringen Latenz nahm er schnell seinen Platz in Lösungen für Online-Marketing und Betrugsbekämpfung in Banken ein.  Dort ist es ein intelligenter Filter für Kundenvorgänge, der nicht standardmäßige Aktivitäten auf Konten sofort erkennt und betrügerische Vorgänge vom Datenstrom isoliert. <br><br>  Dies ist jedoch immer noch ein sekundäres Merkmal von ESP.  Die Engine ist als Mechanismus für die kontinuierliche Verwendung von Analysemodellen (SAS, C, Python und andere) im Datenstrom konzipiert. <br><br><img src="https://habrastorage.org/webt/2m/qg/st/2mqgstvtjf69ku-dd-9elmuooii.png"><br>  <i>Das Prinzip der Streaming-Ereignisverarbeitung.</i> <br><br>  Als anschauliches Beispiel haben wir bei SAS für das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SAS Viya Business Breakfast-</a> Forum beschlossen, einen Demo-Stand einzurichten, der als Grundlage für die Bildanalyse dient.  Und so haben wir es eingerichtet und sind dabei auf etwas gestoßen. <br><br><h3>  Videoanalyse streamen </h3><br>  Wir verfügten über ein Analysemodell, das von Kollegen aus der Abteilung für eingehende Analysen auf der SAS Viya-Plattform erstellt wurde.  Sein Kern war, dass ein Algorithmus (in diesem Fall ein trainiertes Faltungs-Neuronales Netzwerk) beim Empfang eines Eingabebildes eines Fahrers im Fahrzeuginnenraum das Verhalten des Fahrers nach den Klassen klassifizierte: „normales Fahren“, „abgelenkt durch ein Gespräch mit einem Passagier“, „weiterreden“ Telefon “,„ schreibt SMS “usw. <br><img src="https://habrastorage.org/webt/q3/v9/2k/q3v92kdx036qyngrxp-ndx7w7km.png" align="left">  <i>Ein Beispiel für das Modell: Das Eingabebild wird basierend auf dem Teil des Bildes, auf dem die Hand mit dem Telefon getroffen hat, als "SMS schreiben" klassifiziert.</i> <br><br>  Es stellte sich die Frage, wie dieser Algorithmus in Echtzeit ausgeführt werden kann, um auf unerwünschtes Verhalten reagieren zu können.  Entsprechend dem Szenario fielen Bilder von der Kamera im Online-Modus bereits in Form von Dateien in das Netzwerkverzeichnis auf der Festplatte. <br><br>  Alles, was blieb, war: Stellen Sie eine Verbindung zu den Daten her, konvertieren Sie die Bilder in das gewünschte Format, wenden Sie das Modell an und gehören Sie höchstwahrscheinlich zu einer Verhaltensklasse. Zeigen Sie Echtzeitwarnungen auf Online-Dashboards an.  Und es stellte sich heraus, dass all dies in der SAS ESP-GUI ohne eine einzige Zeile Programmcode (!) Konfiguriert werden kann. <br><br><h3>  SAS-Ereignisstromverarbeitung </h3><br><img src="https://habrastorage.org/webt/t4/3w/ca/t43wcat2jtk84v43qaztpzw6yfg.png" width="300" align="left">  <i>Gefahrenerkennungsprojekt in der grafischen Oberfläche von SAS ESP Studio.</i> <br clear="left">  Im grafischen ESP-Editor haben wir die folgenden Datenflusstransformationen hinzugefügt: <br><br><ol><li> Als Eingabe haben wir zwei Knoten vom Typ source: model_source und input_image.  In model_source veröffentlichen wir unser Klassifizierungsmodell.  Konfigurieren Sie dazu den Datei-Connector, der einen Befehl aus einer Textdatei liest, die drei Parameter enthält: den Namen der Operation, den Typ des Modellformats und den physischen Pfad zur Binärdatei.  ESP bleibt hinter jeder Datenquelle zurück, da sie sowohl statisch als auch streamen kann. Daher können wir jederzeit neue Befehle zum Herunterladen von Modellen auf diesen Knoten veröffentlichen, was im industriellen Betrieb praktisch ist. Wir müssen das Projekt nicht stoppen, um die Version der Algorithmen zu aktualisieren. <br><br><img src="https://habrastorage.org/webt/hk/lj/ys/hkljystucnei9_ctlsegjhp9o5o.png"><br>  <i>Einrichten von Veröffentlichungsbefehlen für model_source</i> <br><br>  Der Inhalt der Eingabemodelldatei: <br><br> <code>I,N,1,action,load <br> I,N,2,type,astore <br> I,N,3,reference,/opt/sas/demo/image_processing/d.astore</code> </li> <li>  Die zweite Quelle, input_image, sind Bilder von der Kamera.  Zum Veröffentlichen von Daten verwenden wir einen Standardadapter - ein Programm, das Daten aus einer Quelle in ESP veröffentlicht.  In diesem Fall haben wir einen Dateiadapter verwendet. Sie können jedoch auch direkt eine Verbindung zur Kamera herstellen, z. B. über den mit der Lösung gelieferten UVC-Adapter. <br><br><img src="https://habrastorage.org/webt/ay/ql/hp/ayqlhpbfglnxdttpuv1ckoqdo9k.png"><br>  <i>Konfigurieren eines UVC-Anschlusses für gängige Camcorder-Typen.</i> </li><li>  Bilder können in einem anderen Format vorliegen als das, in dem das Modell trainiert wurde, und dies kann die Qualität der Klassifizierung beeinträchtigen.  Daher fügen wir nach input_image sofort den Knoten resize_image hinzu und schreiben das gewünschte Format in seinen Einstellungen vor.  Drücken Sie in diesem Fall auf ein Quadrat von 100/100 Pixel. <br><br><img src="https://habrastorage.org/webt/jl/bp/th/jlbpthn46z31lehm1ulcb5oe6fy.png" align="left" width="250">  <i>Bildverarbeitungs-Setup</i> <br clear="left"></li><li>  Die Modellausführung wird in CNN_score_code konfiguriert.  Die Schnittstelle extrahiert automatisch Ausgabeattribute aus der Meta-Beschreibung des Modells - P__label_c0, P__label_c1, P__label_c2 und P__label_c9 - die Wahrscheinlichkeiten jeder Verhaltensklasse.  Als nächstes definieren wir im Knoten max_class ein neues berechnetes Feld, das die Klasse mit maximaler Wahrscheinlichkeit auswählt. </li><li>  Durch das Starten des Projekts können wir nun eine Echtzeitklassifizierung für jedes Eingabebild erhalten.  In unserer Geschichte wird ein skrupelloser Fahrer regelmäßig von der Straße abgelenkt.  Es ist jedoch wichtig, diese Fälle, in denen er für eine Sekunde abgelenkt war, von Fällen von längerem gefährlichem Fahren zu trennen.  Dazu fügen wir 3 Knoten hinzu: Speichern von Ereignissen in letzter Minute (copy_1_min), Aggregation nach Verhaltensklassen (aggr_for_alert) und einen Filter mit Fakten zum „gefährlichen Fahren“ (filter_alert). <br><br><img src="https://habrastorage.org/webt/zi/kk/tn/zikktnzlze0q_w1zvir7awy5gum.png" width="300" align="left">  <i>Konfigurieren der Ereignisspeichereinstellungen - in 1 Minute.</i> <br clear="left"><img src="https://habrastorage.org/webt/65/bx/n7/65bxn7cssoq6r2g8tmv20uu-wbs.png" width="300" align="left"><br>  <i>Einrichten der Ereigniszählung für jede Verhaltensklasse.</i> <br clear="left"><img src="https://habrastorage.org/webt/8t/bt/sc/8tbtscxuouv-v3ab5xpykssttvk.png"><br>  <i>Festlegen von Filterregeln.</i> <br></li></ol><br><h3>  Indizes </h3><br>  Es ist wichtig zu beachten, dass jede Transformation im ESP eine Einstellung hat - "Status".  Es charakterisiert, ob die Datentransformation gestreamt wird, d.h.  Bei der Verarbeitung eines Eingabeereignisses wird das Ergebnis sofort weiter entlang des Diagramms übertragen und aus dem Speicher dieses Knotens gelöscht.  Oder wir können das Ergebnis der Verarbeitung jedes Ereignisses speichern und einen Index darauf erstellen, um jederzeit den Zugriff darauf zu ermöglichen.  Beispielsweise speichert das Aggregationsfenster immer den Status und wird basierend auf dem Eingabestream kontinuierlich ereignisberechnet. <br><br><h3>  Starten </h3><br>  Zurück zum Projekt.  Wir müssen es nur laufen lassen <img src="https://habrastorage.org/webt/uv/dy/le/uvdyleayvtubt4nmqhcd2jlcqjo.png" width="50">  . <br>  Zur einfacheren Anzeige von Datenströmen wird ein Online-Berichtsdesigner, SAS ESP Stream Viewer, mit ESP geliefert.  Im Setup-Modus sehen wir alle laufenden Projekte auf den Servern, können eine Verbindung zu ihnen herstellen und eine bequeme Visualisierung auswählen. <br><br><img src="https://habrastorage.org/webt/hc/jm/7f/hcjm7fhuisbkt_unw2m3poekrhc.gif"><br>  <i>Online-Dashboards in SAS ESP Stream Viewer</i> <br><br>  Das ist alles.  Wir hatten die Möglichkeit, die Reaktion auf ein Videosignal in Echtzeit zu automatisieren.  In diesem Fall richten wir die Online-Überwachung ein. Mit denselben Adaptern / Konnektoren können wir jedoch eine Nachricht für jeden Fall erkannter Verstöße senden oder eine Steueraktion an ein externes System senden. <br><br><h3>  Oder Python? </h3><br>  Technisch war der Fall abgeschlossen, aber zum Zwecke der Demonstration im Forum schien er nicht interaktiv genug zu sein.  Es war unpraktisch und ziemlich unsicher (!) In Echtzeit zu zeigen, daher wurden die Fotos im Voraus aufgenommen und das Auto stand auf dem Parkplatz. <br><br>  SAS ESP unterstützt die Streaming-Ausführung von in Python erstellten Modellen.  Zur Bestätigung richten wir die Analyse von Bildern, nämlich die Suche nach Objekten im Bild, mithilfe von OpenCV-Bibliotheken ein. <br><br><img src="https://habrastorage.org/webt/62/nr/gh/62nrghkxa8unlmf2m3fjy82knz0.png" width="300" align="left">  <i>ESP-Modell zum Auffinden eines Schutzhelms in einem Bildeingabestream</i> <br clear="left">  Im ESP-Diagramm haben wir zwei Datenquellen: Bilder von der Online-Kamera des Laptops und ein Foto des gesuchten Objekts.  In diesem Fall stellen wir fest, ob der potenzielle Arbeiter auf der Baustelle die Sicherheitsregeln vergessen hat: Befindet sich ein Helm darauf?  Im Knoten proc_detection führen wir den folgenden Python-Code aus: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compute_total</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Image,image_template)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"Output: score_point"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cv2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> base64 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> imageio <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> imread MIN_MATCH_COUNT = <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-comment"><span class="hljs-comment">#       DIST_COEFF = 0.55 img_big = imread(io.BytesIO(base64.b64decode(image_template))) sift = cv2.xfeatures2d.SIFT_create() # Initiate SIFT detector matcher = cv2.BFMatcher() # BFMatcher with default params kp_big, des_big = sift.detectAndCompute(img_big,None) img_tpl = imread(io.BytesIO(base64.b64decode(Image))) kp_tpl, des_tpl = sift.detectAndCompute(img_tpl,None) matches = matcher.knnMatch(des_tpl,des_big,k=2) good = [] for m,n in matches: if m.distance &lt; n.distance * DIST_COEFF: good.append(m) score_point = len(good) return score_point</span></span></code> </pre><br><img src="https://habrastorage.org/webt/xb/ql/56/xbql56g_rpt7jzmxp6bdzjwab-a.gif" width="500"><br>  <i>Identifizierung des Vorhandenseins eines Helms im Bild von der Webcam im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SAS Viya Business Breakfast-</a> Forum (Kollege, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">maxxts</a> testet den Stand)</i> <br><br><h3>  Maschinelles Lernen </h3><br>  Wenn wir über die Weiterentwicklung der Stream-Verarbeitung sprechen, wird sich der Schwerpunkt wahrscheinlich auf das Training analytischer Modelle für den Stream verlagern.  Das heißt,  Im Gegensatz zu früheren Beispielen werden Modelle nicht nur ausgeführt, sondern auch in SAS ESP trainiert.  Dies erfordert einen zusätzlichen Datenstrom, mit dem der Zugbetrieb des ausgewählten Algorithmus durch das Ereignis ausgeführt werden kann (z. B. für den Anfang ein einfaches k-Mittel-Clustering).  Dann hat das Auto mit dem ESP an Bord die Möglichkeit, die Situation mit neuen Sensoren zu analysieren, die gerade angeschlossen wurden.  Auf diese Weise können neue Geräte im Konzept von Industrie 4.0 schnell eingeschaltet und automatisiert werden. <br><br>  Bitte schreiben Sie in die Kommentare, welche Aufgaben in der Streaming-Analyse zu bewältigen sind, und natürlich beantworte ich gerne Fragen zur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SAS-Ereignisstromverarbeitung</a> . <br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de429176/">https://habr.com/ru/post/de429176/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de429162/index.html">„Um Änderungen vorzunehmen, verstehen Sie, warum Menschen sich dagegen wehren“: Jim Holmes über das Testen der Kultur</a></li>
<li><a href="../de429166/index.html">Multikristall: Von der Geschichte bis zur Spekulation über die Zukunft</a></li>
<li><a href="../de429168/index.html">Durch Feuer und Wasser: die Geschichte der russischen populärwissenschaftlichen Literatur</a></li>
<li><a href="../de429172/index.html">1C auf Proxmox. Allgemeine Hinweise</a></li>
<li><a href="../de429174/index.html">BlueStacks 4: Testen auf schwache Hardware + Entwicklerkommentare</a></li>
<li><a href="../de429178/index.html">Microsoft bestellte ein Modell eines neuen Campus in Minecraft</a></li>
<li><a href="../de429180/index.html">Geh zu goto</a></li>
<li><a href="../de429182/index.html">Künstliche Intelligenz stieß auf eine Barriere des Verstehens</a></li>
<li><a href="../de429184/index.html">Online-Medien brechen vorhersehbar die Kette über Oumuamua- und Harvard-Gelehrte</a></li>
<li><a href="../de429186/index.html">@ Pythonetc Oktober 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>