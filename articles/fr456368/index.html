<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏈 🧚🏻 👩‍👩‍👧‍👧 Effectuer des transactions publiques et privées sur la blockchain JPMorgan Quorum à l'aide de Web3 👈🏼 🎖️ ✌🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quorum est une blockchain basée sur Ethereum développée par JPMorgan et est récemment devenue la première plate-forme de registre distribuée offerte p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Effectuer des transactions publiques et privées sur la blockchain JPMorgan Quorum à l'aide de Web3</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456368/"><p><img src="https://habrastorage.org/webt/dn/2r/f3/dn2rf3fmls1j424_o0ejhkjcxxe.jpeg"><br></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Quorum</a> est une blockchain basée sur Ethereum développée par JPMorgan et est récemment devenue la première plate-forme de registre distribuée offerte par Microsoft Azure. </p><br><p>  Quorum prend en charge les transactions privées et publiques et dispose de nombreux cas d'utilisation commerciale. </p><br><p>  Dans cet article, nous analyserons l'un de ces scénarios - le déploiement d'un réseau de registre distribué entre un supermarché et un propriétaire d'entrepôt pour fournir des informations pertinentes sur la température d'un entrepôt. </p><br><p>  Le code utilisé dans ce guide se trouve dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">référentiel sur GitHub</a> . </p><br><p>  L'article couvre: </p><br><ul><li>  créer un contrat intelligent; </li><li>  Déploiement du réseau Quorum avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Chainstack</a> </li><li>  Transactions publiques de quorum </li><li>  Transactions privées de quorum. </li></ul><br><p>  Pour illustrer cela, nous utilisons le scénario de surveillance de la température dans les salles de stockage des participants au réseau Quorum dans le cadre de l'Internet des objets (IoT). </p><a name="habracut"></a><br><h2 id="kontekst">  Contexte </h2><br><p>  Un groupe de sociétés d'entrepôt est uni dans un consortium pour le stockage conjoint d'informations et l'automatisation des processus sur la blockchain.  Pour cela, les entreprises ont décidé d'utiliser Quorum.  Dans cet article, nous couvrirons deux scénarios: les transactions publiques et les transactions privées. </p><br><p>  Les transactions sont créées par différents participants pour interagir avec le consortium auquel ils appartiennent.  Chaque transaction déploie un contrat ou appelle une fonction dans un contrat pour télécharger des données sur le réseau.  Ces actions sont répliquées sur tous les nœuds du réseau. </p><br><p>  Les transactions publiques peuvent être consultées par tous les membres du consortium.  Les transactions privées ajoutent une couche de confidentialité et ne sont disponibles que pour les participants qui y ont droit. </p><br><p>  Pour les deux scénarios, nous utilisons le même contrat pour plus de clarté. </p><br><h2 id="smart-kontrakt">  Contrat intelligent </h2><br><p> Vous trouverez ci-dessous un simple contrat intelligent créé pour notre scénario.  Il a une <code>temperature</code> variable publique, qui peut être modifiée à l'aide de la méthode <code>set</code> et récupérée par la méthode <code>get</code> . </p><br><pre> <code class="javascript hljs">pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span><span class="hljs-number"><span class="hljs-number">.25</span></span>; contract TemperatureMonitor { int8 public temperature; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">int8 temp</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span><span class="hljs-function"> </span></span>{ temperature = temp; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">int8</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> temperature; } }</code> </pre> <br><p>  Pour que le contrat fonctionne avec <a href="">web3.js</a> , il doit être converti au format ABI et au bytecode.  L'utilisation de la fonction <code>formatContract</code> ci-dessous compile le contrat à l'aide de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">solc-js</a> . </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">formatContract</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = <span class="hljs-string"><span class="hljs-string">'./contracts/temperatureMonitor.sol'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> source = fs.readFileSync(path,<span class="hljs-string"><span class="hljs-string">'UTF8'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> solc.compile(source, <span class="hljs-number"><span class="hljs-number">1</span></span>).contracts[<span class="hljs-string"><span class="hljs-string">':TemperatureMonitor'</span></span>]; }</code> </pre> <br><p>  Le contrat terminé est le suivant: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// interface [ { constant: true, inputs: [], name: 'get', outputs: [Array], payable: false, stateMutability: 'view', type: 'function' }, { constant: true, inputs: [], name: 'temperature', outputs: [Array], payable: false, stateMutability: 'view', type: 'function' }, { constant: false, inputs: [Array], name: 'set', outputs: [], payable: false, stateMutability: 'nonpayable', type: 'function' } ]</span></span></code> </pre> <br><pre> <code class="plaintext hljs">// bytecode</code> </pre><br><p>  Maintenant que le contrat est prêt, nous allons déployer le réseau et déployer le contrat. </p><br><h2 id="razvertyvanie-nod">  Déploiement de noeud </h2><br><p><img src="https://habrastorage.org/getpro/habr/post_images/4e5/8d2/0d2/4e58d20d27bfa4aa8b4da4bbf990ac53.jpg" alt="image"></p><br><p>  Le déploiement d'un nœud peut prendre beaucoup de temps et ce processus peut être remplacé à l'aide du service <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Chainstack</a> . </p><br><p>  Voici un processus de déploiement de réseau Quorum avec un consensus Raft et trois nœuds. </p><br><p>  Pour commencer, commençons un projet et appelons-le le projet Quorum: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/193/316/b8e/193316b8ef875ed68e491804b5a7ff7d.gif" alt="image"></p><br><p>  Créez un réseau Quorum avec le consensus Raft sur la plateforme Google Cloud: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/2f3/650/f1e/2f3650f1e98174694c46f6cd31040d4c.gif" alt="image"></p><br><p>  Au nœud par défaut déjà créé, ajoutez deux nœuds supplémentaires: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/cb5/77b/5f7/cb577b5f7516664e64951f6404711eaa.gif" alt="image"></p><br><p>  Trois nœuds en cours d'exécution: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/243/c4d/056/243c4d0569c5d6b3accb3d1166e2b2f6.png" alt="image"></p><br><p>  La page des détails du nœud affiche le point de terminaison RPC, la clé publique, etc. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a35/61a/29a/a3561a29a5f38d410ed92c99a645b2c1.png" alt="image"></p><br><p>  Le réseau est déployé.  Nous allons maintenant déployer des contrats intelligents et exécuter des transactions à l'aide de <a href="">web3.js.</a> </p><br><h2 id="publichnye-tranzakcii">  Transactions publiques </h2><br><h3 id="kontekst-1">  Contexte </h3><br><p>  La température de l'entrepôt est d'une grande importance pour réduire les coûts, en particulier pour les produits destinés au stockage à des températures inférieures à zéro. </p><br><p>  En donnant aux entreprises la possibilité de partager les valeurs en temps réel de la température extérieure de leur emplacement géographique et de les enregistrer dans un registre immuable, les membres du réseau réduisent les coûts et le temps. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/03e/028/5ca/03e0285ca0b59b6b96351d5b99d95408.png" alt="image"></p><br><p>  Nous réaliserons les trois tâches illustrées dans le schéma: </p><br><ol><li><p>  Nous résilierons le contrat via le <b>nœud 1</b> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> contractAddress = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> deployContract(raft1Node); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`Contract address after deployment: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${contractAddress}</span></span></span><span class="hljs-string">`</span></span>);</code> </pre> <br></li><li><p>  Réglez la température via le <b>nœud 2</b> à 3 degrés: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> status = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> setTemperature(raft2Node, contractAddress, <span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`Transaction status: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${status}</span></span></span><span class="hljs-string">`</span></span>);</code> </pre> <br></li><li><p>  <b>Le nœud 3</b> recevra les informations du contrat intelligent.  Le contrat renverra une valeur de 3 degrés: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> temp = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getTemperature(raft3Node, contractAddress); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Retrieved contract Temperature'</span></span>, temp);</code> </pre> <br><p>  Ensuite, nous <a href="">verrons</a> comment exécuter une transaction publique sur le réseau Quorum à l'aide de <a href="">web3.js.</a> </p><br></li></ol><br><p>  Nous initions une instance via RPC pour trois nœuds: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> raft1Node = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Web3( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Web3.providers.HttpProvider(process.env.RPC1), <span class="hljs-literal"><span class="hljs-literal">null</span></span>, { <span class="hljs-attr"><span class="hljs-attr">transactionConfirmationBlocks</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, }, ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> raft2Node = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Web3( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Web3.providers.HttpProvider(process.env.RPC2), <span class="hljs-literal"><span class="hljs-literal">null</span></span>, { <span class="hljs-attr"><span class="hljs-attr">transactionConfirmationBlocks</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, }, ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> raft3Node = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Web3( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Web3.providers.HttpProvider(process.env.RPC3), <span class="hljs-literal"><span class="hljs-literal">null</span></span>, { <span class="hljs-attr"><span class="hljs-attr">transactionConfirmationBlocks</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, }, );</code> </pre> <br><p>  Détruisez le contrat intelligent: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// returns the default account from the Web3 instance initiated previously function getAddress(web3) { return web3.eth.getAccounts().then(accounts =&gt; accounts[0]); } // Deploys the contract using contract's interface and node's default address async function deployContract(web3) { const address = await getAddress(web3); // initiate contract with contract's interface const contract = new web3.eth.Contract( temperatureMonitor.interface ); return contract.deploy({ // deploy contract with contract's bytecode data: temperatureMonitor.bytecode, }) .send({ from: address, gas: '0x2CD29C0', }) .on('error', console.error) .then((newContractInstance) =&gt; { // returns deployed contract address return newContractInstance.options.address; }); }</span></span></code> </pre> <br><p>  <a href="">web3.js</a> propose deux méthodes pour interagir avec un contrat: <code>call</code> et <code>send</code> . </p><br><p>  Mettez à jour la température du contrat en exécutant <code>set</code> à l'aide de la méthode d' <code>send</code> web3. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// get contract deployed previously async function getContract(web3, contractAddress) { const address = await getAddress(web3); return web3.eth.Contract( temperatureMonitor.interface, contractAddress, { defaultAccount: address, } ); } // calls contract set method to update contract's temperature async function setTemperature(web3, contractAddress, temp) { const myContract = await getContract(web3, contractAddress); return myContract.methods.set(temp).send({}).then((receipt) =&gt; { return receipt.status; }); }</span></span></code> </pre> <br><p>  Ensuite, nous utilisons la méthode d' <code>call</code> web3 pour obtenir la température du contrat.  Veuillez noter que la méthode d' <code>call</code> est exécutée sur le nœud local et la transaction ne sera pas créée sur la blockchain. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// calls contract get method to retrieve contract's temperature async function getTemperature(web3, contractAddress) { const myContract = await getContract(web3, contractAddress); return myContract.methods.get().call().then(result =&gt; result); }</span></span></code> </pre> <br><p>  Vous pouvez maintenant exécuter <a href="">public.js</a> pour obtenir le résultat suivant: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Execute public script node public.js Contract address after deployment: 0xf46141Ac7D6D6E986eFb2321756b5d1e8a25008F Transaction status: true Retrieved contract Temperature 3</span></span></code> </pre> <br><p>  Ensuite, nous pouvons voir les entrées dans l'explorateur de quorum dans le panneau Chainstack, comme indiqué ci-dessous. </p><br><p>  Les trois nœuds ont interagi et les transactions ont été mises à jour: </p><br><ol><li>  La première transaction a obtenu un contrat. </li><li>  La deuxième transaction a fixé la température du contrat à 3 degrés. </li><li>  La température est obtenue via le nœud local, la transaction n'a donc pas été créée. </li></ol><br><p><img src="https://habrastorage.org/getpro/habr/post_images/6fb/104/097/6fb10409705859a6672a53d76356a55c.png" alt="image"></p><br><h2 id="privatnye-tranzakcii">  Transactions privées </h2><br><h3 id="kontekst-2">  Contexte </h3><br><p>  Une exigence courante des organisations est la protection des données.  À titre d'exemple, considérons un scénario dans lequel un <i>supermarché</i> loue un entrepôt pour stocker des fruits de mer auprès d'un <i>fournisseur</i> distinct: </p><br><ul><li>  <i>Le vendeur,</i> à l'aide de capteurs IoT, lit les valeurs de température toutes les 30 secondes et les transmet au <i>supermarché</i> ; </li><li>  ces valeurs ne devraient être disponibles que pour le <i>vendeur</i> et le <i>supermarché</i> , un consortium en réseau. </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/deb/3b1/a51/deb3b1a51e681fe664bc49b2d6eb8307.png" alt="image"></p><br><p>  Nous terminerons les quatre tâches illustrées dans le diagramme ci-dessus. </p><br><ul><li>  Nous utilisons les trois mêmes nœuds du scénario précédent pour illustrer les transactions privées: </li><li>  <i>Le supermarché</i> déploie un contrat intelligent qui est privé au <i>supermarché</i> et au <i>vendeur</i> . </li><li>  <i>Un tiers</i> n'a pas accès au contrat intelligent. </li></ul><br><p>  Nous appellerons les méthodes <code>get</code> et <code>set</code> au nom du <i>supermarché</i> et du <i>vendeur</i> pour démontrer la transaction privée du quorum. </p><br><ol><li><p>  Nous résilierons le contrat privé pour les participants au <i>supermarché</i> et au <i>vendeur</i> par le biais du participant au <i>supermarché</i> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> contractAddress = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> deployContract( raft1Node, process.env.PK2, ); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`Contract address after deployment: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${contractAddress}</span></span></span><span class="hljs-string">`</span></span>);</code> </pre> <br></li><li><p>  Réglez la température à partir du <i>tiers</i> (nœud externe) et obtenez la valeur de température: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Attempts to set Contract temperature to 10, this will not mutate contract's temperature await setTemperature( raft3Node, contractAddress, process.env.PK1, 10, ); // This returns null const temp = await getTemperature(raft3Node, contractAddress); console.log(`[Node3] temp retrieved after updating contract from external nodes: ${temp}`);</span></span></code> </pre> <br></li><li><p>  Réglez la température auprès du <i>fournisseur</i> (nœud interne) et obtenez la valeur de température: </p><br><p>  La température dans ce scénario devrait revenir du contrat intelligent à 12. Veuillez noter que le <i>fournisseur</i> ici a autorisé l'accès au contrat intelligent. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Updated Contract temperature to 12 degrees await setTemperature( raft2Node, contractAddress, process.env.PK1, 12, ); // This returns 12 const temp2 = await getTemperature(raft2Node, contractAddress); console.log(`[Node2] temp retrieved after updating contract from internal nodes: ${temp2}`);</span></span></code> </pre> <br></li><li><p>  Obtenez la température du <i>tiers</i> (nœud externe): </p><br><p>  À l'étape 3, la température a été réglée sur 12, mais le <i>tiers</i> n'a pas accès au contrat intelligent.  Par conséquent, la valeur de retour doit être nulle. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// This returns null const temp3 = await getTemperature(raft3Node, contractAddress); console.log(`[Node3] temp retrieved from external nodes after update ${temp}`);</span></span></code> </pre> <br><p>  Ensuite, nous considérerons plus en détail l'exécution de transactions privées sur le réseau Quorum avec <a href="">web3.js.</a>  Étant donné que la plupart du code coïncide avec des transactions publiques, nous sélectionnons uniquement les parties qui sont différentes pour les transactions privées. </p><br></li></ol><br><p>  Veuillez noter que le contrat téléchargé sur le réseau est inchangeable, donc l'accès avec autorisation doit être accordé aux nœuds correspondants en incluant le contrat public au moment du déploiement du contrat, et non après. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deployContract</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">web3, publicKey</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> address = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getAddress(web3); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> contract = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> web3.eth.Contract( temperatureMonitor.interface, ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> contract.deploy({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: temperatureMonitor.bytecode, }) .send({ <span class="hljs-attr"><span class="hljs-attr">from</span></span>: address, <span class="hljs-attr"><span class="hljs-attr">gas</span></span>: <span class="hljs-string"><span class="hljs-string">'0x2CD29C0'</span></span>, <span class="hljs-comment"><span class="hljs-comment">// Grant Permission to Contract by including nodes public keys privateFor: [publicKey], }) .then((contract) =&gt; { return contract.options.address; }); }</span></span></code> </pre> <br><p>  Les transactions privées sont effectuées de la même manière - en incluant la clé publique des participants au moment de l'exécution. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setTemperature</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">web3, contractAddress, publicKey, temp</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> address = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getAddress(web3); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> myContract = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getContract(web3, contractAddress); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> myContract.methods.set(temp).send({ <span class="hljs-attr"><span class="hljs-attr">from</span></span>: address, <span class="hljs-comment"><span class="hljs-comment">// Grant Permission by including nodes public keys privateFor: [publicKey], }).then((receipt) =&gt; { return receipt.status; }); }</span></span></code> </pre> <br><p>  Maintenant, nous pouvons exécuter <a href="">private.js</a> avec les résultats suivants: </p><br><pre> <code class="bash hljs">node private.js Contract address after deployment: 0x85dBF88B4dfa47e73608b33454E4e3BA2812B21D [Node3] temp retrieved after updating contract from external nodes: null [Node2] temp retrieved after updating contract from internal nodes: 12 [Node3] temp retrieved from external nodes after update null</code> </pre> <br><p>  L'explorateur de quorum de Chainstack affichera les éléments suivants: </p><br><ul><li>  Déploiement d'un contrat d'un participant dans un <i>supermarché</i> ; </li><li>  Exécution de <code>SetTemperature</code> partir d'un <i>tiers</i> ; </li><li>  Effectuez une <code>SetTemperature</code> partir d'un participant <i>fournisseur</i> . </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e14/6d2/660/e146d2660771f328fda7087facaec1e7.png" alt="image"></p><br><p>  Comme vous pouvez le voir, les deux transactions sont terminées, mais seule la transaction du <i>vendeur</i> participant a mis à jour la température dans le contrat.  Ainsi, les transactions privées offrent une immuabilité, mais en même temps, elles ne fournissent pas de données à un tiers. </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  Nous avons examiné le scénario commercial d'utilisation de Quorum pour fournir des informations à jour sur la température dans un entrepôt en déployant un réseau entre deux parties - un supermarché et le propriétaire de l'entrepôt. </p><br><p>  Nous avons montré comment les informations sur la température actuelle peuvent être conservées par le biais de transactions publiques et privées. </p><br><p>  Il peut y avoir beaucoup de scénarios d'application et, comme vous le voyez, ce n'est pas du tout difficile. </p><br><p>  Expérimentez, essayez de déployer votre script.  De plus, l'industrie de la technologie blockchain <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">peut croître près de dix fois d'ici 2024</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr456368/">https://habr.com/ru/post/fr456368/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr456352/index.html">Module de communication d'objets sans fil WISE-4000</a></li>
<li><a href="../fr456354/index.html">Comment collectons-nous les téléviseurs</a></li>
<li><a href="../fr456358/index.html">Les 13 articles les plus tristement célèbres de l'année écoulée</a></li>
<li><a href="../fr456362/index.html">Designer de niveau 6: comment nous motivons et développons les designers</a></li>
<li><a href="../fr456366/index.html">Comment j'ai conçu la LED HEART Box</a></li>
<li><a href="../fr456370/index.html">Implémenter la QoS dans le stockage Qsan</a></li>
<li><a href="../fr456372/index.html">SimbirSoft invite les professionnels de l'informatique à un été intensif 2019</a></li>
<li><a href="../fr456374/index.html">Structures de données d'état de la chaîne de blocs Plasma Cash</a></li>
<li><a href="../fr456376/index.html">Not One Spring Boot: un aperçu des alternatives</a></li>
<li><a href="../fr456380/index.html">Journée portes ouvertes de la Faculté de Programmation en Netologie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>