<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßìüèø ‚ò∫Ô∏è ‚ö∞Ô∏è Cara konfigurasi bekerja di .NET Core üëΩ üóÉÔ∏è ‚ô†Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mari kita menunda pembicaraan tentang DDD dan refleksi sejenak. Saya mengusulkan untuk berbicara tentang yang sederhana, tentang pengaturan pengaturan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cara konfigurasi bekerja di .NET Core</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453416/"><p>  Mari kita menunda pembicaraan tentang DDD dan refleksi sejenak.  Saya mengusulkan untuk berbicara tentang yang sederhana, tentang pengaturan pengaturan aplikasi. </p><br><p>  Setelah kolega saya dan saya memutuskan untuk beralih ke .NET Core, muncul pertanyaan tentang bagaimana mengatur file konfigurasi, bagaimana melakukan transformasi, dll. Di lingkungan baru.  Kode berikut ditemukan dalam banyak contoh, dan banyak yang berhasil menggunakannya. </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IConfiguration Configuration { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IHostingEnvironment Environment { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Startup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfiguration configuration, IHostingEnvironment environment</span></span></span><span class="hljs-function">)</span></span> {   Environment = environment;   Configuration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigurationBuilder() .AddJsonFile(<span class="hljs-string"><span class="hljs-string">"appsettings.json"</span></span>) .AddJsonFile(<span class="hljs-string"><span class="hljs-string">$"appsettings.</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Environment.EnvironmentName}</span></span></span><span class="hljs-string">.json"</span></span>) .Build(); }</code> </pre> <br><p>  Tapi mari kita lihat bagaimana konfigurasi bekerja, dan dalam kasus apa menggunakan pendekatan ini, dan di mana untuk mempercayai pengembang .NET Core.  Saya minta kucing. </p><a name="habracut"></a><br><h2 id="kak-bylo-ranshe">  Seperti sebelumnya </h2><br><p>  Seperti kisah apa pun, artikel ini memiliki awal.  Salah satu masalah pertama setelah beralih ke ASP.NET Core adalah transformasi file konfigurasi. </p><br><div class="spoiler">  <b class="spoiler_title">Ingat bagaimana sebelumnya dengan web.config</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/28/rh/tx/28rhtxxm6uw-67utmgjas0oh0ii.png"></p><br><p>  Konfigurasi terdiri dari beberapa file.  File utama adalah <i>web.config</i> , dan transformasi ( <em>web.Development.config</em> , dll.) Sudah diterapkan, tergantung pada konfigurasi perakitan.  Pada saat yang sama, atribut <em>xml-</em> secara aktif digunakan untuk mencari dan mengubah bagian dokumen <em>xml-</em> . </p></div></div><br><p>  Tapi seperti yang kita tahu di ASP.NET Core, <em>file web.config telah</em> digantikan oleh <em>appsettings.json</em> dan tidak ada lagi mekanisme transformasi yang biasa. </p><br><div class="spoiler">  <b class="spoiler_title">Apa yang diceritakan google kepada kami?</b> <div class="spoiler_text"><p>  Hasil pencarian untuk "Mengubah ke dalam ASP.NET Core" di <em>google</em> menghasilkan kode berikut: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IConfiguration Configuration { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IHostingEnvironment Environment { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Startup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfiguration configuration, IHostingEnvironment environment</span></span></span><span class="hljs-function">)</span></span> {  Environment = environment;  Configuration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigurationBuilder() .AddJsonFile(<span class="hljs-string"><span class="hljs-string">"appsettings.json"</span></span>) .AddJsonFile(<span class="hljs-string"><span class="hljs-string">$"appsettings.</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Environment.EnvironmentName}</span></span></span><span class="hljs-string">.json"</span></span>) .Build(); }</code> </pre> <br><p>  Di konstruktor dari kelas <em>Startup</em> , kami membuat objek konfigurasi menggunakan <em>ConfigurationBuilder</em> .  Dalam hal ini, kami secara eksplisit menunjukkan sumber konfigurasi yang ingin kami gunakan. </p><br><p>  Dan semacamnya: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IConfiguration Configuration { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IHostingEnvironment Environment { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Startup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfiguration configuration, IHostingEnvironment environment</span></span></span><span class="hljs-function">)</span></span> {  Environment = environment;  Configuration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigurationBuilder() .AddJsonFile(<span class="hljs-string"><span class="hljs-string">$"appsettings.</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Environment.EnvironmentName}</span></span></span><span class="hljs-string">.json"</span></span>) .Build(); }</code> </pre> <br><p>  Bergantung pada variabel lingkungan, satu atau beberapa sumber konfigurasi dipilih. </p></div></div><br><p>  Jawaban ini sering ditemukan di <abbr title="Stackoverflow">SO</abbr> dan sumber daya lain yang kurang populer.  Namun perasaan itu tidak pergi.  bahwa kita salah.  Bagaimana jika saya ingin menggunakan variabel lingkungan atau argumen baris perintah dalam konfigurasi?  Mengapa saya perlu menulis kode ini di setiap proyek? </p><br><p>  Untuk mencari kebenaran, saya harus mempelajari dokumentasi dan kode sumber.  Dan saya ingin berbagi ilmu yang didapat dalam artikel ini. </p><br><p>  Mari kita lihat bagaimana konfigurasi bekerja di .NET Core. </p><br><h2 id="konfiguraciya">  Konfigurasi </h2><br><p>  Konfigurasi dalam .NET Core diwakili oleh <em>objek</em> antarmuka <em>IConfiguration</em> . </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IConfiguration</span></span> {  <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> key] { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }  <span class="hljs-function"><span class="hljs-function">IConfigurationSection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSection</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> key</span></span></span><span class="hljs-function">)</span></span>;  <span class="hljs-function"><span class="hljs-function">IEnumerable&lt;IConfigurationSection&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetChildren</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>;  <span class="hljs-function"><span class="hljs-function">IChangeToken </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetReloadToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre> <br><ul><li>  <strong>[string key]</strong> indexer, yang memungkinkan untuk mendapatkan nilai parameter konfigurasi dengan kunci </li><li>  <strong>GetSection (kunci string)</strong> mengembalikan bagian konfigurasi yang sesuai dengan kunci <em>tombol</em> </li><li>  <strong>GetChildren ()</strong> mengembalikan set subbagian dari bagian konfigurasi saat ini </li><li>  <strong>GetReloadToken ()</strong> mengembalikan instance <em>IChangeToken</em> yang dapat digunakan untuk menerima notifikasi ketika konfigurasi berubah </li></ul><br><p>  Konfigurasi adalah kumpulan pasangan nilai kunci.  Saat membaca dari sumber konfigurasi (file, variabel lingkungan), data hierarkis direduksi menjadi struktur datar.  Misalnya, <em>json adalah</em> objek dari formulir </p><br><pre> <code class="plaintext hljs">{ "Settings": { "Key": "I am options" } }</code> </pre> <br><p>  akan direduksi menjadi tampilan datar: </p><br><pre> <code class="plaintext hljs">Settings:Key = I am options</code> </pre> <br><p>  Di sini, kuncinya adalah <em>Pengaturan: Kunci</em> , dan nilainya adalah <em>pilihan saya</em> . <br>  Penyedia konfigurasi digunakan untuk mengisi konfigurasi. </p><br><h2 id="provaydery-konfiguracii">  Penyedia konfigurasi </h2><br><p>  Objek antarmuka bertanggung jawab untuk membaca data dari sumber konfigurasi. <br>  <em>IConfigurationProvider</em> : </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IConfigurationProvider</span></span> {  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TryGet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> key, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">out</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span>;  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> key, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span>;  <span class="hljs-function"><span class="hljs-function">IChangeToken </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetReloadToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>;  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>;  <span class="hljs-function"><span class="hljs-function">IEnumerable&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetChildKeys</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerable&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; earlierKeys, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> parentPath</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre> <br><ul><li>  <strong>TryGet (kunci string, nilai string keluar)</strong> memungkinkan untuk mendapatkan nilai parameter konfigurasi dengan kunci </li><li>  <strong>Set (kunci string, nilai string)</strong> digunakan untuk mengatur nilai parameter konfigurasi </li><li>  <strong>GetReloadToken ()</strong> mengembalikan instance <em>IChangeToken</em> yang dapat digunakan untuk menerima notifikasi ketika sumber konfigurasi berubah </li><li>  <strong>Load ()</strong> metode yang bertanggung jawab untuk membaca sumber konfigurasi </li><li>  <strong>GetChildKeys (IEnumerable &lt;string&gt; beforeKeys, string parentPath)</strong> memungkinkan Anda untuk mendapatkan daftar semua kunci yang disediakan penyedia konfigurasi ini </li></ul><br><p>  Penyedia berikut tersedia dari kotak: </p><br><ul><li>  Json </li><li>  Ini </li><li>  Xml </li><li>  Variabel Lingkungan </li><li>  Ingatan </li><li>  Azure </li><li>  Penyedia konfigurasi khusus </li></ul><br><p>  Konvensi berikut untuk menggunakan penyedia konfigurasi diterima. </p><br><ol><li>  Sumber konfigurasi dibaca dalam urutan yang ditentukan. </li><li>  Jika kunci yang sama ada di sumber konfigurasi yang berbeda (perbandingannya tidak peka huruf besar-kecil), maka nilai yang ditambahkan terakhir digunakan. </li></ol><br><p>  Jika kami membuat instance dari server <em>web</em> menggunakan <em>CreateDefaultBuilder</em> , maka penyedia konfigurasi berikut terhubung secara default: </p><br><p><img src="https://habrastorage.org/webt/pq/0l/5q/pq0l5qp3qultg9xhtg1kvpimj_y.png"></p><br><ul><li>  <strong>ChainedConfigurationProvider</strong> melalui penyedia ini Anda bisa mendapatkan nilai dan kunci konfigurasi yang telah ditambahkan oleh penyedia konfigurasi lainnya </li><li>  <strong>JsonConfigurationProvider</strong> menggunakan file <em>json</em> sebagai sumber konfigurasi.  Seperti yang Anda lihat, tiga penyedia jenis ini ditambahkan ke daftar penyedia.  Yang pertama menggunakan <em>appsettings.json</em> sebagai sumber, yang kedua <em>menggunakan appsettings. {Lingkungan} .json</em> .  Yang ketiga membaca data dari <em>secrets.json</em> .  Jika Anda membangun aplikasi dalam konfigurasi <em>Release</em> , penyedia ketiga tidak akan terhubung, karena tidak disarankan untuk menggunakan rahasia di lingkungan <em>Produksi</em> </li><li>  <strong>EnvironmentVariablesConfigurationProvider</strong> mengambil parameter konfigurasi dari variabel lingkungan </li><li>  <strong>CommandLineConfigurationProvider</strong> memungkinkan menambahkan argumen baris perintah ke konfigurasi </li></ul><br><p>  Karena konfigurasi disimpan sebagai kamus, penting untuk memastikan keunikan tombol.  Secara default, ini berfungsi seperti ini. </p><br><p>  Jika penyedia <em>CommandLineConfigurationProvider</em> memiliki elemen dengan kunci tombol dan penyedia <em>JsonConfigurationProvider</em> memiliki elemen dengan kunci, elemen dari <em>JsonConfigurationProvider</em> akan digantikan oleh elemen dari <em>CommandLineConfigurationProvider</em> karena terdaftar terakhir dan memiliki prioritas lebih tinggi. </p><br><div class="spoiler">  <b class="spoiler_title">Ingat contoh dari awal artikel</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IConfiguration Configuration { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IHostingEnvironment Environment { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Startup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfiguration configuration, IHostingEnvironment environment</span></span></span><span class="hljs-function">)</span></span> {  Environment = environment;  Configuration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigurationBuilder() .AddJsonFile(<span class="hljs-string"><span class="hljs-string">"appsettings.json"</span></span>) .AddJsonFile(<span class="hljs-string"><span class="hljs-string">$"appsettings.</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Environment.EnvironmentName}</span></span></span><span class="hljs-string">.json"</span></span>) .Build(); }</code> </pre> <br><p>  Kita tidak perlu membuat <em>IConfiguration sendiri</em> untuk mengubah file konfigurasi, karena ini diaktifkan secara default.  Pendekatan ini diperlukan ketika kita ingin membatasi jumlah sumber konfigurasi. </p></div></div><br><h2 id="kastomnyy-provayder-konfiguracii">  Penyedia konfigurasi khusus </h2><br><p>  Untuk menulis penyedia konfigurasi Anda, Anda perlu mengimplementasikan <em>antarmuka IConfigurationProvider</em> dan <em>IConfigurationSource</em> .  <em>IConfigurationSource adalah</em> antarmuka baru yang belum kami pertimbangkan dalam artikel ini. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IConfigurationSource</span></span> { <span class="hljs-function"><span class="hljs-function">IConfigurationProvider </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Build</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfigurationBuilder builder</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre> <br><p>  Antarmuka terdiri dari metode <em>Build</em> tunggal yang menggunakan <em>IConfigurationBuilder</em> sebagai parameter dan mengembalikan instance baru <em>IConfigurationProvider</em> . </p><br><p>  Untuk mengimplementasikan penyedia konfigurasi kami, kelas abstrak <em>ConfigurationProvider</em> dan <em>FileConfigurationProvider</em> tersedia untuk kami.  Di kelas-kelas ini, logika metode <em>TryGet</em> , <em>Set</em> , <em>GetReloadToken</em> , <em>GetChildKeys</em> sudah diimplementasikan dan tetap hanya menerapkan metode <em>Load</em> . </p><br><p>  Mari kita lihat sebuah contoh.  Kita perlu menerapkan membaca konfigurasi dari file <em>yaml</em> , dan kita juga perlu mengubah konfigurasi tanpa memulai ulang aplikasi kita. </p><br><p>  Buat kelas <em>YamlConfigurationProvider</em> dan jadikan sebagai pewaris <em>FileConfigurationProvider</em> . </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">YamlConfigurationProvider</span></span> : <span class="hljs-title"><span class="hljs-title">FileConfigurationProvider</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _filePath; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">YamlConfigurationProvider</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">FileConfigurationSource source</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Stream stream</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotImplementedException(); } }</code> </pre> <br><p>  Dalam cuplikan kode di atas, Anda dapat melihat beberapa fitur dari kelas <em>FileConfigurationProvider</em> .  Konstruktor menerima turunan dari <em>FileConfigurationSource</em> , yang berisi <em>IFileProvider</em> .  <em>IFileProvider</em> digunakan untuk membaca file, dan berlangganan acara perubahan file.  Anda juga dapat melihat bahwa metode <em>Load</em> menerima <em>Stream</em> di mana file konfigurasi terbuka untuk dibaca.  Ini adalah metode kelas <em>FileConfigurationProvider</em> dan tidak ada dalam antarmuka <em>IConfigurationProvider</em> . </p><br><p>  Tambahkan implementasi sederhana yang memungkinkan kita membaca file <em>yaml</em> .  Untuk membaca file, saya akan menggunakan paket <em>YamlDotNet</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Implementasi YamlConfigurationProvider</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">YamlConfigurationProvider</span></span> : <span class="hljs-title"><span class="hljs-title">FileConfigurationProvider</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _filePath; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">YamlConfigurationProvider</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">FileConfigurationSource source</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Stream stream</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (stream.CanSeek) { stream.Seek(<span class="hljs-number"><span class="hljs-number">0L</span></span>, SeekOrigin.Begin); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (StreamReader streamReader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamReader(stream)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fileContent = streamReader.ReadToEnd(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> yamlObject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DeserializerBuilder() .Build() .Deserialize(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringReader(fileContent)) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;; Data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pair <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> yamlObject) { FillData(String.Empty, pair); } } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FillData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> prefix, KeyValuePair&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; pair</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> key = String.IsNullOrEmpty(prefix) ? pair.Key.ToString() : <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{prefix}</span></span></span><span class="hljs-string">:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{pair.Key}</span></span></span><span class="hljs-string">"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (pair.Value) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: Data.Add(key, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; section: { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sectionPair <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> section) FillData(pair.Key.ToString(), sectionPair); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } }</code> </pre> </div></div><br><p>  Untuk membuat turunan dari penyedia konfigurasi kami, Anda harus mengimplementasikan <em>FileConfigurationSource</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Implementasi YamlConfigurationSource</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">YamlConfigurationSource</span></span> : <span class="hljs-title"><span class="hljs-title">FileConfigurationSource</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">YamlConfigurationSource</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileName</span></span></span><span class="hljs-function">)</span></span> { Path = fileName; ReloadOnChange = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> IConfigurationProvider </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Build</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfigurationBuilder builder</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.EnsureDefaults(builder); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> YamlConfigurationProvider(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }</code> </pre> <br><p>  Penting untuk dicatat di sini bahwa untuk menginisialisasi properti kelas dasar, Anda harus memanggil metode <em>this.EnsureDefaults (builder)</em> . </p></div></div><br><p>  Untuk mendaftarkan penyedia konfigurasi khusus dalam aplikasi, Anda perlu menambahkan instance penyedia ke <em>IConfigurationBuilder</em> .  Anda dapat memanggil metode <em>Tambahkan</em> dari <em>IConfigurationBuilder</em> , tetapi saya akan segera <em>mengeluarkan logika</em> inisialisasi <em>YamlConfigurationProvider</em> dalam metode <em>ekstensi</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Terapkan YamlConfigurationExtensions</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">YamlConfigurationExtensions</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IConfigurationBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddYaml</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IConfigurationBuilder builder, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> filePath</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (builder == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(builder)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(filePath)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(filePath)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> builder .Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> YamlConfigurationSource(filePath)); } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Panggil Metode AddYaml</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { CreateWebHostBuilder(args).Build().Run(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IWebHostBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateWebHostBuilder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> =&gt; WebHost.CreateDefaultBuilder(args) .ConfigureAppConfiguration((context, builder) =&gt; { builder.AddYaml(<span class="hljs-string"><span class="hljs-string">"appsettings.yaml"</span></span>); }) .UseStartup&lt;Startup&gt;(); }</code> </pre> </div></div><br><h2 id="otslezhivanie-izmeneniy">  Ubah pelacakan </h2><br><p>  Dalam konfigurasi <em>api yang</em> baru, dimungkinkan untuk membaca kembali sumber konfigurasi ketika diubah.  Pada saat yang sama, aplikasi tidak me-restart. <br>  Cara kerjanya: </p><br><ul><li>  Penyedia Konfigurasi memonitor perubahan sumber konfigurasi </li><li>  Jika perubahan konfigurasi terjadi, <em>IChangeToken</em> baru dibuat <em>.</em> </li><li>  Ketika <em>IChangeToken diubah</em> , reload konfigurasi dipanggil </li></ul><br><p>  Mari kita lihat bagaimana pelacakan perubahan diterapkan di <em>FileConfigurationProvider</em> . </p><br><pre> <code class="cs hljs">ChangeToken.OnChange( <span class="hljs-comment"><span class="hljs-comment">//producer () =&gt; Source.FileProvider.Watch(Source.Path), //consumer () =&gt; { Thread.Sleep(Source.ReloadDelay); Load(reload: true); });</span></span></code> </pre> <br><p>  Dua parameter dilewatkan ke metode <em>OnChange</em> dari kelas statis <em>ChangeToken</em> .  Parameter pertama adalah fungsi yang mengembalikan <em>IChangeToken</em> baru ketika sumber konfigurasi (dalam hal ini file) berubah, ini adalah apa yang disebut <em>produser</em> .  Parameter kedua adalah fungsi <em>callback</em> (atau <em>konsumen</em> ), yang akan dipanggil ketika sumber konfigurasi diubah. <br>  Pelajari lebih lanjut tentang kelas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ChangeToken</a> . </p><br><p>  Tidak semua penyedia konfigurasi menerapkan pelacakan perubahan.  Mekanisme ini tersedia untuk keturunan <em>FileConfigurationProvider</em> dan <em>AzureKeyVaultConfigurationProvider</em> . </p><br><h2 id="zaklyuchenie">  Kesimpulan </h2><br><p>  Di .NET Core, kami memiliki mekanisme yang mudah dan nyaman untuk mengelola pengaturan aplikasi.  Banyak add-on yang tersedia di luar kotak, banyak hal digunakan secara default. <br>  Tentu saja, setiap orang memutuskan cara mana yang akan menggunakannya, tetapi saya yakin bahwa orang tahu alat mereka. </p><br><p>  Artikel ini hanya membahas dasar-dasarnya.  Selain dasar-dasar, IOptions, skrip pasca-konfigurasi, validasi pengaturan, dan banyak lagi tersedia untuk kami.  Tapi itu cerita lain. </p><br><p>  Anda dapat menemukan proyek aplikasi dengan contoh-contoh dari artikel ini di repositori di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Github</a> . <br>  Bagikan komentar yang menggunakan pendekatan manajemen konfigurasi mana? <br>  Terima kasih atas perhatian anda </p><br><p>  <strong>upd</strong> .: Seperti yang disarankan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">AdAbsurdum</a> , ketika bekerja dengan array, elemen tidak akan selalu diganti ketika menggabungkan konfigurasi dari dua sumber. <br>  Pertimbangkan sebuah contoh.  Saat membaca array dari <em>appsettings.json</em> kita mendapatkan tampilan datar ini: </p><br><pre> <code class="plaintext hljs">array:0=valueA</code> </pre> <br><p>  Saat membaca dari <em>appsettings.Development.json</em> : </p><br><pre> <code class="plaintext hljs">array:0=valueB array:1=value</code> </pre> <br><p>  Akibatnya, konfigurasi akan menjadi: </p><br><pre> <code class="plaintext hljs">array:0=valueB array:1=value</code> </pre> <br><p>  Semua elemen dengan indeks unik ( <em>array: 1</em> pada contoh) akan ditambahkan ke array yang dihasilkan.  Elemen dari sumber konfigurasi yang berbeda, tetapi memiliki indeks yang sama ( <em>array: 0</em> dalam contoh) akan mengalami penggabungan, dan elemen yang ditambahkan terakhir akan digunakan. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id453416/">https://habr.com/ru/post/id453416/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id453406/index.html">Baterai modern untuk pemain Sony Discman</a></li>
<li><a href="../id453408/index.html">Kotak Alat untuk Peneliti - Edisi Kedua: Kumpulan 15 Databank Tematik</a></li>
<li><a href="../id453410/index.html">Jangan membuang umbi pintar di tempat sampah, atau bahaya IoT</a></li>
<li><a href="../id453412/index.html">Top 3D Shop menjadi distributor eksklusif UFactory</a></li>
<li><a href="../id453414/index.html">Naik turunnya IEO, semua yang perlu Anda ketahui tentang gelombang baru penggalangan dana</a></li>
<li><a href="../id453418/index.html">Apa yang perlu Anda ketahui sebelum pindah ke Akka toolkit untuk mengimplementasikan Pengadaan Acara dan CQRS</a></li>
<li><a href="../id453422/index.html">Berkenalan dengan ITSM: 10 habratopik dan materi ahli untuk ‚Äúpencelupan cepat‚Äù dalam topik ini</a></li>
<li><a href="../id453428/index.html">Meningkatkan keterbacaan kode dalam pengembangan iOS</a></li>
<li><a href="../id453430/index.html">Saat saya menulis pemantauan saya</a></li>
<li><a href="../id453432/index.html">Dari kritik hingga algoritma: suara para elit yang memudar di dunia musik</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>