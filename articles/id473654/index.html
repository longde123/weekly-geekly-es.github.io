<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßëüèΩ üï° üßïüèΩ PHP Composer: Perbaiki dependensi tanpa rasa sakit üòê üññüèº ‚õ©Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Banyak dari Anda pasti menemukan situasi di mana ada bug atau tidak fungsi yang diperlukan di perpustakaan atau kerangka kerja yang Anda gunakan. Misa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PHP Composer: Perbaiki dependensi tanpa rasa sakit</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/473654/"><p>  Banyak dari Anda pasti menemukan situasi di mana ada bug atau tidak fungsi yang diperlukan di perpustakaan atau kerangka kerja yang Anda gunakan.  Misalkan Anda tidak terlalu malas dan membentuk permintaan tarik.  Tetapi mereka tidak akan menerimanya segera, dan rilis produk berikutnya secara umum dapat terjadi dalam setahun. </p><br><p><img src="https://habrastorage.org/webt/jv/ys/9h/jvys9h_dh2zmefozo_xhrosiipo.jpeg" alt="Komposer PHP: memulihkan dependensi tanpa rasa sakit"></p><br><p>  Apa yang harus dilakukan jika Anda perlu melakukan koreksi terhadap produk?  Solusi yang jelas adalah dengan menggunakan garpu perpustakaan atau kerangka kerja.  Namun, tidak semuanya sederhana dengan garpu.  Menggunakan warisan untuk mengganti fungsi yang perlu diubah tidak selalu mungkin dan seringkali membutuhkan perubahan besar.  Plugin untuk Komposer yang dapat menambal dependensi datang untuk menyelamatkan. </p><br><p>  Dalam artikel ini saya akan berbicara lebih banyak tentang mengapa garpu tidak nyaman, dan juga mempertimbangkan dua plugin untuk Composer untuk penambalan dependensi: bagaimana mereka berbeda, bagaimana cara menggunakannya dan apa keuntungan mereka.  Jika Anda mengalami masalah yang sama atau hanya ingin tahu, selamat datang di kucing. <a name="habracut"></a></p><br><p> Masalahnya paling mudah dipertimbangkan dengan sebuah contoh.  Katakanlah kita ingin mengubah sesuatu di perpustakaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PHP Code Coverage</a> , yang digunakan dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kerangka</a> pengujian <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PHPUnit</a> untuk mengukur tingkat cakupan kode dengan tes.  Misalkan kita ingin memperbaiki sesuatu seperti ini di versi 7.0.8 (file <code>myFix.patch</code> ): </p><br><pre> <code class="diff hljs">diff --git a/src/CodeCoverage.php b/src/CodeCoverage.php index 2c92ae2..514171e 100644 --- a/src/CodeCoverage.php +++ b/src/CodeCoverage.php @@ -190,6 +190,7 @@ public function filter(): Filter */ public function getData(bool $raw = false): array { + // for example some changes here if (!$raw &amp;&amp; $this-&gt;addUncoveredFilesFromWhitelist) { $this-&gt;addUncoveredFilesFromWhitelist(); }</code> </pre> <br><p>  Mari kita buat perpustakaan contoh kita.  Biarkan itu menjadi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">php-composer-patches-example</a> .  Detail di sini tidak terlalu penting, tetapi jika Anda memutuskan untuk melihat apa perpustakaan itu, saya membawa output konsol di bawah spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">Teks tersembunyi</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">$ git clone git@github.com:mougrim/php-composer-patches-example.git   ¬´php-composer-patches-example¬ª‚Ä¶ remote: Enumerating objects: 3, done. remote: Counting objects: 100% (3/3), done. remote: Compressing objects: 100% (2/2), done. remote: Total 3 (delta 0), reused 0 (delta 0), pack-reused 0  : 100% (3/3), . $ cd php-composer-patches-example/ $ $ composer.phar init --name=mougrim/php-composer-patches-example --description="It's an example for article with using forks and patches for changing dependencies" --author='Mougrim &lt;rinat@mougrim.ru&gt;' --type=library --require='phpunit/phpunit:^8.4.2' --license=MIT --homepage='https://github.com/mougrim/php-composer-patches-example' Welcome to the Composer config generator This command will guide you through creating your composer.json config. Package name (&lt;vendor&gt;/&lt;name&gt;) [mougrim/php-composer-patches-example]: Description [It's an example for article with using forks and patches for changing dependencies]: Author [Mougrim &lt;rinat@mougrim.ru&gt;, n to skip]: Minimum Stability []: Package Type (eg library, project, metapackage, composer-plugin) [library]: License [MIT]: Define your dependencies. Would you like to define your dev dependencies (require-dev) interactively [yes]? no { "name": "mougrim/php-composer-patches-example", "description": "It's an example for article with using forks and patches for changing dependencies", "type": "library", "homepage": "https://github.com/mougrim/php-composer-patches-example", "require": { "phpunit/phpunit": "^8.4.2" }, "license": "MIT", "authors": [ { "name": "Mougrim", "email": "rinat@mougrim.ru" } ] } Do you confirm generation [yes]? yes Would you like to install dependencies now [yes]? yes Loading composer repositories with package information Updating dependencies (including require-dev) Package operations: 29 installs, 0 updates, 0 removals - Installing sebastian/version (2.0.1): Loading from cache - Installing sebastian/type (1.1.3): Loading from cache - Installing sebastian/resource-operations (2.0.1): Loading from cache - Installing sebastian/recursion-context (3.0.0): Loading from cache - Installing sebastian/object-reflector (1.1.1): Loading from cache - Installing sebastian/object-enumerator (3.0.3): Loading from cache - Installing sebastian/global-state (3.0.0): Loading from cache - Installing sebastian/exporter (3.1.2): Loading from cache - Installing sebastian/environment (4.2.2): Loading from cache - Installing sebastian/diff (3.0.2): Loading from cache - Installing sebastian/comparator (3.0.2): Loading from cache - Installing phpunit/php-timer (2.1.2): Loading from cache - Installing phpunit/php-text-template (1.2.1): Loading from cache - Installing phpunit/php-file-iterator (2.0.2): Loading from cache - Installing theseer/tokenizer (1.1.3): Loading from cache - Installing sebastian/code-unit-reverse-lookup (1.0.1): Loading from cache - Installing phpunit/php-token-stream (3.1.1): Loading from cache - Installing phpunit/php-code-coverage (7.0.8): Loading from cache - Installing doctrine/instantiator (1.2.0): Loading from cache - Installing symfony/polyfill-ctype (v1.12.0): Loading from cache - Installing webmozart/assert (1.5.0): Loading from cache - Installing phpdocumentor/reflection-common (2.0.0): Loading from cache - Installing phpdocumentor/type-resolver (1.0.1): Loading from cache - Installing phpdocumentor/reflection-docblock (4.3.2): Loading from cache - Installing phpspec/prophecy (1.9.0): Loading from cache - Installing phar-io/version (2.0.1): Loading from cache - Installing phar-io/manifest (1.0.3): Loading from cache - Installing myclabs/deep-copy (1.9.3): Loading from cache - Installing phpunit/phpunit (8.4.2): Loading from cache sebastian/global-state suggests installing ext-uopz (*) phpunit/phpunit suggests installing phpunit/php-invoker (^2.0.0) phpunit/phpunit suggests installing ext-soap (*) Writing lock file Generating autoload files $ $ echo 'vendor/' &gt; .gitignore $ echo 'composer.lock' &gt;&gt; .gitignore $ git add .gitignore composer.json $ $ git commit --gpg-sign --message='Init composer' [master ce800ae] Init composer 2 files changed, 18 insertions(+) create mode 100644 .gitignore create mode 100644 composer.json $ git push origin master  : 4, . Delta compression using up to 4 threads.  : 100% (3/3), .  : 100% (4/4), 1.21 KiB | 1.21 MiB/s, . Total 4 (delta 0), reused 0 (delta 0) To github.com:mougrim/php-composer-patches-example.git f31c342..ce800ae master -&gt; master</code> </pre> </div></div><br><h2 id="chto-ne-tak-s-forkom-zavisimosti">  Apa yang salah dengan garpu kecanduan </h2><br><p>  Mari kita lihat bagaimana ketergantungan garpu terjadi.  Mari kita coba pertanggungan Kode PHP. </p><br><ol><li>  Kami pergi ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">halaman Cakupan Kode PHP di GitHub</a> . </li><li>  Tekan tombol Fork <img src="https://habrastorage.org/webt/qj/ff/ta/qjfftaa4kurvcfu91mlrvr2twie.png" alt="Tombol Fork">  (catatan: Anda akan memiliki garpu, ganti mougrim dengan nama pengguna Anda). </li><li>  Mengkloning garpu: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git@github.com:mougrim/php-code-coverage.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> php-code-coverage</code> </pre> </li><li>  Buka versi yang ingin kami tambal: <br><pre> <code class="bash hljs">git checkout 7.0.8</code> </pre> </li><li>  Buat cabang untuk diperbaiki: <br><pre> <code class="bash hljs">git checkout -b 7.0.8-myFix</code> </pre> </li><li>  Kami melakukan perubahan yang diperlukan, komit, dorong: <br><pre> <code class="bash hljs">git apply ../myFix.patch git add src/CodeCoverage.php git commit --gpg-sign --message=<span class="hljs-string"><span class="hljs-string">'My fix'</span></span> git push -u origin 7.0.8-myFix</code> </pre> </li><li>  Tambahkan fork sebagai repositori di composer.json untuk perpustakaan kami (ini diperlukan agar saat menghubungkan paket <code>phpunit/php-code-coverage</code> , bukan paket asli yang terhubung, tetapi fork): <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../php-composer-patches-example git checkout -b useFork composer.phar config repositories.phpunit/php-code-coverage vcs https://github.com/mougrim/php-code-coverage.git</code> </pre> </li><li>  Ubah versi dependensi menjadi brunch: <br><pre> <code class="bash hljs">composer.phar require phpunit/php-code-coverage <span class="hljs-string"><span class="hljs-string">'dev-7.0.8-myFix'</span></span></code> </pre> </li></ol><br><p>  Tetapi sebenarnya ini masih lebih rumit: Komposer mengatakan bahwa pemasangan tidak mungkin, karena <code>phpunit/phpunit</code> memerlukan versi <code>phpunit/php-code-coverage</code> <code>^7.0.7</code> , dan untuk proyek kami memerlukan <code>dev-7.0.8-myFix</code> : </p><br><pre> <code class="plaintext hljs">$ composer.phar require phpunit/php-code-coverage 'dev-7.0.8-myFix' ./composer.json has been updated Loading composer repositories with package information Updating dependencies (including require-dev) Your requirements could not be resolved to an installable set of packages. Problem 1 - phpunit/phpunit 8.4.2 requires phpunit/php-code-coverage ^7.0.7 -&gt; satisfiable by phpunit/php-code-coverage[7.0.x-dev]. - phpunit/phpunit 8.4.2 requires phpunit/php-code-coverage ^7.0.7 -&gt; satisfiable by phpunit/php-code-coverage[7.0.x-dev]. - phpunit/phpunit 8.4.2 requires phpunit/php-code-coverage ^7.0.7 -&gt; satisfiable by phpunit/php-code-coverage[7.0.x-dev]. - Can only install one of: phpunit/php-code-coverage[7.0.x-dev, dev-7.0.8-myFix]. - Installation request for phpunit/php-code-coverage dev-7.0.8-myFix -&gt; satisfiable by phpunit/php-code-coverage[dev-7.0.8-myFix]. - Installation request for phpunit/phpunit ^8.4.2 -&gt; satisfiable by phpunit/phpunit[8.4.2]. Installation failed, reverting ./composer.json to its original content.</code> </pre> <br><p>  Apa yang harus dilakukan?  Ada empat opsi: </p><br><ol><li>  Selain fork <code>phpunit/php-code-coverage</code> , fork PHPUnit dan tulis versi <code>dev-7.0.8-myFix</code> untuk dependensi <code>phpunit/php-code-coverage</code> .  Jalur ini agak rumit dalam hal dukungan dan semakin rumit semakin banyak perpustakaan bergantung pada <code>phpunit/php-code-coverage</code> . </li><li>  Gunakan <a href="">alias</a> saat menghubungkan <code>phpunit/php-code-coverage</code> .  Tetapi alias tidak ditarik dari dependensi, yang berarti bahwa mereka akan selalu perlu ditulis secara manual. </li><li>  Buat <code>phpunit/php-code-coverage</code> di fork Anda sehingga tag <code>7.0.8</code> ke commit lain.  Ini setidaknya tidak jelas, tetapi maksimal - di Git tidak nyaman untuk bekerja dengan tag yang merujuk pada berbagai komitmen dengan nama yang sama di repositori jarak jauh yang berbeda. </li><li>  Di fork <code>phpunit/php-code-coverage</code> gunakan tag rilis alpha, misalnya <code>7.0.8-a+myFix</code> (mungkin ada tabrakan dengan rilis alpha dari pustaka sumber). </li></ol><br><p>  Semua opsi memiliki kekurangannya.  Saya juga mencoba menggunakan tag seperti <code>7.0.8.1</code> , tetapi Composer tidak menerima tag tersebut. </p><br><p>  Pilihan kedua dan keempat tampaknya lebih sedikit dari kejahatan.  Dengan jumlah tindakan mereka kira-kira sama, dalam artikel ini kami hanya akan mempertimbangkan satu - keempat.  Buat tag rilis alfa: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../php-code-coverage git tag 7.0.8<span class="hljs-_"><span class="hljs-_">-a</span></span>+myFix git push origin 7.0.8<span class="hljs-_"><span class="hljs-_">-a</span></span>+myFix <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../php-composer-patches-example composer.phar require phpunit/php-code-coverage <span class="hljs-string"><span class="hljs-string">'7.0.8-a+myFix'</span></span> git add composer.json git commit --gpg-sign --message=<span class="hljs-string"><span class="hljs-string">'Use fork'</span></span> git push -u origin useFork</code> </pre> <br><p>  Katakanlah kita ingin menggunakan pustaka kita <code>mougrim/php-composer-patches-example</code> dalam proyek yang bergantung pada <code>phpunit/phpunit</code> .  Di sini, seseorang tidak dapat melakukannya tanpa perdukunan, Anda harus menentukan repositori lagi <code>https://github.com/mougrim/php-code-coverage.git</code> untuk <code>phpunit/php-code-coverage</code> , serta secara eksplisit menunjukkan ketergantungan pada <code>phpunit/php-code-coverage</code> versi <code>7.0.8-a+myFix</code> (jika tidak instalasi tidak akan berhasil): </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../ mkdir php-project <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> php-project/ composer.phar require phpunit/phpunit <span class="hljs-string"><span class="hljs-string">'^8.4.2'</span></span> composer.phar config repositories.mougrim/php-composer-patches-example vcs https://github.com/mougrim/php-composer-patches-example.git composer.phar config repositories.phpunit/php-code-coverage vcs https://github.com/mougrim/php-code-coverage.git composer.phar require phpunit/php-code-coverage 7.0.8<span class="hljs-_"><span class="hljs-_">-a</span></span>+myFix composer.phar require mougrim/php-composer-patches-example dev-useFork</code> </pre> <br><p>  Harap dicatat bahwa contoh php-composer-patches terhubung sebagai repositori, karena repositori ini hanyalah sebuah contoh dan karenanya belum ditambahkan ke Packagist.  Dalam kasus Anda, langkah ini kemungkinan besar akan dilewati. </p><br><p>  Untuk meringkas penggunaan garpu. </p><br><p>  Keuntungan dari pendekatan ini: </p><br><ul><li>  Tidak perlu menginstal plugin untuk Composer. </li></ul><br><p>  Kekurangan dari pendekatan ini: </p><br><ul><li>  jika Anda menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>roave/security-advisories</code></a> , maka Anda tidak akan melihat informasi bahwa versi dependensi yang Anda gali dan modifikasi mengandung kerentanan; </li><li>  ketika versi baru dari dependensi keluar, cerita fork harus diulang lagi; </li><li>  jika Anda ingin memperbaiki dependensi dependensi, seperti dalam contoh yang dipertimbangkan, maka <code>dev-*</code> tidak akan bekerja untuk itu dan Anda harus perdukunan dengan versi atau fork untuk dependensi yang saling bertentangan; </li><li>  jika ada proyek yang bergantung pada perpustakaan Anda, Anda tidak perlu menginstal perpustakaan di proyek dengan cara yang paling jelas dan nyaman; </li><li>  jika ada proyek yang bergantung pada pustaka Anda, bagi mereka versi <code>phpunit/php-code-coverage</code> akan benar-benar diperbaiki, yang tidak selalu dapat diterima; </li><li>  Terlebih lagi, jika proyek dari poin-poin di atas sudah bercabang dengan PHP Code Coverage untuk beberapa alasan lain, maka semuanya menjadi lebih rumit. </li></ul><br><p>  Saya pikir Anda sudah menyadari bahwa kecanduan forking bukanlah ide yang baik. </p><br><h2 id="ispolzovanie-cweaganscomposer-patches">  Menggunakan cweagans / komposer-patch </h2><br><p>  Sekali lagi mengalami rasa sakit dan menderita menggunakan garpu, saya menemukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>cweagans/composer-patches</code></a> di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PHP Digest No. 101</a> (omong-omong, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">pronskiy memiliki</a> blog yang berguna, saya sarankan berlangganan).  Ini adalah plugin untuk omposer, yang memungkinkan Anda menerapkan tambalan untuk dependensi.  Setelah membaca deskripsi, saya pikir inilah yang Anda butuhkan. </p><br><p>  Cara menggunakan cweagans / komposer-patch: </p><br><ol><li>  Klon Cakupan Kode PHP: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../ rm -rf php-code-coverage git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git@github.com:sebastianbergmann/php-code-coverage.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> php-code-coverage</code> </pre> </li><li>  Buka versi yang ingin kami tambal: <br><pre> <code class="bash hljs">git checkout 7.0.8</code> </pre> </li><li>  Kami melakukan perubahan yang diperlukan. </li><li>  Buat tambalan: <br><pre> <code class="bash hljs">mkdir -p ../php-composer-patches-example/patches/phpunit/php-code-coverage git diff HEAD &gt; ../php-composer-patches-example/patches/phpunit/php-code-coverage/myFix.patch</code> </pre> </li><li>  Dalam proyek kami, kami menghubungkan <code>cweagans/composer-patches</code> : <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../php-composer-patches-example git checkout master composer.phar update git checkout -b cweagansComposerPatches composer.phar require cweagans/composer-patches <span class="hljs-string"><span class="hljs-string">'^1.6.7'</span></span></code> </pre> </li><li>  Untuk mengkonfigurasi <code>cweagans/composer-patches</code> tambahkan yang berikut ke <code>composer.json</code> (Anda dapat menentukan beberapa patches untuk satu paket): <br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"config"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"preferred-install"</span></span>: <span class="hljs-string"><span class="hljs-string">"source"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"extra"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"patches"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"phpunit/php-code-coverage"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"My fix description"</span></span>: <span class="hljs-string"><span class="hljs-string">"patches/phpunit/php-code-coverage/myFix.patch"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"enable-patching"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre> </li><li>  Perbarui dependensi: <br><pre> <code class="bash hljs">composer.phar update</code> </pre> </li><li>  Jika ada yang salah, ini bisa dilihat pada output dari perintah sebelumnya, tetapi untuk berjaga-jaga, Anda dapat memeriksa bahwa perubahan kami telah diterapkan: <br><pre> <code class="plaintext hljs">$ grep example vendor/phpunit/php-code-coverage/src/CodeCoverage.php // for example some changes here</code> </pre> </li><li>  Komit dan dorong hasilnya: <br><pre> <code class="bash hljs">git add composer.json patches/phpunit/php-code-coverage/myFix.patch git commit --gpg-sign --message=<span class="hljs-string"><span class="hljs-string">'Use cweagans/composer-patches'</span></span> git push -u origin cweagansComposerPatches</code> </pre> </li></ol><br><p>  Kami memastikan bahwa ketika menginstal perpustakaan kami di proyek, tambalan juga akan berlaku. </p><br><p>  Buat proyek: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../ rm -rf php-project mkdir php-project <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> php-project composer.phar require phpunit/phpunit <span class="hljs-string"><span class="hljs-string">'^8.4.2'</span></span></code> </pre> <br><p>  Tambahkan baris berikut ke <code>composer.json</code> : </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"extra"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"enable-patching"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre> <br><p>  Instal <code>mougrim/php-composer-patches-example</code> : </p><br><pre> <code class="bash hljs">composer.phar config repositories.mougrim/php-composer-patches-example vcs https://github.com/mougrim/php-composer-patches-example.git composer.phar require mougrim/php-composer-patches-example dev-cweagansComposerPatches</code> </pre> <br><p>  Tampaknya saat menghubungkan paket seharusnya ada upaya untuk menerapkan tambalan, tetapi tidak. <br>  Kami memperbarui paket sehingga tambalan berlaku, tetapi ini tidak terjadi: </p><br><pre> <code class="plaintext hljs">$ composer.phar update Removing package phpunit/php-code-coverage so that it can be re-installed and re-patched. - Removing phpunit/php-code-coverage (7.0.8) Loading composer repositories with package information Updating dependencies (including require-dev) Package operations: 1 install, 0 updates, 0 removals No patches supplied. Gathering patches for dependencies. This might take a minute. - Installing phpunit/php-code-coverage (7.0.8): Loading from cache - Applying patches for phpunit/php-code-coverage patches/phpunit/php-code-coverage/myFix.patch (My fix description) Could not apply patch! Skipping. The error was: The "patches/phpunit/php-code-coverage/myFix.patch" file could not be downloaded: failed to open stream: No such file or directory Writing lock file Generating autoload files</code> </pre> <br><p>  Setelah mencari-cari di pelacak bug, saya menemukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">patch berbasis File tidak diselesaikan dalam</a> bug <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dependensi</a> .  Ternyata Anda harus menentukan URL sebelum tambalan (yang berarti mengunduh dari suatu tempat), atau menentukan jalur ke tambalan secara manual di setiap proyek tempat Anda memasang dependensi yang memerlukan tambalan. </p><br><p>  Untuk meringkas penggunaan <code>cweagans/composer-patches</code> . </p><br><p>  Keuntungan dari pendekatan ini: </p><br><ul><li>  plugin memiliki komunitas; </li><li>  <code>roave/security-advisories</code> tidak akan berhenti bekerja; </li><li>  ketika versi baru dari dependensi dirilis, jika patch berhasil diterapkan, itu akan cukup untuk memastikan bahwa semuanya berfungsi dengan versi baru (untuk rilis minor, dengan probabilitas tinggi itu akan bekerja dengan sendirinya, untuk rilis besar juga kemungkinan tidak ada yang harus dilakukan); </li><li>  jika ada proyek yang bergantung pada pustaka Anda, bagi mereka versi <code>phpunit/php-code-coverage</code> tidak akan sepenuhnya diperbaiki; </li><li>  Selain itu, dalam kasus paragraf di atas, proyek semacam itu akan dapat menerapkan tambalannya dalam Cakupan Kode PHP. </li></ul><br><p>  Cons: </p><br><ul><li>  Ini adalah plugin untuk Komposer, yang berarti bahwa ketika memperbarui Komposer mungkin rusak; </li><li>  <code>enable-patching=true</code> harus ditentukan agar tambalan diterapkan dari dependensi; </li><li>  pengelola proyek utama tidak punya banyak waktu untuk menghadapinya, oleh karena itu, sebagai suatu peraturan, ia menerima permintaan tarik, tetapi tidak secara khusus mengembangkan proyek (misalnya, ia memiliki ide untuk versi kedua dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tugas</a> , tetapi sedikit yang berubah setelah tiga tahun); </li><li>  ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tambalan berbasis File tidak diselesaikan dalam</a> bug <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dependensi</a> , yang tidak nyaman dan telah menggantung di tumpukan selama tiga tahun sekarang; </li><li>  Anda tidak dapat menggunakan tambalan yang berbeda untuk versi dependensi yang berbeda. </li></ul><br><p>  Poin terakhir telah menjadi penghalang bagi saya.  Pertama saya membuat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">permintaan fitur</a> .  Pemelihara menulis bahwa ia tidak ingin menambahkan fitur ini ke kode utama, tetapi pada versi kedua akan dimungkinkan untuk menulis plug-in (ya, plug-in untuk plug-in untuk Composer).  Prospek untuk versi kedua tidak jelas, jadi saya memutuskan untuk mencari alternatif.  Di antara daftar kecil saya tidak menemukan plugin yang akan didukung. </p><br><p>  Saya tidak ingin masuk ke kode plugin, jadi saya memutuskan untuk garpu garpu - pasti, seseorang sudah menemukan masalah dan menyelesaikannya. </p><br><h2 id="ispolzovanie-vaimo-composer-patches">  Menggunakan Vaimo Composer Patches </h2><br><p>  Di sebagian besar garpu tidak ada perbedaan sama sekali dari aslinya (mengapa mereka bahkan bercabang?).  Sebagian dari fork dibuat untuk permintaan tarik, yang sudah digabung dengan perpustakaan utama.  Namun, ada satu kandidat yang menarik yang sedang memecahkan masalah saya - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Vaimo Composer Patches</a> .  Pada saat itu masih dibingkai sebagai garpu, tetapi pengelolanya, tampaknya, tidak akan melakukan permintaan tarik.  Antara lain, misalnya, dia sudah mengubah nama paket menjadi <code>vaimo/composer-patches</code> .  Tetapi ada masalah: masalah dinonaktifkan, yaitu, tidak ada umpan balik dari penulis sama sekali.  Juga, plugin tidak di-host di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Packagist</a> . </p><br><p>  Garpu yang baik seperti itu tidak boleh hilang di tumpukan garpu yang tidak berguna lainnya.  Oleh karena itu, saya menghubungi penulis dengan permintaan untuk mengaktifkan masalah dan menambahkan paket ke Packagist.  Setelah hampir satu bulan, penulis menjawab dan melakukan semua ini.  :) </p><br><p>  Menggunakan <code>vaimo/composer-patches</code> tidak berbeda dengan menggunakan plugin sebelumnya, tetapi Anda dapat menentukan patch yang berbeda untuk versi yang berbeda. </p><br><ol><li>  Kami memutar kembali perpustakaan kami (menghapus folder <code>vendor</code> diperlukan, karena plugin <code>cweagans/composer-patches</code> dan <code>vaimo/composer-patches</code> tidak sangat kompatibel satu sama lain): <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../php-composer-patches-example git checkout master rm -rf vendor/ composer.phar update</code> </pre> </li><li>  Kami melakukan poin 1-4 dari bagian sebelumnya. </li><li>  Dalam proyek kami, kami menghubungkan <code>vaimo/composer-patches</code> : <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../php-composer-patches-example git checkout -b vaimoComposerPatches composer.phar require vaimo/composer-patches <span class="hljs-string"><span class="hljs-string">'^4.20.2'</span></span></code> </pre> </li><li>  Untuk mengkonfigurasi <code>vaimo/composer-patches</code> tambahkan yang berikut ini ke <code>composer.json</code> (dokumentasi dapat dilihat di <a href="">sini</a> ): <br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"extra"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"patches"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"phpunit/php-code-coverage"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"My fix description"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"&lt; 7.0.0"</span></span>: <span class="hljs-string"><span class="hljs-string">"patches/phpunit/php-code-coverage/myFix-leagcy.patch"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"&gt;= 7.0.0"</span></span>: <span class="hljs-string"><span class="hljs-string">"patches/phpunit/php-code-coverage/myFix.patch"</span></span> } } } } }</code> </pre> </li><li>  Perbarui dependensi: <br><pre> <code class="bash hljs">composer.phar update</code> </pre> </li><li>  Jika terjadi kesalahan, ini dapat dilihat pada output dari perintah sebelumnya, tetapi untuk berjaga-jaga, Anda dapat memastikan bahwa perubahan kami diterapkan: <br><pre> <code class="plaintext hljs">$ grep example vendor/phpunit/php-code-coverage/src/CodeCoverage.php // for example some changes here</code> </pre> </li><li>  Komit dan dorong hasilnya: <br><pre> <code class="bash hljs">git add composer.json patches/phpunit/php-code-coverage/myFix.patch git commit --gpg-sign --message=<span class="hljs-string"><span class="hljs-string">'Use vaimo/composer-patches'</span></span> git push -u origin vaimoComposerPatches</code> </pre> </li></ol><br><p>  Kami memastikan bahwa ketika menginstal perpustakaan kami di proyek, tambalan juga akan berlaku. </p><br><p>  Buat proyek dan instal <code>mougrim/php-composer-patches-example</code> : </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../ rm -rf php-project mkdir php-project <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> php-project composer.phar require phpunit/phpunit <span class="hljs-string"><span class="hljs-string">'^8.4.2'</span></span> composer.phar config repositories.mougrim/php-composer-patches-example vcs https://github.com/mougrim/php-composer-patches-example.git composer.phar require mougrim/php-composer-patches-example dev-vaimoComposerPatches</code> </pre> <br><p>  Untuk jaga-jaga, Anda dapat memastikan bahwa perubahan kami telah diterapkan: </p><br><pre> <code class="plaintext hljs">$ grep example vendor/phpunit/php-code-coverage/src/CodeCoverage.php // for example some changes here</code> </pre> <br><p>  Untuk merangkum penggunaan <code>vaimo/composer-patches</code> . </p><br><p>  Kelebihan dari plugin ini hampir sama dengan yang sebelumnya, tetapi juga termasuk yang berikut: </p><br><ul><li>  pengelola secara aktif mengembangkan plugin dan telah merilis versi utama keempat; </li><li>  tidak perlu menentukan apa pun tambahan untuk tambalan dari dependensi untuk diterapkan; </li><li>  Anda dapat menggunakan tambalan yang berbeda untuk versi dependensi yang berbeda; </li><li>  plugin memiliki banyak pengaturan, jadi jika fungsionalitas yang dijelaskan dalam artikel tidak cukup untuk Anda, maka lihat dokumentasi - mungkin fitur yang Anda butuhkan sudah diterapkan. </li></ul><br><p>  Cons: </p><br><ul><li>  seperti yang sebelumnya, ini adalah plugin untuk Komposer, yang berarti bahwa ketika memperbarui Komposer mungkin rusak; </li><li>  tidak seperti plugin sebelumnya, komunitas ini memiliki lebih sedikit. </li></ul><br><h2 id="vyvody">  Kesimpulan </h2><br><p>  Untuk merangkum hasil umum: </p><br><ul><li>  menggunakan garpu paket untuk perbaikan kecil tidak nyaman; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>cweagans/composer-patches</code></a> adalah plugin yang bagus, tetapi berkembang dengan buruk, jadi saya tidak merekomendasikannya; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Vaimo Composer Patches</a> adalah plugin yang sangat baik yang memecahkan masalah memperbaiki dependensi dengan baik, dan juga memiliki banyak pengaturan; </li><li>  Vaimo Composer Patches memiliki komunitas kecil, tetapi saya harap artikel ini akan menambahnya; </li><li>  jika banyak perubahan diperlukan dalam dependensi, maka mungkin lebih mudah untuk menggunakan hard fork (jaga agar garpu independen dari dependensi asli). </li></ul><br><p>  Saya juga membuat kesimpulan tidak langsung: jika beberapa jenis ketergantungan tidak menyediakan fungsionalitas yang diperlukan, maka mungkin ada percabangan yang mengimplementasikan fungsi ini dan bahkan lebih. </p><br><p>  Di Badoo, kami menggunakan Vaimo Composer Patches dalam dua kasus: </p><br><ul><li>  di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SoftMock</a> untuk menambal PHPUnit dan Cakupan Kode PHP; </li><li>  dalam repositori internal untuk perbaikan Webmozart <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Assert</a> untuk kompatibilitas dengan SoftMocks sebagai perbaikan sementara (sementara SoftMocks tidak mendukung konstruksi <code>array_map(array('static', 'valueToString')</code> ). </li></ul><br><p>  Rinat Akhmadeev, Sr.  Pengembang PHP </p><br><p>  <strong>UPD1</strong> : Terima kasih <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">BoShurik</a> untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautannya</a> ke <a href="">alias</a> .  Menambahkan poin tentang alias ke artikel. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id473654/">https://habr.com/ru/post/id473654/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id473640/index.html">Sunset Data Besar</a></li>
<li><a href="../id473642/index.html">Cribble Crabble Gradle: Auto Build</a></li>
<li><a href="../id473646/index.html">Hackathon di sebuah perusahaan kecil: cara mengatur tanpa membuang kereta sumber daya</a></li>
<li><a href="../id473648/index.html">Kuda itu mati - menangis: transisi dari tslint ke eslint</a></li>
<li><a href="../id473652/index.html">Membuat API REST dengan Node.js dan Oracle Database. Bagian 5</a></li>
<li><a href="../id473656/index.html">Hugo Static Site Generator Experience</a></li>
<li><a href="../id473658/index.html">Menangani bug di Go 1.13</a></li>
<li><a href="../id473660/index.html">Arcade Reverse Engineering: Rekam Michael Jordan di NBA Jam</a></li>
<li><a href="../id473664/index.html">Pengalaman belajar langsung. Yandex.Practicum - Analis Data</a></li>
<li><a href="../id473666/index.html">Sebagai penulis fiksi ilmiah, Arthur Clark hampir menutup jurnal Tech - Youth</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>