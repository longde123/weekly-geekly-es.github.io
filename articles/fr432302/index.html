<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçüíª üë©üèº‚Äçü§ù‚Äçüë®üèª üßñüèª Mod√®les de s√©quence √† s√©quence, partie 2 ‚õπüèΩ üßôüèΩ üö®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous! 

 La deuxi√®me partie de la traduction, que nous avons publi√©e il y a quelques semaines, en pr√©paration du lancement du deuxi√®me volet...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mod√®les de s√©quence √† s√©quence, partie 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/432302/"> Bonjour √† tous! <br><br>  La deuxi√®me partie de la traduction, que nous avons publi√©e il y a quelques semaines, en pr√©paration du lancement du deuxi√®me volet du cours <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Data Scientist</a> .  En avant est un autre mat√©riel int√©ressant et une le√ßon ouverte. <br><br>  En attendant, nous sommes all√©s plus loin dans la jungle des mannequins. <br><br>  <b>Mod√®le de traduction neuronale</b> <br><br>  Bien que le c≈ìur du mod√®le de s√©quence √† s√©quence soit cr√©√© par des fonctions de <code>tensorflow/tensorflow/python/ops/seq2seq.py</code> , il existe encore quelques astuces utilis√©es dans notre mod√®le de traduction dans <code>models/tutorials/rnn/translate/seq2seq_model.py</code> , √† propos de m√©rite d'√™tre mentionn√©. <br><br><img src="https://habrastorage.org/webt/3z/s9/fy/3zs9fym7zcpeqweylxlqhknznko.png"><a name="habracut"></a><br><br>  <b>Softmax √©chantillonn√© et projection de sortie</b> <br><br>  Comme mentionn√© ci-dessus, nous voulons utiliser le softmax √©chantillonn√© pour travailler avec un grand dictionnaire de sortie.  Pour en d√©coder, vous devez suivre la projection de la sortie.  La perte de softmax √©chantillonn√©e et la projection de sortie sont g√©n√©r√©es par le code suivant dans <code>seq2seq_model.py</code> . <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> num_samples &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> num_samples &lt; self.target_vocab_size: w_t = tf.get_variable(<span class="hljs-string"><span class="hljs-string">"proj_w"</span></span>, [self.target_vocab_size, size], dtype=dtype) w = tf.transpose(w_t) b = tf.get_variable(<span class="hljs-string"><span class="hljs-string">"proj_b"</span></span>, [self.target_vocab_size], dtype=dtype) output_projection = (w, b) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sampled_loss</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(labels, inputs)</span></span></span><span class="hljs-function">:</span></span> labels = tf.reshape(labels, [<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-comment"><span class="hljs-comment"># We need to compute the sampled_softmax_loss using 32bit floats to # avoid numerical instabilities. local_w_t = tf.cast(w_t, tf.float32) local_b = tf.cast(b, tf.float32) local_inputs = tf.cast(inputs, tf.float32) return tf.cast( tf.nn.sampled_softmax_loss( weights=local_w_t, biases=local_b, labels=labels, inputs=local_inputs, num_sampled=num_samples, num_classes=self.target_vocab_size), dtype)</span></span></code> </pre><br>  Tout d'abord, notez que nous ne cr√©ons un softmax √©chantillonn√© que si le nombre d'√©chantillons (512 par d√©faut) est inf√©rieur √† la taille cible du dictionnaire.  Pour les dictionnaires inf√©rieurs √† 512, il est pr√©f√©rable d'utiliser la perte standard softmax. <br><br>  Ensuite, cr√©ez une projection de la sortie.  Il s'agit d'une paire compos√©e d'une matrice de poids et d'un vecteur de d√©placement.  Lorsqu'elle est utilis√©e, la cellule rnn renvoie les vecteurs de forme du nombre d'√©chantillons d'apprentissage par <code>size</code> , et non le nombre d'√©chantillons d' <code>target_vocab_size</code> par <code>target_vocab_size</code> .  Pour restaurer les logits, vous devez le multiplier par la matrice de poids et ajouter un d√©calage, ce qui se produit aux lignes 124-126 dans <code>seq2seq_model.py</code> . <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> output_projection <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> b <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(len(buckets)): self.outputs[b] = [tf.matmul(output, output_projection[<span class="hljs-number"><span class="hljs-number">0</span></span>]) + output_projection[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ...]</code> </pre> <br>  <b>Godet et rembourrage</b> <br><br>  En plus du softmax √©chantillonn√©, notre mod√®le de traduction utilise √©galement le <i>bucketing</i> , une m√©thode qui vous permet de g√©rer efficacement des phrases de diff√©rentes longueurs.  Pour commencer, expliquez le probl√®me.  Lors de la traduction de l'anglais vers le fran√ßais, nous avons des phrases anglaises de diff√©rentes longueurs L1 √† l'entr√©e et des phrases fran√ßaises de diff√©rentes longueurs L2 √† la sortie.  √âtant donn√© que la phrase anglaise est transmise sous forme d' <code>encoder_inputs</code> et que la phrase fran√ßaise est affich√©e sous forme d' <code>decoder_inputs</code> (avec le pr√©fixe de symbole GO), il est n√©cessaire de cr√©er un mod√®le seq2seq pour chaque paire (L1, L2 + 1) de longueurs de phrases anglais et fran√ßais.  En cons√©quence, nous obtenons un √©norme graphique compos√© de nombreux sous-graphiques similaires.  D'un autre c√¥t√©, nous pouvons ¬´compl√©ter¬ª chaque phrase avec des caract√®res PAD sp√©ciaux.  Et puis nous n'avons besoin que d'un seul mod√®le seq2seq pour les longueurs "compactes".  Mais un tel mod√®le sera inefficace en courtes phrases - vous devez encoder et d√©coder beaucoup de caract√®res PAD inutiles. <br><br>  Comme compromis entre la cr√©ation d'un graphique pour chaque paire de longueurs et le remplissage √† une seule longueur, nous utilisons un certain nombre de compartiments et remplissons chaque phrase √† la longueur du groupe ci-dessus.  Dans <code>translate.py</code> nous utilisons les groupes suivants par d√©faut. <br><br><pre> <code class="python hljs">buckets = [(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), (<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>), (<span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">25</span></span>), (<span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>)]</code> </pre> <br><br>  Ainsi, si une phrase anglaise avec 3 jetons arrive en entr√©e, et la phrase fran√ßaise correspondante contient 6 jetons en sortie, alors ils iront au premier groupe et seront remplis jusqu'√† la longueur 5 √† l'entr√©e de l'encodeur et la longueur 10 √† l'entr√©e du d√©codeur.  Et s'il y a 8 jetons dans l'offre anglaise et dans les 18 fran√ßais correspondants, ils ne tomberont pas dans le groupe (10, 15) et seront transf√©r√©s au groupe (20, 25), c'est-√†-dire que l'offre anglaise passera √† 20 jetons et la fran√ßaise √† 25. <br><br>  N'oubliez pas que lors de la cr√©ation de l'entr√©e du d√©codeur, nous ajoutons le caract√®re <code>GO</code> sp√©cial √† l'entr√©e.  Cela se produit dans la fonction <code>get_batch()</code> dans <code>seq2seq_model.py</code> , qui retourne √©galement la phrase anglaise.  Le retournement de l'entr√©e a aid√© √† am√©liorer les r√©sultats du mod√®le de traduction neuronale de <a href="">Sutskever et al., 2014 (pdf).</a>  Pour enfin comprendre, imaginez qu'il y a une phrase ¬´Je vais¬ª. √Ä l'entr√©e, divis√©e en jetons <code>["I", "go", "."]</code> , Et √† la sortie, il y a une phrase ¬´Je vais.¬ª, Cass√©e en jetons <code>["Je", "vais", "."]</code> .  Ils seront ajout√©s au groupe (5, 10), avec une repr√©sentation du codeur d'entr√©e <code>[PAD PAD "." "go" "I"]</code>  <code>[PAD PAD "." "go" "I"]</code> et entr√©e d√©codeur <code>[GO "Je" "vais" "." EOS PAD PAD PAD PAD PAD]</code>  <code>[GO "Je" "vais" "." EOS PAD PAD PAD PAD PAD]</code> . <br><br>  <b>Lancez-le</b> <br><br>  Pour former le mod√®le d√©crit ci-dessus, vous aurez besoin d'un grand corps anglo-fran√ßais.  Pour la formation, nous utiliserons les 10 ^ 9 corps fran√ßais-anglais du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site Web WMT'15</a> et testerons les nouvelles du m√™me site qu'un √©chantillon de travail.  Les deux jeux de donn√©es seront charg√©s dans <code>train_dir</code> lors de l' <code>train_dir</code> la prochaine commande. <br><br><pre> <code class="plaintext hljs">python translate.py --data_dir [your_data_directory] --train_dir [checkpoints_directory] --en_vocab_size=40000 --fr_vocab_size=40000</code> </pre> <br>  Vous aurez besoin de 18 Go d'espace disque dur et de plusieurs heures pour pr√©parer le b√¢timent de formation.  Le cas est d√©compress√©, les fichiers de dictionnaire sont cr√©√©s dans <code>data_dir,</code> puis le cas est tokenis√© et converti en identificateurs entiers.  Faites attention aux param√®tres responsables de la taille du dictionnaire.  Dans l'exemple ci-dessus, tous les mots en dehors des 40 000 mots les plus fr√©quemment utilis√©s seront convertis en jeton UNK repr√©sentant un mot inconnu.  Ainsi, lors du changement de la taille du dictionnaire, le binaire r√©formera le logement par l'identifiant de jeton.  Apr√®s le d√©but de la formation sur la pr√©paration des donn√©es. <br><br>  Les valeurs sp√©cifi√©es dans <code>translate</code> sont tr√®s √©lev√©es par d√©faut.  Les grands mod√®les qui apprennent depuis longtemps donnent de bons r√©sultats, mais cela peut prendre trop de temps ou trop de m√©moire GPU.  Vous pouvez sp√©cifier un entra√Ænement de mod√®le plus petit, comme dans l'exemple ci-dessous. <br><br><pre> <code class="plaintext hljs">python translate.py --data_dir [your_data_directory] --train_dir [checkpoints_directory] --size=256 --num_layers=2 --steps_per_checkpoint=50</code> </pre> <br>  La commande ci-dessus entra√Ænera le mod√®le avec deux couches (par d√©faut, il y en a 3), chacune ayant 256 unit√©s (par d√©faut - 1024), avec un point de contr√¥le √† toutes les 50 √©tapes (par d√©faut - 200).  Essayez ces options pour voir quel mod√®le de taille convient √† votre GPU. <br><br>  Pendant l'entra√Ænement, chaque √©tape du binaire <code>steps_per_checkpoin</code> t donnera des statistiques sur les √©tapes pass√©es.  Avec les param√®tres par d√©faut (3 couches de taille 1024), le premier message est le suivant: <br><br><pre> <code class="plaintext hljs">global step 200 learning rate 0.5000 step-time 1.39 perplexity 1720.62 eval: bucket 0 perplexity 184.97 eval: bucket 1 perplexity 248.81 eval: bucket 2 perplexity 341.64 eval: bucket 3 perplexity 469.04 global step 400 learning rate 0.5000 step-time 1.38 perplexity 379.89 eval: bucket 0 perplexity 151.32 eval: bucket 1 perplexity 190.36 eval: bucket 2 perplexity 227.46 eval: bucket 3 perplexity 238.66</code> </pre> <br>  Notez que chaque √©tape prend un peu moins de 1,4 seconde, perplexe l'√©chantillon d'apprentissage et perplexe l'√©chantillon de travail dans chaque groupe.  Apr√®s environ 30 mille pas, nous voyons comment les perplexes des phrases courtes (groupes 0 et 1) deviennent sans ambigu√Øt√©.  Le b√¢timent de formation contient environ 22 millions de phrases, une it√©ration (une s√©rie de donn√©es de formation) prend environ 340 mille pas avec un nombre d'√©chantillons de formation au nombre de 64. √Ä ce stade, le mod√®le peut √™tre utilis√© pour traduire des phrases anglaises en fran√ßais en utilisant l'option <code>--decode</code> . <br><br><pre> <code class="plaintext hljs">python translate.py --decode --data_dir [your_data_directory] --train_dir [checkpoints_directory] Reading model parameters from /tmp/translate.ckpt-340000 &gt; Who is the president of the United States? Qui est le pr√©sident des √âtats-Unis ?</code> </pre> <br>  <b>Et ensuite?</b> <br><br>  L'exemple ci-dessus montre comment cr√©er votre propre traducteur anglais-fran√ßais de bout en bout.  Ex√©cutez-le et voyez comment fonctionne le mod√®le.  La qualit√© est acceptable, mais un mod√®le de traduction id√©al ne peut pas √™tre obtenu avec des param√®tres par d√©faut.  Voici quelques points √† am√©liorer. <br><br>  Tout d'abord, nous utilisons la tokenisation primitive, la fonction de base de <code>basic_tokenizer</code> dans <code>data_utils</code> .  Un meilleur tokenizer peut √™tre trouv√© sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le site Web WMT'15</a> .  Si vous l'utilisez et un grand dictionnaire, vous pouvez obtenir de meilleures traductions. <br><br>  De plus, les param√®tres par d√©faut du mod√®le de traduction ne sont pas parfaitement configur√©s.  Vous pouvez essayer de changer la vitesse d'apprentissage, l'att√©nuation, l'initialisation des poids du mod√®le.  Vous pouvez √©galement remplacer le <code>GradientDescentOptimizer</code> standard dans <code>seq2seq_model.py</code> par quelque chose de plus avanc√©, comme <code>AdagradOptimizer</code> .  Essayez de regarder pour de meilleurs r√©sultats! <br><br>  Enfin, le mod√®le pr√©sent√© ci-dessus peut √™tre utilis√© non seulement pour la traduction, mais √©galement pour toute autre t√¢che de s√©quence √† s√©quence.  M√™me si vous souhaitez transformer une s√©quence en arbre, par exemple, g√©n√©rer un arbre d'analyse, ce mod√®le peut produire des r√©sultats de pointe, comme le montrent <a href="">Vinyals &amp; Kaiser et al., 2014 (pdf)</a> .  Vous pouvez donc cr√©er non seulement un traducteur, mais aussi un analyseur, un chat bot ou tout autre programme que vous souhaitez.  Exp√©rimentez! <br><br>  C'est tout! <br><br>  Nous attendons vos commentaires et questions ici ou nous vous invitons √† demander √† leur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">professeur</a> dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">une le√ßon ouverte</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr432302/">https://habr.com/ru/post/fr432302/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr432292/index.html">Polices variables et param√©triques - gagnant-gagnant pour les concepteurs</a></li>
<li><a href="../fr432294/index.html">Tour Ansible: mod√®les de travail de workflow</a></li>
<li><a href="../fr432296/index.html">Google vous maintient dans une "bulle de recherche" personnelle m√™me si vous quittez votre compte</a></li>
<li><a href="../fr432298/index.html">Timeweb est entr√© dans le TOP-10 des bureaux d'enregistrement de domaine dans la zone .RU</a></li>
<li><a href="../fr432300/index.html">Support, service, mal de t√™te et tout-tout</a></li>
<li><a href="../fr432304/index.html">Un neuroscientifique brillant qui peut avoir une cl√© pour cr√©er une v√©ritable intelligence artificielle</a></li>
<li><a href="../fr432306/index.html">M√©moire de classe de stockage dans le stockage - si vous en avez besoin encore plus rapidement</a></li>
<li><a href="../fr432308/index.html">Niveau Sci-Fi modulaire UE4: inspir√© par Nostromo et Serenity</a></li>
<li><a href="../fr432310/index.html">Ktor en tant que client HTTP pour Android</a></li>
<li><a href="../fr432312/index.html">Cr√©er une carte de forme de la carte RF dans Power BI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>