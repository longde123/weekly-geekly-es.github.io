<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐ง๐ฟ ๐ ุงูููุฏุณุฉ ุงูุนูุณูุฉ ูุชูุฏูู Witcher 3 ๐จ๐ฝโ๐ณ ๐๐ฟ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุงูุฌุฒุก ุงูุฃูู ูู ุงูุชุฑุฌูุฉ ููุง . ูู ูุฐุง ุงูุฌุฒุก ุ ุณูุชุญุฏุซ ุนู ุชุฃุซูุฑ ุงูุญุฏุฉ ููุชูุณุท โโุงูุณุทูุน ููุฑุงุญู ุงูููุฑ ูุงูุธูุงูุฑ ุงูุฌููุฉ ุฃุซูุงุก ุงููุทุฑ. 

 ุงูุฌุฒุก 6. ุดุญุฐ 
 ูู ูุฐุง ุง...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุงูููุฏุณุฉ ุงูุนูุณูุฉ ูุชูุฏูู Witcher 3</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437100/" style=";text-align:right;direction:rtl">  ุงูุฌุฒุก ุงูุฃูู ูู ุงูุชุฑุฌูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> .  ูู ูุฐุง ุงูุฌุฒุก ุ ุณูุชุญุฏุซ ุนู ุชุฃุซูุฑ ุงูุญุฏุฉ ููุชูุณุท โโุงูุณุทูุน ููุฑุงุญู ุงูููุฑ ูุงูุธูุงูุฑ ุงูุฌููุฉ ุฃุซูุงุก ุงููุทุฑ. <br><br><h2 style=";text-align:right;direction:rtl">  ุงูุฌุฒุก 6. ุดุญุฐ </h2><br>  ูู ูุฐุง ุงูุฌุฒุก ุ ุณูู ูููู ูุธุฑุฉ ูุงุญุตุฉ ุนูู ุชุฃุซูุฑ ุขุฎุฑ ุจุนุฏ ุงููุนุงูุฌุฉ ูู The Witcher 3 - Sharpen. <br><br>  ุดุญุฐ ูุฌุนู ุงูุตูุฑุฉ ุงููุงุชุฌ ุฃูุซุฑ ูุถูุญุง ููููุง.  ูุฐุง ุงูุชุฃุซูุฑ ูุนุฑูู ููุง ูู ุฎูุงู Photoshop ููุญุฑุฑู ุงูุฑุณูู ุงูุขุฎุฑูู. <br><br>  ูู The Witcher 3 ุ ูุฅู ุงูุชูุถูุญ ูุฏูู ุฎูุงุฑุงู: ููุฎูุถ ูุนุงูู.  ุณุฃุชุญุฏุซ ุนู ุงููุฑู ุจููููุง ุฃุฏูุงู ุ ูููู ุงูุขู ุ ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ููุทุงุช ุงูุดุงุดุฉ: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/285/1fc/6bc/2851fc6bc19e39660e0307f2775b0322.png" alt="ุงูุตูุฑุฉ"></div><br>  <i>ุงูุฎูุงุฑ "ููุฎูุถ" - ูุง ูุตู ุฅูู</i> <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/dc2/cd4/4cd/dc2cd44cd83306f2c08bbf7f87831d8c.png" alt="ุงูุตูุฑุฉ"></div><br>  <i>ุงูุฎูุงุฑ "ููุฎูุถ" - ุจุนุฏ</i> <br><a name="habracut"></a><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/aad/807/2aa/aad8072aa3977f32549856c0be24206b.png"></div><br>  <i>ุฎูุงุฑ ุนุงูู - ูุง ูุตู ุฅูู</i> <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/b87/3ce/0f3/b873ce0f320a785f4fb4bc83e9a696f5.png"></div><br>  <i>ุงูุฎูุงุฑ "ุนุงูู" - ุจุนุฏ</i> <br><br>  ุฅุฐุง ููุช ุชุฑูุฏ ุฅููุงุก ูุธุฑุฉ ุนูู ููุงุฑูุงุช (ุชูุงุนููุฉ) ุฃูุซุฑ ุชูุตููุงู ุ ูุฑุงุฌุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุณู ูู ุฏููู ุฃุฏุงุก Nvidia The Witcher 3</a> .  ููุง ุชุฑูู ุ ูุฅู ุงูุชุฃุซูุฑ ููุญูุธ ุจุดูู ุฎุงุต ุนูู ุงูุนุดุจ ูุฃูุฑุงู ุงูุดุฌุฑ. <br><br>  ูู ูุฐุง ุงูุฌุฒุก ูู ุงูููุดูุฑ ุ ุณูู ูุฏุฑุณ ุงูุฅุทุงุฑ ููุฐ ุจุฏุงูุฉ ุงููุนุจุฉ: ููุฏ ุงุฎุชุฑุช ุฐูู ุนู ูุตุฏ ุ ูุฃููุง ููุง ูุฑู ุงูุฅุบุงุซุฉ (ูุณุงูุฉ ุงูุฑุณู ุงูุทูููุฉ) ููุจุฉ ุงูุณูุงุก. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/898/e97/895/898e9789593705231157a07ebcf34f5e.png"></div><br>  ูููุง ูุชุนูู ุจุงูุฅุฏุฎุงู ุ ูุชุทูุจ ุงูุชูุถูุญ ูุฌูุฏ ูุฎุฒู ูุคูุช ูููู <b>t0</b> (LDR ุจุนุฏ ุชุตุญูุญ ุงููุบูุงุช ูุชููุฌ ุงูุนุฏุณุงุช) <b>ูุชุฎุฒูู</b> ูุคูุช ููุนูู <b>t1</b> . <br><br>  ุฏุนูุง ููุญุต ุฑูุฒ ุงููุฌููุน ูุชุธููู ุงูุจูุณู: <br><br> <code>ps_5_0 <br> dcl_globalFlags refactoringAllowed <br> dcl_constantbuffer cb3[3], immediateIndexed <br> dcl_constantbuffer cb12[23], immediateIndexed <br> dcl_sampler s0, mode_default <br> dcl_resource_texture2d (float,float,float,float) t0 <br> dcl_resource_texture2d (float,float,float,float) t1 <br> dcl_input_ps_siv v0.xy, position <br> dcl_output o0.xyzw <br> dcl_temps 7 <br> 0: ftoi r0.xy, v0.xyxx <br> 1: mov r0.zw, l(0, 0, 0, 0) <br> 2: ld_indexable(texture2d)(float,float,float,float) r0.x, r0.xyzw, t1.xyzw <br> 3: mad r0.x, r0.x, cb12[22].x, cb12[22].y <br> 4: mad r0.y, r0.x, cb12[21].x, cb12[21].y <br> 5: max r0.y, r0.y, l(0.000100) <br> 6: div r0.y, l(1.000000, 1.000000, 1.000000, 1.000000), r0.y <br> 7: mad_sat r0.y, r0.y, cb3[1].z, cb3[1].w <br> 8: add r0.z, -cb3[1].x, cb3[1].y <br> 9: mad r0.y, r0.y, r0.z, cb3[1].x <br> 10: add r0.y, r0.y, l(1.000000) <br> 11: ge r0.x, r0.x, l(1.000000) <br> 12: movc r0.x, r0.x, l(0), l(1.000000) <br> 13: mul r0.z, r0.x, r0.y <br> 14: round_z r1.xy, v0.xyxx <br> 15: add r1.xy, r1.xyxx, l(0.500000, 0.500000, 0.000000, 0.000000) <br> 16: div r1.xy, r1.xyxx, cb3[0].zwzz <br> 17: sample_l(texture2d)(float,float,float,float) r2.xyz, r1.xyxx, t0.xyzw, s0, l(0) <br> 18: lt r0.z, l(0), r0.z <br> 19: if_nz r0.z <br> 20: div r3.xy, l(0.500000, 0.500000, 0.000000, 0.000000), cb3[0].zwzz <br> 21: add r0.zw, r1.xxxy, -r3.xxxy <br> 22: sample_l(texture2d)(float,float,float,float) r4.xyz, r0.zwzz, t0.xyzw, s0, l(0) <br> 23: mov r3.zw, -r3.xxxy <br> 24: add r5.xyzw, r1.xyxy, r3.zyxw <br> 25: sample_l(texture2d)(float,float,float,float) r6.xyz, r5.xyxx, t0.xyzw, s0, l(0) <br> 26: add r4.xyz, r4.xyzx, r6.xyzx <br> 27: sample_l(texture2d)(float,float,float,float) r5.xyz, r5.zwzz, t0.xyzw, s0, l(0) <br> 28: add r4.xyz, r4.xyzx, r5.xyzx <br> 29: add r0.zw, r1.xxxy, r3.xxxy <br> 30: sample_l(texture2d)(float,float,float,float) r1.xyz, r0.zwzz, t0.xyzw, s0, l(0) <br> 31: add r1.xyz, r1.xyzx, r4.xyzx <br> 32: mul r3.xyz, r1.xyzx, l(0.250000, 0.250000, 0.250000, 0.000000) <br> 33: mad r1.xyz, -r1.xyzx, l(0.250000, 0.250000, 0.250000, 0.000000), r2.xyzx <br> 34: max r0.z, abs(r1.z), abs(r1.y) <br> 35: max r0.z, r0.z, abs(r1.x) <br> 36: mad_sat r0.z, r0.z, cb3[2].x, cb3[2].y <br> 37: mad r0.x, r0.y, r0.x, l(-1.000000) <br> 38: mad r0.x, r0.z, r0.x, l(1.000000) <br> 39: dp3 r0.y, l(0.212600, 0.715200, 0.072200, 0.000000), r2.xyzx <br> 40: dp3 r0.z, l(0.212600, 0.715200, 0.072200, 0.000000), r3.xyzx <br> 41: max r0.w, r0.y, l(0.000100) <br> 42: div r1.xyz, r2.xyzx, r0.wwww <br> 43: add r0.y, -r0.z, r0.y <br> 44: mad r0.x, r0.x, r0.y, r0.z <br> 45: max r0.x, r0.x, l(0) <br> 46: mul r2.xyz, r0.xxxx, r1.xyzx <br> 47: endif <br> 48: mov o0.xyz, r2.xyzx <br> 49: mov o0.w, l(1.000000) <br> 50: ret</code> <br> <br>  50 ุณุทุฑ ูู ุฑูุฒ ุงููุฌูุน ุชุจุฏู ููุฃููุง ูููุฉ ููููุฉ.  ุฏุนูุง ูููุจ ุนูู ุญููุง. <br><br><h3 style=";text-align:right;direction:rtl">  ุดุญุฐ ุชูููุฏ ุงููููุฉ </h3><br>  ุงูุฎุทูุฉ ุงูุฃููู ูู ุชุญููู ุงููุฎุฒู ุงููุคูุช ููุนูู (ุงูุณุทุฑ 1).  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃู "The Witcher 3" ูุณุชุฎุฏู ุนูู ููููุจ (1.0 - ุฅุบูุงู ุ 0.0 - ุจุนูุฏ).  ููุง ุชุนูู ุ ูุฅู ุนูู ุงูุฌูุงุฒ ูุฑุชุจุท ุจุดูู ุบูุฑ ุฎุทู (ุงูุธุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฐู ุงูููุงูุฉ ููุญุตูู ุนูู ุงูุชูุงุตูู</a> ). <br><br>  ุชููุฑ ุงูุฎุทูุท 3-6 ุทุฑููุฉ ูุซูุฑุฉ ููุงูุชูุงู ููุบุงูุฉ ูุฑุจุท ุนูู ุงูุฃุฌูุฒุฉ ูุฐุง [1.0 - 0.0] ุจููู [ุนู ุจูุนุฏ] (ูุถุนูุงูุง ูู ูุฑุญูุฉ MatrixPerspectiveFov).  ุฎุฐ ุจุนูู ุงูุงุนุชุจุงุฑ ุงูููู ูู ุงููุฎุฒู ุงููุคูุช ุซุงุจุช: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/636/345/52a/63634552ae9daf03f14305c118cccc25.png"></div><br>  ุจุนุฏ ุฃู ุจูุบุช ูููุฉ "ุงูุฅุบูุงู" 0.2 ุ ูุงููููุฉ "far" 5000 ุ ูููููุง ุญุณุงุจ ููู cb12_v21.xy ููุง ููู: <br><br> <code>cb12_v21.y = 1.0 / near <br> cb12_v21.x = - (1.0 / near) + (1.0 / near) * (near / far)</code> <br> <br>  ูุฐู ุงูุดูุฑุฉ ุดุงุฆุนุฉ ุฌุฏูุง ูู ุชุธููู TW3 ุ ูุฐูู ุฃุนุชูุฏ ุฃููุง ูุฌุฑุฏ ูุธููุฉ. <br><br>  ุจุนุฏ ุงูุญุตูู ุนูู "ุนูู ูุฑู ุงูุฑุคูุฉ" ุ ูุณุชุฎุฏู ุงูุฎุท 7 ุงููููุงุณ / ุงูุชุดููู ูุฅูุดุงุก ูุนุงูู ุงูุงุณุชููุงุก (ููุง ูุณุชุฎุฏู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุชุดุจุน ูุชูุตุฑ</a> ุงูููู ุนูู ุงููุงุตู ุงูุฒููู [0-1]). <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/e89/efd/571/e89efd5711cb2aa1a3c544e9deda9321.png"></div><br>  cb3_v1.xy ู cb3_v2.xy - ูุฐุง ูู ุณุทูุน ุชุฃุซูุฑ ุงูุชูุถูุญ ุนูู ูุณุงูุงุช ูุตูุฑุฉ ูุทูููุฉ.  ุฏุนูุง ูุณูููุง ุดุญุงุฏุฉูุฑุจ ูุดุญุฐ.  ููุฐุง ูู ุงููุฑู ุงููุญูุฏ ุจูู ุงูุฎูุงุฑุงุช "ุงูููุฎูุถุฉ" ู "ุนุงููุฉ" ููุฐุง ุงูุชุฃุซูุฑ ูู The Witcher 3. <br><br>  ุงูุขู ุญุงู ุงูููุช ูุงุณุชุฎุฏุงู ุงููุณุจุฉ ุงููุงุชุฌุฉ.  ูุง ุชููู ุงูุฎุทูุท ูู 8 ุฅูู 9 ุจูุนู <code>lerp(sharpenNear, sharpenFar, interpolationCoeff)</code> .  ูุง ูุฐุงุ  ุจูุถู ูุฐุง ุ ูุญุตู ุนูู ุณุทูุน ูุฎุชูู ุจุงููุฑุจ ูู ุฌูุฑุงูุช ูุจุนูุฏูุง ุนูู.  ุฃููู ูุธุฑุฉ: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/646/233/515/6462335151728759f236b58f14b894dd.png"></div><br>  ุฑุจูุง ูููู ูุฐุง ููุญูุธูุง ุจุงููุงุฏ ุ ููู ููุง ูููุง ุจุชุญุฑูููุง ุงุณุชูุงุฏูุง ุฅูู ุงููุณุงูุฉ ุงูุชู ูููู ูููุง ุณุทูุน ุงูุชูุถูุญ ุจุฌุงูุจ ุงููุงุนุจ (2.177151) ูุฏุฑุฌุฉ ุณุทูุน ุงูุชุฃุซูุฑ ุจุนูุฏุฉ ุฌุฏูุง (1.91303).  ุจุนุฏ ูุฐุง ุงูุญุณุงุจ ุ ูุถูู 1.0 ุฅูู ุงูุณุทูุน (ุงูุณุทุฑ 10).  ููุงุฐุง ูุฐุง ูุทููุจุ  ูููุชุฑุถ ุฃู ุงูุนูููุฉ lerp ุงูููุถุญุฉ ุฃุนูุงู ุฃุนุทุชูุง 0.0.  ุจุนุฏ ุฅุถุงูุฉ 1.0 ุ ูุญุตู ุนูู 1.0 ุจุดูู ุทุจูุนู ุ ููุฐู ูููุฉ ูู ุชุคุซุฑ ุนูู ุงูุจููุณู ุนูุฏ ุงูููุงู ุจุงููุถูุญ.  ูุฑุงุกุฉ ุงููุฒูุฏ ุนู ูุฐุง ุฃุฏูุงู. <br><br>  ุฃุซูุงุก ุงูุชูุถูุญ ุ ูุง ูุฑูุฏ ุงูุชุฃุซูุฑ ุนูู ุงูุณูุงุก.  ูููู ุชุญููู ุฐูู ุนู ุทุฑูู ุฅุถุงูุฉ ูุญุต ูุดุฑูุท ุจุณูุท: <br><br> <code>//   sharpen   <br> float fSkyboxTest = (fDepth &gt;= 1.0) ? 0 : 1;</code> <br> <br>  ูู The Witcher 3 ุ ุชุจูุบ ูููุฉ ุนูู ุงูุจูุณู ูู ุงูุณูุงุก 1.0 ุ ูุฐูู ูุณุชุฎุฏููุง ููุญุตูู ุนูู ููุน ูู "ุงููุฑุดุญ ุงูุซูุงุฆู" (ุญูููุฉ ูุซูุฑุฉ: ูู ูุฐู ุงูุญุงูุฉ ุ ูู ุชุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฎุทูุฉ</a> ุจุดูู ุตุญูุญ). <br><br>  ุงูุขู ูููููุง ูุถุงุนูุฉ ุงูุณุทูุน ุงููุญุฑู ุจูุงุณุทุฉ "ูุฑุดุญ ุงูุณูุงุก": <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/63c/ed1/f50/63ced1f5036d9ee63cfe54de6a501bc1.png"></div><br>  ูุชู ุชูููุฐ ูุฐุง ุงูุถุฑุจ ุนูู ุงูุณุทุฑ 13. <br><br>  ูุซุงู ุนูู ุฑูุฒ Shader: <br><br> <code>//    sharpen <br> float fSharpenAmount = fSharpenIntensity * fSkyboxTest;</code> <br> <br><h3 style=";text-align:right;direction:rtl">  ูุฑูุฒ ุฃุฎุฐ ุงูุนููุงุช ุจูุณู </h3><br>  ูุญุชูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">SV_Position</a> ุนูู ูุธูุฑ ููู ููุง: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฅุฒุงุญุฉ ูุตู ุจูุณู</a> .  ุงุชุถุญ ุฃู ูุฐุง ุจูุณู ูู ุงูุฒุงููุฉ ุงููุณุฑู ุงูุนููุง (0 ุ 0) ูุฏูู ุฅุญุฏุงุซูุงุช ููุณ (0 ุ 0) ูู ุญูุซ SV_Position.xy ุ ูููู (0.5 ุ 0.5).  ูุงู! <br><br>  ููุง ูุฑูุฏ ุฃู ูุฃุฎุฐ ุนููุฉ ูู ูุณุท ุงูุจูุณู ุ ูุฐูู ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ุงูุฃุณุทุฑ 14-16.  ููููู ูุชุงุจุชูุง ูู HLSL: <br><br> <code>//   . <br> //   ""   SV_Position.xy. <br> float2 uvCenter = trunc( Input.Position.xy ); <br> <br> //   ,       <br> uvCenter += float2(0.5, 0.5); <br> uvCenter /= g_Viewport.xy</code> <br> <br>  ููุงุญููุง ุ ูุฃุฎุฐ ุนููุงุช ูู ูุณูุฌ ุงูุฃููุงู ุงููุฏุฎูุฉ ูู texcoords "uvCenter".  ูุง ุชููู ุ ุณุชููู ูุชูุฌุฉ ุฃุฎุฐ ุงูุนููุงุช ูู ููุณูุง ููุง ูู ุงูุทุฑููุฉ "ุงูุนุงุฏูุฉ" (SV_Position.xy / ViewportSize.xy). <br><br><h3 style=";text-align:right;direction:rtl">  ูุดุญุฐ ุฃู ูุง ูุดุญุฐ </h3><br>  ูุนุชูุฏ ุงููุฑุงุฑ ุจุดุฃู ุงุณุชุฎุฏุงู ุดุญุฐ ุนูู fSharpenAmount. <br><br> <code>//     <br> float3 colorCenter = TexColorBuffer.SampleLevel( samplerLinearClamp, uvCenter, 0 ).rgb; <br> <br> //   <br> float3 finalColor = colorCenter; <br> <br> if ( fSharpenAmount &gt; 0 ) <br> { <br> //   sharpening... <br> } <br> <br> return float4( finalColor, 1 );</code> <br> <br><h3 style=";text-align:right;direction:rtl">  ุดุญุฐ </h3><br>  ููุฏ ุญุงู ุงูููุช ูุฅููุงุก ูุธุฑุฉ ุนูู ุงูุฏูุงูุน ุงูุฎูุงุฑุฒููุฉ ููุณูุง. <br><br>  ุจุดูู ุฃุณุงุณู ุ ูููุฐ ุงูุฅุฌุฑุงุกุงุช ุงูุชุงููุฉ: <br><br>  - ุนููุงุช ุฃุฑุจุนุฉ ุฃุถุนุงู ูุณูุฌ ููู ุงูุฅุฏุฎุงู ูู ุฒูุงูุง ุงูุจููุณู ุ <br><br>  - ูุถูู ุนููุงุช ููุญุณุจ ูุชูุณุท โโุงููููุฉ ุ <br><br>  - ูุญุณุจ ุงููุฑู ุจูู "ุงููุณุท" ู "ุงูุฒุงููุฉ ูุชูุณุท" ุ <br><br>  - ูุฌุฏ ุงูุญุฏ ุงูุฃูุตู ูููููู ุงููุทูู ูููุฑู ุ <br><br>  - ูุตุญุญ ูุญุฏ ุฃูุตู.  ุงููููุฉ ุงููุทููุฉ  ูููู ุจุงุณุชุฎุฏุงู ููู ูููุงุณ + ุงูุชุญูุฒ ุ <br><br>  - ูุญุฏุฏ ุญุฌู ุงูุชุฃุซูุฑ ุจุงุณุชุฎุฏุงู ุงูุญุฏ ุงูุฃูุตู.  ุงููููุฉ ุงููุทููุฉ  ุนูุตุฑ <br><br>  - ูุญุณุจ ูููุฉ ุงูุณุทูุน (luma) ูู "centerColor" ู "averageColor" ุ <br><br>  - ููุณู colorCenter ุฅูู ูููุง ุ <br><br>  - ูุญุณุจ ูููุฉ ูููุง ุฌุฏูุฏุฉ ูุญุฑูุฉ ุจูุงุกู ุนูู ุญุฌู ุงูุชุฃุซูุฑ ุ <br><br>  - ูุถุงุนู colorCenter ุจูุงุณุทุฉ ูููุฉ luma ุงูุฌุฏูุฏุฉ. <br><br>  ุงููุซูุฑ ูู ุงูุนูู ุ ููุงู ูู ุงูุตุนุจ ุนูู ูุนุฑูุฉ ุฐูู ุ ูุฃููู ูู ุฃุฌุฑุจ ูุทูููุง ูุฑุดุญุงุช ุดุญุฐ. <br><br>  ููุจุฏุฃ ุจููุท ุฃุฎุฐ ุงูุนููุงุช.  ููุง ุชุฑูู ูู ุฑูุฒ ุงููุฌูุน ุ ูุชู ุชูููุฐ ุฃุฑุจุน ูุฑุงุกุงุช ุงููููุณ. <br><br>  ุณูุชู ุนุฑุถ ุฐูู ุจุฃูุถู ุตูุฑุฉ ุจุงุณุชุฎุฏุงู ูุซุงู ูุตูุฑุฉ ุงูุจูุณู (ูุณุชูู ููุงุฑุฉ ุงูููุงู <i>ุฎุจูุฑ</i> ): <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/5e3/d46/5fa/5e3d465fadc0bccd551256c40c6e5368.png"></div><br>  ุชุณุชุฎุฏู ุฌููุน ุงููุฑุงุกุงุช ุงูููุฌูุฏุฉ ูู ุงูุชุธููู ุฃุฎุฐ ุนููุงุช ุซูุงุฆูุฉ ุงูุฎุท (D3D11_FILTER_MIN_MAG_LINEAR_MIP_POINT). <br><br>  ุงูุฅุฒุงุญุฉ ูู ุงููุฑูุฒ ุฅูู ูู ูู ุงูุฒูุงูุง ูู (ยฑ 0.5 ุ ยฑ 0.5) ุ ุงุนุชูุงุฏูุง ุนูู ุงูุฒุงููุฉ. <br><br>  ุงูุธุฑ ููู ูููู ุชูููุฐ ุฐูู ุนูู HLSLุ  ููุฑู: <br><br> <code>float2 uvCorner; <br> float2 uvOffset = float2( 0.5, 0.5 ) / g_Viewport.xy; // remember about division! <br> <br> float3 colorCorners = 0; <br> <br> //    <br> // -0,5, -0.5 <br> uvCorner = uvCenter - uvOffset; <br> colorCorners += TexColorBuffer.SampleLevel( samplerLinearClamp, uvCorner, 0 ).rgb; <br> <br> //    <br> // +0.5, -0.5 <br> uvCorner = uvCenter + float2(uvOffset.x, -uvOffset.y); <br> colorCorners += TexColorBuffer.SampleLevel( samplerLinearClamp, uvCorner, 0 ).rgb; <br> <br> //    <br> // -0.5, +0.5 <br> uvCorner = uvCenter + float2(-uvOffset.x, uvOffset.y); <br> colorCorners += TexColorBuffer.SampleLevel( samplerLinearClamp, uvCorner, 0 ).rgb; <br> <br> //    <br> // +0.5, +0.5 <br> uvCorner = uvCenter + uvOffset; <br> colorCorners += TexColorBuffer.SampleLevel( samplerLinearClamp, uvCorner, 0 ).rgb;</code> <br> <br>  ูุฐูู ุ ูุชู ุงูุขู ุชูุฎูุต ุฌููุน ุงูุนููุงุช ุงูุฃุฑุจุนุฉ ูู ูุชุบูุฑ "colorCorners".  ุฏุนูุง ูุชุจุน ูุฐู ุงูุฎุทูุงุช: <br><br> <code>//     <br> float3 averageColorCorners = colorCorners / 4.0; <br> <br> //    <br> float3 diffColor = colorCenter - averageColorCorners; <br> <br> //  . . RGB-  <br> float fDiffColorMaxComponent = max( abs(diffColor.x), max( abs(diffColor.y), abs(diffColor.z) ) ); <br> <br> //    <br> float fDiffColorMaxComponentScaled = saturate( fDiffColorMaxComponent * sharpenLumScale + sharpenLumBias ); <br> <br> //     . <br> //   "1.0" -      fSharpenIntensity  1.0. <br> float fPixelSharpenAmount = lerp(1.0, fSharpenAmount, fDiffColorMaxComponentScaled); <br> <br> //   ""     . <br> float lumaCenter = dot( LUMINANCE_RGB, finalColor ); <br> float lumaCornersAverage = dot( LUMINANCE_RGB, averageColorCorners ); <br> <br> //  "centerColor"    <br> float3 fColorBalanced = colorCenter / max( lumaCenter, 1e-4 ); <br> <br> //    <br> float fPixelLuminance = lerp(lumaCornersAverage, lumaCenter, fPixelSharpenAmount); <br> <br> //     <br> finalColor = fColorBalanced * max(fPixelLuminance, 0.0); <br> } <br> <br> return float4(finalColor, 1.0);</code> <br> <br>  ูุชู ุชูููุฐ ุงูุชุนุฑู ุนูู ุงูุญุงูุฉ ุนู ุทุฑูู ุญุณุงุจ ุงูุญุฏ ุงูุฃูุตู.  ุงููููุฉ ุงููุทููุฉ  ุนูุตุฑ ุงููุฑู.  ุฎุทูุฉ ุฐููุฉ!  ุชุญูู ูู ุงูุชุตูุฑ: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/aa9/a26/44a/aa9a2644a16b1b79c6213f7d4effe068.jpg"></div><br>  <i>ุชุตูุฑ ุงูุญุฏ ุงูุฃูุตู ูููููู ุงููุทูู ูููุฑู.</i> <br><br>  ุนุธูู  ุชุธููู HLSL ุงูููุงุฆู ูุชููุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> .  ุขุณู ููุชูุณูู ุงูููุฑุงุก ุฌุฏุง.  ููููู ุงุณุชุฎุฏุงู ุจุฑูุงูุฌ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">HLSLexplorer ุงูุฎุงุต</a> ุจู ูุชุฌุฑุจุฉ ุงูุฑูุฒ. <br><br>  ุฃุณุชุทูุน ุฃู ุฃููู ูุญุณู ุงูุญุธ ุฃู ุงูููุฏ ุฃุนูุงู ููุดุฆ ููุณ ููุฏ ุงูุชุฌููุน ููุง ูู ุงููุนุจุฉ! <br><br>  ูุชูุฎูุต: ููุชูุจ ุจุดูู ุฌูุฏ ููุบุงูุฉ ุชุธููู Witcher 3 (ูุงุญุธ ุฃู fPixelSharpenAmount ุฃูุจุฑ ูู 1.0! ูุฐุง ูุซูุฑ ููุงูุชูุงู ...).  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุฅู ุงูุทุฑููุฉ ุงูุฑุฆูุณูุฉ ูุชุบููุฑ ุณุทูุน ุงูุชุฃุซูุฑ ูู ุณุทูุน ุงููุงุฆูุงุช ุงููุฑูุจุฉ / ุงูุจุนูุฏุฉ.  ูู ูุฐู ุงููุนุจุฉ ุ ููุณูุง ุซูุงุจุช ุ  ููุฏ ุฌูุนุช ุนุฏุฉ ุฃูุซูุฉ ููููู: <br><br>  Skellige: <br><br><table style=";text-align:right;direction:rtl"><tbody><tr><th></th><th>  ุดุญุฐูุฑุจ </th><th>  ุดุญุฐ </th><th>  ุดุญุฐุงูููุงููุฉ </th><th>  ุดุญุฐุงูููุงููุฉ </th><th>  sharpenLumScale </th><th>  sharpenLumBias </th></tr><tr><td>  <b>ููุฎูุถุฉ</b> </td></tr></tbody><tbody><tr><td>  <b>ุนุงููุฉ</b> </td><td>  2.0 </td><td>  1.8 </td><td>  0.025 <br></td><td>  -0.25 <br></td><td>  -13.33333 <br></td><td>  1.33333 </td></tr></tbody></table><br>  ูุงูุฑ ููุฑูุงู: <br><br><table style=";text-align:right;direction:rtl"><tbody><tr><th></th><th>  ุดุญุฐูุฑุจ <br></th><th>  ุดุญุฐ <br></th><th>  ุดุญุฐุงูููุงููุฉ <br></th><th>  ุดุญุฐุงูููุงููุฉ <br></th><th>  sharpenLumScale <br></th><th>  sharpenLumBias <br></th></tr><tr><td>  ููุฎูุถุฉ <br></td><td>  0.57751 <br></td><td>  0.31303 <br></td><td>  0.06665 <br></td><td>  -0.33256 <br></td><td>  -1.0 <br></td><td>  2.0 <br></td></tr><tr><td>  ุนุงููุฉ <br></td><td>  2.17751 <br></td><td>  1.91303 <br></td><td>  0.06665 <br></td><td>  -0.33256 <br></td><td>  -1.0 <br></td><td>  2.0 </td></tr></tbody></table><br><h2 style=";text-align:right;direction:rtl">  ุงูุฌุฒุก 7. ูุชูุณุท โโุงูุณุทูุน </h2><br>  ูููู ุงูุนุซูุฑ ุนูู ุนูููุฉ ุญุณุงุจ ูุชูุณุท โโุณุทูุน ุงูุฅุทุงุฑ ุงูุญุงูู ูู ุฃู ูุนุจุฉ ููุฏูู ุญุฏูุซุฉ ุชูุฑูุจูุง.  ุบุงูุจูุง ูุง ุชุณุชุฎุฏู ูุฐู ุงููููุฉ ูุงุญููุง ูุชุฃุซูุฑ ุชููู ุงูุนูู ูุชุตุญูุญ ุงููุบูุฉ (ุงูุธุฑ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฌุฒุก ุงูุณุงุจู ูู</a> ุงูููุดูุฑ).  ูู ุงูุญููู ุงูุจุณูุทุฉ ุ ูุณุชุฎุฏู ุญุณุงุจ ุงูุณุทูุน ุ ุนูู ุณุจูู ุงููุซุงู ุ ุงููููุณ 512 <sup>2</sup> ุ ุซู ุญุณุงุจ ูุณุชููุงุช mip ูุชุทุจููู.  ูุฐุง ูุนูู ุนุงุฏุฉ ุ ูููู ูุญุฏ ูุซูุฑุง ูู ุงูุงุญุชูุงูุงุช.  ุชุณุชุฎุฏู ุญููู ุฃูุซุฑ ุชุนููุฏูุง ุชุธููู ุญุณุงุจู ูุคุฏู ุ ุนูู ุณุจูู ุงููุซุงู ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุงุฎุชุฒุงู ุงููุชูุงุฒู</a> . <br><br>  ุฏุนูุง ูุชุนุฑู ุนูู ููููุฉ ููุงู ูุฑูู CD Projekt Red ุจุญู ูุฐู ุงููุดููุฉ ูู The Witcher 3.  ูู ุงูุฌุฒุก ุงูุณุงุจู ุ ุฏุฑุณุช ุจุงููุนู ุชุตุญูุญ ุงููุบูุฉ ูุชููููุง ุ ูุจุงูุชุงูู ูุฅู ุงูุฌุฒุก ุงููุญูุฏ ุงููุชุจูู ูู ุงููุบุฒ ูู ูุชูุณุท โโุงูุณุทูุน. <br><br>  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ูุชููู ุญุณุงุจ ุงูุณุทูุน ุงููุชูุณุท โโูู The Witcher 3 ูู ุชูุฑูุฑูู.  ูู ุฃุฌู ุงููุถูุญ ุ ูุฑุฑุช ุชูุณูููุง ุฅูู ุฃุฌุฒุงุก ูููุตูุฉ ุ ูููุธุฑ ุฃููุงู ูู ุงูููุทุน ุงูุฃูู - "ุชูุฒูุน ุงูุณุทูุน" (ุญุณุงุจ ุงูุฑุณู ุงูุจูุงูู ููุณุทูุน). <br><br><h3 style=";text-align:right;direction:rtl">  ุชูุฒูุน ุงูุณุทูุน </h3><br>  ูู ุงูุณูู ุงูุนุซูุฑ ุนูู ูุฐูู ุงูุชูุฑูุฑูู ูู ุฃู ูุญูู ุฅุทุงุฑ.  ูุฐู ูู ุงูููุงููุงุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Dispatch</a> ุจุงูุชุฑุชูุจ ุงูุตุญูุญ ูุจู ุฅุฌุฑุงุก ุงูุชููู ุงูุนูู: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/7de/5fb/09c/7de5fb09ce00453f14262f9e2b1bae30.png"></div><br>  ุฏุนููุง ููุธุฑ ุฅูู ุงููุฏุฎูุงุช ููุฐุง ุงููุฑูุฑ.  ุงูู ูุญุชุงุฌ ุงูู ุงุซููู ูู ุงูููุงู: <br><br>  1) ุนุงุฒูุฉ ุฃููุงู HDR ุ ูุชู ุชูููู ูููุงุณูุง ุฅูู 1/4 ร 1/4 (ุนูู ุณุจูู ุงููุซุงู ุ ูู 1920 ร 1080 ุฅูู 480 ร 270) ุ <br><br>  2) ุนูู ููุก ุงูุดุงุดุฉ ุงูุนุงุฒูุฉ <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/021/38b/795/02138b795946d192f553eadc20d34366.png"></div><br>  <i>1/4 ร 1/4 HDR ููู ุนุงุฒูุฉ.</i>  <i>ูุงุญุธ ุงูุฎุฏุนุฉ ุตุนุจุฉ - ูุฐุง ุงููุฎุฒู ุงููุคูุช ูู ุฌุฒุก ูู ูุฎุฒู ูุคูุช ุฃูุจุฑ.</i>  <i>ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงููุฎุงุฒู ุงููุคูุชุฉ ูู ููุงุฑุณุฉ ุฌูุฏุฉ.</i> <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/0e3/62d/c97/0e362dc97908f75db564cff0f46b1e7e.png"></div><br>  <i>ููุก ุงูุดุงุดุฉ ุนูู ุงูุนุงุฒูุฉ</i> <br><br>  ููุงุฐุง ุงูุชุตุบูุฑ ุงูุนุงุฒูุฉ ุงููููุ  ุฃุนุชูุฏ ุฃู ุงูุฃูุฑ ููู ูุชุนูู ุจุงูุฃุฏุงุก. <br><br>  ุฃูุง ุจุงููุณุจุฉ ูุฅุฎุฑุงุฌ ูุฐุง ุงููุฑูุฑ ุ ููู ูุฎุฒู ูุคูุช ููุธู.  256 ุนูุตุฑ ูู 4 ุจุงูุช ููู ููููุง. <br><br>  ููุณ ูุฏู Shaders ูุนูููุงุช ุชุตุญูุญ ุงูุฃุฎุทุงุก ููุง ุ ูุฐูู ูููุชุฑุถ ุฃููุง ูุฌุฑุฏ ูุฎุฒู ูุคูุช ูููู int ุบูุฑ ุงููููุนุฉ. <br><br>  ูุงู: ุชุณุชุฏุนู ุงูุฎุทูุฉ ุงูุฃููู ูู ุญุณุงุจ ูุชูุณุท โโุงูุณุทูุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ClearUnorderedAccessViewUint</a> ูุฅุนุงุฏุฉ ุชุนููู ูุงูุฉ ุนูุงุตุฑ ุงููุฎุฒู ุงููุคูุช ุงูููุธู ุฅูู ุตูุฑ. <br><br>  ุฏุนูุง ูุฏุฑุณ ููุฏ ุงููุฌููุน ููุชุธููู ุงูุญุณุงุจู (ูุฐุง ูู ุฃูู ุชุธููู ุญุณุงุจู ูู ุชุญููููุง ุจุฃูููู!) <br><br> <code>cs_5_0 <br> dcl_globalFlags refactoringAllowed <br> dcl_constantbuffer cb0[3], immediateIndexed <br> dcl_resource_texture2d (float,float,float,float) t0 <br> dcl_resource_texture2d (float,float,float,float) t1 <br> dcl_uav_structured u0, 4 <br> dcl_input vThreadGroupID.x <br> dcl_input vThreadIDInGroup.x <br> dcl_temps 6 <br> dcl_tgsm_structured g0, 4, 256 <br> dcl_thread_group 64, 1, 1 <br> 0: store_structured g0.x, vThreadIDInGroup.x, l(0), l(0) <br> 1: iadd r0.xyz, vThreadIDInGroup.xxxx, l(64, 128, 192, 0) <br> 2: store_structured g0.x, r0.x, l(0), l(0) <br> 3: store_structured g0.x, r0.y, l(0), l(0) <br> 4: store_structured g0.x, r0.z, l(0), l(0) <br> 5: sync_g_t <br> 6: ftoi r1.x, cb0[2].z <br> 7: mov r2.y, vThreadGroupID.x <br> 8: mov r2.zw, l(0, 0, 0, 0) <br> 9: mov r3.zw, l(0, 0, 0, 0) <br> 10: mov r4.yw, l(0, 0, 0, 0) <br> 11: mov r1.y, l(0) <br> 12: loop <br> 13: utof r1.z, r1.y <br> 14: ge r1.z, r1.z, cb0[0].x <br> 15: breakc_nz r1.z <br> 16: iadd r2.x, r1.y, vThreadIDInGroup.x <br> 17: utof r1.z, r2.x <br> 18: lt r1.z, r1.z, cb0[0].x <br> 19: if_nz r1.z <br> 20: ld_indexable(texture2d)(float,float,float,float) r5.xyz, r2.xyzw, t0.xyzw <br> 21: dp3 r1.z, r5.xyzx, l(0.212600, 0.715200, 0.072200, 0.000000) <br> 22: imul null, r3.xy, r1.xxxx, r2.xyxx <br> 23: ld_indexable(texture2d)(float,float,float,float) r1.w, r3.xyzw, t1.yzwx <br> 24: eq r1.w, r1.w, cb0[2].w <br> 25: and r1.w, r1.w, cb0[2].y <br> 26: add r2.x, -r1.z, cb0[2].x <br> 27: mad r1.z, r1.w, r2.x, r1.z <br> 28: add r1.z, r1.z, l(1.000000) <br> 29: log r1.z, r1.z <br> 30: mul r1.z, r1.z, l(88.722839) <br> 31: ftou r1.z, r1.z <br> 32: umin r4.x, r1.z, l(255) <br> 33: atomic_iadd g0, r4.xyxx, l(1) <br> 34: endif <br> 35: iadd r1.y, r1.y, l(64) <br> 36: endloop <br> 37: sync_g_t <br> 38: ld_structured r1.x, vThreadIDInGroup.x, l(0), g0.xxxx <br> 39: mov r4.z, vThreadIDInGroup.x <br> 40: atomic_iadd u0, r4.zwzz, r1.x <br> 41: ld_structured r1.x, r0.x, l(0), g0.xxxx <br> 42: mov r0.w, l(0) <br> 43: atomic_iadd u0, r0.xwxx, r1.x <br> 44: ld_structured r0.x, r0.y, l(0), g0.xxxx <br> 45: atomic_iadd u0, r0.ywyy, r0.x <br> 46: ld_structured r0.x, r0.z, l(0), g0.xxxx <br> 47: atomic_iadd u0, r0.zwzz, r0.x <br> 48: ret</code> <br> <br>  ููุฎุฒู ูุคูุช ุซุงุจุช: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/c14/805/dc6/c14805dc6b7ffd431d9307cc46dcba0d.png"></div><br>  ูุญู ูุนูู ุจุงููุนู ุฃู ุงูุฅุฏุฎุงู ุงูุฃูู ูู ูุฎุฒู ูุคูุช ูููู HDR.  ูุน ุฌูุงุฒ FullHD ุ ุชุจูุบ ุฏูุฉ ุงูุดุงุดุฉ 480 ร 270.  ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ุฏุนูุฉ ุงูุฅุฑุณุงู. <br><br>  ุฅุฑุณุงู (270 ุ 1 ุ 1) - ููุฐุง ูุนูู ุฃููุง ูุฏูุฑ 270 ูุฌููุนุฉ ูู ุณูุงุณู ุงูุฑุณุงุฆู.  ุจุจุณุงุทุฉ ุ ูุญู ูุฏูุฑ ูุฌููุนุฉ ูุงุญุฏุฉ ูู ุงูุฎููุท ูู ูู ุณุทุฑ ูู ููู ุงููุฎุฒู ุงููุคูุช. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/e9a/a97/7e3/e9aa977e3f9a60104fe9a66d797a27cc.png"></div><br>  <i>ูู ูุฌููุนุฉ ูุคุดุฑ ุชุฑุงุจุท ูููุฐ ุณุทุฑ ูุงุญุฏ ูู HDR ููู ุงููุฎุฒู ุงููุคูุช</i> <br><br>  ุงูุขู ุจุนุฏ ุฃู ุฃุตุจุญ ูุฏููุง ูุฐุง ุงูุณูุงู ุ ุฏุนููุง ูุญุงูู ูุนุฑูุฉ ูุง ููุนูู ุงูุชุธููู. <br><br>  ุชุญุชูู ูู ูุฌููุนุฉ ูุคุดุฑุงุช ุชุฑุงุจุท ุนูู 64 ูุคุดุฑ ุชุฑุงุจุท ูู ุงูุงุชุฌุงู X (dcl_thread_group 64 ุ 1 ุ 1) ุ ุจุงูุฅุถุงูุฉ ุฅูู ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ ุ 256 ุนูุตุฑูุง ูุน 4 ุจุงูุช ููู (dcl_tgsm_structured g0 ุ 4 ุ 256). <br><br>  ูุงุญุธ ุฃููุง ูู ุงูุชุธููู ูุณุชุฎุฏู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">SV_GroupThreadID</a> (vThreadIDInGroup.x) [0-63] ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">SV_GroupID</a> (vThreadGroupID.x) [0-269]. <br><br>  1) ูุจุฏุฃ ุจุชุนููู ุฌููุน ููู ุงูููู ุงููุดุชุฑูุฉ ููุฐุงูุฑุฉ ุงููุดุชุฑูุฉ.  ูุธุฑูุง ูุฃู ุฅุฌูุงูู ุงูุฐุงูุฑุฉ ูุญุชูู ุนูู 256 ุนูุตุฑูุง ู 64 ูุคุดุฑ ุชุฑุงุจุท ููู ูุฌููุนุฉ ุ ูููู ุงูููุงู ุจุฐูู ุจุณูููุฉ ูู ุฎูุงู ุญููุฉ ุจุณูุทุฉ: <br><br> <code>//   -      . <br> //        64 ,          4 . <br> [unroll] for (uint idx=0; idx &lt; 4; idx++) <br> { <br> const uint offset = threadID + idx*64; <br> shared_data[ offset ] = 0; <br> }</code> <br> <br>  2) ุจุนุฏ ุฐูู ุ ูููุง ุจุชุนููู ุงูุญุงุฌุฒ ุจุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">GroupMemoryBarrierWithGroupSync</a> (sync_g_t).  ูููู ุจูุฐุง ูุถูุงู ุฅุนุงุฏุฉ ุชุนููู ุฌููุน ุณูุงุณู ุงูุนูููุงุช ูู ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ ูููุฌููุนุงุช ุฅูู ุงูุตูุฑ ูุจู ุงููุชุงุจุนุฉ ุฅูู ุงูุฎุทูุฉ ุงูุชุงููุฉ. <br><br>  3) ูููุฐ ุงูุขู ุญููุฉ ุ ูุงูุชู ูููู ูุชุงุจุชูุง ุชูุฑูุจูุง ูุซู ูุฐุง: <br><br> <code>// cb0_v0.x -      .  1920x1080   1920/4 = 480; <br> float ViewportSizeX = cb0_v0.x; <br> [loop] for ( uint PositionX = 0; PositionX &lt; ViewportSizeX; PositionX += 64 ) <br> { <br> ...</code> <br> <br>  ูุฐุง ูู ุจุณูุท ููุญููุฉ ูุน ุฒูุงุฏุฉ ูุฏุฑูุง 64 (ูู ูููุช ุจุงููุนู ููุงุฐุงุ). <br><br>  ุงูุฎุทูุฉ ุงูุชุงููุฉ ูู ุญุณุงุจ ููุถุน ุงูุจูุณู ุงููุญููู. <br><br>  ุฏุนููุง ูููุฑ ูู ุฐูู. <br><br>  ุจุงููุณุจุฉ ุฅูู ุฅุญุฏุงุซู Y ุ ูููููุง ุงุณุชุฎุฏุงู SV_GroupID.x ูุฃููุง ุฃุทูููุง 270 ูุฌููุนุฉ ุณูุงุณู ุฑุณุงุฆู. <br><br>  ููุชูุณูู X ุ ูููููุง ... ุงูุงุณุชูุงุฏุฉ ูู ุชุฏูู ุงููุฌููุนุฉ ุงูุญุงูู!  ุฏุนูุง ูุญุงูู ุงูููุงู ุจุฐูู. <br><br>  ูุธุฑูุง ููุฌูุฏ 64 ูุคุดุฑ ุชุฑุงุจุท ูู ูู ูุฌููุนุฉ ุ ุณูุชุฌุงูุฒ ูุฐุง ุงูุญู ุฌููุน ูุญุฏุงุช ุงูุจูุณู. <br><br>  ุงููุธุฑ ูู ูุฌููุนุฉ ุงูุฎูุท (0 ุ 0 ุ 0). <br><br>  - ุณูุนุงูุฌ ุงูุฏูู (0 ุ 0 ุ 0) ูุญุฏุงุช ุงูุจูุณู (0 ุ 0) ุ (64 ุ 0) ุ (128 ุ 0) ุ (192 ุ 0) ุ (256 ุ 0) ุ (320 ุ 0) ุ (384 ุ 0) ุ (448ุ0). <br><br>  - ูุนุงูุฌ ูุคุดุฑ ุงูุชุฑุงุจุท (1 ุ 0 ุ 0) ูุญุฏุงุช ุงูุจูุณู (1 ุ 0) ุ (65 ุ 0) ุ (129 ุ 0) ุ (193 ุ 0) ุ (257 ุ 0) ุ (321 ุ 0) ุ (385 ุ 0) ุ (449 ุ 0) ... <br><br>  - ุณูุนุงูุฌ ุงูุฏูู (63 ุ 0 ุ 0) ุงูุจููุณูุงุช (63 ุ 0) ุ (127 ุ 0) ุ (191 ุ 0) ุ (255 ุ 0) ุ (319 ุ 0) ุ (383 ุ 0) ุ (447 ุ 0) <br><br>  ูุจุงูุชุงูู ุ ุณูุชู ูุนุงูุฌุฉ ุฌููุน ุจูุณู. <br><br>  ูุญุชุงุฌ ุฃูุถูุง ุฅูู ุงูุชุฃูุฏ ูู ุนุฏู ุชุญููู ุงูุจูุณู ูู ุฎุงุฑุฌ ูุฎุฒู ุงูุฃููุงู ุงููุคูุช: <br><br> <code>//      X.  Y  GroupID. <br> uint CurrentPixelPositionX = PositionX + threadID; <br> uint CurrentPixelPositionY = groupID; <br> if ( CurrentPixelPositionX &lt; ViewportSizeX ) <br> { <br> // HDR- . <br> //   HDR-    ,     . <br> uint2 colorPos = uint2(CurrentPixelPositionX, CurrentPixelPositionY); <br> float3 color = texture0.Load( int3(colorPos, 0) ).rgb; <br> float luma = dot(color, LUMA_RGB);</code> <br> <br>  ุงูุธุฑุ  ุงููุง ุจุณูุทุฉ ุฌุฏุง! <br><br>  ุฃูุง ุฃูุถุง ุญุณุงุจ ุงูุณุทูุน (ุงูุณุทุฑ 21 ูู ุฑูุฒ ุงููุฌูุน). <br><br>  ุฑุงุฆุน ุ ููุฏ ูููุง ุจุงููุนู ุจุญุณุงุจ ุงูุณุทูุน ูู ุจูุณู ุงูููู.  ูุงูุฎุทูุฉ ุงูุชุงููุฉ ูู ุชุญููู (ูููุณ ุนููุฉ!) ูููุฉ ุนูู ุงูููุงุจูุฉ. <br><br>  ูููู ููุง ูุฏููุง ูุดููุฉ ุ ูุฃููุง ุฑุจุทูุง ุนุงุฒูุฉ ุฃุนูุงู ุญู ูุงูู.  ูุงุฐุง ุชูุนู ุญูุงู ุฐููุ <br><br>  ูุฐุง ุจุณูุท ุจุดูู ูุฏูุด - ููุท ูู ุจุถุฑุจ colorPos ุจูุงุณุทุฉ ุจุนุถ ุงูุซุงุจุช (cb0_v2.z).  ูููุง ุจุชุฎููุถ ุงููุฎุฒู ุงููุคูุช ูููู HDR ุฃุฑุจุน ูุฑุงุช.  ูุจุงูุชุงูู ูุฅู ุงููููุฉ 4! <br><br> <code>const int iDepthTextureScale = (int) cb0_v2.z; <br> uint2 depthPos = iDepthTextureScale * colorPos; <br> float depth = texture1.Load( int3(depthPos, 0) ).x;</code> <br> <br>  ุญุชู ุงูุขู ุฌูุฏ ุฌุฏุง!  ูููู ... ูุตููุง ุฅูู ุฎุทูุท 24-25 ... <br><br> <code>24: eq r2.x, r2.x, cb0[2].w <br> 25: and r2.x, r2.x, cb0[2].y</code> <br> <br>  ุงุฐู  ุฃููุงู ุ ูุฏููุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงุฑูุฉ ุจุงููุณุงูุงุฉ ุจูู</a> ุงูููุงุท ุงูุนุงุฆูุฉ ุ ูุงููุชูุฌุฉ ููุชูุจุฉ ุจู r2.x ุ ูุจุนุฏ ุฐูู ูุจุงุดุฑุฉ ... ูุงุฐุงุ  Bitwise <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ู</a> ุุ  ุญูุงุ  ููุญุตูู ุนูู ูููุฉ ุงูููุทุฉ ุงูุนุงุฆูุฉุ  ูุงุฐุง ุจุญู ุงูุฌุญูู ุุ <br><br>  <b>ูุดููุฉ 'eq + ู'</b> <br><br>  ุงุณูุญูุง ูู ุฃู ุฃููู ุฃูู ุจุงููุณุจุฉ ูู ูุงู ุงูุฌุฒุก ุงูุฃุตุนุจ ูู ุงูุชุธููู.  ุญุงููุช ุญุชู ูุฌููุนุงุช asint / asfloat ุบุฑูุจุฉ ... <br><br>  ูุฅุฐุง ููุช ุชุณุชุฎุฏู ููุฌ ูุฎุชูู ููููุงุ  ูููู ููุท ุจุฅุฌุฑุงุก ุงูููุงุฑูุฉ ุงููุนุชุงุฏุฉ ูู ูุธุงู HLSL. <br><br> <code>float DummyPS() : SV_Target0 <br> { <br> float test = (cb0_v0.x == cb0_v0.y); <br> return test; <br> }</code> <br> <br>  ูููุง ูู ุงูุฅุฎุฑุงุฌ ูู ุฑูุฒ ุงููุฌูุน: <br><br> <code>0: eq r0.x, cb0[0].y, cb0[0].x <br> 1: and o0.x, r0.x, l(0x3f800000) <br> 2: ret</code> <br> <br>  ูุซูุฑุฉ ููุงูุชูุงู ุ ุฃููุณ ูุฐููุ  ูู ุฃูู ุฃุชููุน ุฃู ุฃุฑู "ู" ููุง. <br><br>  0x3f800000 ูู 1.0f ููุท ... ูุฐุง ููุทูู ูุฃููุง ูุญุตู ุนูู 1.0 ู 0.0 ูุฅูุง ุฅุฐุง ูุฌุญุช ุงูููุงุฑูุฉ. <br><br>  ูููู ูุงุฐุง ูู "ุงุณุชุจุฏููุง" 1.0 ุจูููุฉ ุฃุฎุฑูุ  ุนูู ุณุจูู ุงููุซุงู ุ ูุซู ูุฐุง: <br><br> <code>float DummyPS() : SV_Target0 <br> { <br> float test = (cb0_v0.x == cb0_v0.y) ? cb0_v0.z : 0.0; <br> return test; <br> }</code> <br> <br>  ูุญุตู ุนูู ุงููุชูุฌุฉ ุงูุชุงููุฉ: <br><br> <code>0: eq r0.x, cb0[0].y, cb0[0].x <br> 1: and o0.x, r0.x, cb0[0].z <br> 2: ret</code> <br> <br>  ูุง!  ููุฏ ูุฌุญุช.  ูุฐุง ูู ูุฌุฑุฏ ุณุญุฑ ุงููุชุฑุฌู HLSL.  ููุงุญุธุฉ: ุฅุฐุง ุงุณุชุจุฏูุช 0.0 ุจุดูุก ุขุฎุฑ ุ ูุณุชุญุตู ุนูู movc. <br><br>  ุฏุนูุง ูุนูุฏ ุฅูู ุงูุชุธููู ุงูุญุณุงุจู.  ุงูุฎุทูุฉ ุงูุชุงููุฉ ูู ุงูุชุญูู ูู ุฃู ุงูุนูู ูุณุงูู cb0_v2.w.  ูุณุงูู ุฏุงุฆููุง 0.0 - ูุจุนุจุงุฑุฉ ุฃุฎุฑู ุ ูุชุญูู ููุง ุฅุฐุง ูุงู ุงูุจููุณู ูู ุทุงุฆุฑุฉ ุจุนูุฏุฉ (ูู ุงูุณูุงุก).  ุฅุฐุง ูุงู ุงูุฃูุฑ ูุฐูู ุ ููุญู ูุนููู ูุฐุง ุงููุนุงูู ุจุนุถ ุงููููุฉ ุ ุญูุงูู 0.5 (ููุฏ ุฑุงุฌุนุช ุนูู ุนุฏุฉ ุฅุทุงุฑุงุช). <br><br>  ูุชู ุงุณุชุฎุฏุงู ูุฐุง ุงููุนุงูู ุงููุญุณูุจ ููุชุญุฑูู ุจูู ุณุทูุน ุงูููู ูุณุทูุน "ุงูุณูุงุก" (ูููุฉ cb0_v2.x ุ ูุงูุชู ุบุงูุจุงู ูุง ุชุณุงูู 0.0).  ุฃูุชุฑุถ ุฃู ูุฐุง ุถุฑูุฑู ููุชุญูู ูู ุฃูููุฉ ุงูุณูุงุก ูู ุญุณุงุจ ูุชูุณุท โโุงูุณุทูุน.  ุนุงุฏุฉ ูุง ูุชู ุชูููู ุงูุฃูููุฉ.  ููุฑุฉ ุฐููุฉ ุฌุฏุง. <br><br> <code>// ,       ( ).  ,    ,    <br> //    . <br> float value = (depth == cb0_v2.w) ? cb0_v2.y : 0.0; <br> <br> //  'value'  0.0,   lerp    'luma'.   'value'  <br> // (  0.50),   luma    . (cb0_v2.x    0.0). <br> float lumaOk = lerp( luma, cb0_v2.x, value );</code> <br> <br>  ูุธุฑูุง ูุฃู ูุฏููุง lumaOk ุ ูุฅู ุงูุฎุทูุฉ ุงูุชุงููุฉ ูู ุญุณุงุจ ุงูููุบุงุฑูุชู ุงูุทุจูุนู ูุฅูุดุงุก ุชูุฒูุน ุฌูุฏ.  ูููู ูููุง ุ ุฏุนูุง ูููู lumaOk ูู 0.0.  ูุญู ูุนูู ุฃู ูููุฉ ุงูุณุฌู (0) ุบูุฑ ูุญุฏุฏุฉ ุ ูุฐูู ูุถูู 1.0 ูุฃู log (1) = 0.0. <br><br>  ุจุนุฏ ุฐูู ุ ูููุณ ุงูููุบุงุฑูุชู ุงููุญุณูุจ ุนูู 128 ูุชูุฒูุนู ูู 256 ุฎููุฉ.  ุฐูู ุฌุฏุง! <br><br>  ููู ููุง ูุชู ุฃุฎุฐ ูุฐู ุงููููุฉ 88.722839.  ูุฐุง ูู <code>128 *   (2)</code> . <br><br>  ูุฐู ูุฌุฑุฏ ุทุฑููุฉ ูุญุณุงุจ HLSL ุงูููุบุงุฑูุชูุงุช. <br><br>  ููุงู ูุธููุฉ ูุงุญุฏุฉ ููุท ูู ุชุนูููุฉ ุจุฑูุฌูุฉ HLSL ุชููู ุจุญุณุงุจ ุงูููุบุงุฑูุชูุงุช: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">log</a> ุ ูููุง ูุงุนุฏุฉ 2. <br><br> <code>// ,  lumaOk  0.0. <br> // log(0)   undefined <br> // log(1) = 0. <br> //     <br> lumaOk = log(lumaOk + 1.0); <br> <br> //     128 <br> lumaOk *= 128;</code> <br> <br>  ุฃุฎูุฑูุง ุ ูููู ุจุญุณุงุจ ููุฑุณ ุงูุฎููุฉ ูู ุงูุณุทูุน ุงูููุฒุน ููุบุงุฑูุชูููุง ููุถูู 1 ุฅูู ุงูุฎููุฉ ุงูููุงุจูุฉ ูู ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ. <br><br> <code>//   .    Uint,    256 , <br> //  ,      . <br> uint uLuma = (uint) lumaOk; <br> uLuma = min(uLuma, 255); <br> <br> //  1    . <br> InterlockedAdd( shared_data[uLuma], 1 );</code> <br> <br>  ุณุชููู ุงูุฎุทูุฉ ุงูุชุงููุฉ ูุฑุฉ ุฃุฎุฑู ุชุนููู ุญุงุฌุฒ ูุถูุงู ูุนุงูุฌุฉ ุฌููุน ูุญุฏุงุช ุงูุจูุณู ูู ุงูุตู. <br><br>  ูุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ ูู ุฅุถุงูุฉ ููู ูู ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ ุฅูู ุงููุฎุฒู ุงููุคูุช ุงูููููู.  ูุชู ุฐูู ุจููุณ ุงูุทุฑููุฉ ุ ูู ุฎูุงู ุญููุฉ ุจุณูุทุฉ: <br><br> <code>// ,       <br> GroupMemoryBarrierWithGroupSync(); <br> <br> //      . <br> [unroll] for (uint idx = 0; idx &lt; 4; idx++) <br> { <br> const uint offset = threadID + idx*64; <br> <br> uint data = shared_data[offset]; <br> InterlockedAdd( g_buffer[offset], data ); <br> }</code> <br> <br>  ุจุนุฏ ููุก ุฌููุน ูุคุดุฑุงุช ุงูุชุฑุงุจุท 64 ูู ูุฌููุนุฉ ูุคุดุฑ ุงูุชุฑุงุจุท ุงูุจูุงูุงุช ุงูุดุงุฆุนุฉ ุ ูุถูู ูู ูุคุดุฑ ุชุฑุงุจุท 4 ููู ุฅูู ุงููุฎุฒู ุงููุคูุช ุงูุฅุฎุฑุงุฌ. <br><br>  ุงููุธุฑ ูู ุงููุฎุฒู ุงููุคูุช ุงูุฅุฎุฑุงุฌ.  ุฏุนููุง ูููุฑ ูู ุฐูู.  ูุฌููุน ุฌููุน ุงูููู ูู ุงููุฎุฒู ุงููุคูุช ูุณุงูู ุฅุฌูุงูู ุนุฏุฏ ุงูุจูุณู!  (ูู 480 ร 270 = 129ุ600).  ุฃู ุฃููุง ูุนุฑู ุนุฏุฏ ุงูุจูุณูุงุช ุงูุชู ููุง ูููุฉ ุณุทูุน ูุญุฏุฏุฉ. <br><br>  ุฅุฐุง ููุช ุถููุนูุง ูู ุงูุชุธููู ุงูุญุณุงุจู (ูุซูู) ุ ููุฏ ูุง ูููู ุฐูู ูุงุถุญูุง ูู ุงูุจุฏุงูุฉ ุ ูุฐูู ุงูุฑุฃ ุงูููุดูุฑ ุนุฏุฉ ูุฑุงุช ุ ูุฃุฎุฐ ุงููุฑู ูููู ุฑุตุงุต ุ ูุญุงูู ููู ุงูููุงููู ุงูุชู ุจููุช ุนูููุง ูุฐู ุงูุชูููุฉ. <br><br>  ูุฐุง ูู ุดุฆ!  ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ูุญุณุจ Witcher 3 ุฑุณู ุจูุงูู ููุณุทูุน.  ุดุฎุตูุง ุ ููุฏ ุชุนููุช ุงููุซูุฑ ุนูุฏ ูุชุงุจุฉ ูุฐุง ุงูุฌุฒุก.  ูุจุฑูู ููุงุนุจูู ูู CD Projekt Red ุนูู ุนูููู ุงูููุชุงุฒ! <br><br>  ุฅุฐุง ููุช ููุชููุง ุจุชุธููู HLSL ูุงูู ุ ููู ูุชููุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> .  ุฃุณุนู ุฏุงุฆููุง ููุญุตูู ุนูู ุฑูุฒ ุงูุชุฌููุน ูู ุฃูุฑุจ ููุช ูููู ูู ุงููุนุจุฉ ูุฃูุง ุณุนูุฏ ุชูุงููุง ูุฃููู ูุฌุญุช ูุฑุฉ ุฃุฎุฑู! <br><br><h2 style=";text-align:right;direction:rtl">  ุญุณุงุจ ูุชูุณุท โโุงูุณุทูุน </h2><br>  ูุฐุง ูู ุงูุฌุฒุก ุงูุซุงูู ูู ุชุญููู ุญุณุงุจุงุช ุงูุณุทูุน ุงููุชูุณุท โโูู "The Witcher 3: Wild Hunt". <br><br>  ูุจู ุงูุฏุฎูู ูู ูุนุฑูุฉ ูุน ุชุธููู ุญุณุงุจู ุขุฎุฑ ุ ุฏุนูุง ููุฑุฑ ุจุฅูุฌุงุฒ ูุง ุญุฏุซ ูู ุงูุฌุฒุก ุงูุฃุฎูุฑ: ููุฏ ุนูููุง ูุน ูุฎุฒู ูุคูุช ูููู HDR ูุน ูููุงุณ ูุตู ุฅูู 1 / 4x1 / 4.  ุจุนุฏ ุงูุชูุฑูุฑุฉ ุงูุฃููู ุ ุญุตููุง ุนูู ุฑุณู ุจูุงูู ุณุทูุน (ูุฎุฒู ูุคูุช ููุธู ูุญุชูู ุนูู 256 ูููุฉ ุนุฏุฏ ุตุญูุญ ุบูุฑ ูููุนุฉ).  ุญุณุจูุง ููุบุงุฑูุชู ุณุทูุน ูู ุจูุณู ุ ูุฒุนูุงู ุนูู 256 ุฎููุฉ ูุฒุงุฏูุง ุงููููุฉ ุงูููุงุจูุฉ ูููุฎุฒู ุงููุคูุช ุงูููููู ุจููุฏุงุฑ 1 ููู ุจูุณู.  ููุฐุง ุงูุณุจุจ ุ ูููู ุฅุฌูุงูู ูู ุงูููู ูู ูุฐู ุงูุฎูุงูุง 256 ูุณุงููุงู ูุนุฏุฏ ุงูุจูุณู. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/3c3/89c/d16/3c389cd16ec2eed7617dcf9334429c6e.png"></div><br>  <i>ูุซุงู ุนูู ุฅุฎุฑุงุฌ ุงูุชูุฑูุฑุฉ ุงูุฃููู.</i>  <i>ููุงู 256 ุนูุงุตุฑ.</i> <br><br>  ุนูู ุณุจูู ุงููุซุงู ุ ูุจูุบ ุญุฌู ุงููุฎุฒู ุงููุคูุช ููุก ุงูุดุงุดุฉ 1920 ร 1080.  ุจุนุฏ ุงูุชุตุบูุฑ ุ ุงุณุชุฎุฏู ุงูุชูุฑูุฑ ุงูุฃูู ูุฎุฒููุง ูุคูุชูุง 480 ร 270.  ูุฌููุน ููู 256 ูู ุงููุฎุฒู ุงููุคูุช ุณูููู ูุณุงูู 480 * 270 = 129 600. <br><br>  ุจุนุฏ ูุฐู ุงูููุฏูุฉ ุงูููุฌุฒุฉ ุ ูุญู ุนูู ุงุณุชุนุฏุงุฏ ููุงูุชูุงู ุฅูู ุงูุฎุทูุฉ ุงูุชุงููุฉ: ุฅูู ุงูุญูุณุจุฉ. <br><br>  ูุฐู ุงููุฑุฉ ูุชู ุงุณุชุฎุฏุงู ูุฌููุนุฉ ูุคุดุฑ ุชุฑุงุจุท ูุงุญุฏ ููุท (ุฅุฑุณุงู (1 ุ 1 ุ 1)). <br><br>  ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ุฑูุฒ ุงููุฌูุน ููุชุธููู ุงูุญุณุงุจู: <br><br> <code>cs_5_0 <br> dcl_globalFlags refactoringAllowed <br> dcl_constantbuffer cb0[1], immediateIndexed <br> dcl_uav_structured u0, 4 <br> dcl_uav_typed_texture2d (float,float,float,float) u1 <br> dcl_input vThreadIDInGroup.x <br> dcl_temps 4 <br> dcl_tgsm_structured g0, 4, 256 <br> dcl_thread_group 64, 1, 1 <br> 0: ld_structured_indexable(structured_buffer, stride=4)(mixed,mixed,mixed,mixed) r0.x, vThreadIDInGroup.x, l(0), u0.xxxx <br> 1: store_structured g0.x, vThreadIDInGroup.x, l(0), r0.x <br> 2: iadd r0.xyz, vThreadIDInGroup.xxxx, l(64, 128, 192, 0) <br> 3: ld_structured_indexable(structured_buffer, stride=4)(mixed,mixed,mixed,mixed) r0.w, r0.x, l(0), u0.xxxx <br> 4: store_structured g0.x, r0.x, l(0), r0.w <br> 5: ld_structured_indexable(structured_buffer, stride=4)(mixed,mixed,mixed,mixed) r0.x, r0.y, l(0), u0.xxxx <br> 6: store_structured g0.x, r0.y, l(0), r0.x <br> 7: ld_structured_indexable(structured_buffer, stride=4)(mixed,mixed,mixed,mixed) r0.x, r0.z, l(0), u0.xxxx <br> 8: store_structured g0.x, r0.z, l(0), r0.x <br> 9: sync_g_t <br> 10: if_z vThreadIDInGroup.x <br> 11: mul r0.x, cb0[0].y, cb0[0].x <br> 12: ftou r0.x, r0.x <br> 13: utof r0.y, r0.x <br> 14: mul r0.yz, r0.yyyy, cb0[0].zzwz <br> 15: ftoi r0.yz, r0.yyzy <br> 16: iadd r0.x, r0.x, l(-1) <br> 17: imax r0.y, r0.y, l(0) <br> 18: imin r0.y, r0.x, r0.y <br> 19: imax r0.z, r0.y, r0.z <br> 20: imin r0.x, r0.x, r0.z <br> 21: mov r1.z, l(-1) <br> 22: mov r2.xyz, l(0, 0, 0, 0) <br> 23: loop <br> 24: breakc_nz r2.x <br> 25: ld_structured r0.z, r2.z, l(0), g0.xxxx <br> 26: iadd r3.x, r0.z, r2.y <br> 27: ilt r0.z, r0.y, r3.x <br> 28: iadd r3.y, r2.z, l(1) <br> 29: mov r1.xy, r2.yzyy <br> 30: mov r3.z, r2.x <br> 31: movc r2.xyz, r0.zzzz, r1.zxyz, r3.zxyz <br> 32: endloop <br> 33: mov r0.w, l(-1) <br> 34: mov r1.yz, r2.yyzy <br> 35: mov r1.xw, l(0, 0, 0, 0) <br> 36: loop <br> 37: breakc_nz r1.x <br> 38: ld_structured r2.x, r1.z, l(0), g0.xxxx <br> 39: iadd r1.y, r1.y, r2.x <br> 40: utof r2.x, r2.x <br> 41: utof r2.w, r1.z <br> 42: add r2.w, r2.w, l(0.500000) <br> 43: mul r2.w, r2.w, l(0.011271) <br> 44: exp r2.w, r2.w <br> 45: add r2.w, r2.w, l(-1.000000) <br> 46: mad r3.z, r2.x, r2.w, r1.w <br> 47: ilt r2.x, r0.x, r1.y <br> 48: iadd r2.w, -r2.y, r1.y <br> 49: itof r2.w, r2.w <br> 50: div r0.z, r3.z, r2.w <br> 51: iadd r3.y, r1.z, l(1) <br> 52: mov r0.y, r1.z <br> 53: mov r3.w, r1.x <br> 54: movc r1.xzw, r2.xxxx, r0.wwyz, r3.wwyz <br> 55: endloop <br> 56: store_uav_typed u1.xyzw, l(0, 0, 0, 0), r1.wwww <br> 57: endif <br> 58: ret</code> <br> <br>  ููุฌุฏ ูุฎุฒู ูุคูุช ูุงุญุฏ ุซุงุจุช: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/bbe/13a/0ab/bbe13a0abe0d79f47b0a59d33d51ab9c.png"></div><br>  ุฃููู ูุธุฑุฉ ุณุฑูุนุฉ ุนูู ุฑูุฒ ุงููุฌูุน: ูุชู ุฅุฑูุงู ุงุซููู ูู ุงูุทุงุฆุฑุงุช ุจุฏูู ุทูุงุฑ (u0: ุงููุฎุฒู ุงููุคูุช ููุฅุฏุฎุงู ูู ุงูุฌุฒุก ุงูุฃูู ู u1: ูุณูุฌ ุงูุฎุฑุฌ ุจุชูุณูู 1x1 R32_FLOAT).  ูุฑู ุฃูุถูุง ุฃู ููุงู 64 ูุคุดุฑ ุชุฑุงุจุท ููู ูุฌููุนุฉ ู 256 ุนูุตุฑูุง ูู ุฐุงูุฑุฉ ุงููุฌููุนุฉ ุงููุดุชุฑูุฉ ุฐุงุช 4 ุจุงูุช. <br><br>  ูุจุฏุฃ ุจููุก ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ ุจุงูุจูุงูุงุช ูู ูุฎุฒู ุงูุฅุฏุฎุงู ุงููุคูุช.  ูุฏููุง 64 ูุคุดุฑ ุชุฑุงุจุท ุ ูุฐูู ุณูููู ุนููู ูุนู ููุณ ุงูุดูุก ููุง ูุงู ูู ูุจู. <br><br>  ููุชุฃูุฏ ูู ุฃู ุฌููุน ุงูุจูุงูุงุช ูุฏ ุชู ุชุญููููุง ููุฒูุฏ ูู ุงููุนุงูุฌุฉ ุ ุจุนุฏ ุฐูู ูุถุนูุง ุญุงุฌุฒูุง. <br><br> <code>//   -        . <br> //        64 ,    4     <br> //    . <br> [unroll] for (uint idx=0; idx &lt; 4; idx++) <br> { <br> const uint offset = threadID + idx*64; <br> shared_data[ offset ] = g_buffer[offset]; <br> } <br> //    ,       ,     <br> //             . <br> GroupMemoryBarrierWithGroupSync();</code> <br> <br>  ูุชู ุชูููุฐ ุฌููุน ุงูุญุณุงุจุงุช ูู ูุคุดุฑ ุชุฑุงุจุท ูุงุญุฏ ููุท ุ ููุชู ุงุณุชุฎุฏุงู ุฌููุน ุงูุญุณุงุจุงุช ุงูุฃุฎุฑู ุจุจุณุงุทุฉ ูุชุญููู ุงูููู ูู ุงููุฎุฒู ุงููุคูุช ูู ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ. <br><br>  ูุญุชูู ุฏูู "ุงูุญูุณุจุฉ" ุนูู ูุคุดุฑ 0. ููุงุฐุงุ  ูู ุงููุงุญูุฉ ุงููุธุฑูุฉ ุ ูููููุง ุงุณุชุฎุฏุงู ุฃู ุชูุงุฑ ูู ุงููุงุตู ุงูุฒููู [0-63] ุ ูููู ุจูุถู ุงูููุงุฑูุฉ ูุน 0 ุ ูููููุง ุชุฌูุจ ููุงุฑูุงุช ุนุฏุฏ ุตุญูุญ ุตุญูุญ ุฅุถุงูู (ุชุนูููุงุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ieq</a> ). <br><br>  ุชุณุชูุฏ ุงูุฎูุงุฑุฒููุฉ ุฅูู ุฅุดุงุฑุฉ ุงููุงุตู ุงูุฒููู ููุจูุณูุงุช ุงูุชู ุณูุชู ุฃุฎุฐูุง ูู ุงูุงุนุชุจุงุฑ ูู ุงูุนูููุฉ. <br><br>  ูู ุงูุณุทุฑ 11 ุ ูููู ุจุถุฑุจ ุงูุนุฑุถ * ุงูุงุฑุชูุงุน ููุญุตูู ุนูู ุฅุฌูุงูู ุนุฏุฏ ุงูุจููุณูุงุช ูุถุฑุจูุง ุจุฑูููู ูู ุงููุงุตู ุงูุฒููู [0.0f-1.0f] ุ ููุง ูุดูุฑ ุฅูู ุจุฏุงูุฉ ูููุงูุฉ ุงููุงุตู ุงูุฒููู.  ูุชู ุงุณุชุฎุฏุงู ูููุฏ ุฅุถุงููุฉ ูุถูุงู <code>0 &lt;= Start &lt;= End &lt;= totalPixels - 1</code> : <br><br> <code>//        0. <br> [branch] if (threadID == 0) <br> { <br> //         <br> uint totalPixels = cb0_v0.x * cb0_v0.y; <br> <br> //   (,  ,    ), <br> //        . <br> int pixelsToConsiderStart = totalPixels * cb0_v0.z; <br> int pixelsToConsiderEnd = totalPixels * cb0_v0.w; <br> <br> int pixelsMinusOne = totalPixels - 1; <br> <br> pixelsToConsiderStart = clamp( pixelsToConsiderStart, 0, pixelsMinusOne ); <br> pixelsToConsiderEnd = clamp( pixelsToConsiderEnd, pixelsToConsiderStart, pixelsMinusOne );</code> <br> <br>  ููุง ุชุฑูู ุ ููุงู ุฏูุฑุชุงู ุฃุฏูุงู.  ุงููุดููุฉ ูุนูู (ุฃู ูุน ุฑูุฒ ุงููุฌูุน ุงูุฎุงุต ุจูู) ูู ุฃู ููุงู ุงูุชูุงูุงุช ุดุฑุทูุฉ ุบุฑูุจุฉ ูู ููุงูุงุช ุงูุญููุงุช.  ูุงู ูู ุงูุตุนุจ ุฌุฏูุง ุจุงููุณุจุฉ ูู ุฅุนุงุฏุฉ ุฅูุดุงุฆูุง.  ุงูุธุฑ ุฃูุถูุง ุฅูู ุงูุณุทุฑ 21. ููุงุฐุง ููุฌุฏ "-1"ุ  ุณุงูุถุญ ุฐูู ููููุง ุฃุฏูุงู. <br><br>  ุชุชูุซู ูููุฉ ุงูุฏูุฑุฉ ุงูุฃููู ูู ุชุฌุงูู <i>pixelsToConsiderStart</i> ูููุญูุง ููุฑุณ ุงูุฎููุฉ ุงูุนุงุฒูุฉ ุงูุชู <i>ููุฌุฏ</i> ูููุง <i>pixelsToConsiderStart</i> +1 (ุจุงูุฅุถุงูุฉ ุฅูู ุนุฏุฏ ุฌููุน ูุญุฏุงุช ุงูุจูุณู ูู ุงูุฎูุงูุง ุงูุณุงุจูุฉ). <br><br>  ุฏุนูุง ูููู ุฃู <i>pixelsToConsiderStart</i> ุชุณุงูู 30ุ000 ุชูุฑูุจูุง ุ ููู ุงููุฎุฒู ุงููุคูุช ููุฌุฏ 37000 ุจูุณู ูู ุงูุฎููุฉ "ุตูุฑ" (ูุญุฏุซ ูุฐุง ูู ุงููุนุจุฉ ููููุง).  ูุฐูู ุ ูุฑูุฏ ุฃู ูุจุฏุฃ ูู ุชุญููู ุงูุณุทูุน ุจุงุณุชุฎุฏุงู ุจูุณู 30001 ุชูุฑูุจูุง ุ ุงูููุฌูุฏ ูู ุงูุฎููุฉ "ุตูุฑ".  ูู ูุฐู ุงูุญุงูุฉ ุ ูุฎุฑุฌ ููุฑูุง ูู ุงูุญููุฉ ุ ููุญุตู ุนูู ูุคุดุฑ ุงูุจุฏุงูุฉ '0' ูุงูุตูุฑ ุจูุณู ุงูููููุฉ. <br><br>  ุฃูู ูุธุฑุฉ ุนูู ููุฏ HLSL: <br><br> <code>//     <br> int numProcessedPixels = 0; <br> <br> //   [0-255] <br> int lumaValue = 0; <br> <br> //      <br> bool bExitLoop = false; <br> <br> //    -  "pixelsToConsiderStart" . <br> //          lumaValue,      . <br> [loop] <br> while (!bExitLoop) <br> { <br> //       . <br> uint numPixels = shared_data[lumaValue]; <br> <br> // ,      lumaValue <br> int tempSum = numProcessedPixels + numPixels; <br> <br> //  ,  pixelsToConsiderStart,    . <br> // ,      lumaValue. <br> //  , pixelsToConsiderStart -   "" ,   ,    . <br> [flatten] <br> if (tempSum &gt; pixelsToConsiderStart) <br> { <br> bExitLoop = true; <br> } <br> else <br> { <br> numProcessedPixels = tempSum; <br> lumaValue++; <br> } <br> }</code> <br> <br>  ูุฑุชุจุท ุงูุฑูู ุงูุบุงูุถ "-1" ูู ุงูุณุทุฑ 21 ูู ุฑูุฒ ุงููุฌููุน ุจุดุฑุท Boolean ูุชูููุฐ ุงูุญููุฉ (ุงูุชุดูุช ูุฐุง ุนู ุทุฑูู ุงูุตุฏูุฉ ุชูุฑูุจูุง). <br><br>  ุจุนุฏ ุชููู ุนุฏุฏ ุงูุจูุณู ูู ุฎูุงูุง <i>lumaValue</i> ู <i>lumaValue</i> ููุณูุง ุ ูููููุง ุงูุงูุชูุงู ุฅูู ุงูุฏูุฑุฉ ุงูุซุงููุฉ. <br><br>  ูููุฉ ุงูุฏูุฑุฉ ุงูุซุงููุฉ ูู ุญุณุงุจ ุชุฃุซูุฑ ุงูุจูุณู ููุชูุณุท โโุงูุณุทูุน. <br><br>  ูุจุฏุฃ ุจู <i>lumaValue</i> ุงููุญุณูุจุฉ ูู ุงูุญููุฉ ุงูุฃููู. <br><br> <code>float finalAvgLuminance = 0.0f; <br> <br> //       <br> uint numProcessedPixelStart = numProcessedPixels; <br> <br> //    -      . <br> //    ,    ,        lumaValue. <br> //      [0-255],     ,    ,   ,    <br> //    pixelsToConsiderEnd. <br> //          . <br> bExitLoop = false; <br> [loop] <br> while (!bExitLoop) <br> { <br> //       . <br> uint numPixels = shared_data[lumaValue]; <br> <br> //      <br> numProcessedPixels += numPixels; <br> <br> //    ,    [0-255] (uint) <br> uint encodedLumaUint = lumaValue; <br> <br> //        <br> float numberOfPixelsWithCurrentLuma = numPixels; <br> <br> //    ,    [0-255] (float) <br> float encodedLumaFloat = encodedLumaUint;</code> <br> <br>  ูู ูุฐู ุงููุฑุญูุฉ ุ ุญุตููุง ุนูู ูููุฉ ุงูุณุทูุน ุงููุดูุฑุฉ ูู ุงููุงุตู ุงูุฒููู [0.0f-255.f]. <br><br>  ุนูููุฉ ูู ุงูุชุดููุฑ ุจุณูุทุฉ ููุบุงูุฉ - ุชุญุชุงุฌ ุฅูู ุนูุณ ุญุณุงุจ ูุฑุญูุฉ ุงูุชุฑููุฒ. <br><br>  ุชูุฑุงุฑ ููุฌุฒ ูุนูููุฉ ุงูุชุฑููุฒ: <br><br> <code>float luma = dot( hdrPixelColor, float3(0.2126, 0.7152, 0.0722) ); <br> ... <br> float outLuma; <br> <br> //   log(0)  undef,  log(1) = 0 <br> outLuma = luma + 1.0; <br> <br> //   <br> outLuma = log( outLuma ); <br> <br> //   128,   log(1) * 128 = 0, log(2,71828) * 128 = 128, log(7,38905) * 128 = 256 <br> outLuma = outLuma * 128 <br> <br> //   uint <br> uint outLumaUint = min( (uint) outLuma, 255);</code> <br> <br>  ููู ุชุดููุฑ ุงูุณุทูุน ุ ูุนูุณ ุนูููุฉ ุงูุชุฑููุฒ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุซู ูุฐุง: <br><br> <code>//    0.5f (  ,    ) <br> float fDecodedLuma = encodedLumaFloat + 0.5; <br> <br> //   : <br> <br> //   128 <br> fDecodedLuma /= 128.0; <br> <br> // exp(x),   log(x) <br> fDecodedLuma = exp(fDecodedLuma); <br> <br> //  1.0 <br> fDecodedLuma -= 1.0;</code> <br> <br>  ุจุนุฏ ุฐูู ูุญุณุจ ุงูุชูุฒูุน ุจุถุฑุจ ุนุฏุฏ ุงูุจูุณูุงุช ูุน ุณุทูุน ูุนูู ุจุงูุณุทูุน ุงูุฐู ุชู ูู ุชุฑููุฒู ุ <i>ููููู ุจุชูุฎูุตูุง</i> ุญุชู ูุตู ุฅูู ูุนุงูุฌุฉ <i>pixelsToConsiderEnd</i> ุจูุณู. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุนุฏ ุฐูู ุ ููุณู ุงูุชุฃุซูุฑ ุงูููู ุนูู ุนุฏุฏ ูุญุฏุงุช ุงูุจูุณู ุงูุชู ุชู ุชุญููููุง. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐุง ูู ุงูุฌุฒุก ุงููุชุจูู ูู ุงูุญููุฉ (ูุงูุชุธููู): </font><font style="vertical-align: inherit;">ูุชููุฑ ุงูุชุธููู ุงููุงูู </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">ููุง</font></a><font style="vertical-align: inherit;"> . ููู ูุชูุงูู ุชูุงููุง ูุน ุจุฑูุงูุฌ </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">HLSLexplorer ุงูุฎุงุต</font></a><font style="vertical-align: inherit;"> ุจู </font><font style="vertical-align: inherit;">ุ ูุงูุฐู ุจุฏููู ูู ุฃููู ูุงุฏุฑูุง ุนูู ุฅุนุงุฏุฉ ุฅูุดุงุก ุญุณุงุจ ุงูุณุทูุน ุงููุชูุณุท โโุจุดูู ูุนุงู ูู The Witcher 3 (ูุฌููุน ุงูุชุฃุซูุฑุงุช ุงูุฃุฎุฑู ุฃูุถูุง!). </font><font style="vertical-align: inherit;">ูู ุงูุฎุชุงู ุ ุจุนุถ ุงูุฃููุงุฑ. ูู ุญูุซ ุญุณุงุจ ูุชูุณุท โโุงูุณุทูุน ุ ูุงู ูู ุงูุตุนุจ ุฅุนุงุฏุฉ ุฅูุดุงุก ูุฐุง ุงูุชุธููู. ุงูุฃุณุจุงุจ ุงูุฑุฆูุณูุฉ: </font><font style="vertical-align: inherit;">1) ุงุฎุชุจุงุฑุงุช "ูุนููุฉ" ุบุฑูุจุฉ ุนูู ุชูููุฐ ุงูุฏูุฑุฉ ุ ุงุณุชุบุฑู ุงูุฃูุฑ ุงููุซูุฑ ูู ุงูููุช ุฃูุซุฑ ููุง ุงุนุชูุฏุช ุณุงุจูุง. </font><font style="vertical-align: inherit;">2) ูุดุงูู ูุน ุชุตุญูุญ ูุฐุง ุงูุชุธููู ุงูุญุณุงุจู ูู RenderDoc (v. 1.2).</font></font><br><br> <code>//     <br> float fCurrentLumaContribution = numberOfPixelsWithCurrentLuma * fDecodedLuma; <br> <br> // ()       . <br> float tempTotalContribution = fCurrentLumaContribution + finalAvgLuminance; <br> <br> <br> [flatten] <br> if (numProcessedPixels &gt; pixelsToConsiderEnd ) <br> { <br> //     <br> bExitLoop = true; <br> <br> //      ,     . <br> //         <br> int diff = numProcessedPixels - numProcessedPixelStart; <br> <br> //     <br> finalAvgLuminance = tempTotalContribution / float(diff); <br> } <br> else <br> { <br> //       lumaValue <br> finalAvgLuminance = tempTotalContribution; <br> lumaValue++; <br> } <br> } <br> <br> //    <br> g_avgLuminance[uint2(0,0)] = finalAvgLuminance;</code> <br> <br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุนูููุงุช "ld_structured_indexable" ุบูุฑ ูุฏุนููุฉ ุจุงููุงูู ุ ุนูู ุงูุฑุบู ูู ุฃู ูุชูุฌุฉ ุงููุฑุงุกุฉ ูู ุงูููุฑุณ 0 ุชุนุทู ุงููููุฉ ุงูุตุญูุญุฉ ุ ุจูููุง ุชุฑุฌุน ุฌููุน ุงูุฃุตูุงุฑ ุงูุฃุฎุฑู ุ ููุฐุง ูู ุงูุณุจุจ ูู ุงุณุชูุฑุงุฑ ุงูุฏูุฑุงุช ุฅูู ุฃุฌู ุบูุฑ ูุณูู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุงูุฑุบู ูู ุฃููู ูู ุฃุชููู ูู ุชุญููู ููุณ ุฑูุฒ ุงูุชุฌููุน ููุง ูู ุงููุณุฎุฉ ุงูุฃุตููุฉ (ุงูุธุฑ ููุทุฉ ุงูุดุงุดุฉ ุฃุฏูุงู ููุนุฑูุฉ ุงูุงุฎุชูุงูุงุช) ุ ุจุงุณุชุฎุฏุงู RenderDoc ุชูููุช ูู ุถุฎ ูุฐุง ุงูุชุธููู ูู ุฎุท ุงูุฃูุงุจูุจ - ููุงูุช ุงููุชุงุฆุฌ ูู ููุณูุง!</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/de1/a0e/74f/de1a0e74f0f6619994d1edc9621d148d.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชูุฌุฉ ุงููุนุฑูุฉ. </font><font style="vertical-align: inherit;">ุนูู ุงููุณุงุฑ ูู ุชุธูููู ุ ุนูู ุงููููู ูู ุฑูุฒ ุงููุฌูุน ุงูุฃุตูู.</font></font></i> <br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุฌุฒุก 8. ุงูููุฑ ููุฑุงุญูู </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูุฌุฒุก ุงูุซุงูู ูู ุงูููุงู ุ ููุช ุจูุญุต ุชุธููู ุงูููุฑ ูู The Witcher 3 (ูุจุดูู ุฃูุซุฑ ุชุญุฏูุฏุงู ุ ูู Blood and Wine extension). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููุฑ ุนูุตุฑ ููู ูู ุณูุงุก ุงูููู ุ ููุฏ ูููู ูู ุงูุตุนุจ ููุบุงูุฉ ุฌุนูู ููุตุฏููุง ุ ููู ุจุงููุณุจุฉ ูู ุงููุดู ูููุง ูู TW3 ูุงู ูู ุฏูุงุนู ุณุฑูุฑู ุงูุญูููู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุฑุฏ ุฅููุงุก ูุธุฑุฉ ุนูู ูุฐุง ุงููุดูุฏ!</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/53f/099/b6c/53f099b6ccfcef0eeb0755ced73894b9.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุจู ุฃู ูุชูุงูู ุชุธููู ุงูุจูุณู ุ ุณุฃููู ุจุถุน ูููุงุช ุญูู ุงููุฑูู ุงูุฏูููุฉ ูู ุงูุชูุฏูู. ูู ูุฌูุฉ ูุธุฑ ููุฏุณูุฉ ุ ุงูููุฑ ูู ูุฌุฑุฏ ูุฑุฉ (ุงูุธุฑ ุฃุฏูุงู) ุ ูุงูุชู ุชุญุชูู ุนูู ุฅุญุฏุงุซูุงุช ุงููููุณ ุ ููุงููุงุช ุทุจูุนูุฉ ูููุงุณูุฉ. ูููู ุชุธููู ููุฉ ุงูุฑุฃุณ ุจุญุณุงุจ ุงูููุถุน ูู ุงููุถุงุก ุงูุนุงููู ุ ููุฐูู ุงููุชุฌูุงุช ุงูุทุจูุนูุฉ ููุนุงุฏู ุ ุงูููุงุณ ูุงูููุงุณ ุฅูู ููุทุชูู (ุจุงุณุชุฎุฏุงู ููุชุฌ ูุชุฌู) ุ ูุถุฑูุจูุง ุจุงููุตูููุฉ ุงูุนุงูููุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุถูุงู ุฃู ุงูููุฑ ุชูุน ุจุงููุงูู ุนูู ูุชู ุงูุทุงุฆุฑุฉ ุจุนุฏ ูุงูุญููู ูMinDepth MaxDepth ูููู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D3D11_VIEWPORT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุนููู ูููุฉ 0.0 (ููุณ ุงูุฎุฏุนุฉ ุงูุชู ูุงูุช ุชุณุชุฎุฏู ููุจุฉ ุงูุณูุงุก). ูุชู ุชูุฏูู ุงูููุฑ ูุจุงุดุฑุฉ ุจุนุฏ ุงูุณูุงุก.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/6f5/999/ec7/6f5999ec7ca1176dfac370f60820d97f.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุฑุฉ ุงููุณุชุฎุฏูุฉ ูุฑุณู ุงูููุฑ</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ุญุณูุงู ุ ูู ุดูุก ุ ููุง ุฃุนุชูุฏ ุ ููููู ุงููุชุงุจุนุฉ. </font><font style="vertical-align: inherit;">ุฏุนูุง ูููู ูุธุฑุฉ ุนูู ุชุธููู ุงูุจูุณู: </font><font style="vertical-align: inherit;">ุงูุณุจุจ ุงูุฑุฆูุณู ูุฑุงุก ุงุฎุชูุงุฑ ุงูุชุธููู ูู Blood and Wine ุจุณูุท - ุฅูู ุฃูุตุฑ. </font><font style="vertical-align: inherit;">ุฃููุงู ุ ูุญุณุจ ุงูุฅุฒุงุญุฉ ูุฃุฎุฐ ุนููุงุช ูู ุงููุณูุฌ. </font><font style="vertical-align: inherit;">ูุณุชุฎุฏู cb0 [0] .w ูุฅุฒุงุญุฉ ุนูู ุทูู ุงููุญูุฑ X. ูุน ูุฐู ุงูุญููุฉ ุงูุจุณูุทุฉ ูููููุง ูุญุงูุงุฉ ุฏูุฑุงู ุงูููุฑ ุญูู ูุญูุฑู.</font></font><br><br> <code>ps_5_0 <br> dcl_globalFlags refactoringAllowed <br> dcl_constantbuffer cb0[1], immediateIndexed <br> dcl_constantbuffer cb2[3], immediateIndexed <br> dcl_constantbuffer cb12[267], immediateIndexed <br> dcl_sampler s0, mode_default <br> dcl_resource_texture2d (float,float,float,float) t0 <br> dcl_input_ps linear v1.w <br> dcl_input_ps linear v2.xyzw <br> dcl_input_ps linear v3.xy <br> dcl_input_ps linear v4.xy <br> dcl_output o0.xyzw <br> dcl_temps 3 <br> 0: mov r0.x, -cb0[0].w <br> 1: mov r0.y, l(0) <br> 2: add r0.xy, r0.xyxx, v2.xyxx <br> 3: sample_indexable(texture2d)(float,float,float,float) r0.xyzw, r0.xyxx, t0.xyzw, s0 <br> 4: add r0.xyz, r0.xyzx, l(-0.500000, -0.500000, -0.500000, 0.000000) <br> 5: log r0.w, r0.w <br> 6: mul r0.w, r0.w, l(2.200000) <br> 7: exp r0.w, r0.w <br> 8: add r0.xyz, r0.xyzx, r0.xyzx <br> 9: dp3 r1.x, r0.xyzx, r0.xyzx <br> 10: rsq r1.x, r1.x <br> 11: mul r0.xyz, r0.xyzx, r1.xxxx <br> 12: mul r1.xy, r0.yyyy, v3.xyxx <br> 13: mad r0.xy, v4.xyxx, r0.xxxx, r1.xyxx <br> 14: mad r0.xy, v2.zwzz, r0.zzzz, r0.xyxx <br> 15: mad r0.z, cb0[0].y, l(0.033864), cb0[0].w <br> 16: mul r0.z, r0.z, l(6.283185) <br> 17: sincos r1.x, r2.x, r0.z <br> 18: mov r2.y, r1.x <br> 19: dp2_sat r0.x, r0.xyxx, r2.xyxx <br> 20: mul r0.xyz, r0.xxxx, cb12[266].xyzx <br> 21: mul r0.xyz, r0.xyzx, r0.wwww <br> 22: mul r0.xyz, r0.xyzx, cb2[2].xyzx <br> 23: add_sat r0.w, -v1.w, l(1.000000) <br> 24: mul r0.w, r0.w, cb2[2].w <br> 25: mul o0.xyz, r0.wwww, r0.xyzx <br> 26: mov o0.w, l(0) <br> 27: ret</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/fc2/ddb/c02/fc2ddbc0262d27002f70d837a623c366.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃูุซูุฉ ุนูู ุงูููู ูู ุงููุฎุฒู ุงููุคูุช ุงูุซุงุจุช ุ</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุชู ุฅุฑูุงู ูุงุฏุฉ ูุงุญุฏุฉ (1024 ร 512) ููุฏุฎู. </font><font style="vertical-align: inherit;">ูุชู ุชุดููุฑ ุงูุฎุฑูุทุฉ ุงูุนุงุฏูุฉ ูู ูููุงุช RGB ูููู ุณุทุญ ุงูููุฑ ูู ููุงุฉ ุฃููุง. </font><font style="vertical-align: inherit;">ุฐูู!</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/392/733/1a1/3927331a17867d712e667c36a0ee6641.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุงุฉ ุฃููุง ูู ูุณูุฌ ูู ููู ุณุทุญ ุงูููุฑ.</font></font></i> <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/c64/542/d70/c64542d70a7e3b58aa9426f12e8880d7.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุงุช RGB ุงููููุณ ูู ุฎุฑูุทุฉ ุทุจูุนูุฉ.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุนุฏ ุชููู ุฅุญุฏุงุซูุงุช ุงููููุณ ุงูุตุญูุญุฉ ุ ูููู ุจุชุฌุฑุจุฉ ูููุงุช RGBA. ูุญุชุงุฌ ุฅูู ูู ุงูุฎุฑูุทุฉ ุงูุนุงุฏูุฉ ูุฅุฌุฑุงุก ุชุตุญูุญ ุบุงูุง ูููู ุงูุณุทุญ. ุญุงูููุง ุ ูููู ูุชุงุจุฉ ุชุธููู HLSL ุจูุฐุง ุงูุดูู ุ ุนูู ุณุจูู ุงููุซุงู: </font><font style="vertical-align: inherit;">ุงูุฎุทูุฉ ุงูุชุงููุฉ ูู ุฅุฌุฑุงุก ุงูุฑุจุท ุงูุนุงุฏู ุ ูููู ููุท ูู ููููุงุช XY. (ูู The Witcher 3 ุ ูููู ุงููุญูุฑ Z ุตุนูุฏููุง ุ ูุงูููุงุฉ Z ุจุฃููููุง ูู ุงููููุณ 1.0). ูููููุง ุฃู ููุนู ุฐูู ุจูุฐู ุงูุทุฑููุฉ: </font><font style="vertical-align: inherit;">ุญุงู ุงูููุช ูุฌุฒุกู ุงูููุถู ูู ูุฐุง ุงูุชุธููู. </font><font style="vertical-align: inherit;">ุงูุธุฑ </font><font style="vertical-align: inherit;">ูุฑุฉ ุฃุฎุฑู ุฅูู ุงูุณุทูุฑ 15-16: </font><font style="vertical-align: inherit;">ูุง ูู ูุฐุง ุงูุบุงูุถ 0.033864ุ ูู ุงูุจุฏุงูุฉ ุ ูุจุฏู ุฃูู ูุง ูุนูู ูู ุ ููู ุฅุฐุง ูููุง ุจุญุณุงุจ ุงููููุฉ ูุนููุณุฉ ุ ูุณูู ูุญุตู ุนูู ุญูุงูู 29.53 ุ ุฃู ูุง ูุนุงุฏู ูุฏุฉ </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">ุงูุดูุฑ ุงูุณูููุฏุณู</font></a></font><br><br> <code>float4 MoonPS(in InputStruct IN) : SV_Target0 <br> { <br> //  Texcoords <br> float2 uvOffsets = float2(-cb0_v0.w, 0.0); <br> <br> //  texcoords <br> float2 uv = IN.param2.xy + uvOffsets; <br> <br> //   <br> float4 sampledTexture = texture0.Sample( sampler0, uv); <br> <br> //    -  - <br> float moonColorTex = pow(sampledTexture.a, 2.2 ); <br> <br> //     [0,1]   [-1,1]. <br> // : sampledTexture.xyz * 2.0 - 1.0    <br> float3 sampledNormal = normalize((sampledTexture.xyz - 0.5) * 2);</code> <br> <br><font style="vertical-align: inherit;"></font><br><br> <code>//    <br> float3 Tangent = IN.param4.xyz; <br> float3 Normal = float3(IN.param2.zw, IN.param3.w); <br> float3 Bitangent = IN.param3.xyz; <br> <br> //  TBN <br> float3x3 TBN = float3x3(Tangent, Bitangent, Normal); <br> <br> //    XY <br> //   TBN  float3x2: 3 , 2  <br> float2 vNormal = mul(sampledNormal, (float3x2)TBN).xy;</code> <br> <br><font style="vertical-align: inherit;"></font><br><br> <code>15: mad r0.z, cb0[0].y, l(0.033864), cb0[0].w <br> 16: mul r0.z, r0.z, l(6.283185)</code> <br> <br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูุงูุงู! </font><font style="vertical-align: inherit;">ูุฐุง ูุง ุฃุณููู ุงูุงูุชุจุงู ุฅูู ุงูุชูุงุตูู! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููููุง ุฃู ููุชุฑุถ ุจุดูู ููุซูู ุฃู cb0 [0] .y ูู ุนุฏุฏ ุงูุฃูุงู ุงูุชู ูุฑุช ุฃุซูุงุก ุงููุนุจ. </font><font style="vertical-align: inherit;">ูุชู ุงุณุชุฎุฏุงู ุงูุญุฑุงู ุฅุถุงูู ููุง ุ ูุณุชุฎุฏู ูุฅุฒุงุญุฉ ุนูู ุทูู ุงููุญูุฑ ุงูุณููู ูููุณูุฌ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุนุฏ ุชููู ูุฐุง ุงููุนุงูู ุ ูุถุฑุจู ูู 2 * Pi. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุซู ุจุงุณุชุฎุฏุงู sincos ูุญุณุจ ูุงูู 2D ุขุฎุฑ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุฎูุงู ุญุณุงุจ ุงูููุชุฌ ุงูููุงุณู ุจูู ุงููุชุฌู ุงูุนุงุฏู ููุงูู "ุงูููุฑ" ุ ูุชู ูุญุงูุงุฉ ูุฑุญูุฉ ูู ุงูููุฑ. </font><font style="vertical-align: inherit;">ุฅููุงุก ูุธุฑุฉ ุนูู ููุทุงุช ูุน ูุฑุงุญู ูุฎุชููุฉ ูู ุงูููุฑ:</font></font><br><br> <code>//  . <br> //   days/29.53 + bias. <br> float phase = cb0_v0.y * (1.0 / SYNODIC_MONTH_LENGTH) + cb0_v0.w; <br> <br> //   2*PI.  , 29.53     <br> //   sin/cos. <br> phase *= TWOPI; <br> <br> //      . <br> float outSin = 0.0; <br> float outCos = 0.0; <br> sincos(phase, outSin, outCos); <br> <br> //    <br> float lunarPhase = saturate( dot(vNormal, float2(outCos, outSin)) );</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/c54/e7f/648/c54e7f6488b10d402a7f4b45e61d455d.png"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/899/133/edc/899133edc0c04c67ffb4987748e908b7.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ ูู ุฅุฌุฑุงุก ุณูุณูุฉ ูู ุนูููุงุช ุงูุถุฑุจ ูุญุณุงุจ ุงูููู ุงูููุงุฆู. </font><font style="vertical-align: inherit;">ูู ุงููุญุชูู ุฃูู ูุง ุชููู ุณุจุจ ุฅุฑุณุงู ูุฐุง ุงูุชุธููู ูููุฉ ุฃููุง ุงูุจุงูุบุฉ 0.0 ุฅูู ุงูุฅุฎุฑุงุฌ. </font><font style="vertical-align: inherit;">ูุฐุง ุจุณุจุจ ุชูุฏูู ุงูููุฑ ูุน ูุฒุฌ:</font></font><br><br> <code>//        . <br> <br> // cb12_v266.xyz ,      . <br> //  (1.54, 2.82, 4.13) <br> float3 moonSurfaceGlowColor = cb12_v266.xyz; <br> <br> float3 moonColor = lunarPhase * moonSurfaceGlowColor; <br> moonColor = moonColorTex * moonColor; <br> <br> // cb_v2.xyz - , , ,  (1.0, 1.0, 1.0) <br> moonColor *= cb2_v2.xyz; <br> <br> //   ,    , .  -   . <br> //     ,         , <br> //   . <br> float paramHorizon = saturate(1.0 - IN.param1.w); <br> paramHorizon *= cb2_v2.w; <br> <br> moonColor *= paramHorizon; <br> <br> //        <br> return float4(moonColor, 0.0);</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/2d9/549/32c/2d954932c188bcdcdd0a156796b85da7.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุชูุญ ูู ูุฐู ุงูุทุฑููุฉ ุงูุญุตูู ุนูู ููู ุงูุฎูููุฉ (ุงูุณูุงุก) ุฅุฐุง ุนุงุฏุช ูุฐู ุงูุชุธููู ุฅูู ุงูููู ุงูุฃุณูุฏ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุฐุง ููุช ููุชููุง ุจุชุธููู ูุงูู ุ ูููููู ุฃุฎุฐูุง </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ูุญุชูู ุนูู ูุฎุงุฒู ูุคูุชุฉ ูุจูุฑุฉ ููุฌุจ ุฃู ูููู ุฌุงูุฒูุง ุจุงููุนู ููุญูู ูู RenderDoc ุจุฏูุงู ูู ุงูุชุธููู ุงูุฃุตูู (ูุง ุนููู ุณูู ุฅุนุงุฏุฉ ุชุณููุฉ "MoonPS" ุฅูู "EditedShaderPS"). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงูุฃุฎูุฑ: ุฃุฑุฏุช ูุดุงุฑูุฉ ุงููุชุงุฆุฌ ูุนู: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุงููุณุงุฑ ูู ุชุธูููู ุ ุนูู ุงููููู ูู ุงูุชุธููู ุงูุฃุตูู ูู ุงููุนุจุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุฑู ุถุฆูู ููุง ูุคุซุฑ ุนูู ุงููุชุงุฆุฌ.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/ff8/c4a/8fa/ff8c4a8fa103b9592941c965ad060729.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุง ุชุฑูู ุ ูุงู ูุฐุง ุงูุชุธููู ูู ุงูุณูู ุฌุฏูุง ุฅุนุงุฏุฉ ุฅูุดุงุฆู. </font></font><br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุฌุฒุก 9. G- ุงูุนุงุฒูุฉ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูุฐุง ุงูุฌุฒุก ุ ุณุฃูุดู ุนู ุจุนุถ ุชูุงุตูู gbuffer ูู The Witcher 3. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณูู ููุชุฑุถ ุฃูู ุชุนุฑู ุฃุณุงุณูุงุช ุงูุชุธููู ุงููุคุฌู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชูุฑุงุฑ ุงููุฎุชุตุฑ: ุฅู ููุฑุฉ ุงูุชุฃุฌูู ูุง ุชุชูุซู ูู ุญุณุงุจ ูู ุงูุฅุถุงุกุฉ ูุงูุชุธููู ุงูููุงุฆู ูู ุขู ูุงุญุฏ ุ ูููู ุชูุณูู ุงูุญุณุงุจุงุช ุฅูู ูุฑุญูุชูู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงููุฑุญูุฉ ุงูุฃููู (ุงูููุฑ ุงูููุฏุณู) ูููุฃ GBuffer ุจุจูุงูุงุช ุงูุณุทุญ (ุงูููุถุน ุ ูุงูุฃูุถุงุน ุงูุทุจูุนูุฉ ุ ูุงูุฃููุงู ุจุฑุงู ุ ุฅูุฎ ...) ุ ููู ุงูุซุงููุฉ (ููุฑ ุงูุฅุถุงุกุฉ) ูุฌูุน ูู ุดูุก ููุญุณุจ ุงูุฅุถุงุกุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุธููู ุงููุคุฌู ูู ุฃุณููุจ ุดุงุฆุน ููุบุงูุฉ ูุฃูู ูุณูุญ ูู ุจุงูุญุณุงุจ ูู ุชูุฑูุฑุฉ ุจููุก ุงูุดุงุดุฉ ูู ุฎูุงู ุชูููุงุช ูุซู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุธููู ุงููุคุฌู ููุชุฌุงูุจ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ููุง ูุญุณู ุงูุฃุฏุงุก ุฅูู ุญุฏ ูุจูุฑ.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุจุณุงุทุฉ ุ GBuffer ูู ูุฌููุนุฉ ูู ุงูููุงู ูุน ุฎุตุงุฆุต ุงูููุฏุณุฉ. </font><font style="vertical-align: inherit;">ูู ุงูููู ุฌุฏูุง ุฅูุดุงุก ุงููููู ุงูููุงุณุจ ูุฐูู. </font><font style="vertical-align: inherit;">ููุซุงู ุนูู ุงูุญูุงุฉ ุงูุญููููุฉ ุ ููููู ุฏุฑุงุณุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูููุฉ ุชูุฏูู Crysis 3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุนุฏ ูุฐู ุงูููุฏูุฉ ุงูููุฌุฒุฉ ุ ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ุฅุทุงุฑ ูุซุงู ูู The Witcher 3: Blood and Wine:</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/2c3/6f5/537/2c36f5537e82217c31d0f5f682b17b6c.jpg"></div><br> <i><font style="vertical-align: inherit;"></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชููู </font><i><font style="vertical-align: inherit;">ุฃุญุฏ ุงูููุงุฏู ุงูุนุฏูุฏุฉ ุงูููุฌูุฏุฉ ูู Toussent</font></i><font style="vertical-align: inherit;"> Basic GBuffer ูู ุซูุงุซุฉ ุฃูุฏุงู ุชุฌุณูุฏ ุจููุก ุงูุดุงุดุฉ ุจุชูุณูู DXGI_FORMAT_R8G8B8A8_UNORM ูุชุฎุฒูู ูุคูุช ููุนูู + ุงูุงุณุชูุณู ุจุชูุณูู DXGI_FORMAT_D24_UNORM_S8_UINT. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง ููุทุงุชูู:</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/309/dec/857/309dec857a7839f41984b44ff82516ab.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุฏูู ุงููุฏู 0 - ูููุงุช RGB ุ ููู ุงูุณุทุญ</font></font></i> <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/16c/44c/b90/16c44cb90b067cb420d921e101319bb0.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุฏูู ุงููุฏู 0 - ููุงุฉ ุฃููุง. </font><font style="vertical-align: inherit;">ุจุตุฑุงุญุฉ ุ ููุณ ูุฏู ุฃู ููุฑุฉ ุนู ูุงููุฉ ูุฐู ุงููุนูููุงุช.</font></font></i> <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/de9/f1a/cf3/de9f1acf36c9f9e18ec6f4a9708ede11.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุฏูู ุงููุฏู 1 - ูููุงุช RGB. </font><font style="vertical-align: inherit;">ูุชู ุชุณุฌูู ุงููุชุฌูุงุช ุงูุทุจูุนูุฉ ูู ุงููุงุตู ุงูุฒููู [0-1] ููุง.</font></font></i> <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/0a5/a60/1e8/0a5a601e893d88a619b94f1ed7d21ae2.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุฏูู ุงููุฏู 1 - ููุงุฉ ุฃููุง. </font><font style="vertical-align: inherit;">ูุดุจู ุงูุงูุนูุงุณูุฉ!</font></font></i> <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/7fa/8f5/d61/7fa8f5d61cfc903b764eec1e9b46c431.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุฏูู ุงููุฏู 2 - ูููุงุช RGB. </font><font style="vertical-align: inherit;">ูุดุจู ุงูููู ุจุฑุงู! </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูุฐุง ุงููุดูุฏ ุ ุชููู ููุงุฉ ุฃููุง ุณูุฏุงุก (ูููู ูุชู ุงุณุชุฎุฏุงููุง ูุงุญููุง).</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/e7e/27d/dab/e7e27ddab2102174b3f63bb9037e28a0.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุนูุงู ุงูุนุงุฒูุฉ. </font><font style="vertical-align: inherit;">ูุงุญุธ ุฃู ุนูู ุงูููููุจ ูุณุชุฎุฏู ููุง.</font></font></i> <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/e4e/77d/daa/e4e77ddaa01705381f956410f546fdf4.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณุชุฎุฏู ุงููุฎุฒู ุงููุคูุช ููุงุณุชูุณู ูู ุชุญุฏูุฏ ููุน ูุนูู ูู ุงูุจูุณู (ุนูู ุณุจูู ุงููุซุงู ุ ุงูุฌูุฏ ูุงูุบุทุงุก ุงููุจุงุชู ุ ุฅูุฎ.)</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฐุง ููุณ GBuffer ุจุฃูููู. </font><font style="vertical-align: inherit;">ูุณุชุฎุฏู ูุณุงุฑ ุงูุฅุถุงุกุฉ ุฃูุถูุง ูุฌุณุงุช ุงูุฅุถุงุกุฉ ูุบูุฑูุง ูู ุงููุฎุงุฒู ุงููุคูุชุฉ ุ ููููู ูู ุฃูุงูุดูุง ูู ูุฐู ุงูููุงูุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุจู ุงูุงูุชูุงู ุฅูู ุงูุฌุฒุก "ุงูุฑุฆูุณู" ูู ุงูููุดูุฑ ุ ุณุฃูุฏู ููุงุญุธุงุช ุนุงูุฉ:</font></font><br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุงุญุธุงุช ุนุงูุฉ </font></font></h3><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) ุงููุฎุฒู ุงููุคูุช ุงููุญูุฏ ุงููุฑุงุฏ ุชูุธููู ูู ุงููุฎุฒู ุงููุคูุช ููุนูู / ุงูุงุณุชูุณู.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅุฐุง ููุช ุจุชุญููู ุงูููุงู ุงููุฐููุฑ ุฃุนูุงู ูู ูุญูู ุฅุทุงุฑ ุฌูุฏ ุ ูุณุชูุงุฌุฃ ููููุงู ุ ูุฃููุง ูุง ุชุณุชุฎุฏู ููุงููุฉ "ูุณุญ" ุ ุจุงุณุชุซูุงุก ุงูุนูู / ุงูุงุณุชูุณู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐุง ุ ูู ุงููุงูุน ุ ูุจุฏู RenderTarget1 ุจูุฐุง ุงูุดูู (ูุงุญุธ ูุญุฏุงุช ุงูุจูุณู "ุงูุถุจุงุจูุฉ" ุนูู ุงููุณุชูู ุงูุจุนูุฏ):</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/22a/16a/3a7/22a16a3a7df971c2d1609f15e254cd06.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐุง ูู ุชุญุณูู ุจุณูุท ูุฐูู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏุฑุณ ููู: </font><font style="vertical-align: inherit;">ุชุญุชุงุฌ ุฅูู ุฅููุงู ุงูููุงุฑุฏ </font><font style="vertical-align: inherit;">ุนูู ููุงููุงุช </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ClearRenderTargetView</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูุฐุง ุงุณุชุฎุฏููุง ููุท ุนูุฏ ุงูุถุฑูุฑุฉ. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) ููููุจ ุนูู - ูู ุชูุฏุฆุฉ</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุนุฏูุฏ ูู </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููุงุฏ </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงููุนู </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุชูุจุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุญูู ุฏูุฉ ุนุงุฒูุฉ ุจุนูู ูุน ุงูููุทุฉ ุงูุนุงุฆูุฉ. ููุชุดุฑ 3 ูุณุชุฎุฏู ุนูุณ ุถ. ูุฐุง ูู ุงูุฎูุงุฑ ุงูุทุจูุนู ููุซู ูุฐู ุงููุนุจุฉ ุงูููุชูุญุฉ ูู ุงูุนุงูู ูุน ูุณุงูุงุช ุทูููุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูููู ุงูุชุจุฏูู ุฅูู DirectX ุฃูุฑูุง ุตุนุจูุง: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃ) ูููู ุจูุณุญ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ููุนูู ูู ุฎูุงู ูุชุงุจุฉ "0" ูููุณ "1". </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูููุฌ ุงูุชูููุฏู ุ ุชู ุงุณุชุฎุฏุงู ุงููููุฉ ุงูุจุนูุฏุฉ "1" ููุณุญ ุงููุฎุฒู ุงููุคูุช ููุนูู. ุจุนุฏ ุงูููุงุจ ุงูุนูู ุ ุฃุตุจุญุช ุงููููุฉ "ุงูุจุนูุฏุฉ" ุงูุฌุฏูุฏุฉ 0 ุ ูุฐูู ุชุญุชุงุฌ ุฅูู ุชุบููุฑ ูู ุดูุก.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจ) ุชุจุฏูู ุงูุญุฏูุฏ ุงููุฑูุจุฉ ูุงูุจุนูุฏุฉ ุนูุฏ ุญุณุงุจ ูุตูููุฉ ุงูุฅุณูุงุท </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฌ) ุชุบููุฑ ูุญุต ุงูุนูู ูู "ุฃูู" ุฅูู "ุฃูุซุฑ" </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงููุณุจุฉ ูุจุฑูุงูุฌ OpenGL ุ ููุงู ุญุงุฌุฉ ุฅูู ูุฒูุฏ ูู ุงูุนูู (ุงูุธุฑ ุงูููุงูุงุช ุงููุฐููุฑุฉ ุฃุนูุงู) ุ ูููู ุงูุฃูุฑ ูุณุชุญู ุฐูู. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) ูุญู ูุง ูุญุชูุธ ุจููุงูุชูุง ูู ุงูุนุงูู</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุนู ุ ูู ุดูุก ุจุณูุท ููุบุงูุฉ. </font><font style="vertical-align: inherit;">ูู ูุฑูุฑ ุงูุฅุถุงุกุฉ ุ ูููู ุจุฅุนุงุฏุฉ ุฅูุดุงุก ูููุน ูู ุงูุนุงูู ูู ุงูุฃุนูุงู.</font></font><br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจูุณู ุชุธููู </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูุฐุง ุงูุฌุฒุก ุ ุฃุฑุฏุช ุฃู ุฃุนุฑุถ ุจุงูุถุจุท ุชุธููู ุงูุจูุณู ุงูุฐู ูููุฑ ุจูุงูุงุช ุงูุณุทุญ ูู GBuffer. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุชู ุงูุขู ูุญู ูุนุฑู ุจุงููุนู ููููุฉ ุชุฎุฒูู ุงูููู ุ ูุงูุฃูุถุงุน ุงูุทุจูุนูุฉ ูุงูุจุฑุงู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงูุทุจุน ุ ููุณ ูู ุดูุก ุจูุฐู ุงูุจุณุงุทุฉ ููุง ุชุธู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุดููุฉ ูู ุชุธููู ุจูุณู ูู ุฃูู ูุญุชูู ุนูู ุงูุนุฏูุฏ ูู ุงูุฎูุงุฑุงุช. </font><font style="vertical-align: inherit;">ููู ุชุฎุชูู ูู ุนุฏุฏ ุงูููุงู ุงููููููุฉ ุฅูููุง ูุนุฏุฏ ุงููุนููุงุช ุงููุณุชุฎุฏูุฉ ูู ุงููุฎุฒู ุงููุคูุช ุงูุซุงุจุช (ุฑุจูุง ูู ุงููุฎุฒู ุงููุคูุช ุงูุซุงุจุช ุงูุฐู ูุตู ุงููุงุฏุฉ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุชุญููู ุ ูุฑุฑุช ุงุณุชุฎุฏุงู ูุฐุง ุงูุจุฑููู ุงูุฌููู:</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/262/635/aa0/262635aa0a42dde5353586c867bc91d1.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฑููููุง ุงูุจุทููู! </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฑุฌู ูุฑุญุจ ุงูููุงู:</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/9e4/fde/9bb/9e4fde9bbe2ebcc3c1088eff5e3ea40d.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐูู ูุฏููุง albedo ุ ุฎุฑูุทุฉ ุทุจูุนูุฉ ุ ูููู ุจุฑุงู. ุญุงูุฉ ููุงุณูุฉ ุฌูููุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุจู ุฃู ูุจุฏุฃ ุ ุจุถุน ูููุงุช ุญูู ุฅุฏุฎุงู </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููุฏุณุฉ </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">ูุชู ููู ุงูููุฏุณุฉ ูุน ุงูููุถุน ุ texcoords ุ ุงููุฎุงุฒู ุงููุคูุชุฉ ุงูุนุงุฏูุฉ ูุงููุงุณูุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุชุฌ ุชุธููู ููุฉ ุงูุฑุฃุณ </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ูุง ููู ุนู</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> texcoords ุ ููุงูู ุงูุธูุงู ุงูุทุจูุนูุฉ / ุงูููุงุณูุฉ ุงูุทุจูุนูุฉ ุฅูู ููุทุชูู ุ ูุถุฑูุจุฉ ุณุงุจููุง ูู ุงููุตูููุฉ ุงูุนุงูููุฉ. ุจุงููุณุจุฉ ููููุงุฏ ุงูุฃูุซุฑ ุชุนููุฏูุง (ุนูู ุณุจูู ุงููุซุงู ุ ูุน ุฎุฑูุทุชูู ููุชุดุฑุชูู ุฃู ุฎุฑูุทุชูู ุนุงุฏูุชูู) ุ ูููู ูุชุธููู ููุฉ ุงูุฑุฃุณ ุฅุฎุฑุงุฌ ุจูุงูุงุช ุฃุฎุฑู ุ ููููู ุฃุฑุฏุช ุนุฑุถ ูุซุงู ุจุณูุท ููุง. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุธููู ุจูุณู ูู ุฑูุฒ ุงููุฌููุน: </font><font style="vertical-align: inherit;">ูุชููู ุชุธููู ูู ุนุฏุฉ ุฎุทูุงุช. ุณุฃุตู ูู ุฌุฒุก ุฑุฆูุณู ูู ูุฐุง ุงูุชุธููู ุจุดูู ูููุตู.</font></font><br><br> <code>ps_5_0 <br> dcl_globalFlags refactoringAllowed <br> dcl_constantbuffer cb4[3], immediateIndexed <br> dcl_sampler s0, mode_default <br> dcl_sampler s13, mode_default <br> dcl_resource_texture2d (float,float,float,float) t0 <br> dcl_resource_texture2d (float,float,float,float) t1 <br> dcl_resource_texture2d (float,float,float,float) t2 <br> dcl_resource_texture2d (float,float,float,float) t13 <br> dcl_input_ps linear v0.zw <br> dcl_input_ps linear v1.xyzw <br> dcl_input_ps linear v2.xyz <br> dcl_input_ps linear v3.xyz <br> dcl_input_ps_sgv v4.x, isfrontface <br> dcl_output o0.xyzw <br> dcl_output o1.xyzw <br> dcl_output o2.xyzw <br> dcl_temps 3 <br> 0: sample_indexable(texture2d)(float,float,float,float) r0.xyzw, v1.xyxx, t1.xyzw, s0 <br> 1: sample_indexable(texture2d)(float,float,float,float) r1.xyz, v1.xyxx, t0.xyzw, s0 <br> 2: add r1.w, r1.y, r1.x <br> 3: add r1.w, r1.z, r1.w <br> 4: mul r2.x, r1.w, l(0.333300) <br> 5: add r2.y, l(-1.000000), cb4[1].x <br> 6: mul r2.y, r2.y, l(0.500000) <br> 7: mov_sat r2.z, r2.y <br> 8: mad r1.w, r1.w, l(-0.666600), l(1.000000) <br> 9: mad r1.w, r2.z, r1.w, r2.x <br> 10: mul r2.xzw, r1.xxyz, cb4[0].xxyz <br> 11: mul_sat r2.xzw, r2.xxzw, l(1.500000, 0.000000, 1.500000, 1.500000) <br> 12: mul_sat r1.w, abs(r2.y), r1.w <br> 13: add r2.xyz, -r1.xyzx, r2.xzwx <br> 14: mad r1.xyz, r1.wwww, r2.xyzx, r1.xyzx <br> 15: max r1.w, r1.z, r1.y <br> 16: max r1.w, r1.w, r1.x <br> 17: lt r1.w, l(0.220000), r1.w <br> 18: movc r1.w, r1.w, l(-0.300000), l(-0.150000) <br> 19: mad r1.w, v0.z, r1.w, l(1.000000) <br> 20: mul o0.xyz, r1.wwww, r1.xyzx <br> 21: add r0.xyz, r0.xyzx, l(-0.500000, -0.500000, -0.500000, 0.000000) <br> 22: add r0.xyz, r0.xyzx, r0.xyzx <br> 23: mov r1.x, v0.w <br> 24: mov r1.yz, v1.zzwz <br> 25: mul r1.xyz, r0.yyyy, r1.xyzx <br> 26: mad r1.xyz, v3.xyzx, r0.xxxx, r1.xyzx <br> 27: mad r0.xyz, v2.xyzx, r0.zzzz, r1.xyzx <br> 28: uge r1.x, l(0), v4.x <br> 29: if_nz r1.x <br> 30: dp3 r1.x, v2.xyzx, r0.xyzx <br> 31: mul r1.xyz, r1.xxxx, v2.xyzx <br> 32: mad r0.xyz, -r1.xyzx, l(2.000000, 2.000000, 2.000000, 0.000000), r0.xyzx <br> 33: endif <br> 34: sample_indexable(texture2d)(float,float,float,float) r1.xyz, v1.xyxx, t2.xyzw, s0 <br> 35: max r1.w, r1.z, r1.y <br> 36: max r1.w, r1.w, r1.x <br> 37: lt r1.w, l(0.200000), r1.w <br> 38: movc r2.xyz, r1.wwww, r1.xyzx, l(0.120000, 0.120000, 0.120000, 0.000000) <br> 39: add r2.xyz, -r1.xyzx, r2.xyzx <br> 40: mad o2.xyz, v0.zzzz, r2.xyzx, r1.xyzx <br> 41: lt r1.x, r0.w, l(0.330000) <br> 42: mul r1.y, r0.w, l(0.950000) <br> 43: movc r1.x, r1.x, r1.y, l(0.330000) <br> 44: add r1.x, -r0.w, r1.x <br> 45: mad o1.w, v0.z, r1.x, r0.w <br> 46: dp3 r0.w, r0.xyzx, r0.xyzx <br> 47: rsq r0.w, r0.w <br> 48: mul r0.xyz, r0.wwww, r0.xyzx <br> 49: max r0.w, abs(r0.y), abs(r0.x) <br> 50: max r0.w, r0.w, abs(r0.z) <br> 51: lt r1.xy, abs(r0.zyzz), r0.wwww <br> 52: movc r1.yz, r1.yyyy, abs(r0.zzyz), abs(r0.zzxz) <br> 53: movc r1.xy, r1.xxxx, r1.yzyy, abs(r0.yxyy) <br> 54: lt r1.z, r1.y, r1.x <br> 55: movc r1.xy, r1.zzzz, r1.xyxx, r1.yxyy <br> 56: div r1.z, r1.y, r1.x <br> 57: div r0.xyz, r0.xyzx, r0.wwww <br> 58: sample_l(texture2d)(float,float,float,float) r0.w, r1.xzxx, t13.yzwx, s13, l(0) <br> 59: mul r0.xyz, r0.wwww, r0.xyzx <br> 60: mad o1.xyz, r0.xyzx, l(0.500000, 0.500000, 0.500000, 0.000000), l(0.500000, 0.500000, 0.500000, 0.000000) <br> 61: mov o0.w, cb4[2].x <br> 62: mov o2.w, l(0) <br> 63: ret</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููู ุฃููุงู ุ ูุงูุนุงุฏุฉ - ููุทุฉ ุดุงุดุฉ ุชุญุชูู ุนูู ููู ูู ุงููุฎุฒู ุงููุคูุช ุงูุซุงุจุช: </font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/e94/24c/abb/e9424cabbd31630a47b7489e0e32c6af.jpg"></div><br><h4 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุจูุฏู </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูุจุฏุฃ ูุน ุงูุฃุดูุงุก ุงููุนูุฏุฉ. </font><font style="vertical-align: inherit;">ุฅููุง ููุณุช ูุฌุฑุฏ </font></font><strike><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"OutputColor.rgb = Texture.Sample (uv) .rgb"</font></font></strike> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุนุฏ ุฃุฎุฐ ุนููุงุช ูู ูููู RGB (ุงูุณุทุฑ 1) ุ ูุฅู ุงูุฃุณุทุฑ ุงูู 14 ุงูุชุงููุฉ ูู ูุง ุฃุณููู "ุงููุฎุฒู ุงููุคูุช ูุชูููู ุงูุชุดุจุน". </font><font style="vertical-align: inherit;">ุงุณูุญูุง ูู ุฃู ุฃุฑูู ุฑูุฒ HLSL: </font><font style="vertical-align: inherit;">ุจุงููุณุจุฉ ููุนุธู ุงููุงุฆูุงุช ุ ูุง ูุนูู ูุฐุง ุงูุฑูุฒ ุณูู ุฅุฑุฌุงุน ุงูููู ุงูุฃุตูู ูู ุงููุณูุฌ. </font><font style="vertical-align: inherit;">ูุชู ุชุญููู ุฐูู ูู ุฎูุงู ุงูููู "cbuffer ุงููุงุฏูุฉ" ุงูููุงุจูุฉ. </font><font style="vertical-align: inherit;">ูุญุชูู cb4_v1.x ุนูู ูููุฉ 1.0 ุ ูุงูุชู ุชูุฑุฌุน ููุงุนูุง 0.0 ูุชูุฑุฌุน ููู ุงูุฅุฏุฎุงู ูู ุชุนูููุฉ </font><i><font style="vertical-align: inherit;">lerp</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ููุน ุฐูู ุ ููุงู ุจุนุถ ุงูุงุณุชุซูุงุกุงุช. </font><font style="vertical-align: inherit;">ุฃูุจุฑ </font><i><font style="vertical-align: inherit;">desaturationFactor ูุฌุฏุชู</font></i><font style="vertical-align: inherit;"> ูู 4.0 (ููู ุฃูู ูู 1.0) ุ ู </font><i><font style="vertical-align: inherit;">desaturatedColor</font></i></font><br><br> <code>float3 albedoColorFilter( in float3 color, in float desaturationFactor, in float3 desaturationValue ) <br> { <br> float sumColorComponents = color.r + color.g + color.b; <br> <br> float averageColorComponentValue = 0.3333 * sumColorComponents; <br> float oneMinusAverageColorComponentValue = 1.0 - averageColorComponentValue; <br> <br> float factor = 0.5 * (desaturationFactor - 1.0); <br> <br> float avgColorComponent = lerp(averageColorComponentValue, oneMinusAverageColorComponentValue, saturate(factor)); <br> float3 desaturatedColor = saturate(color * desaturationValue * 1.5); <br> <br> float mask = saturate( avgColorComponent * abs(factor) ); <br> <br> float3 finalColor = lerp( color, desaturatedColor, mask ); <br> return finalColor; <br> }</code> <br> <br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนุชูุฏ ุนูู ุงูููุงุฏ. </font><font style="vertical-align: inherit;">ูููู ุฃู ูููู ุดูุก ูุซู (0.2 ุ 0.3 ุ 0.4) ุ </font><font style="vertical-align: inherit;">ูุง ุชูุฌุฏ ููุงุนุฏ ุตุงุฑูุฉ. </font><font style="vertical-align: inherit;">ูุจุทุจูุนุฉ ุงูุญุงูุ ูู ุฃุณุชุทุน ูุณุงุนุฏุฉ ูููู ุชุญููู ูุฐุง ูู ุจูุฏู DX11-ุงูุฅุทุงุฑุ ูููุง ุงููุชุงุฆุฌุ ุญูุซ ูู ุงูููู </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desaturatedColor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุณุงูู float3 (0.25ุ 0.3ุ 0.45)</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/12f/184/2d9/12f1842d9d272fc057f35bc73439c4c1.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desaturationFactor = 1.0 (ููุณ ูู ุฃู ุชุฃุซูุฑ)</font></font></i> <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/03c/ead/3a3/03cead3a3d5a713e051e7d863d99ecb0.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desaturationFactor = 2.0</font></font></i> <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/caf/c81/992/cafc81992ebb70914c1e9d6605b8ba17.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desaturationFactor = 3.0</font></font></i> <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/f37/193/7fb/f371937fb39f94a887410a951f9eb628.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desaturationFactor = 4.0</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฃูุง ูุชุฃูุฏ ูู ุฃู ูุฐุง ูุฌุฑุฏ ุชุทุจูู ููุนููุงุช ุงูููุงุฏ ุ ูููู ูุง ูุชู ุชูููุฐู ูู ููุงูุฉ ุงูุฌุฒุก albedo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุถูู ุงูุฎุทูุท 15-20 ุงูููุณุงุช ุงูุฃุฎูุฑุฉ: </font><font style="vertical-align: inherit;">v0.z ูู ุงููุงุชุฌ ูู ุชุธููู ููุฉ ุงูุฑุฃุณ ุ ููู ุตูุฑ. </font><font style="vertical-align: inherit;">ูุง ุชูุณู ุฐูู ุ ูุฃูู ุณูุชู ุงุณุชุฎุฏุงู ุงูุฅุตุฏุงุฑ v0.z ูุงุญููุง ุนุฏุฉ ูุฑุงุช. </font><font style="vertical-align: inherit;">ูุจุฏู ุฃูู ููุน ูู ุงููุนุงูู ุ ููุจุฏู ุฃู ุงูููุฏ ุจุฃูููู ูุดุจู ุงูุจูุงุถ ุงูุฎููู ุ ููู ุจูุง ุฃู v0.z ุชุณุงูู 0 ุ ูุฅู ุงูููู ูุธู ุจูุง ุชุบููุฑ. </font><font style="vertical-align: inherit;">HLSL </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">ุจุฎุตูุต RT0.a ุ ููุง ูุฑู ุ ูุชู ุฃุฎุฐูุง ูู ุงููุฎุฒู ุงููุคูุช ุงูุซุงุจุช ูููุงุฏุฉ ุ ูููู ูุธุฑูุง ูุฃู ุงูุชุธููู ูุง ูุญุชูู ุนูู ูุนูููุงุช ุชุตุญูุญ ุงูุฃุฎุทุงุก ุ ููู ุงูุตุนุจ ุชุญุฏูุฏ ูุงููุฉ ุฐูู. </font><font style="vertical-align: inherit;">ุฑุจูุง ุงูุดูุงููุฉุ </font><font style="vertical-align: inherit;">ููุฏ ุงูุชูููุง ูู ูุฏู ุงูุนุฑุถ ุงูุฃูู!</font></font><br><br> <code>15: max r1.w, r1.z, r1.y <br> 16: max r1.w, r1.w, r1.x <br> 17: lt r1.w, l(0.220000), r1.w <br> 18: movc r1.w, r1.w, l(-0.300000), l(-0.150000) <br> 19: mad r1.w, v0.z, r1.w, l(1.000000) <br> 20: mul o0.xyz, r1.wwww, r1.xyzx</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br> <code>/* ALBEDO */ <br> //     (?) <br> float3 albedoColor = albedoColorFilter( colorTex, cb4_v1.x, cb4_v0.rgb ); <br> float albedoMaxComponent = getMaxComponent( albedoColor ); <br> <br> //   ,   <br> //       "paramZ"   0 <br> float paramZ = Input.out0.z; // ,    0 <br> <br> // ,  0.70  0.85      <br> //       lerp,     . <br> float param = (albedoMaxComponent &gt; 0.22) ? 0.70 : 0.85; <br> float mulParam = lerp(1, param, paramZ); <br> <br> //  <br> pout.RT0.rgb = albedoColor * mulParam; <br> pout.RT0.a = cb4_v2.x;</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุนุงุฏู </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูุจุฏุฃ ุจุชูุฑูุบ ุงูุฎุฑูุทุฉ ุงูุนุงุฏูุฉ ุ ูุจุนุฏ ุฐูู ุ ูุงููุนุชุงุฏ ุ ุณูุฑุจุท ุงูููุงุนุฏ ุงูุทุจูุนูุฉ: </font><font style="vertical-align: inherit;">ุญุชู ุงูุขู ุ ูุง ุดูุก ูุซูุฑ ุงูุฏูุดุฉ. </font><i><font style="vertical-align: inherit;">ุงูุธุฑ ุฅูู ุงูุฃุณุทุฑ 28-33:</font></i><font style="vertical-align: inherit;"> ูููููุง ูุชุงุจุชูุง ุชูุฑูุจูุง ููุง ููู: </font><font style="vertical-align: inherit;">ูุณุช ูุชุฃูุฏูุง ููุง ุฅุฐุง ูุงูุช ุงููุชุงุจุฉ ุตุญูุญุฉ. </font><font style="vertical-align: inherit;">ุฅุฐุง ููุช ุชุนุฑู ูุงููุฉ ูุฐู ุงูุนูููุฉ ุงูุฑูุงุถูุฉ ุ ูุฃุนูููู ุจุฐูู. </font><font style="vertical-align: inherit;">ูุฑู ุฃู ุชุธููู ุงูุจูุณู ูุณุชุฎุฏู SV_IsFrontFace.</font></font><br><br> <code>/*  */ <br> float3 sampledNormal = ((normalTex.xyz - 0.5) * 2); <br> <br> //     TBN <br> float3 Tangent = Input.TangentW.xyz; <br> float3 Normal = Input.NormalW.xyz; <br> float3 Bitangent; <br> Bitangent.x = Input.out0.w; <br> Bitangent.yz = Input.out1.zw; <br> <br> //      ;  ,  ,   normal-tbn <br> //      'mad'   'mov' <br> Bitangent = saturate(Bitangent); <br> <br> float3x3 TBN = float3x3(Tangent, Bitangent, Normal); <br> float3 normal = mul( sampledNormal, TBN );</code> <br> <br><font style="vertical-align: inherit;"></font><br><br> <i><font style="vertical-align: inherit;"></font></i> <br><br> <code>28: uge r1.x, l(0), v4.x <br> 29: if_nz r1.x <br> 30: dp3 r1.x, v2.xyzx, r0.xyzx <br> 31: mul r1.xyz, r1.xxxx, v2.xyzx <br> 32: mad r0.xyz, -r1.xyzx, l(2.000000, 2.000000, 2.000000, 0.000000), r0.xyzx <br> 33: endif</code> <br> <br><font style="vertical-align: inherit;"></font><br><br> <code>[branch] if (bIsFrontFace &lt;= 0) <br> { <br> float cosTheta = dot(Input.NormalW, normal); <br> float3 invNormal = cosTheta * Input.NormalW; <br> normal = normal - 2*invNormal; <br> }</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br>  ูุง ูุฐุง<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฃุชู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุซุงุฆู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูููุณุงุนุฏุฉ </font><font style="vertical-align: inherit;">(ุฃุฑุฏุช ุฃู ุฃูุชุจ "msdn" ุ ููู ...):</font></font><br><br><blockquote style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุญุฏูุฏ ูุง ุฅุฐุง ูุงู ุงููุซูุซ ููุธุฑ ุฅูู ุงููุงููุฑุง. </font><font style="vertical-align: inherit;">ููุฎุทูุท ูุงูููุงุท ุ IsFrontFace ุตุญูุญ. </font><font style="vertical-align: inherit;">ุงูุงุณุชุซูุงุก ูู ุงูุฎุทูุท ุงููุฑุณููุฉ ูู ุงููุซูุซุงุช (ูุถุน ุงูุฅุทุงุฑ ุงูุณููู) ุ ูุงูุชู ุชุญุฏุฏ IsFrontFace ุจุดูู ูุดุงุจู ูุชูููุท ุงููุซูุซ ูู ุงููุถุน ุงูุตูุจ. </font><font style="vertical-align: inherit;">ูููู ุฃู ูุชู ุงููุชุงุจุฉ ุฅููู ุจูุงุณุทุฉ ุชุธููู ููุฏุณู ุ ูุงููุฑุงุกุฉ ููู ุจูุงุณุทุฉ ุชุธููู ุจูุณู.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุฑุฏุช ุงูุชุญูู ูู ุฐูู ุจููุฑุฏู. </font><font style="vertical-align: inherit;">ููู ุงููุงูุน ุ ูุฅู ุงูุชุฃุซูุฑ ููุญูุธ ููุท ูู ูุถุน ุงูุฅุทุงุฑ ุงูุณููู. </font><font style="vertical-align: inherit;">ุฃุนุชูุฏ ุฃู ูุฐุง ุงูุฌุฒุก ูู ุงูุดูุฑุฉ ุถุฑูุฑู ูู ุฃุฌู ุงูุญุณุงุจ ุงูุตุญูุญ ููุญุงูุงุช ุงูุทุจูุนูุฉ (ูุจุงูุชุงูู ุงูุฅุถุงุกุฉ) ูู ูุถุน ุงูุฅุทุงุฑ ุงูุณููู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุง ููู ููุงุฑูุฉ: ููุง ุฃููุงู ุฅุทุงุฑ ุงููุดูุฏ ุงูููุงุฆู ูุน ุชุดุบูู / ุฅููุงู ูุฐู ุงูุฎุฏุนุฉ ุ ุจุงูุฅุถุงูุฉ ุฅูู ูุณูุฌ gbuffer [0-1] ุงูุทุจูุนู ูุน ูุฌูุฏ / ุฅููุงู ุชุดุบูู ุงูุฎุฏุนุฉ:</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/598/46b/81b/59846b81b8b9ed57f0441f29e22e6656.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู ุงููุดูุฏ ุจุฏูู ุฎุฏุนุฉ</font></font></i> <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/590/7e1/a97/5907e1a978e58b6fa362ef2e4b6187a8.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุดูุฏ ูููู ูุน ุญููุฉ</font></font></i> <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/745/09a/c0e/74509ac0e56fa639ec4ae2d70a39be44.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนุงุฏู [0-1] ูุง ุญููุฉ</font></font></i> <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/db8/2f8/622/db82f86223182135807d316fe479ff08.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนุงุฏู [0-1] ุจุงุณุชุฎุฏุงู ุฎุฏุนุฉ</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ูุงุญุธุช ุฃู ูู ูุฏู ุชุฌุณูุฏ ูู GBuffer ูู ุงูุชูุณูู R8G8B8A8_UNORMุ ูุฐุง ูุนูู ุฃู ููุงู 256 ูููุฉ ููููุฉ ููู ูููู. ูู ูุฐุง ูููู ูุชุฎุฒูู ุงูุญุงูุงุช ุงูุทุจูุนูุฉุ </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุนุฏ ุชุฎุฒูู ุงูููุงุนุฏ ุงูุทุจูุนูุฉ ุนุงููุฉ ุงูุฌูุฏุฉ ูุน ูุง ูููู ูู ุงูุจุงูุชุงุช ูู Gbuffer ูุดููุฉ ูุนุฑููุฉ ุ ูููู ูุญุณู ุงูุญุธ ุ ููุงู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุนุฏูุฏ ูู </font></font></a> <font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">ุงูููุงุฏ </font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุฎุชููุฉ </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูููู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุนูู ูููุง</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑุจูุง ูุนุฑู ุจุนุถูู ุจุงููุนู ุงูุทุฑููุฉ ุงููุณุชุฎุฏูุฉ ููุง. ูุฌุจ ุฃู ุฃููู ุฃูู ูู ุงูููุทุน ุงููุงูู ููููุฏุณุฉ ููุงู ูุงุฏุฉ ุฅุถุงููุฉ ูุงุญุฏุฉ ููุญูุฉ ุจุงูุดุฑูุญุฉ 13 ...:</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/ab1/e4a/0bf/ab1e4a0bf128bfed8837d3cd081748f8.jpg"></div><br><br>  ูุง!<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณุชุฎุฏู Witcher 3 ุชูููุฉ ุชุณูู " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Best Fit Normals</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font><font style="vertical-align: inherit;">ููุง ูู ุฃุดุฑุญ ุฐูู ุจุงูุชูุตูู (ุงูุธุฑ ุงูุนุฑุถ). </font><font style="vertical-align: inherit;">ุชู ุงุฎุชุฑุงุนู ูู ุงููุชุฑุฉ ูุง ุจูู 2009-2010 ูู ููุจู Crytek ุ ูุจูุง ุฃู CryEngine ููุชูุญ ุงููุตุฏุฑ ุ ูุฅู BFN ูู ุฃูุถูุง </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุชูุญุฉ ุงููุตุฏุฑ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BFN ูุนุทู ูุณูุฌ ูู ุงูุญูุงุฉ ุงูุทุจูุนูุฉ ูุธุฑุฉ "ูุญุจุจ". </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุนุฏ ุชูุณูุน ุงููุทุงูุงุช ุงูุทุจูุนูุฉ ุจุงุณุชุฎุฏุงู BFN ุ ูููู ุจุฅุนุงุฏุฉ ุชุฑููุฒูุง ูู ุงููุงุตู ุงูุฒููู [-1 ุ 1] ุฅูู [0 ุ 1].</font></font><br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุฑุงู </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุจุฏุฃ ูู ุงูุณุทุฑ 34 ูุฃุฎุฐ ุนููุงุช ูู ูุณูุฌ ุจุฑุงู: </font><font style="vertical-align: inherit;">ููุง ุชุฑูู ุ ููุงู ูุฑุดุญ "ูุนุชู" ูุนุฑูู ูู ุงูุจูุฏู: </font><font style="vertical-align: inherit;">ูุญุณุจ ุงููููู ุจุญุฏ ุฃูุตู. </font><font style="vertical-align: inherit;">ุงููููุฉ ุ ุซู ุงุญุณุจ ุงูููู "ุงูุบุงูู" ููู ุจุชุญุฑููู ุจุงูููู ุงูุฃุตูู ุงููุฑุชุจ ุ ูุน ุฃุฎุฐ ุงููุนููุฉ ูู ุชุธููู vertex ... ููู 0 ุ ูุฐูู ุนูุฏ ุงูุฅุฎุฑุงุฌ ูุญุตู ุนูู ุงูููู ูู ุงููุณูุฌ. </font><font style="vertical-align: inherit;">HLSL:</font></font><br><br> <code>34: sample_indexable(texture2d)(float,float,float,float) r1.xyz, v1.xyxx, t2.xyzw, s0 <br> 35: max r1.w, r1.z, r1.y <br> 36: max r1.w, r1.w, r1.x <br> 37: lt r1.w, l(0.200000), r1.w <br> 38: movc r2.xyz, r1.wwww, r1.xyzx, l(0.120000, 0.120000, 0.120000, 0.000000) <br> 39: add r2.xyz, -r1.xyzx, r2.xyzx <br> 40: mad o2.xyz, v0.zzzz, r2.xyzx, r1.xyzx</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br> <code>/* SPECULAR */ <br> float3 specularTex = texture2.Sample( samplerAnisoWrap, Texcoords ).rgb; <br> <br> //   ,    Albedo.  . ,    <br> // -        "". <br> //      paramZ   0,    <br> //  . <br> float specularMaxComponent = getMaxComponent( specularTex ); <br> float3 specB = (specularMaxComponent &gt; 0.2) ? specularTex : float3(0.12, 0.12, 0.12); <br> float3 finalSpec = lerp(specularTex, specB, paramZ); <br> pout.RT2.xyz = finalSpec;</code> <br> <br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุงูุนูุงุณ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุณ ูุฏู ุฃู ููุฑุฉ ุนูุง ุฅุฐุง ูุงู ูุฐุง ุงูุงุณู ููุงุณุจูุง ููุฐู ุงููุนููุฉ ุ ูุฃููู ูุง ุฃุนุฑู ููู ูุคุซุฑ ุนูู ูุฑูุฑ ุงูุฅุถุงุกุฉ. </font><font style="vertical-align: inherit;">ุงูุญูููุฉ ูู ุฃู ููุงุฉ ุฃููุง ููุฎุฑูุทุฉ ุงูุนุงุฏูุฉ ููุฅุฏุฎุงู ุชุญุชูู ุนูู ุจูุงูุงุช ุฅุถุงููุฉ:</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/5d2/9e5/bd1/5d29e5bd1cb4888593139c38630e3f8e.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณูุฌ ููุงุฉ ุฃููุง "ุฎุฑูุทุฉ ุทุจูุนูุฉ". </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑูุฒ ุงููุฌูุน: </font><font style="vertical-align: inherit;">ูู ูุฑุญุจุงู ูุตุฏูููุง ุงููุฏูู - v0.z! </font><font style="vertical-align: inherit;">ูุนูุงูุง ูุดุจู ุงูุจูุงุถ ูุงููุถุงุฑุจ:</font></font><br><br> <code>41: lt r1.x, r0.w, l(0.330000) <br> 42: mul r1.y, r0.w, l(0.950000) <br> 43: movc r1.x, r1.x, r1.y, l(0.330000) <br> 44: add r1.x, -r0.w, r1.x <br> 45: mad o1.w, v0.z, r1.x, r0.w</code> <br> <br><font style="vertical-align: inherit;"></font><br><br> <code>/* REFLECTIVITY */ <br> float reflectivity = normalTex.a; <br> float reflectivity2 = (reflectivity &lt; 0.33) ? (reflectivity * 0.95) : 0.33; <br> <br> float finalReflectivity = lerp(reflectivity, reflectivity2, paramZ); <br> pout.RT1.a = finalReflectivity;</code> <br> <br>  ุนุธูู!<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐู ูู ููุงูุฉ ุชุญููู ุงูุฅุตุฏุงุฑ ุงูุฃูู ูู ุชุธููู ุจูุณู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูุง ููู ููุงุฑูุฉ ุจูู ุชุธูููู (ูุณุงุฑ) ูุน ุงูุฃุตู (ูููู):</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/2c1/f18/47b/2c1f1847b5ceef3cd0e2f8dfba45d2a6.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฐู ุงูุงุฎุชูุงูุงุช ูุง ุชุคุซุฑ ุนูู ุงูุญุณุงุจุงุช ุ ูุฐูู ุงูุชูู ุนููู ููุง. </font></font><br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจูุณู ุดุงุฏุฑ: Albedo + ุฎูุงุฑ ุนุงุฏู </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฑุฑุช ุฃู ุฃุนุฑุถ ุฎูุงุฑูุง ูุงุญุฏูุง ุ ุงูุขู ููุท ุจุงุณุชุฎุฏุงู ุฎุฑุงุฆุท albedo ูุงูุฎุฑุงุฆุท ุงูุนุงุฏูุฉ ุ ุจุฏูู ูุณูุฌ ุจุฑุงู. ุฑูุฒ ุงููุฌููุน ุฃุทูู ููููุงู: </font><font style="vertical-align: inherit;">ุงููุฑู ุจูู ูุฐุง ูุงูุฎูุงุฑุงุช ุงูุณุงุจูุฉ ููุง ููู: </font><font style="vertical-align: inherit;">ุฃ) </font><b><font style="vertical-align: inherit;">ุงูุฃุณุทุฑ 1 ุ 19</font></b><font style="vertical-align: inherit;"> : ูุชู ุถุฑุจ ุงููุนููุฉ ุงูุงุณุชููุงุก v0.z ุจ cb4 [0] .x ูู ุงููุฎุฒู ุงููุคูุช ุงูุซุงุจุช ุ ููู ูุฐุง ุงูููุชุฌ ูุณุชุฎุฏู ููุท ูู ุฃูุจูุฏู ุงูุงุณุชููุงุก ุนูู ุงูุณุทุฑ 19. ุจุงููุณุจุฉ ููุฅุฎุฑุงุฌ ุงูุขุฎุฑ ุ ูุชู ุงุณุชุฎุฏุงู ุงููููุฉ "ุงูุนุงุฏูุฉ" ูู v0.z. </font><font style="vertical-align: inherit;">ุจ) </font><b><font style="vertical-align: inherit;">ุงูุฃุณุทุฑ 54-55</font></b><font style="vertical-align: inherit;"> : o2.w ุชู ุถุจุทูุง ุงูุขู ุจุดุฑุท (cb4 [7] .x&gt; 0.0) </font><font style="vertical-align: inherit;">ููุฏ ุฃุฏุฑููุง ุจุงููุนู ูุฐุง ุงููููุฐุฌ "ููุน ูู ุงูููุงุฑูุฉ - AND" ูู ุญุณุงุจ ุงูุฑุณู ุงูุจูุงูู ููุณุทูุน. ูููู ูุชุงุจุชูุง ุนูู ุงููุญู ุงูุชุงูู: </font><font style="vertical-align: inherit;">ุฌ) </font><b><font style="vertical-align: inherit;">ุงูุฃุณุทุฑ 34-42</font></b><font style="vertical-align: inherit;"> : ุนูููุฉ ุญุณุงุจูุฉ ูุฎุชููุฉ ุชูุงููุง.</font></font><br><br> <code>ps_5_0 <br> dcl_globalFlags refactoringAllowed <br> dcl_constantbuffer cb4[8], immediateIndexed <br> dcl_sampler s0, mode_default <br> dcl_sampler s13, mode_default <br> dcl_resource_texture2d (float,float,float,float) t0 <br> dcl_resource_texture2d (float,float,float,float) t1 <br> dcl_resource_texture2d (float,float,float,float) t13 <br> dcl_input_ps linear v0.zw <br> dcl_input_ps linear v1.xyzw <br> dcl_input_ps linear v2.xyz <br> dcl_input_ps linear v3.xyz <br> dcl_input_ps_sgv v4.x, isfrontface <br> dcl_output o0.xyzw <br> dcl_output o1.xyzw <br> dcl_output o2.xyzw <br> dcl_temps 4 <br> 0: mul r0.x, v0.z, cb4[0].x <br> 1: sample_indexable(texture2d)(float,float,float,float) r1.xyzw, v1.xyxx, t1.xyzw, s0 <br> 2: sample_indexable(texture2d)(float,float,float,float) r0.yzw, v1.xyxx, t0.wxyz, s0 <br> 3: add r2.x, r0.z, r0.y <br> 4: add r2.x, r0.w, r2.x <br> 5: add r2.z, l(-1.000000), cb4[2].x <br> 6: mul r2.yz, r2.xxzx, l(0.000000, 0.333300, 0.500000, 0.000000) <br> 7: mov_sat r2.w, r2.z <br> 8: mad r2.x, r2.x, l(-0.666600), l(1.000000) <br> 9: mad r2.x, r2.w, r2.x, r2.y <br> 10: mul r3.xyz, r0.yzwy, cb4[1].xyzx <br> 11: mul_sat r3.xyz, r3.xyzx, l(1.500000, 1.500000, 1.500000, 0.000000) <br> 12: mul_sat r2.x, abs(r2.z), r2.x <br> 13: add r2.yzw, -r0.yyzw, r3.xxyz <br> 14: mad r0.yzw, r2.xxxx, r2.yyzw, r0.yyzw <br> 15: max r2.x, r0.w, r0.z <br> 16: max r2.x, r0.y, r2.x <br> 17: lt r2.x, l(0.220000), r2.x <br> 18: movc r2.x, r2.x, l(-0.300000), l(-0.150000) <br> 19: mad r0.x, r0.x, r2.x, l(1.000000) <br> 20: mul o0.xyz, r0.xxxx, r0.yzwy <br> 21: add r0.xyz, r1.xyzx, l(-0.500000, -0.500000, -0.500000, 0.000000) <br> 22: add r0.xyz, r0.xyzx, r0.xyzx <br> 23: mov r1.x, v0.w <br> 24: mov r1.yz, v1.zzwz <br> 25: mul r1.xyz, r0.yyyy, r1.xyzx <br> 26: mad r0.xyw, v3.xyxz, r0.xxxx, r1.xyxz <br> 27: mad r0.xyz, v2.xyzx, r0.zzzz, r0.xywx <br> 28: uge r0.w, l(0), v4.x <br> 29: if_nz r0.w <br> 30: dp3 r0.w, v2.xyzx, r0.xyzx <br> 31: mul r1.xyz, r0.wwww, v2.xyzx <br> 32: mad r0.xyz, -r1.xyzx, l(2.000000, 2.000000, 2.000000, 0.000000), r0.xyzx <br> 33: endif <br> 34: add r0.w, -r1.w, l(1.000000) <br> 35: log r1.xyz, cb4[3].xyzx <br> 36: mul r1.xyz, r1.xyzx, l(2.200000, 2.200000, 2.200000, 0.000000) <br> 37: exp r1.xyz, r1.xyzx <br> 38: mad r0.w, r0.w, cb4[4].x, cb4[5].x <br> 39: mul_sat r1.xyz, r0.wwww, r1.xyzx <br> 40: log r1.xyz, r1.xyzx <br> 41: mul r1.xyz, r1.xyzx, l(0.454545, 0.454545, 0.454545, 0.000000) <br> 42: exp r1.xyz, r1.xyzx <br> 43: max r0.w, r1.z, r1.y <br> 44: max r0.w, r0.w, r1.x <br> 45: lt r0.w, l(0.200000), r0.w <br> 46: movc r2.xyz, r0.wwww, r1.xyzx, l(0.120000, 0.120000, 0.120000, 0.000000) <br> 47: add r2.xyz, -r1.xyzx, r2.xyzx <br> 48: mad o2.xyz, v0.zzzz, r2.xyzx, r1.xyzx <br> 49: lt r0.w, r1.w, l(0.330000) <br> 50: mul r1.x, r1.w, l(0.950000) <br> 51: movc r0.w, r0.w, r1.x, l(0.330000) <br> 52: add r0.w, -r1.w, r0.w <br> 53: mad o1.w, v0.z, r0.w, r1.w <br> 54: lt r0.w, l(0), cb4[7].x <br> 55: and o2.w, r0.w, l(0.064706) <br> 56: dp3 r0.w, r0.xyzx, r0.xyzx <br> 57: rsq r0.w, r0.w <br> 58: mul r0.xyz, r0.wwww, r0.xyzx <br> 59: max r0.w, abs(r0.y), abs(r0.x) <br> 60: max r0.w, r0.w, abs(r0.z) <br> 61: lt r1.xy, abs(r0.zyzz), r0.wwww <br> 62: movc r1.yz, r1.yyyy, abs(r0.zzyz), abs(r0.zzxz) <br> 63: movc r1.xy, r1.xxxx, r1.yzyy, abs(r0.yxyy) <br> 64: lt r1.z, r1.y, r1.x <br> 65: movc r1.xy, r1.zzzz, r1.xyxx, r1.yxyy <br> 66: div r1.z, r1.y, r1.x <br> 67: div r0.xyz, r0.xyzx, r0.wwww <br> 68: sample_l(texture2d)(float,float,float,float) r0.w, r1.xzxx, t13.yzwx, s13, l(0) <br> 69: mul r0.xyz, r0.wwww, r0.xyzx <br> 70: mad o1.xyz, r0.xyzx, l(0.500000, 0.500000, 0.500000, 0.000000), l(0.500000, 0.500000, 0.500000, 0.000000) <br> 71: mov o0.w, cb4[6].x <br> 72: ret</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br> <code>pout.RT2.w = (cb4_v7.x &gt; 0.0) ? (16.5/255.0) : 0.0;</code> <br> <br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ููุฌุฏ ูุณูุฌ ุจุฑุงู ููุง. </font><font style="vertical-align: inherit;">ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ุฑูุฒ ุงููุฌูุน ุงููุณุคูู ุนู ูุฐุง ุงูุฌุฒุก: </font><font style="vertical-align: inherit;">ูุงุญุธ ุฃููุง ุงุณุชุฎุฏููุง ููุง (1 - ุงููุฏุฑุฉ ุงูููุนูุณุฉ). </font><font style="vertical-align: inherit;">ูุญุณู ุงูุญุธ ุ ูุฅู ูุชุงุจุฉ ูุฐุง ูู HLSL ุจุณูุท ุฌุฏูุง: </font><font style="vertical-align: inherit;">ุณุฃุถูู ุฃูู ูู ูุฐุง ุงูุฅุตุฏุงุฑ ูููู ุงููุฎุฒู ุงููุคูุช ุงูุซุงุจุช ูุน ุจูุงูุงุช ุงูููุงุฏ ุฃูุจุฑ ููููุงู. </font><font style="vertical-align: inherit;">ููุง ุ ูุชู ุงุณุชุฎุฏุงู ูุฐู ุงูููู ุงูุฅุถุงููุฉ ููุญุงูุงุฉ ุงูููู ุงููุถุงุฑุจ. </font><font style="vertical-align: inherit;">ูุง ุชุจูู ูู ุชุธููู ูู ููุณู ููุง ูู ุงูุฅุตุฏุงุฑ ุงูุณุงุจู. </font><font style="vertical-align: inherit;">ููุงู 72 ุณุทุฑูุง ูู ุฑูุฒ ุงููุฌููุน ุฃูุซุฑ ูู ุงููุงุฒู ูุนุฑุถูุง ูู WinMerge ุ ูุฐุง ุฎุฐ ูููุชู ุฅูููุง: ููุฏ ุชุญููุช ุงูููุฏ ุงูุฎุงุต ุจู ุฅูู ูุง ูู ุนููู ููุง ูู ุงูุญุงู ูู ุงููุต ุงูุฃุตูู. </font><font style="vertical-align: inherit;">ุฃู ููููู ุชูุฒูู </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">HLSLexplorer ุงูุฎุงุต</font></a><font style="vertical-align: inherit;"> ุจู </font><font style="vertical-align: inherit;">ูุงูุธุฑ ุจููุณู!</font></font><br><br> <code>34: add r0.w, -r1.w, l(1.000000) <br> 35: log r1.xyz, cb4[3].xyzx <br> 36: mul r1.xyz, r1.xyzx, l(2.200000, 2.200000, 2.200000, 0.000000) <br> 37: exp r1.xyz, r1.xyzx <br> 38: mad r0.w, r0.w, cb4[4].x, cb4[5].x <br> 39: mul_sat r1.xyz, r0.wwww, r1.xyzx <br> 40: log r1.xyz, r1.xyzx <br> 41: mul r1.xyz, r1.xyzx, l(0.454545, 0.454545, 0.454545, 0.000000) <br> 42: exp r1.xyz, r1.xyzx</code> <br> <br><font style="vertical-align: inherit;"></font><br><br> <code>float oneMinusReflectivity = 1.0 - normalTex.a; <br> float3 specularTex = pow(cb4_v3.rgb, 2.2); <br> oneMinusReflectivity = oneMinusReflectivity * cb4_v4.x + cb4_v5.x; <br> specularTex = saturate(specularTex * oneMinusReflectivity); <br> specularTex = pow(specularTex, 1.0/2.2); <br> <br> //     ... <br> float specularMaxComponent = getMaxComponent( specularTex ); <br> ...</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุชูุฎูุต </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... ูุฅุฐุง ูุฑุฃุชู ููุง ุ ูุฃูุช ุนูู ุงูุฃุฑุฌุญ ุชุฑูุฏ ุฃู ุชุนูู ููููุงู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ูุจุฏู ุจุณูุทูุง ูู ุงูุญูุงุฉ ุงููุงูุนูุฉ ููุณ ุบุงูุจูุง ูุง ูููู ูุฐูู ุ ูููู ุงูุจูุงูุงุช ุฅูู gbuffer ูู ููู Witcher 3 ุงุณุชุซูุงุกู. </font><font style="vertical-align: inherit;">ููุฏ ุนุฑุถุช ุนููู ุฃุจุณุท ุงูุฅุตุฏุงุฑุงุช ูู ุชุธููู ุงูุจูุณู ุงููุณุคูู ุนููุง ุ ููุง ูุฏูุช ููุงุญุธุงุช ุนุงูุฉ ุชุชุนูู ุจุงูุชุธููู ุงููุคุฌู ุจุดูู ุนุงู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงููุณุจุฉ ุฅูู ุฃูุซุฑ ุงููุฑุถู ุ ููุงู ุฎูุงุฑุงู ูุชุธููู ุงูุจููุณูุงุช ูู pastebin: </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฎูุงุฑ 1 - ูุน ูุณูุฌ ุจุฑุงู </font></font></a> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฎูุงุฑ 2 - ุจุฏูู ูุณูุฌ ุจุฑุงู</font></font></a> <br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุฌุฒุก 10. ุงูุณุชุงุฆุฑ ุงููุทุฑ ูู ุงููุณุงูุฉ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูุฐุง ุงูุฌุฒุก ุณูู ูููู ูุธุฑุฉ ุนูู ุงูุชุฃุซูุฑ ุงูุฌูู ุงูุฑุงุฆุน ุงูุฐู ูุนุฌุจูู ุญููุง - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณุชุงุฆุฑ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงููุทุฑ / ุงูุถูุก </font><font style="vertical-align: inherit;">ุงูุจุนูุฏุฉ </font><font style="vertical-align: inherit;">ุจุงููุฑุจ ูู ุงูุฃูู. </font><font style="vertical-align: inherit;">ูู ุงููุนุจุฉ ุ ูู ุงูุฃุณูู ููุงุกูู ูู ุฌุฒุฑ Skellig.</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/VXt4PEEqV2k" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃูุง ุดุฎุตูุงู ุฃุญุจ ูุฐู ุงูุธุงูุฑุฉ ูู ุงูุบูุงู ุงูุฌูู ูููุช ุฃุดุนุฑ ุจุงููุถูู ุญูู ููููุฉ ููุงู ูุจุฑูุฌู ุงูุฑุณููุงุช CD Projekt Red ุจุชูููุฐูุง. </font><font style="vertical-align: inherit;">ุฏุนููุง ูุนุฑูุฉ ุฐูู! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุง ููู ุดุงุดุชุงู ูุจู ูุจุนุฏ ุชุทุจูู ุณุชุงุฆุฑ ุงููุทุฑ:</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/a9a/62a/eb6/a9a62aeb6050efd2404f9d352fc89d33.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุณุชุงุฆุฑ ุงููุทุฑ</font></font></i> <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/9aa/e43/fcf/9aae43fcf34413a4810778e101b8a209.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุนุฏ ุณุชุงุฆุฑ ุงููุทุฑ</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูููุฏุณุฉ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃููุงู ุ ุณูู ูุฑูุฒ ุนูู ุงูููุฏุณุฉ. </font><font style="vertical-align: inherit;">ุงูููุฑุฉ ูู ุงุณุชุฎุฏุงู ุงุณุทูุงูุฉ ุตุบูุฑุฉ:</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/fc4/df3/add/fc4df3addf2524bc18f91c46a42fcd6a.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุณุทูุงูุฉ ูู ุงููุถุงุก ุงููุญูู</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ูุฌูุฉ ูุธุฑ ููุถุนูุง ูู ุงููุณุงุญุฉ ุงููุญููุฉ ุ ููู ุตุบูุฑุฉ ุฌุฏูุง - ูููุนูุง ูู ุงููุทุงู (0.0 - 1.0). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุจุฏู ุฏุงุฆุฑุฉ ุงูุฅุฏุฎุงู ูููุงููุฉ ุงูุณุญุจ ูุฐู ...</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/c1d/a35/c00/c1da35c0080225e7a47d8010c42aeab8.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุงูู ููู ุจุงููุณุจุฉ ููุง ููุง: Texcoords ู Instance_Transform. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชู ุชุบููู Texcoords ุจูู ุจุณุงุทุฉ: U ูู ุงูููุงุนุฏ ุงูุนููุง ูุงูุณูููุฉ ูู ุงููุชุฑุฉ [0.02777 - 1.02734]. V ูู ุงููุงุนุฏุฉ ุงูุณูููุฉ ูู 1.0 ุ ููู ุงูุฃุนูู - 0.0. ููุง ุชุฑูู ุ ููููู ุจุจุณุงุทุฉ ุฅูุดุงุก ูุฐู ุงูุดุจูุฉ ุญุชู ุฅุฌุฑุงุฆูุงู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุนุฏ ุชููู ูุฐู ุงูุฃุณุทูุงูุฉ ุงูุตุบูุฑุฉ ูู ุงููุณุงุญุฉ ุงููุญููุฉ ุ ูููุง ุจุถุฑุจูุง ูู ุงููุตูููุฉ ุงูุนุงูููุฉ ุงูููุฏูุฉ ููู ูุซูู ูุนูุตุฑ ุงูุฅุฏุฎุงู INSTANCE_TRANSFORM. ุฏุนููุง ูุชุญูู ูู ููู ูุฐู ุงููุตูููุฉ:</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/e88/791/17e/e8879117edb6f1dd9b53d3e7334a22df.jpg"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/adf/fb8/697/adffb8697a86ac86b935a00d6ae23dda.jpg"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/608/599/f6c/608599f6cf3930889c92df1a256991af.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุจุฏู ูุฎููุฉ ุฌุฏุง ุ ุฃููุณ ูุฐููุ </font><font style="vertical-align: inherit;">ูููู ูุง ุชููู ุ ูุณูู ูุญูู ูุฐู ุงููุตูููุฉ ููุฑู ูุง ูุฎููู! </font><font style="vertical-align: inherit;">ุงููุชุงุฆุฌ ูุซูุฑุฉ ุฌุฏูุง ููุงูุชูุงู: ูู </font><font style="vertical-align: inherit;">ุงูููู ูุนุฑูุฉ ููุถุน ุงููุงููุฑุง ูู ูุฐุง ุงูุฅุทุงุฑ ุงููุญุฏุฏ: (-116.5338 ุ 234.8695 ุ 2.09) </font><font style="vertical-align: inherit;">ููุง ุชุฑูู ุ ูููุง ุจุชูุณูุน ุงูุฃุณุทูุงูุฉ ูุฌุนููุง ูุจูุฑุฉ ุฌุฏูุง ูู ูุณุงุญุฉ ุงูุนุงูู (ูู ุงููุญูุฑ TW3 ุ ุงุฑุชูุน ุงููุญูุฑ Z) ุ ุ ูุชุญููุช. </font><font style="vertical-align: inherit;">ุฅููู ูุง ุชุจุฏู ุนููู ุงูุงุณุทูุงูุฉ ุจุนุฏ ุงูุชุญููู ุจุงุณุชุฎุฏุงู ุชุธููู ููุฉ ุงูุฑุฃุณ:</font></font><br><br> <code>XMMATRIX mat( -227.7472, 159.8043, 374.0736, -116.4951, <br> -194.7577, -173.3836, -494.4982, 238.6908, <br> -14.16466, -185.4743, 784.564, -1.45565, <br> 0.0, 0.0, 0.0, 1.0 ); <br> <br> mat = XMMatrixTranspose( mat ); <br> <br> XMVECTOR vScale; <br> XMVECTOR vRotateQuat; <br> XMVECTOR vTranslation; <br> XMMatrixDecompose( &amp;vScale, &amp;vRotateQuat, &amp;vTranslation, mat ); <br> <br> //  ... <br> XMMATRIX matRotate = XMMatrixRotationQuaternion( vRotateQuat );</code> <br> <br><font style="vertical-align: inherit;"></font><br><br> <code>vRotateQuat: (0.0924987569, -0.314900011, 0.883411944, -0.334462732) <br> <br> vScale: (299.999969, 300.000000, 1000.00012) <br> <br> vTranslation: (-116.495102, 238.690796, -1.45564997)</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/f60/457/ca6/f60457ca61dd2d15ec3805b387e71def.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุณุทูุงูุฉ ุจุนุฏ ุงูุชุญููู ุจูุงุณุทุฉ ุชุธููู ููุฉ ุงูุฑุฃุณ. </font><font style="vertical-align: inherit;">ุงูุธุฑ ููู ุชูุน ูุณุจุฉ ุฅูู ูุฑู ุงูุฑุคูุฉ.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุฑุชูุณ ุดุงุฏุฑ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุนุชูุฏ ููุฏุณุฉ ุงูุฅุฏุฎุงู ูุชุธููู ููุฉ ุงูุฑุฃุณ ุจุดูู ุตุงุฑู ุนูู ุจุนุถูุง ุงูุจุนุถ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏุนูุง ูููู ูุธุฑุฉ ูุงุญุตุฉ ุนูู ุฑูุฒ ุงููุฌููุน ูุชุธููู ููุฉ ุงูุฑุฃุณ: </font><font style="vertical-align: inherit;">ุฅูู ุฌุงูุจ ุชูููููุฑุฏุณ ุงูุจุณูุทุฉ ุงููุงุฑุฉ (ุงูุณุทุฑ 0) ู Instance_LOD_Params (ุงูุณุทุฑ 8) ุ ููุงู ุญุงุฌุฉ ุฅูู ุนูุตุฑูู ุฅุถุงูููู ููุฅุฎุฑุงุฌ: SV_Position (ูุฐุง ูุงุถุญ) ูุงูุงุฑุชูุงุน (ุงููููู .z) ููููุถุน ูู ุงูุนุงูู. </font><font style="vertical-align: inherit;">ุชุฐูุฑ ุฃู ุงููุณุงุญุฉ ุงููุญููุฉ ูู ุงููุทุงู [0-1]ุ ูุฐูู ุ ูุจู ุชุทุจูู ุงููุตูููุฉ ุงูุนุงูููุฉ ุ ูุณุชุฎุฏู ุชุธููู ููุฉ ุงูุฑุฃุณ ูููุงุณูุง ูุงูุญุฑุงููุง ูุชุบููุฑ ุงููุถุน ุงููุญูู. ุฎุทูุฉ ุฐููุฉ! </font><font style="vertical-align: inherit;">ูู ูุฐู ุงูุญุงูุฉ ุ ูููู ุงููููุงุณ = float3 (4 ุ 4 ุ 2) ุ ูุงูุชุญูุฒ = float3 (-2 ุ -2 ุ -1). &lt; </font><font style="vertical-align: inherit;">ุงูููุท </font><font style="vertical-align: inherit;">ุงูููููุณ </font><font style="vertical-align: inherit;">ุจูู ุงูุฃุณุทุฑ 9 ู 28 ูู ุถุฑุจ ูุตูููุฉ ุฑุฆูุณูุฉ ุตููู. </font><font style="vertical-align: inherit;">ุฏุนูุง ููุท ูููู ูุธุฑุฉ ุนูู ุชุธููู ููุฉ ุงูุฑุฃุณ ุงูููุงุฆู ุนูู HLSL:</font></font><br><br> <code>vs_5_0 <br> dcl_globalFlags refactoringAllowed <br> dcl_constantbuffer cb1[7], immediateIndexed <br> dcl_constantbuffer cb2[6], immediateIndexed <br> dcl_input v0.xyz <br> dcl_input v1.xy <br> dcl_input v4.xyzw <br> dcl_input v5.xyzw <br> dcl_input v6.xyzw <br> dcl_input v7.xyzw <br> dcl_output o0.xyz <br> dcl_output o1.xyzw <br> dcl_output_siv o2.xyzw, position <br> dcl_temps 2 <br> 0: mov o0.xy, v1.xyxx <br> 1: mul r0.xyzw, v5.xyzw, cb1[6].yyyy <br> 2: mad r0.xyzw, v4.xyzw, cb1[6].xxxx, r0.xyzw <br> 3: mad r0.xyzw, v6.xyzw, cb1[6].zzzz, r0.xyzw <br> 4: mad r0.xyzw, cb1[6].wwww, l(0.000000, 0.000000, 0.000000, 1.000000), r0.xyzw <br> 5: mad r1.xyz, v0.xyzx, cb2[4].xyzx, cb2[5].xyzx <br> 6: mov r1.w, l(1.000000) <br> 7: dp4 o0.z, r1.xyzw, r0.xyzw <br> 8: mov o1.xyzw, v7.xyzw <br> 9: mul r0.xyzw, v5.xyzw, cb1[0].yyyy <br> 10: mad r0.xyzw, v4.xyzw, cb1[0].xxxx, r0.xyzw <br> 11: mad r0.xyzw, v6.xyzw, cb1[0].zzzz, r0.xyzw <br> 12: mad r0.xyzw, cb1[0].wwww, l(0.000000, 0.000000, 0.000000, 1.000000), r0.xyzw <br> 13: dp4 o2.x, r1.xyzw, r0.xyzw <br> 14: mul r0.xyzw, v5.xyzw, cb1[1].yyyy <br> 15: mad r0.xyzw, v4.xyzw, cb1[1].xxxx, r0.xyzw <br> 16: mad r0.xyzw, v6.xyzw, cb1[1].zzzz, r0.xyzw <br> 17: mad r0.xyzw, cb1[1].wwww, l(0.000000, 0.000000, 0.000000, 1.000000), r0.xyzw <br> 18: dp4 o2.y, r1.xyzw, r0.xyzw <br> 19: mul r0.xyzw, v5.xyzw, cb1[2].yyyy <br> 20: mad r0.xyzw, v4.xyzw, cb1[2].xxxx, r0.xyzw <br> 21: mad r0.xyzw, v6.xyzw, cb1[2].zzzz, r0.xyzw <br> 22: mad r0.xyzw, cb1[2].wwww, l(0.000000, 0.000000, 0.000000, 1.000000), r0.xyzw <br> 23: dp4 o2.z, r1.xyzw, r0.xyzw <br> 24: mul r0.xyzw, v5.xyzw, cb1[3].yyyy <br> 25: mad r0.xyzw, v4.xyzw, cb1[3].xxxx, r0.xyzw <br> 26: mad r0.xyzw, v6.xyzw, cb1[3].zzzz, r0.xyzw <br> 27: mad r0.xyzw, cb1[3].wwww, l(0.000000, 0.000000, 0.000000, 1.000000), r0.xyzw <br> 28: dp4 o2.w, r1.xyzw, r0.xyzw <br> 29: ret</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br> <code>cbuffer cbPerFrame : register (b1) <br> { <br> row_major float4x4 g_viewProjMatrix; <br> row_major float4x4 g_rainShaftsViewProjMatrix; <br> } <br> <br> cbuffer cbPerObject : register (b2) <br> { <br> float4x4 g_mtxWorld; <br> float4 g_modelScale; <br> float4 g_modelBias; <br> } <br> <br> struct VS_INPUT <br> { <br> float3 PositionW : POSITION; <br> float2 Texcoord : TEXCOORD; <br> float3 NormalW : NORMAL; <br> float3 TangentW : TANGENT; <br> float4 InstanceTransform0 : INSTANCE_TRANSFORM0; <br> float4 InstanceTransform1 : INSTANCE_TRANSFORM1; <br> float4 InstanceTransform2 : INSTANCE_TRANSFORM2; <br> float4 InstanceLODParams : INSTANCE_LOD_PARAMS; <br> }; <br> <br> struct VS_OUTPUT <br> { <br> float3 TexcoordAndZ : Texcoord0; <br> <br> float4 LODParams : LODParams; <br> float4 PositionH : SV_Position; <br> }; <br> <br> VS_OUTPUT RainShaftsVS( VS_INPUT Input ) <br> { <br> VS_OUTPUT Output = (VS_OUTPUT)0; <br> <br> //    <br> Output.TexcoordAndZ.xy = Input.Texcoord; <br> Output.LODParams = Input.InstanceLODParams; <br> <br> //   <br> float3 meshScale = g_modelScale.xyz; // float3( 4, 4, 2 ); <br> float3 meshBias = g_modelBias.xyz; // float3( -2, -2, -1 ); <br> float3 PositionL = Input.PositionW * meshScale + meshBias; <br> <br> //    instanceWorld  float4s: <br> float4x4 matInstanceWorld = float4x4(Input.InstanceTransform0, Input.InstanceTransform1, <br> Input.InstanceTransform2 , float4(0, 0, 0, 1) ); <br> <br> //     (.z) <br> float4x4 matWorldInstanceLod = mul( g_rainShaftsViewProjMatrix, matInstanceWorld ); <br> Output.TexcoordAndZ.z = mul( float4(PositionL, 1.0), transpose(matWorldInstanceLod) ).z; <br> <br> // SV_Posiiton <br> float4x4 matModelViewProjection = mul(g_viewProjMatrix, matInstanceWorld ); <br> Output.PositionH = mul( float4(PositionL, 1.0), transpose(matModelViewProjection) ); <br> <br> return Output; <br> }</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุงุฑูุฉ ุธูุงูู (ูุณุงุฑ) ูุงูุฃุตู (ูููู): </font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/ef3/4f3/4ed/ef34f34edbc63113a08f47b7cde00df0.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุงุฎุชูุงูุงุช ูุง ุชุคุซุฑ ุนูู ุงูุญุณุงุจุงุช. </font><font style="vertical-align: inherit;">ุฃูุง ุญููุช ุดุงุฏุฑ ุจูุฏู ูู ุงูุฅุทุงุฑ ููุงู ูู ุดูุก ูุง ูุฒุงู ุจุฎูุฑ!</font></font><br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจูุณู ุชุธููู </font></font></h3><br>  ุงุฎูุฑุง<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุจุฏุก ุ ุณูู ุฃุนุฑุถ ุนููู ุงููุฏุฎูุงุช: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชู ุงุณุชุฎุฏุงู ูุณูุฌูู ููุง: ูุณูุฌ ุงูุถูุถุงุก ููุฎุฒู ูุคูุช ููุนูู:</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/83a/558/fc3/83a558fc3c8c7e723eb85308b12657d6.jpg"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/db5/0da/111/db50da111880f6b934d8bed6b74491e6.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูููู ูู ูุฎุงุฒู ุซุงุจุชุฉ: </font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/a12/394/bdc/a12394bdc039e522beeff97b8e41cd80.jpg"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/37a/c47/485/37ac47485335960b2efbefc9f315ef14.jpg"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/4e7/e70/38a/4e7e7038a1bc956aadbb695d70b80ded.jpg"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/7ae/775/bc4/7ae775bc4a9388feceaa1ddf8c0a214a.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฑูุฒ ุงููุฌููุน ูุชุธููู ุงูุจูุณู: </font></font><br><br> <code>ps_5_0 <br> dcl_globalFlags refactoringAllowed <br> dcl_constantbuffer cb0[8], immediateIndexed <br> dcl_constantbuffer cb2[3], immediateIndexed <br> dcl_constantbuffer cb12[23], immediateIndexed <br> dcl_constantbuffer cb4[8], immediateIndexed <br> dcl_sampler s0, mode_default <br> dcl_sampler s15, mode_default <br> dcl_resource_texture2d (float,float,float,float) t0 <br> dcl_resource_texture2d (float,float,float,float) t15 <br> dcl_input_ps linear v0.xyz <br> dcl_input_ps linear v1.w <br> dcl_input_ps_siv v2.xy, position <br> dcl_output o0.xyzw <br> dcl_temps 1 <br> 0: mul r0.xy, cb0[0].xxxx, cb4[5].xyxx <br> 1: mad r0.xy, v0.xyxx, cb4[4].xyxx, r0.xyxx <br> 2: sample_indexable(texture2d)(float,float,float,float) r0.x, r0.xyxx, t0.xyzw, s0 <br> 3: add r0.y, -cb4[2].x, cb4[3].x <br> 4: mad_sat r0.x, r0.x, r0.y, cb4[2].x <br> 5: mul r0.x, r0.x, v0.y <br> 6: mul r0.x, r0.x, v1.w <br> 7: mul r0.x, r0.x, cb4[1].x <br> 8: mul r0.yz, v2.xxyx, cb0[1].zzwz <br> 9: sample_l(texture2d)(float,float,float,float) r0.y, r0.yzyy, t15.yxzw, s15, l(0) <br> 10: mad r0.y, r0.y, cb12[22].x, cb12[22].y <br> 11: mad r0.y, r0.y, cb12[21].x, cb12[21].y <br> 12: max r0.y, r0.y, l(0.000100) <br> 13: div r0.y, l(1.000000, 1.000000, 1.000000, 1.000000), r0.y <br> 14: add r0.y, r0.y, -v0.z <br> 15: mul_sat r0.y, r0.y, cb4[6].x <br> 16: mul_sat r0.x, r0.y, r0.x <br> 17: mad r0.y, cb0[7].y, r0.x, -r0.x <br> 18: mad r0.x, cb4[7].x, r0.y, r0.x <br> 19: mul r0.xyz, r0.xxxx, cb4[0].xyzx <br> 20: log r0.xyz, r0.xyzx <br> 21: mul r0.xyz, r0.xyzx, l(2.200000, 2.200000, 2.200000, 0.000000) <br> 22: exp r0.xyz, r0.xyzx <br> 23: mul r0.xyz, r0.xyzx, cb2[2].xyzx <br> 24: mul o0.xyz, r0.xyzx, cb2[2].wwww <br> 25: mov o0.w, l(0) <br> 26: ret</code> <br> <br>  ูุงู!<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุฉ ูุจูุฑุฉ ุฌุฏุง ุ ูููู ูู ุงููุงูุน ุ ูู ุดูุก ููุณ ุณูุฆุง ููุบุงูุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ุงูุฐู ูุญุฏุซ ููุงุ </font><font style="vertical-align: inherit;">ุฃููุงู ุ ูุญุณุจ ุงูุฃุดุนุฉ ููู ุงูุจููุณุฌูุฉ ุงููุชุญุฑูุฉ ุจุงุณุชุฎุฏุงู ุงูููุช ุงููููุถู ูู cbuffer (cb0 [0] .x) ูุงููููุงุณ / ุงูุฅุฒุงุญุฉ. </font><font style="vertical-align: inherit;">ุชุณุชุฎุฏู ูุฐู texcoords ูุฃุฎุฐ ุนููุงุช ูู ูุณูุฌ ุงูุถูุถุงุก (ุงูุณุทุฑ 2). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุนุฏ ุชููู ูููุฉ ุงูุถูุถุงุก ูู ุงููุณูุฌ ุ ูููู ุจุชุญุฑูู ุจูู ููู min / max (ุนุงุฏุฉู 0 ู 1). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุซู ูููู ุจุงูุถุฑุจ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุนู ุทุฑูู ุฅุญุฏุงุซูุงุช ุงููููุณ V (ุชุฐูุฑ ุฃู ุงูุฅุญุฏุงุซู V ููุชูู ูู 1 ุฅูู 0ุ) - ุงูุณุทุฑ 5. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุฐุง ุ ูููุง ุจุญุณุงุจ "ููุงุน ุงูุณุทูุน" - ูุจุฏู ููุง ููู:</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/064/1a8/801/0641a88012fb6ec18797c0b143fb5f27.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุญุธ ุฃู ุงููุงุฆูุงุช ุงูุจุนูุฏุฉ (ุงูููุงุฑุฉ ุ ุงูุฌุจุงู ...) ูุฏ ุงุฎุชูุช. </font><font style="vertical-align: inherit;">ุญุฏุซ ูุฐุง ูุฃู ุงูุฃุณุทูุงูุฉ ุชุฌุชุงุฒ ุงุฎุชุจุงุฑ ุงูุนูู - ุงูุฃุณุทูุงูุฉ ููุณุช ุนูู ุงููุณุชูู ุงูุจุนูุฏ ููุชู ุฑุณููุง ููู ูุฐู ุงููุงุฆูุงุช:</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/106/8f5/ffd/1068f5ffde6b0efba2c4894b88d5ddf5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุฎุชุจุงุฑ ุงูุนูู</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฑูุฏ ุฃู ูุญุงูู ุฃู ุณุชุงุฑุฉ ุงููุทุฑ ุฃุจุนุฏ (ูููู ููุณ ุจุงูุถุฑูุฑุฉ ูู ุงูุทุงุฆุฑุฉ ุงูุจุนูุฏุฉ). </font><font style="vertical-align: inherit;">ููููุงู ุจุฐูู ุ ูููู ุจุญุณุงุจ ููุงุน ุขุฎุฑ ุ "ููุงุน ุงููุงุฆูุงุช ุงูุจุนูุฏุฉ". </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชู ุญุณุงุจูุง ุจูุงุณุทุฉ ุงูุตูุบุฉ ุงูุชุงููุฉ: </font></font><br><br> <code>farObjectsMask = saturate( (FrustumDepth - CylinderWorldSpaceHeight) * 0.001 );</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ูุชู ุฃุฎุฐ 0.001 ูู ุงููุฎุฒู ุงููุคูุช) ุ ูุงูุฐู ูุนุทููุง ุงูููุงุน ุงููุทููุจ:</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/9ff/02a/153/9ff02a1534054fb27b370d5cd58e7a75.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ูู ุงูุฌุฒุก ุงูุฎุงุต ุจุชุฃุซูุฑ Sharpen ุ ููุฏ ุฃูุถุญุช ุจุงููุนู ุณุทุญููุง ููู ูุชู ุงุณุชุฎุฑุงุฌ ุนูู ูุฑู ุงูุฑุคูุฉ ูู ุงููุฎุฒู ุงููุคูุช ููุนูู). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุดุฎุตููุง ุ ูุจุฏู ูู ุฃู ูุฐุง ุงูุชุฃุซูุฑ ูููู ุชุญูููู ุฃูู ุชูููุฉ ุฏูู ุญุณุงุจ ุงูุงุฑุชูุงุน ูู ูุณุงุญุฉ ุงูุนุงูู ุนู ุทุฑูู ุถุฑุจ ุนูู ูุฑู ุงูุฑุคูุฉ ุจุฑูู ุฃุตุบุฑ ุ ุนูู ุณุจูู ุงููุซุงู 0.0004. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูุฏ ูุถุงุนูุฉ ุงูููุงุน ุ ูุชู ุงูุญุตูู ุนูู ุงูููุงุน ุงูุฃุฎูุฑ:</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/c49/fb2/c1e/c49fb2c1e1dd2ee8d38d81c0cccb0daf.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุนุฏ ุชููู ูุฐุง ุงูููุงุน ุงูููุงุฆู (ุงูุณุทุฑ 16) ุ ูููู ุจุฅุฌุฑุงุก ุงุณุชููุงุก ุขุฎุฑ ุ ูุง ููุนู ุดูุฆูุง ุชูุฑูุจูุง (ุนูู ุงูุฃูู ูู ุงูุญุงูุฉ ุงููุฎุชุจุฑุฉ) ุ ุซู ูุถุฑุจ ุงูููุงุน ุงูููุงุฆู ุจููู ุงูุณุชุงุฆุฑ (ุงูุณุทุฑ 19) ุ ููููู ุจุชุตุญูุญ ุบุงูุง (ุงูุฎุทูุท 20) -22) ูุงูุถุฑุจ ุงูููุงุฆู (23-24). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูููุงูุฉ ุ ูุฑุฌุน ููููุง ุจูููุฉ ุตูุฑ ุฃููุง. ูุฐุง ุจุณุจุจ ุชูููู ุงูุฎูุท ุนูู ูุฐุง ุงููุณุงุฑ: </font></font><br><br> <code>FinalColor = SourceColor * 1.0 + (1.0 - SourceAlpha) * DestColor</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุฐุง ููุช ูุง ุชููู ุชูุงููุง ููู ูุนูู ุงูุงุฎุชูุงุท ุ ูุฅููู ุชูุถูุญูุง ููุฌุฒูุง: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SourceColor ูู ุฅุฎุฑุงุฌ RGB ูู ุชุธููู ุงูุจูุณู ุ ู DestColor ูู ููู RGB ุงูุญุงูู ููุจูุณู ูู ูุฏู ุงูุชุฌุณูุฏ . ููุฐ SourceAlpha ูุณุงูู ุฏุงุฆูุง ุฅูู 0.0ุ ูุงููุนุงุฏูุฉ ุฃุนูุงู ูููู ุฅูู: </font></font><code>FinalColor = SourceColor + DestColor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุจุณุงุทุฉ ุ ููุง ูููู ุจุฅุฌุฑุงุก ุฎูุท ุงููุถุงูุฉ. </font><font style="vertical-align: inherit;">ุฅุฐุง ุชู ุฅุฑุฌุงุน ุชุธููู ุงูุจูุณู (0 ุ 0 ุ 0) ุ ูุณูุธู ุงูููู ููุง ูู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅููู ุฑูุฒ HLSL ุงูููุงุฆู - ุฃุนุชูุฏ ุฃูู ุจุนุฏ ุงูุชูุถูุญ ุณูููู ูููู ุฃุณูู ูุซูุฑูุง: </font><font style="vertical-align: inherit;">ูููููู ุฃู ุฃููู ูุญุณู ุงูุญุธ ุฃู ุชุธููู ุงูุจูุณู ุงูุฎุงุต ุจู ูููู ุจุฅูุดุงุก ููุณ ุฑูุฒ ุงูุชุฌููุน ููุง ูู ุงููุต ุงูุฃุตูู. </font><font style="vertical-align: inherit;">ุฃุชููู ุฃู ุชุณุชูุชุนูุง ุจุงูููุงู. </font><font style="vertical-align: inherit;">ุดูุฑุง ูููุฑุงุกุฉ!</font></font><br><br> <code>struct VS_OUTPUT <br> { <br> float3 TexcoordAndWorldspaceHeight : Texcoord0; <br> float4 LODParams : LODParams; // float4(1,1,1,1) <br> float4 PositionH : SV_Position; <br> }; <br> <br> float getFrustumDepth( in float depth ) <br> { <br> // from [1-0] to [0-1] <br> float d = depth * cb12_v22.x + cb12_v22.y; <br> <br> // special coefficents <br> d = d * cb12_v21.x + cb12_v21.y; <br> <br> // return frustum depth <br> return 1.0 / max(d, 1e-4); <br> } <br> <br> float4 EditedShaderPS( in VS_OUTPUT Input ) : SV_Target0 <br> { <br> // * Input from Vertex Shader <br> float2 InputUV = Input.TexcoordAndWorldspaceHeight.xy; <br> float WorldHeight = Input.TexcoordAndWorldspaceHeight.z; <br> float LODParam = Input.LODParams.w; <br> <br> // * Inputs <br> float elapsedTime = cb0_v0.x; <br> float2 uvAnimation = cb4_v5.xy; <br> float2 uvScale = cb4_v4.xy; <br> float minValue = cb4_v2.x; // 0.0 <br> float maxValue = cb4_v3.x; // 1.0 <br> float3 shaftsColor = cb4_v0.rgb; // RGB( 147, 162, 173 ) <br> <br> float3 finalColorFilter = cb2_v2.rgb; // float3( 1.175, 1.296, 1.342 ); <br> float finalEffectIntensity = cb2_v2.w; <br> <br> float2 invViewportSize = cb0_v1.zw; <br> <br> float depthScale = cb4_v6.x; // 0.001 <br> <br> // sample noise <br> float2 uvOffsets = elapsedTime * uvAnimation; <br> float2 uv = InputUV * uvScale + uvOffsets; <br> float disturb = texture0.Sample( sampler0, uv ).x; <br> <br> // * Intensity mask <br> float intensity = saturate( lerp(minValue, maxValue, disturb) ); <br> intensity *= InputUV.y; // transition from (0, 1) <br> intensity *= LODParam; // usually 1.0 <br> intensity *= cb4_v1.x; // 1.0 <br> <br> // Sample depth <br> float2 ScreenUV = Input.PositionH.xy * invViewportSize; <br> float hardwareDepth = texture15.SampleLevel( sampler15, ScreenUV, 0 ).x; <br> float frustumDepth = getFrustumDepth( hardwareDepth ); <br> <br> <br> // * Calculate mask covering distant objects behind cylinder. <br> <br> // Seems that the input really is world-space height (.z component, see vertex shader) <br> float depth = frustumDepth - WorldHeight; <br> float distantObjectsMask = saturate( depth * depthScale ); <br> <br> // * calculate final mask <br> float finalEffectMask = saturate( intensity * distantObjectsMask ); <br> <br> // cb0_v7.y and cb4_v7.x are set to 1.0 so I didn't bother with naming them :) <br> float paramX = finalEffectMask; <br> float paramY = cb0_v7.y * finalEffectMask; <br> float effectAmount = lerp(paramX, paramY, cb4_v7.x); <br> <br> // color of shafts comes from contant buffer <br> float3 effectColor = effectAmount * shaftsColor; <br> <br> // gamma correction <br> effectColor = pow(effectColor, 2.2); <br> <br> // final multiplications <br> effectColor *= finalColorFilter; <br> effectColor *= finalEffectIntensity; <br> <br> // return with zero alpha 'cause the blending used here is: <br> // SourceColor * 1.0 + (1.0 - SrcAlpha) * DestColor <br> return float4( effectColor, 0.0 ); <br> }</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar437100/">https://habr.com/ru/post/ar437100/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar437088/index.html">ุงูุชุฑููุฌ ูุจุฏุก ุงูุชุดุบูู ูู ุงูุฎุงุฑุฌ: ููููุฉ ุงููุตูู ุฅูู ูุฆุงุช ุงูุขูุงู ูู ุงููุฑุงุก ุงููุงุทููู ุจุงููุบุฉ ุงูุฅูุฌููุฒูุฉ ุจุงุณุชุฎุฏุงู "ูุชูุณุท"</a></li>
<li><a href="../ar437092/index.html">ุณูุงูุฉ ุฎูุงุฑุฒููุงุช ุงูุชุนูู ุงูุขูู. ูุฌูุงุช ุจูุซูู</a></li>
<li><a href="../ar437094/index.html">ููุฏ ูููุง ุจุถุฎ ููุชุจ ุฎุฏูุฉ Atlassian - ุงูุฅุนูุงู ุนู mitap ูุงูุจุซ ุงููุจุงุดุฑ</a></li>
<li><a href="../ar437096/index.html">UDB. ูุง ูุฐุงุ ุงูุฌุฒุก 4. Datapath ALU</a></li>
<li><a href="../ar437098/index.html">6 ูุจุฑุงูุฑ ุ ููุณูู ุ DI Telegraph - ูุทุจุฎ QIWI ุงููุจูุฑ ูู ุชุตููู ุงูููุชุฌุงุช</a></li>
<li><a href="../ar437102/index.html">ุจุทู Lego ุฌุฏูุฏ Meet: Lego Boost</a></li>
<li><a href="../ar437104/index.html">ุงูููุธุงุฑ: ุญุณูุง ุ ุงุฎุชุจุงุฑ ูุญุฏุฉ ูุณูู ุฌุฏุง</a></li>
<li><a href="../ar437106/index.html">ุชูููููุฌูุง ุงููุนูููุงุช ูู ุงูููุทูุฉ</a></li>
<li><a href="../ar437108/index.html">ุชุชู ูุชุงุจุฉ ูุนุธู ุงููุตูุต ุนูู ุงูุฅูุชุฑูุช ูู ูุจู ุงููุฌุงููู.</a></li>
<li><a href="../ar437110/index.html">ุงูููุงุฏ ุงููุงูููุฉ ุชุบูุฑ ุนุงูููุง ุ ููุง ุฒููุง ูุง ูููู ุฅุฌุฑุงุกุงุช ููุญุต ุณูุงูุชูู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>