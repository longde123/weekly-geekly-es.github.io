<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òÇÔ∏è üåù üïû Emulando servi√ßos web da Amazon em um processo JVM. Evitando Roskomnadzor e acelerando o desenvolvimento e os testes üë¶üèΩ üìÉ üë©üèº‚Äç‚úàÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Por que voc√™ pode precisar emular a infraestrutura de servi√ßos web da Amazon? 

 Antes de tudo, est√° economizando - economizando tempo para desenvolvi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Emulando servi√ßos web da Amazon em um processo JVM. Evitando Roskomnadzor e acelerando o desenvolvimento e os testes</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444472/"> Por que voc√™ pode precisar emular a infraestrutura de servi√ßos web da Amazon? <br><br>  Antes de tudo, est√° economizando - economizando tempo para desenvolvimento e depura√ß√£o e o que √© igualmente importante - economizando dinheiro com o or√ßamento do projeto.  √â claro que o emulador n√£o ser√° 100% id√™ntico ao ambiente original que estamos tentando emular.  Mas, com o objetivo de acelerar o desenvolvimento e a automa√ß√£o do processo, as semelhan√ßas existentes devem ser suficientes.  A coisa mais atual que aconteceu em 2018 com a AWS foi o bloqueio pelos provedores de IP dos endere√ßos IP das sub-redes da AWS na Federa√ß√£o Russa.  E esses bloqueios afetaram nossa infraestrutura localizada na nuvem da Amaz√¥nia.  Se voc√™ planeja usar a tecnologia da AWS e colocar o projeto nessa nuvem, o desenvolvimento e teste de emula√ß√£o mais do que compensa. <br><br><img src="https://habrastorage.org/webt/jz/ty/k7/jztyk798xcq9yqietemgy-6133m.png"><br><br>  Na publica√ß√£o, mostrarei como conseguimos realizar esse truque com os servi√ßos S3, SQS, RDS PostgreSQL e Redshift ao migrar um data warehouse existente para a AWS por muitos anos. <br><a name="habracut"></a><br>  Isso √© apenas parte da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reuni√£o</a> do meu √∫ltimo ano no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mapa</a> , que corresponde aos temas dos hubs da AWS e Java.  A segunda parte diz respeito aos bancos de dados PostgreSQL, Redshift e coluna, e sua vers√£o em texto pode ser publicada nos hubs, v√≠deos e slides correspondentes, no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site da confer√™ncia</a> . <br><br>  Ao desenvolver um aplicativo para a AWS durante o bloqueio de sub-redes da AWS, a equipe praticamente n√£o os notou no processo di√°rio de desenvolvimento de novas funcionalidades.  Os testes tamb√©m funcionaram e voc√™ pode depurar o aplicativo.  E somente ao tentar examinar os logs do aplicativo nas logentries, as m√©tricas no SignalFX ou a an√°lise de dados no Redshift / PostgreSQL RDS ficaram desapontadas - os servi√ßos n√£o estavam dispon√≠veis na rede do provedor russo.  A emula√ß√£o da AWS nos ajudou a n√£o perceber isso e evitar atrasos muito maiores ao trabalhar com a nuvem Amazon atrav√©s de uma rede VPN. <br><br>  Cada provedor de nuvem ‚Äúescondido‚Äù tem muitos drag√µes e voc√™ n√£o deve ceder √† publicidade.  Voc√™ precisa entender por que tudo isso √© necess√°rio para o provedor de servi√ßos.  Obviamente, a infraestrutura existente da Amazon, Microsoft e Google tem vantagens.  E quando eles dizem que tudo √© feito apenas para facilitar o seu desenvolvimento, eles provavelmente tentam colocar voc√™ na sua agulha e dar a primeira dose de gra√ßa.  Para que mais tarde eles n√£o saiam da infraestrutura e da tecnologia espec√≠fica.  Portanto, tentaremos evitar o bloqueio do fornecedor.  √â claro que nem sempre √© poss√≠vel abstrair completamente de decis√µes espec√≠ficas e acho que, muitas vezes, √© poss√≠vel abstrair quase 90% em um projeto.  Mas os 10% restantes do projeto, vinculados a um provedor de tecnologias muito importantes, est√£o otimizando o desempenho do aplicativo ou os recursos exclusivos dos quais n√£o existem em mais nenhum outro lugar.  Eles devem sempre lembrar as vantagens e desvantagens das tecnologias e se proteger o m√°ximo poss√≠vel, n√£o "sentar-se" em uma API espec√≠fica de um provedor de infraestrutura em nuvem. <br><br>  A Amazon escreve sobre o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">processamento de mensagens</a> em seu site.  A ess√™ncia e a abstra√ß√£o das tecnologias de troca de mensagens s√£o as mesmas em todos os lugares, embora haja nuances - mensagens passando por filas ou t√≥picos.  Portanto, a AWS recomenda o uso do Apache ActiveMQ fornecido e gerenciado para migrar aplicativos de um broker de mensagens existente e para novos aplicativos Amazon SQS / SNS.  Este √© um exemplo de liga√ß√£o √† sua pr√≥pria API, em vez da API JMS padronizada e dos protocolos AMQP, MMQT, STOMP.  √â claro que esse provedor, com sua solu√ß√£o, pode ter um desempenho mais alto, suportar escalabilidade etc.  Do meu ponto de vista, se voc√™ usar suas bibliotecas, e n√£o APIs padronizadas, haver√° muito mais problemas. <br><br>  A AWS possui um banco de dados Redshift.  √â um banco de dados distribu√≠do com uma arquitetura paralela massiva.  Voc√™ pode carregar uma grande quantidade de dados em tabelas em v√°rios sites Redshft na Amazon e executar consultas anal√≠ticas em grandes conjuntos de dados.  Este n√£o √© um sistema OLTP em que √© importante executar pequenas solicita√ß√µes em um pequeno n√∫mero de registros com freq√º√™ncia suficiente com garantias ACID.  Ao trabalhar com Redshift, sup√µe-se que voc√™ n√£o tenha um grande n√∫mero de consultas por unidade de tempo, mas elas podem ler agregados em uma quantidade muito grande de dados.  Esse sistema √© posicionado pelo fornecedor para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">atualizar seu</a> data warehouse (armaz√©m) na AWS e prometer um simples carregamento de dados.  O que n√£o √© de todo verdade. <br><br>  Um trecho da documenta√ß√£o sobre quais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tipos o</a> Amazon Redshift <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">suporta</a> .  √â um conjunto bastante escasso e, se voc√™ precisar de algo para armazenar e processar dados que n√£o est√£o listados aqui, ser√° dif√≠cil trabalhar.  Por exemplo, um GUID. <br><br>  Pergunta do sal√£o: "E JSON?" <br><br>  - JSON pode ser gravado apenas como VARCHAR e h√° v√°rias fun√ß√µes para trabalhar com JSON. <br>  Coment√°rio da plat√©ia: "O Postgres tem suporte JSON normal." <br><br>  - Sim, possui suporte para esse tipo de dados e fun√ß√µes.  Mas o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Redshift √© baseado</a> no PostgreSQL 8.0.2.  Havia um projeto ParAccel, se n√£o me engano, essa tecnologia de 2005 √© uma bifurca√ß√£o do postgres que possui um agendador para solicita√ß√µes distribu√≠das com base em uma arquitetura paralela em massa.  Cinco a seis anos se passaram e esse projeto foi licenciado para a plataforma Amazon Web Servces e recebeu o nome Redshift.  Algo foi removido do Postgres original, muito foi adicionado.  Eles acrescentaram que, relacionado √† autentica√ß√£o / autoriza√ß√£o na AWS, com fun√ß√µes, a seguran√ßa na Amazon funciona bem.  Mas se voc√™ precisar, por exemplo, conectar-se do Redshift a outro banco de dados usando a Fonte de Dados Externos, n√£o encontrar√° isso.  N√£o h√° fun√ß√µes para trabalhar com XML, fun√ß√µes para trabalhar com JSON duas vezes e calculadas incorretamente. <br><br>  Ao desenvolver um aplicativo, tente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">n√£o depender de implementa√ß√µes espec√≠ficas</a> e o c√≥digo do aplicativo depende apenas de abstra√ß√µes.  Voc√™ pode criar essas fachadas e abstra√ß√µes, mas nesse caso existem muitas bibliotecas prontas - fachadas.  Que abstraem o c√≥digo de implementa√ß√µes espec√≠ficas, de estruturas espec√≠ficas.√â claro que elas podem n√£o suportar toda a funcionalidade, como um "denominador comum" para tecnologias.  √â melhor desenvolver software confiando em abstra√ß√µes para simplificar os testes. <br><br>  Para emular a AWS, mencionarei duas op√ß√µes.  O primeiro √© mais honesto e correto, mas funciona mais devagar.  O segundo √© sujo e r√°pido.  Vou falar sobre a op√ß√£o de invas√£o - estamos tentando criar toda a infraestrutura em um √∫nico processo - os testes e a op√ß√£o de plataforma cruzada funcionar√£o mais rapidamente com o trabalho no Windows (onde o docker nem sempre consegue ganhar dinheiro com voc√™). <br><br>  O primeiro m√©todo √© perfeito se voc√™ estiver desenvolvendo no linux / macos e tiver docker, seria melhor usar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">localstack atlassian</a> .  √â conveniente usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cont√™ineres de teste</a> para integrar o localstack na JVM. <br><br>  O que me impediu de usar o lockalstack no docker no projeto foi que o desenvolvimento estava no Windows e ningu√©m atestou a vers√£o alfa do docker quando este projeto iniciou ... Tamb√©m √© poss√≠vel que eles n√£o tenham permiss√£o para instalar uma m√°quina virtual com linux e docker em qualquer empresa que leve a s√©rio. √† seguran√ßa da informa√ß√£o.  N√£o estou falando de trabalhar em um ambiente seguro em bancos de investimento e banir quase todos os firewalls de tr√°fego l√°. <br><br>  Vamos considerar op√ß√µes como emular o armazenamento simples S3.  Este n√£o √© um sistema de arquivos comum da Amazon, mas um armazenamento de objetos distribu√≠dos.  Em que voc√™ coloca seus dados como um BLOB, sem a possibilidade de modifica√ß√£o e adi√ß√£o de dados.  Existem armazenamentos distribu√≠dos completos similares de outros fabricantes.  Por exemplo, o armazenamento de objetos distribu√≠dos Ceph permite que voc√™ trabalhe com sua funcionalidade usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">protocolo REST S3</a> e o cliente existente com modifica√ß√µes m√≠nimas.  Mas esta √© uma solu√ß√£o bastante pesada para o desenvolvimento e teste de aplicativos java. <br><br>  Um projeto mais r√°pido e adequado √© a biblioteca java <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">s3proxy</a> .  Ele emula o protocolo REST S3 e o converte nas chamadas da API <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">jcloud</a> correspondentes e permite o uso de muitas implementa√ß√µes para leitura e armazenamento reais de dados.  Ele pode transmitir chamadas para a API do Google App Engine, API do Microsoft Azure, mas para testes √© mais conveniente usar o armazenamento tempor√°rio do jcloud na RAM.  Tamb√©m √© necess√°rio configurar a vers√£o do protocolo de autentica√ß√£o AWS S3 e especificar os valores de chave e segredo, tamb√©m configurar o terminal - a porta e a interface na qual esse Proxy S3 escutar√°.  Portanto, seu c√≥digo usando o cliente AWS SDK deve ser conectado nos testes ao terminal S3 da AWS, n√£o √† regi√£o da AWS.  Novamente, lembre-se de que o s3proxy n√£o suporta todos os recursos da API do S3, mas todos os nossos cen√°rios de uso s√£o perfeitamente compat√≠veis!  At√© o upload de v√°rias partes para arquivos grandes √© suportado pelo s3proxy. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a85/65d/9ce/a8565d9ceabaa944dfc993c88e00d738.png"></div><br><br>  O Amazon Simple Queue Service √© um servi√ßo de fila.  H√° um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">servi√ßo de</a> fila <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">elasticmq</a> que √© escrito em scala e pode ser apresentado ao seu aplicativo usando o protocolo Amazon SQS.  Como n√£o o usei no projeto, darei o c√≥digo de inicializa√ß√£o, confiando nas informa√ß√µes de seus desenvolvedores. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7eb/11d/adf/7eb11dadfac303746ecc755fccee6384.png"></div><br><br>  No projeto, segui o caminho inverso e o c√≥digo depende das abstra√ß√µes spring-jms JmsTemplate e JmsListener e as depend√™ncias do projeto especificam o driver JMS para SQS com.amazonaws: amazon-sqs-java-messaging-lib.  √â isso que diz respeito ao c√≥digo principal do aplicativo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/08d/3ca/64b/08d3ca64b9c7f355cc3661ce692768ae.png"></div><br><br>  Nos testes, conectamos o Artemis-jms-server como um servidor JMS incorporado para testes e, no contexto do Spring de teste, em vez do connection factory SQS, usamos o connection factory do Artemis.  Artemis √© a pr√≥xima vers√£o do Apache ActiveMQ, um Middleware Orientado a Mensagens moderno e completo - n√£o apenas uma solu√ß√£o de teste.  Talvez passemos a us√°-lo no futuro, n√£o apenas em autotestes.  Assim, usando abstra√ß√µes JMS em conjunto com o Spring, simplificamos o c√≥digo do aplicativo e a capacidade de test√°-lo facilmente.  Voc√™ s√≥ precisa adicionar as depend√™ncias org.springframework.boot: spring-boot-starter-artemis e org.apache.activemq: artemis-jms-server. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/245/a8f/d3c/245a8fd3c8cb56a4b6fa460018d48f94.png"></div><br><br>  Em alguns testes, o PostgreSQL pode ser emulado substituindo-o pelo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">H2Database</a> .  Isso funcionar√° se os testes n√£o forem aceitos e n√£o usarem fun√ß√µes espec√≠ficas do PG.  Ao mesmo tempo, o H2 pode emular um subconjunto do protocolo de conex√£o PostgreSQL sem suporte para tipos e fun√ß√µes de dados.  Em nosso projeto, usamos o Foreing Data Wrapper, para que esse m√©todo n√£o funcione para n√≥s. <br><br>  Voc√™ pode executar o PostgreSQL real.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O postgresql-embedded</a> baixa a distribui√ß√£o real, ou melhor, o archive com arquivos bin√°rios para a plataforma com a qual executamos, descompacta.  No linux no tempfs na RAM, no windows em% TEMP%, o processo do servidor postgresql √© iniciado, define as configura√ß√µes do servidor e os par√¢metros do banco de dados.  Devido aos recursos de distribui√ß√£o de distribui√ß√£o, vers√µes anteriores √† PG 11 n√£o funcionam no Linux.  Para mim, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">criei</a> uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">biblioteca de wrapper</a> que permite obter montagens bin√°rias do PostgreSQL n√£o apenas de um servidor HTTP, mas tamb√©m do reposit√≥rio maven.  O que pode ser muito √∫til ao trabalhar em redes isoladas e criar um servidor de CI sem acesso √† Internet.  Outra conveni√™ncia no trabalho com meu wrapper √© a anota√ß√£o do componente CDI, que facilita o uso do componente no contexto do Spring, por exemplo.  A implementa√ß√£o da interface do servidor AutoClosable apareceu mais cedo do que no projeto original.  N√£o √© necess√°rio lembrar de parar o servidor, ele ser√° interrompido quando o contexto do Spring for fechado automaticamente. <br><br>  Na inicializa√ß√£o, voc√™ pode criar um banco de dados com base em scripts, complementando o contexto do Spring com as propriedades apropriadas.  Agora estamos criando um esquema de banco de dados usando scripts <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">flyway</a> para migrar o esquema do banco de dados, que s√£o iniciados sempre que o banco de dados √© criado em testes. <br><br>  Para verificar os dados ap√≥s a execu√ß√£o dos testes, usamos a biblioteca spring-test-dbunit.  Nas anota√ß√µes dos m√©todos de teste, indicamos com quais uploads comparar o estado do banco de dados.  Isso elimina a necessidade de escrever c√≥digo para trabalhar com o dbunit, voc√™ s√≥ precisa adicionar o ouvinte da biblioteca ao c√≥digo de teste.  Voc√™ pode especificar em qual ordem os dados das tabelas ser√£o exclu√≠dos ap√≥s a conclus√£o do m√©todo de teste, se o contexto do banco de dados for reutilizado entre os testes.  Em 2019, existe uma abordagem mais moderna implementada no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">piloto de banco de dados</a> que funciona com o junit5.  Voc√™ pode ver um exemplo de uso, por exemplo <a href="">aqui</a> . <br><br>  O mais dif√≠cil foi emular o Amazon Redshift.  H√° um projeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">redshift-fake-driver,</a> cujo projeto √© emular a carga de dados em lote no banco de dados anal√≠tico da AWS.  No emulador de protocolo jdbc: postgresqlredshift, os comandos COPY, UNLOAD s√£o implementados, todos os outros comandos s√£o delegados ao driver JDBC PostgreSQL comum. <br><br>  Portanto, os testes n√£o funcionar√£o da mesma maneira que no Redshift, a opera√ß√£o de atualiza√ß√£o, que usa outra tabela como fonte de dados para atualiza√ß√£o (a sintaxe difere no Redshift e no PostgreSQL 9+. Tamb√©m notei uma interpreta√ß√£o diferente da cita√ß√£o de linha nos comandos SQL entre esses bancos de dados. <br><br>  Devido √† arquitetura de um banco de dados Redshift real, as opera√ß√µes de inser√ß√£o, atualiza√ß√£o e exclus√£o de dados s√£o bastante lentas e "caras" em termos de E / S.  √â poss√≠vel inserir dados com desempenho aceit√°vel apenas em "pacotes" grandes e o comando COPY apenas permite fazer o download de dados de um sistema de arquivos S3 distribu√≠do.  Este comando no banco de dados suporta v√°rios formatos de dados AVRO, CSV, JSON, Parquet, ORC e ‚Äã‚ÄãTXT.  E o projeto emulador se concentra em CSV, TXT, JSON. <br><br>  Portanto, para emular o Redshift nos testes, ser√° necess√°rio iniciar o banco de dados PostgreSQL conforme descrito anteriormente e iniciar a emula√ß√£o do reposit√≥rio S3. Ao criar uma conex√£o com o postgres, basta adicionar redshift-fake-driver no caminho da classe e especificar a classe do driver jp.ne.opt.redshiftfake.postgres. FakePostgresqlDriver.  Depois disso, voc√™ pode usar o mesmo caminho para migrar o esquema do banco de dados, e o dbunit j√° √© familiar para comparar dados ap√≥s a execu√ß√£o dos testes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/17e/d0b/20a/17ed0b20a1e7bb4f4205747122a22a70.png"></div><br><br>  Gostaria de saber quantos leitores usam AWS e Redshift em seu trabalho?  Escreva nos coment√°rios sobre sua experi√™ncia. <br><br>  Usando apenas projetos de c√≥digo aberto, a equipe conseguiu acelerar o desenvolvimento no ambiente da AWS, economizar dinheiro com o or√ßamento do projeto e n√£o impedir que a equipe trabalhasse quando as sub-redes da AWS foram bloqueadas por Roskomnadzor. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt444472/">https://habr.com/ru/post/pt444472/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt444462/index.html">Testando o Samsung Galaxy S10 - Quando os smartphones alcan√ßam as c√¢meras?</a></li>
<li><a href="../pt444464/index.html">Outra maneira de fotografar sua perna usando std :: thread</a></li>
<li><a href="../pt444466/index.html">Desculpe, todos os seus bancos de dados pertencem ao Google. Apresenta√ß√£o do Google na Game Development Conference 2019, Stadia Project</a></li>
<li><a href="../pt444468/index.html">Nvidia Neural Network transforma esbo√ßos simples em belas paisagens</a></li>
<li><a href="../pt444470/index.html">20 h√°bitos de higiene da aten√ß√£o: como usar a tecnologia, mas n√£o deix√°-los tomar tempo e aten√ß√£o</a></li>
<li><a href="../pt444474/index.html">Constru√ß√£o da linha de comunica√ß√£o Sakhalin-Kuril. Segero Tour - Telef√©rico</a></li>
<li><a href="../pt444476/index.html">Competi√ß√£o da RUSNANO: fa√ßa um curso on-line sobre microeletr√¥nica moderna e fa√ßa um tour pr√°tico com FPGAs, ganhe um pr√™mio</a></li>
<li><a href="../pt444480/index.html">Como reduzir o peso de um elemento estrutural da aeronave em um ter√ßo</a></li>
<li><a href="../pt444482/index.html">O que infla a mem√≥ria no Ruby?</a></li>
<li><a href="../pt444484/index.html">Estimativa de termos para desenvolvimento e teste de tarefas (n√£o necess√°rio)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>