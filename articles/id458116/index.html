<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍🔧 🛠️ 👀 Langganan SwiftUI dan Auto-Renewable 🔛 👨🏾‍🤝‍👨🏽 🕋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hai Connected Denis from Apphud - layanan untuk analisis langganan yang dapat diperbarui untuk aplikasi iOS. 


 Seperti yang Anda ketahui, di WWDC 20...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Langganan SwiftUI dan Auto-Renewable</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/apphud/blog/458116/"><p><img src="https://habrastorage.org/webt/uv/gw/et/uvgwetpxigh37y6ofexpjnqx6lk.png" alt="gambar"></p><br><p>  Hai  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Connected</a> Denis from <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Apphud</a> - layanan untuk analisis langganan yang dapat diperbarui untuk aplikasi iOS. </p><br><p>  Seperti yang Anda ketahui, di WWDC 2019, Apple mengumumkan kerangka kerja SwiftUI deklaratif barunya.  Pada artikel ini saya akan mencoba memberi tahu cara menggunakan SwiftUI untuk melakukan layar pembayaran dan mengimplementasikan fungsi langganan yang dapat diperbarui secara otomatis. <a name="habracut"></a></p><br><blockquote>  Jika Anda belum terbiasa dengan SwiftUI, Anda dapat membaca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel pengantar</a> singkat.  Dan jika Anda ingin mempelajari lebih lanjut tentang langganan dan cara menerapkannya dengan benar, baca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel ini</a> . </blockquote><p>  Anda membutuhkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Xcode 11 untuk bekerja</a> .  Buat proyek baru dan pastikan ada tanda centang di sebelah <em>"Gunakan SwiftUI".</em> </p><br><p>  SwiftUI adalah kerangka kerja untuk menulis antarmuka, dan oleh karena itu kami tidak dapat membuat manajer pembelian menggunakannya.  Tetapi kami tidak akan menulis manajer kami, tetapi menggunakan solusi yang sudah jadi, yang akan kami tambahkan dengan kode kami.  Anda dapat menggunakan, misalnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SwiftyStoreKit</a> .  Dalam contoh kita, kita akan menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kelas</a> dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel</a> kita <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sebelumnya</a> . </p><br><p>  Produk akan diinisialisasi pada layar utama, tanggal kedaluwarsa langganan kami dan tombol untuk beralih ke layar pembelian juga akan ditampilkan di sana. </p><br><pre><code class="swift hljs"><span class="hljs-type"><span class="hljs-type">ProductsStore</span></span>.shared.initializeProducts() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> windowScene = scene <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">UIWindowScene</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> window = <span class="hljs-type"><span class="hljs-type">UIWindow</span></span>(windowScene: windowScene) window.rootViewController = <span class="hljs-type"><span class="hljs-type">UIHostingController</span></span>(rootView: <span class="hljs-type"><span class="hljs-type">ContentView</span></span>(productsStore: <span class="hljs-type"><span class="hljs-type">ProductsStore</span></span>.shared)) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.window = window window.makeKeyAndVisible() }</code> </pre> <br><p>  Pertimbangkan kelas <code>SceneDelegate</code> .  Di dalamnya, kami membuat <code>ProductsStore</code> kelas tunggal, di mana produk diinisialisasi.  Setelah itu, buat root <code>ContentView</code> dan tentukan singleton sebagai parameter input. <br>  Pertimbangkan kelas <code>ProductsStore</code> : </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductsStore</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ObservableObject</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> shared = <span class="hljs-type"><span class="hljs-type">ProductsStore</span></span>() @<span class="hljs-type"><span class="hljs-type">Published</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> products: [<span class="hljs-type"><span class="hljs-type">SKProduct</span></span>] = [] @<span class="hljs-type"><span class="hljs-type">Published</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> anyString = <span class="hljs-string"><span class="hljs-string">"123"</span></span> <span class="hljs-comment"><span class="hljs-comment">// little trick to force reload ContentView from PurchaseView by just changing any Published value func handleUpdateStore(){ anyString = UUID().uuidString } func initializeProducts(){ IAPManager.shared.startWith(arrayOfIds: [subscription_1, subscription_2], sharedSecret: shared_secret) { products in self.products = products } } }</span></span></code> </pre> <br><p>  Kelas kecil ini, semacam "add-on" di atas <code>IAPManager</code> , berfungsi untuk memperbarui <code>ContentView</code> saat memperbarui daftar produk.  Kelas <code>ProductsStore</code> mendukung protokol <code>ObservableObject</code> . </p><br><p>  Apa itu <code>ObservableObject</code> dan <code>@Published</code> ? </p><br><p>  <code>ObservableObject</code> adalah protokol khusus untuk mengamati objek dan melacak perubahan pada propertinya.  Properti harus ditandai dengan atribut <code>@Published</code> .  Dalam contoh tersebut, pemberitahuan dikirimkan ketika array <code>products</code> berubah, tetapi Anda dapat menambahkan pemberitahuan ini untuk metode dan properti objek apa pun. </p><br><p>  Pemuatan produk itu sendiri dapat dilakukan dengan cara apa pun, tetapi pada akhir permintaan ini Anda harus menetapkan array produk ke variabel produk.  Bagaimana cara mendengarkan perubahan?  Ini dilakukan dengan menggunakan parameter kunci <code>@ObservedObject</code> : </p><br><pre> <code class="swift hljs">@<span class="hljs-type"><span class="hljs-type">ObservedObject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> productsStore : <span class="hljs-type"><span class="hljs-type">ProductsStore</span></span></code> </pre> <br><p>  Sederhananya, ini adalah sesuatu yang mirip dengan Pusat Pemberitahuan.  Dan agar <code>View</code> Anda menerima pemberitahuan ini, Anda harus memiliki variabel objek ini dengan atribut <code>@ObservedObject</code> . </p><br><p>  Mari kita kembali ke logika kelas <code>ProductsStore</code> .  Tujuan utamanya adalah untuk mengunduh dan menyimpan daftar produk.  Tetapi berbagai produk sudah tersimpan di <code>IAPManager</code> , terjadi duplikasi.  Ini tidak baik, tetapi, pertama, dalam artikel ini saya ingin menunjukkan kepada Anda bagaimana binning objek diimplementasikan, dan, kedua, tidak selalu mungkin untuk mengubah kelas selesai dari manajer pembelian.  Misalnya, jika Anda menggunakan perpustakaan pihak ketiga, Anda tidak akan dapat menambahkan protokol <code>ObservableObject</code> dan mengirim pemberitahuan. </p><br><p>  Perlu dicatat bahwa selain atribut <code>@ObservedObject</code> ada juga atribut <code>@State</code> , yang membantu melacak perubahan dalam variabel sederhana (misalnya, <code>String</code> atau <code>Int</code> ) dan <code>@EnvironmentObject</code> yang lebih global, yang dapat memperbarui semua <code>View</code> dalam aplikasi sekaligus tanpa harus melewati variabel antara objek. </p><br><p>  Mari <code>ContentView</code> layar awal <code>ContentView</code> : </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContentView</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class"> </span></span>{ @<span class="hljs-type"><span class="hljs-type">ObservedObject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> productsStore : <span class="hljs-type"><span class="hljs-type">ProductsStore</span></span> @<span class="hljs-type"><span class="hljs-type">State</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> show_modal = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body: some <span class="hljs-type"><span class="hljs-type">View</span></span> { <span class="hljs-type"><span class="hljs-type">VStack</span></span>() { <span class="hljs-type"><span class="hljs-type">ForEach</span></span> (productsStore.products, id: \.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { prod <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-type"><span class="hljs-type">Text</span></span>(prod.subscriptionStatus()).lineLimit(<span class="hljs-literal"><span class="hljs-literal">nil</span></span>).frame(height: <span class="hljs-number"><span class="hljs-number">80</span></span>) } <span class="hljs-type"><span class="hljs-type">Button</span></span>(action: { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Button Pushed"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.show_modal = <span class="hljs-literal"><span class="hljs-literal">true</span></span> }) { <span class="hljs-type"><span class="hljs-type">Text</span></span>(<span class="hljs-string"><span class="hljs-string">"Present"</span></span>) }.sheet(isPresented: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.$show_modal) { <span class="hljs-type"><span class="hljs-type">PurchaseView</span></span>() } } } }</code> </pre> <br><p>  Mari kita cari tahu kodenya.  Menggunakan <code>ForEach</code> kami membuat <code>View</code> tekstual, yang jumlahnya sama dengan jumlah produk.  Karena kami mengikat variabel <code>productsStore</code> , tampilan akan diperbarui setiap kali array produk di kelas <code>ProductsStore</code> berubah. </p><br><p>  Metode <code>subscriptionStatus</code> adalah bagian dari <code>SKProduct</code> kelas <code>SKProduct</code> dan mengembalikan teks yang diinginkan tergantung pada tanggal berakhirnya berlangganan: </p><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subscriptionStatus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">String</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> expDate = <span class="hljs-type"><span class="hljs-type">IAPManager</span></span>.shared.expirationDateFor(productIdentifier) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> formatter = <span class="hljs-type"><span class="hljs-type">DateFormatter</span></span>() formatter.dateStyle = .medium formatter.timeStyle = .medium <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dateString = formatter.string(from: expDate) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-type"><span class="hljs-type">Date</span></span>() &gt; expDate { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Subscription expired: \(localizedTitle) at: \(dateString)"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Subscription active: \(localizedTitle) until:\(dateString)"</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Subscription not purchased: \(localizedTitle)"</span></span> } }</code> </pre> <br><p><img src="https://habrastorage.org/getpro/habr/post_images/e00/2b1/dd8/e002b1dd8a99f04f4b70891830778068.png" alt="Ini adalah layar mulai kami"><br>  <em>Ini adalah layar mulai kami</em> </p><br><p>  Sekarang, masuklah ke layar berlangganan.  Karena, menurut aturan Apple, layar pembayaran harus memiliki teks panjang tentang kondisi pembelian, sebaiknya menggunakan <code>ScrollView</code> . </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body: some <span class="hljs-type"><span class="hljs-type">View</span></span> { <span class="hljs-type"><span class="hljs-type">ScrollView</span></span> (showsIndicators: <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { <span class="hljs-type"><span class="hljs-type">VStack</span></span> { <span class="hljs-type"><span class="hljs-type">Text</span></span>(<span class="hljs-string"><span class="hljs-string">"Get Premium Membership"</span></span>).font(.title) <span class="hljs-type"><span class="hljs-type">Text</span></span>(<span class="hljs-string"><span class="hljs-string">"Choose one of the packages above"</span></span>).font(.subheadline) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.purchaseButtons() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.aboutText() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.helperButtons() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.termsText().frame(width: <span class="hljs-type"><span class="hljs-type">UIScreen</span></span>.main.bounds.size.width) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.dismissButton() }.frame(width : <span class="hljs-type"><span class="hljs-type">UIScreen</span></span>.main.bounds.size.width) }.disabled(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.isDisabled) }</code> </pre> <br><p>  Dalam contoh ini, kami membuat dua tampilan teks dengan font yang berbeda.  Selanjutnya, semua pandangan lain disorot dalam metode mereka sendiri.  Ini dilakukan karena tiga alasan: </p><br><ol><li><p>  Kode menjadi lebih mudah dibaca dan dimengerti untuk dipelajari. </p><br></li><li><p>  Pada saat penulisan ini, Xcode 11 Beta sering membeku dan tidak dapat mengkompilasi kode, dan menempatkan bagian-bagian kode ke dalam fungsi membantu kompiler. </p><br></li><li><p>  Tunjukkan bahwa tampilan dapat dibuat menjadi fungsi yang terpisah, membuat <code>body</code> lebih mudah. </p><br></li></ol><br><p>  Pertimbangkan metode <code>purchaseButtons()</code> : </p><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">purchaseButtons</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; some <span class="hljs-type"><span class="hljs-type">View</span></span> { <span class="hljs-comment"><span class="hljs-comment">// remake to ScrollView if has more than 2 products because they won't fit on screen. HStack { Spacer() ForEach(ProductsStore.shared.products, id: \.self) { prod in PurchaseButton(block: { self.purchaseProduct(skproduct: prod) }, product: prod).disabled(IAPManager.shared.isActive(product: prod)) } Spacer() } }</span></span></code> </pre> <br><p>  Di sini kita membuat tumpukan horisontal dan dalam loop <code>ForEach</code> kita membuat <code>PurchaseButton</code> kustom, di mana kita mentransfer produk dan blok panggilan balik. </p><br><p>  <code>PurchaseButton</code> Kelas <code>PurchaseButton</code> : </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PurchaseButton</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> block : <span class="hljs-type"><span class="hljs-type">SuccessBlock!</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> product : <span class="hljs-type"><span class="hljs-type">SKProduct!</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body: some <span class="hljs-type"><span class="hljs-type">View</span></span> { <span class="hljs-type"><span class="hljs-type">Button</span></span>(action: { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.block() }) { <span class="hljs-type"><span class="hljs-type">Text</span></span>(product.localizedPrice()).lineLimit(<span class="hljs-literal"><span class="hljs-literal">nil</span></span>).multilineTextAlignment(.center).font(.subheadline) }.padding().frame(height: <span class="hljs-number"><span class="hljs-number">50</span></span>).scaledToFill().border(<span class="hljs-type"><span class="hljs-type">Color</span></span>.blue, width: <span class="hljs-number"><span class="hljs-number">1</span></span>) } }</code> </pre> <br><p>  Ini adalah tombol normal yang menyimpan dan memanggil blok yang dilewati saat membuat objek.  Stroke pembulatan diterapkan untuk itu.  Kami menampilkan harga produk dan durasi periode berlangganan sebagai teks dalam metode <code>localizedPrice()</code> . </p><br><p>  Pembelian berlangganan dilakukan sebagai berikut: </p><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">purchaseProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(skproduct : SKProduct)</span></span></span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"did tap purchase product: \(skproduct.productIdentifier)"</span></span>) isDisabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-type"><span class="hljs-type">IAPManager</span></span>.shared.purchaseProduct(product: skproduct, success: { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.isDisabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-type"><span class="hljs-type">ProductsStore</span></span>.shared.handleUpdateStore() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.dismiss() }) { (error) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.isDisabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-type"><span class="hljs-type">ProductsStore</span></span>.shared.handleUpdateStore() } }</code> </pre> <br><p>  Seperti yang Anda lihat, setelah pembelian <code>handleUpdateStore</code> , metode <code>handleUpdateStore</code> , yang dengannya pemberitahuan dikirim untuk memperbarui <code>ContentView</code> .  Ini untuk memastikan bahwa <code>ContentView</code> status langganan ketika menyembunyikan layar modal.  Metode <code>dismiss</code> menyembunyikan jendela modal. </p><br><p>  Karena SwiftUI adalah kerangka kerja deklaratif, menyembunyikan jendela modal tidak dilaksanakan seperti biasa.  Kita harus memanggil metode <code>@Environment</code> <code>dismiss()</code> pada pembungkus variabel <code>presentationMode</code> , mendeklarasikannya dengan atribut <code>@Environment</code> : </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PurchaseView</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class"> </span></span>{ @<span class="hljs-type"><span class="hljs-type">State</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isDisabled : <span class="hljs-type"><span class="hljs-type">Bool</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span> @<span class="hljs-type"><span class="hljs-type">Environment</span></span>(\.presentationMode) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> presentationMode <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dismiss</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.presentationMode.wrappedValue.dismiss() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dismissButton</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; some <span class="hljs-type"><span class="hljs-type">View</span></span> { <span class="hljs-type"><span class="hljs-type">Button</span></span>(action: { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.dismiss() }) { <span class="hljs-type"><span class="hljs-type">Text</span></span>(<span class="hljs-string"><span class="hljs-string">"Not now"</span></span>).font(.footnote) }.padding() } ...</code> </pre> <br><p>  Variabel <code>presentationMode</code> adalah bagian dari <em>Nilai Lingkungan</em> - set khusus metode dan properti global.  Di SwiftUI, hampir semua tindakan terjadi ketika mengubah nilai variabel, Anda tidak dapat melakukan apa pun dalam runtime dalam arti kata sebenarnya - semuanya terikat terlebih dahulu.  Dan untuk melakukan sesuatu saat runtime, Anda harus menggunakan pembungkus. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9a5/0c8/e43/9a50c8e4315f98f4e75cabae81665c19.png" alt="Layar pembelian berlangganan"><br>  <em>Layar pembelian berlangganan</em> </p><br><h2 id="zaklyuchenie">  Kesimpulan </h2><br><p>  Semoga artikel ini bermanfaat bagi Anda.  Apple suka ketika pengembang menggunakan teknologi terbaru.  Jika Anda merilis aplikasi untuk iOS 13 menggunakan SwiftUI, ada kemungkinan kemungkinan menjadi Apple yang terkenal.  Jadi jangan takut dengan teknologi baru - gunakan saja.  Anda dapat mengunduh kode proyek lengkap di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . </p><br><blockquote>  Ingin menerapkan langganan di aplikasi iOS Anda dalam 10 menit?  Integrasikan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Apphud</a> dan: <br><ul><li>  Lakukan pembelian hanya menggunakan satu metode; </li><li>  secara otomatis melacak status langganan setiap pengguna; </li><li>  Integrasikan Penawaran Langganan dengan mudah </li><li>  kirim acara berlangganan ke Amplitude, Mixpanel, Slack dan Telegram dengan mempertimbangkan mata uang lokal pengguna; </li><li>  mengurangi tingkat Churn dalam aplikasi dan mengembalikan pengguna yang tidak berlangganan. </li></ul><br></blockquote><br><h2 id="chto-pochitat">  Apa yang harus dibaca? </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Panduan untuk Menerapkan Langganan yang Dapat Diperbarui Secara Otomatis di Aplikasi iOS</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Semua yang ingin Anda ketahui tentang SwiftUI tetapi takut untuk bertanya</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Panduan Pemberitahuan Langganan Apple untuk iOS.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Apakah mereka benar-benar baik?</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id458116/">https://habr.com/ru/post/id458116/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id458104/index.html">RDMA di dalam pusat data dalam implementasi Huawei</a></li>
<li><a href="../id458106/index.html">Menyelam di Jetpack Compose</a></li>
<li><a href="../id458108/index.html">Redirect: 301, 302, 307 | Panduan cara-301</a></li>
<li><a href="../id458110/index.html">Pemrograman dinamis di dunia nyata: pemotongan jahitan</a></li>
<li><a href="../id458114/index.html">Membangun jaringan hukum global untuk sumber terbuka</a></li>
<li><a href="../id458118/index.html">Bereaksi Panduan Asli untuk Pengembang Android Pemula (dengan aplikasi contoh)</a></li>
<li><a href="../id458120/index.html">Habr Weekly # 7 / Neural network strips people, Airbnb mewah, pada ujian akan diizinkan untuk google, di Google Play banyak pemalsuan</a></li>
<li><a href="../id458122/index.html">Sejarah modernisasi satu pusat data: hampir setengah dari pengurangan PUE dan keuntungan lain dari solusi modern</a></li>
<li><a href="../id458124/index.html">Jejak Rusia di Saga Skandinavia Game</a></li>
<li><a href="../id458130/index.html">“Kata Ajaib” untuk pengusaha - pengalaman IIBS NITU “MISiS”</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>