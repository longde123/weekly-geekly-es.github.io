<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçü§ù‚Äçüë©üèª üßë üåú PUEDE o no PUEDE? ¬øO por qu√© necesito una red de microcontroladores? ‚ôäÔ∏è üßñüèº üõ¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tuve que hacerme esta pregunta hace unos diez a√±os o m√°s. El trabajo que deb√≠a hacerse era dar una segunda vida a la sala de control. Esto es as√≠ en t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PUEDE o no PUEDE? ¬øO por qu√© necesito una red de microcontroladores?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455620/"><p>  Tuve que hacerme esta pregunta hace unos diez a√±os o m√°s.  El trabajo que deb√≠a hacerse era dar una segunda vida a la sala de control.  Esto es as√≠ en toda la pared, que consiste en bombillas e interruptores con interruptores.  Creo que no me equivocar√© al suponer que los escudos han estado funcionando desde la aparici√≥n de las bombillas, ya que los interruptores para ese momento probablemente ya se conoc√≠an.  Y el ansia de belleza, en general, lleg√≥ a personas de la antig√ºedad lejana. </p><br><p>  Ahora muchos preferir√°n los paneles de visualizaci√≥n a los escudos.  Pero si habr√° una mayor√≠a de fan√°ticos de las pantallas depende de muchas cosas desconocidas para nosotros.  Pero ahora no se trata de eso. </p><br><p>  Todos los que puedan hablar sobre el cableado el√©ctrico durante cinco minutos me dir√°n de inmediato que el escudo consiste en paneles planos en los que se colocan interruptores y bombillas, as√≠ como una caja con muchos cables.  Despu√©s de todo, una bombilla sin cables solo es adecuada para romperla est√∫pidamente o, si vienes creativamente y enciendes tu imaginaci√≥n, col√≥cala en la boca con la mayor curiosidad y descubre r√°pidamente d√≥nde est√° la sala de emergencias. </p><a name="habracut"></a><br><p>  Eso fue todo, un mont√≥n de cables dejando la caja a los interruptores y bombillas, solo que las bombillas eran peque√±as.  Al parecer, la nieta de la famosa bombilla Ilich. </p><br><p>  Y ahora, recuerdo, miraba por la ventana, y all√≠ est√° el siglo XXI.  Por lo tanto, es necesario hacer todo de nuevo y de manera diferente.  En lugar de bombillas: LED econ√≥micos.  En lugar de cables - cableado.  En lugar de un caj√≥n, muchos, muchos cajones peque√±os, controladores, por lo tanto. </p><br><p>  Result√≥ que si cada controlador puede dar servicio a cuatro LED y dos interruptores, entonces esto se ver√° √≥ptimo.  Quiero decir, no tan aterrador.  Y si el bus de alimentaci√≥n y el bus de informaci√≥n pasan a trav√©s de todos los controladores, solo hay cuatro cables, entonces aparecer√° una cierta gracia.  Tambi√©n result√≥ que los controladores necesitar√≠an 104 piezas.  De una manera amigable, aqu√≠ ser√≠a necesario plantear y resolver el problema del vendedor ambulante.  Y luego, tal vez, los controladores habr√≠an gastado menos.  Pero no estaba a la altura. </p><br><p>  En ese momento ya sab√≠a qu√© es CAN y el nivel de mi respeto por Bosch era mucho mayor que el de un chef de restaurante decente o una ama de casa ordenada.  Y los fabricantes de autom√≥viles BMW, estoy seguro, incluso fueron a visitar a los ingenieros de Bosch. </p><br><p>  La Red de √Årea de Controladores, como dir√≠an los extranjeros, en mi opini√≥n, como soluci√≥n t√©cnica, surgi√≥ del deseo de hacer algo, finalmente, bien.  No me esconder√©, no sentir√°s todos los encantos de los resultados del trabajo de los ingenieros de inmediato cuando domines dos vol√∫menes del est√°ndar, pero mucho despu√©s.  Cuando hable con testigos presenciales, entreviste a testigos.  Ahora hay m√°s vol√∫menes, pero quiz√°s pueda comenzar inmediatamente desde el tercero, porque ahora se llama CAN_FD.  Sin embargo, d√©jame continuar. </p><br><p>  Incluso antes de la colisi√≥n con el escudo, tuve que enfrentar las decisiones de ingenier√≠a de otras personas sobre el uso de CAN, as√≠ como tambi√©n cometer mis errores.  Los errores generalmente aparecen entre leer las instrucciones y estudiar las descripciones.  Bueno, eso solo la segunda vez se ven como un rastrillo. </p><br><p>  Ahora unos pocos miles de palabras para el lector, que es tolerante con los nerds y no los considera enemigos. </p><br><p>  CAN se puede instalar donde RS485 trabaj√≥ anteriormente en un cable de par trenzado.  El par trenzado no es una condici√≥n indispensable, es simplemente conveniente compararlo.  Usando un cable de par trenzado, a trav√©s de CAN, as√≠ como a trav√©s de RS485, puede enviar mensajes desde el controlador de control al esclavo y recibir una respuesta.  La similitud es sorprendente, pero centr√©monos mejor en las diferencias.  Algunas de las diferencias pueden llevar un signo menos para algunos de los lectores.  Pero les aconsejar√≠a que no se molesten, sino que recuerden la ley de Lomonosov. </p><br><p>  Gracias a la organizaci√≥n sincr√≥nica del protocolo, la resoluci√≥n de colisi√≥n en el bus se implementa en hardware, sobre la marcha, por as√≠ decirlo.  A continuaci√≥n se indica a qu√© conduce esto y qu√© le da al ingeniero inquieto. </p><br><p>  Puede recibir un mensaje sin una solicitud. <br>  No es necesario esperar hasta que la respuesta est√© lista, puede preguntarle a alguien m√°s en este momento. <br>  El controlador esclavo tambi√©n puede preguntar y obtener una respuesta. <br>  Debido a la operaci√≥n sincr√≥nica, la longitud del bus CAN es inversamente proporcional a la velocidad de transmisi√≥n o algo as√≠. <br>  La velocidad m√°xima es de 1 MBaud (10 - en camino). <br>  El remitente sabe que el mensaje no se ha distorsionado durante la transmisi√≥n inmediatamente despu√©s del √∫ltimo bit.  M√°s precisamente, todos en el autob√∫s lo saben. <br>  Si el mensaje est√° distorsionado para uno, no todos cuentan el intento. <br>  Si el mensaje se envi√≥ al bus, el suscriptor no lo recibir√° solo a condici√≥n de que est√© roto. <br>  El n√∫mero de controladores en el bus no debe exceder 127. </p><br><p>  Los mensajes tienen una longitud limitada.  Consisten en un identificador, un indicador de longitud en bytes y un bloque de datos, con exactamente tantos bytes como se indica.  Hay algunos bits m√°s de servicio, pero guardemos silencio sobre ellos, ya que el servicio debe ser discreto.  El identificador puede tener un tama√±o de 11 o 29 bits.  Un bloque de datos puede contener de 0 a 8 bytes (64 - en el camino). </p><br><p>  Para detalles, dar√© algunos n√∫meros.  Si desea trabajar a una velocidad de 1Mbaudio, entonces la longitud del bus no debe ser superior a 35 metros (algunos prefieren 40, es decir, m√°s caliente).  Si necesita transmitir algo a una distancia de 8 km, la velocidad no debe exceder los 5 kbaud.  Por cierto, el lector tiene derecho a preguntar por qu√© kilobod y no kilobit.  Porque no todos los baudios se convierten en bits.  Algo asi. </p><br><p>  ¬øC√≥mo puedo deshacerme de todos estos ingredientes de alto secreto?  Aquellos que ven el juego de dados en todo recordar√°n de inmediato que hay algo tan maravilloso como CANopen y muchas m√°s combinaciones y abreviaturas hermosas y que no hay nada para reinventar la rueda.  Entonces, a menudo quiero responder: ‚Äú¬øNo se parece a una bicicleta ese huevo frito de dos huevos, que muchos cocinan para el desayuno?  ¬øPor qu√© no ir a un servicio de comida y tomar una tortilla?  Pero es mejor que me quede callado y contin√∫e sin distraerme con los gritos de la audiencia. </p><br><p>  En aquellos d√≠as, cuando a√∫n no se hab√≠an inventado identificadores de 29 bits, solo hab√≠a 11 bits.  Algunos comenzaron a usarlo para meter el nombre (n√∫mero) del tipo de datos deseado all√≠.  Otros se utilizan como la direcci√≥n del controlador al que se accede.  Ambos ten√≠an sentido.  Por ejemplo, puede preguntar esto: </p><br><ul><li>  Y danos, querida, un castillo del a√±o trece en un litro de papel. </li></ul><br><p>  M√°s o menos: </p><br><ul><li><p>  Envu√©lveme, por favor, lo que est√° escondido en tu estante inferior a la derecha. <br>  Por cierto, en CAN este dise√±o tambi√©n puede funcionar: </p><br></li><li><p>  ¬°Mienten a todos!  Y r√°pidamente pones todo de los estantes en mi bolso. <br>  Pero este dise√±o a menudo no se usa, porque despu√©s hay que esperar un tiempo. <br>  Espere hasta que todas las respuestas est√©n alineadas una por una y disponibles para el controlador solicitante.  Ya hemos dejado la pel√≠cula, si eso. <br>  En mi caso, estar√≠a contento con la variante del identificador como direcci√≥n.  De los 11 bits, se requer√≠an 7, y quedaban 4 m√°s para hacer que algunos mensajes sean m√°s urgentes que otros, as√≠ como marcar algunos de los controladores como los principales. <br>  Algunos inconvenientes migraron aqu√≠ desde RS485, a saber, las direcciones ten√≠an que establecerse manualmente en cada controlador.  Luego verifique y reinstale.  Y quiz√°s regrese al paso anterior y repita. <br>  Afortunadamente, para entonces ya exist√≠an dos circunstancias. </p><br></li></ul><br><p>  Primero, ya apareci√≥ un identificador de 29 bits.  Y la segunda es que muchos fabricantes de microcontroladores comenzaron a considerar la condici√≥n de que cada chip tiene su propio n√∫mero √∫nico y bastante largo como una buena forma. </p><br><p>  Ahora, en un identificador largo, 24 bits podr√≠an asignarse de forma segura para una direcci√≥n √∫nica.  Quedaron otros 5, para garantizar que los trenes difer√≠an en urgencia, direcci√≥n (all√≠, de regreso), la presencia de un vag√≥n restaurante y vagones con mayor comodidad. </p><br><p>  Si deja de perder el tiempo y se pone serio, llame a los agentes de los controladores subordinados y al resto de los jefes, entonces puede crear una tabla.  Ella se mostrar√° un poco m√°s tarde. </p><br><p>  Un poco m√°s sobre abordar.  Un n√∫mero de chip √∫nico, como regla, ocupa una cantidad de bits muy superior a 24, por ejemplo, 96 con STM32FXXX.  Por lo tanto, de alguna manera necesita obtener 24 de 96. Eleg√≠ la operaci√≥n XOR.  Puede elegir otra cosa, pero quedar√° un peque√±o problema.  Estas son coincidencias de direcci√≥n despu√©s de la reducci√≥n. </p><br><p>  La probabilidad de este problema es extremadamente peque√±a, pero lo es.  Es solucionable, pero agrega trabajo a los instaladores.  Aqu√≠ debe recordarse que los mensajes CAN pueden no contener datos en absoluto.  Esto es √∫til para nosotros al decidir.  Consiste en las siguientes acciones. </p><br><p>  El controlador de control (jefe) env√≠a una solicitud de difusi√≥n a la que todos los agentes deben responder (esta es una solicitud con una direcci√≥n cero).  Los mensajes de respuesta con longitud de datos cero y direcciones coincidentes no se estropear√°n entre s√≠, sino que llegar√°n al jefe en forma de uno. </p><br><p>  Ahora queda por calcular cu√°ntas respuestas se han recibido y cu√°ntas deber√≠an ser.  Si estos dos n√∫meros coinciden, entonces todo est√° en orden.  Si hay menos respuestas que los controladores, entonces hay una coincidencia de direcciones y hay trabajo para los ajustadores.  Y si hay m√°s respuestas que controladores, entonces debe pensar en una disertaci√≥n, porque est√° al borde del descubrimiento. </p><br><p>  Si el cambio en la longitud del mensaje se considera una variaci√≥n de su significado, entonces puede obtener caracter√≠sticas adicionales, de las que hablar√© m√°s adelante si mi madre no llama para comer. </p><br><p>  Otro punto interesante es que si usa identificadores cortos y largos al mismo tiempo, puede obtener, por ejemplo, direcciones de grupo o solicitudes de difusi√≥n parcial.  Pero a√∫n no profundizaremos. </p><br><p>  Volvamos a la codificaci√≥n del identificador. </p><br><p>  Para fines de direccionamiento, se asignan 24 bits en el identificador extendido y seis en el identificador est√°ndar.  Se transmite una direcci√≥n con un valor de 0x000000 para el identificador extendido.  Para un identificador est√°ndar, tambi√©n se considera que se transmite una direcci√≥n nula (sus 6 bits).  Los cinco bits iniciales (altos) en los identificadores largos y cortos se denominan encabezado, afectan el significado del mensaje y se denotan con las letras NVADR: </p><br><p><img src="https://habrastorage.org/webt/5a/ir/yt/5airytjd4ojg3bn15xhoh9qo5jw.jpeg"></p><br><p>  Por supuesto, para el panel de control, era necesario implementar solo una parte de este esquema.  En el primer proyecto con un escudo (o en el escudo, ¬øc√≥mo?), Se usaron chips Cortex de NXP, y en los siguientes proyectos (hab√≠a algunos) M0 de STMicroelectronics ya se usaron. </p><br><p>  Algunas palabras sobre el uso de identificadores cortos.  Esos seis bits que se asignan para el direccionamiento no se dirigen al controlador, sino al grupo.  Al principio, este grupo tiene cero para todos.  A continuaci√≥n, se configuran los agentes, despu√©s de lo cual algunos o todos se convierten en miembros de su grupo.  Ahora una solicitud al grupo, obtenemos las respuestas de los agentes que hemos recopilado en este grupo. </p><br><p>  Ahora, un poco sobre lo que se agrega si interpreta mensajes con diferentes longitudes de datos de manera diferente.  Por ejemplo, una consulta de longitud cero ayuda mucho al depurar, como se mencion√≥ anteriormente.  Una solicitud con una longitud de 3 sirve el espacio variable de 16384 bytes. Una solicitud con una longitud de 4 hace lo mismo, pero est√° destinada a un agente de puerta de enlace que sirve un bus CAN de segundo nivel.  Este autob√∫s puede estar compuesto por uno o dos agentes, pero a un par de kil√≥metros de distancia. </p><br><p>  Del mismo modo, las consultas con longitudes de 5 y 6 est√°n destinadas a un espacio de variables de dos bytes de tama√±o 4194304. No se utilizan dos bits para el direccionamiento.  Un bit controla la escritura-lectura.  Otro se√±ala un error. </p><br><p>  A continuaci√≥n, 7 y 8 sirven palabras de cuatro bytes.  Tambi√©n hay 4.194.304. </p><br><p>  Estos espacios son comunes a todos los agentes.  Cada uno de ellos, dependiendo del prop√≥sito, usa solo un segmento del espacio de variables.  El controlador para medir la temperatura en dos puntos se muestra en la foto.  Esto es para depurar y probar. </p><br><p><img src="https://habrastorage.org/webt/eq/tc/8z/eqtc8z-q-gmhha4cyzqqceqdtjc.jpeg"></p><br><p>  Los controladores est√°n conectados con un cable plano para 6 n√∫cleos.  Dual se utilizan para la alimentaci√≥n.  El chip de veinte pies es el STM32F042. </p><br><p>  En el reverso est√° el MAX3051, un controlador CAN en el paquete SOT23-8. <br>  Bueno, mam√° llama para comer. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/455620/">https://habr.com/ru/post/455620/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../455610/index.html">El legendario Intel Core i7-2600K: prueba de Sandy Bridge en 2019 (parte 1)</a></li>
<li><a href="../455612/index.html">Pensamos a trav√©s de los personajes de los juegos y los di√°logos siguiendo los consejos de los escritores y el ejemplo de los partidarios de la teor√≠a de una Tierra plana.</a></li>
<li><a href="../455614/index.html">FFI: escribir en Rust en un programa PHP</a></li>
<li><a href="../455616/index.html">¬øPor qu√© ir a "Programaci√≥n industrial" en el HSE de San Petersburgo?</a></li>
<li><a href="../455618/index.html">DevOps LEGO: c√≥mo dise√±amos una tuber√≠a en cubos</a></li>
<li><a href="../455622/index.html">El legendario Intel Core i7-2600K: prueba de Sandy Bridge en 2019 (parte 2)</a></li>
<li><a href="../455624/index.html">Hiper bajas y lo que los dise√±adores de juegos pueden aprender de ellas</a></li>
<li><a href="../455626/index.html">Wallarm Offzone2019 HackQuest</a></li>
<li><a href="../455630/index.html">Eventos digitales en Mosc√∫ del 11 al 16 de junio.</a></li>
<li><a href="../455632/index.html">Atencion Error peligroso en la implementaci√≥n de C ++ std :: map :: merge y std :: set :: merge en Visual Studio 2017</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>