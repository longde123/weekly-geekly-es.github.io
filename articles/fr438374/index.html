<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚ÄçüöÄ ‚§¥Ô∏è üë®‚Äçüë©‚Äçüë¶ Comment charger OpenStreetMap dans Hive? üí± ‚öîÔ∏è üõÄüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans un article pr√©c√©dent, j'ai examin√© le g√©ocodage invers√© √† l'aide de Spark. Imaginez maintenant que nous avons √©t√© confront√©s au d√©fi du g√©ocodage...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment charger OpenStreetMap dans Hive?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438374/">  Dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article pr√©c√©dent,</a> j'ai examin√© le g√©ocodage invers√© √† l'aide de Spark.  Imaginez maintenant que nous avons √©t√© confront√©s au d√©fi du g√©ocodage direct des adresses e-mail.  Autrement dit, recevoir pour l'adresse enregistr√©e par le texte de certaines coordonn√©es g√©ographiques. <br><br>  Les adresses pour la pr√©cision sont russes, et plus important encore - elles sont souvent √©crites de mani√®re tordue, c'est-√†-dire avec des erreurs, des ambigu√Øt√©s et d'autres d√©lices.  Et ces adresses se trouvent dans la base de donn√©es Hive, sur le cluster Hadoop. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vc/8n/_s/vc8n_sp2pkut9qvilbnt6u2whqs.png"></div><br>  Eh bien, il semblerait - nous prenons l'API Google Maps Geocoding (ou, si vous √™tes partisan de la substitution des importations, alors l'API Yandex Maps), et nous travaillons.  Mais ici, comme pour le g√©ocodage invers√©, nous attendons une petite embuscade. <br><a name="habracut"></a><br>  Ou gros, c'est comme un regard.  Le fait est que cette fois, nous devons traiter environ 5 millions d'adresses.  Et peut-√™tre 50 - ce n'√©tait pas imm√©diatement clair.  Comme vous le savez, Google bannira votre IP apr√®s environ 10 000 adresses, Yandex fera de m√™me avec vous, bien que ce soit possible un peu plus tard (25 000 demandes par jour, par exemple).  Et d'ailleurs, les deux API sont REST, ce qui signifie qu'il est relativement lent.  Et m√™me si vous achetez un abonnement payant, sa vitesse n'augmentera pas d'un sou. <br><br>  Et pourtant - nous avons manqu√© d'anecdote de munitions. <br><br>  J'ai oubli√© la chose la plus importante - notre cluster Hadoop est situ√© sur l'intranet, et Google Maps, pour l'entreprise avec Yandex Maps et tout le monde, nous sont g√©n√©ralement inaccessibles depuis le cluster.  Autrement dit, nous avions besoin d'une solution autonome. <br><br>  Je dirai tout de suite - vous ne trouverez pas de solution toute faite ici.  Je ne d√©crirai que l'approche que nous pr√©voyons d'appliquer, et de mani√®re un peu plus d√©taill√©e - l'une des √©tapes d'un long chemin vers une solution. <br><br>  Bien s√ªr, nous avions quelque chose en r√©serve.  Il y avait un serveur ArcGIS interne que j'ai d√©j√† mentionn√©.  Nous n'√©tions pas autoris√©s √† les diriger, mais nous √©tions autoris√©s √† utiliser ses services REST. <br><br>  La premi√®re chose que nous avons faite a √©t√© de le visser √† la t√¢che.  Il ne nous a pas bannis, mais a simplement parfois d√©sactiv√© pour l'entretien.  Et ce qui est bien - il y avait un mode de g√©ocodage par lots, lorsque vous soumettez un paquet d'adresses √† l'entr√©e (apr√®s avoir configur√© le serveur, la taille du paquet √©tait de 1000 pi√®ces, par d√©faut, il semble que quelque chose soit un ordre de grandeur ou deux de moins).  Tout cela n'a pas √©t√© facile non plus, et nous, et le support d'ArcGIS, avons √©t√© engag√©s dans une lutte de sumo avec le serveur pendant longtemps, mais c'est une autre histoire. <br><br>  Apr√®s toutes les astuces et rebondissements, nous avons pu traiter nos cinq millions en une journ√©e environ.  Il fallait avancer et essayer encore d'acc√©l√©rer. <br><br>  Dans le m√™me temps, il est devenu clair que tout g√©ocodeur avec REST ne nous convient probablement pas.  De plus, nous avons examin√© Nominatim, Pelias, Photon et gisgraphy, et en g√©n√©ral nous n'en √©tions pas satisfaits.  La qualit√© et les performances (ou les deux) √©taient loin d'√™tre id√©ales. <br><br>  Par exemple, personne ne sait g√©ocoder les packages (et cela acc√©l√®re consid√©rablement le travail avec ArcGIS). <br><br>  Ou qualit√© - rendez-vous sur le serveur de d√©monstration gisgraphy.com et essayez de trouver Moscou.  Vous recevrez une douzaine de r√©ponses, notamment: Moscou (une ville de la F√©d√©ration de Russie), Kansas City (une ville des √âtats-Unis), Khimki, Kaluga, Vykhino-Zhulebino et bien d'autres objets que je ne voudrais pas voir dans la r√©ponse du g√©ocodeur quand recherchez Moscou. <br><br>  Eh bien, le dernier probl√®me (mais pas important pour nous) est que loin de tous les g√©ocodeurs, l'API est aussi bien pens√©e que, disons, Google Maps.  Disons que l'API ArcGIS est d√©j√† beaucoup plus g√™nant, et le reste est pour la plupart encore pire.  Si vous g√©ocodez des adresses pour l'interface utilisateur, en r√®gle g√©n√©rale, une personne s'engage √† choisir la meilleure option.  Et il le fait mieux que le programme.  Et dans le cas du g√©ocodage de masse, comme nous l'avons fait, l'√©valuation de la qualit√© du r√©sultat pour une adresse particuli√®re est l'un des √©l√©ments importants du succ√®s. <br><br>  Par cons√©quent, des options comme ¬´D√©veloppez votre propre Nominatim¬ª, par exemple, ont √©galement disparu. <br><br><h2>  Que faire? </h2><br>  Une solution assez √©vidente √©tait la suivante: √©tant donn√© que les adresses ne proviennent de nulle part et ne disparaissent nulle part, les maisons ne sont pas construites tous les jours et les rues ne sont pas construites, il vous suffit d'ajouter une base de donn√©es d'adresses officiellement existantes √† notre processus.  Mieux imm√©diatement avec les coordonn√©es, et si cela ne se produit pas, g√©ocodez-le une fois.  Dans ce cas, il nous suffira de mettre √† jour notre base avec la m√™me fr√©quence d'apparition de nouvelles maisons ou rues, c'est-√†-dire pas souvent. <br><br>  Le premier et principal candidat pour la base d'adresses existantes est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">FIAS</a> .  Attendez une minute, dites-vous, mais la FIAS n'a que quelques millions d'adresses - et vous en avez jusqu'√† 50 millions?  Oui, il n'y a vraiment que quelques millions de <b>foyers</b> .  Et nos 50, c'est 50 millions d'adresses de nos utilisateurs, c'est-√†-dire, ce sont les adresses de personnes, et ils ont soudainement un appartement √† l'adresse.  Cinq millions de maisons de 1 √† 100 appartements, plusieurs personnes vivent dans chaque appartement ... enfin, vous comprenez tout.  Et la deuxi√®me option est l'adresse des bureaux, o√π un centre de bureaux dispose √©galement de centaines de locaux, parfois lou√©s. <br><br>  Dans le m√™me temps, nous n'avons √©videmment pas besoin d'une adresse avec le num√©ro de l'appartement (ou du bureau) - d'une part, ce sont des donn√©es personnelles avec toutes les cons√©quences, et d'autre part, nous ne sommes toujours pas int√©ress√©s par la fa√ßon dont les appartements sont situ√©s dans une maison particuli√®re, et quelles sont leurs coordonn√©es .  Seule une maison est n√©cessaire.  Pour les bureaux, ce n'est pas tout √† fait vrai, mais l'emplacement des bureaux dans un immeuble par √©tages n'est toujours pas d√©termin√© par les coordonn√©es. <br><br>  En fin de compte, ayant une base de, disons, 5 millions de maisons (conditionnellement) existantes, nous pouvons r√©soudre le probl√®me de g√©ocodage de 50 ou 100 millions d'adresses en jetant simplement l'appartement ou le bureau hors de l'adresse et en l'associant √† la base. <br><br>  Et o√π trouver les coordonn√©es des maisons?  Il n'y a qu'une seule source ouverte √©vidente - OpenStreetMap, il y a des maisons l√†-bas, avec des g√©om√©tries, et toutes sortes d'autres attributs comme le nombre d'√©tages ou m√™me la couleur du toit. <br><br>  Apr√®s toutes les discussions, nous avions un plan napol√©onien.  En voici un: <br><br><ul><li>  chargement des donn√©es cartographiques d'OSM dans Hadoop </li><li>  t√©l√©charger des donn√©es FIAS avec des adresses </li><li>  construire une liste d'adresses compl√®tes uniques avec des num√©ros de maison </li><li>  nous le g√©ocodons en recherchant des adresses dans OSM, et ce que nous n'avons pas trouv√© est via ArcGIS </li></ul><br><br>  Nous obtenons la base de maisons avec latitude et longitude.  Profitez-en.  Profiter des avantages.  Boissons bonus (blague). <br><br>  Dans cet article, je vais vous expliquer comment nous avons mis en ≈ìuvre le premier point de ce plan. <br><br><h2>  Qu'est-ce qu'OpenStreetMap </h2><br>  Si vous regardez OSM du point de vue des donn√©es, vous pouvez imaginer les cartes sous la forme de trois tableaux: <br><br><ul><li>  des points </li><li>  lignes (voies) </li><li>  les relations </li></ul><br><br>  Les sch√©mas r√©els de ces donn√©es seront donn√©s ci-dessous. <br><br>  Seuls les points ont des coordonn√©es (latitude et longitude, en degr√©s).  Les lignes sont une s√©quence ordonn√©e de points.  Les relations sont un ensemble de points et de lignes, chacun ayant un <i>r√¥le</i> . <br><br>  Tout le reste, ce sont les soi-disant balises.  C'est, par exemple, un guichet automatique, ou un magasin, ou une entr√©e du m√©tro - il peut s'agir d'un point √©quip√© de la balise amenity = atm, ou shop = vend quelque chose, ou autre chose.  Il existe un r√©pertoire de balises officiellement recommand√©es (pour chaque langue et pays applicable, elles peuvent √™tre partiellement les leurs), et la pratique d'inventer des balises non standard. <br><br>  En plus des balises, chaque √©l√©ment de la carte a un identifiant num√©rique unique, ainsi que certains attributs li√©s √† l'historique - qui a modifi√© quand, modifier le num√©ro, etc. <br><br>  La base de donn√©es avec la carte se pr√©sente sous plusieurs formats: <br>  - pbf est Google Protobuf, un format de s√©rialisation de donn√©es portable. <br>  - xml est √©videmment XML.  Beaucoup plus en volume. <br><br>  Vous devez comprendre que la base de donn√©es est mise √† jour quotidiennement.  Par cons√©quent, les d√©chargements sont complets et incr√©mentiels. <br><br>  Nous avons choisi le PBF comme plus compact. <br><br>  Pour le lire dans Hadoop, il existe une API Java sp√©cialement con√ßue pour OSM appel√©e ce projet d'osmose.  En principe, travailler avec est simple: vous t√©l√©chargez un fichier et parcourez les √©l√©ments de la carte.  Ajoutez les points √† un endroit, les lignes √† un autre, la relation au troisi√®me.  En principe, l'osmose et par exemple Spark suffisent d√©j√† pour t√©l√©charger toutes les donn√©es. <br><br>  Heureusement, dans le processus de mise en ≈ìuvre de mon v√©lo, il m'est apparu en quelque sorte de rechercher sur Internet pour convertir OSM dans les formats accept√©s dans Hadoop - Parquet (parquet) et Avro.  Dans un sens, les deux sont des analogues du PBF, il y avait donc une chance de trouver un convertisseur.  Et il a √©t√© retrouv√©, mais pas un. <br><br><h2>  Rencontrez OSM Parquetizer </h2><br>  Voyez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ce que j'ai trouv√©!</a> <br><br>  Pour les paresseux - en plein dans le readme du projet dans la premi√®re ligne, il est dit: Telenav publie des t√©l√©chargements hebdomadaires de la plan√®te <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√† l'adresse</a> . <br><br>  Pour les gens tr√®s paresseux: pr√©parez-vous √† exp√©dier environ 700 gigaoctets;) Eh bien, si vous avez certainement besoin d'une plan√®te.  Vous pouvez g√©n√©ralement vous d√©brouiller avec, disons, l'Europe. <br><br>  Si vous ne voulez pas charger, le processus ressemble √† ceci: t√©l√©chargez une carte au format PBF, par exemple √† partir d'une <a href="">g√©ofactory</a> .  C'est 2,5 gigaoctets si vous avez besoin de la Russie et 19 si l'Europe.  Pas un peu non plus, mais vous pouvez trouver des √©chantillons plus finement hach√©s.  Ensuite, placez le fichier sur le disque et ex√©cutez le programme: <br><br><pre><code class="plaintext hljs">java -jar ./osm-parquetizer.jar russia-latest.osm.pbf</code> </pre> <br>  Apr√®s quelques minutes voire quelques secondes, selon les performances de votre machine, vous obtenez trois fichiers au format parquet.  Voici √† quoi ressemble l'auteur (il est de Roumanie): <br><br><pre> <code class="plaintext hljs">-rw-r--r-- 1 adrianbona adrianbona 145M Apr 3 19:57 romania-latest.osm.pbf -rw-r--r-- 1 adrianbona adrianbona 372M Apr 3 19:58 romania-latest.osm.pbf.node.parquet -rw-r--r-- 1 adrianbona adrianbona 1.1M Apr 3 19:58 romania-latest.osm.pbf.relation.parquet -rw-r--r-- 1 adrianbona adrianbona 123M Apr 3 19:58 romania-latest.osm.pbf.way.parquet</code> </pre> <br>  Sch√©mas des fichiers .parquet re√ßus: <br><br> <code>node <br> |-- id: long <br> |-- version: integer <br> |-- timestamp: long <br> |-- changeset: long <br> |-- uid: integer <br> |-- user_sid: string <br> |-- tags: array <br> | |-- element: struct <br> | | |-- key: string <br> | | |-- value: string <br> |-- latitude: double <br> |-- longitude: double <br> <br> way <br> |-- id: long <br> |-- version: integer <br> |-- timestamp: long <br> |-- changeset: long <br> |-- uid: integer <br> |-- user_sid: string <br> |-- tags: array <br> | |-- element: struct <br> | | |-- key: string <br> | | |-- value: string <br> |-- nodes: array <br> | |-- element: struct <br> | | |-- index: integer <br> | | |-- nodeId: long <br> <br> relation <br> |-- id: long <br> |-- version: integer <br> |-- timestamp: long <br> |-- changeset: long <br> |-- uid: integer <br> |-- user_sid: string <br> |-- tags: array <br> | |-- element: struct <br> | | |-- key: string <br> | | |-- value: string <br> |-- members: array <br> | |-- element: struct <br> | | |-- id: long <br> | | |-- role: string <br> | | |-- type: string <br></code> <br><br>  Comme vous pouvez le voir, tout est simple ici.  Ensuite, nous faisons ce qui suit: <br><br><ul><li>  nous mettons des fichiers sur le cluster Hadoop avec la commande hdfs dfs -put </li><li>  allons dire dans Hue et cr√©ons un sch√©ma / base, et trois tables pour cela, sur la base des donn√©es ci-dessus </li><li>  ex√©cutez select * dans osm.nodes et profitez du r√©sultat. </li></ul><br>  Une petite nuance: dans notre version de Hive (et peut-√™tre aussi la v√¥tre), il n'est pas en mesure de cr√©er des tables bas√©es sur le sch√©ma de Parquet.  Vous devez soit convertir ce qui pr√©c√®de en CREATE TABLE (ce qui, en g√©n√©ral, n'est pas difficile, et je laisserai cela comme un exercice √† domicile pour les lecteurs), soit faire un peu plus compliqu√©: Spark peut lire le diagramme et les donn√©es √† partir du sol, et cr√©er des tables temporaires sur leur base .  Nous pouvons donc lire les donn√©es dans Spark Shell comme ceci: <br><br><pre> <code class="plaintext hljs">val nodeDF = sqlContext.read.parquet("file:/tmp/osm/romania-latest.osm.pbf.node.parquet") nodeDF.createOrReplaceTempView("nodes")</code> </pre><br>  Ensuite, vous pouvez d√©j√† cr√©er des tables dans Hive en utilisant des n≈ìuds LIKE. <br><br>  Une autre remarque pour les paresseux: l'auteur a un si bel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">exemple</a> , √† partir duquel en g√©n√©ral tout devient clair (enfin, si vous poss√©dez Spark).  Ce n'est bien s√ªr pas Spark Shell, mais le Databricks Notebook, mais il m'a fallu environ 15 minutes pour appuyer sur un clavier pour le traduire en un autre.  Et en 30 √† 40 minutes, il a √©t√© possible de tout convertir en requ√™tes pour Hive en utilisant des analogues l√©g√®rement diff√©rents de l'√©tincelle. <br><br><h3>  Exemple de demande r√©elle </h3><br>  Que pouvons-nous obtenir de cette base de donn√©es dans sa forme actuelle?  En g√©n√©ral, beaucoup.  Si vous avez une ruche ou une √©tincelle, un cadre spatial, une API de g√©om√©trie ou l'une des alternatives, qui sont GeoSpark ou par exemple GeoMesa, vous pouvez r√©soudre de nombreux probl√®mes diff√©rents sur cette base. <br><br>  Voyons un exemple.  La fa√ßon la plus simple de travailler avec des points.  Par exemple, une requ√™te pour obtenir une liste de distributeurs automatiques de billets avec leurs coordonn√©es ressemble √† ceci: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> nodes <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> tags[<span class="hljs-string"><span class="hljs-string">'amenity'</span></span>]=<span class="hljs-string"><span class="hljs-string">'atm'</span></span></code> </pre><br>  Comment construire une telle requ√™te, vous pouvez le deviner en lisant la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">page sur le wiki</a> .  Vous y trouverez ce que sont d'autres balises, et certaines d'entre elles peuvent √™tre incluses dans votre demande au lieu de *, sous la forme de balises ['op√©rateur'], par exemple, pour afficher le nom de la banque. <br><br>  De la m√™me page, il s'ensuit que le balisage ATM est possible sous la forme de balises amenity = bank et atm = yes.  H√©las, de telles ambigu√Øt√©s sont omnipr√©sentes dans OSM. <br><br>  Si vous √™tes un d√©butant et que vous vous familiarisez avec OSM, je recommande fortement de ma√Ætriser (par de bons exemples sur le wiki) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">overpass-turbo</a> .  Il s'agit d'un outil qui vous permet d'effectuer diff√©rents types de recherches sur les donn√©es cartographiques, √† la fois avec des conditions g√©om√©triques et avec des conditions pour les balises. <br><br><h3>  Et o√π sont les adresses? </h3><br>  Bonne question.  Les adresses dans OSM sont des √©l√©ments de carte fournis avec des balises addr: *, c'est-√†-dire  commen√ßant par addr.  Description que vous trouverez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  En principe, sachant tout ce que j'ai dit ci-dessus, vous pouvez d√©j√† r√©diger une demande de travail: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> nodes <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> tags[<span class="hljs-string"><span class="hljs-string">'addr:housenumber'</span></span>]!=<span class="hljs-literal"><span class="hljs-literal">null</span></span></code> </pre><br>  Quels probl√®mes nous attendent ici?  Premi√®rement, les adresses sont plac√©es √† la fois sur des points (par exemple, des entr√©es de b√¢timents) et sur des polygones, c'est-√†-dire  sur les voies.  Nous devons donc au moins dupliquer la demande.  Et deuxi√®mement, sur la page mentionn√©e ci-dessus, le wiki est √©crit en texte clair qu'il n'est pas recommand√© de mettre des balises indiquant la ville, la r√©gion, la r√©gion et le pays, mais cela doit √™tre calcul√© g√©om√©triquement.  Comment faire  En g√©n√©ral, c'est pratiquement la t√¢che du g√©ocodage invers√©, avec de l√©g√®res modifications, et cela a √©t√© d√©crit dans un post pr√©c√©dent. <br><br>  C'est-√†-dire, en g√©n√©ral, vous devez trouver des limites administratives, et pour toutes les adresses qui s'y trouvent, ajoutez l'adresse √† la zone et √† tout ce qui pr√©c√®de.  La fa√ßon dont les limites des entit√©s administratives sont organis√©es est d√©crite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  En g√©n√©ral, cette t√¢che n'est pas trop simple, mais tout √† fait r√©soluble, et elle n'est pas r√©solue par le g√©ocodage, mais en t√©l√©chargeant les mises √† jour OSM dans notre base de donn√©es, dans une atmosph√®re d√©tendue. <br><br><h3>  Que faut-il faire ensuite </h3><br>  En principe, vous pouvez d√©j√† travailler avec les n≈ìuds, les chemins et les tables de relations que nous avons, mais il vaut mieux changer un peu le sch√©ma, le rendant plus adapt√© √† Hive et Spark.  Le fait est que le sch√©ma OSM est compl√®tement normalis√©, les voies et les relations ne contiennent pas du tout de coordonn√©es.  Pour construire un polygone pour le chemin, vous devez vous joindre √† des n≈ìuds.  Je recommanderais de faire cette op√©ration tout de suite, en enregistrant les polygones soit comme un tableau de structures (Hive peut fonctionner avec un tableau de types composites, une carte et une structure), soit imm√©diatement comme une repr√©sentation s√©rialis√©e de la classe Geometry, par exemple.  Comment faire cela est dans l'exemple du parqueteur auteur. <br><br>  Vous pouvez r√©p√©ter une op√©ration similaire au niveau des relations, si vous le souhaitez, mais cela ne vaut pas la peine.  Premi√®rement, vous n'aurez pas toujours besoin de tous les √©l√©ments d'une relation, et deuxi√®mement, les relations elles-m√™mes dans OSM sont beaucoup plus petites. <br><br><h2>  Convertisseur en Avro </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Voici</a> un autre convertisseur, cette fois au format Avro.  Et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici, il est</a> d√©crit o√π obtenir les fichiers finis.  Je n'ai pas mesur√© les tailles, mais je pense qu'environ 15-20 fichiers par plan√®te devraient √™tre comparables √† PBF.  Autrement dit, ce sont des gigaoctets, et beaucoup. <br><br><h2>  Quelques conclusions </h2><br>  Et o√π est le g√©ocodage, demandez-vous?  Oui, le t√©l√©chargement de cartes et l'extraction d'adresses ne sont qu'une partie de la t√¢che globale.  J'esp√®re qu'il en sera ainsi. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr438374/">https://habr.com/ru/post/fr438374/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr438364/index.html">R√©plication du premier brouilleur vocal num√©rique au monde</a></li>
<li><a href="../fr438366/index.html">Encore un autre examen de la fonctionnalit√© des jetons mat√©riels OATH dans Azure Cloud MFA</a></li>
<li><a href="../fr438368/index.html">Les ampoules intelligentes jet√©es √† la poubelle sont une pr√©cieuse source d'informations personnelles.</a></li>
<li><a href="../fr438370/index.html">La cybercriminalit√© en tant que service: services et tarifs</a></li>
<li><a href="../fr438372/index.html">La NASA poursuit ses tentatives pour contacter l'opportunit√©</a></li>
<li><a href="../fr438376/index.html">R√©tro-ing√©nierie. L'histoire. Le mien</a></li>
<li><a href="../fr438380/index.html">Homme, pause sur les exceptions captur√©es</a></li>
<li><a href="../fr438382/index.html">Organisation d'une recherche sur une page web en JavaScript (sans jQuery)</a></li>
<li><a href="../fr438384/index.html">Le√ßon de chimie: comment exposer le cristal d'une puce √©lectronique pour la photographie</a></li>
<li><a href="../fr438386/index.html">En route vers les principes physiques de l'√©volution biologique</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>