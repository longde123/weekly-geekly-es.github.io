<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🎤 👼🏻 🔤 اختبار Qt 5 الثالث مع PVS-Studio ↗️ ⏲️ 👨🏼‍🚒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="من وقت لآخر ، يعيد فريقنا التحقق من المشاريع التي كتبنا عنها بالفعل مقالات. مشروع آخر تم إعادة فحصه كان Qt. آخر مرة اختبرناها مع PVS-Studio في عام 201...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>اختبار Qt 5 الثالث مع PVS-Studio</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/426485/" style=";text-align:right;direction:rtl"><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/dd9/87d/907/dd987d90784865f850555bc198a97b81.png" alt="PVS-Studio &amp; Qt"></div><br>  من وقت لآخر ، يعيد فريقنا التحقق من المشاريع التي كتبنا عنها بالفعل مقالات.  مشروع آخر تم إعادة فحصه كان Qt.  آخر مرة اختبرناها مع PVS-Studio في عام 2014.  منذ عام 2014 ، بدأ فحص المشروع بانتظام بمساعدة Coverity.  هذا مثير للاهتمام.  دعونا نرى ما إذا كان بإمكاننا الآن العثور على أي أخطاء مثيرة للاهتمام باستخدام PVS-Studio. <br><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  كيو تي </h2><br>  المقالات السابقة: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">كيفية تقليل احتمالية الأخطاء في مرحلة كتابة التعليمات البرمجية</a> " يوليو 2011. </li><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Qt 5 framework check</a> " ، أبريل 2014. </li></ul><br>  هذه المرة <a href="">تم اختبار</a> <a href="">Qt Base</a> (Core ، Gui ، Widgets ، Network ، ...) و <a href="">Qt5 super module</a> .  حول Qt Creator ، نخطط لكتابة مقال منفصل لاحقًا.  للتحقق ، استخدمنا محلل ثابت PVS-Studio ، وهو إصدار تجريبي يمكنك <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">تنزيله</a> من الموقع. <br><br>  في رأيي الشخصي ، أصبح كود Qt أفضل.  على مر السنين منذ الاختبار الأخير ، ظهرت العديد من التشخيصات الجديدة في محلل PVS-Studio.  على الرغم من ذلك ، خلال دراسة مراجعة التحذيرات ، لم أجد الكثير من الأخطاء لمشروع بهذا الحجم.  أكرر مرة أخرى أن هذا هو انطباعي الفردي.  لم أقم بأي بحث خاص حول كثافة الأخطاء سواء في ذلك الوقت أو الآن. <br><br>  على الأرجح ، أثرت الفحوصات المنتظمة باستخدام محلل الغلاف الثابت على جودة الشفرة على الأرجح.  في عام 2014 ، بمساعدة Coverity ، بدأ فحص مشروع Qt (مشروع <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">qt</a> ) ، وفي عام 2016 ، تم إنشاء Qt Creator ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">qt-creator</a> ).  رأيي: إذا كنت تقوم بتطوير مشروع مفتوح ، فإن <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Coverity Scan</a> يمكن أن يكون حلاً مجانيًا جيدًا سيحسن بشكل كبير جودة وموثوقية مشاريعك. <br><br>  ومع ذلك ، كما يمكن للقارئ أن يخمن ، إذا لم أكن قد لاحظت أي شيء مثير للاهتمام في تقرير PVS-Studio ، فلن تكون هناك مقالة :).  وبما أن هناك مقال ، أي عيوب.  دعونا نلقي نظرة عليهم.  في المجموع ، كتبت 96 خطأ. <br><br><h2 style=";text-align:right;direction:rtl">  نسخ ولصق أخطاء فاشلة </h2><br>  لنبدأ بكلاسيكيات هذا النوع ، عندما يكون سبب الخطأ هو عدم الانتباه.  يتم تقدير هذه الأخطاء من قبل المبرمجين.  بالنسبة لأولئك الذين لم يقرؤوا بعد ، أوصي بإلقاء نظرة على هاتين المادتين: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">تأثير الخط الأخير</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">يعيش الشر في وظائف المقارنة</a> </li></ul><br>  هذه الأخطاء هي لغة متداخلة.  على سبيل المثال ، تقدم المقالة الثانية الكثير من الأمثلة على الأخطاء في وظائف المقارنة المكتوبة في C و C ++ و C #.  الآن ، عند تنفيذ دعم لغة جافا في PVS-Studio ، نواجه نفس أنماط الخطأ.  هنا ، على سبيل المثال ، يوجد خطأ وجدناه مؤخرًا في مكتبة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Hibernate</a> : <br><br><pre style=";text-align:right;direction:rtl"><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object other)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (other instanceof Id) { Id that = (Id) other; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> purchaseSequence.equals(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.purchaseSequence) &amp;&amp; that.purchaseNumber == <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.purchaseNumber; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }</code> </pre> <br>  إذا نظرت عن كثب ، اتضح أن حقل PurchaseSequence يتم مقارنته بنفسه.  الخيار الصحيح: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> that.purchaseSequence.equals(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.purchaseSequence) &amp;&amp; that.purchaseNumber == <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.purchaseNumber;</code> </pre> <br>  بشكل عام ، كل شيء كما هو الحال دائمًا ، وسيتعين على محلل PVS-Studio "إشعال اسطبلات Augean" في مشاريع Java.  بالمناسبة ، ندعو الجميع للمشاركة في اختبار الإصدار التجريبي من PVS-Studio for Java ، والذي من المقرر أن يظهر في المستقبل القريب.  للقيام بذلك ، <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">اكتب إلينا</a> (حدد "أريد محلل لـ Java"). <br><br>  نعود الآن إلى الأخطاء في مشروع Qt. <br><br>  <b>عيب N1</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windowDpiAwareness</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HWND hwnd)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QWindowsContext::user32dll.getWindowDpiAwarenessContext &amp;&amp; QWindowsContext::user32dll.getWindowDpiAwarenessContext ? QWindowsContext::user32dll.getAwarenessFromDpiAwarenessContext( QWindowsContext::user32dll.getWindowDpiAwarenessContext(hwnd)) : <span class="hljs-number"><span class="hljs-number">-1</span></span>; }</code> </pre> <br>  تحذير PVS-Studio: V501 CWE-571 هناك تعبيرات فرعية متطابقة "QWindowsContext :: user32dll.getWindowDpiAwarenessContext" إلى اليسار وإلى يمين عامل التشغيل "&amp;&amp;".  qwindowscontext.cpp 150 <br><br>  أي تفسير خاص إلى جانب رسالة المحلل غير مطلوب هنا.  يبدو لي أن التعبير كان يجب أن يكون هكذا: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QWindowsContext::user32dll.getAwarenessFromDpiAwarenessContext &amp;&amp; QWindowsContext::user32dll.getWindowDpiAwarenessContext ? QWindowsContext::user32dll.getAwarenessFromDpiAwarenessContext( QWindowsContext::user32dll.getWindowDpiAwarenessContext(hwnd)) : <span class="hljs-number"><span class="hljs-number">-1</span></span>;</code> </pre> <br>  <b>عيب N2 ، N3</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> QReadWriteLockPrivate::release() { Q_ASSERT(!recursive); Q_ASSERT(!waitingReaders &amp;&amp; !waitingReaders &amp;&amp; !readerCount &amp;&amp; !writerCount); freelist-&gt;release(id); }</code> </pre> <br>  تحذير PVS-Studio: V501 CWE-571 هناك تعبيرات فرعية متطابقة إلى اليسار وإلى يمين عامل التشغيل "&amp;&amp;":! WaitingReaders &amp;&amp;! WaitingReaders qreadwritelock.cpp 632 <br><br>  كان الخطأ داخل <i>حالة</i> الماكرو <i>Q_ASSERT</i> ، لذلك ليس كبيرا.  لكن مع ذلك ، هذا خطأ.  تم <i>التحقق من</i> متغير <i>waitReaders</i> مرتين.  ويبدو أنهم نسوا التحقق من بعض المتغيرات الأخرى. <br><br>  تم العثور على خطأ متطابق في سطر 625 من ملف qreadwritelock.cpp.  تحيا النسخ واللصق!  :) <br><br>  <b>عيب N4</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">QString QGraphicsSceneBspTree::debug(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (node-&gt;type == Node::Horizontal) { tmp += debug(firstChildIndex(index)); tmp += debug(firstChildIndex(index) + <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { tmp += debug(firstChildIndex(index)); tmp += debug(firstChildIndex(index) + <span class="hljs-number"><span class="hljs-number">1</span></span>); } .... }</code> </pre> <br>  تحذير PVS-Studio: V523 CWE-691 عبارة "ثم" تعادل عبارة "آخر".  qgraphicsscene_bsp.cpp 179 <br><br>  على الأرجح ، تم نسخ كتلة النص ، لكنهم نسوا تصحيحها. <br><br>  <b>عيب N5</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> FillRule { OddEvenFill, WindingFill }; QDataStream &amp;<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>&gt;&gt;(QDataStream &amp;s, QPainterPath &amp;p) { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fillRule; s &gt;&gt; fillRule; Q_ASSERT(fillRule == Qt::OddEvenFill || Qt::WindingFill); .... }</code> </pre> <br>  تحذير PVS-Studio: V768 CWE-571 يتم استخدام ثابت التعداد "WindingFill" كمتغير من نوع منطقي.  2479 <br><br>  أوافق ، هذه غلطة جميلة!  لا <i>يتحقق Q_ASSERT من</i> أي شيء ، لأن الشرط دائمًا صحيح.  الشرط صحيح لأن الثابت <i>Qt :: WindingFill</i> هو 1. <br><br>  <b>عيب N6</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> QVariant::canConvert(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> targetTypeId) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentType == QMetaType::SChar || currentType == QMetaType::Char) currentType = QMetaType::UInt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (targetTypeId == QMetaType::SChar || currentType == QMetaType::Char) targetTypeId = QMetaType::UInt; .... }</code> </pre> <br>  قبل قراءة التحذير ، حاول اكتشاف خطأ مطبعي بنفسك.  بإضافة صورة ، سأساعدك على عدم قراءة رسالة المحلل على الفور :). <br><br><p style=";text-align:right;direction:rtl"></p><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/86f/f1d/7c5/86ff1d7c55cdc0fb71cbce45f2f84f05.png" alt="حان وقت التفكير"></div><br><br>  تحذير PVS-Studio: V560 CWE-570 دائمًا ما يكون جزء من التعبير الشرطي خطأ: currentType == QMetaType :: Char.  qvariant.cpp 3529 <br><br>  الحالة "currentType == QMetaType :: Char" محددة في الحالة الأولى.  إذا تم استيفاء الشرط ، <i>يتم</i> تعيين قيمة <i>QMetaType :: UInt للمتغير الحالي</i> .  لذلك ، علاوة على ذلك ، لا يمكن أن يكون المتغير <i>currentType</i> مساوياً لـ <i>QMetaType :: Char</i> .  لذلك ، يشير المحلل إلى أنه في الحالة الثانية <i>، يكون</i> التعبير الفرعي "currentType == QMetaType :: Char" دائمًا خاطئًا. <br><br>  في الواقع ، يجب أن يكون الثاني <i>إذا كان</i> مثل هذا: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (targetTypeId == QMetaType::SChar || targetTypeId == QMetaType::Char) targetTypeId = QMetaType::UInt;</code> </pre> <br><br>  <b>ملاحظة تشخيصية V560</b> <br><br>  وجد التقرير العديد من تحذيرات V560.  ومع ذلك ، لم أعد أنظر إليهم بمجرد أن وجدت حالة مثيرة للاهتمام للمقال ، والتي اعتبرت أعلاه على أنها عيب N6. <br><br>  لا يمكن تسمية الغالبية العظمى من الرسائل V560 بأنها خاطئة ، ولكن لا فائدة منها.  وبعبارة أخرى ، فإن وصفها في مقال ليست مثيرة للاهتمام.  لتوضيح ما أعنيه بالضبط ، ضع في اعتبارك إحدى هذه الحالات. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">QString QTextHtmlExporter::findUrlForImage(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QTextDocument *doc, ....) { QString url; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!doc) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> url; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (QTextDocument *parent = qobject_cast&lt;QTextDocument *&gt;(doc-&gt;parent())) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> findUrlForImage(parent, cacheKey, isPixmap); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (doc &amp;&amp; doc-&gt;docHandle()) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... }</span></span></code> </pre> <br>  تحذير PVS-Stuidio: V560 CWE-571 دائمًا ما يكون جزء من التعبير الشرطي صحيحًا: doc.  qtextdocument.cpp 2992 <br><br>  المحلل صحيح تمامًا أن مؤشر <i>doc</i> ليس دائمًا <i>nullptr</i> عند إعادة فحصه.  لكن هذا ليس خطأ ، كان المبرمج فقط آمنًا.  يمكنك تبسيط الرمز عن طريق كتابة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (doc-&gt;docHandle()) {</code> </pre> <br>  <b>عيب N7</b> <br><br>  والحالة الأخيرة التي يمكن تصنيفها على أنها خطأ مطبعي.  يحدث الخطأ بسبب الارتباك في أسماء الثوابت ، والتي تختلف فقط في حالة الحرف الأول. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QWindowsCursor</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> QPlatformCursor { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> CursorState { CursorShowing, CursorHidden, CursorSuppressed }; .... } QWindowsCursor::CursorState QWindowsCursor::cursorState() { <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> { cursorShowing = <span class="hljs-number"><span class="hljs-number">0x1</span></span>, cursorSuppressed = <span class="hljs-number"><span class="hljs-number">0x2</span></span> }; CURSORINFO cursorInfo; cursorInfo.cbSize = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(CURSORINFO); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GetCursorInfo(&amp;cursorInfo)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cursorInfo.flags &amp; CursorShowing) .... }</code> </pre> <br>  تحذير PVS-Studio: V616 CWE-480 يتم استخدام ثابت "CursorShowing" المسمى بقيمة 0 في عملية أحادي البتات.  669 <br><br>  بمزيد من التفصيل ، قمت بالفعل بتحليل هذا الخطأ في ملاحظة صغيرة منفصلة: " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">مرة أخرى ، تبين أن محلل PVS-Studio أصبح أكثر انتباهاً</a> من <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الشخص</a> ." <br><br><h2 style=";text-align:right;direction:rtl">  العيوب الأمنية </h2><br>  في الواقع ، يمكن أن تسمى جميع الأخطاء التي تمت مناقشتها في هذه المقالة عيوب الأمان.  يتم تصنيفهم جميعًا وفقًا <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">لتعداد الضعف العام</a> (انظر معرف CWE في رسائل المحلل).  إذا تم تصنيف الأخطاء على أنها CWEs ، فمن المحتمل أن تكون خطرًا أمنيًا.  يتم شرح ذلك بمزيد من التفصيل في صفحة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">PVS-Studio SAST</a> . <br><br>  ومع ذلك ، أود أن أفرد عددًا من الأخطاء في مجموعة منفصلة.  دعونا نلقي نظرة عليها. <br><br>  <b>عيب N8 ، N9</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> QLocalServerPrivate::addListener() { .... SetSecurityDescriptorOwner(pSD.data(), pTokenUser-&gt;User.Sid, FALSE); SetSecurityDescriptorGroup(pSD.data(), pTokenGroup-&gt;PrimaryGroup, FALSE); .... }</code> </pre> <br>  تحذيرات PVS-Studio: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  V530 CWE-252 القيمة المرجعة للدالة 'SetSecurityDescriptorOwner' مطلوبة لاستخدامها.  qlocalserver_win.cpp 167 </li><li style=";text-align:right;direction:rtl">  V530 CWE-252 القيمة المرجعة للدالة 'SetSecurityDescriptorGroup' مطلوبة لاستخدامها.  qlocalserver_win.cpp 168 </li></ul><br>  هناك العديد من الوظائف المتعلقة بالتحكم في الوصول.  <i>الدالتان SetSecurityDescriptorOwner</i> و <i>SetSecurityDescriptorGroup</i> من بينها. <br><br>  مع هذه الوظائف تحتاج إلى العمل بعناية فائقة.  على سبيل المثال ، يجب عليك التحقق من الحالة التي يعودون إليها.  ماذا يحدث إذا فشل الاستدعاء لهذه الوظائف؟  التخمين ليس ضروريًا ، من الضروري كتابة رمز للتعامل مع مثل هذه الحالة. <br><br>  ليس من الضروري الاستفادة من عدم التحقق وتحويل هذه الأخطاء إلى نقاط ضعف.  ومع ذلك ، هذا ليس بأي حال مكانًا للمخاطرة ، وتحتاج إلى كتابة رمز أكثر أمانًا. <br><br>  <b>عيب N10</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> QLocalServerPrivate::addListener() { .... InitializeAcl(acl, aclSize, ACL_REVISION_DS); .... }</code> </pre> <br>  تحذير PVS-Studio: V530 CWE-252 يجب استخدام القيمة المرجعة للدالة 'InitializeAcl'.  qlocalserver_win.cpp 144 <br><br>  الوضع مشابه لذلك الذي نوقش أعلاه. <br><br>  <b>عيب N11 ، N12</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sha1ProcessChunk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... quint8 chunkBuffer[<span class="hljs-number"><span class="hljs-number">64</span></span>]; .... <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> SHA1_WIPE_VARIABLES .... memset(chunkBuffer, 0, 64); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> }</span></span></code> </pre> <br>  تحذير PVS-Studio: V597 CWE-14 يمكن للمترجم حذف استدعاء وظيفة "memset" ، والذي يتم استخدامه لمسح المخزن المؤقت "chunkBuffer".  يجب استخدام الدالة RtlSecureZeroMemory () لمسح البيانات الخاصة.  sha1.cpp 189 <br><br>  سيقوم المحول البرمجي بإزالة استدعاء وظيفة <i>memset</i> .  بالفعل عدة مرات في المقالات قمت بتحليل هذا الوضع.  لا أشعر برغبة في تكرار نفسي.  أشير إلى المقالة " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">التنظيف الآمن للبيانات الخاصة</a> ". <br><br>  وخطأ آخر في نفس الملف sha1.cpp ، في السطر 247. <br><br><h2 style=";text-align:right;direction:rtl">  مؤشرات فارغة </h2><br>  حان الوقت للحديث عن المؤشرات.  كان هناك الكثير من الأخطاء حول هذا الموضوع. <br><br>  <b>عيب N13</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">QByteArray &amp;QByteArray::append(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *str, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> len) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (len &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) len = qstrlen(str); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str &amp;&amp; len) { .... }</code> </pre> <br>  تحذير PVS-Studio: V595 CWE-476 تم استخدام مؤشر 'str' قبل التحقق من صلاحيته باستخدام nullptr.  خطوط التحقق: 2118 ، 2119. qbytearray.cpp 2118 <br><br>  الوضع الكلاسيكي هو عندما يتم استخدام المؤشر في البداية ثم يتم التحقق من المساواة في <i>nullptr</i> .  هذا نمط خطأ شائع جدًا ، <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ونراه</a> بشكل منتظم في جميع المشاريع تقريبًا. <br><br>  <b>عيب N14 ، N15</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> QMetaObjectPrivate *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">priv</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> uint* data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QMetaObjectPrivate*&gt;(data); } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> QMetaEnum::isFlag() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> offset = priv(mobj-&gt;d.data)-&gt;revision &gt;= <span class="hljs-number"><span class="hljs-number">8</span></span> ? <span class="hljs-number"><span class="hljs-number">2</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mobj &amp;&amp; mobj-&gt;d.data[handle + offset] &amp; EnumIsFlag; }</code> </pre> <br>  تحذير PVS-Studio: V595 CWE-476 تم استخدام مؤشر "mobj" قبل التحقق من صحته باستخدام nullptr.  خطوط التحقق: 2671 ، 2672. qmetaobject.cpp 2671 <br><br>  فقط في حالة ، أحضر جسم الوظيفة الخاصة.  لسبب ما ، يبدأ القراء أحيانًا في التوصل إلى مواقف تعمل فيها الشفرة.  لا أفهم من أين يأتي هذا الارتياب والرغبة في رؤية ميزة صعبة في الخطأ :).  على سبيل المثال ، قد يقترح شخص ما في التعليقات أن <i>priv</i> هو ماكرو من النموذج: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> priv(A) foo(sizeof(A))</span></span></code> </pre> <br>  ثم سيعمل كل شيء. <br><br>  من أجل تجنب مثل هذه المناقشات ، أحاول أن أذكر أجزاء من التعليمات البرمجية حيث يتم توفير جميع المعلومات التي تؤكد وجود خطأ. <br><br>  لذلك ، يتم <i>إلغاء</i> الإشارة إلى مؤشر <i>modj</i> ثم التحقق منه. <br><br>  مزيد من المشهد يأتي مع النسخ "الجبار والرهيب" نسخ ولصق.  بسبب ما تم الكشف عن نفس الخطأ بالضبط في الدالة <i>isScoped</i> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> QMetaEnum::isScoped() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> offset = priv(mobj-&gt;d.data)-&gt;revision &gt;= <span class="hljs-number"><span class="hljs-number">8</span></span> ? <span class="hljs-number"><span class="hljs-number">2</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mobj &amp;&amp; mobj-&gt;d.data[handle + offset] &amp; EnumIsScoped; }</code> </pre> <br>  تحذير PVS-Studio: V595 CWE-476 تم استخدام مؤشر "mobj" قبل التحقق من صحته باستخدام nullptr.  خطوط التحقق: 2683 ، 2684. qmetaobject.cpp 2683 <br><br>  <b>عيب N16-N21</b> <br><br>  لنأخذ مثالاً آخر ، وأعتقد أنه يكفي. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> QTextCursor::insertFragment(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QTextDocumentFragment &amp;fragment) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!d || !d-&gt;priv || fragment.isEmpty()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; d-&gt;priv-&gt;beginEditBlock(); d-&gt;remove(); fragment.d-&gt;insert(*<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); d-&gt;priv-&gt;endEditBlock(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fragment.d &amp;&amp; fragment.d-&gt;doc) d-&gt;priv-&gt;mergeCachedResources(fragment.d-&gt;doc-&gt;docHandle()); }</code> </pre> <br>  تحذير PVS-Studio: V595 CWE-476 تم استخدام مؤشر "fragment.d" قبل التحقق من صحته باستخدام nullptr.  خطوط التحقق: 2238 ، 2241. qtextcursor.cpp 2238 <br><br>  كل نفس.  انتبه إلى تسلسل العمل مع المؤشر المخزن في الجزء المتغير. <br><br>  أخطاء أخرى من هذا النوع: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  V595 CWE-476 تم استخدام مؤشر "النافذة" قبل التحقق من صلاحيته باستخدام nullptr.  خطوط التحقق: 1846 ، 1848. qapplication.cpp 1846 </li><li style=";text-align:right;direction:rtl">  V595 CWE-476 تم استخدام مؤشر "النافذة" قبل التحقق من صلاحيته باستخدام nullptr.  خطوط التحقق: 1858 ، 1860. qapplication.cpp 1858 </li><li style=";text-align:right;direction:rtl">  V595 CWE-476 تم استخدام مؤشر "الرد" قبل أن يتم التحقق منه مقابل nullptr.  خطوط التحقق: 492 ، 502. qhttpnetworkconnectionchannel.cpp 492 </li><li style=";text-align:right;direction:rtl">  V595 CWE-476 تم استخدام مؤشر "newHandle" قبل التحقق من صلاحيته باستخدام nullptr.  خطوط التحقق: 877 ، 883. qsplitter.cpp 877 </li><li style=";text-align:right;direction:rtl">  V595 CWE-476 تم استخدام مؤشر "عنصر واجهة المستخدم" قبل التحقق من صلاحيته باستخدام nullptr.  خطوط التحقق: 2320 ، 2322. qwindowsvistastyle.cpp 2320 </li><li style=";text-align:right;direction:rtl">  في الواقع ، هناك المزيد من الأخطاء.  لقد سئمت بسرعة من تعلم تحذيرات V595 ، وبالنسبة للمقالة ، كتبت بالفعل أجزاء كافية من التعليمات البرمجية. </li></ul><br>  <b>عيب N22-N33</b> <br><br>  يوجد رمز حيث يتم التحقق من مؤشر إرجاع عامل التشغيل <i>الجديد</i> .  هذا مضحك بشكل خاص وسط حقيقة أن هناك الكثير من الأماكن التي لا يتم فيها تحديد نتيجة وظيفة <i>malloc</i> (انظر مجموعة الأخطاء التالية). <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> QTranslatorPrivate::do_load(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString &amp;realname, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString &amp;directory) { .... d-&gt;unmapPointer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[d-&gt;unmapLength]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (d-&gt;unmapPointer) { file.seek(<span class="hljs-number"><span class="hljs-number">0</span></span>); qint64 readResult = file.read(d-&gt;unmapPointer, d-&gt;unmapLength); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (readResult == qint64(unmapLength)) ok = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } .... }</code> </pre> <br>  تحذير PVS-Studio: V668 CWE-571 لا يوجد أي معنى في اختبار مؤشر "d-&gt; unmap Pointer" مقابل قيمة خالية ، حيث تم تخصيص الذاكرة باستخدام عامل التشغيل "new".  سيتم إنشاء الاستثناء في حالة خطأ تخصيص الذاكرة.  qtranslator.cpp 596 <br><br>  التحقق من المؤشر لا معنى له ، لأنه في حالة وجود خطأ في تخصيص الذاكرة ، سيتم <i>طرح</i> استثناء <i>std :: bad_alloc</i> .  إذا كنت تريد أن يقوم عامل التشغيل <i>الجديد</i> بإرجاع <i>nullptr في</i> حالة عدم وجود ذاكرة كافية ، فيجب عليك كتابة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">d-&gt;unmapPointer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::nothrow) <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[d-&gt;unmapLength];</code> </pre> <br>  يعرف المحلل عن هذا الاستخدام للعامل <i>الجديد</i> ولن يعطي تحذيرًا في هذه الحالة. <br><br>  أخطاء أخرى: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">سأعطيهم ملف qt-V668.txt</a> . <br><br>  <b>عيب N34-N70</b> <br><br>  كما هو موعود ، الآن حان دور الأخطاء عندما لا يتحققون من نتيجة استدعاء الوظائف <i>malloc</i> ، <i>calloc</i> ، <i>strdup</i> ، إلخ.  هذه الأخطاء أكثر خطورة مما تبدو للوهلة الأولى.  مزيد من التفاصيل: " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">لماذا من المهم التحقق مما عادت دالة malloc</a> ." <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">SourceFiles::SourceFiles() { nodes = (SourceFileNode**)<span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(SourceFileNode*)*(num_nodes=<span class="hljs-number"><span class="hljs-number">3037</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n = <span class="hljs-number"><span class="hljs-number">0</span></span>; n &lt; num_nodes; n++) nodes[n] = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; }</code> </pre> <br>  تحذير PVS-Studio: V522 CWE-690 قد يكون هناك إحالة مرجعية لـ "عقد" مؤشر خالية محتملة.  تحقق من الخطوط: 138 ، 136. makefiledeps.cpp 138 <br><br>  يتم استخدام المؤشر دون التحقق المسبق. <br><br>  كل هذه الأخطاء من نفس النوع ، لذلك لن أتناولها بمزيد من التفصيل.  سأعطي بقية قائمة التحذير: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">qt-V522-V575.txt</a> . <br><br><h2 style=";text-align:right;direction:rtl">  الأخطاء المنطقية في الظروف </h2><br>  <b>عيب N71</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">QString QEdidParser::parseEdidString(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> quint8 *data) { <span class="hljs-function"><span class="hljs-function">QByteArray </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buffer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">reinterpret_cast</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *&gt;(data), </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">13</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// Erase carriage return and line feed buffer = buffer.replace('\r', '\0').replace('\n', '\0'); // Replace non-printable characters with dash for (int i = 0; i &lt; buffer.count(); ++i) { if (buffer[i] &lt; '\040' &amp;&amp; buffer[i] &gt; '\176') buffer[i] = '-'; } return QString::fromLatin1(buffer.trimmed()); }</span></span></code> </pre> <br>  تحذير PVS-Studio: V547 CWE-570 Expression 'buffer [i] &lt;' \ 040 '&amp;&amp; buffer [i]&gt;' \ 176 '' دائمًا خطأ.  qedidparser.cpp 169 <br><br>  يجب أن تقوم الوظيفة بالإجراء التالي "استبدال الأحرف غير القابلة للطباعة بشرطة".  ومع ذلك ، لم تفعل ذلك.  دعونا نلقي نظرة فاحصة على هذه الحالة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (buffer[i] &lt; <span class="hljs-string"><span class="hljs-string">'\040'</span></span> &amp;&amp; buffer[i] &gt; <span class="hljs-string"><span class="hljs-string">'\176'</span></span>)</code> </pre> <br>  لا معنى له.  لا يمكن أن يكون الحرف أقل من '\ 040' وأكبر من '\ 176' في نفس الوقت.  في الحالة يجب عليك استخدام عامل التشغيل '||'.  الرمز الصحيح هو: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (buffer[i] &lt; <span class="hljs-string"><span class="hljs-string">'\040'</span></span> || buffer[i] &gt; <span class="hljs-string"><span class="hljs-string">'\176'</span></span>)</code> </pre> <br>  <b>عيب N72</b> <br><br>  خطأ مماثل ، بسبب عدم حظ مستخدمي Windows. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> defined(Q_OS_WIN) static QString driveSpec(const QString &amp;path) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (path.size() </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt; 2) return QString(); char c = path.at(0).toLatin1(); if (c &lt; 'a' &amp;&amp; c &gt; 'z' &amp;&amp; c &lt; 'A' &amp;&amp; c &gt; 'Z') return QString(); if (path.at(1).toLatin1() != ':') return QString(); return path.mid(0, 2); } #endif</span></span></span></span></code> </pre> <br>  ينشئ المحلل تحذيرين في وقت واحد: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  V590 CWE-571 خذ بعين الاعتبار فحص تعبير 'c &lt;' a '&amp;&amp; c&gt;' z '&amp;&amp; c &lt;' A '&amp;&amp; c&gt;' Z ''.  التعبير زائد أو يحتوي على خطأ مطبعي.  qdir.cpp 77 </li><li style=";text-align:right;direction:rtl">  V560 CWE-570 جزء من التعبير الشرطي خطأ دائمًا: c&gt; 'z'.  qdir.cpp 77 </li></ul><br>  خطأ منطقي في الحالة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c &lt; <span class="hljs-string"><span class="hljs-string">'a'</span></span> &amp;&amp; c &gt; <span class="hljs-string"><span class="hljs-string">'z'</span></span> &amp;&amp; c &lt; <span class="hljs-string"><span class="hljs-string">'A'</span></span> &amp;&amp; c &gt; <span class="hljs-string"><span class="hljs-string">'Z'</span></span>)</code> </pre> <br>  كما أفهمها ، أراد المبرمج العثور على حرف ليس حرفًا من الأبجدية اللاتينية.  في هذه الحالة ، يجب أن يكون الشرط كما يلي: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((c &lt; <span class="hljs-string"><span class="hljs-string">'a'</span></span> || c &gt; <span class="hljs-string"><span class="hljs-string">'z'</span></span>) &amp;&amp; (c &lt; <span class="hljs-string"><span class="hljs-string">'A'</span></span> || c &gt; <span class="hljs-string"><span class="hljs-string">'Z'</span></span>))</code> </pre> <br>  <b>عيب N73</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> SelectionMode { NoSelection, SingleSelection, MultiSelection, ExtendedSelection, ContiguousSelection }; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> QAccessibleTableCell::unselectCell() { QAbstractItemView::SelectionMode selectionMode = view-&gt;selectionMode(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!m_index.isValid() || (selectionMode &amp; QAbstractItemView::NoSelection)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; .... }</code> </pre> <br>  تحذير PVS-Studio: V616 CWE-480 يتم استخدام ثابت QAb abstractItemView :: NoSelection مع قيمة 0 في عملية أحادي المعامل.  976 <br><br>  ثابت <i>QAb abstractItemView :: NoSelection</i> هو صفر.  لذلك ، لا معنى <i>للتعبير الفرعي (selectMode &amp; QAb abstractItemView :: NoSelection)</i> .  ستكون دائمًا 0. <br><br>  أعتقد أنه يجب كتابتها هنا: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!m_index.isValid() || (selectionMode == QAbstractItemView::NoSelection))</code> </pre> <br>  <b>عيب N74</b> <br><br>  من الصعب علي فهم الكود التالي.  إنه مخطئ ، لكني لا أعرف ما يجب أن يكون.  التعليق على وظيفة لا يساعدني أيضًا. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Re-engineered from the inline function _com_error::ErrorMessage(). // We cannot use it directly since it uses swprintf_s(), which is not // present in the MSVCRT.DLL found on Windows XP (QTBUG-35617). static inline QString errorMessageFromComError(const _com_error &amp;comError) { TCHAR *message = nullptr; FormatMessage( FORMAT_MESSAGE_ALLOCATE_BUFFER | FORMAT_MESSAGE_FROM_SYSTEM, NULL, DWORD(comError.Error()), MAKELANGID(LANG_NEUTRAL,SUBLANG_DEFAULT), message, 0, NULL); if (message) { const QString result = QString::fromWCharArray(message).trimmed(); LocalFree(static_cast&lt;HLOCAL&gt;(message)); return result; } if (const WORD wCode = comError.WCode()) return QString::asprintf("IDispatch error #%u", uint(wCode)); return QString::asprintf("Unknown error 0x0%x", uint(comError.Error())); }</span></span></code> </pre> <br>  تحذير PVS-Studio: رسالة تعبير V547 CWE-570 خاطئة دائمًا.  qwindowscontext.cpp 802 <br><br>  ربما يفترض المبرمج أن وظيفة <i>FormatMessage</i> ستغير قيمة مؤشر <i>الرسالة</i> .  لكن الأمر ليس كذلك.  لا يمكن <i>للدالة FormatMessage</i> تغيير قيمة المؤشر ، حيث يتم تمريره إلى الدالة حسب القيمة.  هنا نموذج أولي لهذه الوظيفة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">DWORD __<span class="hljs-function"><span class="hljs-function">stdcall </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormatMessageW</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( DWORD dwFlags, LPCVOID lpSource, DWORD dwMessageId, DWORD dwLanguageId, LPWSTR lpBuffer, DWORD nSize, va_list *Arguments )</span></span></span></span>;</code> </pre> <br><br><h2 style=";text-align:right;direction:rtl">  تسرب الذاكرة المحتملة </h2><br>  <b>عيب N75-N92</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SourceDependChildren</span></span></span><span class="hljs-class"> {</span></span> SourceFile **children; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> num_nodes, used_nodes; SourceDependChildren() : children(<span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>), num_nodes(<span class="hljs-number"><span class="hljs-number">0</span></span>), used_nodes(<span class="hljs-number"><span class="hljs-number">0</span></span>) { } ~SourceDependChildren() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (children) <span class="hljs-built_in"><span class="hljs-built_in">free</span></span>(children); children = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addChild</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SourceFile *s)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(num_nodes &lt;= used_nodes) { num_nodes += <span class="hljs-number"><span class="hljs-number">200</span></span>; children = (SourceFile**)<span class="hljs-built_in"><span class="hljs-built_in">realloc</span></span>(children, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(SourceFile*)*(num_nodes)); } children[used_nodes++] = s; } };</code> </pre> <br>  تحذير PVS-Studio: V701 CWE-401 realloc () تسرب محتمل: عندما يفشل realloc () في تخصيص الذاكرة ، يتم فقدان المؤشر الأصلي "أطفال".  خذ بعين الاعتبار تعيين realloc () لمؤشر مؤقت.  ١٠٣ <br><br>  يتم تنفيذ توسيع المخزن المؤقت بطريقة خطيرة.  إذا تعذر على الدالة <i>realloc</i> تخصيص الذاكرة ، فسوف تُرجع <i>NULL</i> .  سيتم وضع <i>NULL</i> على الفور في المتغير التابع ولن تكون هناك إمكانية لتحرير المخزن المؤقت المخصص مسبقًا.  سيحدث تسرب للذاكرة. <br><br>  أخطاء مماثلة: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">qt-701.txt</a> . <br><br><h2 style=";text-align:right;direction:rtl">  متفرقات </h2><br>  <b>عيب N93</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GradientBase</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BlendType</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">inline</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BlendType</span></span></span><span class="hljs-class"> * </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QT_FASTCALL</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">qt_fetch_linear_gradient_template</span></span></span><span class="hljs-class">(....) {</span></span> .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t+inc*length &lt; qreal(INT_MAX &gt;&gt; (FIXPT_BITS + <span class="hljs-number"><span class="hljs-number">1</span></span>)) &amp;&amp; t+inc*length &gt; qreal(INT_MIN &gt;&gt; (FIXPT_BITS + <span class="hljs-number"><span class="hljs-number">1</span></span>))) { .... }</code> </pre> <br>  تحذير PVS-Studio: V610 CWE-758 سلوك غير محدد.  تحقق من عامل النقل '&gt;&gt;'.  المعامل الأيسر "(- 2147483647 - 1)" سلبي.  قحطان 4015 <br><br>  لا يمكن تغيير القيمة السالبة لـ <i>INT_MIN</i> .  هذا سلوك غير محدد ، ولا يمكنك الاعتماد على نتيجة هذه العملية.  يمكن أن تكون البتات الأكثر أهمية تساوي 0 أو 1. <br><br>  <b>عيب N94</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> QObjectPrivate::addConnection(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> signal, Connection *c) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (signal &gt;= connectionLists-&gt;count()) connectionLists-&gt;resize(signal + <span class="hljs-number"><span class="hljs-number">1</span></span>); ConnectionList &amp;connectionList = (*connectionLists)[signal]; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (signal &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { .... }</code> </pre> <br>  تحذير PVS-Studio: V781 CWE-129 يتم التحقق من قيمة متغير "الإشارة" بعد استخدامه.  ربما هناك خطأ في منطق البرنامج.  خطوط التحقق: 397 ، 413. qobject.cpp 397 <br><br>  يشير الاختيار <i>(الإشارة &lt;0)</i> إلى أن قيمة وسيطة <i>الإشارة</i> قد تكون سالبة.  ومع ذلك ، تم استخدام هذه الوسيطة سابقًا لفهرسة الصفيف.  اتضح أن الفحص يتم في وقت متأخر جدًا.  سيتم بالفعل تعطيل البرنامج. <br><br>  <b>عيب N95</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> QXmlStreamWriterPrivate::finishStartElement(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> contents) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inEmptyElement) { write(<span class="hljs-string"><span class="hljs-string">"/&gt;"</span></span>); QXmlStreamWriterPrivate::Tag &amp;tag = tagStack_pop(); lastNamespaceDeclaration = tag.namespaceDeclarationsSize; lastWasStartElement = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { write(<span class="hljs-string"><span class="hljs-string">"&gt;"</span></span>); } inStartElement = inEmptyElement = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; lastNamespaceDeclaration = namespaceDeclarations.size(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hadSomethingWritten; }</code> </pre> <br>  تحذير PVS-Studio: V519 CWE-563 يتم تعيين قيم المتغير "lastNamespaceDeclaration" مرتين على التوالي.  ربما هذا خطأ.  خطوط التحقق: 3188 ، 3194. qxmlstream.cpp 3194 <br><br>  سوف أسلط الضوء على جوهر الخطأ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inEmptyElement) { lastNamespaceDeclaration = tag.namespaceDeclarationsSize; } lastNamespaceDeclaration = namespaceDeclarations.size();</code> </pre> <br>  <b>عيب N96</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> QRollEffect::scroll() { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentHeight != totalHeight) { currentHeight = totalHeight * (elapsed/duration) + (<span class="hljs-number"><span class="hljs-number">2</span></span> * totalHeight * (elapsed%duration) + duration) / (<span class="hljs-number"><span class="hljs-number">2</span></span> * duration); <span class="hljs-comment"><span class="hljs-comment">// equiv. to int((totalHeight*elapsed) / duration + 0.5) done = (currentHeight &gt;= totalHeight); } done = (currentHeight &gt;= totalHeight) &amp;&amp; (currentWidth &gt;= totalWidth); .... }</span></span></code> </pre> <br>  V519 CWE-563 يتم تعيين المتغير "تم" مرتين متتاليتين.  ربما هذا خطأ.  تحقق من الخطوط: 509 ، 511. qeffects.cpp 511 <br><br>  كل شيء هو نفسه كما في الحالة السابقة.  لاحظ المتغير <i>المنجز</i> . <br><br><h2 style=";text-align:right;direction:rtl">  الخلاصة </h2><br>  حتى أثناء النظر في التقرير بشكل سطحي ، كتبت ما يقرب من 100 خطأ.  يسرني نتائج PVS-Studio. <br><br>  وبالطبع ، فإن عمليات التحقق من التعليمات البرمجية النادرة هذه لا علاقة لها بتحسين جودة وموثوقية التعليمات البرمجية.  فهي تُظهر فقط قدرات محلل الكود.  يجب تطبيق أدوات التحليل الثابت بانتظام.  في هذه الحالة ، تقلل من تكلفة إصلاح الأخطاء وحماية التطبيقات من العديد من الثغرات الأمنية المحتملة. <br><br>  شكرا لكم على اهتمامكم.  لمواكبة منشوراتنا الجديدة ، أدعوك للاشتراك في إحدى قنواتنا: <ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  VK.com: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">pvsstudio_rus</a> </li><li style=";text-align:right;direction:rtl">  "Old school" RSS: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">viva64-blog-ru</a> </li><li style=";text-align:right;direction:rtl">  تويتر: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">@ pvsstudio_rus</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">انستقرام</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">@ pvsstudio_rus</a> </li><li style=";text-align:right;direction:rtl">  برقية: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">pvsstudio_rus</a> </li></ol><br><p style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br><br>  إذا كنت تريد مشاركة هذه المقالة مع جمهور ناطق باللغة الإنجليزية ، فيرجى استخدام رابط الترجمة: Andrey Karpov.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">فحص ثالث لـ Qt 5 مع PVS-Studio</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar426485/">https://habr.com/ru/post/ar426485/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar426475/index.html">ميا - مساعد من الهاتف الذكي</a></li>
<li><a href="../ar426477/index.html">الحقيقة الكاملة عن RTOS. المادة رقم 15. أقسام الذاكرة: الخدمات وهياكل البيانات</a></li>
<li><a href="../ar426479/index.html">منضدة اختبار محلية الصنع للوحات الأم</a></li>
<li><a href="../ar426481/index.html">خرائط سداسية في الوحدة: مكتشف المسار وفرق اللاعبين والرسوم المتحركة</a></li>
<li><a href="../ar426483/index.html">الشخص الذي يتفوق على تسلا. لمزيد من الربح</a></li>
<li><a href="../ar426487/index.html">اختبار الأتمتة من الصفر. الجزء الأول</a></li>
<li><a href="../ar426489/index.html">في علاقة الأعداد الأولية وغير المنطقية</a></li>
<li><a href="../ar426491/index.html">أسبوع الأمن 39: في وفاة + Google</a></li>
<li><a href="../ar426493/index.html">خصومات ثابتة من المضيفين على VPS و VPS</a></li>
<li><a href="../ar426495/index.html">مصمم منفرد. كيفية بناء مهنة عندما تعمل بمفردك</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>