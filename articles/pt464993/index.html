<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐒 🔮 💇🏻 Construindo um pacote RPM para o Rosa Linux na prática 🕺🏼 🤬 👩🏽‍🤝‍👨🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Se você usa o sistema operacional Linux há muito tempo e até conhece um pouco de programação, mais cedo ou mais tarde poderá ser necessário compilar o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Construindo um pacote RPM para o Rosa Linux na prática</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464993/"><p>  Se você usa o sistema operacional Linux há muito tempo e até conhece um pouco de programação, mais cedo ou mais tarde poderá ser necessário compilar o programa a partir do código-fonte.  Talvez o programa desejado não esteja nos repositórios de distribuição.  Ou o programa possui uma versão antiga nesses repositórios e você precisa da versão mais recente.  Ou talvez você tenha criado um novo programa e queira compartilhá-lo com outros usuários. <br></p><br><p>  Obviamente, você pode instalar o programa de acordo com as instruções que acompanham o código-fonte.  Mas você precisará gerenciar manualmente os arquivos de programa e monitorar suas dependências.  É muito melhor criar um pacote com o programa e usar o gerenciador de aplicativos embutido no sistema operacional. <br></p><br><p>  Espero que este artigo ajude você a descobrir rapidamente como criar um pacote RPM para o <em>Rosa Linux</em> ou para outra distribuição que use o gerenciador de pacotes RPM (Mandriva, RedHat).  Ou pelo menos me diga onde procurar informações. <br></p><br><p>  Aqui vou mostrar como criar pacotes RPM no meu computador local, usando um exemplo simples.  Vamos construir o programa <em>xkb-switch</em> no <em>sistema</em> operacional <em>Rosa Linux</em> .  Nós pegaremos o código fonte do programa no <em>GitHub</em> . <br></p><br><br><a name="habracut"></a><br><br><div class="spoiler">  <b class="spoiler_title">O artigo está dividido em várias partes curtas, de modo que o índice esteja embaixo do spoiler</b> <div class="spoiler_text"><h2>  Sumário </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Um pouco sobre o Rosa Linux</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Um pouco sobre o xkb-switch</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Configurando, finalizando, verificando o programa</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Verificando o código fonte sem o seu perfil no GitHub</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Verificação ao salvar o projeto no seu perfil do GitHub</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Criando patches</a> </li></ul><br></li></ul><br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Prepare o "local de trabalho" para criar um pacote</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vamos começar a criar um arquivo de especificação</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Um pouco sobre a sintaxe do arquivo de especificação</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cabeçalho do arquivo Spec</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Preparação da fonte</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Compilação</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Instalação</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Embalagem de arquivo</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O que é rpmlint</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tipos de pacotes RPM para Rosa Linux</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Nosso resultado</a> </li></ul><br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Se você precisar dividir o pacote em partes</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Adicione algumas macros</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mude um pouco o título</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Definir pacotes de biblioteca</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Definir arquivos para pacotes</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Solução de problemas adicionais</a> </li></ul><br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Conclusão</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Equipas principais</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Comandos úteis para construir um pacote</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Verificando o pacote pronto</a> </li></ul><br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Links úteis (fontes principais)</a> </li></ul><br></div></div><br><br><a name="foreword"></a><br><h2>  Um pouco sobre o Rosa Linux </h2><br><p>  <em>Rosa Linux</em> é uma distribuição criada e suportada por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">desenvolvedores russos</a> .  É baseado no <em>Mandriva</em> , mas com alguns recursos.  Estou usando a versão de 32 bits do <em>Rosa Fresh R8</em> , lançada em 2014.  Agora, a versão <em>R8</em> não é mais suportada pelos desenvolvedores (os repositórios não são atualizados), mas funciona bem no meu laptop, portanto, não quero instalar uma nova versão. <br></p><br><p> <em>Rosa Fresh R8</em> Usa a área de trabalho do <em>KDE4</em> .  Todas as versões do pacote de distribuição usam gerenciadores de <code>rpm</code> e <code>urpm</code> para gerenciar pacotes com aplicativos, e os comandos correspondentes são <code>rpm</code> , <code>urpmi</code> , <code>urpme</code> , <code>urpmq</code> , <code>urpmf</code> . <br></p><br><p>  Os princípios de criação de pacotes de software geralmente raramente são alterados na mesma família de distribuição Linux.  Portanto, o que é descrito neste artigo deve funcionar em todas as versões das distribuições <em>Rosa</em> . <br></p><br><p>  Construir pacotes no Rosa Linux é um pouco mais simples do que em outras distribuições baseadas em <em>RPM</em> .  Alguns pontos são automatizados e não precisam ser configurados. <br></p><br><br><a name="foreword-xkb-switch"></a><br><h2>  Um pouco sobre o xkb-switch </h2><br><p>  Gostei da ideia de usar o plugin para o editor de texto Vim - <em>xkbswitch</em> , sobre o qual existe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um artigo sobre Habré</a> .  Ele muda automaticamente o layout do teclado para inglês quando você sai do modo de entrada e vice-versa - para aquele em que o texto foi inserido pela última vez - se você entrar no modo de entrada novamente.  Para que este plug-in funcione, você precisa do programa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">xkb-switch</a> , que permite alternar o layout do teclado na linha de comando e nos plug-ins do editor <em>Vim</em> .  Este programa não estava nos repositórios <em>Rosa Linux R8</em> (e provavelmente ninguém o adicionará, porque a distribuição já é antiga e o programa <em>xkb-switch</em> não <em>é</em> muito popular). <br></p><br><br><a name="test_program"></a><br><h2>  Configurando, finalizando, verificando o programa </h2><br><p>  Freqüentemente, é necessário configurar a compilação do programa para funcionar corretamente em uma distribuição específica ou mesmo para um sistema específico.  Acontece que um programa precisa ser construído com outras opções ou com o suporte de algum driver especial.  Ou talvez você queira corrigir erros no código do programa ou apenas verificar se funciona.  Para fazer isso, é melhor copiar o código-fonte para o seu computador antes de criar o pacote RPM, tente compilá-lo e verifique como o programa compilado funciona. <br></p><br><p>  Se você tiver certeza de que não precisará modificar os arquivos do projeto, poderá usar o código-fonte original do site do projeto e prosseguir imediatamente para compilar o pacote.  Mas se você precisar alterar as configurações de compilação, geralmente é muito mais fácil alterar o arquivo na pasta de origem (o chamado <em>makefile</em> ) do que lidar com as opções para os comandos de compilação e o dispositivo macro interno para o arquivo de especificação. <br></p><br><br><a name="test_program-local"></a><br><h3>  Verificando o código fonte sem o seu perfil no GitHub </h3><br><p>  Se você decidir trabalhar com o código-fonte ou as configurações de compilação do projeto, mas não tiver seu próprio perfil no GitHub ou não quiser usá-lo, basta baixar e descompactar o código-fonte.  No nosso caso, pode ser assim (eu uso a pasta <code>~/Projects/cpp</code> para código-fonte <em>C ++</em> ): <br></p><br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Projects/cpp git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/ierton/xkb-switch.git</code> </pre><br><br><p>  Isso criará a pasta <code>~/Projects/cpp/xkb-switch</code> contém o código-fonte.  Obviamente, em vez de usar o <code>git</code> você pode baixar o arquivo com o programa e descompactá-lo. <br></p><br><p>  No arquivo <code>README.md</code> na pasta do projeto, é fácil adivinhar que o utilitário <code>cmake</code> é usado para criar o programa.  Portanto, se você precisar alterar as configurações de compilação, no nosso caso elas estão no arquivo <code>CMakeLists.txt</code> .  E apenas tentamos compilar o programa e verificar se ele funciona.  Quais comandos você precisa usar para isso estão escritos no mesmo arquivo <code>README.md</code> na raiz do projeto. <br></p><br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> xkb-switch mkdir build &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> build cmake .. make ./xkb-switch <span class="hljs-comment"><span class="hljs-comment">#         ./xkb-switch -l #       ./xkb-switch -s ru #       (  )</span></span></code> </pre><br><br><p>  Depois disso, para usar o projeto alterado, você precisará limpar ou excluir a pasta de <code>build</code> do projeto e compactar o código-fonte no arquivo morto.  Pode ser assim: <br></p><br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Projects/cpp/xkb-switch rm -rf ./build <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Projects/cpp zip -r xkb-switch.zip xkb-switch</code> </pre><br><br><p>  O arquivo <code>xkb-switch.zip</code> precisará ser usado para criar o pacote. <br></p><br><br><a name="test_program-github"></a><br><h3>  Verificação ao salvar o projeto no seu perfil do GitHub </h3><br><p>  Suponho que qualquer pessoa que leia esta seção esteja ao menos um pouco familiarizada com o trabalho com o <em>git</em> e já tenha configurado um perfil no <em>GitHub</em> .  Penso que este método é o melhor, pelo que o resto do artigo implica que é utilizado, salvo indicação em contrário. <br></p><br><p>  Primeiro, você precisa inserir o projeto original no seu <em>GitHub</em> .  Depois disso, como no método anterior, clonamos o projeto em nosso computador, mas em nosso repositório (no meu caso, o nome de usuário é <em>alexandersolovyov</em> ): <br></p><br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Projects/cpp git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/alexandersolovyov/xkb-switch.git</code> </pre><br><br><p>  Para adicionar alterações, é melhor usar uma nova ramificação.  Então, se desejado, será possível usar diferentes versões do programa.  E também será possível propor alterações ao autor do projeto usando solicitações de recebimento.  Por exemplo, se você decidir corrigir um pouco o arquivo <code>CMakeLists.txt</code> , antes disso, será necessário criar uma nova ramificação com: <br></p><br><br><pre> <code class="bash hljs">git branch cmake_corrections</code> </pre><br><br><p>  Depois que as alterações são feitas, verificadas e adicionadas à ramificação (usando <code>git commit -am " "</code> ), você pode adicionar uma nova ramificação ao seu GitHub: <br></p><br><br><pre> <code class="bash hljs">git push origin cmake_corrections</code> </pre><br><br><p>  Depois disso, você pode fazer uma solicitação de recebimento, se necessário. <br></p><br><p>  Você pode criar um link para o repositório original: <br></p><br><br><pre> <code class="bash hljs">git remote add ierton https://github.com/ierton/xkb-switch.git</code> </pre><br><br><p>  E atualize a ramificação principal do seu repositório para que ela corresponda ao original: <br></p><br><br><pre> <code class="bash hljs">git pull ierton master</code> </pre><br><br><p>  O código do programa correspondente à ramificação corrigida pode ser usado ao criar o RPM.  Para fazer isso, você precisará especificar o endereço do arquivo morto no formulário no arquivo de especificação: <br></p><br><br><pre> <code class="plaintext hljs">Source0: https://github.com/-/-/archive/---.zip</code> </pre><br><br><p>  Mas, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">como o usuário do specblog solicitou</a> , esse não é realmente o caso.  É melhor transmitir suas alterações na forma de patches.  Para fazer isso, você precisa criar arquivos de correção a partir das alterações em sua ramificação e copiá-los para a pasta de origem para criar o pacote ( <code>~/rpmbuild/SOURCES/</code> ).  Então você precisará especificá-los no arquivo de especificações.  Consideraremos isso um pouco mais tarde, mas se você quiser, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pode ler aqui</a> .  Se você não sabe como criar patches, pode procurar no spoiler. <br></p><br><br><a name="test_program-github-patches"></a><br><div class="spoiler">  <b class="spoiler_title">Como criar patches usando git</b> <div class="spoiler_text"><h4>  Criando patches </h4><br><p>  <em>Patches</em> , são <em>Patches</em> - são arquivos nos quais as alterações são registradas no código-fonte do programa.  Eles são usados ​​como uma alternativa aos comandos <code>git pull</code> e <code>git push</code> para comunicação entre repositórios de códigos locais, se não for conveniente "puxar" alterações de um repositório remoto, ou o histórico de alterações do projeto e os princípios de trabalhar com ele são de tal forma que é melhor usar patches. <br></p><br><br><p>  Vamos imaginar que precisamos fazer alterações no arquivo <code>CMakeLists.txt</code> .  Primeiro, você precisa fazer tudo como descrito acima: o ramo <em>mestre</em> em nosso repositório GitHub deve corresponder ao ramo principal do projeto original e, para suas alterações, você precisa usar o ramo <em>cmake_corrections</em> .  Então você precisa ir para este ramo, fazer as alterações necessárias e salvá-las no <em>git</em> usando commits. <br></p><br><p>  Agora você precisa salvar as alterações como arquivos de correção na pasta <code>~/rpmbuild/SOURCES</code> (se você não estiver usando o Rosa Linux, o caminho para a pasta <code>SOURCES</code> poderá ser diferente).  Por exemplo, isso (quero dizer que estamos na pasta do projeto - por exemplo, <code>~/Projects/cpp/xkb-switch</code> - e no ramo <code>cmake_corrections</code> ): <br></p><br><pre> <code class="bash hljs">git format-patch -o ~/rpmbuild/SOURCES origin/master</code> </pre><br><p>  O comando <code>git format-patch</code> cria um arquivo de <code>git format-patch</code> para cada confirmação.  Nesse formulário, ele fará patches começando na confirmação especificada pelo último argumento e terminando na última confirmação da ramificação atual.  Você pode especificar uma confirmação de qualquer maneira: no início do hash, usando o ponteiro <em>HEAD</em> ou o nome da ramificação, que agora indica a confirmação desejada.  O principal é que uma das confirmações visíveis quando o <code>git log</code> executado é tomada como início.  Ou seja, não é possível começar a fazer correções a partir de uma consolidação que esteja em outra ramificação. <br></p><br><p>  E você pode lembrar (ou ver) quantos commits de volta nós ramificamos da ramificação principal e fazer correções para um certo número de commits de volta.  Por exemplo, se fizermos duas confirmações, o comando seria: <br></p><br><pre> <code class="bash hljs">git format-patch -o ~/rpmbuild/SOURCES -2</code> </pre><br><p>  Aqui, o número de confirmações é definido usando <code>-2</code> .  Você pode especificar qualquer número deles em vez desta figura. <br></p><br><p>  Você pode especificar o intervalo de confirmações a partir das quais as correções devem ser feitas colocando dois pontos entre os links para as confirmações inicial e final: <br></p><br><pre> <code class="bash hljs">git format-patch -o ~/rpmbuild/SOURCES master..cmake_corrections</code> </pre><br><p>  O nome de cada arquivo de correção consiste em um número de série e na primeira linha de um comentário de confirmação.  Portanto, é melhor renomear cada arquivo para que a descrição do patch descreva de maneira mais rápida e clara sua essência.  Por exemplo, assim: <br></p><br><pre> <code class="bash hljs">mv 0001-Return-memory-allocated-by-XkbRf-getNamesProp()-<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>-tmp.patch 001-Fix-memory-leak.patch</code> </pre><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a convenção de nomenclatura para correções no artigo sobre a sintaxe do arquivo spec</a> recomenda adicionar <em>package_name-version-rosa-</em> antes da descrição de cada arquivo de correção.  Talvez essa seja uma boa prática se você enviar correções por email, mas não para criar pacotes.  Como construímos pacotes em nosso computador, é melhor esvaziar a pasta <code>~/rpmbuild/SOURCES</code> todas as vezes antes de <code>~/rpmbuild/SOURCES</code> pacote com outro programa ou um novo pacote de versão. <br></p><br><p>  Agora, se você precisar atualizar o ramo principal do repositório ( <em>mestre</em> ) para corresponder ao original, depois disso, o ramo de mudança ( <em>cmake_corrections</em> ) precisará ser atualizado usando o <code>git rebase</code> .  Você <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pode ver</a> como fazer isso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  Depois disso, os patches precisarão ser recriados. <br></p><br></div></div><br><br><a name="prepare"></a><br><h2>  Prepare o "local de trabalho" para criar um pacote </h2><br><p>  Primeiro você precisa criar uma estrutura de diretórios.  Toda a montagem ocorre na pasta <code>rpmbuild</code> na pasta inicial do <code>rpmbuild</code> .  Crie a estrutura de diretório inicial e vá para a pasta dos arquivos de especificação: <br></p><br><br><pre> <code class="bash hljs">mkdir -p ~/rpmbuild/SPECS &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/rpmbuild/SPECS</code> </pre><br><br><p>  Para o Rosa Linux, basta: as pastas restantes serão criadas automaticamente. <br></p><br><p>  Outra distribuição pode usar um local de arquivo diferente para criar o pacote.  E talvez você precise criar manualmente toda a hierarquia de pastas.  Procure informações para sua distribuição se você não estiver usando o Rosa Linux.  Por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">isso pode ser assim no Red Hat</a> . <br></p><br><p>  Se o pacote tiver sido construído com erros, todos os arquivos criados pelo comando <code>rpmbuild</code> não <code>rpmbuild</code> excluídos - o mesmo que com uma compilação bem-sucedida.  Vamos tentar coletar o pacote várias vezes, e os arquivos restantes após a última vez irão interferir.  Portanto, é melhor criar um script simples que ajude a removê-los rapidamente.  Crie um arquivo cleanup.sh e coloque-o na <code>~/rpmbuild/SPECS</code> .  Aqui está o seu conteúdo: <br></p><br><br><pre> <code class="bash hljs">!<span class="hljs-comment"><span class="hljs-comment">#/bin/sh rm -rf ~/rpmbuild/BUILD/* rm -rf ~/rpmbuild/BUILDROOT/* rm -rf ~/rpmbuild/RPMS/* rm -rf ~/rpmbuild/SRPMS/*</span></span></code> </pre><br><br><p>  Obviamente, é melhor adicionar direitos de execução usando o <code>chmod u+x cleanup.sh</code> . <br></p><br><p>  Se você deseja coletar um pacote de arquivos que estão no computador local - se você não está usando o <em>GitHub</em> e fez alterações nos arquivos do projeto, ou deseja criar um pacote a partir do seu próprio programa, que é armazenado apenas no seu computador - você precisa compactar o projeto em um arquivo morto ( por exemplo, <code>.zip</code> , <code>.tar</code> ou <code>.tar.gz</code> ) e coloque-o na pasta <code>SOURCES</code> .  Por exemplo, assim: <br></p><br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Projects/cpp/ zip -r xkb-switch.zip xkb-switch mkdir -p ~/rpmbuild/SOURCES cp xkb-switch.zip ~/rpmbuild/SOURCES/</code> </pre><br><br><p>  Se, após a criação do programa, você desejar criar outra versão igual ou diferente, mas diferente, será necessário excluir todos os arquivos da pasta <code>~/rpmbuild/SOURCES</code> e, em seguida, copiar o arquivo morto (se você não fizer o download no <em>GitHub</em> ) e arquivos de correção (se usados).  Caso contrário, o arquivo morto provavelmente não será baixado do <em>GitHub</em> (por que - veja mais adiante), e também será difícil descobrir qual arquivo de correção pertence a qual programa. <br></p><br><br><a name="specfile_start"></a><br><h2>  Vamos começar a criar um arquivo de especificação </h2><br><p>  A base para a criação de um pacote RPM é o chamado <em>arquivo speck</em> .  Este arquivo contém as instruções para o programa <code>rpmbuild</code> (ou melhor, <code>rpm</code> ) necessárias para a construção do pacote. <br></p><br><p>  Crie o arquivo <code>xkb-switch.spec</code> na <code>~/rpmbuild/SPECS/</code> .  A maneira mais fácil de começar é com um modelo que pode ser encontrado no site <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Arquivos de especificação de modelo</a> . <br></p><br><p>  No <code>README</code> na página do projeto <em>xkb-switch</em> , <em>é</em> sabido que o programa é compilado usando o utilitário <code>cmake</code> .  Portanto, selecionaremos o <strong>arquivo Spec para um programa criado usando o CMake</strong> e copiaremos o modelo inteiro em nosso arquivo spec.  Obviamente, para montar adequadamente nosso pacote RPM, esse modelo precisa ser muito alterado, o que faremos. <br></p><br><br><a name="specfile_syntax"></a><br><h2>  Um pouco sobre a sintaxe do arquivo de especificação </h2><br><ul><li>  A sintaxe do arquivo spec permite adicionar comentários no estilo bash. <br></li><li>  Você pode usar espaços como os espaços entre os valores na mesma linha para criar a aparência de colunas pares, mas a documentação recomenda enfaticamente o uso do caractere de tabulação (um ou dois, desde que as colunas sejam pares).  <strong>Nota:</strong> em todos os exemplos de código deste artigo, apenas espaços são usados; portanto, é melhor não copiar todo o texto daqui para seu arquivo de especificação, mas imprimi-lo você mesmo. <br></li><li>  Os campos de opção consistem em um nome de opção especial com dois pontos e o próximo valor através de guias (ou espaços).  O caso de caracteres nos nomes dos campos não importa.  Por exemplo: <br><pre> <code class="plaintext hljs"> Name: xkb-switch</code> </pre><br></li><li>  Se a palavra for precedida pelo símbolo <code>%</code> (por exemplo, <code>%description</code> ), essa é uma palavra-chave especial.  Pode ser uma chamada de comando, macro ou script.  Depois disso, os parâmetros que ele usa podem ser indicados.  E há palavras-chave que indicam o início de um bloco de comandos ou opções.  Em seguida, os parâmetros podem ser indicados próximos a ele e nas próximas linhas deve haver comandos ou uma lista de opções que descrevi no parágrafo anterior.  Após esse bloco, uma linha vazia deve ser deixada. <br></li><li>  Para usar o valor de uma constante, você precisa inserir uma construção do formulário <code>%{_}</code> .  Seu valor pode ser predefinido ou pode ser determinado por uma opção (por exemplo, <code>Name: xkb-switch</code> ) ou usando a palavra-chave <code>%define</code> .  Todas essas constantes também são consideradas macros.  Seu uso será discutido em mais detalhes abaixo. <br></li></ul><br><br><a name="specfile_header"></a><br><h2>  Cabeçalho do arquivo Spec </h2><br><p>  No arquivo de especificações, o cabeçalho é sempre escrito primeiro.  Esta é uma lista de opções que se aplicam ao pacote principal do RPM.  Quando o pacote estiver pronto, quase todas essas informações serão exibidas ao visualizar sua descrição.  Aqui está o que as linhas individuais indicam: <br></p><br><br>  <b>Resumo:</b> <br>  Uma breve descrição do pacote.  Espiei a descrição no arquivo <code>README.md</code> no projeto <em>xkb-switch</em> : <code>Query and change XKB layout state</code> . <br><br>  <b>Nome:</b> <br>  O nome do pacote.  No nosso caso, este é o <code>xkb-switch</code> . <br><br>  <b>Versão:</b> <br>  Versão do programa.  Para descobrir, é melhor consultar o arquivo <code>CMakeLists.txt</code> na pasta raiz do projeto.  Obviamente, você precisa tirar o arquivo da cópia do projeto que será usado para a montagem.  Se você usar o projeto original, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">poderá abrir o arquivo diretamente na página do GitHub</a> .  Como você pode ver, a versão é composta por <code>MAJOR_VERSION</code> , <code>MINOR_VERSION</code> e <code>RELEASE_VERSION</code> .  Eu usei a versão do programa <code>1.6.0</code> . <br><br>  <b>Lançamento:</b> <br>  O número da versão do próprio pacote.  Exibe a hora em que um pacote com um programa da mesma versão está sendo montado.  No nosso caso, é "1", pois ninguém jamais montou um programa desta versão.  No caso ideal, se já tentamos criar o pacote e o assembly chegou ao fim (mesmo que houvesse erros), depois de cada nova tentativa, é necessário aumentar esse número em 1 e, ao mesmo tempo, não exclua os pacotes coletados antigos das <code>rpmbuild/SRPMS</code> <code>rpmbuild/RPMS</code> e <code>rpmbuild/SRPMS</code> : Em seguida, novos pacotes com um novo número de compilação serão criados.  Talvez isso deva ser feito se você usar um servidor especial para montagem.  Nós usamos nosso computador e, em vez disso, limparemos as pastas.  Se um pacote com um programa desta versão já estiver nos repositórios da distribuição Linux, mas você estiver compilando com outras configurações, é melhor especificar o número do release 1 a mais que esse pacote. <br><br>  <b>Licença:</b> <br>  O nome abreviado da licença sob a qual o programa é distribuído.  De acordo com as regras do Rosa Linux, você só pode criar pacotes com uma licença que permita a distribuição gratuita.  <code>README.md</code> pode descobrir no arquivo <code>README.md</code> que a licença é <em>GNU GPLv3</em> .  Então, escrevemos: <code>GPLv3+</code> . <br><br>  <b>Grupo:</b> <br>  O grupo ou categoria à qual o programa pertence.  Usando esses grupos, os programas são classificados no menu de inicialização do aplicativo e no gerenciador de programas da janela (“Adicionar ou remover programas”).  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A lista de grupos para o Rosa Linux pode ser encontrada aqui</a> .  Eu acho que o <code>Development\X11</code> é melhor para nós, pois o programa está relacionado ao X11 e é principalmente necessário para criar scripts e plugins para o Vim. <br><br>  <b>URL:</b> <br>  Endereço da Internet em que você pode baixar o código fonte original do programa.  Será especificado ao visualizar as informações do pacote RPM.  Este item é opcional, mas indicaremos: <code>https://github.com/ierton/xkb-switch</code> <br><br>  <b>Fonte0:</b> <br>  O nome do arquivo que contém o código-fonte ou o endereço da Internet em que pode ser baixado.  Se você especificar um endereço na Internet, durante a primeira compilação, o arquivo será baixado para <code>~/rpmbuild/SOURCES/</code> .  Se esse arquivo já existir, ele não será mais baixado, ou seja, o programa <code>rpmbuild</code> usará apenas o nome do arquivo especificado no final desta URL.  Você pode especificar apenas o nome do arquivo, mas ele precisará ser colocado na pasta <code>~/rpmbuild/SOURCES/</code> manualmente.  É melhor fornecer o endereço da sua cópia do projeto no GitHub.  Usei o arquivo <code>https://github.com/alexandersolovyov/xkb-switch/archive/master.zip</code> .  Você pode especificar várias fontes diferentes para coletar as fontes de vários arquivos com a ajuda de um arquivo pontilhado.  Em seguida, no nome da opção para adicionar cada arquivo subsequente, o número deve aumentar ( <code>Source2</code> , <code>Source2</code> , etc.).  Esses endereços de arquivo não são visíveis ao exibir as informações do pacote RPM. <br><br>  <b>Patch0:</b> <br>  Esta opção não está no arquivo de modelo.  Pode ser útil se você decidir transferir suas alterações nos arquivos de projeto do programa na forma de patches.  Quanto à opção <code>Source0</code> , cada arquivo deve ser indicado em uma linha separada, e o número no final do nome da opção deve aumentar a cada vez.  Os arquivos de correção devem estar localizados na pasta <code>~/rpmbuild/SOURCES</code> (ao lado do arquivo de origem baixado).  O nome de cada arquivo deve ser escrito sem um caminho para ele.  Não é necessário especificar todos os arquivos de correção aqui - apenas aqueles que você deseja aplicar podem ser usados. <br><br>  <b>BuildRequires:</b> <br>  Pacotes necessários para construir o programa.  O modelo <code>cmake</code> .  O arquivo <code>CMakeLists.txt</code> indica que a versão mínima do CMake para montagem não deve ser inferior a <em>2,6</em> ; portanto, é melhor especificar <code>cmake &gt;= 2.6</code> .  Você pode adicionar outros pacotes, cada um em uma linha separada, usando a opção <code>BuildRequires:</code> separada.  A lista de pacotes necessários para montagem pode ser encontrada lendo o <code>README</code> do projeto e analisando atentamente o arquivo <code>CMakeLists.txt</code> (especialmente as <code>FIND_PACKAGE</code> , <code>TARGET_LINK_LIBRARY</code> , <code>FIND_PROGRAM</code> ).  Em seguida, você precisa encontrar o nome do pacote correto nos repositórios usando o comando <code>urpmq -a __</code> .  No nosso caso, o arquivo de configurações de compilação ( <code>CMakeLists.txt</code> ) já contém linhas que verificam a presença dos pacotes necessários no sistema.  Mas é melhor especificar a lista inteira aqui também: <br><pre> <code class="plaintext hljs"># CMake  2.6   BuildRequires: cmake &gt;= 2.6 #  C/C++ BuildRequires: gcc #    libxkbfile BuildRequires: libxkbfile-devel #   X11   libxkbfile, #  libx11-devel   . #    man: BuildRequires: xz</code> </pre><br><br>  <b>Requer:, Fornece:</b> <br>  Essas opções não estão na amostra, mas às vezes podem ser úteis.  Eles estabelecem dependências entre pacotes.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A opção </font></font><code>Provides</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">especifica os </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recursos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fornecidos pelo pacote que está sendo construído. Este pode ser o nome do arquivo de linguagem de cabeçalho </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ou dinâmico nome da biblioteca de link, ou qualquer função especial. E a opção </font></font><code>Requires</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indica em quais </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recursos de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> outros pacotes o pacote depende. Package Manager ( </font></font><code>rpm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>urpm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou outras pessoas que utilizam a sua distribuição), na busca de dependências que procuram estas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oportunidades</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em vez de nomes de pacotes. Portanto, </font></font><code>Provides</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é melhor indicar a versão da </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oportunidade</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fornecida </font><font style="vertical-align: inherit;">e para </font></font><code>Requires</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quais versões das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oportunidades</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fornecidas </font><font style="vertical-align: inherit;">são adequadas. A versão é indicada por sinais </font></font><code>&gt;=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ou </font></font><code>&lt;=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cercado por espaços. Normalmente, todas as opções são indicadas primeiro </font></font><code>Requires</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, depois - </font></font><code>Provides</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, um nome de recurso por linha - o mesmo que para </font></font><code>BuildRequires:</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Normalmente, ao criar pacotes no Rosa Linux, as dependências são reconhecidas automaticamente e essas opções raramente precisam ser especificadas. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoReq:, AutoProv:</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se você estiver </font><b><font style="vertical-align: inherit;">criando um</font></b><font style="vertical-align: inherit;"> programa que está escrito em um idioma em que o gerenciador de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpm</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é </font><font style="vertical-align: inherit;">novo ou proprietário e as dependências não são detectadas corretamente automaticamente, é possível desativar a detecção automática de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recursos</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (com </font></font><code>AutoProv: no</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) e / ou </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dependências</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (com ajuda </font></font><code>AutoReq: no</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% descrição</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este bloco não faz mais parte do cabeçalho, mas está associado a ele. </font><font style="vertical-align: inherit;">Ele adicionará uma descrição completa do programa ao pacote RPM. </font><font style="vertical-align: inherit;">Uma linha vazia deve ser deixada depois dela. </font><font style="vertical-align: inherit;">A descrição pode ser a seguinte:</font></font><br><pre> <code class="plaintext hljs">%description xkb-switch is a C++ program that allows to query and change the keyboard layout state for X11 Window System (XKB) via command line. It provides a command 'xkb-switch', and bindings for API of the Vim text editor via 'libxkbswitch.so'. It is mainly used by a plugin for Vim text editor, vim-xkbswitch. Originally ruby-based code written by J.Broomley.</code> </pre><br><br><br><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As linhas do modelo que começam com </font></font><code>%files</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>%find_lang</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">são necessárias apenas se você criar um aplicativo com suporte para vários idiomas, portanto, exclua-os.</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Além disso, após o comentário da linha divisória, seguido por comandos e macros que devem ser concluídos antes de compactar os arquivos. </font><font style="vertical-align: inherit;">Todos esses comandos são divididos em blocos definidos usando palavras-chave especiais.</font></font></p><br><br><a name="prep"></a><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Preparação da fonte </font></font></h2><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O primeiro é um bloco </font></font><code>%prep</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que indica os comandos para se preparar para a compilação. </font><font style="vertical-align: inherit;">Nele está um comando macro </font></font><code>%setup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ela executa um script que faz o seguinte:</font></font></p><br><br><ul><li>       ,      <code>SourceX:</code>    (  —  <code>Source0:</code> ).         ,    . <br></li><li>      <code>~/rpmbuild/SOURCES/</code> . <br></li><li>      <code>~/rpmbuild/BUILD/</code> . <br></li><li>      . <br></li></ul><br><br><p>   <code>-q</code> ,       . </p><br><p>     ,     <code>%prep</code> : </p><br><br><pre> <code class="bash hljs">rpmbuild -bp ~/rpmbuild/SPECS/xkb-switch.spec</code> </pre><br><br><p>     <code>rpmbuild</code> .       ,      <code>rpm</code>    : <code>rpmbuild</code>    ,      .           (   <code>root</code>    <code>sudo</code> ).    <code>rpmbuild</code>  ,  <code>man rpmbuild</code> .      ,       ,   , —  ,          <code>rpmbuild</code> . <br></p><br><p>      : <code>xkb-switch-1.6.0: No such file or directory</code> .    ,          <code>~/rpmbuild/BUILD/xkb-switch-1.6.0</code> ,  .   <br></p><br><br><pre> <code class="bash hljs">ls ~/rpmbuild/BUILD/</code> </pre><br><br><p> ,     <code>xkb-switch-master</code> .     <code>%setup</code>    <code>-n</code> .    <code>%prep</code>  -   : <br></p><br><br><pre> <code class="bash hljs">%prep %setup -q -n xkb-switch-master</code> </pre><br><br><p>    <code>~/rpmbuild/SPECS/cleanup.sh</code> ,    <code>BUILD</code> ,     ,   <code>%prep</code> .  ,     <code>exit 0</code> .  ,     . <br></p><br><p>          ,         .       <code>%prep</code> .       ,    ,      : <br></p><br><pre> <code class="plaintext hljs">%apply_patches</code> </pre><br><p>       <code>rpmbuild -bp xkb-switch.spec</code> .    —    . <br></p><br><p>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  Maximum RPM</a> . <br></p><br><p>    . <br></p><br><br><a name="build"></a><br><h2>  </h2><br><p>      <code>%build</code> .   <code>README</code>  ,     <code>cmake ..</code>  <code>make</code> ,     -   .  :           ,     .    ,        <code>%build</code> : <br></p><br><br><pre> <code class="bash hljs">~/rpmbuild/SPECS/cleanup.sh rpmbuild -bc ~/rpmbuild/SPECS/xkb-switch.spec</code> </pre><br><br><p>     <code>exit 0</code> :    . <br></p><br><p> ,         .     shell (  bash  zsh,     ).  <code>rpmbuild</code>      ,           .    shell    - —        . (    .) <br></p><br><p>     -  , ,  ,     <code>%build</code>  shell  . <br></p><br><p>     ,    ,   .      <code>cmake</code> , , ,        <code>%cmake</code>      -  ,      ,    .         (   — <code>CMakeLists.txt</code> ).             ,    . <br></p><br><br><a name="install"></a><br><h2>  Instalação </h2><br><p> , <em></em> .   <code>%install</code>   ,               ,     ,    <code>~/rpmbuild/BUILDROOT/__-buildroot/</code> . <br></p><br><p>  <code>__</code>    ,     <code>Name:</code>   -,   ( <code>Version:</code>  -),   ( <code>Release:</code>  -),  ,     . <br></p><br><p>   <code>README</code>  ,     <code>make install</code> ,    <code>build</code>   .  - - <code>%makeinstall_std -C build</code>    ,   .       ( ,   ): <br></p><br><br><pre> <code class="bash hljs">~/rpmbuild/SPECS/cleanup.sh rpmbuild -bi ~/rpmbuild/SPECS/xkb-switch.spec</code> </pre><br><br><p>      ,       RPM.   -   ,     . <br></p><br><br><a name="packing"></a><br><h2>   </h2><br><p>         ,      -  .     ,     <code>~/rpmbild/BUILDROOT/</code> . ( , ,     <code>tree</code> ,  -      Linux.)  ,       ,       <code>.debug</code> .    , ,    :        . <br></p><br><p>  ,       ,   <code>%files</code>  -.   ,     ,      .  . <br></p><br><p>       <code>%files</code>  -.  ,    .   Rosa Linux       <code>%prep</code> (  -   ).   ,   ,     ,  ,        —   .          - (,    ,     ). <br></p><br><p>   <code>%files</code>    ,      RPM. ,     : <br></p><br><br><pre> <code class="plaintext hljs">%files %{_bindir}/%{name} %{_libdir}/libxkbswitch.so %{_libdir}/libxkbswitch.so.1 %{_libdir}/libxkbswitch.so.%{version} %{_mandir}/man1/%{name}.1.xz</code> </pre><br><br><p>         -.   , ,     <code>/usr/lib/rpm/macros</code> .  , <code>%{_bindir}</code>     , <code>%{_libdir}</code> —   ,  <code>%{_mandir}</code> —    man.   <code>%{name}</code>  <code>%{version}</code>    <code>Name:</code>  <code>Version:</code>   -. <br></p><br><p>     : <br></p><br><br><pre> <code class="bash hljs">~/rpmbuild/SPECS/cleanup.sh rpmbuild -ba ~/rpmbuild/SPECS/xkb-switch.spec</code> </pre><br><br><p> …   2   1 .    <code>rpmlint</code> ,      .  ,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> Rpmlint Errors</a>  ,   : <br></p><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`xkb-switch.i586: E: versão incoerente no nome (validade: 50) 1`</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Erro: a versão no nome do pacote da biblioteca não está especificada corretamente. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`xkb-switch.i586: E: executável na biblioteca-pacote (Badness: 1) / usr / bin / xkb-switch`</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Erro: o pacote da biblioteca contém um arquivo executável. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`xkb-switch.i586: W: arquivo devel-em-non-devel-pacote / usr / lib / libxkbswitch.so`</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aviso que um arquivo de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pacote de desenvolvimento</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><code>-devel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) foi encontrado em um pacote que não foi desenvolvido para desenvolvimento.</font></font><br><br><br><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Está tudo claro? </font><font style="vertical-align: inherit;">Eu acho que não. </font><font style="vertical-align: inherit;">Vamos dar uma olhada no que está acontecendo aqui.</font></font><br></p><br><br><a name="packing-rpmlint"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O que é rpmlint </font></font></h3><br><p>     Rosa Linux  <code>rpmbuild</code>   <code>rpmlint</code> ,    .  <code>rpmlint</code>    ,   ,      .   ,     Rosa Linux (  ,     <code>rpmlint</code> )     . <br></p><br><p>     ,     ,      .       <code>~/rpmbuild/RPMS/_/</code>         <code>rpmlint -i __</code> . <br></p><br><p> ,      RPM   - ,  ,    ,  ,      Rosa Linux,      <code>rpmlint -i __</code> . <br></p><br><br><a name="packing-package_types"></a><br><h3>   RPM  Rosa Linux </h3><br><p>   Rosa Linux   6 .   ,          . <br></p><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pacote executável</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> É binário. Ele contém apenas um arquivo ou script binário destinado diretamente à execução. Os arquivos desses pacotes costumam ser instalados em uma pasta </font></font><code>/bin/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou em </font></font><code>/usr/bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Também pode conter links - para a possibilidade de chamar o programa usando vários nomes diferentes. O nome do pacote corresponde ao nome do programa. Esses pacotes geralmente dependem da biblioteca. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Biblioteca</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Contém arquivos compilados de </font><b><font style="vertical-align: inherit;">bibliotecas</font></b><font style="vertical-align: inherit;"> dinamicamente conectadas ("compartilhadas", "compartilhadas") usadas pelos programas. Normalmente, esse é o próprio arquivo da biblioteca, cujo nome termina com a versão e um link para esse arquivo, cujo nome termina com o primeiro número da versão. Por exemplo, para uma biblioteca </font></font><code>libxkbfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">versão 1.0.2, será um arquivo </font></font><code>libxkbfile.so.1.0.2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e um link para ele,</font></font><code>libxkbfile.so.1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. O próprio nome do pacote da biblioteca, pelo qual é reconhecido no repositório do instalador, termina com o primeiro número da versão e começa com o prefixo </font></font><code>lib</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. A biblioteca tem o </font></font><code>libxkbfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nome correto - </font></font><code>libxkbfile1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Isso ocorre porque geralmente o número da primeira versão muda apenas com alterações incompatíveis da biblioteca e, portanto, será possível instalar vários pacotes com uma biblioteca de versões diferentes se alguns programas usarem a versão antiga da biblioteca e outros usarem uma versão mais recente. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pacote para desenvolvedores</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Arquivos necessários para compilar programas que usam a biblioteca, mas desnecessários para o trabalho de programas prontos. Para programas </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C ++</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> simples </font><font style="vertical-align: inherit;">, este é um link para o arquivo da biblioteca, mas sem versões no nome (por exemplo,</font></font><code>libxkbfile.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), bem como arquivos de cabeçalho (com a extensão </font></font><code>.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Nome do pacote termina com </font></font><code>-devel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, por exemplo: </font></font><code>libxkbfile-devel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Durante a instalação, sempre depende da biblioteca apropriada. Por exemplo, o pacote </font></font><code>libxkbfile-devel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">depende </font></font><code>libxkbfile1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Código Fonte Os</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> repositórios Rosa Linux possuem pacotes RPM que contêm o código fonte para alguns programas - basicamente apenas aqueles que </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">realmente precisam ser</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reconstruídos. Os nomes desses pacotes terminam com </font></font><code>-src</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>-source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(por exemplo, </font></font><code>apache-source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><code>rpmbuild</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sempre cria esse pacote automaticamente e o coloca </font></font><code>~/rpmbuild/SRPMS/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Símbolos de depuração</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta é uma informação que pode ser usada para depurar um programa concluído. </font><font style="vertical-align: inherit;">Ele associa locais em arquivos compilados ao código fonte. </font><font style="vertical-align: inherit;">Esses pacotes são criados </font></font><code>rpmbuild</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">automaticamente </font><font style="vertical-align: inherit;">pela equipe </font><font style="vertical-align: inherit;">, e um final é atribuído ao seu nome </font></font><code>-debuginfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Não encontrei esses pacotes nos repositórios do Rosa Linux. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Documentação Os</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> repositórios do Rosa Linux possuem pacotes de documentação para vários programas e bibliotecas. </font><font style="vertical-align: inherit;">Eu (por enquanto) não conheço os recursos para compilar esses pacotes. </font><font style="vertical-align: inherit;">Seus nomes geralmente terminam em </font></font><code>doc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: por exemplo </font></font><code>libx11-doc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>java-1.7.0-openjdk-javadoc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">A propósito, quase todos eles são feitos no estilo de sites e, para visualizá-los, é melhor abrir um navegador, acessar o endereço </font></font><code>file:///usr/share/doc/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e selecionar a pasta e o arquivo desejados.</font></font><br><br><br><br><a name="packing-result"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nosso resultado </font></font></h3><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Agora tudo ficou mais claro. </font></font><br></p><br><br><ul><li>    <code>xkb-switch</code>   <code>libxkbswitch.so</code> , ,  ,    <em>  </em> .   ,          : <code>xkb-switch.i586: W: devel-file-in-non-devel-package /usr/lib/libxkbswitch.so</code> . <br></li><li>     <em></em> ,      <code>/usr/lib/libxkbswitch.so.1</code>  <code>/usr/lib/libxkbswitch.so.1.6.0</code> .       ,       .  : <code>xkb-switch.i586: E: executable-in-library-package (Badness: 1) /usr/bin/xkb-switch</code> . <br></li><li>    ,          (1).   : <code>xkb-switch.i586: E: incoherent-version-in-name (Badness: 50) 1</code> . <br></li></ul><br><br><p> ,  <code>rpmlint</code> ,     .          .   <em>xkb-switch</em> ,      <code>libxkbswitch.so.1.6.0</code>       ,        <em>Vim</em> .            <em>xkb-switch</em> ,          <em>C</em>  <em>C++</em> .  RPM-    . <br></p><br><p>       -: <br></p><br><br><div class="spoiler"> <b class="spoiler_title">-   xkb-switch</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Summary: Query and change XKB layout state Name: xkb-switch Version: 1.6.0 Release: 1 License: GPLv3+ Group: Development/X11 URL: https://github.com/ierton/xkb-switch Source0: https://github.com/alexandersolovyov/xkb-switch/archive/master.zip BuildRequires: cmake &gt;= 2.6 BuildRequires: gcc BuildRequires: libxkbfile-devel BuildRequires: xz %description xkb-switch is a C++ program that allows to query and change the keyboard layout state for X11 Window System (XKB) via command line. It provides a command 'xkb-switch', and bindings for API of the Vim text editor via 'libxkbswitch.so'. It is mainly used by a plugin for Vim text editor, vim-xkbswitch. Originally ruby-based code written by J.Broomley. %files %{_bindir}/%{name} %{_libdir}/libxkbswitch.so %{_libdir}/libxkbswitch.so.1 %{_libdir}/libxkbswitch.so.%{version} %{_mandir}/man1/%{name}.1.xz #------------------------------------------------------------------ %prep %setup -q -n xkb-switch-master %build %cmake %make %install %makeinstall_std -C build</code> </pre><br></div></div><br><br><a name="subpackaging"></a><br><h2>       </h2><br><p>        — ,         .    ,  ,       <code>xkb-switch</code>  3 : <em></em> , <em></em>   <em></em> . : <br></p><br><br><ul><li>  <em></em>     <code>/usr/bin/xkb-switch</code>    <code>/usr/share/man/man1/xkb-switch.1.xz</code> , <br></li><li>  <em></em> —  <code>/usr/lib/libxkbswitch.so.1</code>  <code>/usr/lib/libxkbswitch.so.1.6.0</code> , <br></li><li>    <em> </em> — <code>/usr/lib/libxkbswitch.so</code> . <br></li></ul><br><br><p>       -.  ,   , <br>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  - Maximum RPM</a> .     <a href=""> -  libxkbfile</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   Rosa Linux</a> . <br></p><br><p>    . <br></p><br><br><a name="subpackaging-macros"></a><br><h3>    </h3><br><p>        —   <a href="">-  libxkbfile</a> .     -  : <br></p><br><br><pre> <code class="plaintext hljs">%define major 1 %define libname %mklibname xkbswitch %{major} %define develname %mklibname -d xkbswitch</code> </pre><br><br><p>    <code>%define</code>  .        ,    (     ) —   ,       .     ,    <code>%{major}</code>   <code>1</code> ,      . <br></p><br><p>  <code>%mklibname</code>   «lib»,     ,      —   (  ).     <code>%{libname}</code>  <em>«lib» + «xkbswitch» + (  %{major}) =</em> <code>libxkbswitch1</code> —   . <br></p><br><p>  <code>-d</code>  <code>%mklibname</code>   <code>-devel</code> .    <code>%{develname}</code>  <code>libxkbswitch-devel</code> —    . <br></p><br><br><a name="subpackaging-change_header"></a><br><h3>    </h3><br><p>     <code>Version:</code>   <br></p><br><br><pre> <code class="plaintext hljs">Version: %{major}.6.0</code> </pre><br><br><p>  ,           -. <br></p><br><p>      -       .      .      : <br></p><br><pre> <code class="plaintext hljs">Name: xkb-switch Version: %{major}.6.0 Release: 1 Summary: Query and change XKB layout state License: GPLv3+ Group: Development/X11 URL: https://github.com/alexandersolovyov/xkb-switch Source0: https://github.com/alexandersolovyov/xkb-switch/archive/master.zip BuildRequires: cmake &gt;= 2.6 BuildRequires: gcc BuildRequires: libxkbfile-devel BuildRequires: xz %description xkb-switch is a C++ program that allows to query and change the keyboard layout state for X11 Window System (XKB) via command line. It provides a command 'xkb-switch', and bindings for API of the Vim text editor, a library 'libxkbswitch'. It is mainly used for some plugins for Vim text editor, such as vim-xkbswitch. Originally ruby-based code written by J.Broomley.</code> </pre><br><br><a name="subpackaging-packages"></a><br><h3>    </h3><br><p>     <em>-</em>     . <em>-</em>   , -      (    <em>rpm</em> ).       <code>%package</code> .        -.     ,    -.          <code>Version</code> , <code>Summary</code> , <code>Group</code> .      <code>Provides</code>  <code>Requires</code>   <em></em>  <em></em> ,     .  <code>Name</code>   :    ,     <code>%package</code> . <br></p><br><p>      .     <code>%description</code>       —   ,     <code>%package</code> . <br></p><br><p>  Rosa Linux   -   <code>%description</code>  -.    <code>libxkbswitch1</code> : <br></p><br><pre> <code class="plaintext hljs">%package -n %{libname} Version: %{version} Summary: A library for xkb-switch tool, provides API bindings for Vim text editor Group: Development/X11 %description -n %{libname} libxkbswitch library, required by xkb-switch tool. It provides bindings for API of the Vim text editor, which can be used via 'libxkbswitch.so.1'.</code> </pre><br><br><p>  <code>-n</code>    <code>%package</code>  <code>%description</code> ,       .    -        ,    <code>xkb-switch-libxkbswitch1</code> .       <code>libxkbswitch1</code> .           . <br></p><br><p>    <em> </em> : <br></p><br><pre> <code class="plaintext hljs">%package -n %{develname} Version: %{version} Summary: Development library libxkbswitch, provides API bindings for Vim text editor Group: Development/X11 %description -n %{develname} Development files for libxkbswitch. Provides bindings for API of the Vim text editor via 'libxkbswitch.so'.</code> </pre><br><br><a name="subpackaging-files"></a><br><h3>     </h3><br><p>   ,      .     <code>%files</code> . <br></p><br><p>      ,     ,    <code>%package</code> , <code>%description</code>  <code>%files</code> .  ,    <code>%description</code>  -    .   ,      ,    — <code>xkb-switch</code> . <br></p><br><p>  -  Rosa Linux     <code>%files</code>   ,    <code>%prep</code> .       : <br></p><br><pre> <code class="plaintext hljs">%files %{_bindir}/%{name} %{_mandir}/%{name}.1.xz %files -n %{libname} %{_libdir}/libxkbswitch.so.%{major} %{_libdir}/libxkbswitch.so.%{version} %files -n %{develname} %{_libdir}/libxkbswitch.so</code> </pre><br><br><p>    , : <br></p><br><br><ul><li>   <code>xkb-switch</code>   <code>~/usr/bin/xkb-switch</code>  <code>~/usr/share/man/man1/xkb-switch.1</code> , <br></li><li>   <code>libxkbswitch1</code>   <code>~/usr/lib/libxkbswitch.so.1</code>  <code>~/usr/lib/libxkbswitch.so.1.6.0</code> , <br></li><li>    <code>libxkbswitch-devel</code>   <code>~/usr/lib/libxkbswitch.so</code> . <br></li></ul><br><br><p>       <code>cleanup.sh</code>       <code>rpmbuild -ba ~/rpmbuild/SPECS/xkb-switch.spec</code> .    3 : <br></p><br><br><pre> <code class="plaintext hljs">libxkbswitch1.i586: W: no-documentation libxkbswitch-devel.i586: W: no-documentation libxkbswitch-devel.i586: W: no-dependency-on libxkbswitch/libxkbswitch-libs/liblibxkbswitch</code> </pre><br><br><p>   ,       .   ,     .     .  Vamos tentar descobrir. <br></p><br><br><a name="subpackaging-problems"></a><br><h3>    </h3><br><p> ,      ,  ,        <code>README.md</code> .     <code>%files</code>      —    <code>%doc</code> : <br></p><br><br><pre> <code class="plaintext hljs">%doc README.md</code> </pre><br><br><p>      .    <code>%doc</code> —    .        <code>~/rpmbuild/BUILD/xkb-switdh-master/README.md</code> . <br></p><br><p>       : <code>libxkbswitch-devel.i586: W: no-dependency-on libxkbswitch/libxkbswitch-libs/liblibxkbswitch</code> .  ,    <code>libxkbswitch-devel</code>    <code>libxkbswitch</code>  . <br></p><br><p>    <code>rpm -qp  --</code>       .            : <br></p><br><pre> <code class="bash hljs">[user@pc ~] $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/rpmbuild/RPMS/i586/ [user@pc ~/rpmbuild/RPMS/i586] $ ls libxkbswitch1-1.6.0-1-rosa2014.1.i586.rpm xkb-switch-1.6.0-1-rosa2014.1.i586.rpm libxkbswitch-devel-1.6.0-1-rosa2014.1.i586.rpm xkb-switch-debuginfo-1.6.0-1-rosa2014.1.i586.rpm [user@pc ~/rpmbuild/RPMS/i586] $ rpm -qp --provides libxkbswitch1-1.6.0-1-rosa2014.1.i586.rpm libxkbswitch.so.1 libxkbswitch1 = 1.6.0-1:2014.1 [user@pc ~/rpmbuild/RPMS/i586] $ rpm -qp --provides libxkbswitch-devel-1.6.0-1-rosa2014.1.i586.rpm devel(libxkbswitch) libxkbswitch-devel = 1.6.0-1:2014.1 [user@pc ~/rpmbuild/RPMS/i586] $ rpm -qp --requires libxkbswitch-devel-1.6.0-1-rosa2014.1.i586.rpm devel(libX11) devel(libgcc_s) devel(libstdc++) devel(libxkbfile) rpmlib(PayloadIsXz) &lt;= 5.2-1 [user@pc ~/rpmbuild/RPMS/i586] $ rpm -qp --requires xkb-switch-1.6.0-1-rosa2014.1.i586.rpm libc.so.6 libc.so.6(GLIBC_2.0) libc.so.6(GLIBC_2.1.3) libgcc_s.so.1 libgcc_s.so.1(GCC_3.0) libstdc++.so.6 libstdc++.so.6(CXXABI_1.3) libstdc++.so.6(GLIBCXX_3.4) libstdc++.so.6(GLIBCXX_3.4.11) libstdc++.so.6(GLIBCXX_3.4.20) libstdc++.so.6(GLIBCXX_3.4.9) libxkbswitch.so.1 rpmlib(PayloadIsXz) &lt;= 5.2-1</code> </pre><br><br><p>  ,    <code>libxkbswitch1</code>   <code>libxkbswitch.so.1</code>  <code>libxkbswitch1</code> .  <code>xkb-switch</code>   <code>libxkbswitch.so.1</code> ,     <code>libxkbswitch-devel</code>    <code>libxkbswitch1</code> .   ,     <code>%package</code>  <code>libxkbswitch-devel</code> .      : <br></p><br><br><pre> <code class="plaintext hljs">%package -n %{develname} Version: %{version} Summary: Development library libxkbswitch, provides API bindings for Vim text editor Group: Development/X11 Requires: %{libname} &gt;= %{version}</code> </pre><br><br><p>        , …       .     <code>libxkbswitch-devel</code>  ,  ,    .     ,         ,  <code>rpmbuild</code>      . <br></p><br><p> -,     (  <code>README.md</code>    ), —  : <br></p><br><br><div class="spoiler"> <b class="spoiler_title">-    </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">%define major 1 %define libname %mklibname xkbswitch %{major} %define develname %mklibname -d xkbswitch # Main package. Automaticaly requires libxkbswitch and libxkbswitch-devel Name: xkb-switch Version: %{major}.6.0 Release: 1 Summary: Query and change XKB layout state License: GPLv3+ Group: Development/X11 URL: https://github.com/alexandersolovyov/xkb-switch Source0: https://github.com/alexandersolovyov/xkb-switch/archive/master.zip BuildRequires: cmake &gt;= 2.6 BuildRequires: gcc BuildRequires: libxkbfile-devel BuildRequires: xz %description xkb-switch is a C++ program that allows to query and change the keyboard layout state for X11 Window System (XKB) via command line. It provides a command 'xkb-switch', and bindings for API of the Vim text editor, a library 'libxkbswitch'. It is mainly used for some plugins for Vim text editor, such as vim-xkbswitch. Originally ruby-based code written by J.Broomley. # libxkbswitch %package -n %{libname} Version: %{version} Summary: A library for xkb-switch tool, provides API bindings for Vim text editor Group: Development/X11 %description -n %{libname} libxkbswitch library, required by xkb-switch tool. It provides bindings for API of the Vim text editor, which can be used via 'libxkbswitch.so.1'. # libxkbswitch-devel %package -n %{develname} Version: %{version} Summary: Development library libxkbswitch, provides API bindings for Vim text editor Group: Development/X11 Requires: %{libname} &gt;= %{version} %description -n %{develname} Development files for libxkbswitch. Provides bindings for API of the Vim text editor via 'libxkbswitch.so'. # xkb-switch %files %{_bindir}/%{name} %{_mandir}/man1/%{name}.1.xz # libxkbswitch1 %files -n %{libname} %{_libdir}/libxkbswitch.so.%{major} %{_libdir}/libxkbswitch.so.%{version} %doc README.md # libxkbswitch-devel %files -n %{develname} %{_libdir}/libxkbswitch.so %doc README.md #------------------------------------------------------------------ %prep %setup -q -n xkb-switch-master %build %cmake %make %install %makeinstall_std -C build</code> </pre><br></div></div><br><br><a name="summary"></a><br><h2>  Conclusão </h2><br><p>  ,      RPM    <em>Rosa Linux</em> (       ).       ,   -. ,       — ,   ,   <em>rpmrc</em> ,      <em>ABF</em>   , —         . <br></p><br><p>        —    ,      -,         - , —     . <br></p><br><br><a name="commands"></a><br><h2>   </h2><br><br><a name="commands-build"></a><br><h3>     </h3><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpmbuild -bp specfile.spec</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Execute a </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preparação</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (% de preparação). </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpmbuild -bc specfile.spec</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Run </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">compilação</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (% build) e todas as ações anteriores. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpmbuild -bi specfile.spec</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Execute uma </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pseudo-</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> instalação (% install) e todas as etapas anteriores. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpmbuild -ba specfile.spec</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Crie pacotes completamente.</font></font><br><br><br><br><a name="commands-package"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Verificando o pacote pronto </font></font></h3><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpmlint -i package_file_name.rpm</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Verificação geral - quão bem o pacote foi construído. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpm -qp - fornece package_filename.rpm</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Verifique quais "recursos" são fornecidos pelo pacote. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpm -qp - requer package_filename.rpm</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Verifique em quais "capacidades" de outros pacotes este pacote depende. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpm -qpl package_file_name.rpm</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lista de arquivos contidos no pacote. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpm -qpi nome do arquivo do pacote.rpm</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Informações sobre o pacote (no "cabeçalho" do arquivo de especificação ou no bloco </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% package</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br><br><br><br><p>          ,    <code>p</code> .    ,     Rosa Linux,   .     <code>urpmq</code> ,   <code>rpm -q</code> . , <code>urpmq -l _</code>    ,  <code>urpmq --requires _</code>   . <br></p><br><br><a name="links"></a><br><h2>   ( ) </h2><br><ol><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Building RPMs — Quick Start</a> —         RPM  Rosa Linux. </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> RPM</a> —    ,   ,       .   . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RPM:  spec </a> —    -  Rosa Linux. </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Maximum RPM</a> —        <code>rpm</code>   RPM-  RedHat Linux.         ,      Rosa Linux.    . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Template Spec Files</a> —   <code>.spec</code> .  ,      -. </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Automatic Build Farm (ABF)</a> —      Rosa Linux.             ,   ,     ,    <code>.spec</code> .     -. </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Rpmlint Errors</a> —    ,   <code>rpmlint</code> . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Packaging Group</a> —    Rosa Linux. </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   Rosa Linux</a> . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Git — </a> —      <em>Git</em> . </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt464993/">https://habr.com/ru/post/pt464993/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt464981/index.html">O Google fornece argumentos para justificar o rastreamento do usuário - a empresa é acusada de falta de sinceridade e manipulação</a></li>
<li><a href="../pt464985/index.html">Internet das Coisas (IoT) vai mudar o mundo. Futuro da IoT</a></li>
<li><a href="../pt464987/index.html">Repositórios em Kubernetes: OpenEBS vs Rook (Ceph) vs Rancher Longhorn vs StorageOS vs Robin vs Portworx vs Linstor</a></li>
<li><a href="../pt464989/index.html">Contexto da extravagância</a></li>
<li><a href="../pt464991/index.html">Projetos que não decolaram</a></li>
<li><a href="../pt464995/index.html">Quebrar sequências no Swift</a></li>
<li><a href="../pt464997/index.html">Sobre o desenvolvimento de tecnologias de RV: onde elas são usadas, por que os negócios de RV e quais dispositivos usam</a></li>
<li><a href="../pt464999/index.html">Como as especificidades do trabalho com servidores de aplicativos estão mudando usando o exemplo OpenLiberty</a></li>
<li><a href="../pt465001/index.html">Amazon Prime Day 2019 - tecnologia da AWS</a></li>
<li><a href="../pt465003/index.html">Interesses para o gênero ARPG</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>