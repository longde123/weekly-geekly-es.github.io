<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêµ üëêüèæ üåå "Nuevas epopeyas". Comemos el elefante en partes üñäÔ∏è üôáüèæ üë®üèº‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este art√≠culo establecer√© un entorno de trabajo para el desarrollo del juego "Epics", as√≠ como dividir√© el juego en partes adecuadas para su uso en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>"Nuevas epopeyas". Comemos el elefante en partes</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/482752/"><p><img src="https://habrastorage.org/webt/gd/be/ip/gdbeip7f5h-k71jqzl7gmb1axva.jpeg"></p><br><p>  En este art√≠culo establecer√© un entorno de trabajo para el desarrollo del juego "Epics", as√≠ como dividir√© el juego en partes adecuadas para su uso en OpenFaaS.  Har√© todas las manipulaciones en Linux, Kubernetes se implementar√° en minikube usando VirtualBox.  En mi m√°quina de trabajo hay 2 n√∫cleos de procesador y 12 GB de RAM, uso SSD como disco del sistema.  Usar√© Debian 8 como el sistema principal para el desarrollo, con los paquetes emacs, sudo, git y virtualbox instalados, instalar√© el resto descarg√°ndolos de GitHub y otras fuentes.  Instalaremos estas aplicaciones en / usr / local / bin, a menos que se especifique lo contrario.  ¬°Empecemos! </p><a name="habracut"></a><br><h2 id="podgotovka-rabochego-okruzheniya">  Preparaci√≥n del ambiente de trabajo. </h2><br><h3 id="ustanovka-go">  Ir a la instalaci√≥n </h3><br><p>  Siga las instrucciones del sitio web oficial: </p><br><pre><code class="plaintext hljs">$ curl -L0 https://dl.google.com/go/go1.13.5.linux-amd64.tar.gz -o go.tar.gz $ sudo tar -C /usr/local -xzf go.tar.gz $ echo 'export PATH=$PATH:/usr/local/go/bin' &gt;&gt; ~/.profile</code> </pre> <br><p>  Verificar rendimiento: </p><br><pre> <code class="plaintext hljs">$ mkdir -p ~/go/src/hello &amp;&amp; cd ~/go/src/hello $ echo 'package main import "fmt" func main() { fmt.Printf("hello, world\n") }' &gt; hello.go $ go build $ ./hello hello, world</code> </pre> <br><h3 id="ustanovka-faas-cli">  Instalar faas-cli </h3><br><p>  Siga las instrucciones del sitio web oficial: </p><br><pre> <code class="plaintext hljs">$ curl -sSL https://cli.openfaas.com | sudo -E sh x86_64 Downloading package https://github.com/openfaas/faas-cli/releases/download/0.11.3/faas-cli as /tmp/faas-cli Download complete. Running with sufficient permissions to attempt to move faas-cli to /usr/local/bin New version of faas-cli installed to /usr/local/bin Creating alias 'faas' for 'faas-cli'. ___ _____ ____ / _ \ _ __ ___ _ __ | ___|_ _ __ _/ ___| | | | | '_ \ / _ \ '_ \| |_ / _` |/ _` \___ \ | |_| | |_) | __/ | | | _| (_| | (_| |___) | \___/| .__/ \___|_| |_|_| \__,_|\__,_|____/ |_| CLI: commit: 73004c23e5a4d3fdb7352f953247473477477a64 version: 0.11.3</code> </pre> <br><p>  Adem√°s, puede habilitar bash-complete: </p><br><pre> <code class="plaintext hljs">faas-cli completion --shell bash | sudo tee /etc/bash_completion.d/faas-cli</code> </pre> <br><h3 id="ustanovka-i-nastroyka-kubernetes">  Instalar y configurar Kubernetes </h3><br><p>  Minikube es suficiente para el desarrollo, por lo que lo instalaremos y kubelet en / usr / local / bin, tambi√©n instalaremos helm para instalar aplicaciones: </p><br><pre> <code class="plaintext hljs">$ curl https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 -o minikube &amp;&amp; chmod +x minikube &amp;&amp; sudo mv minikube /usr/local/bin/ $ curl https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl -o kubectl &amp;&amp; chmod +x kubectl &amp;&amp; sudo mv kubectl /usr/local/bin/ $ curl https://get.helm.sh/helm-v3.0.2-linux-amd64.tar.gz | tar -xzvf - linux-amd64/helm --strip-components=1; sudo mv helm /usr/local/bin</code> </pre> <br><p>  Lanzar minikube: </p><br><pre> <code class="plaintext hljs">$ minikube start minikube v1.6.2 on Debian 8.11 Automatically selected the 'virtualbox' driver (alternates: []) Downloading VM boot image ... &gt; minikube-v1.6.0.iso.sha256: 65 B / 65 B [--------------] 100.00% ? p/s 0s &gt; minikube-v1.6.0.iso: 150.93 MiB / 150.93 MiB [-] 100.00% 5.67 MiB p/s 27s Creating virtualbox VM (CPUs=2, Memory=8192MB, Disk=20000MB) ... Preparing Kubernetes v1.17.0 on Docker '19.03.5' ... Downloading kubeadm v1.17.0 Downloading kubelet v1.17.0 Pulling images ... Launching Kubernetes ... Waiting for cluster to come online ... Done! kubectl is now configured to use "minikube"</code> </pre> <br><p>  Comprobamos: </p><br><pre> <code class="plaintext hljs">$ kubectl get pods --all-namespaces NAMESPACE NAME READY STATUS RESTARTS AGE kube-system coredns-6955765f44-knlcb 1/1 Running 0 29m kube-system coredns-6955765f44-t9cpn 1/1 Running 0 29m kube-system etcd-minikube 1/1 Running 0 28m kube-system kube-addon-manager-minikube 1/1 Running 0 28m kube-system kube-apiserver-minikube 1/1 Running 0 28m kube-system kube-controller-manager-minikube 1/1 Running 0 28m kube-system kube-proxy-hv2wc 1/1 Running 0 29m kube-system kube-scheduler-minikube 1/1 Running 0 28m kube-system storage-provisioner 1/1 Running 1 29m</code> </pre> <br><h3 id="ustanovka-openfaas">  Instalar OpenFaaS </h3><br><p>  Los desarrolladores recomiendan crear 2 espacios de nombres para el trabajo: </p><br><pre> <code class="plaintext hljs">$ kubectl apply -f https://raw.githubusercontent.com/openfaas/faas-netes/master/namespaces.yml namespace/openfaas created namespace/openfaas-fn created</code> </pre> <br><p>  Agregue un repositorio para helm: </p><br><pre> <code class="plaintext hljs">$ helm repo add openfaas https://openfaas.github.io/faas-netes/ "openfaas" has been added to your repositories</code> </pre> <br><p>  El cuadro tiene la capacidad de establecer una contrase√±a antes de la instalaci√≥n, usarla y guardar los datos de acceso en forma de secreto k8s: </p><br><pre> <code class="plaintext hljs">$ PASSWORD=verysecurerandompasswordstring $ kubectl -n openfaas create secret generic basic-auth --from-literal=basic-auth-user=admin --from-literal=basic-auth-password="$PASSWORD" secret/basic-auth created</code> </pre> <br><p>  Despliegue: </p><br><pre> <code class="plaintext hljs">$ helm repo update Hang tight while we grab the latest from your chart repositories... ...Successfully got an update from the "openfaas" chart repository Update Complete. Happy Helming! $ helm upgrade openfaas --install openfaas/openfaas --namespace openfaas --set functionNamespace=openfaas-fn --set generateBasicAuth=false Release "openfaas" does not exist. Installing it now. NAME: openfaas LAST DEPLOYED: Fri Dec 25 10:28:22 2019 NAMESPACE: openfaas STATUS: deployed REVISION: 1 TEST SUITE: None NOTES: To verify that openfaas has started, run: kubectl -n openfaas get deployments -l "release=openfaas, app=openfaas"</code> </pre> <br><p>  Despu√©s de un tiempo, ejecute el comando propuesto: </p><br><pre> <code class="plaintext hljs">$ kubectl -n openfaas get deployments -l "release=openfaas, app=openfaas" NAME READY UP-TO-DATE AVAILABLE AGE alertmanager 1/1 1 1 114s basic-auth-plugin 1/1 1 1 114s faas-idler 1/1 1 1 114s gateway 1/1 1 1 114s nats 1/1 1 1 114s prometheus 1/1 1 1 114s queue-worker 1/1 1 1 114s</code> </pre> <br><p>  Verificar rendimiento: </p><br><pre> <code class="plaintext hljs">$ kubectl rollout status -n openfaas deploy/gateway deployment "gateway" successfully rolled out $ kubectl port-forward -n openfaas svc/gateway 8080:8080 &amp; [1] 6985 Forwarding from 127.0.0.1:8080 -&gt; 8080 $ echo -n $PASSWORD | faas-cli login --username admin --password-stdin Calling the OpenFaaS server to validate the credentials... Handling connection for 8080 WARNING! Communication is not secure, please consider using HTTPS. Letsencrypt.org offers free SSL/TLS certificates. credentials saved for admin http://127.0.0.1:8080 $ faas-cli list Function Invocations Replicas</code> </pre> <br><h3 id="ustanovka-mongodb">  Instala Mongodb </h3><br><p>  Ponemos todo usando tim√≥n: </p><br><pre> <code class="plaintext hljs">$ helm repo add stable https://kubernetes-charts.storage.googleapis.com/ "stable" has been added to your repositories $ helm install stable/mongodb --generate-name NAME: mongodb-1577466908 LAST DEPLOYED: Fri Dec 25 11:15:11 2019 NAMESPACE: default STATUS: deployed REVISION: 1 TEST SUITE: None NOTES: ** Please be patient while the chart is being deployed ** MongoDB can be accessed via port 27017 on the following DNS name from within your cluster: mongodb-1577466908.default.svc.cluster.local To get the root password run: export MONGODB_ROOT_PASSWORD=$(kubectl get secret --namespace default mongodb-1577466908 -o jsonpath="{.data.mongodb-root-password}" | base64 --decode) To connect to your database run the following command: kubectl run --namespace default mongodb-1577466908-client --rm --tty -i --restart='Never' --image bitnami/mongodb --command -- mongo admin --host mongodb-1577466908 --authenticationDatabase admin -u root -p $MONGODB_ROOT_PASSWORD To connect to your database from outside the cluster execute the following commands: kubectl port-forward --namespace default svc/mongodb-1577466908 27017:27017 &amp; mongo --host 127.0.0.1 --authenticationDatabase admin -p $MONGODB_ROOT_PASSWORD</code> </pre> <br><p>  Comprobamos: </p><br><pre> <code class="plaintext hljs">kubectl run --namespace default mongodb-1577466908-client --rm --tty -i --restart='Never' --image bitnami/mongodb --command -- mongo admin --host mongodb-1577466908 --authenticationDatabase admin -u root -p $(kubectl get secret --namespace default mongodb-1577466908 -o jsonpath="{.data.mongodb-root-password}" | base64 --decode) If you don't see a command prompt, try pressing enter. &gt; db.version(); 4.0.14</code> </pre> <br><p>  Presiona ctrl + D para salir del contenedor. </p><br><h3 id="nastroyka-emacs">  Configuraci√≥n de Emacs </h3><br><p>  En principio, todo ya estaba configurado para <a href="http://reangdblog.blogspot.com/2016/06/emacs-ide-go.html">este art√≠culo</a> , por lo que no pintar√© en detalle. </p><br><h2 id="razbienie-igry-na-funkcii">  Dividiendo el juego en funciones </h2><br><p>  La interacci√≥n con las funciones se lleva a cabo a trav√©s del protocolo http, JWT proporciona la autenticaci√≥n de extremo a extremo entre las diferentes funciones.  Para almacenar fichas, as√≠ como el estado del juego, los datos del jugador, la secuencia de movimientos de todos los juegos y otra informaci√≥n, se utiliza mongodb.  Echemos un vistazo m√°s de cerca a las caracter√≠sticas m√°s interesantes. </p><br><h3 id="registraciya">  Registro </h3><br><p>  En la entrada de esta funci√≥n est√° JSON con un alias de juego y contrase√±a.  Cuando se llama a esta funci√≥n, verifica la ausencia de este alias en la base de datos; en la verificaci√≥n exitosa, inserta el hash de alias y contrase√±a en la base de datos.  Se requiere registro para participar activamente en el juego. </p><br><h3 id="vhod">  Iniciar sesi√≥n </h3><br><p>  En la entrada de la funci√≥n est√° JSON con un alias y una contrase√±a del juego, si hay un alias en la base de datos y la contrase√±a se verifica con √©xito con la contrase√±a almacenada anteriormente en la base de datos, se devuelve JWT, que debe pasarse a otras funciones cuando se invocan.  Tambi√©n se insertan varios registros de servicio en la base de datos, por ejemplo, la hora del √∫ltimo inicio de sesi√≥n, etc. </p><br><h3 id="prosmotr-spiska-igr">  Ver lista de juegos </h3><br><p>  Cualquier usuario no autorizado puede solicitar una lista de todos los juegos, excepto los activos.  Un usuario autorizado tambi√©n ve una lista de juegos activos.  El resultado de la funci√≥n es JSON que contiene listas de juegos (identificador de juego, nombre legible por humanos, etc.). </p><br><h3 id="sozdanie-igry">  Creaci√≥n de juegos </h3><br><p>  La funci√≥n solo funciona con usuarios autorizados, se acepta el n√∫mero m√°ximo de jugadores en la entrada, as√≠ como los par√°metros del juego (por ejemplo, qu√© personajes activar en este juego, el n√∫mero m√°ximo de jugadores, etc.).  Un par√°metro separado del juego es la presencia de una contrase√±a para unirse, que le permite crear juegos no p√∫blicos.  Por defecto, se crea un juego p√∫blico.  El resultado de la ejecuci√≥n de la funci√≥n es JSON, en el que hay un campo de √©xito de creaci√≥n, un identificador √∫nico para el juego, as√≠ como otros par√°metros. </p><br><h3 id="prisoedinenie-k-igre">  Unirse al juego </h3><br><p>  La funci√≥n funciona solo con usuarios autorizados, en la entrada, el identificador del juego y su contrase√±a, si es un juego no p√∫blico, en la salida, JSON con los par√°metros del juego.  El usuario autorizado que se ha unido al juego, as√≠ como el creador del juego, se llaman participantes en el juego. </p><br><h3 id="prosmotr-sobytiy-igry">  Ver eventos del juego </h3><br><p>  Cualquier usuario no autorizado puede solicitar una lista de eventos de juegos inactivos, y un usuario autorizado puede obtener una lista de eventos y cualquier juego activo.  Un par√°metro adicional para la funci√≥n puede ser el n√∫mero de evento que el usuario ya tiene.  En este caso, solo aquellos eventos que ocurrieron m√°s tarde ser√°n devueltos en la lista.  Al iniciar esta funci√≥n peri√≥dicamente, un usuario autorizado observa lo que sucede en el juego.  Esta funci√≥n tambi√©n devuelve una solicitud de una acci√≥n a la que el usuario puede responder utilizando la funci√≥n de enviar un evento de juego. </p><br><h3 id="otpravka-sobytiya-igry">  Despacho de eventos del juego </h3><br><p>  La funci√≥n solo funciona para los participantes del juego: se implementa la capacidad de iniciar un juego, hacer un movimiento, votar, escribir un mensaje de texto que aparece en la lista de eventos del juego, etc. <br>  El usuario autorizado que cre√≥ el juego comienza la distribuci√≥n de roles a todos los participantes en el juego, incluidos ellos mismos, deben confirmar su rol utilizando la misma funci√≥n.  Una vez que se confirman todos los roles, el juego pasa autom√°ticamente al modo nocturno. </p><br><h3 id="statistika-igry">  Estad√≠sticas del juego </h3><br><p>  La funci√≥n funciona solo para los participantes en el juego, muestra el estado del juego, la lista y el n√∫mero de jugadores (alias), roles y su estado (movimiento realizado o no), as√≠ como otra informaci√≥n.  En cuanto a la funci√≥n anterior, todo funciona solo para los participantes del juego. </p><br><h3 id="periodicheski-zapuskaemye-funkcii">  Funciones ejecutadas peri√≥dicamente </h3><br><p>  Si el juego no se ha lanzado durante alg√∫n tiempo especificado durante su creaci√≥n, se eliminar√° autom√°ticamente de la lista de juegos activos mediante la funci√≥n de barrido. </p><br><p>  Otra tarea peri√≥dica es el cambio forzado del modo de juego de noche a d√≠a y viceversa para juegos en los que esto no sucedi√≥ durante el turno (por ejemplo, un jugador que necesita responder a un evento de juego no envi√≥ su decisi√≥n por ning√∫n motivo). </p><br><h2 id="anons">  Anuncio </h2><br><ul><li>  <a href="https://habr.com/ru/company/southbridge/blog/482010/">Introduccion</a> </li><li>  Establecer el entorno de desarrollo, dividiendo la tarea en funciones. </li><li>  Trabajar en el backend </li><li>  Trabajo frontend </li><li>  Configuraci√≥n de CI \ CD, organizaci√≥n de prueba </li><li>  Comenzar una sesi√≥n de prueba del juego </li><li>  Resumen </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/482752/">https://habr.com/ru/post/482752/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../482736/index.html">Uso de TSDuck para monitorear flujos de IP (TS)</a></li>
<li><a href="../482740/index.html">Entrevista para el puesto de poeta</a></li>
<li><a href="../482742/index.html">Entrar en el mercado occidental: c√≥mo interactuar con los clientes</a></li>
<li><a href="../482744/index.html">Encontrar una bala de plata: munici√≥n inusual</a></li>
<li><a href="../482748/index.html">Crear un negocio de reserva de taxis en Dubai: ¬øC√≥mo lanzar una aplicaci√≥n de taxi centrada en el cliente como Careem & Hala?</a></li>
<li><a href="../482756/index.html">¬øEs un futuro verde brumoso?</a></li>
<li><a href="../482758/index.html">En el camino hacia el teclado perfecto</a></li>
<li><a href="../482762/index.html">42,000,000,000 de visitas. PornHub resumi√≥ 2019</a></li>
<li><a href="../482764/index.html">Rhasspy es un kit de herramientas de voz de c√≥digo abierto y totalmente fuera de l√≠nea. Reconocimiento de la lengua rusa. Sin fugas a la nube</a></li>
<li><a href="../482766/index.html">Sobre algunos problemas de microoptimizaci√≥n</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>