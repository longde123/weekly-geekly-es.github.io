<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§æüèº üë©üèº‚Äçü§ù‚Äçüë®üèø üåº WAF √† travers les yeux des pirates üë®‚Äçüé§ üò∑ ü§¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aujourd'hui, nous allons parler de l'un des m√©canismes de s√©curit√© modernes pour les applications Web, √† savoir le Web Application Firewall (WAF). Nou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>WAF √† travers les yeux des pirates</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/454592/"><img align="left" src="https://habrastorage.org/webt/nx/mm/yz/nxmmyzb6nr39jk_zmiu5wcnylbm.png">  Aujourd'hui, nous allons parler de l'un des m√©canismes de s√©curit√© modernes pour les applications Web, √† savoir le Web Application Firewall (WAF).  Nous discuterons des WAF modernes et sur quoi ils sont bas√©s, ainsi que des techniques de contournement, comment les utiliser et pourquoi vous ne devriez jamais vous fier enti√®rement aux WAF.  Nous parlons du point de vue des pentesters;  nous n'avons jamais d√©velopp√© de WAF et collect√© uniquement des donn√©es √† partir de sources ouvertes.  Ainsi, nous ne pouvons que nous r√©f√©rer √† notre propre exp√©rience et ne pas √™tre au courant de certaines particularit√©s des WAF. <br clear="left"><a name="habracut"></a><br><hr><br><br>  <i>Avertissement: il s'agit d'une traduction de l'article du russe vers l'anglais, l'article a √©t√© publi√© fin 2017, respectivement, certaines informations pourraient devenir obsol√®tes.</i> <br><br><h4>  Table des mati√®res </h4><br><ol><li>  Pr√©sentation </li><li>  Le WAF moderne </li><li>  Identification du WAF </li><li>  Cheatsheet de contournement WAF </li><li>  Contournement WAF en pratique </li><li>  Conclusion </li></ol><br>  <i>Si vous savez pourquoi les WAF sont utilis√©s et comment ils fonctionnent, vous pouvez passer directement √† la section de contournement.</i> <br><br><h2>  Pr√©sentation </h2><br>  Les WAF sont devenus tr√®s populaires r√©cemment.  Les fournisseurs proposent diverses solutions dans diff√©rentes gammes de prix, kits de distribution et options, ciblant diff√©rents clients, des petites aux grandes entreprises.  Les WAF sont populaires car ils constituent une solution complexe pour la protection des applications Web, qui couvre un large √©ventail de t√¢ches.  C'est pourquoi les d√©veloppeurs d'applications Web peuvent s'appuyer sur WAF pour certains aspects de s√©curit√©.  Cependant, les WAF ne peuvent pas garantir une s√©curit√© totale. <br><br><img src="https://habrastorage.org/webt/59/e3/95/59e395af93092095133873.png"><br><br>  Alors, de quoi un WAF devrait-il √™tre capable de justifier sa mise en ≈ìuvre dans un projet?  Sa fonction principale est de d√©tecter et de bloquer toute demande qui, selon l'analyse du WAF, pr√©sente des anomalies ou un vecteur d'attaque.  L'analyse ne doit pas entraver l'interaction entre les utilisateurs l√©gitimes et l'application Web tout en d√©tectant avec pr√©cision et en temps opportun toute tentative d'attaque.  Afin de mettre en ≈ìuvre une telle fonctionnalit√©, les d√©veloppeurs WAF utilisent des expressions r√©guli√®res, des tokenizers, une analyse de comportement, une analyse de r√©putation et bien s√ªr un apprentissage automatique.  Souvent, toutes ces technologies sont utilis√©es ensemble.  WAF peut √©galement impl√©menter d'autres fonctions: protection DDoS, interdiction des adresses IP des attaquants, surveillance des adresses IP suspectes, ajout d'en-t√™tes de s√©curit√© (X-XSS-Protection, X-Frame-Options, etc.), ajout d'indicateurs http uniquement au cookie, mise en ≈ìuvre de le m√©canisme HSTS et les jetons CSRF.  En outre, certains WAF ont des modules c√¥t√© client JavaScript pour les sites Web. <br><br>  Bien s√ªr, les WAF cr√©ent des obstacles pour les pirates et les pentesters.  WAF rend la recherche et l'exploitation de vuln√©rabilit√©s plus gourmandes en ressources (sauf si l'attaquant conna√Æt des m√©thodes de contournement 0day efficaces pour un WAF sp√©cifique).  Les scanners automatiques sont pratiquement inutiles lors de l'analyse des applications Web prot√©g√©es par WAF.  WAF est une protection fiable contre les ¬´scriptkiddies¬ª.  Cependant, un pirate exp√©riment√© ou un chercheur sans motivation suffisante ne voudrait probablement pas perdre de temps √† essayer de trouver des moyens de le contourner.  Il convient de noter que plus l'application Web est complexe, plus sa surface d'attaque est grande et plus il est facile de trouver une m√©thode de contournement. <br><br>  Lors de nos r√©cents audits, nous trouvions assez souvent des WAF diff√©rents.  Nous en reparlerons plus tard.  Nous avons d√©j√† test√© deux WAF propri√©taires dans deux sc√©narios principaux: <br><br><ul><li>  Nous savons qu'il existe une certaine vuln√©rabilit√© dans une application Web et nous essayons de contourner le WAF pour l'exploiter; </li><li>  Nous ne connaissons aucune vuln√©rabilit√©, nous devons donc en trouver une malgr√© le WAF, puis l'exploiter en contournant le WAF. </li></ul><br>  Mais d'abord, regardons de plus pr√®s les m√©canismes de base derri√®re WAF et voyons quels probl√®mes ils ont. <br><br><h2>  Le WAF moderne </h2><br>  Pour pouvoir trouver efficacement divers moyens de contourner le WAF, nous devons d'abord trouver des m√©canismes modernes de classification des demandes.  Chaque WAF est sp√©cifique et unique, mais il existe des m√©thodes g√©n√©rales d'analyse.  Jetons un coup d'oeil √† ceux-ci. <br><br><img src="https://habrastorage.org/webt/59/e3/95/59e395af93c4f468367566.png"><br><br><h4>  R√®gles bas√©es sur des expressions r√©guli√®res </h4><br>  La majorit√© des WAF existants utilisent des r√®gles bas√©es sur des expressions r√©guli√®res.  Le d√©veloppeur recherche un certain ensemble d'attaques connues pour identifier les structures syntaxiques cl√©s qui pourraient pointer vers une attaque.  Sur la base de ces donn√©es, le d√©veloppeur cr√©e des expressions r√©guli√®res qui trouvent de telles structures syntaxiques.  Cela semble simple, mais cette m√©thode pr√©sente certains inconv√©nients.  Premi√®rement, une expression r√©guli√®re peut √™tre appliqu√©e √† une seule demande, voire √† un seul param√®tre de demande, ce qui r√©duit √©videmment l'efficacit√© de ces r√®gles et laisse des angles morts.  Deuxi√®mement, la syntaxe des expressions r√©guli√®res et la logique complexe des protocoles de texte, qui permet le remplacement de structures √©quivalentes et l'utilisation de diff√©rentes repr√©sentations de symboles, entra√Ænent des erreurs lors de la cr√©ation de ces r√®gles. <br><br>
<h4>  Cr√©ation de partitions </h4><br>  Ceux qui savent comment fonctionnent les pare-feu r√©seau et les antivirus doivent √™tre familiaris√©s avec ce m√©canisme.  Il ne d√©tecte pas les attaques mais compl√®te d'autres m√©canismes en les rendant plus pr√©cis et flexibles.  Le fait est qu'une structure ¬´suspecte¬ª dans une demande n'est pas une condition suffisante pour d√©tecter une attaque et peut conduire √† de nombreux faux positifs.  Ce probl√®me est r√©solu en impl√©mentant un syst√®me de classement.  Chaque r√®gle bas√©e sur des expressions r√©guli√®res est compl√©t√©e par des informations sur sa criticit√©;  une fois toutes les r√®gles d√©clench√©es identifi√©es, leur criticit√© est r√©sum√©e.  Si la criticit√© totale atteint la valeur seuil, l'attaque est d√©tect√©e et la demande est bloqu√©e.  Malgr√© sa simplicit√©, ce m√©canisme s'est av√©r√© efficace et est largement utilis√© pour de telles t√¢ches. <br><br><h4>  Tokenizers </h4><br>  Cette m√©thode de d√©tection a √©t√© pr√©sent√©e au Black Hat 2012 comme une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">libinjection de</a> biblioth√®que C / C +, qui permet d'identifier les injections SQL rapidement et avec pr√©cision.  En ce moment, il existe de nombreux ports de libinjection pour diff√©rents langages de programmation, comme PHP, Lua, Python, etc.  Ce m√©canisme recherche les signatures pr√©sent√©es comme un ensemble de jetons.  Un certain nombre de signatures sont sur liste noire, et elles sont jug√©es ind√©sirables et malveillantes.  En d'autres termes, avant qu'une requ√™te ne soit analys√©e, elle est traduite en un ensemble de jetons.  Les jetons sont divis√©s en certains types, comme variable, cha√Æne, op√©rateur r√©gulier, inconnu, nombre, commentaire, op√©rateur de type union, fonction, virgule, etc.  L'un des principaux inconv√©nients de la m√©thode est qu'il est possible de construire une structure qui conduirait √† la formation incorrecte de jetons, donc la signature de la demande sera diff√©rente de celle attendue.  Ces structures sont g√©n√©ralement appel√©es brise-jetons, et nous en discuterons plus tard <br><br><h4>  Analyse comportementale </h4><br>  La d√©tection et le blocage des tentatives d'exploitation dans les requ√™tes ne sont pas la seule t√¢che des WAF.  Il est √©galement important d'identifier le processus de recherche de vuln√©rabilit√© et le WAF doit r√©agir en cons√©quence.  Il peut se manifester sous forme de tentatives d'analyse, de force brute de r√©pertoire, de fuzzing des param√®tres et d'autres m√©thodes automatiques.  Les WAF avanc√©s peuvent cr√©er des cha√Ænes de requ√™tes typiques d'un comportement normal normal et bloquer les tentatives d'envoi de requ√™tes inhabituelles.  Cette m√©thode ne d√©tecte pas tant les attaques, car elle entrave le processus de recherche de vuln√©rabilit√©.  Limiter le nombre de requ√™tes par minute n'affecterait pas un utilisateur habituel mais serait un s√©rieux obstacle pour les scanners, qui fonctionnent sur plusieurs threads. <br><br><h4>  Analyse de r√©putation </h4><br>  Il s'agit d'un autre m√©canisme directement h√©rit√© des pare-feu et des antivirus.  Aujourd'hui, presque tous les WAF incluent des listes d'adresses de VPN, d'anonymiseurs, de n≈ìuds Tor et de botnets pour bloquer les demandes de ceux-ci.  Les WAF avanc√©s peuvent mettre √† jour automatiquement leurs bases et les compl√©ter avec des entr√©es suppl√©mentaires en fonction du trafic analys√©. <br><br><h4>  Apprentissage automatique </h4><br>  C'est l'un des aspects les plus discutables du WAF.  Notons que le terme ¬´machine learning¬ª est assez large et comprend de nombreuses technologies et m√©thodes.  De plus, ce n'est qu'une des classes de l'IA.  ¬´Mise en ≈ìuvre¬ª de l'apprentissage automatique ou ¬´utilisation de l'IA¬ª sont des expressions marketing tr√®s populaires.  Il n'est pas toujours clair quels algorithmes sont utilis√©s exactement, et parfois cela ressemble √† du charabia.  Les fournisseurs qui utilisent vraiment l'apprentissage automatique et le font efficacement ne sont pas dispos√©s √† partager leur exp√©rience.  Cela rend difficile pour un √©tranger d'essayer de comprendre la situation.  Essayons n√©anmoins de faire quelques remarques sur la base des informations disponibles. <br><br>  Premi√®rement, l'apprentissage automatique d√©pend enti√®rement des donn√©es sur lesquelles il a √©t√© form√©, ce qui pose un certain probl√®me.  Un d√©veloppeur doit disposer d'une base d'attaques compl√®te et √† jour, ce qui est difficile √† r√©aliser.  C'est pourquoi de nombreux d√©veloppeurs enregistrent de mani√®re approfondie les r√©sultats de leurs WAF et coop√®rent avec les fournisseurs fournissant des syst√®mes IDS et SIEM pour obtenir des exemples d'attaques r√©elles.  Deuxi√®mement, un mod√®le form√© sur une application Web abstraite peut s'av√©rer totalement inefficace sur une application Web r√©elle.  Pour une meilleure qualit√©, il est recommand√© de former en plus un mod√®le au stade de la mise en ≈ìuvre, qui n√©cessite beaucoup de ressources et de temps et n'accorde toujours pas les meilleurs r√©sultats. <br><br><h2>  Identification du WAF </h2><br>  Les d√©veloppeurs WAF utilisent diff√©rentes m√©thodes pour informer l'utilisateur que la demande a √©t√© bloqu√©e.  Ainsi, nous pouvons identifier le WAF en analysant la r√©ponse √† notre demande d'attaque.  Ceci est g√©n√©ralement appel√© WAF Fingerprint.  Les empreintes digitales peuvent aider si un WAF n'est pas mis √† jour pour une raison quelconque (s'applique principalement aux projets open source).  Les d√©veloppeurs de WAF propri√©taires prennent soin de leurs clients et impl√©mentent des mises √† jour automatiques.  De plus, une fois que nous avons identifi√© le WAF, qui s'est av√©r√© √™tre mis √† jour, nous pouvons toujours utiliser les informations le concernant pour en savoir plus sur sa logique. <br><br>  Voici une liste des empreintes digitales WAF possibles: <br><br><ul><li>  Cookies suppl√©mentaires </li><li>  En-t√™tes suppl√©mentaires √† toute r√©ponse ou demande </li><li>  Contenu de la r√©ponse (en cas de demande bloqu√©e) </li><li>  Code de r√©ponse (en cas de demande bloqu√©e) </li><li>  Adresse IP (Cloud WAF) </li><li>  Module c√¥t√© client JS (WAF c√¥t√© client) </li></ul><br>  Illustrons-le avec quelques exemples <br><br>  <b>PT AF</b> <br>  Code de r√©ponse pour la demande bloqu√©e: 403 <br>  Peut ins√©rer le module client waf.js dans la page de r√©ponse <br>  Corps de la r√©ponse: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Forbidden<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pre</span></span></span><span class="hljs-tag">&gt;</span></span>Request ID: 2017-07-31-13-59-56-72BCA33A11EC3784<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pre</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Un en-t√™te suppl√©mentaire qui ajoute par waf.js: <br><br><pre> <code class="xml hljs">X-RequestId: cbb8ff9a-4e91-48b4-8ce6-1beddc197a30</code> </pre> <br>  <b>Nemesida waf</b> <br>  Code de r√©ponse pour la demande bloqu√©e: 403 <br>  Corps de la r√©ponse: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"font-size: 16px; align: center;"</span></span></span><span class="hljs-tag">&gt;</span></span> Suspicious activity detected. Access to the site is blocked. If you think that is's an erroneous blocking, please email us at <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"mailto:nwaf@pentestit.ru"</span></span></span><span class="hljs-tag">&gt;</span></span>nwaf@pentestit.ru<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> and specify your IP-address. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  <b>Wallarm</b> <br>  Code de r√©ponse pour la demande bloqu√©e: 403 <br>  En-t√™te suppl√©mentaire: nginx-wallarm <br><br>  <b>Citrix NetScaler AppFirewall</b> <br>  Cookie suppl√©mentaire: <br><br><pre> <code class="xml hljs">ns_af=31+LrS3EeEOBbxBV7AWDFIEhrn8A000; ns_af_.target.br_%2F_wat=QVNQU0VTU0lP TklEQVFRU0RDU0Nf?6IgJizHRbTRNuNoOpbBOiKRET2gA</code> </pre> <br>  <b>Mod_Security ver.</b>  <b>2.9</b> <br>  Code de r√©ponse pour la demande bloqu√©e: 403 <br>  Organe de r√©ponse: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>403 Forbidden<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Forbidden<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>You don't have permission to access /form.php on this server.<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  <b>Mod_Security ver.</b>  <b>&lt;2,9</b> <br>  Code de r√©ponse pour demande bloqu√©e: 406 ou 501 <br>  Dans le corps de la r√©ponse, vous pouvez trouver mod_security, Mod_Security ou NOYB <br><br>  <b>Pare-feu en vernis</b> <br>  Ajoute les en-t√™tes suivants √† la r√©ponse: <br><br><pre> <code class="plaintext hljs">X-Varnish: 127936309 131303037. X-Varnish: 435491096 Via: 1.1 varnish-v4</code> </pre> <br>  Les d√©veloppeurs WAF d√©cident eux-m√™mes du code de r√©ponse √† retourner en cas de demande bloqu√©e;  il existe √©galement des codes sp√©cifiques.  Par exemple, Web_Knight WAF renvoie le code 999 et dotDefender renvoie le code 200 avec un corps de r√©ponse vide ou avec un message d'erreur.  En plus de cela, les d√©veloppeurs peuvent cr√©er une page de r√©ponse personnalis√©e avec un autre contenu. <br><br>  Le WAF, comme toute autre application, √©volue et change.  C'est pourquoi il est important de v√©rifier en permanence la pertinence des empreintes digitales que vous poss√©dez. <br><br><h2>  Aide-m√©moire de contournement WAF </h2><br>  L'id√©e g√©n√©rale derri√®re la recherche de moyens de contourner le WAF est de transformer la demande dont nous avons besoin afin qu'elle soit toujours valide pour l'application Web mais pas pour le WAF ou semble inoffensive.  Il est important qu'un type de WAF puisse servir de nombreux types de serveurs diff√©rents, y compris les serveurs ¬´exotiques¬ª, comme Unicorn, Tornado, Weblogic, Lighttpd, etc.  Chaque serveur peut percevoir des cas exclusifs d'analyse de requ√™te HTTP d'une mani√®re diff√©rente, qui doit √©galement √™tre prise en compte par WAF.  Ainsi, un attaquant peut utiliser les sp√©cificit√©s des serveurs de l'analyse des requ√™tes HTTP pour trouver un moyen de contourner le WAF. <br><br><img src="https://habrastorage.org/webt/59/e3/95/59e395afb9650235665851.png"><br><br>  Il est difficile de classer toutes les mani√®res possibles de contourner WAF, soit par les m√©canismes de s√©curit√© WAF, soit par domaine d'utilisation.  Les m√™mes voies de contournement peuvent interagir et affecter simultan√©ment diff√©rents composants d'un WAF.  Les techniques d√©crites ci-dessous ont √©t√© collect√©es √† partir de sources ouvertes ou d√©couvertes lors de nos propres recherches et se sont av√©r√©es parmi les plus efficaces. <br><br><h4>  Ajout de symboles sp√©ciaux </h4><br>  Divers symboles sp√©ciaux peuvent violer la logique d'analyse d'un WAF et en m√™me temps √™tre valablement interpr√©t√©s par le serveur.  Les variations de ces symboles peuvent √™tre diff√©rentes: ils peuvent √™tre transform√©s en urlencode (bien que la plupart des WAF puissent g√©rer cela) ou d'autres encodages.  Il est √©galement possible d'ins√©rer des symboles sp√©ciaux dans une requ√™te sans aucun encodage, au format brut, ce qui peut surprendre un WAF.  Par exemple, <b>\ r \ n \ r \ n</b> dans cette pr√©sentation peut √™tre per√ßu comme la fin d'un corps de requ√™te HTTP, et l'octet nul peut violer la logique d'analyse des expressions r√©guli√®res et des analyseurs de donn√©es.  De plus, d'autres symboles sp√©ciaux des vingt premiers symboles de la table ASCII peuvent √™tre utiles. <br>  Exemples: <br><br><ul><li>  0x00 - octet nul; </li><li>  0x0D - Retour chariot; </li><li>  0x0A - Saut de ligne; </li><li>  0x0B - Onglet vertical; </li><li>  0x09 - Onglet horizontal; </li><li>  0x0C - Nouvelle page </li></ul><br>  Lors de la recherche d'un contournement, il est utile d'ins√©rer des symboles sp√©ciaux √† diff√©rents endroits du corps de la demande et pas seulement dans les valeurs des param√®tres.  Par exemple, si une demande est au format JSON, nous pouvons ins√©rer des octets NULL √† la fois dans un param√®tre et entre les param√®tres, √† la fois au d√©but et √† la fin de JSON.  Il en va de m√™me pour les autres formats du corps d'une requ√™te POST.  En g√©n√©ral, nous vous recommandons de faire des recherches et de vous amuser, de rechercher des endroits qui peuvent √™tre surveill√©s et analys√©s par WAF, et d'essayer d'utiliser diff√©rents symboles sp√©ciaux l√†-bas. <br><br>  Par exemple: <br><br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">1337</span></span>,<span class="hljs-attr"><span class="hljs-attr">"string0x00"</span></span>:<span class="hljs-string"><span class="hljs-string">"test' or sleep(9)#"</span></span>} {<span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">1337</span></span>,<span class="hljs-attr"><span class="hljs-attr">"string"</span></span>:<span class="hljs-string"><span class="hljs-string">"test'/*0x00*/ or sleep(9)#"</span></span>} {<span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">1337</span></span>,<span class="hljs-attr"><span class="hljs-attr">"string"</span></span>0x0A0x0D:<span class="hljs-string"><span class="hljs-string">"test' or sleep(9)#"</span></span>}</code> </pre> <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ja0x09vas0x0A0x0Dcript:alert(1)"</span></span></span><span class="hljs-tag">&gt;</span></span>clickme<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">0x00</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript:alert(1)"</span></span></span><span class="hljs-tag">&gt;</span></span>clickme<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">0x00</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"alert(1)"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><pre> <code class="sql hljs">id=1337<span class="hljs-comment"><span class="hljs-comment">/*0x0C*/</span></span>1 UNION <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>() <span class="hljs-comment"><span class="hljs-comment">--</span></span></code> </pre> <br>  <i>Pour plus de clart√©, nous avons remplac√© les symboles sp√©ciaux par leur pr√©sentation hexad√©cimale.</i> <br><br><h4>  Remplacement des symboles d'espace </h4><br>  Dans la plupart des syntaxes, les mots cl√©s et les op√©rateurs doivent √™tre s√©par√©s, mais les symboles d'espace pr√©f√©rables ne sont pas sp√©cifi√©s.  Ainsi, au lieu du <b>0x20</b> commun (espace), vous pouvez utiliser <b>0x0B</b> (onglet vertical) ou <b>0x09</b> (onglet horizontal).  Remplacer les espaces par des structures de division sans leur propre sens tombe dans la m√™me cat√©gorie.  En SQL, il s'agit de <b>/ ** /</b> (commentaires SQL sur plusieurs lignes), <b># \ r \ n</b> (commentaire SQL sur une ligne, se terminant par un saut de ligne), <b>- \ r \ n</b> (commentaire SQL alternatif sur une ligne, se terminant avec saut de ligne).  Voici quelques exemples: <br><br><pre> <code class="html hljs xml">http://test.com/test?id=1%09union/**/select/**/1,2,3 http://test.com/test?id=1%09union%23%0A%0Dselect%2D%2D%0A%0D1,2,3</code> </pre> <br>  De plus, nous pouvons transformer une expression pour se d√©barrasser des espaces en utilisant la syntaxe du langage.  Par exemple, en SQL, nous pouvons utiliser des parenth√®ses: <br><br><pre> <code class="sql hljs">UNION(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>),<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,(<span class="hljs-number"><span class="hljs-number">6</span></span>)<span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">Users</span></span>)<span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span>(login=<span class="hljs-string"><span class="hljs-string">'admin'</span></span>))</code> </pre> <br>  Et dans JS, utilisez <b>/</b> : <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">confirm(1)</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h4>  Changer l'encodage </h4><br>  Cette m√©thode est bas√©e sur l'utilisation de diff√©rents encodages pour emp√™cher WAF de d√©coder les donn√©es √† certains endroits.  Par exemple, si un symbole est remplac√© par son code URL, WAF ne pourra pas comprendre qu'il doit d√©coder les donn√©es et transmettra la demande.  Dans le m√™me temps, le m√™me param√®tre sera accept√© et d√©cod√© avec succ√®s par l'application Web. <br><br>  La forme d√©cimale d'un symbole HTML est <b>&amp; # 106</b> ou <b>&amp; # 0000106</b> .WAF peut conna√Ætre la version courte et ne pas conna√Ætre la version avec des z√©ros suppl√©mentaires (il ne doit pas y avoir plus de 7 symboles au total).  De la m√™me mani√®re, la forme hexad√©cimale d'un symbole HTML est <b>&amp; # x6A</b> ou <b>&amp; # x000006A</b> . <br><br>  Il y a aussi une astuce avec les caract√®res d'√©chappement avec une barre oblique inverse <b>\</b> , par exemple: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">on</span></span></span><span class="hljs-tag">\</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">load</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">a\lert(1)</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Cependant, cela d√©pend de la fa√ßon dont une application Web traite ces donn√©es d'entr√©e.  Ainsi, la s√©quence <b>\ l</b> sera trait√©e comme un <b>l</b> et transform√©e en un seul symbole;  WAF peut traiter chaque symbole s√©par√©ment et il peut rompre les expressions r√©guli√®res ou une autre logique WAF.  Ainsi, WAF manquera les mots-cl√©s.  En utilisant cette technique, nous ne pouvons pas √©chapper les caract√®res <b>\ n</b> , <b>\ r</b> , <b>\ t</b> , car ils seront transform√©s en diff√©rents caract√®res: nouvelle ligne, retour chariot et tabulation. <br><br>  Le codage HTML peut √™tre utilis√© √† l'int√©rieur des attributs de balise, par exemple: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript&amp;colon;alert(1)"</span></span></span><span class="hljs-tag">&gt;</span></span>clickme<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onmouseover</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript&amp;colon;confirm&amp;lpar;1rpar;"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Ces caract√®res peuvent √™tre facilement remplac√©s par une autre repr√©sentation HTML des caract√®res cibles.  Vous pouvez rechercher diff√©rentes transformations de personnages <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Outre le codage HTML, nous pouvons ins√©rer des caract√®res avec <b>\ u</b> : <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript:\u0061lert(1)"</span></span></span><span class="hljs-tag">&gt;</span></span>Clickme<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">confir\u006d(1)</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Examinons √©galement le vecteur li√© √† l'insertion de caract√®res sp√©ciaux.  Brisons la charge utile avec le codage HTML: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ja&amp;Tab;vas&amp;#x0000A;cript:alert(1)"</span></span></span><span class="hljs-tag">&gt;</span></span>clickme<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Dans ce cas, nous pouvons √©galement placer d'autres caract√®res de s√©paration. <br><br>  Ainsi, nous vous recommandons de combiner diff√©rents encodages avec d'autres m√©thodes, par exemple, pour encoder des caract√®res sp√©ciaux. <br><br><h4>  Recherche de structures syntaxiques √©quivalentes atypiques </h4><br>  Cette m√©thode vise √† trouver un mode d'exploitation non pris en compte par les d√©veloppeurs de WAF, ou un vecteur qui n'√©tait pas pr√©sent dans l'√©chantillon d'apprentissage du machine learning.  Des exemples simples seraient les fonctions JavaScript: <b>this, top self, parent, frames;</b>  attributs de balise: <b>liaison de donn√©es, ontoggle, onfilterchange, onbeforescriptexecute, onpointerover, srcdoc;</b>  et op√©rateurs SQL: <b>lpad, field, bit_count</b> . <br><br>  Voici quelques exemples: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">[</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'alert'</span></span></span><span class="javascript">](</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">)</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript">parent[</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'alert'</span></span></span><span class="actionscript">](</span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">1</span></span></span><span class="actionscript">)</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript">self[</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'alert'</span></span></span><span class="actionscript">](</span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">2</span></span></span><span class="actionscript">)</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">LPAD</span></span>(<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">version</span></span>())=<span class="hljs-string"><span class="hljs-string">'5.7'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">sleep</span></span>(<span class="hljs-number"><span class="hljs-number">5</span></span>),<span class="hljs-literal"><span class="hljs-literal">null</span></span>);</code> </pre> <br>  Vous pouvez √©galement utiliser la repr√©sentation non symbolique des expressions JavaScript: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JSFuck</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jjencode</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Xchars.js</a> . </li></ul><br>  Un probl√®me √©vident avec cela est de longues charges utiles. <br><br>  Le contournement WAF avec cette technique d√©pend de l'attaque et de la pile de technologies exploit√©e.  Le c√©l√®bre exploit ImageTragick en est un bon exemple.  La plupart des WAF qui prot√®gent contre cette attaque avaient des mots-cl√©s sur liste noire comme <b>URL</b> , <b>capacit√©</b> et <b>√©tiquette,</b> car ces mots √©taient mentionn√©s dans la majorit√© des articles et des PoC d√©crivant cette vuln√©rabilit√©.  Bien qu'il ait √©t√© bient√¥t r√©v√©l√© que d'autres mots cl√©s peuvent √©galement √™tre utilis√©s, par exemple, <b>√©ph√©m√®re</b> et <b>pango</b> .  Par cons√©quent, les WAF pourraient √™tre contourn√©s avec l'utilisation de ces mots cl√©s. <br><br><h4>  Pollution des param√®tres HTTP (HPP) et fragmentation des param√®tres HTTP (HPF) </h4><br>  L'attaque HPP est bas√©e sur la fa√ßon dont un serveur interpr√®te les param√®tres avec les m√™mes noms.  Voici quelques contournements possibles: <br><br><ul><li>  Le serveur utilise le dernier param√®tre re√ßu et WAF ne v√©rifie que le premier; </li><li>  Le serveur unit la valeur des param√®tres similaires et WAF les v√©rifie s√©par√©ment. </li></ul><br>  Vous pouvez comparer la fa√ßon dont diff√©rents serveurs traitent les m√™mes param√®tres dans le tableau ci-dessous: <br><br><img src="https://habrastorage.org/webt/59/e3/77/59e3770e949f3269504620.png"><br><br>  √Ä son tour, l'attaque HPF est bas√©e sur un principe diff√©rent.  Si la logique d'une application Web r√©unit deux param√®tres ou plus dans une demande, l'adversaire peut diviser la demande pour contourner certaines v√©rifications WAF. <br>  L'injection SQL suivante est un exemple d'une telle attaque: <br><br><pre> <code class="html hljs xml">http://test.com/url?a=1+select&amp;b=1+from&amp;c=base</code> </pre> <br>  HPF et HPP sont tr√®s similaires, mais le premier cible une application Web et le second l'environnement dans lequel elle fonctionne.  La combinaison de ces techniques augmente les chances de contourner un WAF. <br><br><h4>  Normalisation Unicode </h4><br>  La normalisation Unicode est une fonctionnalit√© d'Unicode destin√©e √† comparer les symboles Unicode qui se ressemblent.  Par exemple, les symboles <b>¬´¬™¬ª</b> et <b>¬´·µÉ¬ª</b> ont des codes diff√©rents mais sont tr√®s similaires dans le cas contraire, donc apr√®s normalisation, ils ressembleront tous les deux √† un simple <b>¬´a¬ª</b> et seront consid√©r√©s comme identiques.  La normalisation permet de transformer certains symboles Unicode complexes en leurs alternatives plus simples.  Il existe une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">table de normalisation Unicode</a> avec tous les symboles Unicode et leurs normalisations possibles.  En l'utilisant, vous pouvez cr√©er diff√©rentes charges utiles et les combiner avec d'autres m√©thodes.  Cependant, cela ne fonctionne pas pour toutes les applications Web et est tr√®s d√©pendant de l'environnement. <br><br>  Par exemple, dans le tableau ci-dessus, nous pouvons voir que les symboles <b><code>Ôºú</code></b> et <b><code>Ôπ§</code></b> transforment en simple <b><code>&lt;</code></b> .  Si une application utilise le codage HTML apr√®s la normalisation, il est fort probable que le symbole normalis√© <b><code>&lt;</code></b> sera cod√© dans <b><code>&amp;lt;</code></b>  .  Mais, dans d'autres cas, les d√©veloppeurs peuvent avoir ignor√© cette fonctionnalit√© et non cod√© les symboles Unicode.  Ainsi, nous obtenons des symboles non cod√©s HTML <b>&lt;</b> et <b>&gt;</b> , qui peuvent √™tre transform√©s en attaque XSS.  WAF peut avoir du mal √† comprendre les symboles Unicode - il peut tout simplement ne pas avoir de r√®gles pour de telles astuces, et l'apprentissage automatique peut √©galement √™tre inutile.  Tout en trouvant un contournement dans les applications Web avec la normalisation Unicode, nous pouvons remplacer non seulement <b>&lt;&gt;</b> mais aussi d'autres symboles de la charge utile. <br><br>  Par exemple: <br><br><pre> <code class="html hljs xml">Ôºúimg srcÔπ¶x onerrorÔºùalertÔ∏µ1)&gt;</code> </pre> <br>  R√©cemment, ce probl√®me a √©t√© trouv√© dans le programme Rockstar BugBounty de HackerOne.  Il n'y avait pas de WAF, seulement un filtrage strict des entr√©es utilisateur: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hackerone.com/reports/231444</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hackerone.com/reports/231389</a> <br><br><h4>  Brise-jetons </h4><br>  Les attaques contre les tokenizers tentent de briser la logique de la division d'une requ√™te en tokens √† l'aide des soi-disant disjoncteurs de token.  Les disjoncteurs de jetons sont des symboles qui permettent d'affecter la correspondance entre un √©l√©ment d'une cha√Æne et un certain jeton, et ainsi de contourner la recherche par signature.  Mais lors de l'utilisation du disjoncteur de jeton, la demande doit rester valide.  La demande suivante est un exemple d'attaque utilisant un disjoncteur de jeton <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span>-@<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">version</span></span>()</code> </pre> <br>  o√π <b>- @</b> est le disjoncteur de jeton. <br><br>  Il y a une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">feuille de d√©chiffrage</a> qui a √©t√© acquise par fuzzing mysql et en v√©rifiant les r√©sultats dans libinjection. <br><br>  En savoir plus sur la recherche de probl√®mes dans la libinjection: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un autre flou</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fuzz √† contourner</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment contourner la libinjection</a> <br><br><h4>  Utilisation des fonctionnalit√©s de RFC </h4><br>  Dans les sp√©cifications du protocole HTTP / 1.1 et de divers types de requ√™tes (par exemple multipart / form-data), nous pouvons trouver des choses curieuses li√©es aux cas limites et aux astuces de traitement des en-t√™tes et des param√®tres.  Les d√©veloppeurs WAF ne prennent souvent pas en compte de tels probl√®mes, par cons√©quent, un WAF peut analyser une demande de mani√®re incorrecte et manquer la partie des donn√©es, o√π un vecteur d'attaque est masqu√©.  La plupart des probl√®mes dans les WAF sont li√©s au traitement des donn√©es en plusieurs parties / formulaires et aux valeurs sp√©cifiques du param√®tre de limite, qui sp√©cifie les limites de param√®tre dans de telles demandes.  En plus de cela, les d√©veloppeurs de serveurs peuvent √©galement se tromper et ne pas prendre enti√®rement en charge les sp√©cifications, il peut donc y avoir des fonctionnalit√©s non document√©es dans l'analyseur HTTP d'un serveur. <br><br>  Dans une requ√™te HTTP avec multipart / form-data, la limite des param√®tres est en charge de la s√©gr√©gation des diff√©rents param√®tres dans le corps d'une requ√™te.  Selon la RFC, une fronti√®re pr√©c√©demment sp√©cifi√©e avec un pr√©fixe contenant "-" doit √™tre plac√©e avant chaque nouveau param√®tre POST, afin que le serveur soit capable de discriminer les diff√©rents param√®tres d'une demande. <br><br><pre> <code class="plaintext hljs">POST /vuln.php HTTP/1.1 Host: test.com Connection: close Content-Type: multipart/form-data; boundary=1049989664 Content-Length: 192 --1049989664 Content-Disposition: form-data; name="id" 287356 --1049989664--</code> </pre> <br>  L'attaque peut √©galement √™tre bas√©e sur le fait qu'un serveur et un WAF g√®rent diff√©remment une situation o√π la fronti√®re est laiss√©e vide.  Selon la RFC, dans ce cas, ¬´-¬ª est la fronti√®re entre les param√®tres.  N√©anmoins, un WAF peut utiliser un analyseur qui ne tient pas compte de cela, et, par cons√©quent, le WAF passera la demande parce que les donn√©es des param√®tres d'une demande POST n'appara√Ætraient pas dans l'analyseur.  Le serveur Web peut analyser une telle demande sans probl√®me et remettre les donn√©es pour un traitement ult√©rieur. <br>  Voici quelques exemples plus int√©ressants. <br><br><pre> <code class="plaintext hljs">POST /vuln.php HTTP/1.1 Host: test.com Connection: close Content-Type: multipart/form-data; boundary= Content-Length: 192 -- Content-Disposition: form-data; name="id" 123' or sleep(20)# ----</code> </pre> <br>  Nous donnerons quelques exemples plus int√©ressants des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">diapositives</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bo0oM</a> √† ZeroNights 2016 et l'expliquerons: <br><br><pre> <code class="plaintext hljs">POST /vuln.php HTTP/1.1 Host: test.com Content-Type: multipart/form-data; boundary=FIRST; Content-Type: multipart/form-data; boundary=SECOND; Content-Type: multipart/form-data; boundary=THIRD; --THIRD Content-Disposition: form-data; name=param UNION SELECT version() --THIRD--</code> </pre><br>  Dans cette attaque, nous essayons de d√©finir lequel des param√®tres de limite sera accept√© par le WAF et lequel par le serveur Web.  Ainsi, s'ils acceptent diff√©rents param√®tres, il est possible d'effectuer une attaque en sp√©cifiant une limite que le WAF ne verra pas.  Cette attaque est un peu comme HPP. <br><br><pre> <code class="plaintext hljs">POST /vuln.php HTTP/1.1 Host: test.com Content-Type: multipart/form-data; xxxboundaryxxx=FIRST; boundary=SECOND; --FIRST Content-Disposition: form-data; name=param UNION SELECT version() --FIRST--</code> </pre><br>  Cette attaque est bas√©e sur l'hypoth√®se qu'il existe une diff√©rence dans l'analyse d'une demande HTTP par le WAF et par le serveur Web.  √Ä savoir, l'analyseur du serveur Web recherche la premi√®re entr√©e ¬´limite¬ª, puis le symbole ¬´=¬ª, et seulement apr√®s cela d√©finit la valeur de limite.  L'analyseur WAF, √† son tour, ne recherche que l'entr√©e ¬´limite =¬ª, puis d√©finit la limite.  Si ces conditions sont remplies, le WAF ne trouvera pas la limite dans la demande et ne pourra donc pas trouver et analyser le param√®tre.  Au contraire, le serveur Web recevra la demande et traitera le param√®tre.  Cette attaque fonctionnera √©galement dans l'autre sens: l'analyseur du serveur Web recherche ¬´limite =¬ª et l'analyseur WAF ne recherche que ¬´limite¬ª.  Dans ce cas, nous n'aurons qu'√† changer la fronti√®re r√©elle de FIRST √† SECOND. <br><br><pre> <code class="plaintext hljs">POST /somepage.php HTTP/1.1 Host: test.com Content-Type: multipart/form-data; boundary=Test0x00othertext; --Test Content-Disposition: form-data; name=param Attack --Test--</code> </pre><br>  Cette attaque utilise √©galement des caract√®res sp√©ciaux.  Dans le param√®tre de limite, nous avons ajout√© NULL-byte afin que le serveur Web le coupe, mais le WAF l'accepte dans son int√©gralit√©.  Dans ce cas, WAF ne peut pas analyser le param√®tre car il ne peut pas trouver ses limites. <br><br><h4>  Contourner l'apprentissage automatique </h4><br>  La logique est simple: nous devons composer une attaque qui satisferait les param√®tres du mod√®le statistique entra√Æn√©.  Mais cela d√©pend fortement de la fa√ßon dont le WAF a √©t√© form√© et du mod√®le de formation utilis√©.  Parfois, il est possible de trouver une √©chappatoire, et parfois ce n'est pas le cas.  Habituellement, au stade de la mise en ≈ìuvre, un WAF avec apprentissage automatique n√©cessite une formation suppl√©mentaire bas√©e sur la demande adress√©e √† l'application Web du client.  Cela pose un probl√®me pour les pentesters: les param√®tres qui se ressemblent et ne changent pas beaucoup d'une demande √† l'autre ne peuvent pas √™tre test√©s, car toute digression √† partir de la forme de param√®tre habituelle serait consid√©r√©e comme une anomalie.  Disons que nous <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">devons</a></b> demander √† <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">api.test.com/getuser?id=123</a></b> .  L'ID de param√®tre est toujours num√©rique et il √©tait num√©rique dans l'exemple d'apprentissage.  Si le module d'apprentissage automatique trouve autre chose que des nombres dans ce param√®tre, il d√©cidera tr√®s probablement qu'il s'agit d'une anomalie.  Un autre exemple: supposons que WAF ait √©t√© form√© pour classer la demande POST sur <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">api.test.com/setMarkDown</a></b> avec des param√®tres POST contenant du texte de d√©marque.  De toute √©vidence, il peut y avoir des guillemets, des symboles sp√©ciaux et essentiellement n'importe quoi dans le d√©marque.  Dans ce cas, il est beaucoup plus facile de contourner le module d'apprentissage automatique car le WAF tol√®re les guillemets et les symboles sp√©ciaux. <br><br>  De plus, sur les exemples de notre pratique, nous montrerons qu'il ne va pas toujours aussi loin que le module d'apprentissage automatique en raison des probl√®mes d'analyse des param√®tres caus√©s par les m√©thodes de contournement d√©crites ci-dessus. <br><br>  En g√©n√©ral, nous devons consid√©rer les sp√©cificit√©s d'une demande test√©e et ses param√®tres, pr√©sumer toutes les options possibles des valeurs des param√®tres, auxquelles WAF peut √™tre tol√©rant, et s'appuyer sur celles-ci. <br><br><h4>  Quand WAF est inutile? </h4><br>  WAF analyse les requ√™tes et recherche les comportements anormaux, mais il existe certaines classes de vuln√©rabilit√©s qu'il ne peut pas d√©couvrir.  Par exemple, les vuln√©rabilit√©s logiques, qui n'ont pas d'anomalies mais ont des actions qui perturbent la logique d'une application Web.  Tr√®s probablement, WAF serait √©galement inutile en cas de condition de concurrence, d'IDOR et d'authentification utilisateur non s√©curis√©e. <br><br><h4>  Utilitaires existants </h4><br>  Il existe des outils automatiques pour trouver les contournements WAF, √©crits par les passionn√©s de ce domaine.  Voici les plus c√©l√®bres et les plus dignes: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lightbulb-framework</a> - un framework complet pour tester des applications web prot√©g√©es avec WAF.  Il est √©crit sur Python et est √©galement port√© en tant que plugin pour Burp Suite.  Ses principales caract√©ristiques sont ces deux algorithmes: <br><br><ul><li>  GOFA - un algorithme d'apprentissage automatique actif qui permet d'analyser la filtration et la d√©sinfection des param√®tres dans une application Web. </li><li>  SFADiff - algorithme de test de bo√Æte noire d√©f√©rent, bas√© sur la formation avec des automates finis symboliques (SFA).  Il permet de trouver des diff√©rences dans le comportement des applications Web, ce qui aide √† identifier le WAF et √† trouver un contournement. </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bypass WAF</a> - un plugin pour Burp Suite, qui permet de configurer la modification automatique des √©l√©ments dans le corps d'une demande selon diff√©rentes r√®gles et modifications de codage.  Il peut √©galement automatiser une attaque HPP. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WAFW00F</a> - un outil d'identification WAF, √©crit sur Python.  Il a une base WAF d√©cente et est toujours en cours de mise √† jour.  Cependant, les r√©sultats peuvent √™tre impr√©cis car de nombreux WAF sont mis √† jour plus fr√©quemment que le projet lui-m√™me. <br><br><h2>  Contournement du waf en pratique </h2><br><img src="https://habrastorage.org/webt/59/e4/fc/59e4fc4eee061363676501.png"><br><br>  Nous avons effectu√© un test de p√©n√©tration d'une boutique en ligne, qui √©tait prot√©g√©e par <b>PT AF</b> (Positive Technologies Application Firewall).  Il √©tait difficile de trouver un point faible, qui pourrait √™tre une base pour une d√©rivation.  Mais bient√¥t, nous avons d√©couvert un comportement inhabituel du c√¥t√© de l'application Web, qui n'a pas √©t√© filtr√© par le WAF.  L'anomalie a √©t√© trouv√©e dans la recherche dans l'histoire des biens achet√©s.  La demande a √©t√© envoy√©e au format JSON et ressemblait √† √ßa: <br><br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"request"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"Count"</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-attr"><span class="hljs-attr">"Offset"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-attr"><span class="hljs-attr">"ItemName"</span></span>:<span class="hljs-string"><span class="hljs-string">"Phone"</span></span>}}</code> </pre> <br>  Nous avons plac√© les valeurs <b>Phone '</b> et <b>Phone' + '</b> dans le param√®tre <b>ItemName</b> et constat√© que le serveur renvoyait des r√©ponses diff√©rentes pour ces deux demandes.  Dans le premier cas, la r√©ponse √©tait vide;  dans le second cas, il contenait des donn√©es sur d'autres marchandises avec le mot <b>Phone</b> dans leur nom, comme si le param√®tre <b>ItemName</b> avait <b>Phone</b> comme valeur.  Ce type de comportement est bien connu des pirates et des pentesters et indique que l'application a un probl√®me avec la filtration des entr√©es utilisateur, ce qui entra√Æne entre autres l'injection SQL. <br><br>  Voyons pourquoi cela se produit avec un exemple d'injection SQL.  Si un tel comportement se trouve dans une application Web, il est fort probable que les donn√©es d'une demande SQL soient en concat√©nation avec la demande elle-m√™me.  Dans le premier cas, avec <b>le</b> param√®tre <b>Phone</b> , nous aurons la requ√™te SQL suivante: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> items <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> item_name=<span class="hljs-string"><span class="hljs-string">'Phone''</span></span></code> </pre> <br>  De toute √©vidence, il ne sera pas ex√©cut√© en raison d'une syntaxe incorrecte et ne retournera aucun r√©sultat.  La deuxi√®me demande, avec <b>le</b> param√®tre <b>Phone '+'</b> , ressemblera √† ceci: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> items <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> item_name=<span class="hljs-string"><span class="hljs-string">'Phone'</span></span>+<span class="hljs-string"><span class="hljs-string">''</span></span></code> </pre> <br>  Sa syntaxe est correcte, il s√©lectionnera donc les marchandises sous le nom de <b>T√©l√©phone</b> .  Cette m√©thode de d√©tection des vuln√©rabilit√©s pr√©sente un √©norme avantage lors du test d'une application web prot√©g√©e par WAF.  Le symbole de guillemet simple n'est pas consid√©r√© comme une anomalie suffisante dans un param√®tre par la plupart des WAF modernes, ils transmettent donc une demande avec. <br><br>  Nous avons d√©crit la d√©tection de vuln√©rabilit√©, mais qu'en est-il de contourner WAF et d'exploiter la vuln√©rabilit√©?  Apr√®s avoir travers√© quelques contournements, nous avons trouv√© un probl√®me dans le WAF.  Il s'est av√©r√© que ce WAF est vuln√©rable aux caract√®res sp√©ciaux ajout√©s aux param√®tres JSON.  En fait, si nous ajoutions les symboles JSON <b>0x0A, 0x0D</b> (\ r \ n ou carrige reutrn et nouvelle ligne) au format brut, sans aucun codage, dans un champ de texte, le WAF le transmettrait et l'application Web le consid√©rerait comme √™tre correct et le traiter.  Tr√®s probablement, le probl√®me √©tait dans l'analyseur JSON, qui n'√©tait pas fait pour les symboles sp√©ciaux et analysait JSON jusqu'√† un endroit o√π ces symboles appara√Ætraient.  Ainsi, l'analyseur WAF n'obtiendrait pas la demande compl√®te, nous pourrions donc ins√©rer n'importe quel vecteur d'attaque apr√®s des caract√®res sp√©ciaux.  Outre le saut de ligne, d'autres caract√®res (par exemple NULL-byte) fonctionneraient √©galement.  En cons√©quence, nous pourrions √©crire la demande suivante, qui d√©sactiverait le WAF alors qu'il tentait de v√©rifier cette demande (le saut de ligne et le retour chariot ont √©t√© remplac√©s par leur repr√©sentation textuelle): <br><br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"request"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"kill-waf"</span></span>:<span class="hljs-string"><span class="hljs-string">"die0x0A0x0D"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Count"</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-attr"><span class="hljs-attr">"Offset"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-attr"><span class="hljs-attr">"ItemName"</span></span>:[<span class="hljs-string"><span class="hljs-string">"'+(SELECT 'Phone'+CHAR(ASCII(substring(@@version,1,1))-24))+'"</span></span>]}}</code> </pre> <br>  <i>0x0A et 0x0D est un octet brut.</i> <br><br>  Ainsi, nous avons pu tester facilement et rapidement tous les param√®tres pour toutes les vuln√©rabilit√©s (deux d'entre eux ont √©t√© trouv√©s dans d'autres param√®tres).  Le contournement de WAF et l'exploitation de cette injection nous ont permis de compromettre totalement tous les utilisateurs de l'application Web. <br><br>  Les m√™mes probl√®mes ont √©galement √©t√© constat√©s dans <b>Nemesida WAF</b> .  La seule diff√©rence est que la demande n'√©tait pas en codage JSON, mais c'√©tait une demande POST habituelle avec des param√®tres, et un param√®tre a √©t√© conc√©d√© √† la requ√™te SQL sous forme de nombre.  Si certains symboles ont √©t√© plac√©s dans une demande en code URL, par exemple, <b>% 03% 04,</b> alors WAF bloque une demande, mais si les symboles ont √©t√© plac√©s sous forme brute sans encodage URL, WAF ignore cette demande.  Il convient de noter que l'expression SQL normale a √©t√© plac√©e pour demander ainsi que dans le WAF pr√©c√©dent.  L'expression SQL √©tait un simple <b>¬´UNION SELECT¬ª</b> sans aucune obfuscation suppl√©mentaire, ce qui signifie que WAF ne pouvait tout simplement pas analyser correctement la demande et continuer l'analyse.  Mais il y a un probl√®me - comment rendre la syntaxe de requ√™te SQL correcte?  Parce que l'utilisation de caract√®res sp√©ciaux comme <b>% 03% 04</b> dans la requ√™te SQL n'est pas correcte.  La r√©ponse est simple - nous avons juste besoin d'utiliser les commentaires / ** /.  Ainsi, la demande de r√©sultat ressemblait √†: <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/*0x03 0x04*/</span></span>1 UNION <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>() <span class="hljs-comment"><span class="hljs-comment">--</span></span></code> </pre> <br>  <i>0x03 et 0x04 est un octet brut.</i> <br><br>  En outre, un autre probl√®me a √©t√© d√©tect√© dans Nemesida WAF.  Il √©tait li√© √† un traitement incorrect des demandes POST avec des donn√©es en plusieurs parties / formulaires.  Comme nous l'avons d√©crit ci-dessous, dans une requ√™te HTTP avec multipart / form-data, la <b>fronti√®re des</b> param√®tres est en charge de la s√©gr√©gation des diff√©rents param√®tres dans le corps d'une requ√™te.  Selon la RFC, une fronti√®re pr√©c√©demment sp√©cifi√©e avec un pr√©fixe contenant <b>"-"</b> doit √™tre plac√©e avant chaque nouveau param√®tre POST, afin que le serveur soit capable de discriminer les diff√©rents param√®tres d'une demande. <br>  Le probl√®me √©tait donc que le serveur et le WAF g√©raient la situation diff√©remment lorsque le param√®tre de limite √©tait vide.  Sur la base de la RFC, dans une telle situation, la fronti√®re entre les param√®tres sera une s√©quence de caract√®res <b>¬´-¬ª</b> .  Cependant, WAF a utilis√© un analyseur qui ne prend pas en compte cette fonctionnalit√©, c'est pourquoi WAF transmet √† nouveau la demande, car les donn√©es des param√®tres de demande POST ne sont tout simplement pas entr√©es dans le module d'analyseur et le serveur a analys√© cette situation sans aucun probl√®me. et transf√©r√© les donn√©es √† la suite du traitement.  Voici un exemple de demande pour cette attaque: <br><br><pre> <code class="plaintext hljs">POST /wp-content/plugins/answer-my-question/modal.php HTTP/1.1 Host: example.com Content-Type: multipart/form-data; boundary= Content-Length: 209 -- Content-Disposition: form-data; name="id" 1 UNION SELECT 1,2,3,CONVERT(version() USING utf8) AS name,CONVERT(user() USING utf8) AS name,6,7,8,9,10,11,12 FROM wp_users WHERE id=1 ----</code> </pre><br>  Les deux probl√®mes ont √©t√© signal√©s √† Pentestit, les gars ont pay√© une r√©compense pour leur programme de primes de bogues pour Nemesida WAF, et ont corrig√© les probl√®mes d√®s que possible.  Merci pour cela. <br><br>  Comme nous pouvons le voir, les WAF peuvent √™tre modernes et intelligents, mais il est parfois possible de les contourner simplement en ajoutant un seul caract√®re sp√©cial.  Aujourd'hui, nous ne pouvons pas pr√©voir tous les types de donn√©es d'entr√©e possibles pour tous les serveurs au stade du d√©veloppement, et l'apprentissage automatique, mis en ≈ìuvre pour faire exactement cela, tombe sur des analyseurs qui se retrouvent coinc√©s avec des caract√®res sp√©ciaux. <br><br><h2>  Conclusion </h2><br><img align="left" src="https://habrastorage.org/webt/59/e5/54/59e55464f2331285132470.png">  Alors, devons-nous nous reposer enti√®rement sur WAF?  <b>La r√©ponse est NON.</b> <br><br>  Dans l'un de nos audits, nous avons d√©couvert un contournement WAF qui nous a permis d'exploiter certaines vuln√©rabilit√©s.  Il s'est av√©r√© que les d√©veloppeurs avaient d√©j√† effectu√© un audit de l'application Web, avant qu'elle ne soit prot√©g√©e par WAF, et qu'elle r√©v√©lait les m√™mes vuln√©rabilit√©s.  Au lieu de les r√©parer, ils ont d√©cid√© d'acheter un WAF moderne √©quip√© de machine learning.  Il est dommage que le fournisseur du WAF n'ait pas insist√© pour corriger d'abord les vuln√©rabilit√©s;  ou peut-√™tre que les d√©veloppeurs eux-m√™mes pensaient que le WAF serait une meilleure option.  Nous ne savons cependant pas avec certitude.  Quoi qu'il en soit, c'est un exemple d'une tr√®s mauvaise pratique, de la part des d√©veloppeurs et du fournisseur.  Il convient √©galement de noter que l'apprentissage automatique est toujours une bo√Æte noire et ressemble plus √† un dispositif de marketing qu'√† une v√©ritable d√©fense. <br><br>  En g√©n√©ral, WAF est une solution de s√©curit√© moderne, et cela ne fera pas de mal de l'avoir avec vos applications Web.  Bien qu'aujourd'hui, il ne peut qu'entraver le processus de recherche et d'exploitation des vuln√©rabilit√©s, mais il ne peut pas les prot√©ger compl√®tement.  Dans l'√©tat actuel des choses, c'est l'√©tat de l'art depuis un bon moment.  Les vuln√©rabilit√©s dans les applications Web ne peuvent √™tre corrig√©es qu'en corrigeant le code qui leur est associ√©, et c'est la seule solution infaillible. <br><br>  <b>Contributeurs</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ilia Bulatov</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">barracud4</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Denis Rybin</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">thefaeriedragon</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Alexander Romanov</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">web_rock</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr454592/">https://habr.com/ru/post/fr454592/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr454582/index.html">La longueur du tableau doit-elle √™tre stock√©e dans une variable locale en C #?</a></li>
<li><a href="../fr454584/index.html">√âcole de d√©veloppement d'interface: analyse des t√¢ches pour Minsk et un nouvel ensemble √† Moscou</a></li>
<li><a href="../fr454586/index.html">R√©solution de mots crois√©s japonais avec PÃ∂yÃ∂tÃ∂hÃ∂oÃ∂Ã∂nÃ∂ Rust et WebAssembly</a></li>
<li><a href="../fr454588/index.html">Gazprom Neft vous invite √† visiter: GPN Data Science Meetup</a></li>
<li><a href="../fr454590/index.html">Zimbra Collaboration Suite et Mobile Control avec ABQ</a></li>
<li><a href="../fr454596/index.html">Mod√®les mentaux en s√©curit√© de l'information</a></li>
<li><a href="../fr454598/index.html">Architecture sans serveur et microservices: l'accord parfait?</a></li>
<li><a href="../fr454600/index.html">Comment nous avons conclu un accord s√ªr sur Freelansim: donner un choix, r√©duire les fonctionnalit√©s, comparer les commissions</a></li>
<li><a href="../fr454604/index.html">G√©n√©rer une application React avec un backend GraphQL en quelques minutes</a></li>
<li><a href="../fr454606/index.html">Caract√©ristiques de l'attribut inputmode pour le syst√®me d'exploitation mobile et les navigateurs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>