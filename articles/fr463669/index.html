<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•î üß† ‚úåüèΩ Protocole MQTT: immersion conceptuelle ü§Ω üëçüèø üõçÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le protocole Message Queuing Telemetry Transport (MQTT) est utilis√© depuis de nombreuses ann√©es, mais il est maintenant particuli√®rement pertinent en ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Protocole MQTT: immersion conceptuelle</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463669/">  Le protocole Message Queuing Telemetry Transport (MQTT) est utilis√© depuis de nombreuses ann√©es, mais il est maintenant particuli√®rement pertinent en raison de la croissance explosive de l'IoT: les appareils grand public et industriels mettent en ≈ìuvre des r√©seaux distribu√©s et l'informatique de pointe, et les appareils avec transmission de donn√©es continue font partie du quotidien de la vie. <br><br>  Cela signifie que les protocoles l√©gers, ouverts et abordables deviendront encore plus importants au fil du temps.  Cet article propose une immersion conceptuelle dans MQTT: comment cela fonctionne, comment il est utilis√© maintenant et comment il sera utilis√© √† l'avenir. <br><a name="habracut"></a><br><h1>  Petite introduction </h1><br>  MQTT est un protocole de messagerie bas√© sur un √©diteur-abonn√© (pub / sub).  La version initiale en 1999 a √©t√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">publi√©e par</a> Andy Stanford-Clark d'IBM et Arlene Nipper de Cirrus Link.  Ils ont consid√©r√© MQTT comme un moyen de maintenir la communication entre les machines dans des r√©seaux √† bande passante limit√©e ou des communications impr√©visibles.  L'une des premi√®res options pour son utilisation √©tait de s'assurer que les fragments du pipeline √©taient en contact les uns avec les autres et avec les liaisons centrales via des satellites. <br><br>  Compte tenu des conditions de fonctionnement difficiles, le protocole est rendu petit et l√©ger.  Il est id√©al pour les appareils √† faible consommation et avec une autonomie limit√©e.  Ceux-ci incluent d√©sormais les smartphones omnipr√©sents et le nombre toujours croissant de capteurs et d'appareils connect√©s. <br><br>  Ainsi, MQTT est devenu un protocole pour diffuser des donn√©es entre des appareils avec une puissance CPU et / ou une autonomie de batterie limit√©es, ainsi que pour des r√©seaux √† bande passante co√ªteuse ou faible, √† stabilit√© impr√©visible ou √† latence √©lev√©e.  C'est pourquoi MQTT est connu comme le v√©hicule id√©al pour l'IoT.  Il est construit sur le protocole TCP / IP, mais il existe une branche MQTT-SN pour travailler via Bluetooth, UDP, ZigBee et d'autres r√©seaux IoT autres que TCP / IP. <br><br>  MQTT n'est pas le seul protocole de messagerie pub / sub en temps r√©el de ce type, mais il a d√©j√† √©t√© largement accept√© dans divers environnements qui d√©pendent des communications de machine √† machine.  Parmi ses pairs figurent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le protocole de messagerie des applications Web, le protocole de</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">messagerie orient√©e texte et le protocole</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">alternatif de Message Queuing</a> . <br><br>  MQTT est le choix logique pour les d√©veloppeurs qui souhaitent cr√©er des applications avec des fonctionnalit√©s fiables et une large compatibilit√© avec les appareils et applications connect√©s √† Internet, y compris les navigateurs, les smartphones et les appareils IoT. <br><br><h1>  Comment fonctionne MQTT: les bases </h1><br>  Le syst√®me de communication construit sur MQTT se compose d'un serveur √©diteur, d'un serveur courtier et d'un ou plusieurs clients.  L'√©diteur ne requiert aucun param√®tre pour le nombre ou l'emplacement des abonn√©s qui re√ßoivent des messages.  De plus, les abonn√©s n'ont pas besoin de syntoniser un √©diteur sp√©cifique.  Il peut y avoir plusieurs courtiers de messages dans le syst√®me. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/029/60b/c0b/02960bc0baf11fcfc7c8cd56d331ba4c.png"><br><br>  MQTT fournit un moyen de cr√©er une hi√©rarchie de canaux de communication - une sorte de branche avec des feuilles.  Chaque fois que l'√©diteur a de nouvelles donn√©es √† distribuer aux clients, le message est accompagn√© d'un bon de livraison.  Les clients de niveau sup√©rieur peuvent recevoir chaque message, tandis que les clients de niveau inf√©rieur peuvent recevoir des messages li√©s √† un ou deux canaux de base seulement, des ¬´branches¬ª au bas de la hi√©rarchie.  Cela facilite l'√©change d'informations dont la taille varie de deux octets <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√† 256 m√©gaoctets</a> . <br><br>  Un exemple de la fa√ßon dont vous pouvez configurer le client pour se connecter via le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">courtier MQTT</a> : <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> options = { <span class="hljs-attr"><span class="hljs-attr">keepalive</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-attr"><span class="hljs-attr">username</span></span>: <span class="hljs-string"><span class="hljs-string">'FIRST_HALF_OF_API_KEY'</span></span>, <span class="hljs-attr"><span class="hljs-attr">password</span></span>: <span class="hljs-string"><span class="hljs-string">'SECOND_HALF_OF_API_KEY'</span></span>, <span class="hljs-attr"><span class="hljs-attr">port</span></span>: <span class="hljs-number"><span class="hljs-number">8883</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> client = mqtt.connect(<span class="hljs-string"><span class="hljs-string">'mqtts:mqtt.ably.io'</span></span>, options);</code> </pre> <br>  Toutes les donn√©es publi√©es ou re√ßues par le courtier MQTT seront encod√©es au format binaire, car MQTT est un protocole binaire.  Cela signifie que pour obtenir le contenu original, vous devez interpr√©ter le message.  Voici √† quoi cela ressemble avec Ably et JavaScript: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ably = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Ably.Realtime(<span class="hljs-string"><span class="hljs-string">'REPLACE_WITH_YOUR_API_KEY'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> decoder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TextDecoder(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> channel = ably.channels.get(<span class="hljs-string"><span class="hljs-string">'input'</span></span>); channel.subscribe(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">message</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> command = decoder.decode(message.data); });</code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les courtiers MQTT</a> peuvent parfois accumuler des messages li√©s √† des canaux qui n'ont pas d'abonn√©s actuels.  Dans ce cas, les messages seront rejet√©s ou enregistr√©s, selon les instructions du message de contr√¥le.  Cela est utile dans les cas o√π les nouveaux abonn√©s peuvent avoir besoin du dernier point de donn√©es enregistr√©, plut√¥t que d'attendre le prochain envoi. <br><br>  Il est √† noter que MQTT transmet les informations d'identification de s√©curit√© en texte clair, sinon les fonctions d'authentification ou de s√©curit√© ne sont pas prises en charge.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">C'est l√† que le cadre SSL entre en jeu</a> , aidant √† prot√©ger les informations transmises contre toute interception ou falsification. <br><br>  De plus, dans MQTT, vous pouvez utiliser l'authentification Ably sur les jetons si vous ne souhaitez pas divulguer votre cl√© API au client MQTT r√©el (dans le cas de MQTT sans SSL, les jetons sont requis pour emp√™cher le transfert des cl√©s API en texte clair).  Exemple d'authentification par jeton: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> options = { <span class="hljs-attr"><span class="hljs-attr">keepalive</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-attr"><span class="hljs-attr">username</span></span>: INSERT_TOKEN_HERE, <span class="hljs-attr"><span class="hljs-attr">password</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">port</span></span>: <span class="hljs-number"><span class="hljs-number">8883</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> client = mqtt.connect(<span class="hljs-string"><span class="hljs-string">'mqtts:mqtt.ably.io'</span></span>, options); client.subscribe(<span class="hljs-string"><span class="hljs-string">"[mqtt]tokenevents"</span></span>, { <span class="hljs-comment"><span class="hljs-comment">/* Create a new token called 'NEW_TOKEN' */</span></span> client.end(); options.username = NEW_TOKEN; client = mqtt.connect(<span class="hljs-string"><span class="hljs-string">'mqtts:mqtt.ably.io'</span></span>, options); });</code> </pre> <br><h1>  Fonctionnalit√© MQTT: une immersion plus profonde </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Selon IBM</a> , MQTT a les propri√©t√©s suivantes: <br><br><ul><li>  Neutre au contenu du message <br></li><li>  Id√©al pour les communications un √† plusieurs distribu√©es et les applications d√©connect√©es <br></li><li>  Equip√© de la fonction LWT (Last Will and Testament, ¬´last will and testament¬ª) pour signaler aux parties une d√©connexion anormale du client <br></li><li>  S'appuie sur TCP / IP pour les t√¢ches de communication de base <br></li><li>  Con√ßu pour d√©livrer des messages en utilisant les mod√®les "au plus une fois", "au moins une fois" et "exactement une fois" </li></ul><br>  Un membre du syst√®me MQTT peut jouer le r√¥le d'√©diteur, de consommateur ou les deux √† la fois. <br><br>  L'une des caract√©ristiques distinctives de MQTT est sa compr√©hension unique des canaux: chacun d'eux est trait√© comme un chemin de fichier, par exemple: <br><br><pre> <code class="javascript hljs">channel = <span class="hljs-string"><span class="hljs-string">"user/path/channel"</span></span></code> </pre> <br>  Les canaux garantissent que chaque client re√ßoit les messages qui lui sont destin√©s.  En traitant les canaux comme des chemins de fichier, MQTT ex√©cute toutes sortes de fonctions de communication utiles, y compris le filtrage des messages en fonction de l'endroit - √† quel niveau ou dans quelle branche - les clients s'abonnent au chemin de fichier. <br><br><h1>  Format de message MQTT </h1><br>  Regardez les deux composants qui composent chaque message MQTT: <br><br><ul><li>  <b>Octet 1</b> : contient le type de message (demande de connexion client, confirmation d'abonnement, demande ping, etc.), un indicateur de duplication, des instructions pour l'enregistrement des messages et des informations sur la qualit√© de service (QoS). <br></li><li>  <b>Octet 2</b> : contient des informations sur la longueur de message restante, y compris la charge utile et toutes les donn√©es dans l'en-t√™te d'une variable facultative. </li></ul><br>  L'indicateur QoS dans l'octet 1 m√©rite une attention particuli√®re, car il sous-tend la fonctionnalit√© variable prise en charge par MQTT.  Les indicateurs QoS contiennent les valeurs suivantes en fonction de l'intention et de l'urgence du message: <br><br><ul><li>  0 = pas plus d'une fois: le serveur est d√©clench√© et oublie.  Les messages peuvent √™tre perdus ou dupliqu√©s. <br></li><li>  1 = au moins une fois: le destinataire confirme la livraison.  Les messages peuvent √™tre dupliqu√©s, mais la livraison est garantie <br></li><li>  2 = exactement une fois: le serveur assure la livraison.  Les messages arrivent exactement une fois sans perte ni duplication </li></ul><br>  Voyons comment utiliser les diff√©rents niveaux de QoS dans les appareils IoT et d'autres applications. <br><br><h1>  O√π puis-je utiliser MQTT? </h1><br>  Alors que les applications IoT sont d√©sormais mises en ≈ìuvre √† grande √©chelle, MQTT est devenu un moyen ouvert, simple et √©volutif de d√©ployer l'informatique distribu√©e et les fonctionnalit√©s IoT pour une base d'utilisateurs plus large - √† la fois sur les march√©s grand public et industriel. <br><br>  Comme indiqu√© ci-dessus, MQTT est un protocole de messagerie l√©ger con√ßu pour les r√©seaux et les p√©riph√©riques non approuv√©s avec des restrictions sur l'alimentation et le processeur.  Cependant, cela ne signifie pas que la connexion avec une perte potentielle de paquets est sa seule application.  MQTT fournit diff√©rents niveaux de service pour diff√©rents types d'infrastructure IoT, de l'√©chantillonnage r√©p√©titif des donn√©es √† la gestion des machines industrielles: <br><br><ul><li>  <b>Donn√©es de capteur environnemental</b> : Comme d√©j√† mentionn√©, MQTT prend en charge le mod√®le de livraison de message ¬´pas plus d'une fois¬ª.  Dans les r√©seaux √† couverture partielle ou √† latence √©lev√©e, cela signifie que les informations peuvent √™tre perdues ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dupliqu√©es</a> .  Dans les zones o√π les capteurs √† distance enregistrent et transmettent des donn√©es √† des intervalles sp√©cifi√©s, ce n'est pas un probl√®me, car de nouvelles lectures sont re√ßues r√©guli√®rement.  Les capteurs dans des environnements distants sont g√©n√©ralement des appareils √† faible consommation d'√©nergie, ce qui fait de MQTT la solution id√©ale pour les capteurs IoT avec une priorit√© de transfert de donn√©es relativement faible. <br></li><li>  <b>Donn√©es de performances de la machine</b> : pour r√©pondre rapidement aux probl√®mes et √©viter les temps d'arr√™t.  Par exemple, une installation √©olienne doit garantir la livraison des indicateurs de performance actuels aux √©quipes locales avant m√™me que ces informations n'atteignent le centre de donn√©es.  Dans de telles situations, la livraison de messages ¬´au moins une fois¬ª garantit que les sp√©cialistes appropri√©s sont rapidement remarqu√©s par les sp√©cialistes n√©cessaires, m√™me s'ils arrivent en double.  Ceci est important pour les communications machine de priorit√© plus √©lev√©e. <br></li><li>  <b>Syst√®mes de facturation</b> : il y a encore plus de messages prioritaires et pr√©cis qui doivent √™tre trait√©s correctement.  Dans les situations commerciales o√π la duplication des enregistrements est inacceptable, y compris dans les syst√®mes de facturation, l'indicateur de qualit√© de service <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´une seule fois¬ª</a> est utile.  Cela √©limine la duplication ou la perte de packages dans la facturation ou les syst√®mes de facturation, r√©duit le nombre d'anomalies et de contradictions inutiles, comme convenu. </li></ul><br><h1>  Quand ne pas utiliser MQTT? </h1><br>  Les d√©veloppeurs disposent d'une large s√©lection de protocoles pour la conception et le d√©ploiement de canaux de communication IoT bidirectionnels, y compris MQTT, HTTP, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CoAP</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WebSockets</a> (si le CPU / la batterie le permet) et autres.  Que MQTT soit le meilleur choix d√©pend du mat√©riel et de la t√¢che de l'application. <br><br>  Con√ßu pour les environnements √† bande passante extr√™mement faible, le protocole MQTT peut √™tre assez rigide dans sa qu√™te pour enregistrer chaque octet.  Par exemple, la sp√©cification ne d√©finit que cinq messages d'erreur avec lesquels le serveur peut rejeter la connexion (par exemple, un nom d'utilisateur / mot de passe non valide ou une version inacceptable du protocole).  Si le serveur veut signaler une autre erreur, ce n'est pas par chance.  Pire encore, si une erreur se produit apr√®s le d√©marrage de la connexion, il n'existe aucun m√©canisme pour signaler une erreur.  Le serveur ne peut que hausser les √©paules et interrompre brusquement la connexion TCP, laissant le client sans aucun indice pourquoi il l'a abandonn√©e (et sans aucun moyen de distinguer une d√©connexion d√©lib√©r√©e d'un probl√®me de r√©seau temporaire).  Pour les personnes habitu√©es aux protocoles pub / sous plus flexibles et faciles √† d√©boguer (bien que moins √©conomiques en termes de bande passante), une telle approche Spartan peut sembler un peu primitive. <br><br>  MQTT est souvent mentionn√© avec HTTP, donc Google a men√© une √©tude en les comparant en temps de r√©ponse, volume de trafic et autres attributs importants pour les d√©veloppeurs.  MQTT a pris la premi√®re place dans les tests Google, mais <i>uniquement dans des conditions o√π la connexion peut √™tre r√©utilis√©e</i> pour envoyer plusieurs charges utiles. <br><br>  HTTP et MQTT sont un bon choix pour les applications IoT en raison de la quantit√© relativement faible de trafic, de la batterie faible et des besoins en m√©moire. <br><br>  CoAP est un autre protocole souvent compar√© √† MQTT pour le d√©veloppement de syst√®mes IoT.  Ils sont similaires, mais il existe des diff√©rences notables.  MQTT est un protocole plusieurs-√†-plusieurs, tandis que CoAP est essentiellement un protocole un-√†-un pour la communication entre un serveur et un client.  Dans le m√™me temps, CoAP fournit des fonctionnalit√©s de m√©tadonn√©es, de d√©couverte et de n√©gociation de contenu <i>que MQTT ne poss√®de pas</i> . <br><br>  Dans les cas o√π les clients ne devraient recevoir que des donn√©es, les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©v√©nements envoy√©s par le serveur</a> sont √©galement une option appropri√©e. <br><br><h1>  Comment configurer rapidement MQTT </h1><br>  Le r√©f√©rentiel MQTT sur GitHub poss√®de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">une liste compl√®te de biblioth√®ques MQTT open source</a> dans diff√©rentes langues.  Voici deux exemples de personnalisation utilisant le courtier MQTT open source, la biblioth√®que JavaScript et la biblioth√®que .NET. <br><br><h3>  Eclipse Mosquitto - courtier MQTT open source </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Eclipse Mosquitto</a> est un courtier de messages open source (EPL / EDL) qui impl√©mente les protocoles MQTT version 5.0, 3.1.1 et 3.1.  Mosquitto est l√©ger et adapt√© √† une utilisation sur tous les appareils: des ordinateurs monocarte basse consommation aux serveurs √† part enti√®re. <br><br><h3>  MQTT.js </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MQTT.js</a> est une biblioth√®que cliente pour le protocole MQTT, √©crite en JavaScript pour Node.js et un navigateur.  Voici un exemple d'envoi d'un message √† l'aide de MQTT.js: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mqtt = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mqtt'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> client = mqtt.connect(<span class="hljs-string"><span class="hljs-string">'mqtt://test.mosquitto.org'</span></span>) client.on(<span class="hljs-string"><span class="hljs-string">'connect'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ client.subscribe(<span class="hljs-string"><span class="hljs-string">'presence'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!err) { client.publish(<span class="hljs-string"><span class="hljs-string">'presence'</span></span>, <span class="hljs-string"><span class="hljs-string">'Hello mqtt'</span></span>) } }) }) client.on(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">topic, message</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// message is Buffer console.log(message.toString()) client.end() })</span></span></code> </pre> <br><h3>  MQTTnet </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MQTTnet</a> est une biblioth√®que .NET hautes performances qui fournit √† la fois le client et le serveur MQTT (courtier). <br><br>  Installation du client MQTT: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Create a new MQTT client. var factory = new MqttFactory(); var mqttClient = factory.CreateMqttClient();</span></span></code> </pre> <br>  Apr√®s avoir configur√© les param√®tres du client MQTT, vous pouvez √©tablir une connexion.  Le code suivant montre comment se connecter au serveur: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Use WebSocket connection. var options = new MqttClientOptionsBuilder() .WithWebSocketServer("broker.hivemq.com:8000/mqtt") .Build(); await client.ConnectAsync(options);</span></span></code> </pre> <br>  Recevoir les messages entrants: <br><br><pre> <code class="cpp hljs">client.UseApplicationMessageReceivedHandler(e =&gt; { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"### RECEIVED APPLICATION MESSAGE ###"</span></span>); Console.WriteLine($<span class="hljs-string"><span class="hljs-string">"+ Topic = {e.ApplicationMessage.Topic}"</span></span>); Console.WriteLine($<span class="hljs-string"><span class="hljs-string">"+ Payload = {Encoding.UTF8.GetString(e.ApplicationMessage.Payload)}"</span></span>); Console.WriteLine($<span class="hljs-string"><span class="hljs-string">"+ QoS = {e.ApplicationMessage.QualityOfServiceLevel}"</span></span>); Console.WriteLine($<span class="hljs-string"><span class="hljs-string">"+ Retain = {e.ApplicationMessage.Retain}"</span></span>); Console.WriteLine(); Task.Run(() =&gt; client.PublishAsync(<span class="hljs-string"><span class="hljs-string">"hello/world"</span></span>)); });</code> </pre> <br>  Post-publication: <br><br><pre> <code class="cpp hljs">var message = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MqttApplicationMessageBuilder() .WithTopic(<span class="hljs-string"><span class="hljs-string">"MyTopic"</span></span>) .WithPayload(<span class="hljs-string"><span class="hljs-string">"Hello World"</span></span>) .WithExactlyOnceQoS() .WithRetainFlag() .Build(); await client.PublishAsync(message);</code> </pre> <br>  Voir la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation et le wiki MQTTnet pour plus d'exemples</a> . <br><br>  Les fournisseurs de niveau entreprise disposent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de serveurs MQTT standard</a> pour une messagerie √©volutive entre les applications mobiles, les machines industrielles et une large gamme d'autres utilisations de l'IoT.  Ce <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">guide</a> vous explique comment utiliser MQTT via un courtier de niveau entreprise. <br><br><h1>  Qu'en est-il de la mise √† l'√©chelle? </h1><br>  En ce qui concerne la mise √† l'√©chelle de MQTT, il y a deux consid√©rations √† consid√©rer: 1) est-ce le bon protocole;  2) quel que soit le choix du protocole, quelles infrastructures et capacit√©s r√©seau sont n√©cessaires pour g√©rer l'augmentation du trafic entre les appareils utilisant MQTT. <br><br>  Light-to-Machine-to-Machine (LWM2M) est un autre protocole qui peut √™tre utilis√© avec MQTT au niveau de l'entreprise.  Compar√© au MQTT, il est parfois <i>mieux adapt√© aux syst√®mes IoT √† long terme</i> .  MQTT est id√©alement adapt√© pour un essai de l'IoT sans effort tandis que le LWM2M fournit des fonctionnalit√©s pour une infrastructure polyvalente √† long terme.  LWM2M fournit √©galement des outils de gestion de p√©riph√©riques sup√©rieurs tels que la surveillance des connexions, les mises √† jour du micrologiciel et les actions des p√©riph√©riques distants.  Pour les entreprises disposant d'un grand nombre d'appareils non g√©r√©s qui envoient de grandes quantit√©s de donn√©es √† une plate-forme centrale, LWM2M est le meilleur choix.  N√©anmoins, nous parlons de d√©ploiements √† grande √©chelle de l'IoT, donc g√©n√©ralement MQTT est plus qu'une option ad√©quate.  De plus, MQTT est plus courant et a un support plus large. <br><br>  Maintenant sur les possibilit√©s d'infrastructure.  En ce qui concerne le chargement du serveur, le nombre de connexions simultan√©es est rarement un goulot d'√©tranglement.  La plupart des bons serveurs / courtiers MQTT prennent en charge des milliers de connexions simultan√©es, mais quelle est la charge de travail requise pour traiter et r√©pondre aux messages une fois que le serveur MQTT a re√ßu les donn√©es r√©elles?  En r√®gle g√©n√©rale, il existe toutes sortes de probl√®mes potentiels, tels que la lecture et l'√©criture vers et depuis la base de donn√©es, l'int√©gration avec le serveur, la distribution et la gestion des ressources pour chaque client, etc. D√®s qu'une machine cesse de faire face √† la charge, vous devez ajouter des serveurs suppl√©mentaires, c'est-√†-dire, pensez √† l'√©quilibrage de charge, √† la synchronisation des messages entre les clients connect√©s √† diff√©rents serveurs, √† l'acc√®s g√©n√©ralis√© √† l'√©tat du client, quel que soit le temps de connexion ou le serveur sp√©cifique auquel le client est connect√© - la liste des produits  zhaetsya et continue. <br><br>  De tels probl√®mes m√©ritent un article s√©par√©, et de nombreuses informations peuvent √™tre trouv√©es dans la section Ing√©nierie de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notre blog</a> .  En particulier, consultez l'article sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">certaines des complexit√©s de la maintenance d'une infrastructure de messagerie en temps r√©el √† grande √©chelle</a> . <br><br><h1>  Quelle est la situation actuelle du MQTT? </h1><br>  En avril 2019, OASIS a publi√© MQTT v5.0 en tant que norme officielle.  OASIS est un consortium √† but non lucratif de 600 organisations membres et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">5 000 membres individuels</a> . <br><br>  La version 5.0 introduit un certain nombre de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nouvelles fonctionnalit√©s</a> qui devraient int√©resser les d√©veloppeurs de syst√®mes en temps r√©el.  Ces nouvelles fonctionnalit√©s sont r√©trocompatibles avec les versions actuelles de MQTT.  Parmi eux: <br><br><ul><li>  <b>Rapport d'erreur am√©lior√©</b> : les codes retour peuvent d√©sormais informer que les donn√©es ne sont pas transmises pour une raison quelconque.  Les cha√Ænes facultatives sont prises en charge pour indiquer la raison.  Ils aident √† am√©liorer les diagnostics de d√©pannage. <br></li><li>  <b>Partage des abonnements</b> : pour aider √† √©quilibrer la charge, les abonnements peuvent √™tre partag√©s entre plusieurs clients c√¥t√© r√©ception. <br></li><li>  <b>Propri√©t√©s du message</b> : la version 5.0 introduit des m√©tadonn√©es dans le cadre de l'en-t√™te du message.  Il peut transmettre des informations suppl√©mentaires √† l'utilisateur final ou faciliter certaines des autres fonctions √©num√©r√©es ci-dessous. <br></li><li>  <b>Alias ‚Äã‚Äãde canal</b> : les √©diteurs peuvent remplacer les canaux par des identificateurs num√©riques pour r√©duire le nombre d'octets √† transmettre. <br></li><li>  Date d' <b>expiration du message</b> : les messages peuvent √™tre marqu√©s pour suppression automatique si le syst√®me n'est pas en mesure de les livrer dans un d√©lai sp√©cifi√©. </li></ul><br>  Pour une liste compl√®te des nouvelles fonctionnalit√©s MQTT 5.0, voir l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">annexe C</a> de la norme officielle. <br><br>  En plus des nombreux appareils et services grand public sur le march√©, MQTT a trouv√© une utilisation dans l'infrastructure d'entreprise de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">toutes formes et tailles</a> .  Il s'agit des smartphones et tablettes, des syst√®mes de surveillance de l'√©nergie, des dispositifs m√©dicaux, des plates-formes p√©troli√®res et des plates-formes p√©troli√®res, des industries automobile et a√©rospatiale, ainsi que des capteurs et des syst√®mes de vision industrielle utilis√©s dans la manutention, la construction, la cha√Æne d'approvisionnement, la vente au d√©tail, et bien plus encore. <br><br><h1>  MQTT et Ably </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MQTT</a> est un protocole populaire, largement pris en charge et relativement mature.  Il est id√©al pour de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nombreuses applications en temps r√©el</a> , et pas seulement pour le d√©ploiement de l'IoT.  Cependant, comme la production et la consommation de donn√©es en temps r√©el continuent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de cro√Ætre de fa√ßon exponentielle</a> , MQTT n'est pas toujours le bon protocole pour r√©pondre √† vos besoins de streaming.  Suivez notre section <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Concepts en temps r√©el</a> pour obtenir des informations sur les autres protocoles et la fa√ßon dont ils conviennent √† votre situation. <br><br>  Ably fournit un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">courtier et un adaptateur de protocole MQTT</a> avec traduction dans le propre protocole d'Ably dans les deux sens, ce qui vous permet de vous int√©grer √† tous les syst√®mes et connexions existants.  WebSockets, HTTP, SSE, gRPC (en cours de d√©veloppement), STOMP, AMQP et autres protocoles pris en charge pour organiser une infrastructure de messagerie distribu√©e en temps r√©el.  Il existe plus de 40 biblioth√®ques clientes SDK et la prise en charge de protocoles propri√©taires en temps r√©el. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr463669/">https://habr.com/ru/post/fr463669/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr463655/index.html">La naissance d'un projet ou comment √©crire son propre CMS</a></li>
<li><a href="../fr463657/index.html">Chatbots suce</a></li>
<li><a href="../fr463663/index.html">10 livres pour comprendre la structure du march√© boursier, l'investissement en bourse et le trading automatis√©</a></li>
<li><a href="../fr463665/index.html">1,1 milliard de trajets en taxi: cluster ClickHouse √† 108 c≈ìurs</a></li>
<li><a href="../fr463667/index.html">Forest ne c√®de pas √† la technologie de recherche, mais les ing√©nieurs ripostent</a></li>
<li><a href="../fr463673/index.html">6 raisons d'ouvrir une startup informatique au Canada</a></li>
<li><a href="../fr463675/index.html">Alchimie du personnel: quelle est la composition optimale de l'√©quipe du centre GosSOPKA?</a></li>
<li><a href="../fr463677/index.html">Chef d'√©quipe sur une t√©l√©commande: comment j'ai voyag√© avec ma famille et travaill√© de Gr√®ce et du Vietnam</a></li>
<li><a href="../fr463681/index.html">Hydropisie budg√©taire pour le GPU. Connaissance et premi√®re exp√©rience</a></li>
<li><a href="../fr463683/index.html">Pr√©sentation des solutions Open Typo Correction</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>