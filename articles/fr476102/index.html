<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëäüèΩ ‚ûø üíª Tapez travailler en toute s√©curit√© avec les tableaux PHP üçÇ üéóÔ∏è üéÖüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous, je vais vous parler de mon propre v√©lo pour un travail pratique avec les tableaux en PHP. 

 Indication de type 
 L'indication de type...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tapez travailler en toute s√©curit√© avec les tableaux PHP</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476102/">  Bonjour √† tous, je vais vous parler de mon propre v√©lo pour un travail pratique avec les tableaux en PHP. <br><br><h2>  Indication de type </h2><br>  L'indication de type est apparue en PHP7, ce qui a permis √† l'EDI de r√©aliser une meilleure analyse statique du code, la qualit√© de notre code s'est am√©lior√©e (ou dit correctement " <b>√ßa s'est am√©lior√©</b> "?). <br><br>  Bien s√ªr, auparavant, il √©tait possible pour l'EDI d'√©crire un indice dans les commentaires du code, mais maintenant les types sont devenus une partie du code et maintenant il est devenu possible de refactoriser et de ne pas avoir peur d'oublier quelque chose quelque part (refactoriser bien s√ªr dans le sens de renommer les classes et les interfaces). <br><br>  En plus de permettre de sp√©cifier le type de sortie, il est d√©sormais possible de sp√©cifier le type de l'argument d'entr√©e. <br><br>  Mais en plus des fonctionnalit√©s int√©ressantes, l'indication de type impose √©galement des responsabilit√©s, c'est-√†-dire que les types de variables doivent vraiment √™tre ceux indiqu√©s dans la signature de la m√©thode. <br><br>  Si vous ne cochez pas les types, vous pouvez obtenir des erreurs dans les m√©thodes et les constructeurs (les erreurs dans les concepteurs sont particuli√®rement encourageantes). <br><br>  La r√©daction manuelle des ch√®ques est fastidieuse, j'ai d√©cid√© d'automatiser cette activit√©, mais pas par v√©rification, mais par casting au type souhait√©. <br><a name="habracut"></a><br>  Dans mon travail, je dois souvent √©crire √† partir de z√©ro, g√©n√©ralement c'est soit des prototypes, soit des analyseurs, soit des ETL pour une nouvelle source de donn√©es, en fait aussi un analyseur. <br><br>  Bien s√ªr, vous travaillez avec des tableaux (par exemple, lorsque vous lisez √† partir de * .csv), vous pouvez travailler avec la base de donn√©es via ORM, mais pour mes t√¢ches, c'est trop lourd, il est pratique pour moi de travailler avec la base de donn√©es via PDO, ce qui vous donne √† nouveau des donn√©es dans des tableaux.  Bitrix ¬´favori¬ª ne sait pas comment renvoyer des donn√©es autrement que dans un tableau. <br><br>  Peu importe la fa√ßon dont vous devez r√©cup√©rer les donn√©es des tableaux.  J'ai donc √©crit un wrapper pour travailler avec des tableaux. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Afin de</a> ne pas copier-coller le code du projet vers le projet, j'ai con√ßu le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">package pour <b>Composer</b></a> : <br><br><pre><code class="bash hljs">composer require sbwerewolf/language-specific</code> </pre> <br><h2>  Gestionnaire de valeur </h2><br>  Ma premi√®re exigence √©tait de toujours savoir quel type je recevrais.  Avant cela, bien s√ªr, il nous faudrait encore obtenir la valeur, probablement par l'index, donc nous sommes arriv√©s √† la conclusion que nous avions besoin de la m√©thode <b>get</b> (). <br><br>  Et maintenant, nous avons besoin de m√©thodes de cast, il n'y a pas beaucoup de types en PHP, nous avons les m√©thodes suivantes: <br><br><ol><li>  int () </li><li>  str () </li><li>  bool () </li><li>  double () </li></ol><br>  Les tableaux se rencontrent parfois, alors que ce soit pour les tableaux: <br><br><ul><li>  tableau () </li></ul><br>  Parfois, il vous suffit de r√©cup√©rer l'√©l√©ment tel qu'il est: <br><br><ul><li>  asIs () </li></ul><br>  Parfois, il peut ne pas y avoir d'√©l√©ment avec un index donn√©, puis vous devez utiliser la valeur par d√©faut: <br><br><ul><li>  d√©faut () </li></ul><br><h2>  Arrayhandler </h2><br>  La prochaine exigence √©tait de pouvoir simplifier le tableau d'une valeur √† exactement cette valeur. <br><br>  Je vais vous montrer un exemple de la documentation: <br><br><pre> <code class="php hljs">$connection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PDO ($dsn,$login,$password); $command = $connection-&gt;prepare(<span class="hljs-string"><span class="hljs-string">'select name from employee where salary &gt; 10000'</span></span>); $command-&gt;execute(); $data = $command-&gt;fetchAll(PDO::FETCH_ASSOC); <span class="hljs-comment"><span class="hljs-comment">/* $data = array ( 0 =&gt; array ( 'name' =&gt; 'Mike', ), 1 =&gt; array ( 'name' =&gt; 'Tom', ), 2 =&gt; array ( 'name' =&gt; 'Jerry', ), 3 =&gt; array ( 'name' =&gt; 'Mary', ) ); */</span></span> $names = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayHandler($data); $result = $names-&gt;simplify(); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> var_export($result,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* LanguageSpecific\ArrayHandler::__set_state(array( '_data' =&gt; array ( 0 =&gt; 'Mike', 1 =&gt; 'Tom', 2 =&gt; 'Jerry', 3 =&gt; 'Mary', ), )) */</span></span></code> </pre><br>  Vous pouvez bien s√ªr parcourir le tableau qui sera renvoy√© √† partir de la demande et effectuer cette affectation: <br><br><pre> <code class="php hljs">$response[] = $element[<span class="hljs-number"><span class="hljs-number">0</span></span>];</code> </pre><br>  , mais je ne l'aime pas tellement, laissez-le se produire automatiquement, donc la m√©thode <b>simplify</b> () est apparue. <br><br>  Eh bien, puisque nous avons un wrapper sur le tableau, nous ajouterons une m√©thode pour v√©rifier la pr√©sence de l'index - <b>has</b> (), si vous voulez parcourir les √©l√©ments du tableau, la m√©thode <b>next</b> () vous aidera. <br><br>  Cela aurait pu √™tre arr√™t√© car le niveau d'automatisation a atteint un niveau confortable, mais parfois je dois travailler avec un tableau imbriqu√© d'un tableau imbriqu√©, et il est plus pratique pour moi d'obtenir imm√©diatement un <b>ArrayHandler</b> pour le tableau cible, j'ai donc ajout√© la m√©thode <b>pull</b> (), qui renvoie un <b>ArrayHandler</b> pour le tableau imbriqu√© . <br><br>  Cela ressemble √† ceci: <br><br><pre> <code class="php hljs">$address = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayHandler($item)-&gt;pull(<span class="hljs-string"><span class="hljs-string">'metaDataProperty'</span></span>)-&gt;pull(<span class="hljs-string"><span class="hljs-string">'GeocoderMetaData'</span></span>)-&gt;pull(<span class="hljs-string"><span class="hljs-string">'Address'</span></span>)-&gt;asIs();</code> </pre><br>  Vous pouvez bien s√ªr √©crire comme ceci: <br><br><pre> <code class="php hljs">$address = $item[<span class="hljs-string"><span class="hljs-string">'GeoObject'</span></span>][<span class="hljs-string"><span class="hljs-string">'metaDataProperty'</span></span>][<span class="hljs-string"><span class="hljs-string">'GeocoderMetaData'</span></span>][<span class="hljs-string"><span class="hljs-string">'Address'</span></span>];</code> </pre><br>  , mais √† mes yeux ondule sur le nombre de crochets, c'est plus pratique pour moi gr√¢ce √† <b>pull</b> (). <br><br><h2>  Raisonnement g√©n√©ral </h2><br>  Lorsque le code est connect√© √† partir de Composer, c'est tr√®s pratique, sauf que vous vous d√©barrassez du besoin de copier-coller, vous obtenez votre biblioth√®que avec une seule commande et elle est toujours √† port√©e de main. <br><br>  Avant de cr√©er mon package, j'ai regard√© des analogues et je n'ai rien trouv√© de tel, il y a plusieurs projets qui enveloppent simplement un tableau, et dans ces projets ils encapsulent simplement de nombreuses m√©thodes pour travailler avec des tableaux, et il n'y a aucune s√©curit√© de type nulle part. <br><br>  Apparemment, √©crire (int) ou (bool) devant le nom de la variable est simple et pratique pour tout le monde et personne ne voit de raison de s'emb√™ter avec un r√©f√©rentiel s√©par√© pour cette chose. <br><br>  Les fonctionnalit√©s de la biblioth√®que sont l√©g√®rement plus larges que celles d√©crites dans l'article et plus d'informations peuvent √™tre obtenues <a href="">dans la documentation (README.md)</a> . <br><br>  PHP5 n'est pas rare, donc la biblioth√®que a une version distincte pour PHP5, diff√®re de la version pour PHP7 par le nom de plusieurs m√©thodes, et bien s√ªr, toutes les indications de type ne sont que dans les commentaires. <br>  Il existe une version de la biblioth√®que pour PHP7.2, elle ne diff√®re que par le fait que le type de la valeur de retour appara√Æt dans la signature de la m√©thode <b>object</b> () - objet. <br><br>  Le code est enti√®rement couvert par des tests, mais en principe il n'y a rien √† casser :) <br><br>  Utilisez pour la sant√©! <br><br><h2>  Un autre cas d'utilisation </h2><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($featureMember <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $item) { $pointInfo = extract($item); $info = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayHandler($pointInfo); $address = $info-&gt;get(<span class="hljs-string"><span class="hljs-string">'formatted'</span></span>)-&gt;default(<span class="hljs-string"><span class="hljs-string">''</span></span>)-&gt;str(); $longitude = $info-&gt;get(<span class="hljs-string"><span class="hljs-string">'longitude'</span></span>)-&gt;default(<span class="hljs-number"><span class="hljs-number">61.402554</span></span>)-&gt;double(); $latitude = $info-&gt;get(<span class="hljs-string"><span class="hljs-string">'latitude'</span></span>)-&gt;default(<span class="hljs-number"><span class="hljs-number">55.159897</span></span>)-&gt;double(); $undefined = !$info-&gt;get(<span class="hljs-string"><span class="hljs-string">'formatted'</span></span>)-&gt;has(); $properties = [<span class="hljs-string"><span class="hljs-string">'longitude'</span></span> =&gt; $longitude, <span class="hljs-string"><span class="hljs-string">'latitude'</span></span> =&gt; $latitude, <span class="hljs-string"><span class="hljs-string">'address '</span></span> =&gt; $address ,<span class="hljs-string"><span class="hljs-string">'undefined'</span></span>=&gt;$undefined,]; $result = json_encode($properties); output($result); }</code> </pre><br>  Pour regarder lors du d√©bogage sur JSON dans lequel les nombres sont des nombres, les valeurs logiques sont logiques, je suis beaucoup plus agr√©able que de simples cha√Ænes. <br><br><img src="https://habrastorage.org/webt/z7/rb/j4/z7rbj4bimu2rinuh2xinotto5co.png" alt="image"><br><br>  Et vous? </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr476102/">https://habr.com/ru/post/fr476102/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr476092/index.html">√Ä propos des directions ¬´Photonique¬ª, ¬´Programmation et informatique¬ª et ¬´Information et cybers√©curit√©¬ª de l'Olympiade ¬´Je suis un professionnel¬ª</a></li>
<li><a href="../fr476094/index.html">Le retour de l'√®re des empires: tout sur l'√®re des empires IV</a></li>
<li><a href="../fr476096/index.html">Inventaire de I √† Z. Nous consid√©rons les actifs informatiques</a></li>
<li><a href="../fr476098/index.html">Structures de donn√©es en Java. M√©thodes de classe d'assistance utiles</a></li>
<li><a href="../fr476100/index.html">Architecture des syst√®mes informatiques 1 partie. Portes logiques</a></li>
<li><a href="../fr476104/index.html">N'utilisez pas MTProxy gratuit et d'autres types de proxy gratuits ...</a></li>
<li><a href="../fr476106/index.html">¬´Protocoles de cryptosyst√®mes¬ª: Diffie - Hellman, El-Gamal, MTI / A (0), STS</a></li>
<li><a href="../fr476108/index.html">Cerveau mutable</a></li>
<li><a href="../fr476110/index.html">Pourquoi l'informatique a-t-elle besoin d'une marque personnelle</a></li>
<li><a href="../fr476112/index.html">Elixir comme objectif de d√©veloppement pour Python async</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>