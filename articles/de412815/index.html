<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🈲 👨🏿‍🤝‍👨🏻 😙 Web Manager OpenVPN-Clientschlüssel VPNFace Lite 👩🏼‍🤝‍👨🏻 ❓ 🛀🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Intro 


 Die gestiegene Nachfrage nach den Zauberbuchstaben VPN und deren Gründe, weit entfernt von Netzwerktechnologien, ist nicht einmal interessan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Web Manager OpenVPN-Clientschlüssel VPNFace Lite</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412815/"><h1 id="intro">  Intro </h1><br><p>  Die gestiegene Nachfrage nach den Zauberbuchstaben VPN und deren Gründe, weit entfernt von Netzwerktechnologien, ist nicht einmal interessant zu scherzen. </p><br><blockquote>  Hallo, bist du gut in Computern?  hilf mir über vpn? </blockquote><a name="habracut"></a><br><p>  Tatsächlich bin ich sogar froh, dass die Leute anfangen, die Grundlagen von Computernetzwerken zu lernen (was ist VPN, was passiert es und warum werden verschiedene Websites damit geöffnet?) Und wenn möglich helfen.  Ich versuche, die Prozesse zur Selbstkonfiguration meiner eigenen VPN-Server voranzutreiben, aber ich verstehe, dass <em>nicht jeder ein Systemadministrator</em> ist. Einige Freunde schlagen daher einfach vor, einen Server zu kaufen und ihn mir zur Konfiguration zu geben. </p><br><p>  Aber jeder Programmierer sollte faul sein, um das Gleiche nicht wiederholt zu wiederholen.  Immer wieder dieselben Aktionen auszuführen, verbessert die Fähigkeiten, tötet jedoch das gesamte Interesse an Entwicklung und Kreativität (und Zeit). </p><br><p>  Als ich den dritten VPN-Server einrichtete, wurde mir klar, dass dies alles automatisiert und <em>benutzerfreundlich gestaltet werden musste</em> , damit selbst der gewöhnlichste Benutzer nach einer kurzen Anweisung den ovpn-Schlüssel mit einem Freund oder Verwandten teilen konnte.  Und noch besser - um das System zu installieren, könnte der Benutzer unabhängig mit minimalen Fähigkeiten und Kenntnissen. </p><br><p>  So entstand das VPNFace-Projekt - eine Reihe von Serverskripten zum Verwalten von Benutzerschlüsseln von OpenVPN-Servern und ein Web-Control-Panel für diese.  Und nach ein paar Tagen der Entwicklung dachte ich, dass ungefähr 25% der zu legenden Funktionen niemals von demselben „normalen Benutzer“ beansprucht werden, und das Lite-Präfix wurde dem Namen hinzugefügt, und das Hauptkonzept des Projekts änderte sich von <em>einem Allzweckdesigner</em> zu einem <em>engstirnigen Tool</em> , das gleichzeitig die Entwicklungszeit vor der Veröffentlichung erheblich verkürzte. </p><br><p>  Natürlich - nun <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Google Outline VPN">, so ist es nie passiert</a> - warum ein anderer OpenVPN-Manager?  Um ehrlich zu sein - der Gedanke an andere Projekte von VPN-Managern kam mir in den Sinn, als der Hauptkern bereits funktionierte und ich alle möglichen kleinen Dinge sah.  Zuerst war ich verärgert, dass ich so dumm war und nicht einmal eine Mindeststudie durchgeführt habe (da ich nicht besonders gerne Fahrräder herstelle), aber nachdem ich die oben genannten Projekte studiert hatte, stellte ich fest, dass meine auch eine eigene Nische hat. </p><br><p>  Hauptmerkmale: </p><br><ol><li>  Funktionaler Minimalismus: Ein gewöhnlicher Benutzer benötigt bei der Interaktion mit VPN als Administrator nur wenige Funktionen - Erstellen eines Schlüssels, Sperren und Entsperren.  Es ist unwahrscheinlich, dass er daran denkt, einen anderen VPN-Server zu erstellen, wenn er einen funktionierenden hat, oder die Daten des Zertifikatcenters zu ändern.  Nur wenige Benutzer benötigen schöne Verkehrsdiagramme und die Funktionalität des Unternehmensservers, um <em>ein Telegramm ruhig verwenden zu können</em> . </li><li>  Software-Minimalismus: Das einzige Programm, das der Benutzer benötigt, ist der offizielle OpenVPN-Client, der auf allen Systemen und Geräten verfügbar ist.  Das Key Control Panel ist eine Webanwendung, die in einem Browser ausgeführt wird.  Die administrative Autorisierung erfolgt über den VPN-Schlüssel. </li><li>  Semi-Fixed-Konfiguration: 80 Prozent der Benutzer benötigen dasselbe und es ist ihnen egal, welche IP-Adressen sich in den Netzwerken befinden (sie wissen nicht einmal, dass sie vorhanden sind), weitere 15 Prozent benötigen etwas mehr, aber ähnlich ein und dasselbe Außerdem schreiben die restlichen 5% ähnliche Dinge selbst und implementieren alles so, wie sie es benötigen, sodass Sie sich keine Sorgen machen können.  Trotzdem kann das Panel manuell mit den bereits geöffneten VPN-Servern verbunden werden oder die Zertifikatdaten vor der Standardinstallation korrigieren. </li><li>  Absolute Distanzierung zu Hosting-Unternehmen oder anderen Diensten von Drittanbietern - es gibt einige defekte Kopien bei Streitigkeiten über das magischste Hosting, dies liegt ganz bei der Wahl des Benutzers.  Das Betriebssystem des Servers ist für das Skript wichtiger - es ist unter Ubuntu / Debian-Systemen geschrieben, aber alle Hoster haben sie.  Das System wird sowohl im internen als auch im Unternehmensnetzwerk ruhig stehen. </li><li>  Der einfachste Installationsprozess auf einem sauberen, frisch gekauften Server: Wenn etwas ohne Beteiligung des Benutzers ausgeführt werden kann, erfolgt dies mithilfe von Hardcode.  Weil Lite.  Ja, es war nicht möglich, das Installationsprogramm wie Google Outline zu erreichen. Es erfordert eine Benutzerverbindung über ssh, um die Installation zu starten, und einen unabhängigen Kauf des Servers. Es war jedoch möglich, Kenntnisse darüber zu erlangen, wie eine Verbindung über ssh hergestellt werden kann. Dies war eine der schwierigsten der erforderlichen.  Mit der "Standardeinstellung" wird der Benutzer ohne Fragen mit einer "Standard" -Konfiguration konfiguriert. </li></ol><br><h1 id="panel-upravleniya-klyuchami">  Tastenbedienfeld </h1><br><p>  Während einer Standardinstallation werden drei VPN-Server erstellt: Administrator, Internet und Dark - es ist nicht schwer, anhand der Namen zu erraten, der erste dient dem Administratorzugriff auf den Server und das Schlüsselbedienfeld (und ggf. ssh), der zweite - gibt Benutzer sofort ins Internet frei, und der dritte leitet den gesamten möglichen Verkehr transparent zum Tor-Netzwerk (UDP-Verkehr mit Ausnahme von DNS geht nirgendwo hin und DNS geht an Tor) </p><br><p><img src="https://habrastorage.org/webt/3g/wh/lv/3gwhlv6hr0jbzvhfd6jfrjeldsm.png"></p><br><p>  Es wurde beschlossen, das Bedienfeld auf einem neuen sechsten AngularJS zu erstellen ( <em>während der Installation wird eine kompilierte Version des Bedienfelds heruntergeladen, sodass die Winkelbibliotheken für die Arbeit nicht erforderlich sind</em> ).  Ich mag das Konzept von Webanwendungen und versuche, wenn möglich, in diese Richtung zu entwickeln.  Ich wollte auch lange Zeit eckige Materialien studieren, um Google Admin-Panels in verschiedenen Projekten zu erstellen. </p><br><p>  Die Schlüsselverwaltung wird, wie bereits erwähnt, auf ein Minimum vereinfacht: </p><br><p>  Neuer Schlüssel: </p><br><p><img src="https://habrastorage.org/webt/tr/ld/k_/trldk_mwy4vblg-n-pcdvh3gurk.png"></p><br><p>  Tastensperre: </p><br><p><img src="https://habrastorage.org/webt/b_/pa/i9/b_pai9e-us8hdshodi5irijqrm4.png"></p><br><p>  Schlüssel entsperren: </p><br><p><img src="https://habrastorage.org/webt/4x/sd/hi/4xsdhithv5rglkaazhu9j1o1ptw.png"></p><br><p>  Der Download-Button gibt die fertige ovpn-Datei für die Verbindung an. </p><br><p>  Die minimale Benutzerhilfe ist in das Panel integriert: </p><br><p><img src="https://habrastorage.org/webt/di/eb/ck/diebckjumhsfakj7hzkjmbaq4u4.png"></p><br><p>  Die kompilierte Dokumentation ist im Projekt enthalten, das standardmäßig für das administrative Subnetz an Port 81 ansteigt: </p><br><p><img src="https://habrastorage.org/webt/ty/2n/2i/ty2n2i9ntmsqykn74qffv7nrz5s.png"></p><br><p>  Die Bedeutung der Lite-Version beschränkte auch die Sprachunterstützung - im Moment existiert das gesamte Projekt nur auf Russisch, und die Mehrsprachigkeit ist nicht einmal im Kernel festgelegt. </p><br><h1 id="servernaya-chast">  Serverseite </h1><br><p>  Die Serverseite läuft auf NodeJS und Bash-Skripten.  Warum ein Knoten?  Ich mag sie und ich habe viele Projekte an ihr.  Eine VPN-Manager-Sammlung zu haben, schien mir eine gute Idee zu sein.  Das Installationsskript ruft den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Knotenversionsmanager auf</a> , installiert den Knoten v10 über ihn und erstellt einen Link zum systemweiten Ordner, damit die unter nodejs geschriebenen Dienste funktionieren. </p><br><p>  Die auf dem Knoten installierten Pakete sind auch minimal - für immer, für immer - Dienst zum Starten des Projekts als Systemdienst, Express - für Web-API, Shelljs - zum Ausführen von Konsolenbefehlen, IP-Adresse und Subnetzrechner, Kreidefarbenausgabe an die Konsole.  Natürlich kann diese Liste mit dem Perfektionismus des Minimalismus verkürzt werden, aber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Akins zweites Gesetz</a> wurde eindeutig aus dem Nichts geboren (dasselbe Gesetz kann auf die Frage „Warum Nodejs?“ Und einige andere angewendet werden) und trotz des Wunsches nach Minimalismus in anderen Fragen hier Ich beschloss, nicht tief zu gehen. </p><br><p>  Das Serverskript verwaltet OpenVPN-Server über eine Reihe von Bash-Skripten und erfordert eine bestimmte Stammverzeichnis-Dateistruktur und OpenVPN-Dateikonfiguration.  Als Datenbank werden zwei JSON-Dateien verwendet, die Folgendes ermöglichen: </p><br><ol><li>  Beseitigen Sie die Interaktion mit Datenbanken wie Mongo / SQL und den damit verbundenen Abhängigkeiten und Komplikationen </li><li>  Bereiten Sie die "Basen" (und die Struktur von Verzeichnissen und Dateien) ohne Probleme manuell oder per Skript vor, wenn Sie sie auf einem konfigurierten Arbeitsserver installieren, wenn das im Kit enthaltene Installationsprogramm sogar schädlich sein kann und der Standardinstallationsprozess vermieden werden muss (die Notwendigkeit der Installation wird genau auf das Vorhandensein und den Inhalt von json überprüft Datenbankdateien) </li></ol><br><p>  Ein separater Bonus des Control Panels als unabhängige Webanwendung war die Aufteilung der Serverfunktionalität in einen separaten Satz von http-API-Endpunkten, wodurch Programme von Drittanbietern die Möglichkeit erhalten, Benutzerschlüssel über reguläre http-Anforderungen zu verwalten. </p><br><h1 id="prostaya-ustanovka-po-umolchaniyu">  Einfache Installation (Standard) </h1><br><p>  Es wird davon ausgegangen, dass eine solche Installation auf sauberen neuen Servern ausgeführt wird.  Wenn der Server bereits für einige Aufgaben konfiguriert ist, lesen Sie besser die manuelle Installation (um die vorhandene Funktionalität nicht zu beschädigen). </p><br><p>  Ich mag die Installation von nvm (Node Version Manager), bei der der Benutzer nur einen Befehl im Terminal ausführen muss, den er vom Projektstandort kopiert, sodass das Standardinstallationsprogramm auf die gleiche Weise funktioniert.  Während das Startinstallations-Bash-Skript ausgeführt wird, fordert das Paket iptables-persistent den Benutzer auf, die aktuellen iptables-Regeln zu speichern. </p><br><p><img src="https://habrastorage.org/webt/f_/vc/ke/f_vckeeni_hi396mjlwhkjmuuko.png"></p><br><p>  Die Auswahl des Benutzers spielt keine Rolle, da nach Abschluss der Installation die Firewall durch die letzte Aktion neu konfiguriert wird und der neue Regelsatz die aktuelle Auswahl überschreibt.  Am Ende der Arbeit werden Sie vom Skript aufgefordert, die Installation über die Weboberfläche abzuschließen. </p><br><p><img src="https://habrastorage.org/webt/ih/d2/-e/ihd2-en90hmiyiynxpqjexvxljc.png"></p><br><p>  Die Webinstallation beginnt mit der Bestätigung der öffentlichen IP-Adresse des Servers.  Standardmäßig übernimmt das Web-Skript Daten aus der URL der Browser-Zeichenfolge.  Der Servercode konzentriert sich auf diese IP und sucht nach der Netzwerkadressschnittstelle für die zukünftige Konfiguration der Firewall- und OpenVPN-Server. </p><br><p><img src="https://habrastorage.org/webt/cs/mh/hg/csmhhgijn6e6epp86hfwemjtyc8.png"></p><br><p>  Nach dem Empfang der Netzwerkdaten erstellt das Installationsprogramm einen Administrator-VPN-Server.  Die Generierung kryptografischer Schlüssel während der Einrichtung des Stammverzeichnisses dauert einige Zeit, und während der Entwicklung auf demselben Computer variierte diese Zeit zwischen 1 und 15 Minuten. </p><br><p>  Wenn der Server erstellt und gestartet wird, fährt das Installationsprogramm mit dem zweiten Schritt fort, in dem der Benutzer aufgefordert wird, einen Administratorschlüssel zu erstellen. </p><br><p><img src="https://habrastorage.org/webt/ct/ib/r9/ctibr9x0ju5opuhykwxyhz4w0gc.png"></p><br><p>  Anschließend wird der Standby-Modus zum Verbinden des Administrator-VPN aktiviert.  Es wird erwartet, dass VPN auf demselben Gerät angeschlossen wird, von dem aus die Installation durchgeführt wird. </p><br><p><img src="https://habrastorage.org/webt/ib/s-/am/ibs-am0zswrpurcj2izew-bwlws.png"></p><br><p>  Wenn ein Benutzer eine Verbindung zum VPN-Server des Administrators herstellt, wird diese unter der Adresse 10.1.0.1 verfügbar, und eine JSONP-Anforderung von der Installationsseite wird dort erfolgreich weitergeleitet. Dies ist ein Signal, die Seite an die interne Adresse umzuleiten und die Installation abzuschließen. </p><br><p><img src="https://habrastorage.org/webt/ug/uv/si/uguvsiqhx4tege1hc6opgol94dk.png"></p><br><p>  In der letzten Phase der Installation werden die verbleibenden zwei VPN-Server erstellt und konfiguriert (Zeit zum Generieren der Kryptografie * 2), tor, nginx und iptalbles.  Nach Erhalt eines Signals zum Abschluss der Installation der Serverseite leitet das Skript die Seite an das Hauptbedienfeld weiter. </p><br><h1 id="ruchnaya-ustanovka">  Manuelle Installation </h1><br><p>  Die manuelle Installation des Control Panels in der Arbeitsstruktur von OpenVPN-Servern erfordert mehrere Schritte und ist für den Linux-Administrator technisch machbar (und ich glaube nicht, dass eine andere Person als sie möglicherweise eine manuelle Installation benötigt): </p><br><ol><li>  Vorbereitung der NodeJS-Umgebung gemäß den Anforderungen der aktuellen Serversicherheit und Organisation des Skripts in der erforderlichen Form (Service, Handbuch usw.) </li><li>  Vorbereiten der Dateistruktur von Daten- und Serververzeichnissen, Erstellen von JSON- "Datenbanken" </li><li>  Einrichten des Nginx-Proxys auf dem Bedienfeld und ggf. Dokumentation </li></ol><br><p>  Details und technische Details finden Sie in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Online-Dokumentation</a> . </p><br><h1 id="v-kachestve-zaklyucheniya">  Abschließend </h1><br><p>  Ich hoffe, das Projekt ist für jemanden nützlich. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Projekt-Repository</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Angular Web Panel Quellcode-Repository</a> <br>  Das Projekt wird unter der MIT-Lizenz vertrieben und zur Unterstützung der DIGITAL RESITANCE-Bewegung veröffentlicht. </p><br><p>  PS-Entwicklungsideen über dem Dach - und die Mehrsprachigkeit verbessern, fest codierte Momente im Code beseitigen und Funktionen zum Erstellen von Servern, Verwalten von Routing und Firewall, Verwandeln des Systems in einen <em>universellen Designer</em> usw. hinzufügen.  etc., aber wie und wann wird das alles umgesetzt?  Ohne eine Ahnung wird sich die Zukunft zeigen. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de412815/">https://habr.com/ru/post/de412815/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de412805/index.html">Meine Schritte, Erfolge und Fehler in der Spielentwicklungswelt am Beispiel eines Spielbot in Telegram</a></li>
<li><a href="../de412807/index.html">Hinweise des IoT-Anbieters. Anstand</a></li>
<li><a href="../de412809/index.html">Zwei-Faktor-Authentifizierung auf der Site mithilfe eines USB-Tokens. Wie mache ich den Zugriff auf das Serviceportal sicher?</a></li>
<li><a href="../de412811/index.html">C DevTools on Elbrus: Lebendige Berichte von HolyJS 2018 Piter</a></li>
<li><a href="../de412813/index.html">Unnötige HTTP-Header</a></li>
<li><a href="../de412819/index.html">Freitag Aufwärmen für den Geist: Perfektes Karma für Habrahabr</a></li>
<li><a href="../de412821/index.html">Sehen, sehen, schauen: Was ist der Unterschied?</a></li>
<li><a href="../de412823/index.html">Interview auf Englisch: Wie man es nicht schlimmer macht als der Freund des Sohnes der Mutter</a></li>
<li><a href="../de412825/index.html">QEMU-Blockgeräte</a></li>
<li><a href="../de412827/index.html">Pavel Durov: Nach dem ILV-Appell hat Apple Telegramm-Updates auf der ganzen Welt blockiert</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>