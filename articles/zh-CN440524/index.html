<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ˜¸ ğŸ‘ğŸ» ğŸ³ï¸â€ğŸŒˆ 80çº§è¦†ç›–æˆ–ç®€åŒ–ï¼šä»åˆ‡æ¢ç”¨ä¾‹åˆ°ç±»çš„è·¯å¾„ ğŸ“° ğŸ‘¨ğŸ¿â€âœˆï¸ ğŸ‘©ğŸ»â€âœˆï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="é‚£ä¼šæ˜¯ä»€ä¹ˆï¼Ÿ 


è®©æˆ‘ä»¬çœ‹çœ‹è¿‡å»å‡ å¹´æˆ‘çš„Redux / NGRXåº”ç”¨ç¨‹åºä¸­çš„reducersçš„å˜å½¢ã€‚ ä»Oak switch-case ï¼Œç»§ç»­é€šè¿‡é”®ä»å¯¹è±¡ä¸­è¿›è¡Œé€‰æ‹©ï¼Œæœ€åæ˜¯å¸¦æœ‰è£…é¥°å™¨ï¼ŒäºŒåä¸€ç‚¹å’ŒTypeScriptçš„ç±»ã€‚ æˆ‘ä»¬ä¸ä»…ä¼šå°è¯•å›é¡¾è¿™æ¡è·¯å¾„çš„å†å²ï¼Œè€Œä¸”è¿˜ä¼šå‘ç°ä¸€äº›å› æœå…³ç³»ã€‚ 
 å¦‚æœæ‚¨ä»¥åŠ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>80çº§è¦†ç›–æˆ–ç®€åŒ–ï¼šä»åˆ‡æ¢ç”¨ä¾‹åˆ°ç±»çš„è·¯å¾„</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440524/"><p><img src="https://habrastorage.org/webt/ud/sm/oe/udsmoenal1bazibn-vxzwkytz_8.jpeg" alt="å›¾ç‰‡"></p><br><h2 id="o-chem-poydet-rech"> é‚£ä¼šæ˜¯ä»€ä¹ˆï¼Ÿ </h2><br><p>è®©æˆ‘ä»¬çœ‹çœ‹è¿‡å»å‡ å¹´æˆ‘çš„Redux / NGRXåº”ç”¨ç¨‹åºä¸­çš„reducersçš„å˜å½¢ã€‚ ä»Oak <code>switch-case</code> ï¼Œç»§ç»­é€šè¿‡é”®ä»å¯¹è±¡ä¸­è¿›è¡Œé€‰æ‹©ï¼Œæœ€åæ˜¯å¸¦æœ‰è£…é¥°å™¨ï¼ŒäºŒåä¸€ç‚¹å’ŒTypeScriptçš„ç±»ã€‚ æˆ‘ä»¬ä¸ä»…ä¼šå°è¯•å›é¡¾è¿™æ¡è·¯å¾„çš„å†å²ï¼Œè€Œä¸”è¿˜ä¼šå‘ç°ä¸€äº›å› æœå…³ç³»ã€‚ </p><a name="habracut"></a><br><blockquote> å¦‚æœæ‚¨ä»¥åŠæˆ‘åœ¨Redux / NGRXä¸­è¯¢é—®å¦‚ä½•å¤„ç†æ ·æ¿çš„é—®é¢˜ï¼Œé‚£ä¹ˆ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ¬æ–‡</a>å¯¹æ‚¨å¯èƒ½ä¼šå¾ˆæœ‰è¶£ã€‚ <br><br> å¦‚æœæ‚¨å·²ç»ä½¿ç”¨äº†é€šè¿‡é”®ä»å¯¹è±¡ä¸­é€‰æ‹©å‡é€Ÿå™¨çš„æ–¹æ³•å¹¶å—å¤Ÿäº†ï¼Œåˆ™å¯ä»¥ç«‹å³åˆ‡æ¢åˆ°â€œåŸºäºç±»çš„å‡é€Ÿå™¨â€ã€‚ </blockquote><br><h2 id="shokoladnyy-switch-case"> å·§å…‹åŠ›å¼€å…³ç›’ </h2><br><blockquote> é€šå¸¸<code>switch-case</code> ï¼Œ <code>switch-case</code>é¦™è‰çš„ï¼Œä½†æ˜¯åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™ä¸¥é‡åœ°åŒºåˆ«äºæ‰€æœ‰å…¶ä»–ç±»å‹çš„<code>switch-case</code> ã€‚ </blockquote><p> å› æ­¤ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¼‚æ­¥åˆ›å»ºå®ä½“ï¼ˆä¾‹å¦‚Jediï¼‰çš„å…¸å‹é—®é¢˜ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionTypeJediCreateInit = <span class="hljs-string"><span class="hljs-string">'jedi-app/jedi-create-init'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionTypeJediCreateSuccess = <span class="hljs-string"><span class="hljs-string">'jedi-app/jedi-create-success'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionTypeJediCreateError = <span class="hljs-string"><span class="hljs-string">'jedi-app/jedi-create-error'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerJediInitialState = { <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-comment"><span class="hljs-comment">//   data: [], error: undefined, } const reducerJedi = (state = reducerJediInitialState, action) =&gt; { switch (action.type) { case actionTypeJediCreateInit: return { ...state, loading: true, } case actionTypeJediCreateSuccess: return { loading: false, data: [...state.data, action.payload], error: undefined, } case actionTypeJediCreateError: return { ...state, loading: false, error: action.payload, } default: return state } }</span></span></code> </pre> <br><p> æˆ‘ä¼šå¾ˆå¦ç‡åœ°è¯´ï¼Œå¹¶æ‰¿è®¤æˆ‘åœ¨å®è·µä¸­ä»æœªä½¿ç”¨è¿‡<code>switch-case</code> ã€‚ æˆ‘æƒ³ç›¸ä¿¡æˆ‘ç”šè‡³åˆ—å‡ºäº†è¿™æ ·åšçš„åŸå› ï¼š </p><br><ul><li>  <code>switch-case</code>å¤ªå®¹æ˜“ç ´åï¼šæ‚¨å¯ä»¥å¿˜è®°æ’å…¥<code>break</code> ï¼Œä¹Ÿå¯ä»¥å¿½ç•¥<code>default</code> ã€‚ </li><li>  <code>switch-case</code>å¤ªå†—é•¿äº†ã€‚ </li><li>  <code>switch-case</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‡ ä¹</a> <code>switch-case</code> Oï¼ˆnï¼‰ã€‚ è¿™æœ¬èº«ä¸æ˜¯å¾ˆé‡è¦ï¼Œå› ä¸º  Reduxæœ¬èº«å¹¶ä¸å¤¸è€€æƒŠäººçš„æ€§èƒ½ï¼Œä½†æ˜¯è¿™ä¸ªäº‹å®æ¿€æ€’äº†æˆ‘å†…åœ¨çš„ç¾ä¸½é‰´èµå®¶ã€‚ </li></ul><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Reduxå®˜æ–¹æ–‡æ¡£æä¾›äº†</a>æ¢³ç†æ‰€æœ‰è¿™äº›çš„é€»è¾‘æ–¹æ³•-é€šè¿‡é”®ä»å¯¹è±¡ä¸­é€‰æ‹©ä¸€ä¸ªå‡é€Ÿå™¨ã€‚ </p><br><h2 id="vybor-redyusera-iz-obekta-po-klyuchu"> é€šè¿‡é”®ä»å¯¹è±¡é€‰æ‹©å‡é€Ÿå™¨ </h2><br><p> è¿™ä¸ªæƒ³æ³•å¾ˆç®€å•-æ¯ä¸ªçŠ¶æ€æ›´æ”¹éƒ½å¯ä»¥é€šè¿‡çŠ¶æ€å’ŒåŠ¨ä½œçš„åŠŸèƒ½æ¥æè¿°ï¼Œæ¯ä¸ªè¿™æ ·çš„åŠŸèƒ½éƒ½æœ‰ä¸€ä¸ªä¸å…¶å¯¹åº”çš„ç‰¹å®šé”®ï¼ˆåŠ¨ä½œä¸­çš„<code>type</code>å­—æ®µï¼‰ã€‚ å› ä¸º  <code>type</code>æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ²¡æœ‰ä»€ä¹ˆå¯ä»¥é˜»æ­¢æˆ‘ä»¬ä¸ºæ‰€æœ‰è¿™æ ·çš„å‡½æ•°æ‰¾å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­é”®æ˜¯<code>type</code> ï¼Œè€Œå€¼æ˜¯çº¯çŠ¶æ€è½¬æ¢å‡½æ•°ï¼ˆç¼©å‡å™¨ï¼‰ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“æ–°æ“ä½œåˆ°è¾¾æ ¹å‡é€Ÿå™¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é”®ï¼ˆOï¼ˆ1ï¼‰ï¼‰é€‰æ‹©å¿…è¦çš„å‡é€Ÿå™¨ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionTypeJediCreateInit = <span class="hljs-string"><span class="hljs-string">'jedi-app/jedi-create-init'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionTypeJediCreateSuccess = <span class="hljs-string"><span class="hljs-string">'jedi-app/jedi-create-success'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionTypeJediCreateError = <span class="hljs-string"><span class="hljs-string">'jedi-app/jedi-create-error'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerJediInitialState = { <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerJediMap = { [actionTypeJediCreateInit]: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) =&gt;</span></span> ({ ...state, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }), [actionTypeJediCreateSuccess]: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: [...state.data, action.payload], <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, }), [actionTypeJediCreateError]: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) =&gt;</span></span> ({ ...state, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: action.payload, }), } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerJedi = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = reducerJediInitialState, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    `type`  const reducer = reducerJediMap[action.type] if (!reducer) { //   ,        return state } //        return reducer(state, action) }</span></span></code> </pre> <br><p> æœ€å¯å£çš„æ˜¯ï¼Œ <code>reducerJedi</code>å†…éƒ¨çš„é€»è¾‘å¯¹äºä»»ä½•reduceréƒ½æ˜¯ç›¸åŒçš„ï¼Œæˆ‘ä»¬å¯ä»¥é‡ç”¨å®ƒã€‚ ç”šè‡³è¿˜æœ‰ä¸€ä¸ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">redux-create-reducerçº³ç±³åº“</a> ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createReducer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-create-reducer'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionTypeJediCreateInit = <span class="hljs-string"><span class="hljs-string">'jedi-app/jedi-create-init'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionTypeJediCreateSuccess = <span class="hljs-string"><span class="hljs-string">'jedi-app/jedi-create-success'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionTypeJediCreateError = <span class="hljs-string"><span class="hljs-string">'jedi-app/jedi-create-error'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerJediInitialState = { <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerJedi = createReducer(reducerJediInitialState, { [actionTypeJediCreateInit]: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) =&gt;</span></span> ({ ...state, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }), [actionTypeJediCreateSuccess]: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: [...state.data, action.payload], <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, }), [actionTypeJediCreateError]: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) =&gt;</span></span> ({ ...state, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: action.payload, }), })</code> </pre> <br><p> ä¼¼ä¹ä»€ä¹ˆä¹Ÿæ²¡å‘ç”Ÿã€‚ çš„ç¡®ï¼Œä¸€å‹ºèœ‚èœœå¹¶éæ²¡æœ‰ä¸€æ¡¶ç„¦æ²¹ï¼š </p><br><ul><li> å¯¹äºå¤æ‚çš„å¼‚å¾„ç®¡ï¼Œæˆ‘ä»¬å¿…é¡»ç•™ä¸‹è¯„è®ºï¼Œå› ä¸º è¿™ç§æ–¹æ³•æ²¡æœ‰æä¾›å¼€ç®±å³ç”¨çš„æ–¹å¼æ¥æä¾›ä¸€äº›è¯´æ˜æ€§çš„å…ƒä¿¡æ¯ã€‚ </li><li> å¸¦æœ‰å¤§é‡åŒ–ç®€é”®å’Œé”®çš„å¯¹è±¡æ— æ³•å¾ˆå¥½åœ°è¯»å–ã€‚ </li><li> æ¯ä¸ªå¼‚å¾„ç®¡åªæœ‰ä¸€æŠŠé’¥åŒ™ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æƒ³ä¸ºå¤šä¸ªåŠ¨ä½œæ¸¸æˆè¿è¡ŒåŒä¸€ä¸ªå‡é€Ÿå™¨ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ </li></ul><br><p> å½“æˆ‘è½¬å‘åŸºäºç­çº§çš„å‡é€Ÿå™¨æ—¶ï¼Œæˆ‘å·®ç‚¹å¹¸ç¦çš„æ³ªæ°´ï¼Œä¸‹é¢æˆ‘å°†è§£é‡ŠåŸå› ã€‚ </p><br><h2 id="redyusery-na-osnove-klassov"> åŸºäºç±»çš„å‡é€Ÿå™¨ </h2><br><p> åŒ…å­ï¼š </p><br><ul><li> ç±»æ–¹æ³•æ˜¯æˆ‘ä»¬çš„â€‹â€‹ç®€åŒ–å™¨ï¼Œæ–¹æ³•æœ‰åç§°ã€‚ åªæ˜¯éå¸¸ç®€å•çš„å…ƒä¿¡æ¯ï¼Œå¯ä»¥è¯´æ˜è¯¥å‡é€Ÿå™¨çš„åŠŸèƒ½ã€‚ </li><li> å¯ä»¥ä¿®é¥°ç±»æ–¹æ³•ï¼Œè¿™æ˜¯é“¾æ¥åŒ–ç®€å™¨åŠå…¶ç›¸åº”åŠ¨ä½œï¼ˆå³åŠ¨ä½œï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªåŠ¨ä½œï¼ï¼‰çš„ä¸€ç§ç®€å•çš„å£°æ˜æ–¹å¼ã€‚ </li><li> åœ¨åå°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ‰€æœ‰ç›¸åŒçš„å¯¹è±¡è·å¾—Oï¼ˆ1ï¼‰ã€‚ </li></ul><br><p> æœ€åï¼Œæˆ‘æƒ³å¾—åˆ°ç±»ä¼¼çš„ä¸œè¥¿ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionTypeJediCreateInit = <span class="hljs-string"><span class="hljs-string">'jedi-app/jedi-create-init'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionTypeJediCreateSuccess = <span class="hljs-string"><span class="hljs-string">'jedi-app/jedi-create-success'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionTypeJediCreateError = <span class="hljs-string"><span class="hljs-string">'jedi-app/jedi-create-error'</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReducerJedi</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     "Class field delcaratrions",    Stage 3. // https://github.com/tc39/proposal-class-fields initialState = { loading: false, data: [], error: undefined, } @Action(actionTypeJediCreateInit) startLoading(state) { return { ...state, loading: true, } } @Action(actionTypeJediCreateSuccess) addNewJedi(state, action) { return { loading: false, data: [...state.data, action.payload], error: undefined, } } @Action(actionTypeJediCreateError) error(state, action) { return { ...state, loading: false, error: action.payload, } } }</span></span></code> </pre> <br><p> æˆ‘çœ‹åˆ°ç›®æ ‡ï¼Œæ²¡æœ‰éšœç¢ã€‚ </p><br><h3 id="shag-1-dekorator-action"> æ­¥éª¤1.è£…é¥°å™¨<code>@Action</code> ã€‚ </h3><br><p> æˆ‘ä»¬éœ€è¦åœ¨è¯¥è£…é¥°å™¨ä¸­ç²˜è´´ä»»æ„æ•°é‡çš„åŠ¨ä½œæ¸¸æˆï¼Œå¹¶å°†è¿™äº›æœåŠ¡å¦å­˜ä¸ºä¸€äº›å…ƒä¿¡æ¯ï¼Œä»¥ä¾¿ä»¥åè®¿é—®ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¿®è¡¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Reflect</a>çš„å‡ºè‰²çš„polyfill <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åå°„å…ƒæ•°æ®</a> ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> METADATA_KEY_ACTION = <span class="hljs-string"><span class="hljs-string">'reducer-class-action-metadata'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Action = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...actionTypes</span></span></span><span class="hljs-function">) =&gt;</span></span> (target, propertyKey, descriptor) =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">Reflect</span></span>.defineMetadata(METADATA_KEY_ACTION, actionTypes, target, propertyKey) }</code> </pre> <br><h3 id="shag-2-prevraschaem-klass-v-sobstvenno-redyuser"> ç¬¬2æ­¥ã€‚å®é™…ä¸Šï¼Œå°†ç±»å˜æˆåŒ–ç®€å™¨ã€‚ </h3><br><blockquote> ç”»ä¸€ä¸ªåœ†ï¼Œç”»ä¸€ç§’é’Ÿï¼Œç°åœ¨å†åŠ ä¸Šä¸€ç‚¹é­”æ³•ï¼Œç„¶åå¾—åˆ°ä¸€åªçŒ«å¤´é¹°ï¼ </blockquote><p> ä¼—æ‰€å‘¨çŸ¥ï¼Œæ¯ä¸ªåŒ–ç®€å™¨éƒ½æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œå®ƒæ¥å—å½“å‰çŠ¶æ€å’Œæ“ä½œå¹¶è¿”å›æ–°çŠ¶æ€ã€‚ å½“ç„¶ï¼Œä¸€ä¸ªç±»æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä½†å¹¶ä¸å®Œå…¨æ˜¯æˆ‘ä»¬éœ€è¦çš„ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰<code>new</code>åˆ™æ— æ³•è°ƒç”¨ES6ç±»ã€‚ é€šå¸¸ï¼Œæˆ‘ä»¬éœ€è¦ä»¥æŸç§æ–¹å¼å¯¹å…¶è¿›è¡Œè½¬æ¢ã€‚ </p><br><p> å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†é‡‡ç”¨å½“å‰ç±»ï¼Œéå†å…¶æ¯ä¸ªæ–¹æ³•ï¼Œæ”¶é›†å…·æœ‰æ“ä½œç±»å‹çš„å…ƒä¿¡æ¯ï¼Œæ”¶é›†å…·æœ‰reducerçš„å¯¹è±¡å¹¶ä»è¯¥å¯¹è±¡åˆ›å»ºæœ€ç»ˆçš„reducerã€‚ </p><br><p> è®©æˆ‘ä»¬ä»æ”¶é›†å…ƒä¿¡æ¯å¼€å§‹ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getReducerClassMethodsWthActionTypes = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">instance</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//       const proto = Object.getPrototypeOf(instance) const methodNames = Object.getOwnPropertyNames(proto).filter( (name) =&gt; name !== 'constructor', ) //             const res = [] methodNames.forEach((methodName) =&gt; { const actionTypes = Reflect.getMetadata( METADATA_KEY_ACTION, instance, methodName, ) //     `this`    const method = instance[methodName].bind(instance) //  ,         actionTypes.forEach((actionType) =&gt; res.push({ actionType, method, }), ) }) return res }</span></span></code> </pre> <br><p> ç°åœ¨æˆ‘ä»¬å¯ä»¥å°†ç»“æœé›†åˆè½¬æ¢ä¸ºå¯¹è±¡ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getReducerMap = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">methodsWithActionTypes</span></span></span><span class="hljs-function">) =&gt;</span></span> methodsWithActionTypes.reduce(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">reducerMap, { method, actionType }</span></span></span><span class="hljs-function">) =&gt;</span></span> { reducerMap[actionType] = method <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> reducerMap }, {})</code> </pre> <br><p> å› æ­¤ï¼Œæœ€ç»ˆåŠŸèƒ½å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createReducer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-create-reducer'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createClassReducer = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ReducerClass</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerClass = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ReducerClass() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> methodsWithActionTypes = getReducerClassMethodsWthActionTypes( reducerClass, ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerMap = getReducerMap(methodsWithActionTypes) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = reducerClass.initialState <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducer = createReducer(initialState, reducerMap) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> reducer }</code> </pre> <br><p> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶åº”ç”¨äºæˆ‘ä»¬çš„<code>ReducerJedi</code>ç±»ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducerJedi = createClassReducer(ReducerJedi)</code> </pre> <br><h3 id="shag-3-smotrim-chto-poluchilos-v-itoge"> ç¬¬3æ­¥ã€‚æˆ‘ä»¬çœ‹çœ‹ç»“æœå¦‚ä½•ã€‚ </h3><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//       import { Action, createClassReducer } from 'utils/reducer-class' const actionTypeJediCreateInit = 'jedi-app/jedi-create-init' const actionTypeJediCreateSuccess = 'jedi-app/jedi-create-success' const actionTypeJediCreateError = 'jedi-app/jedi-create-error' class ReducerJedi { //     "Class field delcaratrions",    Stage 3. // https://github.com/tc39/proposal-class-fields initialState = { loading: false, data: [], error: undefined, } @Action(actionTypeJediCreateInit) startLoading(state) { return { ...state, loading: true, } } @Action(actionTypeJediCreateSuccess) addNewJedi(state, action) { return { loading: false, data: [...state.data, action.payload], error: undefined, } } @Action(actionTypeJediCreateError) error(state, action) { return { ...state, loading: false, error: action.payload, } } } export const reducerJedi = createClassReducer(ReducerJedi)</span></span></code> </pre> <br><h2 id="kak-zhit-dalshe"> å¦‚ä½•ç”Ÿæ´»ï¼Ÿ </h2><br><p> æˆ‘ä»¬åœ¨å¹•åç•™ä¸‹äº†ä¸€äº›ä¸œè¥¿ï¼š </p><br><ul><li> å¦‚æœç›¸åŒçš„åŠ¨ä½œç±»å‹å¯¹åº”å¤šä¸ªå‡é€Ÿå™¨ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ </li><li> å¼€ç®±å³ç”¨æ·»åŠ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ²‰æµ¸</a>æ„Ÿå°†æ˜¯å¾ˆæ£’çš„ã€‚ </li><li> å¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨ç±»æ¥åˆ›å»ºåŠ¨ä½œæ€ä¹ˆåŠï¼Ÿ è¿˜æ˜¯åŠŸèƒ½ï¼ˆåŠ¨ä½œåˆ›å»ºè€…ï¼‰ï¼Ÿ æˆ‘å¸Œæœ›è£…é¥°è€…ä¸ä»…å¯ä»¥æ¥å—åŠ¨ä½œç±»å‹ï¼Œè¿˜å¯ä»¥æ¥å—åŠ¨ä½œåˆ›å»ºè€…ã€‚ </li></ul><br><p> ä¸€ä¸ªå°å‹çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">reducer-class</a>åº“å…·æœ‰æ‰€æœ‰è¿™äº›åŠŸèƒ½ä»¥åŠå…¶ä»–ç¤ºä¾‹ã€‚ </p><br><p> å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå°†ç±»ç”¨äºå‡é€Ÿå™¨çš„æƒ³æ³•å¹¶ä¸æ–°é²œã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">@amcdnl</a>æ›¾ç»åˆ›å»ºäº†ä¸€ä¸ªå¾ˆæ£’çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ngrx-actions</a>åº“ï¼Œä½†æ˜¯ä¼¼ä¹ä»–ç°åœ¨å·²ç»å¯¹å…¶è¯„åˆ†å¹¶åˆ‡æ¢åˆ°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">NGXS</a> ã€‚ å¦å¤–ï¼Œæˆ‘æƒ³è¦æ›´ä¸¥æ ¼çš„é”®å…¥å¹¶ä»¥ç‰¹å®šäºAngularåŠŸèƒ½çš„å½¢å¼é‡ç½®é•‡æµå™¨ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™é‡Œåˆ—å‡ºäº†reducer-classå’Œngrx-actionsä¹‹é—´çš„ä¸»è¦åŒºåˆ«ã€‚</a> </p><br><blockquote> å¦‚æœæ‚¨å–œæ¬¢å‡é€Ÿå™¨ç±»çš„æ¦‚å¿µï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½è¿˜å¸Œæœ›ä½¿ç”¨ç±»è¿›è¡Œæ“ä½œã€‚ çœ‹ä¸€ä¸‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">flux-action-class</a> ã€‚ </blockquote><p> å¸Œæœ›æ‚¨ä¸è¦ç™½ç™½æµªè´¹æ—¶é—´ï¼Œå¹¶ä¸”è¿™ç¯‡æ–‡ç« è‡³å°‘å¯¹æ‚¨æœ‰ç”¨ã€‚ è¯·è¸¢å¹¶æ‰¹è¯„ã€‚ æˆ‘ä»¬å°†å­¦ä¹ ä¸€èµ·æ›´å¥½åœ°ç¼–ç ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN440524/">https://habr.com/ru/post/zh-CN440524/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN440514/index.html">è°æ¥å±…ä½åœ¨æœºå™¨äººçš„åœŸåœ°ä¸Šï¼Ÿ æ‘©æ‰˜å¡ï¼ˆMotorikaï¼‰çš„å¼€å‘æ€»ç›‘å‘Šè¯‰äº†ç½—æ–¯æ–¯åŸºå²›ï¼ˆRussky Islandï¼‰çš„æœªæ¥çŠ¶å†µ</a></li>
<li><a href="../zh-CN440516/index.html">â€œ Linuxç¤¾äº¤ç½‘ç»œâ€-LiveJournalå¦‚ä½•æˆä¸ºåšå®¢çš„å‘ç°è€…ï¼Œç„¶åå¤±å»äº†å®ƒä»¬</a></li>
<li><a href="../zh-CN440518/index.html">æˆ‘ä»¬æ­£åœ¨ç”¨Goå’ŒJavascriptç¼–å†™ä¸€ä¸ªå­¦ä¹ åº”ç”¨ç¨‹åºï¼Œä»¥è¯„ä¼°å®é™…çš„è‚¡ç¥¨æ”¶ç›Šã€‚ ç¬¬1éƒ¨åˆ†-åç«¯</a></li>
<li><a href="../zh-CN440520/index.html">å¦‚ä½•è·å¾—Google Developersè®¤è¯ï¼šç§»åŠ¨ç½‘ç»œä¸“å®¶</a></li>
<li><a href="../zh-CN440522/index.html">å…·æœ‰å®æ–½è™šæ‹ŸPBXçš„ç»éªŒã€‚ é€šè®¯å’Œè½¯ä»¶åœ¨ä¸åŒçš„ç¯®å­é‡Œ</a></li>
<li><a href="../zh-CN440526/index.html">å¤§é›ªé£˜è¿‡åï¼Œæ—¥æœ¬åŸå¸‚è½¬å‘æ•°å­—æŠ€æœ¯</a></li>
<li><a href="../zh-CN440528/index.html">â€œç»™æˆ‘çœ‹ä½ çš„è¿åŠ¨é‹ï¼Œæˆ‘å‘Šè¯‰ä½ ä½ æ˜¯è°â€ï¼šä¸»é¢˜åª’ä½“é¡¹ç›®ä¸Šçš„æ–°æ’­å®¢</a></li>
<li><a href="../zh-CN440530/index.html">Cï¼ƒ8.0ä¸­å…·æœ‰æ¨¡å¼çš„æ›´å¤šåŠŸèƒ½</a></li>
<li><a href="../zh-CN440534/index.html">å°†æ”¿æ²»ä¸Šæ­£ç¡®çš„è¯æ±‡ä»è‹±è¯­ç¿»è¯‘æˆä¿„è¯­</a></li>
<li><a href="../zh-CN440536/index.html">Facebook Project Inferå¦‚ä½•åœ¨éƒ¨ç½²ä¹‹å‰å¸®åŠ©å‘ç°ç§»åŠ¨åº”ç”¨ç¨‹åºä¸­çš„é”™è¯¯</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>