<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçüé§ ü§î üë®‚Äçüëß Dispositivo Android controlado por Arduino controlado por Bluetooth - ciclo completo (parte 1) üï∫üèø ‚öìÔ∏è üö£üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduccion 
 Una historia detallada de c√≥mo el autom√≥vil Arduino, controlado por un dispositivo Android a trav√©s de Bluetooth, se ensambl√≥ a partir ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dispositivo Android controlado por Arduino controlado por Bluetooth - ciclo completo (parte 1)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424087/"><h2>  Introduccion </h2><br>  Una historia detallada de c√≥mo el autom√≥vil Arduino, controlado por un dispositivo Android a trav√©s de Bluetooth, se ensambl√≥ a partir de tres motores.  En varias docenas de p√°rrafos intentar√© explicar lo m√°s posible paso a paso d√≥nde conectar cada uno de los cables, c√≥mo escribir una aplicaci√≥n patentada y en qu√© rastrillo de ni√±os tuve que saltar durante m√°s de una semana. <br><br><h2>  Un poco sobre nivel, autor y advertencias </h2><br>  Yo, un autor, un ni√±o de 16-17 a√±os de un pueblo cerca de Mosc√∫, me especializo en escribir aplicaciones de Android (y all√≠ es m√°s dif√≠cil quemar algo), as√≠ que me quito la responsabilidad de un enfoque √≥ptimo para resolver problemas. <br><br>  Pr√°cticamente cada uno de los pasos descritos a continuaci√≥n me llev√≥ m√°s de lo que valdr√≠a la pena.  Probablemente por este motivo quiero compartir mi experiencia.  Y al mismo tiempo, estar√© muy feliz si me rega√±as por los errores y me pides una optimizaci√≥n. <br><br><h2>  Desaf√≠o </h2><br>  La tarea m√°s f√°cil es hacer que el auto sea controlado por Arduino y reemplazar el control remoto con un Android.  Pero en la mayor√≠a de los momentos tuve que reinventar la rueda, porque no se encontr√≥ una soluci√≥n adecuada en Internet. <br><a name="habracut"></a><br><h3>  Necesitar√° </h3><br><ol><li>  Arduino </li><li>  Motor Shield (en mi caso dos) </li><li>  Bluetooth </li><li>  Android </li><li>  Alambres convencionales </li></ol><br><h2>  Base de dise√±o </h2><br>  El Lego Outdoor Challenger se tom√≥ como base (en realidad, parece menos pat√©tico).  Todo lo que queda de ella: el estuche (se eliminan todos los elementos de decoraci√≥n) y tres motores. <br><img src="https://habrastorage.org/webt/5u/w0/8p/5uw08p_lewnr1zi49vaufwll86s.jpeg" alt="imagen"><br>  La m√°quina ten√≠a su propio tablero, pero una de las tareas implicaba universalidad: lo hice, otros pueden repetirlo.  Sac√≥ los cerebros, puso el Arduino Uno. <br><br><h2>  Instalaci√≥n Arduino </h2><br>  Por alguna raz√≥n, los creadores no proporcionaron espacio para el Arduino, por lo que lo sujetaron a los tornillos perforando pl√°stico.  Coloc√≥ madera contrachapada debajo del tablero para que nada se cortocircuitara.  Es mejor deslizar algo de pl√°stico debajo de los tornillos (un trozo de botella), porque el tablero no est√° protegido de los pernos de hierro. <br><br><img src="https://habrastorage.org/webt/-z/qx/o4/-zqxo4riolp63sjxmvgkhuusejm.png"><br><br>  En la parte superior del tablero, puse inmediatamente dos motores, as√≠ sea.  Para controlar el segundo, tendr√° que lanzar un cable desde cualquier puerto digital a H1 (direcci√≥n) y el segundo desde un pin con soporte de cu√±a (marcado con un "~", generalmente 10, 11) a E1 (velocidad). <br><br><img src="https://habrastorage.org/webt/ud/it/js/uditjsgup1hjr2yxejhphyk0zbq.png"><br><br><h2>  Determinaci√≥n del √°ngulo de rotaci√≥n. </h2><br>  Sorprendentemente, no es el servoaccionamiento el que responde a la rotaci√≥n de la m√°quina, sino el motor ordinario.  Hay un problema: ser√≠a bueno no quemarlo, porque el √°ngulo de rotaci√≥n es limitado y el motor puede girar tanto como desee. <br><br>  La opci√≥n con el m√©todo de empuje desaparece, ya que a un nivel de bater√≠a diferente, la cantidad de corriente suministrada al motor cambiar√°, lo que conducir√° a un √°ngulo en constante cambio.  Tambi√©n es imposible girar hasta detenerse, tarde o temprano los engranajes se desmoronar√°n. <br><br>  Soluci√≥n: siga el √°ngulo a trav√©s del circuito.  La foto muestra una cosa peque√±a, que est√° montada cerca del mecanismo giratorio.  En la parte que gira con las ruedas izquierda / derecha junto al motor, se adjunta una vieira con contactos de hierro. <br><br><img src="https://habrastorage.org/webt/4p/9c/yi/4p9cyiwd7tppugbduc7wrq-dejq.jpeg"><br><br><img src="https://habrastorage.org/webt/7t/sd/bj/7tsdbjwklwcsckcbuvjxkx_am0k.jpeg"><br><br>  Principio de funcionamiento: se suelda un cable a cada l√≠nea (hay cuatro en total), la parte inferior se conecta al m√°s (siempre se sujeta con un peine, vea la imagen), los cables restantes se ponen a menos.  Cuando el diente de vieira cae en la fila inferior y, por ejemplo, en el tercero, se produce un cortocircuito, la corriente fluye, esto lo nota Arduino. <br><br><img src="https://habrastorage.org/webt/fs/6-/br/fs6-br5cafv3h0zuhu8veydvb-w.jpeg"><br><br>  Gracias a las diversas combinaciones de las tres bandas, se pueden definir hasta siete √°ngulos.  Por ejemplo, cuando hay corriente en todas las l√≠neas, las ruedas se giran a la posici√≥n m√°s a la derecha, cuando hay corriente solo en la parte superior, las ruedas se giran hacia la izquierda tanto como sea posible.  La tabla proporciona todas las opciones. <br><br><img src="https://habrastorage.org/webt/zm/58/p0/zm58p0a4lopofcg4q64biku9qss.png"><br><br><h2>  √Ångulo de conexi√≥n y c√≥digo </h2><br>  Cada color tiene su propio color: el fondo es verde, el primero debajo es rojo, el segundo es negro y el tercero es blanco.  En la etapa inicial, la placa de pruebas y los LED se utilizaron para la depuraci√≥n visual. <br><br><img src="https://habrastorage.org/webt/bp/40/7m/bp407mzavfdtrovvmbage4rwhus.jpeg"><br><br>  El diagrama de conexi√≥n se muestra en la figura.  Adem√°s, tiramos a verde, los otros estiramos a menos.  A trav√©s de la resistencia instalada para eliminar la interferencia y la ausencia de cortocircuito, conecte los cables a las salidas A0-A2.  Se seleccionan simplemente al guardar otros puertos. <br><br><img src="https://habrastorage.org/webt/ud/it/js/uditjsgup1hjr2yxejhphyk0zbq.png"><br><br>  El c√≥digo se da con comentarios.  Conectamos pines y los interrogamos a trav√©s de digitarRead ().  Si hay voltaje, se devolver√° verdadero.  A continuaci√≥n, observamos si el resultado significa que las ruedas est√°n en posiciones extremas, prohibimos un giro adicional en esta direcci√≥n. <br><br>  Un peque√±o truco: dado que se necesitar√°n salidas en 5V y 3.3V en el futuro, puede poner un plus en uno de los pines digitales.  Antes de cada verificaci√≥n de √°ngulo, proporcione una corriente a trav√©s de digitalWrite (whitePin), luego verifique el √°ngulo y elimine la corriente. <br><br><pre><code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">int</span></span> speedTurn = <span class="hljs-number"><span class="hljs-number">180</span></span>; // ,  <span class="hljs-number"><span class="hljs-number">0</span></span>  <span class="hljs-number"><span class="hljs-number">255</span></span> //    <span class="hljs-type"><span class="hljs-type">int</span></span> pinRed = A0; <span class="hljs-type"><span class="hljs-type">int</span></span> pinWhite = A1; <span class="hljs-type"><span class="hljs-type">int</span></span> pinBlack = A2; <span class="hljs-type"><span class="hljs-type">int</span></span> pinAngleStop = <span class="hljs-number"><span class="hljs-number">12</span></span>; //   ,    ,  //   <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { //    pinMode(pinRed, <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span>); pinMode(pinBlack, <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span>); pinMode(pinWhite, <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span>); // pinMode(pinAngleStop, OUTPUT); //  ,    pinMode(angleDirection, OUTPUT); pinMode(angleSpeed, OUTPUT); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">9600</span></span>); } //   <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>(),      <span class="hljs-type"><span class="hljs-type">void</span></span> turn(<span class="hljs-type"><span class="hljs-type">int</span></span> angle) { digitalWrite(pinAngleStop, HIGH); //   ,    delay(<span class="hljs-number"><span class="hljs-number">5</span></span>); // ,   ""  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(angle &gt; <span class="hljs-number"><span class="hljs-number">149</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( digitalRead(pinWhite) == HIGH &amp;&amp; digitalRead(pinBlack) == LOW &amp;&amp; digitalRead(pinBlack) == LOW) { //    ,      ,   //  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } //   ,  digitalWrite(angleDirection, HIGH); analogWrite(angleSpeed, speedTurn); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (angle &lt; <span class="hljs-number"><span class="hljs-number">31</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(digitalRead(pinRed) == HIGH &amp;&amp; digitalRead(pinBlack) == HIGH &amp;&amp; digitalRead(pinWhite) == HIGH) { //    ,      ,   //  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } //   ,  digitalWrite(angleDirection, LOW); analogWrite(angleSpeed, speedTurn); } digitalWrite(pinAngleStop, LOW); //     delay(<span class="hljs-number"><span class="hljs-number">5</span></span>); }</code> </pre> <br><h2>  Paralelizaci√≥n de ruedas rodantes </h2><br>  Inicialmente, dos motores de propulsi√≥n est√°n conectados entre s√≠.  Se desconectaron por dos razones: un giro es m√°s efectivo si las ruedas giran en diferentes direcciones, y dos motores potentes no tiran de una tabla. <br><br>  Problema: el blindaje del motor tiene dos salidas, cada una de las cuales produce hasta 2 amperios.  Cada motor come 0.7A.  Parece menos, pero no a cargas m√°ximas.  Digamos que la m√°quina est√° atrapada en la arena o descansada, la corriente se eleva por encima del amperio.  No es cr√≠tico, pero es potencialmente peligroso. <br><br>  Pero result√≥ ser cr√≠tico que el tablero se calienta.  Minutos y medio despu√©s de la carrera, el escudo del motor se estaba calentando y comenz√≥ a funcionar feo: las corrientes no eran las correctas, las ruedas no giraban, y as√≠ sucesivamente. <br><br>  La soluci√≥n a ambos problemas: un motor conectado a un escudo del motor, el segundo al otro.  Por extra√±o que parezca, ayud√≥.  La temperatura ha bajado, no hay sobrecalentamiento.  Podr√≠as poner un radiador, pero es dif√≠cil de montar. <br><br><img src="https://habrastorage.org/webt/qp/ty/zd/qptyzd9l9hs1icacrd2m1oetyiq.png"><br><br><h2>  Conexi√≥n Bluetooth </h2><br>  Us√© el modelo HC-05, que jug√≥ una broma fatal.  Todos los bluetooth est√°n conectados de la misma manera: un cable a 3.3V (a veces comenz√≥ a funcionar solo desde 5V), el segundo a menos, dos m√°s en el puerto 0 y 1 (leer y enviar, respectivamente).  Un cable firmado por RXD en bluetooth est√° atascado en TXD arduino y TXD en RXD (si lo mezcla, no ver√° los datos). <br><br>  Hay una advertencia: los puertos 0 y 1 son utilizados por defecto por Serial, a trav√©s del cual se inunda el boceto.  Es decir, mientras el bluetooth est√° atascado, el boceto no se inundar√°.  Hay dos formas: sacar el bluetooth durante el tiempo de llenado o reasignar las entradas y salidas del bluetooth.  La segunda opci√≥n se lleva a cabo en dos l√≠neas. <br><br><pre> <code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SoftwareSerial.h&gt; \\  SoftwareSerial BTSerial(8, 9); \\ 8  9   0  1</span></span></span></span></code> </pre> <br>  La trampa que me ha comido durante tres d√≠as de trabajo es la velocidad de comunicaci√≥n.  Por costumbre, instal√© 9600 y fui a probar.  O bien los datos no llegaron, luego hubo un l√≠o de caracteres.  ¬°Y al final la respuesta es que el HC-05 se comunica por 38400!  Preste mucha atenci√≥n al hecho de que en Setup () ejecutar√© BTSerial.begin (39400), aunque Serial.begin (9600). <br><br><h2>  Sistema de env√≠o de comandos </h2><br>  El art√≠culo se est√° alargando demasiado, por lo que eliminar√© la consideraci√≥n del c√≥digo Arduino y Android en una segunda parte separada, y ahora describir√© el principio. <br><br>  Hay un joystick en el dispositivo Android (un c√≠rculo, cuya implementaci√≥n tambi√©n se encuentra en la segunda parte).  Android lee las lecturas y las convierte en n√∫meros adecuados para arduino: la velocidad de los p√≠xeles se convierte en un valor de -255 a 255 (negativo - inverso), y tambi√©n determina el √°ngulo.  Deliberadamente le di esta tarea al tel√©fono, ya que es mucho m√°s potente y f√°cil de hacer frente al c√°lculo de varios cientos de valores por segundo. <br><br><img src="https://habrastorage.org/webt/gc/sz/op/gcszopqgz0xeruzdui4zlntrtnu.jpeg"><br><br>  Despu√©s de instalar el socket, los datos se env√≠an en el siguiente formato: @ speed # * angle #.  @ - indica que los siguientes d√≠gitos contienen la velocidad, # - indica el final del valor de la velocidad, * - el comienzo del valor del √°ngulo, # - termina de registrar el √°ngulo.  El ciclo es interminable, los comandos se env√≠an cada 100 milisegundos (se selecciona el n√∫mero √≥ptimo).  Si no se presiona nada en el Android, no se env√≠a nada. <br><br>  El algoritmo de recepci√≥n de datos se describe en detalle en el c√≥digo de boceto.  Se correspondi√≥ m√°s de una vez y, en cuanto a m√≠, funciona perfectamente. <br><br><h2>  Conclusi√≥n de la primera parte. </h2><br>  En este art√≠culo, intent√© revelar todo lo relacionado con la parte f√≠sica de la m√°quina.  Lo m√°s probable es que me haya perdido algo, as√≠ que aseg√∫rese de preguntar. <br><br>  Pero lo m√°s interesante, en cuanto a m√≠, permaneci√≥ por un segundo: el programa Arduino y la aplicaci√≥n de Android, la verdadera magia est√° ocurriendo all√≠, al menos para los j√≥venes. <br><br>  Si no encuentra la respuesta a alguna parte y quiere meterme personalmente en las deficiencias, espero - dendolg1@mail.ru ,. <br><br>  UPD: la segunda parte ya est√° disponible - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">habr.com/post/424813</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es424087/">https://habr.com/ru/post/es424087/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es424073/index.html">Ejecuci√≥n remota de c√≥digo en Microsoft JET Database Engine</a></li>
<li><a href="../es424077/index.html">Francia exige que el "derecho al olvido" sea global: lo que puede afectar</a></li>
<li><a href="../es424081/index.html">RESS - Nueva arquitectura para aplicaciones m√≥viles</a></li>
<li><a href="../es424083/index.html">Un servicio para comerciar en el intercambio Robinhood fue acusado de vender datos sobre aplicaciones de usuarios a operadores de alta frecuencia</a></li>
<li><a href="../es424085/index.html">Estamos desarrollando el m√≥dulo procesador NIOS II para IDA Pro</a></li>
<li><a href="../es424089/index.html">Las conferencias son malvadas. O bien?</a></li>
<li><a href="../es424091/index.html">WiX.Py: recopilamos el paquete MSI "en tres l√≠neas"</a></li>
<li><a href="../es424093/index.html">Desde radio antigua hasta parlantes DIY: 12 canales de YouTube para un dispositivo ac√∫stico</a></li>
<li><a href="../es424099/index.html">Determinar la madurez de una sand√≠a usando Keras: un ciclo completo, de una idea a un programa en Google Play</a></li>
<li><a href="../es424103/index.html">Silicon Valley ha sido "imperdonable" para sus empleados desde la d√©cada de 1970</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>