<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçü§ù‚Äçüë©üèº üë®üèº‚Äçüíº üê® Juego en 3D en three.js, nw.js ‚ô†Ô∏è ‚èØÔ∏è üôè</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Decid√≠ lanzar una nueva versi√≥n de mi antiguo juego de navegador, que durante un par de a√±os ha tenido √©xito como aplicaci√≥n en las redes sociales. Es...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Juego en 3D en three.js, nw.js</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450926/"> Decid√≠ lanzar una nueva versi√≥n de mi antiguo juego de navegador, que durante un par de a√±os ha tenido √©xito como aplicaci√≥n en las redes sociales.  Esta vez me propuse dise√±arlo tambi√©n como una aplicaci√≥n para Windows (7-8-10) y colocarlo en varias tiendas.  Por supuesto, en el futuro puede hacer ensamblajes para MacOS y Linux. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1c/tj/vi/1ctjvijgbjodkdjhwszw4atwgvm.jpeg"></div><br>  El c√≥digo del juego est√° escrito completamente en javascript puro.  Para mostrar gr√°ficos en 3D, la biblioteca three.js se usa como un enlace entre el script y WebGL.  Sin embargo, este fue el caso en la versi√≥n anterior del navegador.  Lo m√°s importante en este proyecto para m√≠ fue la raz√≥n, en paralelo con el juego, para agregar mi propia biblioteca, dise√±ada para complementar three.js con las herramientas para un trabajo conveniente con objetos de escena, su animaci√≥n y muchas otras caracter√≠sticas.  Luego lo abandon√© por mucho tiempo.  Es hora de volver a ella. <br><a name="habracut"></a><br><br>  Mi biblioteca contiene herramientas convenientes para agregar y eliminar objetos de la escena, cambiar las propiedades de partes individuales de objetos (mallas), animaci√≥n independiente de la velocidad de fotogramas de objetos 3D, un sombreador de cielo con una textura de cielo estrellado por la noche y mucho m√°s.  Te contar√© sobre algunos de ellos.  Con respecto al cielo, implement√© su creaci√≥n con una √∫nica funci√≥n que toma una serie de par√°metros de entrada, inicializa el sombreador, carga la textura de la nube (si es necesario) y comienza a actualizar el cielo con una iteraci√≥n dada. <br><br>  Sin embargo, todo es un poco m√°s complicado all√≠: para peri√≥dicamente, pero raramente llamadas funciones, otra construcci√≥n realmente funciona, usando setInterval (), en el que los eventos se pueden lanzar a diferentes intervalos, y reducir√° todo esto a un denominador com√∫n y lo resolver√° a la derecha tiempo necesario eventos en la lista.  All√≠ tambi√©n puedes lanzar el intervalo de actualizaci√≥n del cielo.  Pero el movimiento de los objetos de juego en 3D para una mayor suavidad ya se ha implementado a trav√©s de requestAnimationFrame () ... <br><br>  Entonces, como estamos hablando del cielo, comenzaremos con √©l. <br><br><h3>  El cielo </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ge/xw/da/gexwday-od32dav2p4gb48p1nme.jpeg"></div><br>  Agregar el firmamento a la escena es la siguiente. <br><br>  Primero debe agregar la luz est√°ndar three.js a la escena con sus valores m√°ximos (iniciales) de brillo.  Toda la escena con sus objetos, luz y otros atributos, para no saturar el espacio global, se almacenar√° en el espacio de nombres de apscene. <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  (AmbLight)   apscene.AmbLight=new THREE.AmbientLight(0xFFFFFF); apscene.scene.add(apscene.AmbLight); //  (AmbLightBk)   (      ) apscene.AmbLightBk=new THREE.AmbientLight(0xFFFFFF); apscene.sceneb.add(apscene.AmbLightBk); // (, )   var SFog=new THREE.FogExp2(0xaaaaaa, 0.0007); apscene.scene.fog=SFog; // (, )   var SFogBk=new THREE.FogExp2(0xa2a2aC, 0.0006); apscene.sceneb.fog=SFogBk; //  apscene.hemiLight=new THREE.HemisphereLight(0xFFFFFF, 0x999999, 1); apscene.scene.add(apscene.hemiLight); //        .       .        three.js   ,   ,     ,  ,   ... apscene.dirLight=new THREE.DirectionalLight(...) apscene.dirLightBk=new THREE.DirectionalLight(...)</span></span></code> </pre> <br>  Despu√©s de eso, ya puedes ejecutar la animaci√≥n del cielo con sombreadores, texturas (blackjack y ... bueno, est√° bien) a trav√©s de una de mis funciones: <br><br><pre> <code class="javascript hljs">m3d.graph.skydom.initWorld( <span class="hljs-comment"><span class="hljs-comment">//  ,  ,         {saveStart:false}, { //ltamb (light ambient,    ) -       ltamb:{a1:-2, a2:8, k1:0.2, k2:0.75, obj:[ {obj:apscene.AmbLight.color, key:['r','g','b']} ]}, //a1  a2 -      (altitude,      ),     ,   obj,     (k1..k2),   k1  k2 -         // ,    ltamb :     -2  8 (    ),    (apscene.AmbLight.color),    r, g  b,    0.2  0.75     ( ,    ,    0xFFFFFF). //key -    ,        three.js //        (apscene.AmbLightBk.color).    (  altitude)  -4  12          0.3 ... 0.99    .  -4 , ,    0.3  ,   12   0.99   ltambb:{a1:-4, a2:12, k1:0.3, k2:0.99, obj:[ {obj:apscene.AmbLightBk.color, key:['r','g','b']} ]}, //      : ltdir:{a1:-2, a2:8, k1:0.0, k2:1, obj:[ {obj:apscene.dirLight, key:['intensity']}, {obj:apscene.dirLightBk, key:['intensity']} ]}, //       (apscene.dirLightBk)   ,    ,       . // ,      three.js    - inensity ( , apscene.dirLight.intensity).  ,  ,       three.js    . //  .   ,     ( 0.15  )     12  8 (, ,    8  12), : lthem:{a1:8, a2:12, k1:0.15, k2:0.3, obj:[ {obj:apscene.hemiLight, key:['intensity']} ]}, //         .       . //    ()   : ltambfog:{a1:-2, a2:8, k1:0.4, k2:1, obj:[ {obj:apscene.scene.fog.color, key:['r','g','b']} ]}, //  : ltambbfog:{a1:-2, a2:12, k1:0.25, k2:1, obj:[ {obj:apscene.sceneb.fog.color, key:['r','g','b']} ]}, //     .  ,         ,  . ltambfogd:{a1:8, a2:12, k1:0.2, k2:0.35, obj:[ {obj:apscene.scene.fog, key:['density']} ]}, //  ltambbfogd:{a1:6, a2:12, k1:0.2, k2:0.28, obj:[ {obj:apscene.sceneb.fog, key:['density']} ]}, //  ,      ( ,   ),   ,     ,   , -¬´¬ª     ,      skyplane1..6: planeAmb:{a1:-5, a2:12, k1:0.5, k2:1.0, obj:[ {obj:apscene.user.skyplane1.material.color, key:['r','g','b']}, {obj:apscene.user.skyplane2.material.color, key:['r','g','b']}, {obj:apscene.user.skyplane3.material.color, key:['r','g','b']}, {obj:apscene.user.skyplane4.material.color, key:['r','g','b']}, {obj:apscene.user.skyplane5.material.color, key:['r','g','b']}, {obj:apscene.user.skyplane6.material.color, key:['r','g','b']} ]} //,     ,     ,  . };</span></span></code> </pre> <br>  Como resultado, aparece un cielo din√°mico en la escena con un cambio suave en la altura del sol y, en consecuencia, un cambio en la hora del d√≠a. <br><br>  No es necesario utilizar todo tipo de iluminaci√≥n en el escenario.  Y no es necesario cambiar todos los par√°metros seg√∫n la hora del d√≠a.  Pero, jugando con su brillo, sin embargo, puede crear una imagen bastante realista del cambio de d√≠a y de noche.  Puede nombrar los par√°metros como desee, lo principal es observar las claves de los objetos dentro de ellos tal como se especifican en three.js. <br><br>  C√≥mo se ve, puede ver el video de la escena de demostraci√≥n: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/PoAPy3ByPRU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Este es un juego diferente.  Es solo que el horizonte no est√° abarrotado de varios objetos y, por lo tanto, el trabajo de este script es m√°s claramente visible.  Pero en el juego sobre el que se discute la historia, se usa exactamente el mismo enfoque.  La alta velocidad del paso del tiempo aqu√≠ se establece solo con fines de demostraci√≥n, por lo que el tiempo fluye, por supuesto, m√°s lentamente, con el mismo paso de la iteraci√≥n actualizando el firmamento.  En esta demostraci√≥n, por cierto, est√° involucrado un sombreador de agua, tambi√©n con par√°metros variables, dependiendo de la altura del sol ... Pero a√∫n no lo he finalizado. <br><br><h3>  Rendimiento </h3><br>  Todo esto es muy poco exigente con el hierro.  Trabajando en el navegador Chrome, carga el Xeon E5440 bajo LGA775 (y con 4 gigas de RAM) en un 20%, y el n√∫cleo de la tarjeta gr√°fica GT730 en un 45%.  Pero esto se debe √∫nicamente a la animaci√≥n del agua.  Si hablamos de un juego donde no hay agua, pero hay una ciudad, este: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0i/_k/se/0i_ksepjxwtge9qffnonerlnkes.jpeg"></div><br>  luego, en el momento en que el autom√≥vil se mueve por la ciudad: porcentaje 45%, tarjeta de video 50%.  En principio, con una reducci√≥n de fps (hasta aproximadamente 30 cuadros por segundo), funciona razonablemente bien incluso en Pentium4 3GHz (1Gb RAM) y en una tableta en Intel Atom 1.3GHz (2Gb RAM). <br><br>  Todo este hardware es extremadamente d√©bil y otros juegos similares en WebGL y HTML5, incluso algunos en 2D, me ralentizan sin piedad, hasta el punto de que es imposible jugarlos.  Como dicen, escribe el juego t√∫ mismo, seg√∫n lo necesites, y juega. <br><br><h3>  Escena </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jb/zo/y1/jbzoy1gm1aomyfdgyp7udkziole.jpeg"></div><br>  La escena 3D en three.js es un objeto de escena y su matriz secundaria es, de hecho, todos los modelos 3D cargados en la escena.  Para no registrar una llamada al gestor de arranque para cada modelo, decid√≠ que toda la escena del juego se establecer√≠a en forma de una determinada configuraci√≥n, con una gran matriz asociativa locd: {} (como datos de ubicaci√≥n), que contendr√≠a todos los ajustes: luces, caminos de texturas precargadas e im√°genes para la interfaz, rutas a todos los modelos que deben cargarse en el escenario, y m√°s.  En general, esta es la configuraci√≥n completa de la escena.  Se configura una vez en el archivo js del juego y se alimenta a mi cargador de escenas. <br><br>  Y este objeto locd: {}, en particular, contiene las rutas a los modelos 3D individuales que deben cargarse.  La ruta cero es la ruta com√∫n, y luego las rutas relativas para cada objeto, como: <br><pre> <code class="javascript hljs">[<span class="hljs-string"><span class="hljs-string">'path/myObj'</span></span>, scale, y, x,z, r*<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>], <span class="hljs-string"><span class="hljs-string">'scene'</span></span>]</code> </pre> <br>  Se entiende que todos los modelos se exportan desde el editor 3D al formato json, es decir, tienen rutas como path / myObj.json.  Esto es seguido por la escala (ya que el editor se puede guardar con una escala que no es adecuada para el juego), la posici√≥n del objeto en altura (y), a lo largo de los ejes (x) y (z), luego el √°ngulo de rotaci√≥n ¬Æ del modelo en (y), una serie de par√°metros opcionales y El nombre de la escena donde cargar el modelo: en la escena principal (escena) o en el fondo (escenab). <br><br>  S√≠, era necesario implementar esto no en forma simple, sino en forma de matriz asociativa.  Por lo tanto, el orden de los par√°metros es incomprensible incluso sin documentaci√≥n, o al menos sin el tipo de funci√≥n que toma estos par√°metros, no lo entender√°.  Creo que en el futuro rehacer√© estas l√≠neas en matrices asociativas.  Mientras tanto, se ve as√≠: <br><pre> <code class="javascript hljs">landobj: [ [<span class="hljs-string"><span class="hljs-string">'gamePath/'</span></span>], [ [<span class="hljs-string"><span class="hljs-string">'landscape/ground'</span></span>, <span class="hljs-number"><span class="hljs-number">9.455</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>*<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>], <span class="hljs-string"><span class="hljs-string">'scene'</span></span>], [<span class="hljs-string"><span class="hljs-string">'landscape/plants'</span></span>, <span class="hljs-number"><span class="hljs-number">9.455</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>*<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI,<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>], <span class="hljs-string"><span class="hljs-string">'scene'</span></span>], [<span class="hljs-string"><span class="hljs-string">'landscape/buildings/house01'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-420</span></span>,<span class="hljs-number"><span class="hljs-number">420</span></span>, <span class="hljs-number"><span class="hljs-number">-0.75</span></span>*<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>], <span class="hljs-string"><span class="hljs-string">'scene'</span></span>], ... ] ],</code> </pre> <br>  Estos modelos se cargan en el escenario y se colocan en las coordenadas dadas aqu√≠ en el espacio.  En principio, todos los modelos pueden cargarse como un solo objeto, es decir, exportarse desde el editor como una escena de juego completa y cargarse en coordenadas (0; 0; 0).  Entonces solo habr√° una l√≠nea: paisaje / tierra - tengo ground.json - esta es la parte principal del mundo del juego.  Pero en este caso ser√° dif√≠cil manipular objetos individuales de la escena, ya que primero deber√° buscar en la consola del navegador y recordar cu√°l de los hijos de este enorme terreno es.  Y luego cont√°ctelos por n√∫meros.  Por lo tanto, los modelos de juegos itinerantes se cargan mejor con objetos separados.  Luego se puede acceder a ellos por nombre desde la matriz asociativa, que se crear√° autom√°ticamente especialmente para este prop√≥sito. <br><br>  La configuraci√≥n completa del juego puede verse, por ejemplo, as√≠: <br><pre> <code class="javascript hljs">locd:{ <span class="hljs-comment"><span class="hljs-comment">// name: 'SeaBattle', type: 'game', menulabel: '', //    x:-420, y:70, z:-420, rot: -0.5, //    intsdistance: 200, // ambLtColor: 0xFFFFFF, ambLtColorBk: 0xFFFFFF, lightD: [0xDDDDDD,0.3,1000, 200000,0.3,-0.0003, -190,200000,-140,0,0,0, 200,-200,200,-200], lightDBk: [0xFFFFFF,0.3,10000, 40000,0.3,-0.0035, -190,1200,-140,0,0,0, 50000,-50000,50000,-50000], lightH: [0xFFFFFF,0x999999,1, 0,500,0], //      lightsP: [], //     lightsPDynamicAr: [ [0xffffff, 4, [0, -2000, 0], [50, 1.5] ] //[[distance], [decay]] ], //         (x,y,z) userPointLights: [ [0, -2000, 0] ], //   lightsS: [ [0xffffbb, 1.0, [0, 250, 180], [0, 0, 180], 0.5, 600,600,600, -0.0005] ], //  shadowMapCullFace:0, shadowsMode: 'all', //all,list,flag //  imagePaths: [ 'game/img/', 'interface.png', 'interface2.png' ], // 3D  landobj: [ ['game/models/'], [ ['landscape/land',1, 0, 0,0, 0.0*Math.PI,1,'','','',1,['','','',''],'scene'], ['landscape/sbp',1, 0, 0,180, 1.0*Math.PI,1,'','','',1,['','','',''],'scene'], ['landscape/sbu',1, 0, 0,1120, 1.0*Math.PI,1,'','','',1,['','','',''],'scene'] ] ], //        staffobj: [ ['game/models2/'], [ ] ], //  progobj: [ [ ] ] },</span></span></code> </pre> <br>  S√≠, es mejor rehacer todas estas submatrices en matrices asociativas, de lo contrario, el orden de los par√°metros en ellas no est√° claro ... <br><br><h3>  Modelos 3D </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fz/fm/ql/fzfmqlr4yfw3_tkm79xjwlb_ccw.jpeg"></div><br>  Otra cosa interesante  Cargando modelos.  Mi biblioteca acepta modelos 3D con texturas y establece autom√°ticamente algunos par√°metros para sus elementos individuales (mallas), seg√∫n los nombres.  El hecho es que si, por ejemplo, el modelo est√° configurado para proyectar una sombra, entonces ser√° proyectado por cada malla incluida en su composici√≥n.  No siempre es necesario que todo el modelo arroje una sombra por completo o adquiera otras propiedades que afecten fuertemente el rendimiento.  Por lo tanto, si activa un determinado indicador que indica que es necesario considerar cada malla por separado, al cargarla es posible determinar qu√© malla tendr√° esta o aquella propiedad y cu√°les no.  Bueno, por ejemplo, no hay absolutamente ninguna necesidad de que la sombra sea proyectada por el techo horizontal plano de la casa o por muchos detalles menores irrelevantes del modelo sobre un fondo grande.  De todos modos, el reproductor no podr√° ver estas sombras, y la potencia del procesador de video se usar√° para procesarlas. <br><br>  Para hacer esto, en el editor de gr√°ficos (Blender, Max, etc.), puede especificar inmediatamente los nombres de las mallas (en el campo de nombre del objeto) de acuerdo con una determinada regla.  Debe haber un gui√≥n bajo (_).  Los caracteres de control condicional deben ir en el lado izquierdo, por ejemplo: d - doble cara (la malla es bidireccional, de lo contrario - unidireccional), c (sombra proyectada) - proyecta una sombra, r (sombra recibida) - toma sombras.  Es decir, por ejemplo, el nombre de la malla de la tuber√≠a en la casa puede ser cr_tube.  Tambi√©n se usan muchas otras letras.  Por ejemplo, "l" es un colisionador, es decir, la pared de la casa, que tiene el nombre crl_wall01, no permitir√° que el jugador pase a trav√©s de s√≠ mismo, y tambi√©n lanzar√° una sombra.  No hay necesidad de hacer colisionadores, como un techo o una manija de la puerta, y as√≠ degradar el rendimiento.  Como ya entendi√≥, al cargar un modelo, mi biblioteca analiza los nombres de las mallas y les da las propiedades correspondientes en la escena.  Pero para esto es necesario nombrar correctamente todas las mallas antes de exportar el modelo desde el editor 3D.  Esto ahorrar√° significativamente el rendimiento. <br><br>  Todos los indicadores de control para mallas dentro de un objeto: <br><blockquote>  col_ ... es el colisionador.  Dicha malla se mostrar√° simplemente como un colisionador transparente e invisible.  En el editor, puede verse como cualquier cosa, solo su forma es importante.  Por ejemplo, puede ser un paralelep√≠pedo alrededor de todo el modelo si es necesario que el jugador no pueda pasar por este modelo (edificio, piedra grande, etc.). <br><br>  l_ ... es un objeto colisionable.  Dando a cualquier malla una propiedad de colisionador. <br><br>  i_ ... - intersecciones.  La malla se agregar√° a la lista de intersecciones, que se puede usar, por ejemplo, para hacer clic en ella, es decir, para dar interactividad al juego. <br><br>  j_ ... tambi√©n intersecciones.  Igual que el anterior, solo una versi√≥n m√°s nueva, con un algoritmo mejorado para encontrar intersecciones en el juego y menos consumo de recursos. <br><br>  e_ ... - intersecciones para las puertas de las casas (entrada / salida).  Excluye la intersecci√≥n sobre otras mallas de objetos.  Se utiliza si es necesario en las casas en alg√∫n momento para hacer que solo las puertas sean interactivas, excluyendo todos los dem√°s elementos interactivos.  Con imaginaci√≥n, puedes llegar a esto y a muchos otros usos. <br><br>  c_ ... - proyecta sombras.  La malla proyecta una sombra. <br><br>  r_ ... - recibe sombras.  Una malla acepta sombras de todas las otras mallas que las proyectan. <br><br>  d_ ... - bilateral (doble cara).  Visible en ambos lados, la textura se superpone en ambos lados. <br><br>  t_ ... - transparente (transparente), si todo el objeto se establece en alphatest en three.js. <br><br>  u_ ... - transparente (transparente), con una densidad fija (0.4), si todo el objeto no especifica alphatest en three.js. <br><br>  g_ ... - vidrio.  Se establece la transparencia fija (0.2). <br><br>  h_ ... - invisible (oculto).  Para partes del objeto (mallas) que deben ocultarse al agregar el objeto a la escena.  Entr√≥ en la lista de ocultos. <br><br>  v_ ... visible.  Todos los objetos, excepto los marcados con "h", ya son visibles, pero con la bandera "v" se ingresan en una lista separada visible para su posterior ocultaci√≥n u otras manipulaciones. </blockquote><br>  Como resultado, el nombre de la malla puede ser algo como esto: crltj_box1 (proyecta, acepta una sombra, colisionador, transparente, interactivo).  Y otra malla como parte del mismo modelo: cr_box2 (solo proyecta y toma sombras). Naturalmente, los caracteres de control se pueden configurar en cualquier orden.  Por lo tanto, desde el editor puedes controlar la visualizaci√≥n futura de partes del objeto en el juego, o m√°s bien, algunas de sus propiedades, ahorrando, al mismo tiempo, potencia inform√°tica. <br><br><h3>  La esencia del juego </h3><br>  El significado, de hecho, del juego sobre el que trata la historia, es moverse por el per√≠metro del campo cuadrado y comprar empresas.  El campo est√° hecho en forma de calles 3D.  El modelo econ√≥mico del juego es significativamente diferente de los de su tipo.  En mi juego, cuando alguien inicia un negocio, su beneficio esperado cae.  Y viceversa, cuando descubres algo, aumenta.  Todos los c√°lculos de p√©rdidas y ganancias se realizan en la Inspecci√≥n fiscal en el campo Inicio.  Tambi√©n puede obtener un pr√©stamo de un banco, negociar valores y hacer otras cosas.  He mejorado el comportamiento de la IA en comparaci√≥n con la versi√≥n anterior.  Redidi√≥ casi todos los modelos y texturas 3D del juego y optimiz√≥ el rendimiento.  Realiz√≥ m√°s configuraciones y mucho m√°s. <br><br><h3>  Animaci√≥n </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lw/7u/m_/lw7um_phbrcpp-yx78ec5ihw9jy.jpeg"></div><br>  Para animar el movimiento de los objetos del juego, se utiliza el motor m√°s simple, que con una velocidad de fotogramas determinada (se limita a la 60) cambia los par√°metros num√©ricos para un intervalo de tiempo determinado, pasando valores intermedios al controlador.  Y en el controlador, por ejemplo, se muestra el modelo. <br><br>  Por ejemplo  Necesitamos mover el objeto obj en el espacio desde la posici√≥n (10; 10; 50) al punto (100; 300; 60).  Establecemos 3 par√°metros indicando sus valores iniciales y finales.  Nuestra coordenada x variar√° de 10 a 100, y de 10 a 300 y z de 50 a 60. Y todo esto deber√≠a suceder, por ejemplo, en 4 segundos. <br><pre> <code class="javascript hljs">m3d.lib.anim.add( <span class="hljs-string"><span class="hljs-string">'moveobj'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4000</span></span>, <span class="hljs-string"><span class="hljs-string">'and'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">userpar1</span></span>:<span class="hljs-number"><span class="hljs-number">111</span></span>, <span class="hljs-attr"><span class="hljs-attr">obj</span></span>:my3DObject}, [ {<span class="hljs-attr"><span class="hljs-attr">lim1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">lim2</span></span>:<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">sstart</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">sfin</span></span>:<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">t</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">lim1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">lim2</span></span>:<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-attr"><span class="hljs-attr">sstart</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">sfin</span></span>:<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-attr"><span class="hljs-attr">t</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">lim1</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">lim2</span></span>:<span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-attr"><span class="hljs-attr">sstart</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">sfin</span></span>:<span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-attr"><span class="hljs-attr">t</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>} ], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ myPeriodicFun(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ myFinishFun(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } ); m3d.lib.anim.play();</code> </pre> <br>  La primera l√≠nea de 5 par√°metros: moveobj: nombre de la animaci√≥n (cualquiera), 1: n√∫mero de secuencia (puede animar objetos en paralelo en un n√∫mero ilimitado de secuencias), 4000: tiempo de animaci√≥n de 4 segundos y un par√°metro no utilizado que ser√° responsable de la l√≥gica de transici√≥n en el futuro entre animaciones dentro de la misma secuencia, userpar es cualquier matriz asociativa que se pasar√° al controlador como un par√°metro, por ejemplo, con un radio calculado, senos, cosenos y, en general, cualquier valor calculado para esta animaci√≥n, para no ser calculado en  sobre el tiempo de cada iteraci√≥n.  O con referencia a un objeto 3D, que, de hecho, se animar√°. <br><br>  Lo siguiente es una matriz con par√°metros mutables.  Encontramos que el primer par√°metro es el cambio en la coordenada x, el segundo es y, el tercero es z.  Escribimos para cada uno en lim1 y lim2, de qu√© y a qu√© tama√±o cambiar√°.  En sstart y sfin especificamos los mismos valores.  Aqu√≠ puede especificar un inicio, por ejemplo, a partir de alg√∫n otro valor, luego el par√°metro se "desplazar√°" en un c√≠rculo hacia √©l, omitiendo lim2 y comenzando una nueva "revoluci√≥n" con lim1.  Bueno, por ejemplo, esto es necesario si nuestra animaci√≥n se enlaza entre algunos valores (lim1 y lim2), pero necesitamos comenzar no desde el principio (es decir, no desde lim1), sino desde alg√∫n valor intermedio. <br><br>  t: 0 simplemente establece que la animaci√≥n para este par√°metro se realice 1 vez, de acuerdo con el tiempo total (4000), como si se extendiera a √©l.  Si establecemos otro n√∫mero, menor que el tiempo principal, este par√°metro se repetir√° y se repetir√° hasta el momento de la animaci√≥n principal (4000).  Esto es conveniente, por ejemplo, para establecer la rotaci√≥n del objeto cuando el √°ngulo debe cruzar repetidamente la l√≠nea de 360 ‚Äã‚Äãgrados y restablecer a 0. <br><br>  Luego vienen 2 devoluciones de llamada: la que se ejecutar√° con cada iteraci√≥n y la que se ejecutar√° una vez que se complete la animaci√≥n completa (punto de salida). <br><br>  La primera devoluci√≥n de llamada myPeriodicFun (this), por ejemplo, puede ser as√≠: <br><pre> <code class="javascript hljs">myPeriodicFun:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">self</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state=self.par[<span class="hljs-number"><span class="hljs-number">0</span></span>].state, state_old=self.par[<span class="hljs-number"><span class="hljs-number">0</span></span>].state_old; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state2=self.par[<span class="hljs-number"><span class="hljs-number">1</span></span>].state, state_old2=self.par[<span class="hljs-number"><span class="hljs-number">1</span></span>].state_old; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state3=self.par[<span class="hljs-number"><span class="hljs-number">2</span></span>].state, state_old3=self.par[<span class="hljs-number"><span class="hljs-number">2</span></span>].state_old; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((state!=state_old)||(state2!=state_old2)||(state3!=state_old3)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj=self.userpar.obj; obj.position.x=state; obj.position.y=state2; obj.position.z=state3; ap.cameraFollowObj(obj); }; },</code> </pre> <br>  Es decir, en cada iteraci√≥n del movimiento, se arroja un par√°metro (self) en esta funci√≥n que contiene los valores intermedios calculados para todos los par√°metros de animaci√≥n dados: self.par [0] .state, self.par [1] .state, self.par [2] Estado.  Esta es nuestra x, y y z en el momento actual.  Por ejemplo, si la animaci√≥n dura 4 segundos, despu√©s de 2 segundos x ser√° igual a (100-10) / 2 = 45. Y as√≠ para todas las coordenadas.  En consecuencia, en myPeriodicFun simplemente mostramos nuestro objeto en estas coordenadas.            ,  :     ,        -. <br><br>    f ((state!=state_old)...,  ,        ( state_old     ), , ,  , ,  -   ,   ,            .      state  state_old  , , ,    ,  .           1 ,      ,       . <br><br>  ,                  -.     4- ,       .          ,    - .      ,     .   (m3d.lib.anim.add())      ,      . ,       . ,          -. <br><br> PS                       . ..,     javascript . <br><br>   ¬´¬ª       ,    2-          -    . , ,     . <br><br><h3>   </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fd/4c/1-/fd4c1-dofkcz8fsysds0pbi_-eo.jpeg"></div><br>         ,     fps    .    .           .  ,      . <br><br>   .  three.js     ,   (shadowCameraLeft, shadowCameraRight, shadowCameraTop, shadowCameraBottom).      ,    ,             . ,      ‚Äî  ,     .         ,      .           ,   . <br><br>      3D    contr,        .       contr.cameraForShadowStep,     ,      . <br><br> , ,      700x700x700,  contr.cameraForShadowStep   , , 20.      20    ,         .  3D    ,    ,        3D .   ,   700x700x700  20,    7000x7000x7000  200.        . <br><br>  ,           ,       .  ,      ,     .          . <br><br><h3>     </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kg/fa/be/kgfabepvwgn_zxwfctnyh2rce7g.jpeg"></div><br>              fps,    .        ¬´¬ª. , ,         (    )     .      ,    .       ,      3D ,     (2, 4  8)   ¬´ ¬ª. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mr/-g/sr/mr-gsrw4vfm6qjobtc5a36p432s.jpeg"></div><br>  ,            . ,         userPointLights  lightsPDynamicAr.  userPointLights        .  lightsPDynamicAr      8 .      ,              . <br><br>        2-8         userPointLights.       .  , 2-8     ,  . ,        fps,    .      60   ,  ,     ‚Äî          . <br><br>       (Xeon E5440, GeForce GT730): <br><iframe width="560" height="315" src="https://www.youtube.com/embed/IPuJrH8EJ_E" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h3>   </h3><br>         (  ),    bat-,    Google Closure Compiler     *.js .      nwjc.exe   nw.js ‚Äî   js   (*.bin).      : <br><blockquote> java -jar D:\webservers\Closure\compiler.jar --js D:\webservers\proj\m3d\www\game\bus\bus.js --js_output_file D:\webservers\proj\nwProjects\bus\game\bus\bus.js <br><br> cd D:\¬´Program Files¬ª\Web2Exe\down\nwjs-sdk-v0.35.5-win-ia32 <br><br> D:\¬´Program Files¬ª\Web2Exe\down\nwjs-sdk-v0.35.5-win-ia32\nwjc.exe D:\webservers\proj\nwProjects\bus\game\bus\bus.js D:\webservers\proj\nwProjects\bus\game\bus\bus.bin <br><br> del D:\webservers\proj\nwProjects\bus\game\bus\bus.js </blockquote><br>      Web2Executable   exe     Windows.  nw.js   0.35.5,   ,     . -      ,    . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hk/_2/ed/hk_2ed5imb6en8ffx6vtfx_7t-o.jpeg"></div><br>       nw.js   .    .     35  , ,  .   ‚Äî node-webkit.   locales  , ,  -    .         .  ,          (       ).      ,   .      . <br><br>      167 . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jp/ev/qq/jpevqq5deupdq0zkm7naffok4fa.jpeg"></div><br>        -      ,    ,      Businessman3DSetup.exe  70,2 . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sf/xd/nn/sfxdnnsvu3fpp9ukkzsius2vqsm.jpeg"></div><br><br><h3>  </h3><br>       .          .        itch.  ,  ,  ‚Äî $3.   ,         . GOG   ,   ,      . ,  , . Epic Store, ,   . <br><br>    ‚Äî ,      1  5.  ‚Äî   .     .     ‚Äî            -,     Windows,   Linux,   iOs   MacOs,   ,    WebGL. ,  , webkit ‚Äî       ,  Firefox,  Edge    IE11  Windows, ,   ‚Äî  . <br><br><h3>  Conclusiones </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kw/cf/wm/kwcfwmtwbwugbnnsb3gol4bshkk.jpeg"></div><br>           ,     .         ,  , ,  -,  ,       ¬´¬ª    .  ,       .        ,   .       ,   ,   - .    ,   ,        . <br><br>  ,      ,    - .   ,        javascript.    ,          .   ,         ,      html5,     2D. ,            (  ) . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/450926/">https://habr.com/ru/post/450926/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../450914/index.html">Las negociaciones fallaron: c√≥mo Oracle mat√≥ a Java EE</a></li>
<li><a href="../450916/index.html">Comparaci√≥n de la calidad de las fotos tomadas en tel√©fonos con diferentes configuraciones de sensores</a></li>
<li><a href="../450918/index.html">Gesti√≥n del conocimiento de TI: la primera conferencia y el panorama general</a></li>
<li><a href="../450922/index.html">Paseo de la oficina</a></li>
<li><a href="../450924/index.html">Todo sobre las animaciones SVG</a></li>
<li><a href="../450928/index.html">C√≥mo los centros de datos ahorran vacaciones</a></li>
<li><a href="../450930/index.html">C√≥mo desarrollamos # bigdataX5 y qui√©n es necesario en Big Data</a></li>
<li><a href="../450938/index.html">Linux Install Fest 05.19 en Nizhny Novgorod 18 de mayo de 2019</a></li>
<li><a href="../450940/index.html">Vivaldi 2.5 - Macrocosmos atractivo</a></li>
<li><a href="../450942/index.html">Sidecar para una divisi√≥n de c√≥digo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>