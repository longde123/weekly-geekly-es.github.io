<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏾‍🤝‍👨🏻 👐🏿 🎅🏾 Documentez votre API express avec des annotations fanfaronnades 🍒 🧗🏻 🤚🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avez-vous déjà voulu avoir une documentation swagger pour votre API express basée sur des annotations? Je l'ai. Et malheureusement, nous n'avons trouv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Documentez votre API express avec des annotations fanfaronnades</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479230/"><p> Avez-vous déjà voulu avoir une documentation swagger pour votre API express basée sur des annotations?  Je l'ai.  Et malheureusement, nous n'avons trouvé aucun moyen de le faire sans avoir à créer manuellement un fichier <code>swagger.json</code> .  Mon souhait était aussi simple que cela: je veux avoir une application express propre avec plusieurs points de terminaison et je veux garder la documentation swagger pour chaque point de terminaison proche de l'implémentation de point de terminaison, pas dans un fichier séparé. </p><br><p>  Peut-être que je manque simplement de compétences Google, mais j'ai décidé qu'il serait beaucoup plus facile pour moi de créer un tel outil.  Et le voici: <a href="https://github.com/MGrin/mgr-swagger-express">mgr-swagger-express</a> </p><a name="habracut"></a><br><h1 id="getting-started">  Pour commencer </h1><br><p>  L'exemple ici sera écrit en TypeScript, mais la même chose peut être faite dans le projet Javascript. <br>  Imaginez donc une application express classique: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c43/11b/d51/c4311bd51e025c31cbaeda213f3c5c36.png" alt="image"></p><br><p>  Nous avons ici une ressource «Livre» et quelques points de terminaison CRUD de base.  La question est «Comment ajouteriez-vous une documentation Swagger sympa à cette API?» Je voulais vraiment le faire en utilisant des annotations afin de garder chaque documentation de point final proche du point final lui-même. </p><br><p>  Voici ce que vous pourrez faire avec <a href="https://github.com/MGrin/mgr-swagger-express">mgr-swagger-express</a> : <br>  <code>index.ts</code> : </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/8c9/5cc/0cd/8c95cc0cdc187e1e783e111b4acd3208.png" alt="image"></p><br><p>  <code>BookService.ts</code> : </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/6de/e35/9b2/6dee359b2601e8623b37a291b2dfd231.png" alt="image"></p><br><p>  Il y a beaucoup plus de code, mais maintenant nous avons toute la documentation de swagger à côté du point de terminaison lui-même. <br>  Voyons ce qui se passe ici: </p><br><ul><li>  Dans le fichier d'index, nous créons notre application express, comme d'habitude.  Nous devons également initialiser tous les middlewares (le bodyParser étant le plus important). </li><li>  Après cela, nous appelons <code>SET_EXPRESS_APP</code> pour définir l'objet d'application globalement.  De cette façon, mgr-swagger-express pourra attacher des gestionnaires aux points de terminaison </li><li>  Ce n'est qu'après cela que nous pouvons importer le service avec des annotations.  Il n'est pas nécessaire que ce soit une classe, il peut s'agir uniquement de fonctions. </li><li>  Ensuite, nous créons une instance de notre service (ou appelons une fonction init en cas de non utilisation des classes) </li><li>  Et nous générons la configuration swagger sur la base de toutes les annotations que nous avons dans le projet et l'attachons à notre application à l'aide du package swagger-ui-express </li></ul><br><p>  À l'intérieur du service, il se passe plusieurs choses, mais arrêtons-en quelques-unes seulement.  Tout ce que vous pouvez facilement trouver dans le dépôt mgr-swagger-express: </p><br><ul><li>  Dans le constructeur, nous appelons la fonction <code>addSwaggerDefinition</code> .  Il enregistre un modèle swagger avec un nom donné.  dans notre cas, nous définissons <code>BookDefinition</code> sous un nom de livre afin de le référencer ensuite par <code>#/definitions/Book</code> </li><li>  Tous les gestionnaires sont annotés avec les commandes <code>@GET @POST @PUT @DELETE</code> .  Tous prennent en arguments un objet de type <code>SwaggerEndpoint</code> : <br><pre> <code class="plaintext hljs">path: string; auth?: string; description?: string; tags?: string[]; parameters?: SwaggerURLParameter[]; query?: SwaggerQueryParameter; body?: SwaggerBodyParameter; success?: SwaggerSuccessResponse;</code> </pre> <br><p>  Il s'agit essentiellement de l'objet de définition de point de terminaison classique, rien de spécial, sauf pour le champ auth, mais j'y reviendrai à l'avenir </p><br>  Tous les gestionnaires doivent avoir la signature suivante: <br><pre> <code class="plaintext hljs">(args: object, context: Context) =&gt; Promise&lt;any&gt;</code> </pre> <br><p>  L'objet args contient tous les paramètres acheminés vers votre point de terminaison.  Il peut s'agir de paramètres URL (comme <code>book_id</code> dans notre exemple), de paramètres de requête ou même d'une valeur corporelle. </p><br><br><p>  L'objet de contexte est utilisé pour gérer l'authentification et la sécurité, mais encore une fois, à ce sujet plus tard. </p><br><h1 id="conclusion">  Conclusion </h1><br><p>  Nous avons maintenant une API CRUD express simple annotée avec Swagger et une belle interface utilisateur Swagger, où toutes les définitions Swagger se trouvent à proximité de l'implémentation du point de terminaison.  Comme d'habitude - toujours heureux d'avoir des commentaires!  ️ </p></li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr479230/">https://habr.com/ru/post/fr479230/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr479216/index.html">Pandora DXL 3000 Second Wind ou comment j'ai vissé ma propre télémétrie</a></li>
<li><a href="../fr479218/index.html">Comment faire un bot qui transforme une photo en bande dessinée: instructions étape par étape pour les nuls</a></li>
<li><a href="../fr479220/index.html">Nano-neurone - 7 fonctions JavaScript simples montrant comment la machine peut "apprendre"</a></li>
<li><a href="../fr479222/index.html">Le condensé de matériaux intéressants pour le développeur mobile # 325 (du 2 au 8 décembre)</a></li>
<li><a href="../fr479226/index.html">Habr-analysis: ce que les utilisateurs commandent en cadeau à Habr</a></li>
<li><a href="../fr479232/index.html">Développement d'applications MQ JMS sur Spring Boot</a></li>
<li><a href="../fr479234/index.html">Nouvelles du monde d'OpenStreetMap n ° 488 (19/11/2019 - 25/11/2019)</a></li>
<li><a href="../fr479236/index.html">Kivy. Créez des packages pour Android et pas de magie</a></li>
<li><a href="../fr479238/index.html">La programmation fonctionnelle n'est pas ce qu'on nous dit</a></li>
<li><a href="../fr479240/index.html">Le code dans lequel nous vivons</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>