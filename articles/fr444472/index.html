<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôèüèæ ü§¶üèª üñïüèæ √âmulation de services Web Amazon dans un processus JVM. √âviter Roskomnadzor et acc√©l√©rer le d√©veloppement et les tests ‚è™ üòê üí≤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pourquoi pourriez-vous avoir besoin d'√©muler l'infrastructure de services Web Amazon? 

 Tout d'abord, c'est une √©conomie - un gain de temps pour le d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>√âmulation de services Web Amazon dans un processus JVM. √âviter Roskomnadzor et acc√©l√©rer le d√©veloppement et les tests</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444472/"> Pourquoi pourriez-vous avoir besoin d'√©muler l'infrastructure de services Web Amazon? <br><br>  Tout d'abord, c'est une √©conomie - un gain de temps pour le d√©veloppement et le d√©bogage, et ce qui est tout aussi important - une √©conomie sur le budget du projet.  Il est clair que l'√©mulateur ne sera pas 100% identique √† l'environnement d'origine que nous essayons d'√©muler.  Mais dans le but d'acc√©l√©rer le d√©veloppement et l'automatisation du processus, les similitudes existantes devraient suffire.  La chose la plus d'actualit√© qui s'est produite en 2018 avec AWS a √©t√© le blocage par les fournisseurs IP des adresses IP des sous-r√©seaux AWS dans la F√©d√©ration de Russie.  Et ces verrous ont affect√© notre infrastructure situ√©e dans le cloud Amazon.  Si vous pr√©voyez d'utiliser la technologie AWS et de placer le projet dans ce cloud, le d√©veloppement et les tests d'√©mulation sont plus que payants. <br><br><img src="https://habrastorage.org/webt/jz/ty/k7/jztyk798xcq9yqietemgy-6133m.png"><br><br>  Dans la publication, je vais vous expliquer comment nous avons r√©ussi √† r√©aliser une telle astuce avec les services S3, SQS, RDS PostgreSQL et Redshift lors de la migration d'un entrep√¥t de donn√©es existant vers AWS pendant de nombreuses ann√©es. <br><a name="habracut"></a><br>  Ceci n'est qu'une partie de ma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©union de</a> l'ann√©e derni√®re sur la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">carte</a> , qui correspond aux th√®mes des hubs AWS et Java.  La deuxi√®me partie concerne les bases de donn√©es PostgreSQL, Redshift et colonnes, et sa version texte peut √™tre publi√©e dans les hubs correspondants, les vid√©os et les diapositives sont sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le site Web de la conf√©rence</a> . <br><br>  Lors du d√©veloppement d'une application pour AWS lors du blocage des sous-r√©seaux AWS, l'√©quipe ne les a pratiquement pas remarqu√©s dans le processus quotidien de d√©veloppement de nouvelles fonctionnalit√©s.  Les tests ont √©galement fonctionn√© et vous pouvez d√©boguer l'application.  Et ce n'est qu'en essayant de consulter les journaux d'application dans les entr√©es de journal, les mesures dans SignalFX ou l'analyse des donn√©es dans Redshift / PostgreSQL RDS ont √©t√© d√©√ßues - les services n'√©taient pas disponibles via le r√©seau du fournisseur russe.  L'√©mulation AWS nous a aid√©s √† ne pas le remarquer et √† √©viter des retards beaucoup plus importants lorsque vous travaillez avec le cloud Amazon via un r√©seau VPN. <br><br>  Chaque fournisseur de cloud ¬´sous le capot¬ª a beaucoup de dragons et vous ne devez pas c√©der √† la publicit√©.  Vous devez comprendre pourquoi tout cela est n√©cessaire pour le fournisseur de services.  Bien s√ªr, l'infrastructure existante d'Amazon, Microsoft et Google pr√©sente des avantages.  Et quand ils vous disent que tout n'est fait que pour vous faciliter le d√©veloppement, ils essaient tr√®s probablement de vous mettre sur votre aiguille et de donner la premi√®re dose gratuitement.  Pour que plus tard, ils ne sortent pas de l'infrastructure et de la technologie sp√©cifique.  Par cons√©quent, nous essaierons d'√©viter le blocage des fournisseurs.  Il est clair qu'il n'est pas toujours possible de s'abstraire compl√®tement de d√©cisions sp√©cifiques et je pense que tr√®s souvent il est possible d'abstraire pr√®s de 90% dans un projet.  Mais les 10% restants du projet, li√©s √† un fournisseur de technologies tr√®s importantes, consistent soit √† optimiser les performances des applications, soit √† proposer des fonctionnalit√©s uniques nulle part ailleurs.  Ils doivent toujours se souvenir des avantages et des inconv√©nients des technologies et se prot√©ger autant que possible, ne pas "s'asseoir" sur une API sp√©cifique d'un fournisseur d'infrastructure cloud. <br><br>  Amazon √©crit sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">traitement des messages</a> sur son site Web.  L'essence et l'abstraction des technologies d'√©change de messages sont les m√™mes partout, bien qu'il y ait des nuances - le message passant par des files d'attente ou par des sujets.  Ainsi, AWS recommande d'utiliser l'Apache ActiveMQ fourni et g√©r√© par eux pour migrer les applications √† partir d'un courtier de messagerie existant et pour les nouvelles applications Amazon SQS / SNS.  Ceci est un exemple de liaison √† leur propre API, au lieu de l'API JMS standardis√©e et des protocoles AMQP, MMQT, STOMP.  Il est clair que ce fournisseur avec sa solution peut avoir des performances plus √©lev√©es, il prend en charge l'√©volutivit√©, etc.  De mon point de vue, si vous utilisez leurs biblioth√®ques et non des API standardis√©es, il y aura beaucoup plus de probl√®mes. <br><br>  AWS poss√®de une base de donn√©es Redshift.  Il s'agit d'une base de donn√©es distribu√©e avec une architecture parall√®le massive.  Vous pouvez t√©l√©charger une grande quantit√© de vos donn√©es dans des tableaux sur plusieurs sites Redshft sur Amazon et effectuer des requ√™tes analytiques sur de grands ensembles de donn√©es.  Ce n'est pas un syst√®me OLTP o√π il est important pour vous d'effectuer de petites requ√™tes sur un petit nombre d'enregistrements assez souvent avec des garanties ACID.  Lorsque vous travaillez avec Redshift, il est suppos√© que vous n'avez pas un grand nombre de requ√™tes par unit√© de temps, mais ils peuvent lire des agr√©gats sur une tr√®s grande quantit√© de donn√©es.  Ce syst√®me est positionn√© par le fournisseur pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mettre</a> √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">niveau votre</a> entrep√¥t de donn√©es (entrep√¥t) sur AWS et promettre un chargement de donn√©es simple.  Ce qui n'est pas du tout vrai. <br><br>  Un extrait de la documentation sur les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">types pris en charge par</a> Amazon Redshift.  C'est un ensemble plut√¥t maigre, et si vous avez besoin de quelque chose pour stocker et traiter des donn√©es qui ne sont pas r√©pertori√©es ici, il vous sera difficile de travailler.  Par exemple, un GUID. <br><br>  Question de la salle, "Et JSON?" <br><br>  - JSON ne peut √™tre √©crit qu'en VARCHAR et il existe plusieurs fonctions pour travailler avec JSON. <br>  Commentaire du public: "Postgres a un support JSON normal." <br><br>  - Oui, il prend en charge ce type de donn√©es et de fonctions.  Mais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Redshift est bas√©</a> sur PostgreSQL 8.0.2.  Il y avait un projet ParAccel, si je ne me trompe pas, cette technologie de 2005 est un fork de postgres qui a un ordonnanceur pour les requ√™tes distribu√©es bas√©es sur une architecture massivement parall√®le.  5-6 ans se sont √©coul√©s et ce projet a √©t√© autoris√© pour la plate-forme Amazon Web Servces et nomm√© Redshift.  Quelque chose a √©t√© supprim√© des Postgres d'origine, beaucoup a √©t√© ajout√©.  Ils ont ajout√© que li√©s √† l'authentification / autorisation dans AWS, avec les r√¥les, la s√©curit√© dans Amazon fonctionne bien.  Mais si vous devez, par exemple, vous connecter de Redshift √† une autre base de donn√©es √† l'aide d'une source de donn√©es √©trang√®re, vous ne le trouverez pas.  Il n'y a pas de fonctions pour travailler avec XML, des fonctions pour travailler avec JSON deux fois et mal calcul√©es. <br><br>  Lors du d√©veloppement d'une application, essayez de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ne pas d√©pendre d'impl√©mentations sp√©cifiques</a> et le code d'application ne d√©pend que des abstractions.  Vous pouvez cr√©er ces fa√ßades et abstractions vous-m√™me, mais dans ce cas, il existe de nombreuses biblioth√®ques pr√™tes √† l'emploi - des fa√ßades.  Qui soustraient le code √† des impl√©mentations sp√©cifiques, √† des cadres sp√©cifiques. Il est clair qu'elles ne prennent pas en charge toutes les fonctionnalit√©s en tant que ¬´d√©nominateur commun¬ª des technologies.  Il est pr√©f√©rable de d√©velopper des logiciels reposant sur des abstractions pour simplifier les tests. <br><br>  Pour √©muler AWS, je mentionnerai deux options.  Le premier est plus honn√™te et correct, mais il fonctionne plus lentement.  Le second est sale et rapide.  Je vais vous parler de l'option de piratage - nous essayons de cr√©er toute l'infrastructure en un seul processus - les tests et l'option multiplateforme fonctionneront plus rapidement avec le travail sous Windows (o√π Docker n'est pas toujours en mesure de gagner de l'argent avec vous). <br><br>  La premi√®re m√©thode est parfaite si vous d√©veloppez sur linux / macos et que vous avez un docker, il serait pr√©f√©rable d'utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">atlassian localstack</a> .  Il est pratique d'utiliser des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">conteneurs</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">test</a> pour int√©grer localstack dans la JVM. <br><br>  Ce qui m'a emp√™ch√© d'utiliser lockalstack dans docker sur le projet, c'est que le d√©veloppement √©tait sous Windows et que personne ne garantissait la version alpha de docker lorsque ce projet a d√©marr√© ... Il est √©galement possible qu'ils ne soient pas autoris√©s √† installer une machine virtuelle avec linux et docker dans toute entreprise s√©rieuse √† propos de √† la s√©curit√© de l'information.  Je ne parle pas de travailler dans un environnement s√©curis√© dans les banques d'investissement et d'interdire presque tous les pare-feu de circulation l√†-bas. <br><br>  Examinons les options pour √©muler le stockage simple S3.  Ce n'est pas un syst√®me de fichiers Amazon ordinaire, mais plut√¥t un magasin d'objets distribu√©s.  Dans lequel vous mettez vos donn√©es en BLOB, sans possibilit√© de modification et d'ajout de donn√©es.  Il existe des stockages distribu√©s √† part enti√®re similaires d'autres fabricants.  Par exemple, le stockage d'objets distribu√©s Ceph vous permet de travailler avec ses fonctionnalit√©s en utilisant le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">protocole S3 REST</a> et le client existant avec un minimum de modifications.  Mais c'est une solution plut√¥t lourde pour le d√©veloppement et le test d'applications Java. <br><br>  Un projet plus rapide et plus adapt√© est la biblioth√®que java <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">s3proxy</a> .  Il √©mule le protocole S3 REST et le traduit en appels API <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">jcloud</a> correspondants et vous permet d'utiliser de nombreuses impl√©mentations pour une lecture et un stockage r√©els des donn√©es.  Il peut diffuser des appels vers l'API Google App Engine, l'API Microsoft Azure, mais pour les tests, il est plus pratique d'utiliser le stockage transitoire jcloud dans la RAM.  Il est √©galement n√©cessaire de configurer la version du protocole d'authentification AWS S3 et de sp√©cifier la cl√© et les valeurs secr√®tes, de configurer √©galement le point de terminaison - le port et l'interface sur lesquels ce proxy S3 √©coutera.  Par cons√©quent, votre code utilisant le client AWS SDK doit √™tre connect√© lors des tests au point de terminaison S3 AWS, et non √† la r√©gion AWS.  Encore une fois, n'oubliez pas que s3proxy ne prend pas en charge toutes les fonctionnalit√©s de l'API S3, mais tous nos sc√©narios d'utilisation √©mulent parfaitement!  M√™me le t√©l√©chargement en plusieurs parties pour les fichiers volumineux est pris en charge par s3proxy. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a85/65d/9ce/a8565d9ceabaa944dfc993c88e00d738.png"></div><br><br>  Amazon Simple Queue Service est un service de mise en file d'attente.  Il existe un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">service de</a> file d'attente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©lastiquemq</a> √©crit en scala et il peut √™tre pr√©sent√© √† votre application √† l'aide du protocole Amazon SQS.  Je ne l'ai pas utilis√© dans le projet, je vais donc donner le code d'initialisation, en faisant confiance aux informations de ses d√©veloppeurs. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7eb/11d/adf/7eb11dadfac303746ecc755fccee6384.png"></div><br><br>  Dans le projet, je suis all√© dans l'autre sens et le code d√©pend des abstractions spring-jms de JmsTemplate et JmsListener et les d√©pendances du projet sp√©cifient le pilote JMS pour SQS com.amazonaws: amazon-sqs-java-messaging-lib.  C'est ce qui concerne le code d'application principal. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/08d/3ca/64b/08d3ca64b9c7f355cc3661ce692768ae.png"></div><br><br>  Dans les tests, nous connectons Artemis-jms-server en tant que serveur JMS int√©gr√© pour les tests, et dans le contexte de test Spring, au lieu de la fabrique de connexions SQS, nous utilisons la fabrique de connexions Artemis.  Artemis est la prochaine version d'Apache ActiveMQ, un middleware orient√© message moderne et complet - pas seulement une solution de test.  Peut-√™tre que nous passerons √† son utilisation √† l'avenir, pas seulement dans les autotests.  Ainsi, en utilisant les abstractions JMS conjointement avec Spring, nous avons simplifi√© √† la fois le code de l'application et la possibilit√© de le tester facilement.  Il vous suffit d'ajouter les d√©pendances org.springframework.boot: spring-boot-starter-artemis et org.apache.activemq: artemis-jms-server. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/245/a8f/d3c/245a8fd3c8cb56a4b6fa460018d48f94.png"></div><br><br>  Dans certains tests, PostgreSQL peut √™tre √©mul√© en le rempla√ßant par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">H2Database</a> .  Cela fonctionnera si les tests ne sont pas accept√©s et n'utilisent pas de fonctions PG sp√©cifiques.  Dans le m√™me temps, H2 peut √©muler un sous-ensemble du protocole de connexion PostgreSQL sans prise en charge des types de donn√©es et des fonctions.  Dans notre projet, nous utilisons Foreing Data Wrapper, donc cette m√©thode ne fonctionne pas pour nous. <br><br>  Vous pouvez ex√©cuter de vrais PostgreSQL.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">postgresql-embedded</a> t√©l√©charge la vraie distribution, ou plut√¥t l'archive avec des fichiers binaires pour la plate-forme avec laquelle nous fonctionnons, la d√©compresse.  Sous linux sur tempfs en RAM, sous windows dans% TEMP%, le processus serveur postgresql d√©marre, configure les param√®tres du serveur et les param√®tres de la base de donn√©es.  En raison des fonctionnalit√©s de distribution de distribution, les versions ant√©rieures √† PG 11 ne fonctionnent pas sous Linux.  Pour ma part, j'ai cr√©√© une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">biblioth√®que wrapper</a> qui vous permet d'obtenir des assemblages binaires PostgreSQL non seulement √† partir d'un serveur HTTP mais √©galement √† partir du r√©f√©rentiel maven.  Ce qui peut √™tre tr√®s utile lorsque vous travaillez dans des r√©seaux isol√©s et que vous construisez sur un serveur CI sans acc√®s √† Internet.  Une autre commodit√© de travailler avec mon wrapper est l'annotation du composant CDI, ce qui facilite l'utilisation du composant dans le contexte Spring par exemple.  L'impl√©mentation de l'interface du serveur AutoClosable est apparue plus t√¥t que dans le projet d'origine.  Pas besoin de vous souvenir d'arr√™ter le serveur, il s'arr√™tera lorsque le contexte Spring se fermera automatiquement. <br><br>  Au d√©marrage, vous pouvez cr√©er une base de donn√©es bas√©e sur des scripts, compl√©tant le contexte Spring avec les propri√©t√©s appropri√©es.  Nous cr√©ons maintenant un sch√©ma de base de donn√©es √† l'aide de scripts de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">voie</a> de migration pour migrer le sch√©ma de base de donn√©es, qui sont lanc√©s chaque fois que la base de donn√©es est cr√©√©e dans des tests. <br><br>  Pour v√©rifier les donn√©es apr√®s l'ex√©cution des tests, nous utilisons la biblioth√®que spring-test-dbunit.  Dans les annotations aux m√©thodes de test, nous indiquons avec quels chargements pour comparer l'√©tat de la base de donn√©es.  Cela √©limine le besoin d'√©crire du code pour fonctionner avec dbunit, il vous suffit d'ajouter le programme d'√©coute de la biblioth√®que au code de test.  Vous pouvez sp√©cifier dans quel ordre les donn√©es des tables sont supprim√©es une fois la m√©thode de test termin√©e, si le contexte de la base de donn√©es est r√©utilis√© entre les tests.  En 2019, il existe une approche plus moderne mise en ≈ìuvre dans Database-Rider qui fonctionne avec Junit5.  Vous pouvez voir un exemple d'utilisation, par exemple <a href="">ici</a> . <br><br>  La chose la plus difficile a √©t√© d'√©muler Amazon Redshift.  Il existe un projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">redshift-fake-driver</a> qui se concentre sur l'√©mulation du chargement de donn√©es par lots dans la base de donn√©es analytiques √† partir d'AWS.  Dans l'√©mulateur de protocole jdbc: postgresqlredshift, les commandes COPY, UNLOAD sont impl√©ment√©es, toutes les autres commandes sont d√©l√©gu√©es au pilote JDBC PostgreSQL standard. <br><br>  Par cons√©quent, les tests ne fonctionneront pas de la m√™me mani√®re que dans Redshift, l'op√©ration de mise √† jour, qui utilise une autre table comme source de donn√©es pour la mise √† jour (la syntaxe diff√®re dans Redshift et PostgreSQL 9+. J'ai √©galement remarqu√© une interpr√©tation diff√©rente de la citation de ligne dans les commandes SQL entre ces bases de donn√©es. <br><br>  En raison de l'architecture d'une v√©ritable base de donn√©es Redshift, les op√©rations d'insertion, de mise √† jour et de suppression de donn√©es sont plut√¥t lentes et ¬´co√ªteuses¬ª en termes d'E / S.  Il est possible d'ins√©rer des donn√©es avec des performances acceptables uniquement dans de grands "paquets" et la commande COPY vous permet simplement de t√©l√©charger des donn√©es √† partir d'un syst√®me de fichiers S3 distribu√©.  Cette commande dans la base de donn√©es prend en charge plusieurs formats de donn√©es AVRO, CSV, JSON, Parquet, ORC et TXT.  Et le projet d'√©mulation se concentre sur CSV, TXT, JSON. <br><br>  Ainsi, pour √©muler Redshift dans les tests, vous devrez d√©marrer la base de donn√©es PostgreSQL comme d√©crit pr√©c√©demment et d√©marrer l'√©mulation du r√©f√©rentiel S3, et lors de la cr√©ation d'une connexion au postgres, il vous suffit d'ajouter redshift-fake-driver dans le chemin de classe et de sp√©cifier la classe de pilote jp.ne.opt.redshiftfake.postgres. FakePostgresqlDriver.  Apr√®s cela, vous pouvez utiliser la m√™me voie de migration pour migrer le sch√©ma de base de donn√©es, et dbunit est d√©j√† familier pour comparer les donn√©es apr√®s avoir ex√©cut√© les tests. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/17e/d0b/20a/17ed0b20a1e7bb4f4205747122a22a70.png"></div><br><br>  Je me demande combien de lecteurs utilisent AWS et Redshift dans leur travail?  √âcrivez dans les commentaires sur votre exp√©rience. <br><br>  En utilisant uniquement des projets Open Source, l'√©quipe a pu acc√©l√©rer le d√©veloppement dans l'environnement AWS, √©conomiser de l'argent sur le budget du projet et ne pas emp√™cher l'√©quipe de travailler lorsque les sous-r√©seaux AWS √©taient bloqu√©s par Roskomnadzor. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr444472/">https://habr.com/ru/post/fr444472/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr444462/index.html">Test du Samsung Galaxy S10 - Quand les smartphones rattraperont-ils les cam√©ras?</a></li>
<li><a href="../fr444464/index.html">Une autre fa√ßon de tirer sur votre jambe en utilisant std :: thread</a></li>
<li><a href="../fr444466/index.html">D√©sol√©, toutes vos bases de donn√©es appartiennent √† Google. Pr√©sentation de Google √† la Game Development Conference 2019, Stadia Project</a></li>
<li><a href="../fr444468/index.html">Nvidia Neural Network transforme des croquis simples en beaux paysages</a></li>
<li><a href="../fr444470/index.html">20 habitudes pour l'hygi√®ne de l'attention: comment utiliser la technologie, mais ne pas les laisser prendre leur temps et leur attention</a></li>
<li><a href="../fr444474/index.html">Construction de la ligne de communication Sakhalin-Kuril. Tour Segero - T√©l√©ph√©rique</a></li>
<li><a href="../fr444476/index.html">Concours de RUSNANO: suivez un cours en ligne sur la micro√©lectronique moderne, puis une visite pratique avec des FPGA, obtenez un prix</a></li>
<li><a href="../fr444480/index.html">Comment r√©duire d'un tiers le poids d'un √©l√©ment structurel d'avion</a></li>
<li><a href="../fr444482/index.html">Qu'est-ce qui gonfle la m√©moire dans Ruby?</a></li>
<li><a href="../fr444484/index.html">Estimation des conditions de d√©veloppement et de test des t√¢ches (non n√©cessaire)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>