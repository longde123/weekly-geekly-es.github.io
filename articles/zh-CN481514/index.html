<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏟️ 🌩️ 👓 使用真实示例使用Newtonsoft.Json库。 第一部分 🚶🏽 🧑🏾‍🤝‍🧑🏾 ➗</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="如果您正在阅读本文，那么您很可能已经知道JSON是什么，并且您熟悉下面的图片。 但是无论如何，我建议您访问此页面（如果您以前从未到过此页面） ，并且在阅读之前，建议您熟悉一下在C＃中使用JSON表示法的一般原理，例如， 在此链接 。 



 我想指出的是，本说明并不伪装成对该主题的任何完整披露。 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>使用真实示例使用Newtonsoft.Json库。 第一部分</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481514/"> 如果您正在阅读本文，那么您很可能已经知道JSON是什么，并且您熟悉下面的图片。 但是无论如何，我建议您访问此<a href="https://www.json.org/json-ru" rel="nofollow">页面（</a>如果您以前从未到过此<a href="https://www.json.org/json-ru" rel="nofollow">页面）</a> ，并且在阅读之前，建议您熟悉一下在C＃中使用JSON表示法的一般原理，例如， <a href="https://habr.com/ru/post/176087/">在此链接</a> 。 <br><br><img src="https://habrastorage.org/webt/3l/5k/h7/3l5kh7oqau8g7rjl5_urm3bcv-u.png"><br><a name="habracut"></a><br>  <i>我想指出的是，本说明并不伪装成对该主题的任何完整披露。</i>  <i>本文的目的是构造和保留我在使用Newtonsoft.Json库时使用的那些开发。</i> <br><br><h3> 问题陈述 </h3><br> 总的来说，在本文的框架内，如何获取原始数据进行解析并不是很重要，但是，这种解释肯定会促进对材料的理解。 因此，主要任务是实现<a href="https://exmo.me/ru/api" rel="nofollow">EXMO cryptoexchange</a> API的功能。 为简单起见，我们将主要使用公共接口（Public API）。 在这种情况下，信息请求将看起来像站点的常规页面地址。 要发送请求，请使用System.Net.Http命名空间的HttpClient类： <br><br><pre><code class="cs hljs">HttpClient httpClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpClient(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> request = <span class="hljs-string"><span class="hljs-string">"https://api.exmo.com/v1/trades/?pair=BTC_USD"</span></span>; HttpResponseMessage response = (<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> httpClient.GetAsync(request)).EnsureSuccessStatusCode(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> responseBody = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> response.Content.ReadAsStringAsync();</code> </pre> <br> 通过单击链接<a href="https://api.exmo.com/v1/trades/%3Fpair%3DBTC_USD" rel="nofollow">https://api.exmo.com/v1/trades/?pair=BTC_USD</a>可以查看该程序的结果。 如果将这些数据加载到<a href="http://json2csharp.com/" rel="nofollow">JSON C＃Class Generator中</a> ，将为反序列化提供以下类结构： <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BTCUSD</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> trade_id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> type { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> quantity { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> price { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> amount { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> date { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RootObject</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;BTCUSD&gt; BTC_USD { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br> 应该注意的是，加密交换“交易”功能本身允许您一次请求有关多个货币对的信息。 并且在要求的情况下 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span> request = <span class="hljs-string"><span class="hljs-string">"https://api.exmo.com/v1/trades/?pair=BTC_USD,ETH_USD"</span></span>;</code> </pre> <br> 类的结构已经看起来像这样： <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BTCUSD</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> trade_id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> type { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> quantity { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> price { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> amount { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> date { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ETHUSD</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> trade_id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> type { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> quantity { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> price { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> amount { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> date { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RootObject</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;BTCUSD&gt; BTC_USD { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;ETHUSD&gt; ETH_USD { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br> 显然，您无法为每种货币对组合准备课程，这意味着您需要以某种方式摆脱困境。 <br><br><div class="spoiler">  <b class="spoiler_title">不必这样做。</b> <div class="spoiler_text">  <i>令人惊讶的是，几乎不可能在俄语互联网上找到有关使用JSON表示法的优秀文章。</i>  <i>结果，可以在GitHub上找到的那些EXMO API实现以某种方式包含使用split，trim等等对原始数据结构的操作。</i> <i><br><br></i>  <i>我必须承认，我还首先发明了自行车并自行实现了解析。</i>  <i>尽管代码绝对有效，但这是您无法执行此操作的一个很好的示例。</i> <i><br></i> <br><br><pre> <code class="cs hljs">LinkedList&lt;OrderInform&gt; loi = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinkedList&lt;OrderInform&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] json = answer.Split(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] { <span class="hljs-string"><span class="hljs-string">'{'</span></span>, <span class="hljs-string"><span class="hljs-string">'}'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> json) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item.Length &gt; <span class="hljs-number"><span class="hljs-number">20</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] trade = item.Split(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] { <span class="hljs-string"><span class="hljs-string">','</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (trade.Length &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> t_id = trade[<span class="hljs-number"><span class="hljs-number">0</span></span>].Split(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] { <span class="hljs-string"><span class="hljs-string">':'</span></span> })[<span class="hljs-number"><span class="hljs-number">1</span></span>].Trim(<span class="hljs-string"><span class="hljs-string">'"'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> t_type = trade[<span class="hljs-number"><span class="hljs-number">1</span></span>].Split(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] { <span class="hljs-string"><span class="hljs-string">':'</span></span> })[<span class="hljs-number"><span class="hljs-number">1</span></span>].Trim(<span class="hljs-string"><span class="hljs-string">'"'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> t_quantity = trade[<span class="hljs-number"><span class="hljs-number">2</span></span>].Split(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] { <span class="hljs-string"><span class="hljs-string">':'</span></span> })[<span class="hljs-number"><span class="hljs-number">1</span></span>].Trim(<span class="hljs-string"><span class="hljs-string">'"'</span></span>) .Replace(<span class="hljs-string"><span class="hljs-string">"."</span></span>, <span class="hljs-string"><span class="hljs-string">","</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> t_price = trade[<span class="hljs-number"><span class="hljs-number">3</span></span>].Split(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] { <span class="hljs-string"><span class="hljs-string">':'</span></span> })[<span class="hljs-number"><span class="hljs-number">1</span></span>].Trim(<span class="hljs-string"><span class="hljs-string">'"'</span></span>) .Replace(<span class="hljs-string"><span class="hljs-string">"."</span></span>, <span class="hljs-string"><span class="hljs-string">","</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> t_amount = trade[<span class="hljs-number"><span class="hljs-number">4</span></span>].Split(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] { <span class="hljs-string"><span class="hljs-string">':'</span></span> })[<span class="hljs-number"><span class="hljs-number">1</span></span>].Trim(<span class="hljs-string"><span class="hljs-string">'"'</span></span>) .Replace(<span class="hljs-string"><span class="hljs-string">"."</span></span>, <span class="hljs-string"><span class="hljs-string">","</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> t_date_time = trade[<span class="hljs-number"><span class="hljs-number">5</span></span>].Split(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] { <span class="hljs-string"><span class="hljs-string">':'</span></span> })[<span class="hljs-number"><span class="hljs-number">1</span></span>].Trim(<span class="hljs-string"><span class="hljs-string">'"'</span></span>); loi.AddLast(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OrderInform(pair, Convert.ToInt32(t_id), t_type, Convert.ToDouble(t_quantity), Convert.ToDouble(t_price), Convert.ToDouble(t_amount), (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DateTime(<span class="hljs-number"><span class="hljs-number">1970</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)) .AddSeconds(Convert.ToInt32(t_date_time)))); } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loi; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinkedList&lt;OrderInform&gt;(); }</code> </pre><br></div></div><br><h3>  JSON对象（JObject类） </h3><br>  JSON对象是键/值对的无序集合。 对象以“ {”（大括号的开头）开始，以“}”（大括号的结尾）结束。 每个名称后跟：（冒号），键/值对之间用逗号分隔。 <br><br><img src="https://habrastorage.org/webt/da/54/jt/da54jturpeyqcunhm3mtzqb3me0.png"><br><br> 从JSON C＃类生成器先前向我们提出的结构中，我们看到，对于每个货币对，我们都有6个常量字段。 将它们包装在单独的类中，并将其命名为Order。 <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Order</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> trade_id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> type { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> quantity { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> price { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> amount { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> date { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br> 为了能够从交换的动态变化的数据结构中“抓住”这些字段的集合，您需要更详细地了解newtosoft.json库中可用的数据类型。 更具体地说，在newtonsoft.json.linq命名空间中。 <br><br><div class="spoiler">  <b class="spoiler_title">要使用该库，必须先安装它。</b> <div class="spoiler_text"> 要在Visual Studio中安装该库，您只需搜索NuGet。 <br> 在解决方案资源管理器中右键单击解决方案，然后选择“管理解决方案的NuGet软件包...”（管理解决方案的NuGet软件包...“）。 <br><br><img src="https://habrastorage.org/webt/0i/0m/kk/0i0mkki2vmtt_oivt5myv-dcspy.png"><br><br> 接下来，单击“浏览”，然后在搜索栏中输入newtosoft.json。 我们在解决方案前打勾，然后单击“安装”（“安装”）。 <br><br><img src="https://habrastorage.org/webt/zd/jy/h8/zdjyh8s08qxpvgjfmy6okdibx_i.png"><br></div></div><br> 安装库之后，newtosoft.json.linq命名空间可用于连接到项目： <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Newtonsoft.Json.Linq;</code> </pre><br>  Newtosoft.json.linq使用抽象的<a href="https://www.newtonsoft.com/JSON/help/html/T_Newtonsoft_Json_Linq_JToken.htm" rel="nofollow">JToken</a>类表示数据，从中<a href="https://www.newtonsoft.com/JSON/help/html/T_Newtonsoft_Json_Linq_JValue.htm" rel="nofollow">继承JValue</a> （表示简单值）和<a href="https://www.newtonsoft.com/JSON/help/html/T_Newtonsoft_Json_Linq_JContainer.htm" rel="nofollow">JContainer</a> （表示结构）类。 反过来，结构可以是<a href="https://www.newtonsoft.com/JSON/help/html/T_Newtonsoft_Json_Linq_JArray.htm" rel="nofollow">JArray</a> （数组）， <a href="https://www.newtonsoft.com/JSON/help/html/T_Newtonsoft_Json_Linq_JConstructor.htm" rel="nofollow">JConstructor</a> （构造函数）， <a href="https://www.newtonsoft.com/JSON/help/html/T_Newtonsoft_Json_Linq_JObject.htm" rel="nofollow">JObject</a> （对象）或<a href="https://www.newtonsoft.com/JSON/help/html/T_Newtonsoft_Json_Linq_JProperty.htm" rel="nofollow">JProperty</a> （属性）。 <br><br>  JArray和JObject类具有Parse方法，该方法使您可以将JSON数据从常规字符串转换为相应的对象。 因此，如果我们对Exmo trades函数的数据结构使用JObject.Parse（String）方法： <br><br><pre> <code class="cs hljs">HttpClient httpClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpClient(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> request = <span class="hljs-string"><span class="hljs-string">"https://api.exmo.com/v1/trades/?pair=BTC_USD,ETH_USD"</span></span>; HttpResponseMessage response = (<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> httpClient.GetAsync(request)).EnsureSuccessStatusCode(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> responseBody = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> response.Content.ReadAsStringAsync(); JObject jObject = JObject.Parse(responseBody);</code> </pre><br> 我们将看到两个元素的结构，每个元素代表一个键值对。 在这种情况下，键将是货币对的名称（字符串类型），值将是交易清单（JToken类型）： <br><br><img src="https://habrastorage.org/webt/mk/04/n0/mk04n0hdvp_2j4lbrxqvtashli0.png"><br><br> 现在，可以通过键“ BTC_USD”和“ USD_ETH”使用交易列表。 例如，使用货币对“ BTC_USD”进行的交易： <br><br><img src="https://habrastorage.org/webt/hc/r0/kv/hcr0kvnne7stglzzqjtu6rryzm0.png"><br><br> 然后，我们只需要将数据转换为便于工作的类型，例如 <oembed> 清单&lt;订单&gt; </oembed> 使用ToObject &lt;&gt;（）方法： <br><br><pre> <code class="cs hljs">HttpClient httpClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpClient(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> request = <span class="hljs-string"><span class="hljs-string">"https://api.exmo.com/v1/trades/?pair=BTC_USD,ETH_USD"</span></span>; HttpResponseMessage response = (<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> httpClient.GetAsync(request)).EnsureSuccessStatusCode(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> responseBody = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> response.Content.ReadAsStringAsync(); JObject jObject = JObject.Parse(responseBody); JToken list = jObject[<span class="hljs-string"><span class="hljs-string">"BTC_USD"</span></span>]; List&lt;Order&gt; trades = list.ToObject&lt;List&lt;Order&gt;&gt;();</code> </pre><br> 要么将整个结构转换为类型 <oembed> 字典&lt;string，列表&lt;Order &gt;&gt; </oembed>  ： <br><br><pre> <code class="cs hljs">HttpClient httpClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpClient(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> request = <span class="hljs-string"><span class="hljs-string">"https://api.exmo.com/v1/trades/?pair=BTC_USD,ETH_USD"</span></span>; HttpResponseMessage response = (<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> httpClient.GetAsync(request)).EnsureSuccessStatusCode(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> responseBody = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> response.Content.ReadAsStringAsync(); JObject jObject = JObject.Parse(responseBody); Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, List&lt;Order&gt;&gt; trades = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, List&lt;Order&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (KeyValuePair&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, JToken&gt; obj <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> jObject) trades.Add(obj.Key, obj.Value.ToObject&lt;List&lt;Order&gt;&gt;());</code> </pre><br><h3>  JSON数组（JArray类） </h3><br>  JSON数组是值的有序集合。 数组以“ [”（方括号）开始，以“]”（方括号）结束。 值用逗号分隔。 <br><br> 通过点击链接<a href="https://api.exmo.com/v1/currency" rel="nofollow">https://api.exmo.com/v1/currency</a>可以看到JSON数组的样子。 如果您尝试将其转换为JObject，就像我们对上一个请求所做的那样： <br><br><pre> <code class="cs hljs">HttpClient httpClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpClient(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> request = <span class="hljs-string"><span class="hljs-string">"https://api.exmo.com/v1/currency"</span></span>; HttpResponseMessage response = (<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> httpClient.GetAsync(request)).EnsureSuccessStatusCode(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> responseBody = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> response.Content.ReadAsStringAsync(); JObject jObject = JObject.Parse(responseBody);</code> </pre><br> 我们将得到一个Newtonsoft.Json.JsonReaderException异常，告诉我们正在转换的数据不是对象。 <br><br><img src="https://habrastorage.org/webt/o_/ec/8m/o_ec8m2isqj5izqoejif3pbkaqk.png"><br><br> 数组必须转换为特殊的JArray类型，就像JObject一样，它是从JContainer继承的。 <br><br><pre> <code class="cs hljs">HttpClient httpClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpClient(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> request = <span class="hljs-string"><span class="hljs-string">"https://api.exmo.com/v1/currency"</span></span>; HttpResponseMessage response = (<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> httpClient.GetAsync(request)).EnsureSuccessStatusCode(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> responseBody = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> response.Content.ReadAsStringAsync(); JObject jObject = JObject.Parse(responseBody); JArray jArray = JArray.Parse(responseBody);</code> </pre><br> 在解析的情况下，事先不知道初始结构，或者需要具有处理两种类型的数据的能力-您可以将JContainer或JToken指定为转换后的对象的类型，然后在解析期间，数据将隐式转换为所需的类型。 <br><br><pre> <code class="cs hljs">HttpClient httpClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpClient(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> request = <span class="hljs-string"><span class="hljs-string">"https://api.exmo.com/v1/currency"</span></span>; HttpResponseMessage response = (<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> httpClient.GetAsync(request)).EnsureSuccessStatusCode(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> responseBody = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> response.Content.ReadAsStringAsync(); JToken jArray = JToken.Parse(responseBody ); <span class="hljs-comment"><span class="hljs-comment">//    JArray List&lt;string&gt; list = jArray.ToObject&lt;List&lt;string&gt;&gt;(); request = "https://api.exmo.com/v1/trades/?pair=BTC_USD,ETH_USD"; HttpResponseMessage response = (await httpClient.GetAsync(request)).EnsureSuccessStatusCode(); string responseBody = await response.Content.ReadAsStringAsync(); JToken jObject = JToken.Parse(responseBody ); //    JObject Dictionary&lt;string, List&lt;Order&gt;&gt; dict = jObject.ToObject&lt;Dictionary&lt;string, List&lt;Order&gt;&gt;&gt;();</span></span></code> </pre><br><h3>  JSON值（JValue类） </h3><br> 根据JSON格式描述，该值可以是双引号字符串，数字，true，false，null， <b>对象</b>或<b>数组</b> 。 这些结构可以嵌套。 在newotnsoft.json的实现中，仅简单类型的对象可以是一个值。 尝试将JArray转换为JValue将导致“ System.InvalidCastException”异常。 <br><br> 作为newtonsoft.json库中使用特定值（JValue类）的入门资料，文档<a href="https://www.newtonsoft.com/JSON/help/html/JValueCast.htm" rel="nofollow">一</a> <a href="https://www.newtonsoft.com/JSON/help/html/JValueValue.htm" rel="nofollow">两次的</a>示例非常适合。 <br><br> 来自交易所的数据的用法示例： <br><br><pre> <code class="cs hljs">HttpClient httpClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpClient(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> request = <span class="hljs-string"><span class="hljs-string">"https://api.exmo.com/v1/currency"</span></span>; HttpResponseMessage response = (<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> httpClient.GetAsync(request)).EnsureSuccessStatusCode(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> responseBody = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> response.Content.ReadAsStringAsync(); JArray jArray = JArray.Parse(responseBody ); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (JValue <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> jArray) { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> s = (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>)<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; }</code> </pre><br> 在本文的第二部分，我将更详细地描述准备用于解析数据的类的可能性，以及使用DateTime数据类型的一些功能。 <br><br><div class="spoiler">  <b class="spoiler_title">程序的全文。</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Net.Http; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Newtonsoft.Json.Linq; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">JSONObjects</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Order</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> trade_id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> type { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> quantity { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> price { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> amount { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> date { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { HttpClient httpClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpClient(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> request = <span class="hljs-string"><span class="hljs-string">"https://api.exmo.com/v1/currency"</span></span>; HttpResponseMessage response = (<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> httpClient.GetAsync(request)).EnsureSuccessStatusCode(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> responseBody = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> response.Content.ReadAsStringAsync(); JToken jArray = JToken.Parse(responseBody); <span class="hljs-comment"><span class="hljs-comment">//    JArray List&lt;string&gt; list = jArray.ToObject&lt;List&lt;string&gt;&gt;(); request = "https://api.exmo.com/v1/trades/?pair=BTC_USD,ETH_USD"; response = (await httpClient.GetAsync(request)).EnsureSuccessStatusCode(); responseBody = await response.Content.ReadAsStringAsync(); JToken jObject = JToken.Parse(responseBody); //    JObject Dictionary&lt;string, List&lt;Order&gt;&gt; dict = jObject.ToObject&lt;Dictionary&lt;string, List&lt;Order&gt;&gt;&gt;(); } } }</span></span></code> </pre><br></div></div><br> 有关该库的最完整，最详细的信息始终可以在<a href="https://www.newtonsoft.com/JSON/help/html/Introduction.htm" rel="nofollow">官方文档中</a>找到。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN481514/">https://habr.com/ru/post/zh-CN481514/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN481496/index.html">通过社交工程进行DDoS攻击</a></li>
<li><a href="../zh-CN481500/index.html">狂热的程序员。 摘要第3部分+摘要表。 规划和卵石在一桶水</a></li>
<li><a href="../zh-CN481502/index.html">GitHub动作简介</a></li>
<li><a href="../zh-CN481506/index.html">＃327移动开发人员的有趣材料摘要（12月16日至22日）</a></li>
<li><a href="../zh-CN481510/index.html">Unity的优化：场景的层次结构如何窃取您</a></li>
<li><a href="../zh-CN481516/index.html">解决航天器的复杂性</a></li>
<li><a href="../zh-CN481518/index.html">项目管理专业人员（PMP）：第六版什么？ 怎么了 为什么？</a></li>
<li><a href="../zh-CN481522/index.html">在较低的小节上，或反对理智的推定</a></li>
<li><a href="../zh-CN481524/index.html">电子投票期间的并发审核</a></li>
<li><a href="../zh-CN481528/index.html">测试如何帮助您创建自己的UI-kit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>