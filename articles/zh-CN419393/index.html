<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ ğŸ—‘ï¸ ğŸš¶ğŸ¼ åœ¨ASP.NET Coreä¸­åˆ›å»ºä¸€ä¸ªç®€å•çš„APIç½‘å…³ ğŸ‘¨ğŸ¾â€ğŸ³ ğŸ”¥ ğŸ”</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å“ˆHaï¼ æˆ‘å‘æ‚¨ä»‹ç»äº†æ–‡ç« â€œ åœ¨ASP.NET Coreä¸­åˆ›å»ºç®€å•çš„APIç½‘å…³ â€çš„ç¿»è¯‘ã€‚ 


 10åˆ†é’Ÿé˜…è¯» 


 åœ¨ä¸Šä¸€ç¯‡æ–‡ç« .NETä¸­çš„é’ˆå¯¹å¾®æœåŠ¡çš„JWTèº«ä»½éªŒè¯ä¸­ ï¼Œæˆ‘ä»‹ç»äº†ä¸ºç”¨æˆ·èº«ä»½éªŒè¯åˆ›å»ºå¾®æœåŠ¡çš„è¿‡ç¨‹ã€‚ åœ¨ç³»ç»Ÿçš„å…¶ä»–ç»„ä»¶ä¸­æ‰§è¡Œä»»ä½•æ“ä½œä¹‹å‰ï¼Œè¿™å¯ç”¨äºéªŒè¯ç”¨æˆ·çš„èº«ä»½ã€‚ 





 è¯¥äº§...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åœ¨ASP.NET Coreä¸­åˆ›å»ºä¸€ä¸ªç®€å•çš„APIç½‘å…³</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419393/"><p> å“ˆHaï¼ æˆ‘å‘æ‚¨ä»‹ç»äº†æ–‡ç« â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨ASP.NET Coreä¸­åˆ›å»ºç®€å•çš„APIç½‘å…³</a> â€çš„ç¿»è¯‘ã€‚ </p><br><p>  <em>10åˆ†é’Ÿé˜…è¯»</em> </p><br><p> åœ¨ä¸Šä¸€ç¯‡æ–‡ç« <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">.NET</a>ä¸­çš„é’ˆå¯¹å¾®æœåŠ¡çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JWTèº«ä»½éªŒè¯ä¸­</a> ï¼Œæˆ‘ä»‹ç»äº†ä¸ºç”¨æˆ·èº«ä»½éªŒè¯åˆ›å»ºå¾®æœåŠ¡çš„è¿‡ç¨‹ã€‚ åœ¨ç³»ç»Ÿçš„å…¶ä»–ç»„ä»¶ä¸­æ‰§è¡Œä»»ä½•æ“ä½œä¹‹å‰ï¼Œè¿™å¯ç”¨äºéªŒè¯ç”¨æˆ·çš„èº«ä»½ã€‚ </p><br><p><img src="https://habrastorage.org/webt/ue/_y/er/ue_yerdkj5miri4_b6b2vjldhhc.png" alt="å¾®æœåŠ¡æ¶æ„å›¾"></p><br><p> è¯¥äº§å“æ­£å¸¸å·¥ä½œçš„å¦ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†æ˜¯APIç½‘å…³-åº”ç”¨ç¨‹åºå’Œåç«¯ä¹‹é—´çš„ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿé¦–å…ˆå°†ä¼ å…¥çš„è¯·æ±‚è·¯ç”±åˆ°ç›¸åº”çš„å¾®æœåŠ¡ï¼Œç„¶åå¯¹ç”¨æˆ·è¿›è¡Œæˆæƒã€‚ </p><br><p> æœ‰è®¸å¤šæ¡†æ¶å¯ç”¨äºåˆ›å»ºAPIç½‘å…³ï¼Œä¾‹å¦‚ï¼Œ.NETæ ¸å¿ƒä¸­çš„Ocelotæˆ–Javaä¸­çš„Netflix Zuulã€‚ ä½†æ˜¯ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†ä»‹ç»åœ¨.NET Coreä¸­ä»å¤´å¼€å§‹åˆ›å»ºç®€å•APIç½‘å…³çš„è¿‡ç¨‹ã€‚ </p><a name="habracut"></a><br><h2 id="sozdanie-proekta"> é¡¹ç›®åˆ›å»º </h2><br><p> é¦–å…ˆï¼Œé€šè¿‡åœ¨é¡¹ç›®åˆ›å»ºçª—å£ä¸­é€‰æ‹©<em>ASP.NET Core Web Application</em>å¹¶ä»¥<em>Empty</em>ä½œä¸ºæ¨¡æ¿æ¥åˆ›å»ºä¸€ä¸ªæ–°åº”ç”¨ç¨‹åºã€‚ </p><br><p><img src="https://habrastorage.org/webt/ce/f8/rh/cef8rhxwxvjlbnqipa-ps47ulfw.png"></p><br><p><img src="https://habrastorage.org/webt/-r/ta/vk/-rtavkwz1s0qwohtuuba7tkpyt0.png"></p><br><p> è¯¥é¡¹ç›®å°†åŒ…å«<strong>Startup</strong>å’Œ<strong>Program</strong>ç±»ã€‚ å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œæœ€é‡è¦çš„éƒ¨åˆ†æ˜¯<strong>Startup</strong>ç±»çš„<strong>Configure</strong>æ–¹æ³•ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å¤„ç†ä¼ å…¥çš„HTTPè¯·æ±‚å¹¶å¯¹å…¶è¿›è¡Œå“åº”ã€‚ ä¹Ÿè®¸ä¸‹é¢çš„ä»£ç å°†åœ¨<strong>Configure</strong>æ–¹æ³•ä¸­ï¼š </p><br><pre><code class="cs hljs">app.Run(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (context) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> context.Response.WriteAsync(<span class="hljs-string"><span class="hljs-string">"Hello, World!"</span></span>); });</code> </pre> <br><h2 id="napisanie-marshrutizatora"> æ‹¼å†™è·¯ç”±å™¨ </h2><br><p> ç”±äºå°†åœ¨<strong>Configure</strong>æ–¹æ³•ä¸­å¤„ç†è¯·æ±‚ï¼Œå› æ­¤æˆ‘ä»¬å°†ç¼–å†™å¿…è¦çš„é€»è¾‘ï¼š </p><br><pre> <code class="cs hljs">Router router = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Router(<span class="hljs-string"><span class="hljs-string">"routes.json"</span></span>); app.Run(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (context) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> content = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> router.RouteRequest(context.Request); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> context.Response.WriteAsync(<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> content.Content.ReadAsStringAsync()); });</code> </pre> <br><p> é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<strong>Router</strong>ç±»å‹çš„å¯¹è±¡ã€‚ ä»–çš„ä»»åŠ¡åŒ…æ‹¬å­˜å‚¨ç°æœ‰è·¯ç”±ï¼Œæ ¹æ®è·¯ç”±éªŒè¯å’Œå‘é€è¯·æ±‚ã€‚ ä¸ºäº†ä½¿ä»£ç æ›´æ•´æ´ï¼Œæˆ‘ä»¬å°†ä»JSONæ–‡ä»¶åŠ è½½è·¯ç”±ã€‚ </p><br><p> ç»“æœæ˜¯ä»¥ä¸‹é€»è¾‘ï¼šè¯·æ±‚åˆ°è¾¾ç½‘å…³åï¼Œå®ƒå°†è¢«é‡å®šå‘åˆ°è·¯ç”±å™¨ï¼Œè·¯ç”±å™¨å†å°†å…¶å‘é€åˆ°ç›¸åº”çš„å¾®æœåŠ¡ã€‚ </p><br><p> åœ¨ç¼–å†™<strong>Router</strong>ç±»ä¹‹å‰ï¼Œè¯·åˆ›å»ºä¸€ä¸ª<em>route.json</em>æ–‡ä»¶ã€‚ åœ¨æ­¤æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æŒ‡ç¤ºè·¯ç”±çš„åˆ—è¡¨ï¼Œæ¯ä¸ªè·¯ç”±éƒ½å°†åŒ…å«ä¸€ä¸ªå¤–éƒ¨åœ°å€ï¼ˆç«¯ç‚¹ï¼‰å’Œä¸€ä¸ªç›®çš„åœ°å€ï¼ˆç›®çš„åœ°ï¼‰ã€‚ åŒæ ·ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªæ ‡å¿—ï¼ŒæŒ‡ç¤ºåœ¨é‡å®šå‘ä¹‹å‰éœ€è¦æˆæƒç”¨æˆ·ã€‚ </p><br><p> è¯¥æ–‡ä»¶å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"routes"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"endpoint"</span></span>: <span class="hljs-string"><span class="hljs-string">"/movies"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"destination"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"uri"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://localhost:8090/movies/"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"requiresAuthentication"</span></span>: <span class="hljs-string"><span class="hljs-string">"true"</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"endpoint"</span></span>: <span class="hljs-string"><span class="hljs-string">"/songs"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"destination"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"uri"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://localhost:8091/songs/"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"requiresAuthentication"</span></span>: <span class="hljs-string"><span class="hljs-string">"false"</span></span> } } ], <span class="hljs-attr"><span class="hljs-attr">"authenticationService"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"uri"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/api/auth/"</span></span> } }</code> </pre><br><h2 id="sozdaem-klass-destination"> åˆ›å»ºç›®æ ‡ç±»åˆ« </h2><br><p> ç°åœ¨æˆ‘ä»¬çŸ¥é“æ¯ä¸ª<strong>Route</strong>å¿…é¡»å…·æœ‰<code>endpoint</code>å’Œ<code>destination</code> ï¼Œå¹¶ä¸”æ¯ä¸ª<strong>Destination</strong>å¿…é¡»å…·æœ‰<code>uri</code>å’Œ<code>requiresAuthentication</code>å­—æ®µã€‚ </p><br><p> ç°åœ¨è®©æˆ‘ä»¬ç¼–å†™<strong>Destination</strong>ç±»ï¼Œè®°ä½è¿™ä¸€ç‚¹ã€‚ æˆ‘å°†æ·»åŠ ä¸¤ä¸ªå­—æ®µï¼Œä¸¤ä¸ªæ„é€ å‡½æ•°å’Œä¸€ä¸ªä¸å¸¦å‚æ•°çš„ç§æœ‰æ„é€ å‡½æ•°ï¼Œä»¥è¿›è¡ŒJSONååºåˆ—åŒ–ã€‚ </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Destination</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Uri { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> RequiresAuthentication { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Destination</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> uri, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> requiresAuthentication</span></span></span><span class="hljs-function">)</span></span> { Uri = path; RequiresAuthentication = requiresAuthentication; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Destination</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> uri</span></span></span><span class="hljs-function">) :</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uri, </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Destination</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Uri = <span class="hljs-string"><span class="hljs-string">"/"</span></span>; RequiresAuthentication = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }</code> </pre> <br><p> åŒæ ·ï¼Œåœ¨æ­¤ç±»ä¸­ç¼–å†™<code>SendRequest</code>æ–¹æ³•æ˜¯æ­£ç¡®çš„ã€‚ è¿™å°†æ˜¾ç¤º<strong>Destination</strong>ç±»çš„æ¯ä¸ªå¯¹è±¡å°†è´Ÿè´£å‘é€è¯·æ±‚ã€‚ æ­¤æ–¹æ³•å°†ä½¿ç”¨<code>HttpRequest</code>ç±»å‹çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æè¿°ä¼ å…¥çš„è¯·æ±‚ï¼Œä»ä¸­å–å‡ºæ‰€æœ‰å¿…éœ€çš„ä¿¡æ¯ï¼Œç„¶åå°†è¯·æ±‚å‘é€åˆ°ç›®æ ‡URIã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªè¾…åŠ©æ–¹æ³•<code>CreateDestinationUri</code> ï¼Œå®ƒå°†æŠŠè¡Œä¸åœ°å€ä»¥åŠæ¥è‡ªå®¢æˆ·ç«¯çš„åœ°å€è¡Œçš„å‚æ•°ï¼ˆæŸ¥è¯¢å­—ç¬¦ä¸²ï¼‰è¿æ¥èµ·æ¥ã€‚ </p><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateDestinationUri</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HttpRequest request</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> requestPath = request.Path.ToString(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> queryString = request.QueryString.ToString(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> endpoint = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] endpointSplit = requestPath.Substring(<span class="hljs-number"><span class="hljs-number">1</span></span>).Split(<span class="hljs-string"><span class="hljs-string">'/'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (endpointSplit.Length &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) endpoint = endpointSplit[<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Uri + endpoint + queryString; }</code> </pre> <br><p> ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ª<code>SendRequest</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†å‘é€å¯¹å¾®æœåŠ¡çš„è¯·æ±‚å¹¶æ¥æ”¶å›å“åº”ã€‚ </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;HttpResponseMessage&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendRequest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HttpRequest request</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> requestContent; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (Stream receiveStream = request.Body) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (StreamReader readStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamReader(receiveStream, Encoding.UTF8)) { requestContent = readStream.ReadToEnd(); } } HttpClient client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpClient(); HttpRequestMessage newRequest = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpRequestMessage(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpMethod(request.Method), CreateDestinationUri(request)); HttpResponseMessage response = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> client.SendAsync(newRequest); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response; }</code> </pre> <br><h2 id="sozdaem-json-parser"> åˆ›å»ºä¸€ä¸ªJSONè§£æå™¨ã€‚ </h2><br><p> åœ¨ç¼–å†™<strong>Router</strong>ç±»ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºé€»è¾‘ä»¥ä½¿ç”¨è·¯ç”±ååºåˆ—åŒ–JSONæ–‡ä»¶ã€‚ æˆ‘å°†ä¸ºæ­¤åˆ›å»ºä¸€ä¸ªå¸®åŠ©å™¨ç±»ï¼Œå…¶ä¸­å°†æœ‰ä¸¤ç§æ–¹æ³•ï¼šä¸€ç§ç”¨äºä»JSONæ–‡ä»¶åˆ›å»ºå¯¹è±¡ï¼Œå¦ä¸€ç§ç”¨äºååºåˆ—åŒ–ã€‚ </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">JsonLoader</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> T LoadFromFile&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> filePath) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (StreamReader reader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamReader(filePath)) { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> json = reader.ReadToEnd(); T result = JsonConvert.DeserializeObject&lt;T&gt;(json); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> T Deserialize&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> jsonObject) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JsonConvert.DeserializeObject&lt;T&gt;(Convert.ToString(jsonObject)); } }</code> </pre> <br><h2 id="klass-router"> ç±»è·¯ç”±å™¨ã€‚ </h2><br><p> åœ¨ç¼–å†™<strong>Router</strong>ä¹‹å‰ï¼Œæˆ‘ä»¬è¦åšçš„æœ€åä¸€ä»¶äº‹æ˜¯æè¿°è·¯ç”±æ¨¡å‹ï¼š </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Route</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Endpoint { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Destination Destination { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p> ç°åœ¨ï¼Œé€šè¿‡åœ¨å…¶ä¸­æ·»åŠ å­—æ®µå’Œæ„é€ å‡½æ•°æ¥ç¼–å†™Routerç±»ã€‚ </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Router</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;Route&gt; Routes { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Destination AuthenticationService { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Router</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> routeConfigFilePath</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">dynamic</span></span> router = JsonLoader.LoadFromFile&lt;<span class="hljs-keyword"><span class="hljs-keyword">dynamic</span></span>&gt;(routeConfigFilePath); Routes = JsonLoader.Deserialize&lt;List&lt;Route&gt;&gt;( Convert.ToString(router.routes) ); AuthenticationService = JsonLoader.Deserialize&lt;Destination&gt;( Convert.ToString(router.authenticationService) ); } }</code> </pre><br><p> æˆ‘ä½¿ç”¨åŠ¨æ€ç±»å‹ä»JSONè¯»å–å¹¶å°†å¯¹è±¡å±æ€§å†™å…¥å…¶ä¸­ã€‚ </p><br><p> ç°åœ¨ï¼Œæ‰€æœ‰å†…å®¹éƒ½å¯ä»¥æè¿°APIç½‘å…³çš„ä¸»è¦åŠŸèƒ½ï¼šè·¯ç”±å’Œç”¨æˆ·æˆæƒï¼Œè¿™å°†åœ¨<code>RouteRequest</code>æ–¹æ³•ä¸­è¿›è¡Œã€‚ æˆ‘ä»¬éœ€è¦ä»è¯·æ±‚å¯¹è±¡ä¸­è§£å‹ç¼©å¤–éƒ¨åœ°å€çš„åŸºæœ¬éƒ¨åˆ†ï¼ˆåŸºæœ¬ç«¯ç‚¹ï¼‰ã€‚ ä¾‹å¦‚ï¼Œå¯¹äºåœ°å€<code>/movies/add</code>åŸºç¡€å°†æ˜¯<code>/movies/</code> ã€‚ ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥æ˜¯å¦æœ‰æ­¤è·¯çº¿çš„æè¿°ã€‚ å¦‚æœæ˜¯è¿™æ ·ï¼Œåˆ™æˆæƒç”¨æˆ·å¹¶å‘é€è¯·æ±‚ï¼Œå¦åˆ™æˆ‘ä»¬å°†è¿”å›é”™è¯¯ã€‚ ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘è¿˜åˆ›å»ºäº†<strong>ConstructErrorMessage</strong>ç±»ã€‚ </p><br><p> å¯¹äºæˆæƒï¼Œæˆ‘æ›´å–œæ¬¢é‡‡ç”¨ä»¥ä¸‹æ–¹å¼ï¼šæˆ‘ä»¬ä»è¯·æ±‚æ ‡å¤´ä¸­æå–ä»¤ç‰Œï¼Œå¹¶å°†å…¶ä½œä¸ºè¯·æ±‚å‚æ•°å‘é€ã€‚ å¦ä¸€ä¸ªé€‰æ‹©æ˜¯å¯èƒ½çš„ï¼šå°†ä»¤ç‰Œä¿ç•™åœ¨æ ‡å¤´ä¸­ï¼Œç„¶åç”¨äºè¯·æ±‚çš„å¾®æœåŠ¡åº”å·²å°†å…¶æå–ã€‚ </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;HttpResponseMessage&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RouteRequest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HttpRequest request</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> path = request.Path.ToString(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> basePath = <span class="hljs-string"><span class="hljs-string">'/'</span></span> + path.Split(<span class="hljs-string"><span class="hljs-string">'/'</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>]; Destination destination; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { destination = Routes.First(r =&gt; r.Endpoint.Equals(basePath)).Destination; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ConstructErrorMessage(<span class="hljs-string"><span class="hljs-string">"The path could not be found."</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (destination.RequiresAuthentication) { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> token = request.Headers[<span class="hljs-string"><span class="hljs-string">"token"</span></span>]; request.Query.Append(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> KeyValuePair&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, StringValues&gt;(<span class="hljs-string"><span class="hljs-string">"token"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringValues(token))); HttpResponseMessage authResponse = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> AuthenticationService.SendRequest(request); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!authResponse.IsSuccessStatusCode) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ConstructErrorMessage(<span class="hljs-string"><span class="hljs-string">"Authentication failed."</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> destination.SendRequest(request); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> HttpResponseMessage </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConstructErrorMessage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> error</span></span></span><span class="hljs-function">)</span></span> { HttpResponseMessage errorMessage = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpResponseMessage { StatusCode = HttpStatusCode.NotFound, Content = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringContent(error) }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> errorMessage; }</code> </pre> <br><h2 id="zaklyuchenie"> ç»“è®º </h2><br><p> åˆ›å»ºåŸºæœ¬çš„APIç½‘å…³ä¸éœ€è¦å¤ªå¤šçš„å·¥ä½œï¼Œä½†æ˜¯å®ƒæ²¡æœ‰æä¾›é€‚å½“çš„åŠŸèƒ½ã€‚ å¦‚æœéœ€è¦è´Ÿè½½å¹³è¡¡å™¨ï¼Œåˆ™å¯ä»¥æŸ¥çœ‹æä¾›ç”¨äºè·¯ç”±è¯·æ±‚çš„åº“çš„ç°æœ‰æ¡†æ¶æˆ–å¹³å°ã€‚ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHubå­˜å‚¨åº“ä¸­</a>æä¾›äº†æœ¬æ–‡ä¸­çš„æ‰€æœ‰ä»£ç <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ã€‚</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN419393/">https://habr.com/ru/post/zh-CN419393/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN419379/index.html">ç‰¹æ–¯æ‹‰å’Œå¾·æ„å¿—é“¶è¡Œä¸ºä½•æ‹’ç»çº¸è´¨åˆåŒ</a></li>
<li><a href="../zh-CN419383/index.html">æ–°çš„WPA2æ”»å‡»æŠ€æœ¯ï¼Œä¸éœ€è¦APä¸Šçš„å®¢æˆ·ç«¯</a></li>
<li><a href="../zh-CN419385/index.html">å¿ƒè„æ‰‹æœ¯ï¼šæˆ‘ä»¬å¦‚ä½•é‡å†™DLPç³»ç»Ÿçš„ä¸»è¦ç»„æˆéƒ¨åˆ†</a></li>
<li><a href="../zh-CN419389/index.html">Angular 6å’ŒIvyæ¸²æŸ“å¼•æ“</a></li>
<li><a href="../zh-CN419391/index.html">åŠ›é‡ï¼Œé‡‘é’±å’Œå¼€æºã€‚ è®²è¿°ç¤¾åŒºå¦‚ä½•ä¸Apache Igniteåˆä½œ</a></li>
<li><a href="../zh-CN419395/index.html">Lambdaè¡¨è¾¾å¼çš„è¯´æ˜</a></li>
<li><a href="../zh-CN419397/index.html">æˆ‘ä»¬å¦‚ä½•ä¸ºå…­ä¸ªå›½å®¶/åœ°åŒºåˆ¶ä½œç§»åŠ¨åº”ç”¨</a></li>
<li><a href="../zh-CN419399/index.html">OpenAI Fiveåœ¨ä¸€åœºè¡¨æ¼”èµ›Dota 2ä¸­å‡»è´¥äº†ä¸€ç¾¤äºº</a></li>
<li><a href="../zh-CN419401/index.html">Javaå‘½ä»¤è¡Œç•Œé¢ï¼špicocli</a></li>
<li><a href="../zh-CN419405/index.html">IPv6çš„æƒ…å†µå¦‚ä½•ï¼Œæˆ–é˜»ç¢è¿‡æ¸¡åˆ°è¯¥åè®®çš„æ–°ç‰ˆæœ¬çš„åŸå› -è®¨è®ºæƒ…å†µ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>