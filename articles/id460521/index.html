<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👋 🏖️ 🧓🏽 Petualangan Malvari yang Elusif, Bagian IV: Bidang Dokumen DDE dan Word 🍬 🧑🏾 🍩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Artikel ini adalah bagian dari seri Fileless Malware. Semua bagian seri lainnya: 



- Petualangan Malvari yang Elusif, Bagian I 
- The Adventures of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Petualangan Malvari yang Elusif, Bagian IV: Bidang Dokumen DDE dan Word</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/varonis/blog/460521/"><img src="https://habrastorage.org/webt/zn/w7/ji/znw7ji_p5zvifvliksiuceqjll0.png"><br><br>  Artikel ini adalah bagian dari seri Fileless Malware.  Semua bagian seri lainnya: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Petualangan Malvari yang Elusif, Bagian I</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">The Adventures of the Elusive Malvari, Bagian II: Script VBA Rahasia</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Petualangan Malvari yang Sulit dipahami, Bagian III: Skrip VBA yang rumit untuk Tawa dan Keuntungan</a> </li><li>  Petualangan Elusive Malvari, Bagian IV: DDE dan Word Documents Fields (di sini kita) </li></ul><br>  Pada artikel ini, saya akan terjun ke skenario multi-tahap yang lebih rumit dari serangan file-free dengan memperbaiki dalam sistem.  Tapi kemudian saya menemukan serangan yang sangat sederhana tanpa kode - tidak diperlukan makro Word atau Excel!  Dan ini membuktikan jauh lebih efisien hipotesis awal saya yang mendasari serangkaian artikel ini: untuk mengatasi perimeter eksternal organisasi mana pun adalah tugas yang sangat sederhana. <br><a name="habracut"></a><br>  Serangan pertama yang akan saya jelaskan adalah mengeksploitasi kerentanan Microsoft Word, yang didasarkan pada <strong>warisan <a href="">Dynamic Data Exchange Protocol</a> (DDE)</strong> .  Sudah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">diperbaiki</a> .  Yang kedua mengeksploitasi kerentanan yang lebih umum dalam Microsoft COM dan kemampuan transfer objek. <br><br><h2>  Kembali ke masa depan dengan DDE </h2><br>  Apakah ada orang lain yang ingat DDE?  Mungkin sedikit.  Ini adalah salah satu <strong>protokol komunikasi antar proses</strong> pertama <strong>yang memungkinkan aplikasi dan perangkat untuk mentransfer data</strong> . <br><br>  Saya sendiri agak terbiasa dengan hal itu, karena saya biasa mengecek dan menguji peralatan telekomunikasi.  Pada saat itu, DDE mengizinkan, misalnya, untuk mentransfer ID penelepon ke aplikasi CRM untuk operator pusat panggilan, yang pada akhirnya membuka kartu klien.  Untuk melakukan ini, Anda harus menghubungkan kabel RS-232 antara telepon dan komputer.  Inilah zamannya! <br><br>  Ternyata, Microsoft Word masih <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mendukung</a> DDE. <br><br>  Apa yang membuat serangan ini efektif tanpa kode adalah Anda dapat mengakses protokol DDE <i>langsung</i> dari bidang otomatis dokumen Word (saya melepas topi saya ke SensePost untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">meneliti dan menerbitkannya</a> ). <br><br>  <strong>Kode Lapangan</strong> adalah fitur MS Word kuno lainnya yang memungkinkan Anda untuk menambahkan teks dinamis dan sedikit pemrograman ke dokumen.  Contoh yang paling jelas adalah bidang Nomor Halaman, yang dapat dimasukkan ke dalam footer menggunakan nilai {PAGE \ * MERGEFORMAT}.  Ini memungkinkan Anda untuk secara otomatis menghasilkan nomor halaman. <br><br><img src="https://habrastorage.org/webt/wu/ov/ns/wuovnsvhhei65psga4ongzkfwuc.jpeg"><br>  <font color="#999999"><i>Petunjuk: Anda dapat menemukan item menu Bidang di bagian Sisipkan.</i></font> <br><br>  Saya ingat bahwa ketika saya pertama kali menemukan fitur ini di Word, saya kagum.  Dan selama tambalan tidak menonaktifkannya, Word mendukung parameter bidang DDE.  Idenya adalah bahwa DDE akan memungkinkan Word untuk berkomunikasi dengan aplikasi secara langsung, untuk kemungkinan kemudian mentransfer output program ke dokumen.  Itu adalah teknologi yang sangat muda pada waktu itu - dukungan untuk bertukar data dengan aplikasi eksternal.  Nanti dikembangkan dalam teknologi COM, yang juga akan kita pertimbangkan di bawah ini. <br><br>  Akibatnya, para peretas menyadari bahwa aplikasi DDE ini bisa menjadi shell perintah yang, tentu saja, meluncurkan PowerShell, dan dari sana para peretas dapat melakukan apa pun yang mereka inginkan. <br>  Tangkapan layar di bawah ini menunjukkan bagaimana saya menggunakan teknik rahasia ini: skrip PowerShell kecil (selanjutnya disebut PS) dari bidang DDE memuat skrip PS lain yang meluncurkan fase kedua serangan. <br><br><img src="https://habrastorage.org/webt/p6/17/2j/p6172jjjmcko74uq-klljtznybs.jpeg"><br>  <font color="#999999"><i>Terima kasih kepada Windows untuk peringatan yang muncul bahwa bidang bawaan DDEAUTO secara diam-diam mencoba memulai shell</i></font> <br><br>  Metode yang lebih disukai untuk mengeksploitasi kerentanan adalah dengan menggunakan opsi dengan bidang DDEAUTO, yang secara otomatis menjalankan skrip <i>ketika</i> dokumen Word <i>dibuka</i> . <br>  Mari kita pikirkan apa yang bisa kita lakukan. <br><br>  Sebagai peretas pemula, Anda dapat, misalnya, mengirim email phising, berpura-pura berasal dari Layanan Pajak Federal, dan menyematkan bidang DDEAUTO dengan skrip PS untuk tahap pertama (sebenarnya ada dropper).  Dan Anda bahkan tidak perlu melakukan pengkodean makro nyata, dll., Seperti yang saya lakukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel sebelumnya.</a> <br>  Korban membuka dokumen Anda, skrip bawaan diaktifkan, dan peretas ada di dalam komputer.  Dalam kasus saya, skrip PS jarak jauh hanya mencetak pesan, tetapi juga dapat dengan mudah meluncurkan klien PS Empire, yang akan menyediakan akses jarak jauh ke shell. <br>  Dan sebelum korban punya waktu untuk mengatakan sesuatu, peretas akan menjadi remaja terkaya di desa. <br><br><img src="https://habrastorage.org/webt/s2/hr/o3/s2hro3e7lhftosp6nrtdj1cjsge.jpeg"><br>  <font color="#999999"><i>Shell diluncurkan tanpa pengkodean sedikit pun.</i></font>  <font color="#999999"><i>Bahkan seorang anak pun dapat melakukannya!</i></font> <br><br><h2>  DDE dan bidang </h2><br>  Kemudian, Microsoft masih menonaktifkan DDE di Word, tetapi sebelum itu, perusahaan mengatakan bahwa fitur ini hanya disalahgunakan.  Keengganan mereka untuk mengubah sesuatu bisa dimengerti.  Dari pengalaman saya sendiri, saya sendiri mengamati contoh seperti itu bahwa memperbarui bidang ketika membuka dokumen diaktifkan, tetapi makro Word dinonaktifkan oleh layanan TI (tetapi dengan pemberitahuan).  Omong-omong, Anda dapat menemukan parameter yang sesuai di bagian Pengaturan kata. <br><br>  Namun, bahkan jika pembaruan bidang diaktifkan, Microsoft Word juga akan memberi tahu pengguna ketika bidang meminta akses ke data yang dihapus, seperti halnya dengan DDE di atas.  Microsoft benar-benar memperingatkan Anda. <br><br>  Tetapi kemungkinan besar, pengguna masih akan melewatkan peringatan ini dan mengaktifkan pembaruan bidang di Word.  Ini adalah salah satu kesempatan langka untuk berterima kasih kepada Microsoft karena telah menonaktifkan fitur DDE yang berbahaya. <br><br>  Seberapa sulit untuk menemukan sistem Windows yang belum ditonton hari ini? <br><br>  Untuk pengujian ini, saya menggunakan AWS Workspaces untuk mengakses desktop virtual.  Jadi, saya mendapat mesin virtual yang belum ditambal dengan MS Office, yang memungkinkan saya untuk memasukkan bidang DDEAUTO.  Saya tidak ragu bahwa dengan cara yang sama Anda dapat menemukan perusahaan lain yang belum menginstal tambalan keamanan yang diperlukan. <br><br><h2>  Misteri benda </h2><br>  Bahkan jika Anda menginstal tambalan ini, ada lubang keamanan lain di MS Office yang memungkinkan peretas untuk melakukan sesuatu yang sangat mirip dengan apa yang kami lakukan dengan Word.  Dalam skenario berikut, kita akan belajar cara <strong>menggunakan Excel sebagai umpan untuk serangan phishing tanpa menulis kode.</strong> <br><br>  Untuk memahami skenario ini, mari kita memanggil kembali <i>Model Objek Komponen</i> Microsoft, atau disingkat <i>COM (Component Object Model)</i> . <br><br>  COM telah ada sejak 1990-an, dan didefinisikan sebagai "model komponen berorientasi objek yang netral terhadap bahasa pemrograman" berdasarkan panggilan prosedur RPC jarak jauh.  Untuk pemahaman umum tentang terminologi COM, baca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">posting ini</a> di StackOverflow. <br><br>  Pada umumnya, Anda dapat membayangkan aplikasi COM sebagai executable Excel atau Word, atau file biner lain yang dapat diluncurkan. <br><br>  Ternyata aplikasi COM juga dapat menjalankan <i>skrip</i> - JavaScript atau VBScript.  Secara teknis, ini disebut <strong>scriptlet</strong> .  Mungkin Anda telah menjumpai ekstensi sct untuk file di Windows - ini adalah ekstensi resmi untuk skriplet.  Bahkan, mereka adalah kode untuk skrip yang dibungkus dalam pembungkus XML: <br><br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?XML version="1.0"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scriptlet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">registration</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">description</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"test"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">progid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"test"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">classid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{BBBB4444-0000-0000-0000-0000FAADACDC}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">remotable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">registration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">language</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"JScript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="xml"><span class="xml"> &lt;![CDATA[ var r = new ActiveXObject("WScript.Shell").Run("cmd /k powershell -c Write-Host You have been scripted!"); ]]&gt; </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scriptlet</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Peretas dan pentester telah menemukan bahwa ada utilitas dan aplikasi terpisah pada Windows yang menerima objek COM dan, karenanya, skrip juga. <br><br>  Saya bisa meneruskan scriptlet ke utilitas Windows yang ditulis dalam VBS, yang dikenal sebagai pubprn.  Itu terletak di perut C: \ Windows \ system32 \ Printing_Admin_Scripts.  Omong-omong, ada utilitas Windows lain yang mengambil objek sebagai parameter.  Untuk memulai, pertimbangkan contoh ini. <br><br><img src="https://habrastorage.org/webt/yk/ed/ne/ykedneaau8q1rs8n_jizxmiwzp4.jpeg"><br>  <font color="#999999"><i>Wajar jika shell dapat diluncurkan bahkan dari skrip cetak.</i></font>  <font color="#999999"><i>Pergi Microsoft!</i></font> <br><br>  Sebagai ujian, saya membuat skrip jarak jauh sederhana yang meluncurkan shell dan mencetak pesan lucu "Anda baru saja dituliskan!".  Pada dasarnya, pubprn meng-instantiate objek scriptlet, memungkinkan VBScript untuk menjalankan shell.  Metode ini memberikan manfaat yang jelas bagi peretas yang ingin menyelinap masuk dan bersembunyi di sistem Anda. <br><br>  Pada posting selanjutnya saya akan menjelaskan bagaimana COM scriptlets dapat digunakan oleh peretas menggunakan lembar kerja Excel. <br><br>  Untuk pekerjaan rumah Anda, tonton <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">video</a> Derbycon 2016 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ini</a> yang menjelaskan bagaimana peretas menggunakan skrip.  Dan juga baca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel ini</a> tentang skrip dan beberapa jenis moniker. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id460521/">https://habr.com/ru/post/id460521/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id460509/index.html">Bagaimana proxy penduduk membantu dalam bisnis: kasus nyata menggunakan Infatica dalam Penambangan Data</a></li>
<li><a href="../id460511/index.html">Penyesuaian PHP-FPM: menggunakan pm static untuk kinerja maksimum</a></li>
<li><a href="../id460513/index.html">Flutter 1.7 - apa yang baru dalam rilis 10 Juli 2019</a></li>
<li><a href="../id460515/index.html">Seberapa dekat kita dengan kedatangan robomobiles?</a></li>
<li><a href="../id460517/index.html">Cara mendeteksi serangan pada infrastruktur Windows: menjelajahi alat peretas</a></li>
<li><a href="../id460523/index.html">Pengumuman mitap yang dengan lancar berubah menjadi tempat minum BeerPHP (di Moskow dan online)</a></li>
<li><a href="../id460525/index.html">Selamat datang di DINS IT EVENING pada bulan Juli: QA dan JS</a></li>
<li><a href="../id460527/index.html">Pemecahan masalah dengan pwnable.kr 06 - acak dan 09 - kesalahan</a></li>
<li><a href="../id460531/index.html">Penasaran Penasaran dari Dunia IT - 5</a></li>
<li><a href="../id460533/index.html">Anda datang dengan ide produk IT, apa selanjutnya</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>