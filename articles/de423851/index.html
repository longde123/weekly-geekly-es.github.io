<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñåÔ∏è üßùüèæ üë©üèæ‚Äçü§ù‚Äçüë©üèº Einf√ºhrung in Grafanas neues Plugin - Statusmap-Panel üê≤ üôÉ üíç</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Grafana kann den Status anzeigen, Grafana kann Daten rechtzeitig anzeigen. Paradoxerweise hatte Grafana jedoch bisher keine bequeme M√∂glichkeit, den S...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Einf√ºhrung in Grafanas neues Plugin - Statusmap-Panel</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/423851/">  Grafana kann den <b>Status</b> anzeigen, Grafana kann <b>Daten rechtzeitig</b> anzeigen.  Paradoxerweise hatte Grafana jedoch bisher keine bequeme M√∂glichkeit, den <b>Status im Laufe der Zeit</b> anzuzeigen! <br><br>  Wir pr√§sentieren unser Plugin - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Statusmap Panel</a> .  Sie k√∂nnen den Status einer Reihe von Objekten f√ºr einen ausgew√§hlten Zeitraum visuell anzeigen.  Stellen Sie sich als Beispiel f√ºr die Funktionsweise des Plugins viele Orte vor, an denen Kaffee f√ºr jemanden zubereitet wird: <br><br><img src="https://habrastorage.org/webt/gh/is/-v/ghis-vmfpoxwf0pfrgp9uy76qfo.png"><br>  <i>Sie k√∂nnen sehen, wie Nikki Energie spart, Gerry schnell ihre Wasservorr√§te auff√ºllt, Valeras Kaffeemaschine oft Junk ist und Wi-Fi bei Bifrost deutlich besser ist als an der Mondstation, wo es sehr dicht mit Wasser zu sein scheint.</i> <br><br>  Sieht interessant aus?  Aber fangen wir damit an, wie wir alle dazu gekommen sind. <a name="habracut"></a><br><br><h2>  Warum? </h2><br>  Zur besseren Datenvisualisierung haben wir uns eine einfache Aufgabe gestellt: die Zust√§nde einer Reihe von Zeitreihen √ºber einen bestimmten Zeitraum anzuzeigen.  Eine Reihe von Objekten bedeutet unterschiedliche Zeitreihen: Sie k√∂nnen sich in einer Reihe von Beschriftungen und einem Namen unterscheiden.  Dar√ºber hinaus sollten Zeitreihenwerte zweckm√§√üig sein, d.h.  ohne Kr√ºcken, in Text und Farbe angezeigt. <br><br>  Aktuelle Beispiele f√ºr die Verwendung einer solchen Visualisierung f√ºr unser Unternehmen sind der Zustand von Kubernetes-Servern oder -Pods sowie die Ergebnisse der √úberpr√ºfung von HTTP-Diensten.  So wurde bei Flant ein Grafana-Plugin namens Statusmap geboren.  Wir haben uns √ºber die vielen M√∂glichkeiten der Anwendung f√ºr andere Aufgaben Gedanken gemacht und uns schnell verpflichtet, den Code mit der Weltgemeinschaft zu teilen.  Aber wirklich, niemand hat dieses Problem vor uns gel√∂st? <br><br><h2>  Warum nicht bereit? </h2><br>  Die Aufgabe ist sehr beliebt, deshalb sind wir keine Pioniere geworden.  Alles begann mit der Tatsache, dass wir mehrere Dashboards mit coolen Plugins <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Status Panel</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Status Dot hatten</a> .  Mit diesen Plugins k√∂nnen Sie den aktuellen Status einer Reihe von Objekten anzeigen, z. B. Hosts oder Herde ... oder Kaffeemaschinen in verschiedenen Teilen der Welt. <br><br><img src="https://habrastorage.org/webt/vb/qo/tb/vbqotbeezghqnvin2pgw4gqpleq.png"><br><br><img src="https://habrastorage.org/webt/lq/b5/zl/lqb5zlkv0lo82uon9c9qnllu4mo.png"><br><br>  Alles lief gut, bis wir den Status dieser Objekte rechtzeitig sehen wollten.  Die erste und einfachste L√∂sung bestand darin, ein regul√§res Diagramm mit einem <i>gestapelten</i> H√§kchen hinzuzuf√ºgen. <br><br><img src="https://habrastorage.org/webt/bf/ib/mm/bfibmmrpcxlzn2snfzed3mn3_py.png"><br><br>  Wie geplant k√∂nnen wir mit dem Statusfenster + gestapeltem Diagramm den Status der Objekte ‚Äûvorerst‚Äú und die zeitliche Entwicklung der Situation sehen.  Das gestapelte Diagramm ist jedoch nicht sehr klar: <br><br><ul><li>  Farbe zeigt verschiedene Zeitreihen an, nicht die Werte, die in Farbe f√ºr den Statuspunkt oder das Statusfenster angezeigt werden.  Das hei√üt, die Farben f√ºr die beiden Diagramme sind nicht gleich, und dies ist verwirrend. </li><li> Wenn unter den Werten <code>null</code> angezeigt wird, schlagen die Diagramme fehl. </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sie haben</a> versucht, die Standard- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Heatmap</a> anzupassen - es hat nicht funktioniert: Das Plugin arbeitet mit der Y-Achse nur auf der Ebene der Werte und wei√ü nicht, wie Beschriftungen dort angezeigt werden sollen.  Dann haben wir folgende Plugins f√ºr Grafana ausprobiert: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teppichplot</a> - gruppiert Werte nach Tag und nach dem ausgew√§hlten Fragment des Tages; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Discrete Panel</a> ist ein gutes Plugin, aber wir m√ºssen den Status im Laufe der Zeit diskret anzeigen. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Der Status nach Gruppenbedienfeld</a> ist eine gute Verbesserung des Statusbedienfelds, mit dem Sie viele Status anzeigen k√∂nnen, jedoch immer noch ohne die von uns ben√∂tigten Funktionen. </li></ul><br>  Basierend auf den Ergebnissen aller Studien haben wir die folgenden Anforderungen f√ºr das Plugin formuliert: <br><br><ul><li>  hervorgehobene klare Linie des Diagramms f√ºr jedes Objekt; </li><li>  Der Name des Objekts wird entlang der Y-Achse angezeigt und im Legendenfeld festgelegt. </li><li>  Ein Objekt kann mehrere Status haben. In solchen F√§llen wird der wichtigste in Farbe und der Rest in der QuickInfo angezeigt. </li><li>  Eimer sollten mit einer Breite von mindestens einer bestimmten (5 px) angezeigt werden, weil  bei Einzelpixeln unpraktisch, um mit der Maus zu zeigen; </li><li>  Manuelles Farbmanagement - Die M√∂glichkeit, die Farbe f√ºr jeden numerischen Wert aus einem diskreten Satz festzulegen. </li></ul><br>  Lassen Sie mich jetzt einen kleinen Exkurs √ºber die Heatmap, Prometheus-Grafiken und diskrete Status machen ... <br><br><h2>  Ein bisschen Theorie </h2><br>  Die klassische Heatmap ist eine dreidimensionale Grafik: <br><br><ul><li>  Die x-Achse repr√§sentiert die Zeit </li><li>  entlang der Y-Achse sind die m√∂glichen Werte einer bestimmten Gr√∂√üe, </li><li>  entlang der Z-Achse ist die Anzahl der beobachteten Werte zu einem bestimmten Zeitpunkt. </li></ul><br>  Das Standard-Heatmap-Plugin zeigt die Z-Achse in Farbe an - zum Beispiel von Wei√ü nach Rot oder durch den gr√ºn-gelb-roten Farbverlauf.  Dies funktioniert sehr gut f√ºr kontinuierliche Werte: Antwortzeit, Warteschlangenl√§nge, Anzahl der Anforderungen an den Server ... Bei diskreten Status f√ºr eine Reihe von Objekten ben√∂tigen Sie Folgendes: Auf der Y-Achse werden die Namen der Objekte angezeigt, die wir √ºberwachen, und auf der Z-Achse werden die Observablen f√ºr jedes Objekt angezeigt Status zu einem bestimmten Zeitpunkt ... Aber warten Sie!  Was bedeutet der Status eines Objekts zu einem Zeitpunkt?  Ich werde versuchen zu beschreiben. <br><br>  Diejenigen, die Prometheus mit Grafana verwenden, kennen den <code>step</code> oder das <code>interval</code> - die Einstellung auf der Registerkarte <i>Abfrage</i> .  Wenn Sie dort <code>1m</code> angeben und die Daten, die Sie im Abstand von <code>5s</code> <code>coffee_maker_status</code> , eine einfache <code>coffee_maker_status</code> ausf√ºhren, gibt <code>coffee_maker_status</code> Prometheus jeden 12. Wert zur√ºck, und 11 Werte werden im Diagramm nicht <code>coffee_maker_status</code> .  Wie kann man die Situation verbessern? <br><br>  Das erste, was mir in den Sinn kommt, ist die Verwendung der Aggregationsfunktionen - zum Beispiel <code>*_over_time(coffee_maker_status[1m])</code> .  Welche Funktion soll ich √ºbernehmen?  Zeit herauszufinden, wie der Status in Prometheus-Metriken angezeigt wird.  In den meisten F√§llen wird der Status durch einen bestimmten Wertesatz angezeigt.  F√ºr <code>coffee_maker_status</code> k√∂nnen beispielsweise folgende Statuswerte vorhanden sein: <br><br><ul><li>  0 - ok </li><li>  1 - aus </li><li>  2 - keine Bohnen, </li><li>  3 - kein Wasser, </li><li>  4 - scheitern. </li></ul><br>  Au√üerdem scheint es einfach zu sein: Nehmen Sie die Anzahl der Nullen, Einsen, Zweien usw.  in einer Minute ... und wir haben ausgezeichnete Daten auf dem Diagramm anzuzeigen!  Aber Prometheus hat seine eigene Ansicht dazu: <code>coffee_maker_status[1m]</code> ist ein Bereichsvektor, und daher sind Ausdr√ºcke wie <code>max_over_time(coffee_maker_status[1m]==2)</code> oder <code>count_values_over_time(coffee_maker_status[1m], 3)</code> , die sehr geeignet w√§ren, unm√∂glich. <br><br>  Alles funktioniert einwandfrei, wenn die Metrik zwei Werte enth√§lt: <code>0</code> (kein Status wurde beobachtet) und <code>1</code> (Status wurde beobachtet), und der Status selbst wird auf dem Etikett gespeichert.  Dann k√∂nnen Sie solche Anfragen stellen: <code>(max_over_time(coffee_maker_status{status="3"}[1m]) == 1) *3</code> <br><br>  Was tun mit einer Metrik mit mehreren Werten?  Der Hinweis ‚Äû <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Erstellen von Bereichsvektorfunktionen in PromQL</a> ‚Äú brachte die Idee auf, eine Metrik mit diskreten Werten in Metriken mit Beschriftungen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">umzuwandeln</a> .  Dies kann mit der folgenden Aufzeichnungsregel erfolgen: <br><br><pre> <code class="hljs pgsql">- <span class="hljs-type"><span class="hljs-type">record</span></span>: coffee_maker_status:discrete expr: | count_values("status", coffee_maker_status)</code> </pre> <br>  Diese Regel transformiert die <code>coffee_maker_status</code> Metrik <code>coffee_maker_status</code> : Wenn ein Wert von <code>3</code> <code>coffee_maker_status:discrete{status="3"}</code> , erstellt Prometheus eine <code>coffee_maker_status:discrete{status="3"}</code> Metrik <code>coffee_maker_status:discrete{status="3"}</code> mit einem Wert von 1. Und so f√ºr jeden beobachteten Wert. <br><br>  Normalerweise werden die Status im Voraus definiert, sodass Sie eine Reihe von Abfragen erstellen k√∂nnen, um die erforderlichen Werte nicht zu verpassen.  Die Legende f√ºr alle Abfragen muss √ºbereinstimmen, um die Werte zu gruppieren: <br><br><img src="https://habrastorage.org/webt/wp/lw/fr/wplwfrej6vn8i9o36vjhkytrzco.png"><br><br>  Wenn nun die Kaffeemaschine f√ºr eine Minute 30 Sekunden lang ausgeschaltet war (Status aus - <code>1</code> ) und der Rest der Zeit funktionierte (Status ok - <code>0</code> ), haben wir Informationen zum Ausschalten, weil  Das Plugin erh√§lt zwei Werte mit jeweils einer Legende: <code>0</code> von Abfrage A und <code>1</code> von Abfrage B. <br><br>  Gut: Wir haben herausgefunden, wie Daten zu diskreten Status aggregiert werden k√∂nnen, ohne dass Informationen verloren gehen.  Es bleibt abzuwarten, wie Daten basierend auf der Legende kombiniert und auf dem Bedienfeld gezeichnet werden. <br><br><h2>  Statusmap Plugin </h2><br>  Nat√ºrlich kamen wir nicht sofort zu dem, was oben beschrieben wurde, aber als dies alles zusammenkam, wurde klar, dass der Rendering-Mechanismus im Wesentlichen nicht ausreichte.  Jetzt gibt es einen solchen Mechanismus - das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Statusmap-Panel-Plugin</a> , das Folgendes tun kann: <br><br><ul><li>  Werte zu jedem Zeitpunkt werden durch das Zusammentreffen des Textes der in <i>Abfrage</i> angegebenen Legenden in K√∂rbe gruppiert; </li><li>  Jeder Legendentext hat eine eigene Linie im Diagramm und der Text wird als Beschriftung auf der Y-Achse angezeigt, und leere Werte werden als Leerzeichen oder als <code>0</code> angezeigt: <br><br><img src="https://habrastorage.org/webt/6w/3q/oc/6w3qoczr5li9fou2rktxb3h58ke.png"></li><li>  F√ºr jeden Wert k√∂nnen Sie die genaue Farbe des Warenkorbs angeben: <br><br><img src="https://habrastorage.org/webt/zn/c-/1n/znc-1nrw5teu5-mo7g4w5zhcwne.png"></li><li>  Wenn sich mehrere Werte im Warenkorb befinden, wird die Farbe f√ºr den oben auf der Registerkarte <i>Farben</i> definierten Wert verwendet. Wenn Sie den Mauszeiger √ºber den Warenkorb bewegen, werden alle Werte angezeigt, die in den Warenkorb fallen: <br><br><img src="https://habrastorage.org/webt/8o/b4/dt/8ob4dtdp_urq5r903oys4wmcwte.png"></li><li>  Das Plugin kann ein <code>interval</code> f√ºr eine Anfrage an Prometheus bilden, damit die K√∂rbe nicht zu Pixellinien werden. </li></ul><br>  Das Ergebnis ist eine sehr bequeme Darstellung des <b>Status mehrerer Objekte</b> .  Und Sie k√∂nnen sowohl den aktuellen Status (dies sind die K√∂rbe ganz rechts) als auch den Status des Objekts rechtzeitig anzeigen. <br><br><h2>  Wo zu bekommen </h2><br>  Der Quellcode f√ºr das Grafana Statusmap-Plugin wird unter der kostenlosen MIT-Lizenz verteilt <i>(√§hnlich wie bei anderen Grafana-Plugins)</i> .  Es ist derzeit auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unserem GitHub</a> verf√ºgbar.  <s>Und wir hoffen aufrichtig, dass es in naher Zukunft in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">das Grafana-Plugin-Repository aufgenommen wird</a> .</s>  <b>AKTUALISIERT (03/10/18):</b> Das Plugin wurde in den offiziellen Grafana-Katalog aufgenommen. <br><br>  Und schlie√ülich - ein Beispiel daf√ºr, wie Statusmap dabei hilft, Daten mit Status von Herden aus dem Kubernetes-Produktionscluster zu visualisieren: <br><br><img src="https://habrastorage.org/webt/mp/xc/lv/mpxclvizmci-pbwjjqpmy6zvwaw.png"><br><br><h2>  PS </h2><br>  Lesen Sie auch in unserem Blog: <br><br><ul><li>  ‚Äû <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Einf√ºhrung von Loghouse - ein Open-Source-System f√ºr die Arbeit mit Protokollen in Kubernetes</a> ‚Äú; </li><li>  "Wir f√ºhren <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">offiziell das Dienstprogramm dapp - DevOps zur Wartung von CI / CD ein</a> ." </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de423851/">https://habr.com/ru/post/de423851/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de423837/index.html">Wie kann man ein Projekt schnell ruinieren? 17 besten schlechten Tipps</a></li>
<li><a href="../de423839/index.html">sha256 Test pro ZahnOK f√ºr neuronales Netzwerk</a></li>
<li><a href="../de423843/index.html">Wenn Sie in Kasan oder Nowosibirsk sind und Mikrochips wie in Cupertino entwerfen m√∂chten</a></li>
<li><a href="../de423845/index.html">Firmenkondom</a></li>
<li><a href="../de423847/index.html">Farb- und Lichterkennung mit APDS-9960</a></li>
<li><a href="../de423853/index.html">Funktionsweise des S3 DataLine-Speichers</a></li>
<li><a href="../de423855/index.html">Zyxel-Nebel - einfache Verwaltung als Grundlage f√ºr Einsparungen</a></li>
<li><a href="../de423857/index.html">6 Herausforderungen, denen Sie begegnen werden, wenn Sie das Programmieren selbst lernen</a></li>
<li><a href="../de423861/index.html">Solarlaternen - wir brauchen hellere</a></li>
<li><a href="../de423863/index.html">Konfrontation bei PHDays 8 - SOC View</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>