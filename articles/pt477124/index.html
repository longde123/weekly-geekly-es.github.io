<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèÇ üòø üßìüèΩ Bitcoin em uma gaiola? ü§≥üèª üë®üèΩ‚Äçüé® üëµüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aconteceu que eu sou um administrador profissional de sistemas e redes de computadores (em resumo: sysadmin) e, por acaso, contei ao prof. a atividade...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bitcoin em uma gaiola?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/477124/"><p> Aconteceu que eu sou um administrador profissional de sistemas e redes de computadores (em resumo: sysadmin) e, por acaso, contei ao prof.  a atividade de uma ampla variedade de sistemas, incluindo aqueles que exigem [por causa] das medidas de seguran√ßa acima.  E aconteceu que, h√° algum tempo, achei o <a href="https://www.lopp.net/bitcoin-information.html">Bitcoin</a> interessante para mim, e n√£o apenas o usei, mas tamb√©m lan√ßou v√°rios microsservi√ßos para aprender a trabalhar independentemente com a rede Bitcoin (afinal, √© p2p) do ponto de vista do desenvolvimento. (Eu, √© claro, sou um desenvolvedor, ent√£o, deixei passar).  Mas n√£o estou falando de desenvolvimento, mas de um ambiente seguro e eficaz para aplicativos. </p><a name="habracut"></a><br><p>  As tecnologias financeiras ( <em>fintech</em> ) acompanham a seguran√ßa da informa√ß√£o ( <em>infosec</em> ) e a primeira pode funcionar sem a segunda, mas n√£o por muito tempo.  √â por isso que quero compartilhar minha experi√™ncia e o conjunto de ferramentas que eu uso, que inclui <em>fintech</em> e <em>infosec</em> , e, ao mesmo tempo, tamb√©m pode ser usado para um prop√≥sito mais amplo ou completamente diferente.  Neste artigo, falarei pouco sobre Bitcoin, mas sobre o modelo de infraestrutura para desenvolver e operar servi√ßos financeiros (e n√£o apenas) - em uma palavra, os servi√ßos em que "B" √© importante.  Isso se aplica tanto √† troca de Bitcoin quanto ao zool√≥gico corporativo mais t√≠pico dos servi√ßos de uma pequena empresa sem bitcoin de forma alguma. </p><br><p>  Quero observar que sou um defensor dos princ√≠pios de <em>"mantenha as coisas est√∫pidas simples"</em> e <em>"menos √© mais"</em> ; portanto, tanto o artigo como o descrito nele ter√£o as propriedades sobre as quais esses princ√≠pios s√£o. </p><br><p>  <em>Cen√°rio imagin√°rio:</em> vamos dar uma olhada em um exemplo de trocador de bitcoin.  Decidimos come√ßar a trocar rublos, d√≥lares, euros por bitcoins e vice-versa, e j√° temos uma solu√ß√£o funcional, mas por outro dinheiro digital como kiwi e webmoney, ou seja,  encerramos todas as quest√µes legais, existe um aplicativo pronto que funciona como um gateway de pagamento para rublos, d√≥lares e euros e outros sistemas de pagamento.  Ele est√° vinculado √†s nossas contas banc√°rias e possui algum tipo de API para nossos aplicativos finais.  Tamb√©m temos um aplicativo da web que atua como um trocador de usu√°rios, como uma conta t√≠pica de kiwi ou webmoney - abra uma conta, adicione um cart√£o e assim por diante.  Ele se comunica com nosso aplicativo de gateway, embora use a API REST na LAN.  Por isso, decidimos conectar bitcoins e, ao mesmo tempo, atualizar a infraestrutura, porque  inicialmente tudo foi levado √†s caixas virtuais no escrit√≥rio embaixo da mesa ... eles come√ßaram a usar o site e come√ßamos a nos preocupar com tempo de atividade e desempenho. </p><br><p>  Ent√£o, vamos come√ßar com a sele√ß√£o principal de um servidor.  Porque  como a empresa em nosso exemplo √© pequena e confiamos no hoster (OVH), escolheremos uma <a href="https://www.kimsufi.com/">op√ß√£o de or√ßamento</a> na qual voc√™ n√£o pode instalar o sistema a partir da imagem .iso original, mas isso n√£o importa, o departamento de seguran√ßa de TI analisar√° definitivamente a imagem instalada.  E quando crescermos, geralmente alugamos nosso arm√°rio com chave e acesso f√≠sico limitado, ou talvez construamos nosso pr√≥prio CD.  De qualquer forma, vale lembrar que, ao alugar ferro e instalar imagens prontas, √© poss√≠vel que seu sistema tenha um ‚Äúcavalo de troia do host‚Äù, que na maioria dos casos n√£o se destina a rastrear voc√™, mas a oferecer ferramentas de gerenciamento mais convenientes servidor. </p><br><p>  <strong>Instala√ß√£o do servidor</strong> </p><br><p>  Tudo √© simples aqui.  N√≥s escolhemos o ferro que se adapte √†s nossas necessidades.  Depois selecione a imagem do FreeBSD.  Bem, n√≥s nos conectamos (no caso de outro hoster e nosso pr√≥prio hardware) via IPMI ou com um monitor e alimentamos a imagem .iso FreeBSD para o download.  Para instala√ß√µes orquestrais, uso <a href="https://github.com/ansible/ansible">Ansible</a> e <a href="https://mfsbsd.vx.sk/">mfsbsd</a> .  A √∫nica coisa, no nosso caso com o kimsufi, escolhemos a <em>instala√ß√£o personalizada</em> para que os dois discos no espelho tivessem apenas as "parti√ß√µes de inicializa√ß√£o" e / home "abertas", o restante do espa√ßo em disco ser√° criptografado, mas mais sobre isso posteriormente. </p><br><p><img src="https://habrastorage.org/webt/-m/ve/av/-mveavdklaybhokh5sznmisf7be.png"></p><br><p>  O sistema √© instalado da maneira padr√£o, n√£o vou parar por a√≠, s√≥ observo que, antes de iniciar a opera√ß√£o, vale a pena prestar aten√ß√£o nas op√ß√µes de <em>prote√ß√£o</em> que o <code>bsdinstaller</code> oferece no final da instala√ß√£o (se voc√™ mesmo instalar o sistema): </p><br><p><img src="https://habrastorage.org/webt/pj/6w/no/pj6wnohhskxkw6vqigcucollot0.png"></p><br><p>  H√° um <a href="http://bsdadventures.com/harden-freebsd/">bom material</a> sobre esse t√≥pico, resumindo, repetirei aqui. </p><br><p>  √â poss√≠vel ativar os par√¢metros acima da mesma maneira em um sistema j√° instalado.  Para fazer isso, edite o arquivo do carregador de inicializa√ß√£o e ative os par√¢metros do kernel.  * <em>ee √© um editor como este no BSD</em> </p><br><p> <code># ee /etc/rc.conf</code> </p> <br><pre> <code class="plaintext hljs">... #sec hard clear_tmp_enable="YES" syslogd_flags="-ss" sendmail_enable="NONE"</code> </pre><br><p> <code># ee /etc/sysctl.conf</code> </p> <br><pre> <code class="plaintext hljs">... #sec hard security.bsd.see_other_uids=0 security.bsd.see_other_gids=0 security.bsd.unprivileged_read_msgbuf=0 security.bsd.unprivileged_proc_debug=0 kern.randompid=$(jot -r 1 9999) security.bsd.stack_guard_page=1</code> </pre> <br><p>  Tamb√©m vale a pena garantir que voc√™ tenha a vers√£o mais recente do sistema instalada e <a href="https://www.freebsd.org/doc/handbook/updating-upgrading-freebsdupdate.html">concluir todas as atualiza√ß√µes e atualiza√ß√µes</a> .  No nosso caso, por exemplo, √© necess√°ria uma atualiza√ß√£o para a vers√£o mais recente, porque  as imagens de pr√©-instala√ß√£o ficam seis meses a um ano atrasadas.  Bem, l√° mudamos a porta SSH para outra por padr√£o, adicionamos autentica√ß√£o de chave e desabilitamos com uma senha. </p><br><p>  Em seguida, configuramos o <code>aide</code> , monitorando o estado dos arquivos de configura√ß√£o do sistema.  Mais mastigado pode ser lido <a href="https://www.digitalocean.com/community/tutorials/how-to-install-aide-on-a-digitalocean-vps">aqui</a> . </p><br><p> <code>pkg install aide</code> </p> <br><p>  e edite nosso crontab </p><br><p> <code>crontab -e</code> </p> <br><p> <code>06 01 * * 0-6 /root/chkaide.sh</code> </p> <br><pre> <code class="plaintext hljs">#! /bin/sh #chkaide.sh MYDATE=`date +%Y-%m-%d` MYFILENAME="Aide-"$MYDATE.txt /bin/echo "Aide check !! `date`" &gt; /tmp/$MYFILENAME /usr/local/bin/aide --check &gt; /tmp/myAide.txt /bin/cat /tmp/myAide.txt|/usr/bin/grep -v failed &gt;&gt; /tmp/$MYFILENAME /bin/echo "**************************************" &gt;&gt; /tmp/$MYFILENAME /usr/bin/tail -20 /tmp/myAide.txt &gt;&gt; /tmp/$MYFILENAME /bin/echo "****************DONE******************" &gt;&gt; /tmp/$MYFILENAME</code> </pre> <br><p>  Ativar a <a href="https://www.freebsd.org/doc/handbook/audit-config.html">auditoria do sistema</a> </p><br><p> <code>sysrc auditd_enable=YES</code> </p> <br><p> <code># service auditd start</code> </p> <br><p>  Como administrar esse neg√≥cio est√° bem descrito no <a href="https://www.freebsd.org/doc/handbook/audit-administration.html">manual</a> . </p><br><p>  Agora reinicializamos e prosseguimos com o software no servidor.  Cada servidor √© um hypervisor para cont√™ineres ou m√°quinas virtuais completas.  Portanto, √© importante que o processador ofere√ßa suporte a VT-x e EPT se planejamos usar a virtualiza√ß√£o completa. </p><br><p>  Como um gerenciamento de cont√™iner e m√°quina virtual, eu uso o <a href="https://bsdstore.ru/">clevd</a> da <a href="https://github.com/olevole">olevole</a> , desejo a ele mais sa√∫de e benef√≠cios por esse maravilhoso utilit√°rio! </p><br><p>  <strong>Containers?</strong>  <strong>Novamente janela de encaixe ou o qu√™?</strong> </p><br><p>  Mas n√£o.  <a href="https://www.freebsd.org/doc/handbook/jails.html">O FreeBSD Jails</a> √© uma √≥tima ferramenta de cont√™iner, mas o <code>cbsd</code> mencionado <code>cbsd</code> para orquestrar esses cont√™ineres, cujo nome √© c√©lulas. </p><br><p>  Uma c√©lula √© uma solu√ß√£o extremamente eficaz para a constru√ß√£o de infraestrutura para uma variedade de prop√≥sitos, o que requer o isolamento completo de servi√ßos ou processos individuais.  Este √© essencialmente um clone do sistema host, mas n√£o requer virtualiza√ß√£o completa do hardware.  E os recursos resultantes disso n√£o s√£o gastos em um "SO convidado", mas apenas no trabalho realizado.  Quando as c√©lulas s√£o usadas para necessidades internas, essa √© uma solu√ß√£o muito conveniente para o uso ideal do recurso - v√°rias c√©lulas em um servidor de ferro podem usar individualmente todo o recurso do servidor, se necess√°rio.  Dado que sub-servi√ßos geralmente diferentes precisam de mais.  recursos em momentos diferentes, voc√™ pode extrair o desempenho m√°ximo de um servidor, se planejar e desequilibrar as c√©lulas entre os servidores corretamente.  Se necess√°rio, as c√©lulas tamb√©m podem definir limites para o recurso usado. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/95c/817/901/95c8179015447a58c383f4a4a81a510d.gif" alt="imagem"></p><br><p>  <strong>E a virtualiza√ß√£o completa?</strong> </p><br><p>  At√© onde eu sei, o <code>cbsd</code> ap√≥ia o trabalho dos hipervisores <code>bhyve</code> e XEN.  Eu nunca usei o segundo, mas o primeiro √© um <a href="https://www.freebsd.org/doc/handbook/virtualization-host-bhyve.html">hypervisor</a> relativamente jovem <a href="https://www.freebsd.org/doc/handbook/virtualization-host-bhyve.html">do FreeBSD</a> .  Veremos um exemplo de uso de <code>bhyve</code> no exemplo abaixo. </p><br><p>  <strong>Instale e configure o ambiente do host</strong> </p><br><p>  N√≥s usamos o FS <a href="https://www.freebsd.org/doc/handbook/zfs.html">ZFS</a> .  Esta √© uma ferramenta extremamente poderosa para gerenciar o espa√ßo no servidor.  Gra√ßas ao ZFS, voc√™ pode criar diretamente matrizes de v√°rias configura√ß√µes diretamente de discos, expandir dinamicamente o espa√ßo "quente", alterar discos mortos, gerenciar instant√¢neos e muito, muito mais, que pode ser descrito em uma s√©rie de artigos.  Vamos voltar ao nosso servidor e seus discos.  No in√≠cio da instala√ß√£o em discos, deixamos espa√ßo livre para parti√ß√µes criptografadas.  Porque  Isso √© para que o sistema suba automaticamente e ou√ßa no SSH. </p><br><p> <code>gpart add -t freebsd-zfs /dev/ada0</code> </p> <br><p> <code>/dev/ada0p4 added!</code> </p> <br><p>  adicione a parti√ß√£o do disco ao espa√ßo restante </p><br><p> <code>geli init /dev/ada0p4</code> </p> <br><p>  dirigir nossa senha de criptografia </p><br><p> <code>geli attach /dev/ada0p4</code> </p> <br><p>  digite novamente a senha e temos o dispositivo /dev/ada0p4.eli - este √© o nosso espa√ßo criptografado.  Em seguida, repetimos o mesmo para / dev / ada1 e outros discos na matriz.  E crie um novo <a href="https://www.freebsd.org/doc/handbook/zfs-zpool.html">pool do ZFS</a> . </p><br><p>  <code>zpool create vms mirror /dev/ada0p4.eli /dev/ada1p4.eli /dev/ada3p4.eli</code> - bem, agora temos o conjunto m√≠nimo de combate pronto.  Uma matriz de disco espelhada no caso de uma das tr√™s falhar. </p><br><p>  Crie um conjunto de dados no novo "pool" </p><br><p> <code>zfs create vms/jails</code> </p> <br><p>  <code>pkg install cbsd</code> - execute o comando e instale o gerenciamento para nossas c√©lulas. </p><br><p>  Ap√≥s a instala√ß√£o do <code>cbsd</code> , ele precisa ser inicializado: </p><br><p> <code># env workdir="/vms/jails" /usr/local/cbsd/sudoexec/initenv</code> </p> <br><p>  Bem, respondemos a v√°rias perguntas, principalmente respostas por padr√£o. </p><br><p>  * Se voc√™ usar criptografia, √© importante que o daemon <code>cbsdd</code> seja iniciado automaticamente at√© que voc√™ descriptografe os discos manual ou automaticamente (em nosso exemplo, o zabbix faz isso) </p><br><p>  ** Al√©m disso, eu n√£o uso o NAT do <code>cbsd</code> , mas configuro-o pessoalmente no <code>pf</code> . </p><br><p> <code># sysrc pf_enable=YES</code> </p> <br><p> <code># ee /etc/pf.conf</code> </p> <br><pre> <code class="plaintext hljs">IF_PUBLIC="em0" IP_PUBLIC="1.23.34.56" JAIL_IP_POOL="192.168.0.0/24" #WHITE_CL="{ 127.0.0.1 }" icmp_types="echoreq" set limit { states 20000, frags 20000, src-nodes 20000 } set skip on lo0 scrub in all #NAT for jails nat pass on $IF_PUBLIC from $JAIL_IP_POOL to any -&gt; $IP_PUBLIC ## Bitcoin network port forward IP_JAIL="192.168.0.1" PORT_JAIL="{8333}" rdr pass on $IF_PUBLIC proto tcp from any to $IP_PUBLIC port $PORT_JAIL -&gt; $IP_JAIL</code> </pre><br><p> <code># service pf start</code> </p> <br><p> <code># pfctl -f /etc/pf.conf</code> </p> <br><p>  A configura√ß√£o de pol√≠ticas de firewall tamb√©m √© um t√≥pico separado, por isso n√£o vou me aprofundar na configura√ß√£o de pol√≠ticas de BLOCK ALL e na defini√ß√£o de listas de permiss√µes; voc√™ pode fazer isso lendo a <a href="https://www.freebsd.org/doc/handbook/firewalls-pf.html">documenta√ß√£o oficial</a> ou qualquer grande n√∫mero de artigos dispon√≠veis no Google. </p><br><p>  Bem ... temos o cbsd instalado, √© hora de criar nosso primeiro cavalo de trabalho - um dem√¥nio bitcoin em uma gaiola! </p><br><p> <code>cbsd jconstruct-tui</code> </p> <br><p><img src="https://habrastorage.org/webt/jf/yn/l5/jfynl5o0yozaua314r4e65yxy0y.png"></p><br><p>  Aqui vemos o di√°logo de cria√ß√£o de c√©lulas.  Depois que todos os valores estiverem definidos, crie! </p><br><p>  Ao criar a primeira c√©lula, voc√™ deve escolher o que usar como base para as c√©lulas.  Eu seleciono o kit de distribui√ß√£o no reposit√≥rio do FreeBSD com o comando <code>repo</code> .  Essa escolha √© feita apenas ao criar a primeira c√©lula de uma vers√£o espec√≠fica (voc√™ pode hospedar c√©lulas de qualquer vers√£o anterior √† vers√£o do host). </p><br><p>  Depois que tudo estiver instalado - execute a c√©lula! </p><br><p> <code># cbsd jstart bitcoind</code> </p> <br><p>  Mas precisamos instalar o software na gaiola. </p><br><p> <code># jls</code> </p> <br><pre> <code class="plaintext hljs"> JID IP Address Hostname Path 1 192.168.0.1 bitcoind.space.com /zroot/jails/jails/bitcoind</code> </pre> <br><p>  <code>jexec bitcoind</code> para entrar no console da c√©lula </p><br><p>  e j√° dentro da c√©lula, instalamos o software com suas depend√™ncias (nosso sistema host permanece limpo) </p><br><p> <code>bitcoind:/@[15:25] # pkg install bitcoin-daemon bitcoin-utils</code> </p> <br><p> <code>bitcoind:/@[15:30] # sysrc bitcoind_enable=YES</code> </p> <br><p> <code>bitcoind:/@[15:30] # service bitcoind start</code> </p> <br><p>  H√° bitcoin na c√©lula, mas precisamos de anonimato, porque queremos conectar-se a algumas c√©lulas atrav√©s da rede TOP.  Em geral, temos planos de transformar a maioria das c√©lulas com software suspeito apenas por meio de um proxy.  Gra√ßas ao <code>pf</code> voc√™ pode desativar o NAT para um intervalo espec√≠fico de endere√ßos IP na rede local e permitir o NAT apenas para o nosso n√≥ TOR.  Portanto, mesmo que o malware entre na c√©lula, ele provavelmente n√£o entrar√° em contato com o mundo exterior e, se o fizer, n√£o revelar√° o IP do nosso servidor.  portanto, criamos mais uma c√©lula, para servi√ßos de "encaminhamento" como um servi√ßo ".onion" e como um proxy para acessar a Internet em c√©lulas individuais. </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart tor</code> </p> <br><p> <code># jexec tor</code> </p> <br><p> <code>tor:/@[15:38] # pkg install tor</code> </p> <br><p> <code>tor:/@[15:38] # sysrc tor_enable=YES</code> </p> <br><p> <code>tor:/@[15:38] # ee /usr/local/etc/tor/torrc</code> </p> <br><p>  Colocamos listen no endere√ßo local (dispon√≠vel para todas as c√©lulas) </p><br><p> <code>SOCKSPort 192.168.0.2:9050</code> </p> <br><p>  O que ainda falta para a felicidade completa.  Sim, precisamos de um servi√ßo para a nossa web, talvez n√£o um.  Execute o nginx, que atuar√° como proxy reverso e cuidar√° da renova√ß√£o dos certificados Let's Encrypt </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart nginx-rev</code> </p> <br><p> <code># jexec nginx-rev</code> </p> <br><p> <code>nginx-rev:/@[15:47] # pkg install nginx py36-certbot</code> </p> <br><p>  <em>E agora colocamos 150 MB de depend√™ncias em uma gaiola.</em>  <em>E o anfitri√£o ainda est√° limpo.</em> </p><br><p>  voltemos a configurar o nginx posteriormente, precisamos criar mais duas c√©lulas para o nosso gateway de pagamento para nodejs e rust e um aplicativo da web, que por algum motivo est√° no apache e no pkhp, e o banco de dados MySQL tamb√©m √© necess√°rio para o √∫ltimo. </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart paygw</code> </p> <br><p> <code># jexec paygw</code> </p> <br><p> <code>paygw:/@[15:55] # pkg install git node npm</code> </p> <br><p> <code>paygw:/@[15:55] # curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh</code> </p> <br><p>  <em>... e outros 380 MB de pacotes isolados</em> </p><br><p>  Em seguida, aumentamos nosso aplicativo com git e o executamos. </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart webapp</code> </p> <br><p> <code># jexec webapp</code> </p> <br><p> <code>webapp:/@[16:02] # pkg install mariadb104-server apache24 php74 mod_php74 php74-pdo_mysql</code> </p> <br><p>  <em>Pacotes de 450 MB.</em>  <em>na gaiola.</em> </p><br><p>  aqui, damos ao desenvolvedor acesso via SSH diretamente √† c√©lula, eles far√£o tudo sozinhos: </p><br><p> <code>webapp:/@[16:02] # ee /etc/ssh/sshd_config</code> </p> <br><p>  <code>Port 2267</code> - altere a porta da c√©lula SSH para qualquer </p><br><p> <code>webapp:/@[16:02] # sysrc sshd_enable=YES</code> </p> <br><p> <code>webapp:/@[16:02] # service sshd start</code> </p> <br><p>  Bem, o servi√ßo est√° em execu√ß√£o, resta adicionar uma regra no firewall <code>pf</code> </p><br><p>  Vamos ver qual IP temos nas c√©lulas e como √© o nosso "lokalka" </p><br><p> <code># jls</code> </p> <br><pre> <code class="plaintext hljs"> JID IP Address Hostname Path 1 192.168.0.1 bitcoind.space.com /zroot/jails/jails/bitcoind 2 192.168.0.2 tor.space.com /zroot/jails/jails/tor 3 192.168.0.3 nginx-rev.space.com /zroot/jails/jails/nginx-rev 4 192.168.0.4 paygw.space.com /zroot/jails/jails/paygw 5 192.168.0.5 webapp.my.domain /zroot/jails/jails/webapp</code> </pre> <br><p>  e adicione uma regra </p><br><p> <code># ee /etc/pf.conf</code> </p> <br><pre> <code class="plaintext hljs">## SSH for web-Devs IP_JAIL="192.168.0.5" PORT_JAIL="{ 2267 }" rdr pass on $IF_PUBLIC proto tcp from any to $IP_PUBLIC port $PORT_JAIL -&gt; $IP_JAIL</code> </pre><br><p>  Bem, como estamos aqui, adicionaremos a mesma regra no proxy reverso: </p><br><pre> <code class="plaintext hljs">## web-ports for nginx-rev IP_JAIL="192.168.0.3" PORT_JAIL="{ 80, 443 }" rdr pass on $IF_PUBLIC proto tcp from any to $IP_PUBLIC port $PORT_JAIL -&gt; $IP_JAIL</code> </pre> <br><p> <code># pfctl -f /etc/pf.conf</code> </p> <br><p>  <strong>Bem, agora um pouco sobre bitcoins</strong> </p><br><p>  O que temos - temos um aplicativo da web que √© acess√≠vel de fora e se comunica localmente com nosso gateway de pagamento.  Agora precisamos preparar um ambiente de trabalho para intera√ß√£o com a pr√≥pria rede bitcoin - o n√≥ <code>bitcoind</code> √© apenas um daemon que suporta uma c√≥pia local da blockchain atual.  Este daemon possui funcionalidade RPC e carteira, mas existem "wrappers" mais convenientes para o desenvolvimento de aplicativos.  Para come√ßar, decidimos colocar <code>electrum</code> - esta √© uma carteira CLI.  Usaremos <a href="https://electrum.org/">essa carteira</a> como um "armazenamento a frio" para nossos bitcoins - em geral, aqueles que precisar√£o ser armazenados "fora" do sistema, acess√≠veis aos usu√°rios e geralmente afastados de todos.  Ele tamb√©m tem uma interface gr√°fica, ent√£o vamos usar a mesma carteira no nosso <br>  laptops.  Enquanto usaremos o electrum com servidores p√∫blicos, e posteriormente em outra c√©lula, <a href="https://github.com/kyuupichan/electrumx">criaremos o ElectrumX</a> , para que n√£o dependa de ningu√©m. </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart electrum</code> </p> <br><p> <code># jexec electrum</code> </p> <br><p> <code>electrum:/@[8:45] # pkg install py36-electrum</code> </p> <br><p>  <em>outros 700 MB de software em nossa gaiola</em> </p><br><p> <code>electrum:/@[8:53] # adduser</code> </p> <br><pre> <code class="plaintext hljs">Username: wallet Full name: Uid (Leave empty for default): Login group [wallet]: Login group is wallet. Invite wallet into other groups? []: Login class [default]: Shell (sh csh tcsh nologin) [sh]: tcsh Home directory [/home/wallet]: Home directory permissions (Leave empty for default): Use password-based authentication? [yes]: no Lock out the account after creation? [no]: Username : wallet Password : &lt;disabled&gt; Full Name : Uid : 1001 Class : Groups : wallet Home : /home/wallet Home Mode : Shell : /bin/tcsh Locked : no OK? (yes/no): yes adduser: INFO: Successfully added (wallet) to the user database. Add another user? (yes/no): no Goodbye! electrum:/@[8:53] # su wallet</code> </pre> <br><p> <code>electrum:/@[8:53] # su wallet</code> </p> <br><p> <code>wallet@electrum:/ % electrum-3.6 create</code> </p> <br><pre> <code class="plaintext hljs">{ "msg": "Please keep your seed in a safe place; if you lose it, you will not be able to restore your wallet.", "path": "/usr/home/wallet/.electrum/wallets/default_wallet", "seed": "jealous win pig material ribbon young punch visual okay cactus random bird" }</code> </pre> <br><p>  Agora criamos uma carteira. </p><br><p> <code>wallet@electrum:/ % electrum-3.6 listaddresses</code> </p> <br><pre> <code class="plaintext hljs">[ "18WEhbjvMLGRMfwudzUrUd25U5C7uZYkzE", "14XHSejhxsZNDRtk4eFbqAX3L8rftzwQQU", "1KQXaN8RXiCN1ne9iYngUWAr6KJ6d4pPas", ... "1KeVcAwEYhk29qEyAfPwcBgF5mMMoy4qjw", "18VaUuSeBr6T2GwpSHYF3XyNgLyLCt1SWk" ]</code> </pre> <br><p> <code>wallet@electrum:/ % electrum-3.6 help</code> </p> <br><p>  A partir de agora, apenas um c√≠rculo limitado de pessoas poder√° se conectar √† nossa carteira <em>na cadeia</em> .  Para n√£o abrir o acesso externo a esta c√©lula, as conex√µes SSH ocorrer√£o atrav√©s do TOR (uma vers√£o descentralizada da VPN).  Iniciamos o SSH na c√©lula, mas n√£o tocamos em nosso pf.conf no host. </p><br><p> <code>electrum:/@[9:00] # sysrc sshd_enable=YES</code> </p> <br><p> <code>electrum:/@[9:00] # service sshd start</code> </p> <br><p>  Agora desligue o acesso √† Internet da c√©lula com a carteira.  Daremos a ele um endere√ßo IP de outro espa√ßo de sub-rede que n√£o seja baseado em NAT.  Primeiro, altere <code>/etc/pf.conf</code> no host </p><br><p> <code># ee /etc/pf.conf</code> </p> <br><p>  <code>JAIL_IP_POOL="192.168.0.0/24"</code> mude para <code>JAIL_IP_POOL="192.168.0.0/25"</code> , portanto, todos os endere√ßos 192.168.0.126-255 n√£o ter√£o acesso direto √† Internet.  Uma esp√©cie de software "air-gap" da rede.  E a regra da NAT permanece como era </p><br><p> <code>nat pass on $IF_PUBLIC from $JAIL_IP_POOL to any -&gt; $IP_PUBLIC</code> </p> <br><p>  Sobrecarregando as regras </p><br><p> <code># pfctl -f /etc/pf.conf</code> </p> <br><p>  Agora pegue nossa gaiola </p><br><p> <code># cbsd jconfig jname=electrum</code> </p> <br><p><img src="https://habrastorage.org/webt/mj/zo/ui/mjzouia2v_lhuzln_o9inimlwca.png"></p><br><p><img src="https://habrastorage.org/webt/_x/7-/c9/_x7-c9zdmlojjeqrpzfmv2j5fpc.png"></p><br><pre> <code class="plaintext hljs">jset mode=quiet jname=electrum ip4_addr="192.168.0.200" Remove old IP: /sbin/ifconfig em0 inet 192.168.0.6 -alias Setup new IP: /sbin/ifconfig em0 inet 192.168.0.200 alias ip4_addr: 192.168.0.200</code> </pre> <br><p>  Hmm, mas agora o sistema em si vai parar de funcionar para n√≥s.  No entanto, podemos especificar um proxy do sistema.  Mas h√° uma coisa, mas, no TOR, √© um proxy SOCKS5 e, por conveni√™ncia, tamb√©m ter√≠amos um proxy HTTP. </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart polipo</code> </p> <br><p> <code># jexec polipo</code> </p> <br><p> <code>polipo:/@[9:28] # pkg install polipo</code> </p> <br><p> <code>polipo:/@[9:28] # ee /usr/local/etc/polipo/config</code> </p> <br><pre> <code class="plaintext hljs">socksParentProxy = "192.168.0.2:9050" socksProxyType = socks5</code> </pre> <br><p> <code>polipo:/@[9:42] # sysrc polipo_enable=YES</code> </p> <br><p> <code>polipo:/@[9:43] # service polipo start</code> </p> <br><p>  Bem, agora em nosso sistema existem dois proxies, e ambos saem via TOR: socks5: //192.168.0.2: 9050 e <a href="http://192.168.0.6:8123/">http://192.168.0.6:8123</a> </p><br><p>  Agora voc√™ pode personalizar o ambiente da nossa carteira </p><br><p> <code># jexec electrum</code> </p> <br><p> <code>electrum:/@[9:45] # su wallet</code> </p> <br><p> <code>wallet@electrum:/ % ee ~/.cshrc</code> </p> <br><pre> <code class="plaintext hljs">#in the end of file proxy config setenv http_proxy http://192.168.0.6:8123 setenv https_proxy http://192.168.0.6:8123</code> </pre> <br><p>  Bem, agora o shell funcionar√° sob um proxy.  Se voc√™ deseja instalar pacotes, adicione <code>/usr/local/etc/pkg.conf</code> abaixo da raiz </p><br><pre> <code class="plaintext hljs">pkg_env: { http_proxy: "http://my_proxy_ip:8123", }</code> </pre> <br><p>  Bem, agora √© hora de adicionar o servi√ßo oculto TOR como o endere√ßo do nosso servi√ßo SSH na c√©lula da carteira. </p><br><p> <code># jexec tor</code> </p> <br><p> <code>tor:/@[9:59] # ee /usr/local/etc/tor/torrc</code> </p> <br><pre> <code class="plaintext hljs">HiddenServiceDir /var/db/tor/electrum/ HiddenServicePort 22 192.168.0.200:22</code> </pre> <br><p> <code>tor:/@[10:01] # mkdir /var/db/tor/electrum</code> </p> <br><p> <code>tor:/@[10:01] # chown -R _tor:_tor /var/db/tor/electrum</code> </p> <br><p> <code>tor:/@[10:01] # chmod 700 /var/db/tor/electrum</code> </p> <br><p> <code>tor:/@[10:03] # service tor restart</code> </p> <br><p> <code>tor:/@[10:04] # cat /var/db/tor/electrum/hostname</code> </p> <br><pre> <code class="plaintext hljs">mdjus4gmduhofwcso57b3zl3ufoitguh2knitjco5cmgrokpreuxumad.onion</code> </pre> <br><p>  Aqui est√° o nosso endere√ßo de conex√£o.  Vamos verificar na m√°quina local.  Mas primeiro voc√™ precisa adicionar nossa chave SSH: </p><br><p> <code>wallet@electrum:/ % mkdir ~/.ssh</code> </p> <br><p> <code>wallet@electrum:/ % ee ~/.ssh/authorized_keys</code> </p> <br><pre> <code class="plaintext hljs">ecdsa-sha2-nistp521 AAAAE2VjZHNhLXNoYTItbmlzdHA1MjEAAAAIbmlzdHA1MjEAAACFBAG9Fk2Lqi4GQ8EXZrsH3EgSrVIQPQaAlS38MmJLBabihv9KHIDGXH7r018hxqLNNGbaJWO/wrWk7sG4T0yLHAbdQAFsMYof9kjoyuG56z0XZ8qaD/X/AjrhLMsIoBbUNj0AzxjKNlPJL4NbHsFwbmxGulKS0PdAD5oLcTQi/VnNdU7iFw== user@local</code> </pre> <br><p>  Bem, a partir da m√°quina Linux cliente </p><br><p> <code>user@local ~$ nano ~/.ssh/config</code> </p> <br><pre> <code class="plaintext hljs">#remote electrum wallet Host remotebtc User wallet Port 22 Hostname mdjus4gmduhofwcso57b3zl3ufoitguh2knitjco5cmgrokpreuxumad.onion ProxyCommand /bin/ncat --proxy localhost:9050 --proxy-type socks5 %h %p</code> </pre><br><p>  Conectar <em>(Para que isso funcione, voc√™ precisa de um daemon TOR local que escute no 9050)</em> </p><br><p> <code>user@local ~$ ssh remotebtc</code> </p> <br><pre> <code class="plaintext hljs">The authenticity of host 'mdjus4gmduhofwcso57b3zl3ufoitguh2knitjco5cmgrokpreuxumad.onion (&lt;no hostip for proxy command&gt;)' can't be established. ECDSA key fingerprint is SHA256:iW8FKjhVF4yyOZB1z4sBkzyvCM+evQ9cCL/EuWm0Du4. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added 'mdjus4gmduhofwcso57b3zl3ufoitguh2knitjco5cmgrokpreuxumad.onion' (ECDSA) to the list of known hosts. FreeBSD 12.1-RELEASE-p1 GENERIC To save disk space in your home directory, compress files you rarely use with "gzip filename". -- Dru &lt;genesis@istar.ca&gt; wallet@electrum:~ % logout</code> </pre><br><p>  Sucesso! </p><br><p>  Para trabalhar com pagamentos instant√¢neos e micropagamentos, tamb√©m precisamos do n√≥ <a href="https://www.lopp.net/lightning-information.html">Lightning Network</a> ; de fato, essa ser√° nossa principal ferramenta de trabalho com bitcoin.  * O <a href="https://github.com/ElementsProject/lightning">C-lightning</a> , que vamos usar como daemon, possui <a href="https://github.com/fiatjaf/sparko">um plugin Sparko</a> , que √© uma interface HTTP (REST) ‚Äã‚Äãcompleta e permite trabalhar com transa√ß√µes fora da cadeia e transa√ß√µes na cadeia.  <code>c-lightning</code> requer um n√≥ <code>bitcoind</code> para funcionar. </p><br><p>  * <em>Existem implementa√ß√µes diferentes em diferentes PLs do protocolo Lightning Network.</em>  <em>Aqueles que testamos o c-lightning (escrito em C) pareciam os mais est√°veis ‚Äã‚Äãe eficientes em termos de recursos</em> </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart cln</code> </p> <br><p> <code># jexec cln</code> </p> <br><p> <code>lightning:/@[10:23] # adduser</code> </p> <br><pre> <code class="plaintext hljs">Username: lightning ...</code> </pre> <br><p> <code>lightning:/@[10:24] # pkg install git</code> </p> <br><p> <code>lightning:/@[10:23] # su lightning</code> </p> <br><p> <code>cd ~ &amp;&amp; git clone https://github.com/ElementsProject/lightning</code> </p> <br><p> <code>lightning@lightning:~ % exit</code> </p> <br><p> <code>lightning:/@[10:30] # cd /home/lightning/lightning/</code> </p> <br><p> <code>lightning:/home/lightning/lightning@[10:31] # pkg install autoconf automake gettext git gmp gmake libtool python python3 sqlite3 libsodium py36-mako bash bitcoin-utils</code> </p> <br><p> <code>lightning:/home/lightning/lightning@[10:34] # ./configure &amp;&amp; gmake &amp;&amp; gmake install</code> </p> <br><p>  Enquanto tudo o que voc√™ precisa √© compilado e instalado, crie o usu√°rio RPC para <code>lightningd</code> no <code>bitcoind</code> </p><br><p> <code># jexec bitcoind</code> </p> <br><p> <code>bitcoind:/@[10:36] # ee /usr/local/etc/bitcoin.conf</code> </p> <br><pre> <code class="plaintext hljs">rpcbind=192.168.0.1 rpcuser=test rpcpassword=test #allow only c-lightning rpcallowip=192.168.0.7/32</code> </pre> <br><p> <code>bitcoind:/@[10:39] # service bitcoind restart</code> </p> <br><p>  <em>Minha troca ca√≥tica entre c√©lulas n√£o √© t√£o ca√≥tica se voc√™ observar o utilit√°rio <code>tmux</code> , que permite criar muitas sub-sess√µes de terminais dentro de uma sess√£o.</em>  <em>Anal√≥gico: <code>screen</code></em> </p><br><p><img src="https://habrastorage.org/webt/xu/cz/14/xucz14wosjbbeme4iis8ws4nxq8.png"></p><br><p>  Dachshunds, n√£o queremos exibir o IP real de nosso n√≥ e queremos realizar todas as transa√ß√µes financeiras atrav√©s do TOP.  Portanto, voc√™ precisa de mais um .onion. </p><br><p> <code># jexec tor</code> </p> <br><p> <code>tor:/@[9:59] # ee /usr/local/etc/tor/torrc</code> </p> <br><pre> <code class="plaintext hljs">HiddenServiceDir /var/db/tor/cln/ HiddenServicePort 9735 192.168.0.7:9735</code> </pre> <br><p> <code>tor:/@[10:01] # mkdir /var/db/tor/cln</code> </p> <br><p> <code>tor:/@[10:01] # chown -R _tor:_tor /var/db/tor/cln</code> </p> <br><p> <code>tor:/@[10:01] # chmod 700 /var/db/tor/cln</code> </p> <br><p> <code>tor:/@[10:03] # service tor restart</code> </p> <br><p> <code>tor:/@[10:04] # cat /var/db/tor/cln/hostname</code> </p> <br><pre> <code class="plaintext hljs">en5wbkavnytti334jc5uzaudkansypfs6aguv6kech4hbzpcz2ove3yd.onion</code> </pre> <br><p>  agora crie uma configura√ß√£o para o c-lightning </p><br><p> <code>lightning:/home/lightning/lightning@[10:31] # su lightning</code> </p> <br><p> <code>lightning@lightning:~ % mkdir .lightning</code> </p> <br><p> <code>lightning@lightning:~ % ee .lightning/config</code> </p> <br><pre> <code class="plaintext hljs">alias=My-LN-Node bind-addr=192.168.0.7:9735 rgb=ff0000 announce-addr=en5wbkavnytti334jc5uzaudkansypfs6aguv6kech4hbzpcz2ove3yd.onion:9735 network=bitcoin log-level=info fee-base=0 fee-per-satoshi=1 proxy=192.168.0.2:9050 log-file=/home/lightning/.lightning/c-lightning.log min-capacity-sat=200000 # sparko plugin # https://github.com/fiatjaf/lightningd-gjson-rpc/tree/master/cmd/sparko sparko-host=192.168.0.7 sparko-port=9737 sparko-tls-path=sparko-tls #sparko-login=mywalletusername:mywalletpassword #sparko-keys=masterkey;secretread:+listchannels,+listnodes;secretwrite:+invoice,+listinvoices,+delinvoice,+decodepay,+waitpay,+waitinvoice sparko-keys=masterkey;secretread:+listchannels,+listnodes;ultrawrite:+invoice,+listinvoices,+delinvoice,+decodepay,+waitpay,+waitinvoice # for the example above the initialization logs (mixed with lightningd logs) should print something like</code> </pre> <br><p> <code>lightning@lightning:~ % mkdir .lightning/plugins</code> </p> <br><p> <code>lightning@lightning:~ % cd .lightning/plugins/</code> </p> <br><p> <code>lightning@lightning:~/.lightning/plugins:% fetch https://github.com/fiatjaf/sparko/releases/download/v0.2.1/sparko_full_freebsd_amd64</code> </p> <br><p> <code>lightning@lightning:~/.lightning/plugins % mkdir ~/.lightning/sparko-tls</code> </p> <br><p> <code>lightning@lightning:~/.lightning/sparko-tls % cd ~/.lightning/sparko-tls</code> </p> <br><p> <code>lightning@lightning:~/.lightning/sparko-tls % openssl genrsa -out key.pem 2048</code> </p> <br><p> <code>lightning@lightning:~/.lightning/sparko-tls % openssl req -new -x509 -sha256 -key key.pem -out cert.pem -days 3650</code> </p> <br><p> <code>lightning@lightning:~/.lightning/plugins % chmod +x sparko_full_freebsd_amd64</code> </p> <br><p> <code>lightning@lightning:~/.lightning/plugins % mv sparko_full_freebsd_amd64 sparko</code> </p> <br><p> <code>lightning@lightning:~/.lightning/plugins % cd ~</code> </p> <br><p>  voc√™ tamb√©m precisa criar um arquivo de configura√ß√£o para o bitcoin-cli, um utilit√°rio que se comunica com o <code>bitcoind</code> </p><br><p> <code>lightning@lightning:~ % mkdir .bitcoin</code> </p> <br><p> <code>lightning@lightning:~ % ee .bitcoin/bitcoin.conf</code> </p> <br><pre> <code class="plaintext hljs">rpcconnect=192.168.0.1 rpcuser=test rpcpassword=test</code> </pre> <br><p>  verificar </p><br><p> <code>lightning@lightning:~ % bitcoin-cli echo "test"</code> </p> <br><pre> <code class="plaintext hljs">[ "test" ]</code> </pre> <br><p>  correr <code>lightningd</code> </p><br><p> <code>lightning@lightning:~ % lightningd --daemon</code> </p> <br><p>  <code>lightning-cli</code> pr√≥prio <code>lightning-cli</code> pode ser controlado pelo <code>lightning-cli</code> , por exemplo: </p><br><p>  <code>lightning-cli newaddr</code> <em>obter endere√ßo para nova entrada de pagamento</em> </p><br><pre> <code class="plaintext hljs">{ "address": "bc1q2n2ffq3lplhme8jufcxahfrnfhruwjgx3c78pv", "bech32": "bc1q2n2ffq3lplhme8jufcxahfrnfhruwjgx3c78pv" }</code> </pre> <br><p>  <code>lightning-cli withdraw bc1jufcxahfrnfhruwjgx3cq2n2ffq3lplhme878pv all</code> <em>enviam para o endere√ßo todo o dinheiro da carteira (todos os endere√ßos na cadeia)</em> </p><br><p>  Al√©m disso, comandos para opera√ß√µes fora da cadeia de <code>lightning-cli invoice</code> <code>lightning-cli listinvoices</code> , <code>lightning-cli invoice</code> <code>lightning-cli listinvoices</code> , <code>lightning-cli listinvoices</code> <code>lightning-cli pay</code> etc. </p><br><p>  Bem, para comunica√ß√£o com o aplicativo, temos o REST Api </p><br><p> <code>curl -k https://192.168.0.7:9737/rpc -d '{"method": "pay", "params": ["lnbc..."]}' -H 'X-Access masterkey'</code> </p> <br><p>  <strong>Resumir</strong> </p><br><p> <code># jls</code> </p> <br><pre> <code class="plaintext hljs"> JID IP Address Hostname Path 1 192.168.0.1 bitcoind.space.com /zroot/jails/jails/bitcoind 2 192.168.0.2 tor.space.com /zroot/jails/jails/tor 3 192.168.0.3 nginx-rev.space.com /zroot/jails/jails/nginx-rev 4 192.168.0.4 paygw.space.com /zroot/jails/jails/paygw 5 192.168.0.5 webapp.my.domain /zroot/jails/jails/webapp 7 192.168.0.200 electrum.space.com /zroot/jails/jails/electrum 8 192.168.0.6 polipo.space.com /zroot/jails/jails/polipo 9 192.168.0.7 lightning.space.com /zroot/jails/jails/cln</code> </pre> <br><p><img src="https://habrastorage.org/webt/nt/0k/ew/nt0kewrhuin48nj-lbfk1jpa4rc.png"></p><br><p>     ,            . </p><br><p> <code># zfs list</code> </p> <br><pre> <code class="plaintext hljs">NAME USED AVAIL REFER MOUNTPOINT zroot 279G 1.48T 88K /zroot zroot/ROOT 1.89G 1.48T 88K none zroot/ROOT/default 1.89G 17.6G 1.89G / zroot/home 88K 1.48T 88K /home zroot/jails 277G 1.48T 404M /zroot/jails zroot/jails/bitcoind 190G 1.48T 190G /zroot/jails/jails-data/bitcoind-data zroot/jails/cln 653M 1.48T 653M /zroot/jails/jails-data/cln-data zroot/jails/electrum 703M 1.48T 703M /zroot/jails/jails-data/electrum-data zroot/jails/nginx-rev 190M 1.48T 190M /zroot/jails/jails-data/nginx-rev-data zroot/jails/paygw 82.4G 1.48T 82.4G /zroot/jails/jails-data/paygw-data zroot/jails/polipo 57.6M 1.48T 57.6M /zroot/jails/jails-data/polipo-data zroot/jails/tor 81.5M 1.48T 81.5M /zroot/jails/jails-data/tor-data zroot/jails/webapp 360M 1.48T 360M /zroot/jails/jails-data/webapp-data</code> </pre> <br><p>  , bitcoind   190  .          ?  ZFS   .   <code>cbsd jclone old=bitcoind new=bitcoind-clone host_hostname=clonedbtc.space.com</code>          .        ,               (   190 ) </p><br><p>       ZFS,    . <a href="https://www.freebsd.org/doc/handbook/zfs-zfs.html">ZFS   </a>     ,     SSH.    ,   . </p><br><p>        ,      <a href="https://zabbix.org/wiki/Main_Page">Zabbix</a> . </p><br><p> <strong> ‚Äî </strong> </p><br><p>   ,        : </p><br><p> <em></em> ‚Äî   UNIX-     .           ‚Äî .          .           .                   .       -,             . </p><br><p> <em></em> ‚Äî        . -       , ECC , ZFS  " "        .            .   -     . </p><br><p> <em></em> ‚Äî   .           .           .                (     ).           ,         . </p><br><p> <em> </em> ‚Äî            ,  .          ,               . </p><br><p>            ,     ,    ,         . </p><br><p> <strong>    ?</strong> </p><br><p>     cbsd  <a href="https://www.bsdstore.ru/en/11.2.x/wf_bcreate_ssi.html"> </a> .   ,    <code>bhyve</code>     . </p><br><p> <code># cat /etc/rc.conf</code> </p> <br><pre> <code class="plaintext hljs">... kld_list="vmm if_tap if_bridge nmdm" ...</code> </pre> <br><p> <code># cat /boot/loader.conf</code> </p> <br><pre> <code class="plaintext hljs">... vmm_load="YES" ...</code> </pre> <br><p>        ,   - debian  ! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ffd/cb6/219/ffdcb6219c701e2e114100d9601e9fea.gif"></p><br><p> <strong>  </strong> </p><br><p>       .          ‚Äî <a href="https://sochain.com/address/BTC/bc1qu7lhf45xw83ddll5mnzte6ahju8ktkeu6qhttc">bc1qu7lhf45xw83ddll5mnzte6ahju8ktkeu6qhttc</a> .          ,      <a href="https://bitclouds.sh/">pet-project</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt477124/">https://habr.com/ru/post/pt477124/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt477110/index.html">Planejamento divertido</a></li>
<li><a href="../pt477114/index.html">Implementa√ß√£o do interpretador MSH</a></li>
<li><a href="../pt477118/index.html">O MIRO √© uma plataforma de rob√¥ indoor aberta. Parte 5 - Componente de software: ARDUINO (AVR), subimos "sob o cap√¥"</a></li>
<li><a href="../pt477120/index.html">Software de monitoramento cont√≠nuo de glicose no sangue para Windows</a></li>
<li><a href="../pt477122/index.html">O c√©rebro da empresa. Parte 3</a></li>
<li><a href="../pt477126/index.html">Admin em 5 minutos. Front-end - react-admin, back-end - Flask-RESTful</a></li>
<li><a href="../pt477128/index.html">Detetive Habra no fim de semana</a></li>
<li><a href="../pt477130/index.html">"Eugene Onegin": invers√£o (hist√≥ria N.-F.)</a></li>
<li><a href="../pt477132/index.html">Dados pessoais na Federa√ß√£o Russa: quem somos todos? Para onde vamos?</a></li>
<li><a href="../pt477136/index.html">Como o FL.ru engana os usu√°rios ao vender um servi√ßo duas vezes, quebrando suas pr√≥prias regras</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>