<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíáüèø üë©üèº‚Äçüîß üîï Rede descentralizada de mensagens e telefone da nova gera√ß√£o üë®üèº‚Äçüíª üçâ üÉè</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sempre que aparece um artigo sobre algum novo messenger, a maioria dos usu√°rios do Habr est√° interessada em coment√°rios - mensagens instant√¢neas centr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Rede descentralizada de mensagens e telefone da nova gera√ß√£o</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mobile_one/blog/420811/"><img src="https://habrastorage.org/webt/q0/kj/u6/q0kju6hj8o-ujapfibearqcsrhg.gif"><br><br>  Sempre que aparece um artigo sobre algum novo messenger, a maioria dos usu√°rios do Habr est√° interessada em coment√°rios - mensagens instant√¢neas centralizadas ou descentralizadas? <br><br>  Se n√£o - ent√£o - "todos os caras est√£o divergindo". <br><br>  Muitos tamb√©m mencionam a descentraliza√ß√£o do Skype como exemplo, implicando o que era antes de 2011. <br><br>  Vamos ent√£o, como delineador e introdu√ß√£o √† id√©ia principal do artigo, considerar o que era o Skype em seus anos dourados, antes da compra da Microsoft. <br><a name="habracut"></a><br>  Ent√£o, aqui est√° a estrutura de uma rede descentralizada ponto a ponto do Skype: <br><br><img src="https://habrastorage.org/webt/cp/hf/gs/cphfgsjar-muqhcmrpjhlpx9ylu.jpeg"><br><br>  Como vemos, os clientes est√£o conectados principalmente atrav√©s do chamado supern√≥. <br><br>  O que s√£o supern√≥s e por que o Skype precisa deles? <br>  Como P2P t√£o puro? <br>  Por que voc√™ n√£o pode conectar usu√°rios diretamente entre si, pois √© P2P? <br><br><img src="https://habrastorage.org/webt/pz/uj/ch/pzujchomcbkonmn9uw5orujs0ns.jpeg"><br><br>  Para responder √† pergunta sobre por que o supern√≥ era necess√°rio, voc√™ precisa se lembrar do que era o Skype naquele momento. <br><br>  E ele era um "discador" entre os usu√°rios, primeiro com chamadas de √°udio e depois com v√≠deo. <br>  E aqui havia um problema: a maioria dos usu√°rios ficava sob NAT e, √†s vezes, sob NAT duplo, triplo e, nessas condi√ß√µes, √© quase imposs√≠vel estabelecer comunica√ß√£o de √°udio e especialmente de v√≠deo se voc√™ os conectar diretamente. <br><br>  Grosso modo, esse supern√≥ desempenhou o papel de um tipo de servidor TURN, que estava envolvido em sinaliza√ß√£o e transmiss√£o de tr√°fego, "perfurando" NATs e conectando usu√°rios. <br>  Novamente - isso √© importante principalmente para chamadas de √°udio e v√≠deo. <br><br>  Os n√≥s se tornaram computadores com endere√ßos IP brancos, poderosos o suficiente para ficar em canais amplos, √† medida que o tr√°fego pesado de m√≠dia passava por eles. <br><br>  Al√©m disso, eles se tornaram n√≥s, completamente inconscientes disso - os usu√°rios dos n√≥s √†s vezes s√≥ depois descobriram que seu computador come√ßou a consumir repentinamente e a fornecer uma grande quantidade de tr√°fego. <br><br>  Tudo isso se assemelhava a algum tipo de v√≠rus, o que n√£o √© surpreendente - havia uma opini√£o de que o Skype era feito por ex-hackers que haviam feito anteriormente trocadores de piratas e isso se encaixava completamente na abordagem deles para solucionar problemas. <br><br>  Mas n√£o vamos nos aprofundar neste t√≥pico. <br><br>  Em vez disso, vamos ver como funciona ... comunica√ß√µes telef√¥nicas regulares: <br><br><img src="https://habrastorage.org/webt/ay/ms/p0/aymsp0elsjby5pso--ejt92pwlc.gif"><br><br>  O diagrama acima descreve o princ√≠pio de opera√ß√£o da rede telef√¥nica p√∫blica - o chamado PSTN ou o termo internacional - PSTN (Rede Telef√¥nica P√∫blica Comutada). <br><br>  E, embora este diagrama mostre o que aconteceu durante o per√≠odo de ouro da PSTN (anos 70 a 80 e in√≠cio dos anos 90), tudo funciona da mesma maneira agora. <br><br>  A tecnologia mudou, os gigantes se foram (Alcatel, Nortel, etc.), mas o princ√≠pio em si permaneceu. <br><br>  Observando a figura, √© poss√≠vel encontrar os n√≥s - s√£o PBXs da cidade, aos quais determinados assinantes est√£o conectados, com prefixos dos PBXs e supern√≥s correspondentes - PBXs de longa dist√¢ncia. <br><br>  Todos os n√≥s (ATS) podem se comunicar e assinantes entre si - somente atrav√©s desses n√≥s. <br><br>  Acontece que a rede PSTN tamb√©m √© uma rede P2P descentralizada, constru√≠da da mesma maneira que o Skype (ou vice-versa)? <br><br>  Muito provavelmente √© isso. <br><br>  E isso √© f√°cil de ver - por exemplo, quando uma central telef√¥nica tem poucos canais de acesso a outra central telef√¥nica da cidade, ent√£o na hora do rush (CNN - hor√°rio de pico) √© dif√≠cil ou imposs√≠vel para os assinantes de uma central telef√¥nica chegarem a outra, mas, ao mesmo tempo, assinantes da mesma Os PBXs podem discar um ao outro sem problemas. <br><br>  Agora n√£o existe esse problema, porque  as esta√ß√µes s√£o conectadas entre si por canais amplos e por toda parte uma figura, mas at√© aquele momento isso acontecia o tempo todo. <br><br>  Portanto, determinamos que uma rede telef√¥nica moderna (PSTN ou PSTN) √© uma rede P2P descentralizada. <br><br>  Uma quest√£o natural surge - se for P2P, ent√£o podemos nos tornar membros dessa rede descentralizada (aumentar nosso servidor, etc.)? <br><br>  Claro! <br><br>  O que √© necess√°rio para isso e como √© feito (suponha que voc√™ tenha muito dinheiro e seja uma empresa relativamente grande)? <br><br>  Os principais passos: <br><br>  - Voc√™ precisa se tornar um operador de comunica√ß√£o local ou regional ou de longa dist√¢ncia. <br>  Para fazer isso, voc√™ precisa obter uma licen√ßa apropriada do regulador, embora em alguns pa√≠ses isso n√£o seja necess√°rio. <br><br>  Por uma quest√£o de simplicidade, considere um exemplo de que voc√™ deseja se tornar um operador de comunica√ß√µes local - ou seja,  crie um n√≥ da cidade simples. <br><br>  - Voc√™ precisa obter um conjunto de n√∫meros de telefone geograficamente designados para o local onde coloca o n√≥ (central telef√¥nica). <br><br>  Essa piscina tamb√©m fornece ao regulador. <br><br>  Cita√ß√£o: <br><br>  <i>‚Äú... Existe uma recomenda√ß√£o da ITU-T, E.164, que define um plano internacional comum de numera√ß√£o de telecomunica√ß√µes usado em redes telef√¥nicas p√∫blicas e em algumas outras redes.</i>  <i>Os n√∫meros da consoante E.164 podem ter no m√°ximo 15 d√≠gitos e geralmente s√£o escritos com o prefixo "+".</i> <i><br><br></i>  <i>As russas "Regras para a presta√ß√£o de servi√ßos telef√¥nicos" [2] definem o n√∫mero do assinante como "o n√∫mero alocado ao assinante ao concluir o contrato para a presta√ß√£o de servi√ßos telef√¥nicos, pelo qual o dispositivo do assinante conectado √† rede telef√¥nica √© identificado quando outros dispositivos do assinante est√£o conectados a ele".</i>  <i>Na R√∫ssia, o regulador no campo dos n√∫meros de telefone √© o Minist√©rio das Comunica√ß√µes (em particular, a Ag√™ncia Federal de Comunica√ß√µes) ... "</i> <br><br>  - Ap√≥s receber o pool de n√∫meros, voc√™ deve criar e comissionar o n√≥ PSTN.  Omitiremos todos os detalhes necess√°rios para o SORM e assim por diante. <br><br>  Essas s√£o quest√µes organizacionais, n√£o vamos nos aprofundar nelas em detalhes, principalmente porque elas tamb√©m s√£o diferentes em diferentes pa√≠ses. <br><br>  Em vez disso, descrevemos brevemente os pontos t√©cnicos. <br><br>  Em primeiro lugar, agora todos os operadores, grandes e pequenos, montam esta√ß√µes em equipamentos VOIP. <br><br>  I.e.  compra-se uma esta√ß√£o de ferro especializada com VOIP ou um pacote de software - um servidor com um software especializado do tipo Broadcom classe 5 ou mesmo um asterisco dopado para a classe 5, etc. <br><br>  Conectando assinantes. <br><br>  Tudo aqui tamb√©m √© simples - est√£o instalados gateways VOIP com portas FXS, nos quais os assinantes podem conectar telefones ou telefones IP comuns, mini PBXs IP para usu√°rios corporativos ou clientes de software (por exemplo, para centrais de atendimento), etc. <br><br>  Algumas empresas conectam usu√°rios usando PBXs virtuais IP, porque PBX - mas o princ√≠pio √© o mesmo. <br><br>  Em seguida, voc√™ precisa registrar seu pool de telefones com todos os participantes dessa rede compartilhada - para isso, cada propriet√°rio de outra esta√ß√£o (n√≥) nessa rede compartilhada envia uma carta oficial ao regulador ou ao operador dominante - fa√ßa uma rota com esses n√∫meros para o PABX do nosso novo colega. <br><br>  E, portanto, voc√™ deve registrar as rotas de sa√≠da em sua esta√ß√£o (n√≥) de acordo com certas regras. <br><br>  Mesmo na Federa√ß√£o Russa, existe uma regra de que, ao conectar um assinante, voc√™ deve levar dados de passaporte, registro etc. <br><br>  Em princ√≠pio, quase tudo tamb√©m √© feito pelas operadoras m√≥veis. <br><br>  E ent√£o come√ßa a parte comercial - voc√™ ganha dinheiro vendendo esses n√∫meros por uma taxa mensal e cobrando uma taxa para chamadas internacionais ou entre montanhas, que voc√™, por sua vez, compra de um n√≥ superior, etc. <br><br>  <b>Por que todos estamos falando com tanto detalhe?</b> <br><br>  O fato √© que temos uma plataforma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">(M1 Messenger)</a> , que, por um lado, √© um mensageiro descentralizado e, por outro, pode ser definida como uma rede telef√¥nica de nova gera√ß√£o. <br><br>  <b>E o mais importante, para adicionar um n√≥ a essa rede, n√£o s√£o necess√°rias licen√ßas, nem obten√ß√£o de n√∫meros E164, nem quaisquer outras permiss√µes, porque n√£o h√° acesso √† PSTN.</b> <br><br>  I.e.  voc√™ mesmo pode ser adicionado a essa rede absolutamente a qualquer momento, e se tornar um n√≥ independente - um n√≥ na rede M1 Messenger. <br><br>  Voc√™ pode adicionar de forma f√°cil e simples suas esta√ß√µes IP, pequenos escrit√≥rios e grandes provedores a essa plataforma - e todas as esta√ß√µes podem se comunicar entre si e com os usu√°rios comuns do messenger: <br><br><img src="https://habrastorage.org/webt/yb/oa/go/yboagoggx3vn9i_fdexznw5pzye.png"><br><br>  Essa versatilidade se deve ao fato de a plataforma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">M1 Messenger</a> suportar o protocolo SIP. <br><br>  Cada usu√°rio recebe um login ao se registrar, bem como um URI SIP, ou seja, recebe 2 identificadores de uma s√≥ vez. <br><br>  Gra√ßas ao login, a intera√ß√£o ocorre dentro dos usu√°rios do messenger e as comunica√ß√µes de sa√≠da para o exterior, ou seja, aos PBXs IP conectados e, gra√ßas ao URI SIP, cada usu√°rio pode ser acessado para receber chamadas de qualquer rede compat√≠vel com SIP. <br><br>  Considere a figura. <br><br>  Aqui, os PBXs IP sob as letras A, B e C s√£o conectados √† plataforma via tronco SIP, ou seja, esses PBXs s√£o registrados na plataforma. <br><br>  O n√∫mero de conversas simult√¢neas nesse tronco, bem como o n√∫mero de troncos por PBX IP, n√£o √© limitado. <br><br>  Assim, usu√°rios como PBXs IP sob a letra A podem ter sua numera√ß√£o interna e, para chamadas para PBXs IP sob as letras B e C, usam seu URI SIP. <br>  As chamadas recebidas de outras trocas ou do messenger podem ser processadas por essas trocas de duas maneiras diferentes: <br><br>  - Como o √∫nico n√∫mero (n√∫mero de s√©rie) que vai, por exemplo, √† URA padr√£o e depois de acordo com o algoritmo estabelecido. <br><br>  - Cada usu√°rio dentro de um PBX IP de terceiros pode ser atribu√≠do ao seu pr√≥prio tronco e roteado pelo PBX. <br><br>  Assim, cada usu√°rio do PBX pode receber uma chamada destinada apenas a ele dos usu√°rios da plataforma. <br><br>  Al√©m disso, devido ao fato de que todos os usu√°rios de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mensagens instant√¢neas</a> recebem URIs SIP de uma s√≥ vez, √© f√°cil obter n√∫meros recebidos de provedores de n√∫meros virtuais (DIDs). <br><br>  O n√∫mero de n√∫meros recebidos associados ao login tamb√©m n√£o √© limitado. <br><br>  <b>Conex√£o de equipamentos.</b> <br><br>  Atualmente, praticamente n√£o h√° mensageiros que conectem o equipamento √† sua rede. <br><br>  O √∫ltimo foi o Skype. <br><br>  Por exemplo, em 2012, um telefone DECT com suporte do Skype foi anunciado: <br><br><img src="https://habrastorage.org/webt/or/nf/lh/ornflhn9elizzvbpbx03pyvwopo.jpeg"><br><br>  Antes disso, um telefone de mesa com suporte do Skype era vendido: <br><br><img src="https://habrastorage.org/webt/3n/cu/r5/3ncur5q_9xzklikfr7ioq-f7nqc.jpeg"><br><br>  H√° cerca de um ano, o Skype anunciou que n√£o suportaria esses telefones e que, de todos os usu√°rios que os compraram anteriormente, todos se transformaram em ab√≥bora. <br><br>  Por outro lado, absolutamente qualquer telefone IP (incluindo um telefone de v√≠deo) ou um gateway VOIP pode ser conectado √† plataforma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">M1 Messenger</a> : <br><br><img src="https://habrastorage.org/webt/co/m3/kl/com3klkzkdb7xnrzeubliwh27im.jpeg"><br><br><img src="https://habrastorage.org/webt/yf/ym/f6/yfymf6z_qkeb68analedmwp_p-o.jpeg"><br><br><img src="https://habrastorage.org/webt/2i/cd/il/2icdilwhf5a9nz-3lrc504r81wg.jpeg"><br><br>  Isso n√£o √© um conceito, tudo j√° funciona. <br><br>  Assim, qualquer PBX IP pode ser conectado √† plataforma, bem como qualquer equipamento VOIP. <br><br>  Para conectar-se, basta baixar o messenger, registrar-se e ir para a guia SIP equipment: <br><br><img src="https://habrastorage.org/webt/vn/u0/a1/vnu0a1frdqgmgwbl7iggnipj1zy.jpeg"><br><br>  Usando 3 par√¢metros - login, senha e endere√ßo do servidor: <br><br><img src="https://habrastorage.org/webt/9p/ud/cz/9pudczpigho6qsnfosqjpegi-tk.jpeg"><br><br>  Voc√™ pode conectar o PBX IP ou qualquer hardware VOIP. <br><br>  E usando URI SIP, como <b>login digital@sip1.m1online.net,</b> qualquer usu√°rio ou PBX IP conectado ou equipamento conectado pode receber chamadas VOIP de qualquer rede VOIP, mesmo que essa rede n√£o esteja conectada √† plataforma M1 (por exemplo, provedores de n√∫meros DID virtuais, etc. d.) <br><br>  Assim, √© obtida uma rede que n√£o obedece √† regulamenta√ß√£o de nenhum lado, mas ao mesmo tempo pode ser conectada aos PBXs IP existentes, e n√£o importa qual equipamento seja usado - seja um pequeno Atserisk ou um PBX in a box ou uma esta√ß√£o grande de um grande operador. <br><br>  E o mais interessante √© que as chamadas nessa rede n√£o s√£o cobradas e s√£o realizadas diretamente, ignorando n√∫meros de telefone emitidos oficialmente. <br><br>  Acontece uma rede de comunica√ß√£o, que n√£o depende de ningu√©m e est√° aberta √† conex√£o de qualquer usu√°rio - sejam pessoas f√≠sicas, empresas com seus usu√°rios ou grandes operadoras. <br>  Sem reguladores, sem SORMs, sem n√∫meros de telefone e164 que voc√™ pode perder ou retirar de voc√™. <br>  E sem taxas mensais e taxas por minuto de conversa. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt420811/">https://habr.com/ru/post/pt420811/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt420797/index.html">A aprendizagem n√£o pode ser adiada</a></li>
<li><a href="../pt420799/index.html">MPS 2018.2: testes de gerador, plug-in GitHub, aspecto VCS, notifica√ß√µes de migra√ß√£o e muito mais</a></li>
<li><a href="../pt420803/index.html">Aulas de impress√£o 3D. Economizando pl√°stico ao imprimir modelos n√£o funcionais do 3Dtool</a></li>
<li><a href="../pt420805/index.html">[Translation] Quando usar fluxos paralelos</a></li>
<li><a href="../pt420809/index.html">Semana de seguran√ßa 31: cinquenta tons de inseguran√ßa no Android</a></li>
<li><a href="../pt420813/index.html">Redes de bastidores no Kubernetes</a></li>
<li><a href="../pt420815/index.html">Como "decodificar o mundo digital" explodiu no corredor: os 10 principais relat√≥rios do DotNext 2018 Piter</a></li>
<li><a href="../pt420819/index.html">As 10 principais ferramentas Python para aprendizado de m√°quina e ci√™ncia de dados</a></li>
<li><a href="../pt420821/index.html">Regra 10: 1 em programa√ß√£o e reda√ß√£o</a></li>
<li><a href="../pt420825/index.html">Hoje ser√° a primeira partida entre os profissionais OpenAI e Dota 2 (pessoas vencidas). Entendemos como o bot funciona</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>