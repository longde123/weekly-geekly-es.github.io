<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚å®Ô∏è üå´Ô∏è üíü Cython: √úber 30-fache Python-Code-Beschleunigung üôéüèæ üö∏ üèáüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Python ist eine Sprache, die viele Programmierer lieben. Diese Sprache ist unglaublich einfach zu bedienen. Die Sache ist, dass der in Python geschrie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cython: √úber 30-fache Python-Code-Beschleunigung</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/462487/"> Python ist eine Sprache, die viele Programmierer lieben.  Diese Sprache ist unglaublich einfach zu bedienen.  Die Sache ist, dass der in Python geschriebene Code intuitiv und gut lesbar ist.  In Gespr√§chen √ºber Python kann man jedoch oft die gleiche Beschwerde √ºber diese Sprache h√∂ren.  Besonders wenn C-Experten √ºber Python sprechen. So klingt es: "Python ist langsam."  Und diejenigen, die dies sagen, s√ºndigen nicht gegen die Wahrheit. <br><br>  Im Vergleich zu vielen anderen Programmiersprachen ist Python in der Tat langsam.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hier sind</a> die Testergebnisse, die die Leistung verschiedener Programmiersprachen bei der L√∂sung verschiedener Probleme vergleichen. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/yj/2f/ig/yj2figmt6bot5ytlcmommmnjrzm.jpeg"></a> <br><br>  Es gibt verschiedene M√∂glichkeiten, Python-Programme zu beschleunigen.  Beispielsweise k√∂nnen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bibliotheken verwenden,</a> die f√ºr die Verwendung mehrerer Prozessorkerne ausgelegt sind.  Wer mit Numpy, Pandas oder Scikit-Learn arbeitet, kann sich das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Rapids-</a> Softwarepaket ansehen, mit dem Sie die GPU f√ºr wissenschaftliche Berechnungen verwenden k√∂nnen. <br><a name="habracut"></a><br>  Alle diese Beschleunigungstechniken eignen sich f√ºr F√§lle, in denen die mit Python zu l√∂senden Aufgaben parallelisiert werden k√∂nnen.  Dies sind beispielsweise Aufgaben f√ºr die vorl√§ufige Datenverarbeitung oder Operationen mit Matrizen. <br><br>  Aber was ist, wenn Ihr Code reines Python ist?  Was ist, wenn Sie eine gro√üe <code>for</code> Schleife haben, die Sie unbedingt verwenden m√ºssen und deren Ausf√ºhrung einfach nicht parallelisiert werden kann, da die darin verarbeiteten Daten nacheinander verarbeitet werden m√ºssen?  Gibt es eine M√∂glichkeit, Python selbst zu beschleunigen? <br><br>  Die Antwort auf diese Frage gibt Cython - ein Projekt, mit dem Sie in Python geschriebenen Code erheblich beschleunigen k√∂nnen. <br><br><h2>  <font color="#3AC1EF">Was ist Cython?</font> </h2><br>  Cython ist im Kern eine Zwischenschicht zwischen Python und C / C ++.  Mit Cython k√∂nnen Sie regul√§ren Python-Code mit einigen geringf√ºgigen √Ñnderungen schreiben, der dann direkt in C-Code √ºbersetzt wird. <br><br>  Die einzige √Ñnderung am Python-Code besteht darin, jeder Variablen Informationen zu ihrem Typ hinzuzuf√ºgen.  Wenn Sie normalen Python-Code schreiben, k√∂nnen Sie eine Variable wie folgt deklarieren: <br><br><pre> <code class="python hljs">x = <span class="hljs-number"><span class="hljs-number">0.5</span></span></code> </pre> <br>  Wenn Sie Cython beim Deklarieren einer Variablen verwenden, m√ºssen Sie deren Typ angeben: <br><br><pre> <code class="python hljs">cdef float x = <span class="hljs-number"><span class="hljs-number">0.5</span></span></code> </pre> <br>  Dieses Konstrukt teilt Cython mit, dass die Variable eine Gleitkommazahl ist.  Nach dem gleichen Prinzip werden Variablen in C deklariert. Mit normalem Python werden Variablentypen dynamisch definiert.  Die in Cython verwendete explizite Typdeklaration erm√∂glicht die Konvertierung von Python-Code in C-Code.  Der Punkt ist, dass in C eine explizite Deklaration von Variablentypen erforderlich ist. <br><br>  Die Installation von Cython ist √§u√üerst einfach: <br><br><pre> <code class="python hljs">pip install cython</code> </pre> <br><h2>  <font color="#3AC1EF">Typen in Cython</font> </h2><br>  Bei Verwendung von Cython k√∂nnen zwei Arten von Typen unterschieden werden.  Eine ist f√ºr Variablen, die zweite f√ºr Funktionen. <br><br>  Wenn es sich um Variablen handelt, stehen uns folgende Typen zur Verf√ºgung: <br><br><ul><li> <code>cdef int a, b, c</code> </li> <li> <code>cdef char *s</code> </li> <li>  <code>cdef float x = 0.5</code> (Zahl mit einfacher Genauigkeit) </li><li>  <code>cdef double x = 63.4</code> (doppelte Genauigkeit) </li><li> <code>cdef list names</code> </li> <li> <code>cdef dict goals_for_each_play</code> </li> <li> <code>cdef object card_deck</code> </li> </ul><br>  Bitte beachten Sie, dass hier tats√§chlich C / C ++ - Typen angezeigt werden! <br><br>  Bei der Arbeit mit Funktionen stehen uns folgende Typen zur Verf√ºgung: <br><br><ul><li>  <code>def</code> ist eine regul√§re Python-Funktion, die nur von Python aufgerufen wird. </li><li>  <code>cdef</code> ist eine Cython-Funktion, die nicht aus regul√§rem Python-Code aufgerufen werden kann.  Solche Funktionen k√∂nnen nur innerhalb des Cython-Codes aufgerufen werden. </li><li>  <code>cpdef</code> - Eine Funktion, auf die sowohl von C als auch von Python aus zugegriffen werden kann. </li></ul><br>  Nachdem wir die Python-Typen herausgefunden haben, werden wir die Geschwindigkeit des Python-Codes nutzen. <br><br><h2>  <font color="#3AC1EF">Beschleunigen des Codes mit Cython</font> </h2><br>  Beginnen wir mit der Erstellung eines Python-Benchmarks.  Dies ist eine <code>for</code> Schleife, in der die Fakult√§t einer Zahl berechnet wird.  Der entsprechende reine Python-Code w√ºrde folgenderma√üen aussehen: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">:</span></span>    y = <span class="hljs-number"><span class="hljs-number">1</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, x+<span class="hljs-number"><span class="hljs-number">1</span></span>):        y *= i    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> y</code> </pre> <br>  Das Cython-√Ñquivalent dieser Funktion ist der Originalversion sehr √§hnlich.  Der entsprechende Code muss in einer Datei mit der Erweiterung <code>.pyx</code> .  Die einzige √Ñnderung, die am Code vorgenommen werden muss, besteht darin, Informationen zu den Variablentypen und Funktionen hinzuzuf√ºgen: <br><br><pre> <code class="python hljs">cpdef int test(int x):    cdef int y = <span class="hljs-number"><span class="hljs-number">1</span></span>    cdef int i    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, x+<span class="hljs-number"><span class="hljs-number">1</span></span>):        y *= i    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> y</code> </pre> <br>  Beachten Sie, dass der Funktion das Schl√ºsselwort <code>cpdef</code> ist.  Auf diese Weise k√∂nnen Sie diese Funktion von Python aus aufrufen.  Zus√§tzlich wird der Typ der Variablen <code>i</code> , die die Rolle eines Schleifenz√§hlers spielt.  Vergessen wir nicht, dass wir alle in der Funktion deklarierten Variablen eingeben m√ºssen.  Dadurch wird dem C-Compiler mitgeteilt, welche Typen verwendet werden sollen. <br><br>  Erstellen Sie nun die <code>setup.py</code> , mit deren Hilfe wir den Cython-Code in C-Code konvertieren k√∂nnen: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> distutils.core <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> setup <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Cython.Build <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cythonize setup(ext_modules = cythonize(<span class="hljs-string"><span class="hljs-string">'run_cython.pyx'</span></span>))</code> </pre> <br>  Lassen Sie uns kompilieren: <br><br><pre> <code class="python hljs">python setup.py build_ext --inplace</code> </pre> <br>  Der C-Code ist jetzt einsatzbereit. <br><br>  Wenn Sie sich den Ordner ansehen, in dem sich der Cython-Code befindet, finden Sie dort alle Dateien, die zum Ausf√ºhren des C-Codes erforderlich sind, einschlie√ülich der Datei <code>run_cython.c</code> .  Wenn Sie interessiert sind, √∂ffnen Sie diese Datei und sehen Sie sich an, welchen C-Code Cython generiert. <br><br>  Jetzt k√∂nnen Sie unseren ultraschnellen C-Code testen.  Unten finden Sie den Code zum Testen und Vergleichen von zwei Versionen des Programms. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> run_python <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> run_cython <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time number = <span class="hljs-number"><span class="hljs-number">10</span></span> start = time.time() run_python.test(number) end = time.time() py_time = end - start print(<span class="hljs-string"><span class="hljs-string">"Python time = {}"</span></span>.format(py_time)) start = time.time() run_cython.test(number) end = time.time() cy_time = end - start print(<span class="hljs-string"><span class="hljs-string">"Cython time = {}"</span></span>.format(cy_time)) print(<span class="hljs-string"><span class="hljs-string">"Speedup = {}"</span></span>.format(py_time / cy_time))</code> </pre> <br>  Dieser Code ist sehr einfach.  Wir importieren die erforderlichen Dateien - genau wie regul√§re Python-Dateien importiert werden, und rufen dann die entsprechenden Funktionen auf, so als w√ºrden wir die ganze Zeit mit regul√§ren Python-Funktionen arbeiten. <br><br>  Schauen Sie sich die folgende Tabelle an.  M√∂glicherweise stellen Sie fest, dass die Cython-Version des Programms in allen F√§llen schneller ist als die Python-Version.  Je gr√∂√üer die Aufgabe, desto gr√∂√üer die Beschleunigung, die Cython bietet. <br><div class="scrollable-table"><table><tbody><tr><td>  <b>Nummer</b> <br></td><td>  <b>Python-Zeitmetrik</b> <br></td><td>  <b>Cython-Zeitmetrik</b> <br></td><td>  <b>Speedup Score</b> <br></td></tr><tr><td>  10 <br></td><td>  1.6689300537109375e-06 <br></td><td>  4.76837158203125e-07 <br></td><td>  3.5 <br></td></tr><tr><td>  100 <br></td><td>  3.337860107421875e-06 <br></td><td>  4.76837158203125e-07 <br></td><td>  7.0 <br></td></tr><tr><td>  1000 <br></td><td>  2.193450927734375e-05 <br></td><td>  9.5367431640625e-07 <br></td><td>  23.0 <br></td></tr><tr><td>  10.000 <br></td><td>  0,0002090930938720703 <br></td><td>  6.4373016357421875e-06 <br></td><td>  32.481 <br></td></tr><tr><td>  100.000 <br></td><td>  0,0021562576293945312 <br></td><td>  6.008148193359375e-05 <br></td><td>  35,89 <br></td></tr><tr><td>  1.000.000 <br></td><td>  0,02128767967224121 <br></td><td>  0,0005953311920166016 <br></td><td>  35,75 <br></td></tr><tr><td>  10.000.000 <br></td><td>  0,2148280143737793 <br></td><td>  0,00594782829284668 <br></td><td>  36.1187317112278 <br></td></tr></tbody></table></div><br><h2>  <font color="#3AC1EF">Zusammenfassung</font> </h2><br>  Die Verwendung von Cython kann fast jeden in Python geschriebenen Code ohne besonderen Aufwand erheblich beschleunigen.  Je mehr Schleifen im Programm vorhanden sind und je mehr Daten verarbeitet werden, desto bessere Ergebnisse k√∂nnen Sie von Cython erwarten. <br><br>  <b>Liebe Leser!</b>  Verwenden Sie Cython in Ihren Projekten? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de462487/">https://habr.com/ru/post/de462487/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de462477/index.html">Wissenschaftler behaupten, AI sei der Autor eines neuen Patents und versuchen, das Patentrecht zu √§ndern</a></li>
<li><a href="../de462479/index.html">Eskalation der lokalen Berechtigungen des Steam Windows-Clients 0 Tag</a></li>
<li><a href="../de462481/index.html">Geben Sie System-FAQs ein</a></li>
<li><a href="../de462483/index.html">Funktionale Programmierung: Ein verr√ºcktes Spielzeug, das die Arbeitsproduktivit√§t beeintr√§chtigt. Teil 1</a></li>
<li><a href="../de462485/index.html">Funktionale Programmierung: Ein verr√ºcktes Spielzeug, das die Arbeitsproduktivit√§t beeintr√§chtigt. Teil 2</a></li>
<li><a href="../de462489/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends f√ºr die letzte Woche Nr. 374 (29. Juli - 4. August 2019)</a></li>
<li><a href="../de462493/index.html">Multimodell-DBMS - die Basis moderner Informationssysteme?</a></li>
<li><a href="../de462495/index.html">Digitale Veranstaltungen in Moskau vom 05. bis 11. August</a></li>
<li><a href="../de462501/index.html">Warum brauche ich meine eigene Zertifizierungsstelle?</a></li>
<li><a href="../de462503/index.html">Wof√ºr sind die ‚Äûgoldenen Signale‚Äú von √úberwachung und SRE?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>