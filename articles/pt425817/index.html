<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôÖüèª ‚òéÔ∏è üì¢ Arraste e solte nos seus aplicativos para iOS üíÉüèª üí• üë®‚Äç‚úàÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O mecanismo de Drag & Drop em execu√ß√£o no iOS 11 e iOS 12 √© uma maneira de copiar ou mover graficamente de forma ass√≠ncrona ou de dados, em um √∫nico a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arraste e solte nos seus aplicativos para iOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/425817/"><img src="https://habrastorage.org/webt/gb/xu/dt/gbxudtvrfs8biaj5tlzkpjjjwe4.png"><br><br>  O mecanismo de <code>Drag &amp; Drop</code> em execu√ß√£o no <code>iOS 11</code> e <code>iOS 12</code> √© uma maneira de copiar ou mover graficamente de forma ass√≠ncrona ou de dados, em um √∫nico aplicativo e entre diferentes aplicativos.  Embora essa tecnologia tenha cerca de 30 anos, ela literalmente se tornou uma tecnologia "inovadora" no <code>iOS</code> devido ao fato de que, ao arrastar algo no <code>iOS</code> , o <code>multitouch</code> permite interagir livremente com o resto do sistema e coletar dados para redefinir a partir de diferentes aplicativos. <br><a name="habracut"></a><br>  <code>iOS</code> torna poss√≠vel capturar v√°rios elementos ao mesmo tempo.  Al√©m disso, eles n√£o precisam ter uma acessibilidade conveniente para a sele√ß√£o: voc√™ pode pegar o primeiro objeto, ir para outro aplicativo e pegar outra coisa - todos os objetos ser√£o coletados em uma ‚Äúpilha‚Äù embaixo do seu dedo.  Em seguida, chame o dock universal na tela, abra qualquer aplicativo e capture o terceiro objeto e v√° para a tela com os aplicativos em execu√ß√£o e, sem liberar os objetos, despeje-os em um dos programas abertos.  Essa liberdade de a√ß√£o √© poss√≠vel no <code>iPad</code> , no <code>iPhone</code> , a cobertura de <code>Drag &amp; Drop</code> no <code>iOS</code> limitada √† estrutura de um aplicativo. <br><br>  Os aplicativos mais populares ( <code>Safary</code> , <code>Chrome</code> , <code>IbisPaint X</code> , <code>Mail</code> , <code>Photos</code> , <code>Files</code> etc.) j√° possuem um mecanismo de <code>Drag &amp; Drop</code> .  Al√©m disso, a <code>Apple</code> forneceu aos desenvolvedores uma <code>API</code> muito simples e intuitiva para incorporar o mecanismo <code>Drag &amp; Drop</code> no seu aplicativo.  O mecanismo <code>Drag &amp; Drop</code> , assim como os gestos, funciona no <b><font color="#0000FF">UIView</font></b> e usa o conceito de <b><font color="#0000FF">Intera√ß√µes</font></b> , um pouco como gestos, para que voc√™ possa pensar no mecanismo <code>Drag &amp; Drop</code> simplesmente como um gesto realmente poderoso. <br><br>  Al√©m de gestos, √© muito f√°cil integrar seu aplicativo.  Especialmente se seu aplicativo usa a tabela <b><font color="#0000FF">UITableView</font></b> ou a cole√ß√£o <b><font color="#0000FF">UICollectionView</font></b> , porque para eles <code>API Drag &amp; Drop</code> aprimorada e aumentada para um n√≠vel mais alto de abstra√ß√£o, no sentido de que a <code>Collection View</code> si ajuda voc√™ com o <b><font color="#0000FF">indexPath</font></b> do elemento de cole√ß√£o que voc√™ deseja arrastar e soltar <code>Drag</code> .  Ela sabe onde est√° o seu dedo e o interpreta como o <b><font color="#0000FF">indexPath</font></b> do elemento de cole√ß√£o que voc√™ est√° ‚Äúarrastando‚Äù <code>Drag</code> no momento, ou como o <b><font color="#0000FF">indexPath</font></b> do elemento de cole√ß√£o em que voc√™ est√° ‚Äúsoltando‚Äù <code>Drop</code> algo.  Portanto, a <code>Collection View</code> fornece o <b><font color="#0000FF">indexPath</font></b> , mas, de outra forma, √© absolutamente a mesma <code>API Drag &amp; Drop</code> que para um <b><font color="#0000FF">UIView</font></b> regular. <br><br>  O processo de <code>Drag &amp; Drop</code> no <code>iOS</code> possui 4 fases diferentes: <br><br><h2>  Lift </h2><br>  <b>Levantar</b> (levantar) - √© quando o usu√°rio executa um <b><font color="#FF00FF">longo</font></b> gesto de <b><font color="#FF00FF">press√£o</font></b> , indicando o elemento que ser√° "arrastar e soltar".  Nesse momento, uma chamada " <code>lift preview</code> " muito leve do elemento indicado √© formada e o usu√°rio come√ßa a arrastar os dedos. <br><br><img src="https://habrastorage.org/webt/t6/sw/tw/t6swtwdee7kasyvqq_od3ipzlxy.png" width="600" height="450"><br><br><h2>  Arrastar (arrastar e soltar) </h2><br>  <b>Arrastar</b> (arrastar e soltar) - √© quando o usu√°rio move o objeto na superf√≠cie da tela.  Durante esta fase, a " <code>lift preview</code> " para este objeto pode ser modificada (um sinal de mais verde "+" ou outro sinal aparece) ... <br><br><img src="https://habrastorage.org/webt/07/yo/4x/07yo4x4yua4zelwculog6eng9aw.png" width="600" height="450"><br><br>  ... alguma intera√ß√£o com o sistema tamb√©m √© permitida: voc√™ pode clicar em outro objeto e adicion√°-lo √† sess√£o atual de "arrastar e soltar": <br><br><img src="https://habrastorage.org/webt/yb/bx/wi/ybbxwiqe6-226ipfjmkzmpymkva.png" width="600" height="450"><br><br><h2>  Drop </h2><br>  <b>Queda</b> ocorre quando o usu√°rio levanta um dedo.  Nesse momento, duas coisas podem acontecer: o objeto <code>Drag</code> ser√° destru√≠do ou o objeto <code>Drop</code> ser√° "descartado" no destino. <br><br><img src="https://habrastorage.org/webt/iv/b1/4z/ivb14zogie89jntnkfsxmuubvd0.png" width="600" height="450"><br><br><h2>  Transfer√™ncia de dados </h2><br>  Se o processo de <b>arrastar</b> e soltar n√£o foi cancelado e a redefini√ß√£o " <b>Soltar</b> " ocorreu, ocorre a <b>Transfer√™ncia de</b> dados (transfer√™ncia de dados), na qual o "ponto de soltar" solicita dados da "origem" e ocorre a transfer√™ncia ass√≠ncrona de dados. <br><br>  Neste tutorial, mostraremos como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">integrar</a> facilmente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o</a> mecanismo <code>Drag &amp; Drop</code> em seu aplicativo <code>iOS</code> usando o aplicativo de demonstra√ß√£o da Image Gallery, tirado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">do curso de dever de casa de Stanford, CS193P</a> . <br>  Dotaremos a <code>Collection View</code> capacidade de nos preenchermos com imagens FORA, al√©m de reorganizarmos elementos INSIDE usando o mecanismo <code>Drag &amp; Drop</code> .  Al√©m disso, esse mecanismo ser√° usado para despejar elementos desnecess√°rios da <code>Collection View</code> da <code>Collection View</code> em uma "lixeira", que √© uma <b><font color="#0000FF">UIView</font></b> normal e √© representada por um bot√£o no painel de navega√ß√£o.  Tamb√©m podemos compartilhar imagens coletadas em nossa Galeria com outros aplicativos usando o mecanismo <code>Drag &amp; Drop</code> , por exemplo, <code>Notes</code> ou <code>Notes</code> ou <code>Mail</code> ou uma biblioteca de <code>Photo</code> ( <code>Photo</code> ). <br><br>  Mas antes de focar na implementa√ß√£o do mecanismo <code>Drag &amp; Drop</code> no aplicativo de demonstra√ß√£o ‚ÄúImage Gallery‚Äù, analisarei seus principais componentes muito brevemente. <br><br><h1>  Recursos do aplicativo de demonstra√ß√£o "Galeria de imagens" </h1><br>  A interface do usu√°rio ( <code>UI</code> ) do aplicativo Image Gallery √© muito simples.  Este √© um "trecho de tela" do <code>Image Gallery Collection View Controller</code> inserido no <code>Navigation Controller</code> : <br><br><img src="https://habrastorage.org/webt/rz/gl/o6/rzglo69owhktzl8vcstcosf5rdi.png"><br><br>  A parte central do aplicativo √© certamente o <code>Image Gallery Collection View Controller</code> , que √© suportado pela classe <b><font color="#0000FF">ImageGalleryCollectionViewController</font></b> com o Image Gallery Model como uma vari√°vel <b><font color="#0000FF">var imageGallery = ImageGallery ()</font></b> : <br><br><img src="https://habrastorage.org/webt/na/f2/1r/naf21rpv6pxjnht1bk02mowhgoi.png"><br><br>  O modelo √© representado por uma <b><font color="#0000FF">estrutura struct ImageGallery</font></b> contendo uma matriz de imagens, na qual cada imagem √© descrita por uma <b><font color="#0000FF">estrutura struct ImageModel</font></b> contendo o <code>URL</code> localiza√ß√£o <code>URL</code> imagem (n√£o vamos armazenar a imagem em si) e sua propor√ß√£o: <br><br><img src="https://habrastorage.org/webt/bp/0b/6_/bp0b6_kh3bgocgc4zlnjrocmk2q.png"><br><br>  Nosso <b><font color="#0000FF">ImageGalleryCollectionViewController</font></b> implementa o protocolo <b><font color="#0000FF">DataSource</font></b> : <br><br><img src="https://habrastorage.org/webt/ka/vr/gj/kavrgjqaraoqv4sva-aqhffwvhu.png"><br><br>  A c√©lula personalizada na cole√ß√£o de c√©lulas cont√©m uma imagem <b><font color="#0000FF">imageView: UIImageView!</font></b>  e indicador de atividade <b><font color="#0000FF">girat√≥rio: UIActivityIndicatorView!</font></b>  e √© suportado pela <code>subclass</code> personalizada <b><font color="#0000FF">ImageCollectionViewCell da</font></b> classe <b><font color="#0000FF">UICollectionViewCell</font></b> : <br><br><img src="https://habrastorage.org/webt/cu/hs/1l/cuhs1ljdvbara4u2_ndq3y_sfxw.png"><br><br>  <code>Public API</code> da classe <b><font color="#0000FF">ImageCollectionViewCell</font></b> √© o <b><font color="#0000FF">URL da</font></b> imagem <b><font color="#0000FF">imageURL</font></b> .  Assim que a instalamos, nossa <code>UI</code> atualizada, ou seja, os dados da imagem s√£o selecionados de forma ass√≠ncrona neste <b><font color="#0000FF">imageURL</font></b> e exibidos na c√©lula.  Enquanto os dados est√£o sendo recuperados da rede, o indicador de atividade do <b><font color="#0000FF">girador</font></b> est√° funcionando, indicando que estamos no processo de recupera√ß√£o de dados. <br><br>  Uso a fila global <b><font color="#0000FF">(qos: .userInitiated)</font></b> com o argumento de qualidade de servi√ßo <b><font color="#0000FF">qos</font></b> para obter dados em um determinado <code>URL</code> , definido como <b><font color="#0000FF">.userInitiated</font></b> porque seleciono os dados a pedido do usu√°rio: <br><br><img src="https://habrastorage.org/webt/0q/aq/2-/0qaq2-uakbn1zou8ilh7pcvysxy.png"><br><br>  Cada vez que voc√™ usa suas pr√≥prias vari√°veis ‚Äã‚Äãdentro de um fechamento, no nosso caso s√£o <b><font color="#0000FF">imageView</font></b> e <b><font color="#0000FF">imageURL</font></b> , o compilador obriga voc√™ a se colocar na frente delas <b><font color="#0000FF">.</font></b>  para que voc√™ se pergunte: "Existe um" link c√≠clico da mem√≥ria "?"  N√£o temos um " <code>memory cycle</code> " expl√≠cito aqui, porque <b><font color="#0000FF">o</font></b> pr√≥prio <b><font color="#0000FF">eu</font></b> n√£o tem um ponteiro para esse fechamento. <br><br>  No entanto, no caso de multithreading, lembre-se de que as <b><font color="#0000FF">c√©lulas</font></b> na <code>Collection View</code> s√£o reutiliz√°veis ‚Äã‚Äãgra√ßas ao m√©todo <b><font color="#0000FF">dequeueReusableCell</font></b> .  Cada vez que uma c√©lula (nova ou reutilizada) aparece na tela, a imagem √© baixada da rede de forma ass√≠ncrona (nesse momento, o ‚Äú <b><font color="#0000FF">bot√£o girat√≥rio</font></b> ‚Äù do indicador de atividade do <b><font color="#0000FF">bot√£o girat√≥rio</font></b> est√° girando). <br><br>  Assim que o download √© conclu√≠do e a imagem √© recebida, a <code>UI</code> desta c√©lula de cole√ß√£o √© atualizada.  Mas n√£o esperamos o carregamento da imagem, continuamos a rolar pela cole√ß√£o e a c√©lula da cole√ß√£o que marcamos sai da tela sem atualizar nossa <code>UI</code> .  No entanto, uma nova imagem deve aparecer abaixo e a mesma c√©lula que saiu da tela ser√° reutilizada, mas para outra imagem, que pode carregar e atualizar rapidamente a <code>UI</code> do <code>UI</code> .  Nesse momento, o carregamento da imagem iniciado anteriormente nesta c√©lula retornar√° e a tela ser√° atualizada, o que levar√° a um resultado incorreto.  Isso ocorre porque executamos coisas diferentes que funcionam com a rede em segmentos diferentes.  Eles voltam em momentos diferentes. <br><br>  Como podemos resolver a situa√ß√£o? <br>  Dentro da estrutura do mecanismo <b><font color="#0000FF">GCD</font></b> que usamos, n√£o podemos cancelar o download da imagem da c√©lula que saiu da tela, mas podemos, quando nossos dados <b><font color="#0000FF">imageData chegam</font></b> da rede, verificar o <code>URL</code> <b><font color="#0000FF">URL</font></b> que causou o carregamento desses dados e compar√°-lo com o que o usu√°rio deseja ter. nesta c√©lula no momento, ou seja, <b><font color="#0000FF">imageURL</font></b> .  Se eles n√£o corresponderem, n√£o atualizaremos a c√©lula da <code>UI</code> do <code>UI</code> e aguardaremos os dados de imagem necess√°rios: <br><br><img src="https://habrastorage.org/webt/01/xl/-v/01xl-vqsde3rlqyus1f7tksacja.png"><br><br>  Essa linha de c√≥digo aparentemente absurda <b><font color="#0000FF">url == self.imageURL</font></b> faz com que tudo funcione corretamente em um ambiente multithread que requer uma imagina√ß√£o n√£o padr√£o.  O fato √© que algumas coisas na programa√ß√£o multithread acontecem em uma ordem diferente da escrita do c√≥digo. <br><br>  Se n√£o foi poss√≠vel selecionar os dados da imagem, uma imagem √© gerada com uma mensagem de erro na forma da sequ√™ncia ‚ÄúErro‚Äù e um emoji com ‚Äúcarranca‚Äù.  Apenas o espa√ßo vazio em nossa <code>Collection View</code> pode confundir um pouco o usu√°rio: <br><br><img src="https://habrastorage.org/webt/7m/zh/dt/7mzhdt1eo0tedkkrolp6osiidhu.png"><br><br>  N√£o queremos que a imagem com a mensagem de erro repita o <b><font color="#0000FF">aspecto da rela√ß√£o</font></b> dessa imagem de erro, pois, neste caso, o texto junto com o emoji ser√° esticado ou compactado.  Gostar√≠amos que fosse neutro - quadrado, ou seja, teria uma rela√ß√£o de aspecto pr√≥xima a 1,0. <br><br><img src="https://habrastorage.org/webt/7b/rj/ve/7brjvesx81juxpsgnkevsnvge_u.png"><br><br>  Devemos informar nosso <code>Controller</code> sobre esse desejo, para que ele corrija a propor√ß√£o <b><font color="#0000FF">aspectRatio</font></b> para o <b><font color="#0000FF">indexPath</font></b> correspondente em seu <b><font color="#0000FF">imageGallery</font></b> Model.  Essa √© uma tarefa interessante, existem v√°rias maneiras de resolv√™-la e escolheremos a mais f√°cil delas - usando o Fechamento <b><font color="#0000FF">opcional</font></b> <b><font color="#0000FF">var closAspectRatio: (() -&gt; Void)?</font></b>  .  Pode ser igual a <b><font color="#0000FF">zero</font></b> e n√£o precisa ser instalado se isso n√£o for necess√°rio: <br><br><img src="https://habrastorage.org/webt/8v/5q/wy/8v5qwyzl2_-dju1qfotj7i9nem4.png"><br><br>  Ao chamar o fechamento <b><font color="#0000FF">changeAspectRatio? ()</font></b> No caso de busca incorreta de dados, eu uso a cadeia <b><font color="#0000FF">Opcional</font></b> .  Agora, qualquer pessoa interessada em algum tipo de configura√ß√£o ao receber uma imagem incorreta pode definir esse fechamento para algo espec√≠fico.  E √© exatamente isso que fazemos em nosso <code>Controller</code> no m√©todo <b><font color="#0000FF">cellForItemAt</font></b> : <br><br><img src="https://habrastorage.org/webt/uv/ee/mi/uveemimakh506que35eaasanjbi.png"><br><br>  Detalhes podem ser encontrados <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br>  Para exibir imagens com o <b><font color="#0000FF">aspectRatio</font></b> correto, o m√©todo <b><font color="#0000FF">sizeForItemAt do</font></b> delegado <b><font color="#0000FF">UICollectionViewDelegateFlowLayout</font></b> √© <b><font color="#0000FF">usado</font></b> : <br><br><img src="https://habrastorage.org/webt/ys/v7/nz/ysv7nzh7rus7hnowtqyocbevwai.png"><br><br>  Al√©m da <code>Collection View</code> imagens do modo de <code>Collection View</code> , em nossa <code>UI</code> colocamos um <code>Bar Button</code> no painel de navega√ß√£o com uma imagem personalizada do <b><font color="#0000FF">GarbageView</font></b> contendo uma "lixeira" como uma <b><font color="#0000FF">sub-visualiza√ß√£o</font></b> : <br><br><img src="https://habrastorage.org/webt/1h/eo/uu/1heouudwoicj6qyjrckscada9ug.png"><br><br>  Nesta figura, as cores de plano de fundo do <b><font color="#0000FF">GarbageView em</font></b> si e o bot√£o <b><font color="#0000FF">UIButton</font></b> com a imagem da "lata de lixo" (na verdade, existe um plano de fundo transparente) s√£o alteradas especialmente para que voc√™ veja que o usu√°rio que "despeja" as imagens da Galeria na "lata de lixo" muito mais espa√ßo de manobra ao "soltar" <b>Solte do</b> que apenas o √≠cone da lixeira. <br>  A classe <b><font color="#0000FF">GarbageView possui</font></b> dois inicializadores e ambos usam o m√©todo <b><font color="#0000FF">setup ()</font></b> : <br><br><img src="https://habrastorage.org/webt/xj/_t/es/xj_tesvqnjlk9yxbxnrvrvc_6w8.png"><br><br>  No m√©todo <b><font color="#0000FF">setup ()</font></b> , tamb√©m adiciono <b><font color="#0000FF">myButton</font></b> como uma <b>subvis√£o</b> com a imagem da ‚Äúlata de lixo‚Äù extra√≠da do <code>Bar Button</code> padr√£o do <code>Bar Button</code> : <br><br><img src="https://habrastorage.org/webt/if/s5/3c/ifs53cvfeaggqwtrlshju1g5qwc.png"><br><br>  <b><font color="#0000FF">Defino</font></b> um plano de fundo transparente para o <b><font color="#0000FF">GarbageView</font></b> : <br><br><img src="https://habrastorage.org/webt/g_/9y/af/g_9yafe1tu_pz4vx6_wan3tarv0.png"><br><br>  O tamanho da lata de lixo e sua posi√ß√£o ser√£o determinados no m√©todo <b><font color="#0000FF">layoutSubviews ()</font></b> da classe <b><font color="#0000FF">UIView</font></b> , dependendo dos <b><font color="#0000FF">limites do</font></b> <b><font color="#0000FF">UIView</font></b> fornecido: <br><br><img src="https://habrastorage.org/webt/zf/ll/jb/zflljbnvhfenkfx0o2ge8iy2q2k.png"><br><br>  Esta √© a vers√£o inicial do aplicativo de demonstra√ß√£o "Image Gallery", est√° localizada no <b><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Github</a></code></b> na pasta <u><code>ImageGallery_beginning</code></u> .  Se voc√™ executar esta vers√£o do aplicativo "Image Gallery", ver√° o resultado do aplicativo trabalhando nos dados de teste, que ser√£o exclu√≠dos posteriormente e preencher√£o a "Image Gallery" exclusivamente FORA: <br><br><img src="https://habrastorage.org/webt/w9/jn/y4/w9jny4yxwtmeemq8cqkqhbirvoy.png"><br><br>  O plano para implementar o mecanismo <code>Drag &amp; Drop</code> em nosso aplicativo √© o seguinte: <br><br><ol><li>  primeiro, dotaremos nossa <code>Collection View</code> capacidade de "arrastar" <code>Drag</code> partir dela <b><font color="#0000FF">UIImage</font></b> imagens externamente e localmente, </li><li>  ensinaremos nossa cole√ß√£o de imagens do modo de <code>Collection View</code> de <code>Collection View</code> a aceitar o <code>Drag</code> "arrastado" externa ou localmente do <b><font color="#0000FF">UIImage</font></b> , </li><li>  tamb√©m ensinaremos nosso <b><font color="#0000FF">GarbageView</font></b> com o bot√£o da lata de lixo a aceitar imagens <b><font color="#0000FF">UIImage</font></b> arrastadas da <code>Collection View</code> local e remov√™-las da <code>Collection View</code> </li></ol><br><br>  Se voc√™ for ao final deste tutorial e concluir todas as altera√ß√µes de c√≥digo necess√°rias, receber√° a vers√£o final do aplicativo de demonstra√ß√£o ‚ÄúImage Gallery‚Äù, na qual o mecanismo <code>Drag &amp; Drop</code> foi implementado.  Est√° localizado no <b><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Github</a></code></b> na pasta <u><code>ImageGallery_finished</code></u> . <br><br>  O desempenho do mecanismo <code>Drag &amp; Drop</code> na sua <code>Collection View</code> fornecido por dois novos delegados. <br>  Os m√©todos <u>do primeiro delegado, <b><font color="#0000FF">dragDelegate</font></b> , s√£o</u> configurados para inicializar e personalizar os arrastar e soltar <code>Drags</code> . <br>  Os m√©todos do segundo delegado, <b><font color="#0000FF">dropDelegate</font></b> , concluem o arrastar e soltar do <code>Drags</code> e, basicamente, fornecem <code>Data transfer</code> dados e configura√ß√µes personalizadas de anima√ß√£o quando o <code>Drop</code> redefinido, al√©m de outras coisas semelhantes. <br><br>  √â importante observar que esses dois protocolos s√£o completamente independentes.  Voc√™ pode usar um ou outro protocolo se precisar apenas ‚Äúarrastar‚Äù <code>Drag</code> ou soltar ‚Äú <code>Drop</code> ‚Äù, mas voc√™ pode usar os dois protocolos de uma s√≥ vez e simultaneamente <code>Drag</code> e soltar <code>Drag</code> e <code>Drop</code> , o que abre funcionalidades adicionais <code>Drag &amp; Drop</code> mecanismo para reordenar itens na sua <code>Collection View</code> . <br><br><h1>  Arrastar e soltar elementos de <code>Drag</code> <code>Collection View</code> </h1><br>  A implementa√ß√£o do protocolo <code>Drag</code> √© muito simples, e a primeira coisa que voc√™ deve sempre fazer √© se definir como um delegado <b><font color="#0000FF">dragDelegate</font></b> : <br><br><img src="https://habrastorage.org/webt/mt/jw/dq/mtjwdqjahnvyzwjd0hz9cra47mg.png"><br><br>  E, √© claro, no topo da classe <b><font color="#0000FF">ImageGalleryCollectionViewController,</font></b> voc√™ deve dizer "Sim", implementamos o protocolo <b><font color="#0000FF">UICollectionViewDragDelegate</font></b> : <br><br><img src="https://habrastorage.org/webt/ie/ue/xv/ieuexvbtxfan-uouzv4cvxpjw20.png"><br><br>  Assim que fazemos isso, o compilador come√ßa a "reclamar", clicamos no c√≠rculo vermelho e nos perguntam: "Deseja adicionar os m√©todos necess√°rios do protocolo <b><font color="#0000FF">UICollectionViewDragDelegate</font></b> ?" <br>  Eu respondo: "Claro que quero!"  e clique no bot√£o <code>Fix</code> : <br><br><img src="https://habrastorage.org/webt/6d/24/it/6d24itltj_buh2uwe3fbgkh8my8.png"><br><br>  O √∫nico m√©todo necess√°rio do protocolo <b><font color="#0000FF">UICollectionViewDragDelegate</font></b> √© o m√©todo <b><font color="#0000FF">itemsForBeginning</font></b> , que informar√° o sistema <code>Drag</code> que "arrastamos e <b><font color="#0000FF">soltamos</font></b> ".  O m√©todo <b><font color="#0000FF">itemsForBeginning √©</font></b> chamado quando o usu√°rio come√ßa a "arrastar" ( <code>Dragging</code> ) uma c√©lula na <b><font color="#0000FF">c√©lula de</font></b> cole√ß√£o. <br><br>  Observe que, nesse m√©todo, a <code>Collection View</code> adicionou <b><font color="#0000FF">indexPath</font></b> .  Isso nos dir√° qual elemento da cole√ß√£o, qual <b><font color="#0000FF">indexPath</font></b> , vamos ‚Äúarrastar e soltar‚Äù.  Isso √© realmente muito conveniente para n√≥s, pois √© o aplicativo respons√°vel pelo uso dos argumentos <b><font color="#0000FF">session</font></b> e <b><font color="#0000FF">indexPath</font></b> para <b><font color="#0000FF">descobrir</font></b> como lidar com esse arrastar e soltar do <code>Drag</code> . <br><br>  Se a matriz <b><font color="#0000FF">[UIDragItems] dos</font></b> elementos " <b><font color="#0000FF">arrast√°veis</font></b> " for retornada, o "arrastar" do <code>Drag</code> inicializado; se a matriz vazia <b><font color="#0000FF">[] for</font></b> retornada, o "drag" do <code>Drag</code> ignorado. <br><br>  Vou criar uma pequena fun√ß√£o <b><font color="#0000FF">dragItems</font></b> <b><font color="#0000FF">privada</font></b> <b><font color="#0000FF">(em: indexPath)</font></b> com o argumento <b><font color="#0000FF">indexPath</font></b> .  Retorna a matriz <b><font color="#0000FF">[UIDragItem]</font></b> que <b><font color="#0000FF">precisamos</font></b> . <br><br><img src="https://habrastorage.org/webt/_y/iv/86/_yiv869sqaamn_ytg22fg89iez0.png"><br><br>  Como √© um <b><font color="#0000FF">UIDragItem de</font></b> arrastar e soltar? <br>  Ele tem apenas uma coisa muito importante chamada <b><font color="#0000FF">itemProvider</font></b> .  <b><font color="#0000FF">itemProvider</font></b> √© apenas algo que pode fornecer dados que ser√£o arrastados. <br><br>  E voc√™ tem o direito de perguntar: "E o" arrastar e soltar "de um elemento <b><font color="#0000FF">UIDragItem</font></b> que simplesmente n√£o possui dados?"  O item que voc√™ deseja arrastar pode n√£o ter dados, por exemplo, porque a cria√ß√£o desses dados √© uma opera√ß√£o cara.  Pode ser uma imagem de <b><font color="#0000FF">imagem</font></b> ou algo que exija o download de dados da Internet.  O melhor √© que a opera√ß√£o <code>Drag &amp; Drop</code> √© completamente ass√≠ncrona.  Quando voc√™ come√ßa a arrastar e soltar <code>Drag</code> , √© realmente um objeto muito leve ( <code>lift preview</code> ), voc√™ o arrasta para qualquer lugar e nada acontece durante esse "arrastar".  Mas assim que voc√™ "solta" <code>Drop</code> algum lugar seu objeto, sendo um <b><font color="#0000FF">itemProvider</font></b> , ele realmente deve fornecer ao seu objeto "arrastado" e "jogado" dados reais, mesmo que demore um certo tempo. <br><br>  Felizmente, existem muitos <b><font color="#0000FF">provedores de itens internos</font></b> .  Essas s√£o classes que j√° existem no <code>iOS</code> e s√£o <b><font color="#0000FF">itensPoviders</font></b> , como, por exemplo, <code>NSString</code> , que permite arrastar e soltar texto sem fontes.  Obviamente, esta √© uma imagem <b><font color="#0000FF">UIImage</font></b> .  Voc√™ pode selecionar e arrastar e soltar imagens <b><font color="#0000FF">UIImages por toda parte</font></b> .  A classe <b><font color="#0000FF">NSURL</font></b> , que √© absolutamente maravilhosa.  Voc√™ pode ir para a p√°gina da <code>Web</code> , selecionar o <code>URL</code> e solt√°-lo onde quiser.  Pode ser um link para um artigo ou um <code>URL</code> para uma imagem, como ser√° em nossa demonstra√ß√£o.  Essas s√£o as classes de cores do <b><font color="#0000FF">elemento do</font></b> mapa <b><font color="#0000FF">UIColor</font></b> , <b><font color="#0000FF">MKMapItem</font></b> , contato <b><font color="#0000FF">CNContact</font></b> no cat√°logo de endere√ßos, voc√™ pode selecionar e arrastar v√°rias coisas.  Todos eles s√£o <b><font color="#0000FF">itemProviders</font></b> . <br><br>  Vamos ‚Äúarrastar e soltar‚Äù a imagem <b><font color="#0000FF">UIImage</font></b> .  Ele est√° localizado na c√©lula da c√©lula <code>Collection View</code> com <b><font color="#0000FF">indexPath</font></b> , que me ajuda a selecionar a c√©lula da <b><font color="#0000FF">c√©lula</font></b> , obter o <code>Outlet</code> <b><font color="#0000FF">imageView</font></b> e obter a imagem da <b><font color="#0000FF">imagem</font></b> . <br><br>  Vamos expressar essa id√©ia com algumas linhas de c√≥digo. <br>  Primeiro, solicito minha <code>Collection View</code> sobre uma <b><font color="#0000FF">c√©lula</font></b> para o elemento do <b><font color="#0000FF">item</font></b> correspondente a este <b><font color="#0000FF">indexPath</font></b> . <br><br><img src="https://habrastorage.org/webt/ho/zi/gp/hozigp41-y0-3cfa525umwojyu4.png"><br><br>  O <b><font color="#0000FF">m√©todo cellForItem (at: IndexPath)</font></b> para o modo de <code>Collection View</code> funciona apenas para c√©lulas vis√≠veis, mas, √© claro, funcionar√° no nosso caso, porque eu ‚Äúarrasto e solto‚Äù o elemento de cole√ß√£o de <code>Drag</code> na tela e fica vis√≠vel. <br><br>  Ent√£o, eu tenho uma c√©lula de <b><font color="#0000FF">c√©lula</font></b> "arrast√°vel". <br>  Em seguida, eu uso o operador as <b><font color="#0000FF">?</font></b>  para esta c√©lula para que ele tenha um TIPO da minha <code>subclass</code> personalizada.  E se isso funcionar, recebo um <code>Outlet</code> <b><font color="#0000FF">imageView</font></b> , do qual <b><font color="#0000FF">retiro</font></b> sua <b><font color="#0000FF">imagem</font></b> .  Eu apenas ‚Äúcapturei‚Äù a imagem da <b><font color="#0000FF">imagem</font></b> para este <b><font color="#0000FF">indexPath</font></b> . <br><br>  Agora que tenho uma imagem, basta criar um desses <b><font color="#0000FF">UIDragItems</font></b> usando a imagem resultante como <b><font color="#0000FF">itemProvider</font></b> , ou seja, o que nos fornece os dados. <br>  Posso criar <b><font color="#0000FF">dragItem</font></b> usando o construtor <b><font color="#0000FF">UIDragItem</font></b> , que aceita <b><font color="#0000FF">itemProvider</font></b> como argumento: <br><br><img src="https://habrastorage.org/webt/to/zb/gt/tozbgtxocfrgoaqofvn9jgf9yeo.png"><br><br>  Em seguida, criamos um <b><font color="#0000FF">itemProvider</font></b> para a imagem da <b><font color="#0000FF">imagem</font></b> tamb√©m usando o construtor <b><font color="#0000FF">NSItemProvider</font></b> .  Existem v√°rios construtores para o <b><font color="#0000FF">NSItemProvider</font></b> , mas entre eles existe um realmente maravilhoso - o <b><font color="#0000FF">NSItemProvider (objeto: NSItemProviderWriting)</font></b> : <br><br><img src="https://habrastorage.org/webt/ey/21/cq/ey21cq0iq5riml7pfrye4gcnmi8.png"><br><br>  Voc√™ simplesmente fornece o objeto de <b><font color="#0000FF">objeto para</font></b> esse construtor <b><font color="#0000FF">NSItemProvider</font></b> e ele sabe como fazer com que <b><font color="#0000FF">itemProvider</font></b> seja <b><font color="#0000FF">usado</font></b> .  Como um <b><font color="#0000FF">objeto,</font></b> dou √† imagem a <b><font color="#0000FF">imagem</font></b> que recebi da c√©lula da <b><font color="#0000FF">c√©lula</font></b> e obtenho o <b><font color="#0000FF">itemProvider</font></b> para <b><font color="#0000FF">UIImage</font></b> . <br>  E isso √© tudo.  Criamos <b><font color="#0000FF">dragItem</font></b> e devemos devolv√™-lo como uma matriz com um elemento. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas antes de eu voltar </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , eu vou fazer mais uma coisa, ou seja, para definir a vari√°vel </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , igual √† imagem resultante </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><img src="https://habrastorage.org/webt/sh/h0/cz/shh0czt4sxjd7ienvsl2slz8yju.png"><br><br>  O que isso significa? <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ executar ‚Äúarrastar e soltar‚Äù </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localmente, isto √©, dentro do aplicativo, n√£o precisar√° passar por todo esse c√≥digo associado ao </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemProvider</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , atrav√©s da recupera√ß√£o de dados ass√≠ncrona. Voc√™ n√£o precisa fazer isso, basta pegar o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e us√°-lo. Este √© um tipo de "curto-circuito" com "arrastar e soltar" local </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O c√≥digo que escrevemos funcionar√° ao "arrastar" </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fora de nossa cole√ß√£o </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para outros aplicativos, mas se "arrastarmos" </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localmente, poderemos usar </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Em seguida, retorno uma matriz de um elemento </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A prop√≥sito, se, por algum motivo, n√£o consegui obter uma </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para essa c√©lula da </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√©lula</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , retornei uma matriz vazia </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[]</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , isso significa que o "arrastar e soltar" </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foi cancelado. </font></font><br><br><img src="https://habrastorage.org/webt/4b/uk/o3/4buko3fve2swk7wr7d_oy5sflma.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m de objeto local </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , voc√™ pode se lembrar do contexto local </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para a nossa </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sess√£o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a sess√£o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . No nosso caso, ser√° uma cole√ß√£o de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CollectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e √© √∫til para n√≥s depois: </font></font><br><br><img src="https://habrastorage.org/webt/o_/gi/tk/o_gitkbwnnbcevnxwcwm6obckwk.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ter "arrastar e soltar" </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, voc√™ pode adicionar mais itens </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itens</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a esta "arrastar e soltar", apenas fazendo o gesto </font></font><b><font color="#FF00FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">da torneira</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre eles. Como resultado, voc√™ pode arrastar</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muitos itens de cada vez. E isso √© f√°cil de implementar com outro </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©todo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> delegado </font><font style="vertical-align: inherit;">, </font><b><font color="#0000FF"><font style="vertical-align: inherit;">UICollectionViewDragDelegate</font></font></b><font style="vertical-align: inherit;"> , muito semelhante ao m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemsForeginning</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um m√©todo chamado </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemsForAddingTo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . O m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemsForAddingTo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parece exatamente igual ao </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item itemsFor√Çeginning</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e retorna exatamente a mesma coisa, porque tamb√©m fornece um </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">caminho de indexa√ß√£o do</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que o usu√°rio ‚Äúgravou‚Äù durante o processo de ‚Äúarrastar </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font><font style="vertical-align: inherit;">soltar‚Äù </font><font style="vertical-align: inherit;">, e eu s√≥ preciso colocar a </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da c√©lula na que o usu√°rio ‚Äúgravou‚Äù e devolva-o. </font></font><br><br><img src="https://habrastorage.org/webt/u-/hc/9d/u-hc9dnk3001qhkra-et6oycphi.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retornar uma matriz vazia </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[]</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemsForAddingTo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">leva ao fato de que o gesto de </font></font><b><font color="#FF00FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toque</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ser√° interpretado da maneira usual, ou seja, como a escolha dessa c√©lula da </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√©lula</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E √© tudo o que precisamos para arrastar e soltar </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iniciamos o aplicativo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu seleciono a imagem "Veneza", seguro por um tempo e come√ßo a mover ... </font></font><br><br><img src="https://habrastorage.org/webt/p7/ne/9z/p7ne9zdwnirsf2uxjogvflrqwao.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... e podemos realmente arrastar essa imagem para o aplicativo </font></font><code>Photos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, como voc√™ v√™ o sinal de mais verde "+" no canto superior esquerdo da imagem "arrast√°vel". Posso executar um gesto de </font></font><b><font color="#FF00FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toque</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em outra imagem Artika da cole√ß√£o </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... </font></font><br><br><img src="https://habrastorage.org/webt/cg/sj/om/cgsjomxtwxyzqxg-wxvqxz4huqi.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... e agora podemos inserir duas imagens no aplicativo </font></font><code>Photos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br><br><img src="https://habrastorage.org/webt/bk/xk/ud/bkxkud6ggdorw2d1yayjmatnsf4.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como o </font></font><code>Photos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mecanismo j√° est√° embutido </font><font style="vertical-align: inherit;">no aplicativo</font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ent√£o tudo funciona muito bem e √© legal. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, o "arrastar" </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e o "despejo" da </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagem </font><font style="vertical-align: inherit;">da </font><font style="vertical-align: inherit;">Galeria para outros aplicativos </font><font style="vertical-align: inherit;">funcionam para mim </font><font style="vertical-align: inherit;">. N√£o </font><b><font color="#0000FF"><font style="vertical-align: inherit;">precisei</font></font></b><font style="vertical-align: inherit;"> fazer muito no meu aplicativo, exceto para entregar a imagem da </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como uma matriz </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[UIDragItem]</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esse √© um dos muitos recursos excelentes do mecanismo </font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- √© muito f√°cil faz√™-lo funcionar nas duas dire√ß√µes.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redefinir </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagens para a cole√ß√£o</font></font><code>Collection View</code> </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora precisamos fazer uma </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parte da minha cole√ß√£o </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para que possamos "despejar" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qualquer imagem "arrastada" DENTRO desta cole√ß√£o. Uma imagem "arrast√°vel" pode "vir" de FORA, ou diretamente DENTRO desta cole√ß√£o. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para fazer isso, n√≥s fazemos a mesma coisa feita para delegar </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragDelegate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ou seja, fazer a n√≥s mesmos, </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o auto</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , delegar </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dropDelegate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do viewDidLoad</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/5q/wv/mf/5qwvmfjuyh74sfxzwcw7_0gikec.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais uma vez, temos que subir at√© o topo da nossa classe </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageGalleryCollectionViewController</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e verificar protocolo implementa√ß√£o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UICollectionViewDropDelegate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><img src="https://habrastorage.org/webt/wc/ww/7p/wcww7pgfia3xxwe63teews1e9de.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assim que adicionamos nosso novo protocolo, o compilador novamente come√ßou a "reclamar" de que n√£o implementamos esse protocolo. Clicamos no bot√£o </font></font><code>Fix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e os m√©todos necess√°rios deste protocolo aparecem √† nossa frente. Nesse caso, somos informados de que devemos implementar o m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/ll/9t/k4/ll9tk4goht7nfa-gnifnq8iaoto.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devemos fazer isso, caso contr√°rio, uma ‚Äúredefini√ß√£o‚Äù n√£o ocorrer√° </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Na verdade, vou implementar o m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop por</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √∫ltimo, porque existem alguns outros </font></font><code>Apple</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©todos </font><font style="vertical-align: inherit;">altamente recomendados </font><font style="vertical-align: inherit;">que voc√™ precisa implementar para a </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pe√ßa. Isso √© </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canHandle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dropSessionDidUpdate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><img src="https://habrastorage.org/webt/jd/ce/ve/jdcevehobhr1k7wwvc1iaem-w80.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se implementarmos esses dois m√©todos, obteremos um pequeno sinal de adi√ß√£o verde ‚Äú+‚Äù quando arrastarmos imagens de FORA para nossa cole√ß√£o </font></font><code>ollection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e, al√©m disso, elas n√£o tentar√£o despejar o que n√£o entendemos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos implementar o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canHandle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . sua vers√£o do m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canHandle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que se destina √† coleta </font></font><code>ollection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas esse m√©todo </font></font><code>ollection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parece exatamente o mesmo que o m√©todo semelhante para </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> regular </font><font style="vertical-align: inherit;">, n√£o h√° </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , basta retornar o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">session.canLoadObjects (ofClass: UIImage.self)</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e isso significa que eu aceito o "reset" dos objetos deste cl PAS em minha cole√ß√£o </font></font><code>ollection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><img src="https://habrastorage.org/webt/0j/tz/ze/0jtzzen649jj7z58-3tiq_ehrvs.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas isso n√£o √© suficiente para "despejar" a </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagem na minha cole√ß√£o </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FORA. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o "reset" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a imagem ocorre dentro da cole√ß√£o </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o usu√°rio vai reorganizar seus pr√≥prios elementos de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itens</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atrav√©s do mecanismo </font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, em seguida, apenas uma imagem </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de um UIImage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e implementa√ß√£o do m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canHandle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ser√° semelhante √† maneira acima. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas se o "dumping" da </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagem ocorrer FORA, ent√£o devemos manipular apenas o "arrastar e soltar" </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que representa a imagem </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIImage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> junto com </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esta imagem, pois n√£o vamos armazenar as imagens </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIImage diretamente</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no modelo. Nesse caso, retornarei </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> somente </font><font style="vertical-align: inherit;">no m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canHandle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se algumas condi√ß√µes forem atendidas ao mesmo tempo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: session.canLoadObjects (ofClass: NSURL.self) &amp;&amp; session.canLoadObjects (ofClass: UIImage.self)</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/yj/dt/qn/yjdtqnmmxq0olgilbz1ifa5mdt8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preciso determinar se estou lidando com uma "redefini√ß√£o" FORA OU DENTRO. Eu vou fazer isso com a ajuda de constantes calculadas </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isself</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , para o qual o c√°lculo que eu possa usar esse tipo de coisa na </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sess√£o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a sess√£o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tanto o seu local de </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sess√£o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localDragSession</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Esta </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sess√£o </font><font style="vertical-align: inherit;">local </font><font style="vertical-align: inherit;">, por sua vez, possui um contexto local </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ se lembra, definimos esse contexto local no m√©todo</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemsForVeginning</font></font></font></b> <code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> delegado</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UICollectionViewDragDelegate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><img src="https://habrastorage.org/webt/o_/gi/tk/o_gitkbwnnbcevnxwcwm6obckwk.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu estou indo para explorar o contexto local</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> localContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a igualdade na minha cole√ß√£o</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CollectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Verdadeiro, TYPE de</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> localContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ser√°</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Any</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e preciso fazer uma convers√£o de TYPE</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Any</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usando o operador as</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? UICollectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><img src="https://habrastorage.org/webt/kc/zk/nt/kczknt6xiau08k5d06xu40akoyu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se o contexto local</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (session.localDragSession? .LocalContext como? UICollectionView)</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for igual √† minha cole√ß√£o</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a vari√°vel calculada</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> isSelf</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ser√°</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verdadeira</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e h√° um "reset" local dentro da minha cole√ß√£o. Se essa igualdade for violada, estamos lidando com uma "redefini√ß√£o" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FORA. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canHandle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> relata que s√≥ podemos lidar com esse tipo de "arrastar e soltar" </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em nossa cole√ß√£o </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Caso contr√°rio, mais adiante, n√£o faz sentido falar sobre "dumping" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se continuarmos a "reset" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ainda √© at√© o momento em que o usu√°rio vai levantar os dedos para fora da tela e n√£o haver√° uma "redefini√ß√£o" real </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, temos que denunciar </font></font><code>iOS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usando o m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dropSessionDidUpdate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> delegado </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UICollectionViewDropDelegate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre a nossa oferta </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDropProposal</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para implementar reinicializa√ß√£o </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesse m√©todo, devemos retornar uma </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">senten√ßa que possa ter valores </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.copy</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.move</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.cancel</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.forbidden</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para o argumento da </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opera√ß√£o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . E essas s√£o todas as possibilidades que temos no caso comum ao lidar com uma </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> regular </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas a cole√ß√£o </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vai al√©m e oferece o retorno da oferta especializada </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UICollectionViewDropProposal</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que √© uma </font></font><code>subclass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classe de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDropProposal</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e permite </font><font style="vertical-align: inherit;">especificar, </font><font style="vertical-align: inherit;">al√©m da opera√ß√£o de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opera√ß√£o,</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> um par√¢metro de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inten√ß√£o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adicional </font><font style="vertical-align: inherit;">para a cole√ß√£o </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par√¢metro</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inten√ß√£o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cole√ß√µes relatado</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de se queremos celular "descart√°vel" colocado dentro de uma c√©lula existente</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> celular</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e n√≥s queremos adicionar uma nova c√©lula</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> celular</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .Vidite diferen√ßa? No caso da cole√ß√£o,</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devemos comunicar nossa</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> inten√ß√£o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No nosso caso, sempre queremos adicionar uma nova c√©lula, para que voc√™ veja qual ser√° o nosso par√¢metro</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> intent</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selecionamos o segundo construtor para</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UICollectionViewDropProposal</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><img src="https://habrastorage.org/webt/ab/vh/-p/abvh-pb04qje37u4jjgveja3lgu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no nosso caso, sempre queremos adicionar uma nova c√©lula e o par√¢metro</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> intent</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> assumir√° o valor</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .insertAtDestinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em oposi√ß√£o</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.insertIntoDestinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><img src="https://habrastorage.org/webt/yg/t0/xi/ygt0xirvwaucl9zvuvuxvvil2cu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Novamente usei a constante calculada</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> isSelf</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e, se for uma</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auto-</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reorganiza√ß√£o, estou movendo</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .move</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , caso contr√°rio, estou copiando</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .copy</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nos dois casos, usamos</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .insertAtDestinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ou seja, inserir novas</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> c√©lulas</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At√© agora, eu n√£o implementei o m√©todo</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas vamos dar uma olhada no que uma cole√ß√£o j√° pode fazer</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com esse pequeno peda√ßo de informa√ß√£o que fornecemos a ela.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arrasto a imagem do</font></font><code>Safari</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mecanismo de pesquisa</font></font><code>Google</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e um sinal verde "+" aparece na parte superior desta imagem, indicando que nossa Galeria de imagens n√£o est√° pronta apenas para aceitar e copiar esta imagem </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas tamb√©m fornece um local dentro da cole√ß√£o </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br><br><img src="https://habrastorage.org/webt/ia/gy/gv/iagygvechjnwsm-tfvduwi0pc1o.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">posso clicar em outro par de imagens </font></font><code>Safari</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e J√° haver√° tr√™s imagens "arrastadas": </font></font><br><br><img src="https://habrastorage.org/webt/kd/ca/7s/kdca7sflzfrbbsbtmnk8_zbueqm.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mas se eu levantar o dedo e soltar </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">essas imagens, elas n√£o ser√£o colocadas em nossa Galeria, mas simplesmente retornam aos seus lugares anteriores, porque ainda n√£o implementamos o m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><img src="https://habrastorage.org/webt/5v/e4/me/5ve4me_unk6t-azl6fhatljzgxs.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode ver que a cole√ß√£o </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">j√° sabe o que eu quero fazer. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A cole√ß√£o </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© uma coisa absolutamente maravilhosa para o mecanismo.</font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ela tem uma funcionalidade muito poderosa para isso. N√≥s mal a tocamos escrevendo 4 linhas de c√≥digo, e ela j√° se moveu bastante na percep√ß√£o de "redefinir" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos voltar ao c√≥digo e implementar o m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><img src="https://habrastorage.org/webt/i0/cc/es/i0ccescpyvub0pclhjyzcbdcu7o.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesse m√©todo, n√£o seremos capazes de sobreviver com quatro linhas de c√≥digo, porque o m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop √© um</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pouco mais complicado, mas n√£o muito. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando a "redefini√ß√£o" ocorre </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, no m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , precisamos atualizar nosso Model, que √© a </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">galeria</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de imagens </font><b><font color="#0000FF"><font style="vertical-align: inherit;">imageGallery</font></font></b><font style="vertical-align: inherit;"> com uma lista de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagens</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e precisamos atualizar nossa cole√ß√£o visual </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temos dois cen√°rios diferentes de "redefini√ß√£o" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se houver uma ‚Äúredefini√ß√£o‚Äù </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">da minha cole√ß√£o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , eu tenho que ‚Äúredefinir‚Äù o </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elemento </font><font style="vertical-align: inherit;">da </font><font style="vertical-align: inherit;">cole√ß√£o em um novo local e remov√™-lo do local antigo, pois nesse caso movo ( </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.move</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) esse elemento da cole√ß√£o. Esta √© uma tarefa trivial. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√° um "Reset" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© realizada de outro aplicativo, ent√£o precisamos usar a propriedade </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemProvider</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬´arrastado¬ª elemento </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artigo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para buscar dados. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando executamos uma ‚Äúredefini√ß√£o‚Äù </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na cole√ß√£o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a cole√ß√£o nos fornece um coordenador </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordenador</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Em primeiro lugar, n√≥s informamos o coordenador </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordenador</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ele </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ou seja </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "-destination", "reset" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que √© onde n√≥s ser√° "redefinido". </font></font><br><br><img src="https://habrastorage.org/webt/mp/mt/wk/mpmtwkebx7beyw5ge72gt19xt7k.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pode ser </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pois voc√™ pode arrastar a imagem "descartada" para a parte da cole√ß√£o </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que n√£o √© o local entre algumas </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√©lulas</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> existentes </font><font style="vertical-align: inherit;">, portanto pode ser </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Se h√° a situa√ß√£o, ent√£o eu criar </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com o elemento 0 </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artigo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na th se√ß√£o do 0 </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se√ß√£o chamada</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><img src="https://habrastorage.org/webt/qd/ei/me/qdeimejhoj1v0pkgml2xtog1jke.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu poderia escolher qualquer outro </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas </font><font style="vertical-align: inherit;">usarei </font><font style="vertical-align: inherit;">esse </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por padr√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora sabemos onde iremos executar o "reset" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Temos que passar por todos os itens de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordenador</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "redefin√≠veis" </font><font style="vertical-align: inherit;">fornecidos pelo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordenador</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Cada </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> desta lista possui um </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UICollectionViewDropItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> TYPE </font><font style="vertical-align: inherit;">e pode nos fornecer informa√ß√µes muito interessantes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por exemplo, se eu conseguir </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item.sourceIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , eu vou saber exatamente o que √© "arrastar e soltar" </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© feito por si s√≥, </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a auto</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e a origem do arrasto </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© o item de cole√ß√£o com </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> igual a </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/y2/3d/2u/y23d2u0pmf1pnasfw2khu9htji4.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nem mesmo preciso procurar </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nesse caso para descobrir que esse "arrastar e soltar" foi feito DENTRO da cole√ß√£o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font> Uau! <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora eu conhe√ßo o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceIndexPath de</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> origem </font><font style="vertical-align: inherit;">e o destinationIndexPath de " </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destino</font></font></font></b> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e a tarefa se torna trivial. Tudo o que preciso fazer √© atualizar o Model para que a origem e o "destino" sejam trocados e, em seguida, atualizar a cole√ß√£o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , na qual voc√™ precisar√° remover o item da cole√ß√£o com </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e adicion√°-lo √† cole√ß√£o com </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nosso caso local √© o mais simples, porque, nesse caso, o mecanismo </font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funciona n√£o apenas no mesmo aplicativo, mas na mesma cole√ß√£o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e posso obter todas as informa√ß√µes necess√°rias usando o coordenador </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordenador</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Vamos implement√°-lo neste caso local mais simples: </font></font><br><br><img src="https://habrastorage.org/webt/1m/uu/4r/1muu4rnsxmehwuyybyspei14bvo.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no nosso caso, nem preciso do </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que "escondi" anteriormente quando criei o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e que agora posso emprestar do </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "arrastado" </font><font style="vertical-align: inherit;">na </font><font style="vertical-align: inherit;">cole√ß√£o de </font><b><font color="#0000FF"><font style="vertical-align: inherit;">itens</font></font></b><font style="vertical-align: inherit;"> no formul√°rio </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item.localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Necessitaremos disso ao ‚Äúdescarregar‚Äù as </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagens na ‚Äúlixeira‚Äù, que est√° no mesmo aplicativo, mas n√£o √© a mesma cole√ß√£o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dois </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexPathes s√£o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> suficientes para mim </font><b><font color="#0000FF"><font style="vertical-align: inherit;">agora</font></font></b><font style="vertical-align: inherit;"> : o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceIndexPath de</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> origem </font><font style="vertical-align: inherit;">e o destinationIndexPath de " </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destino</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu recebo informa√ß√µes primeiro</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageInfo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre a imagem no local antigo do Modelo, removendo-a de l√°. E, em seguida, inserir em uma s√©rie de</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imagens</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da minha modelos</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ImageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> informa√ß√µes</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ImageInfo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> uma imagem com um novo √≠ndice</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> destinationIndexPath.item</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Foi assim que atualizei meu modelo:</font></font><br><br><img src="https://habrastorage.org/webt/pk/bk/ny/pkbknyitrog4kq40dcs7sfpxk0g.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agora tenho que atualizar a pr√≥pria cole√ß√£o</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . √â muito importante entender que n√£o quero sobrecarregar todos os dados da minha</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reloadData ()</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no meio do processo de "arrastar e soltar"</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, porque ele reinstala todo o "mundo" da nossa Galeria de imagens, o que √© muito ruim, N√ÉO FA√áA. Em vez disso, vou arrumar e inserir elementos</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itens</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> individualmente:</font></font><br><br><img src="https://habrastorage.org/webt/1-/xa/jg/1-xajgm6ru3uwhqh53w4tf7tblu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exclu√≠ o item da cole√ß√£o</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sourceIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e inseri um novo item de cole√ß√£o com</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> destinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parece que esse c√≥digo funciona muito bem, mas, na realidade, esse c√≥digo pode "travar" seu aplicativo. O motivo √© que voc√™ faz in√∫meras altera√ß√µes em sua cole√ß√£o</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e, nesse caso, cada etapa da altera√ß√£o da cole√ß√£o precisa ser sincronizada com o Modelo normalmente, o que n√£o √© observado em nosso caso, pois realizamos as duas opera√ß√µes ao mesmo tempo: excluir e inserir. Da√≠ a cole√ß√£o</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estar√° em algum momento em um estado N√ÉO sincronizado com o modelo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas h√° muito legal maneira de contorn√°-la, o que √© que a cole√ß√£o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CollectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tem um m√©todo chamado </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performBatchUpdates</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que tem circuito ( </font></font><code>closure</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) e dentro deste circuito I pode colocar qualquer n√∫mero desses </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DeleteItems</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertItems</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">moveItems</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e tudo que eu quero: </font></font><br><br><img src="https://habrastorage.org/webt/6b/w_/6n/6bw_6nemnuzuv8xowkmmpt4yumw.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agora </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DeleteItems</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertItems</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ser√° executada como uma √∫nica opera√ß√£o, e nunca ser√° visto a falta de sincroniza√ß√£o de seus modelos com uma cole√ß√£o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CollectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E, finalmente, a √∫ltima coisa que precisamos fazer √© pedir ao </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordenador para</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> implementar e animar o "reset" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br><br><img src="https://habrastorage.org/webt/7k/qr/1u/7kqr1uatpcgzp8vim6hsf1-o_lo.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assim que voc√™ levanta o dedo da tela, a imagem se move, tudo acontece ao mesmo tempo: "reset", a imagem desaparece em um lugar e apar√™ncia em outro. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos tentar mover a imagem de teste "Veneza" em nossa Galeria de imagens para o final da primeira linha ... </font></font><br><br><img src="https://habrastorage.org/webt/gy/k4/ci/gyk4ci8msjogcvzo4hb8iqt2atq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... e "redefini-la": </font></font><br><br><img src="https://habrastorage.org/webt/kb/a0/mv/kba0mvrjzqyf_wf1y8b0j5h27oy.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como quer√≠amos, ela foi colocada no final da primeira linha.</font></font><br>  Viva!<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tudo funciona! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora, N√ÉO trataremos do caso local, ou seja, quando o elemento "reset" vier para FORA, ou seja, de outro aplicativo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para fazer isso, escrevemos </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mais</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no c√≥digo </font><font style="vertical-align: inherit;">com rela√ß√£o ao </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Se n√£o tivermos </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , isso significa que o elemento "redefin√≠vel" veio de OUTSIDE e teremos que usar a transfer√™ncia de dados usando o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemProver do</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> elemento </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">redefin√≠vel item.dragItem.itemProvider</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/wh/-9/gd/wh-9gdfe_e52v_9-wc-mf6o-7co.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se voc√™ "arrastar </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font><font style="vertical-align: inherit;">soltar" </font><font style="vertical-align: inherit;">OUTSIDE e "soltar" "</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, essas informa√ß√µes ficam dispon√≠veis instantaneamente? N√£o, voc√™ seleciona dados da coisa ‚Äúarrastada‚Äù ASSINANTE DE FORMA OCORRIDA. Mas e se a amostra demorar 10 segundos? O que a cole√ß√£o far√° neste momento </font></font><code>ollection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Al√©m disso, os dados podem n√£o chegar na ordem em que foram solicitados. Gerenciar isso n√£o √© f√°cil, e </font></font><code>Apple</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prop√¥s para </font></font><code>ollection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este caso uma tecnologia completamente nova para o uso de substitutos </font></font><code>Placeholders</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ coloca um </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">espa√ßo reservado </font><font style="vertical-align: inherit;">em sua cole√ß√£o </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e a cole√ß√£o </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gerencia tudo para voc√™; portanto, tudo o que voc√™ precisa fazer quando os dados s√£o finalmente selecionados √© solicitar ao espa√ßo reservado que </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chame seu </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">espa√ßo reservado</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e diga a ele que voc√™ recebeu as informa√ß√µes. Em seguida, atualize o seu modelo e contexto </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">placeholderContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> AUTOMATICAMENTE troca celular </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">celular</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com um espa√ßo reservado </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para uma das suas c√©lulas </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√©lulas</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o que corresponde ao tipo de dados que voc√™ recebeu. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Realizamos todas essas a√ß√µes criando um contexto de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">espa√ßo reservado placeholderContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que gerencia o espa√ßo reservado </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e que voc√™ obt√©m do coordenador do </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordenador</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , solicitando que voc√™ ‚Äúredefina‚Äù </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o elemento do </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para o espa√ßo reservado </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usarei o inicializador para o contexto de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">espa√ßo reservado placeholderContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que "lan√ßa" </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para um </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UICollectionViewDropPlaceholder</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/xh/lo/gk/xhlogk8aee_nhrukgwbtq0m8nae.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O objeto que vou "lan√ßar" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item.dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , em que </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© um elemento </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de um </font><font style="vertical-align: inherit;">loop, pois podemos lan√ßar </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muitos </font><b><font color="#0000FF"><font style="vertical-align: inherit;">itens de </font></font></b></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordenador</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . N√≥s os "jogamos" um a um. Ent√£o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item.dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© o que "arrastamos </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font><b><font color="#0000FF"><font style="vertical-align: inherit;">soltamos</font></font></b><font style="vertical-align: inherit;"> " </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. O pr√≥ximo argumento para essa fun√ß√£o √© o espa√ßo reservado, e eu o crio usando o inicializador </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UICollectionViewDropPlaceholder</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/hg/yu/jk/hgyujkpqodrfosah0opsrwwc-t0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para fazer isso, preciso saber ONDE vou inserir o espa√ßo reservado</font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ou seja, </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertionIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , bem como o identificador da c√©lula reutilizada </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reuseIdentifier</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O argumento </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertionIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© obviamente igual a </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; √© o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para colocar o objeto "arrastado"; √© calculado no in√≠cio do m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDropWith</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora vamos ver o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID da</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> c√©lula </font><b><font color="#0000FF"><font style="vertical-align: inherit;">reuseIdentifier</font></font></b><font style="vertical-align: inherit;"> . Voc√™ deve decidir que tipo de c√©lula </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">celular √© o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seu localizador </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. O coordenador do </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordenador</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o possui uma </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√©lula</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "pr√©- </font><font style="vertical-align: inherit;">empacotada </font><font style="vertical-align: inherit;">" </font><font style="vertical-align: inherit;">para o localizador</font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. √â VOC√ä quem deve decidir sobre essa </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√©lula</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Portanto, o identificador da c√©lula reutilizada reutiliza√ß√£o de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">identifica√ß√£o √© solicitado</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ao seu, </font></font><code>storyboard</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para que possa ser usado como um PROTOTYPE. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vou cham√°-lo de "DropPlaceholderCell", mas basicamente, eu poderia nomear o que quer que seja. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta √© apenas a string </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">String</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que eu vou usar na minha </font></font><code>storyboard</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para criar essa coisa. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Volte ao nosso </font></font><code>storyboard</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e crie uma c√©lula de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√©lula</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para o espa√ßo reservado </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Para fazer isso, basta selecionar uma cole√ß√£o </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e inspecion√°-la. No primeiro campo, </font></font><code>Items</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mudo </font></font><code>1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para</font></font><code>2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Isso cria imediatamente uma segunda c√©lula para n√≥s, que √© uma c√≥pia exata da primeira. </font></font><br><br><img src="https://habrastorage.org/webt/df/go/ke/dfgokefx6miugtxs8ee0_jl1zsk.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selecionamos nossa nova c√©lula </font></font><code>ImageCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, definimos o identificador ‚Äú </font></font><code>DropPlaceholderCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äù, exclu√≠mos todos os </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elementos </font><font style="vertical-align: inherit;">de l√° </font><font style="vertical-align: inherit;">, inclusive </font></font><code>Image View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, j√° que esse PROTOTYPE √© usado quando a imagem ainda n√£o chegou. N√≥s adicionamos um novo indicador de atividade na Paleta de Objetos </font></font><code>Activity Indicator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que ser√° rotacionado, informando aos usu√°rios que espero alguns dados de "redefini√ß√£o". Tamb√©m alterar a cor de fundo </font></font><code>Background</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para entender que quando "Reset" a imagem funciona exatamente essa c√©lula </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">celular</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como prot√≥tipos: </font></font><br><br><img src="https://habrastorage.org/webt/ur/gi/72/urgi728r6j2a1d2z0tf_4k-er1a.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m do tipo de nova c√©lula n√£o deve ser </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageCollectionVewCell</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, porque n√£o haver√° imagens nele. </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tornarei</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> essa c√©lula uma c√©lula normal </font><b><font color="#0000FF"><font style="vertical-align: inherit;">UIollectionCiewCell</font></font></b><font style="vertical-align: inherit;"> TYPE </font><font style="vertical-align: inherit;">, j√° que n√£o precisamos </font></font><code>Outlets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de controle: </font></font><br><br><img src="https://habrastorage.org/webt/sg/d8/ya/sgd8ya2342bd0lgk9fl172j-8pi.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vamos configurar o indicador de atividade </font></font><code>Activity Indicator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para que ele comece a animar desde o in√≠cio e n√£o precisaria escrever nada no c√≥digo para inici√°-lo. Para fazer isso, clique na op√ß√£o </font></font><code>Animating</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br><br><img src="https://habrastorage.org/webt/qm/de/hq/qmdehqmwsuzn_dt8fkbjdoclkss.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E √© tudo. Ent√£o, fizemos todas as configura√ß√µes para essa c√©lula </font></font><code>DropPlaceholderCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, retornamos ao nosso c√≥digo. Agora temos um √≥timo localizador </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pronto para </font><font style="vertical-align: inherit;">usar </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tudo o que precisamos fazer √© obter os dados e, quando os dados s√£o recebidos, basta informar o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">placeholderContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre esse contexto </font><font style="vertical-align: inherit;">e ele trocar√° o placeholder</font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e nossa c√©lula "nativa" com dados, e faremos altera√ß√µes no modelo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vou carregar um objeto, que ser√° meu </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usando o m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loadObject (ofClass: UIImage.self)</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (singular). Eu uso o c√≥digo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item.dragItem.itemProvider</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fornecedor </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemProvider</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que ir√° fornecer elementos de dados tem </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item de</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> forma ass√≠ncrona. √â claro que, se o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iitemProvider estiver</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conectado </font><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">obteremos o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">objeto de</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "redefini√ß√£o" </font><font style="vertical-align: inherit;">do </font><b><font color="#0000FF"><font style="vertical-align: inherit;">iitem</font></font></b><font style="vertical-align: inherit;"> fora deste aplicativo. A seguir, √© apresentado o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©todo loadObject (ofClass: UIImage.self)</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (singular): </font></font><br><br><img src="https://habrastorage.org/webt/bv/pl/fj/bvplfjtt-wlffytoqky4jxcbxco.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esse fechamento espec√≠fico N√ÉO √© realizado em</font></font><code>main queue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. E, infelizmente, tivemos que mudar para o </font></font><code>main queue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uso de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DispatchQueue.main.async {}</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para "capturar" a propor√ß√£o da imagem na vari√°vel </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aspectRatio</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> local </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introduzimos realmente duas vari√°veis ‚Äã‚Äãlocais </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageURL</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aspectRatio</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... </font></font><br><br><img src="https://habrastorage.org/webt/vc/k3/vg/vck3vgqg7grejo8tj2ojbdnfdny.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... e as capturamos ao carregar a imagem da </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e o URL da </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URL</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/jc/ui/yk/jcuiyk3c1zcz4wmkeafkpmkdvqq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se as vari√°veis ‚Äã‚Äãlocais </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageURL</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aspectRatio</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o </font><b><font color="#0000FF"><font style="vertical-align: inherit;">forem </font></font></b></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulas</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , solicitaremos ao contexto do </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">espa√ßo reservado placeholderontext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usando o m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commitInsertion</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nos d√™ a oportunidade de alterar nosso modelo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/z6/hm/8w/z6hm8w4jnyrwxgx2g8v9sfnfiuq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nessa express√£o, temos </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertionIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - este √© o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a ser inserido e </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alteramos</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nosso modelo </font><b><font color="#0000FF"><font style="vertical-align: inherit;">imageGallery</font></font></b><font style="vertical-align: inherit;"> . √â tudo o que precisamos fazer e esse m√©todo substituir√° </font><b><font color="#0000FF"><font style="vertical-align: inherit;">automaticamente</font></font></b><font style="vertical-align: inherit;"> um espa√ßo reservado </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">por uma </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√©lula</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> chamando o m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cellForItemAt</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> normal </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Observe que </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertionIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pode ser muito diferente de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font> Porque<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como a amostragem de dados pode levar 10 segundos, √© claro, √© improv√°vel, mas pode levar 10 segundos. Durante esse per√≠odo, </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muita coisa pode acontecer </font><font style="vertical-align: inherit;">na cole√ß√£o </font><font style="vertical-align: inherit;">. Pode adicionar novas c√©lulas </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√©lulas</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tudo acontece r√°pido o suficiente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SEMPRE use </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertionIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e ONLY </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertionIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para atualizar seu modelo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como atualizamos nosso modelo? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inserir a</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> estrutura </font><b><font color="#0000FF"><font style="vertical-align: inherit;">imageModel </font></font></b></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na matriz imageGallery.images</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , composta pela propor√ß√£o da imagem </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aspectRatio</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e pelo URL da imagem </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageURL</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">provedor</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> correspondente nos retornou </font><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso atualiza nosso modelo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e o m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commitInsertion</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> faz o resto para n√≥s. Voc√™ n√£o precisa mais fazer nada extra, sem inser√ß√µes, sem exclus√µes, nada disso. E, √© claro, como estamos encerrando, precisamos nos adicionar </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></font></b>  . <br><br><img src="https://habrastorage.org/webt/rm/ff/nx/rmffnxnhy_1k1ukzub6ni468z6g.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se formos por algum motivo n√£o capaz de obter a rela√ß√£o de aspecto </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aspectRatio</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagem </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageURL</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do correspondente </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pelo fornecedor</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um erro pode ter sido recebido </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de erro</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em vez </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de provedor</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , temos que deix√°-los conhecer o contexto </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">placeholderContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , voc√™ precisa destruir este um espa√ßo reservado </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, porque somos todos iguais, n√£o podemos obtenha outros dados: </font></font><br><br><img src="https://habrastorage.org/webt/gw/tm/jj/gwtmjjywumpq4o7czavwnrcweay.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lembre-se de </font></font><code>URLs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que eles v√™m de lugares como este </font></font><code>Google</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; na realidade, precisam de pequenas transforma√ß√µes para ficarem "limpos"</font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para a imagem. Como esse problema √© resolvido pode ser visto neste aplicativo de demonstra√ß√£o em um arquivo </font></font><code>Utilities.swift</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, ao receber uma </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagem, usamos a propriedade </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageURL</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da classe </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URL</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/v5/cq/dc/v5cqdcxzqnwybov4eiklwlkt2o8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e √© tudo o que voc√™ precisa fazer para aceitar FORA DE ALGO dentro da cole√ß√£o </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos v√™-lo em a√ß√£o. Lan√ßamos simultaneamente, no modo multitarefa, nosso aplicativo de demonstra√ß√£o </font></font><code>ImageGallery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>Safari</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com um mecanismo de pesquisa </font></font><code>Google</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Como </font></font><code>Google</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">olhamos para as imagens sobre o tema da "Dawn¬ª (nascer do sol). Em </font></font><code>Safari</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">j√° constru√≠do</font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o mecanismo, para que possamos selecionar uma dessas imagens, mantenha-a por um longo tempo, mova-a um pouco e arraste-a para a nossa Galeria de imagens. </font></font><br><br><img src="https://habrastorage.org/webt/au/t9/wk/aut9wky03l29lkgj9g7l1ulifmc.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A presen√ßa de um sinal de adi√ß√£o verde "+" indica que nosso aplicativo est√° pronto para aceitar uma imagem de terceiros e copi√°-la para sua cole√ß√£o no local especificado pelo usu√°rio. Depois de o "redefinirmos", leva algum tempo para baixar a imagem e, neste momento, funciona </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br><br><img src="https://habrastorage.org/webt/ge/e-/n0/gee-n08qnm7zc5ofbgr3e4o8df8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depois que o download √© conclu√≠do, a imagem "redefinida" √© colocada no lugar certo e </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desaparece: </font></font><br><br><img src="https://habrastorage.org/webt/m8/rb/nq/m8rbnqvi2x0s3as4w_fzpjpltae.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">podemos continuar a "redefinir" as imagens e coloc√°-las em nosso cole√ß√µes de ainda mais imagens: </font></font><br><br><img src="https://habrastorage.org/webt/x8/np/bq/x8npbqpkm9af1_ybkxhw13kjhug.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ap√≥s o trabalho de "redefini√ß√£o" </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br><br><img src="https://habrastorage.org/webt/b2/lq/hb/b2lqhbg6smc2mvvvjp0copbvfmu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como resultado, nossa Galeria de imagens √© preenchida com novas imagens:</font></font><br><br><img src="https://habrastorage.org/webt/lf/jl/mq/lfjlmqca5iqv26l0woi-htqldcq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora que est√° claro que somos capazes de tirar fotos do lado de fora, n√≥s n√£o precisamos da imagem de teste, e vamos remover: </font></font><br><br><img src="https://habrastorage.org/webt/bv/0t/az/bv0tazx3cjushm1rkcfalu-m1au.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nossa </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">viewDidLoad</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> torna-se muito simples: √© que estamos a fazer o nosso </font></font><code>Controller</code> <code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">delegar e adicionar reconhecedor gesto </font></font><b><font color="#FF00FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pitada</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que regula o n√∫mero de imagens por linha: </font></font><br><br><img src="https://habrastorage.org/webt/ei/fo/1b/eifo1bz0szfk12tuqfseh5fser8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Claro , podemos adicionar um cache para imagens </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageCache</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/f4/oi/ql/f4oiql_gjnka7racbmkrts7mbja.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preencheremos </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageCache</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> quando "redefinir" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... </font></font><br><br><img src="https://habrastorage.org/webt/xy/hc/bt/xyhcbtodifjiqgd5norskny9cge.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e quando </font><b><font color="#0000FF"><font style="vertical-align: inherit;">buscarmos</font></font></b><font style="vertical-align: inherit;"> na "rede" na classe </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageCollectionViewCell</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> personalizada </font><font style="vertical-align: inherit;">: </font></font><br><br><img src="https://habrastorage.org/webt/nk/sl/2s/nksl2sw3dujz-_z7fmp55zixfzi.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usaremos o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cache </font><b><font color="#0000FF"><font style="vertical-align: inherit;">imageCache</font></font></b><font style="vertical-align: inherit;"> ao reproduzir uma c√©lula</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√©lula da</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nossa Galeria de imagens na classe personalizada</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ImageCollectionViewCell</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><img src="https://habrastorage.org/webt/-5/ar/zo/-5arzoeghtoj_ckv-ezxhpu403c.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora come√ßamos com uma cole√ß√£o vazia ...</font></font><br><br><img src="https://habrastorage.org/webt/rl/bq/vn/rlbqvnpsww27j5xbryp9vlgng1a.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... ent√£o "</font><b><font color="#0000FF"><font style="vertical-align: inherit;"> soltamos</font></font></b><font style="vertical-align: inherit;"> " uma nova imagem em nossa cole√ß√£o ...</font></font><br><br><img src="https://habrastorage.org/webt/9j/7o/es/9j7oesf_b-rk-dj-s9ysujlkte0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... a imagem √© carregada e</font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funciona ...</font></font><br><br><img src="https://habrastorage.org/webt/tg/s7/6t/tgs76tffgkarqkpzhamq97ebvio.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... e a imagem aparece no lugar certo:</font></font><br><br><img src="https://habrastorage.org/webt/ps/uy/z8/psuyz8apr4zpulpgpl5z-hsegfy.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">continuamos a preencher nossa cole√ß√£o FORA:</font></font><br><br><img src="https://habrastorage.org/webt/it/ve/_y/itve_yuqqnffh8zyzlpmj_vvske.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vem carregando imagens e</font></font><code>Placeholders</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funcionando ...</font></font><br><br><img src="https://habrastorage.org/webt/li/rx/wd/lirxwd74znfsvgrtjkpg3gfvl8u.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E as imagens aparecem no lugar certo:</font></font><br><br><img src="https://habrastorage.org/webt/uq/j0/as/uqj0asiyqcpqosl8x-3akydb3x0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assim, podemos fazer muito com a nossa Galeria de imagens: preench√™-la FORA, reorganizar itens DENTRO, compartilhar imagens com outras aplica√ß√µes niyami.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√≥s apenas precisamos ensin√°-la a se livrar de imagens desnecess√°rias ‚Äúredefinindo‚Äù elas</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na "lixeira" apresentada na barra de navega√ß√£o √† direita. </font><font style="vertical-align: inherit;">Conforme descrito na se√ß√£o "Recursos do aplicativo de demonstra√ß√£o da Galeria de imagens", a "lixeira" √© representada pela classe </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GabageView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que herda do </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIView,</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e devemos ensin√°-lo a aceitar imagens de nossa cole√ß√£o </font></font><code>ollection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redefina as </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagens da Galeria para a lixeira.</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imediatamente do local - para a pedreira. Vou acrescentar a </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GabageView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "intera√ß√£o" </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intera√ß√£o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e vai </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDropInteraction</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , desde que eu estou tentando "reset" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">algumas coisas. Tudo o que temos para garantir que </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDropInteraction</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , este delegado </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o delegado</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e eu estou indo para nomear a si mesmo, </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auto</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , este delegado </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o delegado</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/mm/tq/xn/mmtqxnmypbysaik9fjd3r2amrlg.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Claro, nossa classe </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GabageView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para confirmar que estamos implementando um protocolo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDropInteractionDelegate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/nv/xy/vw/nvxyvwya12ggtiznb1byxq5vorm.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tudo o que precisamos fazer para faz√™-lo funcionar </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, isso √© para implementar os m√©todos </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canHandle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> j√° conhecidos por n√≥s </font><font style="vertical-align: inherit;">,</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sessionDidUpdate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><img src="https://habrastorage.org/webt/jg/m9/ol/jgm9olzkrnv_fmu0mwesx91dvsq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, diferentemente dos m√©todos semelhantes para a coleta</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, n√£o temos informa√ß√µes adicionais na forma de um</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> caminho de √≠ndice do</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> local de dumping.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos implementar esses m√©todos.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dentro do m√©todo</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> canHandle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ser√£o processados apenas o "drag and drop"</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que representam a imagem</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de um UIImage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Portanto, retornarei</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> true</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> somente se</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> session.canLoadObjects (ofClass: UIImage.self)</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><img src="https://habrastorage.org/webt/if/z7/yo/ifz7yoibzsugla3mj7kat1cylt8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no m√©todo</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> canHandle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,</font><font style="vertical-align: inherit;">voc√™ basicamente diz apenas que, se o objeto "arrast√°vel" n√£o for uma imagem</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UIImage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, al√©m disso, n√£o faz sentido continuar a op√ß√£o "redefinir" Soltar e chamar os m√©todos subsequentes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o objeto "arrast√°vel" for uma imagem </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIImage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , executaremos o m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sessionDidUpdate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Tudo o que precisamos fazer neste m√©todo √© retornar nossa </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oferta de</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "redefini√ß√£o" do </font><b><font color="#0000FF"><font style="vertical-align: inherit;">UIDropProposal</font></font></b></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . E estou pronto para aceitar apenas o objeto LOCALLY "arrastado" do </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIImage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> TYPE da imagem </font><font style="vertical-align: inherit;">, que pode ser "descartado" em </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qualquer lugar dentro do meu </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GarbageView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Meu </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GarbageView</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o interage com imagens despejadas FORA. Ent√£o, eu estou analisando usando a vari√°vel </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">session.localDragSession</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se existe uma ‚Äúredefini√ß√£o‚Äù local </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e eu retorno a senten√ßa ‚Äúredefinir‚Äù na forma do construtor </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDropProposal</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com o argumento de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opera√ß√£o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> assumindo o valor </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.copy</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , porque SEMPRE LOCAL ‚Äúarrastar e soltar‚Äù </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no meu aplicativo vir√° da cole√ß√£o </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Se "arrastar </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font><font style="vertical-align: inherit;">soltar" </font><font style="vertical-align: inherit;">e "redefinir" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ocorrerem FORA, ent√£o retornarei a senten√ßa "redefinir" na forma do construtor </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDropProposal</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com o argumento de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opera√ß√£o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> assumindo o valor </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.fobbiden</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ou seja, "proibido" e obteremos um sinal de proibi√ß√£o de "redefini√ß√£o" em vez do sinal de mais verde . </font></font><br><br><img src="https://habrastorage.org/webt/ii/vd/wy/iivdwy9av6cxwzjkeay9kf87lby.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Copiando uma imagem de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIImage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, simularemos uma diminui√ß√£o em sua escala para quase 0 e, quando ocorrer a "redefini√ß√£o", removeremos esta imagem da cole√ß√£o </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para criar o usu√°rio a ilus√£o de "reset, eo desaparecimento de" imagem na "lata de lixo", usamos um novo m√©todo para n√≥s </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">previewForDropping</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que lhe permite redirecionar o "reset" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em outro lugar e ao mesmo tempo transformar o objeto "descart√°vel" durante a anima√ß√£o: </font></font><br><br><img src="https://habrastorage.org/webt/e7/ej/zb/e7ejzbhlfzjxrkxsjupt9hiewz4.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em Nesse m√©todo, usando o inicializador </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDragPreviewTarget,</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> obtemos um novo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√©View</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para o objeto de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destino</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a ser descartado </font><font style="vertical-align: inherit;">e o redirecionamos usando o m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retargetedPreview</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para um novo local, para a ‚Äúlata de lixo‚Äù, com sua escala quase zero: </font></font><br><br><img src="https://habrastorage.org/webt/bu/zp/av/buzpavo-rn6n2eoeztccvman6r0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se o usu√°rio levantar um dedo, uma ‚Äúredefini√ß√£o‚Äù ocorrer√° </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e eu (como o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GarbageView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) recebo uma mensagem </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Na mensagem </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop,</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> realizamos o "reset" real </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Honestamente, a </font><font style="vertical-align: inherit;">imagem que foi </font><font style="vertical-align: inherit;">despejada no </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GarbageView em</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si </font><font style="vertical-align: inherit;">n√£o nos interessa mais, j√° que a tornamos praticamente invis√≠vel, provavelmente o pr√≥prio fato da conclus√£o da ‚Äúredefini√ß√£o‚Äù </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sinalizar√° que removemos essa imagem da cole√ß√£o </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Para fazer isso, precisamos conhecer a pr√≥pria </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cole√ß√£o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e o </font><b><font color="#0000FF"><font style="vertical-align: inherit;">indexPath da </font></font></b><b><font color="#0000FF"><font style="vertical-align: inherit;">cole√ß√£o</font></font></b></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagem descartada nele. De onde podemos obt√™-los? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como o processo </font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ocorre em uma √∫nica aplica√ß√£o, ele est√° dispon√≠vel para todos n√≥s o local: local de </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sess√£o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localDragSession</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nossa </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sess√£o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a sess√£o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o contexto local </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que √© a nossa colec√ß√£o de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sollectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e objeto local </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imagem de reset, o que podemos fazer por si s√≥ √© </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de "Galeria" ou </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Devido a isso, podemos obter no m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> classe </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GarbageView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cole√ß√£o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cole√ß√£o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e us√°-lo</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dataSource</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ImageGalleryCollectionViewController</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e Modelo</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ImageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nossa</font></font><code>Controller</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, podemos obter uma s√©rie de imagens de</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imagens</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> TYPE [ImageModel]:</font></font><br><br><img src="https://habrastorage.org/webt/3t/tj/kr/3ttjkr1cuyqxh4v3islcmsofjhy.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Com a ajuda do local de</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sess√£o</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> localDragSession</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nossa</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sess√£o</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sess√£o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fomos capazes de obter todo o "arrastar" na</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GarbageView</font></font></font></b> <code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> elementos de</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> itens</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e pode haver um monte, como sabemos, e todos eles s√£o imagens da nossa</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cole√ß√£o collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Criando</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elementos</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dragItems</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nossa cole√ß√£o</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, n√≥s fornecemos para cada "arrastar"</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elemento</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> objeto local</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que √© a imagem de</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imagem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas √© que n√£o v√™m a calhar durante a coleta de reorganiza√ß√£o interna</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CollectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas o "reset" Galerias de Imagem "lata de lixo" que precisam desesperadamente nas instala√ß√µes locais</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> objeto "arrastar"</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ap√≥s todo esse tempo n√£o temos um</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> coordenador</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que compartilhe t√£o generosamente informa√ß√µes sobre o que est√° acontecendo na cole√ß√£o</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Portanto, queremos que o objeto local</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √≠ndice foi</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na matriz imagem</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imagens</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dos nossos modelos</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Fa√ßa as altera√ß√µes necess√°rias no m√©todo</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dragItems (a indexPath: IndexPath)</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> classe</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ImageGalleryCollectionViewController</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><img src="https://habrastorage.org/webt/le/iy/hz/leiyhzxv04brlhk6nlhpakw4bek.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora que podemos tomar todas as "pretaskivaemogo" elemento</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> artigo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que √© o √≠ndice</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na matriz imagem</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imagens</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dos nossos modelos</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imagegallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e envi√°-lo para os √≠ndices de matriz</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √≠ndices</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e matriz de</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indexPahes de</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imagens exclu√≠das:</font></font><br><br><img src="https://habrastorage.org/webt/ci/cf/uo/cicfuo7gxvbmh7ddvjj2maorfog.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conhecendo a matriz de √≠ndices de</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √≠ndices</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e a matriz de</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indexPahes de</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imagens exclu√≠das, no m√©todo</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> performBatchUpdates</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cole√ß√£o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cole√ß√£o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que remover todas as imagens apagadas a partir de modelos </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagens</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e da cole√ß√£o da </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cole√ß√£o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/2t/49/i4/2t49i4wwgqlz-vqqpalim8m4h4u.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Execute o aplicativo, preencher a galeria com novas imagens: </font></font><br><br><img src="https://habrastorage.org/webt/vj/kb/v5/vjkbv5nwenjhacglkmksbto5jh0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selecione um par de imagens que deseja remover de nossa galeria ... </font></font><br><br><img src="https://habrastorage.org/webt/cm/-e/t1/cm-et1fd2cp7pext2src2vddkmm.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... "jogar"-los no √≠cone com a "lata de lixo" ... </font></font><br><br><img src="https://habrastorage.org/webt/yw/l3/ue/ywl3ue6tusekuyqvpjv3n4pn1xy.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eles reduziram quase para 0 ... </font></font><br><br><img src="https://habrastorage.org/webt/14/6r/nd/146rndccir7ou4z5zitpj9gv4ek.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... e desaparece da cole√ß√£o </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ocultando-se na "lixeira":</font></font><br><br><img src="https://habrastorage.org/webt/1x/b_/zw/1xb_zw27xn-2yp7lb7tvlpgm_fc.png"><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Salvando imagens entre as partidas. </font></font></h1><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para salvar a Galeria de Imagens entre as execu√ß√µes, usaremos </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UserDefaults</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , depois de converter nosso Modelo em um </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">formato. Para fazer isso, vamos adicionar √† nossa </font></font><code>Controller</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vari√°vel </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">defailts var</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... </font></font><br><br><img src="https://habrastorage.org/webt/wy/cg/vy/wycgvy5krdrmfiugzp9dgykaphe.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... e no modelo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageModel</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> protocolo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">codific√°vel</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/j2/vv/w6/j2vvw62tiuud6eidtx1n9ipeq0w.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cordas </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cordas</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , matrizes de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Array</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o URL</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">duas vezes</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> j√° est√£o implementando o protocolo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">codific√°vel</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ent√£o n√£o temos mais nada a fazer para chegar a codifica√ß√£o de trabalho e decodifica√ß√£o para </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modelos</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ImageGallery </font><font style="vertical-align: inherit;">em </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">formato.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como obtemos a </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vers√£o do </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para criar esta vari√°vel expandida </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var json</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que retorna o resultado de tentativas de converter-se, </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auto</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , via </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSONEncoder.encode ()</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">formato: </font></font><br><br><img src="https://habrastorage.org/webt/f6/o3/hz/f6o3hzee-7hryaxadmzf--0jeym.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E isso √© tudo. Os </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dados</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ser√£o retornados </font><font style="vertical-align: inherit;">como resultado da convers√£o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">autom√°tica</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para o formato </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ou </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se essa convers√£o falhar, embora a √∫ltima nunca ocorra, porque esse TIPO √© 100% </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">codific√°vel</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . A </font><font style="vertical-align: inherit;">vari√°vel </font><b><font color="#0000FF"><font style="vertical-align: inherit;">json </font></font></b></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opcional</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© usada </font><font style="vertical-align: inherit;">apenas por raz√µes de simetria.</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora temos uma maneira de converter os modelos </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para o </font><font style="vertical-align: inherit;">formato de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dados</font></font></font></b><font style="vertical-align: inherit;"></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vari√°vel </font><b><font color="#0000FF"><font style="vertical-align: inherit;">json</font></font></b><font style="vertical-align: inherit;"> possui um TYPE </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data?</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que pode ser lembrado em </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UserDefaults</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora imagine que, de alguma forma, conseguimos obter os </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dados </font><font style="vertical-align: inherit;">do </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">json</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e eu gostaria de recriar a partir deles o nosso Model, uma inst√¢ncia da estrutura </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Para fazer isso, √© muito f√°cil escrever um INITIALIZER para </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cujo argumento de entrada √© </font><b><font color="#0000FF"><font style="vertical-align: inherit;">json</font></font></b></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> data </font><font style="vertical-align: inherit;">. Este inicializador ser√° um inicializador "em queda" (</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><code>failable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) Se ele falhar ao inicializar, ele trava e retorna </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/g7/0n/l4/g70nl4mxpadtrajaq7y-ec4f6bw.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acabei de obter o valor </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">newValue</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usando o decodificador </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSONDecoder</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tentando decodificar os dados </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">json</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que s√£o passados ‚Äã‚Äãao meu inicializador e atribu√≠-lo a </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si pr√≥prio</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se eu consegui fazer isso, recebo uma nova inst√¢ncia do </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas se minha tentativa falhar, retornarei </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pois minha inicializa√ß√£o "falhou". </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Devo dizer que aqui temos muito mais motivos para ‚Äúfalhar‚Äù ( </font></font><code>fail</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), porque √© bem poss√≠vel que os </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dados </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">json</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode estar estragado ou vazio, tudo isso pode levar √† "queda" ( </font></font><code>fail</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) do inicializador. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora podemos implementar a leitura </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de dados e modelo de recupera√ß√£o </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagegallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o m√©todo </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">viewWillAppear</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nosso </font></font><code>Controller</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... </font></font><br><br><img src="https://habrastorage.org/webt/gw/n2/u-/gwn2u-zkggggk2vuwfi-czhycdq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... bem como uma entrada no observador </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">didSet {}</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> propriedades </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagegallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/-g/bc/yz/-gbcyzh4t5innabrtcbxdmdh3wq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos executar o aplicativo e encher a nossa galeria de imagens: </font></font><br><br><img src="https://habrastorage.org/webt/le/t5/wr/let5wryw9nwf-ahnij7f_wltztc.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se fechar o aplicativo e abri-lo novamente, podemos ver nossa galeria anterior Imagens salvas nos </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">padr√µes</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do </font><b><font color="#0000FF"><font style="vertical-align: inherit;">usu√°rio</font></font></b><font style="vertical-align: inherit;"> .</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Conclus√£o </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este artigo demonstra como √© f√°cil integrar a tecnologia </font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a um </font></font><code>iOS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplicativo </font><font style="vertical-align: inherit;">usando o exemplo de um aplicativo de demonstra√ß√£o muito simples ‚ÄúGaleria de Imagens‚Äù </font><font style="vertical-align: inherit;">. Isso tornou poss√≠vel editar completamente a Galeria de Imagens, ‚Äúlan√ßando‚Äù novas imagens de outros aplicativos para l√°, movendo as existentes e excluindo as desnecess√°rias. E tamb√©m para distribuir imagens acumuladas na Galeria para outros aplicativos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obviamente, gostar√≠amos de criar muitas dessas cole√ß√µes tem√°ticas e pitorescas de imagens e salv√°-las diretamente no iPad ou no iCloud Drive. Isso pode ser feito se cada Galeria for interpretada como um </font><b><font color="#0000FF"><font style="vertical-align: inherit;">UIDocument</font></font></b><font style="vertical-align: inherit;"> permanentemente armazenado</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Essa interpreta√ß√£o nos permitir√° subir para o pr√≥ximo n√≠vel de abstra√ß√£o e criar um aplicativo que funcione com documentos. </font><font style="vertical-align: inherit;">Nesse aplicativo, seus documentos ser√£o mostrados pelo componente </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DocumentBrowserViewController</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , muito semelhante ao aplicativo </font></font><code>Files</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Isso permitir√° que voc√™ crie </font><font style="vertical-align: inherit;">imagens </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDocument</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do tipo ‚ÄúGaleria de imagens‚Äù no seu </font></font><code>iPad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e em </font></font><code>iCloud Drive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, assim como selecione o documento desejado para visualiza√ß√£o e edi√ß√£o. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas este √© o assunto do pr√≥ximo artigo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS O c√≥digo do aplicativo de demonstra√ß√£o antes da implementa√ß√£o do mecanismo </font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e depois est√° no </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt425817/">https://habr.com/ru/post/pt425817/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt425807/index.html">Complexidade de sistemas e m√©todos de "luta" com ele</a></li>
<li><a href="../pt425809/index.html">Aprendendo linguagens de programa√ß√£o no processo: desenvolvedor de software sobre projetos complexos</a></li>
<li><a href="../pt425811/index.html">Outro problema de exibi√ß√£o no MacBook Pro</a></li>
<li><a href="../pt425813/index.html">CICD: implanta√ß√£o cont√≠nua em sistemas de cluster distribu√≠dos sem tempo de inatividade</a></li>
<li><a href="../pt425815/index.html">Quem n√£o precisa de SEO, como escolher um otimizador e testar seu trabalho</a></li>
<li><a href="../pt425819/index.html">GitLab 11.3 lan√ßado com reposit√≥rio Maven e ambientes seguros</a></li>
<li><a href="../pt425821/index.html">Como se tornar um desenvolvedor do React em 2018</a></li>
<li><a href="../pt425823/index.html">Estat√≠sticas de IPO 2018: US $ 45 bilh√µes levantados, o Dropbox levantou menos dinheiro do que empresas farmac√™uticas e vendedores de im√≥veis</a></li>
<li><a href="../pt425827/index.html">Li√ß√£o do Google+: os projetos precisam garantir que os limites entre os interesses dos usu√°rios na vida real sejam respeitados on-line</a></li>
<li><a href="../pt425829/index.html">Como lutamos com Roskomnadzor e o que aconteceu</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>