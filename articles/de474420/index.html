<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¥üèΩ ‚ñ´Ô∏è ‚õΩÔ∏è Thermostatbildung: wie es passiert ist üï¶ üï∏Ô∏è üñêüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nach mehreren Jahren fruchtbarer Arbeit wurde beschlossen, unser erstes Produkt zur Klimatisierung in einem Smart Home der √ñffentlichkeit vor Gericht ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Thermostatbildung: wie es passiert ist</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474420/"><img src="https://habrastorage.org/webt/hq/ic/rj/hqicrj2h1bv5ytdxhdsxlst1uv0.png"><br><br>  Nach mehreren Jahren fruchtbarer Arbeit wurde beschlossen, unser erstes Produkt zur Klimatisierung in einem Smart Home der √ñffentlichkeit vor Gericht zu bringen - einen Smart Thermostat zur Steuerung eines warmen Bodens. <br><a name="habracut"></a><br><h3>  Was ist das f√ºr ein Ger√§t? </h3><br>  Dies ist ein intelligenter Thermostat f√ºr jede elektrische Fu√übodenheizung bis zu 3 kW.  Es wird √ºber die Anwendung, die Webseite, HTTP und MQTT gesteuert, sodass es problemlos in alle Smart-Home-Systeme integriert werden kann.  F√ºr die beliebtesten werden wir Plugins entwickeln. <br><br>  Sie k√∂nnen nicht nur eine elektrische Fu√übodenheizung steuern, sondern auch einen W√§rmekopf an einem wassergeheizten Boden, einem Heizkessel oder einer elektrischen Sauna.  Mit nrf kann der Thermostat auch mit verschiedenen Sensoren kommunizieren.  Nahezu alle klimarelevanten Sensoren befinden sich derzeit in der Entwicklung.  Da das Ger√§t auf ESP basiert, haben wir entschieden, dass es unangemessen ist, Anpassungsoptionen von Benutzern auszuw√§hlen.  Daher werden wir daf√ºr sorgen, dass der Benutzer das Ger√§t in den Entwicklermodus versetzen und eine andere Firmware installieren kann, beispielsweise mit Unterst√ºtzung f√ºr HomeKit oder Projekte von Drittanbietern. <br><br>  * Nach der Installation der Firmware eines Drittanbieters mit Unterst√ºtzung f√ºr HomeKit oder andere beliebte Projekte ist die R√ºckkehr zum Original √ºber OTA (Over-the-Air) nicht m√∂glich. <br><cut></cut><br><h3>  Die Schwierigkeiten, denen wir begegnet sind </h3><br>  Zu sagen, dass sie nicht da waren, w√§re dumm.  Ich werde versuchen, die schwierigsten aufgetretenen Probleme zu beschreiben und wie wir sie gel√∂st haben. <br><br>  Das Geh√§use f√ºr das Ger√§t war eine Herausforderung.  Und die Kosten f√ºr Ressourcen und die Kosten f√ºr Zeit (entwickelt ungef√§hr ein Jahr). <br><br>  Es gab viele Optionen auf dem Markt.  Am beliebtesten ist der 3D-Druck.  Lassen Sie uns sch√§tzen: <br>  Klassischer 3D-Druck.  Qualit√§t ist schlecht, Produktionsgeschwindigkeit auch.  Wir haben 3D-Druck f√ºr Prototypen verwendet, aber er war nicht f√ºr die Produktion geeignet. <br><br>  Photopolymer 3D-Drucker.  Hier ist die Qualit√§t um ein Vielfaches besser, aber der Preiseffekt kommt ins Spiel.  Die Prototypen, die auf einem √§hnlichen Drucker gedruckt wurden, hatten eine Gr√∂√üe von etwa 4000 Rubel, und dies ist ein Teil des Zweik√∂rpers.  Sie k√∂nnen Ihren Drucker kaufen, was den Preis senkt, aber der Preis ist immer noch Platz und die Geschwindigkeit ist unbefriedigend. <br><br>  Silikonguss.  Wir hielten dies f√ºr die beste Option.  Die Qualit√§t war auf dem Niveau, der Preis ist hoch, aber nicht kritisch.  Bereits die erste Charge wurde in 20 F√§llen f√ºr Feldversuche bestellt. <br><br>  Aber alles hat den Fall ge√§ndert.  Eines Abends habe ich versehentlich in einem internen Chat f√ºr Entwickler ver√∂ffentlicht, dass bei den F√§llen ein Pfosten der Preis hoch ist.  Und am n√§chsten Tag schrieb ein Kollege in einer pers√∂nlichen Nachricht, dass der Freund seines Freundes TPA (Thermoplast-Maschine) hat.  Und in der ersten Phase k√∂nnen Sie eine Form f√ºr ihn machen.  Diese Nachricht hat alles ver√§ndert! <br><br>  Ich hatte bereits √ºber die Verwendung von TPA nachgedacht, wurde aber nicht einmal von der Notwendigkeit aufgehalten, eine Charge von mindestens 5000 St√ºck zu bestellen (obwohl Sie, wenn Sie es versuchen k√∂nnen, bei den Chinesen weniger finden k√∂nnen).  Ich wurde durch den Preis einer Form gestoppt.  √úber 5000 Dollar.  Ich war nicht bereit, diesen Betrag sofort bereitzustellen.  Die Menge f√ºr die Form durch unseren frisch gepr√§gten Kollegen war nicht kosmisch, sie variierte zwischen 2000 und 2500 Dollar.  Au√üerdem hat er uns besucht und wir haben uns darauf geeinigt, dass die Zahlung in Raten erfolgt.  Damit war das Problem mit den F√§llen gel√∂st. <br><br>  Die zweite und ebenso wichtige Schwierigkeit, auf die wir gesto√üen sind, ist Eisen. <br><br>  Z√§hlen Sie nicht die Anzahl der Revisionen von Eisen.  Nach vorsichtigen Sch√§tzungen ist die vorgestellte Option die siebte, ohne die Zwischenoptionen.  Darin haben wir versucht, alle im Testprozess festgestellten M√§ngel zu beheben. <br><br>  Vorhin dachte ich, dass kein Hardware-Watchdog erforderlich ist.  Ohne sie wird das Ger√§t nicht mehr in Serie gehen: Aufgrund der Launenhaftigkeit der von uns gew√§hlten Plattform. <br>  Ein weiterer analoger Eingang zum ESP.  Fr√ºher dachte ich, dass jeder ESP-Pin universell ist.  ESP hat jedoch nur einen analogen Pin.  Erfahren Sie, dass dies in der Praxis passiert ist, was zur √Ñnderung und Neuordnung von Leiterplatten gef√ºhrt hat. <br><br>  <i>Die erste Version von Leiterplatten</i> <br><br><img src="https://habrastorage.org/webt/t-/hf/9n/t-hf9nry-pzvsm4shzy4fyta_kc.jpeg"><br><br><img src="https://habrastorage.org/webt/ok/d8/w7/okd8w7vazoijv851jztumvoj0w8.png"><br><br>  <i>Die zweite Version von Leiterplatten</i> <br><br><img src="https://habrastorage.org/webt/yf/c5/9c/yfc59crkqt9oclmawidome-mwm8.jpeg"><br><br><img src="https://habrastorage.org/webt/1o/wl/j0/1owlj0hbceqg4dbxcqsq94g43su.png"><br><br>  <i>Die vorletzte Version von Leiterplatten, bei der ich dringend Probleme mit dem analogen Pin l√∂sen musste</i> <br><br><img src="https://habrastorage.org/webt/hs/ka/q5/hskaq5caccyx6b9ws6fo8lwysh0.jpeg"><br><br><img src="https://habrastorage.org/webt/px/ek/hp/pxekhp2fjamqqcd3nk3oajbjc-8.jpeg"><br><br>  Was die Software betrifft, gab es auch eine Reihe von Fallstricken. <br><br>  Zum Beispiel periodisches Roll-off von ESP.  Trotz der Tatsache, dass Ping dazu geht, wird die Seite nicht ge√∂ffnet.  Es gibt nur eine L√∂sung: Schreiben Sie die Bibliothek neu.  Vielleicht gibt es noch andere, aber wir alle haben versucht, kein Ergebnis zu erzielen. <br><br>  Das zweite wichtige Problem ist seltsamerweise die Anzahl der Anfragen an ESP beim √ñffnen einer Seite.  Mit GET oder Ajax wurden wir mit der Tatsache konfrontiert, dass die Anzahl der Anfragen unangemessen gro√ü wurde.  Aus diesem Grund verhielt sich das ESP unvorhersehbar. Es konnte die Anforderung nur einige Sekunden lang neu starten oder verarbeiten.  Die L√∂sung bestand darin, auf Web-Sockets umzusteigen.  Danach hat sich die Anzahl der Anfragen erheblich verringert. <br><br>  Das dritte Problem ist die Weboberfl√§che.  Weitere Informationen √ºber ihn finden Sie in einem separaten Artikel, der sp√§ter ver√∂ffentlicht wird. <br><br>  Im Moment m√∂chte ich nur sagen, dass die derzeit beste Option die Verwendung von VUE.JS ist. <br><br>  Dieses Framework ist das am besten geeignete von allen, die wir getestet haben. <br><br>  Schnittstellenoptionen k√∂nnen unter den folgenden Links eingesehen werden. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">adaptive.lytko.com</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">mobile.lytko.com</a> <br><br><h3>  Thermostatbildung </h3><br>  Nachdem wir alle Schwierigkeiten √ºberwunden hatten, kamen wir zu folgendem Ergebnis: <br><br><img src="https://habrastorage.org/webt/1r/q5/ai/1rq5aidxmw2b4zsct8rl9y8lhim.png"><br><br><img src="https://habrastorage.org/webt/fj/t8/zd/fjt8zdyi7j829j1yr8w3hps1sna.png"><br><br>  <b>Bau</b> <br><br>  Der Thermostat besteht aus drei Platinen (Modulen): <br><br><ol><li>  Manager; </li><li>  Verwaltet </li><li>  Anzeigetafel </li></ol><br>  <b>Die Steuerkarte</b> ist die Karte, auf der sich ESP12, Hardware Watchdog und nRF24 befinden, um mit zuk√ºnftigen Sensoren zu arbeiten.  Beim Start unterst√ºtzt das Ger√§t den digitalen Sensor DS18B20.  Wir haben jedoch die M√∂glichkeit bereitgestellt, analoge Sensoren von Drittherstellern anzuschlie√üen.  In einem der zuk√ºnftigen Ger√§te-Software-Updates werden wir die M√∂glichkeit hinzuf√ºgen, Sensoren zu verwenden, die mit Thermostaten von Drittanbietern geliefert werden. <br><br><img src="https://habrastorage.org/webt/nr/gf/vm/nrgfvmey1i1qjmiz5zuqbywn4i8.jpeg"><br><br>  <b>Verwaltet</b> - Stromversorgungs- und Lastmanagementkarte.  Sie platzierten ein 750-mA-Netzteil, Anschl√ºsse zum Anschlie√üen von Temperatursensoren und 16-A-Relais zur Steuerung der Last. <br><br><img src="https://habrastorage.org/webt/s4/ka/o-/s4kao-dmzluqeabuwu1g35kggsg.jpeg"><br><br>  <b>Display</b> - In der Entwicklungsphase haben wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">das</a> 2,4-Zoll- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Display von Nextion</a> ausgew√§hlt. <br><br>  √úber ihn k√∂nnen Sie leicht Informationen im Internet finden.  Ich werde selbst hinzuf√ºgen, dass es f√ºr fast alle praktisch ist, au√üer f√ºr den Preis.  Ein 2,4-Zoll-Display kostet rund 1.200 Rubel, was den Endpreis nicht optimal beeinflusst. <br><br>  Daher wurde beschlossen, ein Analogon zu unseren Bed√ºrfnissen zu erstellen, jedoch zu einem niedrigeren Preis.  Es stimmt, es muss auf klassische Weise programmiert werden und nicht aus der Nextion Editor-Umgebung.  Es ist schwieriger, aber wir sind bereit daf√ºr. <br><br>  Ein Analogon ist eine 2,4-Zoll-Matrix mit einem Touchscreen und einer Karte mit STM32 an Bord, um diese zu steuern und die Belastung des ESP12 zu verringern.  Alle Steuerelemente √§hneln denen von Nextion by UART sowie 32 MB Speicher und eine vollst√§ndige Flash-Karte zum Aufzeichnen von Protokollen. <br><br>  Der modulare Aufbau erleichtert das Wechseln eines der Module und der Ausgang ist ein v√∂llig anderes Ger√§t. <br><br>  Zum Beispiel gibt es bereits Optionen f√ºr "Board 2" in mehreren Versionen: <br><br><ul><li>  <b>Option 1</b> - f√ºr Fu√übodenheizung.  Stromversorgung von 220V.  Das Relais steuert jede Last nach sich selbst. </li><li>  <b>Option 2</b> - f√ºr Fu√übodenheizung oder Batterieventil.  Stromversorgung √ºber 24V AC.  24V Ventilsteuerung. </li><li>  <b>Option 3</b> - mit 220 V betrieben.  Steuerung einer separaten Leitung, z. B. eines Heizkessels oder einer elektrischen Sauna. </li></ul><br><h3>  Nachwort </h3><br>  Ich bin kein professioneller Entwickler.  Ich habe es geschafft, Menschen mit einem Ziel zu vereinen.  Zum gr√∂√üten Teil arbeitet jeder f√ºr die Idee;  um etwas wirklich Wertvolles zu machen;  Was wird f√ºr den Endbenutzer n√ºtzlich sein. <br><br>  Ich bin sicher, dass jemand das Design des Geh√§uses nicht m√∂gen wird;  jemand - das Aussehen der Seite.  Das ist dein Recht!  Aber wir sind den ganzen Weg selbst gegangen, durch st√§ndige Kritik an dem, was wir tun, und vor allem - warum.  Wenn es keine der oben genannten Fragen gibt, werden wir uns gerne in den Kommentaren unterhalten. <br><br>  <b>Konstruktive Kritik ist gut und wir sind daf√ºr dankbar.</b> <br><br>  Die Geschichte der Idee <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> .  F√ºr Interessierte: <br><br><ol><li>  Bei allen Fragen: Gruppe im Telegramm <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">LytkoG</a> </li><li>  Folgen Sie den Nachrichten: Telegram <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Lytko News</a> Nachrichtensender </li></ol><br>  Und ja, wir wissen genau, was wir tun. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de474420/">https://habr.com/ru/post/de474420/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de474404/index.html">Analyse der gel√∂sten Probleme aus der Programmiermeisterschaft von Yandex (Frontend-Entwicklung) 2019</a></li>
<li><a href="../de474406/index.html">BlueKeeps erster Auftritt in freier Wildbahn wurde aufgezeichnet</a></li>
<li><a href="../de474408/index.html">Revolution oder Evolution des Seitenobjektmodells?</a></li>
<li><a href="../de474414/index.html">Wir schreiben unseren eigenen Voxelmotor</a></li>
<li><a href="../de474418/index.html">DEFCON-Konferenz 27. Profitieren Sie von Hacker-Produkten f√ºr macOS. Teil 1</a></li>
<li><a href="../de474422/index.html">Spannende Open Source-Plattformen f√ºr die Entwicklung mobiler Anwendungen</a></li>
<li><a href="../de474424/index.html">Blended Training - was ist das und wie funktioniert es?</a></li>
<li><a href="../de474426/index.html">Die Zeichentrickserie "Mathematical Circle"</a></li>
<li><a href="../de474430/index.html">DevOpsDays Moskau - eine Konferenz, die die Community f√ºr die Community veranstaltet</a></li>
<li><a href="../de474434/index.html">Eigener Telegramm-Bot zur Verfolgung der Verf√ºgbarkeit seiner Server in Python und Docker</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>