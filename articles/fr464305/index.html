<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìü üëèüèª üõ¥ Petit, oui. D√©ballage du p√©tard microvirtuel üö¥üèΩ ‚ôíÔ∏è üïµüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Enregistrez les microvirtuels de p√©tard. Nous utilisons deux m√©thodes populaires pour isoler les charges de travail multi-utilisateurs: les machines v...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Petit, oui. D√©ballage du p√©tard microvirtuel</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/464305/">  Enregistrez les microvirtuels de p√©tard.  Nous utilisons deux m√©thodes populaires pour isoler les charges de travail multi-utilisateurs: les machines virtuelles et les conteneurs.  Nous comprenons le meilleur des deux approches, simplifions autant que possible, testons sur une charge r√©elle √©lev√©e.  En cons√©quence, nous obtenons une isolation imp√©n√©trable des ordinateurs virtuels qui peuvent √™tre lanc√©s en centaines de millisecondes.  Cette solution fonctionne sous le capot d'AWS Lambda et Fargate, ex√©cutant des millions de fonctions sans serveur et de conteneurs dans le cloud chaque seconde.  Il s'appelle Firecracker. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rm/ps/oo/rmpsoo1w1jptnyp2qwsaestydsq.png" width="400"></div><br><br>  Cet outil de microvirtualisation est disponible dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">OpenSource</a> .  Si vos t√¢ches n√©cessitent une isolation multi-locataire (enfin, par exemple, vous d√©cidez de cr√©er votre propre cloud), Firecracker est ce dont vous avez besoin. <br><br>  <strong>Vasily Pantyukhin</strong> , architecte d'Amazon Web Services, parle de l'architecture Firecracker, de la fa√ßon dont elle est utilis√©e par AWS Lambda, la compare avec des solutions alternatives et donne des exemples d'int√©gration. <br><br>  <em>Avis de non-responsabilit√©: tout ce qui suit est l'opinion personnelle de Vasily et cela peut ne pas co√Øncider avec la position d'Amazon Web Services.</em> <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/cfsICOzt6Do" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2>  Caract√©ristiques naturelles des nuages ‚Äã‚Äãpublics </h2><br><blockquote>  L'une des propri√©t√©s fondamentales des clouds publics est la multi-location. </blockquote><br>  Quelqu'un traduit ce terme par "multi-tenancy" ou "multi-user environment".  Mais de mon point de vue, cela ne refl√®te pas l'essence.  La multi-location signifie que diff√©rents utilisateurs et leurs charges vivent sur la m√™me infrastructure physique, la partagent entre eux, mais ne se connaissent pas.  √Ä partir des charges de travail multi-utilisateurs, la multi-location diff√®re en principe par des exigences plus strictes pour l'isolement des ressources et l'acc√®s √† celles-ci. <br><br><blockquote>  La surcharge est une autre propri√©t√© inh√©rente aux clouds publics. </blockquote><br>  Croyez-moi, dans le cas d'AWS, c'est une √©norme charge!  La capture d'√©cran est un exemple de donn√©es r√©elles.  Je ne dirai pas pendant combien de temps et dans quelle r√©gion ces millions de "perroquets" ont √©t√© mesur√©s, mais ce n'est pas une sorte d'urgence, mais le mode de fonctionnement habituel pour nous. <br><br><img src="https://habrastorage.org/webt/up/dt/qs/updtqsp7dmtqk1czi5f2zuscbkq.png"><br><br>  Il s'av√®re une certaine contradiction.  D'une part, nous devons garder les utilisateurs aussi isol√©s que possible.  D'autre part, nous devons garantir un niveau tr√®s √©lev√© de productivit√© et d'utilisation des ressources.  L'am√©lioration de l'un conduit souvent aux limites de l'autre.  Comment trouver un compromis, et encore mieux, pour obtenir le maximum sur tous les fronts? <br><br><h2>  Machines virtuelles ou conteneurs? </h2><br>  Il existe deux approches de base qui pourraient potentiellement aider.  Ce sont des machines virtuelles et des conteneurs.  Chacun a ses avantages et ses inconv√©nients. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dj/hl/ba/djhlbailazcjnfxycokcrv38a64.png" width="400"></div><br><br>  Le principal inconv√©nient des machines virtuelles est qu'elles prennent <strong>beaucoup de temps √† charger</strong> .  Il faut g√©n√©ralement des dizaines de secondes, voire des minutes, pour d√©marrer la machine.  Mais les virtualoks ont une vertu: ils <strong>isolent les</strong> charges de <strong>b√©ton les</strong> uns des autres.  Et des deux points de vue: <br><br><ul><li>  <strong>s√©curit√©</strong> lorsqu'une machine virtuelle n'est pas en mesure d'acc√©der aux donn√©es d'une autre machine; </li><li>  <strong>ressources</strong> , lorsque j'ai command√© 8 Go de m√©moire, j'esp√®re que cette RAM sera la mienne et personne ne pourra r√©clamer la ressource pour laquelle j'ai pay√©. </li></ul><br>  Le contraire est le cas des conteneurs: ils sont l√©gers et se <strong>chargent</strong> donc <strong>tr√®s rapidement.</strong>  Ils peuvent √™tre facilement mis √† l'√©chelle horizontalement.  Mais il y a une fonctionnalit√© avec laquelle nous, en tant que fournisseur de cloud public, ne pouvons pas vivre.  Ils utilisent un <strong>noyau partag√© - le noyau du syst√®me d'exploitation est partag√© entre tous les conteneurs</strong> . <br><br><img src="https://habrastorage.org/webt/pa/pz/hm/papzhmvppqzce7pxbezk8bp9owg.png"><br><br>  Peut-on dire que les conteneurs ne sont pas s√ªrs?  Non, m√™me s'il existe de graves vuln√©rabilit√©s. <br><br><blockquote>  Je pense qu'aujourd'hui un conteneur correctement ¬´soud√©¬ª offre un niveau de s√©curit√© suffisant. </blockquote><br>  Le probl√®me est diff√©rent - un noyau partag√© ne garantit pas fondamentalement qu'√† l'avenir, des vuln√©rabilit√©s n'apparaissent pas qui rompent l'isolement des locataires.  Le cloud public ne peut pas se le permettre, m√™me en th√©orie. <br><br>  Il y a encore une autre contradiction et une solution doit √™tre recherch√©e.  Le moyen le plus simple est de tirer le meilleur parti de maman - une machine virtuelle et de papa - d'un conteneur, de traverser et d'obtenir quelque chose de <strong>convergent</strong> .  En fait, nous l'avons fait.  Il s'est av√©r√© que Firecracker. <br><br>  Firecracker est d√©j√† en production.  Dans la m√™me charge √©lev√©e de services critiques, par exemple, AWS Lambda (fonctions sans serveur) et AWS Fargate (conteneurs sans serveur). <br><br><h3>  Probl√®mes de l'ancien AWS Lambda </h3><br>  AWS Lambda est un service de fonctionnalit√©s sans serveur.  Nous prenons la fonction en Java, Go, Python ou un autre langage, nous la jetons dans Lambda, et elle est ex√©cut√©e comme par magie.  Il n'est pas n√©cessaire d'allouer et de g√©rer les ressources.  Comment cela a-t-il √©t√© mis en ≈ìuvre auparavant? <br><br><img src="https://habrastorage.org/webt/ou/ck/-s/ouck-sm6pjv4ul6t13dwlefxtry.png"><br><br>  Pour chaque compte AWS, une ou plusieurs machines virtuelles EC2 distinctes ont √©t√© allou√©es pour isoler les fonctions appartenant √† diff√©rents locataires.  Une telle machine virtuelle consomme des ressources, m√™me lorsqu'elle ne fait rien.  Supposons que nous ex√©cutons une fonction toutes les 10 minutes et qu'elle s'ex√©cute en 200 ms comme une Lambda ordinaire.  Il s'av√®re qu'en une heure la machine EC2 n'est utilis√©e que quelques secondes.  De plus, m√™me √† l'ex√©cution, il ne consomme pas toutes les ressources disponibles - √©limination sous la plinthe.  C'est furieusement non rentable. <br><br><img src="https://habrastorage.org/webt/jy/lo/0q/jylo0qlzudppsa5042qv858mfya.png"><br><br><h3>  Comment avez-vous r√©solu le probl√®me du recyclage? </h3><br>  D√©velopp√© √† partir de z√©ro leur propre solution Firecracker.  Cela ressort clairement du titre du rapport :) <br><br>  Pour commencer √† d√©velopper un nouveau produit, vous avez besoin d'une t√¢che technique.  Il contient beaucoup de texte, mais si vous s√©lectionnez uniquement la signification, vous obtenez ce qui suit. <br><br><ul><li>  <strong>Propuls√© par KVM en</strong> tant qu'hyperviseur.  Quiconque travaille avec AWS sait que nous avons deux hyperviseurs pr√©f√©r√©s.  Les machines virtuelles h√©rit√©es s'ex√©cutent sur Xen.  Depuis fin 2017, KVM vit sous le capot de toutes les voitures. </li><li>  <strong>Cela d√©marre le plus rapidement possible.</strong>  Sur le mat√©riel de r√©f√©rence, l'exigence √©tait une charge compl√®te du microvirtuel en 125 ms. </li><li>  <strong>Frais g√©n√©raux de virtualisation minimum</strong> .  Dans l'architecture de r√©f√©rence, une seule machine micro-virtuelle Firecracker ne consomme en outre que 5 Mo de m√©moire. </li><li>  <strong>La possibilit√© du d√©part le plus dense</strong> .  Param√®tres de conception - pleine charge de 5 microvirtuels par c≈ìur par seconde.  Cette exigence est fondamentale pour des services tels qu'AWS Lambda.  Les fonctions doivent d√©coller, s'entra√Æner et mourir rapidement, lib√©rant des ressources pour la suivante. </li><li>  <strong>La possibilit√© de r√©abonnement</strong> .  C'est une opportunit√© - il n'est pas n√©cessaire de l'utiliser.  En fait, il s'agit de l'allocation de ressources virtuelles dans une plus large mesure qu'elles ne sont physiquement disponibles.  Cela signifie que le serveur dispose de 16 Go de RAM et que vous ex√©cutez simultan√©ment 4 machines virtuelles sur celui-ci, chacun √©tant s√ªr qu'il dispose de 8 Go de m√©moire. </li></ul><br><h3>  AWS Lambda avec p√©tard sous le capot </h3><br>  Qu'est-ce qui a chang√© dans la nouvelle version d'AWS Lambda?  Du point de vue de l'utilisateur final, rien n'a chang√©.  La migration vers une architecture mise √† jour en production √©tait totalement transparente et invisible pour les consommateurs.  Les fonctionnalit√©s Lambda sont de courte dur√©e - c'√©tait facile √† faire. <br><br>  √Ä quoi ressemble l'architecture moderne? <br><br><blockquote>  Au niveau le plus bas, il ne s'agit plus maintenant d'une machine virtuelle, mais d'un bare-metal physique. </blockquote><br>  Ces serveurs permettent d'utiliser pleinement toutes les fonctions du processeur, par exemple Intel VT.  Cela offre des avantages suppl√©mentaires lors de l'utilisation de la virtualisation √† des niveaux sup√©rieurs. <br><br><img src="https://habrastorage.org/webt/rg/i6/s3/rgi6s36v7vgfuc2onnb-cuahbui.png"><br><br>  Au sommet de la pi√®ce de fer se trouve le <strong>syst√®me</strong> d' <strong>exploitation h√¥te</strong> avec le module KVM dans le noyau.  <strong>Les</strong> microvirtuels de <strong>p√©tard</strong> avec leurs propres <strong>OS invit√©s</strong> sont lanc√©s ci-dessus.  Eh bien, ils ont d√©j√† impl√©ment√© des composants du service AWS Lambda lui-m√™me. <br><br>  Auparavant, pour chaque client utilisant les fonctionnalit√©s Lambda, nous allouions des machines virtuelles EC2 distinctes √† faible utilisation.  La nouvelle approche vous permet d'ex√©cuter un microvirtuel l√©ger uniquement lorsque vous en avez vraiment besoin.  Isoler les ressources Firecracker les unes des autres nous permet de le faire sur un mat√©riel commun avec une densit√© maximale.  L'utilisation des ressources s'est fondamentalement am√©lior√©e. <br><br><h2>  Qu'y a-t-il dans la bo√Æte? </h2><br>  J'ai promis une anboxing, alors passons en revue les principaux composants de Firecracker, consid√©rons chacun d'eux s√©par√©ment, puis assemblons le tout. <br><br><img src="https://habrastorage.org/webt/o_/by/mq/o_bymqjtw5d6aomlwpmfa7grqgk.jpeg"><br><br><h3>  Principes de conception </h3><br>  Lorsque nous avons commenc√© √† discuter du d√©veloppement de Firecracker, nous avons convenu d'adh√©rer √† deux principes. <br><br>  <strong>D√©barrassez-vous de tout ce qui n'est pas n√©cessaire.</strong>  Pourquoi les machines virtuelles classiques se chargent-elles lentement?  En particulier, car le code est surcharg√©.  Ils doivent prendre en charge un grand nombre d'appareils h√©rit√©s.  Mais pourquoi √©muler un appareil que personne d'autre n'utilisait il y a 10 ans?  Il n'est donc pas n√©cessaire de se d√©barrasser de tout ce qui est superflu.  Nous r√©solvons une t√¢che √©troite sp√©cifique et toute fonctionnalit√© qui ne permet pas de r√©soudre ce probl√®me est consid√©r√©e comme inutile. <br><br><blockquote>  D√©barrassez-vous de tout ce qui est superflu et concentrez-vous sur une t√¢che. </blockquote><br>  <strong>Simplifiez ce qui reste.</strong>  M√™me ce qui reste devrait √™tre aussi simple que possible. <br><br><h3>  Sur quoi ont-ils √©crit? </h3><br>  Firecracker est √©crit en rouille tendance parce que: <br><br><ul><li>  il vous permet d'√©crire du <strong>code</strong> plus <strong>s√©curis√©</strong> , notamment en termes de m√©moire; </li><li>  <strong>Les performances</strong> et les frais g√©n√©raux sont comparables au C ++ moderne; </li><li>  La rouille <strong>est utilis√©e depuis longtemps,</strong> depuis 2015, elle a √©crit de nombreuses solutions int√©ressantes pour les charges √©lev√©es. </li></ul><br><h3>  Le fer </h3><br>  Je le r√©p√®te - Firecracker n√©cessite une installation sur du vrai mat√©riel.  Comme configuration de r√©f√©rence, la machine en m√©tal nu i3.metal a √©t√© choisie. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rg/to/nh/rgtonh5b1jbhgpzizky2wc6bsfk.png" width="400"></div><br>  <em>Remarque: le rapport √©tait au d√©but d'avril 2019. √Ä cette √©poque, seule la plate-forme Intel √©tait prise en charge.</em>  <em>En mai, ils ont ajout√© la prise en charge alpha d'AMD et en juin ARM.</em>  <em>AMD peut √™tre l√©g√®rement moins cher qu'Intel, et le support ARM offre des opportunit√©s int√©ressantes pour travailler avec l'IoT multi-locataire.</em> <br><br>  Si vous commandez une i3.metal ou une autre machine √† m√©taux nus dans AWS, alors pour les exp√©riences, ce sera une configuration trop puissante et co√ªteuse.  Par cons√©quent, si vous d√©cidez d'installer Firecracker sur eux, n'oubliez pas de payer ces machines apr√®s les exp√©riences.  Sinon, un score d√©cent viendra √† la fin du mois. <br><br>  Y a-t-il une option moins ch√®re?  Oui, vous pouvez d√©marrer Firecracker dans un environnement virtuel.  Mais plus dans AWS - nous ne prenons pas en charge la virtualisation imbriqu√©e sur EC2.  Mais vous pouvez le faire dans GCP, Azure, DigitalOcean ou utiliser Proxmox, Parallels, VMware Fusion.  Tout fonctionnera si vous respectez les exigences, en particulier, selon la version du noyau de l'OS invit√©. <br><br><h3>  Le noyau </h3><br><blockquote>  L'√©l√©ment fondamental de la solution est le module du noyau KVM. </blockquote><br>  Juste au cas o√π, je vais d√©crire comme une digression ce qu'est KVM.  Ce n'est pas tout l'hyperviseur, mais seulement une partie de celui-ci.  Ses principales t√¢ches consistent √† <strong>configurer un processeur virtuel</strong> (vCPU) et √† <strong>d√©marrer une machine virtuelle</strong> . <br><br><img src="https://habrastorage.org/webt/gp/3l/ee/gp3leep27-zq3yzx9fiiho15pkm.png"><br><br>  Mais cela ne suffit pas pour un travail √† part enti√®re.  En plus du processeur, certains autres p√©riph√©riques sont n√©cessaires.  Leur √©mulation se produit dans l'espace utilisateur. <br><br><h3>  VMM </h3><br>  Pour qu'au moins les p√©riph√©riques de base apparaissent, vous avez besoin d'un autre composant - Virtual Machine Manager (VMM).  Avant Firecracker, l'option VMM principale √©tait QEMU. <br><br><img src="https://habrastorage.org/webt/kg/s8/kr/kgs8krmluije10ql6x6vtch7f9g.png"><br><br>  Nous avons s√©rieusement envisag√© la possibilit√© d'utiliser QEMU, mais avons d√©cid√© de d√©velopper notre propre ¬´v√©lo¬ª.  Il y avait plusieurs raisons √† cela. <br><br>  <strong>Gestion du d√©veloppement</strong> .  QEMU est un grand produit mature avec plus d'un million de lignes de code.  Pour apporter des modifications, vous devez afficher trop de codes source.  Beaucoup de gens participent au d√©veloppement et √† la prise de d√©cision sur le d√©veloppement. <br><br>  <strong>La s√©curit√©</strong>  QEMU peut √©muler de nombreux appareils.  C'est pourquoi il a une surface d'attaque assez importante.  Notre t√¢che est de faire un microvirtuel.  D'un point de vue s√©curitaire, il faut minimiser la surface d'attaque. <br><br>  <strong>La n√©cessit√© d'impl√©menter de nouvelles fonctionnalit√©s.</strong>  QEMU a un bon code.  Il s'agit d'un produit mature dans lequel tous les bugs √©vidents sont d√©j√† d√©tect√©s.  Mais dans sa forme actuelle, la fonctionnalit√© QEMU ne nous convenait toujours pas - nous devions en ajouter beaucoup.  De ce point de vue, le nouveau code dans QEMU et dans le nouveau produit aurait la m√™me qualit√©.  Par cons√©quent, une victoire sp√©ciale ne fonctionnerait pas. <br><br><h3>  Appareils </h3><br>  Firecracker impl√©mente VMM, qui est utilis√© pour √©muler des appareils.  Nous √©mulons les appareils suivants: <br><br><ul><li>  <strong>La console</strong>  Une chose utile et n√©cessaire, m√™me si elle peut √™tre d√©sactiv√©e. </li><li>  <strong>Clavier</strong>  Nous avons cr√©√© un clavier d√©licat - avec un seul bouton ¬´R√©initialiser¬ª.  Nous ne faisons tout simplement pas confiance au logiciel ¬´Reset¬ª de ces syst√®mes d'exploitation qui pourraient potentiellement fonctionner dans Firecracker.  Par cons√©quent, ils ont fait du fer. </li><li>  <strong>Pilotes Virtio pour disque et r√©seau</strong> .  Virtio est un appareil tr√®s primitif.  En substance, il s'agit d'un "tampon en anneau".  Le syst√®me invit√© a √©crit quelque chose dans le tampon, a cliqu√© sur l'appel et le syst√®me h√¥te a lu les donn√©es de ce tampon dans un fichier. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pv/av/hw/pvavhwc_g42zvrjrg7ftiqmcfda.png" width="500"></div><br><br>  Dans certains cas, par exemple, pour l'int√©gration avec des conteneurs, nous avons toujours besoin d'un p√©riph√©rique r√©seau qui repr√©senterait les fonctionnalit√©s de base d'une carte r√©seau standard.  Virtio ne rentre pas ici, trop simple.  Par cons√©quent, pour le r√©seau, nous utilisons un autre appareil - <strong>Vsock</strong> . <br><br>  Eh bien, nous devons √©galement pouvoir contr√¥ler la consommation des ressources.  Le <strong>limiteur de d√©bit en</strong> est responsable. <br><br>  Il y a des appareils.  Mais comment g√©rer et configurer les microvirtuels?  L'API de gestion nous aidera ici. <br><br><h3>  La gestion </h3><br>  Amazon a plusieurs principes fondamentaux incassables.  L'un d'eux est que tous les services communiquent entre eux uniquement via l'API.  Peu importe qu'il s'agisse de services externes que vous utilisez en tant qu'utilisateur ou de nos services internes.  Il n‚Äôarrive pas qu‚Äôun service acc√®de directement √† la base de donn√©es d‚Äôun autre service - il est interdit et punissable.  Le thread de l'API Firecracker est juste utilis√© pour acc√©der aux param√®tres et aux fonctionnalit√©s des microvirtuels via l'API REST. <br><br><img src="https://habrastorage.org/webt/1s/qj/bt/1sqjbtijgutp6qfwscgu_vnq1va.png"><br><br>  Nous adh√©rons √† la sp√©cification Open API, vous pouvez donc utiliser Swagger. <br><br><h3>  M√©tadonn√©es </h3><br>  Il y a un tel mal - un codage dur.  C'est lorsque certaines donn√©es sont cousues directement dans le code, par exemple, le login et le mot de passe d'acc√®s √† une autre ressource.  Bien entendu, cela n'est pas autoris√©.  P√©riodiquement, nous devons transf√©rer certaines donn√©es √† l'int√©rieur du microvirtuel.  Cela se fait via le <strong>service de m√©tadonn√©es</strong> . <br><br><img src="https://habrastorage.org/webt/q_/ll/0m/q_ll0msnhoarxu6k5aag0ie2fug.png"><br><br>  Nous transmettons les informations requises via le socket au commerce de m√©tadonn√©es IMDS.  Pour obtenir ces informations dans le microvirtuel, vous devez demander <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://169.254.169.254/latest/meta-data</a> √† l'aide de l'API REST.  Les utilisateurs AWS connaissent d√©j√† cette IP magique.  De la m√™me mani√®re, les microvirtuels peuvent obtenir des informations d√©taill√©es sur leur propre configuration. <br><br><h3>  Journaux </h3><br>  Il est imp√©ratif de pouvoir jeter des b√ªches de microvirtuels dans le monde ext√©rieur avant sa mort.  Cela se fait via un <strong>FIFO</strong> Unix standard. <br><br><img src="https://habrastorage.org/webt/vr/p6/ib/vrp6ibzybyivbp68mi7wt1awobc.png"><br><br><h3>  Isolation suppl√©mentaire </h3><br>  Le principal avantage de la machine virtuelle isol√©e.  Il semble que cela devrait suffire, mais nous sommes all√©s plus loin.  Au cas o√π, pour fonctionner en production, il est recommand√© de poser une couche suppl√©mentaire d'isolation appel√©e <strong>Jailer</strong> . <br><br><img src="https://habrastorage.org/webt/1o/_2/j6/1o_2j6t6y7_ae7h1cmzk36xqliq.png"><br><br>  Ce sont des pr√©cautions standard: <br><br><ul><li>  <strong>cgroups</strong> pour limiter les ressources; </li></ul><br><ul><li>  <strong>espace</strong> de <strong>noms</strong> pour isoler les processus; </li><li>  <strong>seccomp</strong> - un analogue du pare-feu pour les appels syst√®me; </li><li>  et, bien s√ªr, le <strong>chroot</strong> pr√©f√©r√© de tout le monde <strong>.</strong> </li></ul><br><h2>  Int√©gration avec d'autres services </h2><br>  Existe-t-il des solutions pr√™tes √† l'emploi bas√©es sur Firecracker?  Bien s√ªr que oui. <br><br><h3>  OSV </h3><br>  Ce syst√®me d'exploitation est con√ßu pour ex√©cuter une seule application.  Pour cette raison, elle a tr√®s simplement organis√© le travail avec la m√©moire et un planificateur.  Un syst√®me d'exploitation puissant et facile √† g√©rer fonctionne d√©sormais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">au-dessus de Firecracker</a> . <br><br><h3>  Containerd </h3><br>  Nous avons √©galement fait l'int√©gration avec containerd.  Si vous travaillez d√©j√† avec lui, vous avez besoin d'un minimum d'efforts pour lancer des conteneurs qui sont envelopp√©s dans Firecracker pour l'isolement. <br><br><img src="https://habrastorage.org/webt/xm/l3/1n/xml31nghhesczi3x2ul1vagz5xw.png"><br><br>  Au lieu de la cale habituelle, containerd se r√©f√®re √† la cale de p√©tard.  Il g√®re d√©j√† runc, via un agent install√© √† l'int√©rieur du microvirtuel.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V√©rifi√©, fonctionne</a> . <br><br><h3>  Conteneurs Kata </h3><br>  Lorsque nous avons annonc√© Firecracker pour la premi√®re fois, l'une des questions les plus fr√©quemment pos√©es par les clients √©tait: <br><br>  <em>- Le m√©canisme d'isolement des conteneurs a d√©j√† √©t√© invent√© - il s'agit des conteneurs Kata.</em>  <em>Pourquoi ne les avez-vous pas utilis√©s?</em>  <em>Pourquoi d√©velopper le v√¥tre?</em> <br>  <em>- Kata fonctionne avec QEMU, mais nous ne voulons pas travailler avec QEMU.</em>  <em>Par cons√©quent, nous avons d√©cid√© de cuisiner le n√¥tre.</em> <br><br>  Mais cela s'est av√©r√© int√©ressant.  Les d√©veloppeurs de Kata ont rencontr√© les d√©veloppeurs de Firecracker et ont accept√© de s'int√©grer.  Parce que tout le monde voit cela comme un √©norme avantage.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kata Containers v1.5</a> prend d√©j√† en charge QEMU et Firecracker. <br><br>  Il s'av√®re que nous ne rivalisons pas, mais que nous nous compl√©tons harmonieusement.  Dans Kubernetes avec la v1.12, vous pouvez d√©finir runtimeClassName comme Kata FC ou Kata QEMU, et ex√©cuter vos conteneurs dans l'isolement appropri√©. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yt/1-/bn/yt1-bnzwtgnbvhvkkr48gmhsj5o.png" width="500"></div><br><br>  Comment choisir l'isolation qui convient √† votre application - P√©tard ou QEMU?  Mon opinion personnelle est que ce qui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">importe est de savoir si</a> votre demande concerne des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">animaux de compagnie ou du b√©tail</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vs/le/yj/vsleyjeqq1hypjljyr3jcjcpsvc.png" width="300"></div><br><br>  Kata avec QEMU est une solution pour les animaux de compagnie.  QEMU est un grand syst√®me multifonctionnel.  Potentiellement, il offre plus d'options de support et de traitement pour vos animaux de compagnie pr√©f√©r√©s. <br><br>  Le p√©tard convient lorsque la charge est du b√©tail.  Dans le cas o√π votre application sans √©tat a √©t√© initialement con√ßue pour une mise √† l'√©chelle horizontale flexible et la d√©faillance d'un ou plusieurs conteneurs n'est pas critique.  Fournissant une isolation fiable, il vous permet de charger rapidement le nombre requis de nouveaux conteneurs pour remplacer ceux qui ont √©chou√©. <br><br><h2>  Quel est le r√©sultat? </h2><br>  Nous avons commenc√© avec des contradictions.  Il semble que r√©soudre la contradiction soit une approche ¬´√† la fois la n√¥tre et la v√¥tre¬ª, quelque chose entre les deux qui satisfera tout le monde.  Mais l'exp√©rience montre qu'un compromis n'est pas n√©cessaire. <br><br>  Nous nous sommes fix√© pour objectif de d√©velopper une nouvelle solution dans laquelle il n'y aura rien de superflu qui ne soit n√©cessaire pour r√©soudre une t√¢che √©troite.  Il √©tait √©galement important de simplifier autant que possible tout ce que nous utilisons.  Je voudrais croire que nous n'avons pas obtenu de compromis, mais une solution solide qui vous permet de lancer rapidement et en masse des milliers de microvirtuels sans sacrifier leur isolement. <br><br>  Nous utilisons d√©j√† Firecracker dans la production de plusieurs de nos services.  Le principal avantage que nous avons obtenu est l'am√©lioration de l'utilisation des services.  Cela a permis d'√©conomiser consid√©rablement.  Une partie de ces √©conomies que nous avons partag√©es avec les clients.  Par exemple, apr√®s l'introduction de Firecracker, les prix des conteneurs sans serveur AWS Fargate en janvier 2019 ont chut√© de 35 √† 50%.  L'avantage est visible √† l'≈ìil nu, il ne fait donc aucun doute que nous continuerons √† d√©velopper ce produit et √† partager nos meilleures pratiques avec l'Open Source.  Le fait que Firecracker ait d√©j√† commenc√© √† s'int√©grer √† d'autres solutions indique un int√©r√™t croissant de la part de la communaut√©. <br><br>  Si vous avez une id√©e ou un produit fini dans la description de laquelle il y a les mots ¬´isolation multi-locataire¬ª - c'est un indicateur clair de ce qu'il vaut la peine d'exp√©rimenter avec des microvirtuels Firecracker. <br><br><blockquote>  Ce rapport illustre parfaitement le principe auquel nous essayons d'adh√©rer lors des conf√©rences d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ontiko</a> - recevoir une exp√©rience mondiale d'experts russophones.  Et le point n'est pas seulement dans une √©ventuelle barri√®re linguistique, mais dans la culture, nous sommes habitu√©s √† partager des d√©tails techniques.  En novembre, Vasily <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">se produira</a> √† nouveau √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HighLoad ++</a> , et il sera <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rejoint</a> , par exemple, par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Artemy Kolesnikov</a> de Facebook, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vittorio Cioe</a> d'Oracle et, bien s√ªr, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Petr Zaitsev</a> de Percona.  Nous aurons √©galement des rapports en anglais, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">abonnez</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vous</a> √† la newsletter - nous vous dirons quand de nouveaux seront ajout√©s aux quarante rapports accept√©s. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr464305/">https://habr.com/ru/post/fr464305/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr464291/index.html">Les 10 langages de programmation les plus influents des 50 derni√®res ann√©es et leurs cr√©ateurs</a></li>
<li><a href="../fr464293/index.html">Les crochets se remplacent-ils dans React Redux?</a></li>
<li><a href="../fr464295/index.html">Exemples d'utilisation de nouvelles fonctionnalit√©s JavaScript</a></li>
<li><a href="../fr464299/index.html">0, 0, 1, 0, 2, 0, 2, 2, 1, 6, 0, 5, 0, 2, 6, 5, 4, 0, 5, 3, 0, 3, 2, 9, 0, 4, 9, 3, 6, 14, 0, 6, 3, 5, 15, 0, 5, 3, 5 ...</a></li>
<li><a href="../fr464303/index.html">Donn√©es de s√©ries chronologiques dans un SGBD relationnel. Extensions TimescaleDB et PipelineDB pour PostgreSQL</a></li>
<li><a href="../fr464307/index.html">Test d'int√©gration de microservices sur Scala</a></li>
<li><a href="../fr464309/index.html">Bouton d'appel bricolage. Raspberry Pi, MajorDoMo, Freeswitch et Linphonec</a></li>
<li><a href="../fr464315/index.html">Le film dans lequel il y avait de la terre. Recherche sur Yandex et bref historique de la recherche par sens</a></li>
<li><a href="../fr464317/index.html">Projet Konbanwa</a></li>
<li><a href="../fr464325/index.html">Comment Scrumban unit le meilleur des m√©thodologies Kanban et Scrum</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>