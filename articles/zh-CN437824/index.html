<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌑 🤟🏻 🧝🏼 适用于Google表格和文档的通用1C扩展程序-使用和使用 🏴󠁧󠁢󠁥󠁮󠁧󠁿 🗑️ ⏹️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="本文适用于使用G Suite和1C的用户。 

 PIK Digital是一家从事建筑技术开发的IT公司。 去年，我们将PIK集团公司转移到了G Suite 。 为了与Google表格和文档完全兼容，有必要完善我们的系统。 

 其中一项改进是对扩展程序的扩展，该扩展程序可将1C中的报告和表格以Go...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>适用于Google表格和文档的通用1C扩展程序-使用和使用</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pik_digital/blog/437824/"> 本文适用于使用G Suite和1C的用户。 <br><br>  PIK Digital是一家从事建筑技术开发的IT公司。 去年，我们将PIK集团公司转移到了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">G Suite</a> 。 为了与Google表格和文档完全兼容，有必要完善我们的系统。 <br><br> 其中一项改进是对扩展程序的扩展，该扩展程序可将1C中的报告和表格以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Google表格</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Google Docs</a>的格式上传到Google云端硬盘。 在本文中，我们将分享现成的解决方案以及有关其实现的有用信息。 该扩展是免费的。 取用。 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">下载</a>扩展 <br> 在GitHub上<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">查看</a>代码 <br><br><img src="https://habrastorage.org/webt/g_/k8/i6/g_k8i6ikwt9gk_by1qkgodwpy7w.jpeg"><br><a name="habracut"></a><br> 为了使扩展正常工作，您将需要： <br><br><ol><li> 注册一个Google帐号 </li><li> 在Google Cloud Platform上建立专案 </li><li> 创建OAuth客户端 </li><li> 配置对Google Drive API的访问权限 </li><li> 安装扩展1C </li><li> 在1C中配置与Google API的连接 </li></ol><br> 接下来，我们分别考虑每个阶段并给出代码示例。 <br><br><h2>  Google帐户注册 </h2><br> 要工作，您需要一个<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Google帐户</a> 。 没有它，扩展将无法与G Suite服务进行交互。 已经有一个现有帐户-使用它。 <br><br><h2> 在GCP中创建项目 </h2><br> 要激活对Google Drive API的访问，您必须在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Google Cloud Platform</a> （GCP）中创建一个项目。 免费使用GCP有<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">两种选择</a> ： <br><br><ul><li> 试用期为12个月，预算为300美元。 </li><li> 始终免费-访问大多数GCP资源。 </li></ul><br> 两种方法都有局限性， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这里</a>将详细介绍。 我们建议选择12个月的试用期。 试用期过后，如果您不开始使用付费服务，则不会从您的帐户中扣除任何款项。 集成工作所需的一切都是免费的。 <br><br> 我们在链接<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">console.cloud.google.com上</a>注册该项目，单击“选择项目”，然后单击“创建项目”。 创建项目后，再次按“选择项目”按钮将其选中。 <br><br><img src="https://habrastorage.org/webt/-m/q5/lz/-mq5lzrbqzwx7g3dconm7-x17ng.png"><br><br><h3> 创建一个OAuth客户端 </h3><br> 创建用于使用OAUth 2.0协议连接到G Suite的凭据。 在GCP中，转到菜单项“ API和服务”-“凭据”-“创建凭据”-“ OAUth密钥标识符”。 <br><br> 出现提示以创建访问请求窗口。 当要求用户授予访问其数据的权限时，将形成此窗口。 <br><br><img src="https://habrastorage.org/webt/82/xt/sm/82xtsmkgs70pbswjvomkwjojtsk.png"><br><br> 将访问类型保留为“开放访问”，然后输入当员工启动项目并需要同意访问数据时将显示的应用程序的名称。 点击“保存”。 <br><br> 之后，设置“应用程序类型”。 选择其他类型，然后输入OAuth客户端ID。 请注意，这与应用程序的显示名称不同。 结果，将打开一个窗口，其中包含客户端的标识符和密码。 保存它们，这很重要。 <br><br><h2> 连接Google Drive API库 </h2><br> 要访问API功能，请转到菜单项“ API库”，找到所需的库并将其连接。 <br><br><img src="https://habrastorage.org/webt/mc/d9/sa/mcd9sasmv9p1ca1usutujkn5xra.png"><br><br> 由于我们要使用G Suite格式，因此需要将Google Drive API库连接到项目。 此外，我们将需要Google Sheets API库，Google Docs API。 以相同的方式查找并连接它。 <br><br><h2> 在用户模式下安装扩展 </h2><br> 现在，您可以制定对API的请求。 回想一下：我们的任务是将数据从标准表单的1C报告上载到Google表格或Google文档。 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">下载</a>扩展1C。 <br><br> 在1C中，可以独立安装配置扩展。 如果这是您第一次遇到此问题，请<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">观看</a>我们的简短<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">视频</a> ，了解如何执行此操作。 <br><br> 我们的扩展程序可在BP配置（从3.0.65和更高版本开始），ERP（从2.4.6和更高版本开始）和UT（从11.4.6和更高版本开始）上，从8.3.10版本开始的平台上运行。 <br><br> 如果在安装扩展时看到安全警告，请单击“是”。 您将看到一条消息，指出“当前操作已中断，无法发出警告。” 这意味着您已启用安全模式，因此您需要重复添加扩展名的过程并禁用安全模式。 添加后，重新启动1C。 <br><br> 如果安装成功，则您将在报告和打印表单中看到“保存到Google云端硬盘”按钮。 <br><br><img src="https://habrastorage.org/webt/jv/ca/ma/jvcama-ei85tl4nwyqt-rujwpr4.png"><br><br><h2> 设置参数以1C连接到Google API </h2><br> 剩下的工作就是配置用于连接到Google API的设置，您就可以工作。 再次，选择菜单中的“所有功能”项，然后在“处理”部分中寻找“ Google API连接设置”项。 <br><br><img src="https://habrastorage.org/webt/nl/yq/lw/nlyqlwepq_bqvzjweiyerukenio.png"><br><br> 我们使用在GCP中创建项目时获得的值填写Clientid，Clientsecret和“端口”字段。 默认情况下，将使用文件和文件夹的名称替换保存用于连接的临时密钥的位置。 出于安全原因，用户的密钥数据（刷新和访问令牌）存储在当前用户的临时文件目录，文件夹&lt;文件夹名称&gt;和文件&lt;文件名称&gt;中。 如果使用不同的配置创建了相同的Google项目，则可以使所有文件的文件名相同，以免创建具有相同信息的多个文件。 保存时，连接设置将保存在常规设置存储库中。 <br><br><h2> 保存报告 </h2><br> 现在，您可以将Google表格和Google Docs格式的报告保存在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Google云端硬盘中</a> 。 <br><br> 首次尝试保存报告时，您将需要在每个配置中执行一次一次性用户授权过程，以便该服务获得访问权限以保存数据。 <br><br><img src="https://habrastorage.org/webt/xi/qn/jt/xiqnjtmzavqmhxsileeempyf8j4.png"><br><br> 在出现的窗口中，输入您的Gmail电子邮件地址和密码。 下一个 <br> 在打开的窗口中，单击“允许”。 因此，您提供了将应用程序保存在Google云端硬盘中的信息。 <br><br><img src="https://habrastorage.org/webt/-u/tj/yk/-utjykqwshmj99tr1cyry1plzee.png"><br><br> 您将需要输入文件名，选择其类型和目录以保存到共享或个人驱动器。 点击“保存”。 保存后，报告将在浏览器中打开。 观赏愉快。 <br><br><h2> 问题的技术方面 </h2><br> 现在，让我们看看它在1C平台内如何工作。 <br> 要进行连接，将生成以下查询行到Google服务： <br><br><pre><code class="1c hljs">=<span class="hljs-string"><span class="hljs-string">"https://accounts.google.com/o/oauth2/auth"</span></span>+<span class="hljs-string"><span class="hljs-string">"?"</span></span> + <span class="hljs-string"><span class="hljs-string">"response_type=code"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;client_id="</span></span> + _ + <span class="hljs-string"><span class="hljs-string">"&amp;redirect_uri=http://localhost"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;access_type=offline"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;scope=https://www.googleapis.com/auth/drive https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.apps.readonly https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/drive.appdata https://www.googleapis.com/auth/drive.metadata;</span></span></code> </pre> <br>  client_id是我们之前在其中保存变量值的客户端的标识符。 <br>  scope-我们将使用的API库的地址。 如果需要连接多个库，请在它们的前面加一个空格。 <br><br> 客户端应用程序与Google服务的一次性连接需要此查询字符串。 您可以在浏览器中输入查询字符串，作为响应，服务将返回带有以下内容的URL： <br><br><pre> <code class="1c hljs">http:<span class="hljs-comment"><span class="hljs-comment">//localhost/?code=&lt;&gt;&amp;scope=https://www.googleapis.com/auth/admin.directory.user%20https://www.googleapis.com/auth/admin.directory.orgunit</span></span></code> </pre> <br> 您可以在1C表单设计器中添加HTML数据字段，并通过该字段执行请求。 我们需要从该URL获取值&lt;CODE&gt;-服务的访问代码。 <br><br> 仍然需要通过发出HTTP请求来获得两个令牌。 结果，请求将以JSON格式返回带有访问和刷新值的字符串。 刷新令牌不会随着时间的流逝而失去相关性，并且访问令牌的生存时间为60分钟，然后需要进行更新。 要接收这些令牌，我们需要刚刚收到的&lt;CODE&gt;，以及我们之前保存的客户端标识符和机密。 <br><br> 代码可能是这样的： <br><br><pre> <code class="1c hljs"> = <span class="hljs-string"><span class="hljs-string">"accounts.google.com"</span></span>;  = <span class="hljs-string"><span class="hljs-string">"/o/oauth2/token"</span></span>;  = <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(<span class="hljs-string"><span class="hljs-string">"client_id=%1&amp;client_secret=%2&amp;grant_type=authorization_code&amp;code=%3&amp;redirect_uri=http://localhost"</span></span>, _, _, );  = <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-type"><span class="hljs-type">HTTP</span></span>(,<span class="hljs-number"><span class="hljs-number">443</span></span>,,,,,<span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-type"><span class="hljs-type">OpenSSL</span></span>);  = <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-type"><span class="hljs-type"></span></span>; .(<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>,<span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded”) HTTP =  HTTP(,); HTTP.();  = .HTTP("</span></span>POST<span class="hljs-string"><span class="hljs-string">", HTTP);   . = 200  .(("</span></span>   : %<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">", .())); ; ;  = .();  =  JSON(); .();  = XDTO.JSON(); .();  = .access_token;  = .refresh_token;  = .expires_in;</span></span></code> </pre><br> 变量expires_in包含访问令牌的生存期。 <br> 以下是更新令牌的请求： <br><br><pre> <code class="1c hljs"> = <span class="hljs-string"><span class="hljs-string">"accounts.google.com"</span></span>;  = <span class="hljs-string"><span class="hljs-string">"/o/oauth2/token"</span></span>;  = Google.refresh_token; _ = Google.client_id; _ = Google.client_secret;  = <span class="hljs-string"><span class="hljs-string">"grant_type=refresh_token"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;client_id="</span></span> + _ + <span class="hljs-string"><span class="hljs-string">"&amp;client_secret="</span></span> + _ + <span class="hljs-string"><span class="hljs-string">"&amp;refresh_token="</span></span> + ;</code> </pre><br><h2> 将电子表格文档保存到Google云端硬盘 </h2><br> 现在，让我们看看如何将电子表格文档保存在Google云端硬盘上，然后将其转换为Google表格。 <br><br><pre> <code class="1c hljs"><span class="hljs-comment"><span class="hljs-comment">//  HTTP   = "file_for_drive"; // HTTP      = Google()[]; .("Content-Type", "multipart/related; boundary=" + ); //----- //  //----- //  =  ; .("Content-Type: application/json; charset=UTF-8"); //  // json    ,     = GSs(, , id_);  = GoogleAPI_._(, ); //----- //   //----- //----- //  //----- // .(); .("Content-Type: " + ); .("uploadType: media"); //   = (); .(, ()[]);  = GoogleAPI_._(,  ()); //----- //   //----- //----- //    .  =  ; .(); .();  = GoogleAPI_.HTTP(, ); //----- HTTP =  HTTP("/upload/drive/v2/files" + "?uploadType=multipart&amp;convert=true",); HTTP.();  =.HTTP("POST", HTTP);   . = 200   = " HTTP  " + .() + ",   " + .; GoogleAPI_.GS(, ".  ");  ""; ; HTTP = ; HTTP = ;  ();  (" ",.,,,()); ; HTTP = .(); JSON = GoogleAPI_GSheets.JSON(HTTP); //     google drive  GoogleAPI_GSheets.JSON(JSON, "alternateLink");</span></span></code> </pre><br> 此代码使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">分段上传</a>方法来上传文件。 <br> 我们从两个数据块形成一个POST请求。 在第一个块中，我们编写文件的标题和mimeType。 第二个块传输文件的内容。 块由定界符定义，定界符在块的末尾和开始处指示。 <br><br> 在我们有关插入Google Drive知识库文件的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文章中</a>了解有关此内容的更多信息。 <br><br> 这就是它的工作方式。 我们希望现在您不要浪费时间转换从1C下载的数据。 <br><br> 我们扩展的作者是PIK Digital Brazhnikova Maria <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">mbrazh</a>的主要开发人员 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN437824/">https://habr.com/ru/post/zh-CN437824/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN437812/index.html">Xcode 10.2，macOS Mojave 10.14.4，iOS 12.1和其他Beta</a></li>
<li><a href="../zh-CN437814/index.html">Xcode 10.2，macOS Mojave 10.14.4，iOS 12.1和其他测试版</a></li>
<li><a href="../zh-CN437816/index.html">MPLS无处不在。 Yandex.Cloud网络基础架构如何</a></li>
<li><a href="../zh-CN437818/index.html">我们教计算机识别声音：了解DCASE竞赛并在30分钟内组装您的音频分类器</a></li>
<li><a href="../zh-CN437820/index.html">50种Drupal安全性</a></li>
<li><a href="../zh-CN437826/index.html">我们如何将数据库从Redis和Riak KV迁移到PostgreSQL。 第1部分：过程</a></li>
<li><a href="../zh-CN437828/index.html">打开网络研讨会“ MS SQL Server中的SELECT查询执行顺序和查询计划”</a></li>
<li><a href="../zh-CN437830/index.html">可靠的语言编程-新手评论。 第一部分</a></li>
<li><a href="../zh-CN437832/index.html">开源：代码幽默，代码技巧，非代码</a></li>
<li><a href="../zh-CN437834/index.html">关于叶卡捷琳堡编程活动如何发生的两个故事</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>