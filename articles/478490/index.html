<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßëüèª üíª üï° Levenshtein distancia y b√∫squeda de controladores üõ∑ üë®üèΩ‚ÄçüöÄ üë®üèº‚Äç‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probablemente, en todas las ciudades de Bielorrusia donde hay trolebuses, hay grupos VK o chats en Telegram en los que las personas rastrean la ubicac...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Levenshtein distancia y b√∫squeda de controladores</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478490/">  Probablemente, en todas las ciudades de Bielorrusia donde hay trolebuses, hay grupos VK o chats en Telegram en los que las personas rastrean la ubicaci√≥n de los controladores.  Esto se hace principalmente para no pagar los viajes y viajar gratis, aunque la descripci√≥n de los grupos casi siempre contiene la posdata "Pagar por viajar". <br><a name="habracut"></a><br>  En VC, generalmente se ve as√≠: <br><br><img src="https://habrastorage.org/webt/ti/eh/cd/tiehcdyeskmccfofp3adt2ko_qe.png" alt="imagen"><br><br>  Un comentario t√≠pico se ve as√≠: <br><br><img src="https://habrastorage.org/webt/ki/kp/s0/kikps0wwqqptfwyro8hrf81rtzg.png" alt="imagen"><br><br>  La estructura es extremadamente simple.  En el comentario hay nombres de la parada donde se not√≥ actualmente a los controladores, tambi√©n est√° la direcci√≥n en la que se encuentran: <br><br><img src="https://habrastorage.org/webt/no/gy/2l/nogy2l1lrraa8gte90lcyuwsume.png" alt="imagen"><br><br>  El comentario, como resultado, es un objeto con una parada, hora y fecha, as√≠ como una identificaci√≥n √∫nica por la cual podemos identificarlo.  Con esto, puede calcular la ubicaci√≥n m√°s probable de d√≥nde est√°n los controladores ahora. <br><br><h4>  Preparaci√≥n </h4><br>  Primero debe determinar el p√∫blico objetivo, desde el cual analizaremos los datos.  El grupo debe tener mucha actividad en los comentarios, de lo contrario corremos el riesgo de obtener muy poca informaci√≥n <br><br>  En mi caso, este es el grupo "Control Gomel". <br><br>  Analizaremos los comentarios utilizando la API oficial de VKontakte para Python <br><br>  Nos autenticamos con la clave de acceso del usuario, ya que algunos grupos pueden estar cerrados, y el acceso a sus comentarios solo se puede obtener si usted fue aceptado en el grupo. <br>  Despu√©s de eso, puede comenzar a extraer comentarios: <br><br><h4>  Recibir comentarios </h4><br>  Para comenzar, obtenemos la √∫ltima publicaci√≥n disponible en el grupo para extraer comentarios a trav√©s de vk.wall.getComments e inicializar el DataFrame, en el que guardaremos los datos. <br><br>  Cada publicaci√≥n de comentarios tiene la inscripci√≥n "Que tengas un buen d√≠a, paga la tarifa y no caigas bajo control", as√≠ que descarga los comentarios, verifica el contenido de la publicaci√≥n y obt√©n una variedad de comentarios de los que puedes tomar datos. <br><br>  Tom√© comentarios de publicaciones en los √∫ltimos 3 meses, dado que 1 publicaci√≥n se publica todos los d√≠as (ahora a fines de noviembre, el a√±o escolar comienza en septiembre, y los supervisores probablemente tengan esto en cuenta y cambien sus lugares normales).  En principio, se pueden tener en cuenta otros signos, como, por ejemplo, la √©poca del a√±o. <br><br>  Algunos de los comentarios est√°n obstruidos con mensajes como "¬øHay alguien en Barykin?"  Si observa tales comentarios (innecesarios), puede resaltar algunos signos: <br><br><ul><li>  El texto contiene las palabras "limpio", "izquierda", "nadie" y similares </li><li>  Las palabras "dime", "qui√©n", "qu√©", "c√≥mo" </li><li>  S√≠mbolos, como emoticones, por ejemplo </li></ul><br>  Despu√©s de eso, revisamos una serie de comentarios y extraemos una identificaci√≥n √∫nica, texto, hora, fecha y d√≠a de la semana, que colocamos en el DataFrame ya creado. <br><br><div class="spoiler">  <b class="spoiler_title">Recibir comentarios</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> re <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vk_api <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> check_correctness <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">auth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> vk_session = vk_api.VkApi(lp.login, lp.password) vk_session.auth() vk = vk_session.get_api() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vk <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataFromComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(vk, groupID)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#     posts = vk.wall.get(owner_id=groupID, offset=1, count=90) print("\n") data = pd.DataFrame(columns=['text', 'post_id', "date", "day_in_week", "hour","minute", "day_in_month"]) for post in posts.get("items"): # id     postID = post.get("id") if "  ,       " not in post.get("text"): continue #  commentary       comments = vk.wall.getComments(owner_id=groupID, post_id=postID, count=200) #           dataframe for comment in comments.get("items"): text = comment.get("text") text = re.sub(r"A-Za-z--0123456789 ", "", str(text)) commentaryIsNice = check_correctness.detection(text) if commentaryIsNice: print(text) date = comment.get("date") time_struct = time.gmtime(date) post_id = comment.get("post_id") data = data.append({"text": text, "post_id" : post_id, "date": date,"day_in_week" : time_struct.tm_wday, "hour": (time_struct.tm_hour+3), "minute": time_struct.tm_min, "day_in_month": time_struct.tm_mday}, ignore_index=True) # print(data[:10]) # print(data.info()) print("dataset is ready") return data</span></span></code> </pre> <br></div></div><br>  Por lo tanto, recibimos un DataFrame con el texto de los comentarios, su identificaci√≥n, d√≠a de la semana, hora y minuto en que se escribi√≥ el comentario.  Solo necesitamos el d√≠a de la semana, la hora de escritura y el texto.  Se parece a esto: <br><br><img src="https://habrastorage.org/webt/cd/hs/cy/cdhscyg3rx4f5kejgvjdguuscui.png" alt="imagen"><br><br><h4>  Limpieza de datos </h4><br>  Ahora necesitamos borrar los datos.  Es necesario eliminar la direcci√≥n del comentario para cometer menos errores al buscar la distancia de Levenshtein.  Encontramos las expresiones "a un lado", "ir", "c√≥mo", "cerca", ya que generalmente van seguidas del nombre de la segunda parada, y las eliminamos junto con lo que viene despu√©s de ellas, as√≠ como reemplazamos algunos nombres de jerga de las paradas con las habituales. . <br><br><div class="spoiler">  <b class="spoiler_title">Borrar datos</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> fuzzywuzzy <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> process <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear_commentary</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    -     """</span></span> index = <span class="hljs-number"><span class="hljs-number">0</span></span> splitted = text.split(<span class="hljs-string"><span class="hljs-string">" "</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, s <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(splitted): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(splitted) == <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> np.NaN <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> ( <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> ( <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s)) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> s <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>): index = i <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> index <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> index &lt; len(splitted) - <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>): splitted.remove(splitted[index]) string = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(splitted) text = (string.lower()) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> index <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: splitted = splitted[:index] string = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(splitted) text = string.lower() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: text = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(splitted).lower() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clean_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function">:</span></span> data.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>].map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: clear_commentary(s)) data.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) print(<span class="hljs-string"><span class="hljs-string">"cleaned"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data</code> </pre> <br></div></div><br><h4>  Convertir usando la distancia de Levenshtein </h4><br>  Procedemos directamente a la distancia de Levenshane.  Un poco de ayuda: la distancia de Levenshtein: el n√∫mero m√≠nimo de operaciones para insertar un car√°cter, eliminar un car√°cter y reemplazar un car√°cter con otro, necesario para convertir una l√≠nea en otra. <br><br>  Lo encontraremos usando la biblioteca <a href="https://github.com/seatgeek/fuzzywuzzy">fuzzywuzzy</a> .  Le ayuda a calcular r√°pida y f√°cilmente la distancia de Levenshtein.  Para acelerar el trabajo, los autores de la biblioteca tambi√©n recomiendan instalar la biblioteca python-Levenshtein. <br><br>  Para obtener paradas de los comentarios, necesitamos una lista de paradas.  Me lo brind√≥ amablemente el desarrollador de la aplicaci√≥n GoTrans, Alexander Kozlov. <br><br>  La lista tuvo que ampliarse, agregando algunas paradas que no estaban all√≠, y cambiando parte de los nombres para que estuvieran mejor ubicados. <br><br><div class="spoiler">  <b class="spoiler_title">Paradas</b> <div class="spoiler_text">  paradas = ['supermercado', 'prado', 'remybtekhnika', 'Leningrado', 'Yaroslavl', 'Polesskaya', <br>  'Yaroslavl', 'timofeenko', '8 de marzo', <br>  ¬´Casa comercial Rechitsky¬ª, ¬´Avenida Rechitsky¬ª, ¬´circo¬ª, ¬´grandes almacenes¬ª, ¬´Chongarskaya¬ª, <br>  'chongarka', 'ggu', 'skorina', 'university', 'appliance', '1000 little things', 'maya', 'station', <br>  'parque de posgrado', 'comercio y econom√≠a', 'aniversario', 'microdistrito 18', 'aeropuerto', 'pr√≥ximo', <br>  'gomelgeodezcentr', 'crystal', 'lake lyubenskoye', 'mercado davydovsky', 'davydovka', <br>  'river sozh', 'gomeldrev', <br>  'Sevruki', 'gmu No. 1', 'etc. Rechitsky', 'disfraz', 'hospital de enfermedades infecciosas', 'campamento de gaviotas', <br>  Volotova, Coral, Gomeltorgmash, Gomelproekt, Vneshgomelstroy, Peri√≥dico, <br>  'Kalenikova', 'Eremino', 'destiler√≠a', 'automatizaci√≥n industrial especial', '2nd School', 'Barykina', <br>  'unidades de m√°quina', 'juventud', 'cuerpo de casting', 'qu√≠micos', 'golovatsky', 'budenny', <br>  'spu67', '35th', 'gagarin', '50 a√±os para la planta de Gomselmash ',' hill ',' f√°brica de radio ', <br>  'abuela', 'cristaler√≠a', 'casta√±o', 'motores de arranque', 'astronautas', <br>  'rtsrm initial', 'bykhovskaya', 'instituto del ministerio de situaciones de emergencia', 'dk gomselmash', 'store', 'rechitsky', <br>  'Sevruks', 'Osovtsy', 'turista', 'f√°brica de carne', 'Sant√≠sima Trinidad', 'ciudad m√©dica', 'octubre', <br>  'dep√≥sito de petr√≥leo', 'gomelloblavtotrans', 'milkavita', 'bakunin', 'zip', 'oma', 'resina', <br>  'construction market ksk', 'road builder', 'field', 'kamenetskaya', 'bolshevik', 'jakubovka', <br>  'Borodina', 'hipermercado hipop√≥tamo', 'h√©roes subterr√°neos', '9 de mayo', 'casta√±o', 'prot√©sico', <br>  'estaci√≥n iput', 'internacional comunista', 'universidad pedag√≥gica musical', 'empresa agr√≠cola', 'desv√≠o', 'victoria', <br>  'western', 'pearl', 'Vladimir', 'dry', 'dispensary', 'Ivanova', <br>  'construcci√≥n de m√°quinas', 'abedules', '60 a√±os', 'ingeniero de potencia', 'centrolita', <br>  'cl√≠nica oncol√≥gica', 'campo de tiro', 'golovintsy', 'coral', 'sur', 'primavera', <br>  Efremova, Border, Belgut, Gomelstroy, Borisenko, Athletics Palace, <br>  'Michurinsky', 'solar', 'gastello', 'militar', 'centro de autom√≥viles', 'fontaner√≠a', 'uza', <br>  'facultad de medicina', 'jard√≠n de infantes 11', 'bolchevique', 'cachorros', 'Davydovsky', 'oc√©ano', 'progreso', <br>  'Dobrushskaya', 'blanco', 'GSK', 'davydovka', 'equipo el√©ctrico', 'amistad', <br>  '70 a√±os ',' reparaci√≥n de autom√≥viles ',' colina sueca ',' circuito ',' canal de agua ',' m√°quina gomel ', <br>  Volotova, Pioneer, RCM, Khimtorg, 2nd Meadow Lane, Bochkina, Ba√±os, <br>  'cl√≠nica oncol√≥gica', 'plaza', 'Lenin', 'primera escuela', 'tienda sur', <br>  'gomelagrotrans', 'millers', 'lyubensky', 'oficina de alistamiento militar', 'hospital', 'uza', 'rtsrm', <br>  'lysyukovyh', 'shop iput', 'raton', 'gasolinera', 'randovsky', 'farmhouse', 'casta√±o', 'ropovsky', <br>  'Romanovichi', 'Ilyich', 'remo', 'empresa de construcci√≥n', 'infeccioso', <br>  'f√°brica gorda', 'servicio de autom√≥viles', 'servicio agr√≠cola', 'adhesivo', 'Nikolskaya', <br>  'cosechadoras autopropulsadas', 'alba√±iles', 'materiales de construcci√≥n', 'maquinaria de reparaci√≥n', 'administraci√≥n', <br>  'Octubre', 'cuento de hadas del bosque', 'Tatiana', 'Boris Tsarikov', 'Zharkovsky', 'Zaitseva', <br>  ¬´reubicaci√≥n¬ª, ¬´Karpovich¬ª, ¬´planta de construcci√≥n de viviendas¬ª, ¬´transporte el√©ctrico urbano¬ª, ¬´zlin¬ª, <br>  ¬´estadio gomselmash¬ª, ¬´ap 6¬ª, ¬´accionamiento hidr√°ulico¬ª, ¬´dep√≥sito de locomotoras¬ª, ¬´mercado de autom√≥viles osovtsy¬ª, <br>  'nueva vida', 'Zhukova', 'unidad militar', 'tercera escuela', 'bosque', 'faro rojo', <br>  'regional', 'Davydovskaya', 'Karbysheva', 'sat√©lite del mundo', 'juventud', 'locomotora de estadio', <br>  'solar', 'Ladaservice', 'ŒºR 21', 'Aresa', 'internacionalistas', 'Kosareva', <br>  'Bogdanova', 'Hormig√≥n de hierro Gomel', 'Œºr 20a', 'Œºr Rechitsky', 'equipamiento m√©dico', 'Juraeva', <br>  'college of art crafts', 'ice', 'dk festival', 'shopping center', <br>  'Kuibyshevsky', 'festival', 'garage koop 27', 'ingenier√≠a s√≠smica', 'milcha', 'hospital de tubos', <br>  'ptu179', 'productos qu√≠micos', 'departamento de bomberos', 'hospital', 'estaci√≥n de autobuses', <br>  'complejo de peri√≥dicos', 'victoria', 'klenkovsky', 'diamante', 'reparaci√≥n del motor', 'mkr 19'] <br></div></div><br>  Usando .map y fuzzywuzzy.process.extractOne, encontramos la parada con la distancia m√≠nima de Levenshtein en la lista, despu√©s de lo cual reemplazamos el texto del comentario con el nombre de la parada, lo que nos permite obtener un conjunto de datos con los nombres de las paradas. <br><br>  El conjunto de datos resultante se parece a esto: <br><br><img src="https://habrastorage.org/webt/gd/pd/c8/gdpdc8lwdppzpastghnasxbqsbi.png"><br><br><div class="spoiler">  <b class="spoiler_title">Los comentarios se transforman en paradas</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_category_from_comment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""              """</span></span> dict = process.extractOne(text.lower(), stops) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> dict[<span class="hljs-number"><span class="hljs-number">1</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">75</span></span>: text = dict[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: text = np.nan print(<span class="hljs-string"><span class="hljs-string">"wait"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_category_dataset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""      """</span></span> print(<span class="hljs-string"><span class="hljs-string">"remap started. wait"</span></span>) data.text = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> comment: get_category_from_comment(str(comment))) print(<span class="hljs-string"><span class="hljs-string">"remap ends"</span></span>) data.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data</code> </pre> <br></div></div><br><h4>  Salida de datos </h4><br>  Ahora podemos suponer d√≥nde estar√°n los controladores en la hora dada. <br><br>  Estamos buscando en los registros de datos resultantes para una hora y un d√≠a espec√≠ficos de la semana.  Por ejemplo, el martes a las 9 am: <br><br><pre> <code class="python hljs">&lt;code&gt;data[(data[<span class="hljs-string"><span class="hljs-string">"day_in_week"</span></span>] == day) &amp; (data[<span class="hljs-string"><span class="hljs-string">"hour"</span></span>] == hour)]&lt;/code&gt;</code> </pre> <br><img src="https://habrastorage.org/webt/t4/gg/dg/t4ggdgmwezje8lgllisorbqrqwa.png"><br>  <i>(esto no es toda la informaci√≥n)</i> <br><br>  Despu√©s de eso, encontramos el n√∫mero de paradas √∫nicas, y mostramos solo las paradas, y su n√∫mero: <br><br><pre> <code class="python hljs">df[(df[<span class="hljs-string"><span class="hljs-string">"day_in_week"</span></span>] == <span class="hljs-number"><span class="hljs-number">2</span></span>) &amp; (df[<span class="hljs-string"><span class="hljs-string">"hour"</span></span>] == <span class="hljs-number"><span class="hljs-number">9</span></span>)][<span class="hljs-string"><span class="hljs-string">"text"</span></span>].value_counts()</code> </pre> <br><img src="https://habrastorage.org/webt/yq/az/if/yqazifl3gkclyqw4ifykvemsrky.png"><br><br>  Ahora podemos decir que a las 9 en punto de la ma√±ana, los martes, los controladores probablemente ser√°n notados en las paradas de la Planta de Procesamiento de Carne, ul.  Lugovaya, BelGUT, TD "Oma". <br><br>  El principal defecto de este m√©todo es la falta de datos.  No para todos los d√≠as y horas hay entradas en los comentarios dados durante la hora pico, cuando las personas usan el transporte p√∫blico m√°s que los datos en horas menos populares, pero si agrega datos, por ejemplo, no solo de los comentarios de un grupo, sino tambi√©n de grupos alternativos, o chats de telegramas, con el n√∫mero de entradas, todo ser√° m√°s f√°cil. <br><br><h4>  Bot con VK LongPoll API </h4><br>  Para dar la oportunidad de recibir datos sobre la ubicaci√≥n de los controladores, dependiendo de la hora, y sin estar atado a una computadora, hice un bot para un grupo en VKontakte que responde a cualquier mensaje enviando el n√∫mero de paradas en los registros, dada la hora y el d√≠a actual de la semana. <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo bot</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> randint <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vk_api <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> get_stops_from_data <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> get_stops_by_time <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start_bot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data, token)</span></span></span><span class="hljs-function">:</span></span> vk_session = vk_api.VkApi(token=token) vk = vk_session.get_api() print(<span class="hljs-string"><span class="hljs-string">"bot started"</span></span>) longPoll = vk.groups.getLongPollServer(group_id=<span class="hljs-number"><span class="hljs-number">183524419</span></span>) server, key, ts = longPoll[<span class="hljs-string"><span class="hljs-string">'server'</span></span>], longPoll[<span class="hljs-string"><span class="hljs-string">'key'</span></span>], longPoll[<span class="hljs-string"><span class="hljs-string">'ts'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-comment"><span class="hljs-comment">#  :   ts longPoll = post('%s' % server, data={'act': 'a_check', 'key': key, 'ts': ts, 'wait': 25}).json() if longPoll['updates'] and len(longPoll['updates']) != 0: for update in longPoll['updates']: if update['type'] == 'message_new': #        vk.messages.markAsRead(peer_id=update['object']['user_id']) user = update['object']["user_id"] text = get_stops_by_time(data) if text is None or text == {}: message = "√≠√•√≤ √ß√†√Ø√®√±√•√©" vk.messages.send(user_id=user, random_id=randint(-2147483648, 2147483647), message=message) print(message) ts = longPoll['ts'] continue message = "   -     \n" \ "\n \n" for i in text.items(): message += i[0] + " " message += str(i[1]) message += "\n" #    vk.messages.send(user_id=user, random_id=randint(-2147483648, 2147483647), message=message) ts = longPoll['ts']</span></span></code> </pre> <br></div></div><br><h4>  Conclusi√≥n </h4><br>  La calidad de tales hip√≥tesis ha sido probada por m√≠ m√°s de una vez en la pr√°ctica, y todo funciona bien.  Result√≥ que los controladores, b√°sicamente, est√°n en las mismas paradas, aunque no se pueden dar pron√≥sticos absolutamente correctos, y la probabilidad de √©xito no es del 100%.  La distancia de Levenshtein tiene docenas de aplicaciones diferentes, desde corregir errores en una palabra, hasta comparar genes, cromosomas y prote√≠nas, pero tambi√©n tiene potencial en tales problemas aplicados. <br><br>  Que tenga un buen d√≠a y pague la tarifa. <br><br>  Todos los c√≥digos de bot y manipulaciones de datos se publican <a href="https://github.com/dingdongyouarewrong/vk_controllers_bot">aqu√≠</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/478490/">https://habr.com/ru/post/478490/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../478474/index.html">El hermano Pablo Escobar tambi√©n lanz√≥ un tel√©fono inteligente flexible</a></li>
<li><a href="../478480/index.html">Inteligencia artificial, ITSM y, en general, ¬ød√≥nde est√° LEAN?</a></li>
<li><a href="../478482/index.html">El desarrollador abri√≥ una barra para desarrolladores y anfitriones de reuniones all√≠ en Angular, dise√±o, PHP</a></li>
<li><a href="../478484/index.html">SCADA en Frambuesa: ¬ømito o realidad?</a></li>
<li><a href="../478486/index.html">La era de los chips de 10 nm: qui√©n desarrolla dichos procesadores y qu√© le espera a la industria en el futuro</a></li>
<li><a href="../478492/index.html">Escherichia coli en una dieta de CO2: ¬øuna nueva herramienta en la lucha contra el calentamiento global?</a></li>
<li><a href="../478494/index.html">Soluci√≥n de tratamiento t√©rmico Winnum TRP: configuraci√≥n y uso</a></li>
<li><a href="../478496/index.html">Hace 50 a√±os en la habitaci√≥n n√∫mero 3420 naci√≥ Internet</a></li>
<li><a href="../478498/index.html">1. Fortinet Getting Started v 6.0. Introduccion</a></li>
<li><a href="../478500/index.html">¬øPor qu√© hay tan pocas conferencias en el verano?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>