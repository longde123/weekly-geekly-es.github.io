<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😶 🐰 🕺🏼 Bereitstellung und Datenbanken ohne Ausfallzeiten 🔛 🎻 🐛</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel wird ausführlich erläutert, wie die mit der Datenbankkompatibilität verbundenen Probleme während der Bereitstellung behoben werden. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bereitstellung und Datenbanken ohne Ausfallzeiten</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/nixys/blog/481932/"><p><img src="https://habrastorage.org/webt/hr/vy/qq/hrvyqqi2mmitehw9vx_xklbofj8.png" alt="Bild"></p><br><p>  In diesem Artikel wird ausführlich erläutert, wie die mit der Datenbankkompatibilität verbundenen Probleme während der Bereitstellung behoben werden.  Wir werden Ihnen mitteilen, was mit Ihren Anwendungen auf dem Produkt geschehen kann, wenn Sie versuchen, eine Bereitstellung ohne vorherige Vorbereitung durchzuführen.  Dann werden wir die Phasen des Anwendungslebenszyklus durchlaufen, die notwendig sind, um keine Ausfallzeiten zu haben ( <em>ca. Übersetzung: weiter - keine Ausfallzeiten</em> ).  Das Ergebnis unserer Operationen wird die Anwendung einer abwärtskompatiblen Datenbankänderung auf abwärtskompatible Weise sein. </p><a name="habracut"></a><br><p>  Wenn Sie die Codebeispiele aus dem Artikel verstehen möchten, finden Sie sie auf <a href="https://github.com/spring-cloud-samples/zero-downtime-deployment">GitHub</a> . </p><br><h2 id="vvedenie">  Einleitung </h2><br><h3 id="zero-downtime-deployment">  Bereitstellung ohne Ausfallzeiten </h3><br><p>  Was ist die mystische <strong>Null-Ausfallzeit-Bereitstellung</strong> ?  Dies können wir sagen, wenn Ihre Anwendung bereitgestellt wird, damit Sie eine neue Version der Anwendung erfolgreich für die Produktion einführen können, während der Benutzer die Unzugänglichkeit nicht bemerkt.  Dies ist aus Sicht des Anwenders und des Unternehmens das bestmögliche Deployment-Szenario, da auf diese Weise neue Funktionen eingeführt und Fehler ohne Unterbrechung behoben werden können. </p><br><p>  Wie kann man das erreichen?  Es gibt verschiedene Möglichkeiten, hier eine davon: </p><br><ul><li>  Erweitern Sie Version 1 Ihres Dienstes </li><li>  Migrieren Sie die Datenbank </li><li>  Stellen Sie Version 2 Ihres Dienstes parallel zu Version 1 bereit </li><li>  Sobald Sie feststellen, dass Version 2 ordnungsgemäß funktioniert, entfernen Sie Version 1 </li><li>  fertig! </li></ul><br><p>  Einfach, richtig?  Leider ist dies nicht so einfach, und wir werden dies später im Detail betrachten.  Schauen wir uns nun einen weiteren, recht häufigen Bereitstellungsprozess an - die blaugrüne Bereitstellung. </p><br><p>  Haben Sie jemals von einem <a href="https://martinfowler.com/bliki/BlueGreenDeployment.html">blau-grünen Einsatz gehört</a> ?  Mit Cloud Foundry ist dies extrem einfach.  Schauen Sie sich <a href="https://spring.io/blog/2014/04/04/project-sagan-zero-downtime-deployments">diesen Artikel an,</a> in dem wir ihn genauer beschreiben.  Zusammenfassend erinnern wir uns kurz daran, wie die Bereitstellung von Blaugrün durchgeführt wird: </p><br><ul><li>  <em>Stellen Sie sicher, dass zwei Kopien Ihres Produktionscodes ("blau" und "grün") funktionieren.</em> </li><li>  <em>den gesamten Verkehr in die blaue Umgebung leiten, d. h.</em>  <em>damit die Produktions-URLs dorthin zeigen;</em> </li><li>  <em>Stellen Sie alle Anwendungsänderungen in einer grünen Umgebung bereit und testen Sie sie</em> </li><li>  <em>schalte die URL von blau auf grün um</em> </li></ul><br><p>  Blue Green Deployment ist ein Ansatz, mit dem Sie auf einfache Weise neue Funktionen einführen können, ohne befürchten zu müssen, dass die Produktion unterbrochen wird.  Dies liegt an der Tatsache, dass Sie auch dann problemlos zur vorherigen Umgebung zurückkehren können, wenn Sie einfach auf einen Schalter klicken. </p><br><p>  Nachdem Sie alle oben genannten Punkte gelesen haben, können Sie die Frage stellen: Was hat die Null-Ausfallzeit mit der blau-grünen Bereitstellung zu tun? </p><br><p>  Nun, sie haben viele Gemeinsamkeiten, da für die Unterstützung von zwei Kopien derselben Umgebung doppelte Anstrengungen erforderlich sind.  Dies ist der Grund, warum einige Teams laut <a href="https://martinfowler.com/bliki/BlueGreenDeployment.html">Martin Fowler</a> Variationen dieses Ansatzes verfolgen: </p><br><p> <em>Eine andere Möglichkeit besteht darin, dieselbe Datenbank zu verwenden und blaugrüne Switches für Web- und Domain-Layer zu erstellen.</em>  <em>Bei diesem Ansatz können Datenbanken häufig ein Problem darstellen, insbesondere wenn Sie das Schema ändern müssen, um eine neue Version der Software zu unterstützen.</em> </p><br><p>  Und hier kommen wir zum Hauptproblem in diesem Artikel.  <strong>Die Datenbank</strong> .  Schauen wir uns diesen Satz noch einmal an. </p><br><p>  <em>Migrieren Sie die Datenbank.</em> </p><br><p>  Nun müssen Sie sich die Frage stellen, was passiert, wenn das Ändern der Datenbank inkompatibel ist?  Bricht meine erste Version der Anwendung nicht?  Genau das wird passieren ... </p><br><p>  Trotz der enormen Vorteile einer Bereitstellung ohne Ausfallzeiten und ohne "Blue Green" neigen Unternehmen dazu, den folgenden sichereren Bereitstellungsprozess für ihre Anwendungen zu befolgen: </p><br><ul><li>  Bereiten Sie ein Paket mit einer neuen Version der Anwendung vor </li><li>  Beenden Sie eine laufende Anwendung </li><li>  Führen Sie Skripte für die Datenbankmigration aus </li><li>  Stellen Sie die neue Version der Anwendung bereit und starten Sie sie </li></ul><br><p>  In diesem Artikel wird ausführlich beschrieben, wie Sie mit einer Datenbank und Code arbeiten können, um die Bereitstellung ohne Ausfallzeiten zu nutzen. </p><br><h3 id="problemy-s-bazoy-dannyh">  Datenbankprobleme </h3><br><p>  Wenn Sie eine zustandslose Anwendung haben, in der keine Daten in der Datenbank gespeichert sind, können Sie die Bereitstellung ohne Ausfallzeiten sofort durchführen.  Leider muss die meiste Software Daten irgendwo speichern.  Aus diesem Grund sollten Sie überlegen, bevor Sie Änderungen an der Schaltung vornehmen.  Bevor wir uns mit den Details zum Ändern des Schemas befassen, damit es ohne Ausfallzeiten bereitgestellt werden kann, konzentrieren wir uns zunächst auf das Versionskontrollschema. </p><br><h3 id="shema-upravleniya-versiyami">  Versionskontrollschema </h3><br><p> In diesem Artikel verwenden wir <a href="https://flywaydb.org/">Flyway</a> als Tool für die Versionskontrolle ( <em>ungefähr übersetzt: es handelt sich um eine Datenbankmigration</em> ).  Natürlich werden wir auch eine Spring Boot-Anwendung mit integrierter Flyway-Unterstützung schreiben und die Schaltung migrieren, während wir den Anwendungskontext einrichten.  Bei Verwendung von Flyway können Sie Migrationsskripte in Ihrem Projektordner speichern (standardmäßig im <code>classpath:db/migration</code> ).  Hier sehen Sie ein Beispiel für solche Migrationsdateien. </p><br><pre> <code class="plaintext hljs">└── db └── migration ├── V1__init.sql ├── V2__Add_surname.sql ├── V3__Final_migration.sql └── V4__Remove_lastname.sql</code> </pre> <br><p>  In diesem Beispiel sehen wir 4 Migrationsszenarien, die nach dem Start der Anwendung nacheinander ausgeführt werden, wenn sie nicht früher ausgeführt wurden.  Schauen wir uns als Beispiel eine der Dateien ( <code>V1__init.sql</code> ) an. </p><br><pre> <code class="plaintext hljs">CREATE TABLE PERSON ( id BIGINT GENERATED BY DEFAULT AS IDENTITY, first_name varchar(255) not null, last_name varchar(255) not null ); insert into PERSON (first_name, last_name) values ('Dave', 'Syer');</code> </pre> <br><p>  Alles spricht für sich selbst: Mit SQL können Sie festlegen, wie Ihre Datenbank geändert werden soll.  Weitere Informationen zu Spring Boot und Flyway finden Sie unter <a href="https://docs.spring.io/spring-boot/docs/1.3.5.RELEASE/reference/html/howto-database-initialization.html">Spring Boot-Dokumente</a> . </p><br><p>  Die Verwendung der Versionskontrolle mit Spring Boot bietet Ihnen zwei große Vorteile: </p><br><ul><li>  Sie trennen Datenbankänderungen von Codeänderungen </li><li>  Die Datenbankmigration erfolgt zusammen mit dem Rollout Ihrer Anwendung, d. h.  Ihr Bereitstellungsprozess wird vereinfacht </li></ul><br><h2 id="reshenie-problem-s-bazoy-dannyh">  Lösen von Datenbankproblemen </h2><br><p>  Im nächsten Abschnitt des Artikels werden wir uns auf zwei Ansätze für Datenbankänderungen konzentrieren. </p><br><ul><li>  Rückwärts-Inkompatibilität </li><li>  Abwärtskompatibilität </li></ul><br><p>  Die erste Warnung wird als Warnung betrachtet, dass Sie ohne vorherige Vorbereitung keine Bereitstellung ohne Ausfallzeit durchführen sollten. Die zweite bietet eine Lösung dafür, wie Sie eine Bereitstellung ohne Ausfallzeit durchführen und gleichzeitig die Abwärtskompatibilität aufrechterhalten können. </p><br><p>  Unser Projekt, an dem wir arbeiten werden, wird eine einfache Spring Boot Flyway-Anwendung sein, in der sich eine <code>Person</code> mit <code>first_name</code> und <code>last_name</code> in der Datenbank befindet ( <em>ungefähr pro: <code>Person</code> ist eine Tabelle, und <code>irst_name</code> und <code>last_name</code> sind die Felder darin</em> ).  Wir wollen <code>last_name</code> in <code>surname</code> umbenennen. </p><br><h3 id="dopuscheniya">  Annahmen </h3><br><p>  Bevor wir uns mit den Details befassen, müssen wir einige Annahmen zu unseren Anwendungen skizzieren.  Das Hauptergebnis, das wir erreichen wollen, wird ein ziemlich einfacher Prozess sein. </p><br><blockquote>  <strong>Hinweis</strong>  Geschäft PRO-TIP.  Durch die Rationalisierung von Prozessen können Sie beim Support viel Geld sparen (je mehr Mitarbeiter in Ihrem Unternehmen arbeiten, desto mehr Geld können Sie sparen)! </blockquote><br><h3 id="ne-nado-delat-otkat-bazy-dannyh">  Die Datenbank muss nicht zurückgesetzt werden </h3><br><p>  Dies vereinfacht den Bereitstellungsprozess (einige Rollbacks der Datenbank sind fast unmöglich, z. B. das Löschen von Rollbacks).  Wir ziehen es vor, nur Anwendungen zurückzusetzen.  Auf diese Weise sieht Ihre Bereitstellungspipeline auch dann gleich aus, wenn Sie über unterschiedliche Datenbanken verfügen (z. B. SQL und NoSQL). </p><br><p>  <strong>Es muss IMMER möglich sein, die Anwendung um eine Version zurückzusetzen (nicht mehr)</strong> </p><br><p>  Ein Rollback sollte nur bei Bedarf durchgeführt werden.  Wenn in der aktuellen Version ein Fehler auftritt, der nicht einfach zu beheben ist, sollten wir in der Lage sein, die neueste Arbeitsversion zurückzugeben.  Wir gehen davon aus, dass es sich bei dieser neuesten Arbeitsversion um die vorherige handelt.  Die Aufrechterhaltung der Code- und Datenbankkompatibilität für mehr als ein Rollout wäre äußerst schwierig und kostspielig. </p><br><blockquote>  <strong>Hinweis</strong>  Zur besseren Lesbarkeit werden wir im Rahmen dieses Artikels die Hauptversion der Anwendung ändern. </blockquote><br><h3 id="shag-1-ishodnoe-sostoyanie">  Schritt 1: Ausgangszustand </h3><br><p>  Anwendungsversion: <code>1.0.0</code> <br>  DB Version: <code>v1</code> </p><br><h3 id="kommentariy">  Kommentar </h3><br><p>  Dies ist der Ausgangszustand der Anwendung. </p><br><h3 id="izmeneniya-bd">  DB ändert sich </h3><br><p>  Die Datenbank enthält den <code>last_name.</code> </p><br><pre> <code class="plaintext hljs">CREATE TABLE PERSON ( id BIGINT GENERATED BY DEFAULT AS IDENTITY, first_name varchar(255) not null, last_name varchar(255) not null ); insert into PERSON (first_name, last_name) values ('Dave', 'Syer');</code> </pre> <br><h3 id="izmeneniya-koda">  Code-Änderungen </h3><br><p>  Die Anwendung speichert Personendaten unter <code>last_name</code> : </p><br><pre> <code class="plaintext hljs">/* * Copyright 2012-2016 the original author or authors. * * Licensed under the Apache License, Version 2.0 (the "License"); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * * http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */ package sample.flyway; import javax.persistence.Entity; import javax.persistence.GeneratedValue; import javax.persistence.Id; @Entity public class Person { @Id @GeneratedValue private Long id; private String firstName; private String lastName; public String getFirstName() { return this.firstName; } public void setFirstName(String firstName) { this.firstName = firstName; } public String getLastName() { return this.lastName; } public void setLastName(String lastname) { this.lastName = lastname; } @Override public String toString() { return "Person [firstName=" + this.firstName + ", lastName=" + this.lastName + "]"; } }</code> </pre> <br><h3 id="obratno-nesovmestimoe-pereimenovanie-stolbca">  Inkompatible Spaltenumbenennung </h3><br><p>  Schauen wir uns ein Beispiel zum Ändern eines Spaltennamens an: </p><br><blockquote>  <strong>Achtung</strong>  Das folgende Beispiel wird absichtlich unterbrochen.  Wir zeigen dies, um das Datenbankkompatibilitätsproblem zu demonstrieren. </blockquote><p>  Anwendungsversion: <code>2.0.0.BAD</code> </p><br><p>  DB Version: <code>v2bad</code> </p><br><h3 id="kommentariy-1">  Kommentar </h3><br><p>  Aktuelle Änderungen ermöglichen es uns NICHT, zwei Instanzen (alte und neue) gleichzeitig auszuführen.  Eine Bereitstellung ohne Ausfallzeiten ist daher schwierig zu erreichen (Annahmen, die berücksichtigt werden, dies ist praktisch unmöglich). </p><br><h3 id="ab-testirovanie">  A / B-Test </h3><br><p>  Die aktuelle Situation ist, dass wir eine in prod bereitgestellte Anwendungsversion <code>1.0.0,</code> und eine Datenbank <code>v1</code> .  Wir müssen die zweite Instanz der Anwendung, Version <code>2.0.0.BAD</code> , <code>2.0.0.BAD</code> und die Datenbank auf <code>v2bad</code> . </p><br><p>  Schritte: </p><br><ol><li>  stellte eine neue Instanz der Anwendungsversion <code>2.0.0.BAD</code> , die die Datenbank auf <code>v2bad</code> </li><li>  Die Spalte " <code>surname</code> in der <code>v2bad</code> Datenbank nicht mehr vorhanden. Sie wurde in " <code>surname</code> geändert </li><li>  Datenbank- und Anwendungsaktualisierungen waren erfolgreich, und einige Instanzen funktionieren in <code>1.0.0</code> , andere in <code>2.0.0.BAD</code> .  Alle verwandt mit <code>v2bad</code> </li><li>  Alle Instanzen von Version <code>1.0.0</code> <code>last_name</code> Fehler aus, da sie versuchen, Daten in die Spalte <code>last_name</code> einzufügen, die nicht mehr vorhanden ist </li><li>  Alle Instanzen von Version <code>2.0.0.BAD</code> funktionieren ohne Probleme </li></ol><br><p>  Wie Sie sehen, sind A / B-Tests nicht möglich, wenn wir inkompatible Änderungen an der Datenbank und den Anwendungen vornehmen. </p><br><h3 id="otkat-prilozheniya">  Rollback-Anwendung </h3><br><p>  Nehmen wir an, dass wir nach dem Versuch, eine A / B-Bereitstellung durchzuführen ( <em>ungefähr übersetzt: wahrscheinlich bezog sich der Autor hier auf A / B-Tests</em> ), entschieden haben, dass wir die Anwendung auf Version <code>1.0.0.</code>  Angenommen, wir möchten die Datenbank nicht zurücksetzen. </p><br><p>  Schritte: </p><br><ol><li>  Wir stoppen die Anwendungsinstanz Version <code>2.0.0.BAD</code> </li><li>  Datenbank ist noch <code>v2bad</code> </li><li>  Da Version <code>1.0.0</code> <code>surname</code> nicht versteht, werden Fehler angezeigt </li><li>  Die Hölle brach los, wir können nicht mehr zurückkehren </li></ol><br><p>  Wie Sie sehen, können wir bei inkompatiblen Änderungen an der Datenbank und den Anwendungen kein Rollback auf die vorherige Version durchführen. </p><br><h3 id="logi-ispolneniya-skripta">  Skriptausführungsprotokolle </h3><br><pre> <code class="plaintext hljs">Backward incompatible scenario: 01) Run 1.0.0 02) Wait for the app (1.0.0) to boot 03) Generate a person by calling POST localhost:9991/person to version 1.0.0 04) Run 2.0.0.BAD 05) Wait for the app (2.0.0.BAD) to boot 06) Generate a person by calling POST localhost:9991/person to version 1.0.0 &lt;-- this should fail 07) Generate a person by calling POST localhost:9992/person to version 2.0.0.BAD &lt;-- this should pass Starting app in version 1.0.0 Generate a person in version 1.0.0 Sending a post to 127.0.0.1:9991/person. This is the response: {"firstName":"b73f639f-e176-4463-bf26-1135aace2f57","lastName":"b73f639f-e176-4463-bf26-1135aace2f57"} Starting app in version 2.0.0.BAD Generate a person in version 1.0.0 Sending a post to 127.0.0.1:9991/person. This is the response: curl: (22) The requested URL returned error: 500 Internal Server Error Generate a person in version 2.0.0.BAD Sending a post to 127.0.0.1:9995/person. This is the response: {"firstName":"e156be2e-06b6-4730-9c43-6e14cfcda125","surname":"e156be2e-06b6-4730-9c43-6e14cfcda125"}</code> </pre> <br><h3 id="izmeneniya-bd-1">  DB ändert sich </h3><br><p>  Migrationsskript, das <code>last_name</code> in <code>surname</code> <code>last_name</code> </p><br><p>  Quell-Flyway-Skript: </p><br><pre> <code class="plaintext hljs">CREATE TABLE PERSON ( id BIGINT GENERATED BY DEFAULT AS IDENTITY, first_name varchar(255) not null, last_name varchar(255) not null ); insert into PERSON (first_name, last_name) values ('Dave', 'Syer');</code> </pre> <br><p>  Ein Skript, das den <code>last_name</code> . </p><br><pre> <code class="plaintext hljs">-- This change is backward incompatible - you can't do A/B testing ALTER TABLE PERSON CHANGE last_name surname VARCHAR;</code> </pre> <br><h3 id="izmeneniya-koda-1">  Code-Änderungen </h3><br><p>  Wir haben den <code>lastName</code> <code>surname</code> in <code>surname</code> geändert. </p><br><h3 id="pereimenovanie-stolbca-obratno-sovmestimym-sposobom">  Eine Spalte abwärtskompatibel umbenennen </h3><br><p>  Dies ist die häufigste Situation, der wir begegnen können.  Wir müssen rückwärts inkompatible Änderungen vornehmen.  Wir haben bereits bewiesen, dass für eine Bereitstellung ohne Ausfallzeiten nicht nur die Datenbankmigration ohne zusätzliche Maßnahmen angewendet werden sollte.  In diesem Abschnitt des Artikels werden 3 Bereitstellungen der Anwendung sowie Datenbankmigrationen durchgeführt, um das gewünschte Ergebnis zu erzielen und gleichzeitig die Abwärtskompatibilität zu gewährleisten. </p><br><blockquote>  <strong>Hinweis</strong>  Denken Sie daran, dass wir eine Datenbankversion <code>v1</code> .  Es enthält die Spalten <code>first_name</code> und <code>last_name</code> .  Wir müssen <code>last_name</code> in <code>surname</code> ändern.  Wir haben auch eine Anwendungsversion <code>1.0.0,</code> , die noch keinen <code>surname</code> . </blockquote><br><h3 id="shag-2-dobavlyaem-surname">  Schritt 2: Nachname hinzufügen </h3><br><p>  Anwendungsversion: <code>2.0.0</code> <br>  DB Version: <code>v2</code> </p><br><h3 id="kommentariy-2">  Kommentar </h3><br><p>  Durch Hinzufügen einer neuen Spalte und Kopieren ihres Inhalts erstellen wir abwärtskompatible Datenbankänderungen.  Wenn wir die JAR-Datei zurücksetzen oder eine funktionierende alte JAR-Datei haben, wird sie zur Laufzeit nicht beschädigt. </p><br><h3 id="vykatyvaem-novuyu-versiyu">  Wir rollen die neue Version aus </h3><br><p>  Schritte: </p><br><ol><li>  Migrieren Sie die Datenbank, um eine neue <code>surname</code> zu erstellen.  Jetzt deine db version <code>v2</code> </li><li>  Kopieren Sie die Daten von <code>last_name</code> zu <code>surname</code> .  <strong>Beachten Sie,</strong> dass Sie eine Batch-Migration in Betracht ziehen sollten, wenn Sie über viele dieser Daten verfügen! </li><li>  Schreiben Sie Code, in dem sowohl die <strong>neue</strong> als auch die <strong>alte</strong> Spalte verwendet werden.  Nun Ihre Anwendungsversion <code>2.0.0</code> </li><li>  Lesen Sie den Wert aus der Spalte <code>surname</code> , wenn er nicht <code>null</code> , oder aus <code>ast_name</code> wenn <code>surname</code> nicht angegeben ist.  Sie können <code>getLastName()</code> aus dem Code entfernen, da es <code>null</code> zurückgibt, wenn Sie Ihre Anwendung von <code>3.0.0</code> auf <code>2.0.0</code> . </li></ol><br><p>  Wenn Sie Spring Boot Flyway verwenden, werden diese beiden Schritte beim Start von Version <code>2.0.0</code> Anwendung ausgeführt.  Wenn Sie das Datenbankversionierungstool manuell ausführen, müssen Sie zwei verschiedene Aktionen ausführen (zuerst die Datenbankversion manuell aktualisieren und dann eine neue Anwendung bereitstellen). </p><br><blockquote>  <strong>Es ist wichtig.</strong>  Denken Sie daran, dass eine neu erstellte Spalte <strong>NICHT NICHT NULL sein</strong> darf.  Wenn Sie ein Rollback durchführen, kennt die alte Anwendung die neue Spalte nicht und installiert sie beim <code>Insert.</code>  Wenn Sie diese Einschränkung jedoch hinzufügen und Ihre Datenbank die <code>v2</code> , muss der Wert der neuen Spalte festgelegt werden.  Was zu Verstößen gegen Beschränkungen führen wird. <br><br>  <strong>Es ist wichtig.</strong>  Sie sollten die Methode <code>getLastName()</code> entfernen, da Version <code>3.0.0</code> nicht das Konzept einer Spalte <code>last_name</code> im Code hat.  Dies bedeutet, dass dort null gesetzt wird.  Sie können die Methode verlassen und <code>getSurname()</code> hinzufügen. Eine viel bessere Lösung wäre jedoch, sicherzustellen, dass Sie in der <code>getSurname()</code> den richtigen Wert ungleich Null ausgewählt haben. </blockquote><br><h3 id="ab-testirovanie-1">  A / B-Test </h3><br><p>  Die aktuelle Situation besteht darin, dass auf dem Produkt eine Anwendungsversion <code>1.0.0</code> und in Version 1 eine Datenbank <code>v1</code> .  Wir müssen die zweite Instanz der Anwendungsversion <code>2.0.0</code> bereitstellen, mit der die Datenbank auf Version 2 aktualisiert wird. </p><br><p>  Schritte: </p><br><ol><li>  stellte eine neue Instanz der Anwendungsversion <code>2.0.0</code> , mit der die Datenbank auf Version 2 aktualisiert wird </li><li>  In der Zwischenzeit wurden einige Anforderungen von Instanzen der Version <code>1.0.0</code> </li><li>  Das Update war erfolgreich, und Sie haben mehrere Arbeitsinstanzen der Anwendungsversion <code>1.0.0</code> und der restlichen Version <code>2.0.0.</code>  Jeder kommuniziert mit der Datenbank in <code>v2</code> </li><li>  Version <code>1.0.0</code> verwendet nicht die Nachname-Spalte in der Datenbank, aber Version <code>2.0.0</code> verwendet.  Sie stören sich nicht und es sollten keine Fehler auftreten. </li><li>  Version <code>2.0.0</code> speichert Daten sowohl in der alten als auch in der neuen Spalte, was Abwärtskompatibilität bietet </li></ol><br><blockquote>  <strong>Es ist wichtig.</strong>  Wenn Sie Abfragen haben, die Elemente basierend auf Werten aus der alten / neuen Spalte zählen, sollten Sie daran denken, dass Sie jetzt doppelte Werte haben (höchstwahrscheinlich werden sie noch migriert).  Wenn Sie beispielsweise die Anzahl der Benutzer zählen möchten, deren Nachname (unabhängig vom Namen der Spalte) mit dem Buchstaben <code>A</code> beginnt, haben Sie möglicherweise inkonsistente Daten, bevor die Datenmigration ( <code>old</code> → <code>new</code> Spalte) abgeschlossen ist, wenn Sie eine Abfrage für eine neue Spalte ausführen. </blockquote><br><h3 id="otkat-prilozheniya-1">  Rollback-Anwendung </h3><br><p>  Jetzt haben wir eine Anwendungsversion <code>2.0.0</code> und eine Datenbank in <code>v2</code> . </p><br><p>  Schritte: </p><br><ol><li>  Setzen Sie Ihre Anwendung auf Version <code>1.0.0</code> . </li><li>  In Version <code>1.0.0</code> wird die <code>surname</code> Spalte in der Datenbank nicht verwendet, daher muss das Rollback erfolgreich sein </li></ol><br><h3 id="izmeneniya-db">  DB ändert sich </h3><br><p>  Die Datenbank enthält eine Spalte mit dem Namen <code>last_name</code> . </p><br><p>  Quell-Flyway-Skript: </p><br><pre> <code class="plaintext hljs">CREATE TABLE PERSON ( id BIGINT GENERATED BY DEFAULT AS IDENTITY, first_name varchar(255) not null, last_name varchar(255) not null ); insert into PERSON (first_name, last_name) values ('Dave', 'Syer');</code> </pre> <br><p>  Das Skript zum Hinzufügen des <code>surname</code> . </p><br><blockquote>  <strong>Achtung</strong>  Denken Sie daran, dass Sie der hinzugefügten Spalte KEINE NOT NULL-Einschränkungen HINZUFÜGEN KÖNNEN.  Wenn Sie die JAR-Datei zurücksetzen, hat die alte Version keine Ahnung von der hinzugefügten Spalte und setzt sie automatisch auf NULL.  Wenn es eine solche Einschränkung gibt, wird die alte Anwendung einfach unterbrochen. </blockquote><br><pre> <code class="plaintext hljs">-- NOTE: This field can't have the NOT NULL constraint cause if you rollback, the old version won't know about this field -- and will always set it to NULL ALTER TABLE PERSON ADD surname varchar(255); -- WE'RE ASSUMING THAT IT'S A FAST MIGRATION - OTHERWISE WE WOULD HAVE TO MIGRATE IN BATCHES UPDATE PERSON SET PERSON.surname = PERSON.last_name</code> </pre> <br><h3 id="izmeneniya-koda-2">  Code-Änderungen </h3><br><p>  Wir speichern Daten sowohl im <code>last_name</code> als auch im <code>surname</code> .  Gleichzeitig lesen wir von <code>last_name</code> , da diese Spalte am relevantesten ist.  Während des Bereitstellungsprozesses wurden einige Anforderungen möglicherweise von einer Anwendungsinstanz verarbeitet, die noch nicht aktualisiert wurde. </p><br><pre> <code class="plaintext hljs">/* * Copyright 2012-2016 the original author or authors. * * Licensed under the Apache License, Version 2.0 (the "License"); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * * http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */ package sample.flyway; import javax.persistence.Entity; import javax.persistence.GeneratedValue; import javax.persistence.Id; @Entity public class Person { @Id @GeneratedValue private Long id; private String firstName; private String lastName; private String surname; public String getFirstName() { return this.firstName; } public void setFirstName(String firstName) { this.firstName = firstName; } /** * Reading from the new column if it's set. If not the from the old one. * * When migrating from version 1.0.0 -&gt; 2.0.0 this can lead to a possibility that some data in * the surname column is not up to date (during the migration process lastName could have been updated). * In this case one can run yet another migration script after all applications have been deployed in the * new version to ensure that the surname field is updated. * * However it makes sense since when looking at the migration from 2.0.0 -&gt; 3.0.0. In 3.0.0 we no longer * have a notion of lastName at all - so we don't update that column. If we rollback from 3.0.0 -&gt; 2.0.0 if we * would be reading from lastName, then we would have very old data (since not a single datum was inserted * to lastName in version 3.0.0). */ public String getSurname() { return this.surname != null ? this.surname : this.lastName; } /** * Storing both FIRST_NAME and SURNAME entries */ public void setSurname(String surname) { this.lastName = surname; this.surname = surname; } @Override public String toString() { return "Person [firstName=" + this.firstName + ", lastName=" + this.lastName + ", surname=" + this.surname + "]"; } }</code> </pre> <br><h3 id="shag-3-udalenie-last_name-iz-koda">  Schritt 3: Entfernen von Nachname aus dem Code </h3><br><p>  Anwendungsversion: <code>3.0.0</code> </p><br><p>  DB Version: <code>v3</code> </p><br><h3 id="kommentariy-3">  Kommentar </h3><br><p>  <em>Hinweis</em>  <em>trans .: Offensichtlich hat der Autor den Text dieses Blocks aus Schritt 2 des Originalartikels fälschlicherweise kopiert. In diesem Schritt sollten Änderungen am Anwendungscode vorgenommen werden, um die Funktionalität zu entfernen, die die Spalte <code>last_name</code> .</em> </p><br><p>  Durch Hinzufügen einer neuen Spalte und Kopieren ihres Inhalts haben wir abwärtskompatible Datenbankänderungen erstellt.  Auch wenn wir das JAR zurücksetzen oder ein funktionierendes altes JAR haben, wird es zur Laufzeit nicht beschädigt. </p><br><h3 id="otkat-prilozheniya-2">  Rollback-Anwendung </h3><br><p>  Wir haben derzeit die Version <code>3.0.0</code> Anwendung und die <code>v3</code> Datenbank.  Version <code>3.0.0</code> speichert keine Daten in <code>last_name</code> .  Dies bedeutet, dass der <code>surname</code> die aktuellsten Informationen speichert. </p><br><p>  Schritte: </p><br><ol><li>  Führen Sie ein Rollback Ihrer Anwendung auf Version <code>2.0.0</code> . </li><li>  Version <code>2.0.0</code> verwendet sowohl <code>last_name</code> als auch <code>surname</code> . </li><li>  Version <code>2.0.0</code> nimmt den <code>surname</code> wenn er nicht null ist, andernfalls <code>last_name</code> </li></ol><br><h3 id="izmeneniya-bd-2">  DB ändert sich </h3><br><p>  Es gibt keine strukturellen Änderungen in der Datenbank.  Das folgende Skript wird ausgeführt, das die endgültige Migration alter Daten durchführt: </p><br><pre> <code class="plaintext hljs">-- WE'RE ASSUMING THAT IT'S A FAST MIGRATION - OTHERWISE WE WOULD HAVE TO MIGRATE IN BATCHES -- ALSO WE'RE NOT CHECKING IF WE'RE NOT OVERRIDING EXISTING ENTRIES. WE WOULD HAVE TO COMPARE -- ENTRY VERSIONS TO ENSURE THAT IF THERE IS ALREADY AN ENTRY WITH A HIGHER VERSION NUMBER -- WE WILL NOT OVERRIDE IT. UPDATE PERSON SET PERSON.surname = PERSON.last_name; -- DROPPING THE NOT NULL CONSTRAINT; OTHERWISE YOU WILL TRY TO INSERT NULL VALUE OF THE LAST_NAME -- WITH A NOT_NULL CONSTRAINT. ALTER TABLE PERSON MODIFY COLUMN last_name varchar(255) NULL DEFAULT NULL;</code> </pre> <br><h3 id="izmeneniya-koda-3">  Code-Änderungen </h3><br><p>  <em>Hinweis</em>  <em>trans .: Die Beschreibung dieses Blocks wurde vom Autor auch fälschlicherweise aus Schritt 2 kopiert. Gemäß der Logik der Artikelgeschichte sollten Änderungen im Code in diesem Schritt darauf abzielen, Elemente, die mit der Spalte <code>last_name</code> funktionieren, daraus zu <code>last_name</code> .</em> </p><br><p>  Wir speichern Daten sowohl im <code>last_name</code> als auch im <code>surname.</code>  Außerdem lesen wir aus der Spalte <code>last_name</code> , da dies am relevantesten ist.  Während des Bereitstellungsprozesses werden einige Anforderungen möglicherweise von einer Instanz verarbeitet, die noch nicht aktualisiert wurde. </p><br><pre> <code class="plaintext hljs">/* * Copyright 2012-2016 the original author or authors. * * Licensed under the Apache License, Version 2.0 (the "License"); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * * http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */ package sample.flyway; import javax.persistence.Entity; import javax.persistence.GeneratedValue; import javax.persistence.Id; @Entity public class Person { @Id @GeneratedValue private Long id; private String firstName; private String surname; public String getFirstName() { return this.firstName; } public void setFirstName(String firstName) { this.firstName = firstName; } public String getSurname() { return this.surname; } public void setSurname(String lastname) { this.surname = lastname; } @Override public String toString() { return "Person [firstName=" + this.firstName + ", surname=" + this.surname + "]"; } }</code> </pre> <br><h3 id="shag-4-udalenie-last_name-iz-bd">  Schritt 4: Entfernen von Nachname aus der Datenbank </h3><br><p>  Anwendungsversion: <code>4.0.0</code> </p><br><p>  DB Version: <code>v4</code> </p><br><h3 id="kommentariy-4">  Kommentar </h3><br><p>  Aufgrund der Tatsache, dass der Code der Version <code>3.0.0</code> die Spalte <code>last_name</code> nicht verwendet <code>last_name</code> , wird während der Ausführung nichts Schlimmes passieren, wenn nach dem Entfernen der Spalte aus der Datenbank ein Rollback auf <code>3.0.0</code> . </p><br><h3 id="logi-ispolneniya-skripta-1">  Skriptausführungsprotokolle </h3><br><pre> <code class="plaintext hljs">We will do it in the following way: 01) Run 1.0.0 02) Wait for the app (1.0.0) to boot 03) Generate a person by calling POST localhost:9991/person to version 1.0.0 04) Run 2.0.0 05) Wait for the app (2.0.0) to boot 06) Generate a person by calling POST localhost:9991/person to version 1.0.0 07) Generate a person by calling POST localhost:9992/person to version 2.0.0 08) Kill app (1.0.0) 09) Run 3.0.0 10) Wait for the app (3.0.0) to boot 11) Generate a person by calling POST localhost:9992/person to version 2.0.0 12) Generate a person by calling POST localhost:9993/person to version 3.0.0 13) Kill app (3.0.0) 14) Run 4.0.0 15) Wait for the app (4.0.0) to boot 16) Generate a person by calling POST localhost:9993/person to version 3.0.0 17) Generate a person by calling POST localhost:9994/person to version 4.0.0 Starting app in version 1.0.0 Generate a person in version 1.0.0 Sending a post to 127.0.0.1:9991/person. This is the response: {"firstName":"52b6e125-4a5c-429b-a47a-ef18bbc639d2","lastName":"52b6e125-4a5c-429b-a47a-ef18bbc639d2"} Starting app in version 2.0.0 Generate a person in version 1.0.0 Sending a post to 127.0.0.1:9991/person. This is the response: {"firstName":"e41ee756-4fa7-4737-b832-e28827a00deb","lastName":"e41ee756-4fa7-4737-b832-e28827a00deb"} Generate a person in version 2.0.0 Sending a post to 127.0.0.1:9992/person. This is the response: {"firstName":"0c1240f5-649a-4bc5-8aa9-cff855f3927f","lastName":"0c1240f5-649a-4bc5-8aa9-cff855f3927f","surname":"0c1240f5-649a-4bc5-8aa9-cff855f3927f"} Killing app 1.0.0 Starting app in version 3.0.0 Generate a person in version 2.0.0 Sending a post to 127.0.0.1:9992/person. This is the response: {"firstName":"74d84a9e-5f44-43b8-907c-148c6d26a71b","lastName":"74d84a9e-5f44-43b8-907c-148c6d26a71b","surname":"74d84a9e-5f44-43b8-907c-148c6d26a71b"} Generate a person in version 3.0.0 Sending a post to 127.0.0.1:9993/person. This is the response: {"firstName":"c6564dbe-9ab5-40ae-9077-8ae6668d5862","surname":"c6564dbe-9ab5-40ae-9077-8ae6668d5862"} Killing app 2.0.0 Starting app in version 4.0.0 Generate a person in version 3.0.0 Sending a post to 127.0.0.1:9993/person. This is the response: {"firstName":"cbe942fc-832e-45e9-a838-0fae25c10a51","surname":"cbe942fc-832e-45e9-a838-0fae25c10a51"} Generate a person in version 4.0.0 Sending a post to 127.0.0.1:9994/person. This is the response: {"firstName":"ff6857ce-9c41-413a-863e-358e2719bf88","surname":"ff6857ce-9c41-413a-863e-358e2719bf88"}</code> </pre> <br><h3 id="izmeneniya-db-1">  DB ändert sich </h3><br><p>  Für <code>v3</code> entfernen wir einfach die <code>last_name</code> Spalte und fügen die fehlenden Einschränkungen hinzu. </p><br><pre> <code class="plaintext hljs">-- REMOVE THE COLUMN ALTER TABLE PERSON DROP last_name; -- ADD CONSTRAINTS UPDATE PERSON SET surname='' WHERE surname IS NULL; ALTER TABLE PERSON ALTER COLUMN surname VARCHAR NOT NULL;</code> </pre> <br><h3 id="izmeneniya-koda-4">  Code-Änderungen </h3><br><p>  Es gibt keine Änderungen im Code. </p><br><h3 id="vyvod">  Fazit </h3><br><p>  Wir haben die abwärtskompatible Änderung des Spaltennamens erfolgreich angewendet, indem wir mehrere abwärtskompatible Bereitstellungen durchgeführt haben.  Nachfolgend finden Sie eine Zusammenfassung der durchgeführten Schritte: </p><br><ol><li>  Application Deployment Version <code>1.0.0</code> mit <code>v1</code> Datenbankschema (Spaltenname = <code>last_name</code> ) </li><li>  <code>last_name</code> die Anwendungsversion <code>2.0.0,</code> <code>last_name</code> <code>2.0.0,</code> der Daten in <code>last_name</code> und <code>surname</code> <code>last_name</code> .  Die Anwendung liest aus <code>last_name</code> .  Die Datenbank ist in Version <code>v2</code> , die die Spalten <code>last_name</code> und <code>surname. surname</code>  <code>surname. surname</code> ist eine Kopie von l <code>ast_name</code> .  (HINWEIS: Diese Spalte darf keine Nicht-Null-Einschränkung enthalten.) </li><li>  Bereitstellung einer Anwendung der Version <code>3.0.0</code> , bei der Daten nur im <code>surname</code> gespeichert und vom Nachnamen gelesen werden.  Wie bei der Datenbank erfolgt die letzte Migration von <code>last_name</code> zu <code>surname</code> .  Außerdem wird die <strong>NOT NULL-Einschränkung</strong> aus <code>last_name</code> .  DB ist jetzt in der Version <code>v3</code> </li><li>  Application Deployment Version <code>4.0.0</code> - Es werden keine Änderungen am Code vorgenommen.  Stellen Sie eine <code>v4</code> Datenbank <code>last_name</code> , die den <code>last_name</code> entfernt.  Hier können Sie fehlende Einschränkungen zur Datenbank hinzufügen. </li></ol><br><p>  Nach diesem Ansatz können Sie immer eine Version zurücksetzen, ohne die Datenbank- / Anwendungskompatibilität zu beeinträchtigen. </p><br><h3 id="kod">  Code </h3><br><p>  Der gesamte in diesem Artikel verwendete Code ist auf <a href="https://github.com/spring-cloud-samples/zero-downtime-deployment">Github</a> verfügbar.  Unten finden Sie eine zusätzliche Beschreibung. </p><br><h3 id="proekty">  Projekte </h3><br><p>  Nach dem Klonen des Repositorys wird die folgende Ordnerstruktur angezeigt. </p><br><pre> <code class="plaintext hljs">├── boot-flyway-v1 - 1.0.0 version of the app with v1 of the schema ├── boot-flyway-v2 - 2.0.0 version of the app with v2 of the schema (backward-compatible - app can be rolled back) ├── boot-flyway-v2-bad - 2.0.0.BAD version of the app with v2bad of the schema (backward-incompatible - app cannot be rolled back) ├── boot-flyway-v3 - 3.0.0 version of the app with v3 of the schema (app can be rolled back) └── boot-flyway-v4 - 4.0.0 version of the app with v4 of the schema (app can be rolled back)</code> </pre> <br><h3 id="skripty">  </h3><br><p>    ,    ,         . </p><br><p>   <strong>    </strong> , : </p><br><pre> <code class="plaintext hljs">./scripts/scenario_backward_compatible.sh</code> </pre> <br><p>    <strong>    </strong> , : </p><br><pre> <code class="plaintext hljs">./scripts/scenario_backward_incompatible.sh</code> </pre> <br><h3 id="spring-boot-sample-flyway"> Spring Boot Sample Flyway </h3><br><p>     <code>Spring Boot Sample Flyway.</code> </p><br><p>     <code>http://localhost:8080/flyway</code> ,   . </p><br><p>        H2 (  <code>http://localhost:8080/h2-console</code> ),        (URL jdbc   — <code>jdbc:h2:mem:testdb</code> ). </p><br><h2 id="dopolnitelno">  Optional </h2><br><ul><li> <a href="https://databaserefactoring.com/">Database Refactoring patterns</a> </li><li> <a href="https://martinfowler.com/bliki/ContinuousDelivery.html">Continuous Delivery</a> </li></ul><br><h2 id="takzhe-chitayte-drugie-stati-v-nashem-bloge">  Lesen Sie auch andere Artikel in unserem Blog: </h2><br><ul><li>  <a href="https://habr.com/ru/company/nixys/blog/480072/">Kubernetes: Warum ist es so wichtig, ein Systemressourcenmanagement einzurichten?</a> </li><li>  <a href="https://habr.com/ru/company/nixys/blog/481992/">Tekton-Pipeline - Kubernetes-native Pipelines</a> </li><li>  <a href="https://habr.com/ru/company/nixys/blog/473578/">Erstellen dynamischer Module für Nginx</a> </li><li>  <a href="https://habr.com/ru/company/nixys/blog/473014/">Einführung in die Kubernetes-Autorisierung von Hashicorp Consul</a> </li><li>  <a href="https://habr.com/ru/company/nixys/blog/468779/">Was war das Ergebnis der Migration von ClickHouse ohne Berechtigung zu ClickHouse mit Berechtigung?</a> </li><li>  <a href="https://habr.com/ru/company/nixys/blog/470568/">Blaugrüne Bereitstellung von Spring-Anwendungen mit Nginx Web Server</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de481932/">https://habr.com/ru/post/de481932/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de481916/index.html">Woran hat sich das Jahr 2019 in der Entwicklung erinnert?</a></li>
<li><a href="../de481922/index.html">Neujahr IMaskjs 6 - Reagieren Sie Native, Pipes, ESM</a></li>
<li><a href="../de481924/index.html">Apache Spark, Lazy Evaluation und mehrseitige SQL-Abfragen</a></li>
<li><a href="../de481926/index.html">Lernen Sie die neue Veeam Backup for AWS-Lösung kennen</a></li>
<li><a href="../de481930/index.html">Entwicklungskultur: Wie Leistung und Effizienz bewertet werden</a></li>
<li><a href="../de481934/index.html">Analyse: Warum der Kurs der Tesla-Aktie steigt</a></li>
<li><a href="../de481936/index.html">Vor- und Nachteile von A / B-Tests: Erfahrung großer Unternehmen</a></li>
<li><a href="../de481940/index.html">Schnelle und effektive Arbeit in der Kommandozeile</a></li>
<li><a href="../de481942/index.html">Zurück in die Zukunft: Welche modernen Spiele wurden 2010 vorgestellt?</a></li>
<li><a href="../de481944/index.html">Was bestimmt die Position der Site auf der Suchseite?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>