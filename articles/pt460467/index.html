<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÉ üòõ üÖ±Ô∏è Estamos procurando uma avaria no carro pelo som: pedimos um pouco de aprendizado de m√°quina para encontrar anomalias no motor üßô üïó ‚≠ïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Na escola, eu tinha um colega de classe que podia ouvir como o carro funciona no quintal e, com uma cara s√©ria, faz um veredicto: tudo est√° em ordem, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Estamos procurando uma avaria no carro pelo som: pedimos um pouco de aprendizado de m√°quina para encontrar anomalias no motor</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460467/"><p>  Na escola, eu tinha um colega de classe que podia ouvir como o carro funciona no quintal e, com uma cara s√©ria, faz um veredicto: tudo est√° em ordem, ou algo est√° quebrado, e eu preciso correr com urg√™ncia para novas pe√ßas / √≥leo / ferramentas!  Eu, como um bule de ch√° absoluto no setor automotivo, sempre ouvia o barulho habitual do pr√≥ximo dvenashka, sem perceber nenhuma diferen√ßa e apenas me maravilhando silenciosamente com sua audi√ß√£o e habilidades. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/te/rg/mw/tergmw8wjcwkvmcv5cuog4arfms.png"></div><br><p> Agora eu n√£o entendi melhor o interior do carro, mas comecei a trabalhar com o processamento de sinais sonoros e aprendizado de m√°quina, e aqui tentaremos entender se √© poss√≠vel ensinar um computador a detectar anormalidades no som de um motor? </p><br><p>  No m√≠nimo, √© interessante verificar e, no futuro, essa tecnologia poder√° economizar muito dinheiro para os propriet√°rios de autom√≥veis.  Pelo menos na minha opini√£o, falhas cr√≠ticas ocorrem gradualmente sob o cap√¥ e, nos est√°gios iniciais, muitas delas podem ser ouvidas, consertadas de forma r√°pida e barata, economizando tempo, dinheiro e nervos j√° inst√°veis. </p><br><p>  Bem, talvez seja hora de passar de palavras para a√ß√µes.  Vamos l√°! </p><a name="habracut"></a><br><p>  Quero dizer imediatamente que em tudo que diz respeito a matem√°tica e algoritmos, colocarei mais √™nfase no significado e no entendimento, n√£o haver√° f√≥rmulas e c√°lculos matem√°ticos aqui.  N√£o desenvolvi nenhum novo algoritmo aqui; para f√≥rmulas, se desejar, √© melhor pesquisar no Google e na Wikipedia, al√©m de usar os links que deixarei ao longo do artigo. </p><br><p>  Vou dar todas as explica√ß√µes sobre o exemplo do som de um mecanismo quebrado, retirado deste <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">v√≠deo no YouTube</a> . </p><br><p>  O arquivo baixado do YouTube (voc√™ pode baix√°-lo usando extens√µes do navegador ou simplesmente alterando o link do youtube para ssyoutube) convertemos para o formato wav usando ffmpeg: </p><br><pre><code class="plaintext hljs">ffmpeg -i input_video.mp4 -c:a pcm_s16le -ar 16000 -ac 1 engine_sound.wav</code> </pre> <br><p>  Antes de come√ßar a processar este arquivo, vou dizer algumas palavras sobre o que √© um espectrograma e como ele ser√° √∫til para resolver esse problema.  Muitos de voc√™s, com certeza, viram uma imagem semelhante - esta √© a representa√ß√£o amplitude-temporal do som ou um oscilograma. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jg/7i/he/jg7ihe-rdu0xfe64fncvtkkutp4.png"></div><br><p>  Se, em termos simples, o som √© uma onda, e os valores de amplitude dessa onda s√£o observados no oscilograma em determinados momentos. </p><br><p>  Para obter um espectrograma de tal representa√ß√£o, precisamos da transformada de Fourier.  Com sua ajuda, voc√™ pode obter a representa√ß√£o em amplitude-frequ√™ncia do som ou o espectro de amplitude.  Esse espectro mostra em que frequ√™ncia e com que amplitude o sinal em estudo √© expresso. </p><br><p>  De fato, um espectrograma √© um conjunto de espectros de pequenas partes consecutivas de um sinal.  Talvez essa "defini√ß√£o" seja suficiente para n√£o nos distrairmos muito da tarefa.  Tudo ficar√° mais claro se voc√™ observar a visualiza√ß√£o do espectrograma (a imagem foi obtida usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">WaveAssistant</a> ).  O tempo √© plotado no eixo X, a frequ√™ncia no eixo Y, ou seja, cada coluna nesta matriz √© o m√≥dulo do espectro em um determinado ponto no tempo. </p><br><p><img src="https://habrastorage.org/webt/bd/tn/9k/bdtn9kffs19iv8ikvnyn0cg9bb0.png" alt="fragmento inicial do espectrograma de sinal"></p><br><p>  Este espectrograma mostra que o som do motor, na aus√™ncia de batidas, "parece" o mesmo e √© expresso em frequ√™ncias pr√≥ximas a 600, 1200, 2400 e 4800 Hz.  O som de uma batida que incomoda o propriet√°rio √© muito distinto na faixa de frequ√™ncia de 600 a 1200 Hz de 5 a 8 segundos.  Como a grava√ß√£o foi feita em condi√ß√µes bastante barulhentas na rua, esses ru√≠dos tamb√©m est√£o presentes no espectrograma, o que complica um pouco a nossa tarefa. </p><br><p>  No entanto, olhando para esse espectrograma, podemos dizer com seguran√ßa onde estava a batida e onde n√£o estava.  O computador n√£o tem olhos, portanto, precisamos selecionar um algoritmo que seja capaz de distinguir entre esse desvio (e de prefer√™ncia n√£o apenas ele), sujeito √† presen√ßa de ru√≠do na grava√ß√£o. </p><br><p>  Os espectrogramas podem ser calculados usando a biblioteca librosa da seguinte maneira: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> librosa.util <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> buf_to_float <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> librosa.core <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> stft <span class="hljs-comment"><span class="hljs-comment">#     import numpy as np from scipy.io import wavfile #    wav- def cut_wav(path_to_wav, start_time, end_time): sr, wav_data = wavfile.read(path_to_wav) return wav_data[int(sr * start_time): int(sr * end_time)] def get_stft(wav_data): feat = np.abs(stft(buf_to_float(wav_data), n_fft=fft_size, hop_length=fft_step)) #  -       return feat.T wav_path = './engine_sound.wav' train_features = [] #    , time_list -    for [ts, te] in time_list: wav_part = cut_wav(wav_path, ts, te) spec = get_stft(wav_part) train_features.append(spec) X_train = np.vstack(train_features) #     full_wav_data = wavfile.read(wav_path)[1] X_test = get_stft(full_wav_data)</span></span></code> </pre> <br><h1 id="reshenie">  Solu√ß√£o </h1><br><p>  A rigor, precisamos resolver o problema de classifica√ß√£o bin√°ria, onde precisamos determinar se o motor est√° com defeito ou se est√° funcionando normalmente.  Meu colega e eu j√° descrevemos tarefas semelhantes em nosso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo anterior</a> , onde usamos uma rede neural convolucional para classificar eventos ac√∫sticos.  Aqui, essa solu√ß√£o dificilmente √© poss√≠vel: os neur√¥nios gostam muito quando recebem grandes conjuntos de dados.  Estamos lidando com um √∫nico recuo que dura um pouco mais de um minuto, o que obviamente n√£o pode ser chamado de um grande conjunto de dados. </p><br><p>  A escolha foi interrompida no Modelo de Mistura Gaussiana (modelo de misturas Gaussianas).  Um bom artigo detalhando o princ√≠pio de opera√ß√£o e treinamento deste modelo pode ser encontrado aqui.A id√©ia geral desse modelo √© descrever os dados usando uma distribui√ß√£o complexa na forma de uma combina√ß√£o linear de v√°rias distribui√ß√µes normais multidimensionais (mais sobre a distribui√ß√£o normal multidimensional <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> ). </p><br><p>  Como o mecanismo durante sua opera√ß√£o soa aproximadamente ‚Äúo mesmo‚Äù, o som de sua opera√ß√£o pode ser considerado estacion√°rio, e a ideia de descrever esse som usando essa distribui√ß√£o parece bastante significativa.  Para entender a ess√™ncia do GMM, eu recomendo olhar um exemplo de treinamento e escolher o n√∫mero de gaussoids <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </p><br><p>  Nosso caso difere dos exemplos acima, pois, em vez de pontos em um plano bidimensional, ser√£o utilizados os valores do espectro retirados do espectrograma de sinal.  Voc√™ pode selecionar par√¢metros de distribui√ß√£o, como o tipo de matriz de covari√¢ncia, usando o crit√©rio BIC ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">exemplo</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">descri√ß√£o</a> ); no entanto, no meu caso, os par√¢metros ideais do ponto de vista desse crit√©rio mostraram-se piores do que aqueles mostrados no c√≥digo abaixo: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.mixture <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> GaussianMixture n_components = <span class="hljs-number"><span class="hljs-number">3</span></span> gmm_clf = GaussianMixture(n_components) gmm_clf.fit(X_train)</code> </pre> <br><p>  Assumindo que o som da opera√ß√£o normal seja descrito por uma distribui√ß√£o, cujos par√¢metros foram selecionados durante o processo de treinamento, √© poss√≠vel medir a proximidade de qualquer som a essa distribui√ß√£o. </p><br><p>  Para fazer isso, voc√™ pode calcular a probabilidade m√©dia das colunas do espectrograma do sinal estudado e escolher um limite que separar√° a probabilidade de sons de bom trabalho de todos os outros.  A credibilidade para cada segundo √© a seguinte: </p><br><pre> <code class="python hljs">n_seconds = len(full_wav_data) // sr gmm_scores = [] <span class="hljs-comment"><span class="hljs-comment">#     for i in range(n_seconds - 1): test_sec = X_test[(i * sr) // fft_step: ((i + 1) * sr) // fft_step, :] sc = gmm_clf.score(test_sec) gmm_scores.append(sc)</span></span></code> </pre> <br><p>  Se voc√™ exibir a probabilidade obtida no gr√°fico, obteremos a seguinte imagem. <br>  A parte superior mostra o espectrograma do sinal exibido usando a biblioteca matplotlib.  As altera√ß√µes causadas por batidas n√£o s√£o vis√≠veis tanto quanto no exemplo acima (e √© por isso que voc√™ viu duas imagens aqui).  No entanto, se voc√™ olhar de perto, eles ainda podem ser vistos.  As linhas verticais marcam os hor√°rios de in√≠cio e t√©rmino da batida. </p><br><p><img src="https://habrastorage.org/webt/yj/rw/gp/yjrwgpubihtsds-vxin8ilfbqp0.png"></p><br><h1 id="vyvody">  Conclus√µes </h1><br><p>  Como voc√™ pode ver no gr√°fico, no momento do som de uma batida, a probabilidade realmente caiu abaixo do limite, o que significa que poder√≠amos separar essas duas classes (trabalhando com e sem bater).  Mas devo dizer que esse valor est√° pr√≥ximo o suficiente do limiar e em √°reas onde a batida n√£o √© ouvida.  Isso ocorre porque ru√≠dos estranhos s√£o freq√ºentemente encontrados na grava√ß√£o, o que tamb√©m afeta a probabilidade. </p><br><p>  Adicionamos aqui o treinamento em apenas alguns segundos de som, condi√ß√µes prec√°rias de grava√ß√£o, e voc√™ j√° pode se surpreender ao saber que o experimento foi de algum modo bem-sucedido! </p><br><p>  Muito provavelmente, para aplicar esse m√©todo na pr√°tica e ter certeza de sua confiabilidade, voc√™ precisar√° gravar muito mais som e tamb√©m colocar o microfone bem, a fim de minimizar o ru√≠do que entra nas grava√ß√µes. </p><br><p>  Este artigo √© apenas uma tentativa de resolver um problema semelhante, sem reivindicar corre√ß√£o absoluta, se voc√™ tiver id√©ias e sugest√µes, ou talvez perguntas, vamos discuti-las juntos nos coment√°rios ou pessoalmente. </p><br><p>  O c√≥digo completo do github est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt460467/">https://habr.com/ru/post/pt460467/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt460457/index.html">Esta√ß√£o de energia solar DIY 200 m2</a></li>
<li><a href="../pt460459/index.html">Arquivo de configura√ß√£o htaccess</a></li>
<li><a href="../pt460461/index.html">Simula√ß√£o de ataques direcionados como uma avalia√ß√£o de seguran√ßa. Instru√ß√µes de Cyber ‚Äã‚Äãdo Teaming vermelho</a></li>
<li><a href="../pt460463/index.html">O que aconteceu com o GALILEO - Vers√£o do Programador GNSS</a></li>
<li><a href="../pt460465/index.html">Sombras digitais - ajuda a reduzir os riscos digitais com compet√™ncia</a></li>
<li><a href="../pt460469/index.html">No√ß√µes b√°sicas de proxy transparente usando 3proxy e iptables / netfilter ou como "deixar tudo passar por um proxy"</a></li>
<li><a href="../pt460471/index.html">Erros do painel do administrador ou experi√™ncia em desenvolvimento do Laravel Orchid</a></li>
<li><a href="../pt460473/index.html">Ru√≠do branco desenha um quadrado preto</a></li>
<li><a href="../pt460475/index.html">Lifebuoy m√≥vel de controle remoto</a></li>
<li><a href="../pt460479/index.html">E o ursinho de pel√∫cia parece estar muito carregado</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>