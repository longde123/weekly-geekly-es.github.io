<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ»â€ğŸ¤â€ğŸ‘¨ğŸ¼ ğŸ§–ğŸ½ ğŸ‘¨ğŸ¼â€ğŸš’ ä½¿ç”¨Apache Kafkaçš„åŒæ­¥è¯·æ±‚-å“åº” ğŸ‘¨ğŸ¿ ğŸ¥š ğŸ“¡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æ€»ä½“è€Œè¨€ï¼Œ äº‹ä»¶é©±åŠ¨æ¶æ„ ï¼Œå°¤å…¶æ˜¯Apache Kafka ï¼Œæœ€è¿‘å¼•èµ·äº†å¾ˆå¤šå…³æ³¨ã€‚ ä¸ºäº†å……åˆ†åˆ©ç”¨äº‹ä»¶é©±åŠ¨çš„ä½“ç³»ç»“æ„ï¼Œäº‹ä»¶å§”æ‰˜æœºåˆ¶å¿…é¡»å®è´¨ä¸Šæ˜¯å¼‚æ­¥çš„ã€‚ ä½†æ˜¯ï¼Œå¯èƒ½å­˜åœ¨ä¸€äº›ç‰¹å®šçš„ä½¿ç”¨åœºæ™¯/æµç¨‹ï¼Œè¿™äº›åœºæ™¯/æµç¨‹éœ€è¦ä½¿ç”¨Synchronous Request-Responseçš„è¯­ä¹‰ã€‚ æ­¤ç‰ˆæœ¬æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨Apache Kafkaçš„åŒæ­¥è¯·æ±‚-å“åº”</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476156/">æ€»ä½“è€Œè¨€ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äº‹ä»¶é©±åŠ¨æ¶æ„</a> ï¼Œå°¤å…¶æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Apache Kafka</a> ï¼Œæœ€è¿‘å¼•èµ·äº†å¾ˆå¤šå…³æ³¨ã€‚ ä¸ºäº†å……åˆ†åˆ©ç”¨äº‹ä»¶é©±åŠ¨çš„ä½“ç³»ç»“æ„ï¼Œäº‹ä»¶å§”æ‰˜æœºåˆ¶å¿…é¡»å®è´¨ä¸Šæ˜¯å¼‚æ­¥çš„ã€‚ ä½†æ˜¯ï¼Œå¯èƒ½å­˜åœ¨ä¸€äº›ç‰¹å®šçš„ä½¿ç”¨åœºæ™¯/æµç¨‹ï¼Œè¿™äº›åœºæ™¯/æµç¨‹éœ€è¦ä½¿ç”¨<b>Synchronous Request-Response</b>çš„è¯­ä¹‰ã€‚ æ­¤ç‰ˆæœ¬æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨<b>Apache Kafka</b>å®ç°<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¯·æ±‚-å“åº”</a></b> ã€‚ <br><br> ç”±<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">@middle_java</a></b>ç¿»è¯‘ <br><a name="habracut"></a><br> åŸå§‹æ–‡ç« æ—¥æœŸï¼š2018å¹´10æœˆ26æ—¥ <br><br>  Apache Kafkaæœ¬è´¨ä¸Šæ˜¯å¼‚æ­¥çš„ã€‚ å› æ­¤ï¼ŒApache Kafka <b>çš„è¯·æ±‚-å“åº”</b>è¯­ä¹‰æ˜¯ä¸è‡ªç„¶çš„ã€‚ ä½†æ˜¯ï¼Œè¿™ä¸€æŒ‘æˆ˜å¹¶ä¸æ–°é²œã€‚ ä¼ä¸šé›†æˆæ¨¡å¼<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¯·æ±‚-åº”ç­”</a></b>ä¸ºå¼‚æ­¥é€šé“ä¸Šçš„åŒæ­¥æ¶ˆæ¯ä¼ é€’æä¾›äº†ä¸€ç§è¡Œä¹‹æœ‰æ•ˆçš„æœºåˆ¶ï¼š <br><br><img src="https://habrastorage.org/webt/ww/cy/0h/wwcy0hvrj6iie7amwxpk1twfbui.gif"><br><br>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Return Address</a></b>æ¨¡å¼ç”¨ä¸€ç§æœºåˆ¶æ¥è¡¥å……<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Request-Reply</a></b>æ¨¡å¼ï¼Œè¯¥æœºåˆ¶ä½¿è¯·æ±‚è€…å¯ä»¥æŒ‡ç¤ºå°†å“åº”å‘é€åˆ°çš„åœ°å€ï¼š <br><br><img src="https://habrastorage.org/webt/rw/nd/qq/rwndqqxh42kt82xadcbvgjb76wa.gif"><br><br> æœ€è¿‘ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Spring Kafka</a> <b>2.1.3</b>å¢åŠ äº†æ¥è‡ªRequest Requestæ¨¡å¼æ¡†çš„æ”¯æŒï¼Œåœ¨<b>2.2</b>ç‰ˆä¸­ï¼Œå®ƒçš„ä¸€äº›ç²—ç³™åº¦è¢«æŠ›å…‰ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹è¿™ç§æ”¯æŒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š <br><br><h2> å®¢æˆ·ç«¯ï¼šReplyingKafkaTemplate </h2><br>  <b>æ¨¡æ¿</b>çš„ä¼—æ‰€å‘¨çŸ¥çš„æŠ½è±¡æ„æˆäº†Springä¸­Request-Replyæœºåˆ¶çš„å®¢æˆ·ç«¯éƒ¨åˆ†çš„åŸºç¡€ã€‚ <br><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ReplyingKafkaTemplate &lt; String, Request, Reply &gt; replyKafkaTemplate( ProducerFactory &lt; String, Request &gt; pf, KafkaMessageListenerContainer &lt; String, Reply &gt; lc) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ReplyingKafkaTemplate &lt; &gt; (pf, lc); }</code> </pre> <br> è¿™é‡Œçš„ä¸€åˆ‡éƒ½éå¸¸ç®€å•ï¼šæˆ‘ä»¬è®¾ç½®äº†<b>ReplyingKafkaTemplate</b> ï¼Œå®ƒä½¿ç”¨Stringé”®å‘é€è¯·æ±‚æ¶ˆæ¯ï¼Œå¹¶ä½¿ç”¨Stringé”®æ¥æ”¶å“åº”æ¶ˆæ¯ã€‚ ä½†æ˜¯ï¼ŒReplyingKafkaTemplateå¿…é¡»åŸºäºå…·æœ‰é€‚å½“ä½¿ç”¨è€…å’Œç”Ÿäº§è€…é…ç½®çš„ProducerFactoryè¯·æ±‚ï¼ŒConsumerFactoryå“åº”å’ŒMessageListenerContainerã€‚ å› æ­¤ï¼Œæ‰€éœ€çš„é…ç½®éå¸¸é‡è¦ï¼š <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Value</span></span>(<span class="hljs-string"><span class="hljs-string">"${kafka.topic.car.reply}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String replyTopic; <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Map &lt; String, Object &gt; consumerConfigs() { Map &lt; String, Object &gt; props = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap &lt; &gt; (); props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers); props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class); props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, JsonDeserializer.class); props.put(ConsumerConfig.GROUP_ID_CONFIG, groupId); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> props; } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Map &lt; String, Object &gt; producerConfigs() { Map &lt; String, Object &gt; props = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap &lt; &gt; (); props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers); props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class); props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, JsonSerializer.class); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> props; } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ProducerFactory &lt; String, Request &gt; requestProducerFactory() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultKafkaProducerFactory &lt; &gt; (producerConfigs()); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ConsumerFactory &lt; String, Reply &gt; replyConsumerFactory() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultKafkaConsumerFactory &lt; &gt; (consumerConfigs(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringDeserializer(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JsonSerializer &lt; Reply &gt; ()); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> KafkaMessageListenerContainer &lt; String, Reply &gt; replyListenerContainer() { ContainerProperties containerProperties = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ContainerProperties(replyTopic); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> KafkaMessageListenerContainer &lt; &gt; (replyConsumerFactory(), containerProperties); }</code> </pre> <br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨<b>replyKafkaTemplate</b>å‘é€åŒæ­¥è¯·æ±‚å¹¶æ¥æ”¶å“åº”å¦‚ä¸‹ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Value</span></span>(<span class="hljs-string"><span class="hljs-string">"${kafka.topic.car.request}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String requestTopic; <span class="hljs-meta"><span class="hljs-meta">@Value</span></span>(<span class="hljs-string"><span class="hljs-string">"${kafka.topic.car.reply}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String replyTopic; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ReplyingKafkaTemplate &lt; String, Request, Reply &gt; requestReplyKafkaTemplate; ... RequestReply request = RequestReply.request(...); <span class="hljs-comment"><span class="hljs-comment">// producer record ProducerRecord &lt; String, Request &gt; record = new ProducerRecord &lt; String, Request &gt; (requestTopic, request); //       record.headers().add(new RecordHeader(KafkaHeaders.REPLY_TOPIC, requestReplyTopic.getBytes())); //     Kafka          RequestReplyFuture &lt; String, Request, Reply &gt; sendAndReceive = requestReplyKafkaTemplate.sendAndReceive(record); sendAndReceive.addCallback(new ListenableFutureCallback &lt; ConsumerRecord &lt; String, Reply &gt;&gt; () { @Override public void onSuccess(ConsumerRecord &lt; String, Reply &gt; result) { //   consumer record Reply reply = result.value(); System.out.println("Reply: " + reply.toString()); } });</span></span></code> </pre> <br> è¿˜æœ‰å¾ˆå¤šæ ·æ¿æ–‡ä»¶å’Œä¸€ä¸ªä½çº§APIï¼Œç”šè‡³æ˜¯è¿™ä¸ªè¿‡æ—¶çš„<b>ListenableFuture</b> APIï¼Œè€Œä¸æ˜¯ç°ä»£çš„<b>CompletableFuture</b> ã€‚ <br><br>  <b>requestReplyKafkaTemplate</b>è´Ÿè´£ç”Ÿæˆå’Œè®¾ç½®<b>KafkaHeaders.CORRELATION_ID</b>æ ‡å¤´ï¼Œä½†æ˜¯æˆ‘ä»¬å¿…é¡»ä¸ºè¯·æ±‚æ˜¾å¼è®¾ç½®<b>KafkaHeaders.REPLY_TOPIC</b>æ ‡å¤´ã€‚ å¦è¯·æ³¨æ„ï¼Œåœ¨<b>replyListenerContainerä¸­</b> ï¼Œç­”æ¡ˆçš„åŒä¸€ä¸»é¢˜å¤ªæ— æ„äº†ã€‚ ç³Ÿé€äº† ä¸å®Œå…¨ç¬¦åˆæˆ‘å¯¹SpringæŠ½è±¡çš„æœŸæœ›ã€‚ <br><br><h2> æœåŠ¡å™¨ç«¯ï¼š@SendTo </h2><br> åœ¨æœåŠ¡å™¨ç«¯ï¼Œé€šå¸¸åœ¨<b>KafkaListenerä¸Š</b>ä¾¦å¬è¯·æ±‚ä¸»é¢˜çš„åœ°æ–¹è¿˜é™„åŠ äº†<b>@SendTo</b>æ‰¹æ³¨ï¼Œä»¥æä¾›å“åº”æ¶ˆæ¯ã€‚ ç”±ä¾¦å¬å™¨æ–¹æ³•è¿”å›çš„å¯¹è±¡å°†è‡ªåŠ¨åŒ…è£…åœ¨å“åº”æ¶ˆæ¯ä¸­ï¼Œæ·»åŠ <b>CORRELATION_IDï¼Œ</b>å¹¶å°†å“åº”å‘å¸ƒåœ¨<b>REPLY_TOPIC</b>æ ‡å¤´ä¸­æŒ‡å®šçš„ä¸»é¢˜ä¸­ã€‚ <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Map &lt; String, Object &gt; consumerConfigs() { Map &lt; String, Object &gt; props = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap &lt; &gt; (); props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers); props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class); props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, JsonSerializer.class); props.put(ConsumerConfig.GROUP_ID_CONFIG, groupId); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> props; } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Map &lt; String, Object &gt; producerConfigs() { Map &lt; String, Object &gt; props = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap &lt; &gt; (); props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers); props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class); props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, JsonSerializer.class); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> props; } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ConsumerFactory &lt; String, Request &gt; requestConsumerFactory() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultKafkaConsumerFactory &lt; &gt; (consumerConfigs(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringDeserializer(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JsonSerializer &lt; Request &gt; ()); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> KafkaListenerContainerFactory &lt; ConcurrentMessageListenerContainer &lt; String, Request &gt;&gt; requestListenerContainerFactory() { ConcurrentKafkaListenerContainerFactory &lt; String, Request &gt; factory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentKafkaListenerContainerFactory &lt; &gt; (); factory.setConsumerFactory(requestConsumerFactory()); factory.setReplyTemplate(replyTemplate()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> factory; } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ProducerFactory &lt; String, Reply &gt; replyProducerFactory() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultKafkaProducerFactory &lt; &gt; (producerConfigs()); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> KafkaTemplate &lt; String, Reply &gt; replyTemplate() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> KafkaTemplate &lt; &gt; (replyProducerFactory()); }</code> </pre> <br> è¿™é‡Œä¹Ÿéœ€è¦ä¸€äº›é…ç½®ï¼Œä½†æ˜¯ä¾¦å¬å™¨é…ç½®æ›´ç®€å•ï¼š <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@KafkaListener</span></span>(topics = <span class="hljs-string"><span class="hljs-string">"${kafka.topic.car.request}"</span></span>, containerFactory = <span class="hljs-string"><span class="hljs-string">"requestListenerContainerFactory"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@SendTo</span></span>() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Reply </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">receive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Request request)</span></span></span><span class="hljs-function"> </span></span>{ Reply reply = ...; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> reply; }</code> </pre> <br><h2> ä½†æ˜¯æ¶ˆè´¹è€…çš„å¤šä¸ªå®ä¾‹å‘¢ï¼Ÿ </h2><br> ç›´åˆ°æˆ‘ä»¬ä½¿ç”¨äº†å¤šä¸ªæ¶ˆè´¹è€…å®ä¾‹ï¼Œä¸€åˆ‡ä¼¼ä¹éƒ½å¯ä»¥æ­£å¸¸å·¥ä½œã€‚ å¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ªå®¢æˆ·ç«¯å®ä¾‹ï¼Œåˆ™éœ€è¦ç¡®ä¿å°†å“åº”å‘é€åˆ°æ­£ç¡®çš„å®¢æˆ·ç«¯å®ä¾‹ã€‚  Spring Kafkaæ–‡æ¡£å‡å®šæ¯ä¸ªä½¿ç”¨è€…éƒ½å¯ä»¥ä½¿ç”¨å”¯ä¸€çš„ä¸»é¢˜ï¼Œæˆ–è€…éšè¯·æ±‚ä¸€èµ·å‘é€é™„åŠ çš„<b>KafkaHeaders</b>æ ‡å¤´å€¼<b>RESPONSE_PARTITION</b>æ˜¯ä¸€ä¸ªå››å­—èŠ‚å­—æ®µï¼Œå…¶ä¸­åŒ…å«æ•´æ•°éƒ¨åˆ†ç¼–å·çš„BIG-ENDIANè¡¨ç¤ºå½¢å¼ã€‚ ä¸ºä¸åŒçš„å®¢æˆ·ä½¿ç”¨å•ç‹¬çš„ä¸»é¢˜æ˜¾ç„¶ä¸æ˜¯å¾ˆçµæ´»ï¼Œå› æ­¤æˆ‘ä»¬é€‰æ‹©æ˜¾å¼çš„<b>REPLY_PARTITION</b>è®¾ç½®ã€‚ ç„¶åï¼Œå®¢æˆ·ç«¯åº”çŸ¥é“å°†å…¶åˆ†é…ç»™å“ªä¸ªåˆ†åŒºã€‚ è¯¥æ–‡æ¡£å»ºè®®ä½¿ç”¨æ˜¾å¼é…ç½®æ¥é€‰æ‹©ç‰¹å®šåˆ†åŒºã€‚ è®©æˆ‘ä»¬å°†å…¶æ·»åŠ åˆ°æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼š <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Value</span></span>(<span class="hljs-string"><span class="hljs-string">"${kafka.topic.car.reply.partition}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> replyPartition; ... <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> KafkaMessageListenerContainer &lt; String, RequestReply &gt; replyListenerContainer() { ContainerProperties containerProperties = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ContainerProperties(replyTopic); TopicPartitionInitialOffset initialOffset = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TopicPartitionInitialOffset(replyTopic, replyPartition); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> KafkaMessageListenerContainer &lt; &gt; (replyConsumerFactory(), containerProperties, initialOffset); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] intToBytesBigEndian(<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> data) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] { (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)((data &gt;&gt; <span class="hljs-number"><span class="hljs-number">24</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)((data &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)((data &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)((data &gt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>), }; } ... record.headers().add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RecordHeader(KafkaHeaders.REPLY_TOPIC, requestReplyTopic.getBytes())); record.headers().add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RecordHeader(KafkaHeaders.REPLY_PARTITION, intToBytesBigEndian(replyPartition))); RequestReplyFuture &lt; String, RequestReply, RequestReply &gt; sendAndReceive = requestReplyKafkaTemplate.sendAndReceive(record); ...</code> </pre> <br> ä¸æ˜¯å¾ˆæ¼‚äº®ï¼Œä½†æ˜¯å¯ä»¥ã€‚ æ‰€éœ€çš„é…ç½®å¹¿æ³›ï¼ŒAPIçœ‹èµ·æ¥å¾ˆåº•å±‚ã€‚ æ˜¾å¼é…ç½®åˆ†åŒºçš„éœ€æ±‚ä½¿åŠ¨æ€æ‰©å±•å®¢æˆ·ç«¯æ•°é‡çš„è¿‡ç¨‹å˜å¾—å¤æ‚ã€‚ æ˜¾ç„¶ï¼Œæ‚¨å¯ä»¥åšå¾—æ›´å¥½ã€‚ <br><br><h2> å°è£…ä¸»é¢˜å¤„ç†ä»¥è¿›è¡Œå“åº”å’Œåˆ†åŒº </h2><br> è®©æˆ‘ä»¬ä»å°è£…â€œ <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿”å›åœ°å€â€</a></b>æ¨¡å¼å¼€å§‹ï¼Œç„¶åä¼ é€’å“åº”å’Œåˆ†åŒºçš„ä¸»é¢˜ã€‚ å“åº”çš„ä¸»é¢˜å¿…é¡»æ³¨å…¥<b>RequestReplyTemplateä¸­</b> ï¼Œå› æ­¤ï¼Œæ ¹æœ¬ä¸åº”è¯¥å‡ºç°åœ¨APIä¸­ã€‚ å½“æ¶‰åŠåˆ°ç­”æ¡ˆçš„åˆ†åŒºæ—¶ï¼Œæˆ‘ä»¬å°†æ‰§è¡Œç›¸åçš„æ“ä½œï¼šæå–åˆ†é…ç»™è¯¥ä¸»é¢˜ä¾¦å¬å™¨çš„ç­”æ¡ˆçš„åˆ†åŒºï¼Œç„¶åè‡ªåŠ¨è½¬ç§»è¯¥åˆ†åŒºã€‚ è¿™æ¶ˆé™¤äº†å®¢æˆ·ç«¯å¤„ç†è¿™äº›æ ‡å¤´çš„éœ€è¦ã€‚ <br> åŒæ—¶ï¼Œè®©æˆ‘ä»¬ä½¿APIçœ‹èµ·æ¥åƒæ ‡å‡†çš„<b>KafkaTemplate</b> ï¼ˆ <b>ä½¿ç”¨</b>ç®€åŒ–çš„å‚æ•°é‡è½½<b>sendAndReceiveï¼ˆï¼‰</b>æ–¹æ³•<b>ï¼Œ</b>å¹¶ä½¿ç”¨é»˜è®¤ä¸»é¢˜æ·»åŠ ç›¸åº”çš„é‡è½½æ–¹æ³•ï¼‰ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PartitionAwareReplyingKafkaTemplate</span></span></span><span class="hljs-class"> &lt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">K</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">V</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class"> &gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReplyingKafkaTemplate</span></span></span><span class="hljs-class"> &lt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">K</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">V</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class"> &gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PartitionAwareReplyingKafkaTemplate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ProducerFactory &lt; K, V &gt; producerFactory, GenericMessageListenerContainer &lt; K, R &gt; replyContainer)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(producerFactory, replyContainer); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> TopicPartition </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFirstAssignedReplyTopicPartition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getAssignedReplyTopicPartitions() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; getAssignedReplyTopicPartitions().iterator().hasNext()) { TopicPartition replyPartition = getAssignedReplyTopicPartitions().iterator().next(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.logger.isDebugEnabled()) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.logger.debug(<span class="hljs-string"><span class="hljs-string">"Using partition "</span></span> + replyPartition.partition()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> replyPartition; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> KafkaException(<span class="hljs-string"><span class="hljs-string">"Illegal state: No reply partition is assigned to this instance"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] intToBytesBigEndian(<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> data) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] { (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)((data &gt;&gt; <span class="hljs-number"><span class="hljs-number">24</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)((data &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)((data &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)((data &gt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>), }; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RequestReplyFuture &lt; K, V, R &gt; sendAndReceiveDefault(<span class="hljs-meta"><span class="hljs-meta">@Nullable</span></span> V data) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sendAndReceive(getDefaultTopic(), data); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RequestReplyFuture &lt; K, V, R &gt; sendAndReceiveDefault(K key, <span class="hljs-meta"><span class="hljs-meta">@Nullable</span></span> V data) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sendAndReceive(getDefaultTopic(), key, data); } ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RequestReplyFuture &lt; K, V, R &gt; sendAndReceive(String topic, <span class="hljs-meta"><span class="hljs-meta">@Nullable</span></span> V data) { ProducerRecord &lt; K, V &gt; record = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProducerRecord &lt; &gt; (topic, data); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> doSendAndReceive(record); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RequestReplyFuture &lt; K, V, R &gt; sendAndReceive(String topic, K key, <span class="hljs-meta"><span class="hljs-meta">@Nullable</span></span> V data) { ProducerRecord &lt; K, V &gt; record = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProducerRecord &lt; &gt; (topic, key, data); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> doSendAndReceive(record); } ... <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RequestReplyFuture &lt; K, V, R &gt; sendAndReceive(ProducerRecord &lt; K, V &gt; record) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> doSendAndReceive(record); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> RequestReplyFuture &lt; K, V, R &gt; doSendAndReceive(ProducerRecord &lt; K, V &gt; record) { TopicPartition replyPartition = getFirstAssignedReplyTopicPartition(); record.headers() .add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RecordHeader(KafkaHeaders.REPLY_TOPIC, replyPartition.topic().getBytes())) .add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RecordHeader(KafkaHeaders.REPLY_PARTITION, intToBytesBigEndian(replyPartition.partition()))); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.sendAndReceive(record); } }</code> </pre> <br> ä¸‹ä¸€æ­¥ï¼šä½¿<b>ListenableFuture</b>é€‚åº”æ›´ç°ä»£çš„<b>CompletableFuture</b> ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CompletableFutureReplyingKafkaTemplate</span></span></span><span class="hljs-class"> &lt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">K</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">V</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class"> &gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PartitionAwareReplyingKafkaTemplate</span></span></span><span class="hljs-class"> &lt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">K</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">V</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class"> &gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CompletableFutureReplyingKafkaTemplate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ProducerFactory &lt; K, V &gt; producerFactory, GenericMessageListenerContainer &lt; K, R &gt; replyContainer)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(producerFactory, replyContainer); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CompletableFuture &lt; R &gt; requestReplyDefault(V value) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> adapt(sendAndReceiveDefault(value)); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CompletableFuture &lt; R &gt; requestReplyDefault(K key, V value) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> adapt(sendAndReceiveDefault(key, value)); } ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CompletableFuture &lt; R &gt; requestReply(String topic, V value) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> adapt(sendAndReceive(topic, value)); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CompletableFuture &lt; R &gt; requestReply(String topic, K key, V value) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> adapt(sendAndReceive(topic, key, value)); } ... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CompletableFuture &lt; R &gt; adapt(RequestReplyFuture &lt; K, V, R &gt; requestReplyFuture) { CompletableFuture &lt; R &gt; completableResult = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CompletableFuture &lt; R &gt; () { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cancel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mayInterruptIfRunning)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> result = requestReplyFuture.cancel(mayInterruptIfRunning); <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.cancel(mayInterruptIfRunning); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } }; <span class="hljs-comment"><span class="hljs-comment">//       requestReplyFuture.getSendFuture().addCallback(new ListenableFutureCallback &lt; SendResult &lt; K, V &gt;&gt; () { @Override public void onSuccess(SendResult &lt; K, V &gt; sendResult) { // NOOP } @Override public void onFailure(Throwable t) { completableResult.completeExceptionally(t); } }); //     requestReplyFuture.addCallback(new ListenableFutureCallback &lt; ConsumerRecord &lt; K, R &gt;&gt; () { @Override public void onSuccess(ConsumerRecord &lt; K, R &gt; result) { completableResult.complete(result.value()); } @Override public void onFailure(Throwable t) { completableResult.completeExceptionally(t); } }); return completableResult; } }</span></span></code> </pre> <br> æˆ‘ä»¬å°†å…¶æ‰“åŒ…åˆ°ä¸€ä¸ªå®ç”¨ç¨‹åºåº“ä¸­ï¼Œç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªä¸Spring <b>çš„</b>ä¸»è¦è®¾è®¡ç†å¿µ<b>â€œ Convention over Configurationâ€</b>æ›´åŠ ä¸€è‡´çš„APIã€‚ è¿™æ˜¯æœ€ç»ˆçš„å®¢æˆ·ä»£ç ï¼š <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CompletableFutureReplyingKafkaTemplate &lt; String, Request, Reply &gt; requestReplyKafkaTemplate; ... requestReplyKafkaTemplate.requestReply(request).thenAccept(reply - &gt; System.out.println(<span class="hljs-string"><span class="hljs-string">"Reply: "</span></span> + reply.toString()); );</code> </pre> <br><h2> æ€»ç»“ä¸€ä¸‹ </h2><br> æ€»è€Œè¨€ä¹‹ï¼ŒSpring for Kafka 2.2åœ¨Apache Kafkaä¸­æä¾›äº†<b>Request-Reply</b>æ¨¡å¼çš„å…¨åŠŸèƒ½å®ç°ï¼Œä½†æ˜¯APIä»ç„¶æœ‰äº›ç²—ç³™ã€‚ åœ¨æœ¬æœŸä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°APIçš„ä¸€äº›å…¶ä»–æŠ½è±¡å’Œæ”¹ç¼–å¯ä»¥æä¾›æ›´åˆä¹é€»è¾‘çš„é«˜çº§APIã€‚ <br><br>  <b>è­¦å‘Š1ï¼š</b> <br> äº‹ä»¶é©±åŠ¨çš„ä½“ç³»ç»“æ„çš„ä¸»è¦ä¼˜ç‚¹ä¹‹ä¸€æ˜¯äº‹ä»¶äº§ç”Ÿè€…å’Œæ¶ˆè´¹è€…çš„è§£è€¦ï¼Œè¿™ä½¿å¾—åˆ›å»ºæ›´åŠ çµæ´»å’Œä¸æ–­å‘å±•çš„ç³»ç»Ÿæˆä¸ºå¯èƒ½ã€‚ å½“è¯·æ±‚æ–¹å’Œå“åº”æ–¹å¯†åˆ‡ç›¸å…³æ—¶ï¼Œä½¿ç”¨åŒæ­¥è¯­ä¹‰â€œè¯·æ±‚-å“åº”â€æ˜¯å®Œå…¨ç›¸åçš„ã€‚ å› æ­¤ï¼Œä»…åº”åœ¨å¿…è¦æ—¶ä½¿ç”¨ã€‚ <br><br>  <b>è­¦å‘Š2ï¼š</b> <br> å¦‚æœéœ€è¦<b>åŒæ­¥çš„Request-Response</b> ï¼Œé‚£ä¹ˆä¸ä½¿ç”¨<b>è¯¸å¦‚Apache Kafkaä¹‹ç±»çš„å¼‚æ­¥é€šé“</b>ç›¸æ¯”ï¼ŒåŸºäº<b>HTTP</b>çš„<b>åè®®</b>è¦ç®€å•å¾—å¤šä¸”æ•ˆç‡æ›´é«˜ã€‚ <br> ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œ <b>é€šè¿‡Kafka</b>è¿›è¡Œ<b>åŒæ­¥è¯·æ±‚-å“åº”</b>å¾ˆæœ‰æ„ä¹‰ã€‚ åˆç†åœ°é€‰æ‹©æœ€ä½³çš„å·¥ä½œå·¥å…·ã€‚ <br><br> å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github.com/callistaenterprise/blog-synchronous-kafka</a>æ‰¾åˆ°å®Œæ•´çš„å·¥ä½œç¤ºä¾‹ã€‚ <br><br><h2> ç•™è¨€ </h2><br>  <i>Federicoâ€¢7ä¸ªæœˆå‰</i> <br> å½“æˆ‘ä»¬æœ‰æ··åˆéœ€æ±‚æ—¶ï¼Œä¾‹å¦‚ï¼Œåœ¨50ï¼…çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è¯·æ±‚-å“åº”ï¼Œè€Œåœ¨50ï¼…çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦äº‹ä»¶ç®¡ç†ï¼Ÿ æˆ‘ä»¬è¯¥æ€ä¹ˆåšï¼Ÿ  Spring Kafkaæ‰€éœ€çš„é…ç½®çœ‹èµ·æ¥éå¸¸ç³Ÿç³•ã€‚ <br><br>  <i>Jehanzeb Qayyumâ€¢6ä¸ªæœˆå‰</i> <br> ç°åœ¨ï¼ŒSpringåœ¨å“åº”çš„ä¸€ä¸ªå¸¸è§ä¸»é¢˜ä¸­ä½¿ç”¨åˆ†åŒºæ¥æä¾›é»˜è®¤æ”¯æŒã€‚ <br><br> ä»ç‰ˆæœ¬2.2å¼€å§‹ï¼Œæ¨¡æ¿å°è¯•ä»å·²é…ç½®çš„å“åº”å®¹å™¨ï¼ˆç­”å¤å®¹å™¨ï¼‰ç¡®å®šå“åº”æˆ–åˆ†åŒºçš„ä¸»é¢˜ã€‚ <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://docs.spring.io/spring-kafka/reference/html/#replying-template</a> <br><br>  <i>å°¼å°”Â·ç½—æ£®ä¼¯æ ¼â€¢8ä¸ªæœˆå‰</i> <br> ä½ å¥½ <br> åœ¨ä¸Šä¸€æ®µä¸­ï¼Œæ‚¨å†™é“ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸HTTPç›¸æ¯”ï¼Œé€šè¿‡Kafkaè¿›è¡ŒåŒæ­¥çš„Request-Responseæœ‰æ„ä¹‰ã€‚ <br> ä½ èƒ½ä¸¾è¿™æ ·çš„ä¾‹å­å—ï¼Ÿ <br> è°¢è°¢å•¦ <br> å°¼å°” <br><br>  <i>Janne Keskitalo nir rozenbergâ€¢8ä¸ªæœˆå‰</i> <br> æˆ‘ä»¬å°†æŠŠä¸€ä¸ªå¤§å®¹é‡çš„äº¤æ˜“å¤„ç†ç³»ç»Ÿåˆ†æˆå‡ ä¸ªå¾®æœåŠ¡ï¼Œæˆ‘æœ‰ä¸€ä¸ªæƒ³æ³•ï¼Œå°±æ˜¯ä½¿ç”¨Kafkaçš„Request-Responseæ¶ˆæ¯ä¼ é€’æ¥å®ç°ç±»ä¼¼çš„å¤„ç†äº²å’ŒåŠ›ã€‚ åŸºæœ¬ä¸Šï¼ŒKafkaç”¨äºå°†æ‰€æœ‰å‘¼å«ä»ä¸€ä¸ªå®¢æˆ·ç«¯è·¯ç”±åˆ°åŒä¸€äº‹åŠ¡å¤„ç†å™¨è¿›ç¨‹ï¼Œç„¶åä¾æ¬¡ä¸€æ¬¡æ‰§è¡Œä¸€ä¸ªã€‚ è¿™ç§ç±»å‹çš„å¤„ç†å¯ç¡®ä¿çº¿æ€§åŒ–ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://stackoverflow.com/a/19515375/7430325</a> ï¼‰ï¼Œå› æœå…³ç³»ï¼Œå¹¶ä¸”è¿˜å¯ä»¥è¿›è¡Œæœ‰æ•ˆçš„ç¼“å­˜ã€‚ æœ¬è´¨ä¸Šï¼Œåè°ƒå·¥ä½œå°†ä»æ•°æ®åº“è½¬ç§»åˆ°Kafkaï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Serializableä¸¥æ ¼éš”ç¦»æ¨¡å¼ä¸‹å¯åŠ¨æ•°æ®åº“ã€‚ <br> æˆ‘è¿˜æ²¡æœ‰æ·±å…¥ç ”ç©¶äº‹åŠ¡è¯­ä¹‰çš„ç»†èŠ‚ï¼Œä»¥äº†è§£å®ƒçš„ä¸è¶³ä¹‹å¤„ï¼Œæ‰€ä»¥è¿™åªæ˜¯ä¸€ä¸ªä¸»æ„ã€‚ <br><br> ç”±<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">@middle_java</a></b>ç¿»è¯‘ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN476156/">https://habr.com/ru/post/zh-CN476156/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN476140/index.html">å¦‚æœæ‚¨çŸ¥é“7000ä¸ªå•è¯ä½†å¬ä¸æ‡‚ï¼Œè¯¥å¦‚ä½•æé«˜å¬åŠ›ï¼Ÿ</a></li>
<li><a href="../zh-CN476142/index.html">ä¸ºä»€ä¹ˆè¦é¿å…ä½¿ç”¨å¼‚å¸¸æ¥æ§åˆ¶Javaæµ</a></li>
<li><a href="../zh-CN476144/index.html">ä½¿ç”¨æˆ‘ç©â€œç§˜å¯†åœ£è¯è€äººâ€çš„æœºå™¨äººç¤ºä¾‹ï¼Œæ‚¨å¦‚ä½•ä»¥åŠä¸éœ€è¦ä¸ºæœºå™¨äººç¼–å†™èŠå¤©è®°å½•</a></li>
<li><a href="../zh-CN476146/index.html">å¦‚ä½•æ‰©å±•æ•°æ®ä¸­å¿ƒã€‚ YandexæŠ¥å‘Š</a></li>
<li><a href="../zh-CN476148/index.html">FreeBSDä¸Šçš„postfix + dovecot + mysql</a></li>
<li><a href="../zh-CN476160/index.html">æ•™è‚²è½¯ä»¶çš„è¯ç”ŸåŠå…¶å†å²ï¼šä»æœºæ¢°æœºå™¨åˆ°ç¬¬ä¸€å°è®¡ç®—æœº</a></li>
<li><a href="../zh-CN476162/index.html">æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç°ä»£çš„Webåº”ç”¨ç¨‹åºã€‚ ç†Ÿæ‚‰é¡¹ç›®å¹¶åšå¥½å·¥ä½œå‡†å¤‡ã€‚ ç¬¬ä¸€éƒ¨åˆ†</a></li>
<li><a href="../zh-CN476164/index.html">â€œè¿™ä¹Ÿæ˜¯æ•°æ®åˆ†æã€‚â€ ä¸Mikhail Gelfandè°ˆç”Ÿç‰©ä¿¡æ¯å­¦</a></li>
<li><a href="../zh-CN476166/index.html">â€œçœŸæ­£çš„é’¢é“ä¾ â€æ‰“ç ´äº†é£è¡Œé€Ÿåº¦çºªå½•</a></li>
<li><a href="../zh-CN476172/index.html">é»‘å¸½ç¾å›½ä¼šè®®ã€‚ è‡´å¯Œæˆ–ä¸§å‘½ï¼šä½¿ç”¨Black Hatåœ¨äº’è”ç½‘ä¸Šèµšé’±ã€‚ ç¬¬äºŒéƒ¨åˆ†</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>