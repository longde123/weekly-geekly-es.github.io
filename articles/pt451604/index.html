<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôåüèº üßùüèæ üî® Este artigo tem muita √°gua. ü•õ üèí üë©üèø‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúEstamos come√ßando a desenvolver um novo jogo e precisamos de √°gua fria. Voc√™ pode fazer isso? ‚Äù 


 - me perguntou. ‚ÄúSim, sem d√∫vida! Claro que posso...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Este artigo tem muita √°gua.</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451604/">  ‚ÄúEstamos come√ßando a desenvolver um novo jogo e precisamos de √°gua fria.  Voc√™ pode fazer isso? ‚Äù <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/iilqtDkeIBE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  - me perguntou.  ‚ÄúSim, sem d√∫vida!  Claro que posso - respondi, mas minha voz tremia trai√ßoeira.  ‚ÄúE tamb√©m na Unity?‚Äù - e ficou claro para mim que havia muito trabalho pela frente. <br><a name="habracut"></a><br>  Ent√£o, um pouco de √°gua.  At√© aquele momento, eu n√£o tinha visto o Unity, exatamente como C #, ent√£o decidi fazer um prot√≥tipo nas ferramentas que conhecia: C ++ e DX9.  O que eu sabia e era capaz de praticar na √©poca era as texturas de rolagem dos normais para formar a superf√≠cie e o mapeamento de deslocamento primitivo baseado nelas.  Imediatamente foi necess√°rio mudar absolutamente tudo.  Forma animada realista da superf√≠cie da √°gua.  Sombra complicada (fortemente).  Gera√ß√£o de espuma.  Sistema LOD conectado √† c√¢mera.  Comecei a procurar informa√ß√µes na Internet sobre como fazer tudo isso. <br><br>  O primeiro ponto, √© claro, foi o entendimento da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Simulating Ocean Water</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jerry Tessendorf</a> . <br><br>  Pagers acad√™micos com um monte de f√≥rmulas abstrusas nunca me foram muito dados; portanto, depois de algumas leituras, eu entendi pouco.  Os princ√≠pios gerais eram claros: cada quadro √© gerado por um mapa de altura usando a transforma√ß√£o r√°pida de Fourier, que, em fun√ß√£o do tempo, muda suavemente sua forma para formar uma superf√≠cie de √°gua realista.  Mas como e o que contar, eu n√£o sabia.  Eu lentamente mergulhei na sabedoria de calcular a FFT em shaders no D3D9, e o c√≥digo-fonte com um artigo em algum lugar selvagem da Internet, que tentei encontrar por uma hora, mas sem sucesso (infelizmente), realmente me ajudou.  O primeiro resultado foi obtido (assustador como uma guerra nuclear): <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/tdfwF1R81O4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Os sucessos iniciais agradaram e a transfer√™ncia de √°gua para a Unity come√ßou com sua conclus√£o. <br><br>  V√°rios requisitos foram apresentados para a √°gua no jogo sobre batalhas navais: <br><br><ul><li>  Olhar realista.  Belas como escor√ßos pr√≥ximos e distantes, espuma din√¢mica, dispers√£o, etc. </li><li>  Suporte para v√°rias condi√ß√µes clim√°ticas: calma, tempestade e condi√ß√µes intermedi√°rias.  Mudan√ßa de hora do dia. </li><li>  F√≠sica da flutuabilidade dos navios em uma superf√≠cie simulada, objetos flutuantes. </li><li>  Como o jogo √© multiplayer, a √°gua deve ser a mesma para todos os participantes da batalha. </li><li>  Desenho de superf√≠cie: √°reas desenhadas do v√¥o dos n√∫cleos de v√¥lei, espuma da entrada de n√∫cleos na √°gua. </li></ul><br><h3>  Geometria </h3><br>  Decidiu-se construir uma estrutura semelhante a um quadtree, com um centro ao redor da c√¢mera, que √© discretamente reconstru√≠do quando o observador se move.  Por que discreto?  Se voc√™ mover a malha suavemente com a c√¢mera ou usar a reproje√ß√£o do espa√ßo na tela, como no artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Renderiza√ß√£o em √°gua em tempo real - introduzindo o conceito de grade projetada</a> , nos planos de longo prazo, devido √† resolu√ß√£o insuficiente da malha geom√©trica, os pol√≠gonos ‚Äúpular√£o‚Äù para cima e para baixo.  Isso √© muito impressionante.  A imagem est√° ondulando.  Para superar isso, √© preciso aumentar bastante a resolu√ß√£o do pol√≠gono da malha de √°gua ou "achatar" a geometria por longas dist√¢ncias, ou construir e mover os pol√≠gonos para que essas mudan√ßas n√£o sejam vis√≠veis.  Nossa √°gua √© progressiva (hehe) e eu escolhi o terceiro caminho.  Como em qualquer t√©cnica semelhante (especialmente familiar para todos que criaram terreno nos jogos), voc√™ precisa se livrar das jun√ß√µes em T nas fronteiras das transi√ß√µes dos n√≠veis de detalhe.  Para resolver esse problema, no in√≠cio s√£o calculados 3 tipos de quadril√°teros com determinados par√¢metros de mosaico: <br><br><img src="https://habrastorage.org/webt/al/df/nw/aldfnwtnd2iihq2np9juxe5lvjm.jpeg"><br><br>  O primeiro tipo √© para aqueles quads que n√£o s√£o transi√ß√µes para detalhes mais baixos.  Nenhum dos lados possui um n√∫mero reduzido de duas vezes de v√©rtices.  O segundo tipo √© para quadr√≠ceps de limite, mas n√£o angulares.  O terceiro tipo s√£o quadril√°teros de limite angular.  A malha final da √°gua √© constru√≠da girando e escalando esses tr√™s tipos de malhas. <br><br>  √â assim que uma renderiza√ß√£o com uma cor diferente dos n√≠veis de √°gua LOD se parece. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/JycUZlod3xs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Os primeiros quadros mostram a conex√£o de dois n√≠veis diferentes de detalhes. <br><br>  O v√≠deo como um quadro √© preenchido com quads de √°gua: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/VldNrYKLb0w" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Deixe-me lembr√°-lo de que tudo isso foi h√° muito tempo (e n√£o √© verdade).  Agora, de maneira mais otimizada e flex√≠vel, isso pode ser feito diretamente na GPU (GPU Pro 5. Quadtrees na GPU).  E ele far√° uma chamada de empate e o mosaico pode aumentar os detalhes. <br><br>  Mais tarde, o projeto mudou para o D3D11, mas as m√£os n√£o alcan√ßaram a atualiza√ß√£o dessa parte da renderiza√ß√£o oce√¢nica. <br><br><h3>  Gera√ß√£o de forma de onda </h3><br>  Para isso, precisamos da Transformada r√°pida de Fourier.  Para a resolu√ß√£o selecionada (necess√°ria) da textura da onda (vamos cham√°-lo assim, por enquanto, explicarei quais dados s√£o armazenados l√°), preparamos os dados iniciais usando os par√¢metros definidos pelos artistas (for√ßa, dire√ß√£o do vento, depend√™ncia das ondas na dire√ß√£o do vento e outros).  Tudo isso deve ser alimentado nas chamadas f√≥rmulas.  Espectro Phillips  Modificamos os dados iniciais obtidos para cada quadro, levando em considera√ß√£o o tempo e executamos a FFT neles.  Na sa√≠da, obtemos um mosaico de textura em todas as dire√ß√µes que cont√©m o deslocamento dos v√©rtices da malha plana.  Por que n√£o apenas um mapa de altura?  Se voc√™ armazenar apenas o deslocamento em altura, o resultado ser√° uma massa "borbulhante" irrealista, que remotamente se assemelha ao mar: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/2234r1xpuI8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Se considerarmos os deslocamentos para as tr√™s coordenadas, ser√£o geradas ondas realistas "n√≠tidas": <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/tFhKaV1u-AY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Uma textura animada n√£o √© suficiente.  A telha √© vis√≠vel, n√£o h√° detalhes suficientes no futuro pr√≥ximo.  N√≥s pegamos o algoritmo descrito e criamos n√£o uma, mas tr√™s texturas geradas em fft.  O primeiro s√£o ondas grandes.  Ele define a forma de onda b√°sica e √© usado para a f√≠sica.  O segundo s√£o ondas m√©dias.  E, finalmente, o menor.  3 geradores FFT (a 4¬™ op√ß√£o √© o mix final): <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/gqxbAOS4sGM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Os par√¢metros das camadas s√£o definidos independentemente um do outro e as texturas resultantes s√£o misturadas no sombreador de √°gua na forma de onda final.  Paralelamente √†s compensa√ß√µes, tamb√©m s√£o gerados mapas normais de cada camada. <br><br>  A "uniformidade" da √°gua para todos os participantes da batalha √© garantida pela sincroniza√ß√£o dos par√¢metros oce√¢nicos no in√≠cio da batalha.  Esta informa√ß√£o √© transmitida pelo servidor para cada cliente. <br><br><h3>  Modelo de flutua√ß√£o f√≠sica </h3><br>  Uma vez que era necess√°rio fazer n√£o apenas uma imagem bonita, mas tamb√©m o comportamento realista dos navios.  E tamb√©m levando em conta o fato de que um mar tempestuoso (ondas grandes) deveria estar presente no jogo, outra tarefa que precisava ser resolvida era garantir a flutuabilidade dos objetos na superf√≠cie do mar gerado.  Primeiro, tentei fazer o GPU readback a textura da onda.  Mas, como ficou rapidamente claro que toda a f√≠sica do combate naval deve ser feita no servidor, no mar, ou melhor, na sua primeira camada, que define a forma de onda, tamb√©m deve ser lida no servidor (e, muito provavelmente, n√£o existe um m√©todo r√°pido e / ou r√°pido). GPU compat√≠vel), foi decidido escrever uma c√≥pia funcional completa do gerador GPU FFT na CPU na forma de um plug-in C ++ nativo para o Unity.  Eu n√£o implementei o algoritmo FFT e o usei na biblioteca Intel Performance Primitives (IPP).  Mas toda a liga√ß√£o e p√≥s-processamento dos resultados foi feita por mim, seguida pela otimiza√ß√£o no SSE e pela paraleliza√ß√£o por threads.  Isso incluiu a prepara√ß√£o da matriz de dados para a FFT em cada quadro e a convers√£o final dos valores calculados em um mapa de deslocamento de onda. <br><br>  Havia outra caracter√≠stica interessante do algoritmo, que era baseada nos requisitos para a f√≠sica da √°gua.  O que era necess√°rio era a fun√ß√£o de obter rapidamente a altura das ondas em um determinado ponto do mundo.  √â l√≥gico, porque esta √© a base para construir a flutuabilidade de qualquer objeto.  Por√©m, como na sa√≠da do processador FFT obtemos o mapa de deslocamento, n√£o o mapa de altura, a sele√ß√£o usual da textura n√£o nos deu a altura da onda, quando necess√°rio.  Para simplificar, considere a op√ß√£o 2D: <br><br><img src="https://habrastorage.org/webt/u6/ec/pe/u6ecpek-vcazrjpgh4ygxwhon2g.jpeg"><br><br>  Para formar uma onda, os texels (elementos de textura mostrados por linhas verticais) cont√™m um vetor (setas) que define o deslocamento do v√©rtice da malha plana (pontos azuis) na dire√ß√£o de sua posi√ß√£o final (a ponta da seta).  Suponha que tomemos esses dados e tentemos extrair dele a altura da √°gua no ponto de seu interesse.  Por exemplo, precisamos saber a altura em hB.  Se pegarmos o vetor texel tB, obtemos um deslocamento para um ponto pr√≥ximo a hC, que pode ser muito diferente do que precisamos.  Existem duas op√ß√µes para resolver esse problema: a cada solicita√ß√£o de altura, verifique o conjunto de texels adjacentes at√© encontrar um que tenha um deslocamento para a posi√ß√£o de interesse para n√≥s.  No nosso exemplo, encontramos texel tA como contendo o deslocamento mais pr√≥ximo.  Mas essa abordagem n√£o pode ser chamada rapidamente.  A varredura do raio texel n√£o est√° clara de que tamanho (e se o mar tempestuoso ou calmo, os deslocamentos podem variar bastante) podem demorar muito tempo. <br><br>  A segunda op√ß√£o - depois de calcular o mapa de deslocamento, converta-o em um mapa de altura usando a abordagem de dispers√£o.  Isso significa que, para cada vetor de deslocamento, escrevemos a altura da onda que ela define no ponto em que √© deslocada.  Essa ser√° uma matriz de dados separada, que ser√° usada para obter a altura no ponto de interesse.  Usando nossa ilustra√ß√£o, a c√©lula tB conter√° a altura hB obtida no vetor tA ‚Üí hB.  H√° mais um recurso.  A c√©lula tA n√£o conter√° um valor v√°lido, pois n√£o h√° nenhum vetor movendo-se para ele.  Para preencher esses "buracos", √© feita uma passagem para preench√™-los com valores vizinhos. <br><br>  √â assim que parece se voc√™ fizer a visualiza√ß√£o dos deslocamentos usando vetores (vermelho - deslocamento grande, verde - pequeno): <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/uBk8F55lR74" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  O resto √© simples.  O plano da linha de flutua√ß√£o condicional √© definido para o navio.  Nela, √© determinada uma grade retangular de pontos de amostra, que define os locais de aplica√ß√£o das for√ßas que empurram a √°gua para o navio.  Ent√£o, para cada ponto, verificamos se est√° embaixo da √°gua ou se n√£o est√° usando o mapa de altura da √°gua descrito acima.  Se o ponto estiver embaixo da √°gua, aplique a for√ßa vertical at√© o casco f√≠sico do corpo nesse ponto, escalado pela dist√¢ncia do ponto √† superf√≠cie da √°gua.  Se estiver acima da √°gua, n√£o faremos nada, a gravidade far√° tudo por n√≥s.  De fato, as f√≥rmulas s√£o um pouco mais complicadas (todas para o ajuste fino do comportamento do navio), mas o princ√≠pio b√°sico √© esse.  No v√≠deo de visualiza√ß√£o de flutuabilidade abaixo, os cubos azuis s√£o os locais das amostras e as linhas a partir delas s√£o a magnitude da for√ßa que empurra para fora da √°gua. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/mwNRIKbRdpQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Na implementa√ß√£o do servidor, h√° outro ponto de otimiza√ß√£o interessante.  N√£o √© necess√°rio simular √°gua diferente para diferentes inst√¢ncias de combate se elas passarem nas mesmas condi√ß√µes clim√°ticas (os mesmos par√¢metros do simulador de FFT).  Portanto, a decis√£o l√≥gica foi criar um conjunto de simuladores, para os quais as unidades de combate atendam aos pedidos de obten√ß√£o de √°gua simulada com os par√¢metros fornecidos.  Se os par√¢metros forem os mesmos em v√°rias inst√¢ncias, a mesma √°gua retornar√° a eles.  Isso √© implementado usando a API Memor Mapped File.  Quando o simulador de FFT √© criado, ele fornece acesso aos seus dados exportando descritores dos blocos necess√°rios.  A inst√¢ncia do servidor, em vez de iniciar um simulador real, lan√ßa um "manequim" que simplesmente fornece dados abertos por esses descritores.  Houve alguns bugs engra√ßados relacionados a essa funcionalidade.  Devido a erros de contagem de refer√™ncia, o simulador foi destru√≠do, mas o arquivo mapeado na mem√≥ria est√° ativo enquanto pelo menos um identificador est√° aberto.  Os dados pararam de atualizar (n√£o h√° simulador) e a √°gua "parou". <br><br>  No lado do cliente, precisamos de informa√ß√µes sobre a forma de onda para calcular a penetra√ß√£o dos n√∫cleos na onda e reproduzir os sistemas de part√≠culas e espuma.  O dano √© calculado no servidor e tamb√©m √© necess√°rio determinar corretamente se o n√∫cleo entrou na √°gua (a onda pode fechar o navio, especialmente em tempestades).  Aqui j√° √© necess√°rio fazer o rastreamento do mapa de altura por analogia, como √© feito no mapeamento de paralaxe ou nos efeitos SSAO. <br><br><h3>  Sombreamento </h3><br>  Em princ√≠pio, como em outros lugares.  Reflex√µes, refra√ß√µes, espalhamento de subsuperf√≠cie s√£o habilmente amassadas, levando em conta a profundidade do fundo, levamos em conta o efeito fresnel, consideramos o especular.  Consideramos a dispers√£o de cumes, dependendo da posi√ß√£o do sol.  A espuma √© gerada da seguinte forma: crie um "ponto de espuma" nas cristas das ondas (use a altura como uma m√©trica) e aplique pontos rec√©m-criados aos pontos dos quadros anteriores, reduzindo sua intensidade.  Assim, obtemos uma mancha de manchas de espuma na forma de uma cauda de uma crista de onda corrente. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/MyzFcwr641g" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Usamos a textura de ‚Äúmanchas‚Äù obtida como uma m√°scara na qual misturamos as texturas de bolhas, manchas etc. Temos um padr√£o din√¢mico de espuma bastante realista na superf√≠cie das ondas.  Essa m√°scara √© criada para cada camada de FFT (lembre-se, temos tr√™s) e, na mistura final, todas elas se misturam. <br><br>  O v√≠deo acima visualiza uma m√°scara de espuma.  A primeira e a segunda camadas.  Modifico os par√¢metros do gerador e o resultado √© vis√≠vel na textura. <br><br>  E um v√≠deo de um mar tempestuoso um pouco desajeitado.  Aqui voc√™ pode ver claramente a forma de onda, os recursos do gerador e a espuma: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/MAPUbmV4BAA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  Desenho de √°gua </h3><br>  Imagem de uso: <br><br><img src="https://habrastorage.org/webt/zz/gz/1p/zzgz1pslmj1tg5si7o8mwnxqjye.jpeg"><br><br>  Usado para: <br><br><ul><li>  Marcadores, visualiza√ß√£o da zona de expans√£o dos n√∫cleos. </li><li>  Desenhando espuma no ponto em que os n√∫cleos atingem a √°gua. </li><li>  Espumoso vel√≥rio do navio </li><li>  Espremer a √°gua sob o navio para remover o efeito das ondas que inundam o conv√©s e o por√£o inundado. </li></ul><br>  O caso b√°sico √≥bvio √© a texturiza√ß√£o projetiva.  Foi implementado.  Mas existem requisitos adicionais.  Esp√©cies pr√≥ximas - sab√£o devido √† resolu√ß√£o insuficiente (voc√™ pode aumentar, mas n√£o infinitamente), e eu quero que esses desenhos projetivos na √°gua sejam muito vis√≠veis.  Onde o mesmo problema foi resolvido?  √â isso mesmo, nas sombras (mapa das sombras).  Como ela √© resolvida l√°?  √Ä direita, mapas de sombra em cascata (divis√£o paralela).  Tamb√©m colocaremos essa tecnologia em servi√ßo e aplic√°-la √† nossa tarefa.  Dividimos o frustum da c√¢mera em N (3-4 geralmente) subfrustes.  Para cada um, constru√≠mos um ret√¢ngulo descritivo no plano horizontal.  Para cada ret√¢ngulo, constru√≠mos uma matriz de proje√ß√£o ortogr√°fica e desenhamos todos os objetos de interesse para cada uma dessas N c√¢meras orto.  Cada uma dessas c√¢meras atrai uma textura separada e, no sombreador do oceano, as combinamos em uma imagem projetiva s√≥lida. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/etG8tddmbmk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Ent√£o eu coloquei um avi√£o enorme com uma textura de bandeira no mar: <br><br><img src="https://habrastorage.org/webt/pd/uk/jr/pdukjrlnug2wu4debjrhlxbdxrc.jpeg"><br><br>  Aqui est√° o que as divis√µes cont√™m: <br><br><img src="https://habrastorage.org/webt/ez/dw/nm/ezdwnm3u85dzpavd5iz8e2u9q2k.jpeg"><br><br>  Al√©m das figuras usuais, √© necess√°rio desenhar uma m√°scara adicional de espuma (para vest√≠gios de navios e locais onde os n√∫cleos atingem) exatamente da mesma maneira, bem como uma m√°scara para espremer a √°gua sob os navios.  S√£o muitas c√¢meras e muitos corredores.  No in√≠cio, funcionou de maneira t√£o freada, mas, depois de mudar para o D3D11, usando a ‚Äúpropaga√ß√£o‚Äù da geometria no sombreador geom√©trico e desenhando cada c√≥pia em um destino de renderiza√ß√£o separado via SV_RenderTergetArrayIndex, foi poss√≠vel acelerar bastante esse efeito. <br><br><h3>  Melhorias e upgrades </h3><br>  D3D11 √© m√£os muito livres em muitos momentos.  Depois de mudar para ele e para o Unity 5, criei um gerador de FFT nos shaders de computa√ß√£o.  Visualmente, nada mudou, mas tornou-se um pouco mais r√°pido.  A convers√£o do erro de c√°lculo da textura dos reflexos de uma renderiza√ß√£o completa da c√¢mera para a tecnologia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Screen Space Planar Reflections</a> deu um bom impulso no desempenho.  Escrevi sobre a otimiza√ß√£o dos objetos da superf√≠cie da √°gua acima, mas minhas m√£os n√£o atingiram a transfer√™ncia da malha para a GPU Quadtree. <br><br>  Muito poderia ser feito de maneira mais otimizada e simples.  Por exemplo, n√£o rodeie jardins com um simulador de CPU, mas simplesmente execute a op√ß√£o GPU em um servidor com um dispositivo d3d WARP (software).  As matrizes de dados n√£o s√£o muito grandes. <br><br>  Bem, em geral, de alguma forma.  No momento em que o desenvolvimento come√ßou, tudo era moderno e legal.  Agora j√° est√° fora do lugar em alguns lugares.  Existem mais materiais dispon√≠veis, mesmo que haja um an√°logo semelhante ao github: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Crest</a> .  A maioria dos jogos que t√™m mar utiliza uma abordagem semelhante. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt451604/">https://habr.com/ru/post/pt451604/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt451594/index.html">Guia de Relat√≥rio do PHP Russia 2019</a></li>
<li><a href="../pt451596/index.html">Cardeal Cinzento .NET - John Galloway</a></li>
<li><a href="../pt451598/index.html">Unidade Fada Fada M√°gica: DSL em C #</a></li>
<li><a href="../pt451600/index.html">Como escrever uma carta de apresenta√ß√£o ao procurar emprego nos EUA: 7 dicas</a></li>
<li><a href="../pt451602/index.html">Estudamos MITRE ATT & CK. Matrizes m√≥veis: acesso ao dispositivo. Parte 1</a></li>
<li><a href="../pt451606/index.html">Internet History: Decay, Parte 2</a></li>
<li><a href="../pt451610/index.html">Security Week 20: desativando extens√µes do Firefox</a></li>
<li><a href="../pt451614/index.html">‚ÄúO que estamos discutindo na R√∫ssia tamb√©m √© relevante no Ocidente‚Äù: entrevista com Denis Neklyudov</a></li>
<li><a href="../pt451618/index.html">CampusInsight: do monitoramento da infraestrutura √† an√°lise da experi√™ncia do usu√°rio</a></li>
<li><a href="../pt451620/index.html">Autoriza√ß√£o autom√°tica no cart√£o Strava Heatmap</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>