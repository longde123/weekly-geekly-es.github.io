<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∂üèø ü•Ö üìÇ Greenplum 6: revis√£o de novos recursos üéπ üë©‚Äç‚ù§Ô∏è‚Äçüë© üë©üèª‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nos √∫ltimos 16 anos, o Greenplum, um DBMS aberto e massivamente paralelo, ajudou uma variedade de empresas a tomar decis√µes com base na an√°lise de dad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Greenplum 6: revis√£o de novos recursos</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474008/"><img src="https://habrastorage.org/webt/or/nu/hq/ornuhqed9rwdzvwmfwgodnf7kia.png" alt="imagem" width="150" align="left">  Nos √∫ltimos 16 anos, o Greenplum, um DBMS aberto e massivamente paralelo, ajudou uma variedade de empresas a tomar decis√µes com base na an√°lise de dados. <br><br>  Durante esse per√≠odo, a Greenplum penetrou em v√°rias √°reas de neg√≥cios, incluindo: varejo, fintech, telecomunica√ß√µes, ind√∫stria, com√©rcio eletr√¥nico.  Dimensionando para centenas de n√≥s horizontalmente, toler√¢ncia a falhas, c√≥digo-fonte aberto, total compatibilidade com PostgreSQL, transacionalidade e ANSI SQL - √© dif√≠cil imaginar uma melhor combina√ß√£o de propriedades para um DBMS anal√≠tico.  A partir de grandes grupos de empresas gigantes globais, como Morgan Stanley (200 n√≥s, 25 Pb de dados) ou Tinkoff (&gt; 70 n√≥s) e terminando com pequenas instala√ß√µes de dois n√≥s em startups acolhedoras, mais e mais empresas escolhem o Greenplum.  √â especialmente agrad√°vel observar essa tend√™ncia na R√∫ssia - nos √∫ltimos dois anos, o n√∫mero de grandes empresas dom√©sticas que usam o Greenplum triplicou. <br><br>  No outono de 2019, outro grande lan√ßamento do DBMS foi lan√ßado.  Neste artigo, falarei brevemente sobre os principais novos recursos do GP 6. <br><a name="habracut"></a><br>  A vers√£o principal anterior do Greenplum vers√£o 5 foi publicada em setembro de 2017, detalhes podem ser encontrados <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">neste artigo</a> .  Se voc√™ ainda n√£o sabe o que √© Greenplum, pode ser obtida uma breve introdu√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">neste artigo</a> .  √â antigo, mas a arquitetura do DBMS reflete corretamente. <br><br>  A vers√£o atual, por direito, pode ser chamada de ideia coletiva: v√°rias empresas de todo o mundo participaram do desenvolvimento - entre elas a Pivotal, Arenadata (onde o autor deste artigo trabalha), Alibaba. <br><br>  Ent√£o, o que h√° de novo no Greenplum 6? <br><br><h4>  Tabelas replicadas </h4><br>  Deixe-me lembr√°-lo que no Greenplum havia dois tipos de distribui√ß√£o de tabelas em um cluster: <br><br><ul><li>  Distribui√ß√£o uniforme aleat√≥ria </li><li>  Distribui√ß√£o em um ou v√°rios campos </li></ul><br>  Na maioria dos casos, a jun√ß√£o de duas tabelas (JOINs) foi realizada com redistribui√ß√£o de dados entre os segmentos do cluster durante a execu√ß√£o da consulta, e somente se as duas tabelas originalmente distribu√≠das pela chave de jun√ß√£o JOIN ocorressem localmente nos segmentos sem transferir dados entre os segmentos. <br><br>  O GP 6 oferece aos arquitetos uma nova ferramenta de otimiza√ß√£o de esquema de armazenamento - tabelas replicadas.  Essas tabelas s√£o duplicadas na √≠ntegra em todos os segmentos do cluster.  Qualquer conex√£o com essa tabela no lado direito ser√° realizada localmente, sem redistribuir dados.  Basicamente, o recurso √© destinado ao armazenamento de diret√≥rios volumosos. <br><br><div class="spoiler">  <b class="spoiler_title">Exemplo de consulta com tabela replicada</b> <div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> expand_replicated ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">DISTRIBUTED</span></span> REPLICATED; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> expand_random ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">DISTRIBUTED</span></span> RANDOMLY; <span class="hljs-keyword"><span class="hljs-keyword">explain</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> expand_rnd a2 <span class="hljs-keyword"><span class="hljs-keyword">left</span></span> <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> expand_replicated a3 <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> a2.gen = a3.gen <span class="hljs-comment"><span class="hljs-comment">#  ,    redistribute/broadcast Limit (cost=0.00..1680.04 rows=1 width=22) -&gt; Gather Motion 144:1 (slice1; segments: 144) (cost=0.00..1680.04 rows=2 width=22) -&gt; Hash Left Join (cost=0.00..1680.04 rows=1 width=22) Hash Cond: (expand_rnd.gen = expand_replicated.gen) -&gt; Seq Scan on expand_rnd (cost=0.00..431.00 rows=1 width=10) -&gt; Hash (cost=459.60..459.60 rows=2000000 width=12) -&gt; Seq Scan on expand_replicated (cost=0.00..459.60 rows=2000000 width=12)</span></span></code> </pre> <br></div></div><br><h4>  Algoritmo de compress√£o Zstandard (ZSTD) </h4><br>  Apresentado em 2016 pelos desenvolvedores do Facebook, o algoritmo de compacta√ß√£o sem perdas atingiu quase imediatamente o cora√ß√£o da nossa equipe Arenadata, porque comparado ao Zlib (usado por padr√£o no Greenplum) possui taxas de compacta√ß√£o mais altas com menos tempo necess√°rio para compacta√ß√£o e descompacta√ß√£o: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/q4/kv/bf/q4kvbf5hnif4yay7khzxcl2q0hu.png" width="500"></div><br>  <i>Fonte: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cnx-software.com</a></i> <br><br>  A efici√™ncia da compress√£o √© um dos par√¢metros mais importantes do DBMS anal√≠tico moderno.  De fato, permite reduzir a carga no subsistema de disco relativamente caro do cluster, carregando CPUs relativamente baratas.  Ao ler e gravar sequencialmente grandes quantidades de dados, isso resulta em uma redu√ß√£o significativa no custo total de propriedade do sistema. <br><br>  Em 2017, nossa equipe adicionou suporte ao ZSTD para tabelas de colunas no Greenplum; no entanto, de acordo com a pol√≠tica de lan√ßamento, esta revis√£o n√£o chegou aos lan√ßamentos menores oficiais do Greenplum.  At√© hoje, ele estava dispon√≠vel apenas para clientes comerciais da Arenadata e, com o lan√ßamento do 6.0, todos podiam us√°-lo. <br><br><h4>  Otimiza√ß√£o de expans√£o de cluster (expandir) </h4><br>  Nas vers√µes anteriores do GP, a expans√£o horizontal do cluster (adicionando novos n√≥s) apresentava algumas limita√ß√µes: <br><br><ul><li>  Embora a redistribui√ß√£o dos dados tenha ocorrido em segundo plano sem tempo de inatividade, era necess√°rio reiniciar o sistema ao adicionar novos n√≥s </li><li>  O algoritmo de hash e distribui√ß√£o de dados exigiu uma redistribui√ß√£o completa de todas as tabelas durante a expans√£o - o processo de distribui√ß√£o de dados em segundo plano pode levar horas ou at√© dias para clusters especialmente grandes </li><li>  Durante a distribui√ß√£o em segundo plano das tabelas, qualquer jun√ß√£o era distribu√≠da apenas </li></ul><br>  Greenplum 6 introduziu um algoritmo de expans√£o de cluster completamente novo, devido ao qual: <br><br><ul><li>  Agora a expans√£o ocorre sem reiniciar o sistema - o tempo de inatividade n√£o √© necess√°rio </li><li>  O algoritmo de hash consistente permite redistribuir apenas parte dos blocos ao adicionar n√≥s, ou seja, a redistribui√ß√£o em segundo plano das tabelas funciona muitas vezes mais rapidamente </li><li>  A l√≥gica para alterar os diret√≥rios do sistema mudou - agora, mesmo durante o processo de expans√£o, todas as conex√µes (JOINs) funcionam normalmente - localmente e distribu√≠das </li></ul><br>  Agora, a extens√£o Greenplum √© uma quest√£o de minutos, n√£o de horas. Isso permitir√° que os clusters sigam o crescente apetite das unidades de neg√≥cios. <br><br><h4>  Seguran√ßa no n√≠vel da coluna </h4><br>  Agora √© poss√≠vel distribuir direitos para colunas espec√≠ficas nas tabelas (o recurso veio do PostgreSQL): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">grant</span></span> all (column_name) <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> public.table_name <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> gpadmin;</code> </pre> <br><h4>  Jsonb </h4><br>  O armazenamento bin√°rio e ideal de objetos do tipo JSON est√° agora dispon√≠vel no GP.  Leia mais sobre o formato <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br><h4>  Explica√ß√£o autom√°tica </h4><br>  Outra grande extens√£o que veio para o GP do PostgreSQL.  Foi modificado para funcionar no modo distribu√≠do no cluster Greenplum pela equipe Arenadata. <br><br>  Permite automaticamente que cada solicita√ß√£o (ou tomada separadamente) no DBMS salve informa√ß√µes sobre: <br><br><ul><li>  plano de solicita√ß√£o; </li><li>  consumiu recursos em cada est√°gio da execu√ß√£o da consulta em cada segmento (n√≥); </li><li>  tempo gasto; </li><li>  o n√∫mero de linhas processadas em cada est√°gio da consulta em cada segmento (n√≥). </li></ul><br><h4>  Diskquota </h4><br>  Extens√£o do PostgreSQL que permite limitar o armazenamento em disco dispon√≠vel para usu√°rios e esquemas individuais: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> diskquota.set_schema_quota(<span class="hljs-string"><span class="hljs-string">'schema_name'</span></span>, <span class="hljs-string"><span class="hljs-string">'1 MB'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> diskquota.set_role_quota(<span class="hljs-string"><span class="hljs-string">'user_name'</span></span>, <span class="hljs-string"><span class="hljs-string">'1 MB'</span></span>);</code> </pre> <br><h3>  Novos recursos de distribui√ß√£o do banco de dados Arenadata </h3><br>  <i>Isen√ß√£o de responsabilidade - haver√° algumas linhas de publicidade a seguir</i> :) <br><br>  Deixe-me lembr√°-lo que n√≥s, Arenadata, estamos desenvolvendo, implementando e dando suporte √† nossa plataforma de armazenamento de dados com base em tecnologias de c√≥digo aberto - Greenplum, Kafka, Hadoop, Clickhouse.  Nossos clientes s√£o as maiores empresas russas nas √°reas de varejo, telecomunica√ß√µes, fintech e outras.  Por um lado, somos os colaboradores dos pr√≥prios projetos de c√≥digo aberto (comprometendo altera√ß√µes no kernel); por outro lado, estamos desenvolvendo funcionalidades adicionais que est√£o dispon√≠veis apenas para nossos clientes comerciais.  Al√©m disso, falaremos sobre os principais recursos. <br><br><h4>  Conector Tkhemali tcp Connector Greenplum -&gt; Clickhouse </h4><br>  Em projetos, geralmente usamos o grupo Greenplum + Clickhouse - por um lado, isso nos permite usar os melhores modelos cl√°ssicos de constru√ß√£o de data warehouses (das fontes aos data marts) que exigem muitas conex√µes, sintaxe ANSI SQL desenvolvida, transacionalidade e outros chips que o Greenplum possui, por outro lado, para fornecer acesso a grandes vitrines constru√≠das com uma velocidade m√°xima para um n√∫mero significativo de usu√°rios - e a Clickhouse n√£o tem concorrentes nisso. <br><br>  Para usar efetivamente esse pacote, desenvolvemos um conector paralelo especial, que transacionalmente (isto √©, consistente mesmo no caso de uma transa√ß√£o de revers√£o) permite transferir dados do GP para o KH.  Em geral, a arquitetura desse conector merece um artigo puramente t√©cnico separado - na verdade, tivemos que implementar filas ass√≠ncronas paralelas com um sistema para selecionar dinamicamente o n√∫mero de threads por inser√ß√£o e fluxo de dados. <br><br>  O resultado √© uma velocidade de intera√ß√£o fant√°stica: em nossos testes em discos SATA t√≠picos, alcan√ßamos 1 Gb / s por inser√ß√£o em um par de servidores Greenplum - Clickhouse.  Como o cluster GP m√©dio de nossos clientes consiste em mais de 20 servidores, a velocidade de intera√ß√£o √© mais do que suficiente. <br><br><h4>  Conector Kafka </h4><br>  Fizemos o mesmo com a integra√ß√£o com o intermedi√°rio de mensagens Kafka - geralmente encontramos a tarefa de sobrecarregar dados do Kafka para o Greenplum no modo quase em tempo real (segundos ou dezenas de segundos).  No entanto, a arquitetura do conector para Kafka √© diferente.  Um conector √© um cluster de processos sincronizados separados (lan√ßados no Docker) com descoberta autom√°tica, que, por um lado, s√£o consumidores Kafka e, por outro lado, inserem dados diretamente nos segmentos Greenplum.  O conector pode funcionar com o Kafka Registry e garante a consist√™ncia completa dos dados transferidos, mesmo em caso de falhas de hardware. <br><br><h4>  Sistema de gerenciamento e monitoramento </h4><br>  A opera√ß√£o do sistema em produ√ß√£o exige muito da implanta√ß√£o, atualiza√ß√£o e monitoramento do cluster.  √â importante que tudo o que acontece no DBMS seja transparente para opera√ß√µes e especialistas em DBA. <br><br>  Nosso sistema de gerenciamento e monitoramento Arenadata Cluster Manager (ADCM) fornece aos profissionais de opera√ß√£o todas as ferramentas necess√°rias.  De fato, a implanta√ß√£o e a atualiza√ß√£o do cluster Greenplum s√£o feitas com o toque de um bot√£o na interface gr√°fica (todos os sistemas operacionais, servi√ßos, montagem de disco e configura√ß√µes de rede s√£o feitos automaticamente). Al√©m disso, voc√™ obt√©m uma pilha de monitoramento totalmente configurada, pronta para integrar-se aos seus sistemas corporativos.  A prop√≥sito, o Arenadata Cluster Manager pode gerenciar n√£o apenas o Greenplum, mas tamb√©m o Hadoop, Kafka, Clickhouse (nossos conjuntos desses servi√ßos s√£o necess√°rios. Suas vers√µes gratuitas, como a pr√≥pria ADCM, podem ser baixadas totalmente gr√°tis em nosso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site</a> , apenas preenchendo o pop-up). <br><br><h4>  Conclus√£o </h4><br>  Se voc√™ estiver usando o Greenplum 5.X, recomendo atualizar o cluster para a vers√£o atual 6.X nos pr√≥ximos 2-3 meses. <br><br>  Se voc√™ ainda n√£o estiver usando o Greenplum, junte-se a n√≥s!  N√≥s, Arenadata, estamos sempre prontos para ajud√°-lo com isso. <br><br><h4>  Refer√™ncias </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Greenplum no github</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Canal Greenplum Russia Telegram</a> - fa√ßa suas perguntas diretamente aos usu√°rios do Greenplum <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Documenta√ß√£o do Greenplum 6</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt474008/">https://habr.com/ru/post/pt474008/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt473992/index.html">Vis√£o geral de protocolos modernos em sistemas de automa√ß√£o industrial</a></li>
<li><a href="../pt473994/index.html">Carregamento de script moderno</a></li>
<li><a href="../pt473998/index.html">Holanda, ou l√° e volta</a></li>
<li><a href="../pt474000/index.html">IQBX - projetista eletromec√¢nico para clubes e entusiastas de bricolage [ideia conceitual]</a></li>
<li><a href="../pt474004/index.html">De Norilsk a Riyadh: Um exemplo real para os cart√µes de mem√≥ria microSD UHS-I de temperatura industrial da Kingston</a></li>
<li><a href="../pt474012/index.html">Seguran√ßa para cont√™ineres do Docker</a></li>
<li><a href="../pt474014/index.html">Como os proxies ajudam na promo√ß√£o de sites: casos de uso reais, problemas e solu√ß√µes</a></li>
<li><a href="../pt474016/index.html">Escritores sobre ... Escritores sobre ... Escritores, prod, ou como a fic√ß√£o cient√≠fica extinta e renascida na R√∫ssia</a></li>
<li><a href="../pt474018/index.html">Fadiga do asfalto: como a sa√∫de da infraestrutura rodovi√°ria √© monitorada</a></li>
<li><a href="../pt474020/index.html">Como Methodius se tornou Anna: a experi√™ncia de desenvolver e lan√ßar classificadores de mensagens de voz. Parte 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>