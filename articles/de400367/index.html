<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔧 🔉 💉 Was am Wochenende zu tun ist: Fernbedienungs-Gegensprechanlage, budgetloses Remapping Nextion, Showdown mit Onlaym 👂🏼 🙎🏿 🏄</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Freitags wird Fiktion hier manchmal als akzeptabel angesehen. Heute ist natürlich nicht Freitag, aber es ist keine Fiktion, sondern drei Mini-Romane, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Was am Wochenende zu tun ist: Fernbedienungs-Gegensprechanlage, budgetloses Remapping Nextion, Showdown mit Onlaym</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/400367/"><img src="https://habrastorage.org/files/044/f5f/30d/044f5f30df86463087940fff4fc4ba92.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Freitags wird Fiktion hier manchmal als akzeptabel angesehen. </font><font style="vertical-align: inherit;">Heute ist natürlich nicht Freitag, aber es ist keine Fiktion, sondern drei Mini-Romane, die etwas mit meinem Leben zu tun haben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein hastiger Leser kann sich auch fragen, welche Beziehungen die Gegensprechanlage und den Internetprovider tatsächlich verbinden können. </font><font style="vertical-align: inherit;">Und es wird richtig sein, denn auch ich bin nicht sofort dazu gekommen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber über alles (Arduino, banale Life Hacks, Telefonstreitigkeiten) in Ordnung.</font></font><br>
<br>
<a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sim-sim, mach auf!</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um ehrlich zu sein, ist die Fernbedienung der Gegensprechanlage gemäß meiner Version fast unbrauchbar, und ich habe dies vollständig erkannt, bevor ich überhaupt angefangen habe. Um das Unternehmen zu rechtfertigen, musste ich daher die ganze Vorstellungskraft einsetzen, um ein paar Fälle zu erarbeiten, wie sie sagen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst beschloss ich, die Gäste auf diese Weise auf der Veranda aufwärmen zu lassen, wenn ich es noch nicht geschafft hätte, nach Hause zu rennen. Oder ich werde mich nicht besonders darum kümmern, die Schlüssel im Voraus zu bekommen - schließlich können Sie das Telefon einfach so einrichten, dass es einen Befehl zum Öffnen der Tür gibt, wenn ich zum Haus komme. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für gewöhnliche Menschen klingt es ziemlich wild, aber wie sie sagen, per aspera ad astra.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und ich wollte wirklich ein paar Relais in dem Gehäuse verwenden, die von Anfang an in der zentralen Steuerung im Leerlauf waren. Die Situation ist in der Tat lächerlich: Zu dieser Zeit gab es nur einen Block für 4 Relais, von denen nur zwei benötigt wurden. Und ich wollte keinen weiteren Monat auf den Zwei-Relais-Block warten, also sammelte ich das, was zur Hand war, und begann mir sofort Sorgen um Redundanz zu machen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Allerdings zu den Gegensprechanlagen. Im Allgemeinen ist das automatische Öffnen einer Gegensprechanlage keine ausschließliche Sache. Zum Beispiel hier bei Geektimes, Genosse </font><font style="vertical-align: inherit;">Im Jahr 2013 (als der Dollar 30 war) stellte </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cluster</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nicht nur eine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fernbedienung her, sondern auch einen Anrufbeantworter für Gäste</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist bei weitem das Coolste, was ich in dieser Klasse gesehen habe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber viel früher Besucher von RadioKota und vielen anderen thematischen Foren</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hatte Spaß mit Geräten wie "opener"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - entsperren Sie die Gegensprechanlage sofort bei einem Anruf. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich würde weder das eine noch das andere wiederholen. </font><font style="vertical-align: inherit;">Das erste - weil es schwierig ist und weil ich bereits einen funktionierenden Controller hatte, dem ich neue Kräfte verleihen wollte. </font><font style="vertical-align: inherit;">Das zweite aus offensichtlicheren Gründen: Zu viele Details und zu wenig Sinn, ich entschuldige mich, wenn ich die Autoren beleidigt habe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sinn natürlich für mich und überhaupt nicht. </font><font style="vertical-align: inherit;">Das heißt, ich mag das Schema, das jedem, der eine Wohnungsnummer wählt, gastfreundlich die Tür öffnet, kategorisch nicht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher die Grundvoraussetzungen für meinen Öffner: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Verwendung einer zentralen Steuerung zur Steuerung über das Internet und das Radio </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Minimaler Schutz vor unbefugtem Zugriff</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Minimale Interferenz im Innenraum</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Starten Sie</font></font></h3><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich machte mich zunächst mit dem Funktionsprinzip der Gegensprechanlage vertraut, die ich </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ausgeliehen </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">hatte</font></a><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Röhre funktioniert sehr einfach: Wenn die Röhre verlegt wird, hat sie einen Widerstand von 50 Ohm, wenn die Röhre entfernt wird, beträgt der Widerstand ca. </font><font style="vertical-align: inherit;">400 Ohm, wenn die Verriegelungsentriegelungstaste gedrückt wird, wird der Widerstand in Kilo-Ohm gemessen ... Wenn kein Anruf vorliegt, liegt keine Spannung in der Leitung an. </font><font style="vertical-align: inherit;">Wenn ein Anruf eingeht und das Mobilteil einen großen Strom legt und die Spannung sich als klein von 5 bis 7 V herausstellt, wenn das Mobilteil nicht vorhanden ist und der Widerstand gegen unendlich gerufen wird und die Spannung maximal ca. </font><font style="vertical-align: inherit;">15V bei ausgeschalteter Mobilteilspannung ca. 10V. </font><font style="vertical-align: inherit;">Wenn die Spannungstaste gedrückt wird, beträgt das Maximum ca. </font><font style="vertical-align: inherit;">15V - Drücken der Taste entspricht einem Zeilenumbruch.</font></font></blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Fall von Digital ist dies etwas anders, da die Dokumentation für das Mobilteil, aber ich hatte KM-2NO (übrigens danke ich Digital für die Veröffentlichung des Schemas):</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Stromaufnahme im "Talk" -Modus 18-22 mA </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Die Spannung in der Leitung mit einer am Gehäuse installierten Röhre 1,5–2,5 V </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. Die Spannung in der Leitung mit einer erhöhten Röhre 5,8–6,5 V.</font></font><br>
</blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher habe ich mich mit dem Schaltplan meiner Pfeife genauer vertraut gemacht: </font></font><br>
<br>
<img src="https://habrastorage.org/files/b76/591/c8f/b76591c8f87c4eaca7a8bfec1f652f39.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und ich habe festgestellt, dass in Bezug auf den Widerstand alles genau gleich ist, und höchstwahrscheinlich unterscheidet sich der Rest der Logik des Digital kaum vom Besuch. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich mache darauf aufmerksam, dass meine Modifikation ohne LED ist. Dies stellte sich jedoch als genau richtig heraus, da es aufgrund dieser Tatsache sehr einfach ist, Anrufinformationen an die zentrale Steuerung zu übertragen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das heißt: Der Anruf ertönt, die LED „leuchtet“, der Optokoppler leuchtet auf, am Controller-Pin ändert sich der Pegel von hoch nach niedrig. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also habe ich anstelle der LED meinen 4N35-Optokoppler installiert, dessen Ausgang ich direkt an das Arduino gesendet habe. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nach dem Standardschema</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aus demselben Internet:</font></font><br>
<br>
<img src="https://habrastorage.org/files/a7f/c39/9f8/a7fc399f840e4931b225370b2f21c3cd.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und da ich mit einem Minimum an Details und verfügbaren Controller-Ressourcen auskommen wollte, von denen sich die digitalen Pins als die wertvollsten herausstellten (Uno hatte nicht genug davon), verwendete ich anstelle eines 10K-Pull-up-Widerstands den eingebauten Arduino-Pull-up-Widerstand. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei Anschluss an einen digitalen Pin sieht es folgendermaßen aus:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringPin _</span></span><font></font>
<font></font>
pinMode(ringPin, INPUT_PULLUP);<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei Anschluss an einen analogen Pin:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringPin _</span></span><font></font>
<font></font>
pinMode(ringPin, INPUT);<font></font>
digitalWrite(ringPin, HIGH);<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich beschloss, das Optron vom Mikrocontroller zu platzieren. </font><font style="vertical-align: inherit;">Ich kann es nicht rechtfertigen, aber ich dachte, dass das Risiko von Fehlalarmen bei möglichen Abholungen geringer ist. </font><font style="vertical-align: inherit;">Es ist möglich, dass er sich irrt, aber bisher ist alles normal mit Tipps </font><font style="vertical-align: inherit;">Sie sind nicht da. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was die Erde im obigen Beispiel betrifft, müssen Sie verstehen: Obwohl die Erde im Diagramm häufig vorkommt, ist dies nicht der Fall - tatsächlich gibt es tatsächlich eine optoelektronische Isolation. </font><font style="vertical-align: inherit;">Dafür ist er ein Beispiel.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Werde mich los!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Entscheidung, die Intercom-Schaltkreise vollständig loszuwerden, kam nicht sofort, sondern unweigerlich. Übrigens erinnerte ich mich sehr an den Fall vor sechs Jahren, als ich beobachtete, wie sich während der Installation eines ACS ein unangenehmer Moment mit einem elektromagnetischen Schloss bildete. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich weiß nicht, wie es passiert ist, aber es stellte sich heraus, dass das Schloss irgendwie funktionierte. Das "Kriechen", dann gar nichts, und die Installateure selbst haben sich schon den Kopf gebrochen. Aber am Ende wurde vermutet, dass sie irgendwo (oder so ähnlich) in den Steuerkreisen einen unerwarteten Kurzschluss hatten. Natürlich haben wir alles ohne großen Erfolg überprüft, da sie klar nach den Anweisungen eingestellt waren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Öl wurde dem Feuer durch die Tatsache hinzugefügt, dass genau das gleiche Schloss in genau der gleichen Konfiguration war, aber es funktionierte gut auf der anderen Etage.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie lange, kurz, entschieden sie, dass sich die Angelegenheit in der Tür selbst befand, an der das Schloss angebracht ist. Meiner Meinung nach schlugen sie vor, dass sie beim Einbau in den Anker steckten, der wiederum geerdet war, was zu unerwarteten Auswirkungen auf das Schloss führte (das möglicherweise ein Kontrollschloss für das Gehäuse hatte). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Allgemeinen haben sie ziemlich lange und mühsam geklärt. Und ich wollte zu Hause nicht dasselbe wiederholen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher habe ich keine Kabel gespart und die Relaiskontakte auf einfachste Weise angeschlossen: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Normalerweise ein Relais geschlossen - in Reihe mit der Aufwärtstaste SW1 (da diese Taste im Normalzustand geschlossen ist) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Normalerweise ein anderes Relais öffnen - parallel zur Türöffnungstaste SB1 ( weil diese Schaltfläche normalerweise geöffnet ist)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Relaissteuerkontakte sind natürlich mit den freien (Hurra, sie waren es immer noch) digitalen Pins des Mikrocontrollers verbunden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Insgesamt ist es leicht vorstellbar, dass sechs Drähte benötigt wurden: zwei für den Optokoppler und vier weitere für das Relais. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich entschuldige mich für den Primitivismus der Abbildung:</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Von der Gegensprechanlage</font></font></h4><br>
<img src="https://habrastorage.org/files/cfe/2f2/23c/cfe2f223cb2b4d49ad1b853482b3895a.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Von Arduino</font></font></h4><br>
<img src="https://habrastorage.org/files/c99/84f/e4b/c9984fe4be554b13b2ec17915ca86474.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Relais sind hier ausschließlich schematisch dargestellt. </font><font style="vertical-align: inherit;">Da ich wiederhole, habe ich fertige Relaismodule mit voller Füllung verwendet - Optokoppler, Transistoren, Dioden und so weiter. </font><font style="vertical-align: inherit;">Ich empfehle dringend, keine bloßen Relais an Arduino anzuschließen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... und ruf mich nicht mehr an!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bereits zu diesem Zeitpunkt konnte ich das Türtelefon sehr einfach über das Internet oder ein lokales Netzwerk von einem Computer oder Smartphone aus nach folgendem Prinzip </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
öffnen </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">1) Zum Zeitpunkt des Klingelns des Türtelefons wechselt der Controller in den Berechtigungsmodus, um die Tür für 40 Sekunden zu öffnen. Die Zeit wird anhand der Dokumentation für das digitale Türtelefon ausgewählt, wobei angegeben wird, dass die Dauer des Anrufsignals genau 40 Sekunden beträgt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das heißt, für eine längere Zeit macht es keinen Sinn, bedingt offen zu bleiben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Nach Empfang eines offenen Befehls über das Internet (HTTP POST) schaltet die Steuerung das Relais nacheinander um. Zunächst öffnet es das Röhrenrelais, das seinen Anstieg simuliert. Nach einer kurzen Pause schließt das Öffnungsknopfrelais und simuliert so sein Drücken. Nachher - lässt die Taste los und legt den Hörer auf. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Prüfstand war sehr primitiv:</font></font><br>
<br>
<img src="https://habrastorage.org/files/3b5/44c/db1/3b544cdb17ab4f67953d7643d98e0156.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es wäre möglich, damit aufzuhören, wenn ich als stolzer Besitzer von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KTsDV-12-2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nicht </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">wüsste,</font></a><font style="vertical-align: inherit;"> wie unpraktisch es ist - jedes Mal, wenn Sie etwas </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">ein-</font></a><font style="vertical-align: inherit;"> oder ausschalten müssen, um die Fernbedienung oder das Telefon </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">herumzulaufen</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und insbesondere, wenn ich kürzlich keine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desktop-Wetterstation mit Touchscreen fertiggestellt hätte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und das Potenzial offenbar nicht voll ausgeschöpft wäre. </font></font><br>
<br>
<img src="https://habrastorage.org/files/90a/d36/f45/90ad36f45757421295f332c7425578fa.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kurz gesagt, ich habe der Wetterstation schnell (eigentlich nicht) den gebräuchlichsten und vulgärsten 433-MHz-Sender mit Amplitudenmodulation hinzugefügt, der bei Aliexpress für lächerliches Geld verkauft wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infolgedessen ist die Wetterstation zu einem weiteren Kontrollpunkt für die Gegensprechanlage geworden. Wenn also eine Glocke läutet und Sie daneben sitzen, macht es keinen Sinn, das Telefon zu beschädigen, denn direkt vom Bildschirm aus können Sie:</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Öffnen Sie das Schloss. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Nehmen Sie den Hörer ab und langsam (laut Dokumentation dauert das Gespräch 1,5 Minuten gegenüber 40 Sekunden des Anrufs), gehen Sie zur Gegensprechanlage, beantworten Sie und entscheiden Sie, ob Sie öffnen möchten oder nicht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Nehmen Sie den Anruf entgegen (der Controller nimmt ab und sofort "Hängt auf") </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dafür musste ich natürlich den Code und die Schnittstelle der Wetterstation leicht ändern, aber auf dem Weg fand ich heraus, wo es nervige Fehler bei der Anzeige von Grafiken gibt (wie sich herausstellte - ich habe es in meiner DNA, aber das ist eine andere Geschichte). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die neue Oberfläche sieht jetzt übrigens überhaupt nicht mehr wie HAL aus. Jetzt ist alles so bunt und lustig, dass man nur noch lachen muss. Und Sie sehen, verstehen Sie: Ich habe keine Smoothies getrunken, Hipster haben mich nicht gebissen, es gab keine Lamberseks in der Familie und Material zieht mich an wie nie zuvor in meinem Leben:</font></font><br>
<br>
<img src="https://habrastorage.org/files/71a/154/0d4/71a1540d420441d3aa62d3ca673f3a43.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Bildschirm ersetzt die Klimadaten, wenn die Gegensprechanlage klingelt: In diesem Moment gibt die zentrale Steuerung einen Funkbefehl aus, auf den die Wetteranzeige reagiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es mag hier etwas unlogisch sein, aber die Glocke in der Mitte informiert Sie hauptsächlich über den Intercom-Anruf. </font><font style="vertical-align: inherit;">Durch Drücken (hier unlogisch) wird der Intercom-Sound auf barbarische Weise stummgeschaltet - indem der Vorgang des Anhebens und Absenkens des Mobilteils nachgeahmt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Schloss auf der linken Seite ist die Öffnung des Schlosses. </font><font style="vertical-align: inherit;">Mobilteil rechts - Nehmen Sie den Hörer ab, um den Beginn eines Gesprächs zu simulieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Bildschirm wechselt nach 40 Sekunden nach Beginn des Anrufs zum Hauptbildschirm und nicht sofort durch Drücken der Symboltaste. </font><font style="vertical-align: inherit;">Auf diese Weise können Sie mehrmals drücken, wenn der Controller plötzlich keinen Befehl mehr „gehört“ hat, was angesichts des verwendeten Funkkanaltyps nicht ungewöhnlich ist.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algorithmen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie ich bereits erwähnte, war ich zunächst bescheiden und wollte nur eines: die Gegensprechanlage auf Befehl vom Telefon aus und zum Zeitpunkt des Anrufs öffnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber nachdem ich ein paar Tage gespielt hatte, wurde mir klar, dass es ziemlich langweilig ist, vor der Gegensprechanlage zu stehen und auf den Bildschirm zu stöbern, und es ist viel interessanter, eine „verzögerte“ Öffnung zuzulassen, wenn Sie sich nur dem Eingang nähern. Dann bleibt nur noch die Wohnungsnummer auf der Türtafel zu wählen und voila, die Tür ist offen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schließlich dachte ich, dass es in dieser Situation wahrscheinlich sinnvoll ist, ein Öffnungsverbot zu erlassen - im Allgemeinen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber dann riss er sich zusammen, ließ sich dann los, nahm ein nützlicheres Werkzeug, im Volksmund Occams Rasiermesser genannt, und entfernte schnell zusätzliche Wesenheiten. Nämlich: Da ich die Fernbedienung gemacht habe, war es nicht, sie auszuschalten. Daher ist ein Herunterfahren überhaupt nicht erforderlich.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zweitens stellte sich nach nüchternem (und nicht wie üblichem) Denken heraus, dass es keinen besonderen Unterschied zwischen dem Öffnen durch einen Befehl unmittelbar zum Zeitpunkt des Anrufs oder durch einen bestimmten Befehl gab. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abschließend möchte ich noch auf die Ergonomie der Steuerung zurückkommen. Je mehr Modi - desto weniger gewöhnliche Menschen werden sie verwenden. Ja, ich bin langweilig, aber als ich mir vorstellte, dass ich drei Modi für verschiedene Anlässe hatte, wurde mir klar, dass ich immer noch einen verwenden würde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher ist der Modus eins und der Befehl eins, und es gibt zwei Prozessoren: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Wenn die Gegensprechanlage klingelt, ermöglicht die Steuerung das Öffnen innerhalb von 40 Sekunden nach Beginn des Anrufs</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Wenn der Öffnungsbefehl zuerst empfangen wird, lässt die Steuerung das Öffnen zu und wartet innerhalb von N Minuten nach Eingang des Befehls auf einen Anruf (dies dient dazu, die Gegensprechanlage für das Öffnen auf dem Weg zum Haus vorzubereiten). Es </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gibt zwei Quellen für den Öffnungsbefehl: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) HTTP POST- eine Anfrage über ein lokales Netzwerk oder das Internet (zum Beispiel: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myserver.com/?sim-sim-openup</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), d.h. Sie können mindestens von Kuala Lumpur aus öffnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Der Funkbefehl über die Bedienfelder oder Schaltflächen des Hauses (in meiner Implementierung </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">über die RC-Switch-Bibliothek</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und da die gesamte Struktur mit dem Mobilteil verbunden ist, ohne dessen Funktion zu beeinträchtigen, kann die Gegensprechanlage weiterhin auf die übliche Weise verwendet werden (Klingeltelefon-Hi-Hi-Taste), d. H. </font><font style="vertical-align: inherit;">Inland, nicht in der Lage, die Vorzüge des technologischen Fortschritts einzuschätzen, und nicht verpflichtet sind, sich mit den Details zu befassen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plötzliche Boni</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selbst wenn Sie die Türöffnerfunktion nicht verwenden, stellt sich jetzt heraus, dass der Controller regelmäßig benachrichtigt, dass jemand über die Gegensprechanlage an der Eingangstür kratzt. </font><font style="vertical-align: inherit;">Für mich als neugierige Person sind diese Informationen nicht ohne Interesse - und jetzt erhalte ich sie regelmäßig. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Noch wichtiger ist, dass diese Funktion auch dann weiter funktioniert, wenn Sie das Türsprechgerät mit seinem Schalter ausschalten. </font><font style="vertical-align: inherit;">Möglicherweise bedeutet dies, dass jetzt die Wahrscheinlichkeit geringer ist, dass die Gegensprechanlage deaktiviert bleibt, wenn Sie plötzlich die Möglichkeit seiner Anrufe vorübergehend ausschließen müssen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leider ist die Intercom-Schaltung so beschaffen, dass es beim Ausschalten unmöglich wird, das Schloss fernzusteuern (es scheint, dass die Zentraleinheit glaubt, dass in diesem Fall das Mobilteil unabhängig von seiner tatsächlichen Position „aufgelegt“ ist).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und Landschaftsbau</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da ich nach minimalen Störungen im Innenraum strebte, musste ich eine Entscheidung treffen, wie die Verbindung zum zentralen Controller hergestellt werden soll, da sich der Controller und das Türtelefon auf verschiedenen Seiten der Tür befanden und der Controller über Strom verfügte, das Türtelefon jedoch nicht. </font></font><br>
<br>
<img src="https://habrastorage.org/files/7b6/8e8/6c3/7b68e86c3aab453e8fcbc579149f4e2a.JPG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am Ende entschied ich, dass es besser ist, das Kabel hinter dem Türrahmen zu spannen und seine Fragmente mit dekorativen Paneelen zu schließen, die auf einem 3D-Drucker gedruckt sind, als eine andere Steckdose mit einem Netzteil zu belegen. Es ist nicht klar, wie das Kabel zum Türhörer-Mobilteil gezogen und der Funkkanal zwischen dem Mobilteil und dem Controller blockiert werden soll. </font></font><br>
<br>
<img src="https://habrastorage.org/files/e65/a91/84a/e65a9184ab9d4cb29e84e515689e607e.JPG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und ich denke, dass dies unter meinen Bedingungen die beste Option ist. </font><font style="vertical-align: inherit;">Ja, und das Relais ging in Betrieb, aber mit einem Funkkanal - wäre wieder in Reserve geblieben.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nextion neu zuordnen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als ich über die Desktop-Wetteranzeige sprach (Wetterstation, wenn Sie möchten), erwähnte ich, dass es mir während des Endbearbeitungsprozesses gelungen ist, die Hauptkomponente - den Nextion-Touchscreen selbst - zu beschädigen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Störung hatte keinen Einfluss auf den Betrieb seines integrierten Mikrocontrollers und der Datenanzeige, aber das Touchpanel fiel fast aus. Experimentell habe ich jedoch herausgefunden, dass Sie auf diese Weise die Empfindlichkeit der linken (ungefähr) Hälfte des Bildschirms wiederherstellen können, auch wenn Sie an einer bestimmten Stelle nicht zu viel Druck auf das Nextion-Board ausüben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Trick funktioniert instabil und nicht immer, aber oft genug, damit ich es ertragen kann und darüber nachdenke, einen neuen Bildschirm zu bestellen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das hat mich natürlich glücklich und traurig gemacht. Zum einen konnte eine teilweise Bedienbarkeit erreicht werden. Andererseits möchte ich ein bisschen mehr mit den Charts spielen. Und dann wurde mir plötzlich klar, in was für eine dumme Falle ich geraten war: Aus irgendeinem Grund war ich besessen davon, den gesamten Bildschirmbereich zu nutzen, wenn ich die „nicht funktionierenden“ Tasten frei auf den Arbeitsbereich übertragen konnte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich verstehe, dass dies für viele wirklich eine banale Entscheidung ist. Aber ich möchte unschuldige Freude mit denen teilen, die wie ich es lieben, bis zum Äußersten zu gehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also habe ich es herausgefunden, die Größe der Tasten leicht verändert, einen neuen virtuellen Steuerkreis in meinen Kopf gezogen und voila! Wir haben die Funktionalität eines teilweise getöteten Displays fast vollständig wiederhergestellt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es war: </font></font><br>
<br>
<img src="https://habrastorage.org/files/8cb/774/fc0/8cb774fc06b444ce994ad1470e7319d8.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es wurde:</font></font><br>
<br>
<img src="https://habrastorage.org/files/202/2b8/82f/2022b882fd2245a79cc4fae8514ddde5.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unterwegs musste ich jedoch einen Perfektionisten in mir selbst töten und den ursprünglichen Bildschirm für die Eingabe des Telefon-Eingabetelefons auf einen minimal funktionierenden Bildschirm zurücksetzen:</font></font><br>
<br>
<img src="https://habrastorage.org/files/bd2/bec/a58/bd2beca5810346c5a99099e1ac046288.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Live</font></font></h4><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/P6Iqh6SYVRU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn technischer Support kein Ale ist</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es scheint, dass es bei all diesen Höhen und Tiefen möglich wäre, zu beenden, wenn nicht für ein Detail: Ich stellte plötzlich fest, dass die Gegensprechanlage (und dahinter der Rest der Automatisierung) beim Zugriff von externen Netzwerken nicht mehr gesteuert wurde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das heißt, alle Befehle funktionierten einwandfrei, wenn sie über das Heimnetzwerk und externe Adressen (und nicht gemäß dem internen Typ 192.xxx.xxx.xxx) mit dem Internet verbunden waren, lehnten es jedoch ebenso fehlerfrei ab, von den Netzwerken anderer Betreiber ausgeführt zu werden (ich habe zwei ausprobiert). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie sollten sofort verstehen, dass die Befehle über eine HTTP-Anforderung an einen bestimmten externen Port des Routers übertragen werden und von dort bereits an die erforderliche interne IP und den erforderlichen Port umgeleitet werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und dieses Programm hat seit seiner Einführung im Jahr 2013 ohne die geringsten Probleme funktioniert, bis in der aktuellen Version etwas kaputt gegangen ist. Und ich bin mir immer noch sicher, dass es nicht meine Schuld ist. Aber ich weiß nicht, wie ich das überprüfen soll. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eigentlich wollte ich zuerst bei Beeline schwören, weil ich anfangs dachte, das Problem liege im mobilen Internet. Aber dann riss ich mich zusammen, fand einen anderen Anbieter, versuchte es und fand heraus, dass dadurch das gleiche Problem auftrat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann rief ich Onlaym an und erklärte, so gut ich konnte, das Wesentliche der Behauptungen. Und als Antwort erklärten sie mir im Volksmund:</font></font><br>
<br>
<blockquote>               :<br>
TCP/25 –  -;<br>
TCP/135-139, TCP/445  UDP/135-139 –   ,    MS Windows;<br>
TCP/23, TCP/161, UDP/69  UDP/161–   .<br>
 <br>
  ,  ,  .</blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich bestand wiederum darauf, dass mein Port a) nicht in diesen Bereich fällt, b) nicht wie erwartet funktioniert und c) ich nichts geändert habe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie wäre es mit einer Mauer aus Erbsen? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, was soll ich tun, dann erklärte ich höflich, dass ich, obwohl ich verstehe, dass meine unglücklichen 450 Rubel pro Monat nicht das Wetter für sie tun, von einem solchen Unsinn nach demselben Unsinn suchen werde, aber zumindest funktioniert es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Antwort murmelten sie erneut, dass sie mir IP und dann alle meine Probleme zur Verfügung stellten. Nun meins, entschied ich, dann meins. Und durch eine willensstarke Entscheidung habe ich zuerst die Funktionsfähigkeit des Systems an einem anderen Port (auf eine Einheit verschoben) überprüft - es funktioniert. Und dann hat er in Porter eine flexible Konfiguration der Portnummer vorgenommen, über die das Lenkrad tatsächlich automatisch ist.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eigentlich zu dem, was ich meine Leiden beschreibe: Ich wollte objektiv wirklich verstehen, wer in einer solchen Situation falsch lag. </font><font style="vertical-align: inherit;">Weil ich mich wie ein Vollidiot fühle - ich habe den Router neu gestartet und die Einstellungen überprüft (außerdem auf eigene Initiative und nicht auf Aufforderung von „Spezialisten“), und trotzdem haben sie mich in die Hölle geschickt und auf meine krummen Hände hingewiesen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aus dem Bildschirm</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zusammenfassend, dass ich für den Bau des Jahrhunderts verwendet habe: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KTSDV-12-2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 1 </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Stck</font></a><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Türsprechhörer Digital KM-2NO - 1 Stck. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Optokoppler 4N35 - 1 Stck. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4) Flachkabel 10 Adern (sechs verwendet, aber alles - nur für den Fall) - 3 m. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5) Stecker an das Kabel - 2 Stck. </font><font style="vertical-align: inherit;">Väter und Mütter </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6) Selbstgemachtes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wetterdisplay mit Nextion-Touchscreen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 1 </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Stck</font></a><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7) 433-MHz-Sender ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aus einem solchen Kit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) zum Ändern der Wetteranzeige - 1 Stck. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8) 1 kΩ Widerstand für Optokoppler - 1 Stck. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Optionen: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aktualisierte Oberfläche für Nextion</font></font></a><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testcode (vor der Integration mit KTSDV-12-2 und einer ganzen Reihe von Servicefunktionen, nur um den Gedankengang zu verstehen)</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;RCSwitch.h&gt; //   http://code.google.com/p/rc-switch/</span></span></span></span><font></font>
<font></font>
<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringTimeOut 40000 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//       2094</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> openTimeOut 300000 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    allowOpen        </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> handsetPin A3 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    0</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> openPin A4 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    (1)</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringPin 7 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//   (3)</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringCode 360500 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//        </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> doorBell 3395840 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//       </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> openCode 255899 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//     </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> openDelay 1500 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> handsetDelay 2500 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> txPin 8</span></span><font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ringTime, openTime; <span class="hljs-comment"><span class="hljs-comment">//    </span></span>
boolean ring = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;<font></font>
boolean ringRepeat = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//       </span></span>
boolean allowOpen = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     </span></span><font></font>
<font></font>
RCSwitch mySwitch = RCSwitch();<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//  </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openDoor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
    <font></font>
    digitalWrite(handsetPin, LOW);<font></font>
    delay(handsetDelay);<font></font>
    digitalWrite(openPin, LOW);<font></font>
    delay(openDelay);<font></font>
    digitalWrite(openPin, HIGH);<font></font>
    digitalWrite(handsetPin, HIGH);<font></font>
    ring = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
    allowOpen = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//      </span></span>
    <span class="hljs-comment"><span class="hljs-comment">// sendMail(37); //           </span></span><font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
  Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>);<font></font>
  mySwitch.enableTransmit(txPin); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
  mySwitch.enableReceive(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
  pinMode(handsetPin, OUTPUT); <span class="hljs-comment"><span class="hljs-comment">//    </span></span><font></font>
  pinMode(openPin, OUTPUT);<font></font>
  pinMode(ringPin, INPUT_PULLUP  );<font></font>
  digitalWrite(handsetPin, HIGH); <span class="hljs-comment"><span class="hljs-comment">//  </span></span><font></font>
  digitalWrite(openPin, HIGH);<font></font>
  Serial.println(<span class="hljs-string"><span class="hljs-string">"Ready"</span></span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
  <font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(ringPin) == LOW &amp;&amp; ring == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//            </span></span>
    ring = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    </span></span><font></font>
    ringTime = millis();<font></font>
    <span class="hljs-comment"><span class="hljs-comment">// sendMail(36); //     </span></span>
    mySwitch.send(ringCode, <span class="hljs-number"><span class="hljs-number">24</span></span>);<font></font>
    Serial.println(<span class="hljs-string"><span class="hljs-string">"Sent ringCode"</span></span>);
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ringRepeat == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//      </span></span>
      mySwitch.send(doorBell, <span class="hljs-number"><span class="hljs-number">24</span></span>);<font></font>
      Serial.println(<span class="hljs-string"><span class="hljs-string">"DoorBell repeat"</span></span>);<font></font>
    }<font></font>
    Serial.println(<span class="hljs-string"><span class="hljs-string">"Ring-ring!"</span></span>);<font></font>
  }<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((millis() - ringTime) &gt; ringTimeOut &amp;&amp; ring == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//   40  (   )    </span></span>
  ring = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
  Serial.println(<span class="hljs-string"><span class="hljs-string">"Ring reset"</span></span>);
  <span class="hljs-comment"><span class="hljs-comment">// sendMail(38); //      </span></span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ring == <span class="hljs-literal"><span class="hljs-literal">true</span></span> &amp;&amp; allowOpen == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) {<font></font>
  openDoor(); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
  Serial.println(<span class="hljs-string"><span class="hljs-string">"Door opened via net"</span></span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ring == <span class="hljs-literal"><span class="hljs-literal">false</span></span> &amp;&amp; allowOpen == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//  ""   </span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((millis() - openTime) &gt; openTimeOut) { <span class="hljs-comment"><span class="hljs-comment">//       </span></span>
   allowOpen = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; 
   <span class="hljs-comment"><span class="hljs-comment">// sendMail(39); //     </span></span><font></font>
  }<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mySwitch.available()) { <span class="hljs-comment"><span class="hljs-comment">//</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value = mySwitch.getReceivedValue();
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (value != <span class="hljs-number"><span class="hljs-number">0</span></span>) {<font></font>
      Serial.println(mySwitch.getReceivedValue());<font></font>
      <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (mySwitch.getReceivedValue()) {<font></font>
        <font></font>
        <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> openCode: <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
          <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ring == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) {<font></font>
            mySwitch.disableReceive();<font></font>
            openDoor(); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
            Serial.println(<span class="hljs-string"><span class="hljs-string">"Door opened via radio"</span></span>);<font></font>
            mySwitch.enableReceive(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
          }<font></font>
          <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;<font></font>
    }<font></font>
    mySwitch.resetAvailable();<font></font>
  }<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
}<font></font>
<font></font>
}<font></font>
<font></font>
<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe die Bilder für die Benutzeroberfläche auf der wundervollen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pixabay-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Website aufgenommen </font><font style="vertical-align: inherit;">.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de400367/">https://habr.com/ru/post/de400367/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de400357/index.html">Google zeigt ein dreifaches Wohltätigkeitsmuster</a></li>
<li><a href="../de400359/index.html">Propriozeption für Laien. Teil 3. Dynamisches Sitzen auf einem Stuhl</a></li>
<li><a href="../de400361/index.html">Foreve Elon 2016/2017 (Silvester online)</a></li>
<li><a href="../de400363/index.html">Tief tauchen: vom CSS zum Transistor</a></li>
<li><a href="../de400365/index.html">Was VKontakte-Nutzer 2017 versprechen</a></li>
<li><a href="../de400371/index.html">2017 ist nicht nur ein Prime ...</a></li>
<li><a href="../de400377/index.html">Übersicht über aktuelle 3D-Materialien</a></li>
<li><a href="../de400379/index.html">Wie wir die Quest in Telegram arrangiert haben und was daraus wurde. UPD: Wir haben die Ergebnisse des Wettbewerbs zusammengefasst</a></li>
<li><a href="../de400381/index.html">Entwerfen eines Schaltnetzteils mit aktivem KKM. Folge I.</a></li>
<li><a href="../de400383/index.html">Resampling. Digitale Mauer gegen Verschwörungstheorie. Weihnachtsgeschichte für Liebhaber von klarem Klang</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>