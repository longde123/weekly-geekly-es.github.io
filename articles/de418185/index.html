<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐏 🤔 ↙️ Eine Autopsie-Geschichte: Wie wir Hancitor rückgängig gemacht haben 🖖🏽 🏞️ 👩🏿‍🔬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Für diejenigen, die bereits genug mit den Crackme-Rätseln gespielt haben , haben wir einen neuen Trojaner mitgebracht. In freier Wildbahn befindet sic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Eine Autopsie-Geschichte: Wie wir Hancitor rückgängig gemacht haben</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vyshtech/blog/418185/"><img src="https://habrastorage.org/webt/dn/-j/1o/dn-j1ohonpxz_urf0totdzgdxa4.jpeg"><br><br>  Für diejenigen, die bereits genug mit den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Crackme-Rätseln gespielt haben</a> , haben wir einen neuen Trojaner mitgebracht.  In freier Wildbahn befindet sich der Hancitor-Downloader immer noch in seinem natürlichen Lebensraum - Spam-Mailings.  Derzeit wird es aktiv zum Herunterladen des Panda-Banking-Trojaners verwendet, einer Modifikation des berüchtigten Zeus. <br><br>  An einem kalten Sommerabend trafen wir ihn von Angesicht zu Angesicht und sahen uns E-Mail-Spam an.  Wenn Sie sehen möchten, was die Malware unter der Haube hat, lesen Sie unsere neue umgekehrte Analyse. <br><a name="habracut"></a><br>  Unser schädliches Dokument sieht folgendermaßen aus: <br><br><img src="https://habrastorage.org/webt/am/z_/bu/amz_buin-rjqprnnk-v2xuaio28.png"><br><br>  Standardmäßig sind Makros blockiert, daher warnt das System: "Makros wurden deaktiviert."  Der Inhalt der Nachricht besagt jedoch, dass Makros enthalten sein sollten.  Nun, lass es uns tun.  Nach dem Klicken auf die Schaltfläche Inhalt aktivieren ist der Computer infiziert.  Nun wollen wir sehen, welche Art von Makro ausgeführt wird und wie genau die Infektion auftritt.  Dies kann sofort in Word erfolgen, indem Sie zur Registerkarte Ansicht-&gt; Vacros \ Ansichtsmakros wechseln. <br><br><img src="https://habrastorage.org/webt/ly/uq/kd/lyuqkdosmy1commpds7-nu96gsa.png"><br><br>  Sie können professioneller arbeiten - verwenden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Olevba</a> aus dem Oletools-Paket.  Sie können das Paket dort unter dem Link installieren.  Geben Sie als Nächstes olevba doc_file –c –decode&gt; source.txt ein und rufen Sie die Makroquelle ab. <br><br><img src="https://habrastorage.org/webt/tc/tk/gp/tctkgps17vavk9-zgtmzyjgparw.png"><br><br>  Mit dem Code möchte ich sofort sagen, dass der Trojaner zur Klasse der Downloader gehört.  Das Drehbuch entleert sich nur von irgendwo nach Malwara.  Um dies zu beweisen, dekodieren wir base64-Strings.  Es ist für uns bequemer, dies sofort über hiew zu tun, damit wir nicht hundertmal kopieren und einfügen.  Dazu verwenden wir ein spezielles Plugin, das hier beschrieben wird.  Folgendes ist passiert: <br><br><img src="https://habrastorage.org/webt/az/tv/jo/aztvjo9bo-8zxu7vaus2mzxadcc.png"><br><br>  Dies ist ein bösartiges Skript, das in zwei Teile unterteilt und als 1.hta gespeichert ist.  Grundsätzlich interessiert uns nicht besonders, wie es funktioniert.  Es ist alles ziemlich alltäglich.  Der einzige wichtige Punkt ist die Bestimmung der URL, unter der die schädliche Datei heruntergeladen wird.  Versuchen wir, ihn zu finden, da diese Informationen für die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sicherheit</a> nützlich sein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">können</a> .  Sie können Netzwerkregeln hinzufügen, um Anforderungen unter solchen URLs zu blockieren, wodurch das Unternehmen vor Infektionen geschützt wird. <br><br>  Ha!  Es gibt keine Links.  Aber woher kommt die 6.exe-Datei, die 1.hta startet?  Es ist Zeit, sich unsere Dock-Datei noch einmal genauer anzusehen, aber genauer: <br><br><img src="https://habrastorage.org/webt/b2/cc/y1/b2ccy1ewmolwz5wnaqojxdracbm.png"><br><br>  Ja, ein Exe-Shnik ist in das Dock-Dokument integriert.  Ja und schwer verpackt.  Lassen Sie uns erklären, was los ist.  Das Makro legt das schädliche 1.hta-Skript im Ordner Temp ab und startet es. 1.hta startet wiederum 6.exe aus seinem Verzeichnis.  Es ist klar, dass 6.exe der gleiche gepackte PE-Shnik ist, den wir auf dem Bildschirm sehen.  Aber jetzt fragen wir uns, wie 6.exe in% temp% sinkt.  Dies geschieht aufgrund einer interessanten Funktion in der Microsoft Office-Suite.  Tatsache ist, dass in jedes OLE-Dokument jede andere Datei im Ole10Native-Format eingebettet werden kann. <br><br>  Wenn dies der Fall ist, legt MS-Office selbst die auf diese Weise erstellte Datei beim Start im Ordner% temp% unter dem im Ole10Native-Strukturheader angegebenen Namen ab.  Schauen wir uns dieses Objekt an.  Das Plugin zum FAR-Manager - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">OLE2Viewer</a> - hat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">uns geholfen</a> .  Wir öffnen unser schädliches Dokument im Plugin, gehen in das Verzeichnis ObjectPool \ _1593522492 und sehen Folgendes: <br><br><img src="https://habrastorage.org/webt/cc/wn/mx/ccwnmx32xpqyiizulnovkdnrkla.png"><br><br>  Kopieren Sie diese Datei (Ole10Native) und öffnen Sie sie in der Ansicht. <br><br><img src="https://habrastorage.org/webt/vr/xb/37/vrxb37l9_urz13rlu0jvxphqpus.png"><br><br>  Hier sehen wir, unter welchem ​​Namen unser OLE-Objekt - 5c.pif in den Ordner% temp% verschoben wird.  Nun zurück zu unserem Makro.  Seine Aufgabe ist es, einen betrunkenen Exe-Shnik zu starten. <br><br><img src="https://habrastorage.org/webt/lo/wk/li/lowkli2uxojiyiq0gsoq6iuxh7e.png"><br><br>  Um genau zu sein, startet das Makro die abgelegte Datei nicht immer über 1.hta, sondern auch wie folgt: Shell "cmd.exe / c ping localhost -n 100 &amp;&amp;" &amp; Environ ("Temp") &amp; "\ 6 .pif ", vbHide <br><br><img src="https://habrastorage.org/webt/ut/8p/va/ut8pvaykzvbydqbqdfw3wuapvyy.png"><br><br>  Wie wir sehen, hängt die Startmethode vom Vorhandensein der folgenden Prozesse im System ab: bdagent.exe und PSUAMain.exe.  Warum brauchen Sie dann ping localhost -n 100?  Und dies ist ein altgriechischer Trick, um für alle Fälle eine künstliche Verzögerung zu erzeugen.  Normalerweise werden seine Variationen zur Selbstentfernung verwendet. <br><br>  Zu diesem Zeitpunkt haben wir den Betrieb eines schädlichen Dokuments untersucht.  Uns wurde klar, dass das Dokument selbst nicht zu Malware vom Typ Trojan-Downloader gehört, wie es auf den ersten Blick schien, sondern für den Typ Trojan-Dropper geeignet ist.  Folgendes ist beim Start passiert: <br><br><img src="https://habrastorage.org/webt/rd/qp/ki/rdqpkibxofr7rfrqloll1p_xf_q.png"><br><br>  Jetzt muss die Nutzlast selbst zerlegt werden.  Wir haben bereits festgestellt, dass unser Trojaner gepackt ist, also müssen wir ihn zuerst auspacken.  Normalerweise ist dieser Prozess in zwei Phasen unterteilt: <br>  1. Entfernen des entpackten Speicherauszugs + Wiederherstellen der Importtabelle. <br>  2. Analyse und Reinigung globaler Variablen. <br><br>  Wir brauchen die zweite Stufe, da es viele API-Funktionen gibt, die aufgrund ihrer Arbeit nicht wiederholte Werte an uns zurückgeben.  Beispielsweise gibt CreatHeap einen Heap-Deskriptor an uns zurück, der für die Arbeit weiter verwendet wird.  Sehr oft gibt es Typprüfungen im Code: <i>Wenn der Heap-Deskriptor == 0 ist, erhalten Sie den Heap-Deskriptor, andernfalls verwenden Sie einen bereits initialisierten</i> .  Zum Zeitpunkt des Dumps wurde die Variable, die den angegebenen Deskriptor enthielt, bereits von ihm initialisiert, und zu diesem Zeitpunkt war der Deskriptor gültig.  Wenn wir versuchen, den Speicherauszug zu starten, enthält die Variable mit unserem Deskriptor den alten Wert, d. H. Nicht gleich 0, was bedeutet, dass der Test bestanden wird. <br><br>  Sobald das Programm versucht, diesen Deskriptor zu verwenden, löst das Betriebssystem eine Ausnahme aus und das Programm stürzt mit einem Fehler ab.  Um dies zu vermeiden, müssen Sie diese Variablen auf Null setzen.  Sie befinden sich normalerweise in einem beschreibbaren Abschnitt der Daten.  Wahrscheinlich schlagen Sie vor, diesen Abschnitt im Hex-Editor zu öffnen und alles mit Nullen zu überschreiben?  Sie haben teilweise Recht, aber Sie sollten keine vorschnellen Maßnahmen ergreifen.  Es gibt Trojaner, die Variablen nicht auf 0, sondern auf einem zufälligen DWORD prüfen.  Und je nachdem, ob der Test getestet wird oder nicht, werden verschiedene Maßnahmen ergriffen.  Sie müssen für Beispiele nicht weit gehen.  Schauen Sie sich nur den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Cridex an</a> (vor kurzem ist er irgendwo vom Radar verschwunden, anscheinend wurde er vollständig auf EMOTETA aktualisiert). <br><br>  Lassen Sie uns also unser Beispiel ausführen (natürlich in einer virtuellen Maschine).  Es ist auch wünschenswert, dass der Datenverkehr, der die virtuelle Maschine verlässt, über ein VPN erfolgt. <br><br>  Wir starten unseren Trojaner und er hängt einfach dabei.  Großartig!  In der Regel erledigen Trojaner die Dinge schnell und enden dann sofort und zerstören sich selbst.  Daher müssen Sie im Code nach Stellen suchen, die für diese Aktionen verantwortlich sind, sie unterbrechen und dann sichern.  In unserem Fall können wir es einfach so machen. <br><br>  Für den Dump verwenden wir das wunderbare Dienstprogramm Process Dump, das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> zu finden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ist</a> .  Dieses Dienstprogramm findet nicht nur alle versteckten ausführbaren Module und gibt sie aus, sondern stellt auch die Importtabelle selbst wieder her.  Das Dienstprogramm muss folgendermaßen als Administrator ausgeführt werden: pd / pid xxxx, wobei xxxx die ID des Trojanerprozesses ist.  Danach speichert das Dienstprogramm alle Prozessmodule.  Wir haben die zusätzlichen entfernt und dies ist, was bleibt: <br><br><img src="https://habrastorage.org/webt/tg/je/db/tgjedb068z9unx10xyhit2dftii.png"><br><br>  Der Name der ausführbaren Datei des Trojaner-Prozesses lautet 1.exe.  Es stellt sich heraus, dass sich der entpackte Trojaner bei 0x2C0000 befand.  Öffnen Sie es in hiew: <br><br><img src="https://habrastorage.org/webt/84/je/fc/84jefcffxabgt-pihoargfo-raa.png"><br><br>  Nur ein Auge glücklich!  Jetzt ist die Datei entpackt, sie ist deutlich sichtbar.  Die Importtabelle wurde ebenfalls erkannt.  Öffnen wir es in IDA-PRO. <br><br><img src="https://habrastorage.org/webt/fn/hd/nc/fnhdncwcqiqd7jx_f7m8czjyf3m.png"><br><br>  Wir haben bereits einige Funktionen umbenannt, während wir das Beispiel sortiert haben.  Der Trojaner beginnt zunächst mit der Ermittlung der Ladeadresse seines Moduls.  Und wirklich: Woher wusste er, an welcher Adresse sein Stummel ausgepackt war?  Dies geschieht mit einer alten, bewährten Technik - das Umblättern einer Speicherseite bei 0x1000 relativ zur aktuellen Adresse, bis wir auf die "MZ" -Bytes stoßen.  Dies funktioniert, weil ausführbare Module das Betriebssystem immer an einer Adresse laden, die ein Vielfaches von 0x1000 ist.  Überzeugen Sie sich selbst.  In unserem Fall ist eine Grenze von 100 Abisolieren festgelegt. <br><br><img src="https://habrastorage.org/webt/7z/cy/5c/7zcy5cbgu4nls8b9yxz8gv9x3ai.png"><br><br>  Wenn jemand nicht versteht, wo es ein Zurückdrehen gibt, dann ist hier: <br>  Ergebnis + = 0xFFFFF000 entspricht Ergebnis - = 0x1000. <br><br>  Nach Erhalt der Download-Adresse seines Moduls erhält der entpackte Trojaner die Adressen der für seinen Betrieb erforderlichen Funktionen.  Zunächst werden die Adressen zweier Funktionen durchsucht - LoadLibraryA und GetProcAddress.  Wenn Sie die Adressen dieser Funktionen kennen, können Sie sie verwenden, um den Rest abzurufen.  Diese Funktionen befinden sich in der Kernel32-Bibliothek.  Seine Adresse wird durch Lesen des ersten Elements (null - ntdll, erste Kernelbasis usw.) der Ringliste erhalten, das alle Module beschreibt, die in der Initialisierungsreihenfolge mit der Struktur _LDR_DATA_TABLE_ENTRY geladen wurden.  Der Zeiger auf die Liste wird aus dem PEB gezogen. <br><br><img src="https://habrastorage.org/webt/zx/o3/s3/zxo3s3kevu7prcaoffacdxvklow.png"><br><br>  Nachdem der Trojaner die Adresse kernel32.dll (beginnend mit Windows 7 - kernelBase.dll) erhalten hat, kann er seine Exporttabelle manuell analysieren und die erforderlichen zwei Funktionen finden, die vorhersehbar in der Subroutine sub_EF1E60 ausgeführt werden. <br><br><img src="https://habrastorage.org/webt/7k/xz/4v/7kxz4vk7-ad4q4d221g-ealmkko.png"><br><br>  Schauen Sie sich nun die Funktion an, die wir getHeap genannt haben. <br><br><img src="https://habrastorage.org/webt/qc/gv/oz/qcgvozmioggzgsidsap-5frkfas.png"><br><br>  Hier beobachten wir nur die oben beschriebene Situation.  Zum Zeitpunkt des Dumps enthielt die Variable hHeap einen Wert von 600000h.  Daher wird GetProcessHeap nicht aufgerufen.  Stattdessen wechselt das Programm zum Label loc_EF11DD, wo HeapAlloc mit einem ungültigen Handle aufgerufen wird, was zu einem Fehler führt.  Deshalb nehmen wir den Hex-Editor und setzen diese Zahl auf Null.  Wir haben sechs ähnliche Orte gezählt. <br><br>  Als nächstes beginnt der Spaß.  Der Trojaner generiert eine eindeutige Client-ID basierend auf der Seriennummer der Festplatte und der MAC-Adresse.  Hier erhaltene Informationen: <br><br><img src="https://habrastorage.org/webt/hx/fo/ce/hxfoceeap2k3oqut_yjgwqsjnwu.png"><br><br>  Wir erhalten auch Folgendes: IP-Adresse, Betriebssystemversion, Netzwerkname und Benutzername.  Basierend auf all dem wird eine HTTP-Anfrage an das Admin-Panel generiert, deren Adresse wir noch nicht kennen.  Es ist nicht in den Zeilen (auch in der ausgepackten Form).  Aber es ist nicht da, weil es in der Konfiguration verschlüsselt ist.  Die Adresse kann dem Code entnommen werden: <br><br><img src="https://habrastorage.org/webt/vw/9n/ej/vw9nej-cbxk5jgjljgjgasiwikw.png"><br><br>  Die Konfiguration wiegt 0x2008 Bytes und hat das folgende Format: Die ersten 8 Bytes sind der RC4-Schlüssel, 0x2000 Bytes sind verschlüsselte Daten. <br><br><img src="https://habrastorage.org/webt/tf/ne/je/tfneje_zc_aeq5nzmnzmkfd5r6c.png"><br><br>  Die Tatsache, dass der RC4-Verschlüsselungsalgorithmus verwendet wird, wird aus der folgenden Auflistung deutlich: <br><br><img src="https://habrastorage.org/webt/4g/jc/ci/4gjccirc5sxslir_xgfoiytzjhc.png"><br><br>  Bitte beachten Sie, dass die ersten 8 Bytes allein nicht der Schlüssel zu RC4 sind.  Der Schlüssel ist der SHA1-Hash dieser Bytes.  Sie müssen auch das Flag 0x280011 für die Funktion CryptDeriveKey beachten.  MSDN hat einen Haftungsausschluss zu diesem Flag: <br><br><img src="https://habrastorage.org/webt/_t/2m/lu/_t2mlufhbsvpfivk9knvzdnoas0.png"><br><br>  Daraus wird klar, dass die hohen 16 Bits dieses Flags die Schlüsselgröße in Bits festlegen.  Das heißt, in Bytes ist die Schlüsselgröße: (0x280011 &gt;&gt; 16) / 8 = 5. Daher sind die Schlüssel die ersten fünf Bytes aus dem Hash aus den ersten acht Bytes der Konfiguration.  Lassen Sie uns die Konfiguration sichern und ein Python-Skript schreiben, das sie für uns entschlüsselt.  Das Skript sieht folgendermaßen aus: <br><br><img src="https://habrastorage.org/webt/fo/ow/7t/foow7ta0eo02epz-qp8vtkiozfy.png"><br><br>  Das Ergebnis seiner Arbeit war die Datei config.rc4.  Öffnen Sie es in hiew: <br><br><img src="https://habrastorage.org/webt/rc/tz/dj/rctzdjyqwmh4ysz7pt7lhahlpna.png"><br><br>  Wir sehen eine entschlüsselte Liste von Admin-Bereichen.  Das erste Wort ist "19nep07" - Build-Nummer.  Dafür sind 16 Bytes zugeordnet.  Als nächstes folgt eine Liste von Administrator-URLs, die durch "|" getrennt sind. <br><br>  Der erste Aufruf des Admin-Panels hat also das folgende Format: <br>  GUID = 3068075364164635648 &amp; BUILD = 19nep07 &amp; INFO = WIN-56G04BL06SL @ WIN -56G04BL06SL \ Reverse &amp; IP = 35.0.127.52 &amp; TYPE = 1 &amp; WIN = 6.1 (x32 <br><br><img src="https://habrastorage.org/webt/1e/5o/bg/1e5obgayvnhe8mlproaehfms000.png"><br><br>  Anschließend wird die generierte Anforderung zuerst in der Admin-Panel-Liste gesendet. <br><br><img src="https://habrastorage.org/webt/ou/u8/ue/ouu8ueyhzcz_3hh2zbkmdh_hqvw.png"><br><br>  Als nächstes wird die Antwort des Administrators natürlich gelesen, wenn sie noch aktiv ist.  Die Antwort sollte base64-codiert sein.  Ist dies nicht der Fall, wird der nächste Administrator aus der Liste genommen.  Manchmal geben lebende Administratoren eine seltsame Antwort zurück: <br><br><img src="https://habrastorage.org/webt/lu/d_/uo/lud_uoa61fkscmma-05nbxlkoic.png"><br><br>  Es ist bekannt, nicht wahr?  Ja, das sind die gleichen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zahlen</a> !  Tatsächlich weiß ein Autor, warum der Administrator beginnt, sie zurückzugeben!  In normaler Form gibt der Befehl zurück.  Leider ist es unmöglich, mit absoluter Sicherheit zu sagen, wie das Antwortformat aussehen wird, da kein Datenverkehr vorhanden ist und alle Administratoren tot sind.  Die dekodierte Datei wird zusätzlich zu 0x7A dekodiert: <br><br><img src="https://habrastorage.org/webt/f0/sc/8k/f0sc8kchkod-u2luugrrlty75t8.png"><br><br>  Die Antwort sollte einen Befehl enthalten.  Ist dies nicht der Fall, wird das nächste Admin-Panel angerufen.  Der Befehlscode wird als "x:" codiert, wobei x der Buchstabe ist, der einen bestimmten Befehl codiert.  Es gibt 7 von ihnen: 'r', 'l', 'e', ​​'b', 'd', 'c', 'n'.  Betrachten Sie die Befehle "b" und "r". <br><br>  Die Handler dieser Befehle haben dieselbe Funktion.  Wir haben es wie GetExe genannt.  So sieht es aus: <br><br><img src="https://habrastorage.org/webt/_a/rz/lk/_arzlkrepv0wjyhlt0k4krtjtv8.png"><br><br>  Ich denke hier ist alles klar.  Der Trojaner stellt eine http-Anfrage und die ausführbare Datei wird als Antwort in komprimierter Form zurückgegeben, die dann dekomprimiert wird.  Dann sind Variationen möglich.  Im Fall des Befehls "b" werden die folgenden drei Aktionen ausgeführt: <br><br>  <b>1. Erstellung des Svchost-Prozesses in gefrorener Form</b> <br><br><img src="https://habrastorage.org/webt/lz/yw/cy/lzywcy3d56o5tmkxdz8yu5ttvp4.png"><br><br>  <b>2. Injektion in den Adressraum des heruntergeladenen Modulprozesses</b> <br><br><img src="https://habrastorage.org/webt/7b/ab/fe/7babfemu0nyrag5bv6jtadst3o8.png"><br><br>  <b>3. Kontrollieren Sie die Übertragung zum injizierten Modul</b> <br><br><img src="https://habrastorage.org/webt/xj/m4/i5/xjm4i5ch6cpnogd79cz47tn1pny.png"><br><br>  Im Fall des Befehls r werden die folgenden drei Aktionen ausgeführt: <br>  1. Laden Sie die ausführbare Datei herunter, indem Sie die GetExe-Funktion aufrufen. <br>  2. Speichern Sie die heruntergeladene Datei in einem temporären Ordner unter einem zufälligen Namen. <br>  3. Starten Sie eine abgelegte Datei. <br><br><img src="https://habrastorage.org/webt/qk/go/sj/qkgosjsrb_45ny1kkfi7cguuvbm.png"><br><br>  Fertig <br><br>  PS Das nächste Mal können wir entweder den Panda oder einen Kryptor analysieren.  Schreiben Sie in die Kommentare, an welcher Malware Sie am meisten interessiert sind (natürlich zu Forschungszwecken). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de418185/">https://habr.com/ru/post/de418185/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de418169/index.html">Was ist neu in Veeam Availability Console 2.0 Update 1?</a></li>
<li><a href="../de418171/index.html">Auf welche Metriken sollten Sie sich verlassen, wenn Benutzer nur wenige Conversions auf der Website durchführen?</a></li>
<li><a href="../de418173/index.html">Roundtrip für neuronale Netze oder eine Überprüfung der Verwendung von Auto-Encodern in der Textanalyse</a></li>
<li><a href="../de418177/index.html">Bearbeiten von .heic-Bildern ohne Farbverlust</a></li>
<li><a href="../de418183/index.html">Anwendung der Sprachanalyse in der Wirtschaft</a></li>
<li><a href="../de418187/index.html">In Amerika wurde vorgeschlagen, alle Bibliotheken durch Amazon-Hubs zu ersetzen. Die Öffentlichkeit ist empört</a></li>
<li><a href="../de418189/index.html">Erbe des Zeus: Warum der IcedID-Trojaner für Bankkunden gefährlich ist</a></li>
<li><a href="../de418191/index.html">Analoge in Python und JavaScript. Teil drei</a></li>
<li><a href="../de418193/index.html">Wie fühlt es sich an, 2017 ein Spiel für Game Boy zu erstellen?</a></li>
<li><a href="../de418195/index.html">MIT-Kurs "Computer Systems Security". Vorlesung 4: „Privilegien teilen“, Teil 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>