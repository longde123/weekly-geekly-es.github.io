<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∞üèº üë®‚Äçüë©‚Äçüë¶‚Äçüë¶ üà∏ Angular 9 e Ivy: carregamento lento de componentes üë©üèæ‚Äçüî¨ üñ±Ô∏è üë®üèæ‚Äçüéì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Carregamento lento de componentes em Angular? Talvez estejamos falando de m√≥dulos de carregamento lento usando o roteador Angular? N√£o, estamos faland...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Angular 9 e Ivy: carregamento lento de componentes</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/484618/">  Carregamento lento de componentes em Angular?  Talvez estejamos falando de m√≥dulos de carregamento lento usando o roteador Angular?  N√£o, estamos falando sobre os componentes.  A vers√£o atual do Angular suporta apenas o carregamento lento do m√≥dulo.  Mas Ivy oferece ao desenvolvedor novas oportunidades de trabalhar com componentes. <br><br> <a href="https://habr.com/ru/company/ruvds/blog/484618/"><img src="https://habrastorage.org/webt/ox/8d/ub/ox8dubshhrdlijoson4_gyjtarw.png"></a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">A carga lenta que usamos at√© agora: rotas</font> </h2><br>  O carregamento lento √© um √≥timo mecanismo.  No Angular, voc√™ pode usar esse mecanismo sem ter que fazer quase nenhum esfor√ßo declarando rotas que suportam carregamento lento.  Aqui est√° um exemplo da <a href="https://angular.io/guide/lazy-loading-ngmodules">documenta√ß√£o</a> Angular <a href="https://angular.io/guide/lazy-loading-ngmodules">que</a> demonstra isso: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> routes: Routes = [     { <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">'customer-list'</span></span>,       <span class="hljs-attr"><span class="hljs-attr">loadChildren</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(<span class="hljs-string"><span class="hljs-string">'./customers/customers.module'</span></span>).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m</span></span></span><span class="hljs-function"> =&gt;</span></span> m.CustomersModule) }     ];</code> </pre> <br>  Gra√ßas ao c√≥digo acima, ser√° criado um fragmento separado para <code>customers.module</code> , que ser√° carregado quando o usu√°rio navegar pela rota da <code>customer-list</code> . <br><br>  Essa √© uma maneira muito agrad√°vel de reduzir o tamanho do pacote principal do projeto e acelerar o carregamento inicial do aplicativo. <br><br>  Mas, apesar disso, n√£o seria bom poder controlar com mais precis√£o o carregamento lento?  Por exemplo, e se pud√©ssemos organizar o carregamento lento de componentes individuais? <br><br>  At√© agora, isso n√£o foi poss√≠vel.  Mas tudo isso mudou com o advento de Ivy. <br><br><h2>  <font color="#3AC1EF">Ivy e o conceito de "localidade"</font> </h2><br>  M√≥dulos s√£o o conceito b√°sico e o componente b√°sico de qualquer aplicativo Angular.  Os m√≥dulos declaram componentes, diretrizes, tubula√ß√µes, servi√ßos. <br><br>  Um aplicativo Angular moderno n√£o pode existir sem m√≥dulos.  Uma raz√£o para isso √© o fato de o ViewEngine adicionar todos os metadados necess√°rios aos m√≥dulos. <br><br>  Ivy, por outro lado, adota uma abordagem diferente.  No Ivy, um componente pode existir sem um m√≥dulo.  Isso √© poss√≠vel gra√ßas ao conceito de localidade.  Sua ess√™ncia √© que todos os metadados s√£o locais para o componente. <br><br>  Vamos explicar isso analisando o pacote configur√°vel es2015 gerado usando o Ivy. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/02b/775/370/02b7753703a0599491c3f9076527168f.png"></div><br>  <i><font color="#999999">Pacote configur√°vel Es2015 gerado usando Ivy</font></i> <br><br>  Na se√ß√£o <code>Component code</code> do <code>Component code</code> , voc√™ pode ver que o sistema Ivy salvou o c√≥digo do componente.  N√£o h√° nada de especial aqui.  Mas, em seguida, Ivy adiciona alguns metadados ao c√≥digo. <br><br>  O primeiro peda√ßo de metadados √© mostrado na figura como uma <code>Component factory</code> .  A f√°brica sabe como instanciar um componente.  Na se√ß√£o <code>Component metadata</code> do <code>Component metadata</code> , o Ivy coloca atributos adicionais, como <code>type</code> e <code>selectors</code> , ou seja, tudo o que o componente precisa durante a execu√ß√£o do programa. <br><br>  Vale ressaltar que Ivy adiciona a fun√ß√£o de <code>template</code> aqui.  √â mostrado na <code>Compiled version of your template</code> se√ß√£o <code>Compiled version of your template</code> .  Vamos nos debru√ßar sobre esse fato interessante com mais detalhes. <br><br>  A fun√ß√£o de <code>template</code> √© uma vers√£o compilada do nosso c√≥digo HTML.  Ela segue as instru√ß√µes da Ivy para criar um DOM.  Isso √© diferente de como o ViewEngine funciona. <br><br>  O sistema ViewEngine pega o c√≥digo e o ignora.  Angular executar√° o c√≥digo se o usarmos. <br><br>  E com a abordagem usada por Ivy, o componente que chama os comandos Angular √© respons√°vel por tudo.  Essa altera√ß√£o permite que os componentes existam independentemente, isso leva ao fato de que o algoritmo de agita√ß√£o de √°rvore pode ser aplicado ao c√≥digo base Angular. <br><br><h2>  <font color="#3AC1EF">Um exemplo real de carregamento lento de componentes</font> </h2><br>  Agora que sabemos que o carregamento lento de componentes √© poss√≠vel, considere-o com um exemplo real.  Nomeadamente, criaremos um aplicativo de question√°rio que far√° perguntas ao usu√°rio com op√ß√µes de resposta. <br><br>  O aplicativo exibe uma imagem da cidade e op√ß√µes a partir das quais voc√™ precisa escolher o nome dessa cidade.  Assim que o usu√°rio selecionar uma op√ß√£o, clicando no bot√£o correspondente, esse bot√£o ser√° alterado imediatamente, indicando se a resposta estava certa ou errada.  Se o fundo do bot√£o ficar verde, a resposta estava correta.  Se o fundo ficar vermelho, significa que a resposta estava incorreta. <br><br>  Depois que a resposta √† pergunta atual √© recebida, o programa exibe a seguinte pergunta.  Aqui est√° como fica. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2fc/768/ece/2fc768ecebd5c52399030c0d2dc47c66.gif"></div><br>  <i><font color="#999999">Quiz Demo</font></i> <br><br>  As perguntas que o programa faz ao usu√°rio s√£o representadas pelo componente <code>QuizCardComponent</code> . <br><br><h2>  <font color="#3AC1EF">Conceito de carregamento de componentes pregui√ßosos</font> </h2><br>  Vamos primeiro ilustrar a id√©ia geral de carregar pregui√ßosamente o componente <code>QuizCardComponent</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ab/45a/b2b/4ab45ab2b677ce0d886d2f26a5645edb.png"></div><br>  <i><font color="#999999">O processo do componente QuizCardComponent</font></i> <br><br>  Depois que o usu√°rio inicia o teste, clicando no bot√£o <code>Start quiz</code> , iniciamos o carregamento lento do componente.  Depois que o componente estiver √† nossa disposi√ß√£o, colocamos em um recipiente. <br><br>  Reagimos aos eventos <code>questionAnsvered</code> de um componente ‚Äúpregui√ßoso‚Äù da mesma maneira que responder√≠amos aos eventos de um componente regular.  Ou seja, ap√≥s a ocorr√™ncia do evento, exibimos na tela o pr√≥ximo cart√£o com a pergunta. <br><br><h2>  <font color="#3AC1EF">An√°lise de c√≥digo</font> </h2><br>  Para entender o que acontece durante o carregamento lento de um componente, come√ßamos com uma vers√£o simplificada do <code>QuizCardComponent</code> , que exibe as propriedades da pergunta. <br><br>  Em seguida, expandiremos esse componente usando componentes de material angular.  E no final, ajustaremos a rea√ß√£o aos eventos gerados pelo componente. <br><br>  Vamos organizar o carregamento lento de uma vers√£o simplificada do componente <code>QuizCardComponent</code> , que possui o seguinte modelo: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Here's the question<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>Image: <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span> {{ question.image }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>Possible selections: <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span> {{ question.possibleSelections.toString() }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>Correct answer: <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span> {{ question.correctAnswer }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  O primeiro passo √© criar um elemento de cont√™iner.  Para fazer isso, podemos usar um elemento real, como <code>&lt;div&gt;</code> , ou - recorrer ao <code>ng-container</code> , o que nos permite fazer sem um n√≠vel adicional de c√≥digo HTML.  √â assim que a declara√ß√£o do elemento container se parece com a qual colocamos o componente "pregui√ßoso": <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-toolbar</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"primary"</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span>City quiz<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-toolbar</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> *</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngIf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"!quizStarted"</span></span></span><span class="hljs-tag">        </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mat-raised-button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"primary"</span></span></span><span class="hljs-tag">        </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"start-quiz-button"</span></span></span><span class="hljs-tag">        (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">)=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"startQuiz()"</span></span></span><span class="hljs-tag">&gt;</span></span>Start quiz<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ng-container</span></span></span><span class="hljs-tag"> #</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">quizContainer</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"quiz-card-container"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ng-container</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  No componente, voc√™ precisa acessar o cont√™iner.  Para isso, usamos a anota√ß√£o <code>@ViewChild</code> e <code>@ViewChild</code> que queremos ler o <code>ViewContainerRef</code> . <br><br>  Observe que no Angular 9, a propriedade <code>static</code> na anota√ß√£o <code>@ViewChild</code> √© definida como <code>false</code> por padr√£o: <br><br><pre> <code class="javascript hljs">@ViewChild(<span class="hljs-string"><span class="hljs-string">'quizContainer'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">read</span></span>: ViewContainerRef}) quizContainer: ViewContainerRef;</code> </pre> <br>  Agora temos um cont√™iner no qual queremos adicionar o componente "pregui√ßoso".  Em seguida, precisamos de <code>ComponentFactoryResolver</code> e <code>Injector</code> .  Ambos podem ser adquiridos recorrendo √† metodologia de inje√ß√£o de depend√™ncia. <br><br>  A entidade <code>ComponentFactoryResolver</code> √© um registro simples que estabelece o relacionamento entre componentes e as classes <code>ComponentFactory</code> geradas automaticamente que podem ser usadas para instanciar componentes: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(private quizservice: QuizService,            private cfr: ComponentFactoryResolver,            private injector: Injector) { }</code> </pre> <br>  Agora, temos tudo o que √© necess√°rio para atingir a meta.  <code>startQuiz</code> trabalhar no conte√∫do do m√©todo <code>startQuiz</code> e organizar o carregamento lento do componente: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {QuizCardComponent} = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(<span class="hljs-string"><span class="hljs-string">'./quiz-card/quiz-card.component'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> quizCardFactory = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cfr.resolveComponentFactory(QuizCardComponent); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {instance} = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.quizContainer.createComponent(quizCardFactory, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.injector); instance.question = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.quizservice.getNextQuestion();</code> </pre> <br>  Podemos usar o comando <code>import</code> ECMAScript para organizar o carregamento lento do <code>QuizCardComponent</code> .  Uma express√£o de importa√ß√£o retorna uma promessa.  Voc√™ pode trabalhar com ele usando a constru√ß√£o <code>async/await</code> ou usando o manipulador <code>.then</code> .  Depois de resolver a promessa, usamos a desestrutura√ß√£o para criar uma inst√¢ncia do componente. <br><br>  Atualmente, voc√™ deve usar o <code>ComponentFactory</code> para fornecer compatibilidade com vers√µes anteriores.  No futuro, a linha correspondente n√£o ser√° necess√°ria, pois poderemos trabalhar diretamente com o componente. <br><br>  A f√°brica da <code>ComponentFactory</code> nos fornece <code>componentRef</code> .  Passamos <code>componentRef</code> e <code>Injector</code> para o m√©todo <code>createComponent</code> do cont√™iner. <br><br>  O m√©todo <code>createComponent</code> retorna um <code>ComponentRef</code> que a inst√¢ncia do componente est√° contida.  Usamos <code>instance</code> para passar as <code>@Input</code> do componente. <br><br>  No futuro, tudo isso provavelmente poder√° ser feito usando o m√©todo Angular <code>renderComponent</code> .  Este m√©todo ainda √© experimental.  No entanto, √© muito prov√°vel que ele se transforme em um m√©todo Angular regular.  <a href="https://github.com/LayZeeDK/ivy-dynamic-rendering">Aqui est√£o</a> materiais √∫teis sobre esse t√≥pico. <br><br>  Isso √© tudo o que √© necess√°rio para organizar o carregamento lento de um componente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d4/2bd/4bc/2d42bd4bc38ee01c427c94286e060cbb.png"></div><br>  <i><font color="#999999">Carregamento lento de componentes</font></i> <br><br>  Depois que o bot√£o <code>Start quiz</code> √© pressionado, o carregamento lento do componente come√ßa.  Se voc√™ abrir a guia <code>Network</code> das ferramentas do desenvolvedor, poder√° ver o processo de carregamento lento do fragmento de c√≥digo representado pelo arquivo <code>quiz-card-quiz-card-component.js</code> .  Ap√≥s carregar e processar o componente √© exibido, o usu√°rio v√™ um cart√£o de perguntas. <br><br><h2>  <font color="#3AC1EF">Extens√£o de componente</font> </h2><br>  No momento, estamos carregando o componente <code>QuizCardComponent</code> .  Isso √© muito bom  Mas nossa aplica√ß√£o ainda n√£o √© particularmente funcional. <br><br>  Vamos corrigir isso adicionando recursos e componentes adicionais de material angular a ele: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"quiz-card"</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-header</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mat-card-avatar</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"quiz-header-image"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-title</span></span></span><span class="hljs-tag">&gt;</span></span>Which city is this?<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-title</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-subtitle</span></span></span><span class="hljs-tag">&gt;</span></span>Click on the correct answer below<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-subtitle</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-header</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"image"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mat-card-image</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"'assets/' + question.image"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">alt</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Photo of a Shiba Inu"</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-actions</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"answer-section"</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"answeredCorrectly !== undefined"</span></span></span><span class="hljs-tag"> *</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngFor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"let selection of question.possibleSelections"</span></span></span><span class="hljs-tag">            </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mat-stroked-button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"primary"</span></span></span><span class="hljs-tag">            [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngClass</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{              'correct': answeredCorrectly &amp;&amp; selection === question.correctAnswer,              'wrong': answeredCorrectly === false &amp;&amp; selection === question.correctAnswer             }"</span></span></span><span class="hljs-tag">            (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">)=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"answer(selection)"</span></span></span><span class="hljs-tag">&gt;</span></span>      {{selection}}    <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-actions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  N√≥s inclu√≠mos alguns componentes de material bonitos no componente.  E os m√≥dulos correspondentes? <br><br>  √â claro que eles podem ser adicionados ao <code>AppModule</code> .  Mas isso significa que esses m√≥dulos ser√£o carregados no modo "ganancioso".  E isso n√£o √© uma boa ideia.  Al√©m disso, a montagem do projeto falhar√°, com a seguinte mensagem: <br><br><pre> <code class="javascript hljs">ERROR <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> src/app/quiz-card/quiz-card.component.html:<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> - error TS<span class="hljs-number"><span class="hljs-number">-998001</span></span>: <span class="hljs-string"><span class="hljs-string">'mat-card'</span></span> is not a known element: <span class="hljs-number"><span class="hljs-number">1.</span></span> If <span class="hljs-string"><span class="hljs-string">'mat-card'</span></span> is an Angular component, then verify that it is part <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>. <span class="hljs-number"><span class="hljs-number">2.</span></span> If <span class="hljs-string"><span class="hljs-string">'mat-card'</span></span> is a Web Component then add <span class="hljs-string"><span class="hljs-string">'CUSTOM_ELEMENTS_SCHEMA'</span></span> to the <span class="hljs-string"><span class="hljs-string">'@NgModule.schemas'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> component to suppress <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> message.</code> </pre> <br>  O que fazer  Como voc√™ provavelmente j√° entendeu, esse problema √© completamente solucion√°vel.  Isso pode ser feito usando m√≥dulos. <br><br>  Mas desta vez vamos us√°-los um pouco diferente do que antes.  Adicionaremos um pequeno m√≥dulo ao mesmo arquivo que <code>QuizCardComponent</code> (no arquivo <code>quizcard.component.ts</code> ): <br><br><pre> <code class="javascript hljs">@NgModule({  <span class="hljs-attr"><span class="hljs-attr">declarations</span></span>: [QuizCardComponent],  <span class="hljs-attr"><span class="hljs-attr">imports</span></span>: [CommonModule, MatCardModule, MatButtonModule] }) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QuizCardModule</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre> <br>  Observe que n√£o h√° declara√ß√£o de <code>export</code> . <br><br>  Esta especifica√ß√£o do m√≥dulo pertence exclusivamente ao nosso componente, carregado no modo lento.  Como resultado, o √∫nico componente declarado no m√≥dulo ser√° <code>QuizCardComponent</code> .  A se√ß√£o de importa√ß√£o importa apenas os m√≥dulos que nosso componente precisa. <br><br>  N√£o exportamos o novo m√≥dulo para que os m√≥dulos carregados no modo ganancioso n√£o possam import√°-lo. <br><br>  Reinicie o aplicativo e veja como ele se comporta quando voc√™ clica no bot√£o <code> Start quiz</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc5/4bf/c60/bc54bfc6057cc6707e4f01a5bf871de9.png"></div><br>  <i><font color="#999999">An√°lise de Aplica√ß√£o Modificada</font></i> <br><br>  √ìtimo!  O componente <code>QuizCardComponent</code> carregado no modo lento e adicionado ao <code>ViewContainer</code> .  Todas as depend√™ncias necess√°rias s√£o carregadas com ele. <br><br>  Analisaremos o pacote de aplicativos usando a <code>webpack-bundle-analyze</code> fornecida pelo m√≥dulo npm correspondente.  Permite visualizar o conte√∫do dos arquivos que o Webpack produz e examinar o esquema resultante. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d2a/a5a/2aa/d2aa5a2aae380755aca3872db6d068f9.png"></div><br>  <i><font color="#999999">An√°lise de pacote de aplicativos</font></i> <br><br>  O tamanho do pacote principal do aplicativo √© de aproximadamente 260 Kb.  Se fizermos o download do componente <code>QuizCardComponent</code> junto com ele, o tamanho dos dados baixados ser√° de aproximadamente 270 Kb.  Acontece que conseguimos reduzir o tamanho do pacote principal em 10 Kb, carregando apenas um componente no modo lento.  Bom resultado! <br><br>  O c√≥digo do <code>QuizCardComponent</code> ap√≥s a montagem chega a um arquivo separado.  Se voc√™ analisar o conte√∫do desse arquivo, verifica-se que n√£o h√° apenas o c√≥digo <code>QuizCardComponent</code> , mas tamb√©m os m√≥dulos de material usados ‚Äã‚Äãneste componente. <br><br>  Embora <code>QuizCardComponent</code> use <code>MatButtonModule</code> e <code>MatCardModule</code> , apenas <code>MatCardModule</code> entra no <code>MatCardModule</code> c√≥digo finalizado.  A raz√£o para isso √© que tamb√©m usamos o <code>MatButtonModule</code> no <code>AppModule</code> , exibindo o bot√£o <code>Start quiz</code> .  Como resultado, o c√≥digo correspondente cai em outro fragmento do pacote. <br><br>  Agora organizamos o carregamento lento do <code>QuizCardComponent</code> .  Este componente exibe um cart√£o, projetado no estilo Material, contendo uma imagem, uma pergunta e bot√µes com op√ß√µes de resposta.  O que acontece agora se voc√™ clicar em um desses bot√µes? <br><br>  O bot√£o, dependendo de conter a resposta certa ou errada, fica verde ou vermelho quando pressionado.  O que mais est√° acontecendo?  Nada.  E precisamos que, depois de responder uma pergunta, um cart√£o de outra pergunta seja exibido.  Corrija. <br><br><h2>  <font color="#3AC1EF">Manipula√ß√£o de eventos</font> </h2><br>  O aplicativo n√£o mostra um novo cart√£o de pergunta quando voc√™ clica no bot√£o de resposta devido ao fato de ainda n√£o termos configurado mecanismos para responder a eventos de componentes carregados no modo lento.  J√° sabemos que o componente <code>QuizCardComponent</code> gera eventos usando o <code>EventEmitter</code> .  Se voc√™ olhar para a defini√ß√£o da classe <code>EventEmitter</code> , poder√° descobrir que ela √© descendente de <code>Subject</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> declare <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventEmitter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">any</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Subject</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre> <br>  Isso significa que o <code>EventEmitter</code> possui um m√©todo de <code>subscribe</code> , que permite configurar a resposta do sistema aos eventos que ocorrem: <br><br><pre> <code class="javascript hljs">instance.questionAnswered.pipe(    takeUntil(instance.destroy$) ).subscribe(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showNewQuestion());</code> </pre> <br>  Aqui, <code>showNextQuestion</code> o fluxo <code>questionAnswered</code> e chamamos o m√©todo <code>showNextQuestion</code> , que executa a l√≥gica <code>lazyLoadQuizCard</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> showNewQuestion() {  <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.lazyLoadQuizCard(); }</code> </pre> <br>  A constru√ß√£o <code>takeUntil(instance.destroy$)</code> √© necess√°ria para limpar a assinatura executada ap√≥s a destrui√ß√£o do componente.  Se o gancho <code>ngOnDestroy</code> do ciclo de vida do componente <code>ngOnDestroy</code> for chamado, <code>destroy$</code> ser√° chamado com <code>next</code> e <code>complete</code> . <br><br>  Como o componente j√° est√° carregado, o sistema n√£o executa uma solicita√ß√£o HTTP adicional.  Utilizamos o conte√∫do do fragmento de c√≥digo que j√° possu√≠mos, criamos um novo componente e o colocamos no cont√™iner. <br><br><h2>  <font color="#3AC1EF">Ganchos do ciclo de vida do componente</font> </h2><br>  Quase todos os ganchos do ciclo de vida do componente s√£o chamados automaticamente ao trabalhar com o componente <code>QuizCardComponent</code> usando a t√©cnica de carregamento lento.  Mas um gancho n√£o √© suficiente.  Voc√™ consegue entender qual? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ceb/4f7/b2a/ceb4f7b2a34bbed6ced31f69713e4f68.png"></div><br>  <i><font color="#999999">Ganchos do ciclo de vida do componente</font></i> <br><br>  Este √© o <code>ngOnChanges</code> mais importante do <code>ngOnChanges</code> .  Como n√≥s mesmos atualizamos as propriedades de entrada da inst√¢ncia do componente, tamb√©m somos respons√°veis ‚Äã‚Äãpor chamar o gancho do ciclo de vida do <code>ngOnChanges</code> . <br><br>  Para chamar o gancho <code>ngOnChanges</code> da inst√¢ncia do <code>ngOnChanges</code> , voc√™ precisa construir um objeto <code>SimpleChange</code> : <br><br><pre> <code class="javascript hljs">(instance <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> any).ngOnChanges({    <span class="hljs-attr"><span class="hljs-attr">question</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SimpleChange(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, instance.question, <span class="hljs-literal"><span class="hljs-literal">true</span></span>) });</code> </pre> <br>  Chamamos manualmente <code>ngOnChanges</code> inst√¢ncia <code>ngOnChanges</code> componente e passamos a ela um objeto <code>SimpleChange</code> .  Este objeto indica que essa altera√ß√£o √© a primeira, que o valor anterior √© <code>null</code> e que o valor atual √© uma pergunta. <br><br>  √ìtimo!  Carregamos o componente com m√≥dulos de terceiros, respondemos aos eventos gerados e configuramos a chamada dos ganchos necess√°rios do ciclo de vida do componente. <br><br>  <a href="https://github.com/kreuzerk/city-quiz">Aqui est√° o</a> c√≥digo fonte do projeto finalizado em que est√°vamos trabalhando aqui. <br><br><h2>  <font color="#3AC1EF">Sum√°rio</font> </h2><br>  O carregamento lento de componentes oferece aos desenvolvedores Angular grandes oportunidades para otimizar o desempenho do aplicativo.  √Ä sua disposi√ß√£o est√£o as ferramentas para ajustar muito bem a composi√ß√£o dos materiais carregados no modo pregui√ßoso.  Anteriormente, quando era poss√≠vel carregar apenas rotas no modo lento, n√£o t√≠nhamos essa precis√£o. <br><br>  Infelizmente, ao usar m√≥dulos de terceiros no componente, tamb√©m precisamos cuidar dos m√≥dulos.  No entanto, vale lembrar que no futuro isso poder√° mudar. <br><br>  O mecanismo Ivy introduziu o conceito de localidade, gra√ßas ao qual os componentes podem existir independentemente.  Essa mudan√ßa √© a base do futuro da Angular. <br><br>  <b>Caros leitores!</b>  Voc√™ planeja usar a t√©cnica de carregamento lento de componentes em seus projetos Angular? <br><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt484618/">https://habr.com/ru/post/pt484618/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt484604/index.html">Ano Novo, Novo Navegador: Microsoft Edge Fora de Avalia√ß√£o Preliminar e Agora Dispon√≠vel para Download</a></li>
<li><a href="../pt484610/index.html">Adeus c√≥digo limpo</a></li>
<li><a href="../pt484612/index.html">Otimiza√ß√£o do tempo de constru√ß√£o do projeto</a></li>
<li><a href="../pt484614/index.html">6 recomenda√ß√µes para o desenvolvimento de aplicativos Go seguros</a></li>
<li><a href="../pt484616/index.html">6 li√ß√µes aprendidas da experi√™ncia de otimiza√ß√£o de desempenho do servi√ßo Node.js.</a></li>
<li><a href="../pt484620/index.html">Novo renderizador gr√°fico PS1 para Omega Red Emulator</a></li>
<li><a href="../pt484624/index.html">Padr√µes de Intervalo de Jejum e Extens√£o de Vida Lifext</a></li>
<li><a href="../pt484628/index.html">Eric Ciaramella como um exemplo de censura na Wikipedia / Google</a></li>
<li><a href="../pt484630/index.html">CES 2020: hora de surpreender</a></li>
<li><a href="../pt484634/index.html">Node.js VS Python: Qual √© o Melhor?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>