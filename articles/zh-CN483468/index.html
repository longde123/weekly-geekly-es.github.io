<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš½ ğŸš ğŸ˜ Flutteré›†æˆæµ‹è¯•-ç®€å• ğŸ‘©ğŸ¾â€âœˆï¸ ğŸ•´ğŸ¿ ğŸ‘¨ğŸ¾â€ğŸ­</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘è®¤ä¸ºè®¸å¤šäººå·²ç»ç†Ÿæ‚‰Flutterï¼Œå¹¶ä¸”è‡³å°‘å‡ºäºå…´è¶£çš„è€ƒè™‘ï¼Œä»–ä»¬å¼€å§‹åœ¨Flutterä¸Šè¿›è¡Œç®€å•çš„åº”ç”¨ç¨‹åºã€‚ ç°åœ¨æ˜¯ç¡®ä¿ä¸€åˆ‡éƒ½èƒ½æŒ‰éœ€å·¥ä½œçš„æ—¶å€™äº†ï¼Œé›†æˆæµ‹è¯•å°†å¸®åŠ©æˆ‘ä»¬å®ç°è¿™ä¸€ç›®æ ‡ã€‚ 



 Flutterä¸Šçš„é›†æˆæµ‹è¯•æ˜¯ä½¿ç”¨Flutteré©±åŠ¨ç¨‹åºç¼–å†™çš„ï¼Œå…¶å®˜æ–¹ç½‘ç«™ä¸Šæä¾›äº†ä¸€ä¸ªç®€å•æ˜“æ‡‚çš„æ•™ç¨‹ ã€‚ è¿™ç§æµ‹è¯•...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Flutteré›†æˆæµ‹è¯•-ç®€å•</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483468/"><p> æˆ‘è®¤ä¸ºè®¸å¤šäººå·²ç»ç†Ÿæ‚‰Flutterï¼Œå¹¶ä¸”è‡³å°‘å‡ºäºå…´è¶£çš„è€ƒè™‘ï¼Œä»–ä»¬å¼€å§‹åœ¨Flutterä¸Šè¿›è¡Œç®€å•çš„åº”ç”¨ç¨‹åºã€‚ ç°åœ¨æ˜¯ç¡®ä¿ä¸€åˆ‡éƒ½èƒ½æŒ‰éœ€å·¥ä½œçš„æ—¶å€™äº†ï¼Œé›†æˆæµ‹è¯•å°†å¸®åŠ©æˆ‘ä»¬å®ç°è¿™ä¸€ç›®æ ‡ã€‚ <br><img src="https://habrastorage.org/webt/rc/uh/yo/rcuhyopuvni8ghulnrotc1hfiru.png"></p><a name="habracut"></a><br><p>  Flutterä¸Šçš„é›†æˆæµ‹è¯•æ˜¯ä½¿ç”¨Flutteré©±åŠ¨ç¨‹åºç¼–å†™çš„ï¼Œå…¶<a href="https://flutter.dev/docs/cookbook/testing/integration/introduction" rel="nofollow">å®˜æ–¹ç½‘ç«™ä¸Šæä¾›äº†</a>ä¸€ä¸ª<a href="https://flutter.dev/docs/cookbook/testing/integration/introduction" rel="nofollow">ç®€å•æ˜“æ‡‚çš„æ•™ç¨‹</a> ã€‚ è¿™ç§æµ‹è¯•çš„ç»“æ„ç±»ä¼¼äºAndroidä¸–ç•Œä¸­çš„<a href="https://developer.android.com/training/testing/espresso" rel="nofollow">Espresso</a> ã€‚ é¦–å…ˆï¼Œæ‚¨éœ€è¦åœ¨å±å¹•ä¸Šæ‰¾åˆ°UIå…ƒç´ ï¼š </p><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SerializableFinder button = find.byValueKey(<span class="hljs-string"><span class="hljs-string">"button"</span></span>);</code> </pre> <br><p> ç„¶åå¯¹ä»–ä»¬æ‰§è¡Œä¸€äº›æ“ä½œï¼š </p><br><pre> <code class="java hljs">driver = await FlutterDriver.connect(); ... await driver.tap(button);</code> </pre> <br><p> å¹¶éªŒè¯æ‰€éœ€çš„UIå…ƒç´ æ˜¯å¦å¤„äºæ‰€éœ€çŠ¶æ€ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SerializableFinder text = find.byValueKey(<span class="hljs-string"><span class="hljs-string">"text"</span></span>); expect(await driver.getText(text), <span class="hljs-string"><span class="hljs-string">"some text"</span></span>);</code> </pre> <br><p> å½“ç„¶ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œä¸€åˆ‡çœ‹èµ·æ¥éƒ½å¾ˆåŸºæœ¬ã€‚ ä½†æ˜¯éšç€è¢«æµ‹åº”ç”¨ç¨‹åºçš„å¢é•¿å’Œæµ‹è¯•æ•°é‡çš„å¢åŠ ï¼Œæˆ‘ä¸æƒ³åœ¨æ¯æ¬¡æµ‹è¯•ä¹‹å‰é‡å¤æœç´¢UIå…ƒç´ ã€‚ å¦å¤–ï¼Œç”±äºå¯èƒ½æœ‰è®¸å¤šå±å¹•ï¼Œå› æ­¤æ‚¨å°†éœ€è¦æ„é€ è¿™äº›UIå…ƒç´ ã€‚ ä¸ºæ­¤ï¼Œä½¿ç¼–å†™æµ‹è¯•æ›´åŠ æ–¹ä¾¿ã€‚ </p><br><h2 id="screen-objects"> å±å¹•å¯¹è±¡ </h2><br><p> åœ¨Androidï¼ˆ <a href="https://github.com/agoda-com/Kakao" rel="nofollow">Kakao</a> ï¼‰ä¸­ï¼Œé€šè¿‡å°†æ¯ä¸ªå±å¹•ä¸­çš„UIå…ƒç´ åˆ†ç»„åˆ°Screenï¼ˆé¡µé¢å¯¹è±¡ï¼‰ä¸­æ¥è§£å†³æ­¤é—®é¢˜ã€‚ é™¤äº†åœ¨Flutterä¸­ä½¿ç”¨UIå…ƒç´ æ‰§è¡Œæ“ä½œå¤–ï¼Œæ‚¨è¿˜å¯ä»¥åœ¨æ­¤å¤„åº”ç”¨ç±»ä¼¼çš„æ–¹æ³•ï¼Œä¸ä»…éœ€è¦<code>Finder</code> ï¼ˆæœç´¢UIå…ƒç´ ï¼‰ï¼Œè¿˜éœ€è¦<code>FlutterDriver</code> ï¼ˆæ‰§è¡Œæ“ä½œï¼‰ï¼Œå› æ­¤éœ€è¦åœ¨å…¶ä¸­å­˜å‚¨æŒ‡å‘<code>FlutterDriver</code>çš„é“¾æ¥<code>Screen</code> ã€‚ </p><br><p> è¦å®šä¹‰æ¯ä¸ªUIå…ƒç´ ï¼Œæˆ‘ä»¬æ·»åŠ <a href="" rel="nofollow"><code>DWidget</code></a>ç±»ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒDæ˜¯å•è¯Dartï¼‰ã€‚ è¦åˆ›å»º<code>DWidget</code>å°†éœ€è¦<code>FlutterDriver</code>å’Œä¸€ä¸ª<code>FlutterDriver</code> ï¼Œå®ƒå°†ä¸è¯¥UIå…ƒç´ ä¸€èµ·æ‰§è¡Œæ“ä½œï¼Œè¯¥<code>ValueKey</code>ä¸æˆ‘ä»¬è¦ä¸ä¹‹äº¤äº’çš„åº”ç”¨ç¨‹åºä¸­çš„å°éƒ¨ä»¶çš„<code>ValueKey</code> Flutteré‡åˆï¼š </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DWidget</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> FlutterDriver _driver; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SerializableFinder _finder; DWidget(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._driver, dynamic valueKey) : _finder = find.byValueKey(valueKey); ...</code> </pre> <br><p> æ‰‹åŠ¨åˆ›å»ºæ¯ä¸ª<code>DWidget</code>æ—¶<code>find.byValueKey(â€¦)</code> <code>DWidget</code>æ–¹ä¾¿ï¼Œå› æ­¤æœ€å¥½å°†<code>ValueKey</code>å€¼ä¼ é€’ç»™<code>ValueKey</code> ï¼Œå¹¶ä¸”<code>DWidget</code>æœ¬èº«å°†è·å¾—æ‰€éœ€çš„<code>SerializableFinder</code> ã€‚ åˆ›å»ºæ¯ä¸ª<code>FlutterDriver</code>æ—¶æ‰‹åŠ¨ä¼ é€’<code>FlutterDriver</code>ä¹Ÿä¸å¤ªæ–¹ä¾¿ï¼Œå› æ­¤æ‚¨å¯ä»¥å°†<code>FlutterDriver</code>å­˜å‚¨åœ¨<a href="" rel="nofollow"><code>BaseScreen</code></a>å¹¶å°†å…¶ä¼ è¾“åˆ°<code>DWidget</code> ï¼Œå¹¶ä¸º<code>BaseScreen</code>æ·»åŠ æ–°æ–¹æ³•æ¥åˆ›å»º<code>BaseScreen</code> ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseScreen</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> FlutterDriver _driver; BaseScreen(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._driver); <span class="hljs-function"><span class="hljs-function">DWidget </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dWidget</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dynamic key)</span></span></span><span class="hljs-function"> </span></span>=&gt; DWidget(_driver, key); ...</code> </pre> <br><p> å› æ­¤ï¼Œåˆ›å»ºScreensç±»å¹¶åœ¨å…¶ä¸­è·å–UIå…ƒç´ å°†æ›´åŠ å®¹æ˜“ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainScreen</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseScreen</span></span></span><span class="hljs-class"> </span></span>{ MainScreen(FlutterDriver driver) : <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(driver); DWidget get button =&gt; dWidget(<span class="hljs-string"><span class="hljs-string">'button'</span></span>); DWidget get textField =&gt; dWidget(<span class="hljs-string"><span class="hljs-string">'text_field'</span></span>); ... }</code> </pre> <br><h2 id="izbavlyaemsya-ot-await"> æ‘†è„±<code>await</code> </h2><br><p> ç”¨<code>FlutterDriver</code>ç¼–å†™æµ‹è¯•æ—¶ï¼Œå¦ä¸€ä»¶ä¸å¤ªæ–¹ä¾¿çš„äº‹æƒ…æ˜¯éœ€è¦åœ¨æ¯ä¸ªæ“ä½œä¹‹å‰æ·»åŠ <code>await</code> ï¼š </p><br><pre> <code class="java hljs">await driver.tap(button); await driver.scrollUntilVisible(list, checkBox); await driver.tap(checkBox); await driver.tap(text); await driver.enterText(<span class="hljs-string"><span class="hljs-string">"some text"</span></span>);</code> </pre> <br><p> å¿˜è®°<code>await</code>å¾ˆå®¹æ˜“ï¼Œæ²¡æœ‰å®ƒï¼Œæµ‹è¯•å°†æ— æ³•æ­£å¸¸è¿›è¡Œï¼Œå› ä¸º<code>driver</code>æ–¹æ³•è¿”å›<code>Future&lt;void&gt;</code>å¹¶ä¸”åœ¨ä¸<code>await</code>æƒ…å†µä¸‹è°ƒç”¨<code>await</code>å°†æ‰§è¡Œ<code>await</code> ï¼Œç›´åˆ°æ–¹æ³•å†…çš„ç¬¬ä¸€æ¬¡<code>await</code> ï¼Œç„¶åå°†å…¶ä½™æ–¹æ³•â€œæ¨è¿Ÿåˆ°ä»¥åâ€ã€‚ </p><br><p> æ‚¨å¯ä»¥é€šè¿‡åˆ›å»ºå°†â€œåŒ…è£…â€ <code>Future</code>çš„<a href="" rel="nofollow"><code>TestAction</code></a>æ¥<a href="" rel="nofollow"><code>TestAction</code></a>æ­¤é—®é¢˜ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ç­‰åˆ°ä¸€ä¸ªæ“ä½œå®Œæˆåå†è¿›è¡Œä¸‹ä¸€ä¸ªæ“ä½œï¼š </p><br><pre> <code class="java hljs">typedef TestAction = <span class="hljs-function"><span class="hljs-function">Future&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;</code> </pre> <br><p>  ï¼ˆæœ¬è´¨ä¸Šï¼Œ <code>TestAction</code>æ˜¯è¿”å›<code>Future&lt;void&gt;</code>ä»»ä½•å‡½æ•°ï¼ˆæˆ–lambdaï¼‰ï¼‰ </p><br><p> ç°åœ¨ï¼Œæ‚¨å¯ä»¥è½»æ¾è¿è¡Œ<code>TestAction</code>åºåˆ—ï¼Œè€Œæ— éœ€ç­‰å¾…ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">Future&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runTestActions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Iterable&lt;TestAction&gt; actions)</span></span></span><span class="hljs-function"> async </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> action in actions) { <span class="hljs-function"><span class="hljs-function">await </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; } }</code> </pre> <br><h2 id="ispolzuem-testaction-v-dwidget"> åœ¨<code>TestAction</code>ä¸­ä½¿ç”¨<code>DWidget</code> </h2><br><p>  <code>DWidget</code>ç”¨äºä¸UIå…ƒç´ è¿›è¡Œäº¤äº’ï¼Œå¦‚æœè¿™äº›åŠ¨ä½œæ˜¯<code>TestAction</code> ï¼Œåˆ™å°†éå¸¸æ–¹ä¾¿ï¼Œä»¥ä¾¿å¯ä»¥åœ¨<code>runTestAction</code>æ–¹æ³•ä¸­ä½¿ç”¨å®ƒä»¬ã€‚ ä¸ºæ­¤ï¼Œ <code>DWidget</code>ç±»å°†å…·æœ‰æ“ä½œæ–¹æ³•ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DWidget</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> FlutterDriver _driver; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SerializableFinder _finder; ... <span class="hljs-function"><span class="hljs-function">TestAction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({Duration timeout})</span></span></span><span class="hljs-function"> </span></span>=&gt; () =&gt; _driver.tap(_finder, timeout: timeout); <span class="hljs-function"><span class="hljs-function">TestAction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String text, {Duration timeout})</span></span></span><span class="hljs-function"> </span></span>=&gt; () async { await _driver.tap(_finder, timeout: timeout); await _driver.enterText(text ?? <span class="hljs-string"><span class="hljs-string">""</span></span>, timeout: timeout); }; ... }</code> </pre> <br><p> ç°åœ¨æ‚¨å¯ä»¥ç¼–å†™æµ‹è¯•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainScreen</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseScreen</span></span></span><span class="hljs-class"> </span></span>{ MainScreen(FlutterDriver driver) : <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(driver); DWidget get field_1 =&gt; dWidget(<span class="hljs-string"><span class="hljs-string">'field_1'</span></span>); DWidget get field_2 =&gt; dWidget(<span class="hljs-string"><span class="hljs-string">'field_2'</span></span>); <span class="hljs-function"><span class="hljs-function">DWidget </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">field2Variant</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i)</span></span></span><span class="hljs-function"> </span></span>=&gt; dWidget(<span class="hljs-string"><span class="hljs-string">'variant_$i'</span></span>); DWidget get result =&gt; dWidget(<span class="hljs-string"><span class="hljs-string">'result'</span></span>); } â€¦ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> mainScreen = MainScreen(driver); <span class="hljs-function"><span class="hljs-function">await </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runTestActions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([ mainScreen.result.hasText(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"summa = 0"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, mainScreen.field_1.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"3"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, mainScreen.field_2.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, mainScreen.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">field2Variant</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, mainScreen.result.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"summa = 5"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, ])</span></span>;</code> </pre> <br><p> å¦‚æœæ‚¨éœ€è¦åœ¨<code>runTestActions</code>ä¸­æ‰§è¡Œä¸<code>DWidget</code>ä¸ç›¸å…³çš„<code>DWidget</code> ï¼Œåˆ™åªéœ€åˆ›å»ºä¸€ä¸ªè¿”å›<code>Future&lt;void&gt;</code>çš„lambdaå³å¯ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">await </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runTestActions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([ mainScreen.result.hasText(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"summa = 0"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>=&gt; driver.requestData(<span class="hljs-string"><span class="hljs-string">"some_message"</span></span>), () async =&gt; print(<span class="hljs-string"><span class="hljs-string">"some_text"</span></span>), mainScreen.field_1.setText(<span class="hljs-string"><span class="hljs-string">"3"</span></span>), ]);</code> </pre> <br><h2 id="flutterdriverhelper">  FlutterDriverHelper </h2><br><p>  <code>FlutterDriver</code>æœ‰å‡ ç§ä¸UIå…ƒç´ è¿›è¡Œäº¤äº’çš„æ–¹æ³•ï¼ˆæŒ‰ï¼Œæ¥æ”¶å’Œè¾“å…¥æ–‡æœ¬ï¼Œæ»šåŠ¨ç­‰ï¼‰ï¼Œå¯¹äºè¿™äº›æ–¹æ³•ï¼Œ <code>DWidget</code>å…·æœ‰è¿”å›<code>TestAction</code>ç›¸åº”æ–¹æ³•ã€‚ </p><br><p> ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæœ¬æ–‡ä¸­æè¿°çš„æ‰€æœ‰ä»£ç éƒ½åœ¨<a href="https://pub.dev/packages/flutter_driver_helper" rel="nofollow"><code>FlutterDriverHelper</code>ä¸Š</a>ä½œä¸º<a href="https://pub.dev/packages/flutter_driver_helper" rel="nofollow"><code>FlutterDriverHelper</code></a>åº“<a href="https://pub.dev/packages/flutter_driver_helper" rel="nofollow">å‘å¸ƒ</a> ã€‚ </p><br><p> å¯¹äºæ»šåŠ¨åˆ—è¡¨ï¼Œåœ¨å…¶ä¸­åŠ¨æ€åˆ›å»ºå…ƒç´ çš„åˆ—è¡¨ï¼ˆä¾‹å¦‚<code>ListView.builder</code> ï¼‰ï¼Œ <code>FlutterDriver</code>æœ‰ä¸€ä¸ª<code>scrollUntilVisible</code>æ–¹æ³•ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">Future&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollUntilVisible</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( SerializableFinder scrollable, SerializableFinder item, { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> alignment = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dxScroll = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dyScroll = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Duration timeout, })</span></span></span><span class="hljs-function"> async </span></span>{ ... }</code> </pre> <br><p> æ­¤æ–¹æ³•æ²¿æŒ‡å®šæ–¹å‘æ»šåŠ¨å¯æ»šåŠ¨çª—å£å°éƒ¨ä»¶ï¼Œç›´åˆ°<code>item</code>çª—å£å°éƒ¨ä»¶å‡ºç°åœ¨å±å¹•ä¸Šï¼ˆæˆ–ç›´åˆ°<code>timeout</code> ï¼‰ã€‚ ä¸ºäº†ä¸ä½¿æ¯æ¬¡æ»šåŠ¨éƒ½æ»šåŠ¨ï¼Œæ·»åŠ äº†DScrollItemç±»ï¼Œè¯¥ç±»ç»§æ‰¿äº†<code>DWidget</code>å¹¶è¡¨ç¤ºä¸€ä¸ªåˆ—è¡¨é¡¹ã€‚ å®ƒåŒ…å«ä¸€ä¸ªæŒ‡å‘<code>scrollable</code>çš„é“¾æ¥ï¼Œå› æ­¤åœ¨æ»šåŠ¨æ—¶ï¼Œå®ƒä»…ç”¨äºæŒ‡å®š<code>dyScroll</code>æˆ–<code>dxScroll</code> ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SecondScreen</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseScreen</span></span></span><span class="hljs-class"> </span></span>{ SecondScreen(FlutterDriver driver) : <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(driver); DWidget get list =&gt; dWidget(<span class="hljs-string"><span class="hljs-string">"list"</span></span>); <span class="hljs-function"><span class="hljs-function">DScrollItem </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">item</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span><span class="hljs-function"> </span></span>=&gt; dScrollItem(<span class="hljs-string"><span class="hljs-string">'item_$index'</span></span>, list); } ... <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> secondScreen = SecondScreen(driver); <span class="hljs-function"><span class="hljs-function">await </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runTestActions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([ secondScreen.item(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">42</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollUntilVisible</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dyScroll: </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-300</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, ... ])</span></span>;</code> </pre> <br><p> åœ¨æµ‹è¯•æœŸé—´ï¼Œæ‚¨å¯ä»¥è·å–åº”ç”¨ç¨‹åºçš„<a href="" rel="nofollow"><code>Screenshoter</code></a> ï¼Œ <code>FlutterDriverHelper</code>çš„<a href="" rel="nofollow"><code>Screenshoter</code></a>å¯å°†å±å¹•æˆªå›¾ä¸å½“å‰æ—¶é—´ä¸€èµ·ä¿å­˜åˆ°æ­£ç¡®çš„æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶å¯ä»¥ä¸<code>TestAction</code>ä¸€èµ·<code>TestAction</code> ã€‚ </p><br><h2 id="drugie-problemy-i-ih-resheniya"> å…¶ä»–é—®é¢˜åŠå…¶è§£å†³æ–¹æ¡ˆ </h2><br><ul><li> æˆ‘æ‰¾ä¸åˆ°åœ¨æ—¶é—´/æ—¥æœŸå¯¹è¯æ¡†ä¸­å•å‡»æŒ‰é’®çš„æ ‡å‡†æ–¹æ³•-æˆ‘å¿…é¡»ä½¿ç”¨<a href="" rel="nofollow"><code>TestHooks</code></a> ã€‚  <code>TestHooks</code>å¯¹äºåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­æ›´æ”¹å½“å‰æ—¶é—´/æ—¥æœŸä¹Ÿå¾ˆæœ‰ç”¨ã€‚ </li><li> åœ¨<code>DropdownButtonFormField</code>çš„ä¸‹æ‹‰åˆ—è¡¨ä¸­<code>DropdownButtonFormField</code>æ‚¨éœ€è¦ä¸ºè¯¥<code>DropdownMenuItem</code>çš„<code>child</code> <code>key</code>æŒ‡å®š<code>key</code> ï¼Œè€Œä¸æ˜¯<code>DropdownMenuItem</code>çš„<code>key</code> ï¼Œå¦åˆ™<code>Flutter Driver</code>å°†æ‰¾ä¸åˆ°å®ƒã€‚ å¦å¤–ï¼Œåœ¨ä¸‹æ‹‰åˆ—è¡¨ä¸­æ»šåŠ¨å°šä¸èµ·ä½œç”¨ï¼ˆ <a href="https://github.com/flutter/flutter/issues/37903" rel="nofollow">github.comä¸Šçš„Issue</a> ï¼‰ã€‚ </li><li>  <code>FlutterDriver.getCenter</code>æ–¹æ³•è¿”å›<code>Future&lt;DriverOffset&gt;</code> ï¼Œä½†æ˜¯<code>DriverOffset</code>ä¸æ˜¯å…¬å…±APIçš„ä¸€éƒ¨åˆ†ï¼ˆ <a href="https://github.com/flutter/flutter/issues/44367" rel="nofollow">åœ¨github.comä¸Šå‘è¡Œ</a> ï¼‰ </li><li> è¿˜æœ‰ä¸€äº›é—®é¢˜å’Œä¸æ˜æ˜¾çš„ä¸œè¥¿å·²ç»å­˜åœ¨ã€‚ æ‚¨å¯ä»¥åœ¨ä¸€ç¯‡<a href="https://medium.com/flutter-community/blazingly-fast-flutter-driver-tests-5e375c833aa" rel="nofollow">ç²¾å½©çš„æ–‡ç« ä¸­</a>äº†è§£å®ƒä»¬ã€‚ åœ¨æ¯æ¬¡æµ‹è¯•å¼€å§‹ä¹‹å‰ï¼Œå¯ä»¥åœ¨æ¡Œé¢ä¸Šè¿è¡Œæµ‹è¯•å¹¶é‡ç½®åº”ç”¨ç¨‹åºçŠ¶æ€çš„åŠŸèƒ½ç‰¹åˆ«æœ‰ç”¨ã€‚ </li><li> æ‚¨å¯ä»¥ä½¿ç”¨Github Actionsè¿è¡Œæµ‹è¯•ã€‚ æ›´å¤šç»†èŠ‚<a href="https://medium.com/flutter-community/run-flutter-driver-tests-on-github-actions-13c639c7e4ab" rel="nofollow">åœ¨è¿™é‡Œ</a> ã€‚ </li></ul><br><h2 id="todo"> å¾…åŠ </h2><br><p>  <code>FlutterDriverHelper</code>æœªæ¥<code>FlutterDriverHelper</code>åŒ…æ‹¬ï¼š </p><br><ul><li> å¦‚æœåœ¨è®¿é—®å®ƒæ—¶åœ¨å±å¹•ä¸Šä¸å¯è§ï¼Œåˆ™ä¼šè‡ªåŠ¨æ»šåŠ¨åˆ°æ‰€éœ€çš„åˆ—è¡¨é¡¹ï¼ˆå°±åƒåœ¨Androidçš„<a href="https://github.com/KasperskyLab/Kaspresso" rel="nofollow">Kaspresso</a>åº“ä¸­æ‰€åšçš„<a href="https://github.com/KasperskyLab/Kaspresso" rel="nofollow">é‚£æ ·</a> ï¼‰ã€‚ å¦‚æœå¯èƒ½çš„è¯ï¼Œç”šè‡³åŒå‘ã€‚ </li><li> ä½¿ç”¨<code>Dwidget</code>æˆ–<code>DscrollItem</code>æ‰§è¡Œçš„åŠ¨ä½œçš„æ‹¦æˆªå™¨ã€‚ </li></ul><br><p>  <em>æ¬¢è¿æå‡ºè¯„è®ºå’Œå»ºè®¾æ€§åé¦ˆã€‚</em> </p><br><p>  <strong>æ›´æ–°ï¼ˆ</strong> <code>TestAction</code> <strong>ï¼‰</strong> ï¼šåœ¨ç‰ˆæœ¬<a href="https://pub.dev/packages/flutter_driver_helper" rel="nofollow">1.1.0ä¸­ï¼Œ</a> <code>TestAction</code>å˜æˆäº†ä¸€ä¸ªå…·æœ‰<code>String name</code>å­—æ®µçš„ç±»ã€‚ å¹¶å› æ­¤è€Œ<code>runTestActions</code>äº†åœ¨<code>runTestActions</code>æ–¹æ³•ä¸­æ‰§è¡Œçš„æ‰€æœ‰æ“ä½œçš„æ—¥å¿—è®°å½•ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN483468/">https://habr.com/ru/post/zh-CN483468/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN483454/index.html">åœ¨Atlassian Bitbucketä¸­ä»Mercurialåˆ‡æ¢åˆ°GITï¼Œå¹¶ç”¨è¥¿é‡Œå°”æ–‡ä¿å­˜æ–‡ä»¶</a></li>
<li><a href="../zh-CN483458/index.html">GreenPigæ•°æ®åº“åŠ©æ‰‹</a></li>
<li><a href="../zh-CN483460/index.html">SQL HowToï¼šä½¿ç”¨çª—å£å‡½æ•°æ„å»ºé“¾</a></li>
<li><a href="../zh-CN483462/index.html">é—­å˜´æ‹¿æˆ‘çš„é’±</a></li>
<li><a href="../zh-CN483466/index.html">åå‘ä¼ æ’­æ–¹æ³•ä»‹ç»</a></li>
<li><a href="../zh-CN483470/index.html">æœ‰æ•ˆåœ°æ”¾ç½®å›¾å—ï¼ˆPro CSSï¼ŒSVGï¼Œå›¾æ¡ˆç­‰ï¼‰</a></li>
<li><a href="../zh-CN483472/index.html">åˆ é™¤æ‰€æœ‰å†…å®¹ï¼šå¦‚ä½•åˆ é™¤æ•°æ®å¹¶å°†NVMe SSDæ¢å¤ä¸ºå‡ºå‚è®¾ç½®</a></li>
<li><a href="../zh-CN483476/index.html">æœºå™¨äººè¿è¾“çš„é“å¾·ï¼šæ‰‹æ¨è½¦çš„é—®é¢˜ï¼Œé£é™©å’Œåæœ</a></li>
<li><a href="../zh-CN483478/index.html">å¤ªé˜³ï¼Œé£å’Œæ°´ver 0.1</a></li>
<li><a href="../zh-CN483480/index.html">å¡«å­—æ¸¸æˆâ€œæ„Ÿè§‰åƒSOCåˆ†æå¸ˆâ€</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>