<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîÅ üëÉ üë®üèø‚Äçüîß Cr√©ation d'un jeu de rythme dans Unity üìø üóø üôÖüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√©sentation 
 Donc, vous voulez ou essayez de cr√©er un jeu de rythme, mais les √©l√©ments du jeu et la musique sont rapidement d√©synchronis√©s, et maint...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cr√©ation d'un jeu de rythme dans Unity</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452168/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/98c/c5f/e21/98cc5fe21847a5826eb9fb9e396e3379.jpg" alt="image"></div><br><h1>  Pr√©sentation </h1><br>  Donc, vous voulez ou essayez de cr√©er un jeu de rythme, mais les √©l√©ments du jeu et la musique sont rapidement d√©synchronis√©s, et maintenant vous ne savez pas quoi faire.  Cet article vous y aidera.  J'ai jou√© √† des jeux de rythme au lyc√©e et je tra√Ænais souvent sur DDR dans la salle d'arcade locale.  Aujourd'hui, je suis toujours √† la recherche de nouveaux jeux de ce genre, et des projets tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Crypt of the Necrodancer</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bit.Trip.Runner</a> montrent que beaucoup plus peut √™tre fait dans ce genre.  J'ai un peu travaill√© sur des prototypes de jeux de rythme dans Unity, et en cons√©quence j'ai pass√© un mois √† cr√©er un petit jeu de rythme / puzzle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Atomic Beats</a> .  Dans cet article, je parlerai des techniques de construction de code les plus utiles que j'ai apprises en cr√©ant ces jeux.  Je n'ai pu trouver d'informations √† leur sujet nulle part ailleurs, ou elles ont √©t√© pr√©sent√©es avec moins de d√©tails. <br><br>  Tout d'abord, je dois exprimer ma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">profonde</a> gratitude √† Yu Chao pour le poste de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Music Syncing in Rhythm Games</a> [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">traduction en Habr√©</a> ].  Yu a pass√© en revue les bases de la synchronisation des timings audio avec le moteur de jeu dans Unity et a t√©l√©charg√© le code source de son jeu Boots-Cut, ce qui m'a beaucoup aid√© dans la cr√©ation de mon projet.  Vous pouvez √©tudier son article si vous souhaitez apprendre une br√®ve introduction √† la synchronisation musicale d'Unity, mais je couvrirai ce sujet plus en d√©tail et de mani√®re plus approfondie.  Mon code utilise activement les informations de l'article et le code Boots-Cut. <br><a name="habracut"></a><br>  Au c≈ìur de tout jeu de rythme se trouvent les timings.  Les gens sont extr√™mement sensibles √† toute distorsion dans les timings rythmiques, il est donc tr√®s important que toutes les actions, mouvements et entr√©es dans le jeu rythmique soient directement synchronis√©s avec la musique.  Malheureusement, les m√©thodes traditionnelles de suivi du temps Unity comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Time.timeSinceLevelLoad</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Time.time</a> perdent rapidement la synchronisation avec le son en cours de lecture.  Par cons√©quent, nous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">acc√©derons</a> directement au syst√®me audio √† l'aide d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AudioSettings.dspTime</a> , qui utilise le nombre r√©el d'√©chantillons audio trait√©s par le syst√®me audio.  Gr√¢ce √† cela, il maintient toujours la synchronisation avec la musique en cours de lecture (ce n'est peut-√™tre pas le cas avec des fichiers audio tr√®s longs, lorsque des effets d'√©chantillonnage entrent en jeu, mais dans le cas de chansons d'une dur√©e normale, le syst√®me devrait fonctionner parfaitement).  Cette fonction sera au c≈ìur de notre suivi du temps de composition, et sur cette base, nous cr√©erons la classe principale. <br><br><h1>  Chef de classe </h1><br>  La classe de chef d'orchestre est la principale classe de gestion de composition sur la base de laquelle le reste du jeu de rythme sera construit.  Avec lui, nous allons suivre la position de la composition et g√©rer toutes les autres actions synchronis√©es.  Pour suivre la composition, nous avons besoin de quelques variables <br><br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//Song beats per minute //This is determined by the song you're trying to sync up to public float songBpm; //The number of seconds for each song beat public float secPerBeat; //Current song position, in seconds public float songPosition; //Current song position, in beats public float songPositionInBeats; //How many seconds have passed since the song started public float dspSongTime; //an AudioSource attached to this GameObject that will play the music. public AudioSource musicSource;</span></span></code> </pre> <br>  Lors du d√©marrage de la sc√®ne, nous devons effectuer des calculs pour d√©terminer les variables et √©galement enregistrer pour r√©f√©rence l'heure de d√©but de la composition. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//Load the AudioSource attached to the Conductor GameObject musicSource = GetComponent&lt;AudioSource&gt;(); //Calculate the number of seconds in each beat secPerBeat = 60f / songBpm; //Record the time when the music starts dspSongTime = (float)AudioSettings.dspTime; //Start the music musicSource.Play(); }</span></span></code> </pre> <br>  Si vous cr√©ez un GameObject vide avec un tel script attach√©, puis ajoutez la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">source audio</a> avec la composition et ex√©cutez le programme, vous verrez que le script enregistrera l'heure de d√©but de la composition, mais rien d'autre ne se passera.  Nous devrons √©galement saisir manuellement le BPM de la musique que nous ajoutons √† la source audio. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7fc/3ac/550/7fc3ac5504438ff8bd050c50283250c6.png"></div><br>  Gr√¢ce √† toutes ces valeurs, nous pouvons suivre la position dans la composition en temps r√©el lors de la mise √† jour du jeu.  Nous d√©terminerons le timing de la composition, d'abord en secondes, puis en fractions.  Les fractions sont un moyen beaucoup plus pratique de suivre une composition, car elles nous permettent d'ajouter des actions et des synchronisations dans le temps en parall√®le avec la composition, par exemple, dans les fractions 1, 3 et 5.5, sans avoir besoin de calculer des secondes entre les fractions.  Ajoutez les calculs suivants √† la fonction Update () de la classe Conductor: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//determine how many seconds since the song started songPosition = (float)(AudioSettings.dspTime - dspSongTime); //determine how many beats since the song started songPositionInBeats = songPosition / secPerBeat; }</span></span></code> </pre> <br>  Nous obtenons donc la diff√©rence entre l'heure actuelle selon le syst√®me audio et l'heure de d√©but de la composition, ce qui donne le nombre total de secondes pendant lesquelles la composition est jou√©e.  Nous l'enregistrerons dans la variable songPosition. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/84e/f20/a32/84ef20a3208c566d97332c89549c5a7a.png"></div><br>  Notez que la partition en musique commence g√©n√©ralement par une unit√© avec les fractions 1-2-3-4 et ainsi de suite, et songPositionInBeats commence √† 0 et augmente √† partir de cette valeur, de sorte que la troisi√®me partie de la composition correspondra √† songPositionInBeats, qui est 2,0, pas 3,0. <br><br>  √Ä ce stade, si vous souhaitez cr√©er un jeu traditionnel de style Dance Dance Revolution, vous devez cr√©er des notes en fonction de la fraction sur laquelle vous devez les appuyer, interpoler leur position par rapport √† la ligne de clic, puis enregistrer songPositionInBeats lorsque la touche est enfonc√©e, et Comparez la valeur avec la proportion souhait√©e de notes.  Yu Chao discute d'un exemple d'un tel sch√©ma dans son <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> .  Afin de ne pas me r√©p√©ter, je consid√©rerai d'autres techniques potentiellement utiles qui peuvent √™tre construites en plus de la classe de chef d'orchestre.  Je les ai utilis√©s lors de la cr√©ation d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Atomic Beats</a> . <br><br><h1>  Nous nous adaptons √† la part initiale </h1><br>  Si vous cr√©ez votre propre musique pour un jeu de rythme, il est facile de faire en sorte que le premier temps corresponde exactement au d√©but de la musique, ce qui, s'il est correctement sp√©cifi√©, liera de mani√®re fiable la chansonPositionInBeats de la classe Conductor √† la composition. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/56a/acd/dfd/56aacddfd077d0d5890fdea4acb9d667.png"></div><br>  Cependant, si vous utilisez de la musique pr√™te √† l'emploi, il y a une forte probabilit√© qu'il y ait une l√©g√®re pause avant le d√©but de la composition.  Si cela n'est pas pris en compte, alors la classe conductor songPositionInBeats pense que le premier temps a commenc√© lorsque la chanson a commenc√© √† jouer, et non le temps maintenant.  Tout ce qui sera davantage li√© aux valeurs des partages n'est pas synchronis√© avec la musique. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/981/9cc/e24/9819cce244fe54f954e0205345ec86fb.png"></div><br>  Pour r√©soudre ce probl√®me, vous pouvez ajouter une variable qui prend en compte ce d√©calage.  Ajoutez les √©l√©ments suivants √† la classe Conductor: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//The offset to the first beat of the song in seconds public float firstBeatOffset;</span></span></code> </pre> <br>  Dans Update (), la variable songPosition: <br><br><pre> <code class="cs hljs">songPosition = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)(AudioSettings.dspTime - dspSongTime);</code> </pre> <br>  remplac√© par: <br><br><pre> <code class="cs hljs">songPosition = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)(AudioSettings.dspTime - dspSongTime - firstBeatOffset);</code> </pre> <br>  Maintenant, songPosition calculera correctement la position dans la chanson, en tenant compte du vrai premier temps.  Cependant, vous devrez entrer manuellement le d√©calage par rapport au premier temps, donc pour chaque fichier, il sera unique.  De plus, pendant ce d√©calage, il y aura une courte fen√™tre dans laquelle songPosition se r√©v√©lera n√©gatif.  Cela peut ne pas affecter le jeu, mais certains codes, en fonction des valeurs de songPosition ou songPositionInBeats, peuvent ne pas √™tre en mesure de traiter les nombres n√©gatifs pour le moment. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/125/bfd/ab7/125bfdab794789a5920f1ef07bea8a26.png"><br><br><h1>  R√©p√©titions </h1><br>  Si vous travaillez avec une composition qui se joue du d√©but √† la fin, la classe de chef d'orchestre montr√©e ci-dessus sera suffisante pour suivre la position.  Mais si vous avez une courte piste en boucle et que vous souhaitez travailler avec cette boucle, vous devez int√©grer la prise en charge de Repeater dans Conductor. <br><br>  Si vous avez un fragment parfaitement boucl√© (par exemple, si le tempo du morceau est de 120 bpm et que le fragment boucl√© a une longueur de 4 temps, il devrait √™tre exactement 8,0 secondes √† 2,0 secondes par partage) charg√© dans la classe Audio Source de la classe Conductor, puis cochez la case de boucle.  Le chef d'orchestre fonctionnera de la m√™me mani√®re qu'auparavant et transf√©rera la dur√©e totale √† songPosition apr√®s le <em>premier</em> d√©marrage du clip.  Pour d√©terminer la position de la boucle, nous devons en quelque sorte dire √† Conductor combien de partages se trouvent dans une boucle et combien de boucles ont d√©j√† √©t√© jou√©es.  Ajoutez les variables suivantes √† la classe Conductor: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//the number of beats in each loop public float beatsPerLoop; //the total number of loops completed since the looping clip first started public int completedLoops = 0; //The current position of the song within the loop in beats. public float loopPositionInBeats;</span></span></code> </pre> <br>  Maintenant, avec chaque mise √† jour de SongPositionInBeats, nous pouvons √©galement mettre √† jour la position Update () de la boucle. <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//calculate the loop position if (songPositionInBeats &gt;= (completedLoops + 1) * beatsPerLoop) completedLoops++; loopPositionInBeats = songPositionInBeats - completedLoops * beatsPerLoop;</span></span></code> </pre> <br>  Cela nous donne un marqueur qui indique √† loopPositionInBeats combien de partages nous avons parcourus la boucle, ce qui est utile pour de nombreux autres √©l√©ments synchronis√©s.  N'oubliez pas de saisir le nombre de partages de la boucle dans GameObject Conductor. <br><br>  Nous devons √©galement examiner attentivement le calcul des actions.  La musique commence toujours √† 1, donc la mesure en 4 parties prend la forme 1-2-3-4-, et dans notre classe loopPositionInBeats commence √† 0,0 et boucle sur 4,0.  Par cons√©quent, le milieu exact de la boucle, qui lors du calcul des proportions musicales sera 3, dans loopPositionInBeats aura une valeur de 2,0.  Vous pouvez modifier loopPositionInBeats pour en tenir compte, mais cela affectera tous les autres calculs, soyez donc prudent lors de l'insertion de notes. <br><br>  Pour les autres outils, il sera √©galement utile d'ajouter deux autres aspects √† la classe Conductor.  Tout d'abord, une version analogique de LoopPositionInBeats appel√©e LoopPositionInAnalog, qui mesure la position dans la boucle dans la plage de 0 √† 1,0.  La seconde est une instance de la classe Conductor pour des appels pratiques √† partir d'autres classes.  Ajoutez les variables suivantes √† la classe Conductor: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//The current relative position of the song within the loop measured between 0 and 1. public float loopPositionInAnalog; //Conductor instance public static Conductor instance;</span></span></code> </pre> <br>  Dans la fonction Awake (), ajoutez: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { instance = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }</code> </pre> <br>  et ajoutez √† la fonction Update (): <br><br><pre> <code class="cs hljs">loopPositionInAnalog = loopPositionInBeats / beatsPerLoop;</code> </pre> <br><h1>  Turn Sync </h1><br>  Il serait tr√®s utile de synchroniser le mouvement ou la rotation avec les lobes afin que les √©l√©ments soient aux bons endroits.  Dans mon jeu Atomic Beats, je l'ai utilis√© pour faire pivoter dynamiquement les notes autour d'un axe central.  Initialement, ils ont √©t√© plac√©s autour de la circonf√©rence en fonction de leur part √† l'int√©rieur de la boucle, puis toute la zone de jeu a √©t√© tourn√©e de sorte que les notes correspondent √† la ligne de d√©pression de leur part. <br><br>  Pour ce faire, cr√©ez un nouveau script appel√© SyncedRotation et attachez-le au GameObject que vous souhaitez faire pivoter.  Ajoutez √† la fonction Update () du script SyncedRotation: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gameObject.transform.rotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, Mathf.Lerp(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">360</span></span>, Conductor.instance.loopPositionInAnalog)); }</code> </pre> <br>  Ce code interpolera la rotation du GameObject auquel ce jeu est li√© dans l'intervalle de 0 √† 360 degr√©s, en le tournant de mani√®re √† ce qu'il effectue un tour complet √† la fin de chaque boucle.  Ceci est utile √† titre d'exemple, mais pour les animations en boucle ou image par image, il serait plus utile de synchroniser les animations en boucle afin qu'elles correspondent parfaitement au tempo. <br><br><h1>  Synchronisation d'animation </h1><br>  Unity <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Animator est</a> extr√™mement puissant, mais pas toujours pr√©cis.  Pour un alignement fiable des animations et de la musique, j'ai d√ª rivaliser avec la classe Animator et sa tendance √† se d√©synchroniser progressivement avec le rythme.  De plus, il √©tait difficile d'ajuster les m√™mes animations √† des tempos diff√©rents, de sorte que lors du basculement entre les compositions, vous n'aviez pas √† red√©finir les images cl√©s de l'animation au tempo actuel.  Au lieu de cela, nous pouvons aller directement √† la boucle d'animation et d√©finir la position dans cette boucle en fonction de notre position dans la boucle de la classe Conductor. <br><br>  Cr√©ez d'abord une nouvelle classe appel√©e SyncedAnimation et ajoutez-y les variables suivantes: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//The animator controller attached to this GameObject public Animator animator; //Records the animation state or animation that the Animator is currently in public AnimatorStateInfo animatorStateInfo; //Used to address the current state within the Animator using the Play() function public int currentState;</span></span></code> </pre> <br>  Attachez-le √† un GameObject nouveau ou existant que vous souhaitez animer.  Dans cet exemple, nous allons simplement d√©placer l'objet d'avant en arri√®re sur l'√©cran, mais le m√™me principe peut √™tre appliqu√© √† n'importe quelle animation, que ce soit avant de d√©finir la propri√©t√©, ou animation image par image.  Ajoutez un √©l√©ment Animator √† GameObject et cr√©ez un nouveau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">contr√¥leur Animator</a> appel√© SyncedAnimController, ainsi qu'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">clip d'animation</a> appel√© BackAndForth.  Nous chargeons le contr√¥leur dans la classe Animator attach√©e au GameObject et ajoutons Animation √† l'arborescence d'animation comme animation par d√©faut. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d5f/582/0e3/d5f5820e383580dbc69b18dd037a67a1.png"></div><br>  Par exemple, j'ai configur√© l'animation de sorte qu'elle d√©place d'abord l'objet vers la droite de 6 unit√©s, puis vers la gauche de -6, puis de nouveau √† 0. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dbc/d3a/0b9/dbcd3a0b909bb95cc0a91aaf2eaf65e0.png"></div><br>  Maintenant, pour synchroniser l'animation, ajoutez le code suivant √† la fonction Start () de la classe SyncedAnimation, qui initialise les informations sur l'animateur: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//Load the animator attached to this object animator = GetComponent&lt;Animator&gt;(); //Get the info about the current animator state animatorStateInfo = animator.GetCurrentAnimatorStateInfo(0); //Convert the current state name to an integer hash for identification currentState = animatorStateInfo.fullPathHash; }</span></span></code> </pre> <br>  Ajoutez ensuite le code suivant √† Update () pour d√©finir l'animation: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//Start playing the current animation from wherever the current conductor loop is animator.Play(currentState, -1, (Conductor.instance.loopPositionInAnalog)); //Set the speed to 0 so it will only change frames when you next update it animator.speed = 0; }</span></span></code> </pre> <br>  Nous positionnons donc l'animation dans le cadre exact de l'animation par rapport √† une boucle compl√®te.  Par exemple, si vous utilisez l'animation ci-dessus, lorsque vous √™tes au milieu de la boucle, la position GameObject ne fera que croiser 0. Cela peut √™tre appliqu√© √† toute animation que vous cr√©ez que vous souhaitez synchroniser avec le tempo du conducteur. <br><br>  Il convient √©galement de noter que pour cr√©er une boucle transparente d'animations, vous devez configurer les tangentes des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">images cl√©s</a> individuelles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de l'animation</a> sur la courbe d'animation.  Le param√®tre Lin√©aire cr√©era une ligne droite allant d'une image cl√© √† la suivante, et Constant conservera l'animation dans une valeur jusqu'√† l'image cl√© suivante, ce qui donnera un mouvement saccad√© et net. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f4c/68e/db4/f4c68edb4ab3e874379d8f6874b74fea.png"></div><br>  Bien que cette m√©thode soit utile, elle affecte toutes les transitions de l'animation, car elle oblige <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">animationState</a> √† rester dans l'√©tat dans lequel elle se trouvait lors de l'ex√©cution initiale du script.  Cette m√©thode est utile pour les objets qui n'ont besoin que d'une animation synchronis√©e sans fin, mais pour cr√©er des objets plus complexes avec diff√©rentes animations synchronis√©es, vous devez ajouter du code qui traite ces transitions et d√©finit la variable currentState en fonction de l'√©tat d'animation souhait√©. <br><br><h1>  Conclusion </h1><br>  Ce ne sont l√† que quelques-uns des aspects qui m'ont √©t√© utiles dans la cr√©ation d'Atomic Beats.  Certains d'entre eux ont √©t√© collect√©s √† partir d'autres sources ou cr√©√©s par n√©cessit√©, mais la plupart d'entre eux je n'ai pas pu trouver sous la forme finie, alors j'esp√®re que cela sera utile!  Peut-√™tre qu'une partie de mon syst√®me ne sera plus utile dans les grands projets en raison des limitations du processeur ou du syst√®me audio, mais ce sera une bonne base pour jouer √† un jam de jeu ou √† un projet de loisir. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ae/2a4/f7b/9ae2a4f7be098cc23e5b7283d5b1b9ba.png" alt="image"></div><br>  La cr√©ation d'un jeu de rythme ou d'√©l√©ments de jeu synchronis√©s avec la musique peut √™tre difficile.  Pour garder tout √† un rythme constant, vous aurez peut-√™tre besoin d'un code d√©licat; un r√©sultat qui vous permet de jouer √† un rythme constant peut √™tre tr√®s attrayant pour le joueur.  Beaucoup plus peut √™tre fait dans ce genre que les jeux dans le style traditionnel Dance Dance Revolution, et j'esp√®re que cet article vous aidera √† r√©aliser de tels projets.  Je recommande √©galement, si possible, d'√©valuer mon jeu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Atomic Beats</a> .  Je l'ai fait en un mois au printemps de cette ann√©e, il a 8 pistes courtes et c'est gratuit! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr452168/">https://habr.com/ru/post/fr452168/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr452152/index.html">Quelles solutions Rostelecom propose-t-il pour IIoT</a></li>
<li><a href="../fr452154/index.html">Cube virtuel - au lieu d'OLAP</a></li>
<li><a href="../fr452158/index.html">TOPchik - un plugin WordPress ouvert pour la v√©rification gratuite des positions du site pour les requ√™tes de recherche, via l'API Yandex.XML</a></li>
<li><a href="../fr452162/index.html">Bot pour VK sur Python avec MySQL dans une heure, partie 1</a></li>
<li><a href="../fr452164/index.html">ModLook - Scanner de registre ModBus. C√©l√©bration du 20e anniversaire du programme</a></li>
<li><a href="../fr452172/index.html">Syst√®mes complexes. Atteindre un niveau critique</a></li>
<li><a href="../fr452174/index.html">Il n'a pas besoin de toi</a></li>
<li><a href="../fr452178/index.html">Analyse: 23 erreurs populaires en anglais √©crit et comment les √©viter</a></li>
<li><a href="../fr452180/index.html">Nous augmentons les performances des SSD des genoux, o√π cliquer et pourquoi</a></li>
<li><a href="../fr452182/index.html">Enqu√™te aupr√®s des employ√©s. L'erreur principale</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>