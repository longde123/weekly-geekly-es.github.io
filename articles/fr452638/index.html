<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò¢ üàÅ üõÄüèæ Comment nous avons lanc√© 2GIS sous CarPlay et nous d√©m√™lons toujours ü§ù üë∏üèø üéØ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut Je m'appelle Vanya, j'√©cris une application mobile 2GIS pour iOS. Aujourd'hui, il y aura une histoire sur la fa√ßon dont notre navigateur est app...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment nous avons lanc√© 2GIS sous CarPlay et nous d√©m√™lons toujours</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/2gis/blog/452638/"><p><img src="https://habrastorage.org/webt/tt/jg/a3/ttjga3qmefdwknrbj1i351exs3m.jpeg"></p><br><p>  Salut  Je m'appelle Vanya, j'√©cris une application mobile 2GIS pour iOS.  Aujourd'hui, il y aura une histoire sur la fa√ßon dont notre navigateur est apparu dans CarPlay.  Je vais vous expliquer comment, avec une telle documentation et des outils inachev√©s, nous avons cr√©√© un produit fonctionnel et l'avons plac√© dans l'AppStore. </p><a name="habracut"></a><br><h2 id="para-slov-o-carplay">  Quelques mots sur CarPlay </h2><br><p><img src="https://habrastorage.org/webt/hq/vu/xw/hqvuxwo3ms1ivfppuaojrfscvh0.jpeg"></p><br><p>  Tout d'abord, un peu de mat√©riel pour comprendre certains aspects de CarPlay et les raisons pour lesquelles nous avons pris certaines d√©cisions. </p><br><p>  CarPlay n'est pas un syst√®me d'exploitation dans un autre syst√®me d'exploitation, comme de nombreux articles l'√©crivent.  Si c'est grossier, alors CarPlay est un protocole pour travailler avec un affichage externe de l'√©cran de l'unit√© principale;  le son des haut-parleurs de voiture;  √©crans tactiles, panneaux tactiles, rondelles et autres p√©riph√©riques d'entr√©e. </p><br><p>  C'est-√†-dire que l'int√©gralit√© du code ex√©cutable est situ√© directement dans l'application principale (pas m√™me dans une extension s√©par√©e!) C'est tr√®s cool: pour obtenir de nouvelles fonctionnalit√©s, vous n'avez pas besoin de mettre √† jour la radio ou m√™me la machine, il vous suffit de mettre √† jour iOS. </p><br><p> Lors de la Keynote de la WWDC 2018, nous avons eu l'opportunit√© de cr√©er des applications de navigation pour CarPlay, ce qui nous a fait tr√®s plaisir.  Imm√©diatement apr√®s la pr√©sentation, nous avons envoy√© une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">demande</a> d'autorisation de d√©veloppement pour CarPlay.  Dans la demande, il fallait d√©montrer que notre application est capable de navigation. </p><br><p>  Pendant que nous attendions une r√©ponse d'Apple, il y a eu une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">conf√©rence</a> dans laquelle, en utilisant l'exemple d'application CountryRoads, a parl√© de travailler avec CarPlay.framework.  La conf√©rence n'a pas parl√© des pi√®ges et des subtilit√©s lorsque vous travaillez avec CarPlay, mais a mentionn√© qu'apr√®s la connexion √† la radio CarPlay, l'application fonctionnera en mode arri√®re-plan. </p><br><h2 id="pervaya-palka-v-kolyosa">  Premier b√¢ton dans les roues </h2><br><p>  L'application en arri√®re-plan nous a d√©√ßus.  Il y avait deux raisons √† cela: </p><br><ol><li>  Nous ne travaillons pas en arri√®re-plan.  Une fois quitt√© cette limitation pour des raisons techniques et pour des √©conomies d'√©nergie. </li><li>  Notre carte est √©crite en OpenGL (oui, obsol√®te, oui, pas Metal, nous le savons tous), et OpenGL en arri√®re-plan ne fonctionne pas.  Au mieux, vous obtenez une vue noire, et au pire, un crash. </li></ol><br><p>  Il √©tait encore possible de faire face au travail en arri√®re-plan, mais la carte devait d√©finitivement √™tre r√©solue.  Puis l'id√©e est venue de passer par le MKMapView standard.  Jusqu'√† ce que vous commenciez √† nous jeter des pierres sur l'id√©e d'utiliser des cartes Apple standard, je vais vous expliquer: nous allions utiliser MKMapView, mais pas les cartes Apple. </p><br><p>  Le fait est que MKMapView peut charger des tuiles tierces.  Les carreaux sont des conteneurs rectangulaires sp√©ciaux pour les textures.  Nous venons de devenir une servochka qui sait donner des tuiles.  Il <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">existe un code d'</a> impl√©mentation sur GitHub. </p><br><h2 id="otvet-ot-apple">  R√©ponse d'Apple </h2><br><p> Nous avons re√ßu une r√©ponse d'Apple, dans laquelle, en plus de l'autorisation de d√©velopper, nous avons √©galement re√ßu de la documentation "pour l'√©lite", le code de l'exemple d'application CountryRoads (il a √©t√© montr√© lors de la conf√©rence WWDC) et, surtout, la cl√© de capacit√© priv√©e <code>com.apple.developer.carplay-maps</code> .  Cette cl√© est √©crite dans le fichier de droits avec la valeur YES, afin que le syst√®me comprenne que vous pouvez traiter les √©v√©nements de CarPlay au d√©marrage de votre application. </p><br><p>  Sans attendre le sprint avec les histoires s√©lectionn√©es pour le d√©veloppement, j'ai grimp√© pour t√©l√©charger Xcode Beta.  La premi√®re tentative de collecte de 2GIS a √©t√© un √©chec.  Mais l'exemple de projet d'application CoutryRoads a pu √™tre assembl√© pour le simulateur. </p><br><p>  Avant chaque ouverture de la fen√™tre du simulateur CarPlay, ce dernier devait √™tre personnalis√© via une telle fen√™tre: </p><br><p><img src="https://habrastorage.org/webt/3p/xn/rf/3pxnrf5dlvtq7n8qkuovquqgbbi.png"></p><br><p>  Pour ce faire, vous deviez √©crire la ligne dans le terminal: par <code>defaults write com.apple.iphonesimulator CarPlayExtraOptions -bool YES</code> </p><br><p>  Pour une raison quelconque, cela n'a pas fonctionn√© - j'ai d√ª l'ex√©cuter sur presque le plus petit simulateur avec une r√©solution de 800 √ó 480 points et une √©chelle √ó 2.  Ce param√®tre fonctionne actuellement et aide beaucoup. </p><br><p>  Apr√®s avoir cr√©√© mon exemple de projet et arm√© de documentation, j'ai commenc√© √† comprendre ce qui se passait. <br>  La premi√®re chose que j'ai r√©alis√©e: les applications de navigation pour CarPlay se composent de vues de base et de couches de mod√®les. </p><br><p><img src="https://habrastorage.org/webt/hf/t2/rw/hft2rwp8m2d71popp3tus4dif20.jpeg"></p><br><p>  La vue de base est votre carte.  Sur cette couche, il ne devrait y avoir qu'une carte, pas d'autres vues et contr√¥les. </p><br><p>  Les mod√®les sont un ensemble obligatoire presque non personnalisable d'√©l√©ments d'interface utilisateur pour afficher les itin√©raires, les man≈ìuvres, toutes sortes de listes, etc. </p><br><h2 id="razrabotka-bety">  D√©veloppement b√™ta </h2><br><p>  Passons √† l'√©criture de code.  La premi√®re chose √† faire est d'impl√©menter quelques m√©thodes CPApplicationDelegate requises dans le fichier ApplicationDelegate. </p><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">application</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> application: UIApplication, didConnectCarInterfaceController controller: CPInterfaceController, to window: CPWindow )</span></span></span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">application</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> application: UIApplication, didDisconnectCarInterfaceController controller: CPInterfaceController, from window: CPWindow )</span></span></span></span> {}</code> </pre> <br><p>  Regardons la signature: </p><br><p>  Avec UIApplication, tout est clair. <br>  CPWindow est le successeur de UIWindow, une fen√™tre pour l'affichage externe de l'unit√© principale de la radio. <br>  CPInterfaceController - quelque chose comme un analogue de UINavigationController, uniquement √† partir de CarPlay.framework. </p><br><p>  Nous passons maintenant directement √† la mise en ≈ìuvre de la m√©thode. </p><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">application</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> application: UIApplication, didConnectCarInterfaceController controller: CPInterfaceController, to window: CPWindow )</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> carMapViewController = <span class="hljs-type"><span class="hljs-type">CarMapViewController</span></span>( interfaceController: controller ) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> navigationController = <span class="hljs-type"><span class="hljs-type">UINavigationController</span></span>( rootViewController: carMapViewController ) window.rootViewController = navigationController }</code> </pre> <br><p>  Dans didConnect, vous devez √©crire du code similaire √† celui que nous avions l'habitude de voir dans didFinishLaunching.  CarMapViewController est une vue de base (le contr√¥leur est en fait, mais ok), selon la documentation. </p><br><p>  Voici l'image que j'ai finalement obtenue: </p><br><p><img src="https://habrastorage.org/webt/vv/l1/xx/vvl1xxebjbdb9ahiuucw1db_rzg.png"></p><br><p>  Quelque part √† ce moment, il m'est apparu que le nouveau syst√®me de nouvelle construction Xcode est activ√© par d√©faut et, tr√®s probablement, √† cause de cela, 2GIS ne le fera pas. </p><br><p>  J'ai ouvert Xcode, install√© un syst√®me de construction h√©rit√© (ou plut√¥t stable, appelons un chat un chat), et ma th√©orie a √©t√© confirm√©e: 2GIS a √©t√© assembl√©. </p><br><p>  Apr√®s avoir d√©fini la m√™me cl√© de capacit√©, j'ai lanc√© 2GIS sous CarPlay et je n'ai vu aucun journal sur le passage de l'application en mode arri√®re-plan.  Cela est devenu encore plus incompr√©hensible, car les ing√©nieurs d'Apple de la sc√®ne ont parl√© du mode d'arri√®re-plan, mais, d'autre part, ils nous ont promis une contentView d'UIAlertView, et en cons√©quence, UIAlertView est devenu obsol√®te. </p><br><p>  Ayant d√©cid√© qu'il devrait en √™tre ainsi, je n'ai pas pris la peine de MKMapView.  Cela nous priverait hors ligne et nous ferait r√©√©crire le rendu des routes. </p><br><h2 id="problema-odnoy-karty">  Probl√®me de carte unique </h2><br><p>  Je n'ai pas eu le temps de me r√©jouir de la nouvelle que CarPlay aura notre carte, car le probl√®me suivant m'a confront√©: en raison des caract√©ristiques techniques, il ne peut y avoir qu'une seule carte. <br>  Une solution rapide √† ce probl√®me a √©t√©, bien que pas tr√®s √©l√©gante. </p><br><p>  Habituellement, lorsque vous utilisez 2GIS sur CarPlay, le t√©l√©phone est verrouill√© et se trouve quelque part sur l'√©tag√®re.  Donc, la carte en ce moment sur le t√©l√©phone n'est pas vraiment n√©cessaire (cela ne fera pas de mal √† chercher, bien s√ªr).  Par cons√©quent, lorsque nous avons connect√© le t√©l√©phone √† CarPlay, nous avons d√©cid√© de retirer la carte de l'application principale et de l'afficher sur l'√©cran CarPlay de la radio.  Et une fois d√©connect√©, revenez √† l'application sur le t√©l√©phone. </p><br><p>  Oui, c'est une solution en soi, mais c'est rapide, cela fonctionne toujours et n'a pas eu besoin de lancer quelques autres commandes pour riveter MVP. </p><br><h2 id="kontroly-na-karte">  Contr√¥les sur la carte </h2><br><p>  Donc, nous avons obtenu notre carte sur l'√©cran de la radio.  Maintenant, il √©tait n√©cessaire de faire les premi√®res choses √©videntes pour n'importe quelle carte: les commandes de zoom, l'emplacement actuel et le mouvement de la carte. </p><br><p><img src="https://habrastorage.org/webt/c2/ql/u8/c2qlu8wi-sbkh5zizb7mjab-n7w.png"></p><br><p>  Commen√ßons par le zoom et l'emplacement actuel, car ces contr√¥les sont situ√©s sur la carte elle-m√™me et ce ne sont pas des UIControl ordinaires.  Comme je l'ai √©crit ci-dessus, seule la carte est sur la vue de base. </p><br><p>  Afin de placer ces contr√¥les sur la carte, j'ai d√ª aller √† nouveau dans la documentation et l'exemple d'application.  L√†, j'ai lu sur le premier mod√®le - CPMapTemplate. </p><br><p><img src="https://habrastorage.org/webt/5d/xn/26/5dxn263mlspdif8eqhxgc8wjgmc.png"></p><br><p>  CPMapTemplate - un mod√®le transparent pour afficher certains contr√¥les sur la carte et l'analogue de la barre de navigation.  Il est cr√©√© et configur√© comme ceci: </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mapTemplate = <span class="hljs-type"><span class="hljs-type">CPMapTemplate</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.interfaceController.setRootTemplate(mapTemplate, animated: <span class="hljs-literal"><span class="hljs-literal">false</span></span>)</code> </pre> <br><p>  Ensuite, vous devez cr√©er ces contr√¥les et les mettre sur la carte. </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> zoomInButton = <span class="hljs-type"><span class="hljs-type">CPMapButton</span></span>(‚Ä¶) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> zoomOutButton = <span class="hljs-type"><span class="hljs-type">CPMapButton</span></span>(‚Ä¶) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> myLocationButton = <span class="hljs-type"><span class="hljs-type">CPMapButton</span></span>(‚Ä¶) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mapTemplate.mapButtons = [ zoomInButton, zoomOutButton, myLocationButton ]</code> </pre> <br><p>  Mais le tableau mapButtons s'est av√©r√© dr√¥le, car peu importe le nombre d'√©l√©ments que vous y mettez, il ne prendra que les trois premiers √©l√©ments et les affichera √† l'√©cran.  Vous ne recevrez aucune erreur dans le journal ou les assertions. </p><br><p>  Ensuite, j'ai pu voir comment je peux faire bouger la carte, et je l'ai trouv√© dans la documentation: </p><br><pre> <code class="plaintext hljs">Navigation apps are designed to work with a variety of car input devices, and CarPlay does not support direct user interaction in the base view (apps do not directly receive tap or drag events).</code> </pre> <br><p>  √âtrange, ai-je pens√©, et j'ai pu voir comment cela se faisait dans l'exemple d'application CountryRoads.  La r√©ponse passe par cette interface: </p><br><p><img src="https://habrastorage.org/webt/o0/wa/v6/o0wav6ogb8ofbx7-xqxsamjd6g4.png"></p><br><p>  Pas tr√®s pratique, mais d'une mani√®re diff√©rente, la documentation ne mentira pas, non? </p><br><p>  Depuis la place des contr√¥les sur la carte que nous avions √©puis√©e, il a fallu faire un bouton pour mettre la carte en mode "drag" dans cet analogue de navigationBar. </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> panButton = <span class="hljs-type"><span class="hljs-type">CPBarButton</span></span>(‚Ä¶) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mapTemplate.leadingNavigationBarButtons = [panButton] <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mapTemplate.trailingNavigationBarButtons = []</code> </pre> <br><p>  Mais les tableaux des principauxNavigationBarButtons et trailingNavigationBarButtons n'√©taient pas sans plaisanterie: combien d'√©l√©ments en eux poussent, ils ne prendront que les deux premiers.  Aussi sans erreurs dans le journal et les assertions. </p><br><p>  Et pour activer et d√©sactiver le mode glisser-d√©poser de la carte, vous devez √©crire: </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mapTemplate.showPanningInterface(animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mapTemplate.dismissPanningInterface(animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>)</code> </pre> <br><h2 id="postroenie-i-otobrazhenie-marshrutov-na-karte">  Cr√©ation et affichage d'itin√©raires sur une carte </h2><br><p>  Ensuite, j'ai commenc√© √† r√©utiliser notre API existante pour cr√©er des itin√©raires. </p><br><p>  Juste pour une d√©monstration et comprendre quoi et comment faire, j'ai d√©cid√© de prendre deux points et de construire un itin√©raire entre eux.  Le point A √©tait l'emplacement de l'utilisateur et le point B √©tait notre bureau principal √† Novossibirsk. </p><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> choice0 = <span class="hljs-type"><span class="hljs-type">CPRouteChoice</span></span>( summaryVariants: [<span class="hljs-string"><span class="hljs-string">"46 "</span></span>], additionalInformationVariants: [<span class="hljs-string"><span class="hljs-string">"  "</span></span>], selectionSummaryVariants: [<span class="hljs-string"><span class="hljs-string">"1  7 "</span></span>] ) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> choice1 = <span class="hljs-type"><span class="hljs-type">CPRouteChoice</span></span>( summaryVariants: [<span class="hljs-string"><span class="hljs-string">"46 "</span></span>], additionalInformationVariants: [<span class="hljs-string"><span class="hljs-string">"  "</span></span>], selectionSummaryVariants: [‚Äú<span class="hljs-number"><span class="hljs-number">1</span></span>  <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-string"><span class="hljs-string">"] ) let startItem = MKMapItem(‚Ä¶) let endItem = MKMapItem(‚Ä¶) endItem.name = "</span></span>,  ‚Äù <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> trip = <span class="hljs-type"><span class="hljs-type">CPTrip</span></span>( origin: startItem, destination: endItem, routeChoices: [choice0, choice1] ) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> tripPreviewTextConfiguration = <span class="hljs-type"><span class="hljs-type">CPTripPreviewTextConfiguration</span></span>( startButtonTitle: <span class="hljs-string"><span class="hljs-string">" ‚Äù, additionalRoutesButtonTitle: ‚Äú‚Äù, overviewButtonTitle: "</span></span><span class="hljs-string"><span class="hljs-string">" ) self.mapTemplate.showTripPreviews( [trip], textConfiguration: tripPreviewTextConfiguration )</span></span></code> </pre> </div></div><br><p>  Sur l'√©cran, nous avons obtenu un contr√¥le avec une description de l'itin√©raire: </p><br><p><img src="https://habrastorage.org/webt/wi/on/5r/wion5rbc8wx75tqwxzn-x72zsqw.png"></p><br><h2 id="rezhim-navigacii">  Mode navigation </h2><br><p>  Les itin√©raires sont bons, mais la principale caract√©ristique du navigateur est la navigation.  Pour qu'il apparaisse, vous devez √©crire ce qui suit: </p><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapTemplate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mapTemplate: CPMapTemplate, startedTrip trip: CPTrip, using routeChoice: CPRouteChoice )</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.navigationSession = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mapTemplate.startNavigationSession(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: trip) }</code> </pre> <br><p>  CPNavigationSession - une classe avec laquelle vous pouvez afficher certains √©l√©ments d'interface utilisateur qui sont n√©cessaires uniquement en mode navigation. </p><br><p>  Pour afficher la man≈ìuvre, vous devez: </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> maneuver = <span class="hljs-type"><span class="hljs-type">CPManeuver</span></span>() maneuver.symbolSet = <span class="hljs-type"><span class="hljs-type">CPImageSet</span></span>( lightContentImage: icon, darkContentImage: darkIcon ) maneuver.instructionVariants = [<span class="hljs-string"><span class="hljs-string">". "</span></span>] maneuver.initialTravelEstimates = <span class="hljs-type"><span class="hljs-type">CPTravelEstimates</span></span>(‚Ä¶) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.navigationSession?.upcomingManeuvers = [maneuver]</code> </pre> <br><p>  Ensuite, sur l'√©cran de la radio, nous obtenons ceci: </p><br><p><img src="https://habrastorage.org/webt/30/uj/tp/30ujtpqhaaqkgx1oon7mjxpxiq8.png"></p><br><p>  Pour mettre √† jour la s√©quence √† manoeuvrer, vous devez: </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> estimates = <span class="hljs-type"><span class="hljs-type">CPTravelEstimates</span></span>(‚Ä¶) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.navigationSession?.updateEstimates(estimates, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: maneuver)</code> </pre> <br><h2 id="it-just-works">  √áa marche! </h2><br><p>  Lorsque la fonctionnalit√© de base du navigateur √©tait pr√™te, j'ai d√©cid√© de montrer ce m√©tier dans une pr√©sentation interne.  La pr√©sentation a √©t√© un succ√®s: tout le monde a eu l'id√©e de terminer, tester et lancer le navigateur dans les plus brefs d√©lais. </p><br><p>  Tout d'abord, nous avons command√© une v√©ritable unit√© centrale avec prise en charge de CarPlay.  Et puis, comme on dit, la chaleur a commenc√©. </p><br><p><img src="https://habrastorage.org/webt/wz/2-/cj/wz2-cjj1rusmnd270gkr5h8tdj0.jpeg" alt="PIONEER AVH-Z500BT"></p><br><h3 id="provision-profiles">  Profils de provision </h3><br><p>  En raison de l'ajout d'une nouvelle cl√© de capacit√©, les profils doivent √™tre r√©g√©n√©r√©s.  En d√©veloppement normal, nous n'y pensons pas, car Xcode fera tout par lui-m√™me.  Mais pas dans le cas d'une cl√© priv√©e. </p><br><pre> <code class="plaintext hljs">Code Signing Error: Automatic signing is unable to resolve an issue with the "v4ios" target's entitlements. Automatic signing can't add the com.apple.developer.carplay-maps entitlement to your provisioning profile. Switch to manual signing and resolve the issue by downloading a matching provisioning profile from the developer website.</code> </pre> <br><p>  Cela a √©galement bris√© notre CI, car pour la distribution locale des versions d'application, nous utilisons un compte d'entreprise, dans lequel nous n'avons pas demand√© l'autorisation de d√©velopper l'application pour CarPlay.  Mais c'est une histoire compl√®tement diff√©rente. </p><br><h3 id="debugging">  D√©bogage </h3><br><p>  Vous pouvez vous connecter √† CarPlay via Bluetooth ou Lightning.  La pratique montre que la deuxi√®me m√©thode est beaucoup plus populaire.  Notre radio en Bluetooth ne savait pas comment, donc pendant le d√©veloppement j'ai d√ª utiliser le d√©bogage Wi-Fi.  Si vous l'avez essay√© sur des projets plus difficiles que bonjour, alors vous savez ce que c'est que l'enfer. </p><br><div class="spoiler">  <b class="spoiler_title">Et pour ceux qui n'ont pas essay√©, je dis:</b> <div class="spoiler_text"><p>  J'ai r√©cup√©r√© l'application par fil sur le t√©l√©phone, puis seulement, en connectant le t√©l√©phone √† CarPlay, via Wi-Fi, je l'ai t√©l√©charg√©e sur le t√©l√©phone et l'ai ex√©cut√©e pendant plusieurs minutes. <br>  La copie de l'application sur le t√©l√©phone a dur√© environ 3 minutes, le lancement de l'application pendant environ une minute, et ce n'est qu'apr√®s avoir d√©marr√© l'arr√™t aux points d'arr√™t que 15 secondes plus tard. </p></div></div><br><p>  Et puis, il m'est devenu tr√®s int√©ressant de savoir pourquoi Apple n'a pas cr√©√© de DevKit (pour que Apple-way, √ßa marche et c'est tout).  Il n'√©tait pas tr√®s pratique d'assembler un banc d'essai sans lui.  Jusqu'√† pr√©sent, une fois toutes les deux semaines, quelque chose tombe - vous devez vous souvenir des photos dans quoi vous tenir.  Il est bon que l'administrateur, lors de l'assemblage de ce support, ait dit quoi et pourquoi. </p><br><h2 id="the-best-framework-we-ever-made">  Le meilleur cadre que nous ayons jamais cr√©√© </h2><br><p>  En fin de compte, lorsque tout a √©t√© assembl√© sur un v√©ritable appareil, il est devenu clair que la fonctionnalit√© ¬´2GIS for CarPlay¬ª le serait certainement.  Il est temps de faire de la beaut√©. </p><br><h3 id="problemy-s-vyuportom">  Probl√®mes de fen√™tre </h3><br><p>  Il √©tait n√©cessaire de configurer la fen√™tre de la carte pour tracer des itin√©raires dans la zone sans contr√¥les inutiles, et pas seulement au milieu.  En bref, pour le rendre diff√©rent: </p><br><p><img src="https://habrastorage.org/webt/ns/-k/gw/ns-kgwhubcu9cdqybc4nierpkqe.png"></p><br><p>  Et donc: </p><br><p><img src="https://habrastorage.org/webt/tl/sg/i3/tlsgi347mdeagljpg7i8ojxcjxc.png"></p><br><p>  J'esp√©rais obtenir une sorte de layoutGuide avec la zone visible actuelle.  Pour qu'il prenne en compte la barre de navigation, la vue avec l'itin√©raire et les commandes sur la carte.  En fait, je n'ai rien re√ßu.  On ne sait toujours pas comment configurer la fen√™tre, nous avons donc un code dur comme: </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> routeControlsWidth = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.frame.width * <span class="hljs-number"><span class="hljs-number">0.48</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> zoomControlWidth = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.frame.width * <span class="hljs-number"><span class="hljs-number">0.15</span></span></code> </pre> <br><h3 id="postroenie-proezda-ne-tolko-mezhdu-dvumya-tochkami">  Construction du passage non seulement entre deux points </h3><br><p>  Dans la premi√®re version, nous avons d√©cid√© de prendre notre rubricator fait via CPGridTemplate: </p><br><p><img src="https://habrastorage.org/webt/co/ri/ec/coriec6zvpz0pg5uy72kontsmc8.png"></p><br><p>  Favoris et domicile / travail via CPListTemplate. </p><br><p><img src="https://habrastorage.org/webt/mh/iu/le/mhiulexz-l0j4snzfhdx8pvx8pa.png"></p><br><p>  Et la recherche au clavier via CPSearchTemplate: </p><br><p><img src="https://habrastorage.org/webt/gj/jp/co/gjjpcobjxxf3q_u3gdcoscfclda.png"></p><br><p>  Je ne montrerai pas le code sur les mod√®les, car il est simple et la documentation √† ce sujet est bien √©crite (au moins sur quelque chose). </p><br><div class="spoiler">  <b class="spoiler_title">Cependant, il convient de mentionner les probl√®mes d√©couverts lors de leur utilisation.</b> <div class="spoiler_text"><p>  CPInterfaceController peut en navigation similaire √† UIKit.  c'est-√†-dire </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.interfaceController.pushTemplate(listTemplate, animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.interfaceController.presentTemplate(alertTemplate, animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>)</code> </pre> <br><p>  Mais si vous essayez d'ex√©cuter, par exemple, CPAlertTemplate, vous obtiendrez des assertions dans les journaux que CPAlertTemplate ne peut √™tre repr√©sent√© que de fa√ßon modale. </p><br><p>  On ne sait pas pourquoi Apple n'a pas cach√© la logique des tranches sous le capot sans avoir fait une interface comme: </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.interfaceController.showTemplate(listTemplate, animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>)</code> </pre> <br><p>  Il a √©galement rompu la possibilit√© d'utiliser les h√©ritiers de CPTemplate, comme les contr√¥leurs dans UIKit. </p><br><p>  Lorsque vous essayez, par exemple, de mettre votre h√©ritier sur la pile de mod√®les, vous obtenez ceci: </p><br><pre> <code class="plaintext hljs">Terminating app due to uncaught exception 'NSInvalidArgumentException', reason: 'Unsupported object &lt;YourAwesomeGridTemplate: 0x60000060dce0&gt; &lt;identifier: 6CAC7E3B-FE70-43FC-A8B1-8FC39334A61D, userInfo: (null)&gt; passed to pushTemplate:animated:. Allowed classes: {( CPListTemplate, CPGridTemplate, CPSearchTemplate, CPMapTemplate )}'</code> </pre> </div></div><br><h3 id="testirovanie-i-bagi">  Tests et bogues </h3><br><p>  Test√© par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">artemenko-aa</a> .  L'un des premiers bugs qu'il a trouv√©, nous ne pouvons toujours pas le corriger. </p><br><p>  Le fait est que lorsque vous d√©connectez le t√©l√©phone de la radio CarPlay, Watchdog nous cloue sporadiquement - sans expliquer la raison.  M√™me syslog ouvert, rien n'est clair.  Donc, si vous avez une id√©e de comment r√©soudre ou comprendre la raison, n'h√©sitez pas √† commenter. </p><br><p>  Le bogue suivant √©tait au m√™me endroit, mais avec un comportement sp√©cial.  J'ai √©crit ci-dessus que la m√©thode didDisconnect de CPApplicationDelegate est appel√©e lorsque le t√©l√©phone est d√©connect√© de CarPlay.  Et dans cette m√©thode, nous renvoyons la carte de l'√©cran radio √† l'application principale.  Imaginez combien de probl√®mes nous rencontrerions si cette m√©thode n'√©tait pas appel√©e au moins une fois sur cinq. </p><br><p>  Il est devenu clair qu'il s'agit d'un probl√®me d'iOS, et pas sp√©cifiquement de notre application, car tout le syst√®me pensait qu'il √©tait connect√© √† CarPlay. </p><br><p><img src="https://habrastorage.org/webt/nh/3v/tc/nh3vtc2h-zlu5jutajc6-oyoca4.jpeg"></p><br><p>  Je l'ai m√™me signal√© comme radar (comme tous les autres bugs).  On m'a demand√© de d√©poser des journaux avec un tel profil, mais je n'ai pas pu r√©pondre au support pendant un certain temps, alors ils ont ferm√© le radar. </p><br><p>  Comme Apple n'avait pas l'intention de faire quoi que ce soit, le probl√®me a d√ª √™tre contourn√© de lui-m√™me, car il √©tait reproduit assez souvent. </p><br><p>  Et puis je me suis souvenu que la part du lion des connexions √† CarPlay passe par Lightning.  Cela signifie que le t√©l√©phone est en charge au moment de la connexion et qu'au moment de la d√©connexion, le chargement cesse.  Et si c'est le cas, vous pouvez vous abonner √† l'√©tat de la batterie et savoir exactement quand le t√©l√©phone a cess√© de se charger et s'est d√©connect√© de CarPlay. </p><br><p>  Le sch√©ma est fragile, mais nous n'avions pas le choix.  Nous sommes pass√©s par l√† et √ßa a march√©! </p><br><p><img src="https://habrastorage.org/webt/ql/1h/j0/ql1hj02fnqottbo5fstubt65pss.jpeg"></p><br><p>  Heureusement, cette b√©quille a longtemps √©t√© supprim√©e du code: les d√©veloppeurs Apple ont tout corrig√© dans l'une des versions iOS. </p><br><h2 id="istoriya-dvuh-redzhektov">  L'histoire de deux √©diteurs </h2><br><p>  <strong>La premi√®re redirection</strong> √©tait li√©e aux m√©tadonn√©es.  Le texte de l'√©ditorial indique que notre description (et non les notes de version) ne dit pas que nous soutenons CarPlay.  Comme vous pouvez le deviner, ni la directive d'examen, ni le m√™me Google Maps ne l'avaient.  Nous ne nous sommes pas disput√©s (car c'est g√©n√©ralement plus long que la modification des m√©tadonn√©es), nous avons copi√© la ligne des notes de publication vers la description et avons commenc√© √† attendre une nouvelle r√©vision. </p><br><p>  <strong>Le deuxi√®me projet</strong> s'est produit √† cause de la liste des villes.  2GIS a une fonctionnalit√© tr√®s int√©ressante - un mode de fonctionnement hors ligne complet.  Cette fonction nous a tir√© dans la jambe. </p><br><p>  Lors de la connexion d'une application sans ville √©tablie √† CarPlay, nous ne montrons pas la carte, car il n'y a rien √† afficher.  Et pour cela, nous √©tions programm√©s.  La solution √©tait simple: une alerte sans boutons, qui indique que vous devez t√©l√©charger la ville. </p><br><p><img src="https://habrastorage.org/webt/uf/t7/rx/uft7rxuuaqu7ape9ehifdi6r6ki.png"></p><br><h2 id="to-o-chyom-nelzya-govorit">  De quoi tu ne peux pas parler </h2><br><h3 id="peremeschenie-karty-zhestami">  Mouvement de la carte des gestes </h3><br><p>  Vers la m√™me √©poque, le navigateur sous CarPlay de Google Maps est sorti - et l√†, vous pouvez d√©placer la carte avec des gestes sur l'√©cran.  Les API priv√©es, je pensais, c'est √©vident!  Les gars de Google viennent juste d'un immeuble voisin et ont dit ce dont ils avaient besoin.  Apr√®s tout, la documentation dit: </p><br><pre> <code class="plaintext hljs">Navigation apps are designed to work with a variety of car input devices, and CarPlay does not support direct user interaction in the base view (apps do not directly receive tap or drag events).</code> </pre> <br><p>  Cependant, j'ai quand m√™me d√©cid√© de m'en assurer et j'ai √©t√© googl√©, bien que ce soit presque inutile, car il n'y avait pas d'articles techniques sur les applications de navigation CarPlay.  Cependant, j'ai r√©ussi √† trouver quelque chose d'utile et, SOUDAINEMENT, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur le site d'Apple</a> . </p><br><p>  Dans les directives, j'ai trouv√© une vid√©o qui dit que la documentation ment impudemment.  La vid√©o montre comment vous pouvez toujours faire glisser la carte avec des gestes.  J'ai r√©alis√© que je ne comprenais rien, et la seule chose qui me restait √©tait d'ouvrir CarPlay.framework et de revoir tous les fichiers .h. </p><br><p>  Et voil√†!  Je trouve dans CPMapTemplate son d√©l√©gu√© CPMapTemplateDelegate, dans lequel il y a 3 m√©thodes qui semblent crier que si vous les impl√©mentez, vous pouvez prendre le contr√¥le des gestes de la carte. </p><br><div class="spoiler">  <b class="spoiler_title">3 m√©thodes</b> <div class="spoiler_text"><p>  / * <em>Appel√© lorsqu'un mouvement de panoramique commence.</em>  <em>Ne peut pas √™tre appel√© lorsqu'il est connect√© √† certains syst√®mes CarPlay.</em> <em><br></em>  / <br>  fonction publique facultative mapTemplateDidBeginPanGesture (_ mapTemplate: CPMapTemplate) </p><br><p>  / * <em>Appel√© lorsqu'un mouvement de panoramique change.</em>  <em>Ne peut pas √™tre appel√© lorsqu'il est connect√© √† certains syst√®mes CarPlay.</em> <em><br></em>  / <br>  option publique func mapTemplate (_ mapTemplate: CPMapTemplate, didUpdatePanGestureWith Traduction de traduction: CGPoint, v√©locit√©: CGPoint) </p><br><p>  / * <em>Appel√© √† la fin d'un mouvement de panoramique.</em>  <em>Ne peut pas √™tre appel√© lorsqu'il est connect√© √† certains syst√®mes CarPlay.</em> <em><br></em>  / <br>  fonction publique facultative mapTemplate (_ mapTemplate: CPMapTemplate, didEndPanGestureWithVelocity velocity: CGPoint <br>  ) </p></div></div><br><p>  Je les ai impl√©ment√©s et j'ai ex√©cut√© l'application sur un simulateur - rien n'a fonctionn√©.  N'ayant pas le temps de m'√©nerver, je me suis rendu compte que le simulateur peut √™tre de la m√™me qualit√© que la documentation, et le mets sur l'appareil.  Tout a commenc√©, le bonheur n'a pas de limites! </p><br><p>  Fait amusant: une radio CarPlay a besoin d'un quart de l'√©cran pour comprendre qu'un mouvement de panoramique a commenc√©.  Je veux noter que UIPanGestureRecognizer n'a besoin que de 10 points. </p><br><h3 id="neodinakovost-ui-na-raznyh-magnitolah">  Uniformit√© de l'interface utilisateur sur diff√©rents magn√©tophones radio </h3><br><p>  Nous avons re√ßu un appel √† l'appui: l'utilisateur n'a qu'un seul sajest rampant dans la recherche, bien qu'il puisse y en avoir plus.  C'est √©trange, pensais-je, car sur tous les √©crans, une seule ligne convient.  Ont demand√© une capture d'√©cran: </p><br><p><img src="https://habrastorage.org/webt/_t/k7/u6/_tk7u6wbcv55zig2n-b1dlbm9hu.png"></p><br><p>  Et cela est compl√®tement diff√©rent de l'interface utilisateur de CPSearchTemplate que j'ai montr√©e ci-dessus.  Et cela doit √™tre pris en compte lors du d√©veloppement, bien qu'il soit toujours impossible de comprendre combien de cellules dans la plaque ci-dessous peuvent tenir sur l'√©cran. </p><br><h3 id="kontrol-ogranicheniya-skorosti">  Contr√¥le de limite de vitesse </h3><br><p>  Nous avons examin√© les statistiques et r√©alis√© qu'elles utilisent le navigateur pour CarPlay et nous devons l'amener au moins au niveau du navigateur dans l'application principale.  Tout d'abord, nous avons d√©cid√© d'ajouter un contr√¥le de limitation de vitesse.  Bien s√ªr, il y avait des probl√®mes. </p><br><p>  Question num√©ro un: o√π placer? </p><br><p>  En fouillant √† nouveau autour des fichiers .h dans CPWindow, j'ai trouv√© une mise en page curieuse <br>  var mapButtonSafeAreaLayoutGuide: UILayoutGuide </p><br><p>  Et cela s'est av√©r√© √™tre ce dont nous avions besoin.  Notre contr√¥le s'int√®gre parfaitement: </p><br><p><img src="https://habrastorage.org/webt/vo/m7/qw/vom7qwpkpnxqf9a7wk6arc8-gtm.png"></p><br><p><img src="https://habrastorage.org/webt/q7/kq/fh/q7kqfhk7rrtwdzmergpd9yobbz0.png"></p><br><p>  Question num√©ro deux: est-ce g√©n√©ralement l√©gal? </p><br><p>  Le fait est que techniquement le contr√¥le est sur la vue de base.  Et la vue de base selon la documentation ne peut pas contenir autre chose qu'une carte: </p><br><pre> <code class="plaintext hljs">The base view is where the map is drawn. The base view must be used exclusively to draw a map, and may not be used to display other UI elements. Instead, navigation apps overlay UI elements such as the navigation bar and map buttons using the provided templates.</code> </pre> <br><p>  Mais les examinateurs nous ont manqu√© dans l'AppStore, ce qui signifie que les contr√¥les li√©s √† la navigation peuvent toujours √™tre int√©gr√©s. </p><br><h3 id="golosovoy-poisk">  Recherche vocale </h3><br><p><img src="https://habrastorage.org/webt/di/tt/ov/dittovwssqwrbku8rfd7fxpqlqo.png"></p><br><p><img src="https://habrastorage.org/webt/td/co/z-/tdcoz-1fk1-x880os0muqc_2iso.png"></p><br><p>  Dans le bon sens, cette fonctionnalit√© devait d'abord √™tre effectu√©e, mais nous avons accumul√© plusieurs t√¢ches de la dette technique qui ont emp√™ch√© la mise en ≈ìuvre de la recherche vocale pour CarPlay.  Et cette t√¢che n'√©tait pas aussi simple qu'il y paraissait. </p><br><p>  <strong>Le premier probl√®me: les animations.</strong>  Le fait est que dans CPVoiceControlTemplate il n'y a aucun moyen de faire des animations standard.  Les animations pour la reconnaissance et la recherche de la parole devaient √™tre collect√©es image par image √† partir des images et indiquer le temps pass√©. </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>...<span class="hljs-number"><span class="hljs-number">12</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> image = <span class="hljs-type"><span class="hljs-type">UIImage</span></span>(named: <span class="hljs-string"><span class="hljs-string">"carplay_searching_\(i)"</span></span>) { images.append(image) } } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> image = <span class="hljs-type"><span class="hljs-type">UIImage</span></span>.animatedImage(with: images, duration: <span class="hljs-number"><span class="hljs-number">0.96</span></span>)</code> </pre> <br><p>  Il semble, comme vous pouvez le deviner, pas vraiment, mais je ne veux pas augmenter la taille de l'application. </p><br><p>  <strong>Le deuxi√®me probl√®me: les acc√®s.</strong>  Des alertes d'acc√®s au microphone et de reconnaissance vocale s'affichent sur l'√©cran du t√©l√©phone.  J'ai d√ª √©crire sur l'√©cran de la radio que l'utilisateur devait d√©crocher le t√©l√©phone, donner la permission et ensuite seulement utiliser le navigateur sur la radio.  Tr√®s confortable! </p><br><h3 id="pravorulnye-avtomobili">  Voitures √† conduite √† droite. </h3><br><p>  On nous a envoy√© une capture d'√©cran dans laquelle l'interface utilisateur de l'ensemble de l'application a √©t√© boulevers√©e! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e5c/b97/dc2/e5cb97dc248ebb9ffa0ff46147c290d7.jpg"></p><br><p>  Et, bien s√ªr, la fen√™tre d'affichage de la carte est rest√©e la fa√ßon dont nous l'avons cod√©e en dur, car personne ne s'attendait √† ce qu'il y ait un param√®tre distinct pour les voitures avec conduite √† droite.  Je n'ai pas trouv√© comment contourner cela ¬´correctement¬ª, mais j'ai remarqu√© que, puisque notre contr√¥le de limite de vitesse se trouve dans le layoutGuide pour les contr√¥les de carte, il s'est d√©plac√© vers la gauche. </p><br><p>  Ultrafix ne tarda pas √† venir.  Ils l'ont fait grossi√®rement, mais cela fonctionne. </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> isLeftWheelCar = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.speedControlViewController.view.frame.origin.x &gt; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.frame.size.width / <span class="hljs-number"><span class="hljs-number">2.0</span></span></code> </pre> <br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> J'esp√®re vraiment qu'il existe une bonne solution et je ne l'ai tout simplement pas lue. </font></font></p><br><p>  C‚Äôest tout pour moi.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous envisagez soudainement de cr√©er votre propre navigateur sous CarPlay, gardez √† l'esprit que la documentation et le cadre sont imparfaits. </font><font style="vertical-align: inherit;">La plateforme est compl√®tement nouvelle, personne ne sait rien, et Apple n'est pas press√© de partager ses connaissances.</font></font></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr452638/">https://habr.com/ru/post/fr452638/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr452620/index.html">D√©rivation d'un type d'action √† l'aide de Typescript</a></li>
<li><a href="../fr452622/index.html">Introduction √† la g√©nomique pour les programmeurs</a></li>
<li><a href="../fr452624/index.html">Introduction √† Spring Boot Actuator</a></li>
<li><a href="../fr452628/index.html">Feuille inf√©rieure personnalis√©e: comment cela devrait fonctionner</a></li>
<li><a href="../fr452630/index.html">Sauvegarde, Partie 2: Pr√©sentation et test des outils de sauvegarde bas√©s sur rsync</a></li>
<li><a href="../fr452642/index.html">La force de la foule. Comment Chicago a d√©velopp√© un robot poubelle - un nettoyeur de rivi√®re</a></li>
<li><a href="../fr452644/index.html">Conf√©rence des d√©veloppeurs Web DevConf X - 21 juin</a></li>
<li><a href="../fr452646/index.html">Ce que le r√©seau neuronal a vu dans la premi√®re photographie d'un trou noir</a></li>
<li><a href="../fr452648/index.html">PHP: Comment analyser un fichier XML complexe et ne pas se noyer dans le code natif</a></li>
<li><a href="../fr452652/index.html">Security Week 21: un trou dans Whatsapp, une nouvelle vuln√©rabilit√© dans les processeurs Intel, Zero-Day dans Windows</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>