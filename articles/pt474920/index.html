<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêò üë∑üèª ‚è∏Ô∏è E se n√£o houver um analisador est√°tico para o seu idioma favorito? üë©üèº‚Äçüöí üë® ü§≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bem, se o seu idioma favorito significa russo, ingl√™s etc., esse √© outro hub . E se a linguagem de programa√ß√£o ou marca√ß√£o, √© claro, escreva voc√™ mesm...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>E se n√£o houver um analisador est√°tico para o seu idioma favorito?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474920/"><p>  Bem, se o seu idioma favorito significa russo, ingl√™s etc., esse √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">outro hub</a> .  E se a linguagem de programa√ß√£o ou marca√ß√£o, √© claro, escreva voc√™ mesmo o analisador!  √Ä primeira vista, isso √© muito dif√≠cil, mas, felizmente, existem ferramentas multil√≠ngues prontas que s√£o relativamente f√°ceis de adicionar suporte a um novo idioma.  Hoje mostrarei como adicionar o suporte √† linguagem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Modelica</a> ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">analisador PMD</a> com uma quantidade de tempo bastante pequena. </p><br><p> A prop√≥sito, voc√™ sabe o que pode degradar a qualidade da base de c√≥digo obtida de uma sequ√™ncia de solicita√ß√µes de recebimento ideais?  O fato de que programadores de terceiros copiaram partes do c√≥digo do projeto existente em seus patches em vez de abstra√ß√£o alfab√©tica.  Voc√™ deve admitir que, at√© certo ponto, √© ainda mais dif√≠cil capturar essa banalidade do que o c√≥digo de baixa qualidade - √© de alta qualidade e at√© mesmo cuidadosamente depurado. Portanto, a verifica√ß√£o local n√£o √© suficiente aqui, √© preciso ter em mente toda a base de c√≥digos, mas isso n√£o √© f√°cil para uma pessoa ... Ent√£o: se adicionar suporte completo ao Modelica (sem criar regras espec√≠ficas) ao estado "pode ‚Äã‚Äãexecutar verifica√ß√µes primitivas" levou-me cerca de uma semana; em seguida, o suporte para apenas o detector de copiar e colar pode ser adicionado em um dia! </p><a name="habracut"></a><br><h2 id="kakaya-eschyo-modelica">  O que mais √© Modelica? </h2><br><p> Modelica √©, como o nome sugere, uma linguagem para escrever modelos de sistemas f√≠sicos.  De fato, n√£o apenas f√≠sico: √© poss√≠vel descrever processos qu√≠micos, comportamento quantitativo de popula√ß√µes de animais etc. - isso √© descrito por sistemas de equa√ß√µes diferenciais da forma <code>der(X) = f(X)</code> , onde <code>X</code> √© o vetor de inc√≥gnitas.  Partes imperativas de c√≥digo tamb√©m s√£o suportadas.  As equa√ß√µes diferenciais parciais n√£o s√£o explicitamente suportadas, mas √© poss√≠vel dividir a √°rea de estudo em partes (como provavelmente ter√≠amos feito em uma linguagem de uso geral) e, em seguida, anote as equa√ß√µes de cada elemento, reduzindo o problema √† anterior.  O truque de Modelka √© que a solu√ß√£o para esse <code>der(X) = f(X)</code> est√° com o compilador: voc√™ pode alterar o solucionador <strong>nas configura√ß√µes</strong> , a equa√ß√£o n√£o precisa ser linear etc. Em suma, existem algumas vantagens (escrevi a f√≥rmula do livro - e funcionou) e os contras (com mais abstra√ß√£o, obtemos menos controle).  Uma introdu√ß√£o ao Modelika √© o t√≥pico de um artigo separado (que j√° apareceu v√°rias vezes em Habr√©), e at√© de um ciclo inteiro, hoje me interessa como aberta e com v√°rias implementa√ß√µes, mas, infelizmente, ainda √© um padr√£o √∫mido. </p><br><p>  Al√©m disso, o Modelika, por um lado, possui tipifica√ß√£o est√°tica (o que nos ajudar√° a escrever algumas an√°lises significativas mais rapidamente); por outro lado, ao instanciar um modelo, n√£o √© necess√°rio que o compilador verifique completamente a biblioteca inteira (portanto, um analisador est√°tico √© muito √∫til para capturar "adormecido"). erros).  Por fim, ao contr√°rio de alguns C ++, para os quais h√° uma nuvem de analisadores e compiladores est√°ticos com recursos bonitos, <del>  e o mais importante, consulte modelos C ++ </del>  diagn√≥stico de erros, compiladores Os modelos ainda geram periodicamente um erro interno do compilador, o que significa que h√° espa√ßo para ajudar o usu√°rio mesmo com um analisador bastante simples. </p><br><h2 id="a-chto-za-pmd">  O que √© PMD? </h2><br><p>  Vou responder <del>  m√∫sica </del>  de bicicleta.  Uma vez eu quis fazer uma pequena solicita√ß√£o de pull no ambiente de desenvolvimento do OpenModelica.  Vendo como o salvamento do modelo √© processado em outra parte do c√≥digo, notei uma pequena e n√£o muito clara parte interna de quatro linhas de c√≥digo que suportavam algum tipo de invariante.  N√£o entendo com que tipo de editor ele interage, mas percebendo que, do ponto de vista desse trecho de c√≥digo, minha tarefa √© completamente id√™ntica, eu apenas o coloco em uma fun√ß√£o para que eu possa reutiliz√°-lo e n√£o quebr√°-lo.  Menteiner disse que √© maravilhoso, s√≥ ent√£o substituir esse c√≥digo por uma chamada de fun√ß√£o nos vinte lugares restantes ... Decidi n√£o me envolver ainda e apenas fiz outra c√≥pia, observando que, de alguma forma, eu precisaria pentear tudo de uma vez sem misturar com o patch atual.  Pesquisando no Google, encontrei o CPD (Copy-paste Detector) - parte do analisador est√°tico PMD - que suporta ainda mais idiomas do que o pr√≥prio analisador.  Depois de configur√°-lo na base de c√≥digo do OMEdit, eu esperava ver essas duas d√∫zias de pe√ßas de quatro linhas.  Eu simplesmente n√£o os vi (cada um deles simplesmente n√£o excedeu o limite no n√∫mero de tokens), mas vi, por exemplo, a repeti√ß√£o de quase cinquenta linhas de c√≥digo C ++.  Como eu j√° disse, √© improv√°vel que o mentor simplesmente copie uma pe√ßa gigantesca de outro arquivo.  Mas ele poderia facilmente perder isso no PR - porque o c√≥digo, por defini√ß√£o, j√° atendia a todos os padr√µes do projeto!  Quando compartilhei a observa√ß√£o com o mentor, ele concordou que seria necess√°rio fazer a limpeza como parte de uma tarefa separada. </p><br><p>  Por conseguinte, o PMD (Detector de Erros do Programa) √© um analisador est√°tico facilmente extens√≠vel.  Talvez ele n√£o calcule o conjunto de valores que uma vari√°vel pode receber (embora quem sabe ...), mas para adicionar regras a ela, voc√™ nem precisa conhecer Java e, de alguma forma, alterar seu c√≥digo!  O fato √© que a primeira coisa que ele, e n√£o surpreendentemente, est√° criando arquivos AST com c√≥digos-fonte.  E como √© a √°rvore de an√°lise de origem?  Para a √°rvore de an√°lise XML!  Portanto, voc√™ pode descrever as regras simplesmente como solicita√ß√µes XPath - para as quais elas correspondem, em seguida, emitimos um aviso.  Eles ainda t√™m um depurador gr√°fico para as regras!  Regras mais complexas, √© claro, podem ser escritas diretamente em Java como visitantes do AST. </p><br><p>  <em><strong>Consequ√™ncia</strong></em> : O PMD pode ser usado n√£o apenas para as regras r√≠gidas e universais que os programadores Java severos comprometeram com o c√≥digo do analisador, mas tamb√©m para o estilo de codifica√ß√£o local - mesmo se voc√™ inserir seu pr√≥prio ruleset.xml local em cada reposit√≥rio! </p><br><h2 id="uroven-1-nahodim-kopipast-avtomatizirovanno">  N√≠vel 1: encontre copiar e colar automaticamente </h2><br><p>  Em princ√≠pio, adicionar suporte para um novo idioma no CPD geralmente √© muito simples.  N√£o vejo sentido em recontar a documenta√ß√£o "como fazer" - √© muito clara, estruturada e passo a passo.  Para recontar uma coisa dessas - jogue apenas em um telefone danificado.  √â melhor descrever o que espera por voc√™ <em>(TLDR: tudo bem)</em> : </p><br><ul><li>  O analisador (PMD e CPD) √© desenvolvido no github no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reposit√≥rio pmd / pmd</a> </li><li>  O depurador de regra visual foi movido para um reposit√≥rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pmd / pmd-designer</a> separado.  Observe que o jar-nickname final √© incorporado automaticamente na <em>distribui√ß√£o bin√°ria</em> do <em>PMD</em> , que o Gradle coletar√° para voc√™ no reposit√≥rio anterior. Voc√™ n√£o precisa clonar especialmente o <code>pmd-designer</code> para isso. </li><li>  O projeto possui uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o do desenvolvedor</a> .  O que eu li foi muito detalhado.  √â verdade que est√° um pouco desatualizado, mas isso √© tratado pela <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">segunda solicita√ß√£o pull</a> : </li></ul><br><p>  Vou avisar que estou desenvolvendo no Ubuntu.  No Windows, ele tamb√©m deve funcionar perfeitamente - tanto em termos de qualidade quanto no sentido de uma maneira ligeiramente diferente de iniciar ferramentas. </p><br><p>  Ent√£o, para adicionar um novo idioma ao CPD, voc√™ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">s√≥</a> precisa ... </p><br><ul><li>  <strong>ATEN√á√ÉO:</strong> se voc√™ deseja suporte total para o PMD antes do lan√ßamento do PMD 7, √© melhor ir diretamente para o n√≠vel 2, pois o suporte normal para a maneira f√°cil atrav√©s da gram√°tica Antlr pronta aparecer√°, de acordo com os rumores, na mesma vers√£o 7, mas por enquanto voc√™ s√≥ gasta tempo (embora e um pouco ...) </li><li>  Bifurque o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reposit√≥rio pmd / pmd</a> . </li><li>  Encontre no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">antlr / grammars-v4</a> uma gram√°tica pronta para o seu idioma - √© claro, se o idioma for interno, voc√™ dever√° escrev√™-lo, mas para o Modelika, por exemplo, foi encontrado.  Aqui, √© claro, voc√™ precisa cumprir as formalidades das licen√ßas - n√£o sou advogado, mas pelo menos preciso especificar a fonte de onde copiei. </li><li>  Depois disso, voc√™ precisa criar o <code>pmd-&lt;your language name&gt;</code> , adicion√°-lo ao Gradle e colocar o arquivo de gram√°tica l√°.  Al√©m disso, depois de ler duas p√°ginas de documenta√ß√£o n√£o estressante, refa√ßa o script de montagem do m√≥dulo Go, algumas classes para carregar o m√≥dulo atrav√©s da reflex√£o, <em>bem, h√° uma coisinha ...</em> </li><li>  Corrija a sa√≠da de refer√™ncia em um dos testes, porque agora o CPD suporta mais um idioma!  Como voc√™ encontra esse teste?  Muito f√°cil: <em>ele quer quebrar a constru√ß√£o</em> . </li><li>  LUCRO!  √â muito simples, <em>desde que exista uma gram√°tica pronta</em> </li></ul><br><p>  Agora, estando na raiz do reposit√≥rio pmd, voc√™ pode digitar <code>./mvnw clean verify</code> , enquanto em <code>pmd-dist/target</code> voc√™ ter√°, entre outras coisas, distribui√ß√£o bin√°ria na forma de um arquivo zip que voc√™ precisa descompactar e executar usando <code>./bin/run.sh cpd --minimum-tokens 100 --files /path/to/source/dir --language &lt;your language name&gt;</code> no diret√≥rio descompactado.  Em princ√≠pio, voc√™ pode <code>../mvnw clean verify</code> partir do seu novo m√≥dulo, o que acelerar√° drasticamente a montagem, mas ser√° necess√°rio colocar corretamente o apelido do jar montado na distribui√ß√£o bin√°ria descompactada (por exemplo, montada uma vez ap√≥s o registro de um novo m√≥dulo). </p><br><h2 id="uroven-2-nahodim-oshibki-i-narusheniya-style-guide">  N√≠vel 2: localizando erros e viola√ß√µes do guia de estilo </h2><br><p>  Como eu disse, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PMD 7 promete</a> suporte total ao Antlr.  Se voc√™, como eu, n√£o quiser esperar pela libera√ß√£o do mar, precisar√° obter uma descri√ß√£o da gram√°tica do idioma no formato JJTree de algum lugar.  Talvez voc√™ possa fortalecer o suporte de um analisador arbitr√°rio - a documenta√ß√£o diz que isso √© poss√≠vel, <em>mas eles n√£o dizem exatamente</em> ... Acabei de pegar o <code>modelica.g4</code> do mesmo reposit√≥rio com gram√°ticas para o Anltr como base e refaz√™-lo manualmente no JJTree.  Naturalmente, se a gram√°tica acabou sendo um processamento da existente, indique novamente a fonte, verifique a conformidade com as licen√ßas e.  etc. </p><br><p>  A prop√≥sito, para uma pessoa que √© bem versada em todos os tipos de geradores de analisadores, √© improv√°vel que isso seja uma surpresa.  Antes disso, eu o usava seriamente, a menos que eu mesmo escrevesse regulares e combinadores de analisadores no Scala.  Portanto, a coisa √≥bvia, de fato, me entristeceu a princ√≠pio: a AST, √© claro, vou obter do <code>modelica.g4</code> , mas n√£o parece muito claro e "utiliz√°vel": haver√° nuvens de n√≥s extras nele, e se voc√™ n√£o olhar os <strong>tokens</strong> , mas apenas em n√≥s, nem sempre √© claro onde, por exemplo, o ramo <code>then</code> termina e <code>else</code> come√ßa. </p><br><p>  Novamente, n√£o vou recontar a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o do JJTree</a> e um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bom tutorial</a> - desta vez, n√£o porque o original brilha com detalhes e clareza, mas porque eu mesmo n√£o a descobri completamente, mas a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o foi retransmitida</a> incorretamente, mas com confian√ßa, obviamente pior do que n√£o recontar.  √â melhor deixar uma pequena pista, descoberta ao longo do caminho: </p><br><ul><li>  Em primeiro lugar, o <strong>c√≥digo de descri√ß√£o do analisador JavaCC assume inser√ß√µes Java que ser√£o inscritas no analisador gerado</strong> </li><li>  N√£o se confunda com o fato de que, ao criar um AST, sintaxe como <code>[ Expression() ]</code> significa opcional e, no contexto da descri√ß√£o de tokens - escolha de um personagem, como em uma express√£o regular.  Tanto quanto eu entendo a explica√ß√£o dos desenvolvedores de PMD, essas s√£o constru√ß√µes semelhantes que t√™m um significado t√£o diferente - legado, senhor ... </li><li>  Para o n√≥ raiz (no meu caso, <code>StoredDefinition</code> ), voc√™ deve especificar seu tipo em vez de <code>void</code> (ou seja, <code>ASTStoredDefiniton</code> ) </li><li>  Usando a sintaxe <code>#void</code> ap√≥s o nome do n√≥, √© poss√≠vel ocult√°-la da √°rvore analisada (ou seja, ela afetar√° apenas qual √© a origem correta e o que n√£o √©, e como os outros n√≥s ser√£o aninhados) </li><li>  Usando uma constru√ß√£o do formul√°rio <code>void SimpleExpression() #SimpleExpression(&gt;1)</code> podemos dizer que o n√≥ deve ser mostrado no AST resultante, se tiver mais de um descendente.  Isso √© muito conveniente ao descrever express√µes com muitos operadores com prioridades diferentes: ou seja, do ponto de vista do analisador, a constante solit√°ria <code>1</code> ser√° algo como <code>LogicExpression(AdditiveExpression(MultiplicativeExperssion(Constant(1))))</code> - <em>insira todos os n n√≠veis de prioridades de opera√ß√£o</em> - mas o c√≥digo do analisador obter√° <code>Constant(1)</code> </li><li>  O n√≥ possui uma <code>image</code> vari√°vel padr√£o (consulte <code>setImage</code> , <code>setImage</code> ), que geralmente <code>setImage</code> a "ess√™ncia" desse n√≥: por exemplo, para um n√≥ correspondente ao nome de uma vari√°vel local, √© l√≥gico copiar o token correspondente com o identificador para a <code>image</code> (por padr√£o, todos os tokens de as √°rvores ser√£o jogadas fora, por isso, vale a pena copiar o significado nelas, de qualquer forma, se for algo vari√°vel, e n√£o apenas palavras-chave) </li><li>  <strong>LOOKAHEAD</strong> - bem, esta √© uma m√∫sica separada, at√© um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cap√≠tulo separado</a> na documenta√ß√£o √© dedicado a ela <br><ul><li>  Em termos gerais, no JavaCC, se voc√™ acessar um n√≥, n√£o poder√° revert√™-lo e tentar analisar de forma diferente, mas poder√° olhar com anteced√™ncia e decidir se deve ou n√£o ir </li><li>  no caso mais simples, ao ver um aviso JavaCC, <del>  voc√™ acabou de dizer no cabe√ßalho <code>LOOKAHEAD = n</code> </del>  e voc√™ recebe erros de an√°lise misteriosos, porque, no caso geral, parece que n√£o pode resolver todos os problemas (bem, exceto que, ao definir alguns bilh√µes de tokens, voc√™ realmente obt√©m uma pr√©via de tudo, mas n√£o do fato de que funciona dessa maneira .. .) </li><li>  na frente do nome do n√≥ incorporado, voc√™ pode indicar explicitamente com base em quantos tokens aqui voc√™ pode definitivamente tomar a decis√£o final </li><li>  se, no caso geral, n√£o houver <strong>um</strong> n√∫mero <strong>fixo</strong> de tokens, voc√™ pode dizer "v√° aqui, se anteriormente, a partir deste ponto, conseguimos combinar esse prefixo - e depois a descri√ß√£o usual da sub√°rvore" </li><li>  tenha cuidado: no caso geral, o JavaCC n√£o pode verificar a exatid√£o das diretivas <code>LOOKAHEAD</code> - confia em voc√™, portanto, pelo menos, descubra a prova matem√°tica de por que esse lookahead √© suficiente ... </li></ul></li></ul><br><p>  Agora que voc√™ tem uma descri√ß√£o da gram√°tica do idioma no formato JJTree, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">essas 14 etapas simples</a> ajudar√£o voc√™ a adicionar suporte ao idioma.  A maioria deles tem o formato "crie uma classe semelhante √† implementa√ß√£o para java ou vm, mas adaptada".  Observarei apenas os recursos t√≠picos, alguns deles aparecer√£o na documenta√ß√£o principal se eles aceitarem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">minha solicita√ß√£o de recebimento de documenta√ß√£o</a> : </p><br><ul><li>  Comentando a remo√ß√£o de todos os arquivos gerados no script de montagem <code>alljavacc.xml</code> (que est√° no seu novo m√≥dulo), voc√™ pode transferi-los para a √°rvore de origem do <code>target/generated-sources</code> .  Mas melhor n√£o.  Provavelmente, apenas uma pequena parte ser√° alterada; portanto, √© melhor excluir apenas algumas: elas viram a necessidade de alterar a implementa√ß√£o padr√£o, copiadas para a √°rvore de origem, adicionadas √† lista de arquivos exclu√≠dos, reconstru√≠das - e agora voc√™ gerencia o arquivo - <strong>especificamente esse arquivo</strong> .  Caso contr√°rio, ser√° dif√≠cil descobrir exatamente o que foi alterado, e o suporte dificilmente pode ser chamado de agrad√°vel. </li><li>  agora que voc√™ possui uma implementa√ß√£o do modo PMD "principal", tamb√©m pode pendurar facilmente no analisador JJTree uma liga√ß√£o para CPD, semelhante ao Java ou a alguma outra implementa√ß√£o dispon√≠vel. </li><li>  Lembre-se de implementar um m√©todo que retorna o nome do host para consultas XPath.  Na implementa√ß√£o padr√£o, obt√©m-se recurs√£o infinita (o nome do n√≥ via <code>toString</code> e vice-versa) ou qualquer outra coisa, em geral, por isso, tamb√©m n√£o √© poss√≠vel olhar para a √°rvore no PMD Designer e, sem isso, a gram√°tica √© realmente triste. </li><li>  parte dos registros de componentes √© feita adicionando arquivos de texto de pontos de entrada de nome de classe totalmente qualificados ao <code>META-INF/services</code> </li><li>  o que pode ser descrito declarativamente nas regras (por exemplo, uma descri√ß√£o detalhada da verifica√ß√£o e exemplos de erros) √© descrito n√£o no c√≥digo, mas na <code>category/&lt;language name&gt;/&lt;ruleset&gt;.xml</code> - em qualquer caso, voc√™ dever√° registrar suas regras l√° </li><li>  ... mas ao implementar os testes, aparentemente, algum mecanismo de descoberta autom√°tica, talvez caseiro, √© usado ativamente, portanto <br><ul><li>  se voc√™ for informado, "adicione um teste trivial para cada vers√£o do idioma" - √© melhor n√£o discutir, eles dizem "eu n√£o preciso disso, funciona assim" - talvez esse seja o mecanismo de detec√ß√£o autom√°tica </li><li>  se voc√™ vir um teste para uma regra espec√≠fica com um corpo de classe contendo apenas um coment√°rio <code>// no additional unit tests</code> , eles n√£o s√£o testes, eles apenas se encontram nos recursos na forma de descri√ß√£o XML dos dados de entrada e rea√ß√µes esperadas do analisador, imediatamente: alguns corretos e alguns exemplos incorretos. </li></ul></li></ul><br><h2 id="malenkiy-no-vazhnyy-kvest-dopili-pmd-designer">  Uma miss√£o pequena, mas importante: terminar o PMD Designer </h2><br><p>  Talvez voc√™ possa depurar tudo sem um visualizador.  Mas porque?  Em primeiro lugar, terminar √© muito simples.  Em segundo lugar, ajudar√° muito os usu√°rios que n√£o est√£o familiarizados com Java: eles s√£o f√°ceis e simples (se isso se aplica ao XPath), bem, ou pelo menos sem recompilar o PMD, ser√£o capazes de descrever padr√µes simples do que eles n√£o gostam (no caso mais simples - um guia de estilo como "o nome de um pacote de modelo sempre come√ßa com um p min√∫sculo"). </p><br><p>  Diferentemente de outros erros que s√£o imediatamente vis√≠veis, os problemas com o PMD Designer s√£o bastante trai√ßoeiros: parece que voc√™ j√° entendeu que a inscri√ß√£o Java no lado direito do menu n√£o √© um bot√£o, mas uma lista suspensa da sele√ß√£o de idioma O_o, na qual ele j√° apareceu Modelica, porque um novo m√≥dulo com registro de pontos de entrada apareceu no caminho de classe.  Mas aqui voc√™ escolhe seu idioma, baixa um arquivo de teste e v√™ o AST.  E parece ser uma vit√≥ria, mas de alguma forma √© preto e branco, e a sub√°rvore destacada pode ser destacada no texto - embora n√£o, o destaque esteja l√°, mas √© atualizado de forma torta - e, no entanto, como eles n√£o tentaram destacar as correspond√™ncias encontradas com o XPath ... J√° calculando a quantidade de trabalho, voc√™ pensa na pr√≥xima solicita√ß√£o pull, mas decide acidentalmente mudar a linguagem para Java e baixar algum c√≥digo fonte do pr√≥prio PMD ... Ah!  √â colorido! .. E o destaque da sub√°rvore funciona!  Uh ... e acontece que normalmente destaca as correspond√™ncias encontradas e grava trechos de texto na caixa √† direita da solicita√ß√£o ... Parece que quando uma exce√ß√£o ocorre no c√≥digo JavaFX durante a renderiza√ß√£o da interface, ela interrompe a renderiza√ß√£o, mas n√£o √© impressa no console ... </p><br><p>  Em geral, voc√™ s√≥ precisa adicionar uma classe ma-a-scarlet para destacar a sintaxe com base em express√µes regulares.  No meu caso, era <code>net.sourceforge.pmd.util.fxdesigner.util.codearea.syntaxhighlighting.ModelicaSyntaxHighlighter</code> , que precisa ser registrado na classe <code>AvailableSyntaxHighlighters</code> .  Observe que essas duas altera√ß√µes ocorrem no reposit√≥rio <code>pmd-designer</code> , cujo artefato de montagem precisa ser colocado em sua distribui√ß√£o bin√°ria. </p><br><p>  No final, √© algo parecido com isto (GIF retirado do README no reposit√≥rio do PMD Designer): </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/289/e3e/92b/289e3e92b353b29c696ed466434307ed.gif" alt="PMD Designer no trabalho"></p><br><h2 id="promezhutochnyy-itog">  Subtotal </h2><br><p>  Se voc√™ concluiu todos esses n√≠veis, agora tem: </p><br><ul><li>  detector de copiar e colar </li><li>  mecanismo de regras </li><li>  visualizador para depurar o AST e traz√™-lo para uma forma conveniente de an√°lise (como j√° vimos, nem todas as gram√°ticas do mesmo idioma s√£o igualmente √∫teis!) </li><li>  o mesmo visualizador para depurar regras XPath que seus usu√°rios podem escrever sem recompilar o PMD e geralmente conhecer Java (XPath, √© claro, tamb√©m n√£o √© BASIC, mas √© pelo menos uma linguagem de consulta padr√£o e n√£o local) </li></ul><br><p>  Espero que voc√™ tamb√©m entenda o fato de que a gram√°tica agora √© uma API est√°vel para sua implementa√ß√£o de suporte a idiomas - n√£o a altere (ou melhor, a fun√ß√£o de converter a fonte em AST descrita por ela), a menos que seja absolutamente necess√°rio e, se voc√™ tiver alterado, notifique como uma altera√ß√£o de interrup√ß√£o, e ent√£o os usu√°rios ficar√£o chateados: provavelmente nem todos escrever√£o testes para suas regras, mas √© muito triste quando as regras verificaram o c√≥digo e pararam sem aviso pr√©vio - quase como um backup, que de repente quebrou, e um ano atr√°s ... </p><br><p>  A hist√≥ria n√£o termina a√≠: pelo menos algumas regras √∫teis precisam ser escritas. </p><br><p>  Mas isso n√£o √© tudo: o PMD suporta nativamente escopos e declara√ß√µes.  Cada n√≥ AST tem escopo associado: o corpo da classe, fun√ß√£o, loop ... O arquivo inteiro, na pior das hip√≥teses!  E em todo escopo, h√° uma lista de defini√ß√µes (declara√ß√µes) que ela cont√©m diretamente.  Como em outros casos, prop√µe-se implementar por analogia com outras linguagens, por exemplo, Modelika (mas no momento da reda√ß√£o, a l√≥gica na minha solicita√ß√£o pull √©, francamente, bruta).   scopes  declarations    visitor,  -  <code>ScopeAndDeclarationFinder</code> ,           ‚Äî  ,    ,  ,  - ,  read-only    AST.        ,    . </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ModelicaHandler</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractLanguageVersionHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... @Override public VisitorStarter getSymbolFacade() { return new VisitorStarter() { @Override public void start(Node rootNode) { new SymbolFacade().initializeWith((ASTStoredDefinition) rootNode); } }; } }</span></span></code> </pre> <br><h2 id="vyvod">  Conclus√£o </h2><br><p>   PMD     .  ,     ¬´¬ª  Clang Static Analyzer   ,           .      ,      CPD (   ),         . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt474920/">https://habr.com/ru/post/pt474920/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt474906/index.html">Xamarin.Forms - Mapeamento QRCode decorativo com SkiaSharp</a></li>
<li><a href="../pt474910/index.html">O que brincar com as crian√ßas antes da escola</a></li>
<li><a href="../pt474912/index.html">Mensagens e alertas no Android via JSON</a></li>
<li><a href="../pt474916/index.html">Aplicar o ambiente Nix-Shell no Visual Studio Code</a></li>
<li><a href="../pt474918/index.html">Melhorando o projeto conjunto de componentes eletromec√¢nicos</a></li>
<li><a href="../pt474922/index.html">Como escolher um VPS</a></li>
<li><a href="../pt474924/index.html">Como se tornar um bom gerente? 4 maneiras de preencher a lacuna nas habilidades de gerenciamento</a></li>
<li><a href="../pt474928/index.html">Aprendendo a seguir o navegador Vivaldi</a></li>
<li><a href="../pt474930/index.html">Leads de grava√ß√£o de Meetup: Obtenha streaming</a></li>
<li><a href="../pt474936/index.html">15 √≥timas ferramentas para criar, armazenar e gerenciar links (bourget)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>