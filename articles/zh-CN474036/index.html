<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤽 🏢 🦖 文字编辑也讨厌你 🛋️ 🔏 👩🏿‍🎤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="一个月前发布的Alexis Bingessner 的文章“ Text Rendering Hate You”非常接近我。 

 早在2017年，我就在浏览器中开发了一个交互式文本编辑器。 我对现有的ContentEditable库不满意，我想：“嘿，重新实现文本的选择！ 很难吗？” 我还年轻 天真。...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>文字编辑也讨厌你</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474036/"> 一个月前发布的Alexis Bingessner <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的</a>文章<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“ Text Rendering Hate You”</a>非常接近我。 <br><br> 早在2017年，我就在浏览器中开发了一个交互式文本编辑器。 我对现有的ContentEditable库不满意，我想：“嘿，重新实现文本的选择！ 很难吗？” 我还年轻 天真。 我认为我可以在两周内处理好它。 实际上，解决这个问题的尝试花了我几年的时间，其中包括从早到晚为一年的有偿工作，以开发新OS的文本编辑器。 <br><br> 在工作中，我很幸运地向<abbr title="一如既往，感谢Raf Levien和Yokhey Yukawa，他们教给我有关打字的一切知识">在该领域具有丰富经验的导师</abbr>学习了很多东西。 我听过很多很多恐怖的故事。 包括一名工程师，该工程师支持Windows应用程序使用文本字段的自定义实现-并希望从过时的文本输入API切换到新版本。 这是此新版本<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">中的</a>文本输入<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">界面</a>的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">列表</a> ： <br><br><img src="https://habrastorage.org/getpro/habr/post_images/905/ade/db0/905adedb0a3bd875236bfadd2c9f533d.png"><br><a name="habracut"></a><br> 没错，有128个用于输入文本的界面。 我几乎可以肯定，有八（8！）种不同类型的锁可以解决并发问题，尽管老实说我没有阅读它们的文档，所以请不要为此引用我。 那个工程师花了一年半的时间（全职！）修改了他的编辑器，但最终失败了，仍然使用旧的API。 <br><br> 打字很难。 <br><br> 亚历克西斯（Alexis）有时会提到文本的选择，但她的个人经历与渲染更为相关。 另一方面，作为一个人，我可以添加关于输入的几点。 <br><br><h3> 垂直光标移动 </h3><br> 我已经在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">上一篇文章中</a>对此进行了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">介绍</a> ，但是我们可以在此快速重复。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d7/dcb/be8/2d7dcbbe886a8da0e23abaf51f092ced.png"></div><br><br> 在此示例中，如果您按向上键，则光标将移至该行的开头，在单词<i>hello</i>之前。 到目前为止，一切都还算合理。 但是，如果先按上下再按，光标将首先跳到<i>hello</i>前面，然后再跳<i>一些</i> 。 <br><br> 这似乎不太合逻辑。 你问他为什么跳到右边？ 好吧，通过垂直移动，每个光标都可以记住以像素为单位的<i>x</i>位置，并且仅在向左或向右按​​下（而不是上下）时更新。 同样的行为可以防止在垂直移动短线时光标向左移动。 <br><br><h3> 接近度 </h3><br> 好的，现在我们知道选择文本时，我们有<i>两种</i>状态：行内的字节偏移和上述以像素为单位的<i>x</i>坐标。 问题解决了吗？ 好吧，不。 <br><br> 考虑在很长的线上的两个光标位置： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bf1/a02/0f5/bf1a020f5aa7512ad957b47717fd4bc2.png"></div><br><br> 由于<i>loooooooooong</i>是一个单词，因此两个光标位置<i>在string中</i>具有<i>完全相同的字节偏移量</i> 。 它们之间没有换行符，因为该行被软包装了。 我们的光标需要额外的一位，告诉他们要去哪一行。 大多数系统将此位称为亲和力。 它也用在混合双向文本中，我们将在稍后讨论。 <br><br><h3> 表情符号修饰符 </h3><br> 假设我向朋友发送了一条消息。 为了表达我的感受，我想添加一个有趣的表情符号。 我在文本区域中输入一个大拇指， <code>a</code>字母<code>a</code>和一个用于皮肤色调的表情符号修饰符。 看起来像这样： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4fd/f6b/1e8/4fdf6b1e84ddd2774b68d335e8b597b8.png"></div><br><br> 哦，我不想写一封信。 我将光标置于其后，然后单击Backspace。 会发生什么？ 我看到了几个选项，具体取决于编辑器。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/237/c58/054/237c580542b2d5921a07adbdfb2d32c5.png"></div><br><br><ul><li>  <b>错误的＃1</b> <i>似乎</i>正确。 但这是文本编辑器与传统表情符号渲染（例如Sublime Text）支持一起工作的方式。 这很不好，因为轻手指表情符号被编码为黄色手指，紧接着是肤色修饰符。 并没有像预期的那样将它们组合为一个符号。 即使我从另一个应用程序复制了轻手指，它仍然无法正确显示，如下所示。 <br></li><li>  <b>错误2号</b>是Chrome 77在地址栏中的功能。 不在网页上，仅在地址栏中。 这不是渲染问题，因为带有肤色的复制粘贴表情符号有效。 取而代之的是，Chrome会删除字母，并注意到字母后面的修饰符，也会将其删除。 哎呀 <br></li><li>  <b>错误的3号</b>与应如何合并表情符号的Unicode规范匹配。 但这对用户来说是非常难以理解的，顺便说一句，您需要移动光标，以使其不会卡在表情符号中。 </li></ul><br> 所有选项都是不好的，因此您可以假设可能有第四个选项。 有！ 许多编辑器（例如TextEdit）甚至不允许您将光标放在字母后面，因为肤色修饰符被认为是前一个字符的单个单元。 这在表情符号的上下文中是有意义的，甚至在这种情况下也能很好地工作，但是如果修饰符由字符串中的第一个字符指示怎么办？ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ef/a2e/3ad/2efa2e3ad0396bd2362cd08694c841fc.png"></div><br><br> 现在，修饰符更改换行符。  TextEdit不允许您将光标放在第二行的开头！ 我个人认为此决定“也很糟糕”。 <br><br> 您可能还已经注意到，大拇指已变成大拇指朝下。 我自己做了这件事，以反映我对整个局势的感受。 <br><br> 顺便说一句，TextEdit专门使第一行上的光标<i>非常有问题</i> 。 例如，猜猜我在这里按<code>4</code>怎样？ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c8/988/687/1c898868781c9461aba7ab1e7cb74255.png"></div><br><br> 是的 您可能还认为数字之间存在空格。 他们不在那里。 <br><br><h3> 双向文字 </h3><br>  Alexis提到混合双向文本中的拆分选择，如本示例中的TextEdit： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/14b/dd3/8c3/14bdd38c366451ff768fc4aa15dc17b3.png"></div><br><br> 这确实是有道理的，因为行中的阿拉伯语是从右到左编码的，因此选择似乎被拆分了，但是字节是一个连续范围。 <br><br> 因此，我们获得此选择有点令人惊讶： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/53d/d86/9aa/53dd869aa064eb6ebc8cac8114147800.png"></div><br><br> 是的，它在视觉上是连续的，但是按字节分隔。 是的，这很糟糕。 如果您使用箭头键而不是鼠标来选择文本，则某些编辑器会执行此操作。 另一种选择是用从右到左的方向交换文本内的左/右键，这也是不好的。 这里没有好的选择。 <br><br> 作为奖励，请尝试了解此处发生的情况： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e88/2bb/b48/e882bbb480ea0a67812b862fc778d815.png"></div><br><br> 上帝...我不想对此发表评论。 <br><br><h3> 关于输入法的事情 </h3><br> 将击键转换为输入的软件称为输入法或输入法编辑器。 对于拉丁字母来说，这不是一个非常有趣的软件，因为每次击键都直接与一个字符的插入相关联。 但是在许多脚本中，字符不适合键盘，因此您必须具有创造力。 例如，在某些中文输入法中，用户输入声音-并获得与声音相似的字符列表： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/257/4be/547/2574be547e63c1408db959a8bd107c90.png"></div><br><br> 该字段有时称为合成区域，通常显示<abbr title="构图面积">在带下划线的文本上方</abbr> 。 有时输入法必须设置样式。 例如，Android上的日语输入法使用背景色创建一个句子共享区域： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b27/583/4c2/b275834c23880b9375d4da714632f1cc.png"></div><br>  <i><font color="gray">（感谢Shae的屏幕截图！）</font></i> <br><br> 所有这些选择和组成区域是否都与双向文本交互？ 让我们不要考虑它。 <br><br> 输入法应该在任何地方都可以使用， <i>即使在终端内部也可以</i> ： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/24d/b76/f54/24db76f544a936d70edb9143a36fdba0.png"></div><br><br> 在从列表中选择汉字之前，Vim不会采取任何措施。 您可能会想：“但是它如何在Vim命令模式下工作？” 不太好 这就是为什么在Internet上文本输入和键击是单独的事件的原因。 在控制台中，它们混合在一起，导致出现问题。 <br><br> 这只是许多不同的文本输入方法的一个示例。  （不要忘记无键盘输入法，例如语音和手写！）幸运的是，操作系统为您提供了所有这些方法。 但是，不幸的是，您的文本框应该使用所有这些方法使用的通用文本输入协议。 对于Windows，这些是本文开头列出的128个接口。 在其他操作系统中，接口更简单，但是仍然难以实现。 <br><br> 您可能还会注意到，输入法是一个单独的过程，因此输入法和应用程序都可以更改文本字段的状态。 这实际上是一个并行编辑协议。  Windows通过八种（8！）锁类型解决了该问题。 尽管跨进程边界锁定似乎令人怀疑，但大多数其他平台都尝试使用不完善的启发式方法来解决并发问题。 或者他们只是希望比赛条件不会发生。 根据我的经验，祈祷不是并行性的非常有效的原始方法。 <br><br><h3> 为什么一切都这么复杂？ </h3><br> 乔纳森·布洛（Jonathan Blow）在有关软件降级的讲座中提到了他在一周内写的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文本编辑器Ken Thompson</a> 。 本文中的大多数代码都是随机引入的复杂性。  Windows是否真的需要128个界面和8种锁来进行文本输入？ 没办法  TextEdit中的错误是复杂的编辑模型的结果吗？ 是的 在现代程序中散布错误是否值得担心？ 至少对我而言。 <br><br> 但是，肯·汤普森（Ken Thompson）的编辑也比我们期望的现代文本编辑器简单得多。  Unicode支持世界上几乎所有活着的语言（大约有7,000种），并且有更多的语言已经消失。 有不同的脚本，文本方向和输入方法，每个脚本都会对任何编辑器施加复杂的限制（在某些情况下是不可解决的）。 但是他还必须支持屏幕阅读器。 <br><br>  <i>不可避免地会</i>积累大量的复杂性，在本文中，我们仅稍作改动。 这是一个真正的编程奇迹，您只需在网页上拍一下<code>&lt;textarea&gt;</code>立即为世界各地的每个Internet用户提供文本输入。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN474036/">https://habr.com/ru/post/zh-CN474036/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN474020/index.html">Methodius如何成为Anna：开发和启动语音消息分类器的经验。 第三部分</a></li>
<li><a href="../zh-CN474024/index.html">我们将机器人吸尘器变成了通用士兵</a></li>
<li><a href="../zh-CN474026/index.html">消费者故事，Asos放弃了其杂志和TikTok</a></li>
<li><a href="../zh-CN474028/index.html">开发人员需要哪些软技能？ Yandex的意见</a></li>
<li><a href="../zh-CN474032/index.html">排列标准单元格（局外人的音符）</a></li>
<li><a href="../zh-CN474038/index.html">定期数据更新</a></li>
<li><a href="../zh-CN474040/index.html">花花公子访谈：史蒂夫·乔布斯，第1部分</a></li>
<li><a href="../zh-CN474042/index.html">比赛！ 关于服务器闪烁的故事...</a></li>
<li><a href="../zh-CN474046/index.html">关于云服务，人工智能，区块链，数据科学，微服务的研讨会：现在在莫斯科和圣彼得堡</a></li>
<li><a href="../zh-CN474048/index.html">HILDACRYPT：新的勒索软件袭击了备份系统和防病毒解决方案</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>