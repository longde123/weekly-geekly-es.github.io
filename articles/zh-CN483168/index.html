<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏻‍🎨 👎🏿 ✂️ 如何制作将照片变成漫画的机器人。 第二部分 模型训练 👨🏿‍⚖️ ⛽️ 🤥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="⇨第一部分 
 ⇨第三部分 

 你好！ 

 如您所见，假期在一定程度上削弱了文章的时间表。 
 我认为，在这段时间里，许多人设法，即使没有完全训练他们的模型，也至少尝试了不同的数据集。 
 1.放分配 
 2.下载图片 
 3。??? 
 4.利润！ 
 如果您不熟悉我们的神经网络，或者您开始​...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>如何制作将照片变成漫画的机器人。 第二部分 模型训练</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483168/">  <a href="https://habr.com/ru/post/479218/">⇨第一部分</a> <br>  <a href="https://habr.com/ru/post/485824/">⇨第三部分</a> <br><br> 你好！ <br><br> 如您所见，假期在一定程度上削弱了文章的时间表。 <br> 我认为，在这段时间里，许多人设法，即使没有完全训练他们的模型，也至少尝试了不同的数据集。 <br><blockquote>  1.放分配 <br>  2.下载图片 <br>  3。??? <br>  4.利润！ <br></blockquote> 如果您不熟悉我们的神经网络，或者您开始​​阅读本文，那么正如他们所说，没有时间进行解释，我们将提供分发工具包，下载必要的图片，然后开始吧！ <br><a name="habracut"></a><br> 详细说明<a href="https://habr.com/ru/post/479218/">在该系列的上一篇文章中</a> 。 <br><br><h2> 第一块煎饼块状 </h2><br> 当我第一次为<a href="https://t.me/photo2comicsbot" rel="nofollow">@ photo2comicsbot</a>训练模型时， <a href="https://t.me/photo2comicsbot" rel="nofollow">事不宜迟</a> ，我只是将约1000页的漫画填充到数据集中。 <br> 是的，还有封面，公告和其他填充物。 <br><br> 在入口处看起来像这样： <br><br><img src="https://habrastorage.org/webt/vs/7t/p8/vs7tp8lqmuevcrv_3cpuzbyaef4.png"><br><br> 结果是对应的： <br><br><img src="https://habrastorage.org/webt/2s/sf/5s/2ssf5st8mk1oge_9rrfbyepmlhk.png"><br><br><img src="https://habrastorage.org/webt/7x/dl/kp/7xdlkpn70yzd8qfljqusgn6jy5y.png"><br><br><img src="https://habrastorage.org/webt/ll/ll/v8/llllv8gmtfys_udt5euohplcjzw.png"><br><br><div class="spoiler">  <b class="spoiler_title">更多图片</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/tl/ey/8e/tley8enuh1qlcjt3nc7e9-wnzse.png"><br><br><img src="https://habrastorage.org/webt/2u/cz/5n/2ucz5nwpenvhonfh84m080tj_t0.png"><br><br><img src="https://habrastorage.org/webt/o7/qb/xt/o7qbxtxqcrgdcih_4m-ysiksd_e.png"><br><br><img src="https://habrastorage.org/webt/xc/-8/yl/xc-8ylyfuk71me4v59xxvn3qhj4.png"><br><br><img src="https://habrastorage.org/webt/ys/zx/vm/yszxvm-2hc8xt6rjsvvxcpuyy3w.png"><br><br><img src="https://habrastorage.org/webt/jl/p9/3t/jlp93trm26hwitdzgmdt_kylhfw.png"><br><br><img src="https://habrastorage.org/webt/3l/fb/y6/3lfby6xuenl47xlggsv9n2p9hss.png"><br><br><img src="https://habrastorage.org/webt/bq/mt/sd/bqmtsdr7xedmcxsogpa4j8olk8c.png"><br><br></div></div><br> 该模型完美传达了漫画和照片之间的一般差异： <br><br><ul><li> 典型的颜色分级 </li><li> 轮廓选择 </li><li> 封锁 </li><li> 文字云 </li></ul><br> 原则上，此选项可能足以满足生产需求。 <br><br> 但是我想知道在更“干净”的数据集上可以获得什么结果。 <br><br><h2> 拿两个 </h2><br> 在下一个实验中，我在页面上留了一个区块，然后从其余的页面中切出了最大的片段（包括一个区块），以消除最终模型中的垂直和水平分隔线。 <br><blockquote> 如果您对数据集进行更改（例如，删除或添加照片），请不要忘记保存以前的版本。 如果出现问题，您将有一个归还的地方。 </blockquote> 第二个数据集如下所示： <br><br><img src="https://habrastorage.org/webt/ww/j9/8f/wwj98fxmy0d15c0xgxfz8w9bfs4.png"><br><br> 正如他们所说，结果是显而易见的： <br><br><img src="https://habrastorage.org/webt/zn/b3/sc/znb3sczf0ypubx8jya-uryrqbxm.png"><br><br><img src="https://habrastorage.org/webt/xp/n9/zv/xpn9zvimruobxodr4wa2vhrutxk.png"><br><br><img src="https://habrastorage.org/webt/xh/nf/sp/xhnfspsgqrkxvuvhdkj7vaqz5yy.png"><br><br><div class="spoiler">  <b class="spoiler_title">更多图片</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ag/6b/pw/ag6bpwlw1xefb9o8igrdixarhqc.png"><br><br><img src="https://habrastorage.org/webt/h7/xb/di/h7xbdiuyzdmukmjalf3o6rdou8e.png"><br><br><img src="https://habrastorage.org/webt/by/j8/zk/byj8zkaujwhx52po8xqw37un2oo.png"><br><br><img src="https://habrastorage.org/webt/pl/po/0y/plpo0yucjtvt0sbfc-pefnxz940.png"><br><br><img src="https://habrastorage.org/webt/65/4f/el/654fellkdx6_ebimev8ardha_e0.png"><br><br><img src="https://habrastorage.org/webt/zj/9u/vq/zj9uvqeres9m1kr2nmzcpgt-8uc.png"><br></div></div><br> 分隔线消失了，但随着它们的出现，文本的表达力消失了：它们在数据集中的相遇次数开始减少，不再是主要特征。 <br><br> 以前充满文本的空白区域现在充满了迷幻的噪音。 <br><br><h2> 第三次是魅力 </h2><br> 我决定完全摆脱文本，只保留漫画中那些没有的部分。 没有人幸存：没有乌云，没有标题或系列名称。 <br><br>  “语言种族灭绝”之后的数据集： <br><br><img src="https://habrastorage.org/webt/zu/pw/az/zupwaz8q1toeo9qvqncmfamino8.png"><br><br> 最终结果： <br><br><img src="https://habrastorage.org/webt/9s/o2/qg/9so2qgo6e6jpkdazfsqf2wlu1-w.png"><br><br><img src="https://habrastorage.org/webt/gs/nr/7p/gsnr7pfyfu4bcowe0bpyqlqn1vc.png"><br><br><img src="https://habrastorage.org/webt/me/vs/m6/mevsm6y3hlgvrvsa8qce0xhenqa.png"><br><br><div class="spoiler">  <b class="spoiler_title">更多图片</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/uv/hn/ua/uvhnuapobrpzdu8fxhyjqnz-ozg.png"><br><br><img src="https://habrastorage.org/webt/w1/gu/2e/w1gu2enojimz-lrpkzrzlkvihv8.png"><br><br><img src="https://habrastorage.org/webt/_e/j0/91/_ej091msilwm4hhlmbl3j7nw6sq.png"><br><br><img src="https://habrastorage.org/webt/ql/o6/th/qlo6thuiesfbqx_f2yx6yanf4ne.png"><br><br><img src="https://habrastorage.org/webt/cm/xg/4t/cmxg4tu9jp4-6dcjvjp2nwei3gq.png"><br></div></div><br> 一方面，文物较少，另一方面，表现力消失了。 由于在GAN训练中，结果的质量在很大程度上取决于您和我，因此，没有一个好的模型可供选择。 <br><br> 美丽是旁观者的眼睛，因此不要害怕尝试并选择自己最喜欢的东西。 <br><br><h2> 给武器！ </h2><br> 好了，我们已经讨论了主要的陷阱以及处理这些陷阱的方法，现在该开始做生意了。 <br><br> 转到我们下载发行版的文件夹。 让我提醒您，它被称为<b>pytorch-CycleGAN-and-pix2pix</b> <br><br> 由于我们提供了有关虚拟变量的说明，因此我们不会涉及分发代码，因为所有必需的参数都可以在命令行中进行设置。 <br><br> 在这种分布中，默认训练发生了200多个时代，在第100个纪元后，学习速率呈线性衰减。 <br><blockquote> 我的8 GB卡能够控制的最大分辨率为400x400。 经过全面的培训，我花了大约33个小时，因此我们将使用一些小技巧。 首先，我们将以128x128的图片训练模型，然后以256x256的图片训练模型，只有在最后阶段，我们才能向她展示我们华丽的400x400。 <br> 第一阶段将持续100个时代，第二和第三阶段分别为50个时代，这将使我们将培训时间减少近一半。 <br><br> 如实践所示，与立即以最大分辨率进行训练相比，这种方法的结果并不差，有时甚至更好。 </blockquote> 也许有足够的理论，是时候继续实践了。 <br><br> 在命令提示符下，输入。 <br><br><h3> 第一阶段 </h3><br><pre><code class="bash hljs">python train.py --dataroot {dataset root folder} --name {model name} --model cycle_gan --crop_size 128 --load_size 180 --init_type kaiming --netG resnet_9blocks --no_dropout --batch_size 4</code> </pre> <br>  <i>不要忘了用您自己的值替换花括号。</i> <i><br></i> <br> 我们将更详细地分析一些参数： <br><br><pre> <code class="bash hljs">--batch_size {number}</code> </pre> <br> 此参数负责每个周期处理的图像数量，对速度有积极影响，对模型的贪食性有不利影响。 <br><br> 在每个阶段，选择最大可能的--batch_size，它不会由于缺少GPU内存而导致错误。 <br><br><pre> <code class="bash hljs">-- dataroot {dataset root folder}</code> </pre> <br>  -包含我们数据集的文件夹。 如上一篇文章中所述，其中应该是文件夹trainA，trainB，testA，testB。 <br><br><pre> <code class="bash hljs">--name {model name}</code> </pre> <br>  -您的项目名称。 它可以是任意的，但我建议在名称中包括模型架构，最大分辨率和数据集的名称。 <br> 例如：“ resnet9_128to400_comics8” <br> 因此，您可以区分具有各种参数和数据的实验。 <br><br> 训练的第一阶段可以在第100个时代停止。 <br><br> 您可以从浏览器中观察进度： <a href="http://localhost/" rel="nofollow">localhost</a> ：8097 / <br>  （或另一个在控制台中可见的链接） <br><br><h3> 第二阶段 </h3><br><pre> <code class="bash hljs">python train.py --dataroot {dataset root folder} --name {model name} --model cycle_gan --crop_size 256 --load_size 290 --init_type kaiming --netG resnet_9blocks --no_dropout --batch_size 2 --epoch 100 --epoch_count 0 --continue_train</code> </pre> <br> 重要的是要指出我们在第一阶段完成研究的时代。 <br>  “ --Epoch 100”表示我们将从第100个时代的检查点加载模型 <br>  “ --Epoch_count 0”表示我们将以最大的学习速度从头开始训练。 <br><br> 训练的第二阶段可以在50年代停止。 <br><br><h3> 第三阶段 </h3><br><pre> <code class="bash hljs">python train.py --dataroot {dataset root folder} --name {model name} --model cycle_gan --crop_size 400 --load_size 430 --init_type kaiming --netG resnet_9blocks --no_dropout --batch_size 1 --epoch 50 --epoch_count 0 --continue_train</code> </pre> <br><br> 训练的第三阶段可以在50年代停止，但这只是一个问题。 您可以完成最后的操作，然后选择所需的中间结果。 重要的是要记住，第200个时代的结果可能要比第150个时代差。 <br><br><h2> 现在出去看看你做了什么 </h2><br> 在训练期间，模型和中间结果将保存在一个文件夹中 <br>  / pytorch-CycleGAN-and-pix2pix /检查点/ {型号名称} <br><br> 要测试模型，只需输入命令行： <br><br><pre> <code class="bash hljs">python test.py --dataroot {dataset root folder} --name {model name} --model cycle_gan --netG resnet_9blocks --crop_size 512 --load_size 580 --epoch {epoch name}</code> </pre> <br> 您可以在任何检查点的测试数据集上看到结果，只需将其指定为{epoch name}。 如果未指定{epoch name}，将采用最后一个检查点。 <br><br> 结果将保存在文件夹中： <br> <code>/pytorch-CycleGAN-and-pix2pix/results/{model name}/test_{epoch name}</code> <br> <blockquote> 为了不混淆哪个数据集上的哪个模型给出了什么结果， <br> 开始写一本小日记。 记录基线数据和学习成果。 <br><br> 例如，命令行和您到达的时代。 此数据足以保存训练参数和我们训练所依据的数据集。 <br><br> 毕竟，科学实验和鬼混之间有什么区别？ 事实已记录在案！ </blockquote> 今天就这些！ 在下一篇文章中，我们将学习如何导出完成的模型并将其托管在云中。 <br><br> 不要害怕尝试。 请务必尝试几个不同的数据集，比较结果并在评论中分享！ <br><br> 待会见！ <br><br>  <a href="https://habr.com/ru/post/485824/">⇨下一部分</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN483168/">https://habr.com/ru/post/zh-CN483168/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN483148/index.html">我们与咨询公司的创始人讨论数字孪生和模拟</a></li>
<li><a href="../zh-CN483154/index.html">我花了4万美元，毁了一个初创公司的好主意</a></li>
<li><a href="../zh-CN483156/index.html">把猫放在脚上</a></li>
<li><a href="../zh-CN483160/index.html">2020年太空：火星，卫星星座和新火箭</a></li>
<li><a href="../zh-CN483166/index.html">自动检测文本编码</a></li>
<li><a href="../zh-CN483170/index.html">Messenger数据库（第2部分）：我们对“利润”进行划分</a></li>
<li><a href="../zh-CN483172/index.html">如何本地化应用或游戏？ 十大免费电子学习资源</a></li>
<li><a href="../zh-CN483174/index.html">使用Multipeer Connectivity在设备之间录制和传输声音</a></li>
<li><a href="../zh-CN483176/index.html">Messenger数据库（第1部分）：我们设计基础框架</a></li>
<li><a href="../zh-CN483178/index.html">这是Flutter 1.9发行版与Dart 2.5编程结合的更新</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>