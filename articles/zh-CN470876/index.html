<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤³ğŸ¾ ğŸ± ğŸš¿ ä½¿ç”¨Babelåˆ›å»ºè‡ªå®šä¹‰JavaScriptè¯­æ³•ç»“æ„ã€‚ ç¬¬ä¸€éƒ¨åˆ† ğŸ‘¨ğŸ¼â€ğŸ“ ğŸ‘©ğŸ»â€ğŸš€ ğŸ¥©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä»Šå¤©ï¼Œæˆ‘ä»¬å‘å¸ƒäº†ææ–™ç¿»è¯‘çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œè¯¥éƒ¨åˆ†è‡´åŠ›äºä½¿ç”¨Babelä¸ºJavaScriptåˆ›å»ºè‡ªå·±çš„è¯­æ³•æ„é€ ã€‚ 

  

 å¤ä¹  
 é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€çœ‹æœ¬ææ–™çš„ç»“å°¾å°†å®ç°çš„ç›®æ ‡ï¼š 



// '@@' `foo` function @@ foo(a, b, c) { return a + b + c;...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨Babelåˆ›å»ºè‡ªå®šä¹‰JavaScriptè¯­æ³•ç»“æ„ã€‚ ç¬¬ä¸€éƒ¨åˆ†</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/470876/"> ä»Šå¤©ï¼Œæˆ‘ä»¬å‘å¸ƒäº†ææ–™ç¿»è¯‘çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œè¯¥éƒ¨åˆ†è‡´åŠ›äºä½¿ç”¨Babelä¸ºJavaScriptåˆ›å»ºè‡ªå·±çš„è¯­æ³•æ„é€ ã€‚ <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/af/mm/2j/afmm2jwbgwm7bzi3nwdf3namowg.jpeg"></a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">å¤ä¹ </font> </h2><br> é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€çœ‹æœ¬ææ–™çš„ç»“å°¾å°†å®ç°çš„ç›®æ ‡ï¼š <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  '@@'   `foo`   function @@ foo(a, b, c) {   return a + b + c; } console.log(foo(1, 2)(3)); // 6</span></span></code> </pre> <br> æˆ‘ä»¬å°†å®ç°<code>@@</code>è¯­æ³•ï¼Œè¯¥è¯­æ³•å…è®¸<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">currying</a>å‡½æ•°ã€‚ è¯¥è¯­æ³•ç±»ä¼¼äºç”¨äºåˆ›å»º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç”Ÿæˆå™¨å‡½æ•°çš„</a>è¯­æ³•ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œåœ¨<code>function</code>å…³é”®å­—å’Œ<code>function</code>åç§°ä¹‹é—´æ”¾ç½®äº†ä¸€ç³»åˆ—<code>@@</code>å­—ç¬¦ï¼Œè€Œä¸æ˜¯<code>*</code>ç¬¦å·ã€‚ ç»“æœï¼Œåœ¨å£°æ˜å‡½æ•°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å½¢å¼<code>function @@ name(arg1, arg2)</code>çš„æ„é€ ã€‚ <br><br> åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨<code>foo</code>å‡½æ•°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å…¶<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">éƒ¨åˆ†åº”ç”¨ç¨‹åº</a> ã€‚ é€šè¿‡å‘å‡½æ•°<code>foo</code>ä¼ é€’å¤ªå¤šçš„å‚æ•°ï¼ˆå°äºæ‰€éœ€æ•°é‡çš„å‚æ•°ï¼‰æ¥è°ƒç”¨å‡½æ•°<code>foo</code> ï¼Œå°†è¿”å›ä¸€ä¸ªå¯ä»¥æ¥æ”¶å…¶ä½™å‚æ•°çš„æ–°å‡½æ•°ï¼š <br><br><pre> <code class="javascript hljs">foo(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-comment"><span class="hljs-comment">// 6 const bar = foo(1, 2); // (n) =&gt; 1 + 2 + n bar(3); // 6</span></span></code> </pre> <br> æˆ‘é€‰æ‹©<code>@@</code>å­—ç¬¦çš„é¡ºåºï¼Œå› ä¸º<code>@</code>ç¬¦å·ä¸èƒ½åœ¨å˜é‡åä¸­ä½¿ç”¨ã€‚ è¿™æ„å‘³ç€å½¢å¼<code>function@@foo(){}</code>çš„æ„é€ åœ¨è¯­æ³•ä¸Šä¹Ÿæ˜¯æ­£ç¡®çš„ã€‚ å¦å¤–ï¼Œâ€œ operatorâ€ <code>@</code>ç”¨äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è£…é¥°å™¨åŠŸèƒ½</a> ï¼Œæˆ‘æƒ³ä½¿ç”¨å…¨æ–°çš„åŠŸèƒ½ã€‚ ç»“æœï¼Œæˆ‘é€‰æ‹©äº†<code>@@</code>ç»“æ„ã€‚ <br><br> ä¸ºäº†å®ç°æˆ‘ä»¬çš„ç›®æ ‡ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š <br><br><ul><li> åˆ›å»ºBabelè§£æå™¨çš„forkã€‚ </li><li> åˆ›å»ºè‡ªå·±çš„Babelæ’ä»¶è¿›è¡Œä»£ç è½¬æ¢ã€‚ </li></ul><br> çœ‹èµ·æ¥åƒä¸å¯èƒ½çš„äº‹æƒ…ï¼Ÿ <br> å®é™…ä¸Šï¼Œè¿™é‡Œæ²¡æœ‰ä»€ä¹ˆå¯æ€•çš„ï¼Œæˆ‘ä»¬å°†ä¸€èµ·è¯¦ç»†åˆ†ææ‰€æœ‰å†…å®¹ã€‚ æˆ‘å¸Œæœ›å½“æ‚¨é˜…è¯»æœ¬æ–‡æ—¶ï¼Œæ‚¨å°†ç²¾é€šBabelçš„å¤æ‚æ€§ã€‚ <br><br><h2>  <font color="#3AC1EF">åˆ›å»ºä¸€ä¸ªå‰å­Babel</font> </h2><br> è½¬åˆ°GitHubä¸Š<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çš„</a> Babel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å­˜å‚¨åº“</a> ï¼Œç„¶åå•å‡»é¡µé¢å·¦ä¸Šæ–¹çš„<code>Fork</code>æŒ‰é’®ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/adb/5d3/eff/adb5d3effaecdfaead72747dd75f6991.png"></div><br>  <i><font color="#999999">åˆ›å»ºBabelçš„å‰å­ï¼ˆ <a href="">å…¨å›¾</a> ï¼‰</font></i> <br><br> é¡ºä¾¿è¯´ä¸€å¥ï¼Œå¦‚æœæ‚¨æ˜¯ç¬¬ä¸€æ¬¡åˆ›å»ºæµè¡Œçš„å¼€æºé¡¹ç›®çš„åˆ†æ”¯-æ­å–œï¼ <br><br> ç°åœ¨ï¼Œåœ¨è®¡ç®—æœºä¸Šå…‹éš†Babelå‰å‰å¹¶<a href="">å‡†å¤‡å·¥ä½œ</a> ã€‚ <br><br><pre> <code class="javascript hljs">$ git clone https:<span class="hljs-comment"><span class="hljs-comment">//github.com/tanhauhau/babel.git # set up $ cd babel $ make bootstrap $ make build</span></span></code> </pre> <br> ç°åœ¨ï¼Œè®©æˆ‘ç®€è¦åœ°è°ˆè°ˆBabelå­˜å‚¨åº“çš„ç»„ç»‡ã€‚ <br><br>  Babelä½¿ç”¨å•ä¸€å­˜å‚¨åº“ã€‚ æ‰€æœ‰è½¯ä»¶åŒ…ï¼ˆä¾‹å¦‚<code>@babel/core</code> ï¼Œ <code>@babel/parser</code> ï¼Œ <code>@babel/plugin-transform-react-jsx</code>ç­‰ï¼‰éƒ½ä½äº<code>packages/</code>æ–‡ä»¶å¤¹ä¸­ã€‚ çœ‹èµ·æ¥åƒè¿™æ ·ï¼š <br><br><pre> <code class="javascript hljs">- doc - packages  - babel-core  - babel-parser  - babel-plugin-transform-react-jsx  - ... - Gulpfile.js - Makefile - ...</code> </pre> <br> æˆ‘æ³¨æ„åˆ°Babelä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Makefile</a>æ¥è‡ªåŠ¨æ‰§è¡Œä»»åŠ¡ã€‚ å½“é€šè¿‡<code>make build</code>é¡¹ç›®æ—¶ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Gulp</a>ç”¨ä½œä»»åŠ¡ç®¡ç†å™¨ã€‚ <br><br><h2>  <font color="#3AC1EF">ä»£ç è½¬æ¢ä¸ºASTçŸ­æœŸè¯¾ç¨‹</font> </h2><br> å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰è¯¸å¦‚â€œè§£æå™¨â€å’Œâ€œæŠ½è±¡è¯­æ³•æ ‘â€ï¼ˆASTï¼‰ä¹‹ç±»çš„æ¦‚å¿µï¼Œé‚£ä¹ˆåœ¨ç»§ç»­é˜…è¯»ä¹‹å‰ï¼Œæˆ‘å¼ºçƒˆå»ºè®®æ‚¨å…ˆé˜…è¯»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ¬</a>ææ–™ã€‚ <br><br> å¦‚æœæ‚¨éå¸¸ç®€çŸ­åœ°è®¨è®ºè§£æï¼ˆè§£æï¼‰ä»£ç æ—¶å‘ç”Ÿçš„æƒ…å†µï¼Œåˆ™ä¼šå¾—åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š <br><br><ul><li> å‘ˆç°ä¸ºå­—ç¬¦ä¸²ï¼ˆç±»å‹<code>string</code> ï¼‰çš„ä»£ç çœ‹èµ·æ¥åƒä¸€é•¿ä¸²å­—ç¬¦ï¼š <code>f, u, n, c, t, i, o, n, , @, @, f, ...</code> </li><li> ä»ä¸€å¼€å§‹ï¼ŒBabelå°±æ‰§è¡Œä»£ç æ ‡è®°åŒ–ã€‚ åœ¨æ­¤æ­¥éª¤ä¸­ï¼ŒBabelæ‰«æä»£ç å¹¶åˆ›å»ºä»¤ç‰Œã€‚ ä¾‹å¦‚ï¼Œç±»ä¼¼<code>function, @@, foo, (, a, ...</code> </li><li> ç„¶åï¼Œä»¤ç‰Œå°†é€šè¿‡è§£æå™¨è¿›è¡Œè§£æã€‚ åœ¨è¿™é‡Œï¼ŒBabelåŸºäºJavaScriptè¯­è¨€çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è§„èŒƒ</a> ï¼Œåˆ›å»ºäº†ä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ã€‚ </li></ul><br> å¯¹äºé‚£äº›æƒ³äº†è§£æ›´å¤šæœ‰å…³ç¼–è¯‘å™¨çš„äººæ¥è¯´ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™æ˜¯ä¸€ä¸ª</a>å¾ˆå¥½çš„èµ„æºã€‚ <br><br> å¦‚æœæ‚¨è®¤ä¸ºâ€œç¼–è¯‘å™¨â€æ˜¯éå¸¸å¤æ‚ä¸”éš¾ä»¥ç†è§£çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆè¯·çŸ¥é“å®é™…ä¸Šå¹¶ä¸æ˜¯æ‰€æœ‰äº‹ç‰©éƒ½é‚£ä¹ˆç¥ç§˜ã€‚ ç¼–è¯‘åªæ˜¯è§£æä»£ç å¹¶åœ¨å…¶åŸºç¡€ä¸Šåˆ›å»ºæ–°ä»£ç ï¼Œæˆ‘ä»¬å°†å…¶ç§°ä¸ºXXXã€‚  XXXä»£ç å¯ä»¥ç”¨æœºå™¨ä»£ç è¡¨ç¤ºï¼ˆä¹Ÿè®¸ï¼Œå½“æˆ‘ä»¬è€ƒè™‘ç¼–è¯‘å™¨æ—¶ï¼Œæœºå™¨ä»£ç æ˜¯æˆ‘ä»¬å¤§å¤šæ•°äººé¦–å…ˆæƒ³åˆ°çš„ï¼‰ã€‚ è¿™å¯èƒ½æ˜¯ä¸æ—§ç‰ˆæµè§ˆå™¨å…¼å®¹çš„JavaScriptä»£ç ã€‚ å®é™…ä¸Šï¼ŒBabelçš„ä¸»è¦åŠŸèƒ½ä¹‹ä¸€å°±æ˜¯å°†ç°ä»£JSä»£ç ç¼–è¯‘ä¸ºè¿‡æ—¶çš„æµè§ˆå™¨å¯ä»¥ç†è§£çš„ä»£ç ã€‚ <br><br><h2>  <font color="#3AC1EF">ä¸ºBabelå¼€å‘è‡ªå·±çš„è§£æå™¨</font> </h2><br> æˆ‘ä»¬å°†åœ¨<code>packages/babel-parser/</code>æ–‡ä»¶å¤¹ä¸­å·¥ä½œï¼š <br><br><pre> <code class="javascript hljs">- src/  - tokenizer/  - parser/  - plugins/    - jsx/    - typescript/    - flow/    - ... - test/</code> </pre> <br> æˆ‘ä»¬å·²ç»è®¨è®ºäº†ä»¤ç‰ŒåŒ–å’Œè§£æã€‚ æ‚¨å¯ä»¥åœ¨å…·æœ‰ç›¸åº”åç§°çš„æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°å®ç°è¿™äº›è¿‡ç¨‹çš„ä»£ç ã€‚  <code>plugins/</code>æ–‡ä»¶å¤¹åŒ…å«ç”¨äºæ‰©å±•åŸºæœ¬è§£æå™¨åŠŸèƒ½å¹¶å‘ç³»ç»Ÿæ·»åŠ å¯¹å…¶ä»–è¯­æ³•çš„æ”¯æŒçš„æ’ä»¶ï¼ˆæ’ä»¶ï¼‰ã€‚ ä¾‹å¦‚ï¼Œè¿™æ­£æ˜¯å®ç°<code>jsx</code>å’Œ<code>flow</code>æ”¯æŒçš„æ–¹å¼ã€‚ <br><br> è®©æˆ‘ä»¬ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¼€å‘</a>æŠ€æœ¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é€šè¿‡æµ‹è¯•</a> ï¼ˆæµ‹è¯•é©±åŠ¨çš„å¼€å‘ï¼ŒTDDï¼‰è§£å†³é—®é¢˜ã€‚ æˆ‘è®¤ä¸ºï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯å…ˆç¼–å†™ä¸€ä¸ªæµ‹è¯•ï¼Œç„¶åé€æ­¥åœ¨ç³»ç»Ÿä¸Šå·¥ä½œï¼Œä½¿è¯¥æµ‹è¯•è¿è¡Œæ— é”™è¯¯ã€‚ åœ¨ä¸ç†Ÿæ‚‰çš„ä»£ç åº“ä¸­å·¥ä½œæ—¶ï¼Œæ­¤æ–¹æ³•ç‰¹åˆ«å¥½ã€‚  TDDä½¿æ‚¨æ˜“äºç†è§£åœ¨ä½•å¤„éœ€è¦æ›´æ”¹ä»£ç ä»¥å®ç°é¢„æœŸçš„åŠŸèƒ½ã€‚ <br><br><pre> <code class="javascript hljs">packages/babel-parser/test/curry-<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">import</span></span></span><span class="hljs-function"> </span></span>{ parse } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../lib'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getParser</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">code</span></span></span><span class="hljs-function">) </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> parse(code, { <span class="hljs-attr"><span class="hljs-attr">sourceType</span></span>: <span class="hljs-string"><span class="hljs-string">'module'</span></span> }); } describe(<span class="hljs-string"><span class="hljs-string">'curry function syntax'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{  it(<span class="hljs-string"><span class="hljs-string">'should parse'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    expect(getParser(<span class="hljs-string"><span class="hljs-string">`function @@ foo() {}`</span></span>)()).toMatchSnapshot();  }); });</code> </pre> <br> æ‚¨å¯ä»¥åƒè¿™æ ·å¯¹<code>babel-parser</code>è¿è¡Œæµ‹è¯•ï¼š <code>TEST_ONLY=babel-parser TEST_GREP="curry function" make test-only</code> ã€‚ è¿™å°†ä½¿æ‚¨çœ‹åˆ°é”™è¯¯ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">SyntaxError</span></span>: Unexpected token (<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">9</span></span>) at Parser.raise (packages/babel-parser/src/parser/location.js:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">63</span></span>) at Parser.raise [<span class="hljs-keyword"><span class="hljs-keyword">as</span></span> unexpected] (packages/babel-parser/src/parser/util.js:<span class="hljs-number"><span class="hljs-number">133</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span>) at Parser.unexpected [<span class="hljs-keyword"><span class="hljs-keyword">as</span></span> parseIdentifierName] (packages/babel-parser/src/parser/expression.js:<span class="hljs-number"><span class="hljs-number">2090</span></span>:<span class="hljs-number"><span class="hljs-number">18</span></span>) at Parser.parseIdentifierName [<span class="hljs-keyword"><span class="hljs-keyword">as</span></span> parseIdentifier] (packages/babel-parser/src/parser/expression.js:<span class="hljs-number"><span class="hljs-number">2052</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span>) at Parser.parseIdentifier (packages/babel-parser/src/parser/statement.js:<span class="hljs-number"><span class="hljs-number">1096</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span>)</code> </pre> <br> å¦‚æœå‘ç°æŸ¥çœ‹æ‰€æœ‰æµ‹è¯•èŠ±è´¹å¤ªå¤šæ—¶é—´ï¼Œåˆ™å¯ä»¥è¿è¡Œ<code>jest</code>ç›´æ¥è¿è¡Œ<code>jest</code> ï¼š <br><br><pre> <code class="javascript hljs">BABEL_ENV=test node_modules/.bin/jest -u packages/babel-parser/test/curry-<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span></span></code> </pre> <br> æˆ‘ä»¬çš„è§£æå™¨å‘ç°äº†2ä¸ª<code>@</code>ä»¤ç‰Œï¼Œè¿™äº›ä»¤ç‰Œä¼¼ä¹å®Œå…¨æ˜¯æ— è¾œçš„ï¼Œå®ƒä»¬ä¸åº”è¯¥åœ¨å“ªé‡Œã€‚ <br><br> æˆ‘æ€ä¹ˆçŸ¥é“çš„ è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå°†å¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°ä½¿ç”¨<code>make watch</code>å¯åŠ¨çš„ä»£ç ç›‘è§†æ¨¡å¼çš„æ–¹æ³•ã€‚ <br><br> æŸ¥çœ‹è°ƒç”¨å †æ ˆä¼šå¯¼è‡´æˆ‘ä»¬è¿›å…¥<a href="">åŒ…/ babel-parser / src / parser / expression.js</a> ï¼Œå…¶ä¸­æŠ›å‡º<code>this.unexpected()</code>å¼‚å¸¸ã€‚ <br><br> å‘è¯¥æ–‡ä»¶æ·»åŠ å‡ ä¸ªæ—¥å¿—è®°å½•å‘½ä»¤ï¼š <br><br><pre> <code class="javascript hljs">packages/babel-parser/src/parser/expression.js parseIdentifierName(pos: number, liberal?: boolean): string {  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.match(tt.name)) {    <span class="hljs-comment"><span class="hljs-comment">// ...  } else {    console.log(this.state.type); //      console.log(this.lookahead().type); //      throw this.unexpected();  } }</span></span></code> </pre> <br> å¦‚æ‚¨æ‰€è§ï¼Œä¸¤ä¸ªæ ‡è®°éƒ½æ˜¯<code>@</code> ï¼š <br><br><pre> <code class="javascript hljs">TokenType {  <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'@'</span></span>,  <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br> æˆ‘å¦‚ä½•å‘ç°æ„é€ <code>this.state.type</code>å’Œ<code>this.lookahead().type</code>å°†ç»™æˆ‘å½“å‰æ ‡è®°å’Œä¸‹ä¸€ä¸ªæ ‡è®°ï¼Ÿ <br> æˆ‘å°†åœ¨æœ¬ææ–™çš„æœ‰å…³<code>this.eat</code> ï¼Œ <code>this.match</code>å’Œ<code>this.next</code>å‡½æ•°çš„éƒ¨åˆ†ä¸­è®¨è®ºè¿™<code>this.next</code> ã€‚ <br><br> åœ¨ç»§ç»­ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ï¼š <br><br><ul><li> æˆ‘ä»¬ä¸º<code>babel-parser</code>ç¼–å†™äº†ä¸€ä¸ªæµ‹è¯•ã€‚ </li><li> æˆ‘ä»¬ä½¿ç”¨<code>make test-only</code>è¿è¡Œæµ‹è¯•ã€‚ </li><li> æˆ‘ä»¬é€šè¿‡<code>make watch</code>ä½¿ç”¨äº†ä»£ç ç›‘è§†æ¨¡å¼ã€‚ </li><li> æˆ‘ä»¬äº†è§£äº†è§£æå™¨çš„çŠ¶æ€ï¼Œå¹¶åœ¨æ§åˆ¶å°ä¸­<code>this.state.type</code>æœ‰å…³å½“å‰ä»¤ç‰Œç±»å‹ï¼ˆ <code>this.state.type</code> ï¼‰çš„ä¿¡æ¯ã€‚ </li></ul><br> ç°åœ¨ï¼Œæˆ‘ä»¬å°†ç¡®ä¿ä¸ä¼šå°†2ä¸ª<code>@</code>å­—ç¬¦è§†ä¸ºå•ç‹¬çš„ä»¤ç‰Œï¼Œè€Œå°†å…¶ä½œä¸ºæ–°çš„<code>@@</code>ä»¤ç‰Œï¼Œæˆ‘ä»¬å†³å®šå°†å…¶ç”¨ä½œcurryingå‡½æ•°ã€‚ <br><br><h2>  <font color="#3AC1EF">æ–°ä»¤ç‰Œï¼šâ€œ @@â€</font> </h2><br> é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ç¡®å®šä»¤ç‰Œç±»å‹çš„ä½ç½®ã€‚ è¿™æ˜¯æ–‡ä»¶<a href="">åŒ…/ babel-parser / src / tokenizer / types.js</a> ã€‚ <br><br> åœ¨è¿™é‡Œæ‚¨å¯ä»¥æ‰¾åˆ°ä»¤ç‰Œåˆ—è¡¨ã€‚ åœ¨æ­¤å¤„æ·»åŠ æ–°<code>atat</code>ä»¤ç‰Œçš„å®šä¹‰ï¼š <br><br><pre> <code class="javascript hljs">packages/babel-parser/src/tokenizer/types.js <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> types: { [name: string]: TokenType } = {  <span class="hljs-comment"><span class="hljs-comment">// ...  at: new TokenType('@'),  atat: new TokenType('@@'), };</span></span></code> </pre> <br> ç°åœ¨è®©æˆ‘ä»¬åœ¨ä»£ç ä¸­å¯»æ‰¾åœ¨ä»¤ç‰ŒåŒ–è¿‡ç¨‹ä¸­åˆ›å»ºä»¤ç‰Œçš„ä½ç½®ã€‚ åœ¨<code>babel-parser/src/tokenizer</code>æ‰¾åˆ°<code>tt.at</code>å­—ç¬¦çš„åºåˆ—ï¼Œå°†æˆ‘ä»¬å¼•åˆ°æ–‡ä»¶ï¼š <a href="">packages / babel-parser / src / tokenizer / index.js</a> ã€‚ åœ¨<code>babel-parser</code>ä»¤ç‰Œç±»å‹ä½œä¸º<code>tt</code>å¯¼å…¥ã€‚ <br><br> ç°åœ¨ï¼Œå¦‚æœåœ¨å½“å‰<code>@</code>ç¬¦å·ä¹‹åå‡ºç°å¦ä¸€ä¸ª<code>@</code> ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°ä»¤ç‰Œ<code>tt.atat</code>è€Œä¸æ˜¯<code>tt.at</code>ä»¤ç‰Œï¼š <br><br><pre> <code class="javascript hljs">packages/babel-parser/src/tokenizer/index.js getTokenFromCode(code: number): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> {  <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (code) {    <span class="hljs-comment"><span class="hljs-comment">// ...    case charCodes.atSign:      //    -  `@`      if (this.input.charCodeAt(this.state.pos + 1) === charCodes.atSign) {        //  `tt.atat`  `tt.at`        this.finishOp(tt.atat, 2);      } else {        this.finishOp(tt.at, 1);      }      return;    // ...  } }</span></span></code> </pre> <br> å¦‚æœå†æ¬¡è¿è¡Œæµ‹è¯•ï¼Œæ‚¨å°†æ³¨æ„åˆ°æœ‰å…³å½“å‰ä»¤ç‰Œå’Œä¸‹ä¸€ä¸ªä»¤ç‰Œçš„ä¿¡æ¯å·²æ›´æ”¹ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   TokenType {  label: '@@',  // ... } //   TokenType {  label: 'name',  // ... }</span></span></code> </pre> <br> å®ƒçœ‹èµ·æ¥å·²ç»ä¸é”™äº†ã€‚ æˆ‘ä»¬å°†ç»§ç»­åŠªåŠ›ã€‚ <br><br><h2>  <font color="#3AC1EF">æ–°è§£æå™¨</font> </h2><br> åœ¨ç»§ç»­ä¹‹å‰ï¼Œè¯·çœ‹ä¸€ä¸‹ASTä¸­å‘ç”µæœºåŠŸèƒ½çš„è¡¨ç¤ºæ–¹å¼ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ea/cc0/a9f/3eacc0a9fe1c5f780013f7d1d3d1ebe3.png"></div><br>  <i><font color="#999999">ASTç”¨äºç”Ÿæˆå™¨åŠŸèƒ½ï¼ˆ <a href="">å…¨å°ºå¯¸å›¾ç‰‡</a> ï¼‰</font></i> <br><br> å¦‚æ‚¨æ‰€è§ï¼Œ <code>FunctionDeclaration</code>å®ä½“çš„<code>generator: true</code>å±æ€§è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªgenerator <code>FunctionDeclaration</code> ã€‚ <br><br> æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ç±»ä¼¼çš„æ–¹æ³•æ¥æè¿°æ”¯æŒcurryingçš„å‡½æ•°ã€‚ å³ï¼Œæˆ‘ä»¬å¯ä»¥å°†<code>curry: true</code>å±æ€§æ·»åŠ åˆ°<code>FunctionDeclaration</code> ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3a6/056/e68/3a6056e68a6cd80fc136c6e010444d0b.png"></div><br>  <i><font color="#999999">ASTçš„curryingåŠŸèƒ½ï¼ˆ <a href="">å…¨å°ºå¯¸å›¾ç‰‡</a> ï¼‰</font></i> <br><br> å®é™…ä¸Šï¼Œç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªè®¡åˆ’ã€‚ è®©æˆ‘ä»¬æ¥å¤„ç†å®ƒçš„å®ç°ã€‚ <br><br> å¦‚æœæ‚¨åœ¨ä»£ç ä¸­æŸ¥æ‰¾å•è¯<code>FunctionDeclaration</code> ï¼Œåˆ™å¯ä»¥è½¬åˆ°<code>parseFunction</code>å‡½æ•°ï¼Œè¯¥å‡½æ•°åœ¨<a href="">åŒ…/ babel-parser / src / parser / statement.jsä¸­å£°æ˜</a> ã€‚ åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°è®¾ç½®äº†<code>generator</code>å±æ€§çš„è¡Œã€‚ åœ¨ä»£ç ä¸­æ·»åŠ å¦ä¸€è¡Œï¼š <br><br><pre> <code class="javascript hljs">packages/babel-parser/src/parser/statement.js <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StatementParser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExpressionParser</span></span></span><span class="hljs-class"> </span></span>{  <span class="hljs-comment"><span class="hljs-comment">// ...  parseFunction&lt;T: N.NormalFunction&gt;(    node: T,    statement?: number = FUNC_NO_FLAGS,    isAsync?: boolean = false  ): T {    // ...    node.generator = this.eat(tt.star);    node.curry = this.eat(tt.atat);  } }</span></span></code> </pre> <br> å¦‚æœæˆ‘ä»¬å†æ¬¡è¿è¡Œæµ‹è¯•ï¼Œä¸€ä¸ªä»¤äººæƒŠå–œçš„æƒŠå–œå°†ç­‰å¾…ç€æˆ‘ä»¬ã€‚ è¯¥ä»£ç å·²æˆåŠŸæµ‹è¯•ï¼ <br><br><pre> <code class="javascript hljs">PASS packages/babel-parser/test/curry-<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">curry</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">syntax</span></span></span><span class="hljs-function">    âœ“ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">should</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">12</span></span></span></span><span class="hljs-function"><span class="hljs-params">ms</span></span></span><span class="hljs-function">)</span></span></code> </pre> <br> è¿™å°±æ˜¯å…¨éƒ¨å—ï¼Ÿ æˆ‘ä»¬åšäº†ä»€ä¹ˆæ‰èƒ½ä½¿æµ‹è¯•å¥‡è¿¹èˆ¬åœ°é€šè¿‡ï¼Ÿ <br><br> ä¸ºäº†æ‰¾å‡ºç­”æ¡ˆï¼Œè®©æˆ‘ä»¬è°ˆè°ˆè§£æçš„å·¥ä½œåŸç†ã€‚ åœ¨è¿™æ¬¡å¯¹è¯ä¸­ï¼Œå¸Œæœ›æ‚¨èƒ½ç†è§£<code>node.curry = this.eat(tt.atat);</code>  ã€‚ <br><br> å¾…ç»­... <br><br>  <b>äº²çˆ±çš„è¯»è€…ä»¬ï¼</b> ä½ ç”¨å·´åˆ«å¡”å—ï¼Ÿ <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/-o/2e/tu/-o2etuqogwhmdnmysb9_vivc9v4.png"></a> </div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN470876/">https://habr.com/ru/post/zh-CN470876/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN470864/index.html">å…³äºåˆ‡æ¢åˆ°é¢æ¿çš„ä¹è¶£ï¼Œè€Œä¸ä»…ä»…æ˜¯</a></li>
<li><a href="../zh-CN470868/index.html">ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ—¶é—´ï¼šè¿™æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆé‡è¦</a></li>
<li><a href="../zh-CN470870/index.html">é¢„åŠ è½½å­—ä½“</a></li>
<li><a href="../zh-CN470872/index.html">ç”¨äºç ”ç©¶éš¾ä»¥ç½®ä¿¡çš„å¿«é€ŸWebåº”ç”¨ç¨‹åºçš„æ€§èƒ½æŒ‡æ ‡</a></li>
<li><a href="../zh-CN470874/index.html">ä¼˜åŒ–Wikipediaä¸Šçš„JavaScriptåŠ è½½</a></li>
<li><a href="../zh-CN470878/index.html">ä½¿ç”¨Babelåˆ›å»ºè‡ªå®šä¹‰JavaScriptè¯­æ³•ç»“æ„ã€‚ ç¬¬äºŒéƒ¨åˆ†</a></li>
<li><a href="../zh-CN470880/index.html">æ¸¸æˆæœºåˆ¶ã€‚ å†’é™©ï¼Œé›¶å’Œå¼•äººæ³¨ç›®çš„è¨€è¯­æ²»ç–—æ¦‚å¿µ</a></li>
<li><a href="../zh-CN470882/index.html">æ‚¨ä¸ºä»€ä¹ˆè¦æŠ“ä½æˆ‘çš„é¼ æ ‡æˆ–å°†æ£‹ç›˜æ¸¸æˆä½œä¸ºç¤¾äº¤äº’åŠ¨çš„å…¸èŒƒ</a></li>
<li><a href="../zh-CN470884/index.html">åœ¨æ¯”ç‰¹å¸åŒºå—é“¾ä¸­å†™å…¥å’Œè¯»å–æ•°æ®</a></li>
<li><a href="../zh-CN470888/index.html">ä¸ªäººæ•°æ®ä¿æŠ¤é¢†åŸŸçš„ä¿„ç½—æ–¯å’Œå›½é™…æ³•è§„</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>