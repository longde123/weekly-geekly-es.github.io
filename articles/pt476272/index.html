<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>☠️ 👨🏼‍💼 👉🏻 Respostas às tarefas do estande PVS-Studio nas conferências 2018-2019 🤰🏽 🔭 👨‍👦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Oi Apesar de a temporada de conferências de 2019 ainda estar em pleno andamento, gostaríamos de discutir as tarefas que foram oferecidas aos visitante...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Respostas às tarefas do estande PVS-Studio nas conferências 2018-2019</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/476272/"><p><img src="https://habrastorage.org/getpro/habr/post_images/701/9e4/589/7019e458975e9931a108882b6fd126a8.png" alt="Quadro 2" align="left"></p><br>  Oi  Apesar de a temporada de conferências de 2019 ainda estar em pleno andamento, gostaríamos de discutir as tarefas que foram oferecidas aos visitantes de nosso estande anteriormente.  Iniciamos o outono de 2019 com um novo conjunto de tarefas, para que já seja possível publicar a solução de problemas antigos para 2018 e para o primeiro semestre de 2019. Além disso, muitos deles foram retirados de artigos publicados anteriormente, e os folhetos de tarefas continham um link ou um código QR com informações sobre o artigo. <br><a name="habracut"></a><br>  Se você participou de conferências em que ficamos de pé, provavelmente viu ou até resolveu alguns dos nossos problemas.  Esses sempre são trechos de código de projetos reais de código aberto nas linguagens de programação C, C ++, C # ou Java.  O código contém erros que sugerimos que os visitantes procurem.  Para a solução (ou apenas uma discussão sobre o erro), distribuímos prêmios - status na área de trabalho, bugigangas etc.: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d9/aff/240/2d9aff24000a4a61dd4eac65fef38083.jpg" alt="Quadro 4"></div><br>  Você quer o mesmo?  Venha ao nosso estande nas próximas conferências. <br><br>  A propósito, os artigos " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Horário da conferência! Resumindo os resultados de 2018</a> " e " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Conferências. Resultados intermediários do primeiro semestre de 2019</a> " contêm uma descrição de nossa atividade nas conferências deste e do ano passado. <br><br>  Então, vamos começar o jogo "Encontre um erro no código".  Primeiro, considere as tarefas mais antigas para 2018, usaremos o agrupamento por linguagens de programação. <br><br><h2>  2018 </h2><br><h3>  C ++ </h3><br>  <b>Bug de cromo</b> <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> kDaysInMonth[<span class="hljs-number"><span class="hljs-number">13</span></span>] = { <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span> }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ValidateDateTime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> DateTime&amp; time)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (time.year &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> || time.year &gt; <span class="hljs-number"><span class="hljs-number">9999</span></span> || time.month &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> || time.month &gt; <span class="hljs-number"><span class="hljs-number">12</span></span> || time.day &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> || time.day &gt; <span class="hljs-number"><span class="hljs-number">31</span></span> || time.hour &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || time.hour &gt; <span class="hljs-number"><span class="hljs-number">23</span></span> || time.minute &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || time.minute &gt; <span class="hljs-number"><span class="hljs-number">59</span></span> || time.second &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || time.second &gt; <span class="hljs-number"><span class="hljs-number">59</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (time.month == <span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; IsLeapYear(time.year)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> time.month &lt;= kDaysInMonth[time.month] + <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> time.month &lt;= kDaysInMonth[time.month]; } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">A resposta</b> <div class="spoiler_text">  Talvez a tarefa mais "de longa duração" do nosso set.  Sugerimos que esse erro no projeto Chromium seja encontrado pelos visitantes de nosso estande ao longo de 2018.  Também foi apresentado em vários relatórios. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (time.month == <span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; IsLeapYear(time.year)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> time.month &lt;= kDaysInMonth[time.month] + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= day } else { return time.month &lt;= kDaysInMonth[time.month]; // &lt;= day }</span></span></code> </pre> <br>  O corpo do último bloco <i>If-else</i> contém erros de digitação no valor de retorno.  Em vez de <i>time.day, o</i> programador especificou duas vezes, por engano, <i>time.month</i> .  Isso levou ao fato de que <i>true</i> sempre será retornado.  O erro é descrito em detalhes no artigo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">31 de fevereiro</a> ".  Um ótimo exemplo de um bug que não é fácil de detectar na revisão de código.  Também é uma boa ilustração do uso da tecnologia de análise de fluxo de dados. <br></div></div><br>  <b>Bug irreal do motor</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VertInfluencedByActiveBone</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( FParticleEmitterInstance* Owner, USkeletalMeshComponent* InSkelMeshComponent, int32 InVertexIndex, int32* OutBoneIndex = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">NULL</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> UParticleModuleLocationSkelVertSurface::Spawn(....) { .... int32 BoneIndex1, BoneIndex2, BoneIndex3; BoneIndex1 = BoneIndex2 = BoneIndex3 = INDEX_NONE; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!VertInfluencedByActiveBone( Owner, SourceComponent, VertIndex[<span class="hljs-number"><span class="hljs-number">0</span></span>], &amp;BoneIndex1) &amp;&amp; !VertInfluencedByActiveBone( Owner, SourceComponent, VertIndex[<span class="hljs-number"><span class="hljs-number">1</span></span>], &amp;BoneIndex2) &amp;&amp; !VertInfluencedByActiveBone( Owner, SourceComponent, VertIndex[<span class="hljs-number"><span class="hljs-number">2</span></span>]) &amp;BoneIndex3) { .... }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">A resposta</b> <div class="spoiler_text">  A primeira coisa a observar é que o último argumento da função <i>VertInfluencedByActiveBone ()</i> tem um valor padrão e pode não ser especificado.  Agora, dê uma olhada no bloco <i>if</i> .  Simplificado, pode ser reescrito da seguinte maneira: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!foo(....) &amp;&amp; !foo(....) &amp;&amp; !foo(....) &amp; arg)</code> </pre> <br>  Agora está claro que um erro foi cometido.  Devido a um erro de digitação, a terceira chamada à função <i>VertInfluencedByActiveBone ()</i> é feita com três argumentos em vez de quatro, e o operador <i>&amp;</i> é aplicado ao resultado dessa chamada (AND bit a bit, à esquerda é o resultado da função <i>VertInfluencedByActiveBone ()</i> do tipo <i>bool</i> , à direita é a variável inteira <i>BoneIndex3</i> ).  O código é compilado.  Versão corrigida do código (vírgula adicionada, o colchete de fechamento foi movido para outro local): <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!VertInfluencedByActiveBone( Owner, SourceComponent, VertIndex[<span class="hljs-number"><span class="hljs-number">0</span></span>], &amp;BoneIndex1) &amp;&amp; !VertInfluencedByActiveBone( Owner, SourceComponent, VertIndex[<span class="hljs-number"><span class="hljs-number">1</span></span>], &amp;BoneIndex2) &amp;&amp; !VertInfluencedByActiveBone( Owner, SourceComponent, VertIndex[<span class="hljs-number"><span class="hljs-number">2</span></span>], &amp;BoneIndex3))</code> </pre> <br>  O erro descrito originalmente no artigo "A <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tão esperada verificação do Unreal Engine 4</a> ".  O artigo é intitulado "O mais bonito dos erros encontrados" no artigo.  Eu concordo com esta afirmação. <br></div></div><br>  <b>Erros do Android</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> TagMonitor::parseTagsToMonitor(String8 tagNames) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::lock_guard&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::mutex&gt; lock(mMonitorMutex); <span class="hljs-comment"><span class="hljs-comment">// Expand shorthands if (ssize_t idx = tagNames.find("3a") != -1) { ssize_t end = tagNames.find(",", idx); char* start = tagNames.lockBuffer(tagNames.size()); start[idx] = '\0'; .... } .... }</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">A resposta</b> <div class="spoiler_text">  A condição if block confunde a prioridade das operações.  O código não funciona como o programador pretendia: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ssize_t</span></span> idx = (tagNames.find(<span class="hljs-string"><span class="hljs-string">"3a"</span></span>) != <span class="hljs-number"><span class="hljs-number">-1</span></span>))</code> </pre> <br>  A variável <i>idx</i> receberá os valores 0 ou 1, e o cumprimento da condição dependerá desse valor, que é um erro.  Versão corrigida do código: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">ssize_t</span></span> idx = tagNames.find(<span class="hljs-string"><span class="hljs-string">"3a"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (idx != <span class="hljs-number"><span class="hljs-number">-1</span></span>)</code> </pre> <br>  Erro do artigo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Verificamos os códigos-fonte do Android usando o PVS-Studio, ou ninguém é perfeito</a> ." <br></div></div><br>  E mais uma tarefa para encontrar um erro não trivial no Android: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> GGLfixed; <span class="hljs-function"><span class="hljs-function">GGLfixed </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gglFastDivx</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GGLfixed n, GGLfixed d)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((d&gt;&gt;<span class="hljs-number"><span class="hljs-number">24</span></span>) &amp;&amp; ((d&gt;&gt;<span class="hljs-number"><span class="hljs-number">24</span></span>)+<span class="hljs-number"><span class="hljs-number">1</span></span>)) { n &gt;&gt;= <span class="hljs-number"><span class="hljs-number">8</span></span>; d &gt;&gt;= <span class="hljs-number"><span class="hljs-number">8</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gglMulx(n, gglRecip(d)); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">A resposta</b> <div class="spoiler_text">  O problema está na expressão <i>(d &gt;&gt; 24) + 1</i> . <br><br>  O programador queria verificar se os 8 bits de ordem superior da variável <i>d</i> contêm unidades, mas não todos os bits de uma vez.  Em outras palavras, o programador queria verificar se qualquer valor diferente de 0x00 e 0xFF está no byte alto.  Primeiro, ele verificou se os bits mais significativos são diferentes de zero escrevendo uma expressão (d &gt;&gt; 24).  Em seguida, ele muda os oito bits altos para o byte baixo.  Ao mesmo tempo, calcula que o bit de sinal mais significativo é duplicado em todos os outros bits.  Ou seja, se a variável d é igual a 0b11111111'00000000'00000000'00000000, depois do turno, obtemos o valor 0b11111111'11111111'111111111111111111.  Adicionando 1 ao valor 0xFFFFFFFF do tipo <i>int</i> , o programador planeja obter 0 (-1 + 1 = 0).  Assim, com a expressão <i>((d &gt;&gt; 24) +1),</i> ele verifica se nem todos os oito bits altos são iguais a 1. <br><br>  No entanto, ao mudar, o bit mais significativo não é necessariamente "manchado".  O padrão diz: “O valor de E1 &gt;&gt; E2 é E1 com posições de bits E2 deslocadas à direita.  Se E1 tiver um tipo não assinado ou E1 tiver um tipo assinado e um valor não negativo, o valor do resultado será parte integrante do quociente E1 / 2 ^ E2.  <i>Se E1 tiver um tipo assinado e um valor negativo, o valor resultante será definido pela implementação</i> . " <br><br>  Portanto, este é um exemplo de comportamento definido pela implementação.  O funcionamento desse código depende da arquitetura do microprocessador e da implementação do compilador.  Após a mudança, os zeros podem aparecer nos bits mais significativos e, em seguida, o resultado da expressão <i>((d &gt;&gt; 24) +1)</i> sempre será diferente de 0, ou seja, sempre será um valor verdadeiro. <br><br>  De fato, uma tarefa difícil.  Este erro, como o anterior, foi descrito no artigo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Verificamos os códigos-fonte do Android usando o PVS-Studio, ou ninguém é perfeito</a> ". <br></div></div><br><h2>  2019 </h2><br><h3>  C ++ </h3><br>  <b>"O GCC é o culpado"</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *s)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> r = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(*s) { r += ((r * <span class="hljs-number"><span class="hljs-number">20891</span></span> + *s *<span class="hljs-number"><span class="hljs-number">200</span></span>) | *s ^ <span class="hljs-number"><span class="hljs-number">4</span></span> | *s ^ <span class="hljs-number"><span class="hljs-number">3</span></span>) ^ (r &gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>); s++; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> r &amp; <span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>; }</code> </pre> <br>  O programador afirma que esse código funciona com um erro devido à falha do compilador GCC 8. É isso? <br><br><div class="spoiler">  <b class="spoiler_title">A resposta</b> <div class="spoiler_text">  A função retorna valores negativos.  O motivo é que o compilador não gera código para o operador AND (&amp;) bit a bit.  O erro ocorre devido a um comportamento indefinido.  O compilador vê que uma certa quantidade é considerada na variável <i>r</i> .  Nesse caso, apenas números positivos são adicionados.  Estouros excessivos da variável <i>r</i> não devem ocorrer, caso contrário, esse é um comportamento indefinido que o compilador não deve considerar e levar em consideração de nenhuma maneira.  Portanto, o compilador acredita que, como o valor na variável <i>r</i> após o final do ciclo não pode ser negativo, a operação <i>r &amp; 0x7fffffff</i> para redefinir o bit de sinal é supérflua e o compilador simplesmente retorna o valor da variável <i>r a</i> partir da função. <br><br>  Erro do artigo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PVS-Studio 6.26 Release</a> ". <br></div></div><br>  <b>Bug QT</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> QMetaObjectPrivate *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">priv</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> uint* data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QMetaObjectPrivate*&gt;(data); } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> QMetaEnum::isFlag() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> offset = priv(mobj-&gt;d.data)-&gt;revision &gt;= <span class="hljs-number"><span class="hljs-number">8</span></span> ? <span class="hljs-number"><span class="hljs-number">2</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mobj &amp;&amp; mobj-&gt;d.data[handle + offset] &amp; EnumIsFlag; }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">A resposta</b> <div class="spoiler_text">  O ponteiro <i>mobj</i> é inseguro.  Primeiro, é desreferenciado e depois verificado.  Clássico <br><br>  O erro foi descrito no artigo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Terceiro teste do Qt 5 com PVS-Studio</a> ". <br></div></div><br><h3>  C # </h3><br>  <b>Bug do Infer.NET</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteAttribute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TextWriter writer, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, object defaultValue, object value, Func&lt;object, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; converter = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( defaultValue == null &amp;&amp; value == null || value.Equals(defaultValue)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> stringValue = converter == null ? value.ToString() : converter(value); writer.Write($<span class="hljs-string"><span class="hljs-string">"{name}=\"{stringValue}\" "</span></span>); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">A resposta</b> <div class="spoiler_text">  Na expressão <i>value.Equals (defaultValue)</i> , o acesso é possível por meio da referência nula do <i>valor</i> .  Isso acontecerá com esses valores de variável, quando <i>defaultValue! = Null</i> e <i>value == null</i> . <br><br>  O erro do artigo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Quais erros estão ocultos no código Infer.NET?</a> " <br></div></div><br>  <b>FastReport bug</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FastString</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> initCapacity = <span class="hljs-number"><span class="hljs-number">32</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> iniCapacity)</span></span></span><span class="hljs-function"> </span></span>{ sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(iniCapacity); .... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FastString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Init(initCapacity); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FastString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> iniCapacity)</span></span></span><span class="hljs-function"> </span></span>{ Init(initCapacity); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> StringBuilder StringBuilder =&gt; sb; } .... Console.WriteLine(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FastString(<span class="hljs-number"><span class="hljs-number">256</span></span>).StringBuilder.Capacity);</code> </pre> <br>  O que será exibido no console?  O que há de errado com a classe <i>FastString</i> ? <br><br><div class="spoiler">  <b class="spoiler_title">A resposta</b> <div class="spoiler_text">  Será exibido no console 32. O motivo é um erro de digitação no nome da variável passado para o método <i>Init</i> no construtor: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FastString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> iniCapacity)</span></span></span></span>{ Init(initCapacity); }</code> </pre> <br>  O <i>parâmetro do</i> construtor <i>iniCapacity</i> não será usado.  Em vez disso, a constante <i>initCapacity</i> é passada para o método <i>Init</i> . <br><br>  O erro foi descrito no artigo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Os relatórios mais rápidos no oeste selvagem. Além disso, há alguns bugs ...</a> " <br></div></div><br>  <b>Roslyn bug</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> SyntaxNode </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetNode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SyntaxNode root)</span></span></span><span class="hljs-function"> </span></span>{ var current = root; .... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (current.FullSpan.Contains(....)) { .... var nodeOrToken = current.ChildThatContainsPosition(....); .... current = nodeOrToken.AsNode(); } .... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> SyntaxNode </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AsNode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_token != null) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> null; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _nodeOrParent; }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">A resposta</b> <div class="spoiler_text">  O acesso é possível através da referência nula <i>atual</i> na expressão <i>current.FullSpan.Contains (....)</i> .  A variável <i>atual</i> pode obter um valor nulo como resultado do método <i>nodeOrToken.AsNode ()</i> . <br><br>  Erro do artigo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Verificando o código fonte do Roslyn</a> ". <br></div></div><br>  <b>Unity bug</b> <br><br><pre> <code class="cpp hljs">.... staticFields = packedSnapshot.typeDescriptions .Where(t =&gt; t.staticFieldBytes != null &amp; t.staticFieldBytes.Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) .Select(t =&gt; UnpackStaticFields(t)) .ToArray() ....</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">A resposta</b> <div class="spoiler_text">  Erro de digitação permitido: em vez do operador <i>&amp;&amp;</i> , o operador <i>&amp;</i> foi usado.  Isso leva ao fato de que a verificação <i>t.staticFieldBytes.Length&gt; 0</i> é sempre executada, mesmo que a variável <i>nula</i> seja <i>t.staticFieldBytes</i> , que, por sua vez, resultará em acesso por uma referência nula. <br><br>  Este erro foi mostrado pela primeira vez no artigo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Analisando erros nos componentes abertos do Unity3D</a> ". <br></div></div><br><h3>  Java </h3><br>  <b>Bug do IntelliJ IDEA</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkSentenceCapitalization</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NotNull String value)</span></span></span><span class="hljs-function"> </span></span>{ List&lt;String&gt; words = StringUtil.split(value, <span class="hljs-string"><span class="hljs-string">" "</span></span>); .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> capitalized = <span class="hljs-number"><span class="hljs-number">1</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> capitalized / words.size() &lt; <span class="hljs-number"><span class="hljs-number">0.2</span></span>; <span class="hljs-comment"><span class="hljs-comment">// allow reasonable amount of // capitalized words }</span></span></code> </pre> <br>  Propõe-se determinar por que o número de palavras com letras maiúsculas será calculado incorretamente. <br><br><div class="spoiler">  <b class="spoiler_title">A resposta</b> <div class="spoiler_text">  A função deve retornar true se menos de 20% das palavras começarem com uma letra maiúscula.  Mas a verificação não funciona, porque ocorre a divisão inteira, cujo resultado será apenas os valores 0 ou 1. A função retornará um valor falso apenas se todas as palavras começarem com uma letra maiúscula.  Em outros casos, a divisão produzirá 0 e a função retornará true. <br><br>  Erro do artigo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PVS-Studio for Java</a> ". <br></div></div><br>  <b>Bug de Spotbugs</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getXMLType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@WillNotClose InputStream in)</span></span></span><span class="hljs-function"> throws IOException </span></span>{ .... String s; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (count &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) { s = r.readLine(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (s == null) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } Matcher m = tag.matcher(s); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m.find()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m.group(<span class="hljs-number"><span class="hljs-number">1</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IOException(<span class="hljs-string"><span class="hljs-string">"Didn't find xml tag"</span></span>); .... }</code> </pre> <br>  Propõe-se determinar qual é o erro de pesquisa da tag xml. <br><br><div class="spoiler">  <b class="spoiler_title">A resposta</b> <div class="spoiler_text">  A condição de <i>contagem &lt;4</i> sempre será atendida, pois a <i>contagem de</i> variáveis ​​não <i>é</i> incrementada dentro do loop.  Supunha-se que a busca pela tag xml deveria ser realizada apenas nas quatro primeiras linhas do arquivo, mas, devido a um erro, o arquivo inteiro será lido. <br><br>  Este erro, como o anterior, foi descrito no artigo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PVS-Studio for Java</a> ". <br></div></div><br>  Isso é tudo.  Estamos esperando por você nas próximas conferências.  Procure um carrinho de unicórnio.  Daremos novos quebra-cabeças interessantes e, é claro, prêmios.  Até breve! <br><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a> </p><br><br>  Se você deseja compartilhar este artigo com um público que fala inglês, use o link para a tradução: Sergey Khrenov.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Soluções para desafios de detecção de bugs oferecidos pela equipe PVS-Studio nas conferências em 2018-2019</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt476272/">https://habr.com/ru/post/pt476272/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt476262/index.html">Sobre o repositório Centos espelha e escolhe o melhor</a></li>
<li><a href="../pt476264/index.html">Bot de telegrama para aprender línguas estrangeiras: de palavras cheias a falar</a></li>
<li><a href="../pt476266/index.html">Estágio na Mars Digital Technologies. Como aplicamos o aprendizado profundo na M&M</a></li>
<li><a href="../pt476268/index.html">Soluções para desafios de detecção de bugs oferecidos pela equipe PVS-Studio nas conferências em 2018-2019</a></li>
<li><a href="../pt476270/index.html">O que ganhou: TopCoder Open 2019</a></li>
<li><a href="../pt476276/index.html">Escrevendo um balanceador simples no Go</a></li>
<li><a href="../pt476278/index.html">Conferência BLACK HAT USA. Enriqueça ou morra: ganhe dinheiro na Internet usando o Black Hat. Parte 3</a></li>
<li><a href="../pt476280/index.html">Dos espinhos ao DOS: quatro disquetes que mudaram o mundo</a></li>
<li><a href="../pt476284/index.html">Formulamos uma estratégia para trabalhar com erros no React</a></li>
<li><a href="../pt476286/index.html">Os 5 principais frameworks de JS para desenvolvimento front-end em 2020. Parte 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>