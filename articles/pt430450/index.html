<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äçüíª ü§∏üèæ üçÉ Modelo de desenvolvimento usando CPU baseada em pilha como exemplo ü§õüèæ üëáüèª üõê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Voc√™ j√° teve a pergunta "como o processador funciona?". Sim, sim, exatamente o que est√° no seu PC / laptop / smartphone. Neste artigo, quero dar um ex...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Modelo de desenvolvimento usando CPU baseada em pilha como exemplo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430450/"><p>  Voc√™ j√° teve a pergunta "como o processador funciona?".  Sim, sim, exatamente o que est√° no seu PC / laptop / smartphone.  Neste artigo, quero dar um exemplo de um processador auto-inventado com um design no Verilog.  Verilog n√£o √© exatamente a linguagem de programa√ß√£o que parece.  Este √© o idioma da descri√ß√£o do hardware.  O c√≥digo escrito n√£o √© executado por nada (a menos que voc√™ o execute no simulador, √© claro), mas se transforma no design do circuito f√≠sico ou na forma percebida pelo FPGA (Field Programmable Gate Array). </p><a name="habracut"></a><br><p>  <strong>Isen√ß√£o de responsabilidade: este artigo √© o resultado do trabalho em um projeto na universidade, portanto o tempo para o trabalho foi limitado e muitas partes do projeto ainda est√£o apenas no est√°gio inicial de desenvolvimento.</strong> </p><br><p>  <strong>Observe que o processador criado neste artigo tem pouco em comum com os modernos processadores comuns, mas tentei alcan√ßar um objetivo um pouco diferente com sua cria√ß√£o.</strong> </p><br><p>  Para entender realmente o processo de programa√ß√£o, voc√™ precisa imaginar como cada uma das ferramentas utilizadas funciona: um compilador / int√©rprete da linguagem, uma m√°quina virtual, se houver, c√≥digo intermedi√°rio e, √© claro, o pr√≥prio processador.  Muitas vezes, as pessoas que estudam programa√ß√£o est√£o no primeiro est√°gio por um longo tempo - apenas pensam em como a linguagem e seu compilador funcionam.  Isso geralmente leva a erros cujas solu√ß√µes s√£o desconhecidas para o programador iniciante, porque ele n√£o tem id√©ia de onde est√£o vindo as ra√≠zes desses problemas.  Eu mesmo vi v√°rios exemplos ao vivo em que a situa√ß√£o era semelhante √† descri√ß√£o acima, ent√£o decidi tentar corrigi-la e criar um conjunto de coisas que ajudar√£o os iniciantes a entender todas as etapas. </p><br><p>  Este kit consiste em: </p><br><ul><li>  Linguagem realmente inventada </li><li>  Destaque o plugin para o VS Code </li><li>  Compilador para ele </li><li>  Conjunto de instru√ß√µes </li><li>  Um processador simples capaz de executar este conjunto de instru√ß√µes (escrito em Verilog) </li></ul><br><p>  Recordo mais uma vez que este artigo n√£o descreve nada semelhante a um processador real moderno, descreve um modelo f√°cil de entender sem entrar em detalhes. </p><br><p>  O que voc√™ precisa para fazer voc√™ mesmo: </p><br><p>  Para executar uma simula√ß√£o de CPU, voc√™ precisa do ModelSim, que pode ser baixado do site da Intel. </p><br><p>  Para executar o compilador OurLang, voc√™ precisa da vers√£o Java&gt; = 8. </p><br><p>  Links para projetos: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/IamMaxim/OurCPU</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/IamMaxim/OurLang</a> </p><br><p>  Extens√£o: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/IamMaxim/ourlang-vscode</a> </p><br><p>  Para criar a parte do Verilog, eu geralmente uso um script bash: </p><br><pre><code class="plaintext hljs">#/bin/bash vlib work vlog *.v vsim -c testbench_1 -do "run; exit"</code> </pre> <br><p>  Mas isso pode ser repetido atrav√©s da GUI. </p><br><p>  √â conveniente usar o Intellij IDEA para trabalhar com o compilador.  O principal √© acompanhar quais m√≥dulos o m√≥dulo que voc√™ precisa nas depend√™ncias possui.  N√£o publiquei o .jar pronto para abrir o acesso, porque espero que o leitor leia o c√≥digo-fonte do compilador. </p><br><p>  Os m√≥dulos lan√ßados s√£o Compilador e Int√©rprete.  Tudo est√° claro com o compilador, o Interpreter √© apenas um simulador do OurCPU em Java, mas n√£o o consideraremos neste artigo. </p><br><h3 id="instruction-set">  Conjunto de instru√ß√µes </h3><br><p>  Eu acho que √© melhor come√ßar com o conjunto de instru√ß√µes. </p><br><p>  Existem v√°rias arquiteturas de conjuntos de instru√ß√µes: </p><br><ul><li>  Baseado em pilha √© o que √© descrito no artigo.  Uma caracter√≠stica distintiva √© que todos os operandos s√£o empurrados para a pilha e removidos da pilha, o que elimina imediatamente a possibilidade de execu√ß√£o paralelizada, mas √© uma das abordagens mais simples para trabalhar com dados. </li><li>  Baseado no acumulador - o resultado final √© que existe apenas um registro que armazena um valor que √© modificado por instru√ß√µes. </li><li>  Baseado em registro √© o que √© usado nos processadores modernos, porque permite alcan√ßar o desempenho m√°ximo atrav√©s do uso de v√°rias otimiza√ß√µes, incluindo paraleliza√ß√£o de execu√ß√£o, pipelining, etc. </li></ul><br><p>  <a href="">Nosso conjunto de instru√ß√µes do processador cont√©m 30 instru√ß√µes</a> </p><br><p>  Em seguida, proponho uma olhada na implementa√ß√£o do processador: </p><br><p>  O c√≥digo consiste em v√°rios m√≥dulos: </p><br><ul><li>  CPU </li><li>  RAM </li><li>  M√≥dulos para cada instru√ß√£o </li></ul><br><p>  A RAM √© um m√≥dulo que cont√©m diretamente a pr√≥pria mem√≥ria, bem como uma maneira de acessar dados nela. </p><br><p>  CPU - um m√≥dulo que controla diretamente o andamento do programa: l√™ instru√ß√µes, transfere o controle para a instru√ß√£o desejada, armazena os registros necess√°rios (ponteiro para a instru√ß√£o atual, etc.). </p><br><p>  Quase todas as instru√ß√µes funcionam apenas com a pilha, ent√£o siga-as.  Alguns (por exemplo, putw, putb, jmp e jif) t√™m um argumento adicional na pr√≥pria instru√ß√£o.  Eles precisam passar a instru√ß√£o inteira para que possam ler os dados necess√°rios. </p><br><p>  Aqui est√° um resumo geral de como o processador funciona: </p><br><p><img src="https://habrastorage.org/webt/le/eq/-9/leeq-9mhht6o2lderrpxylbaldm.png"></p><br><p>  Princ√≠pios gerais de design de dispositivos no n√≠vel de instru√ß√£o </p><br><p>  Acho que √© hora de se familiarizar com o dispositivo diretamente dos pr√≥prios programas.  Como voc√™ pode ver no diagrama acima, ap√≥s cada instru√ß√£o, o endere√ßo passa para o pr√≥ximo.  Isso fornece um curso linear para o programa.  Quando se torna necess√°rio quebrar essa linearidade (condi√ß√£o, loop, etc.), s√£o utilizadas instru√ß√µes de ramifica√ß√£o (em nosso conjunto de instru√ß√µes s√£o jmp e jif). </p><br><p>  Ao chamar fun√ß√µes, precisamos salvar o estado atual de tudo e, para isso, existem registros de ativa√ß√£o - registros que armazenam essas informa√ß√µes.  Eles n√£o est√£o vinculados ao processador ou √†s instru√ß√µes de forma alguma, √© apenas um conceito que o compilador usa ao gerar c√≥digo.  O registro de ativa√ß√£o em OurLang tem a seguinte estrutura: </p><br><p><img src="https://habrastorage.org/webt/8d/1v/do/8d1vdowiro_cx_7piaxjns-aqni.png"></p><br><p>  Como pode ser visto neste diagrama, as vari√°veis ‚Äã‚Äãlocais tamb√©m s√£o armazenadas no registro de ativa√ß√£o, o que permite calcular o endere√ßo da vari√°vel na mem√≥ria em tempo de compila√ß√£o, em vez de em tempo de execu√ß√£o, agilizando a execu√ß√£o do programa. </p><br><p>  Para chamadas de fun√ß√£o, nosso conjunto de instru√ß√µes fornece m√©todos para trabalhar com dois registradores contidos no m√≥dulo da CPU (ponteiro de opera√ß√£o e ponteiro de endere√ßo de ativa√ß√£o) - putopa / popopa, putara / popara. </p><br><h3 id="kompilyator">  Compilador </h3><br><p>  Agora vamos dar uma olhada na parte mais pr√≥xima do programador final - o compilador.  Em geral, o compilador como um programa consiste em 3 partes: </p><br><ul><li>  Lexer </li><li>  Analisador </li><li>  Compilador </li></ul><br><p>  O lexer √© respons√°vel por traduzir o c√≥digo fonte do programa em unidades lexicais que o analisador entende. </p><br><p>  O analisador cria uma √°rvore de sintaxe abstrata a partir dessas unidades lexicais. </p><br><p>  O compilador passa por essa √°rvore e gera algum tipo de c√≥digo que consiste em instru√ß√µes de baixo n√≠vel.  Pode ser um bytecode ou um c√≥digo bin√°rio pronto para ser executado pelo processador. </p><br><p>  No compilador OurLang, essas partes s√£o representadas respectivamente por classes </p><br><ul><li>  Lexer.java </li><li>  Parser.java </li><li>  Compiler.java </li></ul><br><h3 id="yazyk">  Linguagem </h3><br><p>  O OurLang est√° em sua inf√¢ncia, ou seja, funciona, mas at√© agora n√£o h√° muitas coisas nele e mesmo a parte principal do idioma n√£o foi finalizada.  Mas, para entender a ess√™ncia do compilador, o estado atual √© suficiente. </p><br><p>  Como exemplo de um programa para entender a sintaxe, este fragmento de c√≥digo √© proposto (tamb√©m √© usado para testar a funcionalidade): </p><br><pre> <code class="plaintext hljs">// single-line comments /* * Multi-line comments */ function print(int arg) { instr(putara, 0); instr(putw, 4); instr(add, 0); instr(lw, 0); instr(printword, 0); } function func1(int arg1, int arg2): int { print(arg1); print(arg2); if (arg1 == 0) { return arg2; } else { return func1(arg1 - 1, arg2); }; } function main() { var i: int; i = func1(1, 10); if (i == 0) { i = 1; } else { i = 2; }; print(i); }</code> </pre> <br><p>  N√£o vou me concentrar no idioma, deixarei para o seu estudo.  Atrav√©s do c√≥digo do compilador, √© claro;). </p><br><p>  Ao escrev√™-lo, tentei tornar o c√≥digo autoexplicativo que fica claro sem coment√°rios, para que n√£o haja problemas em entender o c√≥digo do compilador. </p><br><p>  Bem, √© claro, a coisa mais interessante √© escrever c√≥digo e assistir ao que ele se transforma.  Felizmente, o compilador OurLang gera c√≥digo semelhante a assembly com coment√°rios, <br>  o que ajuda a n√£o ficar confuso sobre o que est√° acontecendo l√° dentro. </p><br><p>  Tamb√©m recomendo instalar a extens√£o do Visual Studio Code, pois facilitar√° o trabalho com o idioma. </p><br><p>  Boa sorte para aprender o projeto! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt430450/">https://habr.com/ru/post/pt430450/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt430434/index.html">Iniciando o visualizador de imagens do Windows XP no Windows moderno</a></li>
<li><a href="../pt430436/index.html">Rumo ao QUIC: O que est√° por tr√°s do HTTP / 3</a></li>
<li><a href="../pt430438/index.html">Sombras realistas para roguelike</a></li>
<li><a href="../pt430446/index.html">Mais uma vez sobre os profissionais da "escravid√£o m√≥vel"</a></li>
<li><a href="../pt430448/index.html">O que fornece o aprendizado de m√°quina no varejo: um exemplo de projeto</a></li>
<li><a href="../pt430452/index.html">Fogo, √°gua e spray fino. Como os moradores e visitantes do Centro de Lakhta ser√£o protegidos do fogo</a></li>
<li><a href="../pt430454/index.html">Estou cercado por idiotas ou como trabalhar em equipe</a></li>
<li><a href="../pt430456/index.html">Livros de Gerenciamento de Projetos Legais do PMI</a></li>
<li><a href="../pt430458/index.html">Supercondutor de grafeno multicamada: investiga√ß√£o de zonas planas</a></li>
<li><a href="../pt430460/index.html">Trojan Penguin: Criando um v√≠rus para Linux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>