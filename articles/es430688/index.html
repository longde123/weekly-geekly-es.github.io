<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöï ‚ô®Ô∏è ü•´ Transferencia de datos v√≠a QR animado a Gomobile y GopherJS üêá üë©üèæ‚Äçüî¨ üçí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este art√≠culo quiero hablar sobre un peque√±o y divertido proyecto de fin de semana para transferir archivos a trav√©s de c√≥digos QR animados. El pro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Transferencia de datos v√≠a QR animado a Gomobile y GopherJS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430688/"><p> En este art√≠culo quiero hablar sobre un peque√±o y divertido proyecto de fin de semana para transferir archivos a trav√©s de c√≥digos QR animados.  El proyecto est√° escrito en Go, usando Gomobile y Gopherjs, lo √∫ltimo para una aplicaci√≥n web para medir autom√°ticamente las tasas de transferencia de datos.  Si est√° interesado en la idea de transmitir datos a trav√©s de c√≥digos visuales, desarrollar aplicaciones web que no est√©n en JS o en la verdadera plataforma multiplataforma Go - to Wellcome to Cat. </p><br><p><img src="https://habrastorage.org/webt/2p/zg/t_/2pzgt_2anc92t0udxgl3cnt3xy0.gif" alt="demo txqr"></p><a name="habracut"></a><br><p>  La idea del proyecto naci√≥ de una tarea espec√≠fica para una aplicaci√≥n m√≥vil: c√≥mo transferir una peque√±a porci√≥n de datos (~ 15 KB) a otro dispositivo de la manera m√°s simple y r√°pida, en condiciones de bloqueo de red.  La primera idea fue usar Bluetooth, pero no es tan conveniente como parece: el proceso relativamente largo y no siempre activo de detecci√≥n y emparejamiento de dispositivos es demasiado dif√≠cil para la tarea.  Una buena idea ser√≠a usar NFC (Near Field Communication), pero todav√≠a hay demasiados dispositivos en los que la compatibilidad con NFC es limitada o inexistente.  Necesit√°bamos algo m√°s simple y m√°s asequible. </p><br><p>  ¬øQu√© pasa con los c√≥digos QR? </p><br><h1 id="qr-kody">  C√≥digos QR </h1><br><p>  El c√≥digo QR (respuesta r√°pida) es el tipo de c√≥digo visual m√°s popular del mundo.  Le permite codificar hasta 3 KB de datos arbitrarios y tiene varios niveles de correcci√≥n de errores, lo que le permite leer con confianza incluso un tercio de un c√≥digo cerrado o sucio. </p><br><p>  Pero con los c√≥digos QR hay dos problemas: </p><br><ul><li>  3 KB no es suficiente </li><li>  Cuantos m√°s datos est√©n codificados, mayores ser√°n los requisitos de calidad para escanear la imagen </li></ul><br><p>  Aqu√≠ est√° el c√≥digo QR de la versi√≥n 40 (la mayor densidad de grabaci√≥n) con 1276 bytes: </p><br><p><img src="https://habrastorage.org/webt/wp/r1/mp/wpr1mp7p-uz4vzzssaai5zp8v44.gif" alt="qrv40"></p><br><p>  Para mi tarea, necesitaba aprender c√≥mo transferir ~ 15 KB de datos en dispositivos est√°ndar (tel√©fonos inteligentes / tabletas), por lo que la pregunta surgi√≥ por s√≠ misma: ¬øpor qu√© no animar la secuencia de c√≥digos QR y transferir los datos en pedazos? </p><br><p>  Una b√∫squeda r√°pida de implementaciones preparadas condujo a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">varios</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">proyectos de este tipo</a> , principalmente proyectos en hackatones (aunque hab√≠a una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tesis de graduaci√≥n</a> ), pero todos fueron escritos en Java, Python o JavaScript, lo que, desafortunadamente, hizo que el c√≥digo fuera pr√°cticamente inportable y sin usar.  Pero dada la gran popularidad de los c√≥digos QR y la baja complejidad t√©cnica de la idea, se decidi√≥ escribir desde cero en Go, un lenguaje multiplataforma, legible y r√°pido.  Por lo general, multiplataforma implica la capacidad de construir c√≥digo binario para Windows, Mac y Linux, pero en mi caso tambi√©n fue importante construirlo para la web (gopherjs) y para sistemas m√≥viles (iOS / Android).  Go lo da todo fuera de la caja con un costo m√≠nimo. </p><br><p>  Tambi√©n consider√© opciones alternativas para c√≥digos visuales, como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">HCCB</a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">JAB Code</a> , pero para ellos tendr√≠a que escribir un esc√°ner OpenCV, implementar un codificador / decodificador desde cero y esto fue demasiado para un proyecto para un fin de semana.  Los c√≥digos QR <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">redondos</a> (c√≥digos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tiro</a> ) y sus hom√≥logos utilizados en Facebook, Kik y Snapchat, le permiten codificar mucha menos informaci√≥n, y el enfoque patentado incre√≠blemente genial de Apple para emparejar Apple Watch y iPhone, una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nube animada de part√≠culas coloridas</a> , tambi√©n est√° optimizado para el efecto sorpresa, y no bajo el ancho de banda m√°ximo.  Los c√≥digos QR est√°n integrados en las c√°maras SDK nativas del sistema operativo m√≥vil, lo que facilita enormemente el trabajo con ellos. </p><br><h1 id="txqr">  TXQR </h1><br><p>  As√≠ <em>naci√≥ el</em> proyecto <em>txqr</em> (de Tx - transmisi√≥n y QR), que implementa una biblioteca para codificar / decodificar QR en Go puro y un protocolo para transmitir datos. </p><br><p>  La idea principal es la siguiente: un cliente selecciona un archivo o datos para enviar, el programa en el dispositivo divide el archivo en pedazos, codifica cada uno de ellos en cuadros QR y los muestra en un bucle sin fin con una velocidad de cuadro dada hasta que el destinatario reciba todos los datos.  El protocolo est√° hecho de tal manera que el destinatario puede comenzar desde cualquier fotograma, recibir fotogramas QR en cualquier orden; esto elimina la necesidad de sincronizar la frecuencia de animaci√≥n y la frecuencia de escaneo.  El receptor puede ser un dispositivo antiguo, cuya potencia le permite decodificar 2 cuadros por segundo, y el remitente con un nuevo tel√©fono inteligente que produce animaci√≥n de 120Hz, o viceversa, y esto no ser√° un problema fundamental para el protocolo. </p><br><p> Esto se logra de la siguiente manera: cuando el archivo se divide en partes ( <em>cuadros</em> adicionales), un prefijo con informaci√≥n sobre el desplazamiento relativo a todos los datos y la longitud total: <code>OFFSET/TOTAL|</code>  (donde OFFSET y TOTAL son valores enteros de desplazamiento y longitud, respectivamente).  Los datos binarios todav√≠a est√°n codificados en Base64, pero esto no es realmente necesario: la especificaci√≥n QR permite no solo codificar datos como binarios, sino tambi√©n optimizar diferentes partes de los datos para diferentes codificaciones (por ejemplo, un prefijo con cambios menores puede codificarse como <em>alfanum√©rico</em> , y el resto del contenido - como <em>binario</em> ), pero por simplicidad, Base64 realiz√≥ su funci√≥n perfectamente. </p><br><p>  Adem√°s, el tama√±o del cuadro y la frecuencia pueden incluso cambiarse din√°micamente, adapt√°ndose a las capacidades del destinatario. </p><br><p><img src="https://habrastorage.org/webt/qm/7g/dg/qm7gdgycvmlhgjflhc_xudrfeu8.png" alt="protocolo"></p><br><p>  El protocolo en s√≠ es muy simple, y su principal inconveniente es que para archivos grandes (aunque esto est√° m√°s all√° del alcance de la tarea, pero a√∫n as√≠), un cuadro omitido durante el escaneo duplicar√° el tiempo de escaneo: el destinatario tendr√° que esperar el ciclo completo nuevamente.  En la teor√≠a de la codificaci√≥n hay soluciones para tales casos: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">c√≥digos fuente</a> , pero lo dejar√© para algunos de los siguientes d√≠as libres. </p><br><p>  El punto m√°s interesante fue escribir una aplicaci√≥n m√≥vil que pueda usar este protocolo. </p><br><h2 id="gomobile">  Gomobile </h2><br><p>  Si no ha escuchado sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">gomobile</a> , entonces este es un proyecto que le permite usar bibliotecas Go en proyectos de iOS y Android y lo convierte en un procedimiento simple obsceno. </p><br><p>  El proceso est√°ndar es el siguiente: </p><br><ul><li>  escribes c√≥digo Go regular </li><li>  ejecutar <code>gomobile bind ...</code> </li><li>  copie los artefactos resultantes ( <code>yourpackage.framework.</code> o <code>yourpackage.aar</code> ) en su proyecto m√≥vil </li><li>  importa tu <code>yourpackage</code> y trabaja con √©l como con una biblioteca normal </li></ul><br><p>  Puedes probar lo f√°cil que es. </p><br><p>  Por lo tanto, escrib√≠ r√°pidamente una aplicaci√≥n en Swift que escanea c√≥digos QR (gracias a este <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">maravilloso art√≠culo</a> ) y los decodifica, los pega y, cuando se recibe el archivo completo, lo muestra en la ventana de vista previa. </p><br><p>  Como novato en Swift (aunque le√≠ el libro de Swift 4), hubo algunos momentos en que me qued√© atrapado en algo simple, tratando de descubrir c√≥mo hacerlo correctamente y, al final, la mejor soluci√≥n fue implementar esta funcionalidad en Go y usar a trav√©s de gomobile.  No me malinterpreten, Swift es en muchos sentidos un lenguaje maravilloso, pero, como la mayor√≠a de los otros lenguajes de programaci√≥n, proporciona demasiadas formas de hacer lo mismo y ya tiene un historial decente de cambios incompatibles con versiones anteriores.  Por ejemplo, necesitaba hacer algo simple: medir la duraci√≥n de un evento con una precisi√≥n de milisegundos.  Una b√∫squeda en Google y StackOverflow condujo a una serie de soluciones diferentes, contradictorias y a menudo desactualizadas, ninguna de las cuales, al final, me pareci√≥ hermosa o correcta para el compilador.  Despu√©s de 40 minutos de tiempo invertido, acabo de hacer otro m√©todo en el paquete Go que llam√≥ a <code>time.Since(start) / time.Millisecond</code> y us√© su resultado directamente de Swift. </p><br><p>  Tambi√©n escrib√≠ la utilidad de consola <code>txqr-ascii</code> para pruebas r√°pidas de aplicaciones.  Codifica el archivo y anima los c√≥digos QR en el terminal.  En conjunto, funcion√≥ sorprendentemente bien: pude enviar una imagen peque√±a en unos segundos, pero tan pronto como comenc√© a probar diferentes valores de la velocidad de fotogramas, el n√∫mero de bytes en cada fotograma QR y el nivel de correcci√≥n de errores en el codificador QR, qued√≥ claro que la soluci√≥n del terminal no era hace frente a la alta frecuencia (m√°s de 10) de la animaci√≥n, y que probar y medir los resultados manualmente es algo desastroso. </p><br><h1 id="txqr-tester">  Probador TXQR </h1><br><p><img src="https://habrastorage.org/webt/bc/tp/a6/bctpa6fnru8q-kxbezmo27dcc1w.jpeg"></p><br><p>  Para encontrar la combinaci√≥n √≥ptima de velocidad de cuadros, tama√±o de datos en un cuadro QR y el nivel de correcci√≥n de errores entre los l√≠mites razonables de estos valores, tuve que ejecutar m√°s de 1000 pruebas, cambiar manualmente los par√°metros, esperar un ciclo completo con el tel√©fono en la mano y escribir los resultados en una placa.  ¬°Por supuesto, esto debe ser automatizado! </p><br><p>  Aqu√≠ surgi√≥ la idea de la pr√≥xima aplicaci√≥n: <code>txqr-tester</code> .  Inicialmente, plane√© usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">x / exp / shiny</a> , un marco de IU experimental para aplicaciones de escritorio nativas en Go, pero parece estar abandonado.  Hace aproximadamente un a√±o lo prob√©, y la impresi√≥n no era mala: encajaba perfectamente para cosas de bajo nivel.  Pero hoy, la rama maestra ni siquiera ha sido compilada.  Parece que ya no hay ning√∫n incentivo para invertir en el desarrollo de marcos de escritorio: una tarea compleja y engorrosa, con una demanda casi nula en la actualidad, todas las soluciones de IU se han trasladado a la web hace mucho tiempo. </p><br><p>  En la programaci√≥n web, como saben, los lenguajes de programaci√≥n acaban de comenzar a ingresar, gracias a WebAssembly, pero estos siguen siendo los primeros pasos para los ni√±os.  Por supuesto, tambi√©n hay JavaScript y complementos, pero los amigos no permiten que sus amigos escriban aplicaciones en JavaScript, por lo que decid√≠ usar mi descubrimiento reciente: el marco <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Vecty</a> , que le permite escribir interfaces en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Pure</a> Go, que se convierten autom√°ticamente a JavaScript utilizando un sistema muy adulto y sorprendentemente bien funcional. Proyecto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GopherJS</a> . </p><br><h1 id="vecty-i-gopherjs">  Vecty y GopherJS </h1><br><p><img src="https://habrastorage.org/webt/rf/xc/zz/rfxczzfu4b5efmhjtu_lmf7ema4.png" alt="vecty"></p><br><p>  En mi vida, no he recibido tanto placer del desarrollo de interfaces front-end. </p><br><p>  Un poco m√°s tarde, planeo escribir un par de art√≠culos m√°s sobre mi experiencia en el desarrollo de interfaces en Vecty, incluidas las aplicaciones WebGL, pero la conclusi√≥n es que despu√©s de varios proyectos en React, Angulars y Ember, escribir una interfaz en un lenguaje de programaci√≥n simple y reflexivo es un soplo fresco. aire!  ¬°Puedo escribir frontales muy bonitos en poco tiempo sin escribir una sola l√≠nea en JavaScript! </p><br><p>  Para empezar, as√≠ es como se inicia un nuevo proyecto en Vecty (no hay generadores de c√≥digo de "proyecto inicial" que creen toneladas de archivos y carpetas), solo main.go: </p><br><pre> <code class="go hljs">ackage main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"github.com/gopherjs/vecty"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { app := NewApp() vecty.SetTitle(<span class="hljs-string"><span class="hljs-string">"My App"</span></span>) vecty.AddStylesheet(<span class="hljs-comment"><span class="hljs-comment">/* ... add your css... */</span></span>) vecty.RenderBody(app) }</code> </pre> <br><p>  Una aplicaci√≥n, como cualquier componente de la interfaz de usuario, es solo un tipo: una estructura que incluye el tipo <code>vecty.Core</code> y debe implementar la interfaz <code>vecty.Component</code> (que consiste en un m√©todo <code>Render()</code> ).  ¬°Y eso es todo!  Luego, trabaja con tipos, m√©todos, funciones, bibliotecas para trabajar con DOM, etc., sin magia oculta y nuevos t√©rminos y conceptos.  Aqu√≠ est√° el c√≥digo simplificado para la p√°gina principal: </p><br><pre> <code class="go hljs">/ App is a top-level app component. <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { vecty.Core session *Session settings *Settings <span class="hljs-comment"><span class="hljs-comment">// any other stuff you need, // it's just a struct } // Render implements the vecty.Component interface. func (a *App) Render() vecty.ComponentOrHTML { return elem.Body( a.header(), elem.Div( vecty.Markup( vecty.Class("columns"), ), // Left half elem.Div( vecty.Markup( vecty.Class("column", "is-half"), ), elem.Div(a.QR()), // QR display zone ), // Right half elem.Div( vecty.Markup( vecty.Class("column", "is-half"), ), vecty.If(!a.session.Started(), elem.Div( a.settings, )), vecty.If(a.session.Started(), elem.Div( a.resultsTable, )), ), ), vecty.Markup( event.KeyDown(a.KeyListener), ), ) }</span></span></code> </pre> <br><p>  Probablemente est√© viendo el c√≥digo ahora y pensando: ¬°cu√°nto es el trabajo infundado con el DOM!  Tambi√©n lo pens√© al principio, pero tan pronto como comenc√© a trabajar, me di cuenta de lo conveniente que era: </p><br><ol><li>  No hay magia: cada bloque (marcado o HTML) es solo una variable del tipo deseado, con l√≠mites claros donde puede colocar algo, gracias a la escritura est√°tica. </li><li>  No hay etiquetas de apertura / cierre que deba recordar cambiar cuando refactorice, o use el IDE que lo hace por usted. </li><li>  La estructura de repente se vuelve clara, por ejemplo, nunca entend√≠ por qu√© en React hasta la 16¬™ versi√≥n era imposible devolver varias etiquetas de un componente, esto es "solo una cadena".  Al ver c√≥mo se hace esto en Vecty, de repente se hizo evidente d√≥nde crecieron las ra√≠ces de esa restricci√≥n en React.  De todos modos, no est√° claro, sin embargo, por qu√© despu√©s de React 16 se hizo posible, pero no necesario. </li></ol><br><p>  En general, tan pronto como pruebe este enfoque para trabajar con el DOM, sus ventajas ser√°n muy obvias.  Tambi√©n hay desventajas, por supuesto, pero despu√©s de las desventajas de los m√©todos habituales, son invisibles. </p><br><p>  Vecty se llama un marco similar a React, pero esto no es del todo cierto.  Hay una biblioteca nativa de GopherJS para React: <a href="">myitcv.io/react</a> , pero no creo que sea una buena idea repetir las soluciones arquitect√≥nicas de React para Go.  Cuando escribes una interfaz en Vecty, de repente se vuelve claro lo f√°cil que es realmente.  De repente, toda esta magia oculta y los nuevos t√©rminos y conceptos que inventa cada marco de JavaScript se vuelven superfluos: solo se les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">agrega complejidad</a> , nada m√°s.  Todo lo que se necesita es describir clara y claramente los componentes, su comportamiento y conectarlos entre s√≠: tipos, m√©todos y funciones, y eso es todo. </p><br><p>  Para CSS, utilic√© un marco de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Bulma</a> sorprendentemente decente: tiene un nombre de clase muy claro y una buena estructura, y el c√≥digo de IU declarativo con √©l es muy legible. </p><br><p>  Sin embargo, la verdadera magia comienza cuando compila el c√≥digo Go en JavaScript.  Suena muy intimidante, pero, de hecho, simplemente llama a <code>gopherjs build</code> y en menos de un segundo, tiene un archivo JavaScript generado autom√°ticamente listo para ser incluido en su p√°gina HTML b√°sica (una aplicaci√≥n regular consiste solo en una etiqueta de cuerpo vac√≠a y la inclusi√≥n de este Gui√≥n JS).  Cuando ejecut√© este comando por primera vez, esperaba ver muchos mensajes, advertencias y errores, pero no, funciona fant√°sticamente de manera r√°pida y silenciosa, solo imprime archivos de una sola l√≠nea en el caso de errores de compilaci√≥n generados por el compilador Go, por lo que son muy claros.  ¬°Pero fue a√∫n m√°s genial ver errores en la consola del navegador, con rastros de pila apuntando a archivos .go y la l√≠nea correcta!  Esto es genial </p><br><h2 id="testirovanie-parametrov-qr-animacii">  Prueba de par√°metros de animaci√≥n QR </h2><br><p>  Durante varias horas tuve una aplicaci√≥n web lista que me permiti√≥ cambiar r√°pidamente los par√°metros para las pruebas: </p><br><ul><li>  FPS - velocidad de fotogramas </li><li>  Tama√±o de trama QR: cu√°ntos bytes debe haber en cada trama </li><li>  Nivel de recuperaci√≥n QR: nivel de correcci√≥n de errores QR </li></ul><br><p>  y ejecuta la prueba autom√°ticamente. </p><br><p><img src="https://habrastorage.org/webt/dl/51/my/dl51myjlg-kfbii5wxjx3ggu9tm.png" alt="aplicaci√≥n"></p><br><p>  La aplicaci√≥n m√≥vil, por supuesto, tambi√©n ten√≠a que ser automatizada: ten√≠a que comprender cu√°ndo comienza la pr√≥xima ronda con nuevos par√°metros, comprender cu√°ndo la recepci√≥n toma demasiado tiempo y romper la ronda, enviar los resultados a la aplicaci√≥n, etc. </p><br><p>  El problema es que la aplicaci√≥n web, mientras se ejecuta en el entorno limitado del navegador, no puede crear nuevas conexiones, y si no me equivoco, la √∫nica posibilidad de una conexi√≥n de igual a igual real al navegador es solo a trav√©s de WebRTC (no necesito perforar a trav√©s de NAT ), pero era demasiado engorroso.  La aplicaci√≥n web solo podr√≠a ser un cliente. </p><br><p>  La soluci√≥n fue simple: el servicio web Go que entreg√≥ la aplicaci√≥n web (y lanz√≥ el navegador a la URL deseada) tambi√©n lanz√≥ el proxy WebSocket para dos clientes.  Tan pronto como se unen dos clientes, env√≠a mensajes transparentes de una conexi√≥n a otra, permitiendo que los clientes (aplicaci√≥n web y cliente m√≥vil) se comuniquen directamente.  Deben ser para esto, en una red WIFI, por supuesto. </p><br><p>  Hubo un problema de c√≥mo decirle a un dispositivo m√≥vil d√≥nde, de hecho, conectarse, y se resolvi√≥ usando ... ¬°c√≥digo QR! </p><br><p>  El proceso de prueba se ve as√≠: </p><br><ul><li>  una aplicaci√≥n m√≥vil est√° buscando un c√≥digo QR con un marcador de inicio y un enlace a un proxy de WebSocket </li><li>  tan pronto como se lee el token, la aplicaci√≥n se conecta a este proxy de WebSocket </li><li>  la aplicaci√≥n web (ya conectada al proxy) entiende que la aplicaci√≥n m√≥vil est√° lista y muestra un c√≥digo QR con el marcador "¬ølisto para la pr√≥xima ronda?" </li><li>  la aplicaci√≥n m√≥vil reconoce la se√±al, restablece el decodificador y env√≠a un mensaje "s√≠" a trav√©s de WebSocket. </li><li>  la aplicaci√≥n web, despu√©s de recibir la confirmaci√≥n, genera una nueva animaci√≥n QR y la retuerce hasta que recibe los resultados o el tiempo de espera. </li><li>  los resultados se agregan a una placa junto a la cual puede descargar inmediatamente como CSV </li></ul><br><p><img src="https://habrastorage.org/webt/u_/gm/jx/u_gmjxdtzg16tus3pboxicibyuk.png" alt="dise√±o"></p><br><p>  Como resultado, todo lo que me qued√≥ fue simplemente poner el tel√©fono en un tr√≠pode, iniciar la aplicaci√≥n, y luego los dos programas hicieron todo el trabajo sucio, comunic√°ndose cort√©smente a trav√©s de c√≥digos QR y WebSocket :) </p><br><p><img src="https://habrastorage.org/webt/b-/no/wn/b-nownnc3g_qjijctnqqwpjppri.gif" alt="demo probador"></p><br><p>  Al final, descargu√© el archivo CSV con los resultados, lo conduje a RStudio y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Plotly Online Chart Maker</a> y analic√© los resultados. </p><br><h1 id="rezultaty">  Resultados </h1><br><p>  El ciclo de prueba completo dura aproximadamente 4 horas (desafortunadamente, la parte m√°s dif√≠cil del proceso: generar una imagen GIF animada con marcos QR, tuvo que ejecutarse en el navegador, y dado que el c√≥digo resultante todav√≠a est√° en JS, solo se usa un procesador), durante lo cual, ten√≠a que mirar para que la pantalla no se quedara en blanco de repente o alguna aplicaci√≥n no cerrara la ventana con la aplicaci√≥n web.  Se probaron los siguientes par√°metros: </p><br><ul><li>  FPS: de 3 a 12 </li><li>  El tama√±o de la trama QR es de 100 a 1000 bytes (en incrementos de 50) </li><li>  Los 4 niveles de correcci√≥n de errores QR (bajo, medio, alto, m√°s alto) </li><li>  Tama√±o de archivo transferido: 13 KB de bytes generados aleatoriamente </li></ul><br><p>  Unas horas m√°s tarde descargu√© CSV y comenc√© a analizar los resultados. </p><br><p>  Una imagen es m√°s importante que mil palabras, pero las visualizaciones 3D interactivas son m√°s importantes que mil im√°genes.  Aqu√≠ hay una visualizaci√≥n de los resultados (clicable): </p><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="qr_scan_results"><img src="https://habrastorage.org/getpro/habr/post_images/ba3/833/7f1/ba38337f18e68ef62245173481e497f7.png" alt="qr_scan_results" width="600"></a> <br><br><br><p>  ¬°El mejor resultado fue 1.4 segundos, que es aproximadamente 9 KB / s!  Este resultado se registr√≥ a una frecuencia de 11 cuadros por segundo, un tama√±o de cuadro de 850 bytes y un nivel promedio de correcci√≥n de errores.  Sin embargo, en la mayor√≠a de los casos, a esta velocidad, el decodificador de la c√°mara se salt√≥ algunos fotogramas y tuvo que esperar la pr√≥xima repetici√≥n del fotograma perdido, lo que tuvo un efecto muy negativo en los resultados; en lugar de dos segundos, podr√≠a resultar f√°cilmente 15, o un tiempo de espera establecido en 30 segundos. </p><br><p>  Aqu√≠ est√°n los gr√°ficos de la dependencia de los resultados en variables variables: </p><br><h3 id="vremya--razmer-freyma">  Tiempo / tama√±o del cuadro </h3><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/pd/9c/rp/pd9crp3igj0djkv3uftlpxcgb2y.png" alt="Tiempo vs tama√±o"></a> </p><br><p>  Como puede ver, a valores bajos del n√∫mero de bytes en cada cuadro, el exceso de codificaci√≥n es demasiado grande y el tiempo de lectura total, respectivamente, tambi√©n.  Hay un m√≠nimo local de 500-600 bytes por cuadro, pero los valores al lado a√∫n conducen a cuadros perdidos.  El mejor resultado se observ√≥ a 900 bytes, pero 1000 y m√°s es casi una p√©rdida de trama garantizada. </p><br><h3 id="vremya--fps">  Tiempo / FPS </h3><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/-g/al/up/-galupwvvmk5k78p2bqgmsg1zme.png" alt="Tiempo vs FPS"></a> </p><br><p>  Para mi sorpresa, el valor del n√∫mero de cuadros por segundo no tuvo un efecto muy grande: los valores peque√±os aumentaron demasiado el tiempo de transmisi√≥n general y los grandes aumentaron la probabilidad de un cuadro perdido.  El valor √≥ptimo, a juzgar por estas pruebas, est√° en la regi√≥n de 6-7 cuadros por segundo para los dispositivos en los que prob√©. </p><br><h3 id="vremya--uroven-korrekcii-oshibok">  Nivel de correcci√≥n de tiempo / error </h3><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/c4/2g/di/c42gdiq0sqjxynepawom9j6bpi4.png" alt="Tiempo vs Niv."></a> </p><br><p>  El nivel de correcci√≥n de errores mostr√≥ una relaci√≥n clara entre el tiempo de transferencia de archivos y el nivel de redundancia, lo cual no es sorprendente.  El claro ganador aqu√≠ es el bajo nivel de correcci√≥n (L): cuanto menos datos redundantes, m√°s legible es el c√≥digo QR para el esc√°ner con el mismo tama√±o de datos.  De hecho, no se necesita redundancia para este experimento, pero el est√°ndar no ofrece tal opci√≥n. </p><br><p>  Por supuesto, para obtener datos m√°s objetivos, esta prueba debe ejecutarse cientos y miles de veces, en diferentes dispositivos y diferentes pantallas, pero para mi experimento de fin de semana, fue un resultado m√°s que suficiente. </p><br><h1 id="vyvody">  Conclusiones </h1><br><p>  Este divertido proyecto demostr√≥ que la transferencia de datos unidireccional a trav√©s de c√≥digos animados es ciertamente posible, y para situaciones en las que necesita transferir una peque√±a cantidad en ausencia de cualquier tipo de redes, es bastante adecuada.  Aunque mi resultado m√°ximo fue de aproximadamente 9 KB / s, en la mayor√≠a de los casos la velocidad real fue de 1-2 KB / s. </p><br><p>  Tambi√©n me gust√≥ mucho usar Gomobile y GopherJS con Vecty como herramienta de rutina para resolver problemas.  Estos son proyectos muy maduros, con excelente velocidad de trabajo y, en la mayor√≠a de los casos, dando experiencia "simplemente funciona". </p><br><p>  Al final, todav√≠a admiro lo productivo que puede ser con Go cuando sabe claramente lo que quiere implementar: el ciclo extremadamente corto "cambio" - "ensamblado" - "verificaci√≥n" le permite experimentar mucho y, a menudo, un c√≥digo simple y la falta de una jerarqu√≠a de clases en la estructura Los programas hacen posible refactorizarlos f√°cilmente y sin problemas sobre la marcha, y la fant√°stica plataforma cruzada incrustada en el lenguaje desde el principio le permite escribir el c√≥digo una vez y usarlo en el servidor, en el cliente web y en la aplicaci√≥n m√≥vil nativa.  Al mismo tiempo, a pesar del rendimiento m√°s que suficiente de f√°brica, todav√≠a hay mucho espacio para la optimizaci√≥n y la aceleraci√≥n. </p><br><p>  Entonces, si nunca ha probado Gomobile o GopherJS, le recomiendo que lo intente en la pr√≥xima oportunidad.  Le tomar√° una hora de su tiempo, pero puede abrir una nueva capa de oportunidades en el desarrollo web o m√≥vil.  ¬°Si√©ntase libre de probar! </p><br><h1 id="ssylki">  Referencias </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/divan/txqr</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/divan/txqr/tree/master/cmd/txqr-tester</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/divan/txqr-tester-ios</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/divan/txqr-reader</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/gopherjs/vecty</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/golang/mobile</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es430688/">https://habr.com/ru/post/es430688/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es430678/index.html">Prueba de diez dimmers con l√°mparas LED.</a></li>
<li><a href="../es430680/index.html">Escribir un procesador simple y un entorno para ello</a></li>
<li><a href="../es430682/index.html">Tres a√±os del proyecto de microsat√©lites lunares: etapas de crecimiento</a></li>
<li><a href="../es430684/index.html">Escaneo de contratos de Ethereum en vivo en busca de un error de env√≠o sin marcar. Parte 2</a></li>
<li><a href="../es430686/index.html">Descripci√≥n general: la primera m√°quina de corte por chorro de agua de WAZER</a></li>
<li><a href="../es430690/index.html">Excepciones deterministas y manejo de errores en "C ++ del futuro"</a></li>
<li><a href="../es430692/index.html">Ingenier√≠a social con software de plataforma universal de Windows (APPX)</a></li>
<li><a href="../es430694/index.html">Una breve gu√≠a para aprender C ++: qu√©, cu√°ndo y qu√© crear</a></li>
<li><a href="../es430700/index.html">Un sistema unificado para grabar vistas de pel√≠culas en l√≠nea comenzar√° a funcionar en Rusia</a></li>
<li><a href="../es430702/index.html">Entrenamiento muy extra√±o</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>