<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👃 ✳️ 👨‍⚕️ Erstellen eines einfachen Anrufverfolgungsdienstes, Teil 1 🐲 🌔 🤹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel wird eine der möglichen Optionen für die Implementierung der Anrufverfolgung auf der Site betrachtet. Dieses Material wurde ausschli...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Erstellen eines einfachen Anrufverfolgungsdienstes, Teil 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473372/">  In diesem Artikel wird eine der möglichen Optionen für die Implementierung der Anrufverfolgung auf der Site betrachtet.  Dieses Material wurde ausschließlich zu Bildungszwecken verfasst und hat nicht das Ziel, vorhandene spezialisierte Dienste zu ersetzen, die den Calltracking-Dienst bereitstellen. <br><br><h3>  Funktionale Anforderungen </h3><br><ol><li>  Der Dienst sollte die Möglichkeit bieten, Zahlen durch die Quelle des Übergangs zur Website zu ersetzen - den Übergang von Suchmaschinen, den Übergang zur Werbung, die Weitergabe von Links mit utm-Tags. </li><li>  Der Dienst sollte die angezeigte Nummer für den Site-Besucher festlegen und diese Nummer bei einem weiteren Besuch anzeigen. </li><li>  Wenn Sie die angezeigte Nummer anrufen, muss der Dienst die Erstellung eines Ereignisses in Google Analytics initiieren. </li></ol><a name="habracut"></a><br><h3>  Allgemeine Mechanik </h3><br>  Wenn Sie zur Site gehen, bestimmen wir die Quelle des Übergangs und prüfen dann, ob die Nummer diesem Besucher zugewiesen ist.  Wenn der Besucher die Site zum ersten Mal besucht hat, weisen wir ihm eine eindeutige Kennung zu. Anschließend weisen wir eine Nummer aus dem Nummernpool zu, der sich auf diese Verweisquelle bezieht.  Wenn der Besucher in Zukunft auf die Website zurückkehrt, zeigen wir die ihm zuvor zugewiesene Nummer an. <br><br>  Ich möchte mich auf das Anrufprotokoll konzentrieren.  Das Ersetzen der Nummer und das Zuweisen der Nummer zum Benutzer ist ein technisches Problem. Die Hauptsache besteht darin, einen bestimmten Anruf mit der Nummer vergleichen zu können, die dem Benutzer derzeit zugewiesen ist.  Wenn die von Ihnen verwendete Telefonie es Ihnen ermöglicht, ständig Details zu laufenden Anrufen zu erhalten, den Zeitpunkt eines Anrufs an eine bestimmte Nummer zu kennen und Informationen darüber zu haben, welche Nummer zu diesem Zeitpunkt auf der Website des jeweiligen Benutzers angezeigt wurde, können Sie die Erstellung eines Ereignisses in Google Analytics initiieren und es dem ROK zuordnen. <br><br><h3>  Struktur </h3><br><ol><li>  ct-server.ru - Hier wird ein ausführbares Webdienst-Skript platziert, eine Datenbank zum Speichern von Raumeinstellungen und zum Protokollieren von Besuchern. </li><li>  refer-to-site-with-ct-code.ru - auf dieser Site werden wir den Übergang vom Suchnetzwerk emulieren; </li><li>  site-with-ct-code.ru - die Site, auf der das Nummernersetzungsskript platziert wird. </li></ol><br><h3>  Fangen wir an </h3><br>  Das folgende Beispiel wird auf dem lokalen Server implementiert. <br><br>  Erstellen Sie eine virtuelle <b>Host-Site-with-ct-code.ru</b> , in die wir die Datei <b>index.html</b> mit den folgenden Inhalten <b>einfügen</b> . <br><br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE HTML&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'utf-8'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>CT<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://ct-server.ru/script.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">//  google id document.cookie = '_ga=GA1.2.1212121212.1212121212; expires=Thu, 18 Dec 2077 12:00:00 UTC; path=/'; </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'calltracking'</span></span></span><span class="hljs-tag">&gt;</span></span>79000000000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Wie Sie dem Beispiel <b><a href="">entnehmen können</a></b> , verbinden wir ein externes Skript <b><a href="">ct-server.ru/script.js</a></b> , das zwischen <b>site-with-ct-code.ru</b> und <b>ct-server.ru</b> "kommuniziert" und mit dem DOM-Baum der Site interagiert <b>site-with-ct-code.ru</b> .  Die Nummer wird durch die ID des Elements "Calltracking" ersetzt. <br><br>  Jetzt erstellen wir <b>refer-to-site-with-ct-code.ru</b> , das einen Link zu site-with-ct-code.ru enthält, um die Pin-Nummer beim Übergang vom Referrer überprüfen zu können. <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE HTML&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'utf-8'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>CT<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://site-with-ct-code.ru"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Danach werden wir den Host <b>ct-server.ru aufrufen</b> , der die folgende Struktur hat: <br><br>  index.php - ausführbare Skriptdatei, die Post-Anfragen von site-with-ct-code.ru empfängt und mit der Datenbank interagiert; <br><br>  script.js - Skriptdatei, die an Standorten verbunden wird, an denen die Nummernersetzung durchgeführt wird. <br><br><h3>  Datenbank </h3><br>  Wir müssen zwei Platten erstellen.  In der <b>ct-</b> Tabelle speichern wir Zahlen und Einstellungen für ihre Anzeige, in der <b>Zahlentabelle</b> protokollieren wir die Anzeige von Zahlen. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`ct`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`phone`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`refer`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`utm`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`host`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`ga`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`login`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`ct`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`id`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`ct`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MODIFY</span></span> <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br>  Eine kleine Erklärung der hinzugefügten Felder: <br><br>  Telefon - ersetzte Telefonnummer; <br>  refer - die Quelle des Übergangs; <br>  utm - Link zu der Seite, auf der die Nummernersetzung stattfinden soll; <br>  Host - die Site, auf der sich das Nummernersetzungsskript befindet; <br>  ga - id des Google Analytics-Zählers; <br>  Login - Besitzer der Login-Nummer. <br><br>  Füllen Sie die Platte mit Daten. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`ct`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`phone`</span></span>, <span class="hljs-string"><span class="hljs-string">`refer`</span></span>, <span class="hljs-string"><span class="hljs-string">`utm`</span></span>, <span class="hljs-string"><span class="hljs-string">`host`</span></span>, <span class="hljs-string"><span class="hljs-string">`ga`</span></span>, <span class="hljs-string"><span class="hljs-string">`login`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'78000000001'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru/?utm_medium=cpc'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'UA-12345678-1'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>), (<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'78000000002'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://refer-to-site-with-ct-code.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'UA-12345678-1'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>), (<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'78000000003'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://refer-to-site-with-ct-code.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'UA-12345678-1'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>), (<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'78000000004'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://refer-to-site-with-ct-code.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'UA-12345678-1'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>), (<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'78000000005'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'UA-12345678-1'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>);</code> </pre><br><img src="https://i.ibb.co/WxKt63X/screen4.png" alt="Bild"><br><br>  Erstellen Sie nun das Nummernschild. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`numbers`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`phone`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`ct_user`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`refer`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`gid`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`page`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`time`</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT_TIMESTAMP</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`numbers`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`id`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`numbers`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MODIFY</span></span> <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT;<span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span>;</code> </pre><br>  Auf diesem Schild wird aufgezeichnet, welcher Besucher, welche Nummer und zu welchem ​​Zeitpunkt auf der Website angezeigt wird.  In Zukunft können diese Daten mit dem Anrufprotokoll verglichen werden, um die Zielaktion einzuleiten - Senden eines Ereignisses an Google Analytics, Erstellen eines Leads in CRM, Senden einer E-Mail usw. <br><br>  Telefon - Telefonnummer; <br>  ct_user - Besucher-ID; <br>  refer - die Quelle des Übergangs; <br>  gid - Google Analytics-Cookie <br>  Seite - die Seite, auf der die Nummer angezeigt wird; <br>  Zeit - Nummer Anzeigezeit. <br><br><h3>  Erstellen Sie einen Anforderungshandler </h3><br>  Die Interaktion zwischen dem Webdienst ct-server.ru und der Site, auf der das Skript gehostet wird, erfolgt über domänenübergreifende XHR-POST-Anforderungen (XMLHttpRequest). <br><br>  Öffnen <b>Sie</b> die zuvor erstellte Datei <b>ct-server.ru/index.php</b> und fügen Sie eine Prüfung für den Empfang von Daten von zulässigen Hosts hinzu. In unserem Fall handelt es sich um <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">site-with-ct-code.ru</a></b> , <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">site-with-ct-code2.ru</a></b> und <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">site-with -ct-code3.ru</a></b> . <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">"HTTP_ORIGIN"</span></span>]) === <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { $host = $_SERVER[<span class="hljs-string"><span class="hljs-string">"HTTP_ORIGIN"</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//   $allowHosts = array("http://site-with-ct-code.ru", "http://site-with-ct-code2.ru", "http://site-with-ct-code3.ru"); if (in_array($host, $allowHosts, true) === true) { header('Access-Control-Allow-Origin: ' . $host); header('Access-Control-Allow-Credentials: true'); header('Access-Control-Allow-Methods: POST'); header('Access-Control-Allow-Headers: Content-Type'); //    post-      } if ($_SERVER["REQUEST_METHOD"] === "OPTIONS") { exit; } } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br>  Wir schreiben variable Werte von POST-Anfragen ein, die von site-with-ct-code.ru kamen <br><br><pre> <code class="php hljs">$phone = $_POST[<span class="hljs-string"><span class="hljs-string">"phone"</span></span>]; $ct_user = $_POST[<span class="hljs-string"><span class="hljs-string">"ct_user"</span></span>]; $gid = $_POST[<span class="hljs-string"><span class="hljs-string">"gid"</span></span>]; $refer = $_POST[<span class="hljs-string"><span class="hljs-string">"ref"</span></span>]; $page = $_POST[<span class="hljs-string"><span class="hljs-string">"page"</span></span>];</code> </pre><br>  Cook _ga hat die Form _ga = GA1.2.1212121212.121212121212, wir bringen es in die Form "1212121212.121212121212". <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($gid) { $pos = strpos($gid, <span class="hljs-string"><span class="hljs-string">'.'</span></span>, strpos($gid, <span class="hljs-string"><span class="hljs-string">'.'</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>); $gid = substr($gid, $pos + <span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre><br>  Wir werden eine Verbindung zu der Datenbank herstellen, in der wir zuvor unsere Tabellen erstellt haben. <br><br><pre> <code class="php hljs">$conn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> mysqli(<span class="hljs-string"><span class="hljs-string">"localhost"</span></span>, <span class="hljs-string"><span class="hljs-string">"root"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"calltracking"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($conn-&gt;connect_error) { <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">"Connection failed: "</span></span> . $conn-&gt;connect_error); }</code> </pre><br>  Die Interaktion mit dem Webdienst erfolgt über zwei Methoden: <b>get_num_first</b> und <b>get_num</b> . <br><br>  Die Methode <b>get_num_first wird</b> aufgerufen, wenn der Besucher zum ersten Mal mit der Site interagiert, um eine Nummer zu erhalten, indem er aus der Datenbank nach den Kriterien Mail, Referrer, Utm, Host auswählt.  Wenn das Auswahlergebnis einen Wert zurückgibt, zeigen wir die Telefonnummer an. <br><br>  Darüber hinaus senden wir die Veranstaltung über das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Google Measurement Protocol</a> an Google Analytics.  Die gleiche Methode gilt für die Verfolgung von Offline-Aktionen. In Zukunft kann sie beim Vergleich des Anrufprotokolls und des Nummernprotokolls in der Nummerntabelle verwendet werden. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($_POST[<span class="hljs-string"><span class="hljs-string">'method'</span></span>] == <span class="hljs-string"><span class="hljs-string">'get_num_first'</span></span>) { $sql = <span class="hljs-string"><span class="hljs-string">"SELECT * FROM `ct` where `host` = '"</span></span> . $host . <span class="hljs-string"><span class="hljs-string">"' and `refer` = '"</span></span> . $refer . <span class="hljs-string"><span class="hljs-string">"' and `utm` = '"</span></span> . $page . <span class="hljs-string"><span class="hljs-string">"' ORDER BY RAND() LIMIT 1 "</span></span>; $result = $conn-&gt;query($sql); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($result-&gt;num_rows &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($row = $result-&gt;fetch_assoc()) { print_r($row[<span class="hljs-string"><span class="hljs-string">"phone"</span></span>]); $event = file_get_contents(<span class="hljs-string"><span class="hljs-string">'https://www.google-analytics.com/collect?v=1&amp;tid=UA-12345678-1&amp;cid='</span></span> . $gid . <span class="hljs-string"><span class="hljs-string">'&amp;t=event&amp;ec=GetNumber&amp;ea=number&amp;z='</span></span> . $row[<span class="hljs-string"><span class="hljs-string">"phone"</span></span>] . <span class="hljs-string"><span class="hljs-string">''</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">//echo "0"; $sql = "SELECT * FROM `ct` where `host` = '" . $host . "' and `refer` = '" . $refer . "' ORDER BY RAND() LIMIT 1 "; $result = $conn-&gt;query($sql); print_r($row["phone"]); $event = file_get_contents('https://www.google-analytics.com/collect?v=1&amp;tid=UA-12345678-1&amp;cid=' . $gid . '&amp;t=event&amp;ec=GetNumber&amp;ea=number&amp;z=' . $row["phone"] . ''); } }</span></span></code> </pre><br>  Die Methode <b>get_num ist</b> erforderlich, <b>um</b> Einträge in der <b>Zahlentabelle</b> zu <b>protokollieren</b> . <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($_POST[<span class="hljs-string"><span class="hljs-string">'method'</span></span>] == <span class="hljs-string"><span class="hljs-string">'get_num'</span></span>) { $sql = <span class="hljs-string"><span class="hljs-string">"INSERT INTO `numbers` (`phone`, `ct_user`, `gid`, `refer`,`page`) VALUES ( '"</span></span> . $phone . <span class="hljs-string"><span class="hljs-string">"', '"</span></span> . $ct_user . <span class="hljs-string"><span class="hljs-string">"', '"</span></span> . $gid . <span class="hljs-string"><span class="hljs-string">"', '"</span></span> . $refer . <span class="hljs-string"><span class="hljs-string">"', '"</span></span> . $page . <span class="hljs-string"><span class="hljs-string">"');"</span></span>; $result = $conn-&gt;query($sql); $sql = <span class="hljs-string"><span class="hljs-string">"SELECT * FROM `numbers` where `ct_user` = '"</span></span> . $ct_user . <span class="hljs-string"><span class="hljs-string">"' ORDER BY `id` DESC LIMIT 1 "</span></span>; $result = $conn-&gt;query($sql); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($result-&gt;num_rows &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($row = $result-&gt;fetch_assoc()) { print_r($row[<span class="hljs-string"><span class="hljs-string">"phone"</span></span>]); $event = file_get_contents(<span class="hljs-string"><span class="hljs-string">'https://www.google-analytics.com/collect?v=1&amp;tid=UA-12345678-1&amp;cid='</span></span> . $gid . <span class="hljs-string"><span class="hljs-string">'&amp;t=event&amp;ec=ShowNumber&amp;ea=number&amp;z='</span></span> . $row[<span class="hljs-string"><span class="hljs-string">"phone"</span></span>] . <span class="hljs-string"><span class="hljs-string">''</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">//echo "0"; } } $conn-&gt;close();</span></span></code> </pre><br><h3>  Nummernersetzungsskript </h3><br>  Als nächstes fahren wir mit dem Skript <b>ct-server.ru/script.js fort</b> , das wir auf site-with-ct-code.ru verbinden <br><br>  Lassen Sie uns zunächst zwei Funktionen erstellen - <b>setcookie</b> zum Erstellen und <b>getcookie</b> zum Lesen von Cookies.  Wir werden sie verwenden, um die Cookie-ID des Benutzers und die Telefonnummer aufzuzeichnen und abzurufen. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  function setcookie(phone, value, expires, path, domain, secure) { document.cookie = phone + "=" + escape(value) + (expires ? "; expires=" + new Date(expires) : "") + (path ? "; path=" + path : "") + (domain ? "; domain=" + domain : "") + (secure ? "; secure" : ""); } //  function getcookie(phone) { var cookie = " " + document.cookie; var search = " " + phone + "="; var setStr = null; var offset = 0; var end = 0; if (cookie.length &gt; 0) { offset = cookie.indexOf(search); if (offset != -1) { offset += search.length; end = cookie.indexOf(";", offset); if (end == -1) { end = cookie.length; } setStr = unescape(cookie.substring(offset, end)); } } return setStr; }</span></span></code> </pre><br>  <b>Fügen Sie danach die</b> Funktion <b>makeid hinzu</b> , um die ID für den Benutzer zu generieren. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// id  function makeid(length) { var result = ""; var user_id = "abcdefghijklmnopqrstuvwxyz0123456789"; var user_idLength = user_id.length; for (var i = 0; i &lt; length; i++) { result += user_id.charAt(Math.floor(Math.random() * user_idLength)); } return result; }</span></span></code> </pre><br>  Erstellen wir nun eine Funktion zum Generieren von Cookies mit einer 33-stelligen Benutzer-ID. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// id  function generateuser_id() { var ct_user_id = makeid(33); setcookie("ct_user", ct_user_id, new Date().getTime() + 60 * 60 * 1000); //  }</span></span></code> </pre><br>  Das resultierende <b>ct_user-</b> Cookie wird 1 Stunde lang gespeichert. <br><br>  Wir generieren eine Anforderung für eine Nummer über die Methode <b>get_num_first</b> .  Die resultierende Nummer aus ct-server.ru wird 1 Stunde lang in das Cookie geschrieben, und wir führen die erste Ersetzung der Nummer auf der Seite durch die ID des Elements durch. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    ,  ,       id  function getNumberFirstTime() { var method = "get_num_first"; var ct_user = getcookie("ct_user"); var gid = getcookie("_ga"); var ref = document.referrer; var host = window.location.origin; var page = document.location.href; var xhr = new XMLHttpRequest(); var body = "&amp;method=" + encodeURIComponent(method) + "&amp;page=" + encodeURIComponent(page) + "&amp;ct_user=" + encodeURIComponent(ct_user) + "&amp;ref=" + encodeURIComponent(ref) + "&amp;host=" + encodeURIComponent(host) + "&amp;gid=" + encodeURIComponent(gid); xhr.open("POST", "http://ct-server.ru", true); xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded"); xhr.withCredentials = true; xhr.send(body); xhr.onreadystatechange = function() { //console.log(xhr.responseText); var t = xhr.responseText; document.getElementById("calltracking").innerHTML = t; setcookie("phone", t, new Date().getTime() + 60 * 60 * 1000); //  }; }</span></span></code> </pre><br>  Wir werden eine Funktion erstellen, die regelmäßig die Werte der angezeigten Nummer, Benutzer-ID, Seitenadresse, des Google Analytics-Cookie-Werts und der Verweisquelle an ct-server.ru sendet. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNumberPeriodically</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> method = <span class="hljs-string"><span class="hljs-string">"get_num"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ct_user = getcookie(<span class="hljs-string"><span class="hljs-string">"ct_user"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> phone = getcookie(<span class="hljs-string"><span class="hljs-string">"phone"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gid = getcookie(<span class="hljs-string"><span class="hljs-string">"_ga"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ref = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.referrer; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> page = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.location.href; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> host = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.origin; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body = <span class="hljs-string"><span class="hljs-string">"&amp;method="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(method) + <span class="hljs-string"><span class="hljs-string">"&amp;page="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(page) + <span class="hljs-string"><span class="hljs-string">"&amp;ct_user="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(ct_user) + <span class="hljs-string"><span class="hljs-string">"&amp;ref="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(ref) + <span class="hljs-string"><span class="hljs-string">"&amp;host="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(host) + <span class="hljs-string"><span class="hljs-string">"&amp;phone="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(phone) + <span class="hljs-string"><span class="hljs-string">"&amp;gid="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(gid); xhr.open(<span class="hljs-string"><span class="hljs-string">"POST"</span></span>, <span class="hljs-string"><span class="hljs-string">"http://ct-server.ru"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.setRequestHeader(<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>); xhr.withCredentials = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.send(body); xhr.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//console.log(xhr.responseText); var t = xhr.responseText; //document.getElementById('calltracking').innerHTML = t; }; }</span></span></code> </pre><br>  Am Ende fügen wir die Funktion sendToCalltracking hinzu, die das Vorhandensein der Cookie-Telefonnummer und der Benutzer-ID überprüft. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendToCalltracking</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ggg = getcookie(<span class="hljs-string"><span class="hljs-string">"ct_user"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ccc = getcookie(<span class="hljs-string"><span class="hljs-string">"phone"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gac = getcookie(<span class="hljs-string"><span class="hljs-string">"_ga"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> ggg === <span class="hljs-string"><span class="hljs-string">"undefined"</span></span> || ggg === <span class="hljs-literal"><span class="hljs-literal">null</span></span> || ccc === <span class="hljs-string"><span class="hljs-string">"undefined"</span></span> || ccc === <span class="hljs-literal"><span class="hljs-literal">null</span></span> || ccc.length &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> || ggg.length &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> || ccc === <span class="hljs-string"><span class="hljs-string">""</span></span> || ggg === <span class="hljs-string"><span class="hljs-string">""</span></span> ) { <span class="hljs-comment"><span class="hljs-comment">//console.log('false'); generateuser_id(); getNumberFirstTime(); } else { //console.log('true'); document.getElementById("calltracking").innerHTML = ccc; getNumberPeriodically(); } }</span></span></code> </pre><br>  Ganz am Anfang des Skripts rufen wir unseren Funktions-Timer auf. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> myTimer = setTimeout(sendToCalltracking, <span class="hljs-number"><span class="hljs-number">500</span></span>); <span class="hljs-comment"><span class="hljs-comment">//        setInterval(sendToCalltracking, 1 * 60 * 1000);</span></span></code> </pre><br><img src="https://i.ibb.co/MDhmBRn/screen1.png" alt="Bild"><br><br>  Wenn Cookies während des nächsten Vorgangs gelöscht werden, weist die Funktion dem Besucher ein neues Cookie entsprechend der empfangenen Auswahl durch Host und Quelle zu.  Darüber hinaus ist es möglich, die empfangenen Werte in den localStorage-Browser zu schreiben. <br><br><img src="https://i.ibb.co/4KfXYVD/screen2.png" alt="Bild"><br><br>  Einmal pro Minute sendet das Skript den Wert der Cookie-Nummer und der Benutzer-ID, die die Seite angeben, auf die es angewendet wurde, ohne sie erneut zu laden.  Es versteht sich, dass das Skript auf allen Seiten der Domain platziert wird. <br><br><img src="https://i.ibb.co/q0wGMG3/screen3.png" alt="Bild"><br><br>  Im nächsten Artikel werden wir die Entwicklung einer einfachen Schnittstelle zum Hinzufügen und Konfigurieren von Zahlen diskutieren. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de473372/">https://habr.com/ru/post/de473372/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de473358/index.html">Installieren und konfigurieren Sie Nexus Sonatype mithilfe der Infrastruktur als Code-Ansatz</a></li>
<li><a href="../de473362/index.html">GSoC-Erfahrung: Wie zwei (drei) Schüler den CRIU-Code wirklich verbessert haben</a></li>
<li><a href="../de473364/index.html">Es gibt einen Grundel, der schwingt: eine Checkliste für den E-Commerce in der Verkaufssaison</a></li>
<li><a href="../de473366/index.html">Was ist in meinem Smart-TV für Sie? Oder was kann in den Fernseher gesteckt werden?</a></li>
<li><a href="../de473368/index.html">MIRO ist eine offene Indoor-Roboterplattform. Teil 3 - Softwarekomponente: ESP8266</a></li>
<li><a href="../de473374/index.html">Wie wir YouTube Live mit Zoom integriert haben</a></li>
<li><a href="../de473376/index.html">Die Dokumentation unter Windows 10X ist in das Netzwerk gelangt - eine neue Version des Betriebssystems für Geräte mit zwei Bildschirmen</a></li>
<li><a href="../de473378/index.html">Malware-Lizenzvereinbarungen</a></li>
<li><a href="../de473380/index.html">4. Lasttest-Prüfpunkt Maestro</a></li>
<li><a href="../de473384/index.html">3DToday Fest: wie es war (sein wird). Mitgliederimpressionen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>