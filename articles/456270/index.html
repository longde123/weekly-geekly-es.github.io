<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüë®‚Äçüëß üïé üë©‚Äçüëß‚Äçüë¶ Redis Stream - Fiabilidad y escalabilidad de sus sistemas de mensajer√≠a ‚¨ÖÔ∏è üò° üö£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Redis Stream: un nuevo tipo de datos abstractos introducido en Redis con el lanzamiento de la versi√≥n 5.0 
 Conceptualmente, Redis Stream es una lista...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Redis Stream - Fiabilidad y escalabilidad de sus sistemas de mensajer√≠a</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456270/"><img src="https://habrastorage.org/webt/4z/my/lg/4zmylgmptsa7q0dqxbekaq4gvai.png" alt="imagen"><br><br>  Redis Stream: un nuevo tipo de datos abstractos introducido en Redis con el lanzamiento de la versi√≥n 5.0 <br>  Conceptualmente, Redis Stream es una lista a la que puede agregar entradas.  Cada entrada tiene un identificador √∫nico.  Por defecto, un identificador se genera autom√°ticamente e incluye una marca de tiempo.  Por lo tanto, puede solicitar intervalos de grabaci√≥n por tiempo o recibir nuevos datos a medida que llegan a la secuencia, ya que el comando Unix tail -f lee el archivo de registro y se congela en previsi√≥n de nuevos datos.  Tenga en cuenta que varios clientes pueden escuchar la transmisi√≥n al mismo tiempo, ya que muchos procesos "tail-f" pueden leer un archivo al mismo tiempo, sin entrar en conflicto entre s√≠. <br><br>  Para comprender todas las ventajas del nuevo tipo de datos, recordemos brevemente las estructuras Redis existentes desde hace mucho tiempo que repiten parcialmente la funcionalidad de Redis Stream. <br><a name="habracut"></a><br><h1>  Excursi√≥n hist√≥rica </h1><br><h4>  Redis pub / sub </h4><br>  Redis Pub / Sub es un sistema de mensajer√≠a simple ya integrado en su almacenamiento de valor clave.  Sin embargo, por simplicidad tienes que pagar: <br><br><ul><li>  Si el editor falla por alg√∫n motivo, pierde todos sus suscriptores </li><li>  El editor necesita saber la direcci√≥n exacta de todos sus suscriptores. </li><li>  Un editor puede sobrecargar a sus suscriptores si los datos se publican m√°s r√°pido de lo que se procesan. </li><li>  El mensaje se elimina del b√∫fer del editor inmediatamente despu√©s de la publicaci√≥n, independientemente de cu√°ntos suscriptores entreg√≥ y qu√© tan r√°pido lograron procesar este mensaje. </li><li>  Todos los suscriptores recibir√°n el mensaje al mismo tiempo.  Los suscriptores mismos deben de alguna manera ponerse de acuerdo sobre c√≥mo procesar el mismo mensaje. </li><li>  No existe un mecanismo integrado para confirmar el procesamiento exitoso de un mensaje por un suscriptor  Si el suscriptor recibi√≥ un mensaje y se cay√≥ durante el procesamiento, el editor no lo sabr√°. </li></ul><br><h4>  Lista de Redis </h4><br>  Redis List es una estructura de datos que admite comandos de lectura de bloqueo.  Puede agregar y leer mensajes desde el principio o el final de la lista.  Sobre la base de esta estructura, puede hacer una buena pila o cola para su sistema distribuido y esto en la mayor√≠a de los casos ser√° suficiente.  Las principales diferencias con Redis Pub / Sub: <br><br><ul><li>  El mensaje se entrega a un cliente.  El primer cliente bloqueado por lectura recibir√° primero los datos. </li><li>  Clint debe iniciar una operaci√≥n de lectura para cada mensaje.  List no sabe nada sobre clientes. </li><li>  Los mensajes se almacenan hasta que alguien los cuenta o los elimina expl√≠citamente.  Si configura un servidor Redis para vaciar datos al disco, entonces la confiabilidad del sistema aumenta dram√°ticamente. </li></ul><br><h1>  Introducci√≥n a Stream </h1><br><h4>  Agregar un registro a una secuencia </h4><br>  El comando <b>XADD</b> agrega un nuevo registro a la secuencia.  Un registro no es solo una cadena, consta de uno o m√°s pares clave-valor.  Por lo tanto, cada registro ya est√° estructurado y se asemeja a la estructura de un archivo CSV. <br><br><pre><code class="go hljs">&gt; XADD mystream * sensor-id <span class="hljs-number"><span class="hljs-number">1234</span></span> temperature <span class="hljs-number"><span class="hljs-number">19.8</span></span> <span class="hljs-number"><span class="hljs-number">1518951480106</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span></code> </pre> <br>  En el ejemplo anterior, agregamos dos campos a la secuencia con el nombre (clave) "mystream": "sensor-id" y "temperatura" con los valores "1234" y "19.8", respectivamente.  Como segundo argumento, el comando acepta el identificador que se asignar√° al registro; este identificador identifica de forma √∫nica cada registro en la secuencia.  Sin embargo, en este caso, pasamos * porque queremos que Redis genere un nuevo identificador para nosotros.  Cada nuevo identificador aumentar√°.  Por lo tanto, cada nuevo registro tendr√° un identificador m√°s grande en relaci√≥n con los registros anteriores. <br><br><h4>  Formato de identificaci√≥n </h4><br>  El identificador de registro devuelto por el comando <b>XADD</b> consta de dos partes: <br><br> <code>{millisecondsTime}-{sequenceNumber} <br></code> <br>  <i>millisecondsTime</i> : tiempo de Unix en milisegundos (tiempo del servidor Redis).  Sin embargo, si la hora actual es igual o menor que la hora del registro anterior, se utiliza la marca de tiempo del registro anterior.  Por lo tanto, si la hora del servidor se devuelve al pasado, el nuevo identificador conservar√° la propiedad de aumento. <br><br>  <i>SecuenciaN√∫mero se</i> utiliza para registros creados en el mismo milisegundo.  <i>El n√∫mero de secuencia</i> aumentar√° en 1 en relaci√≥n con el registro anterior.  Como el n√∫mero de <i>secuencia</i> tiene un tama√±o de 64 bits, en la pr√°ctica no debe encontrarse con un l√≠mite en el n√∫mero de registros que se pueden generar en un milisegundo. <br><br>  El formato de tales identificadores a primera vista puede parecer extra√±o.  Un lector incr√©dulo puede preguntarse por qu√© el tiempo es parte de un identificador.  La raz√≥n es que las transmisiones de Redis admiten solicitudes de rango por identificadores.  Dado que el identificador est√° asociado con la hora en que se cre√≥ el registro, esto permite solicitar rangos de tiempo.  Veremos un ejemplo concreto cuando pasemos al estudio del <b>comando XRANGE</b> . <br><br>  Si por alguna raz√≥n el usuario necesita especificar su propio identificador, que, por ejemplo, est√° asociado con alg√∫n sistema externo, entonces podemos pasarlo al <b>comando XADD en</b> lugar del signo * como se muestra a continuaci√≥n: <br><br><pre> <code class="go hljs">&gt; XADD somestream <span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span> field value <span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span> &gt; XADD somestream <span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span> foo bar <span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span></code> </pre><br>  Tenga en cuenta que, en este caso, debe controlar el aumento del identificador.  En nuestro ejemplo, el identificador m√≠nimo es "0-1", por lo que el equipo no aceptar√° otro identificador que sea igual o menor que "0-1". <br><br><pre> <code class="go hljs">&gt; XADD somestream <span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span> foo bar (error) ERR The ID specified in XADD is equal or smaller than the target stream top item</code> </pre><br><h4>  El n√∫mero de registros en la secuencia. </h4><br>  Puede obtener el n√∫mero de registros en una secuencia simplemente usando el comando <b>XLEN</b> .  Para nuestro ejemplo, este comando devolver√° el siguiente valor: <br><br><pre> <code class="go hljs">&gt; XLEN somestream (integer) <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre><br><h4>  Solicitudes de rango - XRANGE y XREVRANGE </h4><br>  Para solicitar datos para un rango, necesitamos especificar dos identificadores: el principio y el final del rango.  El rango devuelto incluir√° todos los elementos, incluidos los bordes.  Tambi√©n hay dos identificadores especiales "-" y "+", respectivamente, que significan el identificador m√°s peque√±o (primer registro) y el m√°s grande (√∫ltimo registro) en la secuencia.  El siguiente ejemplo mostrar√° todas las entradas de flujo. <br><br><pre> <code class="go hljs">&gt; XRANGE mystream - + <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1518951480106</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"sensor-id"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"1234"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"temperature"</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-string"><span class="hljs-string">"19.8"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1518951482479</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"sensor-id"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"9999"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"temperature"</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-string"><span class="hljs-string">"18.2"</span></span></code> </pre><br>  Cada registro devuelto es una matriz de dos elementos: un identificador y una lista de pares clave-valor.  Ya hemos dicho que los identificadores de registro est√°n relacionados con el tiempo.  Por lo tanto, podemos solicitar el rango de un per√≠odo de tiempo espec√≠fico.  Sin embargo, podemos especificar en la solicitud no el identificador completo, sino solo el tiempo Unix, omitiendo la parte relacionada con el n√∫mero de <i>secuencia</i> .  La parte omitida del identificador es autom√°ticamente igual a cero al comienzo del rango y al valor m√°ximo posible al final del rango.  El siguiente es un ejemplo de c√≥mo solicitar un rango de dos milisegundos. <br><br><pre> <code class="go hljs">&gt; XRANGE mystream <span class="hljs-number"><span class="hljs-number">1518951480106</span></span> <span class="hljs-number"><span class="hljs-number">1518951480107</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1518951480106</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"sensor-id"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"1234"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"temperature"</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-string"><span class="hljs-string">"19.8"</span></span></code> </pre><br>  Solo tenemos un registro en este rango, sin embargo, en conjuntos de datos reales, el resultado devuelto puede ser enorme.  Por este motivo, <b>XRANGE</b> admite la opci√≥n COUNT.  Al especificar la cantidad, simplemente podemos obtener los primeros N registros.  Si necesitamos obtener las siguientes N entradas (paginaci√≥n), podemos usar el √∫ltimo identificador recibido, aumentar su n√∫mero de <i>secuencia</i> en uno y solicitar nuevamente.  Veamos esto en el siguiente ejemplo.  Estamos comenzando a agregar 10 elementos usando <b>XADD</b> (supongamos que la secuencia mystream ya se ha llenado con 10 elementos).  Para comenzar la iteraci√≥n, obteniendo 2 elementos por comando, comenzamos con el rango completo, pero con COUNT igual a 2. <br><br><pre> <code class="go hljs">&gt; XRANGE mystream - + COUNT <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1519073278252</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"value_1"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1519073279157</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"value_2"</span></span></code> </pre><br>  Para continuar la iteraci√≥n con los dos elementos siguientes, debemos seleccionar el √∫ltimo identificador recibido, es decir, 1519073279157-0, y agregar 1 al n√∫mero de <i>secuencia</i> . <br>  El identificador resultante, en este caso 1519073279157-1, ahora se puede usar como un nuevo argumento para el comienzo del rango para la pr√≥xima llamada <b>XRANGE</b> : <br><br><pre> <code class="go hljs">&gt; XRANGE mystream <span class="hljs-number"><span class="hljs-number">1519073279157</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span> + COUNT <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1519073280281</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"value_3"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1519073281432</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"value_4"</span></span></code> </pre><br>  Y as√≠ sucesivamente.  Dado que la complejidad de <b>XRANGE</b> es O (log (N)) para buscar, y luego O (M) para devolver elementos M, cada paso de iteraci√≥n es r√°pido.  Por lo tanto, utilizando <b>XRANGE,</b> es posible <b>iterar</b> flujos de manera eficiente. <br><br>  El comando <b>XREVRANGE</b> es el equivalente de <b>XRANGE</b> , pero devuelve los elementos en el orden inverso: <br><br><pre> <code class="go hljs">&gt; XREVRANGE mystream + - COUNT <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1519073287312</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"value_10"</span></span></code> </pre><br>  Tenga en cuenta que el comando <b>XREVRANGE</b> toma los argumentos del rango de inicio y detenci√≥n en el orden inverso. <br><br><h4>  Lectura de nuevos registros con XREAD </h4><br>  A menudo hay una tarea para suscribirse a la transmisi√≥n y recibir solo mensajes nuevos.  Este concepto puede parecer Redis Pub / Sub o bloquear Redis List, pero existen diferencias fundamentales en c√≥mo usar Redis Stream: <br><br><ol><li>  Cada nuevo mensaje se entrega a cada suscriptor de forma predeterminada.  Este comportamiento es diferente de bloquear la Lista de Redis, donde solo un suscriptor leer√° un nuevo mensaje. </li><li>  Mientras que en Redis Pub / Sub todos los mensajes se olvidan y nunca se guardan, en Stream todos los mensajes se almacenan indefinidamente (a menos que el cliente solicite expl√≠citamente su eliminaci√≥n). </li><li>  Redis Stream le permite diferenciar el acceso a los mensajes dentro de una transmisi√≥n.  Un suscriptor espec√≠fico solo puede ver su historial de mensajes personales. </li></ol><br>  Puede suscribirse a la transmisi√≥n y recibir nuevos mensajes con el comando <b>XREAD</b> .  Esto es un poco m√°s complicado que <b>XRANGE</b> , por lo que comenzaremos con ejemplos m√°s simples primero. <br><br><pre> <code class="go hljs">&gt; XREAD COUNT <span class="hljs-number"><span class="hljs-number">2</span></span> STREAMS mystream <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"mystream"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1519073278252</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"value_1"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1519073279157</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"value_2"</span></span></code> </pre><br>  En el ejemplo anterior, se <b>especifica un</b> formulario <b>XREAD</b> sin bloqueo.  Tenga en cuenta que la opci√≥n COUNT es opcional.  De hecho, la √∫nica opci√≥n de comando requerida es la opci√≥n STREAMS, que establece la lista de secuencias junto con el identificador m√°ximo correspondiente.  Escribimos "STREAMS mystream 0": queremos obtener todos los registros de la secuencia mystream con un identificador mayor que "0-0".  Como puede ver en el ejemplo, el comando devuelve el nombre de la secuencia, porque podemos suscribirnos a varias secuencias al mismo tiempo.  Podr√≠amos escribir, por ejemplo, "STREAMS mystream otherstream 0 0".  Tenga en cuenta que despu√©s de la opci√≥n STREAMS, primero debemos proporcionar los nombres de todas las secuencias necesarias y solo luego una lista de identificadores. <br><br>  En esta forma simple, el comando no hace nada especial en comparaci√≥n con <b>XRANGE</b> .  Sin embargo, lo interesante es que podemos convertir f√°cilmente <b>XREAD</b> en un comando de bloqueo especificando el argumento BLOCK: <br><br> <code>&gt; XREAD BLOCK 0 STREAMS mystream $ <br></code> <br>  En el ejemplo anterior, se especifica una nueva opci√≥n BLOQUE con un tiempo de espera de 0 milisegundos (esto significa una espera sin fin).  Adem√°s, en lugar de pasar el identificador habitual para la secuencia de mystream, se pas√≥ el identificador especial $.  Este identificador especial significa que <b>XREAD</b> debe usar el identificador m√°ximo en el flujo de mystream como identificador.  Por lo tanto, solo recibiremos mensajes nuevos, desde el momento en que comenzamos a escuchar.  En cierto modo, esto es similar al comando Unix tail -f. <br><br>  Tenga en cuenta que al usar la opci√≥n BLOQUEO, no necesitamos usar el identificador especial $.  Podemos usar cualquier identificador existente en la secuencia.  Si el equipo puede atender nuestra solicitud de inmediato, sin bloqueo, lo har√°, de lo contrario se bloquear√°. <br><br>  Bloquear <b>XREAD</b> tambi√©n puede escuchar varias transmisiones a la vez, solo necesita especificar sus nombres.  En este caso, el comando devolver√° un registro de la primera secuencia a la que llegaron los datos.  El primer suscriptor bloqueado para esta transmisi√≥n recibir√° primero los datos. <br><br><h3>  Grupos de consumidores </h3><br>  En ciertas tareas, queremos diferenciar el acceso de los suscriptores a los mensajes dentro del mismo hilo.  Un ejemplo en el que esto puede ser √∫til es una cola de mensajes con trabajadores que recibir√°n diferentes mensajes de la transmisi√≥n, lo que le permite escalar el procesamiento de mensajes. <br><br>  Si imaginamos que tenemos tres suscriptores C1, C2, C3 y una secuencia que contiene los mensajes 1, 2, 3, 4, 5, 6, 7, entonces el servicio de mensajes ocurrir√° como en el siguiente diagrama: <br><br> <code>1 -&gt; C1 <br> 2 -&gt; C2 <br> 3 -&gt; C3 <br> 4 -&gt; C1 <br> 5 -&gt; C2 <br> 6 -&gt; C3 <br> 7 -&gt; C1 <br></code> <br>  Para obtener este efecto, Redis Stream utiliza un concepto llamado Grupo de consumidores.  Este concepto es similar a un pseudo-suscriptor que recibe datos de una secuencia, pero en realidad es atendido por varios suscriptores dentro de un grupo, proporcionando ciertas garant√≠as: <br><br><ol><li>  Cada mensaje se entrega a diferentes suscriptores dentro del grupo. </li><li>  Dentro de un grupo, los suscriptores se identifican por su nombre, que es una cadena que distingue entre may√∫sculas y min√∫sculas.  Si alg√∫n suscriptor abandona temporalmente el grupo, puede ser restaurado al grupo con su propio nombre √∫nico. </li><li>  Cada grupo de consumidores sigue el concepto de "primer mensaje no le√≠do".  Cuando un suscriptor solicita nuevos mensajes, solo puede recibir mensajes que nunca se han entregado a ning√∫n suscriptor dentro de un grupo. </li><li>  Hay un comando para confirmar expl√≠citamente el procesamiento exitoso del mensaje por parte del suscriptor.  Hasta que se llame a este comando, el mensaje solicitado permanecer√° en el estado "pendiente". </li><li>  Dentro del Grupo de consumidores, cada suscriptor puede solicitar un historial de mensajes que le fueron entregados, pero que a√∫n no se han procesado (en el estado "pendiente") </li></ol><br>  En cierto sentido, el estado de un grupo se puede representar de la siguiente manera: <br><br><pre> <code class="go hljs">+----------------------------------------+ | consumer_group_name: mygroup | consumer_group_stream: somekey | last_delivered_id: <span class="hljs-number"><span class="hljs-number">1292309234234</span></span><span class="hljs-number"><span class="hljs-number">-92</span></span> | | consumers: | <span class="hljs-string"><span class="hljs-string">"consumer-1"</span></span> with pending messages | <span class="hljs-number"><span class="hljs-number">1292309234234</span></span><span class="hljs-number"><span class="hljs-number">-4</span></span> | <span class="hljs-number"><span class="hljs-number">1292309234232</span></span><span class="hljs-number"><span class="hljs-number">-8</span></span> | <span class="hljs-string"><span class="hljs-string">"consumer-42"</span></span> with pending messages | ... (and so forth) +----------------------------------------+</code> </pre><br>  Ahora es el momento de familiarizarse con los principales equipos del Grupo de consumidores, a saber: <br><br><ul><li>  <b>XGROUP se</b> usa para crear, destruir y administrar grupos. </li><li>  <b>XREADGROUP se</b> usa para leer una secuencia a trav√©s de un grupo. </li><li>  <b>XACK</b> : este comando permite al suscriptor marcar el mensaje como procesado con √©xito </li></ul><br><h4>  Creaci√≥n de grupo de consumidores </h4><br>  Supongamos que ya existe una secuencia de mystream.  Entonces el comando de creaci√≥n de grupo se ver√° as√≠: <br><br> <code>&gt; XGROUP CREATE mystream mygroup $ <br> OK <br></code> <br>  Al crear un grupo, debemos pasar un identificador a partir del cual el grupo recibir√° los mensajes.  Si solo queremos recibir todos los mensajes nuevos, entonces podemos usar el identificador especial $ (como en nuestro ejemplo anterior).  Si especifica 0 en lugar de un identificador especial, todos los mensajes de la transmisi√≥n estar√°n disponibles para el grupo. <br><br>  Ahora que el grupo est√° creado, podemos comenzar a leer mensajes de inmediato usando el <b>comando XREADGROUP</b> .  Este comando es muy similar a <b>XREAD</b> y admite la opci√≥n BLOQUE opcional.  Sin embargo, existe una opci√≥n de GRUPO obligatoria, que siempre debe especificarse con dos argumentos: el nombre del grupo y el nombre del suscriptor.  La opci√≥n COUNT tambi√©n es compatible. <br><br>  Antes de leer la transmisi√≥n, pongamos algunos mensajes all√≠: <br><br><pre> <code class="go hljs">&gt; XADD mystream * message apple <span class="hljs-number"><span class="hljs-number">1526569495631</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> &gt; XADD mystream * message orange <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> &gt; XADD mystream * message strawberry <span class="hljs-number"><span class="hljs-number">1526569506935</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> &gt; XADD mystream * message apricot <span class="hljs-number"><span class="hljs-number">1526569535168</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> &gt; XADD mystream * message banana <span class="hljs-number"><span class="hljs-number">1526569544280</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span></code> </pre><br>  Ahora intentemos leer esta secuencia a trav√©s del grupo: <br><br><pre> <code class="go hljs">&gt; XREADGROUP GROUP mygroup Alice COUNT <span class="hljs-number"><span class="hljs-number">1</span></span> STREAMS mystream &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"mystream"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569495631</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"message"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"apple"</span></span></code> </pre><br>  El comando anterior literalmente dice lo siguiente: <br><br>  "Yo, el suscriptor de Alice, miembro de mygroup, quiero leer un mensaje de mystream que nunca antes se hab√≠a entregado a nadie". <br><br>  Cada vez que un suscriptor realiza una operaci√≥n con un grupo, debe indicar su nombre, identific√°ndose √∫nicamente dentro del grupo.  Hay otro detalle muy importante en el comando anterior: el identificador especial "&gt;".  Este identificador especial filtra los mensajes, dejando solo aquellos que hasta ahora nunca se han entregado. <br><br>  Adem√°s, en casos especiales, puede especificar un identificador real, como 0 o cualquier otro identificador v√°lido.  En este caso, el comando <b>XREADGROUP</b> le devolver√° el historial de mensajes con el estado "pendiente", que se entregaron al suscriptor especificado (Alice), pero que a√∫n no se han confirmado con el <b>comando XACK</b> . <br><br>  Podemos verificar este comportamiento especificando inmediatamente el identificador 0, sin la opci√≥n <b>COUNT</b> .  Solo vemos el √∫nico mensaje pendiente, es decir, el mensaje con la manzana: <br><br><pre> <code class="go hljs">&gt; XREADGROUP GROUP mygroup Alice STREAMS mystream <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"mystream"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569495631</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"message"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"apple"</span></span></code> </pre><br>  Sin embargo, si confirmamos que el mensaje se proces√≥ correctamente, ya no se mostrar√°: <br><br><pre> <code class="go hljs">&gt; XACK mystream mygroup <span class="hljs-number"><span class="hljs-number">1526569495631</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> (integer) <span class="hljs-number"><span class="hljs-number">1</span></span> &gt; XREADGROUP GROUP mygroup Alice STREAMS mystream <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"mystream"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) (empty list or set)</code> </pre><br>  Ahora le toca a Bob leer algo: <br><br><pre> <code class="go hljs">&gt; XREADGROUP GROUP mygroup Bob COUNT <span class="hljs-number"><span class="hljs-number">2</span></span> STREAMS mystream &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"mystream"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"message"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"orange"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569506935</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"message"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"strawberry"</span></span></code> </pre><br>  Bob, miembro de mygroup, solicit√≥ no m√°s de dos mensajes.  El comando informa solo mensajes no entregados debido al identificador especial "&gt;".  Como puede ver, el mensaje "manzana" no se muestra, ya que ya se entreg√≥ a Alice, por lo que Bob recibe "naranja" y "fresa". <br><br>  Por lo tanto, Alice, Bob y cualquier otro suscriptor del grupo pueden leer diferentes mensajes de la misma secuencia.  Tambi√©n pueden leer su historial de mensajes sin procesar o marcar los mensajes como procesados. <br><br>  Hay algunas cosas a tener en cuenta: <br><br><ul><li>  Tan pronto como el suscriptor considera que el mensaje es el comando <b>XREADGROUP</b> , este mensaje pasa al estado "pendiente" y se asigna a este suscriptor en particular.  Otros suscriptores del grupo no podr√°n leer este mensaje. </li><li>  Los suscriptores se crean autom√°ticamente en la primera menci√≥n, no hay necesidad de su creaci√≥n expl√≠cita. </li><li>  Con <b>XREADGROUP</b> puede leer mensajes de varias secuencias diferentes al mismo tiempo, sin embargo, para que esto funcione, primero debe crear grupos con el mismo nombre para cada secuencia usando <b>XGROUP</b> </li></ul><br><h4>  Crash Recovery </h4><br>  El suscriptor puede recuperarse de la falla y volver a leer su lista de mensajes con el estado de "pendiente".  Sin embargo, en el mundo real, los suscriptores pueden finalmente fallar.  ¬øQu√© sucede con el mensaje colgante de un suscriptor si no puede recuperarse despu√©s de una falla? <br>  Consumer Group ofrece una funci√≥n que se usa espec√≠ficamente para tales casos, cuando necesita cambiar el propietario de los mensajes. <br><br>  En primer lugar, debe llamar al comando <b>XPENDING</b> , que muestra todos los mensajes del grupo con el estado "pendiente".  En su forma m√°s simple, se llama a un comando con solo dos argumentos: el nombre de la secuencia y el nombre del grupo: <br><br><pre> <code class="go hljs">&gt; XPENDING mystream mygroup <span class="hljs-number"><span class="hljs-number">1</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-number"><span class="hljs-number">1526569506935</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"Bob"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"2"</span></span></code> </pre><br>  El equipo imprimi√≥ la cantidad de mensajes no procesados ‚Äã‚Äãpara todo el grupo y para cada suscriptor.  Solo tenemos a Bob con dos mensajes sin procesar, porque el √∫nico mensaje solicitado por Alice fue confirmado con <b>XACK</b> . <br><br>  Podemos solicitar informaci√≥n adicional utilizando m√°s argumentos: <br><br> <code>XPENDING {key} {groupname} [{start-id} {end-id} {count} [{consumer-name}]] <br></code> <br>  {start-id} {end-id} - rango de identificadores (puede usar "-" y "+") <br>  {count} - el n√∫mero de intentos de entrega <br>  {nombre-consumidor} - nombre del grupo <br><br><pre> <code class="go hljs">&gt; XPENDING mystream mygroup - + <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"Bob"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">74170458</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569506935</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"Bob"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">74170458</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  Ahora tenemos los detalles de cada mensaje: identificador, nombre del suscriptor, tiempo de inactividad en milisegundos y, finalmente, el n√∫mero de intentos de entrega.  Tenemos dos mensajes de Bob, y est√°n inactivos durante 74170458 milisegundos, aproximadamente 20 horas. <br><br>  Tenga en cuenta que nadie nos impide comprobar cu√°l era el contenido del mensaje simplemente usando <b>XRANGE</b> . <br><br><pre> <code class="go hljs">&gt; XRANGE mystream <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"message"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"orange"</span></span></code> </pre><br>  Solo tenemos que repetir el mismo identificador dos veces en los argumentos.  Ahora que tenemos alguna idea, Alice puede decidir que Bob probablemente no se recuperar√° despu√©s de 20 horas de inactividad, y es hora de solicitar estos mensajes y continuar proces√°ndolos en lugar de Bob.  Para hacer esto, usamos el comando <b>XCLAIM</b> : <br><br> <code>XCLAIM {key} {group} {consumer} {min-idle-time} {ID-1} {ID-2} ... {ID-N} <br></code> <br>  Con este comando, podemos obtener un mensaje "extra√±o" que a√∫n no se ha procesado cambiando el propietario a {consumidor}.  Sin embargo, tambi√©n podemos proporcionar un tiempo de inactividad m√≠nimo {min-idle-time}.  Esto ayuda a evitar una situaci√≥n en la que dos clientes intentan cambiar simult√°neamente el propietario de los mismos mensajes: <br><br> <code>Client 1: XCLAIM mystream mygroup Alice 3600000 1526569498055-0 <br> Clinet 2: XCLAIM mystream mygroup Lora 3600000 1526569498055-0 <br></code> <br>  El primer cliente restablecer√° el tiempo de inactividad y aumentar√° el contador del n√∫mero de entregas.  Entonces el segundo cliente no podr√° solicitarlo. <br><br><pre> <code class="go hljs">&gt; XCLAIM mystream mygroup Alice <span class="hljs-number"><span class="hljs-number">3600000</span></span> <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"message"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"orange"</span></span></code> </pre><br>  El mensaje fue reclamado con √©xito por Alice, quien ahora puede procesar el mensaje y reconocerlo. <br><br>  Del ejemplo anterior, est√° claro que la ejecuci√≥n exitosa de la solicitud devuelve el contenido del mensaje en s√≠.  Sin embargo, esto no es necesario.  La opci√≥n JUSTID puede usarse para devolver solo identificadores de mensaje.  Esto es √∫til si no est√° interesado en los detalles del mensaje y desea aumentar el rendimiento del sistema. <br><br><h3>  Mostrador de entrega </h3><br>  El contador que observa en la salida <b>XPENDING</b> es el n√∫mero de entregas de cada mensaje.  Dicho contador se incrementa de dos maneras: cuando el mensaje se solicita con √©xito a trav√©s de <b>XCLAIM</b> o cuando se <b>usa la</b> llamada <b>XREADGROUP</b> . <br><br>  Es normal que algunos mensajes se entreguen varias veces.  Lo principal es que, como resultado, se procesan todos los mensajes.  A veces, al procesar un mensaje, hay problemas debido a da√±os en el mensaje en s√≠ o al procesar el mensaje se produce un error en el c√≥digo del controlador.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En este caso, puede resultar que nadie pueda procesar este mensaje. </font><font style="vertical-align: inherit;">Como tenemos un contador de intentos de entrega, podemos usar este contador para detectar tales situaciones. </font><font style="vertical-align: inherit;">Por lo tanto, tan pronto como el contador de entrega alcance un gran n√∫mero especificado por usted, probablemente sea m√°s razonable colocar dicho mensaje en otra secuencia y enviar una notificaci√≥n al administrador del sistema.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Estado del hilo </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El comando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XINFO se</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utiliza para solicitar diversa informaci√≥n sobre una secuencia y sus grupos. </font><font style="vertical-align: inherit;">Por ejemplo, la forma b√°sica del comando es la siguiente:</font></font><br><br><pre> <code class="go hljs">&gt; XINFO STREAM mystream <span class="hljs-number"><span class="hljs-number">1</span></span>) length <span class="hljs-number"><span class="hljs-number">2</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) radix-tree-keys <span class="hljs-number"><span class="hljs-number">4</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) radix-tree-nodes <span class="hljs-number"><span class="hljs-number">6</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>) groups <span class="hljs-number"><span class="hljs-number">8</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span>) first-entry <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1524494395530</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"1"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"b"</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-string"><span class="hljs-string">"2"</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>) last-entry <span class="hljs-number"><span class="hljs-number">12</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569544280</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"message"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"banana"</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El comando anterior muestra informaci√≥n general sobre la secuencia especificada. </font><font style="vertical-align: inherit;">Ahora un ejemplo un poco m√°s complejo:</font></font><br><br><pre> <code class="go hljs">&gt; XINFO GROUPS mystream <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) name <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"mygroup"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) consumers <span class="hljs-number"><span class="hljs-number">4</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) pending <span class="hljs-number"><span class="hljs-number">6</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) name <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"some-other-group"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) consumers <span class="hljs-number"><span class="hljs-number">4</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) pending <span class="hljs-number"><span class="hljs-number">6</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> El comando anterior muestra informaci√≥n general para todos los grupos de la secuencia especificada </font></font><br><br><pre> <code class="go hljs">&gt; XINFO CONSUMERS mystream mygroup <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) name <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"Alice"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) pending <span class="hljs-number"><span class="hljs-number">4</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) idle <span class="hljs-number"><span class="hljs-number">6</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">9104628</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) name <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"Bob"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) pending <span class="hljs-number"><span class="hljs-number">4</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) idle <span class="hljs-number"><span class="hljs-number">6</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">83841983</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El comando anterior muestra informaci√≥n sobre todos los suscriptores de la secuencia y el grupo especificados. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si olvida la sintaxis del comando, simplemente p√≥ngase en contacto con el comando para obtener ayuda:</font></font><br><br><pre> <code class="go hljs">&gt; XINFO HELP <span class="hljs-number"><span class="hljs-number">1</span></span>) XINFO {subcommand} arg arg ... arg. Subcommands are: <span class="hljs-number"><span class="hljs-number">2</span></span>) CONSUMERS {key} {groupname} -- Show consumer groups of group {groupname}. <span class="hljs-number"><span class="hljs-number">3</span></span>) GROUPS {key} -- Show the stream consumer groups. <span class="hljs-number"><span class="hljs-number">4</span></span>) STREAM {key} -- Show information about the stream. <span class="hljs-number"><span class="hljs-number">5</span></span>) HELP -- Print this help.</code> </pre><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L√≠mite de tama√±o de transmisi√≥n </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Muchas aplicaciones no desean recopilar datos en la transmisi√≥n para siempre. </font><font style="vertical-align: inherit;">A menudo es √∫til tener la cantidad m√°xima de mensajes en la transmisi√≥n. </font><font style="vertical-align: inherit;">En otros casos, es √∫til transferir todos los mensajes de la secuencia a otro almacenamiento persistente cuando se alcanza el tama√±o de secuencia especificado. </font><font style="vertical-align: inherit;">Puede limitar el tama√±o de la secuencia utilizando el par√°metro MAXLEN en el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comando XADD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="go hljs">&gt; XADD mystream MAXLEN <span class="hljs-number"><span class="hljs-number">2</span></span> * value <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1526654998691</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> &gt; XADD mystream MAXLEN <span class="hljs-number"><span class="hljs-number">2</span></span> * value <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1526654999635</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> &gt; XADD mystream MAXLEN <span class="hljs-number"><span class="hljs-number">2</span></span> * value <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">1526655000369</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> &gt; XLEN mystream (integer) <span class="hljs-number"><span class="hljs-number">2</span></span> &gt; XRANGE mystream - + <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526654999635</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"value"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"2"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526655000369</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"value"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"3"</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando se usa MAXLEN, los registros antiguos se eliminan autom√°ticamente cuando se alcanza la longitud especificada, por lo que la secuencia tiene un tama√±o constante. </font><font style="vertical-align: inherit;">Sin embargo, el recorte en este caso no ocurre de la manera m√°s productiva en la memoria de Redis. </font><font style="vertical-align: inherit;">La situaci√≥n se puede </font><font style="vertical-align: inherit;">mejorar de la </font><font style="vertical-align: inherit;">siguiente manera: el </font><font style="vertical-align: inherit;">argumento ~ en el ejemplo anterior significa que no necesitamos limitar la longitud de la secuencia a un valor espec√≠fico. </font><font style="vertical-align: inherit;">En nuestro ejemplo, este puede ser cualquier n√∫mero mayor o igual a 1000 (por ejemplo, 1000, 1010 o 1030). </font><font style="vertical-align: inherit;">Simplemente indicamos expl√≠citamente que queremos que nuestra transmisi√≥n almacene al menos 1000 registros. </font><font style="vertical-align: inherit;">Esto hace que trabajar con memoria sea mucho m√°s eficiente dentro de Redis. </font><font style="vertical-align: inherit;">Tambi√©n hay un comando </font><b><font style="vertical-align: inherit;">XTRIM</font></b><font style="vertical-align: inherit;"> separado </font><font style="vertical-align: inherit;">que hace lo mismo:</font></font><br><br> <code>XADD mystream MAXLEN ~ 1000 * ... entry fields here ... <br></code> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br> <code>&gt; XTRIM mystream MAXLEN 10 <br> <br> &gt; XTRIM mystream MAXLEN ~ 10 <br></code> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Almacenamiento persistente y replicaci√≥n </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redis Stream se replica asincr√≥nicamente en nodos esclavos y se guarda en archivos como AOF (instant√°nea de todos los datos) y RDB (registro de todas las operaciones de escritura). </font><font style="vertical-align: inherit;">La replicaci√≥n de estado de Grupos de consumidores tambi√©n es compatible. </font><font style="vertical-align: inherit;">Por lo tanto, si el mensaje est√° en el estado "pendiente" en el nodo maestro, entonces en los nodos esclavos este mensaje tendr√° el mismo estado.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eliminar elementos individuales de una secuencia </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para eliminar mensajes hay un comando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XDEL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> especial </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">El comando obtiene el nombre de la secuencia, seguido de los identificadores del mensaje que debe eliminarse:</font></font><br><br><pre> <code class="go hljs">&gt; XRANGE mystream - + COUNT <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526654999635</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"value"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"2"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526655000369</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"value"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"3"</span></span> &gt; XDEL mystream <span class="hljs-number"><span class="hljs-number">1526654999635</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> (integer) <span class="hljs-number"><span class="hljs-number">1</span></span> &gt; XRANGE mystream - + COUNT <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526655000369</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"value"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"3"</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Al usar este comando, debe tener en cuenta que, de hecho, la memoria no se liberar√° de inmediato. </font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Corrientes de longitud cero </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La diferencia entre las secuencias y otras estructuras de datos de Redis es que cuando otras estructuras de datos ya no tienen elementos dentro de s√≠ mismas, como efecto secundario, la estructura de datos se eliminar√° de la memoria. </font><font style="vertical-align: inherit;">Entonces, por ejemplo, el conjunto ordenado se eliminar√° por completo cuando la llamada ZREM elimine el √∫ltimo elemento. </font><font style="vertical-align: inherit;">En cambio, se permite que los hilos permanezcan en la memoria sin siquiera tener un solo elemento adentro.</font></font><br><br><h4>  Conclusi√≥n </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redis Stream es ideal para crear corredores de mensajes, colas de mensajes, registros unificados y sistemas de chat que almacenan el historial. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nicklaus Wirth</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dijo una vez </font><font style="vertical-align: inherit;">, los programas son algoritmos m√°s estructuras de datos, y Redis ya te ofrece ambos.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/456270/">https://habr.com/ru/post/456270/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../456258/index.html">Gratis como viento y gratis como cerveza traducci√≥n de "Gratis como en libertad" al ruso bajo la licencia GNU FDL 1.3</a></li>
<li><a href="../456260/index.html">Charla de econom√≠a justa</a></li>
<li><a href="../456262/index.html">Radio definida por software: ¬øc√≥mo funciona? Parte 9</a></li>
<li><a href="../456264/index.html">Cree archivos binarios de Android con c√≥digo fuente y NDK de Android. Bombeamos la utilidad screencap</a></li>
<li><a href="../456266/index.html">El resumen de materiales interesantes para el desarrollador m√≥vil # 302 (del 10 al 16 de junio)</a></li>
<li><a href="../456272/index.html">¬øQu√© es Android Lint y c√≥mo te ayuda a escribir c√≥digo compatible?</a></li>
<li><a href="../456274/index.html">Psic√≥logos: los robots sexuales conducir√°n a un aumento en el n√∫mero de personas sin pareja que no necesitan relaciones con otras personas</a></li>
<li><a href="../456276/index.html">¬øQu√© es la informaci√≥n?</a></li>
<li><a href="../456280/index.html">Comenzar con stm32 o no repetir mis errores</a></li>
<li><a href="../456282/index.html">Gr√°ficos multidimensionales en Python: de tridimensional a seis dimensional</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>