<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😳 👩🏾‍🎤 🚋 使用microconfig.io轻松管理微服务配置 👩🏾‍💻 🎨 🧑🏾‍🤝‍🧑🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="微服务开发和后续操作中的主要问题之一是对其实例的能力和准确的调整。 我认为，新的microconfig.io框架可以提供帮助。 它使您可以优雅地解决一些设置应用程序的例行任务。 

 如果您有很多微服务，并且每个微服务都带有自己的文件/设置文件，那么它们中的一个可能会出错，而如果没有适当的灵活性和日...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>使用microconfig.io轻松管理微服务配置</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473078/"> 微服务开发和后续操作中的主要问题之一是对其实例的能力和准确的调整。 我认为，新的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">microconfig.io</a>框架可以提供帮助。 它使您可以优雅地解决一些设置应用程序的例行任务。 <br><a name="habracut"></a><br> 如果您有很多微服务，并且每个微服务都带有自己的文件/设置文件，那么它们中的一个可能会出错，而如果没有适当的灵活性和日志记录系统，则可能很难捕获。 框架自行设置的主要任务是最小化重复的实例设置，从而减少添加错误的可能性。 <br><br> 让我们来看一个例子。 假设有一个带有<b>yaml</b>配置<b>文件</b>的简单应用程序。 它可以是任何语言的任何微服务。 让我们看看如何将框架应用于此服务。 <br><br> 但是首先，为了方便起见，我们将在Idea IDE中创建一个空项目，方法是先在其中安装microconfig.io插件： <br><br><img src="https://habrastorage.org/webt/zp/db/uc/zpdbuckv5ezy0gbc5mcikpywfdm.png" alt="图片"><br><br> 我们配置了插件启动配置，您可以使用默认配置，如上面的屏幕截图所示。 <br><br> 我们的服务称为订单，然后在一个新项目中，我们将创建一个类似的结构： <br><br><img src="https://habrastorage.org/webt/jl/an/x5/jlanx519xbvcfj7gje6jdy8emfa.png"><br><br> 在带有服务名称的文件夹中，我们放置了配置文件<b>application.yaml</b> 。 所有微服务都是在某种环境中启动的，因此，除了创建服务本身的配置之外，还必须描述环境本身：为此，创建<b>envs</b>文件夹并向其中添加一个具有我们工作环境名称的文件。 因此，该框架将在<b>开发</b>环境中为服务创建配置文件，因为此参数是在插件的设置中设置的。 <br><br>  <b>dev.yaml</b>文件的结构将非常简单： <br><br><pre><code class="plaintext hljs">mainorder: components: - order</code> </pre> <br> 该框架适用于分组在一起的配置。 对于我们的服务，请为主要<b>订单</b>组选择一个名称。 框架在环境文件中找到每个这样的应用程序组，并为在相应文件夹中找到的所有应用程序创建配置。 <br><br> 在<b>订购</b>服务设置文件本身中，到目前为止，我们仅指示一个参数： <br><br><pre> <code class="plaintext hljs">spring.application.name: order</code> </pre> <br> 现在运行插件，它将根据属性中指定的路径为我们生成所需的服务配置： <br><br><img src="https://habrastorage.org/webt/ba/2s/uq/ba2suqlkzmxnzxisilo5wdu8ebs.png"><br><br> 您只需安装框架的分发工具包并从命令行运行它，而无需安装插件。 <br> 该解决方案适合在构建服务器上使用。 <br><br> 值得注意的是，该框架完全理解了<b>属性</b>语法，即可以在<b>yaml</b>配置中一起使用的普通属性文件。 <br><br> 再增加一项<b>支付</b>服务，同时使现有服务复杂化。 <br>  <b>按顺序</b> ： <br><br><pre> <code class="plaintext hljs">eureka: instance.preferIpAddress: true client: serviceUrl: defaultZone: http://192.89.89.111:6782/eureka/ server.port: 9999 spring.application.name: order db.url: 192.168.0.100</code> </pre> <br>  <b>付款方式</b> ： <br><br><pre> <code class="plaintext hljs">eureka: instance.preferIpAddress: true client: serviceUrl: defaultZone: http://192.89.89.111:6782/eureka/ server.port: 9998 spring.application.name: payments db.url: 192.168.0.100</code> </pre> <br> 这些配置的主要问题是服务设置中存在大量复制粘贴。 让我们看看该框架如何帮助摆脱它。 让我们从最显而易见的开始-每个微服务的描述中都存在<b>eureka</b>配置。 使用设置文件创建一个新目录，并向其中添加新配置： <br><br><img src="https://habrastorage.org/webt/bv/41/qz/bv41qzovbxaeodybgaxlpy7em4k.png"><br><br> 在我们的每个项目中，我们现在将添加行<i>#include eureka</i> 。 <br><br> 该框架将自动找到eureka配置并将其复制到服务配置文件，而不会创建单独的eureka配置，因为我们不会在<b>dev.yaml</b>环境<b>文件中</b>指定它。 服务<b>订单</b> ： <br><br><pre> <code class="1c hljs"><span class="hljs-meta"><span class="hljs-meta">#include eureka server.port: 9999 spring.application.name: order db.url: 192.168.0.100</span></span></code> </pre> <br> 通过将导入行更改为<i>#include eureka，oracle，</i>我们还可以在单​​独的配置中进行数据库设置。 <br><br> 值得注意的是，在框架配置文件的重新生成过程中，每次更改都会由框架监视，并放置在主配置文件旁边的特殊文件中。 他的日志中的条目如下所示：“存储的1属性更改为<b>order / diff-application.yaml</b> ”。 这使您可以快速检测大型配置文件中的更改。 <br><br> 删除配置的公共部分将使您摆脱许多不必要的复制粘贴，但又不允许您灵活地为各种环境创建配置-我们服务的端点是唯一的且经过硬编码，这很不好。 让我们尝试将其删除。 <br><br> 一个好的解决方案是将所有端点保持在其他端点可以引用的一种配置中。 为此，已将对占位符的支持引入了框架。 这是<b>eureka</b>配置文件的更改方式： <br><br><pre> <code class="plaintext hljs"> client: serviceUrl: defaultZone: http://${endpoints@eurekaip}:6782/eureka/</code> </pre> <br> 现在让我们看看这个占位符是如何工作的。 系统找到一个名为<b>终结点</b>的组件，并在其中寻找<b>eurekaip</b> ，然后将其替换为我们的配置。 但是不同的环境呢？ 为此，请<b>在</b>以下类型<b>application.dev.yaml的</b> <b>端点中</b>创建设置文件。 该框架通过文件扩展名独立地决定此配置所属的环境并加载该环境： <br><br><img src="https://habrastorage.org/webt/-l/pv/ru/-lpvruiphufubb2m-bihizph78m.png"><br><br> 开发文件的内容： <br><br><pre> <code class="plaintext hljs">eurekaip: 192.89.89.111 dbip: 192.168.0.100</code> </pre> <br> 我们可以为我们的服务端口创建相同的配置： <br><br><pre> <code class="plaintext hljs">server.port: ${ports@order}.</code> </pre> <br> 所有重要的设置都在一个位置，从而减少了由于配置文件中分散的参数而导致错误的可能性。 <br><br> 该框架提供了许多现成的占位符，例如，您可以获取配置文件所在的目录的名称并为其分配： <br><br><pre> <code class="1c hljs"><span class="hljs-meta"><span class="hljs-meta">#include eureka, oracle server.port: ${ports@order} spring.application.name: ${this@name}</span></span></code> </pre> <br> 因此，无需在配置中另外指定应用程序的名称，并且还可以将其移动到公共模块，例如，移至同一eureka： <br><br><pre> <code class="plaintext hljs">client: serviceUrl: defaultZone: http://${endpoints@eurekaip}:6782/eureka/ spring.application.name: ${this@name}</code> </pre> <br>  <b>订单</b>配置文件将减少为一行： <br><br><pre> <code class="1c hljs"><span class="hljs-meta"><span class="hljs-meta">#include eureka, oracle server.port: ${ports@order}</span></span></code> </pre> <br> 如果我们不需要父配置的任何设置，则可以在我们的配置中指定它，并将在生成过程中应用它。 也就是说，如果由于某种原因我们需要订购服务的唯一名称，只需保留<b>spring.application.name</b>参数即可。 <br><br> 假设您需要向服务添加自定义日志记录设置，这些设置存储在单独的文件中，例如<b>logback.xml</b> 。 为它创建一个单独的设置组： <br><br><img src="https://habrastorage.org/webt/fs/gg/x7/fsggx7dxwx1hako1mysofzssgy0.png"><br><br> 在基本配置中，我们将使用@ConfigDir <b>占位符</b>指示所需位置的日志设置文件的框架： <br><br><pre> <code class="plaintext hljs">microconfig.template.logback.fromFile: ${logback@configDir}/logback.xml</code> </pre> <br> 在<b>logback.xml</b>文件中， <b>我们</b>配置标准附加程序，这些附加程序又可以包含占位符，框架将在生成配置时对其进行更改，例如： <br><br><pre> <code class="1c hljs">&lt;file&gt;logs/${this@name}.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>&lt;/file&gt;</code> </pre> <br> 在服务配置中添加<b>logback</b>导入，我们自动获取每个服务的配置日志记录： <br><br><pre> <code class="1c hljs"><span class="hljs-meta"><span class="hljs-meta">#include eureka, oracle, logback server.port: ${ports@order}</span></span></code> </pre> <br> 是时候更详细地了解所有可用的框架占位符了： <br><br>  <b>$ {this @ env}</b> -返回当前环境的名称。 <br>  <b>$ {... @名称}</b> -返回组件的名称。 <br>  <b>$ {... @ configDir}</b> -返回组件的config目录的完整路径。 <br>  <b>$ {... @ resultDir}</b> -返回组件目标目录的完整路径（接收的文件将放置在此目录中）。 <br>  <b>$ {this @ configRoot}</b> -返回配置存储根目录的完整路径。 <br><br> 系统还允许您获取环境变量，例如，java的路径： <br>  <b>$ {env @ JAVA_HOME}</b> <br> 或者，由于该框架是用<b>JAVA</b>编写的，因此我们可以使用类似于下面的结构来获取类似于调用<b>System :: getProperty的</b>系统变量： <br>  <b>${system@os.name}</b> <br> 值得一提的是对<b>Spring EL</b>扩展语言的支持。 在配置中，类似的表达式适用： <br><br><pre> <code class="1c hljs">connection.timeoutInMs: <span class="hljs-meta"><span class="hljs-meta">#{5 * 60 * 1000} datasource.maximum-pool-size: #{${this@datasource.minimum-pool-size} + 10}</span></span></code> </pre> <br> 并且您可以使用<b>#var</b>表达式在配置文件中使用局部变量： <br><br><pre> <code class="1c hljs"><span class="hljs-meta"><span class="hljs-meta">#var feedRoot: ${system@user.home}/feed folder: root: ${this@feedRoot} success: ${this@feedRoot}/archive error: ${this@feedRoot}/error</span></span></code> </pre> <br> 因此，该框架是用于微服务的精细和灵活配置的相当强大的工具。 该框架完美地执行了其主要任务-消除设置中的复制粘贴，合并设置，从而最大程度地减少可能的错误，同时使组合配置和针对不同环境的更改变得容易。 <br><br> 如果您对此框架感兴趣，建议您访问其官方页面并阅读完整的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文档</a> ，或在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>深入研究源代码。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN473078/">https://habr.com/ru/post/zh-CN473078/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN473064/index.html">巴达维亚的眼泪，汽车和大猩猩玻璃：关于某些类型的强化玻璃</a></li>
<li><a href="../zh-CN473066/index.html">象限树和碰撞识别</a></li>
<li><a href="../zh-CN473070/index.html">Redux-不需要！ 在React中替换为useContext和useReducer？</a></li>
<li><a href="../zh-CN473072/index.html">Gazpromneft如何为企业客户创建数字路径</a></li>
<li><a href="../zh-CN473074/index.html">什么是APS？为什么它没有“按照我们想要的方式制定生产计划……”</a></li>
<li><a href="../zh-CN473082/index.html">我们如何编写微服务以及为何不快速做微服务</a></li>
<li><a href="../zh-CN473084/index.html">“ Ivan”是一个聊天机器人专业。 或使用虚拟助手进行创造性实验</a></li>
<li><a href="../zh-CN473086/index.html">恶意软件如何利用Visual Basic逃避沙箱</a></li>
<li><a href="../zh-CN473088/index.html">来自地下土壤使用者的石油和黄金市场流动性神话</a></li>
<li><a href="../zh-CN473090/index.html">PocketBook 632和632 Aqua评测-带电子墨水的小型旗舰6英寸阅读器</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>