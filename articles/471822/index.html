<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üóûÔ∏è üí™üèæ üîÄ Primer contacto con Home Assistant ‚úåÔ∏è üè∑Ô∏è üë®üèø‚Äçüíº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Home Assistant es una aplicaci√≥n de c√≥digo abierto popular para organizar una casa inteligente. La primera experiencia del autor con Home Assistant se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Primer contacto con Home Assistant</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471822/"><img width="25%" align="right" src="https://habrastorage.org/webt/sj/wt/mu/sjwtmujve5xdbroiyxjiebxbc5o.png"><br>  Home Assistant es una aplicaci√≥n de c√≥digo abierto popular para organizar una casa inteligente.  La primera experiencia del autor con Home Assistant se basa en un intento de integrar una olla arrocera inteligente.  El autor intentar√° describir los principales componentes y caracter√≠sticas de esta aplicaci√≥n, que tuvo la oportunidad de conocer paso a paso.  El art√≠culo es de alguna manera una revisi√≥n, de alguna manera una gu√≠a para aquellos que desean comenzar a conocer a Home Assistant. <br><a name="habracut"></a><br>  Para aquellos que tienen poco tiempo libre, les aconsejo que se salten el dicho, el primer cap√≠tulo, y vayan directamente al segundo.  Solo necesita saber que trabajaremos con una olla arrocera china inteligente de Xiaomi. <br><br><h3>  Olla arrocera inteligente </h3> Una olla arrocera es obviamente una olla arrocera.  Wiki nos muestra vapores de arroz cer√°micos del Museo Brit√°nico que datan de 1250 a. C.  En 1945, Mitsubishi se convirti√≥ en la primera compa√±√≠a japonesa de ollas arroceras caseras.  Nuestro modelo, la arrocera de Xiaomi, puede cocinar no solo arroz.  ‚ÄúEste es un gran dispositivo para hacer no solo arroz, sino tambi√©n otros tipos de platos.  Puede cocinar sopas, pasteles y mucho m√°s ‚Äù, dice el anuncio.  Pero lo m√°s importante es la presencia de un m√≥dulo wi-fi, software con capacidades de automatizaci√≥n y m√°s de 200 recetas instaladas en software.  "El camino hacia una casa inteligente a trav√©s del est√≥mago es correcto", pens√≥ el autor, y decidi√≥. <br><br>  Xiaomi Rice Cooker, como corresponde a un dispositivo digital, es externamente muy atractivo, agrada con su forma redonda y minimalismo general.  Para configurarlo y usarlo, el fabricante ofrece la aplicaci√≥n Mi Home.  Despu√©s de registrar Mi cuenta, el programa encuentra f√°cilmente un nuevo dispositivo y usted lo registra en su red local.  La interfaz de la aplicaci√≥n no es la peor, proporciona herramientas b√°sicas de automatizaci√≥n y puede recibir notificaciones de los dispositivos.  Sin embargo, hay inconvenientes significativos.  No todos pueden estar contentos con enviar informaci√≥n al desarrollador sobre cada clic de usuario.  Y a menudo se encuentra una expresi√≥n desagradable en el color nacional.  En lugar de m√°s de 200 recetas, solo cuatro est√°n traducidas y disponibles en idiomas extranjeros.  El resto es exclusivamente para el pueblo chino.  Cuando su arrocera "inteligente" no puede cumplir con todos los deberes culinarios prometidos, entonces, se da cuenta, se pone triste.  Despu√©s de deambular por un tiempo en Internet, un autor triste se encontr√≥ con el pr√≥ximo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">proyecto</a> interesante (beneficios eternos para el autor).  Que result√≥ estar dedicado al desarrollo de un m√≥dulo para un determinado Asistente de inicio. <br><br><h3>  Asistente de hogar </h3>  Primero, alguna informaci√≥n general.  Como se nos dice en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la p√°gina de inicio de HA</a> , "Este es un software de c√≥digo abierto para la automatizaci√≥n del hogar inteligente que se centra en la gesti√≥n local y la privacidad.  Desarrollado por el trabajo de una comunidad abierta de entusiastas, es ideal para trabajar en una Raspberry Pi o servidor local ".  El proyecto tiene m√°s de cinco a√±os, usa python y una licencia Apache 2.0.  La versi√≥n de lanzamiento al momento de escribir estas l√≠neas es 0.99.3. <br><br>  HA utiliza m√≥dulos separados (integraciones o componentes) para administrar dispositivos.  Crear uno es bastante simple.  En el sitio puede encontrar un cat√°logo de los m√≥dulos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">principales</a> (aprobados y respaldados por la comunidad).  Entre su n√∫mero total (1485 piezas), hay completamente diferentes, los nombres amazon, google, xiaomi e incluso una vez que yandex figuran en el cat√°logo. <br>  Intentemos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">instalar</a> HA en un entorno virtual en el escritorio de Linux.  Necesitaremos python3 y el administrador de paquetes pip. <br><pre><code class="bash hljs">python3 -m venv homeassistant <span class="hljs-comment"><span class="hljs-comment">#    cd homeassistant source bin/activate #    python3 -m pip install homeassistant #  Home Assistant hass --open-ui #  Home Assistant</span></span></code> </pre> <br>  Despu√©s de eso, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GUI</a> HA estar√° disponible en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http: // localhost: 8123</a> .  Cuando inicie sesi√≥n por primera vez, deber√° crear una cuenta de usuario.  La interfaz web de HA es bastante voluminosa.  Un par de elementos importantes que vale la pena mencionar al principio son la pesta√±a Configuraci√≥n ‚Üí General, donde puede volver a cargar f√°cilmente los archivos de configuraci√≥n o el propio servidor.  Adem√°s de la p√°gina de informaci√≥n en la lista de herramientas para desarrolladores, donde puede ver los registros de errores. <br><br>  HA almacena todos los datos de usuario necesarios, en el caso de Linux, en la carpeta de configuraci√≥n "~ / .homeassistant".  Los archivos de configuraci√≥n est√°n escritos en formato <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">YAML</a> , y el principal es "configuration.yaml".  Combina los datos de m√≥dulos, automatizaci√≥n, etc.  La funci√≥n de importaci√≥n le permite dividir la configuraci√≥n en archivos separados organizados l√≥gicamente.  Los m√≥dulos se almacenan en subcarpetas "componentes" (integrados) y "componentes personalizados". <br><br>  Este conocimiento deber√≠a ser suficiente para que podamos instalar un nuevo m√≥dulo.  Copie la carpeta "xiaomi_cooker" de nuestro repositorio en nuestros "~ / .homeassistant / custom_components".  De acuerdo con la descripci√≥n, agregue la configuraci√≥n del m√≥dulo al archivo "configuration.yaml": <br><div class="spoiler">  <b class="spoiler_title">configuration.yaml</b> <div class="spoiler_text"><pre> <code class="bash hljs">xiaomi_cooker: <span class="hljs-comment"><span class="hljs-comment">#   name: 'Akari' #   host: 192.168.1.10 # IP   token: '4921def609273302248d040a24243a25' #   Xiaomi model: chunmi.cooker.normal2 #  </span></span></code> </pre> <br></div></div><br>  Listo  Despu√©s de reiniciar HA, aparecer√° una nueva entrada de m√≥dulo en la secci√≥n General ‚Üí Integraciones de la interfaz web. <br><br>  Cualquier m√≥dulo es un cierto conjunto de objetos (entidades) y servicios (servicios, en esencia, funciones).  Los objetos almacenan diversos datos recibidos de los dispositivos.  Por ejemplo, sensor.xiaomi_cooker_temperature es la temperatura de la olla arrocera, sun.sun es la posici√≥n del sol.  Los datos de un objeto se expresan mediante un valor b√°sico: estado (estado) y un conjunto arbitrario de atributos adicionales (atributos).  Los servicios se utilizan para transferir comandos y valores a los dispositivos.  Por ejemplo, xiaomi_cooker.start - el comando para iniciar la operaci√≥n de la olla arrocera, o homeassistant.check_config - la inicializaci√≥n de la b√∫squeda de errores en los archivos de configuraci√≥n de HA.  La lista de Herramientas para desarrolladores de la interfaz web contiene la secci√≥n Servicios, donde puede ver la lista de servicios disponibles y jugar con sus llamadas.  Cerca est√° la secci√≥n de Estados, donde, en consecuencia, puede ver y cambiar los valores de los objetos.  Cabe se√±alar que los cambios en los valores de los objetos en la secci√≥n de Estados son unilaterales.  Es decir  si, por ejemplo, cambia el estado del objeto lights.state aqu√≠ de apagado a encendido, esto no afectar√° el estado verdadero del dispositivo, y la pr√≥xima vez que se actualicen los datos del dispositivo, el valor del objeto se sobrescribir√° a real. <br><br><h3>  Automatizaci√≥n </h3>  La principal herramienta de administraci√≥n para un hogar inteligente es la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">automatizaci√≥n</a> .  Puede agregarlos y editarlos utilizando la interfaz gr√°fica en la secci√≥n General ‚Üí Automatizaci√≥n o directamente en el archivo "automations.yaml".  La funci√≥n principal de la automatizaci√≥n es llamar a los servicios cuando se cumplen ciertas condiciones.  Herramientas b√°sicas para establecer las condiciones para invocar el valor de los objetos, incl.  datos de tiempo.  Hay soluciones un poco m√°s espec√≠ficas, como los eventos.  Como un simple ejemplo de automatizaci√≥n, le daremos un c√≥digo que actualiza los datos de m√°s del autor con un per√≠odo de 15 minutos: <br><div class="spoiler">  <b class="spoiler_title">automations.yaml</b> <div class="spoiler_text"><pre> <code class="bash hljs"> - id: <span class="hljs-string"><span class="hljs-string">'1565889970818'</span></span> <span class="hljs-comment"><span class="hljs-comment"># ID  alias: Umpiro decharging #  trigger: #   - platform: time_pattern #   -  minutes: /15 #   (   ‚Äì    15 ) condition: [] #    action: #    - data: # ,     entity_id: sensor.umpiro_charge #  (: ) service: homeassistant.update_entity #   </span></span></code> </pre> <br></div></div><br>  Cabe se√±alar que hasta ahora no toda la automatizaci√≥n disponible (por ejemplo, la anterior) se puede configurar sin editar el c√≥digo yaml a trav√©s de la interfaz gr√°fica, pero los desarrolladores dicen que est√°n trabajando activamente para eliminar este inconveniente. <br><br><h3>  Templar </h3>  Despu√©s de la automatizaci√≥n, es hora de hablar sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">plantillas</a> (plantillas).  Varios elementos de configuraci√≥n en archivos yaml le permiten usar inserciones en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el lenguaje de script jinja2</a> .  Muchos de estos elementos est√°n unidos por el nombre com√∫n 'Plantillas', como service_template o trigger_template.  Mediante el uso de plantillas, tenemos acceso a los valores de los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">objetos en HA</a> y la capacidad de utilizar estos datos en expresiones matem√°ticas y l√≥gicas complejas, lo que ampl√≠a enormemente nuestro potencial.  Como ejemplo, tomemos un c√≥digo un poco m√°s complicado de sensor.umpiro_charge escrito en "configuration.yaml".  Este es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">template_sensor</a> , es decir, "un sensor que forma datos basados ‚Äã‚Äãen los valores de otros objetos".  Nuestro sensor ser√° un an√°logo de una bater√≠a descargada gradualmente: <br><div class="spoiler">  <b class="spoiler_title">configuration.yaml</b> <div class="spoiler_text"><pre> <code class="bash hljs">sensor: <span class="hljs-comment"><span class="hljs-comment">#   platform: template #   -  sensors: #   #   ‚Äì sensor.umpiro_charge umpiro_charge: #      UI () unit_of_measurement: '%' # ,    value_template: &gt;- #    ‚Äì   'int' # +     {% if states('sensor.umpiro_charge')|int('unknown') is number %} #       #         {% set value = (states('sensor.umpiro_charge')|int - (as_timestamp(now()) - as_timestamp(states.sensor.umpiro_charge.last_updated))/60/15)|round %} #       {{ [[0, value]|max, 100]|min }} {% else %} # ,  HA   #      {{ 'unknown' }} {% endif %} # ID  ,     #      entity_id: [] friendly_name: 'Charge' #   #      UI () device_class: battery</span></span></code> </pre><br></div></div><br>  Dejamos entidad_id vac√≠a porque ya hemos agregado automatizaci√≥n que causar√° independientemente la actualizaci√≥n de los datos del objeto. <br><br><h3>  Scripts de Python </h3>  A su vez, los scripts de Python son una herramienta simple para crear nuevos servicios.  Despu√©s de agregar la l√≠nea: "script de python:" a "configuration.yaml", todos los archivos con la extensi√≥n ".py" que colocamos en la carpeta "~ / .homeassistant / python_scripts" estar√°n disponibles como servicios con los nombres "python_scripts. &lt; nombre_archivo&gt; ".  Su c√≥digo se ejecuta en un entorno predefinido, donde las variables de datos y hass nos dan acceso a los argumentos de la llamada de servicio, as√≠ como a los objetos y servicios de HA.  Como ejemplo, le damos el c√≥digo del archivo "charge_set.py" para el servicio "python_scripts.charge_set".  Su funci√≥n ser√° establecer la carga de nuestra bater√≠a: <br><div class="spoiler">  <b class="spoiler_title">python_scripts / charge_set.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     name = data.get('name', 'sensor.umpiro_charge') #     new_state = data.get('charge', '100') #    attributes = hass.states.get(name).attributes #    hass.states.set(name, new_state, attributes)</span></span></code> </pre> <br></div></div><br><br><h3>  Creando integraci√≥n </h3>  Todo lo que hicimos con la ayuda de plantillas y scripts de Python, quiz√°s ser√≠a m√°s f√°cil hacerlo escribiendo un m√≥dulo separado.  Como ya se mencion√≥, los m√≥dulos no oficiales se almacenan en la carpeta "custom_components".  En el futuro, necesitaremos un objeto que almacene informaci√≥n sobre la receta actual de nuestra olla arrocera y un servicio que le permita cambiar esta informaci√≥n.  Basado en un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ejemplo de la documentaci√≥n,</a> crearemos un nuevo m√≥dulo para esto, "overmind".  El primer paso es el archivo custom_components / overmind / __ init__.py: <br><div class="spoiler">  <b class="spoiler_title">componentes_personalizados / overmind / __ init__.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     DOMAIN = 'overmind' #       () DEFAULT_RECIPE = { "title": "Habr post", "description": "Post an article on habr.com", "profile": "471822" } #    def setup(hass, config): #    hass.states.set('overmind.current_recipe', 'on', DEFAULT_RECIPE) #       def handle_set(call): #    recipe = call.data.get('recipe', DEFAULT_RECIPE) #   -    hass.states.set('overmind.current_recipe', 'set', recipe) #   hass.services.register(DOMAIN, 'recipe_set', handle_set) return True</span></span></code> </pre> <br></div></div><br>  Despu√©s de eso, informaremos el nuevo m√≥dulo al archivo de configuraci√≥n "configuration.yaml", agregando una l√≠nea con el nombre del m√≥dulo: "overmind:".  El problema est√° resuelto. <br><br><h3>  Lovelace ui </h3>  Este es el nombre del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">extremo frontal</a> utilizado HA.  Esta interfaz gr√°fica, a trav√©s de la cual se invita a un usuario com√∫n a controlar una casa inteligente, es la p√°gina principal de la interfaz web HA.  La interfaz LUI est√° formada por tarjetas de varios tipos, que pueden reflejar los valores de los objetos, servir para llamar funciones y otras tareas.  Las tarjetas se pueden distribuir en p√°ginas (ver), por analog√≠a con los marcadores del navegador.  La configuraci√≥n est√° convenientemente organizada a trav√©s de la misma interfaz gr√°fica, pero tambi√©n es accesible a trav√©s del c√≥digo yaml, para el cual tambi√©n hay un editor de texto incorporado.  Le recomiendo que mire la p√°gina <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://demo.home-assistant.io/</a> , donde hay varios ejemplos diferentes de configuraciones LUI, y donde puede verlos, hacer clic y modificarlos f√°cilmente. <br><br><img src="https://habrastorage.org/webt/64/bd/zf/64bdzfwclc_3sqnoek13735wgqq.png"><br>  <i><font color="grey">Ejemplo de configuraci√≥n de GUI</font></i> <br><br>  Hablando de las deficiencias de la interfaz, desafortunadamente, los propios desarrolladores admiten que el proyecto est√° tratando de sentarse simult√°neamente en las sillas del escritorio y el tel√©fono inteligente.  A LUI, por defecto, le gusta determinar de forma independiente la ubicaci√≥n y el tama√±o de las tarjetas, lo que a veces puede convertir una p√°gina que se ve normal en el monitor en un desastre en la pantalla del tel√©fono inteligente, y viceversa.  Existen algunas herramientas simples para simplificar la interfaz, pero, en mi experiencia, no siempre son efectivas. <br><br>  Creo que no tiene mucho sentido describir la creaci√≥n de una interfaz utilizando herramientas gr√°ficas, por lo que dar√© algunos ejemplos en forma del c√≥digo yaml que utilic√©.  Despu√©s de haber creado una p√°gina separada (vista) para nuestra olla arrocera, intentaremos llenarla con los elementos m√°s necesarios para que no cause rechazo al usar la pantalla del tel√©fono inteligente. <br><br>  Aqu√≠ probaremos esas herramientas de pedido de interfaz muy simples, estas son horizontal-stack y vertical-stack.  Primero, cree una pila vertical a partir de tarjetas de tipos entidad-bot√≥n y sensor.  El primero servir√° para lanzar nuestra olla arrocera, el segundo para mostrar la temperatura: <br><div class="spoiler">  <b class="spoiler_title">pila vertical</b> <div class="spoiler_text"><pre> <code class="bash hljs">cards: <span class="hljs-comment"><span class="hljs-comment">#    - type: entity-button #      entity: sensor.xiaomi_cooker_state # ,     icon: 'mdi:selection' #     icon_height: 100px #   name: Offline #    show_icon: true # show_name: true # tap_action: #    action: call-service #  ‚Äì   service: script.turn_on #  ‚Äì   service_data: #    entity_id: script.order_cooker_start #  ‚Äì   hold_action: #    action: none # - type: sensor #      entity: sensor.xiaomi_cooker_temperature # ,     name: Temper #   type: vertical-stack #   ‚Äì  </span></span></code> </pre> <br></div></div><br>  Home Assistant incluye un archivo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">iconos de dise√±o</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">materiales</a> que, a trav√©s de los nombres apropiados (por ejemplo, mdi: selection), se pueden usar en elementos de configuraci√≥n.  La secuencia de comandos (en este caso, no python-, sino yaml-), que sol√≠amos llamar al servicio, es otra herramienta HA conveniente. <br><br>  Ahora combine la pila vertical anterior con la tarjeta de retrato nuestra en la pila ahora horizontal.  Todo ser√° igual de simple: <br><div class="spoiler">  <b class="spoiler_title">pila horizontal</b> <div class="spoiler_text"><pre> <code class="bash hljs">ards: <span class="hljs-comment"><span class="hljs-comment">#    - type: picture #   image: /local/akari_r.jpg #    - #         type: horizontal-stack #   ‚Äì  </span></span></code> </pre> <br></div></div><br>  Aqu√≠ debe marcar la l√≠nea 'imagen:'.  Todos los archivos que ponemos en la carpeta '~ / .homeassistant / www' est√°n disponibles en el enlace <a href="">http: // localhost / local / filename</a> . <br><br>  El siguiente paso es trabajar un poco en el bot√≥n de llamada de servicio que creamos.  Ser√≠a conveniente para nosotros si funcionara como un interruptor de palanca, es decir  encendido / apagado, y no de la forma en que se hace ahora.  Esto se puede lograr mediante el uso de una tarjeta de tipo condicional, cuya visualizaci√≥n en la pantalla se puede ajustar mediante la configuraci√≥n de ciertas condiciones.  A continuaci√≥n se muestra el c√≥digo de la tarjeta, que es el bot√≥n para apagar la olla arrocera y solo es visible si la olla arrocera est√° en proceso de preparar el plato: <br><div class="spoiler">  <b class="spoiler_title">condicional</b> <div class="spoiler_text"><pre> <code class="bash hljs">card: <span class="hljs-comment"><span class="hljs-comment">#    entity: sensor.xiaomi_cooker_state # icon: 'mdi:star-box-outline' # icon_height: 100px # name: Running # tap_action: # action: call-service # service: xiaomi_cooker.stop # type: entity-button # conditions: #   # ,    entity: sensor.xiaomi_cooker_mode #  ,     state: Running type: conditional #  </span></span></code> </pre> <br></div></div><br>  Reescribiendo el c√≥digo del bot√≥n de encendido creado previamente de una manera similar, y combin√°ndolo con esto, obtenemos un bot√≥n que funciona tanto dentro como fuera. <br><br>  Complementamos nuestro inter√©s con otra tarjeta, con el tiempo hasta el final de la cocci√≥n (similar a la tarjeta de temperatura), y una m√°s con los detalles de la receta (personalizada: tarjeta de receta) mostrada.  Como resultado, obtenemos algo como esto: <br><div style="text-align:center;"><img width="50%" src="https://habrastorage.org/webt/k6/kv/zq/k6kvzqqugn8sizjtsemxyufquo8.jpeg"></div><br><h3>  Tarjetas personalizadas </h3>  Home Assistant, adem√°s de la riqueza del conjunto integrado de tipos de tarjeta, por supuesto, brinda la posibilidad de crear las suyas propias.  Dichas tarjetas se denominan tarjetas personalizadas y se usa javascript para crearlas.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Aqu√≠</a> hay dos ejemplos de c√≥digo simple.  Es f√°cil encontrar tarjetas preparadas creadas por varios <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">entusiastas en la</a> red, y si desea experimentar usted mismo, ser√° √∫til descubrir que hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">m√≥dulos js</a> especiales creados para simplificar el trabajo de escribir otras nuevas.  Mi experiencia con javascript contin√∫a queriendo menos, as√≠ que, como ejemplo, dar√© solo una peque√±a parte del c√≥digo de la tarjeta utilizada para seleccionar y mostrar la receta actual. <br><div class="spoiler">  <b class="spoiler_title">www /cipe-card.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     lit-element LitElement, html, css } from "https://unpkg.com/lit-element@latest/lit-element.js?module"; //      class RecipeCard extends LitElement { //     HA static get properties() { return { hass: {}, config: {} }; } //    callServiceEx() { this.hass.callService('persistent_notification', 'create', {message: 'example'}); } //  html-  render() { //    ,     const entityId = this.config.entity; //    const state = this.hass.states[entityId]; //    const titleStr = state ? state.attributes.title : 'unavailable'; const descrStr = state ? state.attributes.description : 'unavailable'; //    return html` &lt;ha-card&gt; &lt;div class="flex" style="margin-top:16px;"&gt; &lt;div class="icon"&gt; &lt;ha-icon icon="mdi:bowl"&gt;&lt;/ha-icon&gt; &lt;/div&gt; &lt;div class="header"&gt; &lt;span class="name"&gt;Recipe&lt;/span&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class="flex info" style="margin-bottom:16px;"&gt; &lt;span class="recipe-title"&gt;${titleStr}&lt;/span&gt; &lt;span class="recipe-descr"&gt;${descrStr}&lt;/span&gt; &lt;/div&gt; &lt;/ha-card&gt; `; } //     customElements.define('recipe-card', RecipeCard);</span></span></code> </pre> <br></div></div><br><br>  Para usar la nueva tarjeta, deber√° agregar el siguiente c√≥digo al comienzo del archivo de configuraci√≥n de LUI: <br><div class="spoiler">  <b class="spoiler_title">tarjeta de receta</b> <div class="spoiler_text"><pre> <code class="bash hljs">resources: <span class="hljs-comment"><span class="hljs-comment">#    - type: module #   ‚Äì  url: /local/recipe-card.js #  </span></span></code> </pre><br>  y entre la lista de tarjetas: <br><pre> <code class="bash hljs"> - <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: <span class="hljs-string"><span class="hljs-string">'custom:recipe-card'</span></span> <span class="hljs-comment"><span class="hljs-comment">#   entity: overmind.current_recipe # ,    </span></span></code> </pre><br><br></div></div><br><h3>  Notificaciones </h3>  Una parte necesaria de una casa inteligente es enviar mensajes al usuario.  En HA, estos mensajes se denominan notificaciones y hay dos tipos b√°sicos de notificaciones.  El primero son las notificaciones persistentes.  Para enviarlos, se utiliza el servicio integrado "persistent_notification.create".  Una lista de tales mensajes est√° disponible a trav√©s del √≠cono de la campana en la interfaz gr√°fica, usan marcas de descuento y son esencialmente bastante simples. <br><br>  Otra herramienta m√°s interesante es el m√≥dulo de notificaci√≥n incorporado, que a trav√©s de la instalaci√≥n de m√≥dulos adicionales le permite enviar mensajes utilizando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">plataformas de terceros</a> .  Como ejemplo, considere un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">m√≥dulo para telegrama</a> . <br><br>  Para usar el m√≥dulo, antes que nada, necesitaremos crear un bot en el telegrama mismo.  Al configurar, necesitamos el chat_id de nuestro usuario y la API del bot de token.  C√≥mo obtener estos datos: descritos en detalle en el enlace anterior, suponemos que estamos listos.  Pasando directamente a instalar el m√≥dulo, primero, como ya lo hicimos, copie su c√≥digo fuente en la carpeta de componentes y luego agregue su configuraci√≥n al archivo "configuration.yaml": <br><div class="spoiler">  <b class="spoiler_title">configuration.yaml</b> <div class="spoiler_text"><pre> <code class="bash hljs">telegram_bot: <span class="hljs-comment"><span class="hljs-comment">#   telegram platform: polling #   api_key: XXXXXXXXXXXXX # API Token   allowed_chat_ids: XXXXXXX # chat_id   proxy_url: socks5://XXXXXXXXXXXXX #     proxy_params: username: umpiro password: umpiro_password</span></span></code> </pre> <br>  m√°s configuraciones para el m√≥dulo de notificaci√≥n: <br><pre> <code class="bash hljs">notify: <span class="hljs-comment"><span class="hljs-comment">#   notify name: notify_send #   (   ‚Äì  notify.notify_send) platform: telegram #   chat_id: XXXXXXX # chat_id  </span></span></code> </pre> <br></div></div><br><br>  El m√≥dulo de telegramas nos permite enviar mensajes, fotos o videos.  Como ejemplo, crearemos automatizaci√≥n para enviar un mensaje con una imagen, notific√°ndonos el final de la cocci√≥n. <br><div class="spoiler">  <b class="spoiler_title">automations.yaml</b> <div class="spoiler_text"><pre> <code class="bash hljs"> - id: <span class="hljs-string"><span class="hljs-string">'1571074941908'</span></span> <span class="hljs-comment"><span class="hljs-comment"># ID  alias: EOC #   trigger: #    # ,   - entity_id: sensor.xiaomi_cooker_mode from: Running #    #   ‚Äì    platform: state to: Waiting #    condition: [] #   action: #    - service: notify.notify_send #  ‚Äì   data: # ,     title: End of Cooking #  message: "EOC" #  data: #    photo: #   -  #   - file: /home/umpiro/.homeassistant/www/cat.jpg #   caption: ‚ÄúEOC‚Äù</span></span></code> </pre> <br></div></div><br><br><h3>  Ep√≠logo </h3>  Home Assistant puede ser de inter√©s para aquellos que desean tratar de organizar la administraci√≥n local de un hogar inteligente.  Este es un proyecto amplio, interesante, abierto y de desarrollo activo debido a los esfuerzos de la comunidad.  La variedad de herramientas de Home Assistant no puede dejar de alegrarse (no tuve tiempo de mencionar algunas importantes).  Como punto negativo, se puede mencionar la relativa complejidad e incompletitud de la documentaci√≥n. <br>  PS <br>  Recientemente, el 10 de octubre, hubo, no s√© si esto puede llamarse lanzamiento, la transici√≥n del proyecto de la versi√≥n 0.99 a la versi√≥n 0.100. <br>  Cita de las notas de la versi√≥n: <br><blockquote>  ¬°Bienvenido a las notas de lanzamiento de otro lanzamiento maravilloso!  No, no vamos por 1.0, ¬°estamos haciendo 0.100!  Sentimos que a√∫n no estamos listos con nuestros objetivos para 1.0, pero estamos progresando todos los d√≠as.  Para obtener un adelanto de lo que estamos pensando, consulte nuestro blog <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Modo simple en Home Assistant 1.0.</a> </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/471822/">https://habr.com/ru/post/471822/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../471810/index.html">Compare las herramientas para auditar cambios en Active Directory: Quest Change Auditor y Netwrix Auditor</a></li>
<li><a href="../471812/index.html">Biblioteca Wolfram Engine gratuita para desarrolladores de software</a></li>
<li><a href="../471814/index.html">WolframClientForPython | Nueva biblioteca de cliente de Wolfram Language para Python</a></li>
<li><a href="../471816/index.html">C√≥mo firmar aplicaciones para macOS Catalina 10.15</a></li>
<li><a href="../471820/index.html">Estafadores telef√≥nicos. Paso tres, en el que obtengo documentaci√≥n de que mi celda bancaria ha sido creada</a></li>
<li><a href="../471824/index.html">C√°mara de disquete: 8 datos interesantes sobre Sony Mavica MVC-FD85 (muchas fotos)</a></li>
<li><a href="../471836/index.html">Visualizaci√≥n automatizada del c√≥digo de Python. Cuarta parte: soporte de documentaci√≥n</a></li>
<li><a href="../471838/index.html">Amor matem√°tico</a></li>
<li><a href="../471840/index.html">¬øPor qu√© ir a entrevistas?</a></li>
<li><a href="../471844/index.html">5 razones para visitar EPAM INSIDER en Kazajst√°n</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>