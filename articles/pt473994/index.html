<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💄 ✈️ 🏚️ Carregamento de script moderno 👩‍✈️ 🥓 👨‍👦‍👦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Passar o código certo para cada navegador não é tarefa fácil. 

 Neste artigo, consideraremos várias opções de como esse problema pode ser resolvido. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Carregamento de script moderno</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/raiffeisenbank/blog/473994/">  Passar o código certo para cada navegador não é tarefa fácil. <br><br>  Neste artigo, consideraremos várias opções de como esse problema pode ser resolvido. <br><br><img src="https://habrastorage.org/webt/4f/rs/cl/4frsclbbpc2v0pwpxqehbh3tj1w.png"><br><br>  A passagem de código moderno por um navegador moderno pode melhorar muito o desempenho.  Seus pacotes JavaScript poderão conter sintaxe moderna mais compacta ou otimizada e oferecer suporte a navegadores mais antigos. <br><br>  Entre as ferramentas para desenvolvedores, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">predomina o padrão módulo / nomodule de</a> carregamento declarativo de código moderno ou legado, que fornece fontes aos navegadores e permite que você decida quais usar: <br><br><pre><code class="javascript hljs">&lt;script type=<span class="hljs-string"><span class="hljs-string">"module"</span></span> src=<span class="hljs-string"><span class="hljs-string">"/modern.js"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;script nomodule src=<span class="hljs-string"><span class="hljs-string">"/legacy.js"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Infelizmente, nem tudo é tão simples.  A abordagem HTML mostrada acima aciona <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">uma recarga de script no Edge e Safari</a> . <a name="habracut"></a><br><br><h4>  O que pode ser feito? </h4><br>  Dependendo do navegador, precisamos oferecer uma das opções para scripts compilados, mas alguns navegadores antigos não suportam toda a sintaxe necessária para isso. <br><br>  Em primeiro lugar, existe o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Safari Fix</a> .  O Safari 10.1 suporta módulos JS, não o atributo <code>nomodule</code> nos scripts, o que permite executar o código moderno e o legado.  No entanto, o evento de <code>beforeload</code> não padrão suportado pelo Safari 10 e 11 pode ser usado para o preenchimento do <code>nomodule</code> . <br><br><h4><a name="first"></a>  Método 1: Download dinâmico </h4><br>  Você pode solucionar esses problemas implementando um pequeno carregador de scripts.  Semelhante à forma como o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">LoadCSS</a> funciona.  Em vez de esperar pela implementação dos módulos ES e do atributo <code>nomodule</code> nos <code>nomodule</code> , você pode tentar executar um script de módulo como um "teste com um teste decisivo" e, com base no resultado, optar por baixar um código moderno ou legado. <br><br><pre> <code class="javascript hljs">&lt;!-- use a <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> script to detect modern browsers: --&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"module"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="actionscript"><span class="xml"><span class="actionscript"> self.modern = </span></span><span class="hljs-literal"><span class="xml"><span class="actionscript"><span class="hljs-literal">true</span></span></span></span><span class="xml"><span class="actionscript"> </span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;!-- now use that flag to load modern VS legacy code: --&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="javascript"><span class="xml"><span class="javascript"> addEventListener(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">'load'</span></span></span></span><span class="xml"><span class="javascript">, </span></span><span class="hljs-function"><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">(</span></span></span><span class="hljs-params"></span><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span></span><span class="xml"><span class="javascript">{ </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">var</span></span></span></span><span class="xml"><span class="javascript"> s = </span></span><span class="hljs-built_in"><span class="xml"><span class="javascript"><span class="hljs-built_in">document</span></span></span></span><span class="xml"><span class="javascript">.createElement(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">'script'</span></span></span></span><span class="xml"><span class="javascript">) </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">if</span></span></span></span><span class="xml"><span class="javascript"> (</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">'noModule'</span></span></span></span><span class="xml"><span class="javascript"> </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">in</span></span></span></span><span class="xml"><span class="javascript"> s) { </span></span><span class="hljs-comment"><span class="xml"><span class="javascript"><span class="hljs-comment">// notice the casing s.type = 'module' s.src = '/modern.js' } else { s.src = '/legacy.js' } document.head.appendChild(s) }) </span></span></span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Mas com essa abordagem, você deve aguardar a conclusão do script do módulo "litmus" antes de implementar o script correto.  Isso acontece porque <code>&lt;sript type="module"&gt;</code> sempre funciona de forma assíncrona.  Mas existe uma maneira melhor! <br><br>  Você pode implementar a opção independente, verificando se o <code>nomodule</code> é <code>nomodule</code> no navegador.  Isso significa que consideraremos navegadores como o Safari 10.1 como obsoletos, mesmo que eles suportem módulos.  Mas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">poderia ser</a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">melhor</a> .  Aqui está o código relevante: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'script'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">'noModule'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) { <span class="hljs-comment"><span class="hljs-comment">// notice the casing s.type = 'module' s.src = '/modern.js' } else s.src = '/legacy.js' } document.head.appendChild(s)</span></span></code> </pre> <br>  Isso pode ser rapidamente transformado em uma função que carrega código moderno ou legado e também fornece carregamento assíncrono deles: <br><br><pre> <code class="javascript hljs">&lt;script&gt; $loadjs(<span class="hljs-string"><span class="hljs-string">"/modern.js"</span></span>,<span class="hljs-string"><span class="hljs-string">"/legacy.js"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">$loadjs</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">src,fallback,s</span></span></span><span class="hljs-function">) </span></span>{ s = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'script'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">'noModule'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) s.type = <span class="hljs-string"><span class="hljs-string">'module'</span></span>, s.src = src <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s.async = <span class="hljs-literal"><span class="hljs-literal">true</span></span>, s.src = fallback <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.head.appendChild(s) } &lt;<span class="hljs-regexp"><span class="hljs-regexp">/script&gt;</span></span></code> </pre> <br>  Qual é o compromisso aqui? <br><br>  <b>Pré-carregamento</b> <br><br>  Como a solução é totalmente dinâmica, o navegador não poderá detectar nossos recursos JavaScript até que inicie o código de inicialização que escrevemos para inserir scripts modernos ou legados.  Normalmente, um navegador verifica se há recursos que podem ser baixados com antecedência em HTML.  Esse problema foi resolvido, mas não de maneira ideal: você pode pré-carregar a versão moderna do pacote em navegadores modernos usando <code>&lt;link rl=modulpreload&gt;</code> . <br><br>  Infelizmente, até o momento, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">apenas o Chrome suporta o</a> <code>modulepreload</code> . <br><br><pre> <code class="javascript hljs">&lt;link rel=<span class="hljs-string"><span class="hljs-string">"modulepreload"</span></span> href=<span class="hljs-string"><span class="hljs-string">"/modern.js"</span></span>&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"module"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"><span class="xml"><span class="undefined">self.modern=1</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;!-- etc --&gt;</code> </pre> <br>  Se essa técnica for adequada para você, você poderá reduzir o tamanho do documento HTML no qual incorporar esses scripts.  Se sua carga útil for pequena, como uma tela inicial ou um código de download do aplicativo cliente, é improvável que a remoção do scanner de pré-carregamento afete o desempenho.  E se você desenhar muito HTML importante no servidor para enviar aos navegadores, o scanner de pré-carregamento será útil e a abordagem descrita não será a melhor opção para você. <br><br>  Veja como esta solução pode estar em uso: <br><br><pre> <code class="javascript hljs">&lt;link rel=<span class="hljs-string"><span class="hljs-string">"modulepreload"</span></span> href=<span class="hljs-string"><span class="hljs-string">"/modern.js"</span></span>&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"module"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"><span class="xml"><span class="undefined">self.modern=1</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;script&gt; $loadjs(<span class="hljs-string"><span class="hljs-string">"/modern.js"</span></span>,<span class="hljs-string"><span class="hljs-string">"/legacy.js"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">$loadjs</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e,d,c</span></span></span><span class="hljs-function">)</span></span>{c=<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">"script"</span></span>),self.modern?(c.src=e,c.type=<span class="hljs-string"><span class="hljs-string">"module"</span></span>):c.src=d,<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.head.appendChild(c)} &lt;<span class="hljs-regexp"><span class="hljs-regexp">/script&gt;</span></span></code> </pre> <br>  Também deve ser observado que a lista de navegadores que suportam módulos JS é quase a mesma que aqueles que suportam <code>&lt;link rl=preload&gt;</code> .  Para alguns sites, pode ser apropriado usar <code>&lt;link rl=preload as=script crossorigin&gt;</code> vez de <code>modulepreload</code> .  O desempenho pode deteriorar porque o pré-carregamento de script clássico não implica uma análise uniforme ao longo do tempo, como é o caso do <code>modulepreload</code> . <br><br><a name="second"></a><h4>  Método 2: rastrear agente do usuário </h4><br>  Não tenho um exemplo de código adequado, pois o rastreamento do User Agent é uma tarefa não trivial.  Mas então você pode ler o excelente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo na Revista Smashing.</a> <br><br>  De fato, tudo começa com o mesmo <code>&lt;scrit src=bundle.js&gt;</code> em HTML para todos os navegadores.  Quando bundle.js é solicitado, o servidor analisa a sequência do User Agent do navegador solicitante e seleciona qual JavaScript retornar - moderno ou herdado, dependendo de como o navegador foi reconhecido. <br><br>  <b>A abordagem é universal, mas traz sérias conseqüências:</b> <b><br></b> <br><ul><li>  Como servidores inteligentes são necessários, essa abordagem não funcionará sob condições de implantação estática (geradores de sites estáticos, Netlify etc.). </li><li>  O cache desses URLs JavaScript agora depende do User Agent, que é muito volátil. </li><li>  A definição de UA é difícil e pode levar a uma classificação falsa. </li><li>  A linha User Agent é fácil de falsificar, e novos UAs aparecem todos os dias. </li></ul><br>  Uma maneira de contornar essas limitações é combinar o padrão de módulo / nó com a diferenciação do User Agent para evitar o envio de várias versões do pacote para o mesmo endereço.  Essa abordagem reduz a capacidade de cache da página, mas fornece um pré-carregamento eficiente: o servidor gerador de HTML sabe quando usar o <code>modulepreload</code> e quando <code>preload</code> . <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">renderPage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">request, response</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> html = <span class="hljs-string"><span class="hljs-string">`&lt;html&gt;&lt;head&gt;...`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> agent = request.headers.userAgent; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isModern = userAgent.isModern(agent); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isModern) { html += <span class="hljs-string"><span class="hljs-string">` &lt;link rel="modulepreload" href="modern.mjs"&gt; &lt;script type="module" src="modern.mjs"&gt;&lt;/script&gt; `</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { html += <span class="hljs-string"><span class="hljs-string">` &lt;link rel="preload" as="script" href="legacy.js"&gt; &lt;script src="legacy.js"&gt;&lt;/script&gt; `</span></span>; } response.end(html); }</code> </pre> <br>  Para sites que já geram HTML no servidor em resposta a cada solicitação, isso pode ser uma transição eficaz para o download de scripts modernos. <br><br><a name="third"></a><h4>  Método três: bons navegadores antigos </h4><br>  O efeito negativo do padrão módulo / nomodule é visível em versões mais antigas do Chrome, Firefox e Safari - seu número é muito pequeno, porque os navegadores são atualizados automaticamente.  Com o Edge 16-18, a situação é diferente, mas há esperança: novas versões do Edge usarão o mecanismo de renderização baseado no Chromium, que não apresenta esses problemas. <br><br>  Para alguns aplicativos, esse seria um compromisso ideal: baixe a versão moderna do código em 90% dos navegadores e forneça o código herdado para os antigos.  A carga nos navegadores antigos aumentará. <br><br>  A propósito, nenhum dos agentes de usuários para os quais essa reinicialização é um problema ocupa uma parcela significativa do mercado móvel.  Portanto, é improvável que a fonte de todos esses bytes extras sejam dispositivos móveis ou dispositivos com um processador fraco. <br><br>  Se você estiver criando um site que é acessado principalmente por navegadores móveis ou novos, para a maioria desses usuários, o tipo mais simples de padrão de módulo / nó é adequado.  Certifique-se de adicionar a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">correção Safari 10.1</a> se dispositivos iOS mais antigos chegarem até você. <br><br><pre> <code class="javascript hljs">   iOS-. &lt;!-- polyfill <span class="hljs-string"><span class="hljs-string">`nomodule`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Safari <span class="hljs-number"><span class="hljs-number">10.1</span></span>: --&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"module"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="javascript"><span class="xml"><span class="javascript"> !</span></span><span class="hljs-function"><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">(</span></span></span><span class="hljs-params"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-params">e,t,n</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">)</span></span></span></span><span class="xml"><span class="javascript">{!(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"noModule"</span></span></span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">in</span></span></span></span><span class="xml"><span class="javascript">(t=e.createElement(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"script"</span></span></span></span><span class="xml"><span class="javascript">)))&amp;&amp;</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"onbeforeload"</span></span></span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">in</span></span></span></span><span class="xml"><span class="javascript"> t&amp;&amp;(n=!</span></span><span class="hljs-number"><span class="xml"><span class="javascript"><span class="hljs-number">1</span></span></span></span><span class="xml"><span class="javascript">,e.addEventListener(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"beforeload"</span></span></span></span><span class="xml"><span class="javascript">,</span></span><span class="hljs-function"><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">(</span></span></span><span class="hljs-params"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-params">e</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">)</span></span></span></span><span class="xml"><span class="javascript">{</span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">if</span></span></span></span><span class="xml"><span class="javascript">(e.target===t)n=!</span></span><span class="hljs-number"><span class="xml"><span class="javascript"><span class="hljs-number">0</span></span></span></span><span class="xml"><span class="javascript">;</span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">else</span></span></span></span><span class="xml"><span class="javascript"> </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">if</span></span></span></span><span class="xml"><span class="javascript">(!e.target.hasAttribute(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"nomodule"</span></span></span></span><span class="xml"><span class="javascript">)||!n)</span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">return</span></span></span></span><span class="xml"><span class="javascript">;e.preventDefault()},!</span></span><span class="hljs-number"><span class="xml"><span class="javascript"><span class="hljs-number">0</span></span></span></span><span class="xml"><span class="javascript">),t.type=</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"module"</span></span></span></span><span class="xml"><span class="javascript">,t.src=</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"."</span></span></span></span><span class="xml"><span class="javascript">,e.head.appendChild(t),t.remove())}(</span></span><span class="hljs-built_in"><span class="xml"><span class="javascript"><span class="hljs-built_in">document</span></span></span></span><span class="xml"><span class="javascript">) </span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;!-- <span class="hljs-number"><span class="hljs-number">90</span></span>+% <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> browsers: --&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"modern.js"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"module'&gt;&lt;/script&gt;</span></span></span></span></span></span> &lt;!-- IE, Edge &lt;<span class="hljs-number"><span class="hljs-number">16</span></span>, Safari &lt;<span class="hljs-number"><span class="hljs-number">10.1</span></span>, old desktop: --&gt; <span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">&lt;script src="</span></span></span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">legacy.js</span></span></span></span><span class="xml"><span class="hljs-tag">" </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">nomodule</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">async</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">defer</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br><a name="fourth"></a><h4>  Método 4: Aplicar termos do pacote </h4><br>  Uma boa solução seria usar o <code>nomodule</code> para baixar condicionalmente pacotes com código que não é necessário em navegadores modernos, como polyfills.  Com essa abordagem, no pior caso, o polyfill será carregado ou executado (no Safari 10.1), mas o efeito disso será limitado ao "re-polyfilling".  Considerando que hoje a abordagem com o download e a execução de polyfills em todos os navegadores prevalece, isso pode ser uma melhoria digna. <br><br><pre> <code class="javascript hljs">&lt;!-- newer browsers will not load <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> bundle: --&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">nomodule</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"polyfills.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;!-- all browsers load <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> one: --&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"/bundle.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Você pode configurar a CLI Angular para usar essa abordagem com polyfills, como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Minko</a> Gachev <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">demonstrou</a> .  Tendo aprendido sobre essa abordagem, percebi que você pode ativar a injeção automática de polyfill no preact-cli - este <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PR</a> demonstra como é fácil implementar essa técnica. <br><br>  E se você usa o WebPack, existe um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">plug</a> <code>html-webpack-plugin</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">in conveniente</a> para o <code>html-webpack-plugin</code> , que facilita a adição de um nomodule aos pacotes com polyfills. <br><br><h4>  Então o que escolher? </h4><br>  A resposta depende da sua situação.  Se você estiver criando um aplicativo cliente e seu HTML contiver um pouco mais que <code>&lt;sript&gt;</code> , poderá ser necessário o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">primeiro método</a> . <br><br>  Se você estiver criando um site renderizado no servidor e puder pagar em cache, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">segundo método</a> poderá ser adequado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">para você</a> . <br><br>  Se você usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a</a> renderização <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">universal</a> , o ganho de desempenho oferecido pela digitalização de pré-carregamento pode ser muito importante.  Portanto, preste atenção ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">terceiro</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">quarto</a> métodos.  Escolha o que combina com sua arquitetura. <br><br>  Pessoalmente, eu escolho, focando na duração da análise em dispositivos móveis, e não no custo do download nas versões para desktop.  Os usuários móveis percebem os custos de análise e transferência de dados como despesas reais (consumo de bateria e taxas de transferência de dados), enquanto os usuários de desktop não têm essas restrições.  Também procedo da otimização para 90% dos usuários - o principal público de meus projetos usa navegadores modernos e / ou móveis. <br><br><h4>  O que ler </h4><br>  Deseja saber mais sobre este tópico?  Você pode começar por aqui: <br><br><ul><li>  Ótimas informações adicionais no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">webpack-esnext-boilerplate</a> . </li><li>  Ralph <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">implementou o módulo / nomodule no Next.js</a> e está trabalhando em uma solução para problemas comuns. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt473994/">https://habr.com/ru/post/pt473994/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt473984/index.html">Data Science Digest (outubro de 2019)</a></li>
<li><a href="../pt473986/index.html">“Meu sonho é ver uma pessoa através das árvores” - fundadora da Lisa Alert sobre as modernas tecnologias de pesquisa</a></li>
<li><a href="../pt473988/index.html">Otimizando a Distribuição do Servidor nos Racks</a></li>
<li><a href="../pt473990/index.html">Aprenda o OpenGL. Lição 7.2 - Texto de desenho</a></li>
<li><a href="../pt473992/index.html">Visão geral de protocolos modernos em sistemas de automação industrial</a></li>
<li><a href="../pt473998/index.html">Holanda, ou lá e volta</a></li>
<li><a href="../pt474000/index.html">IQBX - projetista eletromecânico para clubes e entusiastas de bricolage [ideia conceitual]</a></li>
<li><a href="../pt474004/index.html">De Norilsk a Riyadh: Um exemplo real para os cartões de memória microSD UHS-I de temperatura industrial da Kingston</a></li>
<li><a href="../pt474008/index.html">Greenplum 6: revisão de novos recursos</a></li>
<li><a href="../pt474012/index.html">Segurança para contêineres do Docker</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>