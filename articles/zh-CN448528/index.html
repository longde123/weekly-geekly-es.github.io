<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕚 👩🏿‍🔬 🧓🏿 AWS上的免费Wireguard VPN服务 💃🏾 🏖️ 🕓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="为了什么 


 随着专制政权对互联网的审查日益严格，越来越多的有用互联网资源和站点被封锁。 包括技术信息。 
 因此，无法充分利用互联网， 并且侵犯了《 世界人权宣言》所载的基本的言论自由权 。 
 第19节 
 人人有权享有见解和言论自由； 这项权利包括自由坚持自己的信仰的自由，以及以任何方式，...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>AWS上的免费Wireguard VPN服务</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448528/"><h2 id="dlya-chego"> 为了什么 </h2><br><p> 随着专制政权对互联网的审查日益严格，越来越多的有用互联网资源和站点被封锁。 包括技术信息。 <br> 因此，无法充分利用互联网， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">并且</a>侵犯了《 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">世界人权宣言》</a>所载的基本的言论自由<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">权</a> 。 </p><br><blockquote> 第19节 <br> 人人有权享有见解和言论自由； 这项权利包括自由坚持自己的信仰的自由，以及以任何方式，不分国界寻求，接受和传播信息和思想的自由。 </blockquote><p> 在本指南中，我们将通过6个步骤，在运行<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Ubuntu Server 18.04</a>的实例（虚拟机）上，使用免费帐户（为期12个月）在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Amazon Web Services</a> （AWS）云基础架构中部署自己的基于<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Wireguard</a>技术的免费* <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">VPN服务</a> 。 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">LTS</a> 。 </p><br><p> 我试图使本演练对远离IT的人们尽可能友好。 唯一需要的是坚持不懈地重复下面描述的步骤。 </p><a name="habracut"></a><br><blockquote> 注意事项 <br><ul><li>  AWS提供了12个月的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">免费使用级别，</a>每月限制15 GB的流量。 </li><li> 本指南的最新版本位于<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://wireguard.isystem.io</a> </li></ul><br></blockquote><br><h2 id="etapy"> 阶段 </h2><br><ol><li>  AWS免费账户注册 </li><li> 创建AWS实例 </li><li> 连接到AWS实例 </li><li> 配置Wireguard </li><li> 配置VPN客户端 </li><li> 验证VPN安装 </li></ol><br><h2 id="poleznye-ssylki"> 有用的链接 </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">用于在AWS上自动安装Wireguard的脚本</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Habr.com讨论</a> </li></ul><br><h1 id="1-registraciya-akkaunta-aws">  1. AWS账户注册 </h1><br><p> 要注册一个免费的AWS账户，您需要一个真实的电话号码和一张可支付的Visa或Mastercard信用卡。 我建议使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Yandex.Money</a>或<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Qiwi钱包</a>免费提供的虚拟卡。 为了检查卡的有效性，会在注册时扣除$ 1，然后将其退还。 </p><br><h2 id="11-otkrytie-konsoli-upravleniya-aws">  1.1。 打开AWS管理控制台 </h2><br><p> 您必须打开浏览器并转到： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">//aws.amazon.com/en/</a> <br> 点击“注册”按钮 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c99/b30/925/c99b309258767bd9c72df8ffee22cb3b.jpg" alt="AWS Amazon初始页面"></p><br><h2 id="12-zapolnenie-personalnyh-dannyh">  1.2。 填写个人资料 </h2><br><p> 填写数据，然后单击“继续”按钮 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ebc/f8d/eec/ebcf8deec53b635bcf599927974672df.jpg" alt="AWS亚马逊账户XML"></p><br><h2 id="13-zapolnenie-kontaktnyh-dannyh">  1.3。 填写联系方式 </h2><br><p> 填写联系方式。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/793/c9f/f67/793c9ff67bdba7d504b2a61cbe94775d.jpg" alt="Amazon AWS账户联系信息"></p><br><h2 id="14-ukazanie-platezhnoy-informacii">  1.4。 计费信息指示。 </h2><br><p> 卡号，有效期和持卡人姓名。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a17/1a4/242/a171a4242cac644070878d3f8b9b8415.jpg" alt="注册Amazon AWS账户时时提供账单信息"></p><br><h2 id="15-podtverzhdenie-akkaunta">  1.5。 帐户验证 </h2><br><p> 在此阶段，将确认电话号码，并直接从支付卡中扣除$ 1。 计算机屏幕上显示4位数字的代码，并在指定的电话上收到来自Amazon的呼叫。 在通话过程中，您必须拨打屏幕上显示的代码。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/09b/e32/ce8/09be32ce83ebfa297fad0032c8f5f577.jpg" alt="Amazon AWS账户验证"></p><br><h2 id="16-vybor-tarifnogo-plana">  1.6。 选择关税计划。 </h2><br><p> 选择-基本计划（免费） </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/743/2ad/942/7432ad942629c21527af98517c33c0f7.jpg" alt="亚马逊AWS选择计划"></p><br><h2 id="17-vhod-v-konsol-upravleniya">  1.7。 登录到管理控制台 </h2><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0cc/151/703/0cc151703a717fbeaefc55512c0c4fb6.jpg" alt="进入Amazon AWS管理控制台"></p><br><h2 id="18-vybor-raspolozheniya-data-centra">  1.8。 选择数据中心位置 </h2><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0bd/b0f/9f3/0bdb0f9f3741b14fd0b78ba49df17e97.jpg" alt="AWS Amazon管理控制台"></p><br><h3 id="181-testirovanie-skorosti">  1.8.1。 速度测试 </h3><br><p> 在选择数据中心之前，建议通过<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://speedtest.net</a>测试访问最近的数据中心<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的</a>速度，在我的位置，以下结果如下： </p><br><ul><li> 新加坡新加坡 <br><img src="https://habrastorage.org/getpro/habr/post_images/43a/a84/ab8/43aa84ab88a4b7e8b3f2180d2291c66f.jpg" alt="新加坡新加坡"></li><li> 巴黎 <br><img src="https://habrastorage.org/getpro/habr/post_images/8ed/0b1/239/8ed0b12395ddfad991f57870525d8acc.jpg" alt="巴黎"></li><li> 法兰克福 <br><img src="https://habrastorage.org/getpro/habr/post_images/67a/de2/9d8/67ade29d8d0c379e781eaee5e88feeb9.jpg" alt="初步"></li><li> 斯德哥尔摩 <br><img src="https://habrastorage.org/getpro/habr/post_images/a78/506/e65/a78506e6501b87a552a4cedbb52c3929.jpg" alt="斯德哥尔摩"></li><li> 伦敦的 <br><img src="https://habrastorage.org/getpro/habr/post_images/15a/ed1/77e/15aed177e0a9654d519177c106a076c1.jpg" alt="伦敦的"></li></ul><br><p> 伦敦的数据中心显示了最快的速度结果。 因此，我选择了它进行进一步的自定义。 </p><br><h1 id="2-sozdanie-instansa-aws">  2.创建一个AWS实例 </h1><br><h2 id="21-sozdanie-virtualnoy-mashiny-instansa">  2.1创建虚拟机（实例） </h2><br><h3 id="210-zapusk-poshagovogo-mastera-sozdaniya-instansa">  2.1.0 启动创建实例演练 </h3><br><h4 id="2101-perehod-na-stranicu-zapuska-instansa">  2.1.0.1。 转到实例启动页面 </h4><br><p><img src="https://habrastorage.org/getpro/habr/post_images/649/07e/1ee/64907e1eee3ae6f9314e2d7f06eaeb86.jpg" alt="转到实例启动页面"></p><br><h4 id="2102-zapusk-poshagovogo-mastera-sozdaniya-instansa">  2.1.0.2。 启动创建实例演练 </h4><br><p><img src="https://habrastorage.org/getpro/habr/post_images/322/794/0d1/3227940d161a58918520b6e655df3e80.jpg" alt="启动创建实例演练"></p><br><h4 id="2103-vybor-tipa-operacionnoy-stistemy-instansa">  2.1.0.3。 选择实例操作系统类型 </h4><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f9b/184/50d/f9b18450d8fca676f8a1d7776c215085.jpg" alt="选择操作系统类型"></p><br><h3 id="211-vybor-tipa-instansa">  2.1.1。 选择实例类型 </h3><br><p> 默认情况下，选中t2.micro实例，我们需要它，只需单击<strong>Next</strong>按钮<strong>：Configure Instance Detalis</strong> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/3b0/af5/0a6/3b0af50a69a6461378ce2fb8d316ee9c.jpg" alt="选择实例类型"></p><br><h3 id="212-nastroyka-parametrov-instansa">  2.1.2。 配置实例参数 </h3><br><p> 将来，我们将永久性公共IP连接到我们的实例，因此在此阶段，我们将关闭公共IP的自动分配，然后单击<strong>下一步：添加存储。</strong> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/57f/50b/da8/57f50bda8627b54a38aa62276f6a9c70.jpg" alt="配置实例参数"></p><br><h3 id="213-podklyuchenie-hranilischa">  2.1.3。 存储连接 </h3><br><p> 指定“硬盘”的大小。  16 GB足以满足我们的目的，然后单击“ <strong>下一步”</strong>按钮<strong>：添加标签</strong> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/921/362/7de/9213627deeffbefe16ff9816f558d290.jpg" alt="存储连接"></p><br><h3 id="214-nastroyka-tegov">  2.1.4。 标签定制 </h3><br><p> 如果我们创建了多个实例，则可以按标签对它们进行分组，以方便管理。 在这种情况下，此功能是多余的，请立即单击“ <strong>下一步”</strong>按钮<strong>：配置安全性</strong> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/4e7/d81/191/4e7d81191d0463535a94d3e7a68d6c7f.jpg" alt="标签定制"></p><br><h3 id="215-otkrytie-portov">  2.1.5。 港口开放 </h3><br><p> 此时，我们通过打开所需的端口来配置防火墙。 开放端口集称为安全组。 我们需要创建一个新的安全组，为其命名，描述，并添加UDP端口（自定义UDP规则），在“ Rort Range”字段中，您需要分配<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">动态端口</a>范围49152–65535中的端口号。 在这种情况下，我选择端口号54321。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d12/f3c/7dd/d12f3c7dd609bf48f739757bb83d10da.jpg" alt="港口开放"></p><br><p> 填写必要的数据后，单击“ <strong>查看并启动”</strong>按钮 </p><br><h3 id="216-obzor-vseh-nastroek-instansa">  2.1.6。 所有实例设置概述 </h3><br><p> 在此页面上，概述了实例的所有设置，检查所有设置是否正确，然后单击“ <strong>启动”</strong>按钮 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/1a5/459/07f/1a545907f6714d976ca0c651664444b9.jpg" alt="所有实例设置概述"></p><br><h3 id="217-sozdanie-klyuchey-dostupa">  2.1.7。 创建密码 </h3><br><p> 接下来是一个对话框，该对话框提供创建或添加现有SSH密钥的功能，稍后我们将使用该密钥远程连接到我们的实例。 我们选择“创建新密钥对”选项来创建新密钥。 设置其名称，然后单击“ <strong>下载密钥对”</strong>按钮以下载创建的密钥。 将它们保存在本地计算机磁盘上的安全位置。 下载后-单击<strong>启动实例</strong>按钮 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/cc0/1e8/e1e/cc01e8e1ea1656094afd975acd2188b5.jpg" alt="创建密码"></p><br><h3 id="2171-sohranenie-klyuchey-dostupa">  2.1.7.1。 保存密码 </h3><br><p> 这里显示了保存上一步创建的密钥的步骤。 单击“ <strong>下载密钥对”</strong>按钮后，该密钥将另存为扩展名为* .pem的证书文件。 在这种情况下，我给它起了名字<strong><em>wireguard-awskey.pem</em></strong> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/49e/ed5/dd6/49eed5dd6bb2315b653a19f90aafe5fb.jpg" alt="保存密码"></p><br><h3 id="218-obzor-rezultatov-sozdaniya-instansa">  2.1.8。 实例创建结果概述 </h3><br><p> 接下来，我们将看到一条有关成功启动刚刚创建的实例的消息。 我们可以通过单击“ <strong>查看实例”</strong>按钮转到实例列表 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a97/a79/7cd/a97a797cddfae65ad45c5a1c272fc6de.jpg" alt="实例创建结果概述"></p><br><h2 id="22-sozdanie-vneshnego-ip-adresa">  2.2。 创建一个外部IP地址 </h2><br><h3 id="221-zapusk-sozdaniya-vneshnego-ip">  2.2.1。 开始创建外部IP </h3><br><p> 接下来，我们需要创建一个永久的外部IP地址，通过该地址我们将连接到我们的VPN服务器。 为此，请在屏幕左侧的导航面板中，从“ <strong><em>网络和特殊性”类别中</em></strong>选择“ <strong>弹性IP”</strong>项，然后单击“ <strong>分配新地址”</strong>按钮 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/987/617/173/98761717343305062012b18b1c58d444.jpg" alt="开始创建外部IP"></p><br><h3 id="222-nastroyka-sozdaniya-vneshnego-ip">  2.2.2。 配置外部IP创建 </h3><br><p> 在下一步中，我们需要启用<strong><em>Amazon pool</em></strong>选项（默认情况下启用），然后单击<strong>Allocate</strong>按钮 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5db/5be/b90/5db5beb90d9ec68ba2cae2380dca6d23.jpg" alt="配置外部IP创建"></p><br><h3 id="223-obzor-rezultatov-sozdaniya-vneshnego-ip-adresa">  2.2.3。 创建外部IP地址的结果概述 </h3><br><p> 下一个屏幕将显示我们收到的外部IP地址。 建议记住它，最好记下来。 在进一步设置和使用VPN服务器的过程中，它将一次又一次地派上用场。 在本指南中，我以IP地址<strong><em>4.3.2.1</em></strong>为例。 如何写地址，点击<strong>关闭</strong>按钮 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/faf/951/0c2/faf9510c260fed5c94f8c96231b99d31.jpg" alt="创建外部IP地址的结果概述"></p><br><h3 id="224-spisok-vneshnih-ip-adresov">  2.2.4。 外部IP地址列表 </h3><br><p> 接下来，我们打开一个列表，列出我们的永久公共IP地址（弹性IP）。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/eeb/6e3/286/eeb6e328635e48bf81dd721b457b6ed5.jpg" alt="外部IP地址列表"></p><br><h3 id="225-naznachenie-vneshnego-ip-instansu">  2.2.5。 分配外部IP实例 </h3><br><p> 在此列表中，我们选择接收到的IP地址，然后按鼠标右键以弹出一个下拉菜单。 在其中，选择“ <strong>关联地址”</strong>项以将其分配给先前创建的实例。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/88a/2d8/350/88a2d83500e3545f562c150ee9e30ac0.jpg" alt="分配外部IP实例"></p><br><h3 id="226-nastroyka-naznacheniya-vneshnego-ip">  2.2.6。 配置外部IP分配 </h3><br><p> 在下一步中，从下拉列表中选择我们的实例，然后单击“ <strong>关联”</strong>按钮 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ec5/70c/f51/ec570cf51ac30695418278b9b7c6ec97.jpg" alt="配置外部IP分配"></p><br><h3 id="227-obzor-rezultatov-naznacheniya-vneshnego-ip">  2.2.7。 外部IP分配结果概述 </h3><br><p> 之后，我们可以看到我们的实例及其私有IP地址与我们的永久公共IP地址绑定在一起。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b8e/ad3/b43/b8ead3b433f5aa357241882e09b0b8af.jpg" alt="外部IP分配结果概述"></p><br><p> 现在，我们可以从外部通过SSH从计算机连接到我们新创建的实例。 </p><br><h1 id="3-podklyuchenie-k-instansu-aws">  3.连接到AWS实例 </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SSH</a>是用于远程控制计算机设备的安全协议。 </p><br><h2 id="31-podklyuchenie-po-ssh-c-kompyutera-na-windows">  3.1。  Windows计算机的SSH连接 </h2><br><p> 要连接Windows计算机，必须首先下载并安装<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Putty</a>程序。 </p><br><h3 id="311-import-privatnogo-klyucha-dlya-putty">  3.1.1。 导入腻子的私钥 </h3><br><p>  3.1.1.1。 安装Putty之后，您必须运行随附的PuTTYgen实用程序，以PEM格式将证书密钥导入适合于Putty的格式。 为此，请在顶部菜单中选择“ <strong>转换”-&gt;“导入密钥</strong> ” </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/566/a08/a67/566a08a670cab781368765877d82cec2.jpg" alt="引入腻子的私钥"></p><br><h4 id="3112-vybor-klyucha-aws-v-formate-pem">  3.1.1.2。 选择PEM格式的AWS密钥 </h4><br><p> 接下来，选择我们先前在步骤<strong><em>2.1.7.1中</em></strong>保存的密钥，在本例中，其名称为<strong><em>wireguard-awskey.pem</em></strong> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c1d/88f/5d1/c1d88f5d11299f452b729fbd03623175.jpg" alt="选择PEM格式的AWS密钥"></p><br><h4 id="3113-zadanie-parametrov-importa-klyucha">  3.1.1.3。 设置关键导入选项 </h4><br><p> 在此步骤中，我们需要为此键指定一个注释（描述），并设置密码及其安全性确认。 每次您连接时都将要求它。 因此，我们使用密码保护密钥，以防不当使用。 您无法设置密码，但是如果密钥落入错误的人手中，密码的安全性就会降低。 单击<strong>保存私钥</strong>按钮后 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c45/bce/8ed/c45bce8ed42265fb239f4182ea1874c3.jpg" alt="设置关键导入选项"></p><br><h4 id="3114-sohranenie-importirovannogo-klyucha">  3.1.1.4。 保存导入的密钥 </h4><br><p>保存文件对话框打开，我们将私钥另存为扩展名为<code>.ppk</code>的文件，适用于<strong><em>Putty</em></strong> 。 <br> 指定密钥的名称（在本例中为<code>wireguard-awskey.ppk</code> ），然后单击“ <strong>保存”</strong>按钮。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e7b/905/6f2/e7b9056f2212177b772b4770a3ae09af.jpg" alt="保存引入的关键"></p><br><h3 id="312-sozdanie-i-nastroyka-soedineniya-v-putty">  3.1.2。 在Putty中创建和配置连接 </h3><br><h4 id="3121-sozdanie-soedineniya">  3.1.2.1。 建立连接 </h4><br><p> 打开Putty程序，选择<strong>Session</strong>类别（默认情况下处于打开状态），然后在步骤2.2.3中收到的<strong>Host Name</strong>字段中输入服务器的公共IP地址。 在“ <strong>保存的会话”</strong>字段中，为我们的连接输入一个任意名称（在我的情况下为<em>wireguard-aws-london</em> ），然后单击“ <strong>保存”</strong>按钮以保存我们所做的更改。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/81f/f1c/5f0/81ff1c5f0f3fcfa590dd17ef0b7c49dd.jpg" alt="建立连接"></p><br><h4 id="3122-nastroyka-avtologina-polzovatelya">  3.1.2.2。 用户自动登录设置 </h4><br><p> 在“ <strong><em>连接”</em></strong>类别中，进一步选择“ <strong><em>数据”</em></strong>子类别，然后在“ <strong>自动登录用户名”</strong>字段中输入<strong>ubuntu</strong>用户名-这是Ubuntu的标准AWS实例用户。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ec7/8a0/08a/ec78a008a3c6e1cb6d69ac2034de0b7a.jpg" alt="用户自动登录设置"></p><br><h4 id="3123-vybor-privatnogo-klyucha-dlya-soedineniya-po-ssh">  3.1.2.3。 选择用于SSH连接的私钥 </h4><br><p> 然后，我们转到“ <strong><em>连接/ SSH /</em></strong> <strong>身份</strong> <strong><em>验证”</em></strong>子类别，然后在“ <strong>用于身份验证的私钥文件”</strong>字段旁边，单击“ <strong>浏览...”</strong>按钮以选择带有密钥证书的文件。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e59/9fb/536/e599fb536b2426d19f46cf265161e1e0.jpg" alt="选择用于ssh连接的私钥"></p><br><h4 id="3124-otkrytie-importirovannogo-klyucha">  3.1.2.4。 打开导入的密钥 </h4><br><p> 我们指出了我们先前在步骤3.1.1.4中导入的密钥，在本例中为<em>wireguard-awskey.ppk文件</em> ，然后单击“ <strong>打开”</strong>按钮。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/419/5a5/b9e/4195a5b9ee0022f2296c75595ba4665c.jpg" alt="引入的关键"></p><br><h4 id="3125-sohranenie-nastroek-i-zapusk-podklyucheniya">  3.1.2.5。 保存设置并开始连接 </h4><br><p> 返回“ <strong><em>会话</em></strong>类别”页面，再次单击“ <strong>保存”</strong>按钮以保存我们先前在先前步骤（3.1.2.2-3.1.2.4）中所做的更改。 然后，我们按“ <strong>打开”</strong>按钮以打开我们创建和配置的远程SSH连接。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5c9/ef6/070/5c9ef6070698e59f18ff26c9356f4ddd.jpg" alt="保存设置并开始连接"></p><br><h4 id="3127-nastroyka-doveriya-mezhdu-hostami">  3.1.2.7。 配置主机之间的信任 </h4><br><p> 在下一步中，即您首次尝试连接时，我们会收到警告，我们尚未在两台计算机之间配置信任关系，并询问是否信任远程计算机。 我们单击<strong>是</strong> ，从而将其添加到受信任主机列表。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/1b4/f36/b9e/1b4f36b9ea9308a528b893abe1865d84.jpg" alt="配置主机之间的信任"></p><br><h4 id="3128-vvod-parolya-dlya-dostupa-k-klyuchu">  3.1.2.8。 输入密码以访问密钥 </h4><br><p> 此后，如果您在步骤3.1.1.3的较早版本中安装了密钥，则将打开终端窗口，在该窗口中要求输入密钥的密码。 输入密码时，屏幕上没有任何动作。 如果输入有误，可以使用<em>Backspace</em>键。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/078/e59/d11/078e59d1183e6cc2a836caa2e300522d.jpg" alt="输入密码以访问密钥"></p><br><h4 id="3129-privetstvennoe-soobschenie-ob-uspeshnom-podklyuchenii">  3.1.2.9。 成功连接后的欢迎消息 </h4><br><p> 成功输入密码后，终端中将显示欢迎文本，通知我们远程系统已准备好执行我们的命令。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f7b/9c0/254/f7b9c0254f7fa2d5d3dd59a8b7587c1e.jpg" alt="成功连接后的欢迎消息"></p><br><h1 id="4-konfigurirovanie-servera-wireguard">  4.配置Wireguard服务器 </h1><br><p> 可以在存储库中找到使用以下描述的脚本安装和使用Wireguard的最新说明： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">//github.com/isystem-io/wireguard-aws</a> </p><br><h2 id="41-ustanovka-wireguard">  4.1。 安装Wireguard </h2><br><p> 在终端中，输入以下命令（您可以将其复制到剪贴板，然后通过右键单击将其粘贴到终端中）： </p><br><h3 id="411-klonirovanie-repozitoriya">  4.1.1。 储存库克隆 </h3><br><p> 我们使用Wireguard安装脚本克隆存储库 </p><br><pre> <code class="plaintext hljs">git clone https://github.com/pprometey/wireguard_aws.git wireguard_aws</code> </pre> <br><h3 id="412-perehod-v-katalog-so-skriptami">  4.1.2。 转到脚本目录 </h3><br><p> 转到包含克隆存储库的目录 </p><br><pre> <code class="plaintext hljs">cd wireguard_aws</code> </pre> <br><h3 id="413--zapusk-skripta-inicializacii">  4.1.3运行初始化脚本 </h3><br><p> 以管理员身份（root用户）运行Wireguard安装脚本 </p><br><pre> <code class="plaintext hljs">sudo ./initial.sh</code> </pre> <br><p> 在安装过程中，系统将提示您输入某些数据，以配置Wireguard </p><br><h3 id="4131-vvod-tochki-podklyucheniya">  4.1.3.1。 输入连接点 </h3><br><p> 输入外部IP地址并打开Wireguard服务器的端口。 我们在步骤2.2.3中获得了服务器的外部IP地址，并在步骤2.1.5中打开了端口。 我们一起指定它们， <code>4.3.2.1:54321</code>冒号<code>4.3.2.1:54321</code> ，例如<code>4.3.2.1:54321</code> ，然后按<strong><em>Enter</em></strong> <br>  <em>输出示例：</em> </p><br><pre> <code class="plaintext hljs">Enter the endpoint (external ip and port) in format [ipv4:port] (eg 4.3.2.1:54321): 4.3.2.1:54321</code> </pre> <br><h3 id="4132-vvod-vnutrennego-ip-adresa">  4.1.3.2。 输入内部IP地址 </h3><br><p> 在安全的VPN子网中输入Wireguard服务器的IP地址，如果您不知道它是什么，只需按Enter即可设置默认值（ <code>10.50.0.1</code> ） <br>  <em>输出示例：</em> </p><br><pre> <code class="plaintext hljs">Enter the server address in the VPN subnet (CIDR format) ([ENTER] set to default: 10.50.0.1):</code> </pre> <br><h3 id="4133-ukazanie-servera-dns">  4.1.3.3。 指定DNS服务器 </h3><br><p> 输入DNS服务器的IP地址，或直接按Enter将默认值设置为<code>1.1.1.1</code> （Cloudflare公共DNS） <br>  <em>输出示例：</em> </p><br><pre> <code class="plaintext hljs">Enter the ip address of the server DNS (CIDR format) ([ENTER] set to default: 1.1.1.1):</code> </pre> <br><h3 id="4134-ukazanie-wan-interfeysa">  4.1.3.4。 指定WAN接口 </h3><br><p> 接下来，输入将在VPN的内部网络接口上侦听的外部网络接口的名称。 只需按Enter即可设置AWS的默认值（ <code>eth0</code> ） <br>  <em>输出示例：</em> </p><br><pre> <code class="plaintext hljs">Enter the name of the WAN network interface ([ENTER] set to default: eth0):</code> </pre> <br><h3 id="4135-ukazanie-imeni-klienta">  4.1.3.5。 客户姓名 </h3><br><p> 输入VPN用户的名称。 事实是，除非添加了至少一个客户端，否则Wireguard VPN服务器将无法启动。 在这种情况下，我输入名称<code>Alex@mobile</code> <br>  <em>输出示例：</em> </p><br><pre> <code class="plaintext hljs">Enter VPN user name: Alex@mobile</code> </pre> <br><p> 之后，应该在屏幕上显示带有新添加客户端配置的QR码，必须使用Android或iOS上的Wireguard移动客户端读取QR码以对其进行配置。 此外，在手动配置客户端的情况下，配置文件的文本也会显示在QR码下方。 下面将描述如何执行此操作。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a4b/22f/66d/a4b22f66d885ebee84bac4b04bbc5369.jpg" alt="完整的Wireguard安装"></p><br><h2 id="42-dobavlenie-novogo-vpn-polzovatelya">  4.2。 添加新的VPN用户 </h2><br><p> 要添加新用户，必须在终端中运行<code>add-client.sh</code>脚本 </p><br><pre> <code class="plaintext hljs">sudo ./add-client.sh</code> </pre> <br><p> 脚本要求输入用户名： <br>  <em>输出示例：</em> </p><br><pre> <code class="plaintext hljs">Enter VPN user name:</code> </pre> <br><p> 另外，该名称可以作为脚本参数（在本例中为<code>Alex@mobile</code> ）传递给用户： </p><br><pre> <code class="plaintext hljs">sudo ./add-client.sh Alex@mobile</code> </pre> <br><p> 执行脚本后，在路径为<code>/etc/wireguard/clients/{}</code>的客户端名称目录中，将使用客户端配置<code>/etc/wireguard/clients/{}</code> CustomerName►.conf）创建一个文件，并显示在终端屏幕上用于设置移动客户端的QR码和配置文件的内容。 </p><br><h3 id="421-fayl-polzovatelskoy-konfiguracii">  4.2.1。 用户配置文件 </h3><br><p> 您可以使用<code>cat</code>在屏幕上显示.conf文件的内容，以进行手动客户端配置。 </p><br><pre> <code class="plaintext hljs">sudo cat /etc/wireguard/clients/Alex@mobile/Alex@mobile.conf</code> </pre> <br><p> 执行结果： </p><br><pre> <code class="plaintext hljs">[Interface] PrivateKey = oDMWr0toPVCvgKt5oncLLRfHRit+jbzT5cshNUi8zlM= Address = 10.50.0.2/32 DNS = 1.1.1.1 [Peer] PublicKey = mLnd+mul15U0EP6jCH5MRhIAjsfKYuIU/j5ml8Z2SEk= PresharedKey = wjXdcf8CG29Scmnl5D97N46PhVn1jecioaXjdvrEkAc= AllowedIPs = 0.0.0.0/0, ::/0 Endpoint = 4.3.2.1:54321</code> </pre> <br><p> 客户端配置文件说明： </p><br><pre> <code class="plaintext hljs">[Interface] PrivateKey =    Address = IP   DNS =    [Peer] PublicKey =    PresharedKey =      AllowedIPs =     ( - 0.0.0.0/0, ::/0) Endpoint = IP     </code> </pre> <br><h3 id="422-qr-kod-konfiguracii-klienta">  4.2.2。  QR客户端配置代码 </h3><br><p> 您可以使用<code>qrencode -t ansiutf8</code>在终端屏幕上显示先前创建的客户端的配置代码的QR码（在此示例中，使用名为Alex @ mobile的客户端）： </p><br><pre> <code class="plaintext hljs">sudo cat /etc/wireguard/clients/Alex@mobile/Alex@mobile.conf | qrencode -t ansiutf8</code> </pre> <br><h1 id="5-konfigurirovanie-vpn-klientov">  5.配置VPN客户端 </h1><br><h2 id="51-nastroyka-mobilnogo-klienta-android">  5.1。  Android Mobile客户端设置 </h2><br><p> 可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">从官方GooglePlay商店安装</a> Android的官方Wireguard客户端 </p><br><p> 之后，您需要通过读取带有客户端配置的QR码来导入配置（请参阅第4.2.2节），并为其命名： </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/861/c38/bba/861c38bba4d89d5569ecf243d7698bc9.jpg" alt="配置Wireguard Android客户端"></p><br><p> 成功导入配置后，您可以启用VPN隧道。 关于成功的连接将在Android系统面板中显示密钥的隐藏状态 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a19/5cb/f5d/a195cbf5d352c812bfed9f2a62b4743b.jpg" alt="运行Android Wireguard Client"></p><br><h2 id="52-nastroyka-klienta-windows">  5.2。  Windows客户端设置 </h2><br><p> 最初，您需要下载并安装<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Windows</a>的TunSafe-这是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Windows</a>的Wireguard客户端。 </p><br><h3 id="521-sozdanie-fayla-konfiguracii-dlya-importa">  5.2.1。 创建要导入的配置文件 </h3><br><p> 右键单击以在桌面上创建一个文本文件。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/fad/09f/54e/fad09f54e4ff9a2482641f869f408a6d.jpg" alt="创建文本文件"></p><br><h3 id="522-kopirovanie-soderzhimogo-fayla-konfiguracii-s-servera">  5.2.2。 从服务器复制配置文件的内容 </h3><br><p> 然后，我们返回到Putty终端并显示所需用户的配置文件的内容，如步骤4.2.1所述。 <br> 接下来，使用鼠标右键在Putty终端中选择配置文本；选择完成后，它将自动复制到剪贴板。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/fc0/937/846/fc0937846ef68a658be436afd63a83cf.jpg" alt="复制配置文字"></p><br><h3 id="523-kopirovanie-konfiguracii-v-lokalnyy-fayl-konfiguracii">  5.2.3。 将配置复制到本地配置文件 </h3><br><p> 该字段返回到我们之前在桌面上创建的文本文件，并将配置文本从剪贴板粘贴到其中。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/6e4/3f7/095/6e43f7095b1eb48c998fa9f0532f046c.jpg" alt="复制配置文字"></p><br><h3 id="524-sohranenie-lokalnogo-fayla-konfiguracii">  5.2.4。 保存本地配置文件 </h3><br><p> 我们以扩展名<strong>.conf</strong>保存文件（在这种情况下，名称为<code>london.conf</code> ） </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/4e9/cf6/448/4e9cf64484b951db1a7a19b71e37fcc0.jpg" alt="保存配置文件"></p><br><h3 id="525-import-lokalnogo-fayla-konfiguracii">  5.2.5。 导入本地配置文件 </h3><br><p> 接下来，您需要将配置文件导入TunSafe程序。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/944/8f3/a27/9448f3a27ccc04f602592b23f66b5a5a.jpg" alt="将配置文件引入TunSafe"></p><br><h3 id="526-ustanovka-vpn-soedineniya">  5.2.6。 建立VPN连接 </h3><br><p> 选择此配置文件，然后单击“ <strong>连接”</strong>按钮进行<strong>连接</strong> 。 <br><img src="https://habrastorage.org/getpro/habr/post_images/39d/c82/6e1/39dc826e150eda422254c55891c037d5.jpg" alt="通过TunSafe连接到VPN服务器"></p><br><h1 id="6-proverka-uspeshnosti-podklyucheniya">  6.检查连接成功 </h1><br><p> 要检查通过VPN隧道的连接是否成功，您需要打开浏览器并转到站点<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://2ip.ua/ru/</a> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b8c/b93/442/b8cb93442fa9a3d037b753496436026b.jpg" alt="通过TunSafe连接到VPN服务器"></p><br><p> 显示的IP地址应该与我们在步骤2.2.3中收到的IP地址匹配。 <br> 如果是这样，则说明VPN隧道运行正常。 </p><br><p> 在Linux的终端上，您可以通过输入以下命令来验证IP地址： </p><br><pre> <code class="plaintext hljs">curl http://zx2c4.com/ip</code> </pre> <br><p> 如果您在哈萨克斯坦，也可以去色情中心。 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN448528/">https://habr.com/ru/post/zh-CN448528/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN448510/index.html">宏cer（Acer）2019年：如果从游戏笔记本电脑中清除所有苍蝇该怎么办</a></li>
<li><a href="../zh-CN448516/index.html">在ARDUINO平台上进化或为机器人奠定基础，我们通过智能手机将传感器和视频驱动到计算机</a></li>
<li><a href="../zh-CN448518/index.html">如何看到黑洞？</a></li>
<li><a href="../zh-CN448522/index.html">nginx的配置生成，一个拉取请求的历史记录</a></li>
<li><a href="../zh-CN448524/index.html">以色列科学家首次在世界上印出一颗活泼的心</a></li>
<li><a href="../zh-CN448530/index.html">扩音器如何在移动订户上睡觉</a></li>
<li><a href="../zh-CN448532/index.html">空间数据中心。 总结实验</a></li>
<li><a href="../zh-CN448534/index.html">为什么我们需要具有增强的EMC的工业交换机？</a></li>
<li><a href="../zh-CN448536/index.html">透明-屠夫的灵丹妙药</a></li>
<li><a href="../zh-CN448538/index.html">构建基于Oracle RAC和AccelStor Shared-Nothing架构的故障转移解决方案</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>