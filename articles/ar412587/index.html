<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⚫️ 🚣🏻 🛃 دمية + هيرا. اضغط على الحد الأقصى 💇🏻 🚗 🏠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="في هذه المقالة ، أود أن أتحدث عن كيفية استخدام Puppet و Hiera لتكوين الحديد والخوادم الافتراضية. في الأساس ، سيكون الأمر متعلقًا بالعمارة والتسلسل اله...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>دمية + هيرا. اضغط على الحد الأقصى</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/semrush/blog/412587/" style=";text-align:right;direction:rtl"><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/vq/z-/bj/vqz-bjm4yx2wvhzcf-frffyuh04.png"></div><br><p style=";text-align:right;direction:rtl">  في هذه المقالة ، أود أن أتحدث عن كيفية استخدام <strong>Puppet</strong> و <strong>Hiera</strong> لتكوين الحديد والخوادم الافتراضية.  في الأساس ، سيكون الأمر متعلقًا بالعمارة والتسلسل الهرمي الذي اخترعناه ، مما يسهل وينظم تكوين الخوادم. </p><br><p style=";text-align:right;direction:rtl">  لقد طُلب مني كتابة هذه المقالة بحقيقة أنني لم أجد على الإنترنت أمثلة جيدة وعملية حقًا لكيفية العمل مع hiera وما الغرض منه.  في الأساس ، هذه دروس مع أمثلة من أجل إدخال الموضوع.  لكن التطبيق العملي الحقيقي للهيرا لم يكتب هناك.  ربما لم أبدو بشكل جيد ، ولكن هنا مثال حقيقي من المحتمل أن يساعدك على وضع جميع النقاط فوقي ، كما فعلت مرة واحدة. </p><br><h3 id="dlya-kogo-byla-by-polezna-dannaya-statya" style=";text-align:right;direction:rtl">  لمن ستكون هذه المقالة مفيدة </h3><br><p style=";text-align:right;direction:rtl">  إذا: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  أنت تعرف ما هي Puppet و Hiera ، لكنك لا تستخدمهما معًا حقًا ، لأنه ليس من الواضح كيفية القيام بذلك ولماذا </li><li style=";text-align:right;direction:rtl">  لديك الكثير من الفرق في شركتك وتحتاج إلى التمييز بين تكوين الخادم بطريقة أو بأخرى على مستوى الأمر </li><li style=";text-align:right;direction:rtl">  يمكنك استخدام لوحة ، وملفات العقدة التي نمت إلى أحجام لا تصدق </li><li style=";text-align:right;direction:rtl">  هل تحب قراءة تكوين الخادم بتنسيق yaml الإلهي :) </li><li style=";text-align:right;direction:rtl">  أنت مهتم بشكل أساسي بموضوع إدارة التهيئة وإدارة النظام. </li></ul><br><p style=";text-align:right;direction:rtl">  هذه المقالة لك. </p><a name="habracut"></a><br><h3 id="prezhde-chem-nachat" style=";text-align:right;direction:rtl">  قبل أن تبدأ </h3><br><p style=";text-align:right;direction:rtl">  سأحذرك على الفور ، تبين أن المقالة طويلة ، ولكن آمل أن تكون مفيدة.  بالإضافة إلى ذلك ، من المفهوم أنك قمت بالفعل بتوصيل هيرا بالدمى ، وأنك على الأقل على دراية بطريقة ما بالدمى.  إذا لم تكن الحيرة متصلة ، فليس من الصعب القيام بذلك. </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  اقرأ المزيد عن دمى العرائس هنا: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">عرائس للمبتدئين</a> . </li><li style=";text-align:right;direction:rtl">  كيف تعمل هيرا - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">مقدمة في هيرا</a> . </li></ul><br><h3 id="vvodnye-dannye" style=";text-align:right;direction:rtl">  بيانات الإدخال </h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  لدينا حوالي 30 فريق تطوير في SEMrush ، لكل منها خوادمها الخاصة </li><li style=";text-align:right;direction:rtl">  يعمل كل فريق مع مجموعته الخاصة من التقنيات (PL ، DBMS ، إلخ.) </li><li style=";text-align:right;direction:rtl">  يمكن للفرق ويجب عليها (بشكل مثالي) استخدام التكوين المشترك لمشاريع محددة (إعادة استخدام التعليمات البرمجية) </li><li style=";text-align:right;direction:rtl">  تدير الفرق نفسها نشر التطبيقات على خوادمها (لا يتم ذلك من خلال التطبيق) </li></ul><br><h3 id="nemnogo-istorii" style=";text-align:right;direction:rtl">  القليل من التاريخ </h3><br><p style=";text-align:right;direction:rtl">  في البداية ، كان لدينا كل شيء في الإصدار 3 من pappet ، ثم قررنا تنفيذ اللوحة الرابعة ، وبدأت جميع الخوادم الجديدة في وضعها ، وتم نقل الخوادم القديمة ببطء إلى الرابع. </p><br><p style=";text-align:right;direction:rtl">  في الجزء الثالث ، اعتدنا على استخدام النظام الكلاسيكي لملفات العقدة والوحدات النمطية.  تم إنشاء الوحدات النمطية في مجموعة خاصة من المشاريع في Gitlab ، وتم استنساخها إلى خادم بابيت (باستخدام <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">r10k</a> ) ، ثم جاء وكلاء pappet إلى المعالج وتلقوا دليلاً لتطبيقه على الخادم. </p><br><p style=";text-align:right;direction:rtl">  ثم بدأوا يحاولون عدم القيام بذلك وعدم استخدام الوحدات المحلية ، ولكن وضع روابط للوحدات الضرورية والمستودعات الخاصة بهم في Puppetfile.  لماذا؟  لأن هذه الوحدات يتم دعمها وتحسينها باستمرار (جيدًا ، بشكل مثالي) من قبل المجتمع والمطورين ، والوحدات المحلية لدينا ليست كذلك.  في وقت لاحق أدخلوا هيرا وتحولوا إليها بالكامل ، وقد غرقت ملفات العقدة (مثل nodes.pp) في طي النسيان. </p><br><p style=";text-align:right;direction:rtl"> في الجزء الرابع ، حاولنا التخلي تمامًا عن الوحدات المحلية واستخدام الوحدات البعيدة فقط.  لسوء الحظ ، يجب إدراج الحجز هنا مرة أخرى ، لأنه "لم ينجح تمامًا" ، في بعض الأحيان لا يزال عليك إمالة وإنهاء شيء بنفسك.  بالطبع ، لا يوجد سوى hiera ولا توجد ملفات عقدة. </p><br><p style=";text-align:right;direction:rtl">  <strong>عندما يكون لديك 30 فريقًا مع حديقة حيوانات تكنولوجية ، فإن مشكلة كيفية الحفاظ على هذا المدير مع أكثر من 1000 خادم تصبح حادة بشكل خاص.</strong>  <strong>علاوة على ذلك ، سأخبرنا كيف تساعدنا هيرا في ذلك.</strong> </p><br><h3 id="ierarhiya" style=";text-align:right;direction:rtl">  التسلسل الهرمي </h3><br><p style=";text-align:right;direction:rtl">  هيرا (التي حصلت على اسمها في الواقع) تشكل تسلسلاً هرميًا.  معنا ، يبدو هذا: </p><br><pre style=";text-align:right;direction:rtl"><code class="hljs axapta">--- :hierarchy: - <span class="hljs-string"><span class="hljs-string">"nodes/%{::fqdn}"</span></span> - <span class="hljs-string"><span class="hljs-string">"teams/%{::team}_team/nodes/%{::fqdn}"</span></span> - <span class="hljs-string"><span class="hljs-string">"teams/%{::team}_team/projects/%{::project}/tiers/%{::tier}"</span></span> - <span class="hljs-string"><span class="hljs-string">"teams/%{::team}_team/projects/%{::project}/%{::role}"</span></span> - <span class="hljs-string"><span class="hljs-string">"teams/%{::team}_team/projects/%{::project}"</span></span> - <span class="hljs-string"><span class="hljs-string">"teams/%{::team}_team/roles/%{::role}"</span></span> - <span class="hljs-string"><span class="hljs-string">"teams/%{::team}_team/%{::team}"</span></span> - <span class="hljs-string"><span class="hljs-string">"projects/%{::project}/tiers/%{::tier}/%{::role}"</span></span> - <span class="hljs-string"><span class="hljs-string">"projects/%{::project}/tiers/%{::tier}"</span></span> - <span class="hljs-string"><span class="hljs-string">"projects/%{::project}/%{::role}"</span></span> - <span class="hljs-string"><span class="hljs-string">"projects/%{::project}"</span></span> - <span class="hljs-string"><span class="hljs-string">"tiers/%{::tier}"</span></span> - <span class="hljs-string"><span class="hljs-string">"virtual/%{::virtual}"</span></span> - <span class="hljs-string"><span class="hljs-string">"os/%{::operatingsystem}/%{::operatingsystemmajrelease}"</span></span> - <span class="hljs-string"><span class="hljs-string">"os/%{::operatingsystem}"</span></span> - users - <span class="hljs-keyword"><span class="hljs-keyword">common</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  أولاً ، دعنا نتعامل مع المتغيرات الغامضة (الحقائق). </p><br><p style=";text-align:right;direction:rtl">  يجب أن يحتوي كل خادم في SEMrush بشكل مثالي على 4 حقائق خاصة مكشوفة تصف انتمائه: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  حقيقة <strong><code>team</code></strong> - أي فريق ينتمي إليه </li><li style=";text-align:right;direction:rtl">  <strong><code>project</code></strong> حقيقة - أي مشروع يتعلق به </li><li style=";text-align:right;direction:rtl">  حقيقة <strong><code>role</code></strong> - ما هو دور هذا المشروع </li><li style=";text-align:right;direction:rtl">  حقيقة <strong><code>tier</code></strong> - أي نوع من المراحل لديها (همز ، اختبار ، ديف) </li></ul><br><p style=";text-align:right;direction:rtl">  كيف يعمل؟  يأتي وكيل Pappet إلى سيد Pappet ، واستنادًا إلى هذه الحقائق ، يبحث عن الملفات لنفسه ، ويمر عبر المجلدات وفقًا لتسلسلنا الهرمي.  لا حاجة للإشارة إلى أن ملفات التكوين تنتمي إلى الخوادم.  بدلاً من ذلك ، تعرف الخوادم نفسها الملفات التي تنتمي إليها ، وتنظر فقط إلى مسارها وحقائقها. </p><br><p style=";text-align:right;direction:rtl">  أثناء إعداد الخادم ، يتصل المشرفون بالمطورين ويحددون هذه المعلمات (غالبًا ، على العكس من ذلك ، يتصل الأشخاص المطلعون بالمسؤولين أنفسهم) من أجل بناء تسلسل هرمي في hiera في المستقبل ، على أساسه يصف تكوين الخادم.  يساعد هذا النظام على إعادة استخدام التعليمات البرمجية ويكون أكثر مرونة من حيث تكوين الخادم. </p><br><p style=";text-align:right;direction:rtl">  على سبيل المثال ، لدينا مشروع <em>خاص</em> .  في هذا المشروع ، قد يكون هناك بعض خادم الواجهة الأمامية مع nginx ، خادم الواجهة الخلفية مع الثعبان ، كتلة db مع الخلية ، خادم redis للتخزين المؤقت.  يجب وضع جميع هذه الخوادم في مشروع واحد يسمى <strong>خاص</strong> ، ثم تعيين <strong>الأدوار</strong> للخوادم. </p><br><p style=";text-align:right;direction:rtl">  في ملف المشروع ، نقوم بوصف المعلمات المشتركة للمشروع بأكمله.  أول ما يتبادر إلى الذهن هو الإنشاء على جميع خوادم المستخدم للنشر مع قضية الحقوق اللازمة له وطرح مفاتيح ssh الخاصة به. </p><br><p style=";text-align:right;direction:rtl">  في دور كل خادم ، عادة ما يتم وصف الخدمة وتخصيصها - لما يقصد به هذا الخادم (nginx ، python ، mysql ، إلخ.) الطبقة في هذه الحالة سنحتاج بالتأكيد إذا كنا بحاجة أيضًا إلى نشر نسخة من بيئة الإنتاج على منصة dev ، ولكن تغيير شيء فيه (كلمات المرور ، على سبيل المثال).  في هذه الحالة ، سيختلف خادم dev وخادم prod فقط في حقيقة أنه تم تعيين الطبقة على "الموضع" المطلوب (prod أو dev).  ثم القليل من السحر والهيرا سيفعلان الخدعة. </p><br><p style=";text-align:right;direction:rtl">  إذا كنا بحاجة إلى نشر خادمين متطابقين في نفس الدور ، ولكن يجب أن يختلف شيء فيهما ، على سبيل المثال ، بعض الخطوط في التكوين ، فسيأتي جزء آخر من التسلسل الهرمي إلى الإنقاذ.  نضع الملفات باسم التنسيق <strong><code>{fqdn }.yaml</code></strong> في المكان الصحيح (على سبيل المثال ، <strong><code>nodes/myserver.domain.net</code></strong> ) ، ونعين القيم اللازمة للمتغيرات على مستوى خادم معين ، وسيطبق البابيت نفس التكوين لكل من الخوادم للدور ، وفريدًا لكل منهما من الخوادم. </p><br><p style=";text-align:right;direction:rtl">  مثال: يوجد خلفيتان برمز php في نفس الدور وهما متطابقان تمامًا.  من الواضح أننا لا نريد عمل نسخة احتياطية من كلا الخادمين - فلا معنى لذلك.  يمكننا إنشاء دور لوصف نفس التكوين لكلا الخادمين ، ثم إنشاء ملف <strong><code>nodes/backend1.semrush.net</code></strong> لوضع التكوين للنسخ الاحتياطي. </p><br><p style=";text-align:right;direction:rtl">  تشير <strong><code>teams/team-name.yaml</code></strong> الملف الدفعي <strong><code>teams/team-name.yaml</code></strong> إلى التكوين لكافة الخوادم التي تنتمي إلى الفريق.  في أغلب الأحيان ، يصف المستخدمين الذين يمكنهم التفاعل مع هذه الخوادم ، بالإضافة إلى حقوق الوصول الخاصة بهم. </p><br><p style=";text-align:right;direction:rtl">  بناءً على هذه المتغيرات ، قمنا ببناء هذا <strong>التسلسل الهرمي</strong> .  كلما زاد حجم الملف الموجود في التسلسل الهرمي ، زادت أولوية التكوين المحدد فيه. </p><br><p style=";text-align:right;direction:rtl">  ويترتب على ذلك أن المتغيرات يمكن <strong>تجاوزها</strong> بناءً على هذا التسلسل الهرمي.  أي أن المتغير في ملف الدور " <strong><code>projects/%{::project}/%{::role}</code></strong> " له الأسبقية على المتغير في ملف المشروع " <strong><code>projects/%{::project}</code></strong> ".  يمكن أيضًا دمج المتغيرات في جميع مستويات التسلسل الهرمي إذا كان لديك وحدة و / أو ملف تعريف / دور مكتوب بطريقة يمكن القيام بها.  من خلال تحديد الجزء المشترك من mysql config لجميع خوادم المشروع ، يمكنك إضافة أجزاء خاصة لها وزن لهذا الدور إلى نفس المتغير في المستويات الأخرى من التسلسل الهرمي (سيكون هناك قسم إضافي في التكوين للعبد). </p><br><p style=";text-align:right;direction:rtl">  وتبين أن ملف العقدة المحددة الموجودة على المسار " <strong><code>hieradata/nodes/%{::fqdn}</code></strong> " له الأولوية القصوى.  بعد ذلك يأتي ملف العقدة ، ولكن بالفعل على مستوى الأمر.  يوجد أدناه الكتلة التي تصف حقائق أخرى أكثر عمومية: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs axapta"> - <span class="hljs-string"><span class="hljs-string">"virtual/%{::virtual}"</span></span> - <span class="hljs-string"><span class="hljs-string">"os/%{::operatingsystem}/%{::operatingsystemmajrelease}"</span></span> - <span class="hljs-string"><span class="hljs-string">"os/%{::operatingsystem}"</span></span> - users - <span class="hljs-keyword"><span class="hljs-keyword">common</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  وفقًا لذلك ، في الملف <strong><code>common.yaml</code></strong> لدينا تكوين يجب أن يأتي بالتأكيد إلى <strong>جميع</strong> الخوادم ، في ملف المستخدمين. يتم وصف جميع المستخدمين (ولكن لا يتم إنشاؤها جميعًا على الخوادم ، بالطبع) ، في <strong><code>os/%{::operatingsystem}</code></strong> التكوين العام النموذجي للخوادم ذات نظام تشغيل معين ( <code>::operatingsystem</code> fact <code>::operatingsystem</code> ) وما إلى ذلك. </p><br><p style=";text-align:right;direction:rtl">  أعتقد ، بالنظر إلى هذا التسلسل الهرمي ، يصبح كل شيء واضحًا.  أدناه سوف أعتبر مثالا لاستخدام مثل هذا التسلسل الهرمي.  ولكن عليك أولاً التحدث عن ملفات التعريف. </p><br><h3 id="profili" style=";text-align:right;direction:rtl">  الملامح </h3><br><p style=";text-align:right;direction:rtl">  يعد استخدام ملفات التعريف نقطة مهمة في تكوين الخوادم باستخدام الوحدات.  وهي تقع على <strong><code>site/profiles</code></strong> المسار وهي نقاط الدخول إلى الوحدات.  بفضلها ، يمكنك تكوين الوحدات المعلقة على الخادم بشكل أكثر دقة وإنشاء الموارد اللازمة. </p><br><p style=";text-align:right;direction:rtl">  فكر في مثال بسيط.  هناك <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">وحدة</a> تقوم بتثبيت وتكوين redis.  ونريد أيضًا تعيين معلمة <code>vm.overcommit_memory</code> على 1 عند توصيل هذه الوحدة ، لأنه <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">هنا</a> .  ثم نكتب ملفًا شخصيًا صغيرًا يوفر هذه الوظيفة: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs lua"># standalone redis server class profiles::db::redis ( Hash $<span class="hljs-built_in"><span class="hljs-built_in">config</span></span> = {}, String $output_buffer_limit_slave = <span class="hljs-string"><span class="hljs-string">'256mb 64mb 60'</span></span>, ) { # https://redis.<span class="hljs-built_in"><span class="hljs-built_in">io</span></span>/topics/faq#background-saving-fails-with-a-fork-<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>-under-linux-even-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-i-have-a-lot-of-free-ram sysctl { <span class="hljs-string"><span class="hljs-string">'vm.overcommit_memory'</span></span>: ensure =&gt; present, value =&gt; <span class="hljs-string"><span class="hljs-string">'1'</span></span>, } class { <span class="hljs-string"><span class="hljs-string">'::redis'</span></span>: * =&gt; $<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>, } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  كما ذكر أعلاه ، فإن الملفات الشخصية هي أداة تسمح لك بتغيير / تحسين سلوك الوحدة ، وكذلك تقليل عدد التكوينات في hiera.  إذا كنت تستخدم وحدات عن بُعد ، فغالبًا ما تواجه مشكلة تتمثل في أن الوحدات "المعتمدة" غالبًا ما لا تحتوي على الوظائف التي تحتاجها ، أو لديك بعض الأخطاء / العيوب.  ثم ، من حيث المبدأ ، يمكنك استنساخ هذه الوحدة وتصحيح / إضافة وظائف.  ولكن القرار الصحيح سيكون ، إن أمكن ، كتابة ملف تعريف جيد يمكنه "إعداد" الوحدة بالطريقة التي تريدها.  فيما يلي بعض الأمثلة عن الملفات الشخصية ، ويمكنك فهم سبب الحاجة إليها بشكل أفضل. </p><br><h3 id="sokrytie-sekretov-v-hiera" style=";text-align:right;direction:rtl">  إخفاء الأسرار في الحيره </h3><br><p style=";text-align:right;direction:rtl">  واحدة من المزايا الهامة للهيرا مقارنة مع لوحة العارية هي قدرتها على تخزين البيانات الحساسة في ملفات التكوين في شكل مشفر في المستودع.  ستكون كلمات المرور الخاصة بك آمنة. </p><br><p style=";text-align:right;direction:rtl">  باختصار ، يمكنك استخدام المفتاح العام لتشفير المعلومات التي تحتاجها ووضعها بمثل هذا الخط في ملف hiera.  يتم تخزين الجزء الخاص من المفتاح على سيد pappet ، والذي يسمح لك بفك تشفير هذه البيانات.  يمكن العثور على مزيد من التفاصيل في صفحة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">المشروع</a> . </p><br><p style=";text-align:right;direction:rtl">  على العميل (الكمبيوتر العامل) ، يتم تثبيت الأداة ببساطة باستخدام <strong><code>gem install hiera-eyaml</code></strong> .  علاوة على ذلك ، باستخدام أمر شكل <strong><code>eyaml encrypt --pkcs7-public-key=/path/to/public_key.pkcs7.pem -s 'hello'</code></strong> يمكنك تشفير البيانات ولصقها في ملف بالملحق eyaml أو yaml فقط ، اعتمادًا على كيفية تكوين ، ومن ثم سوف pappet معرفة ذلك.  تحصل على شيء مثل: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs ruby">roles::postrgresql::<span class="hljs-symbol"><span class="hljs-symbol">password:</span></span> <span class="hljs-string"><span class="hljs-string">'ENC[PKCS7,MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEAbIz1ihQlThMWa9T+Lq194Y6QdElMD1XTev5y+VPSHtkPTu6Al6TJaSrXF+7phJIjue+NF4ZVtJCLkHxUR6nJJqks0fcGS1vF2+6mmM9cy69sIU1A3HqpOHZLuqHAc7jUqljYxpwWSIGOK6I2FygdAp5FfOTewqfcVVmXj97EJdcv3DKrbAlSrIMO2iZRYwQvyv+qnptnZ7pilR2veOCPW2UMm6zagDLutX9Ft5vERbdaiCiEfTOpVa9Qx0GqveNRVJLV/5lfcL5ajdNBJXkvKqDbx8d3ZBtEVAAqeKlw0LqzScgmCbWQx2kUzukX5LSxbTpT0Th984Vp1sl7iPk7UTA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBCp5GcwidcEMA+0wjAMblkKgBCR/f9KGXUgLh3/Ok60OIT5]'</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  أو سلسلة متعددة الأسطر: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs powershell">roles::postgresql::password: &gt; ENC[<span class="hljs-type"><span class="hljs-type">PKCS7</span></span>,<span class="hljs-type"><span class="hljs-type">MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQEw</span></span> <span class="hljs-type"><span class="hljs-type">DQYJKoZIhvcNAQEBBQAEggEAbIz1ihQlThMWa9T</span></span>+<span class="hljs-type"><span class="hljs-type">Lq194Y6QdElMD1XTev5y</span></span> +<span class="hljs-type"><span class="hljs-type">VPSHtkPTu6Al6TJaSrXF</span></span>+<span class="hljs-number"><span class="hljs-number">7</span></span><span class="hljs-type"><span class="hljs-type">phJIjue</span></span>+<span class="hljs-type"><span class="hljs-type">NF4ZVtJCLkHxUR6nJJqks0fcGS1vF</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">6</span></span><span class="hljs-type"><span class="hljs-type">mmM9cy69sIU1A3HqpOHZLuqHAc7jUqljYxpwWSIGOK6I2FygdAp5FfOTe</span></span> <span class="hljs-type"><span class="hljs-type">wqfcVVmXj97EJdcv3DKrbAlSrIMO2iZRYwQvyv</span></span>+<span class="hljs-type"><span class="hljs-type">qnptnZ7pilR2veOCPW2UM</span></span> <span class="hljs-type"><span class="hljs-type">m6zagDLutX9Ft5vERbdaiCiEfTOpVa9Qx0GqveNRVJLV</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span><span class="hljs-type"><span class="hljs-type">lfcL5ajdNBJXkv</span></span> <span class="hljs-type"><span class="hljs-type">KqDbx8d3ZBtEVAAqeKlw0LqzScgmCbWQx2kUzukX5LSxbTpT0Th984Vp1sl7</span></span> <span class="hljs-type"><span class="hljs-type">iPk7UTA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBCp5GcwidcEMA</span></span>+<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-type"><span class="hljs-type">wjAM</span></span> <span class="hljs-type"><span class="hljs-type">blkKgBCR</span></span>/<span class="hljs-type"><span class="hljs-type">f9KGXUgLh3</span></span>/<span class="hljs-type"><span class="hljs-type">Ok60OIT5</span></span>]</code> </pre> <br><p style=";text-align:right;direction:rtl">  يبدو أننا انتهينا من التحضير ، الآن يمكننا أن نفكر في مثال. </p><br><h3 id="primer-na-palcah" style=";text-align:right;direction:rtl">  مثال الإصبع </h3><br><p style=";text-align:right;direction:rtl">  <strong>المفسد</strong> : <em>سيكون</em> هناك <em>العديد من التكوينات ، لذلك يمكن لأولئك المهتمين بهذه المقالة ذات الأهمية النظرية البحتة تخطي هذا القسم والذهاب إلى النهاية.</em> </p><br><p style=";text-align:right;direction:rtl">  دعنا الآن نلقي نظرة على مثال لكيفية تكوين خادم باستخدام hiera في دمية 4.  لن أنشر الرمز لجميع الملفات الشخصية ، وإلا فسيكون المنشور كبيرًا جدًا.  سأركز على التسلسل الهرمي وتكوين الحيرة. </p><br><p style=";text-align:right;direction:rtl">  <strong>المهمة هي:</strong> نحن بحاجة إلى نشر: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  خادمي db متطابقين يتم نشر postgresql عليهما </li><li style=";text-align:right;direction:rtl">  خادمان آخران - الواجهة الأمامية مع nginx </li><li style=";text-align:right;direction:rtl">  الخادم الخامس والسادس - backth python in docker </li><li style=";text-align:right;direction:rtl">  كل شيء هو نفسه في بيئة مطور البرامج ، باستثناء بعض إعدادات الخادم </li></ul><br><p style=";text-align:right;direction:rtl">  سننشئ التسلسل الهرمي الخاص بنا بالترتيب وسنبدأ بملف المشروع. </p><br><h4 id="proekt" style=";text-align:right;direction:rtl">  المشروع </h4><br><p style=";text-align:right;direction:rtl">  قم <strong><code>projects/kicker.yaml</code></strong> ملف المشروع <strong><code>projects/kicker.yaml</code></strong> .  نضع فيه ما هو مشترك بين جميع الخوادم: نحتاج إلى بعض المستودعات والمجلدات للنشر ، بالإضافة إلى مستخدم النشر نفسه. </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs ruby">--- <span class="hljs-symbol"><span class="hljs-symbol">classes:</span></span> - apt::debian::semrush <span class="hljs-symbol"><span class="hljs-symbol">files:</span></span> <span class="hljs-string"><span class="hljs-string">"/srv/data"</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">ensure:</span></span> <span class="hljs-string"><span class="hljs-string">'directory'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">owner:</span></span> <span class="hljs-string"><span class="hljs-string">'deploy'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">group:</span></span> <span class="hljs-string"><span class="hljs-string">'www-data'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">mode:</span></span> <span class="hljs-string"><span class="hljs-string">'0755'</span></span> <span class="hljs-string"><span class="hljs-string">'/srv/data/shared_temp'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">ensure:</span></span> <span class="hljs-string"><span class="hljs-string">'directory'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">owner:</span></span> <span class="hljs-string"><span class="hljs-string">'deploy'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">group:</span></span> <span class="hljs-string"><span class="hljs-string">'www-data'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">mode:</span></span> <span class="hljs-string"><span class="hljs-string">'0775'</span></span> user_management::<span class="hljs-symbol"><span class="hljs-symbol">present:</span></span> - deploy</code> </pre> <br><h4 id="rol-db" style=";text-align:right;direction:rtl">  دور ديسيبل </h4><br><p style=";text-align:right;direction:rtl">  إنشاء ملف دور <strong><code>projects/kicker/db.yaml</code></strong> قاعدة بيانات <strong><code>projects/kicker/db.yaml</code></strong> .  حتى الآن ، سنفعل ذلك دون تقسيم الخوادم إلى بيئات: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs ruby">--- <span class="hljs-symbol"><span class="hljs-symbol">classes:</span></span> - profiles::db::postgresql profiles::db::postgresql::<span class="hljs-symbol"><span class="hljs-symbol">globals:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">manage_package_repo:</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-symbol"><span class="hljs-symbol">version:</span></span> <span class="hljs-string"><span class="hljs-string">'10'</span></span> profiles::db::postgresql::<span class="hljs-symbol"><span class="hljs-symbol">db_configs:</span></span> <span class="hljs-string"><span class="hljs-string">'listen_addresses'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">value:</span></span> <span class="hljs-string"><span class="hljs-string">'*'</span></span> profiles::db::postgresql::<span class="hljs-symbol"><span class="hljs-symbol">databases:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">kicker:</span></span> {} profiles::db::postgresql::<span class="hljs-symbol"><span class="hljs-symbol">hba_rules:</span></span> <span class="hljs-string"><span class="hljs-string">'local connect to kicker'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">type:</span></span> <span class="hljs-string"><span class="hljs-string">'local'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">database:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">user:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">auth_method:</span></span> <span class="hljs-string"><span class="hljs-string">'md5'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">order:</span></span> <span class="hljs-string"><span class="hljs-string">'001'</span></span> <span class="hljs-string"><span class="hljs-string">'allow connect from 192.168.1.100'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">type:</span></span> <span class="hljs-string"><span class="hljs-string">'host'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">database:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">user:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">auth_method:</span></span> <span class="hljs-string"><span class="hljs-string">'md5'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">address:</span></span> <span class="hljs-string"><span class="hljs-string">'192.168.1.100/32'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">order:</span></span> <span class="hljs-string"><span class="hljs-string">'002'</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  نقوم هنا بتوصيل ملف تعريف واحد مكتوب للاستخدام العام من قبل كل من يريد تثبيت postgres على خادمهم.  الملف الشخصي قابل للتهيئة ويسمح لك بتهيئة الوحدة بمرونة قبل تطبيقها. </p><br><p style=";text-align:right;direction:rtl">  بالنسبة إلى الأكثر فضولًا ، أسفل رمز القط لهذا الملف الشخصي: </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">الملف الشخصي :: ديسيبل :: postgresql</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="hljs mel">class profiles::db::postgresql ( Hash $globals = {}, Hash $params = {}, Hash $recovery = {}, Hash[String, Hash[String, Variant[String, Boolean, Integer]]] $roles = {}, Hash[String, Hash[String, Variant[String, Boolean]]] $db_configs = {}, Hash[String, Hash[String, Variant[String, Boolean]]] $databases = {}, Hash[String, String] $db_grants = {}, Hash[String, Hash[String, String]] $extensions = {}, Hash[String, String] $table_grants = {}, Hash[String, Hash[String, String]] $hba_rules = {}, Hash[String, String] $indent_rules = {}, Optional[String] $role = undef, # <span class="hljs-string"><span class="hljs-string">'master'</span></span>, <span class="hljs-string"><span class="hljs-string">'slave'</span></span> Optional[String] $master_host = undef, Optional[String] $replication_password = undef, Integer $master_port = <span class="hljs-number"><span class="hljs-number">5432</span></span>, String $replication_user = <span class="hljs-string"><span class="hljs-string">'repl'</span></span>, String $trigger_file = <span class="hljs-string"><span class="hljs-string">'/tmp/pg_trigger.file'</span></span>, ){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> $role { <span class="hljs-string"><span class="hljs-string">'slave'</span></span>: { $_params = { manage_recovery_conf =&gt; true, } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> $globals[<span class="hljs-string"><span class="hljs-string">'datadir'</span></span>] { <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> { <span class="hljs-string"><span class="hljs-string">"${globals['datadir']}/recovery.done"</span></span>: ensure =&gt; absent, } } $_recovery = { <span class="hljs-string"><span class="hljs-string">'recovery config'</span></span> =&gt; { standby_mode =&gt; <span class="hljs-string"><span class="hljs-string">'on'</span></span>, primary_conninfo =&gt; <span class="hljs-string"><span class="hljs-string">"host=${master_host} port=${master_port} user=${replication_user} password=${replication_password}"</span></span>, trigger_file =&gt; $trigger_file, } } $_conf = { <span class="hljs-string"><span class="hljs-string">'hot_standby'</span></span> =&gt; { value =&gt; <span class="hljs-string"><span class="hljs-string">'on'</span></span>, }, } <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> { $trigger_file: ensure =&gt; absent, } } <span class="hljs-string"><span class="hljs-string">'master'</span></span>: { $_conf = { <span class="hljs-string"><span class="hljs-string">'wal_level'</span></span> =&gt; { value =&gt; <span class="hljs-string"><span class="hljs-string">'replica'</span></span>, }, <span class="hljs-string"><span class="hljs-string">'max_wal_senders'</span></span> =&gt; { value =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>, }, <span class="hljs-string"><span class="hljs-string">'wal_keep_segments'</span></span> =&gt; { value =&gt; <span class="hljs-number"><span class="hljs-number">32</span></span>, }, } <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> { $trigger_file: ensure =&gt; present, } } <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: { $_params = {} $_recovery = {} $_conf = {} } } class { <span class="hljs-string"><span class="hljs-string">'::postgresql::globals'</span></span>: * =&gt; $globals, } class { <span class="hljs-string"><span class="hljs-string">'::postgresql::server'</span></span>: * =&gt; deep_merge($_params, $params), } create_resources(<span class="hljs-string"><span class="hljs-string">'::postgresql::server::config_entry'</span></span>, deep_merge($_conf, $db_configs)) create_resources(<span class="hljs-string"><span class="hljs-string">'::postgresql::server::role'</span></span>, $roles) create_resources(<span class="hljs-string"><span class="hljs-string">'::postgresql::server::database'</span></span>, $databases) create_resources(<span class="hljs-string"><span class="hljs-string">'::postgresql::server::database_grant'</span></span>, $db_grants) create_resources(<span class="hljs-string"><span class="hljs-string">'::postgresql::server::extension'</span></span>, $extensions) create_resources(<span class="hljs-string"><span class="hljs-string">'::postgresql::server::table_grant'</span></span>, $table_grants) create_resources(<span class="hljs-string"><span class="hljs-string">'::postgresql::server::pg_hba_rule'</span></span>, $hba_rules) create_resources(<span class="hljs-string"><span class="hljs-string">'::postgresql::server::pg_indent_rule'</span></span>, $indent_rules) create_resources(<span class="hljs-string"><span class="hljs-string">'::postgresql::server::recovery'</span></span>, deep_merge($_recovery, $recovery)) }</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  وبالتالي ، نقوم بتثبيت <code>Postgresql 10</code> ضربة واحدة ، وتكوين التكوين ( <code>listen</code> ) ، وإنشاء قاعدة بيانات <code>kicker</code> ، وكذلك كتابة قاعدتين للوصول إلى قاعدة البيانات هذه في <code>pg_hba.conf</code> .  رائع! </p><br><h4 id="rol-frontend" style=";text-align:right;direction:rtl">  دور الواجهة </h4><br><p style=";text-align:right;direction:rtl">  نتخذ <code>frontend</code> .  قم <strong><code>projects/kicker/frontend.yaml</code></strong> ملف <strong><code>projects/kicker/frontend.yaml</code></strong> بالمحتويات التالية: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs ruby">--- <span class="hljs-symbol"><span class="hljs-symbol">classes:</span></span> - profiles::webserver::nginx profiles::webserver::nginx::<span class="hljs-symbol"><span class="hljs-symbol">servers:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker.semrush.com'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">use_default_location:</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-symbol"><span class="hljs-symbol">listen_port:</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-symbol"><span class="hljs-symbol">server_name:</span></span> - <span class="hljs-string"><span class="hljs-string">'kicker.semrush.com'</span></span> profiles::webserver::nginx::<span class="hljs-symbol"><span class="hljs-symbol">locations:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker-root'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">location:</span></span> <span class="hljs-string"><span class="hljs-string">'/'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">server:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker.semrush.com'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">proxy:</span></span> <span class="hljs-string"><span class="hljs-string">'http://kicker-backend.semrush.com:8080'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">proxy_set_header:</span></span> - <span class="hljs-string"><span class="hljs-string">'X-Real-IP $remote_addr'</span></span> - <span class="hljs-string"><span class="hljs-string">'X-Forwarded-for $remote_addr'</span></span> - <span class="hljs-string"><span class="hljs-string">'Host kicker.semrush.com'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">location_cfg_append:</span></span> <span class="hljs-string"><span class="hljs-string">'proxy_next_upstream'</span></span>: <span class="hljs-string"><span class="hljs-string">'error timeout invalid_header http_500 http_502 http_503 http_504'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">proxy_connect_timeout:</span></span> <span class="hljs-string"><span class="hljs-string">'5'</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  كل شيء بسيط هنا.  نقوم بتوصيل <strong><code>profiles::webserver::nginx</code></strong> الشخصية ، التي تعد الدخول إلى وحدة nginx ، كما نحدد المتغيرات ، وتحديدًا <code>server</code> <code>location</code> لهذا الموقع. </p><br><p style=";text-align:right;direction:rtl">  سيلاحظ القارئ اليقظ أنه سيكون من الأنسب وضع وصف الموقع أعلى في التسلسل الهرمي ، لأنه لا يزال لدينا بيئة <code>server_name</code> ، وسيتم استخدام المتغيرات الأخرى ( <code>server_name</code> <code>proxy</code> ، <code>proxy</code> ) ، ولكن هذا ليس مهمًا جدًا.  لوصف الدور بهذه الطريقة ، يمكننا أن نرى كيف يتم إعادة تعريف هذه المتغيرات فقط من خلال التسلسل الهرمي. </p><br><h4 id="rol-docker" style=";text-align:right;direction:rtl">  دور عامل الميناء </h4><br><p style=";text-align:right;direction:rtl">  دور <strong><code>projects/kicker/docker.yaml</code></strong> <code>docker</code> <strong><code>projects/kicker/docker.yaml</code></strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs ruby">--- <span class="hljs-symbol"><span class="hljs-symbol">classes:</span></span> - profiles::docker profiles::docker::<span class="hljs-symbol"><span class="hljs-symbol">params:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">version:</span></span> <span class="hljs-string"><span class="hljs-string">'17.05.0~ce-0~debian-stretch'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">packages:</span></span> <span class="hljs-string"><span class="hljs-string">'python3-pip'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">provider:</span></span> apt <span class="hljs-string"><span class="hljs-string">'Fabric3'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">provider:</span></span> pip3 <span class="hljs-symbol"><span class="hljs-symbol">ensure:</span></span> <span class="hljs-number"><span class="hljs-number">1.12</span></span>.post1 user_management::<span class="hljs-symbol"><span class="hljs-symbol">users:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">deploy:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">groups:</span></span> - docker</code> </pre> <br><p style=";text-align:right;direction:rtl">  <strong><code>profiles/docker.pp</code></strong> بسيط للغاية وأنيق.  سأقدم رمزه: </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">الملف الشخصي :: عامل الميناء</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">profiles</span></span></span><span class="hljs-class">:</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">:docker </span></span></span></span>( Hash $params = {}, <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> $install_kernel = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, ){ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-string"><span class="hljs-string">'docker'</span></span>: * =&gt; $params, } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($install_kernel) { include profiles::docker::kernel } }</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  كل شيء جاهز.  هذا يكفي بالفعل لنشر المنتج الذي نحتاجه على العديد من الخوادم ، ببساطة تعيين مشروع ودور معين لهم (على سبيل المثال ، وضع الملف بالتنسيق المطلوب في دليل facts.d ، والذي يعتمد موقعه على طريقة تثبيت العميل). </p><br><p style=";text-align:right;direction:rtl">  الآن لدينا هيكل الملف التالي: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">. ├── kicker │ ├── db.yaml │ ├── docker.yaml │ └── frontend.yaml └── kicker.yaml 1 directory, 4 files</code> </pre> <br><p style=";text-align:right;direction:rtl">  سنتعامل الآن مع البيئات وتعريف التهيئة الفريدة لدور على موقع معين. </p><br><h4 id="okruzheniya-i-override" style=";text-align:right;direction:rtl">  البيئة وتجاوز </h4><br><p style=";text-align:right;direction:rtl">  لنقم بإنشاء التكوين العام لجميع المبيعات.  يحتوي ملف <strong><code>projects/kicker/tiers/prod.yaml</code></strong> على إشارة إلى أننا بحاجة إلى توصيل فئة بجدار حماية بهذه البيئة (حسنًا ، كل نفس الشيء) ، بالإضافة إلى فئة معينة توفر مستوى أعلى من الأمان: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">--- classes: - semrush_firewall - strict_security_level</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  بالنسبة لبيئة التطوير ، إذا كنا بحاجة إلى وصف شيء محدد ، يتم إنشاء نفس الملف ويتم إدخال التكوين الضروري فيه. </p><br><p style=";text-align:right;direction:rtl">  بعد ذلك ، ما زلت بحاجة إلى إعادة تعريف المتغيرات لتكوين nginx لدور <code>frontend</code> في بيئة التطوير.  للقيام بذلك ، تحتاج إلى إنشاء ملف <strong><code>projects/kicker/tiers/dev/frontend.yaml</code></strong> .  انتبه إلى مستوى جديد من التسلسل الهرمي. </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs ruby">--- profiles::webserver::nginx::<span class="hljs-symbol"><span class="hljs-symbol">servers:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker-dev.semrush.com'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">use_default_location:</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-symbol"><span class="hljs-symbol">listen_port:</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-symbol"><span class="hljs-symbol">server_name:</span></span> - <span class="hljs-string"><span class="hljs-string">'kicker-dev.semrush.com'</span></span> profiles::webserver::nginx::<span class="hljs-symbol"><span class="hljs-symbol">locations:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker-root'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">location:</span></span> <span class="hljs-string"><span class="hljs-string">'/'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">server:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker-dev.semrush.com'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">proxy:</span></span> <span class="hljs-string"><span class="hljs-string">'http://kicker-backend-dev.semrush.com:8080'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">proxy_set_header:</span></span> - <span class="hljs-string"><span class="hljs-string">'X-Real-IP $remote_addr'</span></span> - <span class="hljs-string"><span class="hljs-string">'X-Forwarded-for $remote_addr'</span></span> - <span class="hljs-string"><span class="hljs-string">'Host kicker-dev.semrush.com'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">location_cfg_append:</span></span> <span class="hljs-string"><span class="hljs-string">'proxy_next_upstream'</span></span>: <span class="hljs-string"><span class="hljs-string">'error timeout invalid_header http_500 http_502 http_503 http_504'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">proxy_connect_timeout:</span></span> <span class="hljs-string"><span class="hljs-string">'5'</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  لم تعد بحاجة إلى تحديد فئة ؛ فهي موروثة من المستويات السابقة للتسلسل الهرمي.  هنا قمنا بتغيير <code>server_name</code> <code>proxy_pass</code> و <code>proxy_pass</code> .  الخادم الذي له دور الحقائق = frontend و tier = dev سيجد أولاً ملف <strong><code>projects/kicker/frontend.yaml</code></strong> لنفسه ، ولكن بعد ذلك سيتم تجاوز المتغيرات من هذا الملف بملف <strong><code>projects/kicker/tiers/dev/frontend.yaml</code></strong> بأولوية أعلى . </p><br><h4 id="sokrytie-parolya-dlya-postgresql" style=";text-align:right;direction:rtl">  إخفاء كلمة المرور لـ PostgreSQL </h4><br><p style=";text-align:right;direction:rtl">  وهكذا لدينا البند الأخير في جدول الأعمال - تعيين كلمات المرور لـ PostgreSQL. </p><br><p style=";text-align:right;direction:rtl">  يجب أن تختلف كلمات المرور في البيئات.  سنستخدم Eyaml لتخزين كلمات المرور بشكل آمن.  إنشاء كلمات المرور: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">eyaml encrypt -s <span class="hljs-string"><span class="hljs-string">'verysecretpassword'</span></span> eyaml encrypt -s <span class="hljs-string"><span class="hljs-string">'testpassword'</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  نقوم بلصق الخطوط الناتجة في الملفات <code>**projects/kicker/tiers/prod/db.yaml**</code> و <code>**projects/kicker/tiers/prod/db.yaml**</code> <code>**projects/kicker/tiers/dev/db.yaml**</code> (أو يمكنك استخدام امتداد eyaml ، هذا قابل للتخصيص) ، على التوالي.  هنا مثال: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs ruby">--- profiles::db::postgresql::<span class="hljs-symbol"><span class="hljs-symbol">roles:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">password_hash:</span></span> &gt; <span class="hljs-string"><span class="hljs-string">'ENC[PKCS7,MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEAsdpb2P0axUJzyWr2duRKAjh0WooGYUmoQ5gw0nO9Ym5ftv6uZXv25DRMKh7vsbzrrOR5/lLesx/pAVmcs2qbhd/y0Vr1oc2ohHlZBBKtCSEYwem5VN+kTMhWPvlt93x/S9ERoBp8LrrsIvicSYZByNfpS2DXCFbogSXCfEPxTTmCOtlOnxdjidIc9Q1vfAXv7FRQanYIspr2UytScm56H/ueeAc/8RYK51/nXDMtdPOiAP5VARioUKyTDSk8FqNvdUZRqA3cl+hA+xD5PiBHn5T09pnH8HyE/39q09gE0pXRe5+mOnU/4qfqFPc/EvAgAq5mVawlCR6c/cCKln5wJTA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBDNKijGHBLPCth0sfwAjfl/gBAaPsfvzZQ/Umgjy1n+im0s]'</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  بعد ذلك ، ستأتي كلمة مرور دور <code>kicker</code> ، وسيتم فك تشفيرها وتطبيقها على خادم قاعدة البيانات في PostgreSQL. </p><br><p style=";text-align:right;direction:rtl">  هذا ، في الواقع ، كل شيء.  نعم ، اتضح أن المثال ضخم ، ولكن آمل أن يكون عمليًا ، لا يترك أسئلة ، واضحة ومفيدة.  التسلسل الهرمي الناتج في الحيرة هو: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">. ├── db.yaml ├── docker.yaml ├── frontend.yaml └── tiers ├── dev │ ├── db.yaml │ └── frontend.yaml ├── prod │ └── db.yaml └── prod.yaml 3 directories, 7 files</code> </pre> <br><p style=";text-align:right;direction:rtl">  يمكنك مشاهدة هذه الملفات مباشرة عن طريق استنساخ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">مستودع</a> تم إنشاؤه خصيصًا </p><br><h3 id="zaklyuchenie" style=";text-align:right;direction:rtl">  الخلاصة </h3><br><p style=";text-align:right;direction:rtl">  دمية جيدة وسهلة الاستخدام مع هيرا.  لن أسميها أداة تكوين مثالية في العالم الحديث ، على الإطلاق ، ولكنها تستحق الاهتمام.  يتعامل مع بعض المهام بشكل جيد للغاية ، و "فلسفته" في الحفاظ على حالة متطابقة باستمرار من الموارد والتكوين يمكن أن تلعب دورًا مهمًا في ضمان أمان واتساق التكوينات. </p><br><p style=";text-align:right;direction:rtl">  يتعاون العالم الحديث ويتطور تدريجياً.  قليل من الناس يستخدمون الآن نظام تكوين واحدًا فقط ، وغالبًا ما يكون في ترسانة الأجهزة والمديرين العديد من الأنظمة في وقت واحد.  وهذا أمر جيد ، لأن هناك الكثير للاختيار من بينها.  الشيء الرئيسي هو أن كل شيء يجب أن يكون منطقيًا ومفهومًا ، وكيف وأين يمكن تكوينه. </p><br><p style=";text-align:right;direction:rtl">  نتيجة لذلك ، هدفنا كمسؤولين هو تكوين أي شيء بأنفسنا.  كل هذا يجب أن يتم بشكل مثالي من قبل الفرق نفسها.  ويجب أن نمنحهم أداة أو منتجًا يتيح لنا القيام بذلك بأمان وسهولة وأهم من ذلك ، مع نتيجة دقيقة.  حسنًا ، والمساعدة في حل المشكلات المعمارية والأكثر خطورة من "تحتاج إلى تثبيت PostgreSQL على الخادم وإنشاء مستخدم".  كامون ، 2018 في الفناء! <del>  لذا قم برمي العرائس والأمل وانتقل إلى المستقبل بدون خادم. </del></p><br><p style=";text-align:right;direction:rtl">  مع تطور أنظمة السحب وتنظيم الحاويات وتنظيم الحاويات ، تتراجع أنظمة إدارة التكوين ببطء في الخلفية للمستخدمين والعملاء.  يمكنك أيضًا رفع مجموعة من الحاويات الآمنة من الفشل في السحابة والاحتفاظ بتطبيقاتك في حاويات مع التعرية التلقائية والنسخ الاحتياطي والنسخ والاكتشاف التلقائي ، وما إلى ذلك ، دون كتابة سطر واحد لـ ansible ، دمية ، طاه ، إلخ.  لست مضطرًا لرعاية أي شيء (حسنًا ، تقريبًا).  من ناحية أخرى ، هناك عدد أقل من خوادم الحديد بسبب السحب.  كل ما في الأمر أنك لم تعد بحاجة إلى تهيئتها ، فإن هذا الإجراء هو مسؤولية مزود الخدمة السحابية.  لكن من غير المرجح أن يستخدموا نفس الأنظمة التي يستخدمها البشر العاديون. </p><br><h4 id="credits" style=";text-align:right;direction:rtl">  ائتمانات </h4><br><p style=";text-align:right;direction:rtl">  شكرا: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  دميتري توبيتسين ، ديمتري لوجينوف ، ستيبان فيدوروف والفريق بأكمله من مسؤولي النظام لمساعدتهم في إعداد هذه المقالة </li><li style=";text-align:right;direction:rtl">  فلاديمير ليجكوستوبوف للصورة </li><li style=";text-align:right;direction:rtl">  يانا تاباكوفا لتنظيم كل هذا والمساعدة في اجتياز جميع مراحل ما قبل النشر </li><li style=";text-align:right;direction:rtl">  نيكيتا زاخاروف للمساعدة في مسائل الترخيص </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar412587/">https://habr.com/ru/post/ar412587/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar412573/index.html">ما هو الخطأ في Geektimes العودة إلى هبر</a></li>
<li><a href="../ar412575/index.html">في كل عام ، تصبح موسيقى البوب ​​رتيبة أكثر فأكثر ، لأن نفس الأشخاص يؤلفونها</a></li>
<li><a href="../ar412579/index.html">Marvel: Infinity War أو كيفية جمع البيانات لمشروعك في بضع دقائق</a></li>
<li><a href="../ar412581/index.html">من العصر الحجري إلى الحرب العالمية الثانية: كيف يتم استخدام الروبوتات للبحث عن القطع الأثرية التاريخية</a></li>
<li><a href="../ar412583/index.html">نقوم بتفكيك بروتوكول غلاية Redmond G200S وتوصيله بـ HomeAssistant</a></li>
<li><a href="../ar412589/index.html">25 مكتبة أندرويد مسلية. ربيع 2018</a></li>
<li><a href="../ar412591/index.html">بناء jetpack: 29 مايو هو يوم ويندل مور التذكاري</a></li>
<li><a href="../ar412593/index.html">المنتجات الجديدة والمنصات وجميع الخدمات: HPE Webinars</a></li>
<li><a href="../ar412595/index.html">تقرير نادي روما 2018 ، الفصل 1.1.2: "التمويل"</a></li>
<li><a href="../ar412597/index.html">سيقوم جيف بيزوس ببناء مستعمرة على سطح القمر</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>