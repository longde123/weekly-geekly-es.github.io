<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèæ‚Äçüè´ ü§≤üèæ #‚É£ Blackbox-√úberwachung in Clos-Netzwerken. Yandex-Bericht ‚òïÔ∏è üë®üèº‚Äçüè≠ üõÅ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Topologie moderner Rechenzentren und Ger√§te in ihnen erm√∂glicht es uns nicht mehr, uns ausschlie√ülich mit der Whitebox-√úberwachung zu begn√ºgen. Im...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Blackbox-√úberwachung in Clos-Netzwerken. Yandex-Bericht</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/473834/"> Die Topologie moderner Rechenzentren und Ger√§te in ihnen erm√∂glicht es uns nicht mehr, uns ausschlie√ülich mit der <abbr title="Eine Art der √úberwachung basierend auf Metriken, die von Anwendungen auf dem Ger√§t abgerufen wurden. Die Whitebox-√úberwachung umfasst beispielsweise das Sammeln von Protokollen und das √úberpr√ºfen des Sitzungsstatus.">Whitebox-√úberwachung</abbr> zu begn√ºgen.  Im Laufe der Zeit brauchte ich ein Tool, das die Leistung bestimmter Ger√§te basierend auf der tats√§chlichen Situation bei der √úbertragung von Datenverkehr (Datenebene) an eine beliebige Stelle im <abbr title="Klose Network ist eine Art mehrstufiges Vermittlungsnetzwerk, das von Charles Klose beschrieben wird. Weit verbreitet in Rechenzentren.">Clos-Netzwerk</abbr> anzeigt.  Vor einigen Wochen teilte der Yandex-Netzwerkingenieur Alexander Klimenko auf der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Next Hop-</a> Konferenz seine Erfahrungen bei der L√∂sung dieses Problems mit. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/o3/kv/n3/o3kvn3oecpuipgvx68yuzfib4t4.jpeg"></a> <br><br>  - Ich arbeite in der Betriebs- und Entwicklungsabteilung des Yandex-Netzwerks und manchmal zwingen sie mich, einige Probleme zu l√∂sen, anstatt sch√∂ne Wolken auf Flugbl√§tter zu zeichnen oder eine gl√§nzende Zukunft zu erfinden.  Die Leute kommen und sagen, dass etwas f√ºr sie nicht funktioniert.  Wenn diese Angelegenheit √ºberwacht wird und unsere diensthabenden Ingenieure feststellen, dass sie nicht funktioniert, ist es f√ºr mich selbst einfacher.  Diese halbe Stunde wird also der √úberwachung gewidmet sein. <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/wi/m7/gn/wim7gnm9iv9s50sfcujeemna250.jpeg"><br><br>  Fr√ºher oder sp√§ter kommt jeder auf die Idee der √úberwachung.  Das hei√üt, zuerst k√∂nnen Sie Appelle der Benutzer selbst sammeln, sie werden auf Sie klopfen und sagen, dass etwas f√ºr sie nicht funktioniert.  Es ist jedoch klar, dass ein solches System nicht gut skaliert.  Wenn Sie mehr als einen Switch haben, wenn Sie ein ausreichend gro√ües Netzwerk haben, k√∂nnen Sie mit dieser √úberwachungsoption nicht weit kommen. <br><br>  Und fr√ºher oder sp√§ter kommen alle zu dem Schluss, dass es notwendig ist, einige Daten von den Ger√§ten zu sammeln.  Dies ist der allererste Schritt.  Es k√∂nnen Protokolle, verschiedene Daten zu SNMP, Drops, Sie k√∂nnen Topologien gem√§√ü LLDP erstellen usw. sein. Es gibt ein klares Minus - das Ger√§t selbst stellt Ihnen all diese Informationen zur Verf√ºgung.  Es darf nichts sagen, dich t√§uschen usw. <br><br>  Die logische Phase bei der Entwicklung Ihrer √úberwachung ist die √úberwachung auf Hosts.  Wir k√∂nnen sagen, dass es einen kleinen Zweig gibt.  Wenn Sie das Gl√ºck haben oder nicht, ein Netzwerk bei einem Anbieter zu haben, kann der Anbieter Ihnen einige Ihrer eigenen √úberwachungsoptionen anbieten.  Aber letztes Jahr bei Next Hop <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">sagte</a> Dima Ershov <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">,</a> dass unsere Fabrik von zwei einfachen Anbietern gegr√ºndet wurde und wir uns einen solchen Luxus nicht leisten k√∂nnen.  Oder wir k√∂nnen, aber nur teilweise. <br><br>  Endlich die letzte Option, die jeder irgendwie mit der Entwicklung des Netzwerks erreicht.  Dies ist die √úberwachung auf Endhosts.  Yandex hat eine solche √úberwachung.  Es hei√üt Netmon. <br><br><img src="https://habrastorage.org/webt/8j/kj/_w/8jkj_whnq8eze73jzmmc_w_c-_q.jpeg"><br><br>  Am Ende der Folie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">befindet sich ein Link mit einer detaillierten Darstellung der</a> Funktionsweise von Netmon.  Ich werde es buchst√§blich auf einer Folie erz√§hlen.  Wenn jemand m√∂chte, lesen Sie bitte den Vortrag von einer anderen Netmon-Konferenz. <br><br>  Netmon sind Agenten, die auf fast jedem Host im Netzwerk installiert sind.  Die Aufgabe kommt bei den Agenten an: einige Pakete an einen Netzwerkknoten zu senden.  Sie k√∂nnen v√∂llig unterschiedlich sein: UDP, TCP, ICMP.  Es k√∂nnen verschiedene Farben sein, dh DSCP und Bestimmungsort.  Quell- und Zielports k√∂nnen ebenfalls unterschiedlich sein. <br><br>  Diese Daten werden aggregiert, in einen separaten Speicher hochgeladen, und wir erhalten hier ein Segment wie das rechts in der Abbildung.  Ein Slice kann mehr oder weniger aggregiert sein, je nachdem, was wir sehen m√∂chten.  Zum Beispiel haben wir hier, soweit ich sehe, einen Teil der gesamten Konnektivit√§t von Rechenzentren, dh zwischen all unseren Rechenzentren.  Wir k√∂nnen tiefer in die Quadrate hineinfallen - sehen Sie die Konnektivit√§t zwischen dem POD oder innerhalb des Geb√§udes eines Rechenzentrums;  noch tiefer - im POD zwischen den Racks;  und noch tiefer - sogar innerhalb des Racks. <br><br><img src="https://habrastorage.org/webt/ea/iq/to/eaiqtolvrecwgo0apgnxdc2rgy0.jpeg"><br><br>  Was k√∂nnte hier m√∂glicherweise schief gehen?  Ein kleiner Exkurs f√ºr diejenigen, die den Next Hop des letzten Jahres nicht gesehen haben. <br><br>  Wir haben 400 Gigabit pro ToR verwendet und im ersten Moment der Implementierung dieser Fabrik nur 200 eingeschlossen, weil es wichtigere Aufgaben gab.  Egal warum.  Sie schalteten 200 ein, Dienste kamen und sagten: Warum 200?  Wir wollen 400!  Begann es einzuschalten.  Und so kam es, dass der zweite Teil der Fabrik, den wir mit einbezogen hatten, eine Art Ehe im Ged√§chtnis der Karten hatte.  Als Ergebnis schalten wir die Fabrik ein und sehen dieses Bild: <br><br><img src="https://habrastorage.org/webt/-m/mt/vb/-mmtvbpckx_kmr42-u3dwoditz4.jpeg"><br><br>  Dieses Netmon, die roten Quadrate, brennt.  Wir verstehen, dass alles verloren ist.  Wir greifen wie Homer nach unseren K√∂pfen und versuchen, etwas hektisch zu schieben.  Und was zu dr√ºcken, was auszuschalten ist, verstehen wir nicht.  Das hei√üt, Netmon zeigt uns das Vorhandensein eines Problems an, zeigt jedoch nicht an, wo sich das Problem tats√§chlich im Netzwerk befindet. <br><br><img src="https://habrastorage.org/webt/ef/sg/tu/efsgtu9frnrwu4mcwoajkhqtw4m.jpeg"><br><br>  Wir sind zu der Aufgabe gekommen, die wir erf√ºllen m√ºssen.  Was ist zu tun?  Stellen Sie fest, bei welchem ‚Äã‚ÄãGer√§t im Netzwerk ein Problem vorliegt, und nehmen Sie es au√üer Betrieb - entweder automatisch oder durch die Kr√§fte von beispielsweise Dienstingenieuren <br><br>  Dar√ºber hinaus sind die Anfangsbedingungen so, dass wir eine ziemlich regelm√§√üige Topologie haben, das hei√üt, es gibt keine merkw√ºrdigen Verbindungen zwischen Spins der zweiten Ebene oder zwischen Tori.  Wir haben den gr√∂√üten Teil des Datenverkehrs - TCP, es gibt einen zentralen Ort, der uns bereits mitgeteilt wurde, und die Server werden mehr oder weniger zentral verwaltet.  Wir k√∂nnen an diesen zentralen Ort kommen und vern√ºnftigerweise erkl√§ren: Leute, wir wollen das, bitte. <br><br>  Welche Optionen haben wir in Betracht gezogen? <br><br><img src="https://habrastorage.org/webt/y-/cx/1m/y-cx1mnilmeqpxmlibivrgychbq.jpeg"><br><br>  Das erste, was mir in den Sinn kommt, ist die R√ºckverfolgung.  Warum?  Da dasselbe Netmon die fehlgeschlagenen Quell- und Zielpaare in einen separaten Kollektor entl√§dt.  Dementsprechend k√∂nnen wir dieses 5-Tupel nehmen, es betrachten und eine Spur mit denselben Parametern erstellen.  Und um Daten dar√ºber zu aggregieren, √ºber welche Verbindung oder √ºber welche Ger√§te die meisten Traces durchlaufen werden. <br><br>  Leider wird MPLS in unserer Fabrik verwendet (jetzt bewegen wir uns in die entgegengesetzte Richtung wie MPLS, aber wir m√ºssen auch die alten Fabriken irgendwie √ºberwachen, aber sie nicht wegwerfen).  Wir haben MPLS in der Fabrik, und das Problem mit MPLS und Ablaufverfolgung besteht darin, dass die TTL-√ºberschrittene ICMP-Nachricht getunnelt werden muss, die der Ablaufverfolgung zugrunde liegt.  Wenn wir eine solche Nachricht von Eingang zu Ausgang verloren haben, k√∂nnen wir die √úberwachung verlieren.  Das hei√üt, wir werden nicht verstehen, √ºber welche Knoten diese Nachricht geleitet wurde.  Dies war f√ºr die √úberwachung nicht geeignet. <br><br><img src="https://habrastorage.org/webt/xl/bg/fr/xlbgfroj02orrytuqectvxi-n18.jpeg"><br><br>  Es gibt eine zweite Option in Bezug auf ECMP.  Wir nehmen das gleiche Quell- und Zielpaar, zus√§tzlich Quell-Port-Ziel-Port.  Wir kommen zu einem St√ºck Eisen, √ºber die API oder √ºber die CLI geben wir dieses St√ºck Eisen dem St√ºck Eisen zu und erhalten die Ausgabeschnittstelle.  Viele Ger√§te unterst√ºtzen diese Art der Ausgabe. <br><br>  Wir kommen zu ToR und sehen, dass ToR einen linken oder rechten Link gew√§hlt hat.  In diesem Fall ist der linke Link in Richtung des linken S1. <br><br><img src="https://habrastorage.org/webt/pf/k1/fq/pfk1fq3l3zpso1b0dtteib-ip5a.jpeg"><br><br>  Wir kamen zu diesem S1, schauten nach rechts S2 und auf diese Weise bildete sich ein fertiger Pfad. <br><br><img src="https://habrastorage.org/webt/lb/gu/7r/lbgu7r5ogih0uzo4zoazcczuuya.jpeg"><br><br>  Es gibt einige Nachteile.  Erstens k√∂nnen normalerweise nicht alle Ger√§te diese von uns angegebenen Eingabedaten akzeptieren.  Dies liegt an der Tatsache, dass wir IPv6 und MPLS haben, sowie an der Tatsache, dass einige Anbieter dies einfach nicht implementiert haben.  Das zweite Minus dieser L√∂sung: Wir verlassen uns darauf, was das St√ºck Eisen uns wieder sagt, anstatt zu sehen, was auf den Hosts passiert.  Und schlie√ülich das dritte Minus: W√§hrend Sie sehen, was dort passiert, kann sich im Netzwerk bereits etwas √§ndern, und Ihre Daten sind nicht relevant. <br><br><img src="https://habrastorage.org/webt/dy/he/_s/dyhe_sdybz_8nsum0uce40pjg2c.jpeg"><br><br>  Dann stie√üen wir auf eine interessante Pr√§sentation von Facebook.  Wir mochten die Idee, die Facebook vorschlug, und beschlossen, etwas √Ñhnliches zu versuchen. <br><br>  Was war die Hauptidee?  Verwenden Sie ein eBPF-Programm auf dem Host, um die TCP-Neu√ºbertragung einzuf√§rben, und berechnen Sie dann die Anzahl solcher Pakete.  Leider konnten wir das nicht wie auf Facebook machen, wir mussten unser eigenes Fahrrad erfinden.  Ich werde versuchen, Ihnen von dem Weg des Schmerzes und des Leidens zu erz√§hlen, den wir durchlaufen haben. <br><br><img src="https://habrastorage.org/webt/bt/5l/5e/bt5l5e9el6kbhutnjsamv3hpo5u.jpeg"><br><br>  Was haben wir getan  Nur f√ºr den Fall, ich m√∂chte darauf hinweisen, dass es sich bei der erneuten TCP-√úbertragung um TCP-Nachrichten handelt, die mehrmals wiederholt werden, da ihr Empfang nicht best√§tigt wurde.  Wir haben ein eBPF-Programm auf dem Host installiert und pr√ºfen, ob diese TCP-Nachricht erneut √ºbertragen wird oder nicht.  Es macht es kitschig - nach Sequenznummer.  Wenn in einer TCP-Sitzung dieselbe Sequenznummer √ºbertragen wird, wird diese erneut √ºbertragen. <br><br>  Was machen wir mit solchen Paketen?  Wir setzen das letzte Bit im DSCP-Feld auf eins, um das Ganze weiter zu berechnen. <br><br><img src="https://habrastorage.org/webt/rk/nh/qm/rknhqmvuhuu9vss_juaqyzlxtza.jpeg"><br><br>  Im Allgemeinen h√§ngt DSCP irgendwie mit QoS zusammen, oder?  Und mit QoS ist die Geschichte in unserem Netzwerk ziemlich kompliziert und langj√§hrig.  Wir haben bestimmte Richtlinien, die auf ToR-Switches √ºberwacht werden.  Zu diesen Richtlinien haben wir nur die Notwendigkeit hinzugef√ºgt, mehr und diese farbigen Pakete zu z√§hlen. <br><br>  Daher haben wir f√ºr farbige Pakete (lesen Sie: f√ºr TCP-Neu√ºbertragungspakete vom Host) einfach eine weitere QoS-Warteschlange hinzugef√ºgt.  Dies war einfach genug, da wir noch freie Leitungen hatten.  Dies ist au√üerdem praktisch, da es in der Phase des √úbergangs zwischen IPv6 und MPLS in der Fabrik, dh in der Phase, in der das Paket S1 fliegt und zu unserem MPLS-Teil der Fabrik √ºbergeht, praktisch ist, EXP / TC im MPLS-Paket-Header f√ºr jede bestimmte Warteschlange zu √ºbernehmen und neu zu streichen . <br><br><img src="https://habrastorage.org/webt/n1/jz/yy/n1jzyyspbgw39b3zv1xngyavgwm.jpeg"><br><br>  Was machen wir mit diesen Daten?  Wir sammeln sie mit Standard-ACL-Filtern, Verkehrsklasse.  Das hei√üt, es funktioniert im Prinzip bei jedem Anbieter.  Wir k√∂nnen die Anzahl solcher Pakete √ºberall sammeln und berechnen. <br><br>  Als n√§chstes betrachten wir die ungleichm√§√üige Verteilung solcher Pakete auf dem POD.  Darin zum Beispiel vier R√ºcken, wie auf dem Bild.  Wenn die Anzahl der Pakete auf den gelben Links, auf blau, auf gr√ºn und auf rot gleich ist, dann glauben wir, dass alles mehr oder weniger gut ist.  Wenn wir zu einem bestimmten Zeitpunkt einen Anstieg sehen, beispielsweise auf der rechten Seite der ersten Ebene, verstehen wir, dass dieses Ger√§t eine erneute √úbertragung anzieht, etwas stimmt damit nicht.  Dann versuchen wir, es entweder au√üer Betrieb zu setzen oder zumindest zu leasen.  Zumindest wenn wir Probleme mit Netmon sehen, werden wir wissen, mit welchem ‚Äã‚ÄãGer√§t sie auftreten k√∂nnen. <br><br><img src="https://habrastorage.org/webt/ky/9t/8u/ky9t8uf1v57wlbqmqsxmmtusipc.jpeg"><br><br>  Wie sieht es bei einfachen Rohdaten aus?  Hier sind zwei Grafiken.  Tats√§chlich handelt es sich hierbei um eine erneute √úbertragung von Diagrammen mit ToR in Richtung der Wirbels√§ule der ersten Ebene.  Im Beispiel zwei Wirbels√§ulen im Modul.  Das obere Diagramm ist die Aggregation der ersten Wirbels√§ule, das untere Diagramm ist die zweite Wirbels√§ule.  Das Anschauen in dieser Form ist nicht sehr praktisch, daher haben wir die Aggregation dieser Informationen hinzugef√ºgt. <br><br><img src="https://habrastorage.org/webt/ab/pu/-o/abpu-on4l0cwiglpfdftt7mzykc.jpeg"><br><br>  Es sieht so aus.  Es gibt ein Modul, in dem drei Stacheln aus irgendeinem Grund, egal welcher, und wir sehen hier eine solche Gesamtverteilung der erneuten √úbertragungen auf drei Stacheln.  Es ist im Prinzip ziemlich einheitlich. <br><br><img src="https://habrastorage.org/webt/ar/m0/cm/arm0cmbz77k8bpdu8qqerqsttto.jpeg"><br><br>  F√ºr die Wirbels√§ule der zweiten Ebene k√∂nnen verschiedene Abweichungen auftreten. Nennen wir sie so.  Die Topologie bleibt weiterhin regelm√§√üig, aber je nach Rechenzentrum k√∂nnen wir eine plattenartige Architektur verwenden oder nicht.  Der Punkt hier ist genau der gleiche.  Auf einer Ebene sollten wir ungef√§hr die gleiche Verteilung der farbigen Verpackungen haben. <br><br><img src="https://habrastorage.org/webt/if/od/og/ifodogqs86mqbfgahucjzo_wrgi.jpeg"><br><br>  Schauen wir uns einige Beispiele an.  Hat jemand ein Problem in einem solchen Diagramm?  Hier gibt es ein Problem, aber es ist nicht gleichzeitig da.  Ja, das ist Schr√∂dingers Problem.  Warum ist sie da und nicht?  Da die Anzahl der erneuten √úbertragungen zunimmt, ist es direkt offensichtlich, dass etwas f√ºr uns passiert ist.  Gleichzeitig sehen wir aber, dass dieses Wachstum ziemlich gleichm√§√üig ist.  Das hei√üt, drei Wirbels√§ulenblau, Rot, Blau, gleichm√§√üige Verteilung √ºber sie.  Was bedeutet das?  Dass es ein Problem im Netzwerk gab, h√§ngt jedoch nicht mit dieser Ebene der Datenaggregation zusammen.  Sie ist woanders. <br><br>  Vielleicht hat jemand den Port auf Firewalls geschlossen, einen Cluster getrennt, das hei√üt, etwas ist passiert.  Aber wir interessieren uns √ºberhaupt nicht daf√ºr, was da war und warum.  Das hei√üt, wir betrachten ein solches Problem nicht einmal. <br><br><img src="https://habrastorage.org/webt/ie/_4/tz/ie_4tzqchudv3zrxi6vi_mcwxgm.jpeg"><br><br>  Und hier vielleicht nicht so klar, aber das Problem ist sichtbar.  Zwei Stacheln im Modul, 46 bemalte P√§ckchen flogen auf einen und ein wenig auf den zweiten.  Wir verstehen, dass wir ein Problem mit einer Art Wirbels√§ule im Netzwerk haben, wir m√ºssen etwas dagegen tun. <br><br>  Warum habe ich zuerst √ºber den Weg des Schmerzes und des Leidens gesprochen?  Weil es bei einer solchen L√∂sung viele Probleme gibt.  Das Hauptproblem ist nat√ºrlich das Problem jeder √úberwachung, dies ist falsch positiv.  Falsch positiv war ziemlich viel.  Haupts√§chlich aufgrund der Tatsache, dass wir DSCP verwenden und im Allgemeinen an QoS gebunden sind. <br><br><img src="https://habrastorage.org/webt/ht/md/rb/htmdrbopskl2febbslxadjbqtlw.jpeg"><br><br>  Wir haben festgestellt, dass die Pakete anderer Leute in unserer Farbe fliegen und uns auf unsere √úberwachung aufmerksam machen.  Das hei√üt, wir denken, dass dies eine erneute √úbertragung ist, und jemand anderes legt seine Pakete dort ab und verdirbt im Allgemeinen das Bild f√ºr uns.  Nat√ºrlich begannen wir zu verstehen, fanden viele Orte, an denen wir dachten, dass es funktioniert, aber es funktioniert tats√§chlich nicht so, wie wir denken.  Zum Beispiel sollte der Verkehr, der in das Netzwerk eintritt, scheinbar neu gestrichen werden, der Verkehr mit den Klassen CS6 und CS7 an den Grenzen sollte nicht in unser Netzwerk gelangen.  Aber an einigen Stellen gab es beispielsweise M√§ngel, und wir haben sie erfolgreich behandelt. <br><br>  Einige Hersteller pr√§sentierten √úberraschungen in der Form, dass Sie Z√§hler in der Ausgangsrichtung solcher Pakete z√§hlen, und der Chip funktioniert so, dass er bei der Verarbeitung der Ausgangszugriffsliste den Datenverkehr erneut durch sich selbst wickelt und die H√§lfte der Chipbandbreite abbei√üt .  Es waren 900 Gigabit pro Chip, es wurde halb so viel. <br><br>  Und wir haben einige Verbesserungen vorgenommen, da die Einstellungen auf dem Host unterschiedlich sein k√∂nnen.  Das hei√üt, einige Hosts k√∂nnen h√§ufiger Neu√ºbertragungen senden, einige Hosts k√∂nnen weniger h√§ufig, einige zwei, einige f√ºnf und all diese Warnungen unserer √úberwachung, all dies ist falsch positiv. <br><br>  Zun√§chst haben wir die Idee aufgegeben, jede TCP-Neu√ºbertragung zu malen.  Wir haben erkannt, dass wir im Prinzip nicht jede erneute √úbertragung ben√∂tigen, um zu verstehen, wo das Problem liegt.  Wir fingen an, nur SYN-Retransmit zu malen.  SYN ist das erste Paket in der Sitzung. Dies reicht aus, um ein Signal zu empfangen.  Wir malen auch SYN-ACL. <br><br>  Trotzdem gab es einige falsch positive.  Wir gingen etwas weiter.  Wir haben begonnen, nur die erste TCP-SYN-Neu√ºbertragung in der Sitzung zu malen.  Das hei√üt, es werden tats√§chlich mehrere von ihnen gesendet, wir haben jeden gemalt - nur einer begann gemalt zu werden.  Wir sind also zu dem gekommen, was wir jetzt haben. <br><br>  Insgesamt gibt es Netmon, es gibt Agenten auf Hosts, die die erste SYN-Neu√ºbertragung in der Sitzung f√§rben, und wir z√§hlen diese Neu√ºbertragungen auf jedem Ger√§t, auf fast jeder Verbindung in unserem Netzwerk. <br><br><img src="https://habrastorage.org/webt/bk/pn/y1/bkpny1rbllgxlz8nf4v6wynm6ro.jpeg"><br><br>  Aber mit den Augen auf das Bild zu schauen, das ich fr√ºher gezeigt habe, ist nicht sehr praktisch.  Das hei√üt, Sie k√∂nnen es nicht an einen diensthabenden Beamten verkaufen, da Sie in jedem Abschnitt alles mit Ihren Augen bewerten m√ºssen.  Und wir kamen zu der Tatsache, dass ich eine Warnung haben m√∂chte.  Ich m√∂chte, dass ein Licht aufleuchtet: Ein Ger√§t wie dieses ist ein Problem;  Ein anderes Ger√§t ist ein Problem. <br><br>  Erinnern wir uns an einige mathematische Statistiken.  Die Idee mit Alarm ist, dass jedes Ger√§t im Wesentlichen ein Korb ist.  Wir haben eine Erfolgswahrscheinlichkeit und eine Ausfallwahrscheinlichkeit f√ºr vier Ger√§te.  Die Wahrscheinlichkeit einer erneuten √úbertragung in den Warenkorb, dh Erfolg, betr√§gt ¬º.  Es stellt sich eine Binomialverteilung heraus. <br><br>  Was ist die Schwierigkeit, hier einen Alarm auszul√∂sen?  Die Tatsache, dass wir die Schwellenwerte nicht statisch machen k√∂nnen, k√∂nnen wir nicht sagen: Wenn zehn Neu√ºbertragungen auf einem Ger√§t und neun auf dem anderen ankommen, gibt es kein Problem.  Und wenn zehn und f√ºnf, dann gibt es ein Problem.  Denn wenn wir es auf tausend PPS skalieren, sind solche Daten nicht mehr relevant.  1000 PPS und 800 PPS zwischen verschiedenen Ger√§ten sind definitiv ein Problem. <br><br>  Wir k√∂nnen keine statischen Schwellenwerte in PPS oder Bytes festlegen, wir k√∂nnen sie nicht als Prozentsatz festlegen - das gleiche Problem mit ihnen.  Daher ben√∂tigen wir eine L√∂sung, die diesen Schwellenwert je nach Anzahl der Pakete mehr oder weniger dynamisch macht. <br><br>  Und der Reiz der Binomialverteilung besteht darin, dass sie bei der PPS-Erh√∂hung zur Normalit√§t tendiert, und f√ºr eine Normalverteilung k√∂nnen wir bereits die Erwartung, Varianz und das Konfidenzintervall berechnen, was wir getan haben.  Das Konfidenzintervall f√ºr uns betr√§gt 3NPQ, dh es h√§ngt von der Anzahl der Pakete durch das Ger√§t ab.  Als Ergebnis haben wir eine dynamische Verschiebungsschwelle. <br><br>  So sieht unser Signal im Bild aus.  Wenn ein Ger√§t aus der Distribution ausgeschlossen wird, setzen wir eine Flagge darauf - etwas stimmt nicht. <br><br><img src="https://habrastorage.org/webt/0e/bo/c_/0eboc_4g2lwamtfgsdus0o-tqzi.jpeg"><br><br>  Wo wollen wir uns weiterentwickeln, was wollen wir hier verbessern, zus√§tzlich nat√ºrlich zum Kampf gegen falsch positive Ergebnisse?  Zun√§chst w√§ren wir interessiert zu sehen, was zum Zeitpunkt des Problems da war.  Zu diesem Zweck haben wir eine solche Option im Agenten - Debug.  Wir k√∂nnen genau das, was erneut √ºbertragen wurde, dh ein 5-Tupel-Paket, in einen separaten Kollektor hochladen und dann betrachten.  Dies belastet die Hosts jedoch etwas, so dass es uns manchmal verboten ist, dies zu tun.  Wir m√∂chten ERSPAN befestigen und solche Pakete von der Hardware selbst auf den Kollektor entladen, da uns niemand verbietet, dies auf der Hardware zu tun. <br><br>  Dima Afanasyev <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">erkl√§rte,</a> wie wir unsere Fabriken entwickeln werden, und einer der Punkte war der √úbergang von der MPLS-Fabrik zu IPv6.  Was gibt uns das?  MPLS verf√ºgt √ºber drei Bits f√ºr die QoS-Markierung.  In IPv6 mindestens sechs.  Derzeit werden in unserem Netzwerk nur drei Bits verwendet.  Das hei√üt, wir haben noch drei weitere Bits, in die wir tats√§chlich alle Informationen vom Host einf√ºgen k√∂nnen. <br><br>  Zum Beispiel malen wir jetzt nur die erste SYN-Neu√ºbertragung in der Sitzung.  Und wir k√∂nnen das zweite Bit beispielsweise einf√§rben, wenn das Paket an ein externes Netzwerk geht.  Und wir k√∂nnen erneut senden, dh ein anderes Signal hervorheben, das wir dann separat betrachten werden. <br><br>  Dar√ºber hinaus droht uns der √úbergang zum Design mit Edge Pod, wenn wir DCI an einem bestimmten Ort durchgef√ºhrt haben, damit, dass wir an diesem Ort unsere Diffserv-Dom√§ne genauer steuern k√∂nnen.  Das hei√üt, etwas neu streichen und mit Farben tun, um falsch positive Ergebnisse abzuschneiden. <br><br>  Infolgedessen erwies sich all dies als ziemlich schmerzhaft, aber interessant.  Es gab nichts zu bef√ºrchten.  Wir haben tats√§chlich eine L√∂sung entwickelt, die jeder nutzen kann.  Es wird bei praktisch jedem Anbieter getestet, es funktioniert, es ist nicht schwierig.  Und es zeigt wirklich, auf welchem ‚Äã‚ÄãGer√§t im Netzwerk ein Problem vorliegt.  Daher lautet meine Botschaft: Haben Sie keine Angst, dasselbe zu tun, und lassen Sie Ihre √úberwachung gr√ºn bleiben.  Danke f√ºrs Zuh√∂ren. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de473834/">https://habr.com/ru/post/de473834/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de473822/index.html">Stellenangebot an einem Tag: Wie wir am selben Tag interviewt und Feedback gegeben haben</a></li>
<li><a href="../de473824/index.html">So erstellen Sie eine Gesch√§ftstechnologie f√ºr die Vertriebsplanung in einem einzigen System</a></li>
<li><a href="../de473826/index.html">OTP-Authentifizierung auf dem Apache-Webserver</a></li>
<li><a href="../de473828/index.html">Computer Vision als Alternative zu B√ºroausweisen</a></li>
<li><a href="../de473832/index.html">ShIoTiny: Updates und Benachrichtigungen</a></li>
<li><a href="../de473838/index.html">DJI Mavic Mini: der leichteste zusammenklappbare Quadrocopter</a></li>
<li><a href="../de473840/index.html">Streamen Sie Videos vom Android-Ger√§t √ºber UDP zur JAVA-Anwendung</a></li>
<li><a href="../de473842/index.html">Oktober Maschinelles Lernen und k√ºnstliche Intelligenz News Digest</a></li>
<li><a href="../de473844/index.html">Warum brauchen wir Bereiche von C ++ 20 in einem einfachen Brecher?</a></li>
<li><a href="../de473846/index.html">So messen Sie die Leistung von Blockchain-Netzwerken. Schl√ºsselkennzahlen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>