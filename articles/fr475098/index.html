<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòù üë† ‚ÄºÔ∏è Automatisation de l'approvisionnement des affiches cin√©ma en ligne üö£üèæ üõÄüèª üôáüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aujourd'hui, nous allons parler de la fa√ßon dont nous avons automatis√© la pr√©paration des couvertures pour les films / collections et autres contenus ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Automatisation de l'approvisionnement des affiches cin√©ma en ligne</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/okko/blog/475098/">  Aujourd'hui, nous allons parler de la fa√ßon dont nous avons automatis√© la pr√©paration des couvertures pour les films / collections et autres contenus dans Okko, ainsi que des probl√®mes que l'automatisation r√©sout en g√©n√©ral et quelles perspectives cela nous ouvre. <br><a name="habracut"></a><br>  Okko est une salle de cin√©ma en ligne qui prend en charge une large gamme d'appareils: iPhone, iPad, AppleTV, tous les smartphones Android, la plupart des t√©l√©viseurs SMART (LG, Samsung, Sony, Panasonic, Xiaomi, etc.), PS3, PS4, Xbox, Web- navigateurs. <br><br><img src="https://habrastorage.org/webt/h7/j9/-w/h7j9-wewqlmvzen2f5v1g6y_iek.jpeg"><br><br>  Initialement, nous avons pr√©par√© des images hors ligne pour chaque unit√© de contenu (film, s√©rie, s√©rie d'une s√©rie, etc.) dans des tailles cibles.  De plus, les images elles-m√™mes n'√©taient pas tr√®s diff√©rentes les unes des autres.  √Ä un moment donn√©, la pr√©paration et la livraison d'images aux clients se sont transform√©es en un processus inconfortable, accompagn√© d'un certain nombre de probl√®mes: <br><br><ul><li>  une augmentation du volume de r√©ponse aux clients du backend pour demander une liste de films / abonnements / collections; </li><li>  une augmentation du nombre d'images sur le stockage de fichiers (puisque chaque client devait dupliquer une image, mais avec une taille diff√©rente. Pour cette raison, nous avons cr√©√© plus de 30 copies de chaque image pour chaque type de client); </li><li>  l'augmentation du volume occup√© par les liens vers ces images de RAM; </li><li>  mauvaise flexibilit√©: pour changer m√™me l√©g√®rement l'image, vous deviez t√©l√©charger l'image modifi√©e dans le syst√®me de fichiers et l'√©tendre aux clients; </li><li>  temps pour pr√©parer les images: comme les appareils peuvent √™tre fondamentalement diff√©rents, la communication avec l'utilisateur est √©galement diff√©rente.  Par exemple, sur un client TV, il est logique d'afficher le texte sur la couverture, car il peut √™tre lu sur des √©crans avec une telle diagonale.  Mais sur le smartphone, appliquer le m√™me texte est inutile - il sera trop petit pour distinguer ce qui est √©crit sur la couverture.  Dans l'ancien sch√©ma, m√™me une op√©ration aussi simple que la modification du texte n√©cessitait la participation de plusieurs services: il fallait remplacer les parties n√©cessaires de l'image, donner la source √† un sp√©cialiste du contenu qui enverrait l'image au syst√®me de fichiers et utiliser un client qui prend en charge l'image correspondante; </li><li>  un nombre limit√© de possibilit√©s pour travailler avec une image: par exemple, pour un client Web et un client TV, des images de diff√©rents formats sont n√©cessaires.  Et pour les obtenir, vous devez en outre copier l'image dans le syst√®me de fichiers. </li></ul><br>  Une fois que nous avons remarqu√© qu'un tel syst√®me √©tait trop complexe, nous avions besoin d'une automatisation.  Apr√®s avoir analys√© exactement les exigences que nous avons pour la pr√©paration automatique d'images, nous avons d√©velopp√© un micro-service pour pr√©parer des images pour diff√©rents types de clients √† partir d'une seule source √† la vol√©e. <br><br>  Voici une petite liste des exigences initiales que nous avons compil√©es et auxquelles le service aurait d√ª r√©pondre: <br><br><ul><li>  redimensionnement des images </li><li>  recadrage des images √† la taille souhait√©e </li><li>  redimensionnement des images d'un c√¥t√© tout en conservant les proportions </li><li>  changement de qualit√© d'image de sortie </li><li>  changer le format d'image de sortie (jpeg, png, webp) </li><li>  √† l'aide d'un filtre gauss </li><li>  la capacit√© de maintenir l'ordre des transformations d'image </li></ul><br>  La liste ci-dessus couvre les exigences pour la pr√©paration automatique des affiches de cin√©ma, des √©missions de t√©l√©vision, des films en s√©rie, des s√©ries t√©l√©vis√©es et des arri√®re-plans pour les cartes de cin√©ma + les jeux de la Premier League anglaise. <br><br><img src="https://habrastorage.org/webt/-4/om/sh/-4omshvqsfdusq-dby3zrxw12w8.jpeg"><br><br>  Lorsque ces exigences ont √©t√© mises en ≈ìuvre et publi√©es, ils ont commenc√© √† penser √† d'autres entit√©s de service - collections, abonnements, packages d'abonnement.  √Ä ces r√©flexions sur la fa√ßon de traiter des √©l√©ments plus complexes, certains des plans du d√©partement analytique pour cr√©er et d√©velopper des collections personnelles ont √©t√© ajout√©s: ils aimeraient pouvoir collecter la collection sp√©cifiquement pour chaque utilisateur √† l'avenir, formant une communication sur la couverture de la collection, qui, selon notre recommandation le moteur est le mieux adapt√© pour cela.  Cela a √©galement ajout√© les id√©es des concepteurs pour soulager leur travail: enseigner au service √† superposer toutes sortes d'√©l√©ments graphiques et de textes pour les campagnes marketing Okko, les newsletters et les communications. <br><br>  Ainsi, avec l'av√®nement d'une demande d'automatisation de la collecte des collections, des abonnements et des forfaits d'abonnement, les exigences de service ont √©t√© compl√©t√©es par les √©l√©ments suivants: <br><br><ul><li>  superposer des images suppl√©mentaires sur la principale en fonction des coordonn√©es sp√©cifi√©es; </li><li>  superposer du texte diff√©rent sur l'image avec la possibilit√© de modifier la taille du texte, le type de police, l'espacement des lignes et l'espacement des lettres; </li><li>  √ätre capable d'appliquer des param√®tres de base avec de nouveaux. </li></ul><br>  Ces points suppl√©mentaires ont donn√© lieu √† un probl√®me li√© √† la redondance du corps de la requ√™te derri√®re l'image dans le cas o√π l'utilisateur souhaite superposer plusieurs images, ainsi que changer le type d'image de sortie et, par exemple, la qualit√© de l'image.  Cela pourrait ressembler √† une demande de superposition de deux images et de texte: <br><br>  <i>h√¥te: port / img / picture_id? width = 556 &amp; quality = 80 &amp; mediaType = webp &amp; putImage = picture_id2 &amp; x_coordinate = 100 &amp; y_coordinate = 100 &amp; quality_2 = 95 &amp; text = Some text &amp; text_x = 0 &amp; text_y = 150</i> <br><br>  √âvidemment, la prise en charge de tels chemins est g√™nante, en la changeant aussi, m√™me incommode pour simplement √©crire et lire + changer l'un des param√®tres d'image signifie une nouvelle version du client, qui, en g√©n√©ral, n'est pas tr√®s agr√©able (et pour certains appareils, elle est tr√®s longue). <br><br>  Ainsi, dans le micro-service pour la pr√©paration d'images, le concept de pr√©r√©glages est apparu - les fichiers yaml avec une description des √©l√©ments suppl√©mentaires, leur emplacement, leur police et d'autres donn√©es n√©cessaires pour configurer un type d'image sp√©cifique pour un appareil sp√©cifique. <br><br><h3>  R√©sultats </h3><br>  Aujourd'hui, nous sommes √† un stade interm√©diaire: jusqu'√† pr√©sent, toutes les affiches TV de films / films en plusieurs parties / s√©ries / s√©ries ont √©t√© automatiquement pr√©par√©es pour tous les types de clients √† partir de la m√™me couverture.  De plus, nous pr√©parons automatiquement des affiches pour les tourn√©es et les matchs de la journ√©e de Premier League anglaise. <br><br><img src="https://habrastorage.org/webt/_n/ix/i9/_nixi9qcvrtf-bwktytbtjh_vwe.jpeg"><br><br>  Techniquement, le service est aujourd'hui en mesure de se procurer non seulement des couvertures de films et d'√©l√©ments sportifs, mais aussi des collections / abonnements, il est √©galement possible de superposer divers √©l√©ments graphiques et textes sur l'image sans avoir de pr√©r√©glage. <br><br><img src="https://habrastorage.org/webt/4r/xf/qf/4rxfqf0ylfg9-wqa4ntnhdtkjt0.jpeg"><br><br>  La fonctionnalit√© impl√©ment√©e simplifie d√©j√† consid√©rablement la vie: des modifications mineures de l'image ne doivent pas √™tre effectu√©es par plusieurs services, il suffit de modifier ou d'ajouter des valeurs √† l'un ou l'autre param√®tre du service qui est responsable de l'afficher, de tester le micro-service et de le lib√©rer, ce qui est √©videmment beaucoup plus rapide. que la sortie d'une nouvelle version client.  Soutenir un nouveau type d'appareil, √©mettre toutes les affiches du catalogue √† des partenaires externes, l'apparition d'une communication suppl√©mentaire, n'est plus une question de semaines, mais plut√¥t de quelques heures. <br><br>  Le bureau d'√©tudes a d√©charg√©, puisqu'il n'a plus besoin de passer du temps √† pr√©parer des images de m√™me type (ou tr√®s similaires) pour diff√©rents clients, il suffit de donner une source et de pr√©ciser les r√®gles selon lesquelles cette source sera superpos√©e. <br><br>  Il reste encore beaucoup de travail √† faire: il est pr√©vu d'ajouter de l'IA pour les couvertures d'histoires √† g√©n√©ration automatique, une interface Web pour la gestion des pr√©r√©glages avec un aper√ßu du r√©sultat final, l'extension de l'outil √† d'autres d√©partements voisins (SMM, PR), et bien s√ªr les t√¢ches actuelles pour divers types d'optimisations (am√©lioration du travail avec du texte, optimisation de l'algorithme de compression, etc.). <br><br>  C‚Äôest tout.  En cas d'int√©r√™t, nous publierons ult√©rieurement les d√©tails de la structure interne du service, son int√©gration dans la structure g√©n√©rale et le processus de transition vers la pr√©paration automatique d'images. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr475098/">https://habr.com/ru/post/fr475098/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr475078/index.html">Pr√©sentation des wrappers de propri√©t√© dans SwiftUI</a></li>
<li><a href="../fr475082/index.html">Habr Weekly # 26 / Semaine de travail de quatre jours, GitLab est entr√© en politique, Yandex teste le robot de livraison Rover</a></li>
<li><a href="../fr475090/index.html">.NET Core avec Jupyter Notebooks Aper√ßu 1</a></li>
<li><a href="../fr475092/index.html">¬´Je le lirai plus tard¬ª: le sort difficile d'une collection hors ligne de pages Web</a></li>
<li><a href="../fr475096/index.html">Pr√©sentation de .NET Core 3.1 Preview 2</a></li>
<li><a href="../fr475100/index.html">Comment utiliser la crypto pour cr√©er un ¬´bien public¬ª sans risque pour les investisseurs</a></li>
<li><a href="../fr475104/index.html">Nous parcourons les modules: Navigation dans une application multi-modules avec Jetpack</a></li>
<li><a href="../fr475106/index.html">Les principales annonces de la conf√©rence Microsoft Ignite 2019</a></li>
<li><a href="../fr475110/index.html">.NET Core avec Jupyter Notebooks - avant-premi√®re 1</a></li>
<li><a href="../fr475112/index.html">Authentifiez-moi. Si tu peux ...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>