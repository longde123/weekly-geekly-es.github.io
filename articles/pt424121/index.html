<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî∑ ü§° üì£ Criando uma fun√ß√£o de trigger no pgModeler üíë üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø üóæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em um certo reino, em um determinado estado ... eu precisava adicionar um gatilho ao modelo no pgModeler . O que fazer √© f√°cil o suficiente. Mas para ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Criando uma fun√ß√£o de trigger no pgModeler</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424121/">  <i>Em um certo reino, em um determinado estado ...</i> eu precisava adicionar um gatilho ao modelo no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pgModeler</a> .  O que fazer √© f√°cil o suficiente.  Mas para adicionar uma fun√ß√£o de trigger ... Tamb√©m √© f√°cil, mas tive que lidar um pouco com os par√¢metros oferecidos para preenchimento / sele√ß√£o na interface. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O pgModeler</a> √© uma ferramenta de design de banco de dados muito boa que pode gerar scripts sql para o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PostgreSQL</a> .  Detalhes sobre esta ferramenta e seus recursos podem ser encontrados no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site</a> oficial. <br><a name="habracut"></a><br>  Como exemplo, considere um modelo simplificado com uma √∫nica tabela. <br><br><img src="https://habrastorage.org/webt/qv/rk/gh/qvrkghh1osp-coovacxaoen9t5y.png"><br><br>  Adicione uma fun√ß√£o ao modelo. <br><br><img src="https://habrastorage.org/webt/cj/xq/vj/cjxqvjvjvu0ilrmnidbyl67iyek.png"><br><br>  Depois disso, uma janela ser√° aberta com v√°rios par√¢metros edit√°veis ‚Äã‚Äãcom os quais a fun√ß√£o ser√° criada.  No entanto, alguns campos j√° ser√£o preenchidos com valores padr√£o. <br><br><img src="https://habrastorage.org/webt/ti/gg/fs/tiggfs9_2zuay6vog--ewjrvdxa.png"><br><br>  Vamos considerar esses par√¢metros em mais detalhes. <br><br>  Eu acho que com os par√¢metros <i>Nome</i> , <i>Esquema</i> , <i>Propriet√°rio</i> e <i>Coment√°rio,</i> tudo fica claro - esse √© o nome da fun√ß√£o, o esquema do banco de dados, o propriet√°rio e o coment√°rio para essa fun√ß√£o, respectivamente. <br><br>  <i>Idioma</i> √© o nome do idioma em que a fun√ß√£o ser√° implementada.  Para ser sincero, nunca tive que escrever fun√ß√µes para o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PostgreSQL</a> em algo que n√£o <i>fosse o plpgsql</i> .  Portanto, foi esse valor para o par√¢metro que eu escolhi. <br><br>  <i>M√©todo de Retorno</i> .  Como na fun√ß√£o de gatilho n√£o precisamos retornar a tabela nem o conjunto de valores, deixamos <i>Simple</i> . <br><br>  Com os par√¢metros no bloco <i>Data Type</i> , em geral, tudo tamb√©m √© simples.  Porque  Se a fun√ß√£o √© chamada no gatilho, no campo <i>Tipo</i> especificamos o <i>gatilho</i> (o campo <i>Formato</i> ser√° preenchido automaticamente com o valor do <i>gatilho</i> ).  O campo <i>Dimens√£o</i> (o √∫nico campo digital n√£o reservado neste bloco) √© necess√°rio para indicar a dimens√£o da matriz do valor retornado.  Mas como precisamos apenas de um valor, n√£o de uma matriz, deixamos <i>0</i> nesse campo. <br><br>  Com os demais par√¢metros, nem tudo √© t√£o √≥bvio, pelo menos para mim, porque  nunca tive que pensar neles durante a cria√ß√£o usual de fun√ß√µes no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PostgreSQL</a> . <br><br>  <i>O tipo de fun√ß√£o</i> pode assumir um dos tr√™s valores: <i>IMMUTABLE</i> , <i>STABLE</i> e <i>VOLATILE</i> .  Na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> oficial do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PostgreSQL</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">,</a> voc√™ pode descobrir que esses argumentos informam o otimizador de consultas sobre o comportamento da fun√ß√£o. <br><br><ul><li>  <i>IMMUTABLE</i> significa que a fun√ß√£o n√£o pode modificar o banco de dados e sempre retorna o mesmo resultado para determinados valores dos argumentos. <br></li><li>  <i>STABLE</i> significa que a fun√ß√£o n√£o pode modificar o banco de dados e, em uma √∫nica varredura de tabela, sempre retorna o mesmo resultado para determinados valores dos argumentos. <br></li><li>  <i>VOLATILE</i> significa que o resultado de uma fun√ß√£o pode mudar mesmo dentro de uma √∫nica verifica√ß√£o de tabela, portanto, suas chamadas n√£o podem ser otimizadas. <br></li></ul><br>  Consequentemente, se a fun√ß√£o de acionamento exigir altera√ß√£o do banco de dados, <i>IMMUTABLE</i> n√£o <i>ser√°</i> adequado.  Uma fun√ß√£o com o par√¢metro <i>STABLE</i> n√£o √© adequada para gatilhos <i>AFTER</i> que desejam ler linhas modificadas pelo comando atual.  Permanece <i>vol√°til</i> , que n√£o tem os problemas acima.  Tamb√©m ser√° especificado por padr√£o se nenhum dos argumentos acima for especificado ao criar a fun√ß√£o. <br><br>  <i>A seguran√ßa</i> pode assumir um dos dois valores: <i>SECURITY DEFINER</i> e <i>SECURITY INVOKER</i> e √© respons√°vel pelos direitos de que usu√°rio ser√° chamado. <br><br><ul><li>  <i>DEFINER DE SEGURAN√áA</i> significa que a fun√ß√£o ser√° executada com os direitos do usu√°rio que a possui, ou seja,  aquele que foi listado no <i>propriet√°rio</i> . <br></li><li>  <i>INVOKER DE SEGURAN√áA</i> significa que a fun√ß√£o ser√° executada com os direitos do usu√°rio que a chamou. <br></li></ul><br>  Por padr√£o, o <i>SECURITY INVOKER √© usado</i> , para que voc√™ possa deix√°-lo. <br><br>  <i>O comportamento</i> pode assumir um dos tr√™s valores: <i>STRICT</i> , <i>RETORNA NULL NA ENTRADA</i> <i>NULA</i> e <i>CHAMADO NA ENTRADA NULA</i> e mostra como a fun√ß√£o se comportar√° se houver valores NULL entre seus argumentos. <br><br><ul><li>  <i>VOLTA NULL EM NULL INPUT</i> ou <i>STRICT</i> significa que a fun√ß√£o sempre retornar√° NULL se pelo menos um de seus argumentos for NULL. <br></li><li>  <i>CHAMADO NA ENTRADA NULL</i> significa que a fun√ß√£o ser√° chamada como de costume, mesmo que NULL esteja entre seus argumentos. <br></li></ul><br>  O padr√£o √© <i>CHAMADO NA ENTRADA NULA</i> .  Portanto, da mesma maneira, voc√™ pode deix√°-lo. <br><br>  <i>Linhas retornadas</i> mostra o n√∫mero de linhas que o planejador esperar√°.  O valor √© especificado para fun√ß√µes que retornam conjuntos.  Porque  nossa fun√ß√£o retorna um √∫nico valor, deixamos <i>0</i> . <br><br>  <i>Custo de execu√ß√£o</i> define o custo para executar esta fun√ß√£o para o planejador.  Para <i>plpgsql</i> , o padr√£o √© <i>100</i> .  Portanto, indicamos esse valor. <br><br>  <i>Windown Func.</i>  significa que uma fun√ß√£o de janela ser√° criada.  No nosso caso, porque  precisamos de uma fun√ß√£o de gatilho, n√£o precisamos especificar esse valor (bem, em geral, eles escrevem na pr√≥pria documenta√ß√£o que faz sentido especificar esse par√¢metro apenas para fun√ß√µes escritas em C). <br><br>  <i>A prova de vazamento</i> indica que a fun√ß√£o est√° selada, ou seja,  que n√£o divulga informa√ß√µes sobre seus argumentos (por exemplo, n√£o exibe o significado em uma mensagem de erro), exceto para retornar um resultado.  Porque  Como a fun√ß√£o acionadora n√£o aceita argumentos, esse par√¢metro n√£o precisa ser especificado. <br><br>  Assim, os par√¢metros da fun√ß√£o terminaram.  O pr√≥prio corpo da fun√ß√£o pode ser gravado na mesma janela na guia Defini√ß√£o.  Prosseguimos para criar o pr√≥prio gatilho. <br><br><img src="https://habrastorage.org/webt/-m/d-/gn/-md-gnby6dhi6dy_o6bxawskjjw.png"><br><br>  Depois disso, a janela de cria√ß√£o do acionador ser√° exibida. <br><br><img src="https://habrastorage.org/webt/ap/6j/uo/ap6juopfdv961t2r92hxrzjjhkk.png"><br><br>  Considere os par√¢metros que podem ser definidos nesta janela. <br><br>  Com os par√¢metros <i>Nome</i> , <i>Alias</i> e <i>Coment√°rio,</i> tudo fica claro - este √© o nome do gatilho, alias e coment√°rio ao gatilho, respectivamente. <br><br>  <i>Excution</i> mostra como esse gatilho ser√° executado e pode assumir um dos seguintes valores: <i>ANTES</i> , <i>DEPOIS</i> e <i>INSTEAD OF</i> , o que significa que a fun√ß√£o ser√° executada antes, depois ou em vez do evento. <br><br>  <i>FOR EACH ROW</i> determina se o procedimento de acionamento ser√° acionado uma vez para cada linha.  Se n√£o especificado, o par√¢metro <i>FOR EACH STATEMENT</i> ser√° definido, o que determina que o procedimento de acionamento √© acionado uma vez para a instru√ß√£o SQL. <br><br>  <i>Evento</i> determina quais eventos precisam ser processados ‚Äã‚Äãnesse gatilho.  Voc√™ pode especificar v√°rios eventos.  Os eventos s√£o dos seguintes tipos: <i>INSERT</i> , <i>UPDATE</i> , <i>DELETE</i> e <i>TRUNCATE</i> .  Eles ocorrem quando o comando correspondente com a mesma instru√ß√£o SQL √© chamado. <br><br>  <i>A restri√ß√£o</i> indica que um gatilho de restri√ß√£o ser√° criado.  Os gatilhos de restri√ß√£o s√£o usados ‚Äã‚Äãpara lan√ßar exce√ß√µes quando restri√ß√µes s√£o violadas.  Voc√™ pode ler mais sobre eles na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> oficial. <br><br>  Para um acionador de restri√ß√£o, voc√™ pode especificar <i>Adiado</i> , que determina o tempo do acionador.  Este par√¢metro pode assumir um dos seguintes valores: <i>INICIALMENTE IMEDIATO</i> ou <i>INICIALMENTE DIFERIDO</i> . <br><br><ul><li>  <i>INICIALMENTE IMEDIATO</i> significa que o gatilho ser√° acionado ap√≥s cada instru√ß√£o. <br></li><li>  <i>INICIALMENTE DIFERIDO</i> significa que o gatilho ser√° acionado apenas no final da transa√ß√£o. <br></li></ul><br>  <i>Refer.</i>  <i>Tabela</i> √© o nome da tabela referenciada pela restri√ß√£o.  Usado para restri√ß√µes de chave estrangeira e permitido apenas para acionadores de restri√ß√£o. <br><br>  <i>Condi√ß√£o</i> √© uma condi√ß√£o que determina se a fun√ß√£o de disparo ser√° executada.  Para acionadores <i>FOR EACH ROW</i> nesse campo, √© poss√≠vel acessar valores antigos e novos por <i>OLD</i> e <i>NEW,</i> respectivamente (ou seja, o mesmo que no corpo da fun√ß√£o de acionador). <br><br>  <i>Argumentos</i> - uma lista de argumentos que ser√£o passados ‚Äã‚Äãpara a fun√ß√£o de gatilho quando o gatilho for disparado.  As constantes de string s√£o passadas como argumentos para a fun√ß√£o. <br><br>  <i>Colunas</i> - podem ser especificadas apenas para eventos <i>UPDATE</i> .  O acionador funcionar√° apenas se pelo menos uma das colunas especificadas estiver na lista de colunas especificadas em <i>UPDATE</i> . <br><br><h3>  Conclus√£o </h3><br>  Isso, em geral, √© tudo.  Espero que tenha sido interessante e √∫til para algu√©m. <br><br><hr><br>  Ao escrever este artigo, foi utilizado o pgModeler vers√£o 0.9.2-alpha, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">constru√≠do</a> no Windows 7 x64.  Ao usar vers√µes mais antigas / mais recentes do pgModeler, s√£o poss√≠veis pequenas diferen√ßas na interface. <br><br>  O modelo usado no artigo pode ser baixado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt424121/">https://habr.com/ru/post/pt424121/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt424109/index.html">VSCE # 2: Podcast de empreendedores de m√≠dia</a></li>
<li><a href="../pt424111/index.html">Ondas de contratos inteligentes. Primeira experi√™ncia</a></li>
<li><a href="../pt424113/index.html">Processo de design, pesquisa e procura de emprego</a></li>
<li><a href="../pt424115/index.html">Casos de uso ou falta de balanceadores de carga</a></li>
<li><a href="../pt424119/index.html">Houve um Scrum *?</a></li>
<li><a href="../pt424127/index.html">Como fazer amigos Ovirt e Let's Encrypt</a></li>
<li><a href="../pt424129/index.html">Desenvolvimento Android. Um pouco sobre o trabalho r√°pido com listas</a></li>
<li><a href="../pt424131/index.html">Manifesto do desenvolvedor de sistemas inteligentes: 15 princ√≠pios</a></li>
<li><a href="../pt424133/index.html">Virtualiza√ß√£o de empregos para o departamento de arquitetura atrav√©s dos olhos das humanidades</a></li>
<li><a href="../pt424135/index.html">Uni√£o Europ√©ia aprova nova diretiva de direitos autorais - como isso afetar√° a Internet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>