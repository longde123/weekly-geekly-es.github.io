<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>❣️ 👨🏼‍🏫 👲🏻 Terminal untuk server Linux rumahan berdasarkan ESP8266 👩🏻‍🚀 🛍️ 💾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="pengantar
 Perangkat ini berfungsi untuk akses jarak jauh ke server Linux melalui port serial dan memungkinkan Anda untuk meninggalkan monitor dan key...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Terminal untuk server Linux rumahan berdasarkan ESP8266</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/387033/"><img align="left" src="https://habrastorage.org/files/c78/55f/858/c7855f85896b49fca445ce4347fa9d73.png"><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pengantar</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perangkat ini berfungsi untuk akses jarak jauh ke server Linux melalui port serial dan memungkinkan Anda untuk meninggalkan monitor dan keyboard lokal. </font><font style="vertical-align: inherit;">Mengapa diperlukan jika ada SSH dan VNC? </font><font style="vertical-align: inherit;">Anda perlu mengingat sejumlah masalah yang terkait dengan manajemen pada tahap boot sistem dan manajemen daya:</font></font><br>
<ul>
<li>  ,   recovery mode, memtest.  S          ,  fsck   .<br>
</li>
<li>        .   initramfs  dropbear    .    SSH.  ,         ,           ,       .<br>
</li>
<li>   .      ,        Wake-on-LAN (WOL),        ,   ,           «»   ,      .<br>
</li>
<li>       UPS,        .<br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sayangnya, peralatan server rumah saya tidak bersifat industri dan tidak memiliki tingkat keandalan yang tinggi. </font><font style="vertical-align: inherit;">Hal yang sama berlaku untuk perangkat lunak, seringkali modul kernel "mentah" berfungsi. </font><font style="vertical-align: inherit;">Akibatnya, lebih dari sekali server "hang" tanpa menanggapi baik melalui jaringan atau menekan tombol keyboard. </font><font style="vertical-align: inherit;">Saya harus menggunakan reset perangkat keras dengan menahan tombol power selama lebih dari 3 detik.</font></font><br>
</li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak ada masalah seperti itu pada peralatan industri, misalnya, solusi HP iLO memungkinkan Anda menginstal dari jarak jauh setidaknya satu sistem, belum lagi hal-hal seperti manajemen daya dan diagnostik sistem. </font><font style="vertical-align: inherit;">Omong-omong, mereka memiliki produk untuk rumah / usaha kecil dengan solusi ini. </font><font style="vertical-align: inherit;">Tetapi kebetulan bahwa sistem itu dibangun atas dasar motherboard miniITX konvensional tanpa kemampuan seperti itu.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada kebutuhan untuk perangkat yang memungkinkan:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tersedia melalui jaringan</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Berinteraksi dengan bootloader dan OS server, setidaknya dalam mode teks</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zhelezno berinteraksi dengan tombol daya dan dapat menutup kontak tombol ini selama lebih dari 3 detik untuk mematikan paksa</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ubah pengaturan BIOS (EFI) (belum diputuskan, hanya tersedia untuk beberapa motherboard)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah fakta yang diketahui bahwa terminal teks yang digunakan sebelumnya terhubung ke port serial mesin. </font><font style="vertical-align: inherit;">Secara historis ada dukungan terminal Linux dan bootloader grub. </font><font style="vertical-align: inherit;">Pada motherboard modern, port ini tidak dalam bentuk biasa dari konektor DB-9 eksternal, tetapi hampir selalu dialihkan ke konektor 10-pin internal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan munculnya ESP8266 sen, pada dasarnya jembatan antara Wi-Fi dan UART, muncul ide untuk mengimplementasikan terminal jaringan yang didasarkan padanya, dengan fungsi manajemen daya, muncul.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selain ESP8266, ada opsi yang berbeda.</font></font></b><div class="spoiler_text">   OpenWRT   .  UART'a      MAX232 (  USB — RS232 ),   GPIO,   ,   .  ,  ,        .<br>
<br>
               ,    ./.,  .         .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>.<br>
</div></div><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diagram sirkuit</font></font></h4><br>
<img src="https://habrastorage.org/files/cc5/d51/e73/cc5d51e735d34dba97b6e58db1485885.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Elemen utama - ESP8266 (ESP-03), memiliki Wi-Fi untuk komunikasi dengan dunia luar, UART untuk komunikasi dengan server, dan beberapa GPIO di mana indikator status dan LED relai digantung untuk menutup tombol daya. </font><font style="vertical-align: inherit;">Ada beberapa GPIO gratis yang dapat digunakan untuk menghubungkan I2C, 1-Wire, dan sensor dan perangkat lainnya.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chip MAX232 yang populer digunakan untuk mengubah UART dari ESP8266 ke RS-232. MAX232 ditenagai oleh 5V, sedangkan ESP8266 melalui konverter LM1117 5-3.3V, untuk berjaga-jaga, pembagi tegangan yang mengarah 5V dari output MAX232 ke 3.3V digunakan pada jalur RX dari ESP8266. Output MAX232 dibagi menjadi dua konektor, satu untuk menghubungkan ke DB-9 dan yang kedua IDC-10 untuk menghubungkan langsung ke kontak pada motherboard dengan loop langsung. Relai digunakan untuk menutup kontak tombol daya PC dan terhubung secara paralel dengan tombol pada case. Ngomong-ngomong, untuk menghubungkan tombol power dari case unit sistem, Anda bisa menyediakan konektor di papan, saya sudah menerapkannya melalui double untuk 2,54 pin pada konektor motherboard. Secara umum, keputusan menggunakan relay kontroversial. Cukup banyak transistor. Dalam tata letak, saya meletakkan optocoupler 817, tidak berfungsi,tindakan radikal diambil dan relay dihidupkan ... itu berhasil. Biarlah, itu kemudian berguna untuk menutup / membuka sirkuit 220V, selain itu, klik terdengar - ini berguna untuk diagnostik. P6 - konektor untuk pemrograman mudah melalui adaptor Cina untuk arduino FTDI. Dalam mode pemrograman, jumper diaktifkan oleh JP1. Perangkat ini diaktifkan melalui konektor P4 langsung dari tegangan siaga catu daya atau dari port USB. Konektor P1 digunakan untuk menghubungkan antena eksternal.Perangkat ini diaktifkan melalui konektor P4 langsung dari tegangan siaga catu daya atau dari port USB. Konektor P1 digunakan untuk menghubungkan antena eksternal.Perangkat ini diaktifkan melalui konektor P4 langsung dari tegangan siaga catu daya atau dari port USB. Konektor P1 digunakan untuk menghubungkan antena eksternal.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jalur pengembangan yang memungkinkan</font></font></b><div class="spoiler_text"><ul>
<li>   CMOS</li>
<li>  ,      </li>
<li>   </li>
</ul><br>
</div></div><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Papan sirkuit tercetak</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lapisan tunggal, tetapi 5 pelompat utuh keluar.</font></font><br>
<img src="https://habrastorage.org/files/ee5/c2c/5e6/ee5c2c5e68de483ba7f53a535b744ed1.png"><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Canggung dibuat di rumah</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/806/937/b10/806937b100874fd1994fd4f5b3804bce.jpg"><br>
    P6.<br>
</div></div><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firmware</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yang paling sederhana terdiri dari satu server TELNET - sebenarnya untuk pertukaran. </font><font style="vertical-align: inherit;">Segala sesuatu yang muncul di UART dilemparkan ke semua klien TELNET, semua yang berasal dari klien dibuang ke UART. </font><font style="vertical-align: inherit;">Perintah AT juga diaktifkan untuk mengontrol tombol daya dan mengkonfigurasi parameter port dan Wi-Fi. </font><font style="vertical-align: inherit;">Meskipun sejujurnya, ini jauh dari server RFC 854, perintahnya tidak didukung, saya memanggil TELNET karena port 23, pertukaran teks langsung, dan klien TELNET hebat untuk interaksi (diuji pada klien ConnectBot dan Linux Android, utilitas telnet bekerja dengan benar dengan variabel ekspor environment TERM = VT100, parameter -8 dan transisi selanjutnya ke mode karakter ^] karakter mode).</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fitur yang patut diperhatikan, ESP8266 dapat berfungsi baik sebagai titik akses dan sebagai klien jaringan nirkabel pada saat yang sama. Ini sangat penting untuk toleransi kesalahan - ini memungkinkan Anda untuk terhubung ke terminal jika terjadi kegagalan peralatan jaringan. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Firmware aslinya ditulis dalam bahasa </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sming</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Kelebihan utama dari Sming adalah Anda tidak perlu memahami SDK ESP8266 Cina, untuk semua kebutuhan sudah ada bungkus yang dapat dicerna, apakah itu server WEB, memperbarui firmware melalui udara atau bekerja dengan GPIO. Tetapi ketika menggunakan pembungkus server TCP untuk mengimplementasikan TELNET ketika mentransfer volume besar, koneksi terputus, dan ESP8266 digantung. Ada upaya untuk beroperasi langsung dengan API lwip ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi pada titik ini saya menemukan proyek </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP8266-transparan-jembatan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Diputuskan hanya untuk bercabang untuk pelaksanaan perintah untuk mengontrol tombol daya, segala sesuatu yang lain telah dilakukan oleh pembuatnya. </font><font style="vertical-align: inherit;">Bala menambahkan perintah AT</font></font><pre><code class="bash hljs">+++AT PWBTN &lt;duration: SHORT | LONG | HARDRESET&gt; <span class="hljs-comment"><span class="hljs-comment">#       |   | ,        </span></span>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada kekurangan dalam firmware. </font><font style="vertical-align: inherit;">Jika sejumlah besar informasi dikeluarkan ke terminal pada suatu waktu, maka beberapa data mungkin hilang. </font><font style="vertical-align: inherit;">Namun, ESP8266 bukan Moxa NPort dan kemampuannya terbatas. </font><font style="vertical-align: inherit;">Sebagai contoh, jika kita membuat dmesg, maka kita hanya akan melihat sebagian dari data, jadi kita harus menggunakan grep lebih sering dan lebih jarang dan menghindari tampilan panjang di layar. </font><font style="vertical-align: inherit;">Secara umum, ada baiknya mencoba meningkatkan buffer transfer dalam firmware, sekarang hanya 1024 byte, sampai tangan Anda mencapai, membuatnya menjadi 32768 dan mungkin menjadi nyaman untuk bekerja dengan utilitas seperti htop.</font></font><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfigurasi mesin Linux</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di / etc / default / grub harus seperti:</font></font><br>
<pre><code class="bash hljs">GRUB_CMDLINE_LINUX=<span class="hljs-string"><span class="hljs-string">"console=ttyS0,115200n8"</span></span><font></font>
GRUB_TERMINAL=serial<font></font>
GRUB_SERIAL_COMMAND=<span class="hljs-string"><span class="hljs-string">"serial --speed=115200 --unit=0 --word=8 --parity=no --stop=1"</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menampilkan menu bootloader dan mem-boot pesan ke port serial. Dalam hal ini, yang pertama dengan laju bit 115200. Setelah mengedit, jalankan perintah update-grub. Pada prinsipnya, ini dapat dibatasi, tetapi untuk berjaga-jaga, Anda masih dapat membuka terminal pada port serial, untuk ini buat /etc/init/ttyS0.conf dengan konten berikut:</font></font><br>
<pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ttyS0 - getty</span></span>
<span class="hljs-comment"><span class="hljs-comment">#</span></span>
<span class="hljs-comment"><span class="hljs-comment"># This service maintains a getty on ttyS0 from the point the system is</span></span>
<span class="hljs-comment"><span class="hljs-comment"># started until it is shut down again.</span></span><font></font>
<font></font>
start on stopped rc or RUNLEVEL=[2345]<font></font>
stop on runlevel [!2345]<font></font>
<span class="hljs-comment"><span class="hljs-comment">#</span></span><font></font>
respawn<font></font>
<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> /sbin/getty -L 115200 ttyS0 vt102
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menghubungkan ke server </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang telah disebutkan, daya diambil langsung dari tegangan siaga catu daya atau dari port USB, output relai dihubungkan secara paralel dengan tombol daya, bantalan RS-232 dihubungkan dengan kabel langsung ke konektor IDC-10. </font><font style="vertical-align: inherit;">Ada nuansa menempatkan perangkat di dalam case server, Anda harus mengeluarkan antena yang terhubung ke konektor u.fl perangkat untuk case Wi-Fi. </font><font style="vertical-align: inherit;">Tentu saja, ini tidak dapat dilakukan jika kasingnya relatif transparan, misalnya, terbuat dari kayu.</font></font><br>
<br>
<img src="https://habrastorage.org/files/cc1/676/47b/cc167647b315495eafaf671f7b37b084.jpg"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perhitungan biaya</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
$ 3 untuk ESP8266, $ 1 untuk 10 buah MAX232, sisanya biasanya di pertanian.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peragaan video</font></font></h4><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://www.youtube.com/embed/xk7YPsDRASc&amp;usg=ALkJrhgb76DXIJ-vwb16v8ZEnO5n5mrCxw" frameborder="0" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sumber besi dan perangkat lunak di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id387033/">https://habr.com/ru/post/id387033/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id387017/index.html">Sistem kontrol akuarium otomatis di Arduino</a></li>
<li><a href="../id387021/index.html">Perubahan router Hame R-1 di Zyxel Keenetic</a></li>
<li><a href="../id387025/index.html">Yahoo Mail melarang beberapa pengguna AdBlock</a></li>
<li><a href="../id387027/index.html">Американские чиновники беззащитны против фишинга иранских хакеров в соцсетях</a></li>
<li><a href="../id387029/index.html">Perlombaan senjata elektromagnetik. Apa yang dimiliki orang Cina di sana?</a></li>
<li><a href="../id387035/index.html">Tinjauan dari Pameran Teknologi 3D Formnext 2015</a></li>
<li><a href="../id387037/index.html">Rosetta dan Fila</a></li>
<li><a href="../id387041/index.html">Jangan buka sampai 2957: kapsul waktu ditemukan di MIT</a></li>
<li><a href="../id387043/index.html">NASA: у звезды KIC 8462852 нет сферы Дайсона, это целый рой комет</a></li>
<li><a href="../id387047/index.html">Ilmuwan Amerika telah menciptakan nyamuk rekayasa genetika yang menghalangi penyebaran malaria</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>