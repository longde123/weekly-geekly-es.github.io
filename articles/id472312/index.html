<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨ğŸ¾â€âœˆï¸ ğŸ— ğŸ§”ğŸ» Pengalaman mentransfer proyek Maven ke Jar Multi-Rilis: sudah mungkin, tetapi masih sulit ğŸ•Ÿ ğŸ‰ ğŸ‘¨ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saya memiliki perpustakaan StreamEx kecil yang memperpanjang Java 8 Stream API. Secara tradisional saya mengumpulkan perpustakaan melalui Maven, dan s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pengalaman mentransfer proyek Maven ke Jar Multi-Rilis: sudah mungkin, tetapi masih sulit</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472312/"><p> Saya memiliki perpustakaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">StreamEx</a> kecil yang memperpanjang Java 8 Stream API.  Secara tradisional saya mengumpulkan perpustakaan melalui Maven, dan sebagian besar saya senang dengan semuanya.  Namun, saya ingin bereksperimen. </p><br><p> Beberapa hal di perpustakaan harus bekerja secara berbeda di berbagai versi Java.  Contoh yang paling mencolok adalah metode Stream API baru seperti <code>takeWhile</code> , yang hanya muncul di Java 9. Pustaka saya juga menyediakan implementasi metode ini di Java 8, tetapi ketika Anda memperluas Stream API Anda sendiri, Anda memiliki beberapa batasan yang tidak akan saya sebutkan di sini.  Saya berharap pengguna Java 9+ memiliki akses ke implementasi standar. </p><a name="habracut"></a><br><p>  Agar proyek terus mengkompilasi menggunakan Java 8, ini biasanya dilakukan dengan menggunakan alat refleksi: kami mencari tahu apakah ada metode yang sesuai di perpustakaan standar dan, jika demikian, kami menyebutnya, dan jika tidak, kami menggunakan implementasi kami.  Namun, saya memutuskan untuk menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">API MethodHandle</a> , karena menyatakan lebih sedikit panggilan overhead.  Anda bisa mendapatkan <code>MethodHandle</code> di muka dan menyimpannya di bidang statis: </p><br><pre> <code class="java hljs">MethodHandles.Lookup lookup = MethodHandles.publicLookup(); MethodType type = MethodType.methodType(Stream.class, Predicate.class); MethodHandle method = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { method = lookup.findVirtual(Stream.class, <span class="hljs-string"><span class="hljs-string">"takeWhile"</span></span>, type); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (NoSuchMethodException | IllegalAccessException e) { <span class="hljs-comment"><span class="hljs-comment">// ignore }</span></span></code> </pre> <br><p>  Dan kemudian menggunakannya: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (method != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (Stream&lt;T&gt;)method.invokeExact(stream, predicate); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Java 8 polyfill }</span></span></code> </pre> <br><p>  Ini semua baik, tetapi terlihat jelek.  Dan yang paling penting, di setiap titik di mana variasi implementasi dimungkinkan, Anda harus menulis kondisi seperti itu.  Pendekatan yang sedikit alternatif adalah untuk memisahkan strategi Java 8 dan Java 9 sebagai implementasi dari antarmuka yang sama.  Atau, untuk menyimpan ukuran perpustakaan, cukup terapkan semuanya untuk Java 8 dalam kelas non-final yang terpisah, dan gantikan pewaris untuk Java 9.  Itu dilakukan seperti ini: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//    Internals static final VersionSpecific VER_SPEC = System.getProperty("java.version", "").compareTo("1.9") &gt; 0 ? new Java9Specific() : new VersionSpecific();</span></span></code> </pre> <br><p>  Kemudian pada titik-titik penggunaan, Anda cukup menulis <code>return Internals.VER_SPEC.takeWhile(stream, predicate)</code> .  Semua keajaiban dengan pegangan metode sekarang hanya di kelas <code>Java9Specific</code> .  Pendekatan ini, omong-omong, menyelamatkan perpustakaan untuk pengguna Android yang sebelumnya mengeluh bahwa itu tidak bekerja secara prinsip.  Mesin virtual Android bukan Java, bahkan tidak mengimplementasikan spesifikasi Java 7. Secara khusus, tidak ada metode dengan tanda tangan polimorfik seperti <code>invokeExact</code> , dan keberadaan panggilan ini dalam bytecode akan merusak segalanya.  Sekarang panggilan ini ditempatkan di kelas yang tidak pernah diinisialisasi. </p><br><p>  Namun, semua ini masih jelek.  Solusi yang indah (setidaknya secara teori) adalah dengan menggunakan Jar Rilis Multi, yang datang dengan Java 9 ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">JEP-238</a> ).  Untuk melakukan ini, bagian dari kelas harus dikompilasi di bawah Java 9 dan mengkompilasi file kelas yang ditempatkan di <code>META-INF/versions/9</code> di dalam file Jar.  Selain itu, Anda perlu menambahkan baris <code>Multi-Release: true</code> ke manifes.  Kemudian Java 8 akan berhasil mengabaikan semua ini, dan Java 9 dan yang lebih baru akan memuat kelas baru, bukan kelas dengan nama yang sama yang terletak di tempat biasa. </p><br><p>  Pertama kali saya mencoba melakukan ini lebih dari dua tahun yang lalu, tak lama sebelum rilis Java 9. Itu berjalan sangat sulit, dan saya berhenti.  Bahkan sulit untuk membuat proyek dikompilasi oleh kompiler dari Java 9: â€‹â€‹banyak plugin Maven rusak karena perubahan API internal, perubahan <code>java.version</code> string <code>java.version</code> atau yang lainnya. </p><br><p>  Upaya baru tahun ini lebih berhasil.  Sebagian besar plugin telah diperbarui dan berfungsi dengan cukup baik di Jawa baru.  Langkah pertama saya menerjemahkan seluruh unit ke dalam Java 11. Untuk ini, selain memperbarui versi plugin, saya harus melakukan hal berikut: </p><br><ul><li>  Ubah tautan <code>&lt;a name="..."&gt;</code> dari formulir <code>&lt;a name="..."&gt;</code> menjadi <code>&lt;a id="..."&gt;</code> .  Jika tidak, JavaDoc mengeluh. </li><li>  Tentukan opsi <code>additionalOptions = --no-module-directories</code> di maven-javadoc-plugin.  Tanpa ini, ada bug aneh dengan fitur pencarian JavaDoc: direktori dengan modul masih belum dibuat, tetapi ketika beralih ke hasil pencarian, <code>/undefined/</code> ditambahkan ke path (halo, JavaScript).  Fitur ini di Java 8 sama sekali tidak, jadi aktivitas saya sudah membawa hasil yang bagus: JavaDoc telah menjadi pencarian. </li><li>  Perbaiki plugin untuk menerbitkan hasil cakupan pengujian di Coveralls ( <code>coveralls-maven-plugin</code> ).  Untuk beberapa alasan itu ditinggalkan, yang aneh, mengingat bahwa Baju tinggal sendiri dan menawarkan layanan komersial.  Jaxb-api yang digunakan plugin hilang dari Java 11.  Untungnya, tidak sulit untuk memperbaiki masalah menggunakan alat Maven: cukup untuk secara eksplisit mendaftarkan ketergantungan pada plugin: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.eluder.coveralls<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>coveralls-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>4.3.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>javax.xml.bind<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jaxb-api<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.2.3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </li></ul><br><p>  Langkah selanjutnya adalah adaptasi tes.  Karena perilaku pustaka jelas berbeda di Java 8 dan Java 9, akan logis untuk menjalankan tes untuk kedua versi.  Sekarang kita menjalankan semuanya di bawah Java 11, jadi kode khusus Java 8 tidak diuji.  Ini adalah kode yang cukup besar dan non-sepele.  Untuk mengatasinya, saya membuat pena buatan: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> VersionSpecific VER_SPEC = System.getProperty(<span class="hljs-string"><span class="hljs-string">"java.version"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>).compareTo(<span class="hljs-string"><span class="hljs-string">"1.9"</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; !Boolean.getBoolean(<span class="hljs-string"><span class="hljs-string">"one.util.streamex.emulateJava8"</span></span>) ? <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Java9Specific() : <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VersionSpecific();</code> </pre> <br><p>  Sekarang, lewati <code>-Done.util.streamex.emulateJava8=true</code> saat menjalankan tes, <br>  untuk menguji apa yang biasanya berfungsi di Java 8. Sekarang tambahkan blok <code>&lt;execution&gt;</code> ke konfigurasi <code>maven-surefire-plugin</code> dengan <code>argLine = -Done.util.streamex.emulateJava8=true</code> , dan tes lulus dua kali. </p><br><p>  Namun, saya ingin mempertimbangkan tes cakupan total.  Saya menggunakan JaCoCo, dan jika Anda tidak memberi tahu apa-apa padanya, maka jalankan kedua hanya akan menimpa hasil yang pertama.  Bagaimana cara kerja JaCoCo?  Pertama-tama menjalankan target preparate <code>prepare-agent</code> , yang menetapkan properti argLine Maven, menandatangani sesuatu seperti <code>-javaagent:blah-blah/.m2/org/jacoco/org.jacoco.agent/0.8.4/org.jacoco.agent-0.8.4-runtime.jar=destfile=blah-blah/myproject/target/jacoco.exec</code> .  Saya ingin dua file exec yang berbeda dibentuk.  Anda dapat meretasnya dengan cara ini.  Tambahkan <code>destFile=${project.build.directory}</code> konfigurasi <code>destFile=${project.build.directory}</code> <code>prepare-agent</code> .  Kasar tapi efektif.  Sekarang <code>argLine</code> akan berakhir dengan <code>blah-blah/myproject/target</code> .  Ya, ini bukan file sama sekali, tetapi direktori.  Tapi kita bisa mengganti nama file di awal tes.  Kami kembali ke <code>maven-surefire-plugin</code> dan mengatur <code>argLine = @{argLine}/jacoco_java8.exec -Done.util.streamex.emulateJava8=true</code> untuk menjalankan Java 8 dan <code>argLine = @{argLine}/jacoco_java11.exec</code> untuk menjalankan Java 11.  Maka mudah untuk menggabungkan dua file ini menggunakan target <code>merge</code> , yang disediakan oleh plugin JaCoCo, dan kami mendapatkan cakupan keseluruhan. </p><br><p>  <strong>Perbarui:</strong> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">godin</a> dalam komentar mengatakan bahwa itu tidak perlu, Anda dapat menulis ke satu file, dan itu akan secara otomatis merekatkan hasilnya dengan yang sebelumnya.  Sekarang saya tidak yakin mengapa skenario ini pada awalnya tidak berhasil bagi saya. </p><br><p>  Kami siap untuk beralih ke Jar Multi-Rilis.  Saya menemukan sejumlah rekomendasi tentang cara melakukan ini.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Yang pertama</a> menyarankan penggunaan proyek multi-modular Maven.  Saya tidak merasa seperti itu: ini adalah komplikasi besar dari struktur proyek: ada lima pom.xml, misalnya.  Untuk bermain-main demi beberapa file yang perlu dikompilasi di Java 9 tampaknya berlebihan.  Kompilasi awal yang disarankan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">lainnya</a> melalui <code>maven-antrun-plugin</code> .  Di sini saya memutuskan untuk hanya melihat sebagai pilihan terakhir.  Jelas bahwa masalah apa pun di Maven dapat diselesaikan menggunakan Ant, tetapi ini agak canggung.  Akhirnya, saya melihat rekomendasi untuk menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">plugin multi-release-jar-maven-plugin</a> pihak ketiga.  Itu sudah terdengar enak dan benar. </p><br><p>  Plugin merekomendasikan penempatan kode sumber khusus untuk versi baru Java di direktori seperti <code>src/main/java-mr/9</code> , yang saya lakukan.  Saya masih memutuskan untuk menghindari tabrakan dalam nama kelas secara maksimal, sehingga satu-satunya kelas (bahkan antarmuka) yang ada di Java 8 dan Java 9, saya punya ini: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Java 8 package one.util.streamex; /* package */ interface VerSpec { VersionSpecific VER_SPEC = new VersionSpecific(); } // Java 9 package one.util.streamex; /* package */ interface VerSpec { VersionSpecific VER_SPEC = new Java9Specific(); }</span></span></code> </pre> <br><p>  Konstanta lama pindah ke tempat baru, tetapi tidak ada yang benar-benar berubah.  Hanya sekarang kelas <code>Java9Specific</code> menjadi lebih sederhana: semua squat dengan MethodHandle telah berhasil diganti dengan pemanggilan metode langsung. </p><br><p>  Plugin berjanji untuk melakukan hal-hal berikut: </p><br><ul><li>  Ganti <code>maven-compiler-plugin</code> dan kompilasi dalam dua langkah dengan versi target yang berbeda. </li><li>  Ganti <code>maven-jar-plugin</code> dan <code>maven-jar-plugin</code> hasil kompilasi dengan jalur yang benar. </li><li>  Tambahkan baris <code>Multi-Release: true</code> ke <code>MANIFEST.MF</code> . </li></ul><br><p>  Agar bisa bekerja, dibutuhkan beberapa langkah. </p><br><ol><li><p>  Ubah kemasan dari <code>jar</code> ke <code>jar</code> <code>multi-release-jar</code> . </p><br></li><li><p>  Tambahkan ekstensi-bangunan: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>pw.krejci<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>multi-release-jar-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.1.5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></li><li><p>  Salin konfigurasi dari <code>maven-compiler-plugin</code> .  Saya hanya memiliki versi default dengan semangat <code>&lt;source&gt;1.8&lt;/source&gt;</code> dan <code>&lt;arg&gt;-Xlint:all&lt;/arg&gt;</code> </p><br></li><li><p>  Saya berpikir bahwa <code>maven-compiler-plugin</code> sekarang dapat dihapus, tetapi ternyata plugin baru tidak menggantikan kompilasi tes, jadi untuk itu versi Java di-reset ke default (1.5!) Dan <code>-Xlint:all</code> argumen hilang.  Jadi saya harus pergi. </p><br></li><li><p>  Agar tidak menduplikasi sumber dan target untuk dua plugin, saya menemukan bahwa mereka menghormati properti <code>maven.compiler.source</code> dan <code>maven.compiler.target</code> .  Saya menginstalnya dan menghapus versi dari pengaturan plugin.  Namun, tiba-tiba ternyata <code>maven-javadoc-plugin</code> menggunakan <code>source</code> dari pengaturan <code>maven-compiler-plugin</code> untuk mengetahui URL JavaDoc standar, yang harus ditautkan ketika merujuk metode standar.  Dan sekarang dia tidak menghormati <code>maven.compiler.source</code> .  Karenanya, saya harus mengembalikan <code>&lt;source&gt;${maven.compiler.source}&lt;/source&gt;</code> ke pengaturan <code>maven-compiler-plugin</code> .  Untungnya, tidak ada perubahan lain yang diperlukan untuk menghasilkan JavaDoc.  Ini sangat baik dapat dihasilkan dari sumber Java 8, karena seluruh korsel dengan versi tidak mempengaruhi API perpustakaan. </p><br></li><li><p>  <code>maven-bundle-plugin</code> , yang mengubah perpustakaan saya menjadi artefak OSGi.  Dia hanya menolak untuk bekerja dengan <code>packaging = multi-release-jar</code> .  Pada prinsipnya, saya tidak pernah menyukainya.  Dia menulis satu set baris tambahan ke manifes, pada saat yang sama merusak urutan penyortiran dan menambahkan lebih banyak sampah.  Untungnya, ternyata tidak sulit untuk menghilangkannya dengan menulis semua yang Anda butuhkan dengan tangan.  Hanya saja, tentu saja, bukan di <code>maven-jar-plugin</code> , tetapi di yang baru.  Seluruh konfigurasi plugin <code>multi-release-jar</code> akhirnya menjadi seperti ini (saya mendefinisikan beberapa properti seperti <code>project.package</code> sendiri): </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>pw.krejci<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>multi-release-jar-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.1.5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">compilerArgs</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg</span></span></span><span class="hljs-tag">&gt;</span></span>-Xlint:all<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">compilerArgs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifestEntries</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Automatic-Module-Name</span></span></span><span class="hljs-tag">&gt;</span></span>${project.package}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Automatic-Module-Name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Name</span></span></span><span class="hljs-tag">&gt;</span></span>${project.name}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Description</span></span></span><span class="hljs-tag">&gt;</span></span>${project.description}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-License</span></span></span><span class="hljs-tag">&gt;</span></span>${license.url}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-License</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-ManifestVersion</span></span></span><span class="hljs-tag">&gt;</span></span>2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-ManifestVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-SymbolicName</span></span></span><span class="hljs-tag">&gt;</span></span>${project.package}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-SymbolicName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Version</span></span></span><span class="hljs-tag">&gt;</span></span>${project.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Export-Package</span></span></span><span class="hljs-tag">&gt;</span></span>${project.package};version="${project.version}"<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Export-Package</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifestEntries</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></li><li><p>  Tes.  Kami tidak lagi memiliki <code>one.util.streamex.emulateJava8</code> , tetapi Anda dapat mencapai efek yang sama dengan memodifikasi tes jalur kelas.  Sekarang kebalikannya benar: secara default, perpustakaan berfungsi dalam mode Java 8, dan untuk Java 9 Anda perlu menulis: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">classesDirectory</span></span></span><span class="hljs-tag">&gt;</span></span>${basedir}/target/classes-9<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">classesDirectory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">additionalClasspathElements</span></span></span><span class="hljs-tag">&gt;</span></span>${project.build.outputDirectory}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">additionalClasspathElements</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argLine</span></span></span><span class="hljs-tag">&gt;</span></span>@{argLine}/jacoco_java9.exec<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argLine</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Poin penting: <code>classes-9</code> harus mendahului file kelas biasa, jadi kami harus mentransfer yang biasa ke <code>additionalClasspathElements</code> , yang ditambahkan setelahnya. </p><br></li><li><p>  Sumber.  Saya akan memiliki sumber-jar, dan akan lebih baik untuk mengemas sumber-sumber Java 9 ke dalamnya sehingga, misalnya, debugger di IDE dapat menampilkannya dengan benar.  Saya tidak terlalu khawatir tentang duplikat <code>VerSpec</code> , karena ada satu baris, yang dieksekusi hanya selama inisialisasi.  Tidak apa-apa bagi saya untuk hanya menyisakan versi dari Java 8. Namun, alangkah <code>Java9Specific.java</code> untuk melampirkan <code>Java9Specific.java</code> .  Ini dapat dilakukan dengan menambahkan secara manual direktori sumber tambahan: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.codehaus.mojo<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>build-helper-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>3.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>test<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>add-source<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">souâ€‹rces</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">souâ€‹rce</span></span></span><span class="hljs-tag">&gt;</span></span>src/main/java-mr/9<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">souâ€‹rce</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">souâ€‹rces</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Setelah mengumpulkan artefak, saya menghubungkannya ke proyek uji dan memeriksanya di debugger IntelliJ IDEA.  Semuanya berfungsi dengan baik: tergantung pada versi mesin virtual yang digunakan untuk menjalankan proyek pengujian, kami berakhir di sumber yang berbeda saat melakukan debugging. </p><br><p>  Akan sangat menyenangkan untuk melakukan ini dengan plugin multi-release-jar itu sendiri, jadi saya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">membuat</a> saran seperti itu. </p><br></li><li><p>  JaCoCo.  Ternyata itu yang paling sulit baginya, dan aku tidak bisa melakukannya tanpa bantuan dari luar.  Faktanya adalah bahwa plug-in sempurna dihasilkan file-file untuk Java-8 dan Java-9, biasanya menempelkannya ke dalam satu file, namun, ketika menghasilkan laporan dalam XML dan HTML, mereka dengan keras kepala mengabaikan sumber-sumber dari Java-9.  Mengaduk- <a href="">aduk sumber</a> , saya melihat bahwa itu hanya menghasilkan laporan untuk file kelas yang ditemukan di <code>project.getBuild().getOutputDirectory()</code> .  Direktori ini, tentu saja, dapat diganti, tetapi sebenarnya saya memiliki dua di antaranya: <code>classes</code> dan <code>classes-9</code> .  Secara teoritis, Anda dapat menyalin semua kelas ke satu direktori, mengubah <code>outputDirectory</code> dan menjalankan JaCoCo, dan kemudian mengubah kembali <code>outputDirectory</code> agar tidak merusak perakitan JAR.  Tapi itu terdengar sangat jelek.  Secara umum, saya memutuskan untuk menunda solusi untuk masalah ini dalam proyek saya, tetapi saya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menulis kepada</a> orang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">-</a> orang dari JaCoCo bahwa akan lebih baik untuk dapat menentukan beberapa direktori dengan file kelas. </p><br><p>  Yang mengejutkan saya, hanya beberapa jam kemudian salah satu pengembang JaCoCo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">godin</a> datang ke proyek saya dan membawa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">permintaan tarik</a> , yang menyelesaikan masalah.  Bagaimana keputusannya?  Menggunakan Semut, tentu saja!  Ternyata Ant-plugin untuk JaCoCo lebih maju dan dapat menghasilkan laporan ringkasan untuk beberapa direktori sumber dan file kelas.  Dia bahkan tidak memerlukan langkah <code>merge</code> terpisah, karena dia dapat memberi makan beberapa file sekaligus.  Secara umum, Semut tidak bisa dihindari, jadi begitu.  Hal utama yang berhasil, dan pom.xml hanya tumbuh enam baris. </p><br><p><img src="https://habrastorage.org/webt/-y/qd/q9/-yqdq9suyxlqtaw2d9dkjoc0rg8.png"></p><br><p>  Saya bahkan tweet dalam hati: </p><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1185422598810800129"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br></li></ol><br><p>  Jadi saya punya proyek yang sangat bagus yang membangun Jar Multi-Rilis yang indah.  Pada saat yang sama, persentase cakupan bahkan meningkat, karena saya menghapus semua jenis <code>catch (NoSuchMethodException | IllegalAccessException e)</code> yang tidak dapat dicapai di Jawa 9. Sayangnya, struktur proyek ini tidak didukung oleh IntelliJ IDEA, jadi saya harus meninggalkan impor POM dan mengkonfigurasi proyek dalam IDE secara manual .  Saya berharap bahwa di masa depan masih akan ada solusi standar yang akan secara otomatis didukung oleh semua plugin dan alat. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id472312/">https://habr.com/ru/post/id472312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id472298/index.html">Intisari bahan-bahan segar dari dunia front-end untuk minggu terakhir No. 385 (14-20 Oktober 2019)</a></li>
<li><a href="../id472300/index.html">Stochastic gradient descent (SGD) untuk fungsi kehilangan logaritmik (LogLoss) dalam masalah klasifikasi biner</a></li>
<li><a href="../id472304/index.html">NASA merekrut insinyur untuk mengembangkan robot humanoid generasi berikutnya</a></li>
<li><a href="../id472306/index.html">PHP Digest No. 166 (7-21 Oktober, 2019)</a></li>
<li><a href="../id472310/index.html">Identifikasi klien di situs tanpa kata sandi dan cookie: aplikasi untuk standar</a></li>
<li><a href="../id472314/index.html">Saya suka orang kardus</a></li>
<li><a href="../id472318/index.html">Pelacakan Terdistribusi di Istio</a></li>
<li><a href="../id472320/index.html">Wawancara dengan Zabbix: 12 jawaban jujur</a></li>
<li><a href="../id472326/index.html">Industri luar angkasa kami ... Dan jika Anda melihat masalah industri dari sudut pandang seorang geek?</a></li>
<li><a href="../id472334/index.html">Hidup dengan kupon atau cara kami mengoptimalkan pekerjaan layanan sosial</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>