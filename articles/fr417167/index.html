<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍✈️ 🍶 👩‍👩‍👧 Lancez LDA dans le monde réel. Guide détaillé 🍑 ♋️ 👨🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Préface 


 Il existe de nombreux tutoriels sur Internet qui expliquent comment fonctionne le LDA (Latent Dirichlet Allocation) et comment le mettre e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lancez LDA dans le monde réel. Guide détaillé</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417167/"><h2 id="predislovie">  Préface </h2><br><p>  Il existe de nombreux tutoriels sur Internet qui expliquent comment fonctionne le LDA (Latent Dirichlet Allocation) et comment le mettre en pratique.  Des exemples de formation LDA sont souvent présentés sur des ensembles de données «exemplaires», tels que «l'ensemble de données 20 groupes de discussion», qui est disponible sur sklearn. </p><br><p>  Une caractéristique de la formation sur l'exemple d'ensembles de données "exemplaires" est que les données y sont toujours en ordre et empilées en un seul endroit.  Lors de la formation de modèles de production, les données obtenues directement à partir de sources réelles sont généralement le contraire: </p><br><ul><li>  Beaucoup d'émissions. </li><li>  Balisage incorrect (le cas échéant). </li><li>  Déséquilibres de classe très forts et distributions moches de tous les paramètres de l'ensemble de données. </li><li>  Pour les textes, ce sont: les erreurs grammaticales, un grand nombre de mots rares et uniques, le multilinguisme. </li><li>  Un moyen peu pratique de stocker des données (formats différents ou rares, besoin d'analyse) </li></ul><br><p>  Historiquement, j'essaie d'apprendre à partir d'exemples qui se rapprochent le plus possible des réalités de la réalité de production car c'est de cette façon que l'on peut le plus pleinement percevoir les zones problématiques d'un type de tâche particulier.  C'était donc avec le LDA, et dans cet article, je veux partager mon expérience - comment exécuter LDA à partir de zéro, sur des données complètement brutes.  Une partie de l'article sera consacrée à l'obtention de ces mêmes données, afin que l'exemple devienne un «cas d'ingénierie» à part entière. </p><a name="habracut"></a><br><h2 id="topic-modeling-i-lda">  Modélisation de sujets et LDA. </h2><br><p>  Pour commencer, considérez ce que fait le LDA en général et quelles tâches il utilise. <br>  Le plus souvent, LDA est utilisé pour les tâches de modélisation de sujet.  De telles tâches signifient les tâches de regroupement ou de classification des textes - de telle manière que chaque classe ou cluster contient des textes ayant des sujets similaires. </p><br><p>  Afin d'appliquer la LDA à l'ensemble de données des textes (ci-après dénommé le corps du texte), il est nécessaire de transformer le corps en une matrice terme-document. </p><br><p>  Une matrice de document de terme est une matrice qui a une taille <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>o</mi><mi>i</mi><mi>s</mi><mi>W</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.379ex" height="2.419ex" viewBox="0 -780.1 4038 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-4E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-66" x="1138" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-6F" x="1689" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-69" x="2174" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-73" x="2520" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-57" x="2989" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mtext>&nbsp;</mtext><mi>f</mi><mi>o</mi><mi>i</mi><mi>s</mi><mi>W</mi></math></span></span><script type="math/tex" id="MathJax-Element-1"> N \ fois W </script>  où <br>  N est le nombre de documents dans l'affaire, et W est la taille du dictionnaire de l'affaire, c'est-à-dire  le nombre de mots (uniques) que l'on retrouve dans notre corpus.  Dans la i-ème ligne, la j-ème colonne de la matrice est un nombre - combien de fois dans le i-ème texte le j-ème mot a été trouvé. </p><br><p>  Le LDA construit, pour une matrice de document Term donnée et T d'un nombre prédéterminé de thèmes, deux distributions: </p><br><ol><li>  La répartition des sujets dans les textes (en pratique, donnée par la matrice de taille <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>o</mi><mi>i</mi><mi>s</mi><mi>T</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.58ex" height="2.419ex" viewBox="0 -780.1 3694 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-4E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-66" x="1138" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-6F" x="1689" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-69" x="2174" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-73" x="2520" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-54" x="2989" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mtext>&nbsp;</mtext><mi>f</mi><mi>o</mi><mi>i</mi><mi>s</mi><mi>T</mi></math></span></span><script type="math/tex" id="MathJax-Element-2"> N \ fois T </script>  ) </li><li>  La répartition des mots par sujet (matrice de taille <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>T</mi><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>o</mi><mi>i</mi><mi>s</mi><mi>W</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.951ex" height="2.419ex" viewBox="0 -780.1 3854 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-66" x="954" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-6F" x="1505" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-69" x="1990" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-73" x="2336" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-57" x="2805" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mtext>&nbsp;</mtext><mi>f</mi><mi>o</mi><mi>i</mi><mi>s</mi><mi>W</mi></math></span></span><script type="math/tex" id="MathJax-Element-3"> T \ fois W </script>  ) </li></ol><br><p>  Les valeurs des cellules de ces matrices sont, respectivement, les probabilités que ce sujet soit contenu dans ce document (ou la proportion du sujet dans le document, si nous considérons le document comme un mélange de différents sujets) pour la matrice `` Distribution des sujets dans les textes ''. </p><br><p>  Pour la matrice `` Distribution des mots par thèmes '', les valeurs sont la probabilité de rencontrer le mot j dans le texte avec le sujet i, qualitativement, nous pouvons considérer ces nombres comme des coefficients caractérisant la façon dont ce mot est typique de ce sujet. </p><br><p>  Il faut dire que le mot sujet n'est pas une définition «quotidienne» de ce mot.  La LDA attribue T à ceux-ci, mais quel type de sujets sont-ils et s'ils correspondent à des sujets de textes bien connus, tels que: «Sport», «Science», «Politique» - est inconnu.  Dans ce cas, il est plus approprié de parler du sujet comme d'une sorte d'entité abstraite, qui est définie par une ligne dans la matrice de distribution des mots par sujet et avec une certaine probabilité correspond à ce texte, si vous pouvez l'imaginer comme une famille d'ensembles caractéristiques de mots se rencontrant avec les probabilités correspondantes (du tableau) dans un certain ensemble de textes. </p><br><p>  Si vous souhaitez étudier plus en détail et «dans les formules» comment le LDA est formé et fonctionne, voici quelques documents (qui ont été utilisés par l'auteur): </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article original</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">En anglais, avec des exemples illustratifs</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Détails en russe</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">À propos de la mise en œuvre de Python</a> </li></ul><br><h2 id="dobyvaem-dikie-dannye">  Nous obtenons des données sauvages </h2><br><p>  Pour nos «travaux de laboratoire», nous avons besoin d'un ensemble de données personnalisé avec ses propres défauts et fonctionnalités.  Vous pouvez l'obtenir à différents endroits: téléchargez des critiques de Kinopoisk, des articles Wikipédia, des nouvelles d'un portail de nouvelles, nous prendrons une option un peu plus extrême - des publications des communautés VKontakte. </p><br><p>  Nous ferons ceci comme ceci: </p><br><ol><li>  Nous sélectionnons un utilisateur VK. </li><li>  Nous obtenons une liste de tous ses amis. </li><li>  Pour chaque ami, nous prenons toute sa communauté. </li><li>  Pour chaque communauté de chaque ami, nous pompons les n (n = 100) premiers messages de la communauté et les combinons en un seul texte de communauté. </li></ol><br><h4 id="instrumenty-i-stati">  Outils et articles </h4><br><p>  Pour télécharger des articles, nous utiliserons le module vk pour travailler avec l'API VKontakte, pour Python.  L'un des moments les plus complexes lors de l'écriture d'une application à l'aide de l'API VKontakte est l'autorisation, heureusement, le code qui effectue ce travail est déjà écrit et est dans le domaine public, sauf pour vk, j'ai utilisé un petit module d'autorisation - vkauth. </p><br><p>  Liens vers les modules et articles utilisés pour étudier l'API VKontakte: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vkauth</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tutoriel vkauth</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tutoriel vk</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tutoriel vk numéro 2</a> </li><li>  Documentation officielle de l'API Vkontakte </li></ul><br><h4 id="pishem-kod">  Écrire un code </h4><br><p>  Et donc, en utilisant vkauth, connectez-vous: </p><br><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#authorization of app using modules imported. app_id = '6203169' perms = ['photos','friends','groups'] API_ver = '5.68' Auth = VKAuth(perms, app_id, API_ver) Auth.auth() token = Auth.get_token() user_id = Auth.get_user_id() #starting session session = vk.Session(access_token=token) api = vk.API(session)</span></span></code> </pre> <br><p>  Dans le processus, un petit module a été écrit contenant toutes les fonctions nécessaires au téléchargement de contenu au format approprié, elles sont listées ci-dessous, passons en revue: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_friends_ids</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(api, user_id)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">''' For a given API object and user_id returns a list of all his friends ids. '''</span></span> friends = api.friends.get(user_id=user_id, v = <span class="hljs-string"><span class="hljs-string">'5.68'</span></span>) friends_ids = friends[<span class="hljs-string"><span class="hljs-string">'items'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> friends_ids <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_user_groups</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(api, user_id, moder=True, only_open=True)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">''' For a given API user_id returns list of all groups he subscribed to. Flag model to get only those groups where user is a moderator or an admin) Flag only_open to get only public(open) groups. '''</span></span> kwargs = {<span class="hljs-string"><span class="hljs-string">'user_id'</span></span> : user_id, <span class="hljs-string"><span class="hljs-string">'v'</span></span> : <span class="hljs-string"><span class="hljs-string">'5.68'</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> moder == <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: kwargs[<span class="hljs-string"><span class="hljs-string">'filter'</span></span>] = <span class="hljs-string"><span class="hljs-string">'moder'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> only_open == <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: kwargs[<span class="hljs-string"><span class="hljs-string">'extended'</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span> kwargs[<span class="hljs-string"><span class="hljs-string">'fields'</span></span>] = [<span class="hljs-string"><span class="hljs-string">'is_closed'</span></span>] groups = api.groups.get(**kwargs) groups_refined = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> group <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> groups[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]: cond_check = (only_open <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> group[<span class="hljs-string"><span class="hljs-string">'is_closed'</span></span>] == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> only_open <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cond_check: refined = {} refined[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] = group[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] * (<span class="hljs-number"><span class="hljs-number">-1</span></span>) refined[<span class="hljs-string"><span class="hljs-string">'name'</span></span>] = group[<span class="hljs-string"><span class="hljs-string">'name'</span></span>] groups_refined.append(refined) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> groups_refined <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_n_posts_text</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(api, group_id, n_posts=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">50</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">''' For a given api and group_id returns first n_posts concatenated as one text. '''</span></span> wall_contents = api.wall.get(owner_id = group_id, count=n_posts, v = <span class="hljs-string"><span class="hljs-string">'5.68'</span></span>) wall_contents = wall_contents[<span class="hljs-string"><span class="hljs-string">'items'</span></span>] text = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> post <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> wall_contents: text += post[<span class="hljs-string"><span class="hljs-string">'text'</span></span>] + <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text</code> </pre> <br><p>  Le pipeline final est le suivant: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#id of user whose friends you gonna get, like: https://vk.com/id111111111 user_id = 111111111 friends_ids = vt.get_friends_ids(api, user_id) #collecting all groups groups = [] for i,friend in tqdm(enumerate(friends_ids)): if i % 3 == 0: sleep(1) friend_groups = vt.get_user_groups(api, friend, moder=False) groups += friend_groups #converting groups to dataFrame groups_df = pd.DataFrame(groups) groups_df.drop_duplicates(inplace=True) #reading content(content == first 100 posts) for i,group in tqdm(groups_df.iterrows()): name = group['name'] group_id = group['id'] #Different kinds of fails occures during scrapping #For examples there are names of groups with slashes #Like: 'The Kaaats / Indie-rock' try: content = vt.get_n_posts_text(api, group_id, n_posts=100) dst_path = join(data_path, name + '.txt') with open(dst_path, 'w+t') as f: f.write(content) except Exception as e: print('Error occured on group:', name) print(e) continue #need it because of requests limitaion in VK API. if i % 3 == 0: sleep(1)</span></span></code> </pre> <br><h4 id="fails">  Échoue </h4><br><p>  En général, le processus de téléchargement de données n'est pas difficile en soi; vous devez faire attention à seulement deux points: </p><br><ol><li>  Parfois, en raison de la confidentialité de certaines communautés, vous recevrez des erreurs d'accès, parfois d'autres erreurs seront résolues en installant try, sauf au bon endroit. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">VK a une limite</a> sur le nombre de requêtes par seconde. </li></ol><br><p>  Lorsque vous effectuez un grand nombre de demandes, par exemple dans une boucle, nous détectons également des erreurs.  Ce problème peut être résolu de plusieurs manières: </p><br><ol><li>  Stupidement et sans détour: Stick sommeil (certains) toutes les 3 demandes.  Cela se fait sur une seule ligne et ralentit considérablement le déchargement, dans des situations où les volumes de données ne sont pas importants et où il n'y a pas de temps pour des méthodes plus sophistiquées - cela est tout à fait acceptable (implémenté dans cet article). </li><li>  Comprendre le travail des demandes de sondage long <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://vk.com/dev/using_longpoll</a> </li></ol><br><p>  Dans cet article, une méthode simple et lente a été choisie, à l'avenir, j'écrirai probablement un micro article sur les moyens de contourner ou d'assouplir les restrictions sur le nombre de requêtes par seconde. </p><br><h4 id="itog">  Résumé </h4><br><p>  Avec la graine «certains» utilisateurs ayant ~ 150 amis, ils ont réussi à obtenir 4 679 textes - chacun caractérise une certaine communauté VK.  Les textes varient considérablement en taille et sont écrits dans de nombreuses langues - certains d'entre eux ne conviennent pas à nos fins, mais nous en parlerons un peu plus loin. </p><br><h3 id="osnovnaya-chast">  Corps principal </h3><br><p><img src="https://habrastorage.org/webt/bj/to/hm/bjtohmsrvsxlcbs78u0thlawxky.png" alt="image"></p><br><p>  Passons en revue tous les blocs de notre pipeline - d'abord, sur le obligatoire (idéal), puis sur le reste - ils sont juste du plus grand intérêt. </p><br><h4 id="countvectorizer">  Countvectorizer </h4><br><p>  Avant d'enseigner le LDA, nous devons présenter nos documents sous la forme d'une matrice de documents Term.  Cela comprend généralement des opérations telles que: </p><br><ul><li>  Suppression des puttuctions / numéros / jetons inutiles. </li><li>  Tokenisation (présentation sous forme de liste de mots) </li><li>  Compter les mots, compiler une matrice de document thermique. </li></ul><br><p>  Toutes ces actions dans sklearn sont commodément implémentées dans le cadre d'une entité de programme - sklearn.feature_extraction.text.CountVectorizer. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien vers la documentation</a> </p><br><p>  Il vous suffit de: </p><br><pre> <code class="python hljs">count_vect = CountVectorizer(input=<span class="hljs-string"><span class="hljs-string">'filename'</span></span>, stop_words=stopwords, vocabulary=voc) dataset = count_vect.fit_transform(train_names)</code> </pre> <br><h4 id="lda">  Lda </h4><br><p>  De même avec CountVectorizer, LDA est parfaitement implémenté dans Sklearn et d'autres frameworks, donc, il n'y a pas beaucoup de sens à consacrer beaucoup d'espace directement à leurs implémentations, dans notre article purement pratique. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien vers la documentation</a> </p><br><p>  Tout ce dont vous avez besoin pour démarrer LDA est: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#training LDA lda = LDA(n_components = 60, max_iter=30, n_jobs=6, learning_method='batch', verbose=1) lda.fit(dataset)</span></span></code> </pre> <br><h4 id="preprocessing">  Prétraitement </h4><br><p>  Si nous prenons juste nos textes immédiatement après les avoir téléchargés et convertis en une matrice Term-document à l'aide de CountVectorizer, avec le tokenizer par défaut intégré, nous obtiendrons une matrice de taille 4679x769801 (sur les données que j'utilise). </p><br><p>  La taille de notre dictionnaire sera de 769801. Même si nous supposons que la plupart des mots sont informatifs, il est peu probable que nous obtenions un bon LDA, quelque chose comme "Curses of Dimensions" nous attend, sans mentionner que pour presque tous les ordinateurs, nous allons simplement obstruer toute la RAM.  En fait, la plupart de ces mots sont complètement informatifs.  La grande majorité d'entre eux sont: </p><br><ul><li>  Émoticônes, personnages, chiffres. </li><li>  Mots uniques ou très rares (par exemple, mots polonais d'un groupe avec des mèmes polonais, mots mal orthographiés ou en «albanais»). </li><li>  Parties du discours très fréquentes (par exemple, prépositions et pronoms). </li></ul><br><p>  De plus, de nombreux groupes dans VK se spécialisent exclusivement dans les images - il n'y a presque pas de texte là-bas - les textes qui leur correspondent sont dégénérés, dans la matrice de document thermique, ils nous donneront presque complètement zéro lignes. </p><br><p>  Et donc, trions le tout! <br>  Nous tokenisons tous les textes, en supprimons la ponctuation et les nombres, regardons l'histogramme de la répartition des textes par le nombre de mots: <br><img src="https://habrastorage.org/webt/v4/qh/w0/v4qhw0mrgpizranmnptbz5lnivk.png" alt="image"></p><br><p>  Nous supprimons tous les textes de moins de 100 mots (il y en a 525) </p><br><p>  Maintenant le dictionnaire: <br>  Supprimer tous les jetons (mots) qui ne sont pas des lettres, dans le cadre de notre tâche - cela est tout à fait acceptable.  Le CountVectorizer le fait seul, même si ce n'est pas le cas, je pense qu'il n'est pas nécessaire de donner des exemples (ils sont dans la version complète du code de l'article). </p><br><p>  L'une des procédures les plus courantes pour réduire la taille d'un dictionnaire consiste à supprimer les soi-disant mots vides (mots vides) - des mots qui ne portent pas de charge sémantique et / ou qui n'ont pas de coloration thématique (dans notre cas, la modélisation de sujet).  De tels mots dans notre cas sont, par exemple: </p><br><ul><li>  Pronoms et prépositions. </li><li>  Articles - le, a. </li><li>  Mots communs: «être», «bon», «probablement», etc. </li></ul><br><p>  Le module nltk a formé des listes de mots vides en russe et en anglais, mais ils sont plutôt faibles.  Sur Internet, vous pouvez également trouver des listes de mots vides pour n'importe quelle langue et les ajouter à ceux de nltk.  Nous allons donc faire.  Prenez des mots d'arrêt supplémentaires d'ici: </p><br><ul><li>  <a href="">https://github.com/stopwords-iso/stopwords-ru/blob/master/stopwords-ru.json</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://gist.github.com/menzenski/7047705</a> </li></ul><br><p>  En pratique, lors de la résolution de problèmes spécifiques, les listes de mots vides sont progressivement ajustées et complétées au fur et à mesure que les modèles sont entraînés, car pour chaque jeu de données et problème spécifique, il existe des mots "incohérents" spécifiques.  Nous récupérerons également des mots d'arrêt personnalisés après avoir formé notre LDA de première génération. </p><br><p>  En soi, la procédure de suppression des mots vides est intégrée au CountVectorizer - nous avons juste besoin d'une liste d'entre eux. </p><br><p>  Est-ce que nous en avons fait assez? </p><br><p><img src="https://habrastorage.org/webt/ja/xd/6l/jaxd6lnbbnd_dmmmk6nog9a2ntm.png" alt="image"></p><br><p>  La plupart des mots qui sont dans notre dictionnaire ne sont pas encore trop informatifs pour apprendre le LDA sur eux et ne sont pas dans la liste des mots vides.  Par conséquent, nous appliquons une autre méthode de filtrage à nos données. </p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>i</mi><mi>d</mi><mi>f</mi><mo stretchy=&quot;false&quot;>(</mo><mi>t</mi><mo>,</mo><mi>D</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>o</mi><mi>g</mi><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mspace linebreak=&quot;newline&quot; /><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>d</mi><mtext>&amp;#xA0;</mtext><mi>e</mi><mi>n</mi><mi>D</mi><mo>:</mo><mi>t</mi><mtext>&amp;#xA0;</mtext><mi>e</mi><mi>n</mi><mi>d</mi><mspace linebreak=&quot;newline&quot; /></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="37.78ex" height="8.202ex" viewBox="0 -832 16266.3 3531.4" role="img" focusable="false" style="vertical-align: -6.27ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-69" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-64" x="345" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-66" x="869" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMAIN-28" x="1419" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-74" x="1809" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMAIN-2C" x="2170" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-44" x="2615" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMAIN-29" x="3444" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMAIN-3D" x="4111" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-6C" x="5417" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-6F" x="5716" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-67" x="6201" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-66" x="6932" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-72" x="7482" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-61" x="7934" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-63" x="8463" y="0"></use><g transform="translate(8897,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMAIN-7C" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-44" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMAIN-7C" x="1107" y="0"></use></g><g transform="translate(10282,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMAIN-7C" x="0" y="0"></use><g transform="translate(0,-1432)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-64" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-65" x="773" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-6E" x="1240" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-44" x="1840" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMAIN-3A" x="2946" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-74" x="3503" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-65" x="4114" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-6E" x="4581" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMATHI-64" x="5181" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/417167/&amp;usg=ALkJrhiPOCRZVy_0MtT-jzkx2wIS3-Vfkw#MJMAIN-7C" x="5705" y="0"></use></g></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>i</mi><mi>d</mi><mi>f</mi><mo stretchy="false">(</mo><mi>t</mi><mo>,</mo><mi>D</mi><mo stretchy="false">)</mo><mo>=</mo><mtext>&nbsp;</mtext><mi>l</mi><mi>o</mi><mi>g</mi><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow></mrow><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mspace linebreak="newline"></mspace><mrow class="MJX-TeXAtom-ORD"><mi>d</mi><mtext>&nbsp;</mtext><mi>e</mi><mi>n</mi><mi>D</mi><mo>:</mo><mi>t</mi><mtext>&nbsp;</mtext><mi>e</mi><mi>n</mi><mi>d</mi><mspace linebreak="newline"></mspace></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow></mrow></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-4"> idf (t, D) = \ log \ frac {| D |} {| \\ {d \ en D: t \ en d \\} |} </script></p><br><p>  où <br>  t est un mot du dictionnaire. <br>  D - cas (nombreux textes) <br>  d est l'un des textes du corps. <br>  Nous calculons l'IDF de tous nos mots et coupons les mots avec le plus grand idf (très rare) et avec le plus petit (mots répandus). </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#'training' (tf-)idf vectorizer. tf_idf = TfidfVectorizer(input='filename', stop_words=stopwords, smooth_idf=False ) tf_idf.fit(train_names) #getting idfs idfs = tf_idf.idf_ #sorting out too rare and too common words lower_thresh = 3. upper_thresh = 6. not_often = idfs &gt; lower_thresh not_rare = idfs &lt; upper_thresh mask = not_often * not_rare good_words = np.array(tf_idf.get_feature_names())[mask] #deleting punctuation as well. cleaned = [] for word in good_words: word = re.sub("^(\d+\w*$|_+)", "", word) if len(word) == 0: continue cleaned.append(word)</span></span></code> </pre> <br><p>  Obtenu après les procédures ci-dessus est déjà tout à fait adapté à la formation LDA, mais nous ferons plus de stemming - les mêmes mots se retrouvent souvent dans notre ensemble de données, mais dans des cas différents.  Pour le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">stemming, pymystem3 a été utilisé</a> . </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#Stemming m = Mystem() stemmed = set() voc_len = len(cleaned) for i in tqdm(range(voc_len)): word = cleaned.pop() stemmed_word = m.lemmatize(word)[0] stemmed.add(stemmed_word) stemmed = list(stemmed) print('After stemming: %d'%(len(stemmed)))</span></span></code> </pre> <br><p>  Après avoir appliqué le filtrage ci-dessus, la taille du dictionnaire est passée de 769801 à <br>  13611 et déjà avec de telles données, vous pouvez obtenir un modèle LDA de qualité acceptable. </p><br><h3 id="testirovanie-primenenie-i-tyuning-lda">  Test, application et optimisation de LDA </h3><br><p>  Maintenant que nous avons l'ensemble de données, le prétraitement et les modèles que nous avons formés sur l'ensemble de données traité, il serait bien de vérifier l'adéquation de nos modèles, ainsi que de créer des applications pour eux. </p><br><p>  En tant qu'application, pour commencer, envisagez la tâche de générer des mots clés pour un texte donné.  Vous pouvez le faire de manière assez simple comme suit: </p><br><ol><li>  Nous obtenons de LDA la distribution des sujets pour ce texte. </li><li>  Choisissez n (par exemple, n = 2) des sujets les plus prononcés. </li><li>  Pour chaque sujet, choisissez m (par exemple m = 3) les mots les plus caractéristiques. </li><li>  Nous avons un ensemble de n * m mots caractérisant un texte donné. </li></ol><br><p>  Nous allons écrire une classe d'interface simple qui implémentera cette méthode de génération de mots clés: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#Let\`s do simple interface class class TopicModeler(object): ''' Inteface object for CountVectorizer + LDA simple usage. ''' def __init__(self, count_vect, lda): ''' Args: count_vect - CountVectorizer object from sklearn. lda - LDA object from sklearn. ''' self.lda = lda self.count_vect = count_vect self.count_vect.input = 'content' def __call__(self, text): ''' Gives topics distribution for a given text Args: text - raw text via python string. returns: numpy array - topics distribution for a given text. ''' vectorized = self.count_vect.transform([text]) lda_topics = self.lda.transform(vectorized) return lda_topics def get_keywords(self, text, n_topics=3, n_keywords=5): ''' For a given text gives n top keywords for each of m top texts topics. Args: text - raw text via python string. n_topics - int how many top topics to use. n_keywords - how many top words of each topic to return. returns: list - of m*n keywords for a given text. ''' lda_topics = self(text) lda_topics = np.squeeze(lda_topics, axis=0) n_topics_indices = lda_topics.argsort()[-n_topics:][::-1] top_topics_words_dists = [] for i in n_topics_indices: top_topics_words_dists.append(self.lda.components_[i]) shape=(n_keywords*n_topics, self.lda.components_.shape[1]) keywords = np.zeros(shape=shape) for i,topic in enumerate(top_topics_words_dists): n_keywords_indices = topic.argsort()[-n_keywords:][::-1] for k,j in enumerate(n_keywords_indices): keywords[i * n_keywords + k, j] = 1 keywords = self.count_vect.inverse_transform(keywords) keywords = [keyword[0] for keyword in keywords] return keywords</span></span></code> </pre> <br><p>  Nous appliquons notre méthode à plusieurs textes et voyons ce qui se passe: <br>  Communauté <strong>:</strong> Agence de voyage "Couleurs du monde" <br>  <strong>Mots-clés:</strong> ['photo', 'social', 'voyage', 'communauté', 'voyage', 'euro', 'logement', 'prix', 'Pologne', 'départ'] <br>  <strong>Communauté:</strong> Gifs alimentaires <br>  <strong>Mots-clés:</strong> ['beurre', 'st', 'sel', 'pc', 'pâte', 'cuisine', 'oignon', 'poivre', 'sucre', 'gr'] </p><br><p>  Les résultats ci-dessus ne sont pas des «choix de cerise» et semblent assez adéquats.  En fait, ce sont les résultats d'un modèle déjà configuré.  Les premiers LDA qui ont été formés dans le cadre de cet article ont produit des résultats nettement moins bons, parmi les mots clés que vous pouviez souvent voir, par exemple: </p><br><ol><li>  Composants composites d'adresses Web: www, http, ru, com ... </li><li>  Mots communs. </li><li>  unités: cm, mètre, km ... </li></ol><br><p>  Le réglage (réglage) du modèle a été effectué comme suit: </p><br><ol><li>  Pour chaque sujet, sélectionnez n (n = 5) mots les plus caractéristiques. </li><li>  Nous les considérons idf, selon le cas de formation. </li><li>  Nous apportons 5 à 10% des mots clés les plus répandus. </li></ol><br><p>  Un tel «nettoyage» doit être effectué avec soin, en prévoyant ces 10% des mots.  Les candidats à la suppression doivent plutôt être choisis de cette manière, puis les mots qui doivent être supprimés doivent être sélectionnés manuellement parmi eux. </p><br><p>  Quelque part dans la génération 2-3 des modèles, avec une manière similaire de sélectionner les mots vides, pour les 5% supérieurs des distributions de mots les plus répandues, nous obtenons: <br>  ['tout', 'complètement', 'droit', 'facile', 'suivant', 'internet', 'petit', 'moyen', 'difficile', 'humeur', 'tellement', 'set', ' option ',' nom ',' discours ',' programme ',' compétition ',' musique ',' cible ',' film ',' prix ',' jeu ',' système ',' jouer ',' entreprise ' , 'sympa'] </p><br><h3 id="esche-prilozheniya">  Plus d'applications </h3><br><p>  La première chose qui me vient à l'esprit spécifiquement est d'utiliser la distribution des sujets dans le texte comme des `` incorporations '' de textes, dans cette interprétation, vous pouvez leur appliquer des algorithmes de visualisation ou de clustering, et rechercher les clusters thématiques finaux `` efficaces '' de cette manière. </p><br><p>  Faisons ça: </p><br><pre> <code class="python hljs">term_doc_matrix = count_vect.transform(names) embeddings = lda.transform(term_doc_matrix) kmeans = KMeans(n_clusters=<span class="hljs-number"><span class="hljs-number">30</span></span>) clust_labels = kmeans.fit_predict(embeddings) clust_centers = kmeans.cluster_centers_ embeddings_to_tsne = np.concatenate((embeddings,clust_centers), axis=<span class="hljs-number"><span class="hljs-number">0</span></span>) tSNE = TSNE(n_components=<span class="hljs-number"><span class="hljs-number">2</span></span>, perplexity=<span class="hljs-number"><span class="hljs-number">15</span></span>) tsne_embeddings = tSNE.fit_transform(embeddings_to_tsne) tsne_embeddings, centroids_embeddings = np.split(tsne_embeddings, [len(clust_labels)], axis=<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br><p>  En sortie, nous obtenons l'image suivante: <br><img src="https://habrastorage.org/webt/7j/2r/qv/7j2rqvpp2-blr9vfq44qjs75upc.png" alt="image"></p><br><p>  Les croix sont les centres de gravité (cénroïdes) des grappes. </p><br><p>  Dans l'image tSNE des plongements, on peut voir que les clusters sélectionnés à l'aide de KMeans forment des ensembles assez connectés et le plus souvent spatialement séparables. </p><br><p>  Tout le reste, à vous de voir. </p><br><p>  Lien vers tout le code: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://gitlab.com/Mozes/VK_LDA</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr417167/">https://habr.com/ru/post/fr417167/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr417155/index.html">Noyau Linux 4.18: ce qui se prépare pour la prochaine version</a></li>
<li><a href="../fr417157/index.html">La singularité approche: l'IA commence à contrôler les robots</a></li>
<li><a href="../fr417161/index.html">Burger King: surveillance secrète, mensonges, vol de cartes bancaires. Continuation</a></li>
<li><a href="../fr417163/index.html">Fine commits</a></li>
<li><a href="../fr417165/index.html">Ce qui menace Burger King</a></li>
<li><a href="../fr417171/index.html">Étude: les fonds spéculatifs gérés par des femmes affichent de meilleurs résultats</a></li>
<li><a href="../fr417173/index.html">«Old New Vinyl»: 20 documents sur l'histoire et la production de platines vinyles et de disques</a></li>
<li><a href="../fr417175/index.html">Restauration du sémaphore de la route d'Acme de la première moitié du XXe siècle</a></li>
<li><a href="../fr417177/index.html">Serveur Web local sous Linux, avec élévation d'hôte automatique et changement de version PHP</a></li>
<li><a href="../fr417179/index.html">Mise en place d'un environnement de développement domestique (docker + gitlab + DNS)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>