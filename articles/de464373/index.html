<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîÖ üßôüèª üßïüèø Edge-to-Edge unter Android: Richtig machen üßúüèæ ü•â üçæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Das vergangene Google I / O 2019 brachte viele sensationelle Innovationen mit sich, von denen viele in den kommenden Jahren Auswirkungen auf die mobil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Edge-to-Edge unter Android: Richtig machen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/surfstudio/blog/464373/">  Das vergangene Google I / O 2019 brachte viele sensationelle Innovationen mit sich, von denen viele in den kommenden Jahren Auswirkungen auf die mobile Entwicklungsbranche haben werden.  Es war nicht weniger interessant, den aufkommenden Trends zu folgen.  Erstens gingen mechanische Steuertasten in die Geschichte ein, Smartphone-Bildschirme wurden gr√∂√üer und die Seitenrahmen wurden unauff√§lliger.  Gesten ersetzten die Systemschaltfl√§chen auf dem Bildschirm und lie√üen immer mehr Platz f√ºr den Konsum von Inhalten.  Anwendungen werden auf der gesamten sichtbaren Oberfl√§che des Displays vom unteren bis zum oberen Rahmen angezeigt, ohne sich auf die bedingten Grenzen der Statusleiste und des Navigationsbereichs zu beschr√§nken.  Wir stehen kurz vor einer Edge-to-Edge-√Ñra. <br><br><img src="https://habrastorage.org/webt/xu/3i/ny/xu3inyrvy6ruyd_uj5j5l97pnf0.png"><br><a name="habracut"></a><br>  Was ist Edge-to-Edge?  W√∂rtlich verstanden bedeutet dies, dass Ihre Anwendung auf der gesamten sichtbaren Oberfl√§che des Displays vom unteren bis zum oberen Rahmen angezeigt werden sollte, ohne sich auf die Statusleiste und die unteren Navigationsschaltfl√§chen zu beschr√§nken. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/119/459/053/11945905307bf673c909e4a75a270ba0.jpg"></div><br>  <i>Edge-to-Edge am Beispiel der Android-System-Shell.</i> <br><br>  Wenn es um Android geht, ist eine einfache Idee bei weitem nicht immer einfach umzusetzen.  In diesem Artikel werden wir dar√ºber sprechen, wie Sie die Nutzung des gesamten verf√ºgbaren Speicherplatzes auf einem beliebigen Ger√§t maximieren k√∂nnen, unabh√§ngig von Hersteller, Version des Systems und den verschiedenen Einstellungen, die Hersteller von Ger√§ten aus dem Reich der Mitte (und nicht nur) gerne den Benutzern gefallen.  Der im Artikel vorgestellte Code wurde von uns pers√∂nlich auf mehr als 30 Ger√§ten und von 100.000 Benutzern unserer Anwendungen auf 231 verschiedenen Ger√§ten getestet. <br><br>  Das Problem der Erstellung einer Edge-to-Edge-Schnittstelle ist an sich nicht neu und war lange vor der E / A 2019 relevant. Sicherlich wird sich jeder von Ihnen daran erinnern, wie Sie zuerst etwas aus der Kategorie <i>"Androide transparente Statusleiste"</i> oder <i>"Android-Statusleistenverlauf"</i> googeln. <i>"</i> . <br><br>  Die Hauptkriterien f√ºr die Anwendung, um dem Titel von Kante zu Kante zu entsprechen, sind: <br><br><ul><li>  transparente Statusleiste; </li><li>  transparente Navigationsleiste. </li></ul><br>  Lesen Sie mehr dar√ºber auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">material.io</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a20/18b/3a3/a2018b3a34a0d61b30d940f2c50c44fe.png"></div><br>  <i>Die Deezer App macht sich keine Sorgen um die Edge-to-Edge-Konformit√§t</i> <i><br></i> <br>  Es ist wichtig zu beachten, dass wir nicht davon sprechen, sie vollst√§ndig zu entfernen, wie im " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vollbildmodus</a> ".  Wir √ºberlassen dem Benutzer die M√∂glichkeit, wichtige Systeminformationen anzuzeigen und die vertraute Navigation zu verwenden. <br><br>  Eine ebenso wichtige Voraussetzung f√ºr eine L√∂sung ist die Skalierbarkeit und Erweiterbarkeit.  Es gibt eine Reihe anderer: <br><br><ul><li>  Verschieben Sie den Bildschirm korrekt √ºber die Tastatur, ohne die Unterst√ºtzung f√ºr die adjustResize-Flags der Aktivit√§t zu unterbrechen. </li><li>  Vermeiden Sie es, die Statusleiste und die Navigationsleiste auf den UI-Elementen der Anwendung zu √ºberlagern, w√§hrend Sie den entsprechenden Hintergrund darunter anzeigen. </li><li>  Arbeiten Sie auf allen Ger√§ten mit aktuellen Android-Versionen und sehen Sie identisch aus. </li></ul><br><h1>  Ein bisschen Theorie </h1><br>  Es kann unerwartet viel Zeit in Anspruch nehmen, eine L√∂sung f√ºr eine scheinbar einfache Aufgabe zu finden, die f√ºr den Projektmanager nicht leicht zu erkl√§ren ist.  Und wenn die Qualit√§tssicherung immer noch das ungl√ºckliche Smartphone findet, auf dem Ihr Bildschirm nicht ‚Äûnach den Kanonen‚Äú aussieht ... <br>  In unserem Projekt haben wir uns mehrmals geirrt.  Nur einen Monat sp√§ter, nach einer langen Reihe von Versuchen und Irrt√ºmern, haben wir das Problem ein f√ºr alle Mal gel√∂st. <br><br>  Zun√§chst m√ºssen Sie verstehen, wie Android Systempanels zeichnet.  Ab Android 5.0 wurde eine praktische API zum Arbeiten mit Systemeinz√ºgen entlang der horizontalen R√§nder des Bildschirms bereitgestellt.  Sie hei√üen WindowInsets und sind im Bild unten rot gef√§rbt: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bd4/f76/d86/bd4f76d86dd3508a88edf9618eab7a1b.png"></div><br>  Au√üerdem haben Entwickler aus dem Android-Team Listener hinzugef√ºgt, mit denen Sie √Ñnderungen an diesen Einz√ºgen abonnieren k√∂nnen, z. B. wenn die Tastatur angezeigt wird.  Genau genommen sind WindowInsets die R√§nder Ihrer Layoutdatei von den R√§ndern des Bildschirms.  Wenn Sie die Gr√∂√üe Ihrer Aktivit√§t √§ndern (Split-Screen-Modus, Tastaturaussehen), √§ndert sich auch das Einschub.  Um Edge-to-Edge zu unterst√ºtzen, m√ºssen wir daher sicherstellen, dass diese Einr√ºckungen nicht vorhanden sind.  Ein Bildschirm mit null WindowInsets sieht folgenderma√üen aus: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/197/cca/01d/197cca01df6de4ab8707131a70f8c993.png"></div><br><h1>  Implementierung </h1><br>  In unserer Implementierung werden wir aktiv an Window und seinen Flags arbeiten. <br>  Alle Beispiele werden in Kotlin geschrieben, aber Sie k√∂nnen sie problemlos in Java implementieren, indem Sie Dienstprogramme anstelle von Erweiterungsfunktionen verwenden. <br><br>  Das erste, was Sie mit dem Root-Layout-Element tun m√ºssen, ist, das Flag explizit zu setzen: <br><br><pre><code class="kotlin hljs">android:fitsSystemWindows=<span class="hljs-string"><span class="hljs-string">"true"</span></span></code> </pre> <br>  Dies ist erforderlich, um sicherzustellen, dass die Stammansicht unter den Systemelementen gezeichnet wird, sowie um die korrekten Messungen von Inset zu erhalten, wenn Sie deren √Ñnderung abonnieren. <br>  Nun wenden wir uns dem Wichtigsten zu - wir entfernen die R√§nder des Bildschirms!  Dies muss jedoch sehr sorgf√§ltig erfolgen.  Und hier ist warum: <br><br><ol><li>  Wenn Sie den unteren Einschub auf Null setzen, besteht die Gefahr, dass die Reaktion des Fensters auf das Erscheinungsbild der Tastatur verloren geht: Es gibt Dutzende von Tipps zu StackOverflow zum Zur√ºcksetzen des oberen Einschubs, aber die unteren sind zart leise.  Aus diesem Grund ist die Navigationsleiste nicht vollst√§ndig transparent.  Beim Zur√ºcksetzen des unteren Einschubs funktioniert das Flag "adjustResize" nicht mehr. <br><br>  <b>L√∂sung:</b> Stellen Sie bei jedem √Ñndern des Einschubs fest, ob die untere H√∂he der Tastatur darin enthalten ist, und setzen Sie sie nur anderweitig zur√ºck. </li><li>  Wenn Sie Inset zur√ºcksetzen, werden die sichtbaren Teile der Ansicht unter der Statusleiste und der Navigationsleiste angezeigt.  Nach dem Konzept des Materialdesigns (und des gesunden Menschenverstandes) sollten sich keine aktiven Elemente in Systembereichen befinden.  Das hei√üt, in diesem Bereich sollten keine Schaltfl√§chen, Felder zur Texteingabe, Kontrollk√§stchen usw. vorhanden sein. <br><br>  <b>L√∂sung:</b> Wir f√ºgen dem Listener einen Listener hinzu, sodass beim √Ñndern von WindowInsets die Systemeinz√ºge in die Aktivit√§t √ºbersetzt und intern darauf reagiert werden, indem die richtigen Auff√ºllungen und R√§nder f√ºr die Ansicht festgelegt werden. </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3bd/73e/10e/3bd73e10ee50b6e2ae8a2da1b1bb2808.png"></div><br>  Dieses Verhalten sollte nicht zul√§ssig sein (Symbolleiste wird in der Statusleiste gecrawlt). <br><br>  Die Funktion <i>removeSystemInsets ()</i> sieht folgenderma√üen aus: <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeSystemInsets</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">, listener: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">OnSystemInsetsChangedListener</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { ViewCompat.setOnApplyWindowInsetsListener(view) { _, insets -&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> desiredBottomInset = calculateDesiredBottomInset( view, insets.systemWindowInsetTop, insets.systemWindowInsetBottom, listener ) ViewCompat.onApplyWindowInsets( view, insets.replaceSystemWindowInsets(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, desiredBottomInset) ) } }</code> </pre><br>  Die Funktion <i>berechneDesiredBottomInset () berechnet den</i> unteren Einschub mit oder ohne Tastatur, abh√§ngig von der aktuellen Konfiguration des Ger√§ts. <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateDesiredBottomInset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( view: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">, topInset: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, bottomInset: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, listener: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">OnSystemInsetsChangedListener</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hasKeyboard = isKeyboardAppeared(view, bottomInset) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> desiredBottomInset = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasKeyboard) bottomInset <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> listener(topInset, <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasKeyboard) <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> bottomInset) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> desiredBottomInset }</code> </pre><br>  Verwenden Sie die Methode <i>isKeyboardAppeared ()</i> , um die H√∂he der Tastatur zu √ºberpr√ºfen <i>.</i>  Wir vertrauten der Hypothese, dass die Tastatur nicht weniger als ein Viertel der Bildschirmh√∂he einnehmen darf.  Bei Bedarf k√∂nnen Sie die √úberpr√ºfungslogik nach Ihren W√ºnschen √§ndern. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> View.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isKeyboardAppeared</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bottomInset: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = bottomInset / resourdisplayMetrics.heightPixels.toDouble() &gt; .<span class="hljs-number"><span class="hljs-number">25</span></span></code> </pre> <br>  Die Methode <i>removeSystemInsets ()</i> verwendet einen Listener.  Eigentlich sind dies nur Typealien f√ºr einen Lambda-Ausdruck.  Sein vollst√§ndiger Code: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> OnSystemBarsSizeChangedListener = (statusBarSize: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, navigationBarSize: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span></code> </pre> <br>  Der n√§chste Schritt besteht darin, die Transparenz f√ºr die Systemleisten festzulegen: <br><br><pre> <code class="kotlin hljs">window.statusBarColor = Color.TRANSPARENT window.navigationBarColor = Color.TRANSPARENT</code> </pre> <br>  Nachdem wir alle oben genannten Punkte zusammengestellt haben, erhalten wir die folgende Methode: <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> Activity.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setWindowTransparency</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( listener: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">OnSystemInsetsChangedListener</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = { _, _ -&gt; } )</span></span></span></span> { InsetUtil.removeSystemInsets(window.decorView, listener) window.navigationBarColor = Color.TRANSPARENT window.statusBarColor = Color.TRANSPARENT }</code> </pre> <br>  Um den Edge-to-Edge-Modus der gew√ºnschten Aktivit√§t zu aktivieren, m√ºssen Sie nur die folgende Funktion in der <i>onCreate ()</i> -Methode <i>aufrufen</i> : <br><br><pre> <code class="kotlin hljs">setWindowTransparency { statusBarSize, navigationBarSize -&gt; <span class="hljs-comment"><span class="hljs-comment">//  }</span></span></code> </pre> <br>  So haben wir in weniger als 30 Codezeilen einen ‚ÄûEdge-to-Edge‚Äú -Effekt erzielt, ohne gegen UX-Prinzipien zu versto√üen, ohne dem Benutzer die √ºblichen Systemsteuerungen zu entziehen.  Eine solche Implementierung mag f√ºr jemanden einfach und trivial erscheinen, aber sie gew√§hrleistet den zuverl√§ssigen Betrieb Ihrer Anwendung auf allen Ger√§ten. <br>  Sie k√∂nnen den "Edge-to-Edge" -Effekt auf ungef√§hr hundert verschiedene Arten erzielen (die Anzahl <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">solcher Tipps</a> in StackOverflow ist eine eindeutige Best√§tigung daf√ºr), aber viele von ihnen f√ºhren entweder zu falschem Verhalten bei verschiedenen Android-Versionen oder ber√ºcksichtigen keine Parameter wie die Notwendigkeit einer langen Anzeige Listen oder brechen Sie die Gr√∂√üe des Bildschirms, wenn Sie die Tastatur anzeigen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/955/a21/a0a/955a21a0a5422a4463fa0908c0427990.gif"></div><br><hr><br><h1>  Fliege in die Salbe </h1><br>  Die in diesem Artikel beschriebene L√∂sung ist f√ºr alle aktuellen Ger√§te geeignet.  Tats√§chlich bedeutet Ger√§te auf Android Lollipop (5.0) und h√∂her.  F√ºr sie wird die obige L√∂sung perfekt funktionieren.  F√ºr √§ltere Android-Versionen ben√∂tigen Sie jedoch eine eigene Implementierung, da zu diesem Zeitpunkt noch nichts √ºber WindowInsets bekannt war. <br><br>  Die gute Nachricht ist, dass unter Android KitKat (4.4) die Transparenz von Systempanels weiterhin unterst√ºtzt wird.  Aber √§ltere Versionen unterst√ºtzen solche Sch√∂nheit √ºberhaupt nicht, man kann es nicht einmal versuchen. <br><br>  Konzentrieren wir uns auf die Verschiebung von Insets in Android 4.4.  Dies kann in der Methode <i>fitSystemWindows () erfolgen</i> .  Daher sollte das Hauptelement in Ihrem Layout ein Container mit einer √ºberschriebenen fitSystemWindows-Methode sein, die genau die gleiche Implementierung enth√§lt wie unser Listener im Beispiel f√ºr aktuelle Versionen von Android. <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KitkatTransparentSystemBarsFrame</span></span></span><span class="hljs-class"> </span><span class="hljs-meta"><span class="hljs-class"><span class="hljs-meta">@JvmOverloads</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">constructor</span></span></span></span>( context: Context, attrs: AttributeSet? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, defStyleAttr: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> = -<span class="hljs-number"><span class="hljs-number">1</span></span> ) : FrameLayout(context, attrs, defStyleAttr), KitkatTransparentSystemBarsContainer { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> onSystemInsetsChangedListener: OnSystemInsetsChangedListener = { _, _ -&gt; } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fitSystemWindows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(insets: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Rect</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { insets ?: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> desiredBottomInset = InsetUtil.calculateDesiredBottomInset( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, insets.top, insets.bottom, onSystemInsetsChangedListener ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.fitSystemWindows(Rect(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, desiredBottomInset)) }</code> </pre><br>  Auf Ger√§ten mit Android 4.4 funktioniert nur teilweise Transparenz durch Setzen von durchscheinenden Flags: <br><br><pre> <code class="kotlin hljs">window.addFlags( WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS or WindowManager.LayoutParams.FLAG_TRANSLUCENT_NAVIGATION )</code> </pre> <br>  Diese Flags machen die Systemleisten durchscheinend und f√ºgen ihnen einen leichten Farbverlauf hinzu, der leider nicht entfernt werden kann.  Mit dieser Bibliothek kann der Farbverlauf jedoch in eine durchscheinende Farbleiste umgewandelt werden: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/jgilfelt/SystemBarTint</a> .  Sie hat uns in der Vergangenheit mehr als einmal gerettet.  Die letzten √Ñnderungen wurden vor 5 Jahren an der Bibliothek vorgenommen, sodass sie ihren Charme nur echten r√ºckl√§ufigen St√§dten offenbaren wird. <br><br>  Der gesamte Markierungsprozess f√ºr Kitkat sieht folgenderma√üen aus: <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> Activity.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setWindowTransparencyKitkat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( rootView: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">KitkatTransparentSystemBarsContainer</span></span></span></span><span class="hljs-function"><span class="hljs-params">, listener: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">OnSystemBarsSizeChangedListener</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = { _, _ -&gt; } )</span></span></span></span> { rootView.onSystemBarsSizeChangedListener = listener window.addFlags( WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS or WindowManager.LayoutParams.FLAG_TRANSLUCENT_NAVIGATION ) }</code> </pre> <br>  Vor diesem Hintergrund schreiben wir eine universelle Methode, mit der Systemleisten transparent (oder zumindest durchscheinend) gemacht werden k√∂nnen, unabh√§ngig davon, welche Anwendung auf einem Ger√§t mit welcher Android-Version ausgef√ºhrt wird: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP -&gt; setWindowTransparency(::updateMargins) Build.VERSION.SDK_INT == Build.VERSION_CODES.KITKAT -&gt; setWindowTransparencyKitkat(root_container, ::updateMargins) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; { <span class="hljs-comment"><span class="hljs-comment">/*do nothing*/</span></span> } }</code> </pre><br>  Unter dem Spoiler unten k√∂nnen Sie sehen, wie das im Artikel vorgestellte Beispiel auf einigen der problematischen Ger√§te aussieht: <br><br><div class="spoiler">  <b class="spoiler_title">Screenshots</b> <div class="spoiler_text">  Huawei Honor 8, Android 7.0 <br><br><img src="https://habrastorage.org/webt/vb/iq/vb/vbiqvbaw6ncicr9zaramjgp7rw4.png"><br><br>  Xiaomi Redmi Note 4, Android 6.1 <br><br><img src="https://habrastorage.org/webt/oa/qz/09/oaqz09dbvoqd9lvdrqmvd_db2lq.png"><br><br>  HTC Desire Dual Sim, Android 4.4.2 <br><br><img src="https://habrastorage.org/webt/qa/tj/og/qatjogphzqsrtj59iep-bnnqdyw.png"><br><br>  Samsung J3, Android 7.0 <br><br><img src="https://habrastorage.org/webt/_u/tm/gj/_utmgjk86esswybhkri_ropcghw.jpeg"><br><br>  Meizu M3s, Android 5.1 <br><br><img src="https://habrastorage.org/webt/5m/9b/7f/5m9b7f0wc6g3vodq2jimsaqichm.jpeg"><br><br>  Asus Zenfone 3 Max, Android 6.0 <br><br><img src="https://habrastorage.org/webt/ye/t5/9l/yet59l_2qgcqsdbnps2jgwgvx3g.jpeg"><br><br>  Umi Rom, Android 5.0 <br><br><img src="https://habrastorage.org/webt/qn/th/zp/qnthzp8jdtsobkl2t5c_et3iada.png"><br><br>  Nexus 5X, Android 8.0 <br><br><img src="https://habrastorage.org/webt/t7/9j/mo/t79jmolqrgeimm_0ylppf3nwwrk.png"><br><br>  Samsung Galaxy S8, Android 9.0 <br><br><img src="https://habrastorage.org/webt/to/cg/ab/tocgabznqxu36_wp1-d9aou0hbe.jpeg"><br></div></div><br><hr><br>  Abschlie√üend m√∂chte ich sagen, dass die L√∂sung selbst einer scheinbar einfachen Aufgabe wie dem Festlegen von Transparenz f√ºr Elemente der Systembenutzeroberfl√§che Sie durch die Vielzahl von Fallstricken ziehen und letztendlich nicht zum gew√ºnschten Ergebnis f√ºhren kann, sondern unangenehme Fehler verursacht.  Gut, dass Sie diesen Artikel jetzt haben. <br><br>  Eine vollst√§ndige Liste des Programms und ein Beispiel f√ºr die Arbeit finden Sie in unserem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Git-Repository</a> . <br><br>  Das Material ist inspiriert von dem Chris Banes-Bericht ‚ÄûBecoming a Master Window Fitter‚Äú. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/_mGDMVRO3iE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Ich danke Surf Studio und Evgeny Saturov f√ºr die Hilfe bei der Vorbereitung des Materials. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de464373/">https://habr.com/ru/post/de464373/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de464361/index.html">Intel Quartz Canyon - NUC f√ºr Profis</a></li>
<li><a href="../de464365/index.html">Sicherheitswoche 34: Au√üergew√∂hnliche Sicherheitsl√ºcken in Windows</a></li>
<li><a href="../de464367/index.html">Und ein weiterer Steam Windows Client Local Privilege Escalation 0day</a></li>
<li><a href="../de464369/index.html">Welchen Blocker benutzt du? Ergebnisse</a></li>
<li><a href="../de464371/index.html">/etc/resolv.conf f√ºr Kubernetes-Pods, Option ndots: 5, da dies die Anwendungsleistung beeintr√§chtigen kann</a></li>
<li><a href="../de464375/index.html">Wie Suchmaschinen funktionieren</a></li>
<li><a href="../de464377/index.html">Schmutzige Assembler-Hacks 6502</a></li>
<li><a href="../de464381/index.html">Reise nach Alaska oder KDD'19 mit den Augen eines Augenzeugen</a></li>
<li><a href="../de464383/index.html">Wie ich die Dinge in einem Projekt in Ordnung bringe, in dem es einen Wald direkter H√§nde gibt (tslint, h√ºbscher usw. Einstellungen)</a></li>
<li><a href="../de464385/index.html">Python als ultimativer Fall von C ++. Teil 1/2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>