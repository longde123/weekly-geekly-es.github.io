<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСйтАНЁЯОУ ЁЯд╖ЁЯП╗ ЁЯЦЦЁЯП╗ 12.3 рдорд┐рд▓рд┐рдпрди рд╕рдорд╡рд░реНрддреА рд╡реЗрдм рдкреЙрдХреЗрдЯреНрд╕ ЁЯМТ ЁЯСйЁЯП╜тАНтЬИя╕П ЁЯСО</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="WebSockets рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╕рднреА CPU рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдЪреНрдЪ рдкрд░реНрдпрд╛рдкреНрдд рд▓реЛрдб рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреА рдд...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>12.3 рдорд┐рд▓рд┐рдпрди рд╕рдорд╡рд░реНрддреА рд╡реЗрдм рдкреЙрдХреЗрдЯреНрд╕</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460847/"><p>  WebSockets рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╕рднреА CPU рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдЪреНрдЪ рдкрд░реНрдпрд╛рдкреНрдд рд▓реЛрдб рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреА рддрд░рдл рдмрд╣реБрдд рд╕рд╛рд░реЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </p><br><p>  рдРрд╕реА рдХрдИ рдЪреБрдиреМрддрд┐рдпрд╛рдВ рд╣реИрдВ рдЬрд┐рдирд╕реЗ рдЖрдкрдХреЛ рдкрд╛рд░ рдкрд╛рдирд╛ рд╣реЛрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рд╡реЗрдмрд╕реЙрдлрд╝реНрдЯ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╕рд░реНрд╡рд░ рдХреА рддрд░рдл рд╕реЗ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреА рдорд╛рдВрдЧ рдкрд░ рдЕрдзрд┐рдХ рд╕реАрдкреАрдпреВ рд╣реИред  рдЙрд╕реА рд╕рдордп рдЖрдкрдХреЛ рд▓рд╛рдЦреЛрдВ рдХрдиреЗрдХреНрд╢рди рд╣реЛрдиреЗ рдкрд░ рдЦреБрд▓реЗ рдХрдиреЗрдХреНрд╢рди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдЕрдзрд┐рдХ рд░реИрдо рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </p><br><p>  рдореИрдВ рдмрд╣реБрдд рднрд╛рдЧреНрдпрд╢рд╛рд▓реА рд░рд╣рд╛ рд╣реВрдВ рдХрд┐ рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ "рдмрд░реНрдирдЖрдЙрдЯ" рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдореЗрд░реЗ рдирд┐рдкрдЯрд╛рди рдореЗрдВ рд╕реАрдорд┐рдд рд╕рдордп рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдирдП рд╕рд░реНрд╡рд░ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдПред  рдЗрд╕рд▓рд┐рдП рдореИрдВрдиреЗ рджреЛрдиреЛрдВ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ Lua Application Server - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">LAppS</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓рд┐рдпрд╛: рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░реЗрдВ рдФрд░ LAppS рдЙрдЪреНрдЪ рд▓реЛрдб рдкрд░реАрдХреНрд╖рдг рдХрд░реЗрдВред </p><br><p><a name="habracut"></a>  рдЖрдЗрдП рджреЗрдЦрддреЗ рд╣реИрдВ рдбрд┐рдЯреЗрд▓реНрд╕ </p><br><h1 id="challenges">  рдЪреБрдиреМрддрд┐рдпрд╛рдВ </h1><br><p>  рдЬрдм рддрдХ рдЖрдк рдЗрд╕реЗ рдирдХрд▓реА рдирд╣реАрдВ рдмрдирд╛рдирд╛ рдЪрд╛рд╣рддреЗ, рддрдм рддрдХ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреА рддрд░рдл рд╕реЗ рд╕рднреА WebSockets рдХреЛ рдЯреНрд░реИрдлрд╝рд┐рдХ рдорд╛рд╕реНрдХрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рддреЗрдЬрд╝ RNG рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдореИрдВ рдЪрд╛рд╣рддрд╛ рдерд╛ рдХрд┐ рдкрд░реАрдХреНрд╖рдг рдпрдерд╛рд░реНрдерд╡рд╛рджреА рд╣реЛрдВ, рдЗрд╕рд▓рд┐рдП рдореИрдВрдиреЗ рдЖрд░рдЬреАрдЬреА рдХреЛ рдПрдХ рдирд┐рд░рдВрддрд░рддрд╛ рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд╡рд┐рдЪрд╛рд░ рдХреЛ рдЦрд╛рд░рд┐рдЬ рдХрд░ рджрд┐рдпрд╛ред  рдпрд╣ рдПрдХрдорд╛рддреНрд░ рд╡рд┐рдХрд▓реНрдк рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реИ - рдмрд╣реБрдд рд╕реА рд╕реАрдкреАрдпреВ рд╢рдХреНрддрд┐ред  рдЬреИрд╕рд╛ рдХрд┐ рдореИрдВрдиреЗ рдХрд╣рд╛, рдореЗрд░реЗ рдкрд╛рд╕ рджреЛ рд╕рд░реНрд╡рд░ рд╣реИрдВ: рдПрдХ рджреЛрд╣рд░реА рдЗрдВрдЯреЗрд▓ рдЧреЛрд▓реНрдб 6148 рд╕реАрдкреАрдпреВ (рдХреБрд▓ рдорд┐рд▓рд╛рдХрд░ 40 рдХреЛрд░) 256 рдЬреАрдмреА рд░реИрдо (рдбреАрдбреАрдЖрд░ 4-2666) рдФрд░ рдПрдХ рдХреНрд╡рд╛рдб рдЗрдВрдЯреЗрд▓ рдкреНрд▓реЗрдЯрд┐рдирдо 8180 рд╕реАрдкреАрдпреВ (рдХреБрд▓ 112 рдХреЛрд░) 384 рдЬреАрдмреА рд░реИрдо (рдбреАрдбреАрдЖрд░ 4-2666) ред  рдореИрдВ рдЙрдирдХреЗ рдмрд╛рдж рд╕рд░реНрд╡рд░ рдП рдФрд░ рд╕рд░реНрд╡рд░ рдмреА рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░реВрдВрдЧрд╛ред </p><br><p>  рджреВрд╕рд░реА рдЪреБрдиреМрддреА - рд╡реЗрдмрд╕реНрдХреЗрдЯреНрд╕ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдпрд╛ рдЯреЗрд╕реНрдЯ рд╕реВрдЯ рдирд╣реАрдВ рд╣реИрдВ рдЬреЛ рдХрд╛рдлреА рддреЗрдЬрд╝ рд╣реИрдВред  рдпрд╣реА рдХрд╛рд░рдг рд╣реИ рдХрд┐ рдореБрдЭреЗ LAppS ( <strong>cws</strong> ) рдХреЗ рд▓рд┐рдП рдПрдХ WebSockets рдХреНрд▓рд╛рдЗрдВрдЯ рдореЙрдбреНрдпреВрд▓ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ред </p><br><h1 id="the-tests-setup">  рдкрд░реАрдХреНрд╖рдг рд╕реЗрдЯрдЕрдк </h1><br><p>  рджреЛрдиреЛрдВ рд╕рд░реНрд╡рд░реЛрдВ рдореЗрдВ рджреЛрд╣рд░реА рдкреЛрд░реНрдЯ 10GbE рдХрд╛рд░реНрдб рд╣реИрдВред  рдкреНрд░рддреНрдпреЗрдХ рдХрд╛рд░реНрдб рдХреЗ рдкреЛрд░реНрдЯ 1 рдХреЛ рдПрдХ рдмреЙрдиреНрдбрд┐рдВрдЧ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЗ рд▓рд┐рдП рдПрдХрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдпреЗ рдХрд╛рд░реНрдб рдпрд╛ рддреЛ рдкреЛрд░реНрдЯреНрд╕ рдЖрд░рдЖрд░ рдореЛрдб рдореЗрдВ рдПрдХ рджреВрд╕рд░реЗ рд╕реЗ рдЬреБрдбрд╝реЗ рд╣реЛрддреЗ рд╣реИрдВред  рдкреНрд░рддреНрдпреЗрдХ рдХрд╛рд░реНрдб рдХреЗ рдкреЛрд░реНрдЯ 2 рдХреЛ рдПрдХ рдИрдерд░рдиреЗрдЯ рдмреИрдХрдЕрдк рдкрд░ рдХрдиреЗрдХреНрдЯреЗрдб, рдПрдХреНрдЯрд┐рд╡-рдмреИрдХрдЕрдк рдореЛрдб рдореЗрдВ рдПрдХ рдмреЙрдиреНрдбрд┐рдВрдЧ рдЗрдВрдЯрд░рдлреЗрд╕ рдореЗрдВ рдПрдХрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдкреНрд░рддреНрдпреЗрдХ рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рд╕рд░реНрд╡рд░ RHEL 7.6 рдЪрд▓рд╛ рд░рд╣рд╛ рдерд╛ред  рдореБрдЭреЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ gcc-4.8.5 рдХреЗ рдмрдЬрд╛рдп рдЖрдзреБрдирд┐рдХ рд╕рдВрдХрд▓рдХ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрд░реЛрддреЛрдВ рд╕реЗ gcc-8.3 рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рдкрдбрд╝рд╛ред  рдкреНрд░рджрд░реНрд╢рди рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рд╕реЗрдЯрдЕрдк рдирд╣реАрдВ, рдлрд┐рд░ рднреА рднрд┐рдЦрд╛рд░реА рдЪрдпрдирдХрд░реНрддрд╛ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреЗред </p><br><p>  рд╕рд░реНрд╡рд░ рдП (2xGold 6148) рдкрд░ рд╕реАрдкреАрдпреВ рдореЗрдВ рд╕рд░реНрд╡рд░ рдмреА (4xPl Platinum 8180) рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЙрдЪреНрдЪ рдЖрд╡реГрддреНрддрд┐ рд╣реЛрддреА рд╣реИред  рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рд╕рд░реНрд╡рд░ рдмреА рдореЗрдВ рдЕрдзрд┐рдХ рдХреЛрд░ рд╣реЛрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдореИрдВрдиреЗ рд╕рд░реНрд╡рд░ рдП рдкрд░ рдПрдХ рдЗрдХреЛ рд╕рд░реНрд╡рд░ рдФрд░ рд╕рд░реНрд╡рд░ рдмреА рдкрд░ рдЗрдХреЛ рдХреНрд▓рд╛рдЗрдВрдЯ рдЪрд▓рд╛рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓рд┐рдпрд╛ред </p><br><p>  рдореИрдВ рдпрд╣ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛ рдХрд┐ рд▓рд╛рдЦреЛрдВ рдХрдиреЗрдХреНрд╢рдиреЛрдВ рдХреЗ рд╕рд╛рде LAppS рдХрд┐рд╕ рддрд░рд╣ рд╕реЗ рдЙрдЪреНрдЪ рднрд╛рд░ рдХрд╛ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдкреНрд░рддрд┐ рд╕реЗрдХреЗрдВрдб рдЕрдзрд┐рдХрддрдо рдкреНрд░рддрд┐рдзреНрд╡рдирд┐ рдХреНрдпрд╛ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддрд╛ рд╣реИред  рдпреЗ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рджреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╕реЗрдЯ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдХрдиреЗрдХреНрд╢рди рд░рд╛рд╢рд┐ рд╡реГрджреНрдзрд┐ рдХреЗ рд╕рд╛рде рд╕рд░реНрд╡рд░ рдФрд░ рдХреНрд▓рд╛рдЗрдВрдЯ рддреЗрдЬреА рд╕реЗ рдЬрдЯрд┐рд▓ рдХрд╛рдо рдХрд░ рд░рд╣реЗ рд╣реИрдВред </p><br><p>  рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдореИрдВрдиреЗ рдЕрдкрдиреЗ рдШрд░ рдкреАрд╕реА рдкрд░ рд╕рднреА рдкрд░реАрдХреНрд╖рдг рдХрд┐рдП рд╣реИрдВ рдЬреЛ рдореИрдВ рд╡рд┐рдХрд╛рд╕ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВред  рдЗрди рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдореЗрд░реЗ рд╣реЛрдо рдкреАрд╕реА рдореЗрдВ рдПрдХ рдЗрдВрдЯреЗрд▓ рдХреЛрд░ i7-7700 рд╕реАрдкреАрдпреВ 3.6GHz (4.0GHz рдЯрд░реНрдмреЛ) рд╣реИ рдЬрд┐рд╕рдореЗрдВ 4 рдХреЛрд░ рдФрд░ 32GB DDR4-2400 рд░реИрдо рд╣реИред  рдпрд╣ рдкреАрд╕реА Gentoo рдХреЛ 4.14.72 рдХрд░реНрдиреЗрд▓ рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рддрд╛ рд╣реИред </p><br><div class="spoiler">  <b class="spoiler_title">рд╕реНрдкреЗрдХреНрдЯрд░ рдФрд░ рдореЗрд▓реНрдЯрдбрд╛рдЙрди рдкреИрдЪ рд╕реНрддрд░</b> <div class="spoiler_text"><ul><li>  рд╣реЛрдо рдкреАрд╕реА <br><pre><code class="plaintext hljs">/sys/devices/system/cpu/vulnerabilities/l1tf:Mitigation: PTE Inversion; VMX: conditional cache flushes, SMT vulnerable /sys/devices/system/cpu/vulnerabilities/meltdown:Mitigation: PTI /sys/devices/system/cpu/vulnerabilities/spec_store_bypass:Mitigation: Speculative Store Bypass disabled via prctl and seccomp /sys/devices/system/cpu/vulnerabilities/spectre_v1:Mitigation: __user pointer sanitization /sys/devices/system/cpu/vulnerabilities/spectre_v2:Vulnerable: Minimal generic ASM retpoline, IBPB, IBRS_FW</code> </pre> </li><li>  рд╕рд░реНрд╡рд░ рдП рдФрд░ рдмреА <br><pre> <code class="plaintext hljs">/sys/kernel/debug/x86/ibpb_enabled : 1 /sys/kernel/debug/x86/pti_enabled : 1 /sys/kernel/debug/x86/ssbd_enabled : 1 /sys/kernel/debug/x86/ibrs_enabled : 1 /sys/kernel/debug/x86/retp_enabled : 3</code> </pre> </li></ul><br><p>  рдореИрдВ рд╕рд░реНрд╡рд░ рдП рдФрд░ рдмреА рдХреЗ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдиреЛрдЯ рдХрд░реВрдБрдЧрд╛ рдХрд┐ рдпреЗ рдкреИрдЪ рд╕рдХреНрд╖рдо рд╣реИрдВ рдпрд╛ рдирд╣реАрдВред </p><br><p>  рдореЗрд░реЗ рд╣реЛрдо рдкреАрд╕реА рдкрд░ рдкреИрдЪ рдХрд╛ рд╕реНрддрд░ рдХрднреА рдирд╣реАрдВ рдмрджрд▓рд╛ рдЬрд╛рддрд╛ рд╣реИред </p></div></div><br><h2 id="installing-lapps-081">  LAppS рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ 0.8.1 </h2><br><div class="spoiler">  <b class="spoiler_title">рдкреВрд░реНрд╡рд╛рдкреЗрдХреНрд╖рд╛рдПрдБ рдФрд░ рдирд┐рдпрдо рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛</b> <div class="spoiler_text"><p>  LAppS luajit-2.0.5 рдпрд╛ рдЙрдЪреНрдЪрддрд░, libcrypto ++ 8.2 рдФрд░ wolfSSL-3.15.7 рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрдиреНрд╣реЗрдВ RHEL 7.6 рдореЗрдВ рд╕реНрд░реЛрддреЛрдВ рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдХрд┐рд╕реА рднреА рдЕрдиреНрдп рд▓рд┐рдирдХреНрд╕ рд╡рд┐рддрд░рдг рдореЗрдВ рд╣реЛрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИред </p><br><p>  рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рд▓рд┐рдП рдЙрдкрд╕рд░реНрдЧ / usr / рд╕реНрдерд╛рдиреАрдп рд╣реИред  рдпрд╣рд╛рдБ рднреЗрдбрд╝рд┐рдпрд╛рдПрд╕рдПрд╕рдПрд▓ рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдЕрдзрд┐рдХ рдЖрддреНрдо-рд╡реНрдпрд╛рдЦреНрдпрд╛рддреНрдордХ рдбреЙрдХрд░рдлрд╛рдЗрд▓ рднрд╛рдЧ рд╣реИ </p><br><pre> <code class="plaintext hljs">ADD https://github.com/wolfSSL/wolfssl/archive/v3.15.7-stable.tar.gz ${WORKSPACE} RUN tar xzvf v3.15.7-stable.tar.gz WORKDIR ${WORKSPACE}/wolfssl-3.15.7-stable RUN ./autogen.sh RUN ./configure CFLAGS="-pipe -O2 -march=native -mtune=native -fomit-frame-pointer -fstack-check -fstack-protector-strong -mfpmath=sse -msse2avx -mavx2 -ftree-vectorize -funroll-loops -DTFM_TIMING_RESISTANT -DECC_TIMING_RESISTANT -DWC_RSA_BLINDING" --prefix=/usr/local --enable-tls13 --enable-openssh --enable-aesni --enable-intelasm --enable-keygen --enable-certgen --enable-certreq --enable-curve25519 --enable-ed25519 --enable-intelasm --enable-harden RUN make -j40 all RUN make install</code> </pre><br><p>  рдФрд░ рдпрд╣рд╛рдБ libcrypto ++ рд╕реНрдерд╛рдкрдирд╛ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИ </p><br><pre> <code class="plaintext hljs">ADD https://github.com/weidai11/cryptopp/archive/CRYPTOPP_8_2_0.tar.gz ${WORKSPACE} RUN rm -rf ${WORKSPACE}/cryptopp-CRYPTOPP_8_2_0 RUN tar xzvf ${WORKSPACE}/CRYPTOPP_8_2_0.tar.gz WORKDIR ${WORKSPACE}/cryptopp-CRYPTOPP_8_2_0 RUN make CFLAGS="-pipe -O2 -march=native -mtune=native -fPIC -fomit-frame-pointer -fstack-check -fstack-protector-strong -mfpmath=sse -msse2avx -mavx2 -ftree-vectorize -funroll-loops" CXXFLAGS="-pipe -O2 -march=native -mtune=native -fPIC -fomit-frame-pointer -fstack-check -fstack-protector-strong -mfpmath=sse -msse2avx -mavx2 -ftree-vectorize -funroll-loops" -j40 libcryptopp.a libcryptopp.so RUN make install</code> </pre><br><p>  рдФрд░ рд▓реБрдЬрд┐рдд </p><br><pre> <code class="plaintext hljs">ADD http://luajit.org/download/LuaJIT-2.0.5.tar.gz ${WORKSPACE} WORKDIR ${WORKSPACE} RUN tar xzvf LuaJIT-2.0.5.tar.gz WORKDIR ${WORKSPACE}/LuaJIT-2.0.5 RUN env CFLAGS="-pipe -Wall -pthread -O2 -fPIC -march=native -mtune=native -mfpmath=sse -msse2avx -mavx2 -ftree-vectorize -funroll-loops -fstack-check -fstack-protector-strong -fno-omit-frame-pointer" make -j40 all RUN make install</code> </pre> <br><p>  LAppS рдХреА рдПрдХ рд╡реИрдХрд▓реНрдкрд┐рдХ рдирд┐рд░реНрднрд░рддрд╛, рдЬрд┐рд╕реЗ рдЕрдирджреЗрдЦрд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, Microsoft <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">mimalloc</a> рдХреА рдирдИ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд╣реИред  рдпрд╣ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдорд╣рддреНрд╡рдкреВрд░реНрдг рдкреНрд░рджрд░реНрд╢рди рдореЗрдВ рд╕реБрдзрд╛рд░ (рд▓рдЧрднрдЧ 1%) рдХрд░рддреА рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдХреЗ рд▓рд┐рдП cmake-3.4 рдпрд╛ рдЙрдЪреНрдЪрддрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реАрдорд┐рдд рд╕рдордп рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП, рдореИрдВрдиреЗ рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рдкреНрд░рджрд░реНрд╢рди рд╕реБрдзрд╛рд░ рдХрд╛ рддреНрдпрд╛рдЧ рдХрд░рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓рд┐рдпрд╛ред </p><br><p>  рдЕрдкрдиреЗ рд╣реЛрдо рдкреАрд╕реА рдкрд░, рдореИрдВ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рджреМрд░рд╛рди <em>рдорд┐рдореЗрд▓реЙрдХ рдХреЛ</em> рдЕрдХреНрд╖рдо рдирд╣реАрдВ <em>рдХрд░реВрдВрдЧрд╛</em> ред </p><br><p>  рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рд╕реЗ рд▓рд╛рдЯреНрд╕ рдХреЛ рдЪреЗрдХрдЖрдЙрдЯ рдХрд░реЗрдВ: </p><br><pre> <code class="plaintext hljs">WORKDIR ${WORKSPACE} RUN rm -rf ITCLib ITCFramework lar utils LAppS RUN git clone https://github.com/ITpC/ITCLib.git RUN git clone https://github.com/ITpC/utils.git RUN git clone https://github.com/ITpC/ITCFramework.git RUN git clone https://github.com/ITpC/LAppS.git RUN git clone https://github.com/ITpC/lar.git WORKDIR ${WORKSPACE}/LAppS</code> </pre> <br><p>  рдЕрдм рд╣рдореЗрдВ <strong>nbproject</strong> рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рд╕рднреА рдореЗрдХрдлрд╛рдЗрд▓реНрд╕ рд╕реЗ "-lmimalloc" рдХреЛ рд╣рдЯрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо LAppS рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рд╣рдорд╛рд░реА рд╡рд░реНрддрдорд╛рди рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ $ {WORKSPACE} / LAppS рд╣реИ) </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># find ./nbproject -type f -name "*.mk" -exec sed -i.bak -e 's/-lmimalloc//g' {} \; # find ./nbproject -type f -name "*.bak" -exec rm {} \;</span></span></code> </pre> <br><p>  рдФрд░ рдЕрдм рд╣рдо LAppS рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  LAppS рдХрдИ рдмрд┐рд▓реНрдб рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдкрд░ рдХреБрдЫ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЛ рдмрд╛рд╣рд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ рд╣реИ: </p><br><ul><li>  рдПрд╕рдПрд╕рдПрд▓ рд╕рдорд░реНрдерди рдХреЗ рд╕рд╛рде рдФрд░ рдЖрдВрдХрдбрд╝реЛрдВ рдХреЗ рд╕рдорд░реНрдерди рдХреЗ рд╕рд╛рде </li><li>  рдПрд╕рдПрд╕рдПрд▓ рдХреЗ рд╕рд╛рде рдФрд░ рдЖрдВрдХрдбрд╝реЛрдВ рдХреЗ рдЬрдорд╛рд╡ рдХреЗ рдмрд┐рдирд╛ (рд╣рд╛рд▓рд╛рдВрдХрд┐ рдиреНрдпреВрдирддрдо рдЖрдБрдХрдбрд╝реЗ рдПрдХрддреНрд░ рдХрд░рдирд╛ рдЬрд╛рд░реА рд░рд╣реЗрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд░рдирдЯрд╛рдЗрдо рдореЗрдВ рдЧрддрд┐рд╢реАрд▓ рдПрд▓рдПрдкреАрдПрд╕ рдЯреНрдпреВрдирд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ) </li><li>  SSL рдХреЗ рдмрд┐рдирд╛ рдФрд░ рдЖрдБрдХрдбрд╝рд╛ рдПрдХрддреНрд░рд┐рдд рдХрд┐рдП рдмрд┐рдирд╛ред </li></ul><br><p>  рдЕрдЧрд▓реЗ рдЪрд░рдг рд╕реЗ рдкрд╣рд▓реЗ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЖрдк / рдСрдкреНрдЯ / рд▓реИрдкреНрд╕ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреЗ рдорд╛рд▓рд┐рдХ рд╣реИрдВ (рдпрд╛ sudo рдХреЗ рд╕рд╛рде рд░рди рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ) </p><br><p>  рдЖрдЗрдП, рдПрд╕рдПрд╕рдПрд▓ рд╕рдкреЛрд░реНрдЯ рдФрд░ рд╕реНрдЯреИрдЯрд┐рд╕реНрдЯрд┐рдХреНрд╕ рдХреЗ рджреЛ рдкреНрд░рдХрд╛рд░ рдХреЗ рдмрд╛рдпрдиреЗрд░рд┐рдЬрд╝ рдмрдирд╛рддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕рдХреЗ рдмрд┐рдирд╛ (рд╣рдо $ {WORKSPACE} / LAppS рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдореЗрдВ рд╣реИрдВ): </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># make clean # make CONF=Release.AVX2 install # make CONF=Release.AVX2.NO_STATS.NO_TLS install</span></span></code> </pre> <br><p>  рдкрд░рд┐рдгрд╛рдореА рдмрд╛рдпрдиреЗрд░рд┐рдЬрд╝ рд╣реИрдВ: </p><br><ul><li>  dist / Release.AVX2 / GNU-Linux / lapps.avx2 </li><li>  dist / Release.AVX2.NO_STATS.NO_TLS / GNU-Linux / lapps.avx2.nostats.notls </li></ul><br><p>  рдЙрдиреНрд╣реЗрдВ / рдСрдкреНрдЯ / рд▓реИрдкреНрд╕ / рдмрд┐рди рдореЗрдВ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </p><br><p>  рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ Lua рдХреЗ рд▓рд┐рдП WebSockets рдХреНрд▓рд╛рдЗрдВрдЯ рдореЙрдбреНрдпреВрд▓ рд╣рдореЗрд╢рд╛ SSL рд╕рдорд░реНрдерди рдХреЗ рд╕рд╛рде рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдпрд╣ рд╕рдХреНрд╖рдо рд╣реИ рдпрд╛ рдирд╣реАрдВ URI рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЖрдк рдХрдиреЗрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ (ws: // рдпрд╛ wss: //) рд░рдирдЯрд╛рдЗрдо рдореЗрдВред </p></div></div><br><h2 id="test-1-top-performance-on-home-pc-configuration-for-baseline">  рдЯреЗрд╕реНрдЯ 1. рд╣реЛрдо рдкреАрд╕реА рдкрд░ рд╢реАрд░реНрд╖ рдкреНрд░рджрд░реНрд╢рдиред  рдЖрдзрд╛рд░ рд░реЗрдЦрд╛ рдХреЗ рд▓рд┐рдП рд╡рд┐рдиреНрдпрд╛рд╕ред </h2><br><p>  рдореИрдВрдиреЗ рдкрд╣рд▓реЗ рд╣реА рд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд▓рд┐рдпрд╛ рд╣реИ рдХрд┐ рдореБрдЭреЗ рд╕рд░реНрд╡рд╢реНрд░реЗрд╖реНрда рдкреНрд░рджрд░реНрд╢рди рдорд┐рд▓рддрд╛ рд╣реИ рдЬрдм рдореИрдВ рдкреНрд░рддреНрдпреЗрдХ 100 рдХрдиреЗрдХреНрд╢рди рдХреЗ рд╕рд╛рде рдЪрд╛рд░ рдмреЗрдВрдЪрдорд╛рд░реНрдХ рд╕реЗрд╡рд╛ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддрд╛ рд╣реВрдВред  рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рдореБрдЭреЗ рд╕рд░реНрд╡рд╢реНрд░реЗрд╖реНрда рдкреНрд░рджрд░реНрд╢рди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рддреАрди IOWorkers рдФрд░ рдЪрд╛рд░ рдЗрдХреЛ рд╕реЗрд╡рд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдпрд╛рдж рд░рдЦреЗрдВ?  рдореЗрд░реЗ рдпрд╣рд╛рдБ рдХреЗрд╡рд▓ 4 рдХреЛрд░ рд╣реИрдВред </p><br><p>  рдЗрд╕ рдкрд░реАрдХреНрд╖рдг рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдЖрдЧреЗ рдХреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдЖрдзрд╛рд░ рд░реЗрдЦрд╛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рд╣реИред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдпрд╣рд╛рдВ рдХреБрдЫ рднреА рд░реЛрдорд╛рдВрдЪрдХ рдирд╣реАрдВ рд╣реИред </p><br><p>  Bellow рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рд▓рд┐рдП LAppS рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдХрджрдо рд╣реИрдВред </p><br><h3 id="self-signed-certificates">  рд╕реНрд╡рдпрдВ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдкреНрд░рдорд╛рдг рдкрддреНрд░ </h3><br><div class="spoiler">  <b class="spoiler_title">certgen.sh рд╕реНрдХреНрд░рд┐рдкреНрдЯ</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash openssl genrsa -out example.org.key 2048 openssl req -new -key example.org.key -out example.org.csr openssl genrsa -out ca.key 2048 openssl req -new -x509 -key ca.key -out ca.crt openssl x509 -req -in example.org.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out example.org.crt cat example.org.crt ca.crt &gt; example.org.bundle.crt</span></span></code> </pre> </div></div><br><p>  / рдСрдкреНрдЯ / lapps / conf / ssl рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рднреАрддрд░ рд╕реЗ рдЗрд╕ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдЪрд▓рд╛рдиреЗ рд╕реЗ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдлрд╛рдЗрд▓реЗрдВ рдмрди рдЬрд╛рдПрдВрдЧреАред  рдпрд╣рд╛рдБ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЖрдЙрдЯрдкреБрдЯ рд╣реИ рдФрд░ рдореИрдВрдиреЗ рдЗрд╕рдореЗрдВ рдХреНрдпрд╛ рд▓рд┐рдЦрд╛ рд╣реИ: </p><br><div class="spoiler">  <b class="spoiler_title">certgen.sh рдЖрдЙрдЯрдкреБрдЯ</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># certgen.sh Generating RSA private key, 2048 bit long modulus .................................................................................................................................................................+++++ .....................................+++++ e is 65537 (0x010001) You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Country Name (2 letter code) [AU]:KZ State or Province Name (full name) [Some-State]:none Locality Name (eg, city) []:Almaty Organization Name (eg, company) [Internet Widgits Pty Ltd]:NOORG.DO.NOT.FORGET.TO.REMOVE.FROM.BROWSER Organizational Unit Name (eg, section) []: Common Name (eg server FQDN or YOUR name) []: Email Address []: Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []: An optional company name []: Generating RSA private key, 2048 bit long modulus ...+++++ ............................................................................+++++ e is 65537 (0x010001) You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Country Name (2 letter code) [AU]:KZ State or Province Name (full name) [Some-State]:none Locality Name (eg, city) []:Almaty Organization Name (eg, company) [Internet Widgits Pty Ltd]:none Organizational Unit Name (eg, section) []: Common Name (eg server FQDN or YOUR name) []:*.example.org Email Address []: Signature ok subject=C = KZ, ST = none, L = Almaty, O = NOORG.DO.NOT.FORGET.TO.REMOVE.FROM.BROWSER Getting CA Private Key</code> </pre> </div></div><br><h3 id="lapps-configuration">  LAppS рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди </h3><br><p>  рдпрд╣рд╛рдВ WebSockets рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рд╣реИ рдЬреЛ TLS 1.3 рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рд╣реИ, рдЗрд╕рдореЗрдВ рдЙрдкрд░реЛрдХреНрдд рдЙрддреНрдкрдиреНрди рдкреНрд░рдорд╛рдг рдкрддреНрд░ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ рдФрд░ 3 IOWorkers (LAppS рд╡рд┐рдХрд┐ рдореЗрдВ рдЪрд░ рдХрд╛ рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рд╡рд░рдг рджреЗрдЦреЗрдВ) рдХреЗ рд╕рд╛рде рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред </p><br><div class="spoiler">  <b class="spoiler_title">/opt/lapps/etc/conf/ws.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"listeners"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">"connection_weight"</span></span>: <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ip"</span></span> : <span class="hljs-string"><span class="hljs-string">"0.0.0.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"port"</span></span> : <span class="hljs-number"><span class="hljs-number">5083</span></span>, <span class="hljs-attr"><span class="hljs-attr">"lapps_config_auto_save"</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span> , <span class="hljs-attr"><span class="hljs-attr">"workers"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"workers"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max_connections"</span></span> : <span class="hljs-number"><span class="hljs-number">40000</span></span>, <span class="hljs-attr"><span class="hljs-attr">"auto_fragment"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max_poll_events"</span></span> : <span class="hljs-number"><span class="hljs-number">256</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max_poll_wait_ms"</span></span> : <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max_inbounds_skip"</span></span> : <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">"input_buffer_size"</span></span> : <span class="hljs-number"><span class="hljs-number">2048</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"acl"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"policy"</span></span> : <span class="hljs-string"><span class="hljs-string">"allow"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"exclude"</span></span> : [] }, <span class="hljs-attr"><span class="hljs-attr">"tls"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tls_server_version"</span></span> : <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tls_client_version"</span></span> : <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tls_certificates"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"ca"</span></span>:<span class="hljs-string"><span class="hljs-string">"/opt/lapps/conf/ssl/ca.crt"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"cert"</span></span>: <span class="hljs-string"><span class="hljs-string">"/opt/lapps/conf/ssl/example.org.bundle.crt"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"key"</span></span>: <span class="hljs-string"><span class="hljs-string">"/opt/lapps/conf/ssl/example.org.key"</span></span> } }</code> </pre> </div></div><br><p>  рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рд╡рд╛рд▓реА рд╕реЗрд╡рд╛рдПрдВ: рдЗрдХреЛ рд╕рд░реНрд╡рд░ рдФрд░ рдЗрдХреЛ рдХреНрд▓рд╛рдЗрдВрдЯ (рдмреЗрдВрдЪрдорд╛рд░реНрдХ), рдкреНрд░рддреНрдпреЗрдХ рдореЗрдВ рдЪрд╛рд░ рдЙрджрд╛рд╣рд░рдг рд╣реИрдВред </p><br><div class="spoiler">  <b class="spoiler_title">/opt/lapps/etc/conf/lapps.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"directories"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"app_conf_dir"</span></span>: <span class="hljs-string"><span class="hljs-string">"etc"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"applications"</span></span>: <span class="hljs-string"><span class="hljs-string">"apps"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"deploy"</span></span>: <span class="hljs-string"><span class="hljs-string">"deploy"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tmp"</span></span>: <span class="hljs-string"><span class="hljs-string">"tmp"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"workdir"</span></span>: <span class="hljs-string"><span class="hljs-string">"workdir"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"services"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"echo"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"auto_start"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"instances"</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">"internal"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max_inbound_message_size"</span></span>: <span class="hljs-number"><span class="hljs-number">16777216</span></span>, <span class="hljs-attr"><span class="hljs-attr">"protocol"</span></span>: <span class="hljs-string"><span class="hljs-string">"raw"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"request_target"</span></span>: <span class="hljs-string"><span class="hljs-string">"/echo"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"acl"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"policy"</span></span> : <span class="hljs-string"><span class="hljs-string">"allow"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"exclude"</span></span> : [] } }, <span class="hljs-attr"><span class="hljs-attr">"benchmark"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"auto_start"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"instances"</span></span> : <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">"internal"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"preload"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"nap"</span></span>, <span class="hljs-string"><span class="hljs-string">"cws"</span></span>, <span class="hljs-string"><span class="hljs-string">"time"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"depends"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"echo"</span></span> ] } } }</code> </pre> </div></div><br><p>  рдЧреВрдВрдЬ рд╕реЗрд╡рд╛ рдмрд╣реБрдд рддреБрдЪреНрдЫ рд╣реИ: </p><br><div class="spoiler">  <b class="spoiler_title">рдЗрдХреЛ рд╕рд░реНрд╡рд┐рд╕ рд╕реЛрд░реНрд╕ рдХреЛрдб</b> <div class="spoiler_text"><pre> <code class="lua hljs">echo = {} echo.<span class="hljs-built_in"><span class="hljs-built_in">__index</span></span> = echo; echo.onStart=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"echo::onStart"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> echo.onDisconnect=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> echo.onShutdown=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"echo::onShutdown()"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> echo.onMessage=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(handler,opcode, message)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> result, errmsg=ws:send(handler,opcode,message); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">not</span></span> result) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"echo::OnMessage(): "</span></span>..errmsg); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> echo</code> </pre> </div></div><br><p>  рдмреЗрдВрдЪрдорд╛рд░реНрдХ рд╕реЗрд╡рд╛ рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ <strong>рдмреЗрдВрдЪрдорд╛рд░реНрдХ</strong> .ax_connections рдХреЗ рд░реВрдк рдореЗрдВ рдХрдИ рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рддрдм рддрдХ рдЪрд▓рддрд╛ рд╣реИ рдЬрдм рддрдХ рдЖрдк LAASS рдХреЛ рд░реЛрдХ рдирд╣реАрдВ рджреЗрддреЗред  рдХрдиреЗрдХреНрд╢рди рдХреА рд╕реНрдерд╛рдкрдирд╛ рдпрд╛ рдЧреВрдВрдЬ рдЕрдиреБрд░реЛрдз рдмрдордмрд╛рд░реА рдореЗрдВ рдХреЛрдИ рдард╣рд░рд╛рд╡ рдирд╣реАрдВ рд╣реИред  <strong>Cws</strong> рдореЙрдбреНрдпреВрд▓ API WebSockets рдХреЗ рд▓рд┐рдП рд╡реЗрдм API рдЬреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИред  рд╕рднреА <strong>рдмреЗрдВрдЪрдорд╛рд░реНрдХ</strong> .max_connections рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдЬреБрдбрд╝реЗ рд╕реЙрдХреЗрдЯ рдХреА рдорд╛рддреНрд░рд╛ рдХреЛ рдкреНрд░рд┐рдВрдЯ рдХрд░рддрд╛ рд╣реИред  рдПрдХ рдмрд╛рд░ рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдмреЗрдВрдЪрдорд╛рд░реНрдХ рд╕рд░реНрд╡рд░ рдХреЛ рдмреЗрдВрдЪрдорд╛рд░реНрдХ.рдореИрд╕реЗрдЬ рднреЗрдЬрддрд╛ рд╣реИред  рд╕рд░реНрд╡рд░ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрддрд░ рджреЗрдиреЗ рдХреЗ рдмрд╛рдж <strong>cws</strong> рдСрдмреНрдЬреЗрдХреНрдЯ рдХрд╛ рдЕрдирд╛рдо <strong>рдСрдирдореЗрд╕реЗрдЬ</strong> рд╡рд┐рдзрд┐ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рд╕рд░реНрд╡рд░ рдкрд░ рд╡рд╛рдкрд╕ рдЙрд╕реА рд╕рдВрджреЗрд╢ рдХреЛ рднреЗрдЬрддрд╛ рд╣реИред </p><br><div class="spoiler">  <b class="spoiler_title">рдмреЗрдВрдЪрдорд╛рд░реНрдХ рд╕рд░реНрд╡рд┐рд╕ рд╕реЛрд░реНрд╕ рдХреЛрдб</b> <div class="spoiler_text"><pre> <code class="lua hljs">benchmark={} benchmark.<span class="hljs-built_in"><span class="hljs-built_in">__index</span></span>=benchmark benchmark.init=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> benchmark.messages_counter=<span class="hljs-number"><span class="hljs-number">0</span></span>; benchmark.start_time=<span class="hljs-built_in"><span class="hljs-built_in">time</span></span>.now(); benchmark.max_connections=<span class="hljs-number"><span class="hljs-number">100</span></span>; benchmark.target=<span class="hljs-string"><span class="hljs-string">"wss://127.0.0.1:5083/echo"</span></span>; benchmark.message=<span class="hljs-string"><span class="hljs-string">"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"</span></span>; benchmark.meter=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> benchmark.messages_counter=benchmark.messages_counter+<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> slice=<span class="hljs-built_in"><span class="hljs-built_in">time</span></span>.now() - benchmark.start_time; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( slice &gt;= <span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(benchmark.messages_counter..<span class="hljs-string"><span class="hljs-string">" messages received per "</span></span>..slice..<span class="hljs-string"><span class="hljs-string">"ms"</span></span>) benchmark.messages_counter=<span class="hljs-number"><span class="hljs-number">0</span></span>; benchmark.start_time=<span class="hljs-built_in"><span class="hljs-built_in">time</span></span>.now(); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> benchmark.run=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> n=nap:new(); <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> counter=<span class="hljs-number"><span class="hljs-number">1</span></span>; n:sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> array={}; <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> start=<span class="hljs-built_in"><span class="hljs-built_in">time</span></span>.now(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(#array &lt; benchmark.max_connections) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">not</span></span> must_stop()) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> sock, err_msg=cws:new(benchmark.target, { onopen=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(handler)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> result, errstr=cws:send(handler,benchmark.message,<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">not</span></span> result) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Error on websocket send at handler "</span></span>..handler..<span class="hljs-string"><span class="hljs-string">": "</span></span>..errstr); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>, onmessage=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(handler,message,opcode)</span></span></span></span> benchmark.meter(); cws:send(handler,message,opcode); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>, onerror=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(handler, message)</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Client WebSocket connection is failed for socketfd "</span></span>..handler..<span class="hljs-string"><span class="hljs-string">". Error: "</span></span>..message); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>, onclose=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(handler)</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Connection is closed for socketfd "</span></span>..handler); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sock ~= <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">table</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">insert</span></span>(array,sock); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(err_msg); err_msg=<span class="hljs-literal"><span class="hljs-literal">nil</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">collectgarbage</span></span>(<span class="hljs-string"><span class="hljs-string">"collect"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-comment"><span class="hljs-comment">-- poll events once per 10 outgoing connections -- this will improve the connection establishment speed if counter == 10 then cws:eventLoop(); counter=1 else counter = counter + 1; end end print("Sockets connected: "..#array); benchmark.start_time=time.now(); while not must_stop() do cws:eventLoop(); end for i=1,#array do array[i]:close(); cws:eventLoop(); end end return benchmark;</span></span></code> </pre> </div></div><br><h3 id="services-installation">  рд╕реЗрд╡рд╛рдУрдВ рдХреА рд╕реНрдерд╛рдкрдирд╛ </h3><br><p>  рдЕрдм рд╣рдореЗрдВ рд╕реЗрд╡рд╛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ /opt/lapps/apps//.lua рдореЗрдВ рд░рдЦрдирд╛ рд╣реЛрдЧрд╛: <br></p><ul><li>  /opt/lapps/apps/benchmark/benchmark.lua </li><li>  /opt/lapps/apps/echo/echo.lua </li></ul><br><p>  рд╣рдо рдЕрдкрдирд╛ рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдЕрдм рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИрдВред  рдмрд╕ рдЪрд▓рд╛рдПрдВ: <code>rm -f lapps.log; /opt/lapps/bin/lapps.avx2 &gt; log</code>  <code>rm -f lapps.log; /opt/lapps/bin/lapps.avx2 &gt; log</code> LAppS рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рднреАрддрд░ рд╕реЗ <code>rm -f lapps.log; /opt/lapps/bin/lapps.avx2 &gt; log</code> рдХрд░реЗрдВ рдФрд░ 5 рдорд┐рдирдЯ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ, рдлрд┐рд░ LAppS рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╛рд░ Ctrl-C рджрдмрд╛рдПрдВ (рдпрд╣ рддреБрд░рдВрдд рдмрдВрдж рдирд╣реАрдВ рд╣реЛрдЧрд╛, рдпрд╣ рдкрд╣рд▓реЗ рдХрдиреЗрдХреНрд╢рди рдмрдВрдж рдХрд░ рджреЗрдЧрд╛), рдпрд╛ рджреЛ рдмрд╛рд░ (рдпрд╣ рд╢рдЯрдбрд╛рдЙрди рдЕрдиреБрдХреНрд░рдо рдХреЛ рдмрд╛рдзрд┐рдд рдХрд░реЗрдЧрд╛)ред </p><br><p>  рдареАрдХ рд╣реИ, рд╣рдореЗрдВ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдХреБрдЫ рдХреЗ рд╕рд╛рде рдПрдХ рдкрд╛рда рдлрд╝рд╛рдЗрд▓ рдорд┐рд▓реА рд╣реИ: </p><br><div class="spoiler">  <b class="spoiler_title">рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдЖрдЙрдЯрдкреБрдЯ</b> <div class="spoiler_text"><p>  рдЗрдХреЛ :: рдСрдирд╕реНрдЯрд╛рд░реНрдЯ <br>  рдЗрдХреЛ :: рдСрдирд╕реНрдЯрд╛рд░реНрдЯ <br>  рдЗрдХреЛ :: рдСрдирд╕реНрдЯрд╛рд░реНрдЯ <br>  рдЗрдХреЛ :: рдСрдирд╕реНрдЯрд╛рд░реНрдЯ <br>  рдЪрд▓ рд░рд╣рд╛ рд╣реИ <br>  1 рд╕рдВрджреЗрд╢ рдкреНрд░рддрд┐ 3196ms рдкреНрд░рд╛рдкреНрдд рд╣реБрдЖ <br>  рдкреНрд░рддрд┐ 3299ms рдкрд░ 1 рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рд╣реБрдЖ <br>  рдкреНрд░рддрд┐ 3299ms рдкрд░ 1 рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рд╣реБрдЖ <br>  3305ms рдкреНрд░рддрд┐ 1 рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рд╣реБрдЖ <br>  рд╕реЙрдХреЗрдЯреНрд╕ рдХрдиреЗрдХреНрдЯреЗрдб: 100 <br>  рд╕реЙрдХреЗрдЯреНрд╕ рдХрдиреЗрдХреНрдЯреЗрдб: 100 <br>  рд╕реЙрдХреЗрдЯреНрд╕ рдХрдиреЗрдХреНрдЯреЗрдб: 100 <br>  рд╕реЙрдХреЗрдЯреНрд╕ рдХрдиреЗрдХреНрдЯреЗрдб: 100 <br>  рдкреНрд░рддрд┐ 1000ms рдкрд░ 134597 рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рд╣реБрдП <br>  рдкреНрд░рддрд┐ 1000ms рдкрд░ 139774 рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рд╣реБрдП <br>  рдкреНрд░рддрд┐ 1000ms рдкрд░ 138521 рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рд╣реБрдП <br>  рдкреНрд░рддрд┐ 1000ms рдкрд░ 139404 рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рд╣реБрдП <br>  рдкреНрд░рддрд┐ 1000ms рдкрд░ 140162 рд╕рдВрджреЗрд╢ рдорд┐рд▓реЗ <br>  рдкреНрд░рддрд┐ 1000ms рдкрд░ 139337 рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рд╣реБрдП <br>  рдкреНрд░рддрд┐ 1000ms рдкрд░ 140088 рд╕рдВрджреЗрд╢ рдорд┐рд▓реЗ <br>  рдкреНрд░рддрд┐ 1000ms рдкрд░ 139946 рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рд╣реБрдП <br>  141204 рд╕рдВрджреЗрд╢ рдкреНрд░рддрд┐ 1000ms рдкреНрд░рд╛рдкреНрдд рд╣реБрдП <br>  рдкреНрд░рддрд┐ 1000ms рдкрд░ 137988 рд╕рдВрджреЗрд╢ рдорд┐рд▓реЗ <br>  рдкреНрд░рддрд┐ 1000ms рдкрд░ 141805 рд╕рдВрджреЗрд╢ рдорд┐рд▓реЗ <br>  134733 рд╕рдВрджреЗрд╢ рдкреНрд░рддрд┐ 1000ms рдкреНрд░рд╛рдкреНрдд рд╣реБрдП <br>  ... </p></div></div><br><p>  рдЖрдЗрдП рдЗрд╕ рд▓реЙрдЧ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЗрд╕ рддрд░рд╣ рд╕реЗ рд╕рд╛рдлрд╝ рдХрд░реЗрдВ: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -e <span class="hljs-string"><span class="hljs-string">':%s/ms/^V^M/g\n:%g/^$/d\nGdd1G4/Sockets\n4\ndggZZ'</span></span> | vi <span class="hljs-variable"><span class="hljs-variable">$i</span></span></code> </pre> <br><p>  '^ V ^ M' рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреНрд░рдореБрдЦ рд╣рд┐рдЯреНрд╕ рдХрд╛ рджреГрд╢реНрдпрдорд╛рди рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рд╣реИ: Ctrl-V Ctrl-V Ctrl-V Ctrl-M, рдЗрд╕рд▓рд┐рдП рдЗрд╕ рдмреИрд╢ рд▓рд╛рдЗрди рдХреЛ рдХреЙрдкреА рдкреЗрд╕реНрдЯ рдХрд░рдирд╛ рдмрд╣реБрдд рдмреЗрдХрд╛рд░ рд╣реЛрдЧрд╛ред  рд╕рдВрдХреНрд╖рд┐рдкреНрдд рд╡рд┐рд╡рд░рдг: </p><br><ul><li>  рд╣рдореЗрдВ рд▓рд╛рдЗрди рдХреЗ рдЕрдВрдд рдХреЗ рд╕рд╛рде 'рдПрдордПрд╕' рдкреНрд░рддреАрдХреЛрдВ рдХреЛ рдмрджрд▓рдирд╛ рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рд╣рдореЗрдВ рдЙрдирдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рд╡реЗ рдмрд╛рдж рдореЗрдВ рдЧрдгрдирд╛ рдХреЛ рдЧрдбрд╝рдмрдбрд╝ рдХрд░ рджреЗрдВрдЧреЗ рдФрд░ рд╕рдорд╛рдирд╛рдВрддрд░ рдореЗрдВ рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ 4 рдорд╛рдирджрдВрдб рдПрдХ рдкрдВрдХреНрддрд┐ рдореЗрдВ рдЕрдкрдиреЗ рдкрд░рд┐рдгрд╛рдо рдкреНрд░рд┐рдВрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </li><li>  рд╣рдореЗрдВ рдмрд╛рдж рдореЗрдВ рд╕рднреА рдЦрд╛рд▓реА рд▓рд╛рдЗрдиреЛрдВ рдХреЛ рд╣рдЯрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </li><li>  рд╣рдо рдЕрдВрддрд┐рдо рдкрдВрдХреНрддрд┐ рдХреЛ рднреА рд╣рдЯрд╛рддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рд╕рд░реНрд╡рд░ рдХреЛ рд░реЛрдХрддреЗ рд╣реИрдВ </li><li>  <strong>рд▓реЙрдЧ</strong> рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдХреЗрд╡рд▓ рдХреБрдЫ рдкрдВрдХреНрддрд┐рдпрд╛рдБ рд╣реЛрдВрдЧреА рдЬрд┐рдирдореЗрдВ <em>рд╕реЙрдХреЗрдЯреНрд╕ рдЬреБрдбрд╝реЗ рд╣реБрдП рд╣реИрдВ: 100</em> (рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рдХреЗрд╡рд▓ рдЪрд╛рд░ рдмреЗрдВрдЪрдорд╛рд░реНрдХ рд╕реЗрд╡рд╛ рдЪрд▓рд╛рддреЗ рд╣реИрдВ)ред  рдЗрд╕рд▓рд┐рдП рд╣рдо рдЙрдирдореЗрдВ рд╕реЗ рдЕрдВрддрд┐рдо 4 рд▓рд╛рдЗрдиреЛрдВ рдХреЛ рдЫреЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВ, рдФрд░ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рд╕рдм рдХреБрдЫ рд╣рдЯрд╛рдиреЗ рд╕реЗред </li><li>  рдлрд╝рд╛рдЗрд▓ рд╕рд╣реЗрдЬрдирд╛ред </li></ul><br><p>  рдлрд╝рд╛рдЗрд▓ рд╕рд╣реЗрдЬ рд▓реА рдЧрдИ рд╣реИ рдФрд░ рдЖрдк рдЕрдм рд╢реЗрд▓ рдореЗрдВ рд╡рд╛рдкрд╕ рдЖ рдЧрдП рд╣реИрдВ, рдФрд░ рд▓реЙрдЧ рдлрд╝рд╛рдЗрд▓ рдЕрдЧрд▓реЗ рдЪрд░рдг рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИ: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># awk -v avg=0 '{rps=($1/$5);avg+=rps;}END{print ((avg*1000)/NR)*4}' log</span></span></code> </pre> <br><p>  рдпрд╣ awk рд╕рд┐рдВрдЧрд▓-рд▓рд╛рдЗрдирд░ рдкреНрд░рддрд┐ ms рдкреНрд░рддрд┐рдзреНрд╡рдиреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдорд╛рддреНрд░рд╛ рдХреА рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИ, рдФрд░ <em>рдПрд╡реАрдЬреА</em> рдЪрд░ рдореЗрдВ рдкрд░рд┐рдгрд╛рдо рдХреЛ рдЬрдорд╛ рдХрд░рддрд╛ рд╣реИред  рд▓реЙрдЧ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рднреА рд▓рд╛рдЗрдиреЛрдВ рдХреЗ рд╕рдВрд╕рд╛рдзрд┐рдд рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рдпрд╣ рдкреНрд░рддрд┐ рд╕реЗрдХрдВрдб рдЗрдХреЛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдХреБрд▓ рд░рд╛рд╢рд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП 1000 рд╕реЗ рдЧреБрдгрд╛ рдХрд░рддрд╛ рд╣реИ, рд▓рд╛рдЗрдиреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдмреЗрдВрдЪрдорд╛рд░реНрдХ рд╕реЗрд╡рд╛рдУрдВ рдХреА рдорд╛рддреНрд░рд╛ рдХреЛ рдЧреБрдгрд╛ рдХрд░рддрд╛ рд╣реИред  рдпрд╣ рд╣рдореЗрдВ рдЗрд╕ рдкрд░реАрдХреНрд╖рдг рд░рди рдХреЗ рд▓рд┐рдП рдкреНрд░рддрд┐ рд╕реЗрдХрдВрдб рдХреА рдФрд╕рдд рдкреНрд░рддрд┐рдзреНрд╡рдирд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрддрд╛ рд╣реИред </p><br><p>  рдореЗрд░реЗ рдкреАрд╕реА рдкрд░ рдпрд╣ рд╕рдВрдЦреНрдпрд╛ (рдИрдЖрд░рдкреАрдПрд╕) рд╣реИ: <strong>релремрей .релрек</strong> </p><br><p>  рдПрд╕рдПрд╕рдПрд▓ рд╕рдорд░реНрдерди рдХреЗ рдмрд┐рдирд╛ рдРрд╕рд╛ рд╣реА рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЕрдВрддрд░ рджреЗрдЦрддреЗ рд╣реИрдВ: </p><br><ul><li>  Wsjson рдореЗрдВ tls рдЪрд░ рдХреЗ рдореВрд▓реНрдп рдХреЛ рдЧрд▓рдд рдореЗрдВ рдмрджрд▓реЗрдВ </li><li>  <strong>рдмреЗрдВрдЪрдорд╛рд░реНрдХ</strong> рдореЗрдВ рдмрджрд▓реЗрдВ редрдорд╛рд░реНрдХ рдХреЛ wss: // рд╕реЗ ws: // рдореЗрдВ рджреЗрдЦреЗрдВред </li><li>  <code>rm -f lapps.log; /opt/lapps/bin/lapps.avx2.nostats.notls &gt; log</code>  <code>rm -f lapps.log; /opt/lapps/bin/lapps.avx2.nostats.notls &gt; log</code> LAppS рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рднреАрддрд░ рд╕реЗ <code>rm -f lapps.log; /opt/lapps/bin/lapps.avx2.nostats.notls &gt; log</code> , рдФрд░ рдКрдкрд░ рджрд┐рдП рдЧрдП рдЪрд░рдгреЛрдВ рдХреЛ рджреЛрд╣рд░рд╛рдПрдВред </li></ul><br><p>  рдореБрдЭреЗ рдорд┐рд▓ рдЧрдпрд╛ рд╣реИ: рдкреНрд░рддрд┐ рд╕реЗрдХрдВрдб <strong>721236</strong> рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ </p><br><p>  SSL рдФрд░ рдмрд┐рдирд╛ SSL рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдореЗрдВ рдЕрдВрддрд░ рд▓рдЧрднрдЧ 22% рд╣реИред  рдЖрдЗрдП рднрд╡рд┐рд╖реНрдп рдХреЗ рд╕рдВрджрд░реНрдн рдХреЗ рд▓рд┐рдП рдЗрди рдирдВрдмрд░реЛрдВ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦреЗрдВред </p><br><p>  рд╕рд░реНрд╡рд░ A рдкрд░ рд╕рдорд╛рди рд╕реЗрдЯрдЕрдк рдХреЗ рд╕рд╛рде, рдореБрдЭреЗ рдорд┐рд▓рд╛ рд╣реИ: SSL рдХреЗ рд╕рд╛рде <strong>421905</strong> ERpS рдФрд░ SSL рдХреЗ рдмрд┐рдирд╛ <strong>443145</strong> ERpSред  рд╕реНрдкреЗрдХреНрдЯрд░ рдФрд░ рдореЗрд▓реНрдЯрдбрд╛рдЙрди рдХреЗ рд▓рд┐рдП рдкреИрдЪ рдХреЛ рдЕрдХреНрд╖рдо рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред <br>  рд╕рд░реНрд╡рд░ B рдкрд░ рдореБрдЭреЗ SSL рдХреЗ рд╕рд╛рде <strong>270996</strong> ERpS рдФрд░ SSL рдХреЗ рдмрд┐рдирд╛ <strong>318522</strong> ERpS рд╕рдХреНрд╖рдо рд╣реИрдВред  <strong>385726</strong> рдФрд░ <strong>372126</strong> рдмрд┐рдирд╛ рдПрд╕рдПрд╕рдПрд▓ рдХреЗред  рд╕реНрдкреЗрдХреНрдЯрд░ рдФрд░ рдореЗрд▓реНрдЯрдбрд╛рдЙрди рдХреЗ рд▓рд┐рдП рдкреИрдЪ рдХреЛ рднреА рдЕрдХреНрд╖рдо рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред </p><br><p>  рдкрд░рд┐рдгрд╛рдо рдПрдХ рд╣реА рд╕реЗрдЯрдЕрдк рдХреЗ рд╕рд╛рде рдЦрд░рд╛рдм рд╣реЛрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдЗрди рд╕рд░реНрд╡рд░реЛрдВ рдкрд░ рд╕реАрдкреАрдпреВ рдХреА рдЖрд╡реГрддреНрддрд┐ рдХрдо рд╣реЛрддреА рд╣реИред </p><br><p>  рдХреГрдкрдпрд╛ рд╕рд╛рд╡рдзрд╛рди рд░рд╣реЗрдВ рдХрд┐ рдЧреНрд░рд╛рд╣рдХ / dev / urandom рдореЗрдВ рдбреЗрдЯрд╛ рдЙрдкрд▓рдмреНрдзрддрд╛ рдкрд░ рдмрд╣реБрдд рдирд┐рд░реНрднрд░ рд╣реИрдВред  рдпрд╣ рддрдм рддрдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬрдм рддрдХ рдХрд┐ рдЧреНрд░рд╛рд╣рдХ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЪрд▓рдирд╛ рд╢реБрд░реВ рди рдХрд░реЗрдВ, рдпрджрд┐ рдЖрдк рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЗрд╕реЗ рдПрдХ рдмрд╛рд░ рдЪрд▓рд╛ рдЪреБрдХреЗ рд╣реИрдВред  рддреЛ рдмрд╕ рдЙрдирдХреЗ рд▓рд┐рдП рдХрд╛рдо рд╢реБрд░реВ рдХрд░рдиреЗ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ, рдлрд┐рд░ рд╡реЗ рдЬреЛ рдХрд░рддреЗ рд╣реИрдВ, рдЙрд╕рдореЗрдВ рдмрд╣реБрдд рддреЗрдЬ рд╣реИрдВред  рдЕрдЧрд░ рдПрд▓рдПрдкреАрдПрд╕ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХреЛрдИ рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИ рддреЛ рдмрд╕ <em>рдКрдкрд░ рд╕реЗ</em> рдирд┐рдЧрд░рд╛рдиреА рдХрд░реЗрдВред  рдпрджрд┐ / dev / urandom рдХреЛ рд╕рдорд╛рдкреНрдд рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ LAppS рдЖрдкрдХреЗ CPU рдХреЛ рддрдм рддрдХ рдирд╣реАрдВ рдЦрд╛рдПрдЧрд╛ рдЬрдм рддрдХ рдХрд┐ рдХреБрдЫ рдбреЗрдЯрд╛ рдЙрдкрд▓рдмреНрдз рди рд╣реЛред </p><br><h1 id="preparing-for-big-tests">  рдмрдбрд╝реЗ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреА рддреИрдпрд╛рд░реА рдХрд░ рд░рд╣рд╛ рд╣реИ </h1><br><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рд╣рдореЗрдВ рдХрд░реНрдиреЗрд▓ рдорд╛рдкрджрдВрдбреЛрдВ рдореЗрдВ рдХреБрдЫ рдмрджрд▓рд╛рд╡ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдФрд░ рдЦреБрд▓реА рдлрд╛рдЗрд▓реЛрдВ рдХреА рдПрдирдЖрд░ рдХреЗ рд▓рд┐рдП рдЕрд▓реНрдорд┐рдЯ рдХреЛ рдордд рднреВрд▓рдирд╛ред  рдореИрдВрдиреЗ рдЗрд╕ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓реЗрдЦ</a> рдореЗрдВ рд▓рдЧрднрдЧ рд╕рдорд╛рди рд╕реЗрдЯрдЕрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рд╣реИред </p><br><p>  рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде рдПрдХ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдБ </p><br><pre> <code class="bash hljs">: sysctl -w fs.file-max=14000000 sysctl -w fs.nr_open=14000000 <span class="hljs-built_in"><span class="hljs-built_in">ulimit</span></span> -n 14000000 sysctl -w net.ipv4.tcp_mem=<span class="hljs-string"><span class="hljs-string">"100000000 100000000 100000000"</span></span> sysctl -w net.core.somaxconn=20000 sysctl -w net.ipv4.tcp_max_syn_backlog=20000 sysctl -w net.ipv4.ip_local_port_range=<span class="hljs-string"><span class="hljs-string">"1025 65535"</span></span></code> </pre> <br><p>  рдлрд┐рд░ <em>рд╕реНрд░реЛрдд рдХрд╛</em> рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред рдХрд░реНрдиреЗрд▓ рдкреИрд░рд╛рдореАрдЯрд░ рдФрд░ <em>рдЕрд▓рд┐рдореЗрдЯ</em> рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рджреЛрдиреЛрдВ рд╕рд░реНрд╡рд░реЛрдВ рдкрд░ рдирд╛рдо рдмрджрд▓реЗрдВред </p><br><p>  рдЗрд╕ рдмрд╛рд░ рдореЗрд░рд╛ рдЙрджреНрджреЗрд╢реНрдп рдПрдХ рд╕рд░реНрд╡рд░ рдкрд░ рдХрдИ рд▓рд╛рдЦреЛрдВ рдЧреНрд░рд╛рд╣рдХ рдмрдирд╛рдирд╛ рдФрд░ рдЙрдиреНрд╣реЗрдВ рджреВрд╕рд░реЗ рд╕реЗ рдЬреЛрдбрд╝рдирд╛ рд╣реИред </p><br><p>  рд╕рд░реНрд╡рд░ рдП рд╡реЗрдмрд╕реЙрдХреЗрдЯ рдЧреВрдВрдЬ рд╕реЗрд╡рд╛ рд╕рд░реНрд╡рд░ рдкрдХреНрд╖ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░реЗрдЧрд╛ред <br>  рд╕рд░реНрд╡рд░ рдмреА рд╡реЗрдмрд╕реЙрдХреЗрдЯ рдЗрдХреЛ рд╕рд░реНрд╡рд┐рд╕ рдХреНрд▓рд╛рдЗрдВрдЯ рд╕рд╛рдЗрдб рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░реЗрдЧрд╛ред </p><br><p>  LuaJIT рджреНрд╡рд╛рд░рд╛ рд▓рдЧрд╛рдП рдЧрдП LAppS рдореЗрдВ рдПрдХ рд╕реАрдорд╛ рд╣реИред  рдЖрдк рдкреНрд░рддрд┐ LuaJIT VM рдореЗрдВ рдХреЗрд╡рд▓ 2GB RAM рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣ рд░реИрдо рдХреА рд╕реАрдорд╛ рд╣реИ рдЬрд┐рд╕реЗ рдЖрдк рд╕рднреА рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдПрдХрд▓ рдПрд▓рдПрдкреАрдПрд╕ рдЙрджрд╛рд╣рд░рдг рдХреЗ рднреАрддрд░ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рд╕реЗрд╡рд╛рдПрдВ рдПрдХ рд▓рдмреБрдЖрдЬрд┐рдд рдЙрджрд╛рд╣рд░рдг рдХреЗ рдЦрд┐рд▓рд╛рдл рдЬреБрдбрд╝реЗ рдзрд╛рдЧреЗ рд╣реИрдВред  рдпрджрд┐ рдЖрдкрдХреА рдХреЛрдИ рднреА рд╕реЗрд╡рд╛, рдЬреЛ рд╕рд┐рдВрдЧрд▓ рдПрд▓рдПрдкреАрдПрд╕ рдЙрджрд╛рд╣рд░рдг рдХреЗ рддрд╣рдд рдЪрд▓ рд░рд╣реА рд╣реИ, рдЗрд╕ рд╕реАрдорд╛ рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛ рдЬрд╛рддреА рд╣реИ, рддреЛ рд╕рднреА рд╕реЗрд╡рд╛рдПрдВ рдореЗрдореЛрд░реА рд╕реЗ рдмрд╛рд╣рд░ рд╣реЛ рдЬрд╛рдПрдВрдЧреАред </p><br><p>  рдореБрдЭреЗ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ рдкреНрд░рддрд┐ рдПрдХрд▓ рдПрд▓рдПрдкреАрдПрд╕ рдЙрджрд╛рд╣рд░рдг рдЖрдк 64 рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рд╕рдВрджреЗрд╢ рдЖрдХрд╛рд░ рдХреЗ рд╕рд╛рде 2 рддреЛ 464 000 рдХреНрд▓рд╛рдЗрдВрдЯ рд╡реЗрдмрд╕реНрдХреЗрдЯ рдХреЛ рдЕрдзрд┐рдХ рд╕реНрдерд╛рдкрд┐рдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╕рдВрджреЗрд╢ рдХрд╛ рдЖрдХрд╛рд░ рдЗрд╕ рд╕реАрдорд╛ рдХреЛ рдереЛрдбрд╝рд╛ рдмрджрд▓ рд╕рдХрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ LAppS рд╕рдВрджреЗрд╢ рдХреЛ LuaJIT рдХреЗ рднреАрддрд░ рдЗрд╕ рд╕рдВрджреЗрд╢ рдХреЗ рд▓рд┐рдП рд╕реНрдерд╛рди рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдХреЗ рд╕реЗрд╡рд╛ рдХреЛ рдкрд╛рд╕ рдХрд░рддрд╛ рд╣реИред </p><br><p>  рдЗрд╕рдХрд╛ рддрд╛рддреНрдкрд░реНрдп рд╣реИ рдХрд┐ рдореБрдЭреЗ рд╕рд░реНрд╡рд░ рдмреА рдкрд░ рдПрдХ рд╣реА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рд╕рд╛рде рдХрдИ LAppS рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рдХреЛ рд╢реБрд░реВ рдХрд░рдирд╛ рд╣реИ рддрд╛рдХрд┐ рдЕрдзрд┐рдХ рд╕реЗ рдЕрдзрд┐рдХ 2.4 рд▓рд╛рдЦреЛрдВ WebSockets рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред  рд╕рд░реНрд╡рд░ A (рдЗрдХреЛ рд╕рд░реНрд╡рд░) LuaJIT рдкрдХреНрд╖ рдкрд░ рдЕрдзрд┐рдХ рдореЗрдореЛрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП LAppS рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдмрд┐рдирд╛ рдХрд┐рд╕реА рд╕рдорд╕реНрдпрд╛ рдХреЗ 12.3 рдорд┐рд▓рд┐рдпрди WebSockets рдХрд╛ рдзреНрдпрд╛рди рд░рдЦреЗрдЧрд╛ред </p><br><p>  рдЪрд▓реЛ рд╕рд░реНрд╡рд░ рдП рдФрд░ рдмреА рдХреЗ рд▓рд┐рдП рджреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рддреИрдпрд╛рд░ рдХрд░рддреЗ рд╣реИрдВред </p><br><div class="spoiler">  <b class="spoiler_title">рд╕рд░реНрд╡рд░ A ws.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"listeners"</span></span> : <span class="hljs-number"><span class="hljs-number">224</span></span>, <span class="hljs-attr"><span class="hljs-attr">"connection_weight"</span></span>: <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ip"</span></span> : <span class="hljs-string"><span class="hljs-string">"0.0.0.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"port"</span></span> : <span class="hljs-number"><span class="hljs-number">5084</span></span>, <span class="hljs-attr"><span class="hljs-attr">"lapps_config_auto_save"</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span> , <span class="hljs-attr"><span class="hljs-attr">"workers"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"workers"</span></span>: <span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max_connections"</span></span> : <span class="hljs-number"><span class="hljs-number">2000000</span></span>, <span class="hljs-attr"><span class="hljs-attr">"auto_fragment"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max_poll_events"</span></span> : <span class="hljs-number"><span class="hljs-number">256</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max_poll_wait_ms"</span></span> : <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max_inbounds_skip"</span></span> : <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">"input_buffer_size"</span></span> : <span class="hljs-number"><span class="hljs-number">2048</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"acl"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"policy"</span></span> : <span class="hljs-string"><span class="hljs-string">"allow"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"exclude"</span></span> : [] }, <span class="hljs-attr"><span class="hljs-attr">"tls"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tls_server_version"</span></span> : <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tls_client_version"</span></span> : <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tls_certificates"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"ca"</span></span>:<span class="hljs-string"><span class="hljs-string">"/opt/lapps/conf/ssl/ca.crt"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"cert"</span></span>: <span class="hljs-string"><span class="hljs-string">"/opt/lapps/conf/ssl/example.org.bundle.crt"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"key"</span></span>: <span class="hljs-string"><span class="hljs-string">"/opt/lapps/conf/ssl/example.org.key"</span></span> } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">рд╕рд░реНрд╡рд░ A lapps.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"directories"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"app_conf_dir"</span></span>: <span class="hljs-string"><span class="hljs-string">"etc"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"applications"</span></span>: <span class="hljs-string"><span class="hljs-string">"apps"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"deploy"</span></span>: <span class="hljs-string"><span class="hljs-string">"deploy"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tmp"</span></span>: <span class="hljs-string"><span class="hljs-string">"tmp"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"workdir"</span></span>: <span class="hljs-string"><span class="hljs-string">"workdir"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"services"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"echo"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"auto_start"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"instances"</span></span>: <span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-attr"><span class="hljs-attr">"internal"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max_inbound_message_size"</span></span>: <span class="hljs-number"><span class="hljs-number">16777216</span></span>, <span class="hljs-attr"><span class="hljs-attr">"protocol"</span></span>: <span class="hljs-string"><span class="hljs-string">"raw"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"request_target"</span></span>: <span class="hljs-string"><span class="hljs-string">"/echo"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"acl"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"policy"</span></span> : <span class="hljs-string"><span class="hljs-string">"allow"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"exclude"</span></span> : [] } } } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">рд╕рд░реНрд╡рд░ B ws.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"listeners"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"connection_weight"</span></span>: <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ip"</span></span> : <span class="hljs-string"><span class="hljs-string">"0.0.0.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"port"</span></span> : <span class="hljs-number"><span class="hljs-number">5083</span></span>, <span class="hljs-attr"><span class="hljs-attr">"lapps_config_auto_save"</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span> , <span class="hljs-attr"><span class="hljs-attr">"workers"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"workers"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max_connections"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"auto_fragment"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max_poll_events"</span></span> : <span class="hljs-number"><span class="hljs-number">2048</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max_poll_wait_ms"</span></span> : <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max_inbounds_skip"</span></span> : <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">"input_buffer_size"</span></span> : <span class="hljs-number"><span class="hljs-number">2048</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"acl"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"policy"</span></span> : <span class="hljs-string"><span class="hljs-string">"deny"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"exclude"</span></span> : [] }, <span class="hljs-attr"><span class="hljs-attr">"tls"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tls_server_version"</span></span> : <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tls_client_version"</span></span> : <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tls_certificates"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"ca"</span></span>:<span class="hljs-string"><span class="hljs-string">"/opt/lapps/conf/ssl/ca.crt"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"cert"</span></span>: <span class="hljs-string"><span class="hljs-string">"/opt/lapps/conf/ssl/example.org.bundle.crt"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"key"</span></span>: <span class="hljs-string"><span class="hljs-string">"/opt/lapps/conf/ssl/example.org.key"</span></span> } }</code> </pre> </div></div><br><p>  рд╕рд░реНрд╡рд░ A рдореЗрдВ рджреЛ рдЗрдВрдЯрд░рдлреЗрд╕ рд╣реИрдВ: </p><br><ul><li>  рдмрдВрдз0 - xx203.37 </li><li>  рдмрдВрдз 1 - xx23.10 </li></ul><br><p>  рдПрдХ рддреЗрдЬреА рд╕реЗ рдПрдХ рдФрд░ рдзреАрдореА рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХреЛрдИ рдлрд░реНрдХ рдирд╣реАрдВ рдкрдбрд╝рддрд╛ред  рд╕рд░реНрд╡рд░ рднрд╛рд░реА рд▓реЛрдб рдХреЗ рддрд╣рдд рд╣реЛрдЧрд╛ред </p><br><p>  рд╣рдорд╛рд░реЗ /opt/lapps/benchmark/benchmark.lua рд╕реЗ рдПрдХ рдЦрд╛рдХрд╛ рддреИрдпрд╛рд░ рдХрд░реЗрдВ </p><br><div class="spoiler">  <b class="spoiler_title">benchmark.lua</b> <div class="spoiler_text"><pre> <code class="lua hljs">benchmark={} benchmark.<span class="hljs-built_in"><span class="hljs-built_in">__index</span></span>=benchmark benchmark.init=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> benchmark.messages_counter=<span class="hljs-number"><span class="hljs-number">0</span></span>; benchmark.start_time=<span class="hljs-built_in"><span class="hljs-built_in">time</span></span>.now(); benchmark.max_connections=<span class="hljs-number"><span class="hljs-number">10000</span></span>; benchmark.target_port=<span class="hljs-number"><span class="hljs-number">0</span></span>; benchmark.target_prefix=<span class="hljs-string"><span class="hljs-string">"wss://IPADDR:"</span></span>; benchmark.target_postfix=<span class="hljs-string"><span class="hljs-string">"/echo"</span></span>; benchmark.message=<span class="hljs-string"><span class="hljs-string">"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"</span></span>; benchmark.meter=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> benchmark.messages_counter=benchmark.messages_counter+<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> slice=<span class="hljs-built_in"><span class="hljs-built_in">time</span></span>.now() - benchmark.start_time; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( slice &gt;= <span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(benchmark.messages_counter..<span class="hljs-string"><span class="hljs-string">" messages received per "</span></span>..slice..<span class="hljs-string"><span class="hljs-string">"ms"</span></span>) benchmark.messages_counter=<span class="hljs-number"><span class="hljs-number">0</span></span>; benchmark.start_time=<span class="hljs-built_in"><span class="hljs-built_in">time</span></span>.now(); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> benchmark.run=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> n=nap:new(); <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> counter=<span class="hljs-number"><span class="hljs-number">1</span></span>; n:sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> array={}; <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> start=<span class="hljs-built_in"><span class="hljs-built_in">time</span></span>.now(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(#array &lt; benchmark.max_connections) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">not</span></span> must_stop()) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> benchmark.target_port=<span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>(<span class="hljs-number"><span class="hljs-number">5084</span></span>,<span class="hljs-number"><span class="hljs-number">5307</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> sock, err_msg=cws:new(benchmark.target_prefix..benchmark.target_port..benchmark.target_postfix, { onopen=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(handler)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> result, errstr=cws:send(handler,benchmark.message,<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">not</span></span> result) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Error on websocket send at handler "</span></span>..handler..<span class="hljs-string"><span class="hljs-string">": "</span></span>..errstr); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>, onmessage=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(handler,message,opcode)</span></span></span></span> benchmark.meter(); cws:send(handler,message,opcode); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>, onerror=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(handler, message)</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Client WebSocket connection is failed for socketfd "</span></span>..handler..<span class="hljs-string"><span class="hljs-string">". Error: "</span></span>..message); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>, onclose=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(handler)</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Connection is closed for socketfd "</span></span>..handler); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sock ~= <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">table</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">insert</span></span>(array,sock); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(err_msg); err_msg=<span class="hljs-literal"><span class="hljs-literal">nil</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">collectgarbage</span></span>(<span class="hljs-string"><span class="hljs-string">"collect"</span></span>); <span class="hljs-comment"><span class="hljs-comment">-- force garbage collection on connection failure. end -- poll events once per 10 outgoing connections -- this will improve the connection establishment speed if counter == 10 then cws:eventLoop(); counter=1 else counter = counter + 1; end end print("Sockets connected: "..#array); benchmark.start_time=time.now(); while not must_stop() do cws:eventLoop(); end for i=1,#array do array[i]:close(); cws:eventLoop(); end end return benchmark;</span></span></code> </pre> </div></div><br><p>  рдЖрдЗрдП рд╕рд░реНрд╡рд░ A IP рдкрддреЛрдВ рдХреЛ рдХреНрд░рдорд╢рдГ IP1 рдФрд░ IP2 рдлрд╛рдЗрд▓реЛрдВ рдореЗрдВ рд╕реНрдЯреЛрд░ рдХрд░реЗрдВ рдФрд░ рдлрд┐рд░: </p><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 1 2 <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> mkdir -p /opt/lapps/apps/benchmark<span class="hljs-variable"><span class="hljs-variable">${i}</span></span> sed -e <span class="hljs-string"><span class="hljs-string">"s/IPADDR/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(cat IP1)</span></span></span><span class="hljs-string">/g"</span></span> /opt/lapps/apps/benchmark/benchmark.lua &gt; /opt/lapps/apps/benchmark<span class="hljs-variable"><span class="hljs-variable">${i}</span></span>/benchmark<span class="hljs-variable"><span class="hljs-variable">${i}</span></span>.lua <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br><p>  рдЕрдм рд╣рдо рд╕рд░реНрд╡рд░ рдмреА рдкрд░ / рдЧреЛрдж /lapps/etc/conf/lapps.json рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддреЗ рд╣реБрдП рдЗрди рджреЛ рдЕрдХреНрд╖рд░реЛрдВ рдХрд╛ рдкреНрд░рдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ: </p><br><div class="spoiler">  <b class="spoiler_title">рд╕рд░реНрд╡рд░ рдмреА lapps.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"directories"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"app_conf_dir"</span></span>: <span class="hljs-string"><span class="hljs-string">"etc"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"applications"</span></span>: <span class="hljs-string"><span class="hljs-string">"apps"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"deploy"</span></span>: <span class="hljs-string"><span class="hljs-string">"deploy"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tmp"</span></span>: <span class="hljs-string"><span class="hljs-string">"tmp"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"workdir"</span></span>: <span class="hljs-string"><span class="hljs-string">"workdir"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"services"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"benchmark1"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"auto_start"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"instances"</span></span> : <span class="hljs-number"><span class="hljs-number">112</span></span>, <span class="hljs-attr"><span class="hljs-attr">"internal"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"preload"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"nap"</span></span>, <span class="hljs-string"><span class="hljs-string">"cws"</span></span>, <span class="hljs-string"><span class="hljs-string">"time"</span></span> ] }, <span class="hljs-attr"><span class="hljs-attr">"benchmark2"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"auto_start"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"instances"</span></span> : <span class="hljs-number"><span class="hljs-number">112</span></span>, <span class="hljs-attr"><span class="hljs-attr">"internal"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"preload"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"nap"</span></span>, <span class="hljs-string"><span class="hljs-string">"cws"</span></span>, <span class="hljs-string"><span class="hljs-string">"time"</span></span> ] } } }</code> </pre> </div></div><br><p>  рдХреНрдпрд╛ рд╣рдо рддреИрдпрд╛рд░ рд╣реИрдВ?  рдирд╣реАрдВ рд╣рдо рдирд╣реАрдВ рд╣реИрдВред  рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рдХреЗрд╡рд▓ рджреЛ рдкрддреЛрдВ рдкрд░ 2 240 000 рдЖрдЙрдЯрдЧреЛрдЗрдВрдЧ рд╕реЙрдХреЗрдЯ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХрд╛ рдЗрд░рд╛рджрд╛ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдФрд░ рд╣рдореЗрдВ рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдкрд░ рдЕрдзрд┐рдХ рдкреЛрд░реНрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдПрдХ рд╣реА рдЖрдИрдкреА рд╕реЗ рдЕрдзрд┐рдХ 64k рдХрдиреЗрдХреНрд╢рди рдмрдирд╛рдирд╛ рдЕрд╕рдВрднрд╡ рд╣реИ: рдкреЛрд░реНрдЯ рдЬреЛрдбрд╝реА (рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдереЛрдбрд╝рд╛ рдХрдо рддреЛ 64k)ред </p><br><p>  рд╕рд░реНрд╡рд░ рдП рдкрд░ рдлрд╝рд╛рдЗрд▓ LAppS рдореЗрдВ рд╢рд╛рдорд┐рд▓ / / wsServer.h рдПрдХ рдлрд╝рдВрдХреНрд╢рди void startListeners () рд╣реИред  рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рд╣рдо рд▓рд╛рдЗрди 126 рдХреЛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВрдЧреЗ </p><br><pre> <code class="plaintext hljs">LAppSConfig::getInstance()-&gt;getWSConfig()["port"],</code> </pre> <br><p>  рдЗрд╕рдХреЗ рд╕рд╛рде: </p><br><pre> <code class="plaintext hljs">static_cast&lt;int&gt;(LAppSConfig::getInstance()-&gt;getWSConfig()["port"])+i,</code> </pre> <br><p>  LAppS рдХрд╛ рдкреБрдирд░реНрдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВ: </p><br><pre> <code class="bash hljs">make CONF=Release.AVX2 install</code> </pre> <br><h1 id="running-the-tests-for-2-240-000-client-websockets">  2 240 000 рдХреНрд▓рд╛рдЗрдВрдЯ рд╡реЗрдмрд╕реНрдХреЗрдЯ рдХреЗ рд▓рд┐рдП рдкрд░реАрдХреНрд╖рдг рдЪрд▓рд╛ рд░рд╣рд╛ рд╣реИред </h1><br><p>  рд╕рд░реНрд╡рд░ рдмреА рдкрд░ LAppS рдкреНрд░рд╛рд░рдВрдн рдХрд░реЗрдВ, рдлрд┐рд░ рд╕рд░реНрд╡рд░ B рдкрд░ LAppS рдкреНрд░рд╛рд░рдВрдн рдХрд░реЗрдВ рдФрд░ рдЖрдЙрдЯрдкреБрдЯ рдХреЛ рдЗрд╕ рддрд░рд╣ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░реЗрдВ: </p><br><pre> <code class="bash hljs">/opt/lapps/bin/lapps.avx2 &gt; <span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> </pre> <br><p>  рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЗрдВ, NB: </p><br><pre> <code class="plaintext hljs">if you want to run several LAppS instances, then create separate directory for each instnace (like run1,run2, etc) and run each instance from within these directories. This is required for lapps.log file and of course for resulting standard output, for not to be overlapped/overwritten by concurrent LAppS instances.</code> </pre> <br><p>  рд╕рднреА рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрдиреЗ рддрдХ рдЗрд╕рдореЗрдВ рдХреБрдЫ рд╕рдордп рд▓рдЧ рд╕рдХрддрд╛ рд╣реИред  рдЪрд▓реЛ рдкреНрд░рдЧрддрд┐ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рддреЗ рд╣реИрдВред </p><br><p>  рд╕реНрдерд╛рдкрд┐рдд рдХрдиреЗрдХреНрд╢рди рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдиреЗрдЯрд╕реНрдЯреИрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рди рдХрд░реЗрдВ, рдпрд╣ рдмреЗрдХрд╛рд░ рд╣реИ рдЬрдмрдХрд┐ рдпрд╣ 150k рдХрдиреЗрдХреНрд╢рдиреЛрдВ рдХреА рддрд░рд╣ рдЕрдирд┐рд╢реНрдЪрд┐рдд рдХрд╛рд▓ рддрдХ рдЪрд▓рддрд╛ рд╣реИ рдЬреЛ рдХреБрдЫ рд╕реЗрдХрдВрдб рдореЗрдВ рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрддреЗ рд╣реИрдВред  рд╕рд░реНрд╡рд░ A рдкрд░ lapps.log рдХреЛ рдЙрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рджреЗрдЦреЗрдВ, рдЬрд┐рд╕рдореЗрдВ рдЖрдк LAppS рдХреЛ рд╢реБрд░реВ рдХрд░рддреЗ рд╕рдордп рдереЗред  рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡рди-рд▓рд╛рдЗрдирд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХрдиреЗрдХреНрд╢рди рдХреИрд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ IOWorkers рдХреЗ рдмреАрдЪ рдХреИрд╕реЗ рд╡рд┐рддрд░рд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ: </p><br><pre> <code class="bash hljs">date;awk <span class="hljs-string"><span class="hljs-string">'/ will be added to connection pool of worker/{a[$22]++}END{for(i in a){ print i, a[i]; sum+=a[i]} print sum}'</span></span> lapps.log | sort -n;date</code> </pre> <br><p>  рдЗрди рдХрдиреЗрдХреНрд╢рдиреЛрдВ рдХреЛ рдХрд┐рддрдиреА рддреЗрдЬреА рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕ рдкрд░ рдПрдХ рд╡рд┐рдЪрд╛рд░ рд╣реИ: </p><br><pre> <code class="plaintext hljs">375874 Sun Jul 21 20:33:07 +06 2019 650874 Sun Jul 21 20:34:42 +06 2019 2894 connections per second 1001874 Sun Jul 21 20:36:45 +06 2019 2974 connections per second 1182874 Sun Jul 21 20:37:50 +06 2019 2784 connections per second 1843874 Sun Jul 21 20:41:44 +06 2019 2824 connections per second 2207874 Sun Jul 21 20:45:43 +06 2019 3058 connections per second</code> </pre><br><p>  рд╕рд░реНрд╡рд░ B рдкрд░ рд╣рдо рдЙрдирдХреЗ рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдХрд┐рдП рдЧрдП рдорд╛рдирджрдВрдб рдХреА рд░рд╛рд╢рд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># grep Sockets log | wc -l 224</span></span></code> </pre> <br><p>  рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рдмрд╛рдж рдХрд┐ рд╕рдВрдЦреНрдпрд╛ 224 рд╣реИ, рд╕рд░реНрд╡рд░ рдХреЛ рдХреБрдЫ рд╕рдордп рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдХрд░рдиреЗ рджреЗрдВ, рд╢реАрд░реНрд╖ рдкрд░ рд╕реАрдкреАрдпреВ рдФрд░ рдореЗрдореЛрд░реА рдЙрдкрдпреЛрдЧ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░реЗрдВред  рдЖрдк рдЗрд╕ рддрд░рд╣ рдХреБрдЫ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ (рдмрд╛рдИрдВ рдУрд░ рд╕рд░реНрд╡рд░ рдмреА рдФрд░ рджрд╛рдИрдВ рдУрд░ рд╕рд░реНрд╡рд░ рдП): </p><br><p><img src="https://habrastorage.org/webt/e0/vy/sv/e0vysvislttrfhwpn_vexnwseli.png" alt="рдЫрд╡рд┐"></p><br><p>  рдпрд╛ рдЗрд╕ рддрд░рд╣ (рдмрд╛рдИрдВ рдУрд░ рд╕рд░реНрд╡рд░ рдмреА рдФрд░ рджрд╛рдИрдВ рдУрд░ рд╕рд░реНрд╡рд░ рдП): </p><br><p><img src="https://habrastorage.org/webt/p1/cj/qk/p1cjqk6fxmthbnnexc2ikco9d6a.png"></p><br><p>  рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рд╕рд░реНрд╡рд░ рдмреА рд╣реИ, рдЬрд╣рд╛рдВ рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реЗрд╡рд╛рдПрдВ рдЪрд▓ рд░рд╣реА рд╣реИрдВ, рднрд╛рд░реА рднрд╛рд░ рдХреЗ рдЕрдзреАрди рд╣реИред  рд╕рд░реНрд╡рд░ рдП рднрд╛рд░реА рд▓реЛрдб рдХреЗ рддрд╣рдд рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдореЗрд╢рд╛ рдирд╣реАрдВред  рдЬрдм рд╕рд░реНрд╡рд░ рдмреА рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╛рд░реНрдпреЛрдВ рдХреА рдорд╛рддреНрд░рд╛ рдХреЗ рд╕рд╛рде рд╕рдВрдШрд░реНрд╖ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдХреБрдЫ рдмрд╛рд░ рдпрд╣ рдзреЛрдЦрд╛ рджреЗрддрд╛ рд╣реИред  рдЯреАрдПрд▓рдПрд╕ рдкрд░ рдЯреНрд░реИрдлрд┐рдХ рд╕рд╛рдЗрдлрд░рд┐рдВрдЧ рдмрд╣реБрдд рд╕реАрдкреАрдпреВ рдЗрдВрдЯреЗрдВрд╕рд┐рд╡ рд╣реИред </p><br><p>  рдЖрдЗрдП рд╕рд░реНрд╡рд░реЛрдВ рдХреЛ рдмрдВрдж рдХрд░реЗрдВ (рдХрдИ рдмрд╛рд░ Ctrl-C рджрдмрд╛рдПрдВ) рдФрд░ рдкрд╣рд▓реЗ рдХреА рддрд░рд╣ рд▓реЙрдЧ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ рд▓реЗрдХрд┐рди рдмреЗрдВрдЪрдорд╛рд░реНрдХ рд╕реЗрд╡рд╛рдУрдВ рдХреА рдмрджрд▓реА рд╣реБрдИ рд░рд╛рд╢рд┐ (224) рдХреЗ рд╕рдВрдмрдВрдз рдореЗрдВ: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -e <span class="hljs-string"><span class="hljs-string">':%s/ms/^V^M/g\n:%g/^$/d\nGdd1G224/Sockets\n224\ndggZZ'</span></span> | vi <span class="hljs-variable"><span class="hljs-variable">$i</span></span> awk -v avg=0 <span class="hljs-string"><span class="hljs-string">'{rps=($1/$5);avg+=rps;}END{print ((avg*1000)/NR)*224}'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> </pre> <br><p>  рдЖрдк рдмреЗрдВрдЪрдорд╛рд░реНрдХ рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд░реЛрдХрдиреЗ рд╕реЗ рдкреНрд░рд┐рдВрдЯ рдЖрдЙрдЯ рдХреЗ рд▓рд┐рдП рдХрдИ рдЕрдВрддрд┐рдо рд▓рд╛рдЗрдиреЗрдВ рднреА рд╣рдЯрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред  рдЖрдкрдХреЛ рдкрд╣рд▓реЗ рд╣реА рдкрддрд╛ рдЪрд▓ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдХреИрд╕реЗ рдХрд░рдирд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП рдореИрдВ рд╡рд┐рднрд┐рдиреНрди рдкрд░реАрдХреНрд╖рдг рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдкрд░рд┐рдгрд╛рдо рдкреЛрд╕реНрдЯ рдХрд░реВрдВрдЧрд╛ рдФрд░ рдЙрди рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдЖрдЧреЗ рдмрдврд╝реВрдВрдЧрд╛, рдЬрд┐рдирдХрд╛ рдореИрдВрдиреЗ рд╕рд╛рдордирд╛ рдХрд┐рдпрд╛ рд╣реИред </p><br><h1 id="results-for-all-the-other-tests-49-million-and-beyond">  рдЕрдиреНрдп рд╕рднреА рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рдкрд░рд┐рдгрд╛рдо (4.9 рдорд┐рд▓рд┐рдпрди рдФрд░ рдЙрд╕рд╕реЗ рдЕрдзрд┐рдХ) </h1><br><p><img src="https://habrastorage.org/webt/az/4a/at/az4aatexickfttbrom2gg3yrymu.png"></p><br><div class="spoiler">  <b class="spoiler_title">рдкрд░реАрдХреНрд╖рдг # 4 рд▓реЛрдб</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ra/ka/_f/raka_fia7i2vnqhwh2p-5lnulc8.png"></p></div></div><br><div class="spoiler">  <b class="spoiler_title">рдкрд░реАрдХреНрд╖рдг # 5 рд▓реЛрдб</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ln/z5/ml/lnz5mlaoz7aclxuyvjwjpwj25jm.png"></p></div></div><br><div class="spoiler">  <b class="spoiler_title"># 5 рд╕рдорд╛рди CPU рд╕рд╛рдЭрд╛рдХрд░рдг рдХреЗ рд▓рд┐рдП рд╕рдВрддреБрд▓рд┐рдд рдкрд░реАрдХреНрд╖рдг</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/vi/cy/fe/vicyfenhzk7uvcjsiohq950c9fa.png"></p></div></div><br><div class="spoiler">  <b class="spoiler_title">рдкрд░реАрдХреНрд╖рдг # 6</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/7h/bg/ez/7hbgezb4zxuv3ijuemjmkilf110.png"></p></div></div><br><div class="spoiler">  <b class="spoiler_title">рдкрд░реАрдХреНрд╖рдг # 8</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/gq/5_/uj/gq5_uje-nnkfhlqmilb7xnbu5tc.png"></p></div></div><br><div class="spoiler">  <b class="spoiler_title">рдкрд░реАрдХреНрд╖рдг # 12</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/xa/tr/m9/xatrm9dbbaha13w9wjxzmecvxjm.png"></p></div></div><br><div class="spoiler">  <b class="spoiler_title">рдкрд░реАрдХреНрд╖рдг # 13</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/-w/9t/i8/-w9ti8atzczna-9dvepihihlyqu.png"></p></div></div><br><h1 id="problems">  рд╕рдорд╕реНрдпрд╛рдПрдВред </h1><br><p>  рд▓рд╛рд▓ рдХреЗ рд╕рд╛рде рдКрдкрд░ рдХреА рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рддред </p><br><p>  рддрдм рд╕рд░реНрд╡рд░ рдмреА рдкрд░ 224 рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рдЪрд▓рд╛рдирд╛ рдмреБрд░рд╛ рд╡рд┐рдЪрд╛рд░ рд╕рд╛рдмрд┐рдд рд╣реБрдЖ, рдХреНрдпреЛрдВрдХрд┐ рдХреНрд▓рд╛рдЗрдВрдЯ рд╕рд╛рдЗрдб рдкрд░ рд╕рд░реНрд╡рд░ рд╕реАрдкреАрдпреВ рд╕рдордп рдХреЛ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ / рдереНрд░реЗрдбреНрд╕ рдХреЗ рдмреАрдЪ рд╕рдорд╛рди рд░реВрдк рд╕реЗ рд╡рд┐рддрд░рд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдЕрд╕рдорд░реНрде рдерд╛ред  рдкрд╣рд▓реЗ 224 рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рдЬрд┐рдиреНрд╣реЛрдВрдиреЗ рдЕрдкрдиреЗ рд╕рднреА рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдП рд╣реИрдВ, рдЕрдзрд┐рдХрд╛рдВрд╢ рд╕реАрдкреАрдпреВ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рд▓реЗ рд▓рд┐рдпрд╛ рдФрд░ рдмрд╛рдХреА рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рдкрд┐рдЫрдбрд╝ рд░рд╣реЗ рд╣реИрдВред  рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдореВрд▓рд╛рдВрдХ -20 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдмрд╣реБрдд рдорджрдж рдирд╣реАрдВ рдорд┐рд▓рддреА рд╣реИ (448 рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдЗрдВрд╕реНрдЯреЗрдВрд╕, 2 рдПрд▓рдПрдкреАрдПрд╕ рдЙрджрд╛рд╣рд░рдг): </p><br><div class="spoiler">  <b class="spoiler_title">448 рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдЙрджрд╛рд╣рд░рдг</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/a2/ms/bg/a2msbgjgzuwvzzdl332linmmq98.png"><br>  рд╕рд░реНрд╡рд░ рдмреА (рдмрд╛рдИрдВ рдУрд░) рдмрд╣реБрдд рднрд╛рд░реА рднрд╛рд░ рдХреЗ рдЕрдзреАрди рд╣реИ рдФрд░ рд╕рд░реНрд╡рд░ рдП рдореЗрдВ рдЕрднреА рднреА рдореБрдлреНрдд рд╕реАрдкреАрдпреВ рд╕рдВрд╕рд╛рдзрди рд╣реИрдВред </p></div></div><br><p>  рдЗрд╕рд▓рд┐рдП рдореИрдВрдиреЗ рдЕрд▓рдЧ-рдЕрд▓рдЧ LAppS рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЛ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп <strong>рдмреЗрдВрдЪрдорд╛рд░реНрдХ</strong> .max_connections рдХреЛ рджреЛрдЧреБрдирд╛ рдХрд░ рджрд┐рдпрд╛ред </p><br><p>  рдЕрднреА рднреА 12.3 рдорд┐рд▓рд┐рдпрди рд╡реЗрдмрд╕реНрдХреЗрдЯреНрд╕ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЪрд▓ рд░рд╣реЗ рдЪрд╛рд░ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рдмрд┐рдирд╛ 5 рдПрд▓рдПрдкреАрдПрд╕ рдЙрджрд╛рд╣рд░рдг (рдкрд░реАрдХреНрд╖рдг 5 рдФрд░ 6) рд╢реБрд░реВ рдХрд░ рджрд┐рдпрд╛ рд╣реИред  рдФрд░ CFST рдХреА рднреВрдорд┐рдХрд╛ рдХреЛ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдирд┐рд▓рдВрдмрд┐рдд рдХрд░рдиреЗ рдФрд░ <em>рдорд╛рд░рдиреЗ -STOP / -Cont</em> рдпрд╛ / рдХреЗ рд╕рд╛рде рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рд╡рд╛рд▓реА рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдлрд┐рд░ рд╕реЗ рд╢реБрд░реВ рдХрд░рдиреЗ рдФрд░ рдЙрдирдХреА рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдУрдВ рдХреЛ <em>рд░рджреНрдж</em> рдХрд░рдиреЗ рдХреА рднреВрдорд┐рдХрд╛ рдирд┐рднрд╛рдИред  рдЖрдк рдЗрд╕рдХреЗ рд▓рд┐рдП рдирд┐рдореНрди рдЯреЗрдореНрдкреНрд▓реЗрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> [ 1 ]; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> -STOP &lt;4 fast-processes pids&gt; sleep 10 <span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> -CONT &lt;4 fast-processes pids&gt; sleep 5 <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br><p>  2019 рдЖрд░рдПрдЪрдИрдПрд▓ 7.6 рдореЗрдВ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИ!  рдИрдорд╛рдирджрд╛рд░реА рд╕реЗ, рдореИрдВрдиреЗ 2009 рдХреЗ рдмрд╛рдж рдкрд╣рд▓реА рдмрд╛рд░ рд░реЗрдирд┐рд╕ рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред рд╕рдмрд╕реЗ рдЦрд░рд╛рдм рдХреНрдпрд╛ рд╣реИ, - рдореИрдВрдиреЗ рдЗрд╕ рдмрд╛рд░ рд▓рдЧрднрдЧ рдЕрд╕рдлрд▓ рд░реВрдк рд╕реЗ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред </p><br><p>  рдореБрдЭреЗ рдПрдирдЖрдИрд╕реА рдХреЗ рддрд┐рддрд░-рдмрд┐рддрд░ рдЗрдВрдЬрди рдХреЗ рд╕рд╛рде рдПрдХ рд╕рдорд╕реНрдпрд╛ рдереАред  рдЗрд╕рд▓рд┐рдП рдореИрдВрдиреЗ рдЗрд╕реЗ рдХреБрдЫ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдЕрдХреНрд╖рдо рдХрд░ рджрд┐рдпрд╛, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЗрд╕ рдШрдЯрдирд╛ рдХреЛ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ред </p><br><p>  рдореБрдЭреЗ рднрд╛рд░реА рднрд╛рд░ рдФрд░ рдПрдирдЖрдИрд╕реА рдЪрд╛рд▓рдХ рдмрдЧ рдХреЗ рддрд╣рдд рдЖрдВрд╢рд┐рдХ рд▓рд┐рдВрдХ рд╡реНрдпрд╡рдзрд╛рди рдереЗ, рдЗрд╕рд▓рд┐рдП рдореБрдЭреЗ рд╕рдВрдмрдВрдзрд┐рдд рдкрд░реАрдХреНрд╖рдг рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рдЫреЛрдбрд╝рдирд╛ рдкрдбрд╝рд╛ред </p><br><h1 id="end-of-story">  рдХрд╣рд╛рдиреА рдХрд╛ рдЕрдВрдд </h1><br><p>  рдИрдорд╛рдирджрд╛рд░реА рд╕реЗ, рдкрд░реАрдХреНрд╖рдг рдореЗрд░реЗ рдЕрдиреБрдорд╛рди рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдмрд╣реБрдд рдЪрд┐рдХрдирд╛ рдЪрд▓рд╛ рдЧрдпрд╛ред </p><br><p>  рдореБрдЭреЗ рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╣реИ рдХрд┐ рдореИрдВрдиреЗ рд╕рд░реНрд╡рд░ рдП рдкрд░ рдПрд▓рдПрдкреАрдПрд╕ рдХреЛ рдЕрдкрдиреА рдкреВрд░реНрдг рдХреНрд╖рдорддрд╛ (рдПрд╕рдПрд╕рдПрд▓ рдХреЗ рдмрд┐рдирд╛) рд▓реЛрдб рдХрд░рдиреЗ рдореЗрдВ рдХрд╛рдордпрд╛рдм рдирд╣реАрдВ рдХрд┐рдпрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдореЗрд░реЗ рдкрд╛рд╕ рдХреНрд▓рд╛рдЗрдВрдЯ рдкрдХреНрд╖ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╕реАрдкреАрдпреВ рд╕рдВрд╕рд╛рдзрди рдирд╣реАрдВ рдереЗред  рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЯреАрдПрд▓рдПрд╕ 1.3 рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рдХреЗ рдмрд╛рд╡рдЬреВрдж, рд╕рд░реНрд╡рд░ рдП рдкрд░ рдПрд▓рдПрдкреАрдПрд╕ рд▓рдЧрднрдЧ рд╕рднреА рдЙрдкрд▓рдмреНрдз рд╕реАрдкреАрдпреВ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рдерд╛ред </p><br><p>  рдореБрдЭреЗ рдЕрдм рднреА рдпрдХреАрди рд╣реИ рдХрд┐ LAppS рд╡рд╣рд╛рдБ рд╕реЗ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕реНрдХреЗрд▓реЗрдмрд▓ рдФрд░ рд╕рдмрд╕реЗ рддреЗрдЬрд╝ WebSockets рдЦреБрд▓рд╛ рд╕реНрд░реЛрдд рд╕рд░реНрд╡рд░ рд╣реИ рдФрд░ <strong>Cws</strong> WebSockets рдХреНрд▓рд╛рдЗрдВрдЯ рдореЙрдбреНрдпреВрд▓ рдХреЗрд╡рд▓ рдЗрд╕рдХрд╛ рдкреНрд░рдХрд╛рд░ рд╣реИ, рдЬреЛ рдЙрдЪреНрдЪ рднрд╛рд░ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рд░реВрдкрд░реЗрдЦрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред </p><br><p>  рдХреГрдкрдпрд╛ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдкрд░ рдкрд░рд┐рдгрд╛рдо рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реЗрдВред </p><br><p>  рд╕рд▓рд╛рд╣ рдкрд░ рдзреНрдпрд╛рди рджреЗрдВ: рд▓реЛрдб рдмреИрд▓реЗрдВрд╕рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдпрд╛ рд╡реЗрдмрд╕реНрдХреЙрдлрд╝реНрдЯ рдХреЗ рд▓рд┐рдП рдкреНрд░реЙрдХреНрд╕реА-рдкрд╛рд╕ рдХреЗ рд░реВрдк рдореЗрдВ рдХрднреА рднреА рдирдВрдЧреЗрдХреНрд╕ рдпрд╛ рдЕрдкрд╛рдЪреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рди рдХрд░реЗрдВ, рдпрд╛ рдЖрдк рдкрд░рд┐рдорд╛рдг рдХреЗ рдЖрджреЗрд╢ рдкрд░ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рд╕рдорд╛рдкреНрдд рдХрд░ рджреЗрдВрдЧреЗред  рд╡реЗ WebSockets рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рдмрдиреЗ рд╣реИрдВред </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi460847/">https://habr.com/ru/post/hi460847/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi460837/index.html">рд╢реБрд░реБрдЖрдд рдкреЙрдбрдХрд╛рд╕реНрдЯ рд╣реИрдВрдбрдмреБрдХ</a></li>
<li><a href="../hi460839/index.html">рдкреНрд░реАрдбреЗрдЯрд░ рд▓реЙрдиреНрдЪ рдХрд░реЗрдВ - Precompiled Data Repositories</a></li>
<li><a href="../hi460841/index.html">рдЯреЙрдк -23 рд▓реИрдВрдЧреНрд╡реЗрдЬ рд▓рд░реНрдирд┐рдВрдЧ рдРрдкреНрд╕</a></li>
<li><a href="../hi460843/index.html">рдирдП 3CX рдХреЙрд▓ рдлреНрд▓реЛ рдбрд┐рдЬрд╝рд╛рдЗрдирд░ рдФрд░ 3CX CRM рдЯреЗрдореНрдкрд▓реЗрдЯ рдЬреЗрдирд░реЗрдЯрд░ рдХрд╛ рдкрд░рд┐рдЪрдп</a></li>
<li><a href="../hi460845/index.html">рдЖрдкрдХреЗ рдХрдВрдкреНрдпреВрдЯрд░ (рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб) рдХреЗ рдЬрдирдХ рдлрд░реНрдирд╛рдВрдбреЛ рдХреЙрд░реНрдмреЗрдЯреЛ рдХрд╛ 93 рд╡рд░реНрд╖ рдХреА рдЖрдпреБ рдореЗрдВ рдирд┐рдзрди рд╣реЛ рдЧрдпрд╛</a></li>
<li><a href="../hi460849/index.html">рднрд╛рдЧ 4. рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рд╕рдорд╛рдирд╛рдВрддрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рддрд╛рд░реНрдХрд┐рдХ рдХрд╛рд░реНрдпреЛрдВ рдХреА рдЧрдгрдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдЧреНрд░рд╛рдл рдореЙрдбрд▓</a></li>
<li><a href="../hi460851/index.html">SamsPcbGuide, рднрд╛рдЧ 10: рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА - рд▓реАрдб рдореБрдХреНрдд рдШрдЯрдХ рдорд┐рд▓рд╛рдк</a></li>
<li><a href="../hi460855/index.html">Microservices рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП PHP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВ?</a></li>
<li><a href="../hi460857/index.html">рдХреИрд╕реЗ Namecoin рдмреНрд▓реЙрдХрдЪреЗрди рд░рд┐рд╕рд░реНрдЪ рдЖрд░рдЯреАрдПрдо рд╕рд╛рдЗрдмрд░ рд╣рдорд▓реЛрдВ рдХреА рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгреА рдХреА</a></li>
<li><a href="../hi460859/index.html">ITHink # 3 рд╕рдореНрдореЗрд▓рди Kharkov рдореЗрдВ - WWDC 2019 рдкрд░ рдЖрдзрд╛рд░рд┐рдд</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>