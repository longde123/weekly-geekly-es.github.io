<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍🎨 ✴️ 🐍 Comment j'ai découvert que mon visa n'était pas prêt, un message dans Slack 🤛 🔊 👩‍❤️‍👩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Jeûne pour les vacances de mai. Il y a 6 semaines, j'ai demandé un visa pour l'Irlande. Le départ est prévu pour le 30 avril. Il existe un site Web de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment j'ai découvert que mon visa n'était pas prêt, un message dans Slack</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/newprolab/blog/450060/"><p>  Jeûne pour les vacances de mai.  Il y a 6 semaines, j'ai demandé un visa pour l'Irlande.  Le départ est prévu pour le 30 avril.  Il existe un site Web de l'ambassade <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur lequel des listes</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">décisions en</a> matière de visas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sont publiées</a> .  Ils le font les lundis et jeudis.  Et me voilà assis le dimanche 28 avril, il n'y a toujours pas de solution pour mon visa.  Et mes autres actions lundi dépendront de si ma déclaration figurera ou non dans le nouveau rapport.  Sinon, vous devrez vous rendre à l'ambassade et faire le tri.  Si c'est le cas, tirez sur le centre des visas.  Laisser et mettre à jour la page toute la journée de lundi semblait être un passe-temps ennuyeux, j'ai donc écrit un script Python. </p><br><p><img src="https://habrastorage.org/webt/gz/a6/ec/gza6ecxqgxhhjcyjbyho7h3nd-a.jpeg"></p><br><p>  Clause de non-responsabilité.  Je ne suis pas programmeur, mais je peux programmer.  Cela signifie que je ne peux pas écrire de code élégant et efficace, mais je peux faire en sorte que cet orgue de Barbarie fasse ce dont j'ai besoin. </p><a name="habracut"></a><br><h3 id="1-proverka-stranicy-na-nalichie-novogo-otcheta">  1. Vérification de la page pour un nouveau rapport </h3><br><p>  Alors, que faut-il faire: </p><br><ol><li>  Vous devez analyser cette page. </li><li> Trouvez parmi les rapports un nouveau par une nouvelle date (dans mon cas, vous pouvez rechercher par le mot <code>24 April</code> ). </li><li>  Obtenez un lien vers ce rapport. </li></ol><br><p>  Le code de fonction est le suivant: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_report</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(url, div_class, date)</span></span></span><span class="hljs-function">:</span></span> embassy_page = requests.get(url) page_text = BeautifulSoup(embassy.text, <span class="hljs-string"><span class="hljs-string">'lxml'</span></span>) tags = page_text.findAll(<span class="hljs-string"><span class="hljs-string">'div'</span></span>, {<span class="hljs-string"><span class="hljs-string">"class"</span></span>: div_class}) text = <span class="hljs-string"><span class="hljs-string">''</span></span> report_url = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> tag <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tags: tag_soup = BeautifulSoup(tag.text, <span class="hljs-string"><span class="hljs-string">'lxml'</span></span>) report = s(text=re.compile(date)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(report) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>: text = <span class="hljs-string"><span class="hljs-string">'New report published'</span></span> report_url = <span class="hljs-string"><span class="hljs-string">'https://www.dfa.ie'</span></span> + tag.find(<span class="hljs-string"><span class="hljs-string">'a'</span></span>).attrs[<span class="hljs-string"><span class="hljs-string">'href'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text, report_url</code> </pre> <br><p>  Maintenant, plus sur ce qui se passe dans ce code. </p><br><p>  Tout d'abord, nous utilisons la bibliothèque de <code>requests</code> , qui nous aide à télécharger la page requise.  Ensuite, nous utilisons une autre bibliothèque <code>BeautifulSoup</code> , qui aide à transformer cette mise en page sauvage en une apparence plus belle et plus pratique. </p><br><p>  Avant d'utiliser <code>BeautifulSoup</code> : </p><br><pre> <code class="html hljs xml">'<span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span>\r\n\r\n<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span>\r\n <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span>\r\n <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">META</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"X-UA-Compatible"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"IE=edge"</span></span></span><span class="hljs-tag">&gt;</span></span>\r\n <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span>\t\r\n\t<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"viewport"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"initial-scale=1"</span></span></span><span class="hljs-tag">&gt;</span></span>\r\n \r\n \r\n \r\n \r\n \r\n <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Static Meta data --&gt;</span></span>\r\n \r\n\t<span class="hljs-comment"><span class="hljs-comment">&lt;!-- &lt;meta name="DC.Creator" content="Department of Foreign Affairs" /&gt;\r\n\t&lt;meta name="DC.Publisher" content="Department of Foreign Affairs" /&gt; \r\n\t&lt;meta name="DC.Format" content="text/xhtml" /&gt; \r\n\t&lt;meta name="DC.Copyright" content="All material (c) copyright 2012 Department of Foreign Affairs" /&gt; \r\n\t&lt;meta name="DC.Source" content="Department of Foreign Affairs" /&gt; \r\n\t&lt;meta name="DC.Language" content="en" /&gt;\r\n\t&lt;meta name="DC.Author" content="Department of Foreign Affairs" /&gt; --&gt;</span></span>\r\n\r\n\r\n<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"author"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Department of Foreign Affairs"</span></span></span><span class="hljs-tag">&gt;</span></span>\r\n<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"google-site-verification"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HHtulupgM8GXpd9YYDjoXUb6MiU7_mGTkHixUrVPFYQ"</span></span></span><span class="hljs-tag"> /&gt;</span></span>\r\n \r\n\t<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Weekly Decision Report - Department of Foreign Affairs and Trade<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>\r\n <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> /&gt;</span></span> \r\n <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">media</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"screen"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/media/dfa-2017/style-assets/css/font-defs.css"</span></span></span><span class="hljs-tag"> /&gt;</span></span>\t<span class="hljs-comment"><span class="hljs-comment">&lt;!-- 2017 font-defs.css --&gt;</span></span> \r\n\t<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">media</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"screen"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/media/dfa-2017/style-assets/css/style.css"</span></span></span><span class="hljs-tag"> /&gt;</span></span>\t<span class="hljs-comment"><span class="hljs-comment">&lt;!-- 2017 style.css --&gt;</span></span>\r\n <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">media</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"print"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/media/dfa-2017/style-assets/css/print.css"</span></span></span><span class="hljs-tag"> /&gt;</span></span>\t<span class="hljs-comment"><span class="hljs-comment">&lt;!-- 2017 print.css --&gt;</span></span>\r\n</code> </pre> <br><p>  Après: </p><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"IE=edge"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"X-UA-Compatible"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=utf-8"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"initial-scale=1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"viewport"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Static Meta data --&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- &lt;meta name="DC.Creator" content="Department of Foreign Affairs" /&gt; &lt;meta name="DC.Publisher" content="Department of Foreign Affairs" /&gt; &lt;meta name="DC.Format" content="text/xhtml" /&gt; &lt;meta name="DC.Copyright" content="All material (c) copyright 2012 Department of Foreign Affairs" /&gt; &lt;meta name="DC.Source" content="Department of Foreign Affairs" /&gt; &lt;meta name="DC.Language" content="en" /&gt; &lt;meta name="DC.Author" content="Department of Foreign Affairs" /&gt; --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Department of Foreign Affairs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"author"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HHtulupgM8GXpd9YYDjoXUb6MiU7_mGTkHixUrVPFYQ"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"google-site-verification"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Weekly Decision Report - Department of Foreign Affairs and Trade<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/media/dfa-2017/style-assets/css/font-defs.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">media</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"screen"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- 2017 font-defs.css --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/media/dfa-2017/style-assets/css/style.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">media</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"screen"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- 2017 style.css --&gt;</span></span></code> </pre> <br><p>  Maintenant, vous pouvez en quelque sorte vivre et travailler avec cela.  En particulier, dans mon cas, nous rechercherons une <code>div class</code> spéciale utilisée pour les liens vers les rapports.  Nous le voyons dans le code source de la page: <code>&lt;div class="gen-content-landing__block"&gt;</code> .  Dans mon code, nous recherchons toutes ces balises. </p><br><p>  Ensuite, parcourez les balises collectées et recherchez celle qui contient la date du nouveau rapport: <code>24 April</code> .  Si un tel résultat est trouvé, nous en extrayons le lien et formons le texte qu'un nouveau rapport a été publié. </p><br><h3 id="2-poisk-id-vizy-v-novom-otchete">  2. Recherchez un identifiant de visa dans un nouveau rapport </h3><br><p>  Alors, que faut-il faire maintenant ici: </p><br><ol><li>  Téléchargez ce nouveau rapport. </li><li>  Analyse le fichier pdf. </li><li>  Trouvez mon id dedans. </li><li>  Trouvez le statut qui lui correspond. </li></ol><br><p>  Le code de fonction est le suivant: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_visa</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(report_url, filename, visa_id, text)</span></span></span><span class="hljs-function">:</span></span> pdf = requests.get(report_url) file_path = Path(filename) file_path.write_bytes(pdf.content) pdfFileObj = open(filename, <span class="hljs-string"><span class="hljs-string">'rb'</span></span>) pdfReader = PyPDF2.PdfFileReader(pdfFileObj, strict=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> pageNum <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, pdfReader.numPages): page = str(pdfReader.getPage(pageNum).extractText().encode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)).split(<span class="hljs-string"><span class="hljs-string">'\\n'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> visa_id <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> page: visa_index = page.index(visa_id) status = page[visa_index + <span class="hljs-number"><span class="hljs-number">1</span></span>] text = text + <span class="hljs-string"><span class="hljs-string">'\t'</span></span> + visa_id + <span class="hljs-string"><span class="hljs-string">'\t'</span></span> + status <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text</code> </pre> <br><p>  En utilisant à nouveau la bibliothèque de <code>requests</code> , nous faisons une demande à ce rapport.  Ensuite, enregistrez-le localement.  En utilisant la bibliothèque <code>PyPDF2</code> , <code>PyPDF2</code> lisons le fichier.  Après cela, nous trions ses pages et recherchons <code>visa_id</code> dans le tableau des jetons.  Le balisage de ce fichier pdf est tel que le jeton suivant après <code>visa_id</code> est le statut d' <code>visa_id</code> directement: <code>Approved</code> ou <code>Refused</code> .  Ensuite, nous concaténons le texte existant avec id et status. </p><br><h3 id="3-otpravka-statusa-soobscheniem-v-slack">  3. Envoi d'un message d'état dans Slack </h3><br><p>  Bon.  Le script a trouvé, disons, mon identifiant, mais vous devez m'en informer quelque part.  Dans notre entreprise, nous utilisons Slack comme messager, j'ai donc pensé qu'il serait pratique pour moi de recevoir une notification. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ce lien</a> vous permet de configurer votre webhook.  Vous pouvez y sélectionner le canal ou le destinataire auquel envoyer le message (il peut être nécessaire d'être un administrateur WorkSpace pour cette étape).  Là, vous recevrez une URL unique pour webhook, qui peut être utilisée dans le code. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_to_slack</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(webhook_url, text)</span></span></span><span class="hljs-function">:</span></span> post = {<span class="hljs-string"><span class="hljs-string">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"{0}"</span></span>.format(text)} json_data = json.dumps(post) req = requests.post(webhook_url, data=json_data.encode(<span class="hljs-string"><span class="hljs-string">'ascii'</span></span>), headers={<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'application/json'</span></span>}) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> req.status_code</code> </pre> <br><p>  En utilisant la même bibliothèque de <code>requests</code> , nous faisons une requête POST avec le contenu du <code>text</code> sur webhook. </p><br><h3 id="4-ispolzovanie-funkciy">  4. Utilisation des fonctions </h3><br><p>  Le reste du code ressemble à ceci: </p><br><pre> <code class="python hljs">url = <span class="hljs-string"><span class="hljs-string">'https://www.dfa.ie/irish-embassy/russia/visas/weekly-decision-report/'</span></span> div_class = <span class="hljs-string"><span class="hljs-string">'gen-content-landing__block'</span></span> date = <span class="hljs-string"><span class="hljs-string">'24 April'</span></span> filename = <span class="hljs-string"><span class="hljs-string">'weekly_report.pdf'</span></span> visa_id = <span class="hljs-string"><span class="hljs-string">'38644112'</span></span> webhook_url = <span class="hljs-string"><span class="hljs-string">'https://hooks.slack.com/services/...'</span></span> text, report_url = check_report(url, div_class, date) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> text != <span class="hljs-string"><span class="hljs-string">''</span></span>: text = check_visa(report_url, filename, visa_id, text) print(send_to_slack(webhook_url, text))</code> </pre> <br><p>  Nous attribuons des valeurs à toutes les variables nécessaires, puis exécutons les fonctions prescrites. </p><br><h3 id="5-zapusk-po-planu">  5. Lancement selon le plan </h3><br><p>  Ok  J'ai écrit un script, mais si je dois le tirer moi-même à chaque fois, je ne suis pas loin de la situation initiale, où je devrais m'asseoir et mettre à jour la page. </p><br><pre> <code class="bash hljs">$ crontab -e</code> </pre> <br><p>  Ajout d'une ligne: </p><br><pre> <code class="plaintext hljs">*/10 * * * * python3 /home/ubuntu/embassy.py &gt;/dev/null 2&gt;&amp;1</code> </pre> <br><p>  Je pensais que cela me suffit si ce script est exécuté toutes les 10 minutes par cron sur un serveur avec ubuntu. </p><br><h3 id="6-zaklyuchenie">  6. Conclusion </h3><br><p>  À 11 h 50, j'ai reçu un message selon lequel un nouveau rapport était apparu, mais mon visa n'y était pas ... Après cela, je suis allé à l'ambassade.  Il l'a pris d'assaut (ils n'ont pas répondu aux lettres et aux appels pendant plusieurs semaines) et ont donc reçu son passeport avec un visa. </p><br><p>  En général, la compétence en programmation est importante dans le monde moderne, même si vous n'êtes pas programmeur.  Il vous permet d'automatiser certaines de vos opérations de routine, ce qui rend votre monde un peu plus pratique.  En fait, on pourrait même organiser cela dans un service séparé, où une personne entre simplement son identifiant et son e-mail, et il reçoit un message sur la préparation d'un visa à envoyer. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr450060/">https://habr.com/ru/post/fr450060/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr450048/index.html">Commentaires sur les modifications de la loi fédérale n ° 149-ФЗ «sur l'information, les technologies de l'information et la protection de l'information»</a></li>
<li><a href="../fr450050/index.html">Les bases de la programmation réactive à l'aide de RxJS. Partie 3. Observables d'ordre supérieur</a></li>
<li><a href="../fr450054/index.html">Pirater le jeton JWT</a></li>
<li><a href="../fr450056/index.html">Faites attention # 2: Recueil d'articles sur la réflexion sur les produits, la psychologie du comportement et la productivité personnelle</a></li>
<li><a href="../fr450058/index.html">Le CV de ce mec</a></li>
<li><a href="../fr450062/index.html">Rétablir la circulation cérébrale quelques heures après la mort</a></li>
<li><a href="../fr450064/index.html">Microsoft Build 2019 - diffusion en direct en russe</a></li>
<li><a href="../fr450066/index.html">Test: Comment respectez-vous les exigences relatives au traitement des données personnelles?</a></li>
<li><a href="../fr450068/index.html">Comment la technologie manipule votre esprit: l'apparence d'un illusionniste et expert en éthique du design Google</a></li>
<li><a href="../fr450070/index.html">60 millions de champs et 27 cultures. Comment nous avons fait une carte de tous les domaines de l'Europe et des USA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>