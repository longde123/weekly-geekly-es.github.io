<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•™ üîà üë®üèΩ‚Äçü§ù‚Äçüë®üèº Kundenidentifikation auf Websites ohne Passw√∂rter und Cookies: Anwendung f√ºr Standard üê¨ üë©‚Äç‚úàÔ∏è ü§ûüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lieber Habrozhitel! Sehr geehrte Experten! Ich pr√§sentiere f√ºr Ihre Einsch√§tzung ein neues Konzept der Benutzeridentifikation auf Websites, das mit Ih...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kundenidentifikation auf Websites ohne Passw√∂rter und Cookies: Anwendung f√ºr Standard</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472310/"><img src="https://habrastorage.org/webt/zx/gv/lz/zxgvlzpzrabaux0m9y-brjkhhpi.jpeg" alt="Bild"><br><br>  Lieber Habrozhitel!  Sehr geehrte Experten!  Ich pr√§sentiere f√ºr Ihre Einsch√§tzung ein neues Konzept der Benutzeridentifikation auf Websites, das mit Ihrer Hilfe hoffentlich zu einem offenen Internetstandard wird und diese Internetwelt ein wenig besser macht.  Dies ist eine Entwurfsversion des kennwortlosen Authentifizierungsprotokolls, die als kostenloser Artikel konzipiert wurde.  Und wenn die zugrunde liegende Idee von Ihnen, lieber Leser, positiv bewertet wird, werde ich sie weiterhin auf reddit.com und rfc-editor.org ver√∂ffentlichen.  Und ich hoffe, dass ich Entwickler f√ºhrender Browser f√ºr deren Implementierung interessieren kann.  Deshalb erwarte ich von Ihnen konstruktive Kritik. <br><br>  Achtung: viel Text. <br><br><a name="habracut"></a><br>  Die Frage ist also.  Ist es m√∂glich, Website-Besucher eindeutig zu identifizieren, ohne ihre pers√∂nlichen Daten preiszugeben und zwischen verschiedenen Websites zu verfolgen?  Ist es m√∂glich, bei der L√∂sung eines solchen Problems die primitivste Form der Autorisierung durch Login / Passwort vollst√§ndig aufzugeben und Cookie / localStorage zu verwenden? <br><br>  Einerseits m√ºssen Websites einen Kunden erkennen, um beispielsweise seine Einstellungen, den Warenkorb, Anzeigen, Artikel usw. ‚Äûwiederherzustellen‚Äú.  Auf der anderen Seite m√∂chten Besucher so anonym wie m√∂glich bleiben, ohne ihre pers√∂nlichen Daten preiszugeben und zu verhindern, dass Websites von Drittanbietern sie verfolgen.  Und letztere k√∂nnen dies tun, indem sie die gesammelten Daten untereinander austauschen. <br><br>  Es klingt nach einer Aufgabe, daf√ºr zu sorgen, dass die W√∂lfe voll und die Schafe in Sicherheit sind.  Ist das echt? <br><br>  Ich denke bis zu einem gewissen Grad - wirklich. <br><br><h1>  Inhaltsverzeichnis </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1 Passwortloses Authentifizierungskonzept</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.1 Schl√ºssel und Token anstelle von Anmeldungen und Passw√∂rtern</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.2 Token-Struktur</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/472310/&amp;usg=ALkJrhiM0KZg0f4LAniBTiC_9H6-o1bXtw#">1.3 HTTP-Protokoll-Header</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.4 Wie identifizieren Kunden Websites?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.4.2 Woher wei√ü ich, ob eine Site dieses Protokoll unterst√ºtzt?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.5 Wie autorisieren Kunden Websites?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.6 Wie implementiere ich eine zuverl√§ssige Kundenidentifikation?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.7 Autorisierung auf der Website durch die Augen des Benutzers</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.8 Wie √§ndert sich ein Site-Schl√ºssel?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.9 Wie wird die dom√§nen√ºbergreifende Autorisierung implementiert?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.10 Wie implementiere ich eine dom√§nen√ºbergreifende Authentifizierung?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.11 Kontomobilit√§t</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2 Technische Beschreibung des Protokolls</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2.0 Algorithmus zur Generierung von Dom√§nenschl√ºsseln</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2.1 der Algorithmus zur Berechnung des Quell-Tokens</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2.2 Token-Schutzalgorithmus w√§hrend der √úbertragung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2.3 Salzaustauschverfahren zwischen Browser und Server</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2.4 Regeln f√ºr die Bildung des Kontextfeldes</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2.5 Regeln zum Definieren von Absender- und Empf√§ngerfeldern</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2.6 Details zu Kontextdefinitionstabellen</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2.7 Protokollszenarien</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2.8 Token auf dem Server verarbeiten</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2.9 Dom√§nen√ºbergreifende Authentifizierung</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">3 Sicherheitsempfehlungen</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">3.1 Schutz der Schl√ºsselinformationen vor unbefugtem Zugriff</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">3.2 Informationen zu Passw√∂rtern als Dom√§nenschl√ºssel</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">3.3 Risiken des Verlusts / der Gef√§hrdung von Schl√ºsseln und ihrer Minimierung</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4 Angriffe auf das Autorisierungsschema</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4.1 Benutzerverfolgung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4.2 XSS-Angriff</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4.3 CSRF-Angriff</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4.4 Tracking mit SSO</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4.5 Schl√ºsselkompromiss f√ºr SSO</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4.6 Token-Kompromiss w√§hrend der √úbertragung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4.7 Eine Website hacken und Token kompromittieren</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fazit</a> <br><br><br><div class="spoiler">  <b class="spoiler_title">Was ist los mit Passw√∂rtern?</b> <div class="spoiler_text">  Ja, das ist nicht so.  Sie k√∂nnen verloren gehen.  Sie k√∂nnen gestohlen werden.  Sie m√ºssen in Erinnerung bleiben.  Wie auch immer, warum bin ich verpflichtet, eine Registrierungsform auszuf√ºllen und ein anderes Passwort einzugeben, um das Wetter zu sehen oder diese Datei herunterzuladen?  Schlie√ülich sind Passw√∂rter etwas weniger als viele.  Wie viele Websites Sie m√∂gen, so viele Passw√∂rter.  Und deshalb verwenden viele tats√§chlich ein Passwort auf allen Websites.  Jemand benutzt einen kniffligen Algorithmus, um sich an sie zu erinnern.  Oder ein Passwort-Manager.  Oder dumm ein Notizbuch.  Oder bevorzugen Sie die dom√§nen√ºbergreifende Authentifizierung: Sie melden sich einmal an einer Site an und fertig!  Ja, nicht alle.  Dies ist der Fall, wenn die Site dies unterst√ºtzt. <br>  Alle diese Ans√§tze haben Nachteile. <br>  Verwenden Sie ein Passwort auf verschiedenen Websites - Moveton.  Was zwei Menschen wissen, wei√ü auch das Schwein.  Nicht alle Websites (auch gro√üe und seri√∂se) erf√ºllen ehrlich die Sicherheitsregeln f√ºr die Speicherung Ihrer Passw√∂rter.  Einige Websites speichern Kennw√∂rter in offener Form, w√§hrend andere der Meinung sind, dass das Speichern von Kennwort-Hashes sie bereits ausreichend sch√ºtzt.  Infolgedessen treten regelm√§√üig Lecks von Passw√∂rtern und anderen pers√∂nlichen Daten von Kunden auf. <br>  Mit dem Passwort-Manager ist das schon besser.  Es stimmt, niemand garantiert Ihnen, dass Ihre Passw√∂rter nicht irgendwo zusammengef√ºhrt werden.  Suchen Sie sich einen Manager, der Ihre Konten auf allen Ger√§ten (Heimnetzwerk, Telefon, Arbeitscomputer) synchronisieren kann.  Ich schlie√üe nicht aus, dass es solche gibt. <br>  Aber auf jeden Fall die Idee: Registrieren Sie sich zuerst auf unserer Website (senden Sie gleichzeitig eine E-Mail, senden Sie ein Handy, spenden Sie Blut f√ºr die Analyse), erfinden Sie dann Ihren Benutzernamen und Ihr Passwort und merken Sie sich diese, aber halten Sie sie geheim - Ann√§herung, ich sage dir, so lala.  Und kein einziger Passwort-Manager wird es l√∂sen.  Aber es l√∂st die <abbr title="Single Sign-On-Technologie, die von verschiedenen Protokollen wie SAML, OAuth und Kerberos implementiert wird">SSO</abbr> . <br>  Das ist nur Pech: Wenn Sie das Passwort von der SSO-Site verlieren und es vergessen oder es Ihnen gestohlen wurde ... Sie verlieren den Zugriff von allen Ihren Sites auf einmal oder geben es freiwillig an Dritte weiter und es ist nicht klar, mit welchen Absichten.  <b>Lagern Sie nicht alle Eier in einem Korb!</b> <br>  Und es ist keine Tatsache, dass die SSO-Site zuverl√§ssig ist.  Oder speichert Ihre Passw√∂rter nicht im Klartext.  Oder sie werden nicht freiwillig zusammengef√ºhrt, und es bietet anderen die M√∂glichkeit, Sie zwischen Websites zu verfolgen.  Nun, du verstehst, worum es geht. <br>  Deshalb: Login + Passwort = b√∂se.  Und all das B√∂se auf der Welt sollte ernsthaft und f√ºr lange Zeit getrunken werden.  Und ein Keks auch.  Zusammen mit seiner Sitzung Krokodile PHPSESSIONID, JSESSIONID und ihre Analoga. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Und was tun?</b> <div class="spoiler_text">  Zuerst m√ºssen Sie typische Situationen betrachten, aus denen klar wird: Warum m√∂chten Websites sich an ihre Kunden erinnern und ist dies f√ºr sie wirklich notwendig? <br><ol><li>  Pers√∂nlicher Blog "Vasya Pupkina", in dem zum Beispiel Kommentare erlaubt sind.  Eine Registrierung ist nur erforderlich, um sich vor Bots zu sch√ºtzen, kostenlose Abstimmungen durchzuf√ºhren, "Likes" und andere "Miau-Miau" zu z√§hlen und Kommentatoren eine Bewertung zuzuweisen.  Das hei√üt,  Hier <b>wird die Tracking-Funktionalit√§t ausschlie√ülich von der Site</b> und nur in geringem Umfang ben√∂tigt - vom Benutzer (wenn er seine "Kommentator" -Bewertung auf dieser Site bewertet). </li><li>  Websites von sozialen Netzwerken und anderen Internet-Sprechern (ICQ, Skype - auch dort).  Eine Registrierung ist erforderlich, um benannte (Autoren-) Inhalte zu implementieren und Besucher untereinander zu identifizieren.  Das hei√üt,  Hier <b>wird die Identifikationsfunktionalit√§t von den Benutzern selbst in gr√∂√üerem Umfang ben√∂tigt</b> .  Obwohl die Websites sozialer Netzwerke die ersten in der Liste der "S√ºnder" sind, sammeln sie die vollst√§ndigsten Informationen √ºber Besucher und erinnern sich ernsthaft und lange an Sie.  Es ist also noch nicht bekannt, wer mehr Identifikation ben√∂tigt. </li><li>  Unternehmensseite mit geschlossenen Inhalten.  Die Registrierung oder Autorisierung hier ist haupts√§chlich erforderlich, um den Zugriff auf Inhalte einzuschr√§nken.  Alle Arten von: Online-Schulen, Bibliotheken, private nicht √∂ffentliche Websites und so weiter.  Hier <b>wird die Autorisierungsfunktionalit√§t von der Site in gr√∂√üerem Umfang ben√∂tigt</b> .  In der Regel gibt es keine offenen Anmeldeformulare.  Anmeldeinformationen werden √ºber andere Kan√§le geteilt. </li><li>  Ein Online-Shop und eine √§hnliche Plattform, auf der Artikel, Dienstleistungen oder Inhalte verkauft werden.  Ich werde auch kostenpflichtige / kostenlose Kleinanzeigen-Websites einschlie√üen.  Die Registrierung ist haupts√§chlich erforderlich, um den Verlauf von Kundenbestellungen zu speichern und um den aktuellen Status zu verfolgen und deren Einstellungen (Favoriten) zu speichern.  um pers√∂nliche Angebote f√ºr den Kunden basierend auf der Kaufhistorie und den Vorlieben zu formulieren.  Hier <b>ist die Identifikationsfunktion sowohl f√ºr den Kunden als auch f√ºr das Gesch√§ft gleicherma√üen notwendig</b> .  Aber nat√ºrlich mehr zum Laden.  D√§mpfen, d√§mpfen und d√§mpfen. </li><li>  Alle pers√∂nlichen Konten von Nutzern von Internetdiensten: E-Mail, √∂ffentliche Dienste, Sberbank-Online, Megaphon-Online, B√ºros von Anbietern, CMS von Hostern usw.  Hier <b>ist der Benutzer selbst in erster Linie an der korrekten und zuverl√§ssigen Identifizierung interessiert</b> .  Schlie√ülich verwaltet er Informationen, die f√ºr ihn selbst von Bedeutung sind und in einigen Situationen rechtliche und finanzielle Konsequenzen haben.  Es riecht nicht nach Anonymit√§t.  Sie ist hier sch√§dlich. </li><li>  Router, Verwaltungskonsolen, Webversionen zum Verwalten von Objekten in Ihrem Heim- oder Unternehmensnetzwerk. </li></ol><br><br>  Es ist klar, dass in verschiedenen Situationen unterschiedliche Risiken bestehen k√∂nnen.  In einigen F√§llen f√ºhrt eine falsche Identifizierung, der Verlust von Authentifizierungsdaten oder sogar deren Diebstahl / F√§lschung zu keinen wesentlichen Konsequenzen f√ºr die Website oder den Benutzer.  In anderen F√§llen wird es nur unangenehm sein (ich habe Karma bei Habr√© verloren - "es ist eine Katastrophe ...") oder zu Unannehmlichkeiten f√ºhren (ich kann mich in Yula nicht unterkriegen, meine Anzeigen sehen; ich habe den Zugang zu meinen Projekten auf Github profiliert - okay neues Konto, Gabelprojekte).  Drittens kann dies rechtliche und finanzielle Konsequenzen haben.  Daher muss davon ausgegangen werden, dass das vorgeschlagene Genehmigungsschema nicht in allen F√§llen eine ‚ÄûSilberkugel‚Äú ist, insbesondere nicht ‚Äûnackt‚Äú.  <b>Wenn vertrauliche Informationen verwaltet werden, lohnt es sich, andere Methoden zur Identifizierung und Authentifizierung</b> oder deren Kombination zu verwenden (Zwei-Faktor-Authentifizierung, Kryptografie mit asymmetrischen Schl√ºsseln, 3D-sicher, eToken, OTP-Token usw.). <br><br>  Gut.  Was ist deine TK? <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Was bietet das neue Protokoll?</b> <div class="spoiler_text">  Aus Sicht des Endbenutzers: <br><ol><li>  Die Site sollte den Besucher ohne Eingaben des Benutzers speichern und erkennen.  Die Site sollte Sie sowohl innerhalb der Sitzung als auch zwischen verschiedenen Sitzungen erkennen.  Keine Cookies, Passw√∂rter oder Registrierungen.  Gleichzeitig sollten verschiedene Websites nicht in der Lage sein <i>,</i> denselben Besucher eindeutig zu identifizieren und ihre Aktivit√§ten auf diesen und anderen Websites zu verfolgen.  Das hei√üt,  Websites sollten nicht in der Lage sein, Informationen f√ºr ihre Besucher zu sammeln. </li><li>  Der Benutzer sollte jederzeit in der Lage sein, " <b>jede Site</b> zu <b>vergessen</b> ".  und die Seite wird den Benutzer vergessen.  Es sollte die M√∂glichkeit bestehen, der Site auf Initiative des Kunden Rechte zu gew√§hren, um sich an den Kunden zu erinnern (ohne zwanghaftes Popup).  Der Benutzer sollte in der Lage sein, seine virtuelle Identit√§t sicher zwischen verschiedenen Ger√§ten und Browsern zu migrieren (falls erforderlich), um eine einzige Autorisierung f√ºr seine bevorzugten Websites zu erhalten. </li></ol><br><br>  Ich verstehe.  Und welche Boni sollten Website-Entwickler davon erhalten? <br><ol><li>  Ein einfacheres Identifikationsverfahren: Es ist nicht erforderlich, zum tausendsten Mal die n√§chste Form der Anmeldung, Abmeldung, Registrierung, √Ñnderung und Kennwortwiederherstellung zu erstellen.  Es reicht aus, das Protokollunterst√ºtzungsmodul f√ºr Ihr bevorzugtes Framework zu aktivieren, das auf der Grundlage des Standards implementiert wurde. </li><li>  Ein Designer muss kein Anmeldeformular zeichnen und √ºberlegen, wo er es auf einem kleinen mobilen Bildschirm ausblenden soll.  Das Protokoll macht Formulare √ºberhaupt unn√∂tig.  Nun, au√üer dass das Anmeldeformular.  Wo ist es dann ohne sie?  Leider. </li></ol><br><br>  Endlich: <br><ol><li>  Das Authentifizierungsprotokoll muss einheitlich und standardisiert sein.  Von Sicherheitsexperten √ºberpr√ºft  Genehmigt und empfohlen von Webstandardisierungsaussch√ºssen.  Infolgedessen besteht die M√∂glichkeit, dass Webmaster klassische Fehler machen, wenn sie Standard-Anmelde- / Abmeldeformulare entwickeln, Kennw√∂rter √§ndern / wiederherstellen (√úbertragen von Kennw√∂rtern in klarer Form, falsche Verwendung von Hashing, Speichern von Kennw√∂rtern oder ‚Äûnicht gesalzenen‚Äú Hashes in der Datenbank, Entf√ºhren von Benutzerkennw√∂rtern, wenn Hacking-Site). </li><li>  Die Autorisierung sollte bis zu einem gewissen Grad zuverl√§ssig sein (vor F√§lschungen, unbefugtem Zugriff und garantierter Authentifizierung gesch√ºtzt).  Erstellen Sie keine neuen Sicherheitsl√ºcken auf Webseiten und Browsern.  Reduzieren Sie nach M√∂glichkeit das Risiko bekannter Netzwerkangriffe sofort.  Nun, oder zumindest eine signifikante Reduzierung der Risiken ihrer erfolgreichen Implementierung. </li></ol><br><br>  Basierend auf diesen Anforderungen wenden wir uns dem interessantesten zu: dem Entwerfen eines neuen Protokolls. <br></div></div><br><br><a name="part1"></a><h1>  1 Passwortloses Authentifizierungskonzept </h1><br><br><a name="tokens_vs_passwords"></a><h2>  1.1 Schl√ºssel und Token anstelle von Anmeldungen und Passw√∂rtern </h2><br>  F√ºr jede Dom√§ne, einschlie√ülich untergeordneter Dom√§nen, generiert der Client-Browser zuf√§llig einen eindeutigen 256-Bit-Schl√ºssel <math></math><img src="https://habrastorage.org/getpro/habr/formulas/8b1/9d8/49a/8b19d849a66473b36d68c78d06462129.svg" alt="$ K $" data-tex="inline">  .  <b>Dieser Schl√ºssel wird niemals √ºbertragen.</b>  Bleibt innerhalb der Benutzersitzung konstant.  Jede neue Sitzung erstellt einen neuen Schl√ºssel. <br>  Schl√ºsselbasiert <math></math><img src="https://habrastorage.org/getpro/habr/formulas/8b1/9d8/49a/8b19d849a66473b36d68c78d06462129.svg" alt="$ K $" data-tex="inline">  Der Browser generiert mithilfe eines <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">speziellen Algorithmus</a> ein 256-Bit <sup>*</sup> -Token <math></math><img src="https://habrastorage.org/getpro/habr/formulas/175/f98/839/175f98839ab732db76d5f20cd6ce2ce9.svg" alt="$ T $" data-tex="inline">  um den Benutzer mit einer bestimmten Domain zu identifizieren.  Identifikations-Token <math></math><img src="https://habrastorage.org/getpro/habr/formulas/175/f98/839/175f98839ab732db76d5f20cd6ce2ce9.svg" alt="$ T $" data-tex="inline">  Der Benutzer (im Folgenden einfach als Token bezeichnet) dient als Ersatz f√ºr Sitzungscookies wie PHPSESSIONID und JSESSIONID. <br>  Schl√ºssel <math></math><img src="https://habrastorage.org/getpro/habr/formulas/8b1/9d8/49a/8b19d849a66473b36d68c78d06462129.svg" alt="$ K $" data-tex="inline">  kann vom Benutzer " <b>repariert</b> " werden.  Durch das Fixieren des Schl√ºssels kann der Benutzer unbegrenzt in verschiedenen Browsersitzungen auf der Site autorisiert bleiben und die zuvor vorhandene Autorisierung zur√ºckgeben.  Dies ist <b>ein Analogon zur Funktion ‚ÄûErinnere dich an mich‚Äú</b> . <br>  Wenn das Festschreiben abgebrochen wird, "vergisst" der Browser diesen Schl√ºssel und beginnt erneut, f√ºr jede neue Sitzung (ab der aktuellen Sitzung) einen zuf√§lligen Schl√ºssel f√ºr diese Dom√§ne zu generieren <b>, der</b> dem <b>"Beenden" des</b> Benutzers von der Site entspricht.  Die Ausgabe erfolgt sofort und erfordert kein erneutes Laden der Seite. <br>  Der Benutzer kann <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einen permanenten Schl√ºssel f√ºr die Dom√§ne erstellen</a> .  Mit dem permanenten und dem festen Schl√ºssel kann der Benutzer die vorherige Autorisierung zur√ºckgeben.  Tats√§chlich wird dieser <b>Schl√ºssel ein Ersatz f√ºr die Login-Passwort-Verbindung.</b> <br>  Der Benutzer hat die M√∂glichkeit zu steuern, wann und wann der Browser f√ºr die Domain einen konstanten Schl√ºssel verwendet.  Dies ist <b>ein Analogon zur Login / Logout-Funktion</b> .  Das Konzept <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ist in den folgenden Screenshots dargestellt</a> . <br>  Methoden zum Generieren persistenter Dom√§nenschl√ºssel erm√∂glichen die Mobilit√§t von Benutzerkonten zwischen verschiedenen Ger√§ten.  Das Protokoll definiert Folgendes: <br><ul><li>  Generierung eines Dom√§nenschl√ºssels basierend auf einem Benutzerhauptschl√ºssel </li><li>  Individuelles Bilden eines Dom√§nenschl√ºssels basierend auf einem biologischen Zufallszahlensensor </li><li>  Importieren vorhandener Schl√ºssel aus einer Schl√ºsseldatei von einem anderen Ger√§t </li></ul><br><br><a name="token_structure"></a><h2>  1.2 Token-Struktur </h2><br>  Das Token ist eine 256-Bit-Struktur, die als hexadezimale Zeichenfolge dargestellt wird: <br><div class="scrollable-table"><table><tbody><tr><td>  84bc3da1b3e33a18e8d5e1bdd7a18d7a </td><td>  166d77ac1b46a1ec38aa35ab7e628ab5 </td></tr><tr><td>  Identifikationsteil </td><td>  Authentifizierungsteil </td></tr></tbody></table></div><br>  Der Identifikationsteil des Tokens (die h√∂chsten 128 Bits) √§hnelt dem Login.  Durch diese Folge von Bits kann der Server den Benutzer eindeutig identifizieren. <br>  Der Authentifizierungsteil des Tokens (die unteren 128 Bit) √§hnelt dem Kennwort.  Diese Folge von Bits hilft dem Server, das Token zu validieren. <br>  Token-Validierungsregeln werden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unten beschrieben</a> . <br><br><a name="http_headers"></a><h2>  1.3 HTTP-Protokoll-Header </h2><br>  <b>Vom Client verwendete Header:</b> <br><br>  <b>CSI-Token</b> : &lt;Token&gt; wird verwendet, um ein Token an den Server zu senden <br>  <b>CSI-Token</b> : &lt;Token1&gt;;  <b>Ge√§ndert zu</b> &lt;Token2&gt; wird verwendet, um das aktuelle Token zu √§ndern: <br><ul><li>  Wenn Sie einen permanenten Schl√ºssel autorisieren, </li><li>  bei der Registrierung eines permanenten Schl√ºssels, </li><li>  beim √Ñndern des permanenten Schl√ºssels. </li></ul><br>  <b>CSI-Token</b> : &lt;Token&gt; <b>Permanent wird</b> verwendet, wenn der Benutzer den aktuellen Zufallsschl√ºssel festlegt. <br>  <b>CSI-Token</b> : &lt;Token&gt; <b>Abmelden wird</b> verwendet, um die aktuelle Sitzung vorzeitig zu beenden. <br><br>  <b>Vom Server verwendete Header:</b> <br>  <b>CSI-Unterst√ºtzung: yes</b> teilt dem Client mit, dass der Server das CSI-Autorisierungsprotokoll unterst√ºtzt. <br>  <b>CSI-Token-Aktion: Erfolg wird</b> verwendet, um den Browser √ºber die Akzeptanz eines neuen Benutzertokens (Change-To-Schl√ºssel) zu benachrichtigen. <br>  <b>CSI-Token-Aktion: Abbruch</b> bricht die Prozedur zum √Ñndern von Token ab (Rollback auf das vorherige Token). <br>  <b>CSI-Token-Aktion: Die Registrierung</b> teilt dem Browser mit, dass sich das neue Benutzertoken noch in der Registrierung befindet. <br>  <b>CSI-Token-Aktion: Ung√ºltiger</b> Fehler bei der √úberpr√ºfung des serverseitigen Tokens. <br><br>  Endlich <br>  <b>CSI-Salt wird</b> sowohl vom Browser als auch vom Server gesendet, wenn das zum Schutz des Tokens verwendete ‚ÄûSalt‚Äú (Authentifizierungsteil) ausgetauscht wird.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Siehe unten f√ºr</a> weitere Details. <br><br><a name="how_site_identify_us"></a><h2>  1.4 Wie identifizieren Kunden Websites? </h2><br>  Eine Site kann ein Token verwenden, um einen Site-Besucher zu identifizieren.  Gleichzeitig <b>garantieren</b> das Token-Generierungsschema und ihre 256-Bit-Kapazit√§t <b>eindeutige Token f√ºr jedes Paar:</b> Benutzerdom√§ne.  Eine andere Domain sieht ein anderes Benutzertoken.  Auch wenn im Kontext der Zielsite ausgef√ºhrt (√ºber IFRAME, IMG, LINK, SCRIPT).  Dar√ºber hinaus sch√ºtzt ein spezieller Algorithmus zur Token-Generierung Benutzer vor XSS- und SRF-Angriffen und macht es unm√∂glich, einen Benutzer ohne sein Wissen zu verfolgen.  Gleichzeitig <abbr title="Single Sign-On-Technologie, die von verschiedenen Protokollen wie SAML, OAuth und Kerberos implementiert wird">bleibt die SSO-</abbr> Technologie mit ihrer Erlaubnis und dom√§nen√ºbergreifenden Identifizierung m√∂glich. <br>  Das Token <b>wird im CSI-Token-HTTP-Header</b> <u>bei jeder Anforderung</u> an eine beliebige Dom√§nenressource (Seite, Dokument, Bild, Skript, Stil, Schriftart, Datei, Ajax-Anforderung, ...) √ºbertragen: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ki/mv/0k/kimv0kx4wvesmftizvvlgpfe088.png"></div><br>  Das Token wird <b><i>bei jeder</i> HTTP (S)</b> -Anforderung <b>neu berechnet</b> : Seite, Bild, Ajax-Anforderung. <br>  Um die Berechnungen zu optimieren, ist das Zwischenspeichern von Token durch den Browser zul√§ssig, jedoch nur f√ºr die Dauer der Sitzung und nur, wenn die Bedingungen f√ºr die Erf√ºllung der Anforderung unver√§ndert bleiben. <br>  Wie oben erw√§hnt, kann das Token als Ersatz f√ºr Sitzungscookies wie PHPSESSIONID und JSESSIONID dienen.  Der einzige Unterschied besteht darin, dass der Client diese Funktion jetzt selbst ausf√ºhrt, wenn die Site zuvor eine Kennung f√ºr den Besucher generiert hat, um einen bestimmten Benutzer zwischen seinen verschiedenen Anforderungen zu verfolgen (schlie√ülich kommen Tausende von Anfragen von verschiedenen Benutzern gleichzeitig auf die Site). <br>  Eine solche Identifizierung reicht v√∂llig aus, um Eink√§ufe im Online-Shop zu t√§tigen, auf geeigneten Websites zu werben, in Foren, in sozialen Netzwerken, Wikipedia- oder Habr√©-Artikeln zu schreiben. <br>  Ja, der Benutzer bleibt f√ºr die Site anonym.  Es kann sich jedoch um einen anonymen ‚ÄûVertrauten‚Äú der Website handeln.  Und der Server kann das Token eines solchen Benutzers zusammen mit seinen Daten (pers√∂nliches Konto mit Eink√§ufen, Vorlieben, Karma, Br√∂tchen, Likes und anderen Boni) auf seiner Seite speichern.  Aber nur, um unter der Bedingung des Abschlusses eines Gesch√§ftsprozesses zu bleiben: Kauf, Einreichung der Ank√ºndigung usw.  Die Bedingungen werden von der Site selbst bestimmt. <br>  Wie Sie sehen, ist das Protokoll f√ºr Websites, die Sie nicht registrieren m√ºssen, so einfach wie m√∂glich, bevor Sie die M√∂glichkeit haben, Ma√ünahmen zu ergreifen.  Aber diejenigen, die es brauchen, werden es etwas schwieriger haben.  Aber mehr dazu weiter unten. <br><br><a name="how_we_know_what_sci_supported"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.4.2 Woher wei√ü ich, ob eine Site dieses Protokoll unterst√ºtzt? </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Site sollte den </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSI-Support: yes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> http-Header </font><font style="vertical-align: inherit;">im Abschnitt Antwortheader ihrer Antwort bestehen:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ly/gs/zu/lygszusqavjk8yjnljig4pgojdm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobald der Browser einen solchen Titel sieht, informiert er den Benutzer unauff√§llig dar√ºber, dass er sich auf der Website speichern kann. </font><font style="vertical-align: inherit;">Zum Beispiel das Schl√ºsselsymbol in der Adressleiste:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ar/ff/bt/arffbt4ibbg__wlp7eyvaei_gvq.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie beispielsweise auf einen Schl√ºssel klicken, wird ein Schl√ºssel f√ºr die Domain </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.youtube.com erstellt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fq/7c/4p/fq7c4piubz15qir9xtxchg9639o.jpeg"></div><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Die Bildung eines neuen Schl√ºssels f√ºhrt nicht zu seiner automatischen Verwendung. </font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der permanente Schl√ºssel wird erst verwendet, wenn er vom Benutzer aktiviert wird. </font></font><br><br><a name="how_make_authorization"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.5 Wie autorisieren Kunden Websites? </font></font></h3><br>  ,          , ‚Äì  . ,     ,     ‚Äì   ¬´¬ª. <br>         ,    , ,  .        . <br><blockquote>   :      .      .        -    . </blockquote><br>     ¬´   ¬ª .            .   ¬´   ¬ª: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/__/0i/1x/__0i1xkyu82-ne_cnghuongzrfy.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie m√ºssen nat√ºrlich zuerst einen permanenten Schl√ºssel f√ºr die Site erstellen. </font><font style="vertical-align: inherit;">Dies ist jedoch nur eine Frage von ein paar Mausklicks. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und nat√ºrlich werden Sie aufgefordert, Ihr Telefon oder Ihre Postanschrift zu best√§tigen. </font><font style="vertical-align: inherit;">Aber es kommt schon auf die Seite an. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nach erfolgreicher Autorisierung </font><font style="vertical-align: inherit;">informiert </font><font style="vertical-align: inherit;">der Server √ºber einen speziellen HTTP-Header </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSI-Token-Action</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> den Browser dar√ºber, dass er den neuen Schl√ºssel akzeptiert hat. </font><font style="vertical-align: inherit;">Weitere Details in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kapitel II</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="how_implement_reliable_identification"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.6 Wie implementiere ich eine zuverl√§ssige Kundenidentifikation? </font></font></h2><br>     (  , , )      ,             :   , ,      . (, .    ,      ). <br><br><a name="user_view_concept"></a><h2> 1.7      </h2><br>   ,     CSI,      .       ,      .           : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/up/et/3q/upet3q-qbs8ikn4ba9t0ycn8voy.gif"></div><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">     ,  .       ,   ,  ,   .    ,   .    .    .   ,   , ,      .   .  . <br></div></div><br>   ,           .  : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/32/82/tm/3282tmri0zwdfx1jqi_zgd76zu0.gif"></div><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">   .   .  .      . <br>     ,  ¬´ ¬ª.      . <br></div></div><br>             ,     : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/u4/cm/_g/u4cm_gdewg2j7ree3gq3phuz6x4.gif"></div><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">   . ,    .  ,  ¬´¬ª.   ,  . <br></div></div><br>    ,         -.     <u>        </u> .    . ,       -    / : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xs/ye/tx/xsyetxguxoesirmridywcy-2rts.gif"></div><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">      .       -.  .    (  ). <br></div></div><br>    -  ¬´¬ª   : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/du/ab/cl/duabclss3t9nkxpnjygrqfxjdha.gif"></div><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">   .   .       .   ;    .   . <br></div></div><br>    .    ¬´¬ª  : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/do/2r/fe/do2rfebsd3orgwphl0ujrt_o52q.jpeg"></div><br>     (   )   HEAD,     CSI-Token &lt;&gt;; Logout. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mt/gj/s1/mtgjs1i1jmtbehjyus_hfukqsq4.gif"></div><br> ,   ,  Logout.     ,        (     ).     ,   . <br>          :  ,   ajax-,    .. ‚Äì    ,      . <br><blockquote>       :   ,     ,      .  ¬´¬ª     .     . </blockquote><br><br><a name="how_user_can_change_key"></a><h2> 1.8     ? </h2><br>       ,        .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> II</a> . <br>      ,       ,  <i>   </i>  <b>CSI-Token</b>   <b>Changed-To</b> : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xk/rp/75/xkrp75ivdr3kjj1_i2sh9iwfqaa.png"></div><br>      . ,        ,    .             .       (Response Headers) : <b>CSI-Token-Action: success</b> ,    . <br>        (,               )  <b>CSI-Token-Action: aborted.</b> <br>   ,      CSI-Token-Action,         CSI-Token    Changed-To. <br>  <b> ¬´ ¬ª .</b> <br><br><a name="how_make_cross_domain_auth"></a><h2> 1.9   - ? </h2><br>  Die klassische dom√§nen√ºbergreifende Autorisierung mithilfe der <abbr title="Single Sign-On-Technologie, die von verschiedenen Protokollen wie SAML, OAuth und Kerberos implementiert wird">SSO-</abbr> Technologie bietet dem Benutzer viele Vorteile.  Sie m√ºssen sich nicht eine Reihe von Passw√∂rtern von einer Reihe von Websites merken.  Es ist nicht erforderlich, sich zu registrieren und die trostlosen Formulare auszuf√ºllen.  Einige Autorisierungsserver fragen, welche Rechte die Site gew√§hren sollen, die das SSO angefordert hat. <br>  Es gibt aber auch Nachteile.  <b>Sie sind abh√§ngig vom SSO-Anbieter.</b>  Wenn der SSO-Server nicht funktioniert, gelangen Sie nicht zum Zielstandort.  Wenn Sie Ihr Passwort verlieren oder Ihr Konto gestohlen wird, verlieren Sie den Zugriff von allen Websites gleichzeitig. <br>  F√ºr Webentwickler sind die Dinge etwas komplizierter.  Von Anfang an m√ºssen Sie Ihre Site auf dem Autorisierungsserver registrieren, die Schl√ºssel abrufen, lernen, wie Sie mit dem Protokoll ( <abbr title="Ein offener Standard f√ºr den Austausch von Authentifizierungs- und Autorisierungsdaten zwischen einem Kontoanbieter und einem Dienstanbieter">SAML</abbr> , <abbr title="Ein offenes Autorisierungsprotokoll, mit dem ein Dritter nur eingeschr√§nkten Zugriff auf die gesch√ºtzten Ressourcen des Benutzers erh√§lt, ohne dass ein Login und ein Kennwort an einen Dritten √ºbertragen werden m√ºssen">OAuth</abbr> usw.) und den entsprechenden Bibliotheken arbeiten, sicherstellen, dass der Schl√ºssel nicht abl√§uft, dass der Autorisierungsserver Ihre Site aus Ihren Gr√ºnden nicht blockiert und usw.  Dies ist eine Geb√ºhr f√ºr die Tatsache, dass Sie keine Benutzerkonten f√ºhren, keine Registrierungsformulare erstellen, sich nicht anmelden usw. m√ºssen.  Die Wahrheit erh√∂ht die Wartungskosten (in Form der Reparatur pl√∂tzlicher Ausf√§lle).  Wenn der Server f√ºr die Site pl√∂tzlich nicht mehr verf√ºgbar ist, dann leider. <br>  Dieses Autorisierungsschema macht SSO etwas sicherer und die Autorisierung f√ºr alle Teilnehmer ist einfacher.  Informationen zur Sicherheit finden Sie weiter unten im Abschnitt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">"Key Compromise for SSO".</a> <br><br>  Schauen Sie sich Website S an, die das SSO von Google unterst√ºtzt.  Angenommen, Sie haben ein Google-Konto.  Um sich anzumelden, klicken Sie auf den Link "Mit Google anmelden", um die Registerkarte "Google-Autorisierung" zu √∂ffnen.  Der Browser teilt Ihnen mit, dass Sie einen Schl√ºssel f√ºr Google haben.  Und Google wird Ihnen mitteilen, welche Rechte S. anfordert. <br>  Wenn Sie damit einverstanden sind, klicken Sie im Schl√ºsselmanager auf "Anmelden".  Die Seite wird neu geladen.  Google erh√§lt bereits seinen g√ºltigen Token, erkennt und autorisiert Sie.  Bei einer Anfrage zwischen Servern wird Site S gem√§√ü den angeforderten Feldern √ºber Ihre Kontoinformationen informiert. <br>  Die neu geladene Seite enth√§lt eine Schaltfl√§che "Weiter", mit der Sie zur Zielwebsite zur√ºckkehren. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w5/u1/aa/w5u1aahv-_os9k2d81c819d5zhg.gif"></div><br><div class="spoiler">  <b class="spoiler_title">In der Abbildung</b> <div class="spoiler_text">  Er wird ein Beispiel f√ºr diesen Algorithmus geben, wenn er sich unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.youtube.com</a> mit dom√§nen√ºbergreifender Autorisierung √ºber Accounts.google.com registriert. <br></div></div><br>  Site S kann entscheiden, ob Daten √ºber Sie in seiner Datenbank gespeichert werden sollen oder nicht.  Dieses Problem geht √ºber den Rahmen des vorgeschlagenen Genehmigungsschemas hinaus.  Wenn wir jedoch das Risiko des Verlusts des Schl√ºssels f√ºr SSO ber√ºcksichtigen, wird der Site empfohlen, das Benutzertoken und die Kennung von SSO auf seiner Seite zu halten, und dem Benutzer wird empfohlen, einen permanenten Schl√ºssel f√ºr S zu erstellen. <br><blockquote>  <b>Sicherheitsl√ºcke:</b> Nach einer solchen Autorisierung k√∂nnen die Websites S1, S2, S3, ... (auf denen Sie sich √ºber Google angemeldet haben) Sie erkennen (anhand der Ihnen von Google zugewiesenen Kennung) und als Ergebnis Ihre Aktivit√§ten verfolgen. </blockquote><br><blockquote>  <b>Schutzoption:</b> Arbeiten Sie nicht gleichzeitig auf Websites, wenn Sie sich √ºber das SSO desselben Anbieters registriert haben.  Melden Sie sich nach M√∂glichkeit sofort nach Abschluss der Autorisierung vom Autorisierungsserver ab ("Auto-Exit" f√ºr die Domain). </blockquote><br><br><a name="how_make_sub_domain_identify"></a><h2>  1.10 Wie implementiere ich eine dom√§nen√ºbergreifende Authentifizierung? </h2><br>  Das alles ist nat√ºrlich gut.  W√§hrend die Arbeit in einem Browser ausgef√ºhrt wird, ist alles in Ordnung.  Aber was ist mit der modernen Realit√§t, wenn eine Person zwei Mobiltelefone, einen funktionierenden Computer und mehrere Browser, einen Heimcomputer und einen anderen Laptop hat?  Plus eine gemeinsame Tablette f√ºr die Frau / Kinder. <br>  Wir m√ºssen das Problem der √úbertragung von Dom√§nenschl√ºsseln zwischen Browsern und Ger√§ten irgendwie l√∂sen.  Und l√∂sen Sie auch das Problem ihrer korrekten Synchronisation. <br>  Einer der Mechanismen zur L√∂sung dieses Problems besteht darin, verschiedene Dom√§nenschl√ºssel basierend auf einem gemeinsamen Hauptschl√ºssel zu berechnen, ohne die M√∂glichkeit einer umgekehrten Wiederherstellung des Hauptschl√ºssels von einem bekannten Dom√§nenschl√ºssel. <br>  Nachdem ein Benutzer einen pers√∂nlichen Schl√ºssel K f√ºr Dom√§ne D unter Verwendung eines Hauptschl√ºssels M auf einem Ger√§t erstellt hat, kann er denselben Schl√ºssel K f√ºr Dom√§ne D und auf jedem anderen Schl√ºssel unter Verwendung desselben Hauptschl√ºssels M und eines einzelnen Algorithmus erstellen.  Genauer gesagt wird dies nicht vom Benutzer, sondern von seinem Browser durchgef√ºhrt.  Bei diesem Ansatz reicht es f√ºr den Benutzer aus, seinen Hauptschl√ºssel auf alle von ihm verwendeten Browser zu verteilen, und er "√ºbertr√§gt alle seine Schl√ºssel" von Dom√§nen gleichzeitig.  Gleichzeitig werden auf diese Weise Backups erstellt. <br>  Maximaler Benutzerkomfort.  <b>Aber auch das maximale Risiko</b> bei Kompromittierung des Hauptschl√ºssels.  Letztere m√ºssen daher entsprechend gesch√ºtzt werden.  Die Risiken des Verlusts oder der Beeintr√§chtigung des Hauptschl√ºssels und M√∂glichkeiten zur Minimierung solcher Risiken werden im Kapitel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚Äû3 Sicherheitsempfehlungen‚Äú beschrieben</a> . <br>  Die Verwendung nur eines Hauptschl√ºssels zum Generieren aller Schl√ºssel f√ºr alle Dom√§nen ist nicht immer eine bequeme Option.  Was tun, wenn pl√∂tzlich der Dom√§nenschl√ºssel kompromittiert wird und ge√§ndert werden muss?  Was ist zweitens, wenn Sie einen Domain-Schl√ºssel mit einer anderen Person teilen m√ºssen?  Zum Beispiel zwischen Familienmitgliedern.  Oder handelt es sich um ein √∂ffentliches E-Mail-Zugriffskonto f√ºr Unternehmen?  Wie kann man dann seinen Schl√ºssel "abholen" (weil er tats√§chlich kompromittiert wurde)? <br>  Daher muss die Generierung einzelner Dom√§nenschl√ºssel mithilfe eines biologischen Zufallszahlensensors von Browsern unterst√ºtzt werden.  Aber dann kehren wir noch einmal zu der Frage unserer Mobilit√§t und den Fragen der Synchronisation, den Funktionen zum Exportieren und Importieren von Schl√ºsseln im Browser und zum Erstellen von Sicherungskopien zur√ºck. <br><br><h3>  √úbertragung durch ein physisch ver√§u√üerbares Ger√§t </h3><br>  Smartcards und USB-Token eignen sich durchaus als sichere Speicherung von Schl√ºsselinformationen (da sie daf√ºr erstellt wurden).  Die Zwei-Faktor-Authentifizierung sch√ºtzt Schl√ºssel vor unbefugtem Zugriff durch direkten Zugriff auf das Ger√§t. <br>  F√ºr Smartcards sind spezielle Leseger√§te erforderlich (ganz zu schweigen von Treibern), die ihre Verwendung nur auf Workstations beschr√§nken, die mit solchen Leseger√§ten ausgestattet sind. <br>  Mit USB-Token etwas einfacher.  Es werden nur Treiber ben√∂tigt.  Sie k√∂nnen einen solchen Token jedoch nicht in das Telefon stecken.  Und obwohl es f√ºr Mobiltelefone Token in Form von SD-Karten gibt, hei√üt das nicht, dass diese L√∂sung die Mobilit√§t erh√∂ht.  Versuchen Sie, eine Karte von einem Mobiltelefon zu ziehen, aber legen Sie sie in eine andere ein.  Und das ist nicht unm√∂glich.  Die Sache ist, dass es nicht bequem ist. <br>  Und wenn der Token kaputt geht?  Dann gehen alle deine Schl√ºssel zum Gro√üen Cthulhu. <br>  Bei einem solchen Schema besteht also die Versuchung, mehrere doppelte Ger√§te zu verwenden.  Wenn Sie mehrere Smartcards haben, m√ºssen Sie das Problem mit der Schl√ºsselsynchronisierung noch l√∂sen. <br>  Und ehrlich gesagt sind solche Ger√§te nicht vor Keyloggern gesch√ºtzt.  Nun, wenn der PIN-Code von der Karte / dem Token selbst eingegeben werden w√ºrde.  Dann noch etwas.  Aber ich habe solche in der Natur nicht gesehen. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gq/1g/js/gq1gjsgtxvfjjvs79syif5_u8_w.png"></div><br><blockquote>  <b>Vorteile: Es k√∂nnen</b> zuf√§llige 256-Bit-Schl√ºssel verwendet werden.  hohe Sicherheit durch Zwei-Faktor-Authentifizierung;  das h√∂chste Schutzniveau gegen direkte Manipulation. <br>  <b>Nachteile:</b> Ger√§teabh√§ngigkeit;  erfordert finanzielle Kosten;  geringe Mobilit√§t;  die Notwendigkeit, Karten zu reservieren und infolgedessen Daten zwischen ihnen zu synchronisieren;  Die Anf√§lligkeit f√ºr Keylogger bleibt bestehen. <br></blockquote><br><h3>  Synchronisierung √ºber Online-Service </h3><br>  "Cloud-Technologie" wird jetzt wo immer m√∂glich verschoben.  Es scheint, dass sie zusammen mit der Blockchain ein Ersatz f√ºr die "Bananentechnologie" geworden sind.  Nat√ºrlich besteht der Wunsch, eine bestimmte Internetplattform f√ºr den Austausch von Schl√ºsselinformationen zu nutzen.  Eine Art Smartcard "online". <br>  Und was?  Sie melden sich anonym mit unserem Schema auf einer solchen Website an.  Senden Sie Ihre Schl√ºssel dort verschl√ºsselt mit einem Passwort.  Sie wechseln mit demselben Schl√ºssel / Passwort von einem anderen Ger√§t zur selben Site.  Sie bekommen die Schl√ºssel von dort;  Sie synchronisieren √Ñnderungen nach dem Datum der Bearbeitung.  √Ñhnlich wie beim Passwort-Manager ist nur dieser online. <br>  Das hei√üt nur, niemand garantiert, dass der Onlinedienst nicht gehackt wird oder Ihre, wenn auch verschl√ºsselten "erforderlichen" Schl√ºssel nicht zusammengef√ºhrt werden.  Wer wird einen solchen Dienst kostenlos implementieren.  Das war's. <br>  Obwohl das Passwort die Schl√ºssel nat√ºrlich vor direkter Verwendung sch√ºtzt.  Aber ist Ihr Passwort gegen Brute Force "offline" resistent?  Das ist eine andere Frage. <br><blockquote>  <b>Vorteile:</b> hohe Mobilit√§t der Berechtigungsnachweise;  Ger√§te- und Browserunabh√§ngigkeit;  Sie ben√∂tigen nur ein einziges Passwort (obwohl das Passwort nicht hinterlassen wurde, ist es bereits besser). <br>  <b>Nachteile:</b> Weniger sicher als das Speichern von Schl√ºsseln auf einem ver√§u√üerlichen Medium.  Tats√§chlich basiert die Sicherheit der Schl√ºssel auf der St√§rke des Kennworts f√ºr die Auswahl. <br></blockquote><br>  Sie k√∂nnen nat√ºrlich einen Hauptschl√ºssel verwenden, um andere Schl√ºssel zu verschl√ºsseln.  Derjenige, mit dem andere Dom√§nenschl√ºssel berechnet werden.  Als Option. <br><br><a name="part2"></a><h1>  2 Technische Beschreibung des Protokolls </h1><br><br><a name="perm_key_algo"></a><h2>  2.0 Algorithmus zur Generierung von Dom√§nenschl√ºsseln </h2><br>  Dieses Protokoll definiert nur zwei Methoden zum Generieren von Dom√§nenschl√ºsseln. <br><br><ul><li>  basierend auf einem Zufallszahlengenerator (vorzugsweise biologisch) </li><li>  basierend auf einem 256-Bit-Hauptschl√ºssel </li></ul><br>  Im letzteren Fall wird der Dom√§nenschl√ºssel wie folgt berechnet: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/3aa/d39/ac7/3aad39ac79fc322d157a9f4c58a793f2.svg" alt="$ K = HMAC_ {M_ {Schl√ºssel}} (Dom√§ne) $" data-tex="display"></p>  wo <math></math><img src="https://habrastorage.org/getpro/habr/formulas/0b7/f4d/5a6/0b7f4d5a6dcc0d36804bd9dfc0ff9403.svg" alt="$ M_ {Schl√ºssel} $" data-tex="inline">  - 256-Bit-Hauptschl√ºssel, Dom√§ne - Dom√§nenname, f√ºr den der Schl√ºssel erstellt wurde. <br>  Im Folgenden ist <i>HMAC</i> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ein kryptografischer Hash-Algorithmus,</a> der auf einer 256-Bit-Implementierung der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SHA-2-</a> Hash-Funktion basiert. <br><blockquote>  Eine Kompromittierung oder freiwillige Offenlegung eines Dom√§nenschl√ºssels gef√§hrdet nicht den urspr√ºnglichen Hauptschl√ºssel. </blockquote><br>  Der Hauptschl√ºssel bietet einen Mechanismus f√ºr die Mobilit√§t von Benutzeranmeldeinformationen. <br><div class="spoiler">  <b class="spoiler_title">Hinweis</b> <div class="spoiler_text">  In der ersten Version des Protokolls wurde die Option zum Generieren von Dom√§nenschl√ºsseln basierend auf dem Kennwort des Benutzers als Bereitstellung von Benutzermobilit√§t und Schutz vor Kennwortkompromissen beim Hacken einer Site angesehen.  Im Kapitel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚Äû3 Sicherheitsempfehlungen‚Äú wird jedoch</a> erl√§utert, warum beschlossen wurde, ein solches System abzulehnen. </div></div><br>  Wenn der auf der Grundlage des ‚ÄûMasters‚Äú erstellte Schl√ºssel kompromittiert wurde oder das aus einem solchen Schl√ºssel berechnete Token (als Ergebnis des Hackens der Site) kompromittiert wurde, muss der Schl√ºssel ge√§ndert werden.  Sie k√∂nnen es in einen zuf√§lligen 256-Bit-Schl√ºssel √§ndern oder es mit demselben ‚ÄûAssistenten‚Äú generieren, indem Sie eine Version hinzuf√ºgen: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/eae/301/46b/eae30146bac887a402418464641e617e.svg" alt="$ K = HMAC_ {Mkey} (Domain \ cup-Version) $" data-tex="display"></p>  Im Folgenden das Symbol <math></math><img src="https://habrastorage.org/getpro/habr/formulas/a47/285/a28/a47285a2828b9a69edf64fea3e240a0d.svg" alt="$ \ cup $" data-tex="inline">  wird f√ºr die Verkettung von Zeichenfolgen (Byte-Arrays) verwendet. <br><br><a name="token_algo"></a><h2>  2.1 der Algorithmus zur Berechnung des Quell-Tokens </h2><br>  Das Authentifizierungstoken des Benutzers wird bei jeder Anforderung einer Dom√§nenressource berechnet.  Zur Berechnung des Anforderungstokens werden die folgenden Daten verwendet: <br><br><ul><li>  <i>Absender</i> - Der Dom√§nenname des Initiators der Anforderung (es kann sich um eine Seite mit einem Iframe oder einem Skript aus der Dom√§ne einer anderen Person handeln, die den Abruf ausf√ºhrt). </li><li>  <i>Empf√§nger</i> - Domainname des Empf√§ngers (an den die Anfrage gesendet wird), </li><li>  <i>Kontext</i> - Anforderungsausf√ºhrungskontext, </li><li>  <i>Schutz</i> - eine zuf√§llige Folge von 32 Bytes (256 Bit), wenn der Kontext leer ist;  sonst leer </li></ul><br>  Diese Daten werden verkettet und mit 256-Bit-SHA-2 <b>auf dem Schl√ºssel K der Dom√§ne</b> gehasht, <b>die die Anforderung initiiert</b> : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/8d1/bd1/cbc/8d1bd1cbc81815e0121976c9bb5e4ccc.svg" alt="$ K = HMAC_M (Absender \ Tasse Empf√§nger \ Tasse Kontext \ Tasse Schutz) $" data-tex="display"></p><blockquote>  Ein g√ºltiges Token wird erhalten, wenn der Kontext nicht leer ist.  F√ºr eine ordnungsgem√§√üe Identifizierung am Zielstandort muss die Bedingung Absender = Empf√§nger = Kontext erf√ºllt sein. </blockquote><br>  Das Feld Kontext wird zusammen mit Schutz zum Schutz vor <abbr title="Cross-Site-Scripting - &quot;Cross-Site-Scripting&quot;">XSS-</abbr> und <abbr title="F√§lschung von standort√ºbergreifenden Anfragen - &quot;F√§lschung von standort√ºbergreifenden Anfragen&quot;">CSRF-</abbr> Angriffen sowie vor Benutzerverfolgung verwendet. <br>  Detailliertere Erl√§uterungen zu den Regeln zur Bestimmung von Absender / Empf√§nger / Kontext finden Sie weiter unten. <br><br><a name="token_validation_algo"></a><h2>  2.2 Token-Schutzalgorithmus w√§hrend der √úbertragung </h2><br>  Das urspr√ºngliche Client-Token wird √§u√üerst selten √ºbertragen.  Nur beim √úbertragen eines nicht registrierten Tokens zum Zeitpunkt der Erstellung der Sitzung. <br>  <b>Ein Token gilt als nicht registriert,</b> wenn es: auf der Grundlage eines zuf√§lligen (nicht festen) Schl√ºssels erstellt wird;  wurde vom Server nach dem Senden des Wechsels zum oder des permanenten Schl√ºssels nicht akzeptiert.  Weitere Informationen finden Sie unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚ÄûVerarbeiten von Token auf dem Server‚Äú</a> . <br>  Der Browser und der Server erzeugen gemeinsam ein Paar von Zufallszahlen, die sogenannten  Salz (Salz), mit dem die unteren 128 Bits des Tokens gehasht werden.  Beide tauschen diese Nummern gem√§√ü dem Protokoll aus.  Weitere Informationen finden Sie unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚ÄûSalt-Swap-Prozedur-Browser-Server‚Äú</a> . <br>  Daher sieht der Standortserver das folgende Token: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/8ea/b59/cc3/8eab59cc3e5060cfec9956f984807b5f.svg" alt="$ T = Hi (T_s) \ cup HMAC_ {salt} (Lo (T_s)) $" data-tex="display"></p>  wo <math></math><img src="https://habrastorage.org/getpro/habr/formulas/69c/826/a5b/69c826a5bc2d0953c3db1dbcc842a035.svg" alt="$ Hi (T_s) $" data-tex="inline">  - hohe 128 Bit, <math></math><img src="https://habrastorage.org/getpro/habr/formulas/73a/cbf/6b4/73acbf6b426b5d3dff599b4cba44ebfd.svg" alt="$ Lo (T_s) $" data-tex="inline">  - die unteren 128 Bits des urspr√ºnglichen Tokens, <math></math><img src="https://habrastorage.org/getpro/habr/formulas/a47/285/a28/a47285a2828b9a69edf64fea3e240a0d.svg" alt="$ \ cup $" data-tex="inline">  - Verkettung von Zeichenfolgen.  In diesem Fall das erste Token <math></math><img src="https://habrastorage.org/getpro/habr/formulas/c39/070/036/c39070036bed1c9b371606081981a5fb.svg" alt="$ T_s $" data-tex="inline">  sollte dem Server bereits bekannt sein. <br><br>  Im Idealfall sollte sich CSI-Salt jedes Mal √§ndern, wenn ein Browser einen Server anfordert.  Dies kann jedoch eine kostspielige Anforderung in Bezug auf Rechenressourcen sein.  Dar√ºber hinaus kann die M√∂glichkeit, parallele Anforderungen an den Server zu senden, "beendet" werden. <br>  Um die Berechnungen zu optimieren, d√ºrfen die CSI-Salt-Werte daher in verschiedenen Anforderungen unver√§ndert bleiben, <u>jedoch nicht l√§nger als eine Sitzung</u> .  Dies kann ein Zeitlimit (√Ñnderung von CSI-Salt alle 5 Minuten) oder eine Reaktion auf die Intensit√§t von Anforderungen (√Ñnderung von CSI-Salt alle 100 Anforderungen) oder nach jeder Reihe von Anforderungen (zum Zeitpunkt der Pause, Client-Server) oder eine gemischte Version sein.  Hier bleibt die Entscheidung den Browserentwicklern √ºberlassen. <br>  Wenn CSI-Salt zu lange unver√§ndert bleibt, wird der Schutz des √ºbertragenen Tokens geschw√§cht, sodass der Angreifer das Token abfangen kann, w√§hrend der legitime Benutzer die Abmeldung abgeschlossen hat, und eine nicht autorisierte Anforderung im Namen des Opfers ausf√ºhren kann. <br><br><a name="salt_exchange_algo"></a><h2>  2.3 Salzaustauschverfahren zwischen Browser und Server </h2><br>  2.3.1 Token basierend auf einem zuf√§lligen oder nicht registrierten <sup>[1]</sup> Serverschl√ºssel. <br><div class="scrollable-table"><table><tbody><tr><th>  <b>Browser</b> </th><th>  <b>Server</b> </th></tr><tr><td colspan="2">  <b>Erstanforderung (Benutzersitzungsinitialisierung)</b> </td></tr><tr><td>  Der Browser sendet das Token unver√§ndert. <br>  <b>Ihrer Anfrage fehlt CSI-Salt.</b> <br></td><td>  Der Server sieht zuerst ein solches Token. <br><div class="spoiler">  <b class="spoiler_title">√úbrigens</b> <div class="spoiler_text">  Der Server ist m√∂glicherweise nicht der erste, der ein solches Token sieht.  Und der Browser gilt als nicht registriert.  Dies kann passieren, <u>wenn Sie den Schl√ºssel basierend auf dem Hauptschl√ºssel auf einem anderen Ger√§t neu erstellen</u> .  Daher sollte auch diese Situation ber√ºcksichtigt werden. </div></div><br>  Nimmt es so wahr wie es ist (betrachtet es als ungesch√ºtzt).  Verwendet dieses Token als Sitzungskennung. <br>  Erzeugt sein <i>S- <sub>Salz</sub></i> . <br>  <b>Gibt es in der Antwort im CSI-Salt-Header zur√ºck.</b> <br></td></tr><tr><td colspan="2">  <b>Zweite Anfrage</b> </td></tr><tr><td>  Erzeugt Salz <i>Mit <sub>Salz</sub></i> . <br>  Der Browser verbindet <sup>[3]</sup> sein Salt und das Salt des Servers. <br>  Der Browser sendet die Anfrage und √ºbergibt ein gemeinsames Salt-Token. <br>  <b>Sendet CSI-Salz.</b> <br></td><td>  Der Server empf√§ngt die Anforderung und <b>ruft den CSI-Salt-Client ab</b> . <br>  Der Server verbindet das Browser-Salt mit seinem eigenen und verwendet es, um das Token zu √ºberpr√ºfen. <br><br>  Wenn die Token-Validierung erfolgreich ist, stellt sie dem Benutzer Inhalte gem√§√ü seinen Rechten zur Verf√ºgung. <br><br>  Gibt bei √úberpr√ºfungsfehlern den <b>ung√ºltigen</b> Header <b>CSI-Token-Action:</b> an den Client zur√ºck.  Inhalt zur√ºckgeben oder leere Antwort zur√ºckgeben: Serverabh√§ngig. <br></td></tr><tr><td colspan="2">  <b>Nachfolgende Anfragen</b> </td></tr><tr><td>  Der Browser sendet die Anfrage und √ºbergibt ein gemeinsames Salt-Token. <br>  <b>Ihrer Anfrage fehlt CSI-Salt.</b> <br></td><td>  Der Server empf√§ngt die Anforderung und √ºberpr√ºft ihr Token. <br><br>  Wenn die Token-Validierung erfolgreich ist, stellt sie dem Benutzer Inhalte gem√§√ü seinen Rechten zur Verf√ºgung. <br><br>  Gibt bei √úberpr√ºfungsfehlern den <b>ung√ºltigen</b> Header <b>CSI-Token-Action:</b> an den Client zur√ºck.  Inhalt zur√ºckgeben oder leere Antwort zur√ºckgeben: Serverabh√§ngig. <br></td></tr><tr><td colspan="2">  <b>Nach einiger Zeit <sup>[2]</sup></b> </td></tr><tr><td>  Erzeugt ein neues Salz <i>C- <sub>Salz</sub></i> . <br>  Verbinden Sie das neue Salz mit dem Serversalz. <br>  Sendet eine Anfrage und √ºbergibt einen Token, der durch ein neues gemeinsames Salz gesch√ºtzt ist. <br>  <b>Sendet CSI-Salz.</b> <br></td><td>  Der Server empf√§ngt die Anforderung und <b>ruft den neuen CSI-Salt-Client ab</b> . <br>  Der Server verbindet das Browser-Salt mit seinem eigenen und verwendet es, um das Token zu √ºberpr√ºfen. <br><br>  Wenn die Token-Validierung erfolgreich ist, stellt sie dem Benutzer Inhalte gem√§√ü seinen Rechten zur Verf√ºgung. <br><br>  Gibt bei √úberpr√ºfungsfehlern den <b>ung√ºltigen</b> Header <b>CSI-Token-Action:</b> an den Client zur√ºck.  Inhalt zur√ºckgeben oder leere Antwort zur√ºckgeben: Serverabh√§ngig. <br></td></tr></tbody></table></div><br>  2.3.2 Token basierend auf dem vom Server registrierten Schl√ºssel <sup>[1]</sup> . <br><div class="scrollable-table"><table><tbody><tr><th>  <b>Browser</b> </th><th>  <b>Server</b> </th></tr><tr><td colspan="2">  <b>Erstanforderung (Benutzersitzungsinitialisierung)</b> </td></tr><tr><td>  Erzeugt Salz <i>Mit <sub>Salz</sub></i> . <br>  <b>Sendet CSI-Salz.</b> <br>  √úbertr√§gt das Token in gesch√ºtzter Form. <br></td><td>  Der Server empf√§ngt die Anforderung und <b>ruft den CSI-Salt-Client ab</b> . <br>  Liest ein gesch√ºtztes Token. <br>  Findet das vollst√§ndige Client-Token in seiner Datenbank (verwendet das erste 128-Bit-Token, das in der Suchanforderung empfangen wurde). <br>  Weil  Dies ist die erste Anforderung. Der Server hat kein Salt an den Client gesendet. Die <b>Token-Validierung wird zu diesem Zeitpunkt nur vom Salt des Clients durchgef√ºhrt</b> . <br><br>  Gibt bei √úberpr√ºfungsfehlern den <b>ung√ºltigen</b> Header <b>CSI-Token-Action:</b> an den Client zur√ºck.  Inhalt zur√ºckgeben oder leere Antwort zur√ºckgeben: Serverabh√§ngig. <br><br>  Wenn die Token-Validierung erfolgreich ist, stellt sie dem Benutzer Inhalte gem√§√ü seinen Rechten zur Verf√ºgung. <br><br>  Erzeugt sein <i>S- <sub>Salz</sub></i> . <br>  <b>Gibt es in der Antwort im CSI-Salt-Header zur√ºck</b> . <br></td></tr><tr><td colspan="2">  <b>Nachfolgende Anfragen</b> </td></tr><tr><td>  Der Browser kombiniert Salt und Server Salt. <br>  Der Browser sendet die Anfrage und √ºbergibt ein gemeinsames Salt-Token. <br>  <b>Ihrer Anfrage fehlt CSI-Salt</b> . <br></td><td>  Der Server empf√§ngt die Anforderung und √ºberpr√ºft ihr Token. <br><br>  Wenn die Token-Validierung erfolgreich ist, stellt sie dem Benutzer Inhalte gem√§√ü seinen Rechten zur Verf√ºgung. <br><br>  Gibt bei √úberpr√ºfungsfehlern den <b>ung√ºltigen</b> Header <b>CSI-Token-Action:</b> an den Client zur√ºck.  Inhalt zur√ºckgeben oder leere Antwort zur√ºckgeben: Serverabh√§ngig. <br></td></tr><tr><td colspan="2">  <b>Nach einiger Zeit <sup>[2]</sup></b> </td></tr><tr><td>  Erzeugt ein neues Salz <i>C- <sub>Salz</sub></i> . <br>  Der Browser verbindet das neue Salt mit dem Server Salt. <br>  Der Browser sendet die Anforderung und √ºbergibt ein Token, das durch das neue gemeinsam genutzte Salt gesch√ºtzt ist. <br>  <b>Sendet CSI-Salz</b> . <br></td><td>  Der Server empf√§ngt die Anforderung und <b>ruft den neuen CSI-Salt-Client ab</b> . <br>  Der Server verbindet das Browser-Salt mit seinem eigenen und verwendet es, um das Token zu √ºberpr√ºfen. <br><br>  Wenn die Token-Validierung erfolgreich ist, stellt sie dem Benutzer den Inhalt gem√§√ü seinen Rechten zur Verf√ºgung. <br><br>  Gibt bei √úberpr√ºfungsfehlern den <b>ung√ºltigen</b> Header <b>CSI-Token-Action:</b> an den Client zur√ºck.  Inhalt zur√ºckgeben oder leere Antwort zur√ºckgeben: Serverabh√§ngig. <br></td></tr></tbody></table></div><hr>  <sup>[1] Ein Token gilt als nicht registriert, wenn es: auf der Grundlage eines zuf√§lligen Schl√ºssels erstellt wird;</sup>  <sup>wurde vom Server nach dem Senden des Wechsels zum oder des permanenten Schl√ºssels mit der Antwort CSI-Token-Aktion: Erfolg nicht akzeptiert.</sup> <sup><br></sup>  <sup>[2] Die Zeit, in der die CSI-Salt-√Ñnderung vorgenommen wird, wird von den Browsern selbst festgelegt.</sup>  <sup>Dies kann nach einer Reihe von Anforderungen, nach einer Zeit√ºberschreitung und nach einer bestimmten Anzahl von Anforderungen geschehen.</sup> <sup>  ‚Äì <b>     CSI-Salt    </b> . <br> [3]     16-  128- .     ,   : <i> <sub>salt</sub></i> || <i>S <sub>salt</sub></i> .       ‚Äì     ,    .      ,    ,    .</sup> <br><br><a name="context_rules"></a><h2> 2.4    Context </h2><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text">      .   ,  -  .            . <br>       ,   .      ,     . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir nennen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsere</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Domain, deren Seite wir laden (angezeigt in der Adressleiste des Browsers). Die restlichen Domains werden als </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extern bezeichnet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Auch wenn dies untergeordnete Dom√§nen einer bestimmten sind. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir nennen die Ressource </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extern,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wenn sie von einer externen Domain heruntergeladen wurde. Wir nennen die Ressource </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intern,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wenn sie von unserer Domain heruntergeladen wurde. Die Ressource kann ein Skript, ein Bild, eine Ajax-Anfrage und eine beliebige andere Datei sein.</font></font><br><br>   ,       . ,     &lt;script&gt;,   ,    . ,     &lt;script&gt;,  ,    ,           .      &lt;script&gt;         . <br><br>   LINK, SCRIPT, IMG, IFAME  ,      - ,      DOM ‚Äì <i> </i> . <br><br>   FORM, A, META  ,         (submit, click, timeout) ‚Äì <i> </i> . <br><br>   <i></i> ,          .   <i></i> ,        . <br><br>  FORM  ,       ,      INPUT,    . <br><br>    <i></i> ,    ,   ,     ,   ,   ,   .        <i></i> . <br><br> <b>    .</b>         ,   ,    click ( ),  submit ( )       onclick/onsubmit. <br><br>         .    ‚Äì META   http-equiv=¬´refresh¬ª content=¬´0¬ª. <br><br> <sup> P.  Context     </sup> <br><a name="context_table_P"></a><div class="scrollable-table"><table><tbody><tr><th colspan="3" rowspan="2">   </th><th colspan="4">    ? </th></tr><tr><th>  Benutzer </th><th> . JS </th><th> . JS </th><th>  </th></tr><tr><td rowspan="3">  <sup>1</sup> </td><td colspan="2">  </td><td> P1. Referrer </td><td> P2. Variant <sup>3</sup> </td><td> P3. Empty </td><td> P4. Inherit </td></tr><tr><td rowspan="2">  </td><td>  </td><td> P5. Inherit </td><td> P6. Variant <sup>3</sup> </td><td> P7. Empty </td><td> P8. Inherit </td></tr><tr><td>  </td><td> P9. Empty </td><td> PA. Empty </td><td> PB. Empty </td><td> PC. Empty </td></tr><tr><td colspan="3">  </td><td> PD. Domain </td><td> PE. Variant <sup>3</sup> </td><td> PF. Empty </td><td> PG. Variant <sup>4</sup> </td></tr></tbody></table></div><br><div class="spoiler"> <b class="spoiler_title">  ,  </b> <div class="spoiler_text">  <img src="https://habrastorage.org/webt/cq/l-/6e/cql-6eob6gouvsqsrdy5ltykhfg.gif" align="right"></div></div><br>       (  SRC  IMG),      ,  ,   /  ,   ‚Äî ,      ¬´¬ª. <br><br> <sup> R.  Context    <b> /</b></sup> <br><a name="context_table_R"></a><div class="scrollable-table"><table><tbody><tr><th colspan="3" rowspan="2">   </th><th colspan="3">    ? </th></tr><tr><th> DOM Parser </th><th> . JS </th><th> . JS </th></tr><tr><td rowspan="3">  <sup>2</sup> </td><td colspan="2">  </td><td> R1. Page </td><td></td><td></td></tr><tr><td rowspan="2">  </td><td>  </td><td> R4. Page </td><td></td><td></td></tr><tr><td>  </td><td> R7. Empty </td><td></td><td></td></tr><tr><td colspan="3">  </td><td> RA. Referrer </td><td> RB. Page </td><td> RC. Referrer </td></tr></tbody></table></div><br><div class="spoiler"> <b class="spoiler_title">  ,  </b> <div class="spoiler_text">  <img src="https://habrastorage.org/webt/dl/zi/mn/dlzimnup-7etmrsysxzlxjw1zd8.gif" align="right"></div></div><br><hr> <sup>[1]   <br> [2]   <br> [3] Inherit    , Empty      <br> [4] Inherit      , Empty            (. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> )</sup> <br><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"> <b>Referrer</b> ‚Äì     Referrer. <br> <b>Page</b> ‚Äì   (Tab)      . <br> <b>Empty</b> ‚Äì  . <br> <b>Domain</b> ‚Äì  Context     <br> <b>Inherit</b> ‚Äì  Context     <br> <b>Variant</b> ‚Äì  Context    ¬´-¬ª   <br></div></div><br>   P1..PF, R1..RC            . <br><blockquote>     <b>Referrer</b>  <b>Domain</b>   .       ,       ,      ,       . </blockquote><br><br><a name="sender_recipient_rules"></a><h2> 2.5    Sender  Recipient </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Absender ist die Dom√§ne der Seite / des Skripts / des Stils, von der die Anforderung stammt. </font><font style="vertical-align: inherit;">Die Seite fordert Stile, Bilder und Skripte an. </font><font style="vertical-align: inherit;">Skripte fordern Inhalte √ºber Ajax an. </font><font style="vertical-align: inherit;">Stile k√∂nnen andere Stile laden. </font><font style="vertical-align: inherit;">Dies sind die Initiatoren der Anfrage. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Empf√§nger ist die Domain, an die die Anfrage wirklich geht. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Damit keine Fragen mehr offen sind, betrachten wir konkrete Beispiele. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lass es eine site.net Seite geben. </font><font style="vertical-align: inherit;">Auf der Hauptseite der Website befindet sich:</font></font><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> style site.net/css/common.css </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> common.css-Stile importieren fonts.google.com/fonts/Roboto.css-Stile </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der Roboto.css-Stil importiert die Schriftart fonts.google.com/fonts/Roboto.ttf </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bild f√ºhrt zu img.site.net/picture1.jpg </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Frame von adriver.ru/frame geladen </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Skript von adm.site.net/admin.js </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lassen Sie den Rahmen (mit adriver.ru) verbinden: </font></font><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Stil von adriver.ru/style.css </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bild von img.adriver.ru/img/01.png </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Skript von adriver.ru/libs.js </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Skript von api.adriver.ru/v1/ad.js </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Absender- / Empf√§ngerwerte beim Laden von Ressourcen mit dem DOM-Parser </font></font><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Herunterladbare Ressource </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Absenderwert </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Empf√§ngerwert </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net/css/common.css </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com/fonts/Roboto.css </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com/fonts/Roboto.ttf </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.site.net/picture1.jpg </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/frame </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net/admin.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/style.css </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.adriver.ru/img/01.png </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/libs.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru/v1/ad.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru </font></font></td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Betrachten wir nun die Werte von Absender / Empf√§nger beim Laden von Inhalten mit Skripten w√§hrend der Ausf√ºhrung von Ajax-Anforderungen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Absender- / Empf√§ngerwerte beim Laden von Inhalten mit Skripten</font></font><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ausf√ºhrbares Skript </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wohin geht die Anfrage? </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Absender </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Empf√§nger </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net/admin.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net/api/ </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/libs.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/api/ </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru/v1/ad.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.2gis.ru / ... </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.2gis.ru </font></font></td></tr></tbody></table></div><br><br><a name="context_tables_comments"></a><h2> 2.6      Context </h2><br>  ,     (  )   ,    Context    . <br><br><a name="P1"></a> <b>P1</b> ‚Äì          submit  .      /     .  .        . <br><br>    site.net    google.com, Context     (google.com).      site.net   (      ,   ). <br><br>     (  )           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">P1</a> ,  Context     site.net, ..   Context = Referrer. <br><br>      <abbr title="ross Site Request Forgery ‚Äî ¬´  ¬ª">CSRF</abbr> -. <br><br><a name="P5"></a> <b>P5</b> ‚Äì       , / ,     ;         submit , /  (  FORM,    INPUT).      /     . <br><br><a name="P9"></a> <b>P9</b> ‚Äì ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">P5</a> ,    ,          (       ). <br><br><a name="PD"></a> <b>PD</b> ‚Äì      .  . <br><blockquote>       URL   .      . </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie einen Link √ºber eine Desktop-Verkn√ºpfung eines anderen Programms √∂ffnen, sollte jede andere Situation, in der das Betriebssystem einen Befehl zum √ñffnen des Links an den Browser sendet, als </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PG-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fall betrachtet werden </font><font style="vertical-align: inherit;">(√ñffnen des Links auf Initiative des Browsers). Selbst wenn der Benutzer F5 dr√ºckt, um die Seite neu zu laden, sollte dies als </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PG-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fall betrachtet werden </font><font style="vertical-align: inherit;">. Nur wenn der Benutzer in die Adressleiste gelangt und die Eingabetaste dr√ºckt, wird er vom Browser als </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PD betrachtet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies geschieht, um CSRF-Angriffe vor anderen Programmen zu sch√ºtzen.</font></font><br><br>                  Context,   ,     F5 ( ).      ,    -     ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">P1</a> ). <br><br>  ,              site.net,    ,        .           ,     ,   ‚Ä¶ ,   ,  ,     site.net. <br><br><a name="P2"></a> <b>P2</b> ‚Äì       ,    ,       click/submit.      ,   .      . <br><br>       , Context    .      , Context  . <br><br><a name="P6"></a> <b>P6</b> ‚Äì  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">P2</a> ,  /  /  . <br><br><a name="PA"></a> <b>PA</b> ‚Äì  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">P2</a> ,  /  /  . <br><br><a name="PE"></a> <b>PE</b> ‚Äì          window.location.href  window.open(‚Ä¶). <br><br>   site.net        ,  Context     .    Context = site.net. <br><br>     ya.ru,      maps.ya.ru,  Context     .     Context     ,      . <br><br>  ,      ‚Äì  .           CSRF-. <br><br><a name="P3"></a> <b>P3</b> ‚Äì  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">P2</a> ,   click/submit    . Context   (     ),        ( ). <br><br><a name="P7"></a> <b>P7</b> ‚Äì  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">P6</a> ,  /  /  . <br><br><a name="PB"></a> <b>PB</b> ‚Äì  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PA</a> ,  /  /  . <br><br><a name="PF"></a> <b>PF</b> ‚Äì  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PE</a> ,     . <br><br><a name="P4"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P4</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Der Browser hat die Seite als Ergebnis der Verarbeitung des &lt;META&gt; -Tags neu geladen. </font><font style="vertical-align: inherit;">Das Tag befand sich urspr√ºnglich auf der Seite. </font><font style="vertical-align: inherit;">Rechtliche Weiterleitung. </font><font style="vertical-align: inherit;">Der Kontext bleibt auf der Originalseite erhalten. </font><font style="vertical-align: inherit;">Wie bei </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="P8"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P8</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Der Browser hat die Seite als Ergebnis der Verarbeitung des &lt;META&gt; -Tags neu geladen. </font><font style="vertical-align: inherit;">Das Tag wurde jedoch durch ein eigenes Skript erstellt / ge√§ndert. </font><font style="vertical-align: inherit;">Dies ist g√ºltig, aber der Kontext bleibt auf der Originalseite erhalten. </font><font style="vertical-align: inherit;">Wie bei </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Es ist nicht m√∂glich, das legale Token des Benutzers auf diese Weise zu locken.</font></font><br><br><a name="PC"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - √§hnlich wie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P8</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nur externes Skript. </font><font style="vertical-align: inherit;">Die ge√∂ffnete Site erh√§lt eine Zufallszahl als Kontext.</font></font><br><br><a name="PG"></a> <b>PG</b> ‚Äì       .   ,       ,     .    ,    ,   .       ,   Context       . <br><br>     CSRF-   . <br><br><blockquote>       ,  Context          . </blockquote><br>  ,      ,        (   )    HTTP- Header.       ,   Context .      ‚Äì . <br><br>      - -. <br><br><blockquote> ,         - .     SSO-         ‚Äì    . </blockquote><br>   ¬´ ¬ª     ,     - .    : <br><br><ol><li>         ; </li><li>      SSO- ,   ; </li><li>      SSO-; </li><li> SSO-,   Changed-To,  -    ; </li><li>      - ¬´¬ª,       ; </li><li>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">P1</a> ,        -,     (,     ). </li><li>   -,  ,       . </li></ol><br>   ,   , ,   .  UI-   : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w5/u1/aa/w5u1aahv-_os9k2d81c819d5zhg.gif"></div><br><blockquote>           SSO-.     . </blockquote><br><br>   ,       ,    Context    . <br><br><a name="R1"></a> <b>R1</b> ‚Äì        (   ).  Context         Context    . <br><br> ,    site.net   adriver.ru,       img.disk.com,    HTTP-  img.disk.com    Context  ,      site.net. <br><br><a name="R4"></a> <b>R4</b> ‚Äì ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">R1</a> .     /  ,     DOM Parser . ,   site.net/index.html   site.net/require.js      ( &lt;script src=‚Ä¶&gt;) site.net/min.js,         main.js.  Context       ,      site.net. <br><br><a name="R7"></a> <b>R7</b> ‚Äì ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">R1</a> .      /  ,          Context   256- .      evil.com/drop.js,      site.net,       site.net     , ..            . <br><br><a name="RA"></a> <b>RA</b> ‚Äì         . ,   site.net/css/common.css,    site.net/index.html,    fonts.google.com/fonts/Roboto.css,        fonts.google.com   Referrer = site.net/css/common.css.  Context      Referrer.    Roboto.css   Roboto.ttf,        fonts.google.com/fonts/Roboto.ttf   Referrer = fonts.google.com/fonts/Roboto.css.  Context       Referrer,   . <br><br> , ,   Roboto.css ( )   /,    CSRF-  : <pre><code class="css">@import "https://site.net/api/payment?victim_params"</code> </pre>  in der Hoffnung, die Anfrage auf site.net im Namen eines autorisierten Benutzers zu erf√ºllen.  Das Problem f√ºr den Angreifer ist jedoch, dass site.net erwartet, ein Token vom Benutzer zu erhalten: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/18c/ba0/6d3/18cba06d3ab48142219dbf3e3f4e2330.svg" alt="$ T_s ^ 1 = HMAC_k (site.net \ cup site.net \ cup site.net) $" data-tex="display"></p><br>  Dann erstellt der Browser wie bei einer solchen CSRF-Anforderung ein Token: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/466/929/b86/466929b86ade0b848996042a3ac12f25.svg" alt="$ T_s ^ 2 = HMAC_k (fonts.google.com \ cup site.net \ cup fonts.google.com) $" data-tex="display"></p><br>  Eine Anfrage an die Site erfolgt im Namen einer anonymen Site, die keine Zugriffsrechte zum Ausf√ºhren dieser Vorg√§nge besitzt. <br><br><a name="RB"></a>  <b>RB</b> - Der Inhalt wird vom eigenen Skript der Site hochgeladen.  In diesem Fall wird der Kontext verwendet, um das Anforderungstoken zu berechnen, das der Seite entspricht, die das Skript enth√§lt.  F√ºr das Skript site.net/1.js auf der Kontext-Seite site.net entspricht es dem Kontext der Seite selbst. <br><blockquote>  Beachten Sie, dass der Kontext der Seite selbst nicht immer dem Dom√§nennamen der Seite entspricht und davon abh√§ngt, wie sie urspr√ºnglich ge√∂ffnet wurde. </blockquote>  Angenommen, die Site des Angreifers evil.com √∂ffnet die Seite der angegriffenen Site site.net, auf der das Skript site.net/util.js eine Anforderung mit den √ºber die Seiten-URL √ºbergebenen Parametern ausf√ºhrt.  Der Angreifer hofft, durch Verschieben von ‚Äûseinen Parametern‚Äú durch die URL sein eigenes site.net/util.js-Skript zu zwingen, eine Ajax-Anforderung auszuf√ºhren, um wichtige Aktionen im Namen des Opfers auszuf√ºhren. <br><br>  Angenommen, der Benutzer selbst ist √ºber einen direkten Link zu evil.com gegangen.  Dann ist der Kontext f√ºr evil.com evil.com.  Weiter √∂ffnet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">evil.com site.net/api/payment?victim_params</a> mit einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Skript</a> , in der Hoffnung, einen Angriff durchzuf√ºhren, aber das Kontextfeld f√ºr site.net ist leer (PE / PF-Fall).  Das Skript site.net/utils.js, das eine Ajax-Anforderung ausf√ºhrt, zwingt den Browser, den Kontext von der Seite site.net zu √ºbernehmen.  Und es ist leer bei uns.  Aber dann erh√§lt site.net eine Ajax-Anfrage mit diesem Token: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/866/a41/990/866a41990a710d17dbe34a04ecb2e28c.svg" alt="$ T = HMAC_ {site.ru-key} (site.net \ cup site.net \ cup random) $" data-tex="display"></p><br>  F√ºr einen autorisierten Benutzer wird Folgendes erwartet: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/025/1b3/fad/0251b3fadaf0e4f1535b6aa8a67df332.svg" alt="$ T_s = HMAC_ {site.ru-key} (site.net \ cup site.net \ cup site.net) $" data-tex="display"></p><br>  site.net sieht ein unbekanntes Token und kann den Benutzer nicht identifizieren.  Der Schutz hat funktioniert. <br><blockquote>  √úbrigens ist es aufgrund eines solchen Schemas unrealistisch, eine dom√§nen√ºbergreifende Autorisierung √ºber Popups durchzuf√ºhren. </blockquote>  Um SSO unter dem Protokoll zu implementieren, m√ºssen Sie eine neue Registerkarte f√ºr die Seite des Autorisierungsservers √∂ffnen.  Gleichzeitig muss der Benutzer eine solche Registerkarte √∂ffnen.  Am besten √∂ffnen Sie dem Benutzer den entsprechenden Link von der Zielwebsite. <br><br><a name="RC"></a>  <b>RC</b> - Inhalte werden mit einem externen Website - Skript geladen.  In diesem Fall wird Context verwendet, um das Anforderungstoken zu berechnen, das dem Feld Request Referrer entspricht. <br><br>  Trotz der Tatsache, dass <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RA</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RB</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RC</a> vor CSRF-Angriffen sch√ºtzen, f√ºhren sie dennoch zur Erzeugung konstanter Token.  Auf <b>diese Weise k√∂nnen Sie die dom√§nen√ºbergreifende Authentifizierung und die dom√§nen√ºbergreifende</b> Benutzerauthentifizierung <b>implementieren</b> (wenn Sie feststellen m√ºssen, dass mehrere Anforderungen an verschiedene Server von diesem Benutzer stammen).  Was kann implementiert werden, um ihm die gleiche Autorit√§t in einer Gruppe verwandter Dom√§nen zu verleihen? <br><br>  Wenn die <b>Site-Seite automatisch</b> von einer anderen Site aus <b>ge√∂ffnet wurde</b> , k√∂nnen Sie sich dort nicht anmelden, selbst wenn Sie diese Site selbst neu laden.  Weil Source von einem Nullwert erbt.  Der Browser sollte dem Benutzer dies mitteilen (Quelle = Zufall): <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1h/pr/ew/1hprewdwumpuwpzmzkqfmbds104.jpeg"></div><br>  Dies geschieht zum Schutz vor Sites, die das √ñffnen anderer Popup-Fenster erzwingen (selbst oder deren externe Skripte). Auf den ge√∂ffneten Sites werden sie neu gestartet oder es werden gef√§lschte Schaltfl√§chen zum Schlie√üen auf dem gesamten Bildschirm erstellt, die zu denselben Sites f√ºhren.  Das hei√üt,  Dies verhindert einen Versuch, Sie zu verfolgen, in der Hoffnung, ein g√ºltiges Token zu erhalten. <br><br>  <b>Jeder Versuch der Site, Ihre Aktionen mit einem externen Skript nachzuahmen</b> , oder ein Versuch eines externen Skripts, direkt oder indirekt ein initiierendes Tag zu erstellen und an Sie zu senden, f√ºhrt zum Zeitpunkt der Berechnung des Token-Hash zu einer leeren Quelle und dem Hinzuf√ºgen von zuf√§lligen Bytes. <br><br>  Der Trick beim Erstellen oder √Ñndern des &lt;script&gt; -Tags auf der angegriffenen Seite im DOM hilft nicht weiter.  Das Feld Quelle bleibt leer. <br><br>  Unter den gleichen Bedingungen f√ºhren interne Skripte jedoch zu Abfragen, bei denen Source dem vorherigen Wert entspricht.  Und wenn die urspr√ºngliche Seite Source = Domain h√§tte, w√§re alles in Ordnung.  Der Benutzer bleibt f√ºr solche Anfragen autorisiert. <br><br>  Bei Skripten, die von Drittanbieter-Ressourcen (CDN) heruntergeladen wurden, k√∂nnen in einigen F√§llen Probleme auftreten.  Und es ist richtig, weil  Die Integrit√§t des CDN-Codes kann nicht garantiert werden.  Wenn Sie die Benutzerberechtigung nicht verlieren m√∂chten, behalten Sie die Skripte auf Ihrer Website und laden Sie sie von Ihrer Domain herunter.  Dies ist so etwas wie das Verbot der Verwendung von http-Links auf https-Seiten. <br><br>  Wir beschreiben die Situation, in die ein Entwickler geraten k√∂nnte.  Aufgrund von Benutzeraktionen leitet Ihr Skript einen autorisierten Benutzer auf eine der Seiten der Site weiter (dies erfolgt beispielsweise √ºber ein Formular), sodass der Benutzer weiterhin autorisiert bleiben muss.  Ihr Skript ruft beispielsweise $ (form) .submit () mit einem vom CDN geladenen jQuery-Skript auf.  In diesem Fall sieht der Browser, dass im Aufrufstapel, der das √úbermittlungsereignis des Formulars ausgel√∂st hat, eine Funktion aus einem externen Skript vorhanden ist.  Um <abbr title="Cross-Site-Scripting - &quot;Cross-Site-Scripting&quot;">XSS</abbr> / <abbr title="F√§lschung von standort√ºbergreifenden Anfragen - &quot;F√§lschung von standort√ºbergreifenden Anfragen&quot;">CSRF-</abbr> Angriffe zu verhindern, macht der Browser das Feld Quelle leer und f√ºgt der Generierung des Tokens zuf√§llige Bytes hinzu (Fall <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">P9</a> ).  Infolgedessen wird der Benutzer auf der neuen Seite pl√∂tzlich nicht mehr autorisiert und kann den Vorgang nicht abschlie√üen.  Dies kann f√ºr Entwickler, die an die Verwendung von CDNs gew√∂hnt sind, verwirrend sein. <br><br><a name="protocol_scenario"></a><h2>  2.7 Protokollszenarien </h2><br>  Hier sind die wichtigsten wahrscheinlichen Szenarien f√ºr die Arbeit des Benutzers mit der Site aufgef√ºhrt, die sich auf alle m√∂glichen Situationen und die Phasen ihrer Implementierung auswirken (anonyme Anmeldung, "Erinnere dich an mich", "Vergiss mich", Umstellung auf die Verwendung eines permanenten Schl√ºssels, Autorisierung und Beenden, Registrierung und Zwei-Faktor-Authentifizierung, Export / Schl√ºsselimport, Schl√ºsselersatz usw.) <br><div class="scrollable-table"><table><tbody><tr><th colspan="3">  1 Forum, Blog, Wikipedia </th></tr><tr><th>  Benutzer </th><th>  Browser </th><th>  Standortserver </th></tr><tr><td>  1.1 Erster Zugriff auf diese Site. </td><td>  Erzeugt einen zuf√§lligen Schl√ºssel.  Sendet ein unsicheres Token von einem zuf√§lligen Schl√ºssel. </td><td>  Wir betrachten den Benutzer als anonym.  Wir verwenden dieses Token als Kennung der Benutzersitzung. </td></tr><tr><td>  1.2 Seiten anzeigen. </td><td>  Sendet ein sicheres Token gegen einen zuf√§lligen Schl√ºssel. </td><td>  Bietet √∂ffentlichen Inhalt.  √úberpr√ºft das untere 128-Bit-Token-Bit. </td></tr><tr><td>  1.3 Versuchen, Aktionen auszuf√ºhren (Kommentare hinzuf√ºgen usw.) </td><td>  Sendet ein sicheres Token gegen einen zuf√§lligen Schl√ºssel. </td><td>  Sagt dem Benutzer, dass er sich dem System vorstellen muss.  Zu diesem Zeitpunkt ist die Site zuversichtlich, dass der Schl√ºssel zuf√§llig ist. </td></tr><tr><td>  1.4 Weist den Browser an, die Site daran zu erinnern. </td><td>  Behebt den aktuellen Schl√ºssel.  Sendet einen permanenten Schl√ºssel.  Das Token wird nach wie vor in gesch√ºtzter Form √ºbertragen.  Sendet diesen Schl√ºssel, bis er vom Server erfolgreich empfangen wird. </td><td>  Jetzt wei√ü die Site, dass der Schl√ºssel fest ist.  Sendet CSI-Token-Aktion: Erfolg.  Es kann die Technik anwenden, sich lange an den Benutzer zu erinnern: Entweder speichert es das Token in der Datenbank f√ºr die zuk√ºnftige Wiederherstellung der Sitzung mit dem Benutzer.  Oder h√§lt die Sitzung f√ºr eine l√§ngere Zeit (in Datei speichern). </td></tr><tr><td>  1.5 F√ºhrt Aktionen aus (Hinzuf√ºgen von Posts, Abstimmen usw.) </td><td>  Sendet ein sicheres CSI-Token von einem festen Schl√ºssel. </td><td>  Protokolliert Aktionen dieses Benutzers. </td></tr><tr><td>  1.6 Schlie√üt die Registerkarte Browser. </td><td>  Nichts. </td><td>  Es wartet auf die folgenden Benutzeranforderungen. </td></tr><tr><td>  1.7 Geht zur√ºck zur Site. </td><td>  Sendet einen sicheren festen Schl√ºssel. </td><td>  Arbeitet weiter mit dem Benutzer.  Sitzungsdaten werden per Token aus der Datenbank oder der tempor√§ren Datei entnommen. </td></tr><tr><td>  1.8 Macht die Tastenfixierung r√ºckg√§ngig (vergiss mich auf dieser Seite) </td><td>  Sendet einen Abmeldeschl√ºssel </td><td>  L√∂scht Benutzerdaten in der Datenbank als  Es war ein fester Schl√ºssel, und der Benutzer kann ihn nie wieder wiederherstellen.  Beendet die Sitzung.  Der Browser wird ein solches Token nie wieder senden. </td></tr><tr><td>  1.9 Wenn Sie nach dem Abmelden zum ersten Mal auf die Site zugreifen. </td><td>  Erzeugt einen zuf√§lligen Schl√ºssel.  Sendet ein unsicheres Token von einem zuf√§lligen Schl√ºssel. </td><td>  Diese Seite ist bereits ein neuer Benutzer.  Wir betrachten den Benutzer als anonym.  Wir verwenden das Token als Kennung der Benutzersitzung. </td></tr><tr><td>  1.10 Seiten durchsuchen. </td><td>  Sendet ein sicheres Token gegen einen zuf√§lligen Schl√ºssel. </td><td>  Bietet √∂ffentlichen Inhalt.  √úberpr√ºft das untere 128-Bit-Token-Bit. </td></tr><tr><td>  1.11 Schlie√üt die Registerkarte Browser. </td><td>  Nichts. </td><td>  Unterbricht eine Sitzung nach einer Zeit√ºberschreitung. </td></tr><tr><td>  1.12 Geht zur√ºck zur Site. </td><td>  Erzeugt einen zuf√§lligen Schl√ºssel.  Sendet ein unsicheres Token von einem zuf√§lligen Schl√ºssel. </td><td>  Wir betrachten den Benutzer als anonym.  Wir verwenden dieses Token als Kennung der Benutzersitzung. </td></tr><tr><td>  1.13 Erstellt einen permanenten Site-Schl√ºssel. </td><td>  Nichts. </td></tr><tr><td>  1.14 Aktivierung des permanenten Schl√ºssels. </td><td>  <b>Fragt den Benutzer: M√∂chten Sie wirklich, dass sich die Site an Ihren Schl√ºssel erinnert?</b>  <b>Stellen Sie sicher, dass diese Site die ist, f√ºr die sie sich ausgibt.</b> <br>  Sendet Change-To.  Erst in diesem Moment gibt der Browser das Token an den ungesch√ºtzten weiter.  In allen folgenden F√§llen √ºbertr√§gt der Browser beim Anmelden immer ein gesch√ºtztes Token.  Daf√ºr muss die Site jedoch die √Ñnderung von Token durch CSI-Token-Action best√§tigen: Erfolg. </td><td>  Denken Sie an das neue Benutzertoken in der Datenbank.  √Ñndert die Sitzungs-ID.  Wartet weiterhin auf Anforderungen vom neuen Token.  Sendet CSI-Token-Aktion: Erfolg. </td></tr><tr><td>  1.15 F√ºhrt Aktionen aus (Hinzuf√ºgen von Posts, Abstimmen usw.) </td><td>  Sendet ein sicheres Token von einem permanenten Schl√ºssel </td><td>  Protokolliert Aktionen dieses Benutzers.  √úberpr√ºft das untere 128-Bit-Token. </td></tr><tr><td>  1.16 Macht den "Exit". </td><td>  Sendet einen Abmeldeschl√ºssel </td><td>  Unterbricht die Sitzung </td></tr><tr><td>  1.17 Geht zur√ºck zur Site. </td><td>  Erzeugt einen zuf√§lligen Schl√ºssel.  Sendet ein unsicheres Token von einem zuf√§lligen Schl√ºssel. </td><td>  Wir betrachten den Benutzer als anonym.  Wir verwenden das Token als Kennung der Benutzersitzung. </td></tr><tr><td>  1.18 Aktivierung des permanenten Schl√ºssels. </td><td>  Sendet Change-To.  Das Token ist bereits gesch√ºtzt, weil  Das letzte Mal, als die Seite uns antwortete CSI-Token-Action: Erfolg. </td><td>  Wir laden die gespeicherten Benutzerdaten aus der Datenbank.  √Ñndert die Sitzungs-ID.  Wir arbeiten mit dem gespeicherten Token.  Wir wissen, dass ein Token auf einem permanenten Schl√ºssel basiert. </td></tr><tr><td>  1.19 Schlie√üt die Registerkarte Browser. </td><td>  Nichts.  Oder die Abmeldetaste, wenn "Auto-Exit" konfiguriert ist, wenn die Registerkarte geschlossen wird. </td><td>  Unterbricht eine Sitzung nach einer Zeit√ºberschreitung oder nach Erhalt eines Abmeldeschl√ºssels. </td></tr><tr><th colspan="3">  2 Online-Shop oder Anzeigenseite </th></tr><tr><th>  Benutzer </th><th>  Browser </th><th>  Standortserver </th></tr><tr><td>  2.1 Zuerst auf dieser Site enthalten. </td><td>  Erzeugt einen zuf√§lligen Schl√ºssel.  Sendet ein unsicheres Token von einem zuf√§lligen Schl√ºssel. </td><td>  Wir betrachten den Benutzer als anonym.  Wir verwenden dieses Token als Kennung der Benutzersitzung. </td></tr><tr><td>  2.2 Seiten anzeigen. </td><td>  Sendet ein sicheres Token gegen einen zuf√§lligen Schl√ºssel. </td><td>  Bietet √∂ffentlichen Inhalt.  √úberpr√ºft das untere 128-Bit-Token-Bit. </td></tr><tr><td>  2.3 Versuchen, Aktionen auszuf√ºhren (Anzeigen, Eink√§ufe usw. hinzuf√ºgen) </td><td>  Sendet ein sicheres Token gegen einen zuf√§lligen Schl√ºssel. </td><td>  Sagt dem Benutzer, dass er sich dem System vorstellen muss.  Zu diesem Zeitpunkt ist die Site zuversichtlich, dass der Schl√ºssel zuf√§llig ist. </td></tr><tr><td>  2.4 Weist den Browser an, die Site daran zu erinnern. </td><td>  Behebt den aktuellen Schl√ºssel.  Vor der ersten Anforderung wird ein sicheres CSI-Token mit dem permanenten Schl√ºssel gesendet.  Nach erfolgreichem Empfang wird der Schl√ºssel nicht mehr gesendet. </td><td>  Jetzt wei√ü die Site, dass der Schl√ºssel fest ist.  Es kann die Technik anwenden, sich lange an den Benutzer zu erinnern: Entweder speichert es das Token in der Datenbank f√ºr die zuk√ºnftige Wiederherstellung der Sitzung mit dem Benutzer.  Oder h√§lt die Sitzung f√ºr eine l√§ngere Zeit (mehrere Tage). </td></tr><tr><td>  2.5 F√ºhrt Aktionen aus (Hinzuf√ºgen von Ank√ºndigungen, K√§ufen usw.) </td><td>  Sendet ein sicheres CSI-Token von einem festen Schl√ºssel. </td><td>  Protokolliert Aktionen dieses Benutzers.  √úberpr√ºft den Token. </td></tr><tr><td>  2.6 Schlie√üt die Registerkarte Browser. </td><td>  Nichts. </td><td>  H√§lt die Sitzung.  Bei l√§ngerer Inaktivit√§t werden Sitzungsdaten aus dem RAM in einer Datei oder Datenbank gespeichert. </td></tr><tr><td>  2.7 Meldet sich erneut bei der Site an. </td><td>  Sendet einen sicheren festen Schl√ºssel. </td><td>  Die Sitzung wird fortgesetzt.  Wir arbeiten mit dem Benutzer, als w√§re nichts passiert. </td></tr><tr><td>  2.8 <b>Erstellt oder importiert einen</b> dauerhaften Site-Schl√ºssel. </td><td>  Nichts. </td></tr><tr><td>  2.9 Aktivierung des permanenten Schl√ºssels.  Hier gibt es tats√§chlich einen √úbergang von der Verwendung eines festen zu einem dauerhaften Schl√ºssel. </td><td>  Sendet einen Wechselschl√ºssel.  Das Token wird <b>ungesch√ºtzt</b> f√ºr den neu erstellten Schl√ºssel und das nicht auf dem Server registrierte Token √ºbertragen.  Das Token wird <b>gesch√ºtzt</b> f√ºr den importierten Schl√ºssel √ºbertragen. </td><td>  2.9.A.  Token basierend auf dem neuen Schl√ºssel. <br>  Wenn das alte Token in der Datenbank gespeichert wurde, √§ndern Sie einfach das Token in der Datenbank. <br><br>  2.9.V.  Token basierend auf dem importierten Schl√ºssel. <br>  Wenn das alte Token in der Datenbank gespeichert wurde, l√∂schen Sie es.  Beim Zusammenf√ºhren von zwei Profilen eines Benutzers (wor√ºber Sie ihn fragen k√∂nnen) - weil  Tats√§chlich hat der Benutzer zwei Token in der Datenbank gespeichert: von einem festen Schl√ºssel und von einem importierten.  √Ñndert die Sitzungs-ID.  Sendet CSI-Token-Aktion: Erfolg.  Er wartet weiterhin auf Anfragen vom neuen Token. </td></tr><tr><td>  2.10 F√ºhrt Aktionen aus (K√§ufe, Anzeigenschaltung, Warenkorb, Favoriten, Bewertungen, Vergleiche) </td><td>  Sendet ein sicheres Token von einem permanenten Schl√ºssel </td><td>  Protokolliert Aktionen dieses Benutzers.  √úberpr√ºft das untere 128-Bit-Token. </td></tr><tr><td>  2.11 Schlie√üt die Registerkarte Browser. </td><td>  Nichts.  Oder die Abmeldetaste, wenn "Auto-Exit" konfiguriert ist, wenn die Registerkarte geschlossen wird. </td><td>  Unterbricht eine Sitzung nach einer Zeit√ºberschreitung oder nach Erhalt eines Abmeldeschl√ºssels. </td></tr><tr><th colspan="3">  3 Websites mit obligatorischer Vorregistrierung (soziales Netzwerk) </th></tr><tr><th>  Benutzer </th><th>  Browser </th><th>  Standortserver </th></tr><tr><td>  3.1 Auf dieser Website enthalten. </td><td>  Erzeugt einen zuf√§lligen Schl√ºssel.  Sendet ein unsicheres Token von einem zuf√§lligen Schl√ºssel. </td><td>  Wir betrachten den Benutzer als anonym.  Wir verwenden dieses Token als Kennung der Benutzersitzung.  Wir lassen nur in √∂ffentlichen Bereichen.  Wenn Sie versuchen, auf geschlossene Inhalte zuzugreifen, √ºbersetzen wir in das Autorisierungsformular. </td></tr><tr><td>  3.2 Erstellt einen permanenten Site-Schl√ºssel </td><td>  Nichts </td></tr><tr><td>  3.3 Aktivierung des permanenten Schl√ºssels. </td><td>  <b>Fragt den Benutzer: M√∂chten Sie wirklich, dass sich die Site an Ihren Schl√ºssel erinnert?</b>  <b>Stellen Sie sicher, dass diese Site die ist, f√ºr die sie sich ausgibt.</b> <br><br>  Sendet Change-To. <br>  <b>Der Token wird im Klartext √ºbertragen</b> . </td><td>  Erinnere dich an den neuen Token.  Wir haben es nicht eilig, in der Datenbank zu speichern, bis die Registrierung noch abgeschlossen ist.  Wir behalten den Benutzer auf dem Registrierungsformular, bis die Eigentumsbest√§tigung (per Telefon, Post) erfolgt.  Sendet CSI-Token-Aktion: Registrierung </td></tr><tr><td>  3.4 Geben Sie Ihre Kontaktdaten ein. </td><td>  Sendet Ajax-Anfragen.  Sendet Change-To.  Altes Token auf demselben Zufallsschl√ºssel. <br>  <b>Das neue Token wird bereits in gesch√ºtzter Form √ºbertragen</b> . <br><br>  Sobald es erfolgreich ist, wird ein neues Token (permanenter Schl√ºssel) verwendet. </td><td>  √úberpr√ºft die Kontaktdaten.  Wenn alles erfolgreich ist, sendet es CSI-Token-Action: Erfolg.  Ansonsten: CSI-Token-Aktion: Registrierung.  Wenn CSI-Token-Action: Abbruch gesendet wird, ist die Registrierung nicht erfolgreich.  Der Browser sollte wieder eine Zufallszahl verwenden (Eingabe abbrechen).  Und melden Sie dies dem Benutzer. </td></tr><tr><td>  3.5 Geht zum geschlossenen Bereich der Site </td><td>  Sendet ein sicheres Token von einem permanenten Schl√ºssel. </td><td>  Bietet Zugriff durch √úberpr√ºfen des unteren 128-Bit-Tokens. </td></tr><tr><td>  3.6 F√ºhrt Aktionen aus (K√§ufe, Anzeigenschaltung, Warenkorb, Favoriten, Bewertungen, Vergleiche) </td><td>  Sendet ein sicheres Token von einem permanenten Schl√ºssel. </td><td>  Protokolliert Aktionen dieses Benutzers.  √úberpr√ºft das untere 128-Bit-Token. </td></tr><tr><td>  3.7 Schlie√üt die Registerkarte Browser. </td><td>  Nichts.  Oder die Abmeldetaste, wenn "Auto-Exit" konfiguriert ist, wenn die Registerkarte geschlossen wird. </td><td>  Unterbricht eine Sitzung nach einer Zeit√ºberschreitung oder nach Erhalt eines Abmeldeschl√ºssels. </td></tr><tr><td>  3.8 In dieser Site enthalten. </td><td>  Erzeugt einen zuf√§lligen Schl√ºssel.  Sendet ein unsicheres Token von einem zuf√§lligen Schl√ºssel. </td><td>  Wir betrachten den Benutzer als anonym.  Wir verwenden dieses Token als Kennung der Benutzersitzung.  Wir lassen nur in √∂ffentlichen Bereichen.  Wenn wir versuchen, auf geschlossene Inhalte zuzugreifen, informieren wir den Benutzer, dass er ein anonymer Benutzer ist. </td></tr><tr><td>  3.9 Aktivierung des permanenten Schl√ºssels. </td><td>  Sendet Change-To.  Beide Token werden sicher √ºbertragen. </td><td>  Wir laden Benutzerdaten aus der Datenbank per Token (das h√∂chste 128-Bit).  Jetzt wei√ü die Site, wer dieser Benutzer ist. </td></tr><tr><td>  3.10 √Ñndert den permanenten Dom√§nenschl√ºssel (in einen anderen permanenten) </td><td>  <b>Fragt den Benutzer: M√∂chten Sie wirklich, dass sich die Site an Ihren neuen Schl√ºssel erinnert?</b>  <b>Stellen Sie sicher, dass diese Site die ist, f√ºr die sie sich ausgibt.</b> <br><br>  Sendet Change-To. <br>  <b>Der neue Token wird im Klartext √ºbertragen.</b>  <b>alt - in gesch√ºtzt</b> <br></td><td>  √Ñndert das Token in der Datenbank in ein neues.  L√§dt Profildaten.  Verwendet ein neues Token aus den folgenden Anforderungen.  Sendet CSI-Token-Aktion: Erfolg </td></tr><tr><td>  3.11 F√ºhrt Aktionen aus (Hinzuf√ºgen von Posts, Abstimmen usw.) </td><td>  Sendet ein sicheres Token von einem neuen Schl√ºssel </td><td>  Protokolliert Aktionen dieses Benutzers.  √úberpr√ºft das untere 128-Bit-Token. </td></tr><tr><td>  3.12 Macht einen "Exit". </td><td>  Sendet einen Abmeldeschl√ºssel </td><td>  Unterbricht die Sitzung </td></tr><tr><td>  3.13 Auf dieser Site enthalten. </td><td>  Erzeugt einen zuf√§lligen Schl√ºssel.  Sendet ein unsicheres Token von einem zuf√§lligen Schl√ºssel. </td><td>  Wir betrachten den Benutzer als anonym.  Wir verwenden dieses Token als Kennung der Benutzersitzung.  Wir √ºbersetzen in das Autorisierungsformular. </td></tr><tr><td>  3.14 Permanenten Schl√ºssel aktivieren </td><td>  Sendet Change-To.  Beide Token werden sicher √ºbertragen. </td><td>  Wir laden Benutzerdaten aus der Datenbank per Token (das h√∂chste 128-Bit). </td></tr><tr><td>  3.15 Importiert einen anderen Schl√ºssel f√ºr diese Domain. <br>  <b>Wichtig: Der importierte Schl√ºssel muss auf dem Server registriert sein.</b> <br></td><td>  Sendet einen Schl√ºssel. Abmelden Wechselt zur Verwendung eines zuf√§lligen Schl√ºssels. </td><td>  Unterbricht die Sitzung </td></tr><tr><td>  3.16 Aktiviert einen neuen Schl√ºssel </td><td>  Sendet Change-To. <br>  <b>Beide Token werden sicher √ºbertragen.</b> <br><br>  Bitte beachten Sie, dass der ‚Äûvorherige‚Äú Schl√ºssel bereits ein zuf√§lliger Schl√ºssel ist (siehe 3.15). </td><td>  Dieser Schl√ºssel muss der Datenbank bekannt sein.  <b>Der Schl√ºsselexport</b> aus dem Browser ist nur f√ºr registrierte Token zul√§ssig.  Somit ist der Browser sicher, dass der <b>importierte Schl√ºssel dem Server bekannt ist,</b> und sendet ihn sicher.  Andernfalls kann der Server das Benutzertoken nicht erkennen und nicht autorisieren. </td></tr><tr><td>  3.17 F√ºhrt Aktionen aus (Hinzuf√ºgen von Posts, Abstimmen usw.) </td><td>  Sendet ein sicheres Token von einem neuen Schl√ºssel </td><td>  Protokolliert Aktionen dieses Benutzers.  √úberpr√ºft das untere 128-Bit-Token. </td></tr><tr><td>  3.18 kommt heraus </td><td>  Sendet einen Abmeldeschl√ºssel </td><td>  Unterbricht die Sitzung </td></tr><tr><th colspan="3">  4 Websites mit Zwei-Faktor-Berechtigung (Sberbank Online) </th></tr><tr><th>  Benutzer </th><th>  Browser </th><th>  Standortserver </th></tr><tr><td>  4.1 Auf dieser Website enthalten. </td><td>  Erzeugt einen zuf√§lligen Schl√ºssel.  Sendet ein unsicheres Token von einem zuf√§lligen Schl√ºssel. </td><td>  Wir betrachten den Benutzer als anonym.  Wir verwenden dieses Token als Kennung der Benutzersitzung.  Wir √ºbersetzen in das Autorisierungsformular. </td></tr><tr><td>  4.2 Erstellt einen permanenten Site-Schl√ºssel </td><td>  Nichts </td></tr><tr><td>  4.3 Aktivierung des permanenten Schl√ºssels. </td><td>  <b>Fragt den Benutzer: M√∂chten Sie wirklich, dass sich die Site an Ihren Schl√ºssel erinnert?</b>  <b>Stellen Sie sicher, dass diese Site die ist, f√ºr die sie sich ausgibt.</b> <br><br>  Sendet Change-To. <br>  <b>Der Token wird im Klartext √ºbertragen</b> . </td><td>    .   .     .  CSI-Token-Action: registration. </td></tr><tr><td> 4.4     .  ¬´¬ª </td><td>  Change-To      success.       . <br> <b>      .</b> <br></td><td>   .    . </td></tr><tr><td> 4.5      . </td><td>  ajax-.      Change-To. <br><br>    success,      ( ). </td><td>   .      ( ).  CSI-Token-Action: success <br>       . <br>    ,  CSI-Token-Action: registration. <br><br>      CSI-Token-Action: abort.    ,      . </td></tr><tr><td> 4.6    . </td><td>   Token    </td><td>        . </td></tr><tr><td> 4.7  ¬´¬ª   </td><td>   Logout </td><td>   </td></tr><tr><td> 4.8    . </td><td>   .      . </td><td>   .        .          ¬´¬ª. </td></tr><tr><td> 4.9   . </td><td>  Change-To. <br> <b>    </b> (..   ;    ). </td><td>        ( 128-).  ,        .      ,   .    .   CSI-Token-Action: success </td></tr><tr><td> 4.10      . </td><td>  ajax-.         . </td><td>  .  .  .       . </td></tr><tr><td> 4.11    . </td><td>   Token   . </td><td>        . </td></tr><tr><td> 4.12  ¬´¬ª   </td><td>   Logout </td><td>   </td></tr><tr><td> 4.12     (). </td><td>    Logout,   ¬´¬ª   .  . </td><td>  ,     Logout.   . </td></tr><tr><th colspan="3"> 5  :   ESXi </th></tr><tr><th>  Benutzer </th><th>  </th><th>   </th></tr><tr><td> 5.1    . </td><td>   .      . </td><td>   .        .   . </td></tr><tr><td> 5.2    . </td><td></td><td></td></tr><tr><td> 5.3     ( ,   ).  ,   <i></i> . </td><td></td><td></td></tr><tr><td> 5.4     (SSH, RDP).      (  .htaccess ‚Äì .  ) </td><td></td><td></td></tr><tr><td> 5.5   </td><td>  </td><td>     </td></tr><tr><td> 5.6    . </td><td>   .      . </td><td>   .        .   . </td></tr><tr><td> 5.7   . </td><td>  Change-To. <br> <b>    </b> (..  ,         ;     <i></i> ). </td><td>        (. ). <br><br>     ( 128-). <br>    128-.     . <br>   CSI-Token-Action: success. <br>   CSI-Token-Action: abort (    ),   403 ‚Äì Forbidden. <br>     . </td></tr><tr><td> 5.8    </td><td>      . </td><td>        . </td></tr><tr><td> 5.9   </td><td>    Logout,   ¬´¬ª   .  . </td><td>  ,     Logout.   . </td></tr><tr><th colspan="3"> 6  :   </th></tr><tr><th>  Benutzer </th><th>  </th><th>   </th></tr><tr><td> 6.1    . </td><td>   .      . </td><td>   .        . <b>   .</b>   CSI-Support: yes; </td></tr><tr><td> 6.2   . </td><td></td><td></td></tr><tr><td> 6.3   . </td><td> <b> :   ,     ? ,     ,    .</b> <br><br>  Change-To. <br> <b>    </b> . </td><td>  ,   CSI-Token-Action: registration, ..   . </td></tr><tr><td> 6.4  /  ¬´ ¬ª </td><td>  / POST-  .      Change-To,    . </td><td>  /.    .    .  CSI-Token-Action: success </td></tr><tr><td> 6.5           ¬´¬ª </td><td>     Token    </td><td>    /.  . </td></tr><tr><td> 6.6  </td><td>   Logout </td><td>   </td></tr><tr><td> 6.7    . </td><td>   .      . </td><td>   . <b>  ¬´ ¬ª</b> <br></td></tr><tr><td> 6.8   . </td><td>  Change-To. <b>    </b> (..   ;    ). </td><td>     128- .   . </td></tr><tr><td> 6.9    </td><td>   Token    </td><td>       . </td></tr><tr><td> 6.10  </td><td>   Logout </td><td>   </td></tr></tbody></table></div><br>         .htaccess. <br><pre> <code class="apache">&lt;Directory "/var/www/html"&gt; AuthType CSI AuthName "Restricted Content" AuthTokensFile /etc/apache2/.csi_keys Require valid-user &lt;/Directory&gt;</code> </pre><br><pre> cat /etc/apache2/.csi_keys </pre><pre> <code class="bash"># # Client Self Identification tokens file # # CSI-Domain-Key UserName Role 84bc3da1b3e33a18e8d5e1bdd7a18d7a166d77ac1b46a1ec38aa35ab7e628ab5 MelnikovIN admin 6d7fce9fee471194aa8b5b6e47267f0348a24b70a0b376535542b996af517398 BoshirovAM user</code> </pre> <br><br><a name="token_algo_for_server"></a><h2> 2.7.1          </h2><br>     K ,      ¬´¬ª  T ,     .   ,    :  ,           .  ,      vsphere.local, : <br><pre> <code class="plaintext">Sender = Recipient = Context = vsphere.local</code> </pre> <br>   ()  , : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/af8/1c2/5b0/af81c25b054111db5d526fcfb8c4fb8c.svg" alt="$T_s = HMAC_{K}(Sender \cup Recipient \cup Context)$" data-tex="display"></p><br>  ,     .  128     ,     CSI-Salt <sup>*</sup> .  ,    : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/8ea/b59/cc3/8eab59cc3e5060cfec9956f984807b5f.svg" alt="$T = Hi(T_s) \cup HMAC_{salt}( Lo(T_s) )$" data-tex="display"></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wobei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hi</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die hohen 128 Bit sind, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die niedrigen 128 Bit des urspr√ºnglichen Tokens. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bei geschlossenen Verwaltungskonsolen in einem Unternehmensnetzwerk laden Webkonsolen normalerweise keine externen Skripts, Frames usw. </font><font style="vertical-align: inherit;">Daher ist diese Bedingung in den meisten F√§llen erf√ºllt.</font></font><br><hr> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Informationen zur Salzbildung finden Sie im Abschnitt </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄûSalzaustauschverfahren zwischen Browser und Server‚Äú.</font></font></a></sup> <br><br><a name="server_token_processing"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.8 Token auf dem Server verarbeiten </font></font></h2><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Senden eines Tokens an den Server (ohne Schl√ºssel) </font></font></h3><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Token T-Status in der Standortsitzung </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Site Server-Aktionen </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Unbekannt </font></font></td><td>         ,              . <br><br>   .   . <br>   128       . <br>     .      CSI-Salt. <br><br></td></tr><tr><td>  ( 128 ) </td><td>   . <br>      CSI-Salt ‚Äì   . <br>    .       CSI-Token. <br><br>   ,  CSI-Token-Action: invalid.    400. <br><br>    ‚Äì  200. <br><br></td></tr></tbody></table></div><br><br><h3>     Permanent </h3><br>    .  ,     ,    .        ‚Äì   .   CSI-Token-Action: success  CSI-Token-Action: abort. <br><br><h3>     Logout </h3><br>   ,        .     ¬´¬ª  ,       (   ),       (¬´    ¬ª). <br><blockquote> , ,   .   . </blockquote><br><br><h3>     Change-To </h3><br>    T,  ‚Äì '. <br><br> <b>:</b>     T'     (  ,  ),       ( 128 ). <br><div class="scrollable-table"><table><tbody><tr><td colspan="2">      <sup>*</sup> </td><td rowspan="2">      </td></tr><tr><td>  T. </td><td> T' </td></tr><tr><td>  </td><td>  </td><td> : <b> </b> . <br><br>      T' <br>   CSI-Token-Action: success. <br><br>         ¬´¬ª.        .        (   ). <br><br>    CSI-Token-Action: registration,   ,     (        ).        Change-To (   )   ,     success  abort.   ,  ,     .   ‚Äì      (  ). <br></td></tr><tr><td>  </td><td>  ist da </td><td> : <b> Login</b> . <br><br>    T'  .   .   .   CSI-Token-Action: success. <br><br> <b></b> .         Change-To   ,    CSI-Token-Action: success, <b>  </b>    Change-To   <b>  </b> . <br>    ,       .          . <br>  <b>     </b> ,       ¬´¬ª .    <b>      </b> ,       -.  Weil    ¬´  ¬ª,    . <br></td></tr><tr><td>  ist da </td><td>  </td><td> : <b>  </b>   . <br><br>    T     T'.   . <br>   CSI-Token-Action: success. <br></td></tr><tr><td> , <br>  der Schl√ºssel <br>  <br></td><td>  ist da </td><td> : <b>     </b> <br><br>  ,         ,      -.                  -     . <br><br>            (  ).      ‚Äì . <br><br>   .   CSI-Token-Action: success <br></td></tr><tr><td> , <br>  der Schl√ºssel <br>  nicht <br> . <br></td><td>  ist da </td><td>  .            .   .  CSI-Token-Action: abort.   . <br><br>  256-       SHA-2.      ( )         . <br><br>          : <ul><li>      ; </li><li>         ; </li><li>    </li></ul>      .   , ‚Äì  -    . <br>     ,      .        Logout   .   Login  .  . <br></td></tr></tbody></table></div><hr> <sup>*        ,    .</sup> <br><br><a name="sub_domain_identify"></a><h2> 2.9 -  </h2><br>    ,      -   -,      .   ,    site.ru      img.site.ru,  download.site.ru,     . <br><br>     site.ru      -,       . ,     site.ru,         ,  - .       . <br><br>  ,         . <br>      site.ru      : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/a5a/e9b/500/a5ae9b500f4fd8f2600eafdb3a315d32.svg" alt="$T_1 = HMAC_{site.ru-key}(site.ru \cup site.ru \cup site.ru)$" data-tex="display"></p><br>  ,     site.ru   site.ru  : <br><ul><li>    (   ) </li><li>   </li></ul>    T <sub>1</sub> (.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">R1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">R4</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RB</a> ).      site.ru. <br><br>          site.ru,     download.site.ru.        ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">R1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">R4</a> ): <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/445/897/361/445897361e99df033e11f354f37071af.svg" alt="$T_2 = HMAC_{site.ru-key}(site.ru \cup download.site.ru \cup site.ru)$" data-tex="display"></p><br><br>      download.site.ru ,      ajax-    site.ru ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RB</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RC</a> ). <br><br>   domain   : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/231/d05/899/231d058996ea04e27a4a67dbdadf68ee.svg" alt="$T_3 = HMAC_{site.ru-key}(site.ru \cup domain \cup site.ru)$" data-tex="display"></p><br><br> ,  ,      ,      A, B, C      .     - . , . <br><br>   site.ru  ajax-  .   ID != T <sub>1</sub> ,    site.ru.       ID  T <sub>x</sub> .         ID .    ID        . <br><br>   .  ,      , ..     site.ru   . <br><br><a name="part3"></a><h1> 3    </h1><br><div class="spoiler">  <b class="spoiler_title">Hinweis</b> <div class="spoiler_text">      .          . </div></div><br><br><a name="keys_NAA_protection"></a><h2> 3.1      </h2><br>        ,   ,        . <br><br>          . <br><br>     : <br><br><ul><li>      ( ) </li><li>        ¬´¬ª ( ) </li><li>      </li></ul><br>  ,      - (      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">¬´  ¬ª</a> ),         .      ,     PIN-;     . <br><br>  -            .  :     ? <br><br>        ,  -,      ¬´¬ª, -, ,   ,    : ¬´ - ¬ª. <br><br>    <b>   <sup>*</sup>     </b> (     ).       ,       .     100%  ,      .        ,   ,  ,     . <br><br>          ,         (..     ).       (  )  ,          ‚Äì .    -              . <br><br>    :     +        (   API ).     ¬´ ¬ª.      . <br><br>  ,      ,   .         ,     ,      ,             .  :   . <br><br>        (   ). , ,           . <br><hr> <sup>*, 32-      64-  .            .</sup> <br><br><a name="why_password_for_keys_not_good"></a><h2> 3.2       </h2><br>              .   ,            . <br><br>        .         .    : <br><br><ol><li>     ,     ¬´¬ª ,        ,   .   ,       -,          . <br><br>  (),     8-  ,       ,    .: ~!@#$%^&amp;.   : 26 + 26 + 10 + 8 = 70 . 8-       70 <sup>8</sup> . <br><br> ,     ,         10 <sup>12</sup>   .      70 <sup>8</sup> / 10 <sup>12</sup> = ~576 .  Das hei√üt,       ~10 .          5       . 10-      15 .      10 ,      1-2 . <br><br>           ,        . </li><li>       ,     . </li><li>                ,     .  Das hei√üt,      (       SHA-2). </li><li>  , ,  ,      .        . </li></ol><br><br><a name="risks_loss_keys"></a><h2> 3.3  /     </h2><br> <b>     -?</b> <br><br>   ,       .  ? <br><br>      ,   .     -,    -,   .  . <br><br> ,             ,     ? ,        ( ¬´ ¬ª)?     ¬´ ¬ª ? <br><br>    ,      ,         , <i></i>   . ,       .      ,    (email, mobile). ,     (, ).  ,     ,  100% ,    ‚Äì  . <br><br>  -,    -. <br><blockquote> <b>  ?</b>   ,        .  , ,       bitcoin.  ,   -       .    .     .      ¬´¬ª,  . <br></blockquote><br> <b>      -?</b> <br>   .       - (   )     ,    ,   ,   - .  ,    .            javascript.  .    ‚Ä¶ <br><br> <b>    -?</b> <br><br>              .               .  Ruhig und ruhig.         .  .   . <br><br>          . ,   ,          , ‚Äì   .     :      ,           .      ,  -. <br><blockquote> <b>  .</b>      (    ).     .   IP-  ,      ,       . <br></blockquote><br><br><a name="part4"></a><h1> 4     </h1><br><br><a name="attack_user_tracking"></a><h2> 4.1   </h2><br> ,   ,        .    -,        . -, - ‚Äì     . <br><br>      ,        ,   : <br><br><ol><li>              (     ,     ). </li><li>       (    )       . </li></ol><br>   2   : <b>  </b> ,  .    == . <br><br> ,         ‚Ññ 2.     ¬´¬ª    (  ),         ¬´¬ª,    ,   .      ,   <b>  </b> . <br><br>          ‚Ññ 1.   . <br><br>  1     H <sub>1</sub> ,   2,     1 ‚Äì  H <sub>2</sub> . ,      (H <sub>1</sub> , H <sub>2</sub> )      -. <br>      3,       2,   .  3     H <sub>3</sub> ,   2,     3 ‚Äì  H <sub>2'</sub> != H <sub>2</sub> (.   ).  ,    , ..     . <br><br>  <b>  ,        fingerprint </b> .    ,             . <br><br> <b> :</b>   ,     .        . <br><br><a name="attack_XSS"></a><h2> 4.2   XSS </h2><br><br> <abbr title="Cross-Site Scripting ‚Äî ¬´ ¬ª">XSS</abbr> ‚Äì  ,        victim.com  . ,      CDN  . <br><br>                    .           - ( ),    ( ),      ( ). <br><br>           ‚Äì      Source   . <br><br> <b></b> :   XSS (              ),   .         ¬´¬ª.         -. <br><br><a name="attack_CSRF"></a><h2> 4.3   SRF </h2><br><br>     evil.com,  .      (GET/POST/HEAD/PUT/DELETE)  ,     (,    ).       (,     ).   ,     Referer        .  ,   . <br><br>          <abbr title="ross Site Request Forgery ‚Äî ¬´  ¬ª">CSRF</abbr> ,     .             .  ,          .     GET-      ( )      . <br><br>       . <br><br><a name="attack_SSO"></a><h2> 4.4     SSO </h2><br>   S <sub>1</sub>  S <sub>2</sub> ,        ,   ,  SSO,   .  ..       (-     ),       (   ),   S <sub>1</sub>    . <br><br>         A,   .     S <sub>2</sub> ,       ( S <sub>1</sub> )   H <sub>1</sub> .    .      S <sub>1</sub> ,       S <sub>2</sub> . <br><br>    S <sub>2</sub>    .         <br><pre> <code class="xml">&lt;meta http-equiv="refresh" content="0"&gt;</code> </pre>  . <br><br>  S <sub>2</sub>    A         ¬´¬ª: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/is/n5/jh/isn5jhlcnubhl580cvv6lgdloye.jpeg"></div><br>     ,   .        S <sub>2</sub>    H <sub>2</sub> (..   2.4 P1:      ). <br><br>   S <sub>2</sub>         S <sub>1</sub> ,   H <sub>1</sub>   H <sub>2</sub> ,   H <sub>2</sub>    S <sub>1</sub> .    S <sub>1</sub>  S <sub>2</sub>        , ..       <b>   </b> . <br><blockquote>       , ..          ,    . </blockquote> <b> :</b>      .   S <sub>2</sub>         ,        .      ,         S <sub>1</sub>  S <sub>2</sub> .       . <br><br><a name="attack_sso_key_discredit"></a><h2> 4.5    SSO </h2><br>       ,  SSO, .       . <br><br>          . <br><blockquote> <b>          .</b> </blockquote>  ,        SSO,             SSO.   ,          .  Das hei√üt,     SSO    ‚Äì       . <br><br>          .            . <br><br>        - :           Id- SSO    .        Id   SSO  .   ,       . <br>          (. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">¬´  ¬ª</a> ). <br><br> <b>.</b>  ,         ,      SSO,     - ,     . <br><br> <b>   .</b>   ,   ‚Äì         .    -       Id-    .  ,       ,    ,      . <br><br> <b> :</b>        (    ).     .      .        ,          .  , ,   ,     . <br><br> <b> .</b>    SSO ( ,            ).   SSO (      !). <br><br>  SSO          (, ),         . <br><br><a name="attack_token_compromise_due_transmit"></a><h2> 4.6     </h2><br> ,        <b>  100% </b>  .           (     ),  .    . <br><br>   SSL .     HTTPS  .    ,   HTTP.   . <br><br>      ,            .   . <br><br>    ‚Äì          .    ,           .                 .     -  ,  . <br><blockquote>  , ,   ,      Javascript .  Cookie   HttpOnly.    ajax- . </blockquote> <b> :</b>   ,    ,        (     ).        cookie      . <br><br> <b> :</b>       , ,    ;        ( ,  ). <br><br><a name="attack_token_compromise_due_site_hacking"></a><h2> 4.7      </h2><br>    .       .   :   ,   ¬´¬ª.      -  ‚Äì   . <br><br>   ,  -,        . <br><blockquote> <b>       </b> ,      .   <b>       </b> .   ,       . </blockquote>   ,         -:   - . <br><br>      ,    , ,   , .   . <br><br>   ,    ,       ,    -,    : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/b1c/9ee/9ac/b1c9ee9ac9a8f065c9a394045a24edb9.svg" alt="$DomainKey = HMAC_{M_{key}}( DomainName \cup VersionNumber )$" data-tex="display"></p><br><br><a name="epilog"></a><h1>  Fazit </h1><br>   ,    ,         : ¬´     ?¬ª <br><br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text">  ,        (     ),     (?)  ,   . <br><br> ,     ,  -  .  ,    ,       ,           .       (   ,   ).    ,        ¬´ ¬ª      ¬´-¬ª. <br><br>  -    ¬´ ¬ª. <s>  </s>    ,  <s></s> ¬´¬ª.     ,    .     (   Google ,  Facebook ‚Äì       ).     (  DDOS-    . ‚Äì <abbr title="            "><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a></abbr>  )   - .   ,     SSO       ,        .   ? <br><br>   , , ,       .  ,     -     -.  ,     .,     .     email,  .      .  ,             .    ? <br><br> <b>  -.  ?</b> SSO ‚Äì    . <br><br> ,        ¬´ ¬ª.         .      .       .             .   , . <br><br>      -      ¬´¬ª  .    ,    ¬´ ¬ª.          ,    . <br><br>  -,         ? <br></div></div><br> <b>    !</b>  Leider.    ,      ¬´/¬ª. <br><br> 1. , ,       popup <br><blockquote> ¬´   cookie!     ,      !  ¬´¬ª,       ¬ª. </blockquote>    popup         .      GDPR (   ). <br><br>  .   , cookie      !   ¬´¬ª.        ,       . <b>   , +1   .</b> <br><br> 2.          .      SSO    : OAuth, SAML, Kerberos  ..,     ,   ,    ;   -       SSO,    : ¬´   ,  ¬ª.            .  .   ,  ‚Ä¶          ,      . <b> = </b> . <br><br><div class="spoiler"> <b class="spoiler_title"> ...</b> <div class="spoiler_text">      .     .       ,   -  -  .       .  Ich wei√ü  Aber leider. <br><br>    -, -,  ¬´ ¬ª   . <br></div></div><br><br> 3.        .           .        ,    .     -,      -  .  -. <b>  ?</b> <br><br> 4.   ,    .    .           . <br><br> 5.        .         XSS, CSRF.   -     .    ‚Äî . <br><br> 6.         . <b>   .</b> <br><br> 7. ,  <b>     </b> .  ,     , <u>     </u> ,         ,      , ,  , .        SQL-. <br><br>   ,     ,  <b>     </b>  .       ¬´¬ª  , -     .       .   ,  ¬´-¬ª   . <br><br><blockquote> <i>‚Äì ,     </i> <br> .  <br></blockquote><br><br><hr>  <b>PS</b> <br>          .     Habr    .      ,         ()  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a> .       sergey201991[].   ,   .   /      .     .     -. <br><br> ,  ,      : <br><ol><li>         ,       ,   ;    </li><li>      ;           ,  SSO </li><li>       ¬´¬ª, -  : -      (   ) </li><li>    -  </li></ol><br>   . 1 ‚Äî             ,         : ,      1000.                . <br><br>   . 2 ‚Äî   .     .    ,   .   80-   ,        . <br><br>  ,     ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de472310/">https://habr.com/ru/post/de472310/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de472296/index.html">Auslaufschutzsystem f√ºr eine Waschmaschine</a></li>
<li><a href="../de472298/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends f√ºr die letzte Woche Nr. 385 (14. - 20. Oktober 2019)</a></li>
<li><a href="../de472300/index.html">Stochastischer Gradientenabstieg (SGD) f√ºr die logarithmische Verlustfunktion (LogLoss) in einem bin√§ren Klassifizierungsproblem</a></li>
<li><a href="../de472304/index.html">Die NASA stellt Ingenieure ein, um humanoide Roboter der n√§chsten Generation zu entwickeln</a></li>
<li><a href="../de472306/index.html">PHP Digest Nr. 166 (7.-21. Oktober 2019)</a></li>
<li><a href="../de472312/index.html">Erfahrung in der √úbertragung eines Maven-Projekts auf Multi-Release Jar: bereits m√∂glich, aber immer noch schwierig</a></li>
<li><a href="../de472314/index.html">Ich mag Pappleute</a></li>
<li><a href="../de472318/index.html">Verteilte R√ºckverfolgung in Istio</a></li>
<li><a href="../de472320/index.html">Interview mit Zabbix: 12 offene Antworten</a></li>
<li><a href="../de472326/index.html">Unsere Raumfahrtindustrie ... Und wenn Sie die Probleme der Branche aus der Perspektive eines Geeks betrachten?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>