<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥪 🔈 👨🏽‍🤝‍👨🏼 Kundenidentifikation auf Websites ohne Passwörter und Cookies: Anwendung für Standard 🐬 👩‍✈️ 🤞🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lieber Habrozhitel! Sehr geehrte Experten! Ich präsentiere für Ihre Einschätzung ein neues Konzept der Benutzeridentifikation auf Websites, das mit Ih...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kundenidentifikation auf Websites ohne Passwörter und Cookies: Anwendung für Standard</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472310/"><img src="https://habrastorage.org/webt/zx/gv/lz/zxgvlzpzrabaux0m9y-brjkhhpi.jpeg" alt="Bild"><br><br>  Lieber Habrozhitel!  Sehr geehrte Experten!  Ich präsentiere für Ihre Einschätzung ein neues Konzept der Benutzeridentifikation auf Websites, das mit Ihrer Hilfe hoffentlich zu einem offenen Internetstandard wird und diese Internetwelt ein wenig besser macht.  Dies ist eine Entwurfsversion des kennwortlosen Authentifizierungsprotokolls, die als kostenloser Artikel konzipiert wurde.  Und wenn die zugrunde liegende Idee von Ihnen, lieber Leser, positiv bewertet wird, werde ich sie weiterhin auf reddit.com und rfc-editor.org veröffentlichen.  Und ich hoffe, dass ich Entwickler führender Browser für deren Implementierung interessieren kann.  Deshalb erwarte ich von Ihnen konstruktive Kritik. <br><br>  Achtung: viel Text. <br><br><a name="habracut"></a><br>  Die Frage ist also.  Ist es möglich, Website-Besucher eindeutig zu identifizieren, ohne ihre persönlichen Daten preiszugeben und zwischen verschiedenen Websites zu verfolgen?  Ist es möglich, bei der Lösung eines solchen Problems die primitivste Form der Autorisierung durch Login / Passwort vollständig aufzugeben und Cookie / localStorage zu verwenden? <br><br>  Einerseits müssen Websites einen Kunden erkennen, um beispielsweise seine Einstellungen, den Warenkorb, Anzeigen, Artikel usw. „wiederherzustellen“.  Auf der anderen Seite möchten Besucher so anonym wie möglich bleiben, ohne ihre persönlichen Daten preiszugeben und zu verhindern, dass Websites von Drittanbietern sie verfolgen.  Und letztere können dies tun, indem sie die gesammelten Daten untereinander austauschen. <br><br>  Es klingt nach einer Aufgabe, dafür zu sorgen, dass die Wölfe voll und die Schafe in Sicherheit sind.  Ist das echt? <br><br>  Ich denke bis zu einem gewissen Grad - wirklich. <br><br><h1>  Inhaltsverzeichnis </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1 Passwortloses Authentifizierungskonzept</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.1 Schlüssel und Token anstelle von Anmeldungen und Passwörtern</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.2 Token-Struktur</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/472310/&amp;usg=ALkJrhiM0KZg0f4LAniBTiC_9H6-o1bXtw#">1.3 HTTP-Protokoll-Header</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.4 Wie identifizieren Kunden Websites?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.4.2 Woher weiß ich, ob eine Site dieses Protokoll unterstützt?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.5 Wie autorisieren Kunden Websites?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.6 Wie implementiere ich eine zuverlässige Kundenidentifikation?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.7 Autorisierung auf der Website durch die Augen des Benutzers</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.8 Wie ändert sich ein Site-Schlüssel?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.9 Wie wird die domänenübergreifende Autorisierung implementiert?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.10 Wie implementiere ich eine domänenübergreifende Authentifizierung?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1.11 Kontomobilität</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2 Technische Beschreibung des Protokolls</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2.0 Algorithmus zur Generierung von Domänenschlüsseln</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2.1 der Algorithmus zur Berechnung des Quell-Tokens</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2.2 Token-Schutzalgorithmus während der Übertragung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2.3 Salzaustauschverfahren zwischen Browser und Server</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2.4 Regeln für die Bildung des Kontextfeldes</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2.5 Regeln zum Definieren von Absender- und Empfängerfeldern</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2.6 Details zu Kontextdefinitionstabellen</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2.7 Protokollszenarien</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2.8 Token auf dem Server verarbeiten</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2.9 Domänenübergreifende Authentifizierung</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">3 Sicherheitsempfehlungen</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">3.1 Schutz der Schlüsselinformationen vor unbefugtem Zugriff</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">3.2 Informationen zu Passwörtern als Domänenschlüssel</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">3.3 Risiken des Verlusts / der Gefährdung von Schlüsseln und ihrer Minimierung</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4 Angriffe auf das Autorisierungsschema</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4.1 Benutzerverfolgung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4.2 XSS-Angriff</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4.3 CSRF-Angriff</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4.4 Tracking mit SSO</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4.5 Schlüsselkompromiss für SSO</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4.6 Token-Kompromiss während der Übertragung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4.7 Eine Website hacken und Token kompromittieren</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fazit</a> <br><br><br><div class="spoiler">  <b class="spoiler_title">Was ist los mit Passwörtern?</b> <div class="spoiler_text">  Ja, das ist nicht so.  Sie können verloren gehen.  Sie können gestohlen werden.  Sie müssen in Erinnerung bleiben.  Wie auch immer, warum bin ich verpflichtet, eine Registrierungsform auszufüllen und ein anderes Passwort einzugeben, um das Wetter zu sehen oder diese Datei herunterzuladen?  Schließlich sind Passwörter etwas weniger als viele.  Wie viele Websites Sie mögen, so viele Passwörter.  Und deshalb verwenden viele tatsächlich ein Passwort auf allen Websites.  Jemand benutzt einen kniffligen Algorithmus, um sich an sie zu erinnern.  Oder ein Passwort-Manager.  Oder dumm ein Notizbuch.  Oder bevorzugen Sie die domänenübergreifende Authentifizierung: Sie melden sich einmal an einer Site an und fertig!  Ja, nicht alle.  Dies ist der Fall, wenn die Site dies unterstützt. <br>  Alle diese Ansätze haben Nachteile. <br>  Verwenden Sie ein Passwort auf verschiedenen Websites - Moveton.  Was zwei Menschen wissen, weiß auch das Schwein.  Nicht alle Websites (auch große und seriöse) erfüllen ehrlich die Sicherheitsregeln für die Speicherung Ihrer Passwörter.  Einige Websites speichern Kennwörter in offener Form, während andere der Meinung sind, dass das Speichern von Kennwort-Hashes sie bereits ausreichend schützt.  Infolgedessen treten regelmäßig Lecks von Passwörtern und anderen persönlichen Daten von Kunden auf. <br>  Mit dem Passwort-Manager ist das schon besser.  Es stimmt, niemand garantiert Ihnen, dass Ihre Passwörter nicht irgendwo zusammengeführt werden.  Suchen Sie sich einen Manager, der Ihre Konten auf allen Geräten (Heimnetzwerk, Telefon, Arbeitscomputer) synchronisieren kann.  Ich schließe nicht aus, dass es solche gibt. <br>  Aber auf jeden Fall die Idee: Registrieren Sie sich zuerst auf unserer Website (senden Sie gleichzeitig eine E-Mail, senden Sie ein Handy, spenden Sie Blut für die Analyse), erfinden Sie dann Ihren Benutzernamen und Ihr Passwort und merken Sie sich diese, aber halten Sie sie geheim - Annäherung, ich sage dir, so lala.  Und kein einziger Passwort-Manager wird es lösen.  Aber es löst die <abbr title="Single Sign-On-Technologie, die von verschiedenen Protokollen wie SAML, OAuth und Kerberos implementiert wird">SSO</abbr> . <br>  Das ist nur Pech: Wenn Sie das Passwort von der SSO-Site verlieren und es vergessen oder es Ihnen gestohlen wurde ... Sie verlieren den Zugriff von allen Ihren Sites auf einmal oder geben es freiwillig an Dritte weiter und es ist nicht klar, mit welchen Absichten.  <b>Lagern Sie nicht alle Eier in einem Korb!</b> <br>  Und es ist keine Tatsache, dass die SSO-Site zuverlässig ist.  Oder speichert Ihre Passwörter nicht im Klartext.  Oder sie werden nicht freiwillig zusammengeführt, und es bietet anderen die Möglichkeit, Sie zwischen Websites zu verfolgen.  Nun, du verstehst, worum es geht. <br>  Deshalb: Login + Passwort = böse.  Und all das Böse auf der Welt sollte ernsthaft und für lange Zeit getrunken werden.  Und ein Keks auch.  Zusammen mit seiner Sitzung Krokodile PHPSESSIONID, JSESSIONID und ihre Analoga. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Und was tun?</b> <div class="spoiler_text">  Zuerst müssen Sie typische Situationen betrachten, aus denen klar wird: Warum möchten Websites sich an ihre Kunden erinnern und ist dies für sie wirklich notwendig? <br><ol><li>  Persönlicher Blog "Vasya Pupkina", in dem zum Beispiel Kommentare erlaubt sind.  Eine Registrierung ist nur erforderlich, um sich vor Bots zu schützen, kostenlose Abstimmungen durchzuführen, "Likes" und andere "Miau-Miau" zu zählen und Kommentatoren eine Bewertung zuzuweisen.  Das heißt,  Hier <b>wird die Tracking-Funktionalität ausschließlich von der Site</b> und nur in geringem Umfang benötigt - vom Benutzer (wenn er seine "Kommentator" -Bewertung auf dieser Site bewertet). </li><li>  Websites von sozialen Netzwerken und anderen Internet-Sprechern (ICQ, Skype - auch dort).  Eine Registrierung ist erforderlich, um benannte (Autoren-) Inhalte zu implementieren und Besucher untereinander zu identifizieren.  Das heißt,  Hier <b>wird die Identifikationsfunktionalität von den Benutzern selbst in größerem Umfang benötigt</b> .  Obwohl die Websites sozialer Netzwerke die ersten in der Liste der "Sünder" sind, sammeln sie die vollständigsten Informationen über Besucher und erinnern sich ernsthaft und lange an Sie.  Es ist also noch nicht bekannt, wer mehr Identifikation benötigt. </li><li>  Unternehmensseite mit geschlossenen Inhalten.  Die Registrierung oder Autorisierung hier ist hauptsächlich erforderlich, um den Zugriff auf Inhalte einzuschränken.  Alle Arten von: Online-Schulen, Bibliotheken, private nicht öffentliche Websites und so weiter.  Hier <b>wird die Autorisierungsfunktionalität von der Site in größerem Umfang benötigt</b> .  In der Regel gibt es keine offenen Anmeldeformulare.  Anmeldeinformationen werden über andere Kanäle geteilt. </li><li>  Ein Online-Shop und eine ähnliche Plattform, auf der Artikel, Dienstleistungen oder Inhalte verkauft werden.  Ich werde auch kostenpflichtige / kostenlose Kleinanzeigen-Websites einschließen.  Die Registrierung ist hauptsächlich erforderlich, um den Verlauf von Kundenbestellungen zu speichern und um den aktuellen Status zu verfolgen und deren Einstellungen (Favoriten) zu speichern.  um persönliche Angebote für den Kunden basierend auf der Kaufhistorie und den Vorlieben zu formulieren.  Hier <b>ist die Identifikationsfunktion sowohl für den Kunden als auch für das Geschäft gleichermaßen notwendig</b> .  Aber natürlich mehr zum Laden.  Dämpfen, dämpfen und dämpfen. </li><li>  Alle persönlichen Konten von Nutzern von Internetdiensten: E-Mail, öffentliche Dienste, Sberbank-Online, Megaphon-Online, Büros von Anbietern, CMS von Hostern usw.  Hier <b>ist der Benutzer selbst in erster Linie an der korrekten und zuverlässigen Identifizierung interessiert</b> .  Schließlich verwaltet er Informationen, die für ihn selbst von Bedeutung sind und in einigen Situationen rechtliche und finanzielle Konsequenzen haben.  Es riecht nicht nach Anonymität.  Sie ist hier schädlich. </li><li>  Router, Verwaltungskonsolen, Webversionen zum Verwalten von Objekten in Ihrem Heim- oder Unternehmensnetzwerk. </li></ol><br><br>  Es ist klar, dass in verschiedenen Situationen unterschiedliche Risiken bestehen können.  In einigen Fällen führt eine falsche Identifizierung, der Verlust von Authentifizierungsdaten oder sogar deren Diebstahl / Fälschung zu keinen wesentlichen Konsequenzen für die Website oder den Benutzer.  In anderen Fällen wird es nur unangenehm sein (ich habe Karma bei Habré verloren - "es ist eine Katastrophe ...") oder zu Unannehmlichkeiten führen (ich kann mich in Yula nicht unterkriegen, meine Anzeigen sehen; ich habe den Zugang zu meinen Projekten auf Github profiliert - okay neues Konto, Gabelprojekte).  Drittens kann dies rechtliche und finanzielle Konsequenzen haben.  Daher muss davon ausgegangen werden, dass das vorgeschlagene Genehmigungsschema nicht in allen Fällen eine „Silberkugel“ ist, insbesondere nicht „nackt“.  <b>Wenn vertrauliche Informationen verwaltet werden, lohnt es sich, andere Methoden zur Identifizierung und Authentifizierung</b> oder deren Kombination zu verwenden (Zwei-Faktor-Authentifizierung, Kryptografie mit asymmetrischen Schlüsseln, 3D-sicher, eToken, OTP-Token usw.). <br><br>  Gut.  Was ist deine TK? <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Was bietet das neue Protokoll?</b> <div class="spoiler_text">  Aus Sicht des Endbenutzers: <br><ol><li>  Die Site sollte den Besucher ohne Eingaben des Benutzers speichern und erkennen.  Die Site sollte Sie sowohl innerhalb der Sitzung als auch zwischen verschiedenen Sitzungen erkennen.  Keine Cookies, Passwörter oder Registrierungen.  Gleichzeitig sollten verschiedene Websites nicht in der Lage sein <i>,</i> denselben Besucher eindeutig zu identifizieren und ihre Aktivitäten auf diesen und anderen Websites zu verfolgen.  Das heißt,  Websites sollten nicht in der Lage sein, Informationen für ihre Besucher zu sammeln. </li><li>  Der Benutzer sollte jederzeit in der Lage sein, " <b>jede Site</b> zu <b>vergessen</b> ".  und die Seite wird den Benutzer vergessen.  Es sollte die Möglichkeit bestehen, der Site auf Initiative des Kunden Rechte zu gewähren, um sich an den Kunden zu erinnern (ohne zwanghaftes Popup).  Der Benutzer sollte in der Lage sein, seine virtuelle Identität sicher zwischen verschiedenen Geräten und Browsern zu migrieren (falls erforderlich), um eine einzige Autorisierung für seine bevorzugten Websites zu erhalten. </li></ol><br><br>  Ich verstehe.  Und welche Boni sollten Website-Entwickler davon erhalten? <br><ol><li>  Ein einfacheres Identifikationsverfahren: Es ist nicht erforderlich, zum tausendsten Mal die nächste Form der Anmeldung, Abmeldung, Registrierung, Änderung und Kennwortwiederherstellung zu erstellen.  Es reicht aus, das Protokollunterstützungsmodul für Ihr bevorzugtes Framework zu aktivieren, das auf der Grundlage des Standards implementiert wurde. </li><li>  Ein Designer muss kein Anmeldeformular zeichnen und überlegen, wo er es auf einem kleinen mobilen Bildschirm ausblenden soll.  Das Protokoll macht Formulare überhaupt unnötig.  Nun, außer dass das Anmeldeformular.  Wo ist es dann ohne sie?  Leider. </li></ol><br><br>  Endlich: <br><ol><li>  Das Authentifizierungsprotokoll muss einheitlich und standardisiert sein.  Von Sicherheitsexperten überprüft  Genehmigt und empfohlen von Webstandardisierungsausschüssen.  Infolgedessen besteht die Möglichkeit, dass Webmaster klassische Fehler machen, wenn sie Standard-Anmelde- / Abmeldeformulare entwickeln, Kennwörter ändern / wiederherstellen (Übertragen von Kennwörtern in klarer Form, falsche Verwendung von Hashing, Speichern von Kennwörtern oder „nicht gesalzenen“ Hashes in der Datenbank, Entführen von Benutzerkennwörtern, wenn Hacking-Site). </li><li>  Die Autorisierung sollte bis zu einem gewissen Grad zuverlässig sein (vor Fälschungen, unbefugtem Zugriff und garantierter Authentifizierung geschützt).  Erstellen Sie keine neuen Sicherheitslücken auf Webseiten und Browsern.  Reduzieren Sie nach Möglichkeit das Risiko bekannter Netzwerkangriffe sofort.  Nun, oder zumindest eine signifikante Reduzierung der Risiken ihrer erfolgreichen Implementierung. </li></ol><br><br>  Basierend auf diesen Anforderungen wenden wir uns dem interessantesten zu: dem Entwerfen eines neuen Protokolls. <br></div></div><br><br><a name="part1"></a><h1>  1 Passwortloses Authentifizierungskonzept </h1><br><br><a name="tokens_vs_passwords"></a><h2>  1.1 Schlüssel und Token anstelle von Anmeldungen und Passwörtern </h2><br>  Für jede Domäne, einschließlich untergeordneter Domänen, generiert der Client-Browser zufällig einen eindeutigen 256-Bit-Schlüssel <math></math><img src="https://habrastorage.org/getpro/habr/formulas/8b1/9d8/49a/8b19d849a66473b36d68c78d06462129.svg" alt="$ K $" data-tex="inline">  .  <b>Dieser Schlüssel wird niemals übertragen.</b>  Bleibt innerhalb der Benutzersitzung konstant.  Jede neue Sitzung erstellt einen neuen Schlüssel. <br>  Schlüsselbasiert <math></math><img src="https://habrastorage.org/getpro/habr/formulas/8b1/9d8/49a/8b19d849a66473b36d68c78d06462129.svg" alt="$ K $" data-tex="inline">  Der Browser generiert mithilfe eines <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">speziellen Algorithmus</a> ein 256-Bit <sup>*</sup> -Token <math></math><img src="https://habrastorage.org/getpro/habr/formulas/175/f98/839/175f98839ab732db76d5f20cd6ce2ce9.svg" alt="$ T $" data-tex="inline">  um den Benutzer mit einer bestimmten Domain zu identifizieren.  Identifikations-Token <math></math><img src="https://habrastorage.org/getpro/habr/formulas/175/f98/839/175f98839ab732db76d5f20cd6ce2ce9.svg" alt="$ T $" data-tex="inline">  Der Benutzer (im Folgenden einfach als Token bezeichnet) dient als Ersatz für Sitzungscookies wie PHPSESSIONID und JSESSIONID. <br>  Schlüssel <math></math><img src="https://habrastorage.org/getpro/habr/formulas/8b1/9d8/49a/8b19d849a66473b36d68c78d06462129.svg" alt="$ K $" data-tex="inline">  kann vom Benutzer " <b>repariert</b> " werden.  Durch das Fixieren des Schlüssels kann der Benutzer unbegrenzt in verschiedenen Browsersitzungen auf der Site autorisiert bleiben und die zuvor vorhandene Autorisierung zurückgeben.  Dies ist <b>ein Analogon zur Funktion „Erinnere dich an mich“</b> . <br>  Wenn das Festschreiben abgebrochen wird, "vergisst" der Browser diesen Schlüssel und beginnt erneut, für jede neue Sitzung (ab der aktuellen Sitzung) einen zufälligen Schlüssel für diese Domäne zu generieren <b>, der</b> dem <b>"Beenden" des</b> Benutzers von der Site entspricht.  Die Ausgabe erfolgt sofort und erfordert kein erneutes Laden der Seite. <br>  Der Benutzer kann <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einen permanenten Schlüssel für die Domäne erstellen</a> .  Mit dem permanenten und dem festen Schlüssel kann der Benutzer die vorherige Autorisierung zurückgeben.  Tatsächlich wird dieser <b>Schlüssel ein Ersatz für die Login-Passwort-Verbindung.</b> <br>  Der Benutzer hat die Möglichkeit zu steuern, wann und wann der Browser für die Domain einen konstanten Schlüssel verwendet.  Dies ist <b>ein Analogon zur Login / Logout-Funktion</b> .  Das Konzept <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ist in den folgenden Screenshots dargestellt</a> . <br>  Methoden zum Generieren persistenter Domänenschlüssel ermöglichen die Mobilität von Benutzerkonten zwischen verschiedenen Geräten.  Das Protokoll definiert Folgendes: <br><ul><li>  Generierung eines Domänenschlüssels basierend auf einem Benutzerhauptschlüssel </li><li>  Individuelles Bilden eines Domänenschlüssels basierend auf einem biologischen Zufallszahlensensor </li><li>  Importieren vorhandener Schlüssel aus einer Schlüsseldatei von einem anderen Gerät </li></ul><br><br><a name="token_structure"></a><h2>  1.2 Token-Struktur </h2><br>  Das Token ist eine 256-Bit-Struktur, die als hexadezimale Zeichenfolge dargestellt wird: <br><div class="scrollable-table"><table><tbody><tr><td>  84bc3da1b3e33a18e8d5e1bdd7a18d7a </td><td>  166d77ac1b46a1ec38aa35ab7e628ab5 </td></tr><tr><td>  Identifikationsteil </td><td>  Authentifizierungsteil </td></tr></tbody></table></div><br>  Der Identifikationsteil des Tokens (die höchsten 128 Bits) ähnelt dem Login.  Durch diese Folge von Bits kann der Server den Benutzer eindeutig identifizieren. <br>  Der Authentifizierungsteil des Tokens (die unteren 128 Bit) ähnelt dem Kennwort.  Diese Folge von Bits hilft dem Server, das Token zu validieren. <br>  Token-Validierungsregeln werden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unten beschrieben</a> . <br><br><a name="http_headers"></a><h2>  1.3 HTTP-Protokoll-Header </h2><br>  <b>Vom Client verwendete Header:</b> <br><br>  <b>CSI-Token</b> : &lt;Token&gt; wird verwendet, um ein Token an den Server zu senden <br>  <b>CSI-Token</b> : &lt;Token1&gt;;  <b>Geändert zu</b> &lt;Token2&gt; wird verwendet, um das aktuelle Token zu ändern: <br><ul><li>  Wenn Sie einen permanenten Schlüssel autorisieren, </li><li>  bei der Registrierung eines permanenten Schlüssels, </li><li>  beim Ändern des permanenten Schlüssels. </li></ul><br>  <b>CSI-Token</b> : &lt;Token&gt; <b>Permanent wird</b> verwendet, wenn der Benutzer den aktuellen Zufallsschlüssel festlegt. <br>  <b>CSI-Token</b> : &lt;Token&gt; <b>Abmelden wird</b> verwendet, um die aktuelle Sitzung vorzeitig zu beenden. <br><br>  <b>Vom Server verwendete Header:</b> <br>  <b>CSI-Unterstützung: yes</b> teilt dem Client mit, dass der Server das CSI-Autorisierungsprotokoll unterstützt. <br>  <b>CSI-Token-Aktion: Erfolg wird</b> verwendet, um den Browser über die Akzeptanz eines neuen Benutzertokens (Change-To-Schlüssel) zu benachrichtigen. <br>  <b>CSI-Token-Aktion: Abbruch</b> bricht die Prozedur zum Ändern von Token ab (Rollback auf das vorherige Token). <br>  <b>CSI-Token-Aktion: Die Registrierung</b> teilt dem Browser mit, dass sich das neue Benutzertoken noch in der Registrierung befindet. <br>  <b>CSI-Token-Aktion: Ungültiger</b> Fehler bei der Überprüfung des serverseitigen Tokens. <br><br>  Endlich <br>  <b>CSI-Salt wird</b> sowohl vom Browser als auch vom Server gesendet, wenn das zum Schutz des Tokens verwendete „Salt“ (Authentifizierungsteil) ausgetauscht wird.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Siehe unten für</a> weitere Details. <br><br><a name="how_site_identify_us"></a><h2>  1.4 Wie identifizieren Kunden Websites? </h2><br>  Eine Site kann ein Token verwenden, um einen Site-Besucher zu identifizieren.  Gleichzeitig <b>garantieren</b> das Token-Generierungsschema und ihre 256-Bit-Kapazität <b>eindeutige Token für jedes Paar:</b> Benutzerdomäne.  Eine andere Domain sieht ein anderes Benutzertoken.  Auch wenn im Kontext der Zielsite ausgeführt (über IFRAME, IMG, LINK, SCRIPT).  Darüber hinaus schützt ein spezieller Algorithmus zur Token-Generierung Benutzer vor XSS- und SRF-Angriffen und macht es unmöglich, einen Benutzer ohne sein Wissen zu verfolgen.  Gleichzeitig <abbr title="Single Sign-On-Technologie, die von verschiedenen Protokollen wie SAML, OAuth und Kerberos implementiert wird">bleibt die SSO-</abbr> Technologie mit ihrer Erlaubnis und domänenübergreifenden Identifizierung möglich. <br>  Das Token <b>wird im CSI-Token-HTTP-Header</b> <u>bei jeder Anforderung</u> an eine beliebige Domänenressource (Seite, Dokument, Bild, Skript, Stil, Schriftart, Datei, Ajax-Anforderung, ...) übertragen: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ki/mv/0k/kimv0kx4wvesmftizvvlgpfe088.png"></div><br>  Das Token wird <b><i>bei jeder</i> HTTP (S)</b> -Anforderung <b>neu berechnet</b> : Seite, Bild, Ajax-Anforderung. <br>  Um die Berechnungen zu optimieren, ist das Zwischenspeichern von Token durch den Browser zulässig, jedoch nur für die Dauer der Sitzung und nur, wenn die Bedingungen für die Erfüllung der Anforderung unverändert bleiben. <br>  Wie oben erwähnt, kann das Token als Ersatz für Sitzungscookies wie PHPSESSIONID und JSESSIONID dienen.  Der einzige Unterschied besteht darin, dass der Client diese Funktion jetzt selbst ausführt, wenn die Site zuvor eine Kennung für den Besucher generiert hat, um einen bestimmten Benutzer zwischen seinen verschiedenen Anforderungen zu verfolgen (schließlich kommen Tausende von Anfragen von verschiedenen Benutzern gleichzeitig auf die Site). <br>  Eine solche Identifizierung reicht völlig aus, um Einkäufe im Online-Shop zu tätigen, auf geeigneten Websites zu werben, in Foren, in sozialen Netzwerken, Wikipedia- oder Habré-Artikeln zu schreiben. <br>  Ja, der Benutzer bleibt für die Site anonym.  Es kann sich jedoch um einen anonymen „Vertrauten“ der Website handeln.  Und der Server kann das Token eines solchen Benutzers zusammen mit seinen Daten (persönliches Konto mit Einkäufen, Vorlieben, Karma, Brötchen, Likes und anderen Boni) auf seiner Seite speichern.  Aber nur, um unter der Bedingung des Abschlusses eines Geschäftsprozesses zu bleiben: Kauf, Einreichung der Ankündigung usw.  Die Bedingungen werden von der Site selbst bestimmt. <br>  Wie Sie sehen, ist das Protokoll für Websites, die Sie nicht registrieren müssen, so einfach wie möglich, bevor Sie die Möglichkeit haben, Maßnahmen zu ergreifen.  Aber diejenigen, die es brauchen, werden es etwas schwieriger haben.  Aber mehr dazu weiter unten. <br><br><a name="how_we_know_what_sci_supported"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.4.2 Woher weiß ich, ob eine Site dieses Protokoll unterstützt? </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Site sollte den </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSI-Support: yes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> http-Header </font><font style="vertical-align: inherit;">im Abschnitt Antwortheader ihrer Antwort bestehen:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ly/gs/zu/lygszusqavjk8yjnljig4pgojdm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobald der Browser einen solchen Titel sieht, informiert er den Benutzer unauffällig darüber, dass er sich auf der Website speichern kann. </font><font style="vertical-align: inherit;">Zum Beispiel das Schlüsselsymbol in der Adressleiste:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ar/ff/bt/arffbt4ibbg__wlp7eyvaei_gvq.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie beispielsweise auf einen Schlüssel klicken, wird ein Schlüssel für die Domain </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.youtube.com erstellt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fq/7c/4p/fq7c4piubz15qir9xtxchg9639o.jpeg"></div><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Die Bildung eines neuen Schlüssels führt nicht zu seiner automatischen Verwendung. </font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der permanente Schlüssel wird erst verwendet, wenn er vom Benutzer aktiviert wird. </font></font><br><br><a name="how_make_authorization"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.5 Wie autorisieren Kunden Websites? </font></font></h3><br>  ,          , –  . ,     ,     –   «». <br>         ,    , ,  .        . <br><blockquote>   :      .      .        -    . </blockquote><br>     «   » .            .   «   »: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/__/0i/1x/__0i1xkyu82-ne_cnghuongzrfy.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie müssen natürlich zuerst einen permanenten Schlüssel für die Site erstellen. </font><font style="vertical-align: inherit;">Dies ist jedoch nur eine Frage von ein paar Mausklicks. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und natürlich werden Sie aufgefordert, Ihr Telefon oder Ihre Postanschrift zu bestätigen. </font><font style="vertical-align: inherit;">Aber es kommt schon auf die Seite an. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nach erfolgreicher Autorisierung </font><font style="vertical-align: inherit;">informiert </font><font style="vertical-align: inherit;">der Server über einen speziellen HTTP-Header </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSI-Token-Action</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> den Browser darüber, dass er den neuen Schlüssel akzeptiert hat. </font><font style="vertical-align: inherit;">Weitere Details in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kapitel II</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="how_implement_reliable_identification"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.6 Wie implementiere ich eine zuverlässige Kundenidentifikation? </font></font></h2><br>     (  , , )      ,             :   , ,      . (, .    ,      ). <br><br><a name="user_view_concept"></a><h2> 1.7      </h2><br>   ,     CSI,      .       ,      .           : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/up/et/3q/upet3q-qbs8ikn4ba9t0ycn8voy.gif"></div><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">     ,  .       ,   ,  ,   .    ,   .    .    .   ,   , ,      .   .  . <br></div></div><br>   ,           .  : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/32/82/tm/3282tmri0zwdfx1jqi_zgd76zu0.gif"></div><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">   .   .  .      . <br>     ,  « ».      . <br></div></div><br>             ,     : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/u4/cm/_g/u4cm_gdewg2j7ree3gq3phuz6x4.gif"></div><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">   . ,    .  ,  «».   ,  . <br></div></div><br>    ,         -.     <u>        </u> .    . ,       -    / : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xs/ye/tx/xsyetxguxoesirmridywcy-2rts.gif"></div><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">      .       -.  .    (  ). <br></div></div><br>    -  «»   : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/du/ab/cl/duabclss3t9nkxpnjygrqfxjdha.gif"></div><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">   .   .       .   ;    .   . <br></div></div><br>    .    «»  : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/do/2r/fe/do2rfebsd3orgwphl0ujrt_o52q.jpeg"></div><br>     (   )   HEAD,     CSI-Token &lt;&gt;; Logout. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mt/gj/s1/mtgjs1i1jmtbehjyus_hfukqsq4.gif"></div><br> ,   ,  Logout.     ,        (     ).     ,   . <br>          :  ,   ajax-,    .. –    ,      . <br><blockquote>       :   ,     ,      .  «»     .     . </blockquote><br><br><a name="how_user_can_change_key"></a><h2> 1.8     ? </h2><br>       ,        .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> II</a> . <br>      ,       ,  <i>   </i>  <b>CSI-Token</b>   <b>Changed-To</b> : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xk/rp/75/xkrp75ivdr3kjj1_i2sh9iwfqaa.png"></div><br>      . ,        ,    .             .       (Response Headers) : <b>CSI-Token-Action: success</b> ,    . <br>        (,               )  <b>CSI-Token-Action: aborted.</b> <br>   ,      CSI-Token-Action,         CSI-Token    Changed-To. <br>  <b> « » .</b> <br><br><a name="how_make_cross_domain_auth"></a><h2> 1.9   - ? </h2><br>  Die klassische domänenübergreifende Autorisierung mithilfe der <abbr title="Single Sign-On-Technologie, die von verschiedenen Protokollen wie SAML, OAuth und Kerberos implementiert wird">SSO-</abbr> Technologie bietet dem Benutzer viele Vorteile.  Sie müssen sich nicht eine Reihe von Passwörtern von einer Reihe von Websites merken.  Es ist nicht erforderlich, sich zu registrieren und die trostlosen Formulare auszufüllen.  Einige Autorisierungsserver fragen, welche Rechte die Site gewähren sollen, die das SSO angefordert hat. <br>  Es gibt aber auch Nachteile.  <b>Sie sind abhängig vom SSO-Anbieter.</b>  Wenn der SSO-Server nicht funktioniert, gelangen Sie nicht zum Zielstandort.  Wenn Sie Ihr Passwort verlieren oder Ihr Konto gestohlen wird, verlieren Sie den Zugriff von allen Websites gleichzeitig. <br>  Für Webentwickler sind die Dinge etwas komplizierter.  Von Anfang an müssen Sie Ihre Site auf dem Autorisierungsserver registrieren, die Schlüssel abrufen, lernen, wie Sie mit dem Protokoll ( <abbr title="Ein offener Standard für den Austausch von Authentifizierungs- und Autorisierungsdaten zwischen einem Kontoanbieter und einem Dienstanbieter">SAML</abbr> , <abbr title="Ein offenes Autorisierungsprotokoll, mit dem ein Dritter nur eingeschränkten Zugriff auf die geschützten Ressourcen des Benutzers erhält, ohne dass ein Login und ein Kennwort an einen Dritten übertragen werden müssen">OAuth</abbr> usw.) und den entsprechenden Bibliotheken arbeiten, sicherstellen, dass der Schlüssel nicht abläuft, dass der Autorisierungsserver Ihre Site aus Ihren Gründen nicht blockiert und usw.  Dies ist eine Gebühr für die Tatsache, dass Sie keine Benutzerkonten führen, keine Registrierungsformulare erstellen, sich nicht anmelden usw. müssen.  Die Wahrheit erhöht die Wartungskosten (in Form der Reparatur plötzlicher Ausfälle).  Wenn der Server für die Site plötzlich nicht mehr verfügbar ist, dann leider. <br>  Dieses Autorisierungsschema macht SSO etwas sicherer und die Autorisierung für alle Teilnehmer ist einfacher.  Informationen zur Sicherheit finden Sie weiter unten im Abschnitt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">"Key Compromise for SSO".</a> <br><br>  Schauen Sie sich Website S an, die das SSO von Google unterstützt.  Angenommen, Sie haben ein Google-Konto.  Um sich anzumelden, klicken Sie auf den Link "Mit Google anmelden", um die Registerkarte "Google-Autorisierung" zu öffnen.  Der Browser teilt Ihnen mit, dass Sie einen Schlüssel für Google haben.  Und Google wird Ihnen mitteilen, welche Rechte S. anfordert. <br>  Wenn Sie damit einverstanden sind, klicken Sie im Schlüsselmanager auf "Anmelden".  Die Seite wird neu geladen.  Google erhält bereits seinen gültigen Token, erkennt und autorisiert Sie.  Bei einer Anfrage zwischen Servern wird Site S gemäß den angeforderten Feldern über Ihre Kontoinformationen informiert. <br>  Die neu geladene Seite enthält eine Schaltfläche "Weiter", mit der Sie zur Zielwebsite zurückkehren. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w5/u1/aa/w5u1aahv-_os9k2d81c819d5zhg.gif"></div><br><div class="spoiler">  <b class="spoiler_title">In der Abbildung</b> <div class="spoiler_text">  Er wird ein Beispiel für diesen Algorithmus geben, wenn er sich unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.youtube.com</a> mit domänenübergreifender Autorisierung über Accounts.google.com registriert. <br></div></div><br>  Site S kann entscheiden, ob Daten über Sie in seiner Datenbank gespeichert werden sollen oder nicht.  Dieses Problem geht über den Rahmen des vorgeschlagenen Genehmigungsschemas hinaus.  Wenn wir jedoch das Risiko des Verlusts des Schlüssels für SSO berücksichtigen, wird der Site empfohlen, das Benutzertoken und die Kennung von SSO auf seiner Seite zu halten, und dem Benutzer wird empfohlen, einen permanenten Schlüssel für S zu erstellen. <br><blockquote>  <b>Sicherheitslücke:</b> Nach einer solchen Autorisierung können die Websites S1, S2, S3, ... (auf denen Sie sich über Google angemeldet haben) Sie erkennen (anhand der Ihnen von Google zugewiesenen Kennung) und als Ergebnis Ihre Aktivitäten verfolgen. </blockquote><br><blockquote>  <b>Schutzoption:</b> Arbeiten Sie nicht gleichzeitig auf Websites, wenn Sie sich über das SSO desselben Anbieters registriert haben.  Melden Sie sich nach Möglichkeit sofort nach Abschluss der Autorisierung vom Autorisierungsserver ab ("Auto-Exit" für die Domain). </blockquote><br><br><a name="how_make_sub_domain_identify"></a><h2>  1.10 Wie implementiere ich eine domänenübergreifende Authentifizierung? </h2><br>  Das alles ist natürlich gut.  Während die Arbeit in einem Browser ausgeführt wird, ist alles in Ordnung.  Aber was ist mit der modernen Realität, wenn eine Person zwei Mobiltelefone, einen funktionierenden Computer und mehrere Browser, einen Heimcomputer und einen anderen Laptop hat?  Plus eine gemeinsame Tablette für die Frau / Kinder. <br>  Wir müssen das Problem der Übertragung von Domänenschlüsseln zwischen Browsern und Geräten irgendwie lösen.  Und lösen Sie auch das Problem ihrer korrekten Synchronisation. <br>  Einer der Mechanismen zur Lösung dieses Problems besteht darin, verschiedene Domänenschlüssel basierend auf einem gemeinsamen Hauptschlüssel zu berechnen, ohne die Möglichkeit einer umgekehrten Wiederherstellung des Hauptschlüssels von einem bekannten Domänenschlüssel. <br>  Nachdem ein Benutzer einen persönlichen Schlüssel K für Domäne D unter Verwendung eines Hauptschlüssels M auf einem Gerät erstellt hat, kann er denselben Schlüssel K für Domäne D und auf jedem anderen Schlüssel unter Verwendung desselben Hauptschlüssels M und eines einzelnen Algorithmus erstellen.  Genauer gesagt wird dies nicht vom Benutzer, sondern von seinem Browser durchgeführt.  Bei diesem Ansatz reicht es für den Benutzer aus, seinen Hauptschlüssel auf alle von ihm verwendeten Browser zu verteilen, und er "überträgt alle seine Schlüssel" von Domänen gleichzeitig.  Gleichzeitig werden auf diese Weise Backups erstellt. <br>  Maximaler Benutzerkomfort.  <b>Aber auch das maximale Risiko</b> bei Kompromittierung des Hauptschlüssels.  Letztere müssen daher entsprechend geschützt werden.  Die Risiken des Verlusts oder der Beeinträchtigung des Hauptschlüssels und Möglichkeiten zur Minimierung solcher Risiken werden im Kapitel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">„3 Sicherheitsempfehlungen“ beschrieben</a> . <br>  Die Verwendung nur eines Hauptschlüssels zum Generieren aller Schlüssel für alle Domänen ist nicht immer eine bequeme Option.  Was tun, wenn plötzlich der Domänenschlüssel kompromittiert wird und geändert werden muss?  Was ist zweitens, wenn Sie einen Domain-Schlüssel mit einer anderen Person teilen müssen?  Zum Beispiel zwischen Familienmitgliedern.  Oder handelt es sich um ein öffentliches E-Mail-Zugriffskonto für Unternehmen?  Wie kann man dann seinen Schlüssel "abholen" (weil er tatsächlich kompromittiert wurde)? <br>  Daher muss die Generierung einzelner Domänenschlüssel mithilfe eines biologischen Zufallszahlensensors von Browsern unterstützt werden.  Aber dann kehren wir noch einmal zu der Frage unserer Mobilität und den Fragen der Synchronisation, den Funktionen zum Exportieren und Importieren von Schlüsseln im Browser und zum Erstellen von Sicherungskopien zurück. <br><br><h3>  Übertragung durch ein physisch veräußerbares Gerät </h3><br>  Smartcards und USB-Token eignen sich durchaus als sichere Speicherung von Schlüsselinformationen (da sie dafür erstellt wurden).  Die Zwei-Faktor-Authentifizierung schützt Schlüssel vor unbefugtem Zugriff durch direkten Zugriff auf das Gerät. <br>  Für Smartcards sind spezielle Lesegeräte erforderlich (ganz zu schweigen von Treibern), die ihre Verwendung nur auf Workstations beschränken, die mit solchen Lesegeräten ausgestattet sind. <br>  Mit USB-Token etwas einfacher.  Es werden nur Treiber benötigt.  Sie können einen solchen Token jedoch nicht in das Telefon stecken.  Und obwohl es für Mobiltelefone Token in Form von SD-Karten gibt, heißt das nicht, dass diese Lösung die Mobilität erhöht.  Versuchen Sie, eine Karte von einem Mobiltelefon zu ziehen, aber legen Sie sie in eine andere ein.  Und das ist nicht unmöglich.  Die Sache ist, dass es nicht bequem ist. <br>  Und wenn der Token kaputt geht?  Dann gehen alle deine Schlüssel zum Großen Cthulhu. <br>  Bei einem solchen Schema besteht also die Versuchung, mehrere doppelte Geräte zu verwenden.  Wenn Sie mehrere Smartcards haben, müssen Sie das Problem mit der Schlüsselsynchronisierung noch lösen. <br>  Und ehrlich gesagt sind solche Geräte nicht vor Keyloggern geschützt.  Nun, wenn der PIN-Code von der Karte / dem Token selbst eingegeben werden würde.  Dann noch etwas.  Aber ich habe solche in der Natur nicht gesehen. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gq/1g/js/gq1gjsgtxvfjjvs79syif5_u8_w.png"></div><br><blockquote>  <b>Vorteile: Es können</b> zufällige 256-Bit-Schlüssel verwendet werden.  hohe Sicherheit durch Zwei-Faktor-Authentifizierung;  das höchste Schutzniveau gegen direkte Manipulation. <br>  <b>Nachteile:</b> Geräteabhängigkeit;  erfordert finanzielle Kosten;  geringe Mobilität;  die Notwendigkeit, Karten zu reservieren und infolgedessen Daten zwischen ihnen zu synchronisieren;  Die Anfälligkeit für Keylogger bleibt bestehen. <br></blockquote><br><h3>  Synchronisierung über Online-Service </h3><br>  "Cloud-Technologie" wird jetzt wo immer möglich verschoben.  Es scheint, dass sie zusammen mit der Blockchain ein Ersatz für die "Bananentechnologie" geworden sind.  Natürlich besteht der Wunsch, eine bestimmte Internetplattform für den Austausch von Schlüsselinformationen zu nutzen.  Eine Art Smartcard "online". <br>  Und was?  Sie melden sich anonym mit unserem Schema auf einer solchen Website an.  Senden Sie Ihre Schlüssel dort verschlüsselt mit einem Passwort.  Sie wechseln mit demselben Schlüssel / Passwort von einem anderen Gerät zur selben Site.  Sie bekommen die Schlüssel von dort;  Sie synchronisieren Änderungen nach dem Datum der Bearbeitung.  Ähnlich wie beim Passwort-Manager ist nur dieser online. <br>  Das heißt nur, niemand garantiert, dass der Onlinedienst nicht gehackt wird oder Ihre, wenn auch verschlüsselten "erforderlichen" Schlüssel nicht zusammengeführt werden.  Wer wird einen solchen Dienst kostenlos implementieren.  Das war's. <br>  Obwohl das Passwort die Schlüssel natürlich vor direkter Verwendung schützt.  Aber ist Ihr Passwort gegen Brute Force "offline" resistent?  Das ist eine andere Frage. <br><blockquote>  <b>Vorteile:</b> hohe Mobilität der Berechtigungsnachweise;  Geräte- und Browserunabhängigkeit;  Sie benötigen nur ein einziges Passwort (obwohl das Passwort nicht hinterlassen wurde, ist es bereits besser). <br>  <b>Nachteile:</b> Weniger sicher als das Speichern von Schlüsseln auf einem veräußerlichen Medium.  Tatsächlich basiert die Sicherheit der Schlüssel auf der Stärke des Kennworts für die Auswahl. <br></blockquote><br>  Sie können natürlich einen Hauptschlüssel verwenden, um andere Schlüssel zu verschlüsseln.  Derjenige, mit dem andere Domänenschlüssel berechnet werden.  Als Option. <br><br><a name="part2"></a><h1>  2 Technische Beschreibung des Protokolls </h1><br><br><a name="perm_key_algo"></a><h2>  2.0 Algorithmus zur Generierung von Domänenschlüsseln </h2><br>  Dieses Protokoll definiert nur zwei Methoden zum Generieren von Domänenschlüsseln. <br><br><ul><li>  basierend auf einem Zufallszahlengenerator (vorzugsweise biologisch) </li><li>  basierend auf einem 256-Bit-Hauptschlüssel </li></ul><br>  Im letzteren Fall wird der Domänenschlüssel wie folgt berechnet: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/3aa/d39/ac7/3aad39ac79fc322d157a9f4c58a793f2.svg" alt="$ K = HMAC_ {M_ {Schlüssel}} (Domäne) $" data-tex="display"></p>  wo <math></math><img src="https://habrastorage.org/getpro/habr/formulas/0b7/f4d/5a6/0b7f4d5a6dcc0d36804bd9dfc0ff9403.svg" alt="$ M_ {Schlüssel} $" data-tex="inline">  - 256-Bit-Hauptschlüssel, Domäne - Domänenname, für den der Schlüssel erstellt wurde. <br>  Im Folgenden ist <i>HMAC</i> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ein kryptografischer Hash-Algorithmus,</a> der auf einer 256-Bit-Implementierung der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SHA-2-</a> Hash-Funktion basiert. <br><blockquote>  Eine Kompromittierung oder freiwillige Offenlegung eines Domänenschlüssels gefährdet nicht den ursprünglichen Hauptschlüssel. </blockquote><br>  Der Hauptschlüssel bietet einen Mechanismus für die Mobilität von Benutzeranmeldeinformationen. <br><div class="spoiler">  <b class="spoiler_title">Hinweis</b> <div class="spoiler_text">  In der ersten Version des Protokolls wurde die Option zum Generieren von Domänenschlüsseln basierend auf dem Kennwort des Benutzers als Bereitstellung von Benutzermobilität und Schutz vor Kennwortkompromissen beim Hacken einer Site angesehen.  Im Kapitel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">„3 Sicherheitsempfehlungen“ wird jedoch</a> erläutert, warum beschlossen wurde, ein solches System abzulehnen. </div></div><br>  Wenn der auf der Grundlage des „Masters“ erstellte Schlüssel kompromittiert wurde oder das aus einem solchen Schlüssel berechnete Token (als Ergebnis des Hackens der Site) kompromittiert wurde, muss der Schlüssel geändert werden.  Sie können es in einen zufälligen 256-Bit-Schlüssel ändern oder es mit demselben „Assistenten“ generieren, indem Sie eine Version hinzufügen: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/eae/301/46b/eae30146bac887a402418464641e617e.svg" alt="$ K = HMAC_ {Mkey} (Domain \ cup-Version) $" data-tex="display"></p>  Im Folgenden das Symbol <math></math><img src="https://habrastorage.org/getpro/habr/formulas/a47/285/a28/a47285a2828b9a69edf64fea3e240a0d.svg" alt="$ \ cup $" data-tex="inline">  wird für die Verkettung von Zeichenfolgen (Byte-Arrays) verwendet. <br><br><a name="token_algo"></a><h2>  2.1 der Algorithmus zur Berechnung des Quell-Tokens </h2><br>  Das Authentifizierungstoken des Benutzers wird bei jeder Anforderung einer Domänenressource berechnet.  Zur Berechnung des Anforderungstokens werden die folgenden Daten verwendet: <br><br><ul><li>  <i>Absender</i> - Der Domänenname des Initiators der Anforderung (es kann sich um eine Seite mit einem Iframe oder einem Skript aus der Domäne einer anderen Person handeln, die den Abruf ausführt). </li><li>  <i>Empfänger</i> - Domainname des Empfängers (an den die Anfrage gesendet wird), </li><li>  <i>Kontext</i> - Anforderungsausführungskontext, </li><li>  <i>Schutz</i> - eine zufällige Folge von 32 Bytes (256 Bit), wenn der Kontext leer ist;  sonst leer </li></ul><br>  Diese Daten werden verkettet und mit 256-Bit-SHA-2 <b>auf dem Schlüssel K der Domäne</b> gehasht, <b>die die Anforderung initiiert</b> : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/8d1/bd1/cbc/8d1bd1cbc81815e0121976c9bb5e4ccc.svg" alt="$ K = HMAC_M (Absender \ Tasse Empfänger \ Tasse Kontext \ Tasse Schutz) $" data-tex="display"></p><blockquote>  Ein gültiges Token wird erhalten, wenn der Kontext nicht leer ist.  Für eine ordnungsgemäße Identifizierung am Zielstandort muss die Bedingung Absender = Empfänger = Kontext erfüllt sein. </blockquote><br>  Das Feld Kontext wird zusammen mit Schutz zum Schutz vor <abbr title="Cross-Site-Scripting - &quot;Cross-Site-Scripting&quot;">XSS-</abbr> und <abbr title="Fälschung von standortübergreifenden Anfragen - &quot;Fälschung von standortübergreifenden Anfragen&quot;">CSRF-</abbr> Angriffen sowie vor Benutzerverfolgung verwendet. <br>  Detailliertere Erläuterungen zu den Regeln zur Bestimmung von Absender / Empfänger / Kontext finden Sie weiter unten. <br><br><a name="token_validation_algo"></a><h2>  2.2 Token-Schutzalgorithmus während der Übertragung </h2><br>  Das ursprüngliche Client-Token wird äußerst selten übertragen.  Nur beim Übertragen eines nicht registrierten Tokens zum Zeitpunkt der Erstellung der Sitzung. <br>  <b>Ein Token gilt als nicht registriert,</b> wenn es: auf der Grundlage eines zufälligen (nicht festen) Schlüssels erstellt wird;  wurde vom Server nach dem Senden des Wechsels zum oder des permanenten Schlüssels nicht akzeptiert.  Weitere Informationen finden Sie unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">„Verarbeiten von Token auf dem Server“</a> . <br>  Der Browser und der Server erzeugen gemeinsam ein Paar von Zufallszahlen, die sogenannten  Salz (Salz), mit dem die unteren 128 Bits des Tokens gehasht werden.  Beide tauschen diese Nummern gemäß dem Protokoll aus.  Weitere Informationen finden Sie unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">„Salt-Swap-Prozedur-Browser-Server“</a> . <br>  Daher sieht der Standortserver das folgende Token: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/8ea/b59/cc3/8eab59cc3e5060cfec9956f984807b5f.svg" alt="$ T = Hi (T_s) \ cup HMAC_ {salt} (Lo (T_s)) $" data-tex="display"></p>  wo <math></math><img src="https://habrastorage.org/getpro/habr/formulas/69c/826/a5b/69c826a5bc2d0953c3db1dbcc842a035.svg" alt="$ Hi (T_s) $" data-tex="inline">  - hohe 128 Bit, <math></math><img src="https://habrastorage.org/getpro/habr/formulas/73a/cbf/6b4/73acbf6b426b5d3dff599b4cba44ebfd.svg" alt="$ Lo (T_s) $" data-tex="inline">  - die unteren 128 Bits des ursprünglichen Tokens, <math></math><img src="https://habrastorage.org/getpro/habr/formulas/a47/285/a28/a47285a2828b9a69edf64fea3e240a0d.svg" alt="$ \ cup $" data-tex="inline">  - Verkettung von Zeichenfolgen.  In diesem Fall das erste Token <math></math><img src="https://habrastorage.org/getpro/habr/formulas/c39/070/036/c39070036bed1c9b371606081981a5fb.svg" alt="$ T_s $" data-tex="inline">  sollte dem Server bereits bekannt sein. <br><br>  Im Idealfall sollte sich CSI-Salt jedes Mal ändern, wenn ein Browser einen Server anfordert.  Dies kann jedoch eine kostspielige Anforderung in Bezug auf Rechenressourcen sein.  Darüber hinaus kann die Möglichkeit, parallele Anforderungen an den Server zu senden, "beendet" werden. <br>  Um die Berechnungen zu optimieren, dürfen die CSI-Salt-Werte daher in verschiedenen Anforderungen unverändert bleiben, <u>jedoch nicht länger als eine Sitzung</u> .  Dies kann ein Zeitlimit (Änderung von CSI-Salt alle 5 Minuten) oder eine Reaktion auf die Intensität von Anforderungen (Änderung von CSI-Salt alle 100 Anforderungen) oder nach jeder Reihe von Anforderungen (zum Zeitpunkt der Pause, Client-Server) oder eine gemischte Version sein.  Hier bleibt die Entscheidung den Browserentwicklern überlassen. <br>  Wenn CSI-Salt zu lange unverändert bleibt, wird der Schutz des übertragenen Tokens geschwächt, sodass der Angreifer das Token abfangen kann, während der legitime Benutzer die Abmeldung abgeschlossen hat, und eine nicht autorisierte Anforderung im Namen des Opfers ausführen kann. <br><br><a name="salt_exchange_algo"></a><h2>  2.3 Salzaustauschverfahren zwischen Browser und Server </h2><br>  2.3.1 Token basierend auf einem zufälligen oder nicht registrierten <sup>[1]</sup> Serverschlüssel. <br><div class="scrollable-table"><table><tbody><tr><th>  <b>Browser</b> </th><th>  <b>Server</b> </th></tr><tr><td colspan="2">  <b>Erstanforderung (Benutzersitzungsinitialisierung)</b> </td></tr><tr><td>  Der Browser sendet das Token unverändert. <br>  <b>Ihrer Anfrage fehlt CSI-Salt.</b> <br></td><td>  Der Server sieht zuerst ein solches Token. <br><div class="spoiler">  <b class="spoiler_title">Übrigens</b> <div class="spoiler_text">  Der Server ist möglicherweise nicht der erste, der ein solches Token sieht.  Und der Browser gilt als nicht registriert.  Dies kann passieren, <u>wenn Sie den Schlüssel basierend auf dem Hauptschlüssel auf einem anderen Gerät neu erstellen</u> .  Daher sollte auch diese Situation berücksichtigt werden. </div></div><br>  Nimmt es so wahr wie es ist (betrachtet es als ungeschützt).  Verwendet dieses Token als Sitzungskennung. <br>  Erzeugt sein <i>S- <sub>Salz</sub></i> . <br>  <b>Gibt es in der Antwort im CSI-Salt-Header zurück.</b> <br></td></tr><tr><td colspan="2">  <b>Zweite Anfrage</b> </td></tr><tr><td>  Erzeugt Salz <i>Mit <sub>Salz</sub></i> . <br>  Der Browser verbindet <sup>[3]</sup> sein Salt und das Salt des Servers. <br>  Der Browser sendet die Anfrage und übergibt ein gemeinsames Salt-Token. <br>  <b>Sendet CSI-Salz.</b> <br></td><td>  Der Server empfängt die Anforderung und <b>ruft den CSI-Salt-Client ab</b> . <br>  Der Server verbindet das Browser-Salt mit seinem eigenen und verwendet es, um das Token zu überprüfen. <br><br>  Wenn die Token-Validierung erfolgreich ist, stellt sie dem Benutzer Inhalte gemäß seinen Rechten zur Verfügung. <br><br>  Gibt bei Überprüfungsfehlern den <b>ungültigen</b> Header <b>CSI-Token-Action:</b> an den Client zurück.  Inhalt zurückgeben oder leere Antwort zurückgeben: Serverabhängig. <br></td></tr><tr><td colspan="2">  <b>Nachfolgende Anfragen</b> </td></tr><tr><td>  Der Browser sendet die Anfrage und übergibt ein gemeinsames Salt-Token. <br>  <b>Ihrer Anfrage fehlt CSI-Salt.</b> <br></td><td>  Der Server empfängt die Anforderung und überprüft ihr Token. <br><br>  Wenn die Token-Validierung erfolgreich ist, stellt sie dem Benutzer Inhalte gemäß seinen Rechten zur Verfügung. <br><br>  Gibt bei Überprüfungsfehlern den <b>ungültigen</b> Header <b>CSI-Token-Action:</b> an den Client zurück.  Inhalt zurückgeben oder leere Antwort zurückgeben: Serverabhängig. <br></td></tr><tr><td colspan="2">  <b>Nach einiger Zeit <sup>[2]</sup></b> </td></tr><tr><td>  Erzeugt ein neues Salz <i>C- <sub>Salz</sub></i> . <br>  Verbinden Sie das neue Salz mit dem Serversalz. <br>  Sendet eine Anfrage und übergibt einen Token, der durch ein neues gemeinsames Salz geschützt ist. <br>  <b>Sendet CSI-Salz.</b> <br></td><td>  Der Server empfängt die Anforderung und <b>ruft den neuen CSI-Salt-Client ab</b> . <br>  Der Server verbindet das Browser-Salt mit seinem eigenen und verwendet es, um das Token zu überprüfen. <br><br>  Wenn die Token-Validierung erfolgreich ist, stellt sie dem Benutzer Inhalte gemäß seinen Rechten zur Verfügung. <br><br>  Gibt bei Überprüfungsfehlern den <b>ungültigen</b> Header <b>CSI-Token-Action:</b> an den Client zurück.  Inhalt zurückgeben oder leere Antwort zurückgeben: Serverabhängig. <br></td></tr></tbody></table></div><br>  2.3.2 Token basierend auf dem vom Server registrierten Schlüssel <sup>[1]</sup> . <br><div class="scrollable-table"><table><tbody><tr><th>  <b>Browser</b> </th><th>  <b>Server</b> </th></tr><tr><td colspan="2">  <b>Erstanforderung (Benutzersitzungsinitialisierung)</b> </td></tr><tr><td>  Erzeugt Salz <i>Mit <sub>Salz</sub></i> . <br>  <b>Sendet CSI-Salz.</b> <br>  Überträgt das Token in geschützter Form. <br></td><td>  Der Server empfängt die Anforderung und <b>ruft den CSI-Salt-Client ab</b> . <br>  Liest ein geschütztes Token. <br>  Findet das vollständige Client-Token in seiner Datenbank (verwendet das erste 128-Bit-Token, das in der Suchanforderung empfangen wurde). <br>  Weil  Dies ist die erste Anforderung. Der Server hat kein Salt an den Client gesendet. Die <b>Token-Validierung wird zu diesem Zeitpunkt nur vom Salt des Clients durchgeführt</b> . <br><br>  Gibt bei Überprüfungsfehlern den <b>ungültigen</b> Header <b>CSI-Token-Action:</b> an den Client zurück.  Inhalt zurückgeben oder leere Antwort zurückgeben: Serverabhängig. <br><br>  Wenn die Token-Validierung erfolgreich ist, stellt sie dem Benutzer Inhalte gemäß seinen Rechten zur Verfügung. <br><br>  Erzeugt sein <i>S- <sub>Salz</sub></i> . <br>  <b>Gibt es in der Antwort im CSI-Salt-Header zurück</b> . <br></td></tr><tr><td colspan="2">  <b>Nachfolgende Anfragen</b> </td></tr><tr><td>  Der Browser kombiniert Salt und Server Salt. <br>  Der Browser sendet die Anfrage und übergibt ein gemeinsames Salt-Token. <br>  <b>Ihrer Anfrage fehlt CSI-Salt</b> . <br></td><td>  Der Server empfängt die Anforderung und überprüft ihr Token. <br><br>  Wenn die Token-Validierung erfolgreich ist, stellt sie dem Benutzer Inhalte gemäß seinen Rechten zur Verfügung. <br><br>  Gibt bei Überprüfungsfehlern den <b>ungültigen</b> Header <b>CSI-Token-Action:</b> an den Client zurück.  Inhalt zurückgeben oder leere Antwort zurückgeben: Serverabhängig. <br></td></tr><tr><td colspan="2">  <b>Nach einiger Zeit <sup>[2]</sup></b> </td></tr><tr><td>  Erzeugt ein neues Salz <i>C- <sub>Salz</sub></i> . <br>  Der Browser verbindet das neue Salt mit dem Server Salt. <br>  Der Browser sendet die Anforderung und übergibt ein Token, das durch das neue gemeinsam genutzte Salt geschützt ist. <br>  <b>Sendet CSI-Salz</b> . <br></td><td>  Der Server empfängt die Anforderung und <b>ruft den neuen CSI-Salt-Client ab</b> . <br>  Der Server verbindet das Browser-Salt mit seinem eigenen und verwendet es, um das Token zu überprüfen. <br><br>  Wenn die Token-Validierung erfolgreich ist, stellt sie dem Benutzer den Inhalt gemäß seinen Rechten zur Verfügung. <br><br>  Gibt bei Überprüfungsfehlern den <b>ungültigen</b> Header <b>CSI-Token-Action:</b> an den Client zurück.  Inhalt zurückgeben oder leere Antwort zurückgeben: Serverabhängig. <br></td></tr></tbody></table></div><hr>  <sup>[1] Ein Token gilt als nicht registriert, wenn es: auf der Grundlage eines zufälligen Schlüssels erstellt wird;</sup>  <sup>wurde vom Server nach dem Senden des Wechsels zum oder des permanenten Schlüssels mit der Antwort CSI-Token-Aktion: Erfolg nicht akzeptiert.</sup> <sup><br></sup>  <sup>[2] Die Zeit, in der die CSI-Salt-Änderung vorgenommen wird, wird von den Browsern selbst festgelegt.</sup>  <sup>Dies kann nach einer Reihe von Anforderungen, nach einer Zeitüberschreitung und nach einer bestimmten Anzahl von Anforderungen geschehen.</sup> <sup>  – <b>     CSI-Salt    </b> . <br> [3]     16-  128- .     ,   : <i> <sub>salt</sub></i> || <i>S <sub>salt</sub></i> .       –     ,    .      ,    ,    .</sup> <br><br><a name="context_rules"></a><h2> 2.4    Context </h2><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text">      .   ,  -  .            . <br>       ,   .      ,     . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir nennen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsere</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Domain, deren Seite wir laden (angezeigt in der Adressleiste des Browsers). Die restlichen Domains werden als </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extern bezeichnet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Auch wenn dies untergeordnete Domänen einer bestimmten sind. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir nennen die Ressource </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extern,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wenn sie von einer externen Domain heruntergeladen wurde. Wir nennen die Ressource </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intern,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wenn sie von unserer Domain heruntergeladen wurde. Die Ressource kann ein Skript, ein Bild, eine Ajax-Anfrage und eine beliebige andere Datei sein.</font></font><br><br>   ,       . ,     &lt;script&gt;,   ,    . ,     &lt;script&gt;,  ,    ,           .      &lt;script&gt;         . <br><br>   LINK, SCRIPT, IMG, IFAME  ,      - ,      DOM – <i> </i> . <br><br>   FORM, A, META  ,         (submit, click, timeout) – <i> </i> . <br><br>   <i></i> ,          .   <i></i> ,        . <br><br>  FORM  ,       ,      INPUT,    . <br><br>    <i></i> ,    ,   ,     ,   ,   ,   .        <i></i> . <br><br> <b>    .</b>         ,   ,    click ( ),  submit ( )       onclick/onsubmit. <br><br>         .    – META   http-equiv=«refresh» content=«0». <br><br> <sup> P.  Context     </sup> <br><a name="context_table_P"></a><div class="scrollable-table"><table><tbody><tr><th colspan="3" rowspan="2">   </th><th colspan="4">    ? </th></tr><tr><th>  Benutzer </th><th> . JS </th><th> . JS </th><th>  </th></tr><tr><td rowspan="3">  <sup>1</sup> </td><td colspan="2">  </td><td> P1. Referrer </td><td> P2. Variant <sup>3</sup> </td><td> P3. Empty </td><td> P4. Inherit </td></tr><tr><td rowspan="2">  </td><td>  </td><td> P5. Inherit </td><td> P6. Variant <sup>3</sup> </td><td> P7. Empty </td><td> P8. Inherit </td></tr><tr><td>  </td><td> P9. Empty </td><td> PA. Empty </td><td> PB. Empty </td><td> PC. Empty </td></tr><tr><td colspan="3">  </td><td> PD. Domain </td><td> PE. Variant <sup>3</sup> </td><td> PF. Empty </td><td> PG. Variant <sup>4</sup> </td></tr></tbody></table></div><br><div class="spoiler"> <b class="spoiler_title">  ,  </b> <div class="spoiler_text">  <img src="https://habrastorage.org/webt/cq/l-/6e/cql-6eob6gouvsqsrdy5ltykhfg.gif" align="right"></div></div><br>       (  SRC  IMG),      ,  ,   /  ,   — ,      «». <br><br> <sup> R.  Context    <b> /</b></sup> <br><a name="context_table_R"></a><div class="scrollable-table"><table><tbody><tr><th colspan="3" rowspan="2">   </th><th colspan="3">    ? </th></tr><tr><th> DOM Parser </th><th> . JS </th><th> . JS </th></tr><tr><td rowspan="3">  <sup>2</sup> </td><td colspan="2">  </td><td> R1. Page </td><td></td><td></td></tr><tr><td rowspan="2">  </td><td>  </td><td> R4. Page </td><td></td><td></td></tr><tr><td>  </td><td> R7. Empty </td><td></td><td></td></tr><tr><td colspan="3">  </td><td> RA. Referrer </td><td> RB. Page </td><td> RC. Referrer </td></tr></tbody></table></div><br><div class="spoiler"> <b class="spoiler_title">  ,  </b> <div class="spoiler_text">  <img src="https://habrastorage.org/webt/dl/zi/mn/dlzimnup-7etmrsysxzlxjw1zd8.gif" align="right"></div></div><br><hr> <sup>[1]   <br> [2]   <br> [3] Inherit    , Empty      <br> [4] Inherit      , Empty            (. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> )</sup> <br><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"> <b>Referrer</b> –     Referrer. <br> <b>Page</b> –   (Tab)      . <br> <b>Empty</b> –  . <br> <b>Domain</b> –  Context     <br> <b>Inherit</b> –  Context     <br> <b>Variant</b> –  Context    «-»   <br></div></div><br>   P1..PF, R1..RC            . <br><blockquote>     <b>Referrer</b>  <b>Domain</b>   .       ,       ,      ,       . </blockquote><br><br><a name="sender_recipient_rules"></a><h2> 2.5    Sender  Recipient </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Absender ist die Domäne der Seite / des Skripts / des Stils, von der die Anforderung stammt. </font><font style="vertical-align: inherit;">Die Seite fordert Stile, Bilder und Skripte an. </font><font style="vertical-align: inherit;">Skripte fordern Inhalte über Ajax an. </font><font style="vertical-align: inherit;">Stile können andere Stile laden. </font><font style="vertical-align: inherit;">Dies sind die Initiatoren der Anfrage. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Empfänger ist die Domain, an die die Anfrage wirklich geht. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Damit keine Fragen mehr offen sind, betrachten wir konkrete Beispiele. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lass es eine site.net Seite geben. </font><font style="vertical-align: inherit;">Auf der Hauptseite der Website befindet sich:</font></font><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> style site.net/css/common.css </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> common.css-Stile importieren fonts.google.com/fonts/Roboto.css-Stile </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der Roboto.css-Stil importiert die Schriftart fonts.google.com/fonts/Roboto.ttf </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bild führt zu img.site.net/picture1.jpg </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Frame von adriver.ru/frame geladen </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Skript von adm.site.net/admin.js </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lassen Sie den Rahmen (mit adriver.ru) verbinden: </font></font><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Stil von adriver.ru/style.css </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bild von img.adriver.ru/img/01.png </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Skript von adriver.ru/libs.js </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Skript von api.adriver.ru/v1/ad.js </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Absender- / Empfängerwerte beim Laden von Ressourcen mit dem DOM-Parser </font></font><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Herunterladbare Ressource </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Absenderwert </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Empfängerwert </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net/css/common.css </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com/fonts/Roboto.css </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com/fonts/Roboto.ttf </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.site.net/picture1.jpg </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/frame </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net/admin.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/style.css </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.adriver.ru/img/01.png </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/libs.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru/v1/ad.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru </font></font></td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Betrachten wir nun die Werte von Absender / Empfänger beim Laden von Inhalten mit Skripten während der Ausführung von Ajax-Anforderungen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Absender- / Empfängerwerte beim Laden von Inhalten mit Skripten</font></font><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ausführbares Skript </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wohin geht die Anfrage? </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Absender </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Empfänger </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net/admin.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net/api/ </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/libs.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/api/ </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru/v1/ad.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.2gis.ru / ... </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.2gis.ru </font></font></td></tr></tbody></table></div><br><br><a name="context_tables_comments"></a><h2> 2.6      Context </h2><br>  ,     (  )   ,    Context    . <br><br><a name="P1"></a> <b>P1</b> –          submit  .      /     .  .        . <br><br>    site.net    google.com, Context     (google.com).      site.net   (      ,   ). <br><br>     (  )           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">P1</a> ,  Context     site.net, ..   Context = Referrer. <br><br>      <abbr title="ross Site Request Forgery — «  »">CSRF</abbr> -. <br><br><a name="P5"></a> <b>P5</b> –       , / ,     ;         submit , /  (  FORM,    INPUT).      /     . <br><br><a name="P9"></a> <b>P9</b> – ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">P5</a> ,    ,          (       ). <br><br><a name="PD"></a> <b>PD</b> –      .  . <br><blockquote>       URL   .      . </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie einen Link über eine Desktop-Verknüpfung eines anderen Programms öffnen, sollte jede andere Situation, in der das Betriebssystem einen Befehl zum Öffnen des Links an den Browser sendet, als </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PG-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fall betrachtet werden </font><font style="vertical-align: inherit;">(Öffnen des Links auf Initiative des Browsers). Selbst wenn der Benutzer F5 drückt, um die Seite neu zu laden, sollte dies als </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PG-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fall betrachtet werden </font><font style="vertical-align: inherit;">. Nur wenn der Benutzer in die Adressleiste gelangt und die Eingabetaste drückt, wird er vom Browser als </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PD betrachtet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies geschieht, um CSRF-Angriffe vor anderen Programmen zu schützen.</font></font><br><br>                  Context,   ,     F5 ( ).      ,    -     ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">P1</a> ). <br><br>  ,              site.net,    ,        .           ,     ,   … ,   ,  ,     site.net. <br><br><a name="P2"></a> <b>P2</b> –       ,    ,       click/submit.      ,   .      . <br><br>       , Context    .      , Context  . <br><br><a name="P6"></a> <b>P6</b> –  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">P2</a> ,  /  /  . <br><br><a name="PA"></a> <b>PA</b> –  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">P2</a> ,  /  /  . <br><br><a name="PE"></a> <b>PE</b> –          window.location.href  window.open(…). <br><br>   site.net        ,  Context     .    Context = site.net. <br><br>     ya.ru,      maps.ya.ru,  Context     .     Context     ,      . <br><br>  ,      –  .           CSRF-. <br><br><a name="P3"></a> <b>P3</b> –  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">P2</a> ,   click/submit    . Context   (     ),        ( ). <br><br><a name="P7"></a> <b>P7</b> –  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">P6</a> ,  /  /  . <br><br><a name="PB"></a> <b>PB</b> –  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PA</a> ,  /  /  . <br><br><a name="PF"></a> <b>PF</b> –  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PE</a> ,     . <br><br><a name="P4"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P4</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Der Browser hat die Seite als Ergebnis der Verarbeitung des &lt;META&gt; -Tags neu geladen. </font><font style="vertical-align: inherit;">Das Tag befand sich ursprünglich auf der Seite. </font><font style="vertical-align: inherit;">Rechtliche Weiterleitung. </font><font style="vertical-align: inherit;">Der Kontext bleibt auf der Originalseite erhalten. </font><font style="vertical-align: inherit;">Wie bei </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="P8"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P8</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Der Browser hat die Seite als Ergebnis der Verarbeitung des &lt;META&gt; -Tags neu geladen. </font><font style="vertical-align: inherit;">Das Tag wurde jedoch durch ein eigenes Skript erstellt / geändert. </font><font style="vertical-align: inherit;">Dies ist gültig, aber der Kontext bleibt auf der Originalseite erhalten. </font><font style="vertical-align: inherit;">Wie bei </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Es ist nicht möglich, das legale Token des Benutzers auf diese Weise zu locken.</font></font><br><br><a name="PC"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ähnlich wie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P8</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nur externes Skript. </font><font style="vertical-align: inherit;">Die geöffnete Site erhält eine Zufallszahl als Kontext.</font></font><br><br><a name="PG"></a> <b>PG</b> –       .   ,       ,     .    ,    ,   .       ,   Context       . <br><br>     CSRF-   . <br><br><blockquote>       ,  Context          . </blockquote><br>  ,      ,        (   )    HTTP- Header.       ,   Context .      – . <br><br>      - -. <br><br><blockquote> ,         - .     SSO-         –    . </blockquote><br>   « »     ,     - .    : <br><br><ol><li>         ; </li><li>      SSO- ,   ; </li><li>      SSO-; </li><li> SSO-,   Changed-To,  -    ; </li><li>      - «»,       ; </li><li>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">P1</a> ,        -,     (,     ). </li><li>   -,  ,       . </li></ol><br>   ,   , ,   .  UI-   : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w5/u1/aa/w5u1aahv-_os9k2d81c819d5zhg.gif"></div><br><blockquote>           SSO-.     . </blockquote><br><br>   ,       ,    Context    . <br><br><a name="R1"></a> <b>R1</b> –        (   ).  Context         Context    . <br><br> ,    site.net   adriver.ru,       img.disk.com,    HTTP-  img.disk.com    Context  ,      site.net. <br><br><a name="R4"></a> <b>R4</b> – ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">R1</a> .     /  ,     DOM Parser . ,   site.net/index.html   site.net/require.js      ( &lt;script src=…&gt;) site.net/min.js,         main.js.  Context       ,      site.net. <br><br><a name="R7"></a> <b>R7</b> – ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">R1</a> .      /  ,          Context   256- .      evil.com/drop.js,      site.net,       site.net     , ..            . <br><br><a name="RA"></a> <b>RA</b> –         . ,   site.net/css/common.css,    site.net/index.html,    fonts.google.com/fonts/Roboto.css,        fonts.google.com   Referrer = site.net/css/common.css.  Context      Referrer.    Roboto.css   Roboto.ttf,        fonts.google.com/fonts/Roboto.ttf   Referrer = fonts.google.com/fonts/Roboto.css.  Context       Referrer,   . <br><br> , ,   Roboto.css ( )   /,    CSRF-  : <pre><code class="css">@import "https://site.net/api/payment?victim_params"</code> </pre>  in der Hoffnung, die Anfrage auf site.net im Namen eines autorisierten Benutzers zu erfüllen.  Das Problem für den Angreifer ist jedoch, dass site.net erwartet, ein Token vom Benutzer zu erhalten: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/18c/ba0/6d3/18cba06d3ab48142219dbf3e3f4e2330.svg" alt="$ T_s ^ 1 = HMAC_k (site.net \ cup site.net \ cup site.net) $" data-tex="display"></p><br>  Dann erstellt der Browser wie bei einer solchen CSRF-Anforderung ein Token: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/466/929/b86/466929b86ade0b848996042a3ac12f25.svg" alt="$ T_s ^ 2 = HMAC_k (fonts.google.com \ cup site.net \ cup fonts.google.com) $" data-tex="display"></p><br>  Eine Anfrage an die Site erfolgt im Namen einer anonymen Site, die keine Zugriffsrechte zum Ausführen dieser Vorgänge besitzt. <br><br><a name="RB"></a>  <b>RB</b> - Der Inhalt wird vom eigenen Skript der Site hochgeladen.  In diesem Fall wird der Kontext verwendet, um das Anforderungstoken zu berechnen, das der Seite entspricht, die das Skript enthält.  Für das Skript site.net/1.js auf der Kontext-Seite site.net entspricht es dem Kontext der Seite selbst. <br><blockquote>  Beachten Sie, dass der Kontext der Seite selbst nicht immer dem Domänennamen der Seite entspricht und davon abhängt, wie sie ursprünglich geöffnet wurde. </blockquote>  Angenommen, die Site des Angreifers evil.com öffnet die Seite der angegriffenen Site site.net, auf der das Skript site.net/util.js eine Anforderung mit den über die Seiten-URL übergebenen Parametern ausführt.  Der Angreifer hofft, durch Verschieben von „seinen Parametern“ durch die URL sein eigenes site.net/util.js-Skript zu zwingen, eine Ajax-Anforderung auszuführen, um wichtige Aktionen im Namen des Opfers auszuführen. <br><br>  Angenommen, der Benutzer selbst ist über einen direkten Link zu evil.com gegangen.  Dann ist der Kontext für evil.com evil.com.  Weiter öffnet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">evil.com site.net/api/payment?victim_params</a> mit einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Skript</a> , in der Hoffnung, einen Angriff durchzuführen, aber das Kontextfeld für site.net ist leer (PE / PF-Fall).  Das Skript site.net/utils.js, das eine Ajax-Anforderung ausführt, zwingt den Browser, den Kontext von der Seite site.net zu übernehmen.  Und es ist leer bei uns.  Aber dann erhält site.net eine Ajax-Anfrage mit diesem Token: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/866/a41/990/866a41990a710d17dbe34a04ecb2e28c.svg" alt="$ T = HMAC_ {site.ru-key} (site.net \ cup site.net \ cup random) $" data-tex="display"></p><br>  Für einen autorisierten Benutzer wird Folgendes erwartet: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/025/1b3/fad/0251b3fadaf0e4f1535b6aa8a67df332.svg" alt="$ T_s = HMAC_ {site.ru-key} (site.net \ cup site.net \ cup site.net) $" data-tex="display"></p><br>  site.net sieht ein unbekanntes Token und kann den Benutzer nicht identifizieren.  Der Schutz hat funktioniert. <br><blockquote>  Übrigens ist es aufgrund eines solchen Schemas unrealistisch, eine domänenübergreifende Autorisierung über Popups durchzuführen. </blockquote>  Um SSO unter dem Protokoll zu implementieren, müssen Sie eine neue Registerkarte für die Seite des Autorisierungsservers öffnen.  Gleichzeitig muss der Benutzer eine solche Registerkarte öffnen.  Am besten öffnen Sie dem Benutzer den entsprechenden Link von der Zielwebsite. <br><br><a name="RC"></a>  <b>RC</b> - Inhalte werden mit einem externen Website - Skript geladen.  In diesem Fall wird Context verwendet, um das Anforderungstoken zu berechnen, das dem Feld Request Referrer entspricht. <br><br>  Trotz der Tatsache, dass <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RA</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RB</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RC</a> vor CSRF-Angriffen schützen, führen sie dennoch zur Erzeugung konstanter Token.  Auf <b>diese Weise können Sie die domänenübergreifende Authentifizierung und die domänenübergreifende</b> Benutzerauthentifizierung <b>implementieren</b> (wenn Sie feststellen müssen, dass mehrere Anforderungen an verschiedene Server von diesem Benutzer stammen).  Was kann implementiert werden, um ihm die gleiche Autorität in einer Gruppe verwandter Domänen zu verleihen? <br><br>  Wenn die <b>Site-Seite automatisch</b> von einer anderen Site aus <b>geöffnet wurde</b> , können Sie sich dort nicht anmelden, selbst wenn Sie diese Site selbst neu laden.  Weil Source von einem Nullwert erbt.  Der Browser sollte dem Benutzer dies mitteilen (Quelle = Zufall): <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1h/pr/ew/1hprewdwumpuwpzmzkqfmbds104.jpeg"></div><br>  Dies geschieht zum Schutz vor Sites, die das Öffnen anderer Popup-Fenster erzwingen (selbst oder deren externe Skripte). Auf den geöffneten Sites werden sie neu gestartet oder es werden gefälschte Schaltflächen zum Schließen auf dem gesamten Bildschirm erstellt, die zu denselben Sites führen.  Das heißt,  Dies verhindert einen Versuch, Sie zu verfolgen, in der Hoffnung, ein gültiges Token zu erhalten. <br><br>  <b>Jeder Versuch der Site, Ihre Aktionen mit einem externen Skript nachzuahmen</b> , oder ein Versuch eines externen Skripts, direkt oder indirekt ein initiierendes Tag zu erstellen und an Sie zu senden, führt zum Zeitpunkt der Berechnung des Token-Hash zu einer leeren Quelle und dem Hinzufügen von zufälligen Bytes. <br><br>  Der Trick beim Erstellen oder Ändern des &lt;script&gt; -Tags auf der angegriffenen Seite im DOM hilft nicht weiter.  Das Feld Quelle bleibt leer. <br><br>  Unter den gleichen Bedingungen führen interne Skripte jedoch zu Abfragen, bei denen Source dem vorherigen Wert entspricht.  Und wenn die ursprüngliche Seite Source = Domain hätte, wäre alles in Ordnung.  Der Benutzer bleibt für solche Anfragen autorisiert. <br><br>  Bei Skripten, die von Drittanbieter-Ressourcen (CDN) heruntergeladen wurden, können in einigen Fällen Probleme auftreten.  Und es ist richtig, weil  Die Integrität des CDN-Codes kann nicht garantiert werden.  Wenn Sie die Benutzerberechtigung nicht verlieren möchten, behalten Sie die Skripte auf Ihrer Website und laden Sie sie von Ihrer Domain herunter.  Dies ist so etwas wie das Verbot der Verwendung von http-Links auf https-Seiten. <br><br>  Wir beschreiben die Situation, in die ein Entwickler geraten könnte.  Aufgrund von Benutzeraktionen leitet Ihr Skript einen autorisierten Benutzer auf eine der Seiten der Site weiter (dies erfolgt beispielsweise über ein Formular), sodass der Benutzer weiterhin autorisiert bleiben muss.  Ihr Skript ruft beispielsweise $ (form) .submit () mit einem vom CDN geladenen jQuery-Skript auf.  In diesem Fall sieht der Browser, dass im Aufrufstapel, der das Übermittlungsereignis des Formulars ausgelöst hat, eine Funktion aus einem externen Skript vorhanden ist.  Um <abbr title="Cross-Site-Scripting - &quot;Cross-Site-Scripting&quot;">XSS</abbr> / <abbr title="Fälschung von standortübergreifenden Anfragen - &quot;Fälschung von standortübergreifenden Anfragen&quot;">CSRF-</abbr> Angriffe zu verhindern, macht der Browser das Feld Quelle leer und fügt der Generierung des Tokens zufällige Bytes hinzu (Fall <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">P9</a> ).  Infolgedessen wird der Benutzer auf der neuen Seite plötzlich nicht mehr autorisiert und kann den Vorgang nicht abschließen.  Dies kann für Entwickler, die an die Verwendung von CDNs gewöhnt sind, verwirrend sein. <br><br><a name="protocol_scenario"></a><h2>  2.7 Protokollszenarien </h2><br>  Hier sind die wichtigsten wahrscheinlichen Szenarien für die Arbeit des Benutzers mit der Site aufgeführt, die sich auf alle möglichen Situationen und die Phasen ihrer Implementierung auswirken (anonyme Anmeldung, "Erinnere dich an mich", "Vergiss mich", Umstellung auf die Verwendung eines permanenten Schlüssels, Autorisierung und Beenden, Registrierung und Zwei-Faktor-Authentifizierung, Export / Schlüsselimport, Schlüsselersatz usw.) <br><div class="scrollable-table"><table><tbody><tr><th colspan="3">  1 Forum, Blog, Wikipedia </th></tr><tr><th>  Benutzer </th><th>  Browser </th><th>  Standortserver </th></tr><tr><td>  1.1 Erster Zugriff auf diese Site. </td><td>  Erzeugt einen zufälligen Schlüssel.  Sendet ein unsicheres Token von einem zufälligen Schlüssel. </td><td>  Wir betrachten den Benutzer als anonym.  Wir verwenden dieses Token als Kennung der Benutzersitzung. </td></tr><tr><td>  1.2 Seiten anzeigen. </td><td>  Sendet ein sicheres Token gegen einen zufälligen Schlüssel. </td><td>  Bietet öffentlichen Inhalt.  Überprüft das untere 128-Bit-Token-Bit. </td></tr><tr><td>  1.3 Versuchen, Aktionen auszuführen (Kommentare hinzufügen usw.) </td><td>  Sendet ein sicheres Token gegen einen zufälligen Schlüssel. </td><td>  Sagt dem Benutzer, dass er sich dem System vorstellen muss.  Zu diesem Zeitpunkt ist die Site zuversichtlich, dass der Schlüssel zufällig ist. </td></tr><tr><td>  1.4 Weist den Browser an, die Site daran zu erinnern. </td><td>  Behebt den aktuellen Schlüssel.  Sendet einen permanenten Schlüssel.  Das Token wird nach wie vor in geschützter Form übertragen.  Sendet diesen Schlüssel, bis er vom Server erfolgreich empfangen wird. </td><td>  Jetzt weiß die Site, dass der Schlüssel fest ist.  Sendet CSI-Token-Aktion: Erfolg.  Es kann die Technik anwenden, sich lange an den Benutzer zu erinnern: Entweder speichert es das Token in der Datenbank für die zukünftige Wiederherstellung der Sitzung mit dem Benutzer.  Oder hält die Sitzung für eine längere Zeit (in Datei speichern). </td></tr><tr><td>  1.5 Führt Aktionen aus (Hinzufügen von Posts, Abstimmen usw.) </td><td>  Sendet ein sicheres CSI-Token von einem festen Schlüssel. </td><td>  Protokolliert Aktionen dieses Benutzers. </td></tr><tr><td>  1.6 Schließt die Registerkarte Browser. </td><td>  Nichts. </td><td>  Es wartet auf die folgenden Benutzeranforderungen. </td></tr><tr><td>  1.7 Geht zurück zur Site. </td><td>  Sendet einen sicheren festen Schlüssel. </td><td>  Arbeitet weiter mit dem Benutzer.  Sitzungsdaten werden per Token aus der Datenbank oder der temporären Datei entnommen. </td></tr><tr><td>  1.8 Macht die Tastenfixierung rückgängig (vergiss mich auf dieser Seite) </td><td>  Sendet einen Abmeldeschlüssel </td><td>  Löscht Benutzerdaten in der Datenbank als  Es war ein fester Schlüssel, und der Benutzer kann ihn nie wieder wiederherstellen.  Beendet die Sitzung.  Der Browser wird ein solches Token nie wieder senden. </td></tr><tr><td>  1.9 Wenn Sie nach dem Abmelden zum ersten Mal auf die Site zugreifen. </td><td>  Erzeugt einen zufälligen Schlüssel.  Sendet ein unsicheres Token von einem zufälligen Schlüssel. </td><td>  Diese Seite ist bereits ein neuer Benutzer.  Wir betrachten den Benutzer als anonym.  Wir verwenden das Token als Kennung der Benutzersitzung. </td></tr><tr><td>  1.10 Seiten durchsuchen. </td><td>  Sendet ein sicheres Token gegen einen zufälligen Schlüssel. </td><td>  Bietet öffentlichen Inhalt.  Überprüft das untere 128-Bit-Token-Bit. </td></tr><tr><td>  1.11 Schließt die Registerkarte Browser. </td><td>  Nichts. </td><td>  Unterbricht eine Sitzung nach einer Zeitüberschreitung. </td></tr><tr><td>  1.12 Geht zurück zur Site. </td><td>  Erzeugt einen zufälligen Schlüssel.  Sendet ein unsicheres Token von einem zufälligen Schlüssel. </td><td>  Wir betrachten den Benutzer als anonym.  Wir verwenden dieses Token als Kennung der Benutzersitzung. </td></tr><tr><td>  1.13 Erstellt einen permanenten Site-Schlüssel. </td><td>  Nichts. </td></tr><tr><td>  1.14 Aktivierung des permanenten Schlüssels. </td><td>  <b>Fragt den Benutzer: Möchten Sie wirklich, dass sich die Site an Ihren Schlüssel erinnert?</b>  <b>Stellen Sie sicher, dass diese Site die ist, für die sie sich ausgibt.</b> <br>  Sendet Change-To.  Erst in diesem Moment gibt der Browser das Token an den ungeschützten weiter.  In allen folgenden Fällen überträgt der Browser beim Anmelden immer ein geschütztes Token.  Dafür muss die Site jedoch die Änderung von Token durch CSI-Token-Action bestätigen: Erfolg. </td><td>  Denken Sie an das neue Benutzertoken in der Datenbank.  Ändert die Sitzungs-ID.  Wartet weiterhin auf Anforderungen vom neuen Token.  Sendet CSI-Token-Aktion: Erfolg. </td></tr><tr><td>  1.15 Führt Aktionen aus (Hinzufügen von Posts, Abstimmen usw.) </td><td>  Sendet ein sicheres Token von einem permanenten Schlüssel </td><td>  Protokolliert Aktionen dieses Benutzers.  Überprüft das untere 128-Bit-Token. </td></tr><tr><td>  1.16 Macht den "Exit". </td><td>  Sendet einen Abmeldeschlüssel </td><td>  Unterbricht die Sitzung </td></tr><tr><td>  1.17 Geht zurück zur Site. </td><td>  Erzeugt einen zufälligen Schlüssel.  Sendet ein unsicheres Token von einem zufälligen Schlüssel. </td><td>  Wir betrachten den Benutzer als anonym.  Wir verwenden das Token als Kennung der Benutzersitzung. </td></tr><tr><td>  1.18 Aktivierung des permanenten Schlüssels. </td><td>  Sendet Change-To.  Das Token ist bereits geschützt, weil  Das letzte Mal, als die Seite uns antwortete CSI-Token-Action: Erfolg. </td><td>  Wir laden die gespeicherten Benutzerdaten aus der Datenbank.  Ändert die Sitzungs-ID.  Wir arbeiten mit dem gespeicherten Token.  Wir wissen, dass ein Token auf einem permanenten Schlüssel basiert. </td></tr><tr><td>  1.19 Schließt die Registerkarte Browser. </td><td>  Nichts.  Oder die Abmeldetaste, wenn "Auto-Exit" konfiguriert ist, wenn die Registerkarte geschlossen wird. </td><td>  Unterbricht eine Sitzung nach einer Zeitüberschreitung oder nach Erhalt eines Abmeldeschlüssels. </td></tr><tr><th colspan="3">  2 Online-Shop oder Anzeigenseite </th></tr><tr><th>  Benutzer </th><th>  Browser </th><th>  Standortserver </th></tr><tr><td>  2.1 Zuerst auf dieser Site enthalten. </td><td>  Erzeugt einen zufälligen Schlüssel.  Sendet ein unsicheres Token von einem zufälligen Schlüssel. </td><td>  Wir betrachten den Benutzer als anonym.  Wir verwenden dieses Token als Kennung der Benutzersitzung. </td></tr><tr><td>  2.2 Seiten anzeigen. </td><td>  Sendet ein sicheres Token gegen einen zufälligen Schlüssel. </td><td>  Bietet öffentlichen Inhalt.  Überprüft das untere 128-Bit-Token-Bit. </td></tr><tr><td>  2.3 Versuchen, Aktionen auszuführen (Anzeigen, Einkäufe usw. hinzufügen) </td><td>  Sendet ein sicheres Token gegen einen zufälligen Schlüssel. </td><td>  Sagt dem Benutzer, dass er sich dem System vorstellen muss.  Zu diesem Zeitpunkt ist die Site zuversichtlich, dass der Schlüssel zufällig ist. </td></tr><tr><td>  2.4 Weist den Browser an, die Site daran zu erinnern. </td><td>  Behebt den aktuellen Schlüssel.  Vor der ersten Anforderung wird ein sicheres CSI-Token mit dem permanenten Schlüssel gesendet.  Nach erfolgreichem Empfang wird der Schlüssel nicht mehr gesendet. </td><td>  Jetzt weiß die Site, dass der Schlüssel fest ist.  Es kann die Technik anwenden, sich lange an den Benutzer zu erinnern: Entweder speichert es das Token in der Datenbank für die zukünftige Wiederherstellung der Sitzung mit dem Benutzer.  Oder hält die Sitzung für eine längere Zeit (mehrere Tage). </td></tr><tr><td>  2.5 Führt Aktionen aus (Hinzufügen von Ankündigungen, Käufen usw.) </td><td>  Sendet ein sicheres CSI-Token von einem festen Schlüssel. </td><td>  Protokolliert Aktionen dieses Benutzers.  Überprüft den Token. </td></tr><tr><td>  2.6 Schließt die Registerkarte Browser. </td><td>  Nichts. </td><td>  Hält die Sitzung.  Bei längerer Inaktivität werden Sitzungsdaten aus dem RAM in einer Datei oder Datenbank gespeichert. </td></tr><tr><td>  2.7 Meldet sich erneut bei der Site an. </td><td>  Sendet einen sicheren festen Schlüssel. </td><td>  Die Sitzung wird fortgesetzt.  Wir arbeiten mit dem Benutzer, als wäre nichts passiert. </td></tr><tr><td>  2.8 <b>Erstellt oder importiert einen</b> dauerhaften Site-Schlüssel. </td><td>  Nichts. </td></tr><tr><td>  2.9 Aktivierung des permanenten Schlüssels.  Hier gibt es tatsächlich einen Übergang von der Verwendung eines festen zu einem dauerhaften Schlüssel. </td><td>  Sendet einen Wechselschlüssel.  Das Token wird <b>ungeschützt</b> für den neu erstellten Schlüssel und das nicht auf dem Server registrierte Token übertragen.  Das Token wird <b>geschützt</b> für den importierten Schlüssel übertragen. </td><td>  2.9.A.  Token basierend auf dem neuen Schlüssel. <br>  Wenn das alte Token in der Datenbank gespeichert wurde, ändern Sie einfach das Token in der Datenbank. <br><br>  2.9.V.  Token basierend auf dem importierten Schlüssel. <br>  Wenn das alte Token in der Datenbank gespeichert wurde, löschen Sie es.  Beim Zusammenführen von zwei Profilen eines Benutzers (worüber Sie ihn fragen können) - weil  Tatsächlich hat der Benutzer zwei Token in der Datenbank gespeichert: von einem festen Schlüssel und von einem importierten.  Ändert die Sitzungs-ID.  Sendet CSI-Token-Aktion: Erfolg.  Er wartet weiterhin auf Anfragen vom neuen Token. </td></tr><tr><td>  2.10 Führt Aktionen aus (Käufe, Anzeigenschaltung, Warenkorb, Favoriten, Bewertungen, Vergleiche) </td><td>  Sendet ein sicheres Token von einem permanenten Schlüssel </td><td>  Protokolliert Aktionen dieses Benutzers.  Überprüft das untere 128-Bit-Token. </td></tr><tr><td>  2.11 Schließt die Registerkarte Browser. </td><td>  Nichts.  Oder die Abmeldetaste, wenn "Auto-Exit" konfiguriert ist, wenn die Registerkarte geschlossen wird. </td><td>  Unterbricht eine Sitzung nach einer Zeitüberschreitung oder nach Erhalt eines Abmeldeschlüssels. </td></tr><tr><th colspan="3">  3 Websites mit obligatorischer Vorregistrierung (soziales Netzwerk) </th></tr><tr><th>  Benutzer </th><th>  Browser </th><th>  Standortserver </th></tr><tr><td>  3.1 Auf dieser Website enthalten. </td><td>  Erzeugt einen zufälligen Schlüssel.  Sendet ein unsicheres Token von einem zufälligen Schlüssel. </td><td>  Wir betrachten den Benutzer als anonym.  Wir verwenden dieses Token als Kennung der Benutzersitzung.  Wir lassen nur in öffentlichen Bereichen.  Wenn Sie versuchen, auf geschlossene Inhalte zuzugreifen, übersetzen wir in das Autorisierungsformular. </td></tr><tr><td>  3.2 Erstellt einen permanenten Site-Schlüssel </td><td>  Nichts </td></tr><tr><td>  3.3 Aktivierung des permanenten Schlüssels. </td><td>  <b>Fragt den Benutzer: Möchten Sie wirklich, dass sich die Site an Ihren Schlüssel erinnert?</b>  <b>Stellen Sie sicher, dass diese Site die ist, für die sie sich ausgibt.</b> <br><br>  Sendet Change-To. <br>  <b>Der Token wird im Klartext übertragen</b> . </td><td>  Erinnere dich an den neuen Token.  Wir haben es nicht eilig, in der Datenbank zu speichern, bis die Registrierung noch abgeschlossen ist.  Wir behalten den Benutzer auf dem Registrierungsformular, bis die Eigentumsbestätigung (per Telefon, Post) erfolgt.  Sendet CSI-Token-Aktion: Registrierung </td></tr><tr><td>  3.4 Geben Sie Ihre Kontaktdaten ein. </td><td>  Sendet Ajax-Anfragen.  Sendet Change-To.  Altes Token auf demselben Zufallsschlüssel. <br>  <b>Das neue Token wird bereits in geschützter Form übertragen</b> . <br><br>  Sobald es erfolgreich ist, wird ein neues Token (permanenter Schlüssel) verwendet. </td><td>  Überprüft die Kontaktdaten.  Wenn alles erfolgreich ist, sendet es CSI-Token-Action: Erfolg.  Ansonsten: CSI-Token-Aktion: Registrierung.  Wenn CSI-Token-Action: Abbruch gesendet wird, ist die Registrierung nicht erfolgreich.  Der Browser sollte wieder eine Zufallszahl verwenden (Eingabe abbrechen).  Und melden Sie dies dem Benutzer. </td></tr><tr><td>  3.5 Geht zum geschlossenen Bereich der Site </td><td>  Sendet ein sicheres Token von einem permanenten Schlüssel. </td><td>  Bietet Zugriff durch Überprüfen des unteren 128-Bit-Tokens. </td></tr><tr><td>  3.6 Führt Aktionen aus (Käufe, Anzeigenschaltung, Warenkorb, Favoriten, Bewertungen, Vergleiche) </td><td>  Sendet ein sicheres Token von einem permanenten Schlüssel. </td><td>  Protokolliert Aktionen dieses Benutzers.  Überprüft das untere 128-Bit-Token. </td></tr><tr><td>  3.7 Schließt die Registerkarte Browser. </td><td>  Nichts.  Oder die Abmeldetaste, wenn "Auto-Exit" konfiguriert ist, wenn die Registerkarte geschlossen wird. </td><td>  Unterbricht eine Sitzung nach einer Zeitüberschreitung oder nach Erhalt eines Abmeldeschlüssels. </td></tr><tr><td>  3.8 In dieser Site enthalten. </td><td>  Erzeugt einen zufälligen Schlüssel.  Sendet ein unsicheres Token von einem zufälligen Schlüssel. </td><td>  Wir betrachten den Benutzer als anonym.  Wir verwenden dieses Token als Kennung der Benutzersitzung.  Wir lassen nur in öffentlichen Bereichen.  Wenn wir versuchen, auf geschlossene Inhalte zuzugreifen, informieren wir den Benutzer, dass er ein anonymer Benutzer ist. </td></tr><tr><td>  3.9 Aktivierung des permanenten Schlüssels. </td><td>  Sendet Change-To.  Beide Token werden sicher übertragen. </td><td>  Wir laden Benutzerdaten aus der Datenbank per Token (das höchste 128-Bit).  Jetzt weiß die Site, wer dieser Benutzer ist. </td></tr><tr><td>  3.10 Ändert den permanenten Domänenschlüssel (in einen anderen permanenten) </td><td>  <b>Fragt den Benutzer: Möchten Sie wirklich, dass sich die Site an Ihren neuen Schlüssel erinnert?</b>  <b>Stellen Sie sicher, dass diese Site die ist, für die sie sich ausgibt.</b> <br><br>  Sendet Change-To. <br>  <b>Der neue Token wird im Klartext übertragen.</b>  <b>alt - in geschützt</b> <br></td><td>  Ändert das Token in der Datenbank in ein neues.  Lädt Profildaten.  Verwendet ein neues Token aus den folgenden Anforderungen.  Sendet CSI-Token-Aktion: Erfolg </td></tr><tr><td>  3.11 Führt Aktionen aus (Hinzufügen von Posts, Abstimmen usw.) </td><td>  Sendet ein sicheres Token von einem neuen Schlüssel </td><td>  Protokolliert Aktionen dieses Benutzers.  Überprüft das untere 128-Bit-Token. </td></tr><tr><td>  3.12 Macht einen "Exit". </td><td>  Sendet einen Abmeldeschlüssel </td><td>  Unterbricht die Sitzung </td></tr><tr><td>  3.13 Auf dieser Site enthalten. </td><td>  Erzeugt einen zufälligen Schlüssel.  Sendet ein unsicheres Token von einem zufälligen Schlüssel. </td><td>  Wir betrachten den Benutzer als anonym.  Wir verwenden dieses Token als Kennung der Benutzersitzung.  Wir übersetzen in das Autorisierungsformular. </td></tr><tr><td>  3.14 Permanenten Schlüssel aktivieren </td><td>  Sendet Change-To.  Beide Token werden sicher übertragen. </td><td>  Wir laden Benutzerdaten aus der Datenbank per Token (das höchste 128-Bit). </td></tr><tr><td>  3.15 Importiert einen anderen Schlüssel für diese Domain. <br>  <b>Wichtig: Der importierte Schlüssel muss auf dem Server registriert sein.</b> <br></td><td>  Sendet einen Schlüssel. Abmelden Wechselt zur Verwendung eines zufälligen Schlüssels. </td><td>  Unterbricht die Sitzung </td></tr><tr><td>  3.16 Aktiviert einen neuen Schlüssel </td><td>  Sendet Change-To. <br>  <b>Beide Token werden sicher übertragen.</b> <br><br>  Bitte beachten Sie, dass der „vorherige“ Schlüssel bereits ein zufälliger Schlüssel ist (siehe 3.15). </td><td>  Dieser Schlüssel muss der Datenbank bekannt sein.  <b>Der Schlüsselexport</b> aus dem Browser ist nur für registrierte Token zulässig.  Somit ist der Browser sicher, dass der <b>importierte Schlüssel dem Server bekannt ist,</b> und sendet ihn sicher.  Andernfalls kann der Server das Benutzertoken nicht erkennen und nicht autorisieren. </td></tr><tr><td>  3.17 Führt Aktionen aus (Hinzufügen von Posts, Abstimmen usw.) </td><td>  Sendet ein sicheres Token von einem neuen Schlüssel </td><td>  Protokolliert Aktionen dieses Benutzers.  Überprüft das untere 128-Bit-Token. </td></tr><tr><td>  3.18 kommt heraus </td><td>  Sendet einen Abmeldeschlüssel </td><td>  Unterbricht die Sitzung </td></tr><tr><th colspan="3">  4 Websites mit Zwei-Faktor-Berechtigung (Sberbank Online) </th></tr><tr><th>  Benutzer </th><th>  Browser </th><th>  Standortserver </th></tr><tr><td>  4.1 Auf dieser Website enthalten. </td><td>  Erzeugt einen zufälligen Schlüssel.  Sendet ein unsicheres Token von einem zufälligen Schlüssel. </td><td>  Wir betrachten den Benutzer als anonym.  Wir verwenden dieses Token als Kennung der Benutzersitzung.  Wir übersetzen in das Autorisierungsformular. </td></tr><tr><td>  4.2 Erstellt einen permanenten Site-Schlüssel </td><td>  Nichts </td></tr><tr><td>  4.3 Aktivierung des permanenten Schlüssels. </td><td>  <b>Fragt den Benutzer: Möchten Sie wirklich, dass sich die Site an Ihren Schlüssel erinnert?</b>  <b>Stellen Sie sicher, dass diese Site die ist, für die sie sich ausgibt.</b> <br><br>  Sendet Change-To. <br>  <b>Der Token wird im Klartext übertragen</b> . </td><td>    .   .     .  CSI-Token-Action: registration. </td></tr><tr><td> 4.4     .  «» </td><td>  Change-To      success.       . <br> <b>      .</b> <br></td><td>   .    . </td></tr><tr><td> 4.5      . </td><td>  ajax-.      Change-To. <br><br>    success,      ( ). </td><td>   .      ( ).  CSI-Token-Action: success <br>       . <br>    ,  CSI-Token-Action: registration. <br><br>      CSI-Token-Action: abort.    ,      . </td></tr><tr><td> 4.6    . </td><td>   Token    </td><td>        . </td></tr><tr><td> 4.7  «»   </td><td>   Logout </td><td>   </td></tr><tr><td> 4.8    . </td><td>   .      . </td><td>   .        .          «». </td></tr><tr><td> 4.9   . </td><td>  Change-To. <br> <b>    </b> (..   ;    ). </td><td>        ( 128-).  ,        .      ,   .    .   CSI-Token-Action: success </td></tr><tr><td> 4.10      . </td><td>  ajax-.         . </td><td>  .  .  .       . </td></tr><tr><td> 4.11    . </td><td>   Token   . </td><td>        . </td></tr><tr><td> 4.12  «»   </td><td>   Logout </td><td>   </td></tr><tr><td> 4.12     (). </td><td>    Logout,   «»   .  . </td><td>  ,     Logout.   . </td></tr><tr><th colspan="3"> 5  :   ESXi </th></tr><tr><th>  Benutzer </th><th>  </th><th>   </th></tr><tr><td> 5.1    . </td><td>   .      . </td><td>   .        .   . </td></tr><tr><td> 5.2    . </td><td></td><td></td></tr><tr><td> 5.3     ( ,   ).  ,   <i></i> . </td><td></td><td></td></tr><tr><td> 5.4     (SSH, RDP).      (  .htaccess – .  ) </td><td></td><td></td></tr><tr><td> 5.5   </td><td>  </td><td>     </td></tr><tr><td> 5.6    . </td><td>   .      . </td><td>   .        .   . </td></tr><tr><td> 5.7   . </td><td>  Change-To. <br> <b>    </b> (..  ,         ;     <i></i> ). </td><td>        (. ). <br><br>     ( 128-). <br>    128-.     . <br>   CSI-Token-Action: success. <br>   CSI-Token-Action: abort (    ),   403 – Forbidden. <br>     . </td></tr><tr><td> 5.8    </td><td>      . </td><td>        . </td></tr><tr><td> 5.9   </td><td>    Logout,   «»   .  . </td><td>  ,     Logout.   . </td></tr><tr><th colspan="3"> 6  :   </th></tr><tr><th>  Benutzer </th><th>  </th><th>   </th></tr><tr><td> 6.1    . </td><td>   .      . </td><td>   .        . <b>   .</b>   CSI-Support: yes; </td></tr><tr><td> 6.2   . </td><td></td><td></td></tr><tr><td> 6.3   . </td><td> <b> :   ,     ? ,     ,    .</b> <br><br>  Change-To. <br> <b>    </b> . </td><td>  ,   CSI-Token-Action: registration, ..   . </td></tr><tr><td> 6.4  /  « » </td><td>  / POST-  .      Change-To,    . </td><td>  /.    .    .  CSI-Token-Action: success </td></tr><tr><td> 6.5           «» </td><td>     Token    </td><td>    /.  . </td></tr><tr><td> 6.6  </td><td>   Logout </td><td>   </td></tr><tr><td> 6.7    . </td><td>   .      . </td><td>   . <b>  « »</b> <br></td></tr><tr><td> 6.8   . </td><td>  Change-To. <b>    </b> (..   ;    ). </td><td>     128- .   . </td></tr><tr><td> 6.9    </td><td>   Token    </td><td>       . </td></tr><tr><td> 6.10  </td><td>   Logout </td><td>   </td></tr></tbody></table></div><br>         .htaccess. <br><pre> <code class="apache">&lt;Directory "/var/www/html"&gt; AuthType CSI AuthName "Restricted Content" AuthTokensFile /etc/apache2/.csi_keys Require valid-user &lt;/Directory&gt;</code> </pre><br><pre> cat /etc/apache2/.csi_keys </pre><pre> <code class="bash"># # Client Self Identification tokens file # # CSI-Domain-Key UserName Role 84bc3da1b3e33a18e8d5e1bdd7a18d7a166d77ac1b46a1ec38aa35ab7e628ab5 MelnikovIN admin 6d7fce9fee471194aa8b5b6e47267f0348a24b70a0b376535542b996af517398 BoshirovAM user</code> </pre> <br><br><a name="token_algo_for_server"></a><h2> 2.7.1          </h2><br>     K ,      «»  T ,     .   ,    :  ,           .  ,      vsphere.local, : <br><pre> <code class="plaintext">Sender = Recipient = Context = vsphere.local</code> </pre> <br>   ()  , : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/af8/1c2/5b0/af81c25b054111db5d526fcfb8c4fb8c.svg" alt="$T_s = HMAC_{K}(Sender \cup Recipient \cup Context)$" data-tex="display"></p><br>  ,     .  128     ,     CSI-Salt <sup>*</sup> .  ,    : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/8ea/b59/cc3/8eab59cc3e5060cfec9956f984807b5f.svg" alt="$T = Hi(T_s) \cup HMAC_{salt}( Lo(T_s) )$" data-tex="display"></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wobei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hi</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die hohen 128 Bit sind, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die niedrigen 128 Bit des ursprünglichen Tokens. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bei geschlossenen Verwaltungskonsolen in einem Unternehmensnetzwerk laden Webkonsolen normalerweise keine externen Skripts, Frames usw. </font><font style="vertical-align: inherit;">Daher ist diese Bedingung in den meisten Fällen erfüllt.</font></font><br><hr> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Informationen zur Salzbildung finden Sie im Abschnitt </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">„Salzaustauschverfahren zwischen Browser und Server“.</font></font></a></sup> <br><br><a name="server_token_processing"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.8 Token auf dem Server verarbeiten </font></font></h2><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Senden eines Tokens an den Server (ohne Schlüssel) </font></font></h3><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Token T-Status in der Standortsitzung </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Site Server-Aktionen </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Unbekannt </font></font></td><td>         ,              . <br><br>   .   . <br>   128       . <br>     .      CSI-Salt. <br><br></td></tr><tr><td>  ( 128 ) </td><td>   . <br>      CSI-Salt –   . <br>    .       CSI-Token. <br><br>   ,  CSI-Token-Action: invalid.    400. <br><br>    –  200. <br><br></td></tr></tbody></table></div><br><br><h3>     Permanent </h3><br>    .  ,     ,    .        –   .   CSI-Token-Action: success  CSI-Token-Action: abort. <br><br><h3>     Logout </h3><br>   ,        .     «»  ,       (   ),       («    »). <br><blockquote> , ,   .   . </blockquote><br><br><h3>     Change-To </h3><br>    T,  – '. <br><br> <b>:</b>     T'     (  ,  ),       ( 128 ). <br><div class="scrollable-table"><table><tbody><tr><td colspan="2">      <sup>*</sup> </td><td rowspan="2">      </td></tr><tr><td>  T. </td><td> T' </td></tr><tr><td>  </td><td>  </td><td> : <b> </b> . <br><br>      T' <br>   CSI-Token-Action: success. <br><br>         «».        .        (   ). <br><br>    CSI-Token-Action: registration,   ,     (        ).        Change-To (   )   ,     success  abort.   ,  ,     .   –      (  ). <br></td></tr><tr><td>  </td><td>  ist da </td><td> : <b> Login</b> . <br><br>    T'  .   .   .   CSI-Token-Action: success. <br><br> <b></b> .         Change-To   ,    CSI-Token-Action: success, <b>  </b>    Change-To   <b>  </b> . <br>    ,       .          . <br>  <b>     </b> ,       «» .    <b>      </b> ,       -.  Weil    «  »,    . <br></td></tr><tr><td>  ist da </td><td>  </td><td> : <b>  </b>   . <br><br>    T     T'.   . <br>   CSI-Token-Action: success. <br></td></tr><tr><td> , <br>  der Schlüssel <br>  <br></td><td>  ist da </td><td> : <b>     </b> <br><br>  ,         ,      -.                  -     . <br><br>            (  ).      – . <br><br>   .   CSI-Token-Action: success <br></td></tr><tr><td> , <br>  der Schlüssel <br>  nicht <br> . <br></td><td>  ist da </td><td>  .            .   .  CSI-Token-Action: abort.   . <br><br>  256-       SHA-2.      ( )         . <br><br>          : <ul><li>      ; </li><li>         ; </li><li>    </li></ul>      .   , –  -    . <br>     ,      .        Logout   .   Login  .  . <br></td></tr></tbody></table></div><hr> <sup>*        ,    .</sup> <br><br><a name="sub_domain_identify"></a><h2> 2.9 -  </h2><br>    ,      -   -,      .   ,    site.ru      img.site.ru,  download.site.ru,     . <br><br>     site.ru      -,       . ,     site.ru,         ,  - .       . <br><br>  ,         . <br>      site.ru      : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/a5a/e9b/500/a5ae9b500f4fd8f2600eafdb3a315d32.svg" alt="$T_1 = HMAC_{site.ru-key}(site.ru \cup site.ru \cup site.ru)$" data-tex="display"></p><br>  ,     site.ru   site.ru  : <br><ul><li>    (   ) </li><li>   </li></ul>    T <sub>1</sub> (.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">R1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">R4</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RB</a> ).      site.ru. <br><br>          site.ru,     download.site.ru.        ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">R1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">R4</a> ): <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/445/897/361/445897361e99df033e11f354f37071af.svg" alt="$T_2 = HMAC_{site.ru-key}(site.ru \cup download.site.ru \cup site.ru)$" data-tex="display"></p><br><br>      download.site.ru ,      ajax-    site.ru ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RB</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RC</a> ). <br><br>   domain   : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/231/d05/899/231d058996ea04e27a4a67dbdadf68ee.svg" alt="$T_3 = HMAC_{site.ru-key}(site.ru \cup domain \cup site.ru)$" data-tex="display"></p><br><br> ,  ,      ,      A, B, C      .     - . , . <br><br>   site.ru  ajax-  .   ID != T <sub>1</sub> ,    site.ru.       ID  T <sub>x</sub> .         ID .    ID        . <br><br>   .  ,      , ..     site.ru   . <br><br><a name="part3"></a><h1> 3    </h1><br><div class="spoiler">  <b class="spoiler_title">Hinweis</b> <div class="spoiler_text">      .          . </div></div><br><br><a name="keys_NAA_protection"></a><h2> 3.1      </h2><br>        ,   ,        . <br><br>          . <br><br>     : <br><br><ul><li>      ( ) </li><li>        «» ( ) </li><li>      </li></ul><br>  ,      - (      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">«  »</a> ),         .      ,     PIN-;     . <br><br>  -            .  :     ? <br><br>        ,  -,      «», -, ,   ,    : « - ». <br><br>    <b>   <sup>*</sup>     </b> (     ).       ,       .     100%  ,      .        ,   ,  ,     . <br><br>          ,         (..     ).       (  )  ,          – .    -              . <br><br>    :     +        (   API ).     « ».      . <br><br>  ,      ,   .         ,     ,      ,             .  :   . <br><br>        (   ). , ,           . <br><hr> <sup>*, 32-      64-  .            .</sup> <br><br><a name="why_password_for_keys_not_good"></a><h2> 3.2       </h2><br>              .   ,            . <br><br>        .         .    : <br><br><ol><li>     ,     «» ,        ,   .   ,       -,          . <br><br>  (),     8-  ,       ,    .: ~!@#$%^&amp;.   : 26 + 26 + 10 + 8 = 70 . 8-       70 <sup>8</sup> . <br><br> ,     ,         10 <sup>12</sup>   .      70 <sup>8</sup> / 10 <sup>12</sup> = ~576 .  Das heißt,       ~10 .          5       . 10-      15 .      10 ,      1-2 . <br><br>           ,        . </li><li>       ,     . </li><li>                ,     .  Das heißt,      (       SHA-2). </li><li>  , ,  ,      .        . </li></ol><br><br><a name="risks_loss_keys"></a><h2> 3.3  /     </h2><br> <b>     -?</b> <br><br>   ,       .  ? <br><br>      ,   .     -,    -,   .  . <br><br> ,             ,     ? ,        ( « »)?     « » ? <br><br>    ,      ,         , <i></i>   . ,       .      ,    (email, mobile). ,     (, ).  ,     ,  100% ,    –  . <br><br>  -,    -. <br><blockquote> <b>  ?</b>   ,        .  , ,       bitcoin.  ,   -       .    .     .      «»,  . <br></blockquote><br> <b>      -?</b> <br>   .       - (   )     ,    ,   ,   - .  ,    .            javascript.  .    … <br><br> <b>    -?</b> <br><br>              .               .  Ruhig und ruhig.         .  .   . <br><br>          . ,   ,          , –   .     :      ,           .      ,  -. <br><blockquote> <b>  .</b>      (    ).     .   IP-  ,      ,       . <br></blockquote><br><br><a name="part4"></a><h1> 4     </h1><br><br><a name="attack_user_tracking"></a><h2> 4.1   </h2><br> ,   ,        .    -,        . -, - –     . <br><br>      ,        ,   : <br><br><ol><li>              (     ,     ). </li><li>       (    )       . </li></ol><br>   2   : <b>  </b> ,  .    == . <br><br> ,         № 2.     «»    (  ),         «»,    ,   .      ,   <b>  </b> . <br><br>          № 1.   . <br><br>  1     H <sub>1</sub> ,   2,     1 –  H <sub>2</sub> . ,      (H <sub>1</sub> , H <sub>2</sub> )      -. <br>      3,       2,   .  3     H <sub>3</sub> ,   2,     3 –  H <sub>2'</sub> != H <sub>2</sub> (.   ).  ,    , ..     . <br><br>  <b>  ,        fingerprint </b> .    ,             . <br><br> <b> :</b>   ,     .        . <br><br><a name="attack_XSS"></a><h2> 4.2   XSS </h2><br><br> <abbr title="Cross-Site Scripting — « »">XSS</abbr> –  ,        victim.com  . ,      CDN  . <br><br>                    .           - ( ),    ( ),      ( ). <br><br>           –      Source   . <br><br> <b></b> :   XSS (              ),   .         «».         -. <br><br><a name="attack_CSRF"></a><h2> 4.3   SRF </h2><br><br>     evil.com,  .      (GET/POST/HEAD/PUT/DELETE)  ,     (,    ).       (,     ).   ,     Referer        .  ,   . <br><br>          <abbr title="ross Site Request Forgery — «  »">CSRF</abbr> ,     .             .  ,          .     GET-      ( )      . <br><br>       . <br><br><a name="attack_SSO"></a><h2> 4.4     SSO </h2><br>   S <sub>1</sub>  S <sub>2</sub> ,        ,   ,  SSO,   .  ..       (-     ),       (   ),   S <sub>1</sub>    . <br><br>         A,   .     S <sub>2</sub> ,       ( S <sub>1</sub> )   H <sub>1</sub> .    .      S <sub>1</sub> ,       S <sub>2</sub> . <br><br>    S <sub>2</sub>    .         <br><pre> <code class="xml">&lt;meta http-equiv="refresh" content="0"&gt;</code> </pre>  . <br><br>  S <sub>2</sub>    A         «»: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/is/n5/jh/isn5jhlcnubhl580cvv6lgdloye.jpeg"></div><br>     ,   .        S <sub>2</sub>    H <sub>2</sub> (..   2.4 P1:      ). <br><br>   S <sub>2</sub>         S <sub>1</sub> ,   H <sub>1</sub>   H <sub>2</sub> ,   H <sub>2</sub>    S <sub>1</sub> .    S <sub>1</sub>  S <sub>2</sub>        , ..       <b>   </b> . <br><blockquote>       , ..          ,    . </blockquote> <b> :</b>      .   S <sub>2</sub>         ,        .      ,         S <sub>1</sub>  S <sub>2</sub> .       . <br><br><a name="attack_sso_key_discredit"></a><h2> 4.5    SSO </h2><br>       ,  SSO, .       . <br><br>          . <br><blockquote> <b>          .</b> </blockquote>  ,        SSO,             SSO.   ,          .  Das heißt,     SSO    –       . <br><br>          .            . <br><br>        - :           Id- SSO    .        Id   SSO  .   ,       . <br>          (. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">«  »</a> ). <br><br> <b>.</b>  ,         ,      SSO,     - ,     . <br><br> <b>   .</b>   ,   –         .    -       Id-    .  ,       ,    ,      . <br><br> <b> :</b>        (    ).     .      .        ,          .  , ,   ,     . <br><br> <b> .</b>    SSO ( ,            ).   SSO (      !). <br><br>  SSO          (, ),         . <br><br><a name="attack_token_compromise_due_transmit"></a><h2> 4.6     </h2><br> ,        <b>  100% </b>  .           (     ),  .    . <br><br>   SSL .     HTTPS  .    ,   HTTP.   . <br><br>      ,            .   . <br><br>    –          .    ,           .                 .     -  ,  . <br><blockquote>  , ,   ,      Javascript .  Cookie   HttpOnly.    ajax- . </blockquote> <b> :</b>   ,    ,        (     ).        cookie      . <br><br> <b> :</b>       , ,    ;        ( ,  ). <br><br><a name="attack_token_compromise_due_site_hacking"></a><h2> 4.7      </h2><br>    .       .   :   ,   «».      -  –   . <br><br>   ,  -,        . <br><blockquote> <b>       </b> ,      .   <b>       </b> .   ,       . </blockquote>   ,         -:   - . <br><br>      ,    , ,   , .   . <br><br>   ,    ,       ,    -,    : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/b1c/9ee/9ac/b1c9ee9ac9a8f065c9a394045a24edb9.svg" alt="$DomainKey = HMAC_{M_{key}}( DomainName \cup VersionNumber )$" data-tex="display"></p><br><br><a name="epilog"></a><h1>  Fazit </h1><br>   ,    ,         : «     ?» <br><br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text">  ,        (     ),     (?)  ,   . <br><br> ,     ,  -  .  ,    ,       ,           .       (   ,   ).    ,        « »      «-». <br><br>  -    « ». <s>  </s>    ,  <s></s> «».     ,    .     (   Google ,  Facebook –       ).     (  DDOS-    . – <abbr title="            "><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a></abbr>  )   - .   ,     SSO       ,        .   ? <br><br>   , , ,       .  ,     -     -.  ,     .,     .     email,  .      .  ,             .    ? <br><br> <b>  -.  ?</b> SSO –    . <br><br> ,        « ».         .      .       .             .   , . <br><br>      -      «»  .    ,    « ».          ,    . <br><br>  -,         ? <br></div></div><br> <b>    !</b>  Leider.    ,      «/». <br><br> 1. , ,       popup <br><blockquote> «   cookie!     ,      !  «»,       ». </blockquote>    popup         .      GDPR (   ). <br><br>  .   , cookie      !   «».        ,       . <b>   , +1   .</b> <br><br> 2.          .      SSO    : OAuth, SAML, Kerberos  ..,     ,   ,    ;   -       SSO,    : «   ,  ».            .  .   ,  …          ,      . <b> = </b> . <br><br><div class="spoiler"> <b class="spoiler_title"> ...</b> <div class="spoiler_text">      .     .       ,   -  -  .       .  Ich weiß  Aber leider. <br><br>    -, -,  « »   . <br></div></div><br><br> 3.        .           .        ,    .     -,      -  .  -. <b>  ?</b> <br><br> 4.   ,    .    .           . <br><br> 5.        .         XSS, CSRF.   -     .    — . <br><br> 6.         . <b>   .</b> <br><br> 7. ,  <b>     </b> .  ,     , <u>     </u> ,         ,      , ,  , .        SQL-. <br><br>   ,     ,  <b>     </b>  .       «»  , -     .       .   ,  «-»   . <br><br><blockquote> <i>– ,     </i> <br> .  <br></blockquote><br><br><hr>  <b>PS</b> <br>          .     Habr    .      ,         ()  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a> .       sergey201991[].   ,   .   /      .     .     -. <br><br> ,  ,      : <br><ol><li>         ,       ,   ;    </li><li>      ;           ,  SSO </li><li>       «», -  : -      (   ) </li><li>    -  </li></ol><br>   . 1 —             ,         : ,      1000.                . <br><br>   . 2 —   .     .    ,   .   80-   ,        . <br><br>  ,     ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de472310/">https://habr.com/ru/post/de472310/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de472296/index.html">Auslaufschutzsystem für eine Waschmaschine</a></li>
<li><a href="../de472298/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends für die letzte Woche Nr. 385 (14. - 20. Oktober 2019)</a></li>
<li><a href="../de472300/index.html">Stochastischer Gradientenabstieg (SGD) für die logarithmische Verlustfunktion (LogLoss) in einem binären Klassifizierungsproblem</a></li>
<li><a href="../de472304/index.html">Die NASA stellt Ingenieure ein, um humanoide Roboter der nächsten Generation zu entwickeln</a></li>
<li><a href="../de472306/index.html">PHP Digest Nr. 166 (7.-21. Oktober 2019)</a></li>
<li><a href="../de472312/index.html">Erfahrung in der Übertragung eines Maven-Projekts auf Multi-Release Jar: bereits möglich, aber immer noch schwierig</a></li>
<li><a href="../de472314/index.html">Ich mag Pappleute</a></li>
<li><a href="../de472318/index.html">Verteilte Rückverfolgung in Istio</a></li>
<li><a href="../de472320/index.html">Interview mit Zabbix: 12 offene Antworten</a></li>
<li><a href="../de472326/index.html">Unsere Raumfahrtindustrie ... Und wenn Sie die Probleme der Branche aus der Perspektive eines Geeks betrachten?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>