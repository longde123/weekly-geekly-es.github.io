<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚ÄçüöÄ ü§ì üë®üèª‚Äç‚úàÔ∏è Comment nous avons impl√©ment√© ML dans une application avec pr√®s de 50 millions d'utilisateurs. Exp√©rience Sberbank üë®üèº‚Äçüîß üë©üèº‚Äçüç≥ üçê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! Je m'appelle Nikolai et je suis engag√© dans la construction et la mise en ≈ìuvre de mod√®les d'apprentissage automatique √† Sberbank. Aujo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment nous avons impl√©ment√© ML dans une application avec pr√®s de 50 millions d'utilisateurs. Exp√©rience Sberbank</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sberbank/blog/461747/">  Bonjour, Habr!  Je m'appelle Nikolai et je suis engag√© dans la construction et la mise en ≈ìuvre de mod√®les d'apprentissage automatique √† Sberbank.  Aujourd'hui, je vais parler du d√©veloppement d'un syst√®me de recommandation pour les paiements et les transferts dans l'application sur vos smartphones. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/358/23c/0f8/35823c0f8e513f268f58de291b8504c7.png"></a> <br>  <i>Conception de l'√©cran principal de l'application mobile avec recommandations</i> <br><br>  Nous avions 2 centaines de milliers d'options de paiement possibles, 55 millions de clients, 5 sources bancaires diff√©rentes, une demi-colonne d√©veloppeur et une montagne d'activit√© bancaire, des algorithmes et tout cela, toutes les couleurs, ainsi qu'un litre de graines al√©atoires, une bo√Æte d'hyperparam√®tres, un demi-litre de facteurs de correction et deux des dizaines de biblioth√®ques.  Ce n'est pas que tout cela √©tait n√©cessaire dans le travail, mais depuis qu'il a commenc√© √† am√©liorer la vie des clients, allez dans votre passe-temps jusqu'√† la fin.  Sous la coupe se trouve l'histoire de la bataille pour l'UX, la formulation correcte du probl√®me, la lutte contre la dimensionnalit√© des donn√©es, la contribution √† l'open source et nos r√©sultats. <br><br><a name="habracut"></a><br><h2>  √ânonc√© du probl√®me </h2><br>  Au fur et √† mesure du d√©veloppement et de l'extension, l'application Sberbank Online gagne des fonctionnalit√©s utiles et des fonctionnalit√©s suppl√©mentaires.  En particulier, dans l'application, vous pouvez transf√©rer de l'argent ou payer des services de diverses organisations. <br><br>  ¬´Nous avons examin√© attentivement tous les chemins utilisateur √† l'int√©rieur de l'application et nous avons r√©alis√© que beaucoup d'entre eux peuvent √™tre consid√©rablement r√©duits.  Pour ce faire, nous avons d√©cid√© de personnaliser l'√©cran principal en plusieurs √©tapes.  Tout d'abord, nous avons essay√© de supprimer de l'√©cran ce que le client n'utilise pas, √† commencer par les cartes bancaires.  Ensuite, ils ont mis en √©vidence les actions que le client avait d√©j√† effectu√©es plus t√¥t et pour lesquelles il pouvait entrer dans l'application d√®s maintenant.  Maintenant, la liste des actions comprend les paiements aux organisations et les transferts aux contacts, puis la liste de ces actions sera √©largie ¬ª, a d√©clar√© mon coll√®gue Sergey Komarov, qui d√©veloppe la fonctionnalit√© du point de vue du client dans l'√©quipe Sberbank Online.  Il est n√©cessaire de construire un mod√®le qui remplirait les emplacements d√©sign√©s dans les widgets Actions (figure ci-dessus) avec des recommandations personnelles de paiements et de transferts au lieu de r√®gles simples. <br><br><h2>  Solution </h2><br>  Dans l'√©quipe, nous avons d√©compos√© la t√¢che en deux parties: <br><br><ul><li>  la recommandation de la r√©p√©tition des op√©rations de paiement de services ou de transfert de fonds (bloc "Op√©rations recommand√©es") <br></li><li>  recommandation d'exemples de demandes de recherche de paiement pour des services non utilis√©s auparavant par ce client (bloc ¬´Exemples de recherche¬ª) <br></li></ul><br>  Nous avons d√©cid√© de tester d'abord la fonctionnalit√© sur l'onglet de recherche: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8fe/450/0ee/8fe4500ee0d612b4210a7237a643850b.png"></div><br>  <i>Conception d'√©cran de recherche recommand√©e</i> <br><br><h2>  Op√©rations recommand√©es </h2><br><h3>  Optimisation du scoring </h3><br>  Si nous d√©finissons la sous-t√¢che comme une recommandation de r√©p√©ter les op√©rations, cela nous permet de nous d√©barrasser du calcul et de l'√©valuation de milliers de milliards de combinaisons de toutes les op√©rations possibles pour tous les clients et de nous concentrer sur un nombre beaucoup plus limit√© d'entre elles.  Si, sur l'ensemble des op√©rations disponibles pour nos clients, le client hypoth√©tique avec le hachage YYY n'a utilis√© que le paiement pour le gaz et le stationnement, alors nous √©valuerons la probabilit√© de r√©p√©ter uniquement ces op√©rations pour ce client: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/33f/d0e/415/33fd0e4159a1143ff54c6834c0cd964d.png"><br>  <i>Un exemple de r√©duction de la dimension des donn√©es pour le scoring</i> <br><br><h3>  Pr√©paration de l'ensemble de donn√©es </h3><br>  L'√©chantillon est une observation transactionnelle, enrichie de facteurs de d√©mographie des clients, d'agr√©gats financiers et de diverses caract√©ristiques de fr√©quence d'une op√©ration particuli√®re. <br><br>  La variable cible dans ce cas est binaire et refl√®te le fait de l'√©v√©nement le jour suivant le jour o√π les facteurs sont calcul√©s.  Ainsi, en d√©pla√ßant it√©rativement le jour du calcul des facteurs et en positionnant le drapeau de la variable cible, nous multiplions et marquons les m√™mes op√©rations et les marquons diff√©remment selon la position par rapport √† ce jour. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/929/618/c8a/929618c8a1fbcf3b2385300bf9669ae3.png"></div><br>  <i>Sch√©ma d'observation</i> <br><br>  En calculant la coupe du 17/03/2019 pour le client "YYY", nous obtenons deux observations: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/78b/e70/741/78be707412f6a3fee92dcb5d62413de9.png"></div><br>  <i>Un exemple des observations pour un ensemble de donn√©es</i> <br><br>  ¬´Fonction 1¬ª peut signifier, par exemple, le solde sur toutes les cartes du client, ¬´Fonction 2¬ª - la pr√©sence de ce type d'op√©ration la semaine derni√®re. <br><br>  Nous prenons les m√™mes transactions, mais formons des observations pour une formation √† une date diff√©rente: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/901/c8e/618/901c8e6188d792bb9c77fc207f7d95d1.png"></div><br>  <i>Sch√©ma d'observation</i> <br><br>  Nous obtiendrons des observations pour un ensemble de donn√©es avec d'autres valeurs des deux entit√©s et de la variable cible: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e99/a4f/060/e99a4f0602c8c127f47aecee38f02292.png"><br>  <i>Un exemple des observations pour un ensemble de donn√©es</i> <br><br>  Dans les exemples ci-dessus, pour plus de clart√©, les valeurs r√©elles des facteurs sont donn√©es, mais en fait, les valeurs sont trait√©es par un algorithme automatique: les r√©sultats de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">conversion WOE</a> sont introduits dans l'entr√©e du mod√®le.  Il vous permet d'amener les variables dans une relation monotone avec la variable cible et en m√™me temps de vous d√©barrasser des effets des valeurs aberrantes.  Par exemple, nous avons le facteur ¬´Nombre de cartes¬ª et une certaine distribution de la variable cible: <br><br><img src="https://habrastorage.org/webt/4z/vz/xt/4zvzxtz04cy0corijvcyz4zfhf0.png"><br><br>  <i>Exemple de conversion WOE</i> <br><br>  La transformation WOE nous permet de transformer une d√©pendance non lin√©aire en au moins une d√©pendance monotone.  Chaque valeur du facteur analys√© est associ√©e √† sa propre valeur WOE et donc un nouveau facteur est form√©, et l'original est supprim√© de l'ensemble de donn√©es: <br><br><img src="https://habrastorage.org/webt/9j/os/o4/9joso4mjqdpris64sxtrb3ji34k.png"><br>  <i>L'effet de la transformation WOE sur la relation avec la variable cible</i> <br><br>  Le dictionnaire de conversion des valeurs variables en WOE est enregistr√© et utilis√© ult√©rieurement pour la notation.  Autrement dit, si nous devons calculer les probabilit√©s pour demain, nous cr√©ons un ensemble de donn√©es comme dans les tableaux avec des exemples d'observations ci-dessus, convertissons les variables n√©cessaires en WOE avec le code enregistr√© et appliquons le mod√®le √† ces donn√©es. <br><br><h3>  La formation </h3><br>  Le choix de la m√©thode √©tait strictement limit√© - interpr√©tabilit√©.  Par cons√©quent, afin de respecter les d√©lais, il a √©t√© d√©cid√© de reporter les explications en utilisant le m√™me <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SHAP</a> dans la seconde moiti√© du probl√®me et de tester des m√©thodes relativement simples: r√©gression et neurones superficiels.  L'outil √©tait SAS Miner, un logiciel de pr√©traitement, d'analyse et de construction de mod√®les sur diverses donn√©es sous une forme interactive, ce qui permet d'√©conomiser beaucoup de temps sur l'√©criture de code. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1ae/80d/b3c/1ae80db3c2741d5c70a2cbc9e48dd0ff.png"><br>  <i>Interface SAS Miner</i> <br><br><h3>  √âvaluation de la qualit√© </h3><br>  La comparaison de la m√©trique GINI sur un √©chantillon hors du temps a montr√© que le r√©seau neuronal fait le mieux face √† la t√¢che: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d24/553/e79/d24553e79a193415b2fa94c6e3b0d987.png"></div><br>  <i>Tableau comparatif des mod√®les de qualit√© et des r√®gles de fr√©quence</i> <br><br>  Le mod√®le a deux points de sortie.  Les recommandations sous forme de cartes widget sur l'√©cran principal incluent des op√©rations dont la pr√©vision est sup√©rieure √† un certain seuil (voir la premi√®re image dans le billet).  La fronti√®re est s√©lectionn√©e sur la base d'un √©quilibre de qualit√© et de couverture, qui dans une telle architecture repr√©sente la moiti√© de toutes les op√©rations effectu√©es.  Les 4 premi√®res op√©rations sont envoy√©es au bloc ¬´op√©rations recommand√©es¬ª de l'√©cran de recherche (voir la deuxi√®me image). <br><br><h2>  Exemples de recherche </h2><br>  Passant √† la deuxi√®me partie de la t√¢che, nous revenons au probl√®me d'un grand nombre d'options de paiement possibles pour les services des fournisseurs qui doivent √™tre √©valu√©es et tri√©es au sein de chaque client - des milliards de paires.  En plus de cela, nous avons des donn√©es implicites, c'est-√†-dire qu'il n'y a aucune information sur l'√©valuation des paiements effectu√©s, ni pourquoi le client n'a effectu√© aucun paiement.  Par cons√©quent, pour commencer, il a √©t√© d√©cid√© de tester diff√©rentes m√©thodes d'√©largissement de la matrice des paiements des clients aux fournisseurs: ALS et FM. <br><br><h3>  SLA </h3><br>  ALS (Alternating Least Squares) ou Alternating Least Squares - en filtrage collaboratif, l'une des m√©thodes pour r√©soudre le probl√®me de la factorisation de la matrice d'interaction.  Nous pr√©senterons nos donn√©es transactionnelles sur le paiement des services sous la forme d'une matrice dans laquelle les colonnes sont des identifiants uniques des services de tous les fournisseurs et les lignes sont des clients uniques.  Dans les cellules, nous pla√ßons le nombre d'op√©rations de clients sp√©cifiques avec des prestataires sp√©cifiques pendant une certaine p√©riode: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/430/fcd/db7/430fcddb7494ed4ba54411d0423b5b16.png"><br>  <i>Principe de d√©composition matricielle</i> <br><br>  Le sens de la m√©thode est que nous cr√©ons deux de ces matrices de dimension inf√©rieure, dont la multiplication donne le r√©sultat le plus proche de la grande matrice d'origine dans les cellules remplies.  Le mod√®le apprend √† cr√©er une description factorielle cach√©e pour les clients et les fournisseurs.  Une impl√©mentation de la m√©thode dans la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">implicite</a> a √©t√© utilis√©e.  La formation se d√©roule selon l'algorithme suivant: <br><br><ol><li>  Les matrices des clients et des fournisseurs avec des facteurs cach√©s sont initialis√©es.  Leur nombre est l'hyperparam√®tre du mod√®le. <br></li><li>  La matrice des facteurs cach√©s des fournisseurs est fixe et la d√©riv√©e de la fonction de perte pour la correction de la matrice client est consid√©r√©e.  L'auteur a utilis√© une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">m√©thode</a> int√©ressante <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de gradients conjugu√©s</a> , qui vous permet d'acc√©l√©rer consid√©rablement cette √©tape. <br></li><li>  L'√©tape pr√©c√©dente est r√©p√©t√©e de la m√™me mani√®re pour la matrice des facteurs cach√©s des clients. </li><li>  Les √©tapes 2-3 alternent jusqu'√† ce que l'algorithme converge. </li></ol><br><h3>  La pr√©paration </h3><br>  Les donn√©es transactionnelles ont √©t√© transform√©es en une matrice d'interactions avec un degr√© de raret√© de ~ 99% avec une grande in√©galit√© entre les prestataires.  Pour s√©parer les donn√©es en √©chantillons de train et de validation, nous avons masqu√© au hasard la proportion de cellules remplies: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d60/d96/282/d60d96282aac1b7425ee0ea597253d66.png"><br>  <i>Exemple de partage de donn√©es</i> <br><br>  Les transactions ont √©t√© prises comme test pour la p√©riode suivant la formation, et pr√©sent√©es dans une matrice du m√™me format - elle s'est av√©r√©e hors du temps. <br><br><h3>  La formation </h3><br>  Le mod√®le poss√®de plusieurs hyperparam√®tres qui peuvent √™tre ajust√©s pour am√©liorer la qualit√©: <br><br><ul><li>  Alpha est le coefficient par lequel la matrice est pond√©r√©e, ajustant le degr√© de confiance ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">C_iu</a> ) que le service donn√© est vraiment ¬´aim√©¬ª par le client. <br></li><li>  Le nombre de facteurs dans les matrices cach√©es des clients et des fournisseurs est le nombre de colonnes et de lignes, respectivement. <br></li><li>  Coefficient de r√©gularisation L2 Œª. <br></li><li>  Le nombre d'it√©rations de la m√©thode. <br></li></ul><br>  Nous avons utilis√© la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hyperopt</a> , qui nous permet d'√©valuer l'effet des hyperparam√®tres sur la m√©trique de qualit√© √† l'aide de la m√©thode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">TPE</a> et de s√©lectionner leur valeur optimale.  L'algorithme commence par un d√©marrage √† froid et effectue plusieurs √©valuations de la m√©trique de qualit√© en fonction des valeurs des hyperparam√®tres analys√©s.  Ensuite, en substance, il essaie de s√©lectionner un ensemble de valeurs d'hyperparam√®tres qui est plus susceptible de donner une bonne valeur pour la m√©trique de qualit√©.  Les r√©sultats sont enregistr√©s dans un dictionnaire √† partir duquel vous pouvez cr√©er un graphique et √©valuer visuellement le r√©sultat de l'optimiseur (le bleu c'est mieux): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa2/175/64a/fa217564a3f448a81abbbfad1d27f7a1.png"></div><br>  <i>Le graphique de la d√©pendance de la m√©trique de qualit√© sur la combinaison d'hyperparam√®tres</i> <br><br>  Le graphique montre que les valeurs des hyperparam√®tres affectent fortement la qualit√© du mod√®le.  Puisqu'il est n√©cessaire d'appliquer des plages pour chacune d'entre elles √† l'entr√©e de la m√©thode, le graphique peut en outre d√©terminer s'il est judicieux d'agrandir l'espace de valeurs ou non.  Par exemple, dans notre t√¢che, il est clair qu'il est logique de tester de grandes valeurs pour le nombre de facteurs.  √Ä l'avenir, cela a vraiment am√©lior√© le mod√®le. <br><br><h3>  M√©trique et complexit√© de l'√©valuation de la qualit√© </h3><br>  Comment √©valuer la qualit√© du mod√®le?  L'une des mesures les plus couramment utilis√©es pour les syst√®mes de recommandation o√π la commande est importante est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MAP @ k</a> ou Mean Average Precision √† K.Cette mesure estime la pr√©cision du mod√®le sur K recommandations, en tenant compte de l'ordre des articles dans la liste de ces recommandations en moyenne pour tous les clients. <br><br>  Malheureusement, une op√©ration d'√©valuation de la qualit√©, m√™me sur un √©chantillon, a pris plusieurs heures.  Apr√®s avoir retrouss√© nos manches, nous avons commenc√© √† profiler la fonction mean_average_pecision_at_k () avec la biblioth√®que line_profiler.  La t√¢che √©tait encore compliqu√©e par le fait que la fonction utilisait du code cython et devait √™tre correctement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">prise en compte</a> , faute de quoi les statistiques n√©cessaires n'√©taient tout simplement pas collect√©es.  En cons√©quence, nous avons de nouveau √©t√© confront√©s au probl√®me de la dimensionnalit√© de nos donn√©es.  Pour calculer cette m√©trique, vous devez obtenir des estimations de chaque service de tous les possibles pour chaque client et s√©lectionner les recommandations personnelles top-K en les triant √† partir du tableau r√©sultant.  M√™me en consid√©rant l'utilisation du tri partiel de numpy.argpartition () avec la complexit√© O (n), le tri des notes s'est av√©r√© √™tre l'√©tape la plus longue √©tirant la notation de qualit√© au fil du temps.  Comme numpy.argpartition () n'a pas utilis√© tous les noyaux de notre serveur, il a √©t√© d√©cid√© d'am√©liorer l'algorithme en r√©√©crivant cette partie en C ++ et OpenMP via cython.  Un nouvel algorithme succinct est le suivant: <br><br><ol><li>  Les donn√©es sont d√©coup√©es en lots par les clients. <br></li><li>  Une matrice vide et des pointeurs vers la m√©moire sont initialis√©s. <br></li><li>  Les cha√Ænes de lots par pointeurs sont tri√©es de deux mani√®res: par la fonction partial_sort puis tri√©es par la biblioth√®que d'algorithmes C ++. <br></li><li>  Les r√©sultats sont √©crits en parall√®le dans les cellules de la matrice vide. <br></li><li>  Les donn√©es sont renvoy√©es en python. <br></li></ol><br>  Cela nous a permis d'acc√©l√©rer plusieurs fois le calcul des recommandations.  La r√©vision a √©t√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ajout√©e</a> au r√©f√©rentiel officiel. <br><br><h2>  Analyse des r√©sultats OOT </h2><br>  Et maintenant, il est temps d'√©valuer la qualit√© du mod√®le.  Pourquoi avons-nous besoin d'un √©chantillonnage hors temps?  Si nous regardons la distribution des op√©rations par les fournisseurs, nous verrons l'image suivante: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/345/5d2/3d4/3455d23d4093172fbbf416d9719e14fa.png"></div><br>  <i>R√©partition de la popularit√© des prestataires de services</i> <br><br>  Il y a un d√©s√©quilibre.  Cela conduit au fait que le mod√®le essaie de recommander des services populaires.  Retour √† l'image ci-dessus: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ef/0fd/b08/6ef0fdb084bd7495ad12821c42cd70c2.png"><br><br>  Le probl√®me est que si vous v√©rifiez la pr√©cision du mod√®le en masquant la m√™me matrice, comme cela est conseill√© presque partout, alors pour la plupart des clients (exemples marginaux: ¬´W¬ª, ¬´E¬ª et ¬´I¬ª) la qualit√© des pr√©visions de validation (nous ferons comme si elle n'a pas particip√© √† la s√©lection des hyperparam√®tres) sera √©lev√© si ce sont les prestataires les plus populaires.  En cons√©quence, nous obtenons une fausse confiance dans la force du mod√®le.  Par cons√©quent, nous avons agi comme suit: <br><br><ol><li>  Estimations form√©es des prestataires par mod√®le. <br></li><li>  Les couples client-service existants ont √©t√© exclus des classifications (voir la figure ci-dessous) et des matrices OOT. <br></li><li>  Form√© √† partir des notes restantes des recommandations K-top et not√© MAP @ k sur le reste OOT. <br></li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/ee7/c06/f4b/ee7c06f4b68beda0b4f0e22e3c8163c1.png"><br>  <i>La logique de pr√©paration de la matrice de g√©n√©ration des pr√©visions</i> <br><br>  En tant que ligne de base, nous avons compil√© une liste de fournisseurs, tri√©e par popularit√©, et multipli√©e par tous les clients, en excluant √† nouveau les paires de service client existantes.  Il s'est av√©r√© √™tre triste et pas du tout ce que nous attendions et avons vu sur les √©chantillons de train \ validation: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee2/a94/050/ee2a94050abe17d305bdcffeb895f2d0.png"></div><br>  <i>Tableau de comparaison de la r√©f√©rence et de la qualit√© du mod√®le</i> <br><br>  Arr√™te √ßa!  Nous avons des facteurs clients et des param√®tres de fournisseurs.  Nous obtenons des machines de factorisation. <br><br><h3>  FM </h3><br>  Machines de factorisation (machine de factorisation) - un algorithme d'apprentissage avec un enseignant, con√ßu pour trouver des relations entre des facteurs qui d√©crivent des entit√©s en interaction, qui sont pr√©sent√©es sous la forme de matrices clairsem√©es.  Nous avons utilis√© l'impl√©mentation FM de la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LightFM</a> . <br><br><h3>  Format des donn√©es </h3><br>  En plus de la matrice d'interaction normalis√©e, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">m√©thode</a> utilise deux jeux de donn√©es suppl√©mentaires avec des facteurs pour les clients et pour les services des fournisseurs sous la forme de matrices cod√©es √† chaud connect√©es √† des matrices uniques: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/61b/fa6/c8a/61bfa6c8ab458cfb9b747a37a28e0e32.png"><br>  <i>La logique de pr√©paration de la matrice de g√©n√©ration des pr√©visions</i> <br><br><h3>  √âvaluation de la qualit√© </h3><br>  La qualit√© du mod√®le FM sur nos donn√©es s'est av√©r√©e inf√©rieure √† ALS: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/48b/457/003/48b457003013f435b77ba2d9ecc4cb25.png"></div><br>  <i>Tableau comparatif des mod√®les de qualit√© et de r√©f√©rence</i> <br><br><h3>  Changer l'architecture du mod√®le - Booster </h3><br>  Il a √©t√© d√©cid√© de venir de l'autre c√¥t√©.  Rappelant la r√©partition de la popularit√© des services, nous en avons identifi√© 300, transactions qui couvrent 80% de l'ensemble des op√©rations, et form√© un classificateur sur celles-ci.  Ici, les donn√©es repr√©sentent des agr√©gats de transactions client enrichis de fonctionnalit√©s client: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d25/47d/718/d2547d718a7199fba96be2d0f653bf9a.png"><br>  <i>Sch√©ma d'agr√©gation de transactions</i> <br><br>  Pourquoi seulement c√¥t√© client, demandez-vous?  Parce que dans ce cas, pour pr√©parer des recommandations, il nous suffira d'avoir une ligne par client.  En lui appliquant le mod√®le, nous obtenons le vecteur de sortie des probabilit√©s pour toutes les classes, √† partir duquel il est facile de choisir des recommandations top-K.  Si nous ajoutons les fonctionnalit√©s des services du fournisseur √† l'ensemble de formation, alors au stade de l'application du mod√®le, nous serons oblig√©s soit de pr√©parer 300 lignes pour chaque client - une pour chaque service du fournisseur avec des fonctionnalit√©s les d√©crivant, soit de construire un autre mod√®le pour le tri pr√©alable des candidats √©valuant les candidats. . <br><br>  L'ajout de fonctionnalit√©s aux clients de la SLA n'a pas augment√© nos donn√©es, car nous avons d√©j√† pris en compte l'activit√© transactionnelle - par exemple, dans des sections de MCC ou des cat√©gories dans le style de "gamer" ou de "th√©√¢tre".  Dans ce format, nous avons r√©ussi √† obtenir de bons r√©sultats: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eed/66a/389/eed66a389e4b545fa18a59c6c4ac123a.png"></div><br>  <i>Tableau comparatif des mod√®les de qualit√© et de r√©f√©rence</i> <br><br><h3>  Filtre r√©gional </h3><br>  Malgr√© la haute qualit√© du mod√®le, un probl√®me de plus demeure dans cette approche.  √âtant donn√© que l'architecture des donn√©es et du mod√®le n'implique pas l'utilisation de fonctionnalit√©s des services des fournisseurs, le mod√®le ne prend pas pleinement en compte la g√©ographie et peut recommander que les gens paient pour le service d'un fournisseur local d'une autre r√©gion.  Pour minimiser ce risque, nous avons d√©velopp√© un petit filtre pour pr√©-couper les options avant de formuler des recommandations.  Une fleur de r√©cursivit√© facile est jet√©e sur l'algorithme: <br><br><ol><li>  Nous collectons des informations sur la r√©gion du client √† partir des profils bancaires et d'autres sources internes. <br></li><li>  Nous distinguons les principales r√©gions de pr√©sence pour chaque fournisseur. <br></li><li>  Nous clarifions / compl√©tons les informations sur la r√©gion du client par les r√©gions des prestataires qu'il utilise. <br></li></ol><br>  Apr√®s ces manipulations, √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">l'</a> aide de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">l'indice Herfindahl, nous</a> s√©parons les prestataires r√©gionaux, qui sont repr√©sent√©s dans un ensemble limit√© de r√©gions, des prestataires f√©d√©raux: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/620/15f/090/62015f090d3bdcc34d468f7b36ffef90.png"></div><br>  <i>S√©paration des prestataires par pr√©sence dans les r√©gions</i> <br><br>  Nous formons un masque avec des fournisseurs r√©gionaux acceptables pour les clients et excluons les √©l√©ments inutiles des pr√©dictions du mod√®le avant de cr√©er une liste de recommandations. <br><br><h2>  Conclusion </h2><br>  Nous avons d√©velopp√© deux mod√®les qui forment ensemble un ensemble complet de recommandations sur les paiements et les transferts.  Il a √©t√© possible de r√©duire le chemin du client pour la moiti√© des op√©rations r√©currentes en un seul clic.  Dans les plans futurs visant √† am√©liorer le mod√®le des ¬´op√©rations recommand√©es¬ª √† l'aide de donn√©es de r√©troaction (les cartes peuvent √™tre masqu√©es, etc.), ce qui r√©duira le seuil de s√©lection des recommandations et augmentera la couverture.  Il est √©galement pr√©vu d'√©tendre la couverture des paiements recommand√©s dans le mod√®le des ¬´exemples de recherche¬ª et de d√©velopper un algorithme d'optimisation de la notation pour celui-ci. <br><br>  Nous sommes pass√©s par la voie √©pineuse de la construction d'un syst√®me de recommandation de paiements et de transferts.  Sur le chemin, nous avons eu des bosses et acquis de l'exp√©rience dans la d√©composition et la simplification de telles t√¢ches, l'√©valuation correcte de ces syst√®mes, l'applicabilit√© des m√©thodes, un travail optimal avec de grands volumes de donn√©es et nous avons consid√©rablement √©largi notre compr√©hension des sp√©cificit√©s de ces t√¢ches.  En chemin, j'ai r√©ussi √† contribuer √† l'open source, que nous utilisons nous-m√™mes.  Je vous souhaite des t√¢ches int√©ressantes, des lignes de base r√©alistes et une F1 unique.  Merci de votre attention! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr461747/">https://habr.com/ru/post/fr461747/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr461737/index.html">Nous collectons l'environnement pour le TDD moderne sur le code JavaScript + VS</a></li>
<li><a href="../fr461739/index.html">Backend United 4: Okroshka. Incidents</a></li>
<li><a href="../fr461741/index.html">Regroupement hi√©rarchique des donn√©es cat√©gorielles dans R</a></li>
<li><a href="../fr461743/index.html">Security Week 31: vuln√©rabilit√© VLC et t√©l√©phone cass√©</a></li>
<li><a href="../fr461745/index.html">DeviceLock DLP: Prix du march√© noir russe pour percer les donn√©es personnelles (plus une r√©ponse √† la r√©ponse de Tinkoff Bank)</a></li>
<li><a href="../fr461749/index.html">La beaut√© dans l'≈ìil du spectateur</a></li>
<li><a href="../fr461751/index.html">Contribution du concepteur au d√©veloppement d'applications mobiles</a></li>
<li><a href="../fr461753/index.html">InterSystems IRIS Global Transactions</a></li>
<li><a href="../fr461755/index.html">La psychologie de la vision sonore. Svetlana Lebedeva a expliqu√© comment les gens apprennent une nouvelle fa√ßon de percevoir</a></li>
<li><a href="../fr461759/index.html">√âcoute des communications VoIP crypt√©es</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>