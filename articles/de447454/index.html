<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèæ‚Äçüíº ü§µüèª üöÜ FPGA-Sieben-Segment-Anzeigesteuerung üÄÑÔ∏è üßôüèΩ üèïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! Ich m√∂chte meinen Beitrag zur Weiterentwicklung von FPGAs leisten. In diesem Artikel werde ich versuchen zu erkl√§ren, wie in VHDL ein Ger√§...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>FPGA-Sieben-Segment-Anzeigesteuerung</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447454/"> Hallo Habr!  Ich m√∂chte meinen Beitrag zur Weiterentwicklung von FPGAs leisten.  In diesem Artikel werde ich versuchen zu erkl√§ren, wie in VHDL ein Ger√§t beschrieben wird, das eine Sieben-Segment-Anzeige steuert.  Aber bevor ich anfange, m√∂chte ich kurz dar√ºber sprechen, wie ich zu FPGA gekommen bin und warum ich mich f√ºr die VHDL-Sprache entschieden habe. <br><br>  Vor ungef√§hr einem halben Jahr habe ich mich entschlossen, FPGAs zu programmieren.  Vorher war ich noch nie auf Schaltkreise gesto√üen.  Es gab wenig Erfahrung mit Mikrocontrollern (Atmega328p, STM32).  Unmittelbar nach der Entscheidung, sich mit FPGAs vertraut zu machen, stellte sich die Frage, welche Sprache ich verwenden w√ºrde.  Die Wahl fiel auf VHDL aufgrund seiner strengen Typisierung.  Als Anf√§nger wollte ich so viele m√∂gliche Probleme wie m√∂glich in der Synthesephase und nicht auf einem Arbeitsger√§t erkennen. <br><br>  Warum genau eine Sieben-Segment-Anzeige?  Das Blinken der LED ist bereits m√ºde, und die Logik des Blinkens ist nicht interessant.  Die Logik der Steuerung der Anzeige ist einerseits komplizierter als das Blinken einer LED (d. H. Das Schreiben ist interessanter), und andererseits ist sie recht einfach zu implementieren. <br><a name="habracut"></a><br>  Was ich beim Erstellen des Ger√§ts verwendet habe: <br><br><ul><li>  FPGA Altera Cyclone II (Ich wei√ü, dass es hoffnungslos veraltet ist, aber die Chinesen k√∂nnen es f√ºr einen Cent kaufen) </li><li>  Quartus II Version 13.0.0 (soweit ich wei√ü, ist dies die neueste Version, die Cyclone II unterst√ºtzt) </li><li>  Simulator ModelSim </li><li>  Sieben-Segment-Anzeige mit Schieberegister </li></ul><br><h3>  Herausforderung </h3><br>  Erstellen Sie ein Ger√§t, das die Zahlen 0 - 9 in einem Zyklus anzeigt. Einmal pro Sekunde sollte der auf dem Display angezeigte Wert um 1 erh√∂ht werden. <br><br>  Es gibt viele M√∂glichkeiten, diese Logik zu implementieren.  Ich werde dieses Ger√§t in Module unterteilen, von denen jedes eine Aktion ausf√ºhrt und das Ergebnis dieser Aktion an das n√§chste Modul √ºbertragen wird. <br><cut></cut><br><h3>  Module </h3><br><ul><li>  Dieses Ger√§t sollte in der Lage sein, die Zeit zu z√§hlen.  Um die Zeit zu z√§hlen, habe ich ein Verz√∂gerungsmodul erstellt.  Dieses Modul hat 1 eingehendes und 1 ausgehendes Signal.  Das Modul empf√§ngt das FPGA-Frequenzsignal und √§ndert nach einer bestimmten Anzahl von Perioden des eingehenden Signals den Wert des ausgehenden Signals in die entgegengesetzte Richtung. </li><li>  Das Ger√§t sollte von 0 bis 9 lesen. Hierf√ºr wird das Modul bcd_counter verwendet. </li><li>  Um ein Segment auf dem Display zu beleuchten, m√ºssen Sie das dem Segment entsprechende Bit im Schieberegister des Displays auf 0 setzen und zum L√∂schen des Segments in Bits 1 schreiben (mein Display hat eine invertierte Logik).  Der Decoder bcd_2_7seg √ºbernimmt die Installation und das Zur√ºcksetzen der gew√ºnschten Bits. </li><li>  Das Sendermodul ist f√ºr die Daten√ºbertragung verantwortlich. </li></ul><br>  Das Host-Ger√§t steuert die korrekte √úbertragung von Signalen zwischen den Modulen und erzeugt nach Abschluss der Daten√ºbertragung ein rclk-Signal. <br><br><div class="spoiler">  <b class="spoiler_title">Zur Verdeutlichung gebe ich ein Diagramm dieses Ger√§ts</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/059/804/1b3/0598041b386b8e22438b35683b2cf2c4.png" alt="Schema"><br></div></div><br>  Wie Sie dem Diagramm entnehmen k√∂nnen, verf√ºgt das Ger√§t √ºber 1 eingehendes Signal (clk) und 3 ausgehende Signale (sclk, dio, rclk).  Das clk-Signal kommt in 2 Signalteilern (sec_delay und transfer_delay).  Ein ausgehendes Signal mit einer Periode von 1s verl√§sst das Ger√§t sec_delay.  Bei der ansteigenden Flanke dieses Signals beginnt der Z√§hler (bcd_counter1), die n√§chste Zahl zur Anzeige zu generieren.  Nachdem die Nummer generiert wurde, konvertiert der Decoder (bcd_2_7seg1) die bin√§re Darstellung der Nummer in beleuchtete und nicht beleuchtete Segmente auf dem Display.  Welche √ºber den Sender (Sender1) an das Display √ºbertragen werden.  Der Sender wird mit dem Ger√§t transfer_delay getaktet. <br><br><h3>  Code </h3><br>  Um ein Ger√§t in VHDL zu erstellen, wird eine Konstruktion aus zwei Komponenten von Entit√§t und Architektur verwendet.  Die Entit√§t deklariert eine Schnittstelle f√ºr die Arbeit mit dem Ger√§t.  Die Architektur beschreibt die Logik des Ger√§ts. <br><br><div class="spoiler">  <b class="spoiler_title">So sieht die Entit√§t des Verz√∂gerungsger√§ts aus</b> <div class="spoiler_text"><pre><code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">entity</span></span> delay <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-comment"><span class="hljs-comment">--   entity,  generic    generic (delay_cnt: integer); --       port(clk: in std_logic; out_s: out std_logic := '0'); end entity delay;</span></span></code> </pre> <br></div></div><br>  √úber das generische Feld k√∂nnen wir das Ger√§t auf die gew√ºnschte Verz√∂gerung einstellen.  Und im Feld Ports beschreiben wir die eingehenden und ausgehenden Signale des Ger√§ts. <br><br><div class="spoiler">  <b class="spoiler_title">Die Verz√∂gerungsvorrichtungsarchitektur ist wie folgt</b> <div class="spoiler_text"><pre> <code class="vhdl hljs"><span class="hljs-comment"><span class="hljs-comment">--   architecture  ,     --   entity    0    architecture delay_arch of delay is begin delay_proc: process(clk) variable clk_cnt: integer range 0 to delay_cnt := 0; variable out_v: std_logic := '0'; begin --        if(rising_edge(clk)) then clk_cnt := clk_cnt + 1; if(clk_cnt &gt;= delay_cnt) then -- switch/case   VHDL case out_v is when '0' =&gt; out_v := '1'; when others =&gt; out_v := '0'; end case; clk_cnt := 0; --    out_s   out_v out_s &lt;= out_v; end if; end if; end process delay_proc; end delay_arch;</span></span></code> </pre><br></div></div><br>  Der Code innerhalb des Prozessabschnitts wird sequentiell ausgef√ºhrt, jeder andere Code wird parallel ausgef√ºhrt.  In Klammern werden nach dem Prozessschl√ºsselwort Signale angezeigt, indem ge√§ndert wird, welcher Prozess gestartet wird (Sensitivit√§tsliste). <br><br>  Das bcd_counter-Ger√§t ist hinsichtlich der Ausf√ºhrungslogik mit dem Verz√∂gerungsger√§t identisch.  Daher werde ich nicht im Detail darauf eingehen. <br><br><div class="spoiler">  <b class="spoiler_title">Hier ist die Entit√§t und Architektur des Decoders</b> <div class="spoiler_text"><pre> <code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">entity</span></span> bcd_to_7seg <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>(bcd: <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) := X<span class="hljs-string"><span class="hljs-string">"0"</span></span>; disp_out: <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) := X<span class="hljs-string"><span class="hljs-string">"00"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">entity</span></span> bcd_to_7seg; <span class="hljs-keyword"><span class="hljs-keyword">architecture</span></span> bcd_to_7seg_arch <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> bcd_to_7seg <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> not_bcd_s: <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) := X<span class="hljs-string"><span class="hljs-string">"0"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> not_bcd_s &lt;= <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> bcd; disp_out(<span class="hljs-number"><span class="hljs-number">7</span></span>) &lt;= (bcd(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> not_bcd_s(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> not_bcd_s(<span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (not_bcd_s(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> not_bcd_s(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> not_bcd_s(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> bcd(<span class="hljs-number"><span class="hljs-number">0</span></span>)); disp_out(<span class="hljs-number"><span class="hljs-number">6</span></span>) &lt;= (bcd(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> not_bcd_s(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> bcd(<span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (bcd(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> bcd(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> not_bcd_s(<span class="hljs-number"><span class="hljs-number">0</span></span>)); disp_out(<span class="hljs-number"><span class="hljs-number">5</span></span>) &lt;= not_bcd_s(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> bcd(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> not_bcd_s(<span class="hljs-number"><span class="hljs-number">0</span></span>); disp_out(<span class="hljs-number"><span class="hljs-number">4</span></span>) &lt;= (not_bcd_s(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> not_bcd_s(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> not_bcd_s(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> bcd(<span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (bcd(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> not_bcd_s(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> not_bcd_s(<span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (bcd(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> bcd(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> bcd(<span class="hljs-number"><span class="hljs-number">0</span></span>)); disp_out(<span class="hljs-number"><span class="hljs-number">3</span></span>) &lt;= (bcd(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> not_bcd_s(<span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> bcd(<span class="hljs-number"><span class="hljs-number">0</span></span>); disp_out(<span class="hljs-number"><span class="hljs-number">2</span></span>) &lt;= (not_bcd_s(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> not_bcd_s(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> bcd(<span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (not_bcd_s(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> not_bcd_s(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> bcd(<span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (bcd(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> bcd(<span class="hljs-number"><span class="hljs-number">0</span></span>)); disp_out(<span class="hljs-number"><span class="hljs-number">1</span></span>) &lt;= (not_bcd_s(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> not_bcd_s(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> not_bcd_s(<span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (bcd(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> bcd(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> bcd(<span class="hljs-number"><span class="hljs-number">0</span></span>)); disp_out(<span class="hljs-number"><span class="hljs-number">0</span></span>) &lt;= <span class="hljs-string"><span class="hljs-string">'1'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> bcd_to_7seg_arch;</code> </pre><br></div></div><br>  Die gesamte Logik dieses Ger√§ts wird parallel ausgef√ºhrt.  Ich habe in einem der Videos auf meinem Kanal dar√ºber gesprochen, wie man Formeln f√ºr dieses Ger√§t erh√§lt.  Wen k√ºmmert es, hier ist ein Link zum <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Video</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Im Sendeger√§t kombiniere ich serielle und parallele Logik</b> <div class="spoiler_text"><pre> <code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">entity</span></span> transmitter <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>(enable: <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">boolean</span></span>; clk: <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span>; digit_pos: <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) := X<span class="hljs-string"><span class="hljs-string">"00"</span></span>; digit: <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) := X<span class="hljs-string"><span class="hljs-string">"00"</span></span>; sclk, dio: <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span> := <span class="hljs-string"><span class="hljs-string">'0'</span></span>; ready: <span class="hljs-keyword"><span class="hljs-keyword">buffer</span></span> <span class="hljs-built_in"><span class="hljs-built_in">boolean</span></span> := <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">entity</span></span> transmitter; <span class="hljs-keyword"><span class="hljs-keyword">architecture</span></span> transmitter_arch <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> transmitter <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constant</span></span> max_int: <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> := <span class="hljs-number"><span class="hljs-number">16</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> sclk &lt;= clk <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> ready <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">'0'</span></span>; send_proc: <span class="hljs-keyword"><span class="hljs-keyword">process</span></span>(clk, enable, ready) <span class="hljs-keyword"><span class="hljs-keyword">variable</span></span> dio_cnt_v: <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> max_int := <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">variable</span></span> data_v: <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>((max_int - <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-comment"><span class="hljs-comment">--   dio      clk if(falling_edge(clk) and (enable or not ready)) then if(dio_cnt_v = 0) then --    ,     --          data_v := digit_pos &amp; digit; ready &lt;= false; end if; if(dio_cnt_v = max_int) then dio_cnt_v := 0; ready &lt;= true; dio &lt;= '0'; else dio &lt;= data_v(dio_cnt_v); dio_cnt_v := dio_cnt_v + 1; end if; end if; end process send_proc; end transmitter_arch;</span></span></code> </pre><br></div></div><br>  Zum sclk-Signal leite ich den Wert des in den Sender eintretenden clk-Signals um, aber nur, wenn das Ger√§t gerade Daten sendet (Signal bereit = falsch).  Andernfalls ist der Wert des sclk-Signals 0. Zu Beginn der Daten√ºbertragung (enable = true signal) kombiniere ich die Daten von zwei 8-Bit-Vektoren (digit_pos und digit), die in das Ger√§t eingegeben werden, in einen 16-Bit-Vektor (data_v) und sende Daten von diesem Vektor sind ein Bit pro Takt, wodurch der Wert des √ºbertragenen Bits im ausgehenden Signal dio gesetzt wird.  Von den interessanten Dingen an diesem Ger√§t m√∂chte ich beachten, dass die Daten in dio auf die Hinterflanke des clk-Signals gesetzt sind und die Daten von pin dio in das Schieberegister der Anzeige geschrieben werden, wenn die Vorderflanke des sclk-Signals eintrifft.  Nach Abschluss der √úbertragung signalisiere ich anderen Ger√§ten durch Setzen des Signals ready &lt;= true, dass die √úbertragung abgeschlossen wurde. <br><br><div class="spoiler">  <b class="spoiler_title">So sieht die Entit√§t und Architektur eines Anzeigeger√§ts aus</b> <div class="spoiler_text"><pre> <code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">entity</span></span> display <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>(clk: <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span>; sclk, rclk, dio: <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span> := <span class="hljs-string"><span class="hljs-string">'0'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">entity</span></span> display; <span class="hljs-keyword"><span class="hljs-keyword">architecture</span></span> display_arch <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> display <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">component</span></span> delay <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">generic</span></span> (delay_cnt: <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>(clk: <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span>; out_s: <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span> := <span class="hljs-string"><span class="hljs-string">'0'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">component</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">component</span></span> bcd_counter <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>(clk: <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span>; bcd: <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">component</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">component</span></span> bcd_to_7seg <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>(bcd: <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>); disp_out: <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">component</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">component</span></span> transmitter <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>(enable: <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">boolean</span></span>; clk: <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span>; digit_pos: <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>); digit: <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>); sclk, dio: <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span>; ready: <span class="hljs-keyword"><span class="hljs-keyword">buffer</span></span> <span class="hljs-built_in"><span class="hljs-built_in">boolean</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">component</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> sec_s: <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span> := <span class="hljs-string"><span class="hljs-string">'0'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> bcd_counter_s: <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) := X<span class="hljs-string"><span class="hljs-string">"0"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> disp_out_s: <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) := X<span class="hljs-string"><span class="hljs-string">"00"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> tr_enable_s: <span class="hljs-built_in"><span class="hljs-built_in">boolean</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> tr_ready_s: <span class="hljs-built_in"><span class="hljs-built_in">boolean</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> tr_data_s: <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) := X<span class="hljs-string"><span class="hljs-string">"00"</span></span>; <span class="hljs-comment"><span class="hljs-comment">--  ,   tr_ready_s  --    rclk  signal disp_refresh_s: boolean; signal transfer_clk: std_logic := '0'; begin sec_delay: delay generic map(25_000_000) port map(clk, sec_s); transfer_delay: delay generic map(10) port map(clk, transfer_clk); bcd_counter1: bcd_counter port map(sec_s, bcd_counter_s); bcd_to_7seg1: bcd_to_7seg port map(bcd_counter_s, disp_out_s); transmitter1: transmitter port map(tr_enable_s, transfer_clk, X"10", tr_data_s, sclk, dio, tr_ready_s); tr_proc: process(transfer_clk) variable prev_disp: std_logic_vector(7 downto 0); variable rclk_v: std_logic := '0'; begin if(rising_edge(transfer_clk)) then --         if(tr_ready_s) then --         if(not (prev_disp = disp_out_s)) then prev_disp := disp_out_s; --        tr_data_s &lt;= disp_out_s; --    tr_enable_s &lt;= true; end if; else disp_refresh_s &lt;= true; --       --   , --         tr_enable_s &lt;= false; end if; if(rclk_v = '1') then disp_refresh_s &lt;= false; end if; if(tr_ready_s and disp_refresh_s) then rclk_v := '1'; else rclk_v := '0'; end if; rclk &lt;= rclk_v; end if; end process tr_proc; end display_arch;</span></span></code> </pre><br></div></div><br>  Dieses Ger√§t steuert andere Ger√§te.  Bevor ich Hilfssignale deklariere, deklariere ich hier die Komponenten, die ich verwenden werde.  In der Architektur selbst (nach dem Schl√ºsselwort begin) erstelle ich Ger√§teinstanzen: <br><br><ul><li>  sec_delay - eine Instanz der Verz√∂gerungskomponente.  Das ausgehende Signal wird an sec_s weitergeleitet. </li><li>  transfer_delay - eine Instanz der Verz√∂gerungskomponente.  Das ausgehende Signal wird an das Signal transfer_clk gesendet. </li><li>  bcd_counter1 - eine Instanz der Komponente bcd_counter.  Das ausgehende Signal wird an bcd_counter_s weitergeleitet. </li><li>  bcd_to_7seg1 - eine Instanz der Komponente bcd_to_7seg.  Das ausgehende Signal wird an disp_out_s weitergeleitet. </li><li>  Sender1 ist eine Instanz der Senderkomponente.  Ausgehende Signale werden an die Signale sclk, dio, tr_ready_s gesendet. </li></ul><br>  Nach Komponenteninstanzen wird ein Prozess deklariert.  Dieser Prozess l√∂st mehrere Probleme: <br><br><ol><li><div class="spoiler">  <b class="spoiler_title">Wenn der Sender nicht besetzt ist, initialisiert der Prozess den Start der Daten√ºbertragung.</b> <div class="spoiler_text"><pre> <code class="vhdl hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(tr_ready_s) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">not</span></span> (prev_disp = disp_out_s)) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> prev_disp := disp_out_s; <span class="hljs-comment"><span class="hljs-comment">--     --    tr_data_s &lt;= disp_out_s; --    tr_enable_s &lt;= true; end if; else ...</span></span></code> </pre><br></div></div><br></li><li>  Wenn der Sender besetzt ist (tr_ready_s = false), setzt der Prozess den Wert des Signals disp_refresh_s &lt;= true (dieses Signal bedeutet, dass nach Abschluss der √úbertragung die Daten auf dem Display aktualisiert werden m√ºssen).  Der Signalwert tr_enable_s &lt;= false wird ebenfalls gesetzt. Wenn dies nicht vor Abschluss der √úbertragung erfolgt, werden die auf den Sender heruntergeladenen Daten √ºbertragen <br></li><li><div class="spoiler">  <b class="spoiler_title">Setzt das rclk-Signal und setzt es zur√ºck, nachdem die Daten√ºbertragung abgeschlossen ist</b> <div class="spoiler_text"><pre> <code class="vhdl hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rclk_v = <span class="hljs-string"><span class="hljs-string">'1'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> disp_refresh_s &lt;= <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(tr_ready_s <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> disp_refresh_s) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> rclk_v := <span class="hljs-string"><span class="hljs-string">'1'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> rclk_v := <span class="hljs-string"><span class="hljs-string">'0'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; rclk &lt;= rclk_v;</code> </pre><br></div></div><br></li></ol><br><h3>  Zeitdiagramm </h3><br><div class="spoiler">  <b class="spoiler_title">Hier ist das Zeitdiagramm zum √úbertragen der Nummer 1 an die erste Position der Anzeige</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/87d/b73/21d/87db7321dd5e795125347fc1f08e873a.png" alt="Zeitdiagramm"><br></div></div><br>  Zun√§chst werden die Daten ‚Äû10011111‚Äú √ºbertragen.  Dann lautet die Position der Nummer auf dem Display ‚Äû00010000‚Äú (dieser Parameter erreicht den Sender als Konstante X ‚Äû10‚Äú).  In beiden F√§llen wird zuerst das Bit ganz rechts (lsb) √ºbertragen. <br><br>  Der gesamte Code kann auf <a href="">github angezeigt werden</a> .  Dateien mit einem Index * _tb.vhd sind Debug-Dateien f√ºr die entsprechenden Komponenten (beispielsweise ist Transmitter_tb.vhd eine Debug-Datei f√ºr einen Sender).  F√ºr alle F√§lle habe ich sie auch auf github hochgeladen.  Dieser Code wurde heruntergeladen und auf einem echten Board bearbeitet.  Wen k√ºmmert es, Sie k√∂nnen eine Illustration des Codes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier sehen</a> (ab 15:30 Uhr).  Vielen Dank f√ºr Ihre Aufmerksamkeit. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de447454/">https://habr.com/ru/post/de447454/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de447442/index.html">Einf√ºhrung in den Shell-Operator: Vereinfachung der Bediener f√ºr Kubernetes</a></li>
<li><a href="../de447446/index.html">IBM Workshops: Fr√ºhling-Sommer 2019 - K√ºnstliche Intelligenz, Cloud-Entwicklung, Chat-Bots, Blockchain und andere Technologien</a></li>
<li><a href="../de447448/index.html">Intelligenz Evolution: Der Anfang</a></li>
<li><a href="../de447450/index.html">Mit Ghidra einen einfachen ‚ÄûRiss‚Äú brechen - Teil 1</a></li>
<li><a href="../de447452/index.html">Supply Chain Security: "Wenn ich ein Nationalstaat w√§re ..."</a></li>
<li><a href="../de447456/index.html">Wie genau sagt Yandex den Niederschlag im Winter voraus? Wir analysieren die Genauigkeit von Predictive Services</a></li>
<li><a href="../de447458/index.html">Wie neue W√∂rter im modernen Englisch entstehen</a></li>
<li><a href="../de447460/index.html">Hacken Sie Ihren XiaoMi Staubsauger</a></li>
<li><a href="../de447462/index.html">Visual Studio 2019 .NET-Produktivit√§t</a></li>
<li><a href="../de447464/index.html">Was verhindert das Erlernen einer Fremdsprache?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>