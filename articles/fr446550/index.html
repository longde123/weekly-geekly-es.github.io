<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåö üçò üöá Probl√®mes de mod√®le de coordinateur et qu'est-ce que RouteComposer a √† voir avec cela üñ•Ô∏è üòº üõçÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je continue la s√©rie d'articles sur la biblioth√®que RouteComposer que nous utilisons, et aujourd'hui je veux parler du mod√®le de coordinateur. J'ai √©t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Probl√®mes de mod√®le de coordinateur et qu'est-ce que RouteComposer a √† voir avec cela</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446550/"><p>  Je continue la s√©rie d'articles sur la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RouteComposer</a> que nous utilisons, et aujourd'hui je veux parler du mod√®le de coordinateur.  J'ai √©t√© invit√© √† √©crire cet article par une discussion sur l'un des articles sur le mod√®le, le coordinateur ici sur Habr√©. </p><br><p>  Le mod√®le de coordinateur, introduit il n'y a pas si longtemps, gagne de plus en plus en popularit√© parmi les d√©veloppeurs iOS et, en g√©n√©ral, il est clair pourquoi.  Parce que les fonds de la bo√Æte que fournit <strong>UIKit</strong> ne sont pas un g√¢chis assez polyvalent. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/304/47d/bd8/30447dbd8d2a0a39a34f7f6946a02383.png" alt="image"></p><a name="habracut"></a><br><p>  J'ai d√©j√† soulev√© la question de la fragmentation de la fa√ßon dont je compose la vue des contr√¥leurs sur la pile, et pour √©viter les r√©p√©titions, vous pouvez simplement lire √† ce sujet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><br><p> Soyons honn√™tes.  √Ä un moment donn√©, Epole a r√©alis√© qu'en pla√ßant les contr√¥leurs dans le centre de d√©veloppement d'applications, elle n'offrait aucun moyen sens√© de cr√©er ou de transf√©rer des donn√©es entre eux, et, apr√®s avoir confi√© la solution √† ce probl√®me aux d√©veloppeurs, elle a √©t√© compl√©t√©e automatiquement √† partir de Xcode, et peut-√™tre aux d√©veloppeurs UISearchConnroller, √† un moment donn√© nous a pr√©sent√© des storyboards et des encha√Ænements.  Epolus s'est alors rendu compte qu'elle avait √©crit des applications compos√©es de 2 √©crans uniquement, et dans l'it√©ration suivante, elle a offert la possibilit√© de diviser les storyboards en plusieurs composants, car Xcode a commenc√© √† planter lorsque le storyboard a atteint une certaine taille.  Les s√©quences ont chang√© avec ce concept, en plusieurs it√©rations qui ne sont pas tr√®s compatibles les unes avec les autres.  Leur soutien est √©troitement <code>UIViewController</code> classe <code>UIViewController</code> massive, et, finalement, nous avons obtenu ce que nous avons obtenu.  Le voici: </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepare</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">for</span></span></span></span><span class="hljs-function"><span class="hljs-params"> segue: UIStoryboardSegue, sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> segue.identifier == <span class="hljs-string"><span class="hljs-string">"showDetail"</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> indexPath = tableView.indexPathForSelectedRow { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> object = objects[indexPath.row] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">NSDate</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> controller = (segue.destination <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">UINavigationController</span></span>).topViewController <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">DetailViewController</span></span> controller.detailItem = object controller.navigationItem.leftBarButtonItem = splitViewController?.displayModeButtonItem controller.navigationItem.leftItemsSupplementBackButton = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } } }</code> </pre> <br><p>  Le nombre de tycastcasts forc√©s dans ce bloc de code est incroyable, tout comme les constantes de cha√Æne dans les storyboards eux-m√™mes, pour suivre quel Xcode n'offre aucun moyen.  Et le moindre d√©sir de changer quelque chose dans le processus de navigation vous permettra de compiler le projet sans aucun effort et il se plantera avec un coup dans l'ex√©cution sans le moindre avertissement de Xcode.  Voici un tel WYSIWYG √† la fin, il s'est av√©r√©.  Ce que vous voyez, c'est ce que vous obtenez. </p><br><p>  Vous pouvez argumenter longtemps sur les charmes de ces fl√®ches grises dans des storyboards cens√©s montrer √† quelqu'un les connexions entre les √©crans, mais, comme ma pratique l'a montr√©, j'ai intentionnellement interview√© plusieurs d√©veloppeurs familiers de diff√©rentes entreprises, d√®s que le projet a d√©pass√© 5-6 √©crans, les gens ont essay√© trouver une solution plus fiable et a finalement commenc√© √† garder la structure de la pile de contr√¥leurs de vue dans ma t√™te.  Et si la prise en charge de l'iPad et d'autres mod√®les de navigation ou la prise en charge des push √©tait ajout√©e, tout √©tait triste l√†-bas. </p><br><p>  Depuis lors, plusieurs tentatives ont √©t√© faites pour r√©soudre ce probl√®me, dont certaines ont abouti √† des cadres distincts, d'autres √† des mod√®les architecturaux distincts, car la cr√©ation de contr√¥leurs de vue √† l'int√©rieur du contr√¥leur de vue a rendu ce morceau de code massif et maladroit encore plus. </p><br><p>  Revenons au mod√®le Coordinateur.  Pour des raisons √©videntes, vous ne trouverez pas sa description sur Wikipedia car ce n'est pas un mod√®le de programmation / conception standard.  Il s'agit plut√¥t d'une sorte d'abstraction, qui sugg√®re de cacher sous le capot tout ce code ¬´laid¬ª pour cr√©er et ins√©rer une nouvelle torsion de contr√¥leur sur la pile, stocker des r√©f√©rences au conteneur de contr√¥leurs et pousser des donn√©es entre les contr√¥leurs.  L'article le plus appropri√© d√©crivant ce processus que j'appellerais un article sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">raywenderlich.com</a> .  Il commence √† devenir populaire apr√®s la conf√©rence NSSpain 2015, lorsque le grand public en a √©t√© inform√©.  Plus en d√©tail, ce qui a √©t√© dit peut √™tre trouv√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><br><p>  Je d√©crirai bri√®vement en quoi il consiste avant de poursuivre. </p><br><p>  Le mod√®le de coordinateur dans toutes les interpr√©tations correspond approximativement √† cette image: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/554/4bb/f95/5544bbf95415d233060a7e4d515ff58d.png"></p><br><p>  Autrement dit, le coordinateur est un protocole </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Coordinator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> }</code> </pre> <br><p>  Et tout le code laid est cens√© √™tre cach√© dans la fonction de <code>start</code> .  En outre, le coordinateur peut avoir des liens vers des coordinateurs enfants, c'est-√†-dire qu'ils ont une certaine capacit√© de composition et, par exemple, vous pouvez remplacer une impl√©mentation par une autre.  Autrement dit, cela semble assez √©l√©gant. </p><br><p>  Cependant, les inanit√©s commencent assez t√¥t: </p><br><ol><li>  Certaines impl√©mentations proposent de transformer le coordinateur d'un mod√®le de g√©n√©ration en quelque chose de plus raisonnable, en regardant la pile de contr√¥leurs et en <em>faire un d√©l√©gu√© du conteneur</em> , par exemple, <code>UINavigationController</code> , pour g√©rer la pression du bouton Retour ou balayer vers l'arri√®re et supprimer le coordinateur enfant.  Pour des raisons naturelles, un seul objet peut √™tre un d√©l√©gu√©, ce qui limite le contr√¥le du conteneur lui-m√™me et conduit au fait que cette logique incombe soit au coordinateur, soit cr√©e la n√©cessit√© de d√©l√©guer cette logique √† quelqu'un plus bas dans la liste. </li><li>  Souvent, la logique de cr√©ation du contr√¥leur suivant <em>d√©pend de la logique m√©tier</em> .  Par exemple, pour passer √† l'√©cran suivant, l'utilisateur doit √™tre connect√© au syst√®me.  De toute √©vidence, il s'agit d'un processus asynchrone, qui comprend la g√©n√©ration d'un √©cran interm√©diaire avec le formulaire de connexion, le processus de connexion lui-m√™me peut se terminer avec succ√®s ou non.  Pour √©viter de transformer le coordinateur en un coordinateur massif (similaire au Massive View Controller), nous avons besoin d'une d√©composition.  Autrement dit, vous devez cr√©er un coordinateur coordinateur. </li><li>  Un autre probl√®me rencontr√© par les coordinateurs est qu'ils sont essentiellement des wrappers pour les contr√¥leurs de vue de conteneur tels que <code>UINavigationController</code> , <code>UITabBarController</code> etc.  Et quelqu'un devrait fournir des <em>liens vers ces contr√¥leurs</em> .  Si avec les coordinateurs enfants, tout est encore moins clair, alors avec les coordinateurs initiaux de la cha√Æne, tout n'est pas si simple.  De plus, lors du changement de navigation, par exemple pour le test A / B, le refactoring et l'adaptation de ces coordinateurs entra√Ænent un mal de t√™te s√©par√©.  Surtout si le type de conteneur change. </li><li>  Tout cela devient encore plus compliqu√© lorsque l'application commence √† prendre en charge <em>des √©v√©nements externes</em> qui g√©n√®rent des contr√¥leurs de vue.  Tels que les notifications push ou les liens universels (l'utilisateur clique sur le lien dans la lettre et continue dans l'√©cran d'application correspondant).  Ici, d'autres incertitudes surgissent pour lesquelles le mod√®le de coordinateur n'a pas de r√©ponse exacte.  Vous devez savoir exactement sur quel √©cran l'utilisateur se trouve actuellement afin de lui montrer le prochain √©cran demand√© par un √©v√©nement externe. <br>  L'exemple le plus simple est une application de chat compos√©e de 3 √©crans - une liste de chat, le chat lui-m√™me qui est pouss√© dans la navigation du contr√¥leur de liste de chat et l'√©cran des param√®tres affich√© de fa√ßon modale.  L'utilisateur peut √™tre sur l'un de ces √©crans lorsqu'il re√ßoit une notification push et appuie dessus.  Et ici, l'incertitude commence, s'il est dans la liste de discussion, vous devez d√©marrer une discussion avec cet utilisateur sp√©cifique, s'il est d√©j√† dans la discussion, vous devez le changer, et s'il est d√©j√† dans la discussion avec cet utilisateur, alors ne rien faire et mettre √† jour, si l'utilisateur est sur √©cran des param√®tres - apparemment, vous devez fermer et suivre les √©tapes pr√©c√©dentes.  Ou peut-√™tre pas fermer et simplement afficher le chat de mani√®re modale sur les param√®tres?  Et si les param√®tres sont dans un autre onglet, et non modaux?  Celles <code>if/else</code> ci <code>if/else</code> commencent soit r√©parties sur les coordinateurs ou vont √† un autre m√©ga-coordinateur sous la forme d'un morceau de spaghetti.  De plus, ce sont soit des it√©rations actives sur la pile de vues des contr√¥leurs et une tentative de d√©terminer o√π se trouve l'utilisateur en ce moment, soit une tentative de construction d'une sorte d'application qui surveille leur statut, mais ce n'est pas une t√¢che facile, bas√©e uniquement sur la nature de la pile de contr√¥leurs de vue elle-m√™me. </li><li>  Et la cerise sur le g√¢teau sont les <em>p√©pins UIKit</em> .  Un exemple trivial: un <code>UITabBarController</code> avec un <code>UINavigationController</code> dans le deuxi√®me onglet avec un autre <code>UIViewController</code> .  L'utilisateur dans le premier onglet provoque un certain √©v√©nement qui n√©cessite de basculer l'onglet et de <code>UINavigationController</code> un autre contr√¥leur de vue dans son <code>UINavigationController</code> .  Tout cela doit √™tre fait dans une telle s√©quence.  Si l'utilisateur n'a jamais ouvert le deuxi√®me onglet avant cela et que <code>UINavigationController</code> pas <code>UINavigationController</code> appel√© sur <code>viewDidLoad</code> la m√©thode <code>push</code> ne fonctionnera pas en ne laissant qu'un message indistinct dans la console.  Autrement dit, les coordinateurs ne peuvent pas simplement devenir des auditeurs d'√©v√©nements dans cet exemple, ils doivent travailler dans une certaine s√©quence.  Ils doivent donc se conna√Ætre.  Et cela contredit d√©j√† la premi√®re d√©claration du mod√®le de coordinateur, selon laquelle les coordinateurs ne savent rien des coordinateurs g√©n√©rateurs et ne sont connect√©s qu'avec les enfants.  Et limite √©galement leur interchangeabilit√©. </li></ol><br><p>  Cette liste peut √™tre prolong√©e, mais en g√©n√©ral, il est clair que le mod√®le de coordinateur est une solution plut√¥t limit√©e et peu √©volutive.  Si vous le regardez sans lunettes roses, c'est un moyen de d√©composer une partie de la logique, qui est g√©n√©ralement √©crite √† l'int√©rieur de massifs <code>UIViewController</code> , dans une autre classe.  Toutes les tentatives pour en faire plus qu'une simple usine g√©n√©rative et y introduire d'autres logiques ne finissent pas bien. </p><br><p>  Il convient de noter qu'il existe des biblioth√®ques bas√©es sur ce mod√®le, qui, d'une mani√®re ou d'une autre, permettent d'att√©nuer partiellement les inconv√©nients ci-dessus.  Je <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mentionnerais XCoordinator</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RxFlow</a> . </p><br><h2 id="chto-sdelali-my">  Qu'avons-nous fait? </h2><br><p>  Apr√®s avoir jou√© dans le projet que nous avons obtenu d'une autre √©quipe pour le support et le d√©veloppement, avec les coordinateurs et leur <em>routeur</em> "arri√®re-grand-m√®re" simplifi√© dans l'approche architecturale <em>VIPER</em> , nous sommes revenus √† l'approche qui fonctionnait bien dans le grand projet pr√©c√©dent de notre entreprise.  Cette approche n'a pas de nom.  Il se trouve en surface.  Lorsque nous avions du temps libre, il a √©t√© compil√© dans une biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RouteComposer</a> distincte qui a compl√®tement remplac√© les coordinateurs et s'est av√©r√©e plus flexible. </p><br><p>  Quelle est cette approche?  En cela, pour me fier √† la pile (arborescence), je tord les contr√¥leurs tels quels.  Afin de ne pas cr√©er d'entit√©s inutiles qui doivent √™tre surveill√©es.  N'enregistrez pas ou ne suivez pas les conditions. </p><br><p>  Examinons de <em>plus</em> pr√®s les entit√©s <em>UIKit</em> et essayons de comprendre ce que nous avons en fin de compte et avec quoi nous pouvons travailler: </p><br><ol><li>  <strong>La pile du contr√¥leur</strong> est un arbre.  Il existe un contr√¥leur de vue racine qui a des contr√¥leurs de vue enfant.  Les contr√¥leurs de vue pr√©sent√©s de fa√ßon modale sont un cas particulier des contr√¥leurs de vue enfants, car ils ont √©galement une liaison avec le contr√¥leur de vue g√©n√©r√©.  Tout est pr√™t √† l'emploi. </li><li>  J'ai besoin de cr√©er des entit√©s de contr√¥leurs.  Ils ont tous des constructeurs diff√©rents; ils peuvent √™tre cr√©√©s √† l'aide de fichiers Xib ou de storyboards.  Ils ont des param√®tres d'entr√©e diff√©rents.  Mais ils sont unis en ce qu'ils doivent √™tre cr√©√©s.  Donc, ici, nous pouvons utiliser le mod√®le <strong>Factory</strong> , qui sait comment cr√©er le contr√¥leur de vue souhait√©.  Chaque usine est facile √† couvrir avec des tests unitaires complets et elle est ind√©pendante des autres. </li><li>  Nous divisons les contr√¥leurs de vue en 2 classes: 1. Il suffit de visualiser les contr√¥leurs, 2. <strong>Les contr√¥leurs de vue de conteneur (Container View Controller)</strong> .  Les contr√¥leurs de vue de conteneur diff√®rent des contr√¥leurs ordinaires en ce qu'ils peuvent contenir des contr√¥leurs de vue enfant - √©galement des conteneurs ou des contr√¥leurs simples.  De tels contr√¥leurs de vue sont disponibles <code>UINavigationController</code> : <code>UINavigationController</code> , <code>UITabBarController</code> et ainsi de suite, mais peuvent √©galement √™tre cr√©√©s par l'utilisateur.  Si nous l'ignorons, nous pouvons trouver les propri√©t√©s suivantes dans tous les conteneurs: 1. Ils ont une liste de tous les contr√¥leurs qu'ils contiennent.  2. Un ou plusieurs contr√¥leurs sont actuellement visibles.  3. On peut leur demander de rendre visible l'un de ces contr√¥leurs.  C'est tout ce que les contr√¥leurs <em>UIKit</em> peuvent <em>faire</em> .  Ils ont juste diff√©rentes m√©thodes pour cela.  Mais il n'y a que 3 t√¢ches. </li><li>  Pour incorporer un contr√¥leur de vue cr√©√© en usine, la m√©thode de vue parent du contr√¥leur est <code>UINavigationController.pushViewController(...)</code> , <code>UITabBarController.selectedViewController = ...</code> , <code>UIViewController.present(...)</code> etc.  Vous remarquerez peut-√™tre que 2 contr√¥leurs de vue sont toujours requis, un d√©j√† sur la pile et un qui doit √™tre int√©gr√© √† la pile.  Enveloppez-le dans un wrapper et appelez-le <strong>Action (Action)</strong> .  Chaque action est facile √† couvrir avec des tests unitaires complets et chacune est ind√©pendante des autres. </li><li>  D'apr√®s ce qui pr√©c√®de, il s'av√®re qu'en utilisant des entit√©s pr√©par√©es, vous pouvez cr√©er une cha√Æne de configuration <em>Factory -&gt; Action -&gt; Factory -&gt; Action -&gt; Factory,</em> et apr√®s l'avoir termin√©e, vous pouvez cr√©er une arborescence de vues de contr√¥leurs de toute complexit√©.  Il vous suffit de sp√©cifier le point d'entr√©e.  Ces points d'entr√©e sont g√©n√©ralement le <em>rootViewController</em> appartenant √† l' <em>UIWindow</em> ou le contr√¥leur de vue actuel, qui est la branche la plus extr√™me de l'arborescence.  Autrement dit, une telle configuration est correctement √©crite comme: <strong>D√©marrage de ViewController -&gt; Action -&gt; Factory -&gt; ... -&gt; Factory</strong> . </li><li>  En plus de la configuration, vous aurez besoin d'une entit√© qui sait comment d√©marrer et cr√©er la configuration fournie.  Nous l'appellerons <strong>routeur</strong> .  Il n'a pas d'√©tat, il ne contient aucun lien.  Il a une m√©thode √† laquelle la configuration est pass√©e et il effectue s√©quentiellement les √©tapes de configuration. </li><li>  Ajoutez des responsabilit√©s au routeur en ajoutant des classes <strong>Interceptors</strong> √† la cha√Æne de configuration.  Les intercepteurs sont possibles de 3 types: 1. Lanc√© avant de d√©marrer la navigation.  Nous supprimons les t√¢ches d'authentification des utilisateurs dans le syst√®me et les autres t√¢ches asynchrones en elles.  2. Ex√©cutez au moment de la cr√©ation du contr√¥leur de vue pour d√©finir les valeurs.  3. Effectu√© apr√®s navigation et ex√©cution de diverses t√¢ches analytiques.  Chaque entit√© est facilement couverte par des tests unitaires et ne sait pas comment elle sera utilis√©e dans la configuration.  Elle n'a qu'une seule responsabilit√© et elle la remplit.  Autrement dit, la configuration pour une navigation complexe peut ressembler √† <strong>[T√¢che de pr√©-navigation ...] -&gt; D√©marrage de ViewController -&gt; Action -&gt; (Factory + [ContextTask ...]) -&gt; ... -&gt; (Factory + [ContextTask ...]) -&gt; [Post NavigationTask ...]</strong> .  C'est-√†-dire que toutes les t√¢ches seront ex√©cut√©es par le routeur de mani√®re s√©quentielle, effectuant √† leur tour de petites entit√©s atomiques facilement lisibles. </li><li>  La derni√®re t√¢che qui ne peut pas √™tre r√©solue par la configuration reste - c'est l'√©tat de l'application pour le moment.  Que se passe-t-il si nous devons construire non pas toute la cha√Æne de configuration, mais seulement une partie, car l'utilisateur l'a partiellement d√©pass√©e?  Cette question peut toujours √™tre r√©pondue sans ambigu√Øt√© par l'arborescence des contr√¥leurs de vue.  Parce que si une partie de la cha√Æne est d√©j√† construite, elle est d√©j√† dans l'arborescence.  Cela signifie que si chaque usine de la cha√Æne peut r√©pondre √† la question de savoir si elle est construite ou non, le routeur sera en mesure de comprendre quelle partie de la cha√Æne doit √™tre termin√©e.  Bien s√ªr, ce n'est pas la t√¢che de l'usine, donc une autre entit√© atomique est introduite - le <strong>Finder,</strong> et toute configuration ressemble √† ceci: <strong>[T√¢che de pr√©-navigation ...] -&gt; D√©marrage de ViewController -&gt; Action -&gt; (Finder / Factory + [ContextTask ...]) -&gt; ... -&gt; (Finder / Factory + [ContextTask ...]) -&gt; [Post NavigationTask ...]</strong> .  Si le routeur commence √† le lire depuis la fin, l'un des Finders lui dira qu'il est d√©j√† construit et le routeur commencera √† partir de ce point √† reconstituer la cha√Æne.  Si aucun d'entre eux ne se trouve dans l'arborescence, vous devez cr√©er la cha√Æne enti√®re √† partir du contr√¥leur initial. <br><img src="https://habrastorage.org/getpro/habr/post_images/f50/a64/213/f50a64213fa1654fbde33e53b31f4e43.gif" alt="image"></li><li>  La configuration doit √™tre fortement typ√©e.  Par cons√©quent, chaque entit√© fonctionne avec un seul type de vue de contr√¥leur; un type de donn√©es et de configuration repose enti√®rement sur la capacit√© de swift √† travailler avec les types <strong>associ√©s</strong> .  Nous voulons compter sur le compilateur, pas sur le runtime.  Un d√©veloppeur peut intentionnellement affaiblir la frappe, mais pas l'inverse. </li></ol><br><p>  Un exemple d'une telle configuration: </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> productScreen = <span class="hljs-type"><span class="hljs-type">StepAssembly</span></span>(finder: <span class="hljs-type"><span class="hljs-type">ProductViewControllerFinder</span></span>(), factory: <span class="hljs-type"><span class="hljs-type">ProductViewControllerFactory</span></span>()) .add(<span class="hljs-type"><span class="hljs-type">LoginInterceptor</span></span>&lt;<span class="hljs-type"><span class="hljs-type">UUID</span></span>&gt;()) <span class="hljs-comment"><span class="hljs-comment">// Have to specify the context type till https://bugs.swift.org/browse/SR-8719 is fixed .add(ProductViewControllerContextTask()) .add(ProductViewControllerPostTask(analyticsManager: AnalyticsManager.sharedInstance)) .using(UINavigationController.push()) .from(NavigationControllerStep()) .using(GeneralActions.presentModally()) .from(GeneralStep.current()) .assemble()</span></span></code> </pre> <br><p>  Les √©l√©ments d√©crits ci-dessus couvrent l'ensemble de la biblioth√®que et d√©crivent l'approche.  Il ne nous reste plus qu'√† fournir les configurations de cha√Æne que le routeur ex√©cutera lorsque l'utilisateur cliquera sur un bouton ou qu'un √©v√©nement externe se produira.  S'il s'agit de diff√©rents types d'appareils, par exemple iPhone ou iPad, nous fournirons diff√©rentes configurations de transition en utilisant le polymorphisme.  Si nous avons des tests A / B, la m√™me chose.  Nous n'avons pas besoin de penser √† l'√©tat de l'application au moment de d√©marrer la navigation, nous devons nous assurer que la configuration est √©crite correctement au d√©part, et nous sommes s√ªrs que le routeur la construira d'une mani√®re ou d'une autre. </p><br><p>  L'approche d√©crite est plus compliqu√©e qu'une certaine abstraction ou un certain mod√®le, mais nous n'avons pas encore rencontr√© le probl√®me o√π cela ne serait pas suffisant.  Bien s√ªr, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RouteComposer</a> n√©cessite une √©tude et une compr√©hension de son fonctionnement.  Cependant, c'est beaucoup plus facile que d'apprendre les bases d'AutoLayout ou de RunLoop.  Pas de math√©matiques sup√©rieures. </p><br><p>  La biblioth√®que, ainsi que l'impl√©mentation du routeur qui lui est fourni, n'utilise aucune astuce objective avec le runtime et suit enti√®rement tous les concepts de Cocoa Touch, aidant seulement √† diviser le processus de composition en √©tapes et √† les ex√©cuter dans la s√©quence donn√©e.  La biblioth√®que est test√©e avec les versions iOS 9 √† 12. </p><br><p>  Plus de d√©tails peuvent √™tre trouv√©s dans les articles pr√©c√©dents: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Composition des UIViewControllers et navigation entre eux (et pas seulement) / magazine geek</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Exemples de configuration d'UIViewControllers utilisant RouteComposer / Geek Magazine</a> </p><br><p>  Merci de votre attention.  Je me ferai un plaisir de r√©pondre aux questions dans les commentaires. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr446550/">https://habr.com/ru/post/fr446550/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr446536/index.html">Files d'attente et JMeter: √©change avec Publisher et abonn√©</a></li>
<li><a href="../fr446538/index.html">PhotoGuru est pass√© du ¬´c√¥t√© obscur¬ª au ¬´plus sage¬ª</a></li>
<li><a href="../fr446544/index.html">Microsoft √©tend le programme Azure IP Advantage avec de nouveaux avantages IP pour les innovateurs et les startups Azure IoT</a></li>
<li><a href="../fr446546/index.html">Microsoft √©tend Azure IP Advantage avec de nouveaux avantages IP pour les innovateurs et les startups Azure IoT</a></li>
<li><a href="../fr446548/index.html">Analyse des statistiques sur les campagnes publicitaires - cr√©er une nouvelle m√©trique dans le DataFrame (python)</a></li>
<li><a href="../fr446552/index.html">Utilisation des commandes APDU √† l'aide de l'exemple EToken</a></li>
<li><a href="../fr446554/index.html">Programme r√©sident Yandex, ou Comment un back-end exp√©riment√© devient ing√©nieur ML</a></li>
<li><a href="../fr446558/index.html">Structures de donn√©es exotiques: Merkle modifi√©e Patricia Trie</a></li>
<li><a href="../fr446560/index.html">"Courtesy Exchange": l'essence du conflit entre les deux soci√©t√©s de streaming les plus c√©l√®bres</a></li>
<li><a href="../fr446562/index.html">Asynchronie dans la programmation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>