<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äç‚öñÔ∏è üñ±Ô∏è üòä Conex√£o de um monitor ER-TFT101-1 de 10 "ao STM32F429 via FMC üëêüèª üèÑ üëÅÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bom dia a todos. Neste artigo, analisaremos a conex√£o do monitor TFT ER-TFT101-1 (10 polegadas, driver RA8876) √† placa STM32F429L Discovery atrav√©s de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Conex√£o de um monitor ER-TFT101-1 de 10 "ao STM32F429 via FMC</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483538/">  Bom dia a todos.  Neste artigo, analisaremos a conex√£o do monitor TFT ER-TFT101-1 (10 polegadas, driver RA8876) √† placa STM32F429L Discovery atrav√©s de uma interface paralela 8080 de 16 bits usando o m√≥dulo FMC (controlador de mem√≥ria flex√≠vel). <br><br><img src="https://habrastorage.org/webt/cp/ut/gd/cputgdq9cwztakwkxazqyzraay0.jpeg"><br><img src="https://habrastorage.org/webt/2m/om/jf/2momjfwxhdkw_lmxfx76jxeelpw.jpeg"><br><br><h4>  Sobre montagem de exibi√ß√£o </h4><br>  O ER-TFT101-1 da EastRising √© um conjunto de uma matriz TFT de 10 polegadas com uma resolu√ß√£o de 1024x600 e uma placa com um driver RA8876.  Na placa-m√£e com o driver, toda a energia necess√°ria √© roteada, h√° uma mem√≥ria SD-RAM de 16 megabytes (barramento de 16 bits, frequ√™ncia m√°xima de 166 MHz, capacidade m√°xima de 64 MB), h√° um slot para cart√£o microSD padr√£o.  Existem pegadas vazias na EEPROM com fontes externas e na mem√≥ria flash para imagens com conectores de sa√≠da para program√°-las.  Al√©m disso, um painel de toque resistivo ou capacitivo pode opcionalmente ser instalado na montagem. <br><a name="habracut"></a><br>  Na placa, est√° o driver RAiO RA8876 de ponta, com uma freq√º√™ncia operacional m√°xima de 120 MHz, que, se desejado, pode funcionar como um microcontrolador de controle.  Voc√™ pode escrever um pequeno programa (apenas 12 instru√ß√µes) e coloc√°-lo em uma mem√≥ria flash externa.  Quando o visor iniciar, este programa come√ßar√° a ser executado, duplicando essencialmente todas as op√ß√µes de controle por meio da interface externa. <br><br><img src="https://habrastorage.org/webt/pf/up/ld/pfupldlxpv0p0xzjk1uliqmypeo.png"><br><br>  O RA8876 n√£o possui sua pr√≥pria RAM e, portanto, usa mem√≥ria SD-RAM externa.  Ele pode ler imagens da mem√≥ria flash usando o DMA e carreg√°-lo no buffer de quadros e possui uma configura√ß√£o muito flex√≠vel.  O driver √© conectado √† pr√≥pria matriz usando uma interface RGB padr√£o de 18 bits.  Apenas 6 bits por canal vermelho, 6 bits por canal verde e 6 bits em azul s√£o usados.  Os dois bits inferiores de cada canal n√£o s√£o usados, o que, em teoria, fornece 262.144 cores. <br><br>  O m√≥dulo DMA do RA8876 √© muito semelhante ao DMA2D da STM - ele pode copiar se√ß√µes retangulares da mem√≥ria de um lugar para outro, com convers√£o de cores, transpar√™ncia e outros chips. <br><br>  O RA8876 tamb√©m possui fontes inglesas e chinesas integradas (8x16,12x24,16x32 pixels) com configura√ß√µes flex√≠veis para exibi√ß√£o (rota√ß√£o, escala, etc.) e uma interface matricial separada (5 x 5) para bot√µes de hardware (para N√£o use somente) com v√°rias configura√ß√µes, como press√£o longa e curta, ative a tela pressionando um bot√£o e pressionando v√°rios bot√µes ao mesmo tempo. <br><br>  H√° uma fun√ß√£o picture-in-picture (sem suporte √† transpar√™ncia) para exibir janelas e menus pop-up. <br><br>  O pr√≥prio driver pode desenhar primitivas gr√°ficas, como quadrado, c√≠rculo, curva, oval, tri√¢ngulo, quadrado arredondado, com e sem preenchimento.  A prop√≥sito, no RA8875 e no RA8876 h√° um pequeno bug para preencher o tri√¢ngulo, e cada driver possui o seu.  Mas o RAiO n√£o dava a m√≠nima para a torre sineira ... tentei escrever uma carta para eles de alguma forma, para que eles nem respondessem.  Desenhar essas primitivas permite criar belos gr√°ficos, mesmo com um microcontrolador lento. <br><br>  No mundo externo, o RA8876 se comunica atrav√©s de interfaces 8080/6800 8/16 bits, 3/4 SPI e I2C.  Al√©m disso, o pr√≥prio chip do driver pode atuar como um mestre SPI e I2C.  No RA8876, existem duas sa√≠das PWM que podem ser usadas para controle flex√≠vel da luz de fundo.  A frequ√™ncia SPI CLK m√°xima √© declarada em 66 MHz com uma frequ√™ncia de driver de 120 MHz, o que, em teoria, fornece 6 quadros por segundo de uma atualiza√ß√£o em tela cheia (em 1024 x 600 x 16 bits).  Essa conex√£o foi testada por mim e mostrou que tem direito √† vida se n√£o exibirmos o v√≠deo na tela. <br><br>  No nosso caso, conectaremos o monitor usando o protocolo 8080 com uma largura de 16 bits ao STM32F429ZIT6 atrav√©s do m√≥dulo FMC (controlador de mem√≥ria flex√≠vel), o que nos permitir√° obter mais velocidade de preenchimento de tela e menos carga no microcontrolador. <br><br><h4>  Configura√ß√£o dos pinos 8080 e FMC </h4><br>  Veremos o diagrama de conex√£o do 8080 na folha de dados no visor: <br><br><img src="https://habrastorage.org/webt/cu/6f/hq/cu6fhqbkgfnugnpjk7pxxy5k5ts.png"><br><br>  Examinamos os pinos necess√°rios para conectar ao STM32 no CubeMX.  Estamos interessados ‚Äã‚Äãno banco 1 (NOR Flash / PSRAM / SRAM / ROM / LDC 1). <br><br><img src="https://habrastorage.org/webt/9u/rr/dt/9urrdt8fmvcz-6d10pblahs24te.png"><br><br>  Em rela√ß√£o ao XnWAIT na folha de dados, voc√™ pode ler o seguinte: <br><blockquote>  <i>A velocidade de grava√ß√£o cont√≠nua de dados determina a velocidade de atualiza√ß√£o da tela.</i>  <i>O intervalo ciclo a ciclo deve ser maior que 5 do per√≠odo do rel√≥gio do sistema se o usu√°rio sem adotar o XnWait para inserir o estado de espera.</i>  <i>A especifica√ß√£o pode causar perda de dados ou falha na fun√ß√£o se o mecanismo xnwait n√£o for usado.</i> </blockquote>  Literalmente, entre os ciclos operacionais do protocolo 8080, um atraso de 5 fragmentos do sistema RA8876 deve ser inserido se o usu√°rio n√£o usar o mecanismo XnWAIT para aguardar o lan√ßamento do RA8876.  Vamos usar este pino mais uma vez, como  na pr√°tica, tentei inserir um atraso de cinco ciclos e n√£o funcionou. <br><br>  Em vez de um barramento de endere√ßo completo para a unidade FMC, usamos apenas um pino A16. <br><br><ol><li>  Configuramos os pinos de dados (D0 - D15) como uma fun√ß√£o alternativa n¬∫ 12, como push-pool, velocidade m√°xima e sem suspens√≥rios. </li><li>  Os pinos XnWAIT, XnWR, XnRD, XA0 e XnCS s√£o configurados como uma fun√ß√£o alternativa n¬∫ 12, como empurrar e puxar com um elevador at√© o mais (PULL UP). </li><li>  Configuramos o XnRST como um GPIO comum sem um suspender (ele est√° no pr√≥prio quadro). </li><li>  O XnINTR √© configur√°vel como um GPIO para a entrada com um aumento para o mais. </li></ol><br>  Tamb√©m conectei a luz de fundo a 100% sem control√°-la via PWM.  Para fazer isso, o pino 14 no conector do conjunto da tela est√° conectado ao VDD. <br><br>  N√£o forne√ßo o c√≥digo de configura√ß√£o para os pinos, porque  Eu uso minhas pr√≥prias bibliotecas de configura√ß√£o, e a pr√≥pria configura√ß√£o do GPIO j√° foi mastigada centenas de vezes no hub e em outras fontes. <br><br>  <a href="https://github.com/Yoda49/RA8876-Driver-for-STM32F429ZIT6-FMC" rel="nofollow">A biblioteca de inicializa√ß√£o est√° aqui</a> . <br><br><h4>  Configura√ß√µes FMC </h4><br>  Tr√™s bancos para cada banco s√£o respons√°veis ‚Äã‚Äãpela configura√ß√£o dos bancos do m√≥dulo FMC (NOR Flash / PSRAM / SRAM / ROM / LDC 1).  Estes s√£o FMC_BCRx, FMC_BTRx e FMC_BWTRx.  No STM32F429 MK define, os registros FMC_BCRx e FMC_BTRx s√£o combinados em uma matriz comum chamada FMC_BTCR com oito elementos, em que o elemento zero √© FMC_BCR1, o primeiro elemento √© FMC_BTR1, o segundo elemento √© FMC_BCR2 e assim por diante.  FMC_BWTRx s√£o combinados em uma matriz FMC_BWTR com sete elementos, embora deva haver quatro.  N√£o me pergunte por que ... <br><br>  FMC_BCRx cont√©m configura√ß√µes b√°sicas, FMC_BTRx cont√©m hor√°rios gerais e FMC_BWTRx cont√©m hor√°rios separados para leitura, se o dispositivo exigir. <br><br>  Diagrama de tempo e tempos para a intera√ß√£o de STM32F429 e RA8876. <br><br><img src="https://habrastorage.org/webt/fc/q5/sx/fcq5sxlxvbr0tqg1bz0mthfgzpm.png"><br><br>  Para facilitar a configura√ß√£o, inseriremos os tempos do protocolo 8080 em constantes.  Escolhi os hor√°rios empiricamente, reduzindo um pouco do valor, porque  A tabela de tempo com uma folha de dados √© mais como um cavalo esf√©rico no v√°cuo. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ADDSET = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ADDHLD = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> DATAST = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> BUSTURN = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> CLKDIV = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> DATLAT = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ACCMOD = <span class="hljs-number"><span class="hljs-number">0</span></span>; RCC-&gt;AHB3ENR |= RCC_AHB3ENR_FMCEN; <span class="hljs-comment"><span class="hljs-comment">//  FMC FMC_Bank1-&gt;BTCR[0] = 0; //    FMC_Bank1-&gt;BTCR[0] |= FMC_BCR1_MWID_0; //    16  FMC_Bank1-&gt;BTCR[0] |= FMC_BCR1_WREN; //    FMC_Bank1-&gt;BTCR[0] |= FMC_BCR1_WAITEN; //   XnWAIT FMC_Bank1-&gt;BTCR[0] |= FMC_BCR1_ASYNCWAIT; // XnWAIT    FMC_Bank1-&gt;BTCR[0] |= FMC_BCR1_WAITCFG; //  XnWAIT FMC_Bank1-&gt;BTCR[1] = 0; //    FMC_Bank1-&gt;BTCR[1] |= (ADDSET &lt;&lt; 0) | (ADDHLD &lt;&lt; 4) | (DATAST &lt;&lt; 8) | (BUSTURN &lt;&lt; 16) | (CLKDIV &lt;&lt; 20) | (DATLAT &lt;&lt; 24) | (ACCMOD &lt;&lt; 28); //   FMC_Bank1-&gt;BTCR[0] |= 1; //   </span></span></code> </pre> <br>  O valor do registro FMC_BTCRx ap√≥s a redefini√ß√£o √© 0x0FFF FFFF, ou seja,  hor√°rios m√°ximos s√£o definidos.  Se voc√™ tiver uma nova tela ou mem√≥ria, reduza os tempos e tente executar. <br><br><h4>  Inicializa√ß√£o de exibi√ß√£o </h4><br>  Trabalhar com a tela se resume √† leitura ou grava√ß√£o em determinadas √°reas da mem√≥ria.  A FMC cuida do resto do trabalho.  Para simplificar o trabalho, definimos duas defini√ß√µes: <br><br><pre> <code class="plaintext hljs">#define LCD_DATA 0x60020000 #define LCD_REG 0x60000000</code> </pre> <br>  E agora descrevemos as fun√ß√µes de baixo n√≠vel: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LCD_CmdWrite</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cmd)</span></span></span><span class="hljs-function"> </span></span>{ *(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> *)(LCD_REG) = cmd; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LCD_DataWrite</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data)</span></span></span><span class="hljs-function"> </span></span>{ *(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> *)(LCD_DATA)= data; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LCD_StatusRead</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> data = *(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> *)(LCD_REG); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LCD_DataRead</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> data = * (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> *)(LCD_DATA); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>)data; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LCD_RegisterWrite</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cmd, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data)</span></span></span><span class="hljs-function"> </span></span>{ *(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> *)(LCD_REG) = cmd; *(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> *)(LCD_DATA) = data; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LCD_RegisterRead</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cmd)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> data = <span class="hljs-number"><span class="hljs-number">0</span></span>; LCD_CmdWrite (cmd); data = LCD_DataRead (); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data; };</code> </pre> <br>  Al√©m disso, a pr√≥pria fun√ß√£o de inicializa√ß√£o de exibi√ß√£o.  O c√≥digo √© retirado do provedor de v√≠deo e foi ligeiramente redesenhado para atender √†s suas necessidades.  As subfun√ß√µes ocupam uma quantidade enorme e, neste artigo, n√£o darei a elas. <br><br>  <a href="" rel="nofollow">Link para o driver no github</a> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RA8876_Init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ RA8876_PLL_Init (); <span class="hljs-comment"><span class="hljs-comment">//   RA8876  120  RA8876_SDRAM_Init (); //  SDRAM  166  TFT_24bit (); //    24   ??? Host_Bus_16bit (); //   16  RGB_16b_16bpp (); //   16  MemWrite_Left_Right_Top_Down (); //       . Graphic_Mode (); //    Memory_Select_SDRAM (); //   SDRAM /*  RGB     RA8876 */ HSCAN_L_to_R (); VSCAN_T_to_B (); PDATA_Set_RGB (); PCLK_Falling (); DE_High_Active (); HSYNC_High_Active (); VSYNC_High_Active (); LCD_HorizontalWidth_VerticalHeight (1024, 600); LCD_Horizontal_Non_Display (160); LCD_HSYNC_Start_Position (160); LCD_HSYNC_Pulse_Width (70); LCD_Vertical_Non_Display (23); LCD_VSYNC_Start_Position (12); LCD_VSYNC_Pulse_Width (10); //   Frame_Buffer_Start_Address (PAGE0_START_ADDR); Frame_Buffer_Width (1024); Frame_Buffer_Start_XY (0, 0); Frame_Buffer_Color_Mode_16bpp (); //   Canvas_Window_Start_Address (PAGE0_START_ADDR); Canvas_Window_Width (1024); Canvas_Window_Start_XY (0, 0); Canvas_Window_WH (1024, 600); Canvas_Memory_XY_Mode (); Canvas_Window_Color_Mode_16bpp (); }</span></span></code> </pre><br>  Sobre framebuffer e √°rea ativa um pouco mais.  Para essas duas configura√ß√µes, definimos as seguintes defini√ß√µes: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE0_START_ADDR 0 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE1_START_ADDR (1024 * 600 * 2 * 1) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE2_START_ADDR (1024 * 600 * 2 * 2) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE3_START_ADDR (1024 * 600 * 2 * 3) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE4_START_ADDR (1024 * 600 * 2 * 4) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE5_START_ADDR (1024 * 600 * 2 * 5) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE6_START_ADDR (1024 * 600 * 2 * 6) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE7_START_ADDR (1024 * 600 * 2 * 7) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE8_START_ADDR (1024 * 600 * 2 * 8) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE9_START_ADDR (1024 * 600 * 2 * 9) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE10_START_ADDR (1024 * 600 * 2 * 10) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE11_START_ADDR (1024 * 600 * 2 * 11) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE12_START_ADDR (1024 * 600 * 2 * 12)</span></span></code> </pre> <br>  Cada p√°gina (PAGEx_START_ADDR) √© o endere√ßo inicial no SDRAM.  Em 16 megabytes de mem√≥ria, podemos colocar 13 camadas completas no tamanho 1228800 bytes (1024 * 600 * 2). <br>  A fun√ß√£o Frame_Buffer_Start_Address define a √°rea de mem√≥ria inicial do framebuffer (o que est√° sendo exibido no momento). <br><br>  A fun√ß√£o Canvas_Window_Start_Address define a √°rea de mem√≥ria inicial para a tela.  Al√©m disso, a tela pode ser maior que o buffer de moldura, para que voc√™ possa rolar a imagem na tela.  Por exemplo, para um jogo de plataforma, voc√™ pode criar uma tela longa medindo 13312 x 600 pixels e rolar horizontalmente, movendo o buffer de moldura horizontalmente sobre ele. <br><br>  Se voc√™ comparar a sa√≠da gr√°fica com o LTDM do STM32, tudo aqui n√£o √© t√£o bom.  Ao mesmo tempo, o pr√≥prio driver pode exibir apenas uma camada final (buffer) e LTDC de uma vez duas, misturando-as, sem exigir sua participa√ß√£o nesse processo. <br><br><h4>  Primitivas de desenho </h4><br>  C√≥digo de um provedor de v√≠deo com recursos pr√©-criados: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Line</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Triangle</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Triangle_Fill</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Line_Start_XY</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Line_End_XY</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangle_Point1_XY</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangle_Point2_XY</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangle_Point3_XY</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Square_Start_XY</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Square_End_XY</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Circle_or_Ellipse</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Circle_or_Ellipse_Fill</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Left_Down_Curve</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Left_Up_Curve</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Right_Up_Curve</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Right_Down_Curve</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Left_Down_Curve_Fill</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Left_Up_Curve_Fill</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Right_Up_Curve_Fill</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Right_Down_Curve_Fill</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Square</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Square_Fill</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Circle_Square</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Circle_Square_Fill</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Circle_Center_XY</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ellipse_Center_XY</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Circle_Radius_R</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ellipse_Radius_RxRy</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Circle_Square_Radius_RxRy</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>;</code> </pre> <br>  Por exemplo, para desenhar um tri√¢ngulo preenchido, definimos tr√™s pontos: Triangle_Point1_XY, Triangle_Point2_XY, Triangle_Point2_XY e executamos a fun√ß√£o Start_Triangle_Fill. <br><br><h4>  Trabalhar com DMA </h4><br>  Por conveni√™ncia, escrevi minha fun√ß√£o com uma estrutura como um par√¢metro passado: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GFX_BTE_options</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> layer_s0_addr; <span class="hljs-comment"><span class="hljs-comment">//     0 unsigned long layer_s1_addr; //     1 unsigned long layer_d_addr; //     unsigned short layer_s0_width; //    0 unsigned short layer_s1_width; //    1 unsigned short layer_d_width; //    unsigned short layer_s0_start_x; //     0 unsigned short layer_s0_start_y; //   Y  0 unsigned short layer_s1_start_x; //   X  1 unsigned short layer_s1_start_y; //   Y  1 unsigned short layer_d_start_x; //   X   unsigned short layer_d_start_y; //   Y   unsigned short window_size_x; //     unsigned short window_size_y; //     unsigned char rop_code; //  ROP unsigned char operation_code; //   DMA };       DMA: void GFX_BTE_operation (struct GFX_BTE_options options) { BTE_S0_Color_16bpp (); BTE_S0_Memory_Start_Address (options.layer_s0_addr); BTE_S0_Image_Width (options.layer_s0_width); BTE_S0_Window_Start_XY (options.layer_s0_start_x, options.layer_s0_start_y); BTE_S1_Color_16bpp (); BTE_S1_Memory_Start_Address (options.layer_s1_addr); BTE_S1_Image_Width (options.layer_s1_width); BTE_S1_Window_Start_XY (options.layer_s1_start_x, options.layer_s1_start_y); BTE_Destination_Color_16bpp (); BTE_Destination_Memory_Start_Address (options.layer_d_addr); BTE_Destination_Image_Width (options.layer_d_width); BTE_Destination_Window_Start_XY (options.layer_d_start_x, options.layer_d_start_y); BTE_Window_Size (options.window_size_x, options.window_size_y); BTE_ROP_Code (options.rop_code); BTE_Operation_Code (options.operation_code); BTE_Enable (); Check_BTE_Busy (); }</span></span></code> </pre> <br>  <u>Descri√ß√£o dos c√≥digos de opera√ß√£o (C√ìDIGO DE OPERA√á√ÉO):</u> <br><br>  0000: Grava na mem√≥ria com o ROP usando MK. <br>  0001: Leia mem√≥ria sem ROP usando MK. <br>  0010: Copie um bloco de mem√≥ria na dire√ß√£o direta usando ROP. <br>  0011: Copiando um bloco de mem√≥ria na dire√ß√£o reversa usando ROP. <br>  0100: Grava na mem√≥ria (com transpar√™ncia) sem ROP usando MK. <br>  0101: Copie (mova) um bloco de mem√≥ria (com transpar√™ncia) na dire√ß√£o direta sem ROP. <br>  0110: Preencha com um padr√£o usando ROP. <br>  0111: Preencha o modelo com chromakey. <br>  1000: Extens√£o de Cor <br>  1001: Cor aprimorada com transpar√™ncia <br>  1010: Movendo um bloco de mem√≥ria para frente com mistura alfa <br>  1011: Escreva na mem√≥ria com mistura alfa usando MK. <br>  1100: Preenche a √°rea da mem√≥ria com uma cor s√≥lida. <br>  1101: Reservado <br>  1110: Reservado <br>  1111: Reservado <br><br>  <u>Descri√ß√£o dos c√≥digos raster (C√ìDIGO ROP):</u> <br><br>  0000b: 0 (preto) <br>  0001b: ~ S0 ¬∑ ~ S1 ou ~ (S0 + S1) <br>  0010b: ~ S0 ¬∑ S1 <br>  0011b: ~ S0 <br>  0100b: S0 ¬∑ S1 <br>  0101b: ~ S1 <br>  0110b: S0 ^ S1 <br>  0111b: ~ S0 + ~ S1 ou ~ (S0 ¬∑ S1) <br>  1000b: S0 ¬∑ S1 <br>  1001b: ~ (S0 ^ S1) <br>  1010b: S1 <br>  1011b: ~ S0 + S1 <br>  1100b: S0 <br>  1101b: S0 + ~ S1 <br>  1110b: S0 + S1 <br>  1111b: 1 (branco) <br><br>  S0 √© a camada zero, S1 √© a primeira camada.  A intera√ß√£o entre eles ocorre usando opera√ß√µes aritm√©ticas e de bits. <br><br><h4>  Sa√≠da de fonte embutida </h4><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GFX_Show_String_TMODE</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *ptr, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> charColor, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bkColor)</span></span></span><span class="hljs-function"> </span></span>{ Foreground_color_65k (charColor); Background_color_65k (bkColor); CGROM_Select_Internal_CGROM (); Font_Select_12x24_24x24 (); Text_Mode (); Goto_Text_XY (x, y); LCD_CmdWrite (<span class="hljs-number"><span class="hljs-number">0x04</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (*ptr != <span class="hljs-string"><span class="hljs-string">'\0'</span></span>) { LCD_DataWrite (*ptr); Check_Mem_WR_FIFO_not_Full (); ++ptr; } Check_2D_Busy (); Graphic_Mode (); <span class="hljs-comment"><span class="hljs-comment">//back to graphic mode }</span></span></code> </pre> <br>  <a href="https://github.com/Yoda49/RA8876-Driver-for-STM32F429ZIT6-FMC" rel="nofollow">A vers√£o completa do driver pode ser encontrada no github no link</a> <br><br>  Obrigado a todos pela leitura! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt483538/">https://habr.com/ru/post/pt483538/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt483526/index.html">Gerenciando o estado do aplicativo com o RxJS / Immer como uma alternativa simples ao Redux / MobX</a></li>
<li><a href="../pt483528/index.html">API REST deve ser baseada em hipertexto</a></li>
<li><a href="../pt483530/index.html">Como fizemos um jogo de tabuleiro. Porque e porque?</a></li>
<li><a href="../pt483532/index.html">Confer√™ncia DefCon 27: Nos bastidores da cria√ß√£o de crach√°s eletr√¥nicos Parte 1</a></li>
<li><a href="../pt483536/index.html">A hist√≥ria do microprocessador e computador pessoal: 1974 - 1980</a></li>
<li><a href="../pt483540/index.html">ChaiScript - linguagem de script para C ++</a></li>
<li><a href="../pt483542/index.html">Resumo de telecomunica√ß√µes - materiais sobre o trabalho dos fornecedores</a></li>
<li><a href="../pt483544/index.html">Novos dados refutam suposi√ß√£o chave de energia escura</a></li>
<li><a href="../pt483550/index.html">Desenvolvimento de servi√ßos e IaaS: uma compila√ß√£o de nuvem, armazenamento de dados e evolu√ß√£o da 1cloud</a></li>
<li><a href="../pt483552/index.html">MVVM e sele√ß√£o de elementos no adaptador</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>