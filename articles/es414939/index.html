<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>   Autorizaci贸n transparente para una aplicaci贸n en Oracle Weblogic Server   硷</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este art铆culo, le contar茅 c贸mo cambiamos de NTLM a la autorizaci贸n Kerberos para aplicaciones en Oracle Weblogic Server, lo que simplifica el inici...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Autorizaci贸n transparente para una aplicaci贸n en Oracle Weblogic Server</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414939/">  En este art铆culo, le contar茅 c贸mo cambiamos de NTLM a la autorizaci贸n Kerberos para aplicaciones en Oracle Weblogic Server, lo que simplifica el inicio de sesi贸n del usuario al eliminar la necesidad de ingresar una contrase帽a.  Todos los usuarios, as铆 como el servidor de aplicaciones, est谩n en el mismo dominio; la autorizaci贸n de dominio para las aplicaciones del servidor Weblogic tambi茅n se configur贸 previamente.  Todas las configuraciones se verificaron en WLS 12.1.2. <br><a name="habracut"></a><br>  Primero, una peque帽a teor铆a, muy brevemente para una mayor comprensi贸n del proceso de interacci贸n. <br><br><h3>  驴Qu茅 es el inicio de sesi贸n 煤nico? </h3><br>  Single Sign-On (SSO) es un mecanismo a trav茅s del cual una acci贸n de autenticaci贸n de un solo usuario le permite al usuario acceder a todas las computadoras y sistemas donde tiene permiso de acceso sin tener que ingresar varias contrase帽as.  Las credenciales ingresadas previamente ser谩n reutilizadas de forma transparente por varios componentes. <br><br><h3>  驴Qu茅 es Kerberos? </h3><br>  Kerberos es un protocolo de autenticaci贸n de red que fue desarrollado por el Instituto de Tecnolog铆a de Massachusetts.  Kerberos es un m茅todo seguro para autenticar una solicitud de un servicio en la red y est谩 dise帽ado para proporcionar una autenticaci贸n s贸lida para aplicaciones cliente-servidor utilizando criptograf铆a con una clave secreta. <br><br><h3>  驴Qu茅 es SPNEGO? </h3><br>  SPNEGO es un motor de negociaci贸n GSSAPI simple y seguro.  Esta es una interfaz estandarizada para la autenticaci贸n (por ejemplo, JNDI para b煤squedas de directorio), la implementaci贸n predeterminada para SPNEGO en Windows es Kerberos (por ejemplo, LDAP para JNDI).  La terminolog铆a de Microsoft utiliza "Autenticaci贸n de Windows integrada" como sin贸nimo de SPNEGO.  En la autenticaci贸n integrada de Windows, se pueden negociar los protocolos Kerberos o NTLM. <br><br>  Cuando un servidor recibe una solicitud de Internet Explorer (IE 6.1 o superior), puede solicitar que el navegador utilice el protocolo SPNEGO para la autenticaci贸n.  Este protocolo realiza la autenticaci贸n Kerberos a trav茅s de HTTP y permite a Internet Explorer delegar la autoridad delegada para que la aplicaci贸n web pueda iniciar sesi贸n en los servicios Kerberizados posteriores en nombre del usuario. <br><br>  Cuando el servidor HTTP quiere ejecutar SPNEGO, devuelve una respuesta "401 no autorizada" a la solicitud HTTP con el t铆tulo "Autorizaci贸n WWW: Negociar".  Internet Explorer se pone en contacto con el Servicio de tickets (TGS) para obtener un ticket.  Elige el nombre especial del participante del servicio para solicitar un boleto, por ejemplo: <br><br><pre><code class="bash hljs">HTTP/webserver@&lt;DOMAIN NAME&gt;</code> </pre> <br>  El ticket devuelto se envuelve en un token SPNEGO, que se codifica y se env铆a de vuelta al servidor mediante una solicitud HTTP.  El token se despliega y el boleto se autentica. <br><br><h3>  Beneficios de Kerberos </h3><br>  El uso de Kerberos permite a los administradores deshabilitar la autenticaci贸n NTLM en cuanto todos los clientes de la red puedan autenticar Kerberos.  Kerberos es m谩s flexible y eficiente que NTLM y m谩s seguro. <br><br><h2>  Configurar SSO basado en Kerberos en un entorno de servidor de aplicaciones Weblogic </h2><br>  Esquema de interacci贸n: <br><br><img src="https://habrastorage.org/webt/ag/nr/hb/agnrhbp4keg9dswqfuudfhmdy1y.png"><br><br><ol><li>  Cuando un usuario registrado (PC) solicita un recurso de Oracle WebLogic Server (WLS), env铆a la solicitud HTTP GET original. </li><li>  El servidor de Oracle WebLogic Server (WLS) que ejecuta el c贸digo de token SPNEGO requiere autenticaci贸n y emite un acceso 401 denegado, WWWAuthenticate: negociar respuesta. </li><li>  Un cliente (navegador en la PC) solicita un ticket de sesi贸n de TGS / KDC (AD). </li><li>  TGS / KDC (AD) proporciona al cliente el ticket Kerberos necesario (siempre que el cliente est茅 autorizado), envuelto en el token SPNEGO. </li><li>  El cliente reenv铆a la solicitud HTTP GET + Negociar token SPNEGO en el encabezado de autorizaci贸n: Negociar base64 (token). </li><li>  Al verificar la autenticaci贸n web SPNEGO en el servidor Weblogic, se ve un encabezado HTTP con el token SPNEGO.  SPNEGO comprueba el token SPNEGO y obtiene informaci贸n del usuario. </li><li>  Despu茅s de que Weblogic recibe la informaci贸n del usuario, valida al usuario en Microsoft Active Directory / KDC.  Cuando se completa el proceso de autenticaci贸n, Weblogic ejecuta el c贸digo Java correspondiente (servlets, JSP, EJB, etc.) y verifica la autorizaci贸n. </li><li>  El c贸digo del manejador del token del servidor Oracle WebLogic acepta y procesa el token a trav茅s de la API GSS, autentica al usuario y responde con la URL solicitada. </li></ol><br><h3>  Ahora vamos a practicar </h3><br>  1. Realizamos ajustes en el lado del servidor del dominio del controlador en el que est谩n configurados los servicios TGS / KDC. <br><br><ul><li>  Crear un usuario en Active Directory (la contrase帽a no debe caducar) </li><li>  Establezca el SPN apropiado para el nombre del servidor WLS </li></ul><br>  Realizar la verificaci贸n establecida por SPN <br><br><pre> <code class="bash hljs">setspn l HTTP_weblogic</code> </pre> <br>  deber铆a devolver dos registros <br>  Generar archivo de tabla de claves <br><br><pre> <code class="bash hljs">ktpass -princ HTTP_weblogic@mycompany.com -pass PASSWORD -crypto RC4-HMAC-NT -ptype KRB5_NT_PRINCIPAL -kvno 0 -out c:\krb5.keytab</code> </pre> <br>  Copie este archivo al servidor WLS <br><br>  2. Configuraci贸n del servidor WLS <br><br><ul><li>  Debe crear el archivo krb5.ini en la carpeta% windir%: C: \ Windows.  Este archivo contiene ajustes de configuraci贸n para clientes, por ejemplo, donde se encuentra el KDC.  El archivo se ver谩 as铆: </li></ul><br><pre> <code class="bash hljs">[libdefaults] default_realm = &lt;DOMAIN NAME&gt; ticket_lifetime = 600 [realms] &lt;DOMAIN NAME&gt; = { kdc = &lt;HOSTNAME OF AD/KDC&gt; admin_server = &lt;HOSTNAME OF AD/KDC&gt; default_domain = &lt;DOMAIN NAME&gt; } [domain_realm] . &lt;DOMAIN NAME&gt;= &lt;DOMAIN NAME&gt; [appdefaults] autologin = <span class="hljs-literal"><span class="hljs-literal">true</span></span> forward = <span class="hljs-literal"><span class="hljs-literal">true</span></span> forwardable = <span class="hljs-literal"><span class="hljs-literal">true</span></span> encrypt = <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br><ul><li>  Cree el archivo de configuraci贸n krb5Login.conf: </li></ul><br><pre> <code class="bash hljs">com.sun.security.jgss.krb5.initiate { com.sun.security.auth.module.Krb5LoginModule required principal=<span class="hljs-string"><span class="hljs-string">"user@MYCOMPANY.COM"</span></span> useKeyTab=<span class="hljs-literal"><span class="hljs-literal">true</span></span> keyTab=krb5.keytab storeKey=<span class="hljs-literal"><span class="hljs-literal">true</span></span> debug=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; }; com.sun.security.jgss.krb5.accept { com.sun.security.auth.module.Krb5LoginModule required principal=<span class="hljs-string"><span class="hljs-string">"user@MYCOMPANY.COM"</span></span> useKeyTab=<span class="hljs-literal"><span class="hljs-literal">true</span></span> keyTab=krb5.keytab storeKey=<span class="hljs-literal"><span class="hljs-literal">true</span></span> debug=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; };</code> </pre> <br>  Tenga en cuenta que el nombre de dominio debe estar en <b>may煤scula</b> .  Para versiones anteriores, use com.sun.security.jgss.initiate en la configuraci贸n anterior en lugar de com.sun.security.jgss.krb5.initiate. <br><br><ul><li>  Los archivos krb5Login.conf y krb5.keytab deben ubicarse en la ra铆z del directorio del dominio del servidor WLS. </li></ul><br><ul><li>  Edici贸n del archivo setDomainEnv </li></ul><br>  Encuentre el conjunto de l铆neas JAVA_OPTIONS =% JAVA_OPTIONS% y agregue al final <br><br><pre> <code class="bash hljs">-Djava.security.auth.login.config=&lt;  &gt;\krb5Login.conf -Djavax.security.auth.useSubjectCredsOnly=<span class="hljs-literal"><span class="hljs-literal">false</span></span> -Dweblogic.security.enableNegotiate=<span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre><br><ul><li>  En este caso, no estamos considerando configurar la autorizaci贸n WLS en AD, creemos que funciona, si necesita pintar este art铆culo, escriba los comentarios. </li><li>  Configurando SPNEGO en WLS <br>  Para hacer esto, vaya a la Consola de administraci贸n del servidor WebLogic <br>  Vaya a la secci贸n Reinos de seguridad&gt; myrealm&gt; Proveedores y haga clic en el bot贸n Agregar <br>  Seleccione el tipo de "Proveedor de Afirmaci贸n de Identidad de Negociaci贸n de WebLogic" <br>  Verifique que ambos par谩metros est茅n seleccionados. <br><br><img src="https://habrastorage.org/webt/mx/yw/dh/mxywdhiksffnmoskhudbwgbheue.png"><br><br>  Presionamos el bot贸n Reordenar y al controlar las flechas establecemos la secuencia de los tipos de autorizaci贸n.  En primer lugar, debe instalarse el proveedor WebLogic Negotiate Identity Assertion en segundo lugar Proveedor que realiza la autenticaci贸n LDAP (autorizaci贸n de dominio) <br><br><img src="https://habrastorage.org/webt/xg/9s/3z/xg9s3zptdxssvyluczibql18jii.png"></li></ul><br><ul><li>  Reiniciar el servidor </li></ul><br><ul><li>  A continuaci贸n, debe indicar a la aplicaci贸n el m茅todo de autorizaci贸n CLIENTE-CERT; estos cambios se aplican en el archivo web.xml de la aplicaci贸n </li></ul><br><pre> <code class="bash hljs">&lt;security-constraint&gt; &lt;display-name&gt;Security Constraint <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> SSO &lt;/display-name&gt; &lt;web-resource-collection&gt; &lt;web-resource-name&gt;My webapp&lt;/web-resource-name&gt; &lt;description&gt;Group of Users&lt;/description&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt; &lt;http-method&gt;GET&lt;/http-method&gt; &lt;http-method&gt;POST&lt;/http-method&gt; &lt;/web-resource-collection&gt; &lt;auth-constraint&gt; &lt;role-name&gt;valid-users&lt;/role-name&gt; &lt;/auth-constraint&gt; &lt;/security-constraint&gt; &lt;login-config&gt; &lt;auth-method&gt;CLIENT-CERT&lt;/auth-method&gt; &lt;/login-config&gt; &lt;security-role&gt; &lt;description&gt;Role description&lt;/description&gt; &lt;role-name&gt;valid-users&lt;/role-name&gt; &lt;/security-role&gt;</code> </pre> <br>  El rol debe estar preinstalado en el sistema.  En nuestro caso, se utiliza el rol incorporado para ADF (usuarios v谩lidos) y, m谩s adelante, seg煤n los grupos de dominio, se otorgan permisos. <br><br><ul><li>  Depurar </li></ul><br>  Para identificar problemas con la autorizaci贸n, debe habilitar la depuraci贸n.  Para hacer esto, vaya a la secci贸n. <br><br>  Entorno -&gt; Servidores, seleccione nuestro servidor -&gt; Depurar -&gt; weblogic (expandir) -&gt; Seguridad -&gt; atn, marque la casilla y act铆velo. <br><br><img src="https://habrastorage.org/webt/el/cu/wl/elcuwln1wfg_nepcwqv5vttbh2c.png"><br><br>  Para habilitar y deshabilitar la depuraci贸n, no es necesario reiniciar. <br><br><ul><li>  Reiniciamos el servidor para aplicar cambios de configuraci贸n. </li><li>  Implemente la aplicaci贸n con un m茅todo de autorizaci贸n modificado (nuevo web.xml) </li><li>  Para deshabilitar este tipo de autorizaci贸n para la consola administrativa, realice los siguientes cambios% Ora_Home% \ wlserver \ server \ lib \ consoleapp \ webapp \ WEB-INF \ web.xml. <br><br>  Cambiar la linea <br><br><pre> <code class="java hljs"> &lt;auth-method&gt;CLIENT-CERT,FORM&lt;/auth-method&gt;  &lt;auth-method&gt;FORM&lt;/auth-method&gt;</code> </pre> </li></ul><br>  Inicie sesi贸n en la m谩quina de dominio, haga clic en el enlace de la aplicaci贸n e inicie sesi贸n sin ingresar una contrase帽a.  Vale la pena se帽alar que el bot贸n Salir de la aplicaci贸n no funcionar谩 en esta configuraci贸n. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es414939/">https://habr.com/ru/post/es414939/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es414929/index.html">TRIZ, Haskell y pensamiento funcional</a></li>
<li><a href="../es414931/index.html">Prueba de tr谩nsito: IETF ofrece un nuevo enfoque para confirmar la ruta del paquete de red</a></li>
<li><a href="../es414933/index.html">Redes de malla en Wi-Fi: por qu茅 la Alianza Wi-Fi propuso su est谩ndar</a></li>
<li><a href="../es414935/index.html">Agencia Especial de la ONU publica plan de transici贸n de IPv6 - comunidad de TI disgustada</a></li>
<li><a href="../es414937/index.html">"Frecuencias inaudibles": ha aparecido un cortafuegos que bloquea las cookies ultras贸nicas</a></li>
<li><a href="../es414943/index.html">Implementaci贸n de software del filtro IIR en el canal de medici贸n de informaci贸n</a></li>
<li><a href="../es414945/index.html">La Universidad Johns Hopkins cre贸 una piel artificial que siente dolor</a></li>
<li><a href="../es414947/index.html">Obteniendo Git para Windows bajo ReactOS</a></li>
<li><a href="../es414951/index.html">Gesti贸n de acceso en Expressjs con CASL</a></li>
<li><a href="../es414953/index.html">Nvidia ense帽贸 a la red neuronal a ralentizar el video</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>