<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍🚒 🚍 💸 Videoanrufe unter der Haube: von Millionen pro Tag bis zu 100 Teilnehmern in einer Konferenz 🍭 👨‍👩‍👧‍👦 🛌🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Jetzt scheint es unmöglich zu sein, einen Messenger ohne die Anruffunktion zu finden. Dies ist praktisch für Benutzer, da alle Kommunikationen in eine...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Videoanrufe unter der Haube: von Millionen pro Tag bis zu 100 Teilnehmern in einer Konferenz</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/odnoklassniki/blog/479852/">  Jetzt scheint es unmöglich zu sein, einen Messenger ohne die Anruffunktion zu finden.  Dies ist praktisch für Benutzer, da alle Kommunikationen in einer Anwendung durchgeführt werden können.  Wenn wir alle in den Medien verfügbaren Statistiken zusammenfassen, stellt sich heraus, dass die Menschen mehr als eine Milliarde Minuten pro Tag über das Internet sprechen.  Und mit der Entwicklung der Technologie wächst der Anteil der Videokommunikation, da Video die Emotionen des Gesprächspartners besser vermittelt und es Ihnen ermöglicht, den Effekt der Präsenz zu erzeugen. <br><br>  Eine neue Herausforderung für den Videoanrufdienst besteht darin, in einer Konferenz die ganze Familie oder eine Gruppe von Freunden in verschiedenen Teilen der Welt oder Kollegen, die an demselben Projekt arbeiten, für die Planung zusammenzubringen. <br><img src="https://habrastorage.org/webt/mh/zl/8a/mhzl8ar7wkjk2akfni3vzzbiufi.jpeg"><br>  Der Entwicklungsleiter der Video- und Tape-Plattformen, Alexander Tobol ( <a href="https://habr.com/ru/users/alatobol/" class="user_link">alatobol</a> ), wird zeigen, dass es unter der Haube einen Videoanrufdienst gibt, mit welchen Technologien und Hacks Ihr Konferenzserver erstellt wird und wie Videos korrekt übertragen werden.  Lernen Sie, wie Sie einen Einzelgesprächsdienst auf Gruppengespräche für 100 Personen übertragen und warum Sie für so viele Teilnehmer Unterstützung benötigen. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/2z4XO3fyn3U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Der Artikel basiert auf einem Bericht über <a href="https://www.highload.ru/">HighLoad ++ Sibirien</a> , in dem Alexander Tobol versucht, ein vollständiges Bild zu vermitteln.  Wenn Sie bereits mit anderen Materialien zum Thema vertraut sind (z. B. <a href="https://habr.com/ru/company/oleg-bunin/blog/428217/">mit den Funktionen der Videoübertragung</a> und <a href="https://habr.com/ru/company/oleg-bunin/blog/461829/">Netzwerkprotokollen</a> ), können Sie den theoretischen Teil überspringen und direkt zur <a href="https://habr.com/ru/company/odnoklassniki/blog/479852/">Lösung übergehen</a> . <br><br>  <strong>Die Gliederung des Artikels:</strong> <br><br><ul><li>  Verlauf und Geräteaufrufe. </li><li>  <a href="https://habr.com/ru/company/odnoklassniki/blog/479852/">Übergang von Einzelgesprächen zu Gruppengesprächen.</a> </li><li>  <a href="https://habr.com/ru/company/odnoklassniki/blog/479852/">DIY Gruppenrufservice.</a> </li><li>  <a href="https://habr.com/ru/company/odnoklassniki/blog/479852/">Conferencing Server: Entdecken Sie Konkurrenten und verbessern Sie sie.</a> </li></ul><br><h2>  Verlauf aufrufen </h2><br>  Die erste bekannte Anwendung für Anrufe, und mit dem Video, war Skype, es erschien im Jahr 2006.  In Odnoklassniki haben wir in den Jahren 2010-2012 Anrufe auf der Basis einer Lösung von Adobe gestartet ... Vor ein paar Jahren haben wir sie in WebRTC komplett überarbeitet (mehr zu diesem Start <a href="https://habr.com/ru/company/oleg-bunin/blog/428217/">hier</a> ). Letztes Jahr haben wir Gruppenanrufe hinzugefügt.  Dieser Übergang wird im Artikel besprochen. <br><img src="https://habrastorage.org/webt/5v/-d/9o/5v-d9oc0kvmij7u43f4q8dihyoa.jpeg"><br>  Warum kann ich Ihnen wohl sagen, wie das geht?  Weil unser monatliches Publikum, das Anrufe tätigt, 10 Millionen Menschen übersteigt und <strong>wir mehr als 2 Millionen Anrufe pro Tag haben</strong> .  Darüber hinaus geschieht mehr als die Hälfte davon über mobile Plattformen. <br><br>  Gruppengespräche sind der am schnellsten wachsende Dienst und unser Ziel sind 100 Konferenzteilnehmer gleichzeitig.  Warum so viel?  Erstens möchten Sie manchmal eine schöne Aufnahme mit Ihren Freunden und Klassenkameraden teilen oder ein Seminar abhalten.  Zweitens kann sich alles ändern, auch wenn Sie der Meinung sind, dass Ihr Service nichts benötigt. <br><br>  Jetzt scheint es, dass Videokonferenzen für 100 Teilnehmer nicht erforderlich sind, und vor fünf Jahren haben sie mich gefragt, warum wir Video in 4K starten.  Jetzt ist ein 4K-Fernseher an der Tagesordnung und wir waren 2014 bereit. <br><blockquote>  Der Punkt ist nicht der Zeit voraus.  Wenn Sie einen guten Service leisten möchten, legen Sie die Messlatte höher. </blockquote>  Wenn Sie gut funktionierende Anrufe für 50 bis 100 Personen tätigen können, funktioniert für 6 bis 10 Benutzer alles einwandfrei. <br><br>  Jeder Anrufdienst hat 4 relativ unabhängige Komponenten: <br><br><ul><li>  <strong>Signalisierung</strong>  Die Aufgabe besteht darin, den Teilnehmer anzurufen, Anfangsdaten auszutauschen, zu informieren, was jeder Teilnehmer tun kann, und dann einen Kanal einzurichten, über den Videodaten übertragen werden können. </li><li>  <strong>Video / Audio.</strong>  Video- und Audiodaten werden mit Codecs komprimiert. </li><li>  <strong>Netzwerk.</strong>  Es ist notwendig, die Arbeit in schlechten Netzwerken sicherzustellen, Paketwiederherstellung, P2P-Verbindungen usw. zu implementieren. </li><li>  <strong>Topologie</strong> - bei Gruppenrufen hinzugefügt. </li></ul><br>  Sie können über jeden dieser Teile separat sprechen.  Aber ich möchte einen Überblick über die Funktionsweise von Anrufen geben. Deshalb werde ich versuchen, alles in eine Geschichte zu integrieren. <br><br>  Bevor Sie mit der Arbeit am Service beginnen, müssen Sie die <strong>Anforderungen</strong> identifizieren: <br><br><ul><li>  <strong>Stellen Sie schnell eine Verbindung her,</strong> sodass die Verbindung sofort hergestellt wird, nachdem der Gesprächspartner den Hörer abgenommen hat. </li><li>  <strong>Hohe Anrufqualität,</strong> damit das Video nicht bröckelt und nicht einfriert. </li><li>  <strong>Die Anzahl der Teilnehmer am Anruf</strong> , damit Sie in Chats anrufen können, in denen bis zu 100 Teilnehmer teilnehmen. </li><li>  <strong>Geringe Latenz zwischen Anrufern.</strong>  Eine Latenz von 1,3 s als Polycom passt überhaupt nicht zu uns. </li></ul><br>  Hier sind die spezifischen Bedeutungen, in denen diese Anforderungen für Gruppenanrufe ausgedrückt werden: Beginn eines Anrufs nicht länger als 1 Sekunde;  ein Netzwerk, in dem 300-Kbit / s-Video stabil funktioniert;  Latenz vom Anrufer zum Hörer nicht länger als 0,5 Sekunden;  100 Benutzer in einem Anruf. <br><br><h2>  Was ist im Weg? </h2><br>  Wie Sie wissen, werden Daten in Netzwerken in Paketen übertragen: Es gibt einen Socket, Sie senden einen Datenstrom dorthin, alles fliegt davon, als ob es in einer Blackbox zusammengesetzt wäre und funktioniert. <br><img src="https://habrastorage.org/webt/e4/pa/vy/e4pavyyaikufar_cl4sqw1karxe.jpeg"><br>  Die Netzwerke sind jedoch unterschiedlich.  Die Hälfte der Anrufe wird über Mobilfunknetze getätigt und sieht nicht immer wie eine Autobahn aus. <br><img src="https://habrastorage.org/webt/ck/62/va/ck62vamogxhsgqdjuvvmoa1jlrq.jpeg"><br>  Netzwerke können überlastet sein, dann gehen die Daten verloren und sie müssen wiederhergestellt werden, wodurch das Netzwerk weiter geladen wird.  Es gibt Netzwerke, in denen alles in Ordnung zu sein scheint, aber Pakete immer noch verschwinden - zum Beispiel, weil sich der WLAN-Router hinter einer Stahlbetonwand befindet. <br><br><h2>  Netzwerkfunktionen </h2><br>  Wir werden die Hauptmerkmale analysieren, die die Qualität des Netzwerks beschreiben. <br><br><h3>  RTT </h3><br>  Roundtrip-Zeit - die Zeit zwischen dem Server, der die Daten an den Client sendet und die Bestätigung zurückerhält. <br><br>  Denken Sie daran, wir möchten in 1 Sekunde eine Verbindung herstellen.  Wenn die Umlaufzeit 200 ms beträgt, können beim Verbindungsaufbau, z. B. über TCP, plus TLS, <strong>nur 500 ms für die Verbindung verloren gehen</strong> .  Es verbleiben nur 500 ms, d.h.  Noch ein paar Anfragen, nach denen die Verbindung aufgebaut werden soll.  Daher müssen Sie bei zusätzlichen Anfragen mit RTT sehr sorgfältig arbeiten. <br><br>  Ein Beispiel: <br><br><pre><code class="xml hljs">$ ping google.com 64 bytes from 173.194.73.139: icmp_seq=5 ttl=44 time=211.847 ms round-trip min/avg/max/stddev = 209.471/220.238/266.304/19.062 ms RTT = 220ms $ curl -o /dev/null -w "HTTP time taken: %{time_connect}\nHTTPS time taken: %{time_appconnect}\n" -s https://www.google.com HTTP time taken: 0.231 HTTPS time taken: 0.797 HTTP = 230ms HTTPS = 800ms</code> </pre> <br>  Bei RTT = 220 ms dauert der Empfang einer Antwort über https bis zu 800 ms.  Wenn Sie also eine sichere Web-Socket-Verbindung haben, wird mit einem solchen Ping die ganze Sekunde vergehen. <br><img src="https://habrastorage.org/webt/h7/jz/fz/h7jzfzctyl9uto140qct-vu05um.jpeg"><br>  Die Tabelle zeigt die in Mobilfunknetzen gemessenen Handshake-Verzögerungen (in <a href="https://youtu.be/0xKAR0AHIdY">diesem</a> Bericht werden weitere Details zum Betrieb von Anwendungen in Mobilfunknetzen aufgeführt). <br><br><h3>  Durchsatz </h3><br>  Sie können Pakete an das Netzwerk senden, wie Sie möchten: in Stapeln oder sofort alle in den Puffer hämmern, werden sie immer noch gleichmäßig an den Client gelangen.  Die Anzahl der Pakete oder Daten pro Sekunde ist die Bandbreite oder Bandbreite. <br><br>  Das Problem ist, dass sich die <strong>Bandbreite in Mobilfunknetzen ständig ändert</strong> .  Wenn es stark abfällt und die Daten mit derselben Bitrate übertragen werden, gehen sie offensichtlich mit Verlusten durch, und der Anruf des Benutzers wird "hängen".  Dies muss auch bekämpft werden. <br><br><h3>  Paketverlust </h3><br>  Bei der Übertragung von Daten kann das Paket verloren gehen.  In diesem Fall haben Sie die Wahl: Überspringen Sie entweder einen Teil der Pakete und erhalten Sie Verzerrungen, oder versuchen Sie, die Pakete erneut zu übertragen und ein Standbild zu erhalten. <br><br><h3>  Jitter </h3><br>  Tatsache ist, dass Pakete nicht gleichmäßig nacheinander eintreffen, sondern in gebündelten Paketen in bestimmten Intervallen. <br><br><img src="https://habrastorage.org/webt/zs/hc/fu/zshcfujfcg6helcc8rnx8pyfor4.jpeg"><br>  Jitter ist einfach zu messen: <br><br><pre> <code class="xml hljs">PING highload.ru (178.248.233.16): 56 data bytes icmp_seq=11 ttl=43 time=117.177 ms icmp_seq=12 ttl=43 time=132.868 ms icmp_seq=13 ttl=43 time=176.413 ms icmp_seq=14 ttl=43 time=225.981 ms</code> </pre> <br>  Pinganuli highload.ru mehrmals (ping ist ein instabiler Wert, es ist notwendig zu <code>((132-117)+(176-132)+(225-176)) / 3 = (14 + 44 + 79) / 3 = 46 </code> ), wir haben den durchschnittlichen Jitter: <code>((132-117)+(176-132)+(225-176)) / 3 = (14 + 44 + 79) / 3 = 46 </code> . <br><img src="https://habrastorage.org/webt/zj/4n/wp/zj4nwpcfmrefzo989lg_ipmbffy.jpeg"><br>  Angenommen, wir übertragen ein Video und ein Frame ist ein Netzwerkpaket.  Es werden mehrere Bilder ohne Unterbrechung abgespielt, aber der dritte Vogel ist aufgrund von Jitter verzögert - wir erhalten ein Standbild.  Sie müssen also Pakete irgendwo sammeln und diesen Effekt ausgleichen. <br><br>  Das heißt, um drahtlose Netzwerke zu charakterisieren, ist es ausreichend, die folgenden Werte zu kennen: RTT (Roundtrip-Zeit);  Bandbreite BW (Bandbreite);  Paketverlust in Prozent;  Jitter. <br><br><h2>  Wie sieht der Benutzer aus? </h2><br>  Bevor Sie beginnen, die Arbeit mit dem Netzwerk zu optimieren, müssen Sie herausfinden, welche Art von Internet die Benutzer haben - vielleicht hat jeder ein perfektes Netzwerk, jede Lösung funktioniert. <br><br>  In 80% der Fälle verwendet der Endbenutzer eine drahtlose Verbindung: Es handelt sich entweder um ein Mobilfunknetz oder um Wi-Fi. <br><br><img src="https://habrastorage.org/webt/ub/_w/ep/ub_wepc3hzha5g1vmnbcuvu5758.jpeg"><br><br>  In Russland, außerhalb der westlichen Region und großer Städte, sind die durchschnittlichen Netzwerkeigenschaften: RTT - 200 ms, Bandbreite - 1,1 Mbit / s, Paketverlust - 0,6%, Jitter - 5 ms. <br><br>  Wir haben diese Werte nach Netzwerktypen unterteilt und festgestellt, dass es notwendig ist, zu lernen, damit zu arbeiten. <br><br><img src="https://habrastorage.org/webt/vb/mk/6u/vbmk6ue1tjohnzk9dmybx7jgiq4.jpeg"><br><br><h2>  Entwicklungsfunktionen aufrufen </h2><br>  Viele Menschen vergessen, aber LTE und 3G sind asymmetrische Kommunikationskanäle: Downlink ist immer mehr als Uplink.  Je nach Protokolltyp kann dieses Verhältnis zwischen 15/85 und 30/70 variieren.  Dies ist beim Entwerfen von Anrufen wichtig. <br><br>  Wie können Sie überprüfen, welchen Kanal Ihre Kunden haben? <br><br><img src="https://habrastorage.org/webt/9y/kz/pj/9ykzpjasmaqko3glxox9ps6tkgs.jpeg"><br><br>  Sie können sich speedtest ansehen, wie hoch das weltweite Geschwindigkeitsverhältnis zwischen mobilem und festem Internet ist.  Es stellte sich heraus, dass das feste Internet weltweit ebenfalls asymmetrisch ist.  In Russland stellte sich glücklicherweise eine Symmetrie heraus: Das Uplink / Downlink-Verhältnis in einem festen Internet über WLAN in Russland beträgt 50/50.  Wir werden uns auf solche Werte konzentrieren. <br><br><img src="https://habrastorage.org/webt/al/6o/zb/al6ozb-zf_b_f8vecacwryr-gce.jpeg"><br><br>  <strong>Fazit:</strong> Drahtlose Netzwerke sind beliebt und instabil. <br><br><ul><li>  Mehr als 80% der Kunden nutzen das drahtlose Internet. </li><li>  WLAN-Einstellungen ändern sich dynamisch. </li><li>  Drahtlose Netzwerke weisen hohe Raten von Paketverlust, Jitter und Neuordnung auf. </li><li>  Asymmetrischer Uplink / Downlink-Kanal im Verhältnis 30/70. </li></ul><br><h2>  Anrufe </h2><br>  Kehren wir mit diesem Wissensspeicher zur Implementierung von Gruppenaufrufen zurück.  Betrachten Sie einen Algorithmus für einen einfachen Gruppenaufruf, den wir dann verfeinern. <br><br>  <strong>Schritt 1.</strong> Alice möchte Boris anrufen und sendet ihm ein Angebot, in dem sie alles berichtet, was sie kann, welche Protokolle, Einstellungen usw. unterstützt. <br><img src="https://habrastorage.org/webt/k-/gr/xz/k-grxzwigzw4xaqgctisb27xalq.jpeg"><br>  <strong>Schritt 2.</strong> Boris antwortet Alice, woraufhin eine Verkehrsverbindung hergestellt wird. <br><img src="https://habrastorage.org/webt/qf/yp/my/qfypmyzwq5sjl8et0tg2ju6vddm.jpeg"><br>  <strong>Schritt 3.</strong> Danach beginnt der Austausch von Audio- / Videodaten. <br><img src="https://habrastorage.org/webt/rb/7w/hh/rb7whhnevjv6s15l0nmvftyx2lq.jpeg"><br>  Die Architektur von Anrufen sieht ungefähr so ​​aus wie in der folgenden Abbildung. <br><img src="https://habrastorage.org/webt/_n/6g/7o/_n6g7ohpbtl7wonvxjfrdcb8w2a.jpeg"><br>  Es gibt immer einen gemeinsam genutzten Server, aber wenn die Verbindung hergestellt ist, können Benutzer bereits P2P-Daten oder über Server von Drittanbietern übertragen. <br><br>  Daten werden von einer Kamera erfasst, die sie auf dem Gerät codiert und an die Socket-Verbindung sendet.  Sie durchlaufen das Netzwerk, werden vom Codec auf der anderen Seite wiedergegeben und auf dem Bildschirm angezeigt. <br><br>  Betrachten Sie alle Schritte des Algorithmus im Detail und versuchen Sie, von 1-zu-1-Anrufen zu Gruppenanrufen zu wechseln. <br><br><h2>  Signalisierung </h2><br>  Aufgabe: Anruf melden und Datenverbindungen herstellen. <br><br>  Alles ist ganz einfach: <br><br><ul><li>  Alice ruft an, eine Benachrichtigung wird über ein mobiles Gerät oder einen Browser an Boris gesendet. </li><li>  Ein Web-Socket oder eine andere Verbindung wird hergestellt. </li><li>  Danach finden Verhandlungen statt - Alice und Boris sind sich einig. </li><li>  Wenn der Hörer auf einem Gerät abgenommen wird, wird der Anruf auf dem anderen Gerät automatisch beendet. </li></ul><br><img src="https://habrastorage.org/webt/x8/p8/4a/x8p84akywewgezvufnt64jqfmp8.jpeg"><br>  Die Anrufplattform in Odnoklassniki unterstützt verschiedene Kunden und Transporte.  Sie alle befinden sich in der Nähe eines Servers, der einen Anruf bearbeitet und Nachrichten weiterleitet. <br><img src="https://habrastorage.org/webt/on/3v/9s/on3v9swzgtmfub9c_ru18qwjl1m.jpeg"><br>  Im Falle eines Serverabsturzes oder der Installation von Updates gibt es einen dauerhaften Speicher, in dem alle Nachrichten aufgezeichnet werden.  Im Falle eines Serververlusts können Sie problemlos zu einem anderen wechseln.  Das macht ZooKeeper. <br><br>  Die einzige Schwierigkeit ist <strong>genau einmal</strong> .  Wir möchten einige Nachrichten nicht zweimal anwenden.  Dieses Problem wird einfach gelöst: Alle Nachrichten haben eine Seriennummer - zweimal kommt eine einzelne Nachricht nicht an. <br><br>  Darüber hinaus müssen Sie beim Erstellen eines Anrufs vorsichtig sein.  Eine Person kann einen Anruf erstellen, auflegen und einen weiteren Anruf erstellen.  Oder es kann nicht hängen, aber immer noch eine andere erstellen.  Alle diese Anrufe sind nicht eindeutig - es ist nicht klar, ob dies ein Relais ist oder der Benutzer auf die Anruftaste doppelklickt.  Es ist einfach zu reparieren: Auf dem Client wird eine eindeutige ID generiert und eine Deduplizierung durchgeführt.  Grundsätzlich <strong>gibt es keine Schwierigkeiten bei der Signalisierung</strong> . <br><br>  Die P2P-Signalisierung an die Gruppe ist problemlos abgeschlossen. <br><img src="https://habrastorage.org/webt/7q/y6/zh/7qy6zhw2z72nbjcazwlx681hrau.jpeg"><br>  Die gleichen Angebote und Antworten sendet Alice nun nicht nur an Boris, sondern auch an Dima.  Sie empfangen sie, stimmen zu, Datenaustauschkanäle erscheinen zwischen ihnen. <br><br><h2>  Audio / Video </h2><br>  Um mit einem Gruppenanruf fertig zu werden und zu verstehen, welche Technologien benötigt werden, müssen wir ein wenig darüber sprechen, was ein Video ist. <br><br>  Video ist 24 oder 60 Bilder pro Sekunde.  Um sie zu komprimieren, werden Codecs verwendet.  Das Hauptmerkmal von Codecs ist, dass alle paar Frames ein Referenzframe (z. B. JPEG) vorhanden ist und dass Zwischenframes durch Änderungen bestimmt werden. <br><img src="https://habrastorage.org/webt/yl/2d/fs/yl2dfs-nsm6cmuifnpaykbyhnkg.jpeg"><br>  Im obigen Bild ist das erste Bild mit der Maschine das Referenzbild, und im nächsten Bild werden nur die Änderungen (Bewegung der Maschine) und beim nächsten Mal auch nur die Änderungen codiert. <br><br>  Dies wird als Gruppe von Bildern bezeichnet - eine unabhängige Gruppe miteinander verbundener Bilder, die decodiert werden können.  Codec ist ein Algorithmus zur Transformation zwischen Frames.  Je steiler der Codec, desto besser werden die Daten komprimiert und desto mehr Ressourcen werden benötigt. <br><div class="scrollable-table"><table><tbody><tr><td>  Qualität </td><td>  Erlaubnis </td><td>  Minimale Bitrate </td></tr><tr><td>  FullHD </td><td>  1920 x 1080 </td><td>  4 Mbit / s </td></tr><tr><td>  HD </td><td>  1280 x 720 </td><td>  1,5 Mbit / s </td></tr><tr><td>  niedrig </td><td>  640 x 360 </td><td>  600 kbps </td></tr><tr><td>  am niedrigsten </td><td>  426 x 240 </td><td>  300 kbps </td></tr></tbody></table></div>  Über das Verhältnis der Codec-Bitraten gibt es allgemeine Regeln (siehe <a href="https://youtu.be/e1JYFRwHzkQ">Link</a> ). <br><br>  Die beliebtesten Codecs für Anrufe sind <strong>H.264 und VP8</strong> .  H.264 ist gut, weil es überall hart arbeitet und keine Batterie frisst.  Aber in der Regel auf Handys ein Encoder (Encoder) und 4 Decoder.  Für alles andere benötigen Sie die Software VP8, die einen guten Akku verbraucht.  Es lohnt sich, die Priorität für Gruppenanrufe auf H.264 zu ändern (siehe den <a href="https://is.gd/5WaBAP">Link</a> zur Vorgehensweise). <br><br>  Der Codec kann mit einer Variablen (Variable Bitrate) oder einer konstanten Bitrate (Constant Bitrate) codieren.  Viele Codecs auf Geräten unterstützen keine konstante Bitrate, so dass Sie mit dem Bild auf der linken Seite leben müssen. <br><img src="https://habrastorage.org/webt/6r/ej/mt/6rejmtldwpgvu2an6bbjwu7-xoq.jpeg"><br><br><h3>  Audio-Codecs </h3><br>  Es gibt verschiedene Legacy-Codecs für Audio, z. B. den G711.  Der Opus-Codec ist sehr beliebt - er löst das Codierungsproblem sowohl bei niedrigen als auch bei hohen Bitraten, da er SILK von Skype und den CELT-Codec für Musik enthält. <br><br>  Es ist erwähnenswert, dass das Opus einen proaktiven Fehlerkorrekturalgorithmus für die Vorwärtsfehlerkorrektur (FEC - Forward Error Correction) hat.  Für Audio funktioniert dieser Algorithmus folgendermaßen: In jedem Paket befinden sich Daten in hoher Qualität und Daten aus vorherigen Frames für einige Zeit in geringer Qualität.  Wenn dementsprechend das vorherige Paket verloren geht, können Sie die Daten des vorherigen Pakets in geringer Qualität erhalten und irgendwie verlieren.  Im Durchschnitt fällt es ziemlich gut aus. <br><br>  Bei der Arbeit mit Audio-Codecs ist es interessant, die Grafik zu betrachten, die das Verhältnis zwischen der Qualität des Eingangssignals und der Bitrate zeigt. <br><img src="https://habrastorage.org/webt/_r/wd/em/_rwdemfrce5rw2njez4pge9wgr0.jpeg"><br>  Es ist zu sehen, dass Opus fast alle Probleme löst.  Es ist interessant, auf AAC zu achten, das beim Codieren von Videos in verschiedenen Hostingdiensten verwendet wird, und auf den alten Speex-Codec, der ausschließlich für Audio verwendet wurde und bis zu 32 Kbit / s funktioniert. <br><br><h3>  Daten zur Medienpathologie </h3><br>  Um zu verstehen, wie Topologien funktionieren und welche Funktionen sie haben, müssen Sie wissen, wie ein Videocodec mit Verlusten umgeht. <br><img src="https://habrastorage.org/webt/vt/dn/zm/vtdnzmfdmc8n8bxq_rmmfoscpls.jpeg"><br>  Im ersten Fall ging nichts verloren und wir sehen ein gutes Bild.  In der zweiten Zeile geht ein zufälliger Frame verloren - das Bild enthält kleine Artefakte.  Im dritten Fall verschwand der Referenzrahmen, daher werden bis zum nächsten Referenzrahmen Änderungen angezeigt, die sich zufällig überlappen. <br><br>  Offensichtlich ist das Erstellen von Referenzrahmen oft teuer, da die Bitrate zunimmt.  Daher unterstützen fast alle Anrufdienste die Möglichkeit, bei Verlust einen Referenzrahmen anzufordern.  In WebRTC wird dies als vollständiger INTRA-Frame bezeichnet. <br><br>  Die einfachste Topologie besteht darin, Ihr gesamtes Video an alle anderen Konferenzteilnehmer zu senden. <br><img src="https://habrastorage.org/webt/st/mt/bu/stmtbu09eze8vg6letvekimnosu.jpeg"><br>  Wir starten einen Codec und beginnen mit der Videoübertragung.  Alice schaltet die Kamera ein, den Codec, sendet ihr Video an Boris und Dima.  Aber wenn Dima schlechtes Internet hat, leidet Boris, weil Sie die Qualität des gesamten Videos verringern müssen.  Und wenn Dima den Schuss verlor und einen Unterstützer verlangte, wird Boris ihn auch bekommen, obwohl er ihn nicht brauchte. <br><br>  Auf der anderen Seite können Sie alle Videos in einem Stream zusammenfügen.  Dies erfordert spezielle Ausrüstung und möglicherweise zusätzliche Verzögerungen, aber es gibt auch eine solche Lösung. <br><br><h3>  Transportieren oder liefern Sie Video und Audio mit minimaler Verzögerung </h3><br>  Wir haben die Wahl zwischen TCP- oder UDP-Protokollen. <br><div class="scrollable-table"><table><tbody><tr><td>  TCP </td><td>  UDP </td></tr><tr><td>  Zuverlässig </td><td>  Unzuverlässig </td></tr><tr><td>  Verbindungsorientiert </td><td>  Verbindungslos </td></tr><tr><td>  Segmentweiterleitung und Flusskontrolle durch Fensterung </td><td>  Keine Fensterung oder erneute Übertragung </td></tr><tr><td>  Segmentsequenzierung </td><td>  Keine Sequenzierung </td></tr><tr><td>  Acknowledgement Sequencing </td><td>  Keine Bestätigung </td></tr></tbody></table></div>  Wahrscheinlich erinnert sich jeder daran, dass TCP ein zuverlässiges Protokoll ist, das sie im Falle eines Paketverlusts erneut sendet.  Aus diesem Grund ist diese Reihenfolge der Frames wie im Bild unten möglich. <br><img src="https://habrastorage.org/webt/si/qm/rc/siqmrcta6lzauazsdsbitbkifvo.jpeg"><br>  Wenn ein Paket im Paket fehlt, können Sie dieses der 24 Frames im Video frei überspringen, aber TCP erlaubt Ihnen nicht, das Folgende zu empfangen, bis Sie das verlorene senden.  <strong>Die Übertragung von Videos über TCP ist äußerst ineffizient.</strong>  UDP wird für solche Aufgaben empfohlen und wird von allen Anrufdiensten verwendet. <br><br>  Dieser <a href="https://habr.com/ru/company/oleg-bunin/blog/461829/">Artikel</a> enthält alle Funktionen beider Protokolle und erläutert, warum alle Streams unter UDP funktionieren.  Im Rahmen des heutigen Themas reicht es für uns zu wissen, dass UDP nicht überall verfügbar ist und in 3% der Netzwerke nicht funktioniert. <br><img src="https://habrastorage.org/webt/tv/ky/jz/tvkyjzwzytjo2pgxmfgek1afv_8.jpeg"><br>  Im Allgemeinen können Benutzer P2P-Verbindungen zwischen sich herstellen. <br><img src="https://habrastorage.org/webt/xe/nj/ew/xenjewfqamelio5eqywflbiyn54.jpeg"><br>  Dies ist am rentabelsten, da es viel besser ist, direkt zu kommunizieren und keinen zusätzlichen Server zu verwenden, der eine Hebelwirkung bietet, wenn wir uns in Nowosibirsk anrufen. <br><br>  NAT existiert jedoch und mehr als 97% der Benutzer befinden sich jetzt dahinter - nur wenige haben externe IPs.  Einerseits wird dieses Problem früher oder später durch IPv6 behoben.  In Russland war MTS übrigens die erste, die es auf den Markt gebracht hat.  Jetzt unterstützen sie IPv6 vollständig und alle ihre Clients verfügen über weiße IPs. <br><br>  NAT kann durchbrechen, kann nicht durchbrechen, und dann müssen Sie Fallback über den Server verwenden.  Es gibt auch einen <a href="https://habr.com/ru/company/oleg-bunin/blog/428217/">Artikel darüber,</a> wie man NAT durchbricht. <br><br><h3>  Jitterpuffer zwischen Transport und Frames </h3><br>  Wir ziehen weiter.  Jetzt brauchen wir einen Jitterpuffer, um den Effekt des Jitters auszugleichen <br><img src="https://habrastorage.org/webt/od/eb/m5/odebm5kla1eprghttikfis_tzm8.jpeg"><br>  Wir beginnen proaktiv, Frames mit einer gewissen Verzögerung anzuzeigen, und richten in der Zwischenzeit Frames im gleichen Intervall im Puffer aus. <br><br>  Der Puffer erhöht sich dynamisch. <br><img src="https://habrastorage.org/webt/_q/-s/o4/_q-so4lqgyenwyrlcbk2u141h2k.jpeg"><br>  Wenn der Frame verloren geht und das Bild eingefroren ist, vergrößert sich der Puffer, und wir arbeiten bereits mit einem Puffer dieser Größe. <br><br>  Es kann jedoch eine umgekehrte Situation geben, wenn Sie den Puffer reduzieren müssen.  Zum Beispiel hat sich das Netzwerk stabilisiert, und die Zeit muss eingeholt werden.  Wenn Sie einfach den Puffer reduzieren, wird es lächerlich, die Leute werden sehr schnell mit der Stimme eines Gnoms sprechen.  Aus diesem Grund gibt es spezielle Algorithmen, die die Audio-Geschwindigkeit unmerklich anpassen: Entfernen Sie Pausen zwischen Wörtern oder reduzieren Sie Geräusche, die in der Sprache zu lang sind. <br><br>  Wenn Sie ein Video transkodieren und etwas reparieren möchten, benötigen Sie zunächst einen Jitter-Puffer, dessen Latenz nicht geringer ist als der Latenz-Jitter dieses Netzwerks.  Das heißt, es erhöht definitiv die Latenz und wir erinnern uns, dass wir wirklich innerhalb von 0,5 s bleiben wollen. <br><img src="https://habrastorage.org/webt/um/vs/2i/umvs2isu-bjnd2sp4u7ke7sqyv4.jpeg"><br>  Ausatmen - die Theorie ist vorbei! <br><br><h2><a name="ok-call"></a>  Ruft nach OK auf </h2><br>  Vor Gruppenanrufen hatten wir p2p-Anrufe, die WebRTC-Bibliothek wurde verwendet, Web- und Mobile-Clients wurden gesammelt, Signalisierung wurde geschrieben. <br><img src="https://habrastorage.org/webt/kj/sl/uo/kjsluoez0wxxhsya9ttbfaev--k.jpeg"><br><br><h3>  Wettbewerbsanalyse </h3><br>  Wenn Sie nicht wissen, was Sie tun sollen, schauen Sie sich Ihre Konkurrenten an.  Als Referenz haben wir ein Set ausgewählt: Skype, WhatsApp, Hangouts, ICQ, Zoom.  Wir haben die maximale Teilnehmerzahl in einem Gruppengespräch, die Latenz, den Batterieverbrauch und die Qualität gemessen. <br><br>  Am interessantesten ist es, die Verzögerung zu bestimmen.  Wir machen es so: Timer einschalten, Video aufnehmen, telefonieren. <br><img src="https://habrastorage.org/webt/0k/_q/ct/0k_qctbyc9_eenat32mcm3zbz10.jpeg"><br>  100 ms - Kameraverzögerung von dem Moment an, an dem das Video auf die Linse traf, bevor es in die Matrix des Telefons gezeichnet wurde.  Danach wird das Video an das Netzwerk gesendet und es wird bereits eine Verzögerung von 310 ms beim Anruf festgestellt. <br><img src="https://habrastorage.org/webt/eg/oi/g5/egoig53tzrzn-1byodqkwmfcfsq.jpeg"><br>  Vergessen Sie nicht, die CPU-Auslastung auf dem Gerät zu messen.  Ab iOS 12 war dies systematisch möglich, aber wir verwenden ein Pyrometer auf die alte Art und Weise. <br><br>  Erhielt die folgenden Ergebnisse: <br><img src="https://habrastorage.org/webt/mk/tu/1s/mktu1se2wjoa_lwb842wsfkyouk.jpeg"><br>  WhatsApp und ICQ haben maximal 4 Anrufteilnehmer, Skype hat 25 (Skype for Business 250) und Hangouts und Zoom haben jeweils 100 Teilnehmer.  Hangouts hatten früher ungefähr 35 Mitglieder, und jetzt ist er in die 100+ -Rubrik gesprungen. <br><br>  Der Zoom hat eine etwas längere Verzögerung, aber Hangouts verbrauchen mehr Akkustrom.  Zoom scheint mir eine bessere Qualität zu haben, aber es gibt Artikel, die das Gegenteil aussagen - dies ist eine subjektive Metrik. <br><img src="https://habrastorage.org/webt/mu/sa/9b/musa9bet2chfnzj55svmkj5j9qk.jpeg"><br>  Einige Dienste verwenden offenes WebRTC, andere proprietäre Protokolle.  Es ist jedoch offensichtlich, dass die Anzahl der Teilnehmer des Anrufs nicht beeinflusst wird, welche Art von Transport Sie im Folgenden verwenden.  Es gibt Lösungen mit 100 Anrufen und eigenen Protokollen (Zoom) sowie mit WebRTC (Hangouts). <br><br><h3>  Skaliere von 2 bis N </h3><br>  Stellen Sie sich einen interessanten Fall vor: Es gibt einen Client mit einem asymmetrischen Kanal, Eingang 3 Mbit / s, Ausgang 1,5 Mbit / s, Paketverlust 0,6%, Jitter 50 ms.  Es gibt Video in HD (1280x720) mit einer Bitrate von 1,5 Mbit / s und Video mit einer Auflösung von 640x360 (nennen wir LOW) bei 600 Kbit / s.  Wir wollen coole Videos übertragen. <br><br>  Wenn zwei Leute p2p anrufen, ist alles einfach.  Sie haben genug Eingangsnetzwerk, das Ausgangsnetzwerk ist eng genug, weil der Kanal asymmetrisch ist und es keine Probleme mit Codecs gibt - alle Codecs sind kostenlos. <br><br>  Wenn wir anfangen, Gruppengespräche zu führen, müssen wir alle wieder verbinden.  Die einfachste Version der Topologie ist <strong>Mesh</strong> oder "all to all". <br><img src="https://habrastorage.org/webt/xt/zk/th/xtzkthwsqgph-xmvnpzufncfl6o.jpeg"><br>  Es ist großartig, dass keine Zwischenserver benötigt werden, aber es wird problematisch, jedem Ihr Video für Kunden mit solchen Eigenschaften zur Verfügung zu stellen.  Und wenn der Client das Video nicht alleine an jemanden verteilen kann, müssen Sie die Qualität verringern, da der gemeinsame Stream für alle codiert ist. <br><br>  In diesem Fall reichen für 5 Teilnehmer weder 3 noch 4 Mbit / s aus. <br><img src="https://habrastorage.org/webt/ah/h5/rf/ahh5rfvgcjjkm70qhzv1ruduaws.jpeg"><br>  Aus diesem Grund gibt es in WhatsApp in einem Gruppenanruf maximal 4 Teilnehmer, die nicht mehr so ​​lange teilnehmen, wie sie Mesh verwenden. <br><br>  Eine andere Möglichkeit besteht <strong>darin, das</strong> gesamte Bild <strong>auf dem Server zu sammeln</strong> .  Dies ist für den Client am rentabelsten: Er hat eine Verbindung zum Server, der Server sammelt das Bild, der Client erhält es zurück. <br><img src="https://habrastorage.org/webt/bg/_3/qh/bg_3qhrgkt1izvjkwciy4pfegbm.jpeg"><br>  Angenommen, unsere Benutzer aus Petropavlovsk-Kamchatsky, Komsomolsk-on-Amur und Novosibirsk möchten über einen Moskauer Server chatten.  Natürlich wird es sehr schlecht ausgehen.  Das Vorhandensein von CDN wird ein wenig helfen, aber dennoch eine große Menge an Jitter-Puffern erhalten, was insgesamt zu einer angemessenen Erhöhung der Latenz führt. <br><br>  Die nächste Topologie - das <strong>Mischen beenden</strong> - schlägt vor, kein allgemeines Bild auf dem Server zu sammeln, um diese Verzögerungen zu vermeiden, sondern einfach Pakete auszulösen. <br><img src="https://habrastorage.org/webt/1k/aj/cc/1kajccrtduezyvharoklxqwlv0e.jpeg"><br>  Das heißt, der Server in dieser Topologie ist einfach ein Relay, das Daten überträgt. <br><br>  Alles wird ein bisschen besser: Der Benutzer empfängt Streams aller anderen Teilnehmer des Anrufs und sendet seine eigenen nur einmal.  Aber auch hier gibt es Probleme: <br><br><ul><li>  <strong>Qualität.</strong>  Alle Empfänger Ihres Streams haben ein anderes Netzwerk.  Wenn eine Person mit einer schlechten Internetverbindung verbunden ist, muss das Video in niedriger Auflösung an sie gesendet werden, und dementsprechend wird das Bild für alle schlecht. </li><li>  <strong>Storm Referenzrahmen</strong> .  Wenn eine Person mit schlechtem Internet ständig nach einem Referenzrahmen fragt, dann fängt auch jeder an, Oporniks zu erhalten.  Dies ist eine ineffiziente Verwendung der Bitrate, die Qualität nimmt wieder ab. </li></ul><br><img src="https://habrastorage.org/webt/26/wj/bv/26wjbvlg4tlfijnuif4dwzpfc8m.jpeg"><br>  Wenn ein <strong>zentrales System verwendet</strong> wird, werden alle Videos auf dem Server gesammelt.  Dies erfordert viele Codierungsstufen, die sowohl die Latenz erhöhen als auch zusätzliche Hardware erfordern.  Beim Endmischen hingegen ist alles schnell und einfach. <br><br>  <strong>Nachteile Topologien:</strong> <br><br><ul><li>  Mesh - maximal 4 Mitglieder. </li><li>  Zentralisiert - Probleme mit der Transcodierung und mit Jitter. </li><li>  Ende mischen - Qualitätslimit und Sturmbezugsrahmen. </li></ul><br>  Nur ICQ und Skype funktionieren in der Mesh-Topologie, und der Rest ist das Endmischen.  Aber, wie wir uns erinnern, unterscheiden sich alle Services in ihren Eigenschaften - was bedeutet, dass es nicht nur Endmixing gibt, sondern etwas anderes. <br><br>  Hangouts haben den Trick mit Endmix gemacht. <br><img src="https://habrastorage.org/webt/pm/uy/25/pmuy25cx0untfvn3gbk0qmcehay.jpeg"><br>  Auf jedem Client werden zwei Encoder gestartet: H.264 in hoher Qualität und VP8 in niedriger Qualität.  Dementsprechend überträgt der Server für Benutzer mit gutem Internet qualitativ hochwertige Videos, für Benutzer mit schlechtem Internet ist dies schlechter, und schlechte Qualität passt sich an das schlechteste Netzwerk an.  Zwei Eigenschaften sind gut, aber das ist zusätzlicher Verkehr von Kunden und Batterieverbrauch.  Es gibt aber keinen Jitterpuffer <br><br>  Die Tabelle zeigt, dass bei Hangouts, in denen das Telefon am meisten erwärmt wird, nur minimale Verzögerungen auftreten, die Qualität jedoch darunter leidet, da die hohe Bitrate bei niedriger Qualität nach wie vor sinkt. <br><img src="https://habrastorage.org/webt/na/6n/2f/na6n2fs0u3ebkqez1jjntk3kel0.jpeg"><br>  Wir haben uns entschlossen, einen Schritt weiter zu gehen und ein Spiel wie dieses zu spielen: Führen Sie dennoch keine Software-Codecs vom Client aus, codieren Sie H.264, nutzen Sie den Kanal in vollem Umfang unter einem Stream (dies spart Batterie und Verkehr), und verwenden Sie das End-Mischschema für hohe Qualität.      centralized-,    ,    ,       ,     . <br><img src="https://habrastorage.org/webt/db/15/pw/db15pwl1tkdxpxd4xpz8gp-sba4.jpeg"><br> ,      :      .   ,        , ,     ,   -     .    ,           . <br><br>        . <br><img src="https://habrastorage.org/webt/0o/9y/6b/0o9y6bt7zahjvydljkpnkvaxvyk.jpeg"><br> ,  ,    ,       latency     .    ,        , ,   ,       .                 centralized,    ,  ,   jitter-  .          ,            ,   . <br><br>        «»,   .          100,  50,   20   .           . <br><img src="https://habrastorage.org/webt/du/88/yt/du88ytnejvtsgryudgkdfntv7pg.jpeg"><br>         —  ,       5 .      .    :  ,     ,      ,      —      . <br><br>  «»      , ,    , —  .       :   ,    - ,    fps.  ,          —  .    - ,  .    ,     . <br><br><h2><a name="fin"></a>   </h2><br>    Mesh  3-4       latency,    ,         Mesh.      ,   HD   End mixing, a SD —  centralized. <br><br>       Zoom. <br><img src="https://habrastorage.org/webt/h9/5q/2q/h95q2que4mihuktnf2mz18zsjua.jpeg"><br> ,    -    ,   Zoom  ,    WebRTC.   <strong>   WebRTC</strong> ,        . <br><br><h2>  </h2><br>      . <br><br> <strong>CPU   ,  .</strong>       — ,    ,   ,   ,   CPU ,  .     ,       . <br><br>   :   ,    ,      . <br><br> <strong> screen sharing   .</strong>    screen sharing,       ,    .   screen sharing  .  ,   fps — ,    ,    . <br><br> <strong>        .</strong>    —     centralized,      ,       .    ,   . <br><img src="https://habrastorage.org/webt/kd/b4/zt/kdb4ztkg9daqyfjryhpzg4u7uac.jpeg"><br>  ,        ,    ,     .         ,    ,                 . <br><br><h2><a name="server"></a>   </h2><br> ,   ,  -     .               . <br><img src="https://habrastorage.org/webt/ga/ve/43/gave43pdwqyaly4pm7b1amurzxc.jpeg"><br><br><h3> Packet pacing </h3><br> -,  UDP-     .   UDP   pacing.    UDP-  ,     . <br><img src="https://habrastorage.org/webt/mc/mb/t3/mcmbt33ngipgrs1xlf3hvhbx6d8.jpeg"><br>   ,      UDP ,   21       100%.           —     . <br><br>     pacing?    ,         (   <a href=""></a> ) —   ,  .  ,         ,  , ,  ,     ,   -             . <br><br>   : <br><br><ul><li>  pacing,     . </li><li>   pacing, ,  ,   ,      . </li></ul><br>     :        ,  pacing ,    —. <br><br>    packet pacing? <br><img src="https://habrastorage.org/webt/wp/y3/vx/wpy3vxtcvgzvn8lukrnrpm2sx2w.jpeg"><br>   ,   (    )      ,   ,  - .   (  ),     ,       ,     . <br><br>    — packet loss ,   pacing. <br><br><h3>  MTU </h3><br> TCP  ,       MTU.      UDP,     ,  MTU —    ,      . <br><br>       MTU 1500,        MTU 1100,   . ,    ,        , , ,    (   ).       ,   MTU . <br><img src="https://habrastorage.org/webt/rc/r7/jv/rcr7jvrykz5mtbajkmskh-s9if0.jpeg"><br>  TCP  ,       .   ,   MTU:   -   ,    , ,    MTU.         ,   MTU,    ,  . <br><br>   . <br><img src="https://habrastorage.org/webt/mp/fx/ct/mpfxctwu5bck6fnp2_nr_lsmugc.jpeg"><br>   ,     :      ,  ,      .  98%          1350.    <strong>MTU = 1350</strong> ,    ,    2%    —  ,  . <br><br><h3>  Fehlerbehebung </h3><br> WebRTC  SACK, NACK, FEC.       . <br><br>   ,   1–3%     —  ,      . <br><br>  WebRTC      negative acknowledgement (NACK). <br><img src="https://habrastorage.org/webt/n4/ik/zh/n4ikzhbxffmdjuf-a79snq2vaum.jpeg"><br>         ,  ,  -  ,  . <br><br>  , TCP   acknowledgement,     selective acknowledgement.  negative acknowledgement  ,        FEC (Forward Error Correction). <br><br>     ,   SACK, NACK, FEC,   <a href="https://youtu.be/e1JYFRwHzkQ"></a> . <br><br>  FEC ,   ,   .  :      ,   ,         .     , ,    —   . <br><img src="https://habrastorage.org/webt/fo/dw/-s/fodw-s_sepjc4qkhonlbr_k-6pq.jpeg"><br>    FEC —  XOR,      , ,  .       ,     -  . <br><br>  <a href="https://tools.ietf.org/html/draft-ietf-payload-flexible-fec-scheme-20"></a>   ,       .     ,        ,     ,     FEC-.  ,   ,         , ,          . <br><br> ,   , <strong>   </strong> .    , : <br><br><ul><li>  90%     500 /. </li><li>    — 3-4,        Mesh  End mixing. </li><li>      —  27  (,  ). </li></ul><br><h2> Check List </h2><br>          : <br><br><ul><li> Packet pacing. </li><li> MTU discovery. </li><li>  Fehlerbehebung </li><li> C    . </li></ul><br>    ,     signalling,   WebRTC,   ,   ,     - . <br><br>       ,     : <br><br><ul><li> <strong>Packet loss:</strong> , packet pacing, FEC,  MTU. </li><li> <strong>   :</strong>    back pressure  ,         FEC-. </li><li> <strong>Jitter</strong>     jitter buffer,     latency. </li><li> <strong>RTT:</strong>   ,      signaling. </li></ul><br><h1>      </h1><br> WebRTC —    .  RTP,        ,    ,   .     WebRTC  . <br><br>    ,   Zoom, Skype  Line,    .      .         . ,    ,     <a href="https://habr.com/ru/company/oleg-bunin/blog/413479/"></a>   UDP- (      ,   WebRTC),   .   ,    ,    . ,    Google STADIA. <br><br> STADIA —   ,       .    WebRTC,  ,     .  Google      WebRTC.     WebRTC     SRTP WebRTC  QUIC.  ,    ,    . <br><br>   QUIC,     .    Chrome  c Android   Google  YouTube,    TCP —  QUIC  UDP  Google.     30%   QUIC/UDP. <br><br>     QUIC     20-30%,  TCP.    - QUIC    ,       . <br><br><h1>  Schlussfolgerungen </h1><br>     ,           .  ,     : signaling; / ;   . ,     ,    . <br><br>     ? <br><br><ul><li>  ,     - ,    . </li><li>       ,    . </li></ul><br>      /     . <br><br>  ,    , — <strong>   </strong> .        ,  latency,  . ,    !   -       :) <br><br><blockquote>    HighLoad++     . <a href="https://www.highload.ru/spb/2020"> </a> (      )   ,  <a href="https://conf.ontico.ru/lectures/propose%3Fconference%3Dhl2020-spb"> </a>   6-7  2020   .    ,   <a href="http://eepurl.com/VYVaf"></a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de479852/">https://habr.com/ru/post/de479852/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de479836/index.html">Die Staatsduma hat Änderungen des Elektrizitätsgesetzes in Bezug auf die Mikroerzeugung verabschiedet. Werden Alternativen glücklich sein?</a></li>
<li><a href="../de479842/index.html">Die Universität von Bata schuf ein elektronisches analoges Neuron</a></li>
<li><a href="../de479844/index.html">Bilden Sie ein Team von UX-Designern und verlieren Sie 7 Millionen durch Einstellungsfehler</a></li>
<li><a href="../de479848/index.html">Unsere im Quadranten 2019! Wie sich der analytische Bericht zu Videokonferenzen von Gartner Meeting Solutions über fünf Jahre geändert hat</a></li>
<li><a href="../de479850/index.html">Installieren Sie Exchange 2019 unter Windows Server Core 2019</a></li>
<li><a href="../de479854/index.html">12. Dezember Morgen Java Digest</a></li>
<li><a href="../de479858/index.html">Auf der Suche nach LD_PRELOAD</a></li>
<li><a href="../de479860/index.html">Eine Variation zum Thema Lebensmodellierung. Teil 2</a></li>
<li><a href="../de479862/index.html">So sparen Sie 15 000 Rubel bei der Registrierung von Software</a></li>
<li><a href="../de479864/index.html">Spiel auf WinForms + C # in 16 Jahren (2 Teil)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>