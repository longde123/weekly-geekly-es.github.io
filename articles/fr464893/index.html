<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö∞ üèõÔ∏è üë©üèø‚Äçüåæ Nous recherchons des bogues dans le code PHP sans analyseurs statiques ü•ï ‚ôøÔ∏è üÜì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ma partie pr√©f√©r√©e dans l'analyse de code statique est de proposer des hypoth√®ses sur les erreurs potentielles dans le code, puis de les v√©rifier. 


...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nous recherchons des bogues dans le code PHP sans analyseurs statiques</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464893/"><p>  Ma partie pr√©f√©r√©e dans l'analyse de code statique est de proposer des hypoth√®ses sur les erreurs potentielles dans le code, puis de les v√©rifier. </p><br><p>  Exemple d'hypoth√®se: </p><br><pre><code class="plaintext hljs"> strpos      .</code> </pre> <br><p>  Mais il est possible que, m√™me sur quelques millions de lignes de code, un tel diagnostic ne "tire" pas, vous ne voulez donc pas passer beaucoup de temps sur des hypoth√®ses infructueuses. </p><br><p>  Aujourd'hui, je vais montrer comment effectuer l'analyse statique la plus simple √† l'aide de l'utilitaire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">phpgrep</a> sans √©crire de code. </p><br><div class="scrollable-table"><table><tbody><tr><td><img src="https://habrastorage.org/webt/ct/6n/nt/ct6nntwmvdgniqe2e625qogapj0.png"></td><td><hr><p>  Sous la coupe: </p><br><ul><li>  Recherche et analyse de bugs dans des projets open source. </li><li>  D√©marrage rapide par phpgrep. </li><li>  Le principe de la recherche syntaxique. </li></ul><br><br><hr></td></tr></tbody></table></div><a name="habracut"></a><br><h1 id="predposylki">  Contexte </h1><br><p>  Depuis plusieurs mois, je supporte le linter PHP NoVerify (lisez-le dans l'article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NoVerify: Linter pour PHP de l'√©quipe VKontakte</a> ). </p><br><p>  De temps en temps, des id√©es de nouveaux diagnostics apparaissent dans l'√©quipe.  Il peut y avoir beaucoup d'id√©es, mais je veux tout v√©rifier, surtout si le contr√¥le propos√© vise √† identifier les d√©fauts critiques. </p><br><p>  Auparavant, je d√©veloppais activement la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">go-critique</a> et la situation √©tait similaire, la seule diff√©rence √©tant que les codes sources √©taient analys√©s en Go, et non en PHP.  Quand j'ai d√©couvert l'utilitaire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gogrep</a> , mon monde a bascul√©.  Comme son nom l'indique, cet utilitaire a quelque chose en commun avec grep, seule la recherche est effectu√©e non pas par des expressions r√©guli√®res, mais par des mod√®les de syntaxe (j'expliquerai plus tard ce que cela signifie). </p><br><p>  Je ne voulais pas vivre sans grep intelligent, alors un soir, j'ai d√©cid√© de m'asseoir et d'√©crire <code>phpgrep</code> . </p><br><h1 id="analiziruemyy-korpus">  Cas analys√© </h1><br><p>  Pour √™tre amusant, on se plonge imm√©diatement dans l'application.  Nous analyserons un petit ensemble de projets PHP assez connus et de grande taille disponibles sur GitHub. </p><br><p>  Notre kit comprenait les projets suivants: </p><br><div class="scrollable-table"><table><tbody><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Wordpress</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Wikia</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Drupal</a> </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">yii2</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CodeIgniter</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">compositeur</a> </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Phalcon</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Joomla!</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Laravel</a> </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">moodle</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">noyau ownCloud</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Phabricator</a> </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Phpunit</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">symfony</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">woocommerce</a> </td></tr></tbody></table></div><br><p>  Pour les personnes qui complotent ce que nous complotons, c'est un ensemble tr√®s app√©tissant. </p><br><p>  Alors allons-y! </p><br><h1 id="ispolzovanie-prisvaivaniya-v-kachestve-vyrazheniya">  Utilisation de l'affectation comme expression </h1><br><p>  Si l'affectation est utilis√©e comme expression, en outre: </p><br><ul><li>  le contexte attend le r√©sultat d'une op√©ration logique (condition logique) et </li><li>  le c√¥t√© droit de l'expression n'a pas d'effets secondaires et est constant, </li></ul><br><p>  c'est tr√®s probablement une erreur dans le code. </p><br><p>  Pour commencer, prenons les constructions suivantes pour le "contexte logique": </p><br><ol><li>  Expression √† l'int√©rieur de " <code>if ($cond)</code> ". </li><li>  La condition de l'op√©rateur ternaire est: " <code>$cond ? $x : $y</code> ". </li><li>  Conditions de continuation pour les boucles " <code>while ($cond)</code> " et " <code>for ($init; $cond; $post)</code> ". </li></ol><br><p>  Sur le c√¥t√© droit de l'affectation, nous attendons des constantes ou des litt√©raux. </p><br><div class="spoiler">  <b class="spoiler_title">Pourquoi avons-nous besoin de telles restrictions?</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><td>  Les deux restrictions sont n√©cessaires pour r√©duire le nombre de faux positifs. <br><br>  Si nous recherchons des affectations exclusivement dans des conditions, alors la probabilit√© qu'il y ait eu une faute de frappe et au lieu de "=" a √©t√© impliqu√©e par "==" est plus √©lev√©e. <br><br>  Mais m√™me dans ce cas, des situations controvers√©es subsistent o√π l'affectation a un sens en raison des effets secondaires qui peuvent se produire au sein d'une fonction.  Afin de ne pas les traiter, nous ne choisirons que les valeurs assign√©es les plus simples. <br></td></tr></tbody></table></div></div></div><br><p>  Commen√ßons par (1): </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#      # |      (  ) # | | # | | phpgrep . 'if ($_ = []) $_' # 1 # | # | #    #  3    . phpgrep . 'if ($_ = ${"const"}) $_' # 2 phpgrep . 'if ($_ = ${"str"}) $_' # 3 phpgrep . 'if ($_ = ${"num"}) $_' # 4</span></span></code> </pre> <br><p>  Ici, nous voyons 4 mod√®les, la seule diff√©rence entre lesquels est l'expression assign√©e (RHS).  Commen√ßons par le premier. </p><br><p>  Le mod√®le " <code>if ($_ = []) $_</code> " capture un <code>if</code> , auquel un tableau vide est affect√© √† n'importe quelle expression.  <code>$_</code> correspond √† n'importe quelle expression ou instruction. </p><br><pre> <code class="plaintext hljs">    (RHS) | if ($_ = []) $_ | | |   if',   ,  {}    LHS  </code> </pre> <br><p>  Les exemples suivants utilisent des groupes <strong>const</strong> , <strong>str</strong> et <strong>num</strong> plus complexes.  Contrairement √† <code>$_</code> ils d√©crivent les restrictions sur les op√©rations compatibles. </p><br><ul><li>  <code>const</code> est une constante nomm√©e ou une constante de classe. </li><li>  <code>str</code> est un litt√©ral de cha√Æne de tout type. </li><li>  <code>num</code> est un litt√©ral num√©rique de tout type. </li></ul><br><p>  Ces sch√©mas suffisent pour r√©aliser plusieurs op√©rations sur le bo√Ætier. </p><br><p>  ‚éÜ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">moodle / blocks / rss_client / viewfeed.php # L37</a> : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($courseid = SITEID) { $courseid = <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><p>  Le deuxi√®me d√©clencheur dans Moodle √©tait la d√©pendance <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ADOdb</a> .  Dans la biblioth√®que en amont, le probl√®me est toujours pr√©sent. </p><br><p>  ‚éÜ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ADOdb / drivers / adodb-odbtp.inc.php # L741</a> : </p><br><p><img src="https://habrastorage.org/webt/uo/mv/wj/uomvwjrpztuhmrkm4lolol9sbvg.png"></p><br><p>  Il y a beaucoup dans ce fragment, mais pour nous seule la premi√®re ligne est pertinente.  Au lieu de comparer le champ <code>databaseType</code> , nous effectuons l'affectation et allons toujours √† l'int√©rieur de la condition. </p><br><p>  Un autre endroit int√©ressant o√π nous voulons effectuer des actions uniquement pour les enregistrements ¬´corrects¬ª, mais au lieu de cela, toujours les ex√©cuter et, en outre, marquer tout enregistrement comme correct! </p><br><p>  ‚éÜ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">moodle / question / format / blackboard_six / formatqti.php # L598</a> : </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// For BB Fill in the Blank, only interested in correct answers. if ($response-&gt;feedback = 'correct') { // ... }</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Liste √©tendue de mod√®les pour cette v√©rification</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><td><pre>  phpgrep.  'pour ($ _; $ _ = []; $ _) $ _'
 phpgrep.  'for ($ _; $ _ = $ {"const"}; $ _) $ _'
 phpgrep.  'pour ($ _; $ _ = $ {"num"}; $ _) $ _'
 phpgrep.  'pour ($ _; $ _ = $ {"str"}; $ _) $ _'
 phpgrep.  'while ($ _ = []) $ _'
 phpgrep.  'while ($ _ = $ {"const"}) $ _'
 phpgrep.  'while ($ _ = $ {"num"}) $ _'
 phpgrep.  'while ($ _ = $ {"str"}) $ _'
 phpgrep.  'if ($ _ = []) $ _'
 phpgrep.  'if ($ _ = $ {"const"}) $ _'
 phpgrep.  'if ($ _ = $ {"str"}) $ _'
 phpgrep.  'if ($ _ = $ {"num"}) $ _'
 phpgrep.  '$ _ = []?  $ _: $ _ '
 phpgrep.  '$ _ = $ {"const"}?  $ _: $ _ '
 phpgrep.  '$ _ = $ {"str"}?  $ _: $ _ '
 phpgrep.  '$ _ = $ {"num"}?  $ _: $ _ '
 phpgrep.  '($ _ = []) &amp;&amp; $ _'
 phpgrep.  '($ _ = $ {"const"}) &amp;&amp; $ _'
 phpgrep.  '($ _ = $ {"str"}) &amp;&amp; $ _'
 phpgrep.  '($ _ = $ {"num"}) &amp;&amp; $ _'
 phpgrep.  '$ _ &amp;&amp; $ _ = []'
 phpgrep.  '$ _ &amp;&amp; $ _ = $ {"const"}'
 phpgrep.  '$ _ &amp;&amp; $ _ = $ {"str"}'
 phpgrep.  '$ _ &amp;&amp; $ _ = $ {"num"}'
 phpgrep.  '($ _ = []) ||  $ _ '
 phpgrep.  '($ _ = $ {"const"}) ||  $ _ '
 phpgrep.  '($ _ = $ {"str"}) ||  $ _ '
 phpgrep.  '($ _ = $ {"num"}) ||  $ _ '
 phpgrep.  ¬´$ _ ||  $ _ = [] '
 phpgrep.  ¬´$ _ ||  $ _ = $ {"const"} '
 phpgrep.  ¬´$ _ ||  $ _ = $ {"str"} '
 phpgrep.  ¬´$ _ ||  $ _ = $ {"num"} ' </pre></td></tr></tbody></table></div></div></div><br><p>  R√©p√©tons ce que nous avons appris: </p><br><ul><li>  Les mod√®les ressemblent au code php qu'ils trouvent. </li><li>  <code>$_</code> repr√©sente tout.  Vous pouvez comparer avec <code>.</code>  dans les expressions r√©guli√®res. </li><li>  <code>${"&lt;class&gt;"}</code> fonctionne comme <code>$_</code> avec une restriction de type d'√©l√©ment AST. </li></ul><br><p>  Il convient √©galement de souligner que tout sauf les variables est mapp√© litt√©ralement.  Cela signifie que le motif " <code>array(1, 2 + 3)</code> " ne sera satisfait que par le code identique dans sa structure syntaxique (les espaces n'affectent pas).  D'un autre c√¥t√©, le mod√®le " <code>array($_, $_)</code> " satisfait tout litt√©ral de tableau √† deux √©l√©ments. </p><br><h1 id="sravnenie-vyrazheniya-s-samim-soboy">  Comparer une expression √† vous-m√™me </h1><br><p>  Le besoin de comparer quelque chose avec soi est tr√®s rare.  Il peut s'agir d'une v√©rification <code>NaN</code> , mais au moins la moiti√© du temps, il s'agit d'une erreur de copier / coller. </p><br><p>  ‚éÜ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Wikia / app / extensions / SemanticDrilldown / inclut / SD_FilterValue.php # L103</a> : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( $fv1-&gt;month == $fv1-&gt;month ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br><p>  √Ä droite devrait √™tre " <code>$fv2-&gt;month</code> ". </p><br><p>  Pour exprimer des parties en double dans un mod√®le, nous utilisons des variables avec des noms autres que " <code>_</code> ".  Le m√©canisme de r√©p√©tition dans un mod√®le est similaire aux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">backlinks</a> dans les expressions r√©guli√®res. </p><br><p>  Le mod√®le " <code>$x == $x</code> " sera exactement ce que trouve l'exemple ci-dessus.  Au lieu de " <code>x</code> ", n'importe quel nom peut √™tre utilis√©.  Il est seulement important que les noms soient identiques.  Les variables de mod√®le qui ont des noms distinctifs n'ont pas besoin d'avoir le m√™me contenu lors de la capture. </p><br><p>  L'exemple suivant a √©t√© trouv√© en utilisant " <code>$x &lt;= $x</code> ". </p><br><p>  ‚éÜ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Drupal / core / modules / views / tests / src / Unit / ViewsDataTest.php # L166</a> : </p><br><pre> <code class="php hljs">$prev = $base_tables[$base_tables_keys[$i - <span class="hljs-number"><span class="hljs-number">1</span></span>]]; $current = $base_tables[$base_tables_keys[$i]]; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertTrue( $prev[<span class="hljs-string"><span class="hljs-string">'weight'</span></span>] &lt;= $current[<span class="hljs-string"><span class="hljs-string">'weight'</span></span>] &amp;&amp; $prev[<span class="hljs-string"><span class="hljs-string">'title'</span></span>] &lt;= $prev[<span class="hljs-string"><span class="hljs-string">'title'</span></span>], <span class="hljs-comment"><span class="hljs-comment">// &lt;--------------  'The tables are sorted as expected.');</span></span></code> </pre> <br><h1 id="dubliruyuschiesya-podvyrazheniya">  Sous-expressions en double </h1><br><p>  Maintenant que nous connaissons les possibilit√©s de sous-expressions r√©p√©t√©es, nous pouvons composer de nombreux motifs int√©ressants. </p><br><p>  Un de mes favoris est " <code>$_ ? $x : $x</code> ". <br>  Il s'agit d'un op√©rateur ternaire avec des branches vraies / fausses identiques. </p><br><p>  ‚éÜ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">joomla-cms / biblioth√®ques / src / User / UserHelper.php # L522</a> : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ($show_encrypt) ? <span class="hljs-string"><span class="hljs-string">'{SHA256}'</span></span> . $encrypted : <span class="hljs-string"><span class="hljs-string">'{SHA256}'</span></span> . $encrypted;</code> </pre> <br><p>  Les deux branches sont dupliqu√©es, ce qui sugg√®re un probl√®me potentiel dans le code.  Si nous regardons le code autour, nous pouvons comprendre ce qui aurait d√ª √™tre √† la place.  Pour des raisons de lisibilit√©, j'ai supprim√© une partie du code et r√©duit le nom de la variable <code>$encrypted</code> √† <code>$enc</code> . </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'crypt-blowfish'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ($show_encrypt ? <span class="hljs-string"><span class="hljs-string">'{crypt}'</span></span> : <span class="hljs-string"><span class="hljs-string">''</span></span>) . crypt($plaintext, $salt); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'md5-base64'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ($show_encrypt) ? <span class="hljs-string"><span class="hljs-string">'{MD5}'</span></span> . $enc : $enc; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'ssha'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ($show_encrypt) ? <span class="hljs-string"><span class="hljs-string">'{SSHA}'</span></span> . $enc : $enc; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'smd5'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ($show_encrypt) ? <span class="hljs-string"><span class="hljs-string">'{SMD5}'</span></span> . $enc : $enc; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'sha256'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ($show_encrypt) ? <span class="hljs-string"><span class="hljs-string">'{SHA256}'</span></span> . $enc : <span class="hljs-string"><span class="hljs-string">'{SHA256}'</span></span> . $enc; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ($show_encrypt) ? <span class="hljs-string"><span class="hljs-string">'{MD5}'</span></span> . $enc : $enc;</code> </pre> <br><p>  Je parierais que le code a besoin du patch suivant: </p><br><pre> <code class="diff hljs"><span class="hljs-deletion"><span class="hljs-deletion">- ($show_encrypt) ? '{SHA256}' . $encrypted : '{SHA256}' . $encrypted; + ($show_encrypt) ? '{SHA256}' . $encrypted : $encrypted;</span></span></code> </pre> <br><h1 id="opasnye-prioritety-operaciy-v-php">  Priorit√©s des op√©rations dangereuses en PHP </h1><br><p>  Une bonne pr√©caution en PHP est l'utilisation de parenth√®ses de regroupement partout o√π il est important d'avoir l'ordre correct des calculs. </p><br><p>  Dans de nombreux langages de programmation, l'expression " <code>x &amp; mask != 0</code> " a une signification intuitive.  Si <code>mask</code> d√©crit un bit, ce code v√©rifie qu'√† <code>x</code> ce bit n'est pas √©gal √† z√©ro.  Malheureusement, pour PHP, cette expression sera calcul√©e comme suit: " <code>x &amp; (mask != 0)</code> ", ce qui n'est presque pas toujours ce dont vous avez besoin. </p><br><p>  WordPress, Joomla et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Moodle</a> utilisent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SimplePie</a> . </p><br><p>  ‚éÜ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SimplePie / library / SimplePie / Locator.php # L254</a> <br>  ‚éÜ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SimplePie / library / SimplePie / Locator.php # L384</a> <br>  ‚éÜ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SimplePie / library / SimplePie / Locator.php # L412</a> <br>  ‚éÜ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SimplePie / library / SimplePie / Sanitize.php # L349</a> <br>  ‚éÜ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SimplePie / library / SimplePie.php # L1634</a> </p><br><pre> <code class="php hljs">$feed-&gt;method &amp; SIMPLEPIE_FILE_SOURCE_REMOTE === <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p>  <code>SIMPLEPIE_FILE_SOURCE_REMOTE</code> d√©fini comme <code>1</code> , donc l'expression sera √©quivalente √†: </p><br><pre> <code class="plaintext hljs">$feed-&gt;method &amp; (1 === 0) // =&gt; $feed-&gt;method &amp; false</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Exemples de mod√®les de recherche</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><td><pre>  phpgrep.  '$ x &amp; $ mask == $ y'
 phpgrep.  '$ x &amp; $ mask === $ y'
 phpgrep.  '$ x &amp; $ mask! == $ y'
 phpgrep.  '$ x &amp; $ mask! = $ y'
 phpgrep.  ¬´$ x |  $ mask == $ y '
 phpgrep.  ¬´$ x |  $ mask === $ y '
 phpgrep.  ¬´$ x |  $ mask! == $ y '
 phpgrep.  ¬´$ x |  $ mask! = $ y ' </pre></td></tr></tbody></table></div></div></div><br><p>  Poursuivant le sujet des priorit√©s d'op√©rations inattendues, vous pouvez lire sur l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">op√©rateur ternaire en PHP</a> .  Le habr m√™me l'article lui √©tait consacr√©: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'ordre d'ex√©cution de l'op√©rateur ternaire</a> . </p><br><p>  Est-il possible de trouver de tels endroits avec <code>phpgrep</code> ?  La r√©ponse est <strong>oui</strong> ! </p><br><pre> <code class="bash hljs">phpgrep . <span class="hljs-string"><span class="hljs-string">'$_ == $_ ? $_ : $_ ? $_ : $_'</span></span> phpgrep . <span class="hljs-string"><span class="hljs-string">'$_ != $_ ? $_ : $_ ? $_ : $_'</span></span></code> </pre> <br><h1 id="prelesti-proverki-url-s-pomoschyu-regulyarnyh-vyrazheniy">  Les avantages de la validation des expressions r√©guli√®res </h1><br><p>  ‚éÜ <a href="">Wikia / app / maintenance / wikia / updateCentralInterwiki.inc # L95</a> : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( preg_match( <span class="hljs-string"><span class="hljs-string">'/(wowwiki.com|wikia.com|falloutvault.com)/'</span></span>, $url ) ) { $local = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $local = <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><p>  Comme con√ßu par l'auteur du code, nous v√©rifions la co√Øncidence de l'URL avec l'une des 3 options.  D√©sol√© symbole <code>.</code>  non blind√©, ce qui entra√Ænera le fait qu'au lieu de <code>falloutvault.com</code> nous pouvons obtenir <code>falloutvaultxcom</code> sur n'importe quel domaine et passer le test. </p><br><p><img src="https://habrastorage.org/webt/n7/sj/pc/n7sjpcnsabhg5ggan7tiscxy0q4.png"></p><br><p>  Ce n'est pas une erreur sp√©cifique √† PHP.  Dans toute application o√π la validation est effectu√©e via des expressions r√©guli√®res et o√π un m√©ta-caract√®re fait partie de la cha√Æne en cours de v√©rification, il existe un risque d'oublier l'√©chappement l√† o√π il est n√©cessaire et d'obtenir une vuln√©rabilit√©. </p><br><p>  Vous pouvez trouver de tels endroits en ex√©cutant <code>phpgrep</code> : </p><br><pre> <code class="bash hljs">phpgrep . <span class="hljs-string"><span class="hljs-string">'preg_match(${"pat:str"}, ${"*"})'</span></span> <span class="hljs-string"><span class="hljs-string">'pat~[^\\]\.(com|ru|net|org)\b'</span></span></code> </pre> <br><p>  Nous introduisons le sous-mod√®le nomm√© <code>pat</code> , qui capture n'importe quel litt√©ral de cha√Æne, puis lui appliquons un filtre √† partir de l'expression r√©guli√®re. </p><br><p>  Les filtres peuvent √™tre appliqu√©s √† n'importe quelle variable de mod√®le.  En plus des expressions r√©guli√®res, il existe √©galement des op√©rateurs structurels <code>=</code> et <code>!=</code> .  Une liste compl√®te se trouve dans la <a href="">documentation</a> . </p><br><p>  <code>${"*"}</code> capture un nombre arbitraire d'arguments, nous n'avons donc pas √† nous soucier des param√®tres facultatifs de la fonction <code>preg_match</code> . </p><br><h1 id="dublikaty-klyuchey-v-literale-massiva">  Cl√©s en double dans le tableau litt√©ral </h1><br><p>  En PHP, vous ne recevrez aucun avertissement si vous ex√©cutez ce code: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> var_dump([<span class="hljs-string"><span class="hljs-string">'a'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'a'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>]); <span class="hljs-comment"><span class="hljs-comment">// : array(1) {["a"]=&gt; int(2)}</span></span></code> </pre> <br><p>  Nous pouvons trouver de tels tableaux en utilisant <code>phpgrep</code> : </p><br><pre> <code class="plaintext hljs">[${"*"}, $k =&gt; $_, ${"*"}, $k =&gt; $_, ${"*"}]</code> </pre> <br><p>  Ce mod√®le peut √™tre d√©crypt√© comme suit: "un litt√©ral de tableau dans lequel il y a au moins deux cl√©s identiques dans une position arbitraire."  Les expressions <code>${"*"}</code> nous aident √† d√©crire une "position arbitraire", permettant des √©l√©ments 0-N avant, entre et apr√®s les cl√©s qui nous int√©ressent. </p><br><p>  ‚éÜ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Wikia / app / extensions / wikia / WikiaMiniUpload / WikiaMiniUpload_body.php # L23</a> : </p><br><pre> <code class="php hljs">$script_a = [ <span class="hljs-string"><span class="hljs-string">'wmu_back'</span></span> =&gt; wfMessage( <span class="hljs-string"><span class="hljs-string">'wmu_back'</span></span> )-&gt;escaped(), <span class="hljs-string"><span class="hljs-string">'wmu_back'</span></span> =&gt; wfMessage( <span class="hljs-string"><span class="hljs-string">'wmu_back'</span></span> )-&gt;escaped(), <span class="hljs-comment"><span class="hljs-comment">// ... ];</span></span></code> </pre> <br><p>  Dans ce cas, ce n'est pas une erreur grossi√®re, mais je connais des cas o√π la duplication de cl√©s dans de grands tableaux (100+ √©l√©ments) comportait au moins un comportement inattendu dans lequel l'une des cl√©s chevauchait la valeur de l'autre. </p><br><hr><br><p>  Ceci conclut notre br√®ve excursion avec des exemples.  Si vous en voulez plus, √† la fin de l'article d√©crit comment obtenir tous les r√©sultats. </p><br><h1 id="chto-zhe-takoe-phpgrep">  Qu'est-ce que phpgrep? </h1><br><p>  La plupart des √©diteurs et des IDE utilisent la recherche en texte brut pour rechercher le code (s'il ne s'agit pas de rechercher un caract√®re sp√©cial tel qu'une classe ou une variable) - en d'autres termes, quelque chose comme grep. </p><br><p>  Vous entrez " <code>$x</code> ", recherchez " <code>$x</code> ".  Des expressions r√©guli√®res peuvent √™tre disponibles pour vous, alors vous pouvez r√©ellement essayer d'analyser le code PHP avec des habitu√©s.  Parfois, cela fonctionne m√™me si vous recherchez quelque chose d'assez sp√©cifique et simple - par exemple, "n'importe quelle variable avec un suffixe".  Mais si cette variable avec un suffixe doit faire partie d'une autre expression compos√©e, des difficult√©s surviennent. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">phpgrep</a> est un outil de recherche pratique de code PHP, qui vous permet de rechercher non pas √† l'aide de r√©guliers orient√©s texte, mais √† l'aide de mod√®les compatibles avec la syntaxe. </p><br><p>  La syntaxe signifie que la langue du mod√®le refl√®te la langue cible et ne fonctionne pas sur les caract√®res individuels, comme le font les expressions r√©guli√®res.  Nous ne faisons √©galement aucune diff√©rence avant de formater le code, seule sa structure est importante. </p><br><div class="spoiler">  <b class="spoiler_title">Contenu optionnel: d√©marrage rapide</b> <div class="spoiler_text"><h1 id="quick-start">  D√©marrage rapide </h1><br><h3 id="ustanovka">  L'installation </h3><br><p>  Il existe des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">versions</a> pr√™tes √† l'emploi pour amd64 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pour Linux et Windows</a> , mais si vous avez install√© Go, une seule commande suffit pour obtenir un nouveau binaire pour votre plate-forme: </p><br><pre> <code class="bash hljs">go get -v github.com/quasilyte/phpgrep/cmd/phpgrep</code> </pre> <br><p>  Si <code>$GOPATH/bin</code> est dans le syst√®me <code>$PATH</code> , la commande <code>phpgrep</code> deviendra imm√©diatement disponible.  Pour v√©rifier cela, essayez d'ex√©cuter la commande avec le param√®tre <code>-help</code> : </p><br><pre> <code class="bash hljs">phpgrep -<span class="hljs-built_in"><span class="hljs-built_in">help</span></span></code> </pre> <br><p>  Si rien ne se passe, trouvez o√π Go a install√© le binaire et ajoutez-le √† la variable d'environnement <code>$PATH</code> . </p><br><p>  Une mani√®re ancienne et fiable de regarder <code>$GOPATH</code> , m√™me si elle n'est pas d√©finie explicitement: </p><br><pre> <code class="bash hljs">go env GOPATH</code> </pre> <br><h3 id="ispolzovanie">  Utiliser </h3><br><p>  Cr√©ez un fichier test <code>hello.php</code> : </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...$xs)</span></span></span><span class="hljs-function"> </span></span>{} f(<span class="hljs-number"><span class="hljs-number">10</span></span>); f(<span class="hljs-number"><span class="hljs-number">20</span></span>); f(<span class="hljs-number"><span class="hljs-number">30</span></span>); f($x); f();</code> </pre> <br><p>  Ex√©cutez <code>phpgrep</code> dessus: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># phpgrep hello.php 'f(${"x:int"})' 'x!=20' hello.php:3: f(10) hello.php:5: f(30)</span></span></code> </pre> <br><p>  Nous avons trouv√© tous les appels √† la fonction <code>f</code> avec un argument, un nombre dont la valeur n'est pas √©gale √† 20. </p></div></div><br><h1 id="kak-rabotaet-phpgrep">  Comment phpgrep fonctionne </h1><br><p>  Pour analyser PHP, la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/z7zmey/php-parser</a> est utilis√©e.  C'est assez bon, mais certaines des limitations de <code>phpgrep</code> d√©coulent des fonctionnalit√©s de l'analyseur utilis√©.  En particulier, de nombreuses difficult√©s surviennent lorsque vous essayez de travailler normalement avec des supports. </p><br><p>  Le principe de <code>phpgrep</code> est simple: </p><br><ul><li>  AST est construit √† partir du mod√®le d'entr√©e, les filtres sont d√©mont√©s; </li><li>  pour chaque fichier d'entr√©e, un arbre AST complet est construit; </li><li>  nous faisons le tour de l'AST de chaque fichier, essayant de trouver de tels sous-arbres qui correspondent au mod√®le; </li><li>  pour chaque r√©sultat, une liste de filtres est appliqu√©e; </li><li>  tous les r√©sultats qui ont r√©ussi les filtres sont imprim√©s √† l'√©cran. </li></ul><br><p>  Le plus int√©ressant est de savoir comment exactement les deux n≈ìuds AST sont appari√©s pour l'√©galit√©.  Parfois trivial: un √† un et les m√©ta-n≈ìuds peuvent capturer plus d'un √©l√©ment.  Des exemples de m√©ta n≈ìuds sont <code>${"*"}</code> et <code>${"str"}</code> . </p><br><h1 id="zaklyuchenie">  Conclusion </h1><br><p>  Il serait malhonn√™te de parler de <code>phpgrep</code> sans mentionner la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">recherche structurelle et le remplacement</a> (SSR) de PhpStorm.  Ils r√©solvent des probl√®mes similaires, et le SSR a ses avantages, par exemple, l'int√©gration dans l'IDE, et <code>phpgrep</code> vante d'√™tre un programme autonome, qui est beaucoup plus facile √† mettre, par exemple, sur CI. </p><br><p>  Entre autres choses, <code>phpgrep</code> est √©galement une biblioth√®que que vous pouvez utiliser dans vos programmes pour faire correspondre le code PHP.  Ceci est particuli√®rement utile pour le linter et la g√©n√©ration de code. </p><br><p>  Je serai heureux si cet outil vous est utile.  Si cet article vous motive simplement √† regarder dans la direction du SSR susmentionn√©, c'est aussi bien. </p><br><img src="https://habrastorage.org/webt/o_/9a/cz/o_9aczasnsf3wssmuunol5lyjfe.png"><br><br><h1 id="dopolnitelnye-materialy">  Mat√©riel suppl√©mentaire </h1><br><p>  La liste compl√®te des mod√®les utilis√©s pour l'analyse se trouve dans le fichier <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">patterns.txt</a> .  √Ä c√¥t√© de ce fichier, vous pouvez trouver le script <code>phpgrep-lint.sh</code> , qui simplifie le lancement de <code>phpgrep</code> avec une liste de mod√®les. </p><br><p>  L'article ne fournit pas une liste compl√®te des r√©ponses, mais vous pouvez reproduire l'exp√©rience en clonant tous les r√©f√©rentiels nomm√©s et en ex√©cutant <code>phpgrep-lint.sh</code> sur eux. </p><br><p>  Vous pouvez vous inspirer des mod√®les de test, par exemple, des articles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PVS studio</a> .  J'ai vraiment aim√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Logical Expressions: Mistakes Made by Professionals</a> , qui se transforme en quelque chose comme ceci: </p><br><pre> <code class="plaintext hljs">#  "x != y || x != z": phpgrep . '$x != $a || $x != $b' phpgrep . '$x !== $a || $x != $b' phpgrep . '$x != $a || $x !== $b' phpgrep . '$x !== $a || $x !== $b'</code> </pre> <br><p>  Vous pouvez √©galement √™tre int√©ress√© par la pr√©sentation de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">phpgrep: recherche de code sensible √† la syntaxe</a> . </p><br><blockquote>  L'article utilise des images de gophers qui ont √©t√© cr√©√©es via <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gopherkon</a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr464893/">https://habr.com/ru/post/fr464893/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr464877/index.html">Nouvelles du monde d'OpenStreetMap n ¬∞ 473 (08/06/2019 - 12/08/2019)</a></li>
<li><a href="../fr464881/index.html">Personnalisation de la composition des tests JUnit5 avec application.properties</a></li>
<li><a href="../fr464883/index.html">Vers o√π se dirige le r√©seau</a></li>
<li><a href="../fr464887/index.html">Quelques erreurs courantes dans Vue.js (Vuex)</a></li>
<li><a href="../fr464889/index.html">Retour vers le futur des t√©l√©phones portables</a></li>
<li><a href="../fr464895/index.html">Pourquoi Isra√´l est le moteur du d√©veloppement de la technologie automobile</a></li>
<li><a href="../fr464897/index.html">Vous construisez XPath? XPath algorithmique? Rien que XPath</a></li>
<li><a href="../fr464899/index.html">L'effondrement d'une ville du Texas qui a manqu√© de l'argent d'une ferme de bitcoins</a></li>
<li><a href="../fr464901/index.html">D√©veloppement du Helpdesk</a></li>
<li><a href="../fr464909/index.html">¬´Ils nous regardent¬ª: ce qui peut arriver dans une mini-fourgonnette discr√®te juste sous votre fen√™tre</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>