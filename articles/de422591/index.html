<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñäÔ∏è ü§ë üõï Anomalie der Corona SDK json-Bibliothek ü§∂ üë∑üèº üí´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo an alle. Es ist f√ºr niemanden ein Geheimnis, dass die Verwendung von json in Ihren Projekten im Corona SDK einige Dinge recht bequem machen kann...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Anomalie der Corona SDK json-Bibliothek</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422591/">  Hallo an alle.  Es ist f√ºr niemanden ein Geheimnis, dass die Verwendung von json in Ihren Projekten im Corona SDK einige Dinge recht bequem machen kann.  Ich fand eine interessante Anomalie bei der Arbeit mit der Bibliothek, die sich in der Praxis als kein Fehler herausgestellt hat, sondern eine Funktion, die Sie kennen und auf die Sie vorbereitet sein sollten.  Lassen Sie uns alles im Detail betrachten. <a name="habracut"></a><br><br><h3>  1. Beschreibung des Problems </h3><br>  Angenommen, wir haben ein Lua-Array, das so aussieht: <br><br><pre><code class="lua hljs">ar = {<span class="hljs-number"><span class="hljs-number">23</span></span>,<span class="hljs-number"><span class="hljs-number">45</span></span>,<span class="hljs-number"><span class="hljs-number">56</span></span>,<span class="hljs-string"><span class="hljs-string">'weer'</span></span>}</code> </pre> <br>  Wenn Sie alles normale mit einem Verst√§ndnis der Sprache haben, wird Ihnen dieses Array wie unten gezeigt pr√§sentiert, nur aufgrund der Umst√§nde fettarm - SO M√ñGLICH: <br><br><pre> <code class="lua hljs">ar = {[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">23</span></span>,[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-number"><span class="hljs-number">45</span></span>,[<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-number"><span class="hljs-number">56</span></span>,[<span class="hljs-number"><span class="hljs-number">4</span></span>] = <span class="hljs-string"><span class="hljs-string">'weer'</span></span>}</code> </pre> <br>  Wenn Sie sich entscheiden, dieses Array in json zu konvertieren, erhalten Sie √ºber die Ausgabe Folgendes (nat√ºrlich vergessen wir nicht, die json-Bibliothek anzuschlie√üen): <br><br><pre> <code class="lua hljs">ar = {[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">23</span></span>,[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-number"><span class="hljs-number">45</span></span>,[<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-number"><span class="hljs-number">56</span></span>,[<span class="hljs-number"><span class="hljs-number">4</span></span>] = <span class="hljs-string"><span class="hljs-string">'weer'</span></span>} json = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">"json"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> str = json.encode(ar) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(str)<span class="hljs-comment"><span class="hljs-comment">--&gt; [23,45,56,"weer"]</span></span></code> </pre><br>  Wie Sie sehen k√∂nnen, wei√ü json auch √ºber die Existenz dieser Art von vereinfachtem Datensatz Bescheid, bei dem die Elemente des Arrays, wenn sie fortlaufend angeordnet werden, nicht explizit nummeriert werden. Dies ist wunderbar, da wir json in unseren Projekten h√§ufig f√ºr das Netzwerkprotokoll oder zum Speichern in einer Datei verwenden und die zus√§tzliche Gr√∂√üe vollst√§ndig ist wozu. <br><br>  Versuchen wir nun, den Drain wieder in eine Lua-Tabelle umzuwandeln und seinen Inhalt anzuzeigen, wobei wir auf die Datentypen der Schl√ºssel achten: <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> str = <span class="hljs-string"><span class="hljs-string">'[23,45,56,"weer"]'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> ar2 = json.decode(str) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k,v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>(ar2)<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(k,<span class="hljs-built_in"><span class="hljs-built_in">type</span></span>(k),v) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-comment"><span class="hljs-comment">--[[ 1 number 23 2 number 45 3 number 56 4 number weer ]]</span></span></code> </pre> <br>  Wie Sie sehen k√∂nnen, ist das Ergebnis mehr als erwartet, die Tabelle ar am Eingang entspricht vollst√§ndig der Tabelle ar2 am Ausgang.  Nachdem wir nun den vorherigen 2 Punkten gefolgt sind, aber gleichzeitig ein Array vorhanden ist, in dem sich eine unterbrochene Sequenz im Array befindet, f√ºgen wir den Schl√ºssel 6 (unter Umgehung von 5) mit dem Wert 'wtf' hinzu.  Wir brechen. <br><br><pre> <code class="lua hljs">json = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">"json"</span></span> ar = {<span class="hljs-number"><span class="hljs-number">23</span></span>,<span class="hljs-number"><span class="hljs-number">45</span></span>,<span class="hljs-number"><span class="hljs-number">56</span></span>,<span class="hljs-string"><span class="hljs-string">'weer'</span></span>,[<span class="hljs-number"><span class="hljs-number">6</span></span>] = <span class="hljs-string"><span class="hljs-string">'wtf'</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> str = json.encode(ar) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(str)<span class="hljs-comment"><span class="hljs-comment">--&gt;[23,45,56,"weer",null,"wtf"] local t = json.decode(str) for k,v in pairs(t)do print(k,type(k),v) end --[[ 1 number 23 2 number 45 3 number 56 4 number weer 6 number wtf ]]</span></span></code> </pre> <br>  Wie Sie sehen k√∂nnen, hat sich alles wieder als gro√üartig erwiesen, da json.encode diesen Fang erwartet hat und anstelle eines nicht vorhandenen 5-Schl√ºssels null eingef√ºgt wurde und dies alles mit Erfolg endete. Wir werden hier nicht aufh√∂ren und dem Array einen weiteren 777-Schl√ºssel mit dem Wert 1 hinzuf√ºgen, was wir h√∂chstwahrscheinlich erwarten dass die Tabelle auf die gleiche Weise konvertiert wird und 770 null enth√§lt - dies ist sicherlich nicht die beste Option, da sie viel mehr Platz beansprucht, aber es gibt einfach keine andere M√∂glichkeit in json, ein vollst√§ndiges Analogon dieser lua-Tabelle zu erstellen, da der Schl√ºssel nicht in json ist kann klar sein  vlen als Zahl.  Wir schauen uns an, was passiert ist. <br><br><pre> <code class="lua hljs">json = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">"json"</span></span> ar = {<span class="hljs-number"><span class="hljs-number">23</span></span>,<span class="hljs-number"><span class="hljs-number">45</span></span>,<span class="hljs-number"><span class="hljs-number">56</span></span>,<span class="hljs-string"><span class="hljs-string">'weer'</span></span>,[<span class="hljs-number"><span class="hljs-number">6</span></span>] = <span class="hljs-string"><span class="hljs-string">'wtf'</span></span>,[<span class="hljs-number"><span class="hljs-number">777</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> str = json.encode(ar) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(str)<span class="hljs-comment"><span class="hljs-comment">--&gt;{"1":23,"2":45,"3":56,"4":"weer","6":"wtf","777":1} local t = json.decode(str) for k,v in pairs(t)do print(k,type(k),v) end --[[ 1 string 23 777 string 1 3 string 56 2 string 45 4 string weer 6 string wtf ]]</span></span></code> </pre> <br>  Wie Sie sehen k√∂nnen, ging der Encoder in die andere Richtung und konvertierte alle Schl√ºssel mit der Werttypnummer in eine Zeichenfolge.  Es ist kein Geheimnis, dass eine solche Funktion zu Fehlern f√ºhren kann und wird (wenn Sie nichts davon wissen) oder zu Kr√ºcken, die bei der Arbeit mit dieser Tabelle explizite Tonumber / Tstring-Transformationen verwenden. Dies wird auf keinen Fall viel Freude bereiten.  √úberlegen Sie, wie Sie damit umgehen sollen. <br><br><h3>  2. das Problem l√∂sen </h3><br>  Um dieses Problem zu l√∂sen, k√∂nnen Sie eine Funktion schreiben, die alle Arrays initialisiert, in denen das Problem aufgetreten ist. Dann m√ºssen Sie sich im Code st√§ndig an dieses Problem erinnern und diese Funktion √ºberall anwenden. Dies ist ein normaler Weg, aber nicht der beste, und daher gibt es Plan B. Definieren Sie die Implementierung der Funktion json.decode neu, sodass alle Problembereiche automatisch konvertiert werden. Diese L√∂sung funktioniert sowohl beim ersten Verschachteln im √ºbergebenen Array als auch bei tieferen Anh√§ngen.  Wir werden den Funktionswert direkt nach dem Verbinden der json-Bibliothek mit dem Projekt neu definieren.  Die folgende Implementierung ist verf√ºgbar: <br><br><pre> <code class="lua hljs">json = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">"json"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> jd = json.decode<span class="hljs-comment"><span class="hljs-comment">--   local norm_ar json.decode = function(ar,not_convert)--  local res = jd(ar) --     --    norm_ar = function(root) local res = {} --  for k,v in pairs(root)do res[k] = v end --   for k,v in pairs(res) do if type(k) == 'string' and--  string.match(tostring(k),'%D') == nil then--    -- string -&gt; number root[tonumber(k)] = root[k] root[k] = nil--   end --      if type(v) == 'table' then norm_ar(v) end end return root end --   not_convert    return not_convert and res or norm_ar(res) end</span></span></code> </pre> <br>  Versuchen Sie nun erneut, den vorherigen Vorgang auszuf√ºhren: <br><br><pre> <code class="lua hljs">ar = {<span class="hljs-number"><span class="hljs-number">23</span></span>,<span class="hljs-number"><span class="hljs-number">45</span></span>,<span class="hljs-number"><span class="hljs-number">56</span></span>,<span class="hljs-string"><span class="hljs-string">'weer'</span></span>,[<span class="hljs-number"><span class="hljs-number">6</span></span>] = <span class="hljs-string"><span class="hljs-string">'wtf'</span></span>,[<span class="hljs-number"><span class="hljs-number">777</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> str = json.encode(ar) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(str)<span class="hljs-comment"><span class="hljs-comment">--&gt;{"1":23,"2":45,"3":56,"4":"weer","6":"wtf","777":1} local t = json.decode(str) for k,v in pairs(t)do print(k,type(k),v) end --[[ 1 number 23 2 number 45 3 number 56 4 number weer 6 number wtf 777 number 1 --]]</span></span></code> </pre> <br>  Wie Sie sehen k√∂nnen, hat alles funktioniert und das Array hat seine fr√ºhere Struktur beibehalten.  Zuletzt m√∂chte ich hinzuf√ºgen, dass die neue Implementierungsoption json.decode einen zweiten optionalen Parameter unterst√ºtzt, der die Konvertierung deaktiviert, wenn Sie diese Konvertierung aus irgendeinem Grund vermeiden m√ºssen. <br><br>  Tsch√ºss alle! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de422591/">https://habr.com/ru/post/de422591/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de422581/index.html">Quantenschalter nach Schr√∂dinger</a></li>
<li><a href="../de422583/index.html">Tough Middling: Snom D735 IP-Telefon Bewertung</a></li>
<li><a href="../de422585/index.html">Die praktische Verwendung neuronaler Netze</a></li>
<li><a href="../de422587/index.html">Vorbereitung und Weitergabe von IELTS: pers√∂nliche Erfahrung</a></li>
<li><a href="../de422589/index.html">Umgang mit schmutzigen Nebenwirkungen in reinem, funktionalem JavaScript-Code</a></li>
<li><a href="../de422593/index.html">Verstecke dich ohne dich zu verstecken. Noch einmal √ºber LSB-Steganographie, Chi-Quadrat und ... Singularit√§t?</a></li>
<li><a href="../de422595/index.html">Russische Wissenschaftler haben einen Motor f√ºr Cubesat mit einer 40% igen Alkoholl√∂sung entwickelt</a></li>
<li><a href="../de422597/index.html">Backend United # 2: F√ºllung</a></li>
<li><a href="../de422601/index.html">Chrome 69 verf√ºgt √ºber einen Zufallskennwortgenerator</a></li>
<li><a href="../de422603/index.html">Ein bisschen n√§her an der Perfektion</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>