<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â›³ï¸ ğŸ§™ğŸ» ğŸ“» Nightmare of the "Knight": sebuah cerita instruktif tentang DevOps ğŸ‘¨ğŸ¾â€ğŸŒ¾ ğŸ§’ğŸ¼ ğŸš </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1066, lebih dari 200 tahun telah berlalu sejak awal invasi Viking ke Inggris. Raja Harold, mengumpulkan detasemen ksatria, berbaris ke Sungai Derwent ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nightmare of the "Knight": sebuah cerita instruktif tentang DevOps</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/moex/blog/458304/"><img src="https://habrastorage.org/webt/im/2a/ct/im2actpwxzvrz1_j4k-2easujdy.jpeg"><br><br>  1066, lebih dari 200 tahun telah berlalu sejak awal invasi Viking ke Inggris.  Raja Harold, mengumpulkan detasemen ksatria, berbaris ke Sungai Derwent untuk pertempuran yang menentukan dengan pasukan senama - raja Norwegia Harald.  Para pembuat senjata bekerja selama satu bulan untuk menempa baju besi generasi baru yang cukup yang dapat melindungi ksatria agar tidak terkena kapak Skandinavia.  Dan berapa banyak percobaan dan uji coba dalam turnamen sebelumnya!  Tapi harapan itu seharusnya bisa dibenarkan sendiri - peralatan yang ringan, tetapi dapat diandalkan, bahkan dengan berjalan kaki, tanpa kerugian besar, untuk membubarkan Viking hird.  Dan akhirnya, mereka bertemu di Stamford Bridge.  Detasemen utama para ksatria, yang dipimpin oleh seorang komandan berbaju zirah, bentrok di tengah jembatan dengan musuh.  Ya, baja master podgorny menahan pukulan! <br><br>  Perlahan tapi pasti, orang-orang Viking bergerak ke pertahanan round-robin.  Kemenangan tampaknya sudah dekat.  Dan akhirnya, di medan perang, komandan ksatria dan jarl Norwegia menemukan satu sama lain. <br><a name="habracut"></a><br>  Kapak jarl dua tangan sudah rusak dan dia terpaksa membela diri dengan Saxon biasa, yang tidak bisa dibandingkan dengan seorang ksatria dan setengah pedang.  Gelombang dengan belati - untuk baju besi komandan itu seperti pisau lipat, tetapi melewati baju besi dan ... tampaknya sihir telah ikut berperan - baju besi dari para ksatria tetangga tersebar!  Gelombang lain, lagi tepat sasaran, dan sekarang di ksatria di sisi kiri baju zirah itu tiba-tiba menyala merah-panas.  Pukulan ketiga - para ksatria berenang di depan mata mereka, mereka tersandung, jatuh, dan tidak pernah bangkit lagi. <br><br>  "*** ** **** ****!"  Teriak Petrovich, bangun jam 5 pagi pada hari Senin dalam keringat dingin.  Segalanya berjalan salah: pada jam 11 malam ia naik ke Wikipedia untuk mencari bahan-bahan untuk laporan anak tentang sifat tundra, tetapi pada malam hari ia entah bagaimana menemukan dirinya dalam deskripsi invasi Viking di Inggris.  Dan juga, pada akhir pekan mereka mengadakan pertempuran rilis berikutnya, yang harus dimulai hari ini.  Seperti biasa, kami mengujinya untuk waktu yang lama dan tuntas, mengendarainya melalui sistem integrasi berkelanjutan jutaan kali, apakah semuanya berjalan lancar ... <br><br>  Untungnya bagi sebagian orang, tetapi sayangnya bagi para korban, selalu ada kesempatan untuk belajar dari kesalahan orang lain, untuk memperbaiki sesuatu di rumah dan mendapatkan porsi ekstra kepercayaan diri.  Dengan artikel yang diterjemahkan ini kami ingin sekali lagi, secara lebih rinci, mengingat salah satu kasus di industri "kami". <br><br><hr><br>  Tahun lalu di konferensi saya berbicara tentang DevOps, konfigurasi sebagai kode, dan pengiriman berkelanjutan.  Menggunakan kisah di bawah ini, saya menjelaskan pentingnya menciptakan penyebaran yang sepenuhnya otomatis dan dapat direproduksi sebagai bagian dari inisiatif DevOps / Continuous Delivery.  Setelah konferensi, beberapa orang meminta saya untuk berbagi cerita di blog.  Ini adalah kisah yang benar-benar benar.  Ini menceritakan kembali apa yang saya baca, saya sendiri tidak berpartisipasi dalam ini. <br><br>  Jadi, kisah tentang bagaimana sebuah perusahaan dengan aset hampir $ 400 juta bangkrut dalam 45 menit karena penyebaran yang tidak berhasil. <br><br><h1>  Sedikit latar belakang </h1><br>  Knight Capital Group ("Knight" dalam bahasa Inggris berarti "knight") adalah perusahaan keuangan global Amerika yang bergerak di bidang pembuatan pasar, eksekusi elektronik, penjualan institusi, dan perdagangan.  Pada 2012, Knight adalah pedagang saham AS terbesar dengan pangsa pasar sekitar 17% di NYSE dan NASDAQ.  Grup Perdagangan Elektronik Knight (ETG) mengelola volume perdagangan harian rata-rata lebih dari 3,3 miliar transaksi per hari, diperdagangkan di atas $ 21 miliar ... per hari.  Ini bukan lelucon! <br><br>  Pada tanggal 31 Juli 2012, Knight memiliki sekitar $ 365 juta dalam bentuk tunai dan setara kas. <br><br>  Pada 1 Agustus 2012, NYSE berencana untuk meluncurkan program likuiditas ritel baru, Program Liquidity Ritel (program yang dirancang untuk meningkatkan harga bagi investor ritel melalui broker ritel seperti Knight).  Dalam persiapan untuk acara ini, Knight memperbarui SMARS router algoritmik mereka yang otomatis dan berkecepatan tinggi, yang mengirimkan aplikasi ke pasar untuk dieksekusi.  Salah satu fungsi utama SMARS adalah untuk menerima aplikasi dari komponen lain dari platform perdagangan Knights (aplikasi "induk"), diikuti dengan mengirim satu atau lebih aplikasi "anak" untuk dieksekusi.  Dengan kata lain, SMARS akan menerima pesanan dalam jumlah besar dari platform perdagangan dan memecahnya menjadi beberapa yang kecil untuk menemukan pembeli / penjual untuk saham.  Semakin besar aplikasi induk, semakin banyak aplikasi anak akan dibuat. <br><br>  Pembaruan SMARS seharusnya menggantikan kode lama yang tidak terpakai yang disebut "Power Peg" - fungsi yang sudah tidak digunakan Knight selama 8 tahun (mengapa kode yang mati begitu lama masih dalam basis kode adalah sebuah misteri, tetapi ini bukan yang utama).  Kode yang diperbarui menetapkan ulang flag lama yang digunakan untuk mengaktifkan fungsionalitas Power Peg.  Kode diuji secara menyeluruh, bekerja dengan benar, dan dapat diandalkan.  Apa yang salah? <br><br><h1>  Apa yang salah?  Dan sungguh! </h1><br>  Antara 27 Juli 2012 dan 31 Juli 2012, Knight secara manual menggunakan perangkat lunak baru pada sejumlah server per hari - total delapan (8) server.  Inilah yang dikatakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumen SEC</a> tentang penyebaran manual (SEC adalah Komisi Sekuritas dan Pertukaran, regulator pasar saham Amerika). <br><br><blockquote>  â€œSelama penyebaran kode baru, salah satu karyawan Knight tidak menyalin kode baru ke salah satu dari delapan server SMARS.  Knight tidak melakukan tinjauan teknis kedua dari penyebaran ini, jadi kode Power Peg tidak dihapus dari server kedelapan, dan kode RLP baru tidak ditambahkan.  Perusahaan tidak memiliki prosedur yang memerlukan pemeriksaan ulang. â€  Rilis No. 70694, 16 Oktober 2013 </blockquote><br>  Pada 1 Agustus 2012 pukul 9:30 EST, pasar dibuka, dan Knight mulai memproses permintaan dari pialang-dealer atas nama pelanggannya dalam Program Liquidity Ritel yang baru.  Tujuh (7) server yang digunakan dengan benar mulai memproses aplikasi dengan benar.  Dan aplikasi yang masuk ke server kedelapan mungkin mengaktifkan bendera yang diubah dan membangkitkan Power Peg. <br><br><h1>  Serangan Zombie: Kode Pembunuh </h1><br>  Di sini Anda perlu menjelaskan mengapa kode Power Peg "mati" diperlukan.  Fungsi ini dimaksudkan untuk menghitung saham yang dibeli / dijual berdasarkan permintaan orang tua saat pesanan anak selesai.  Setelah aplikasi induk dijalankan, Power Peg melarang pengajuan aplikasi anak.  Pada prinsipnya, Power Peg akan melacak pesanan anak dan menghentikan eksekusi setelah pemrosesan aplikasi induk.  Pada tahun 2005, Knight mengembalikan fungsionalitas pelacakan kumulatif ini ke tahap awal eksekusi kode (sehingga menghapus pelacakan kuantitas dari Power Peg). <br><br>  Ketika bendera Power Peg di server kedelapan diaktifkan, Power Peg mulai merutekan pesanan anak untuk dieksekusi, tetapi tidak menghubungkannya dengan jumlah saham dalam urutan induk - semacam loop tertutup muncul <br><br><h1>  Infernal 45 menit </h1><br>  Bayangkan: Anda memiliki sistem yang dapat mengirim aplikasi kecepatan tinggi otomatis ke pasar tanpa pelacakan dan kemampuan untuk melihat apakah cukup banyak aplikasi telah selesai.  Ya, semuanya ternyata sangat buruk. <br><br>  Ketika pasar dibuka pada jam 9:30 pagi, orang dengan cepat menyadari bahwa ada sesuatu yang salah.  Pada jam 9:31 pagi, banyak orang di Wall Street menyadari bahwa sesuatu yang serius sedang terjadi.  Pasar dibanjiri tawaran dengan yang tidak biasa, dibandingkan dengan situasi normal, volume perdagangan untuk saham tertentu.  Pada pukul 9:32 di Wall Street, mereka bertanya-tanya mengapa aib ini tidak berhenti.  Hampir selamanya dalam perdagangan kecepatan tinggi.  Mengapa seseorang tidak mengklik tombol kill pada sistem yang melakukannya?  Ternyata, tidak ada saklar.  Selama 45 menit pertama perdagangan, pelaksanaan transaksi dari Knight berjumlah lebih dari 50% dari volume perdagangan, meningkatkan saham tertentu hingga lebih dari 10% dari nilainya.  Akibatnya, saham lain jatuh nilainya karena transaksi yang salah. <br><br>  Dan untuk memperburuk keadaan, sistem Knight mulai mengirim e-mail otomatis bahkan sebelum peristiwa ini - sudah pukul 8:01 pagi (ketika SMARS memproses pesanan yang cocok untuk perdagangan pra-pasar).  Dalam pesan, sistem merujuk ke SMARS dan menunjukkan kesalahan "Power Peg tidak tersedia."  Antara pukul 8:01 pagi dan 9:30 pagi, 97 surat dikirimkan kepada karyawan Knight.  Tentu saja, surat-surat ini tidak tampak seperti peringatan sistem, jadi tidak ada yang langsung melihatnya.  Aduh <br><br>  Selama 45 menit, Knight mencoba untuk menghentikan transaksi yang salah.  Itu tidak mungkin untuk mematikan sistem (karena tidak ada prosedur yang terdokumentasi untuk menanggapi situasi seperti itu), oleh karena itu, mencoba mengatasi masalah dalam kondisi perdagangan langsung, mereka tetap berada di pasar, di mana 8 juta saham dijual setiap menit.  Karena karyawan perusahaan tidak dapat menentukan dari mana aplikasi yang salah berasal, mereka menghapus kode baru dari server di mana ia digunakan dengan benar.  Dengan kata lain, mereka menghapus kode kerja dan dibiarkan rusak.  Ini hanya memperburuk masalah yang menyebabkan permintaan orang tua tambahan untuk mengaktifkan kode Power Peg pada semua server, dan bukan hanya di mana kode itu awalnya digunakan secara tidak benar.  Pada akhirnya, saya berhasil menghentikan sistem - setelah 45 menit perdagangan. <br><br>  Sementara perdagangan sedang berlangsung, kode Power Peg menerima dan memproses 212 permintaan orang tua.  Akibatnya, SMARS mengirim jutaan anak perusahaan ke pasar, menyelesaikan 4 juta transaksi dalam 154 transaksi dengan lebih dari 397 juta saham.  Untuk para penikmat pasar saham, ini berarti bahwa Knight membeli saham dari 80 perusahaan yang berbeda dengan $ 3,5 miliar dan menjual saham dari 74 perusahaan dengan $ 3,15 miliar. Dari sudut pandang non-profesional, Knight Capital Group kehilangan $ 460 juta dalam 45 menit.  Tetapi Knight hanya memiliki $ 365 juta dalam bentuk tunai dan setara kas.  Dalam 45 menit, Knight telah berubah dari pedagang terbesar saham Amerika dan pembuat pasar utama di NYSE dan NASDAQ menjadi bangkrut.  Mereka punya 48 jam untuk mengumpulkan jumlah yang diperlukan untuk menutupi kerugian (yang dapat mereka lakukan berkat investasi $ 400 juta dari sekitar setengah lusin investor).  Pada akhirnya, Knight Capital Group diakuisisi oleh Getco LLC (pada Desember 2012), dan sekarang perusahaan gabungan itu disebut KCG Holdings. <br><br><h1>  Kesimpulan apa yang Anda butuhkan untuk menggambar </h1><br>  Peristiwa 1 Agustus 2012 harus menjadi pelajaran bagi semua tim pengembangan dan tim proyek.  Tidak cukup membuat perangkat lunak hebat dan mengujinya;  Anda juga perlu memastikan bahwa itu dikirim dengan benar ke pasar sehingga pelanggan Anda menerima persis nilai yang Anda berikan (dan bahwa Anda tidak membuat perusahaan Anda bangkrut).  Insinyur yang menggunakan SMARS tidak hanya dapat disalahkan karena fakta bahwa prosedur yang diikuti di Knight tidak memperhitungkan risiko.  Prosedur (atau ketidakhadirannya) jelas salah.  Setiap kali proses penyebaran tergantung pada bagaimana orang membaca dan mengikuti instruksi, Anda menempatkan diri Anda dalam risiko.  Orang membuat kesalahan.  Kesalahan bisa dalam instruksi, dalam interpretasi instruksi atau dalam implementasinya. <br><br>  Tata letaknya harus otomatis, dapat direproduksi, dan bebas dari kemungkinan kesalahan manusia.  Jika Knight menerapkan sistem penyebaran otomatis - satu set konfigurasi, penyebaran otomatis, dan pengujian - maka kesalahan yang berubah menjadi mimpi buruk Knight bisa dihindari. <br><br>  Berikut adalah beberapa prinsip pengiriman kontinu (bahkan jika Anda tidak menerapkan proses pengiriman kontinu yang lengkap): <br><br><ul><li>  Rilis perangkat lunak harus merupakan proses yang berulang dan dapat diandalkan. <br></li><li>  Otomatisasi semua yang Anda bisa. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id458304/">https://habr.com/ru/post/id458304/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id458290/index.html">Komputer dual-core biosintetik dalam sel hidup</a></li>
<li><a href="../id458292/index.html">PHP Digest No. 159 (17 Juni - 1 Juli 2019)</a></li>
<li><a href="../id458298/index.html">Membuat setengah roda gigi besar di panel surya untuk 250.000 rubel (2 bagian)</a></li>
<li><a href="../id458300/index.html">Evolusi alat paling populer dari setiap pengembang (dalam Visual Studio)</a></li>
<li><a href="../id458302/index.html">Frontend Weekly Digest (24 - 30 Juni 2019)</a></li>
<li><a href="../id458306/index.html">Intisari bahan-bahan segar dari dunia front-end untuk minggu terakhir No. 371 (24 - 30 Juni, 2019)</a></li>
<li><a href="../id458308/index.html">Tinjauan Umum: Apa yang akan menjadi masa depan Tesla, dan faktor-faktor apa yang akan memengaruhinya</a></li>
<li><a href="../id458310/index.html">Kumpulkan metrik dari aplikasi .NET menggunakan Telegraf</a></li>
<li><a href="../id458312/index.html">Akademi Android di Moskow: Kursus Lanjutan</a></li>
<li><a href="../id458316/index.html">Yandex Retro Games Battle 2019 - mengembangkan game untuk ZX Spectrum</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>