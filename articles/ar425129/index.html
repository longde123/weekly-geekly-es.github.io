<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐๐ผ ๐ ๐ง ููููุฉ ุฃุชูุชุฉ ุฅูุดุงุก ุงูุฃุฌูุฒุฉ ุงูุงูุชุฑุงุถูุฉุ ูููู ุจุงูุชูุตูู ๐ผ๐ผ ๐ง๐ฟโ๐คโ๐ง๐ฝ ๐ฅ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุนุฏ ุฅูุดุงุก ุฌูุงุฒ ุงูุชุฑุงุถู ุฌุฏูุฏ ุฑูุชูููุง ูุณุชููููุง ููููุช. ูุงููุฒูุฏ ูู ุงูุจููุฉ ุงูุชุญุชูุฉ ูุงูุชูุธูู ุ ูุงููุฒูุฏ ูู ุงูุฅุฌุฑุงุกุงุช ุงููุฑุชุจุทุฉ ุจูุฐู ุงูุนูููุฉ. ูููุง ุจุฃุชูุชุฉ ูุฐู ุง...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ููููุฉ ุฃุชูุชุฉ ุฅูุดุงุก ุงูุฃุฌูุฒุฉ ุงูุงูุชุฑุงุถูุฉุ ูููู ุจุงูุชูุตูู</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/icl_services/blog/425129/" style=";text-align:right;direction:rtl"> ูุนุฏ ุฅูุดุงุก ุฌูุงุฒ ุงูุชุฑุงุถู ุฌุฏูุฏ ุฑูุชูููุง ูุณุชููููุง ููููุช.  ูุงููุฒูุฏ ูู ุงูุจููุฉ ุงูุชุญุชูุฉ ูุงูุชูุธูู ุ ูุงููุฒูุฏ ูู ุงูุฅุฌุฑุงุกุงุช ุงููุฑุชุจุทุฉ ุจูุฐู ุงูุนูููุฉ.  ูููุง ุจุฃุชูุชุฉ ูุฐู ุงูุนูููุฉ ุจุงุณุชุฎุฏุงู PowerShell. <br><br>  ูุฑุญุจุง ุจูู ูู ูุงุช ุฅุฐุง ููุช ููุชูุง. <br><br><img src="https://habrastorage.org/webt/fv/fr/cc/fvfrccl_crsi5nfvcnstarorits.jpeg"><br><br><a name="habracut"></a><br>  ูุง ูุญุจ ุงููุจุฑูุฌูู ุงูููุงู ุจุนูู ูุฒุฏูุฌ ุ ููุง ุฃู ูุณุคููู ุงููุธุงู. <br><br>  ูููุง ููู ูุซุงู ูุฃุชูุชุฉ ุฃุญุฏ ุนููุงุฆูุง. <br><br>  ุฃุฑุฏูุง ุฃู ูุชุฃูุฏ ูู ุฃู ุฃู ูููุฏุณ ุฃู ูุฏูุฑ ูุดุฑูุน ููููู ุฅูุดุงุก ุฌูุงุฒ ุงูุชุฑุงุถู ุฌุฏูุฏ ุจุฃูู ุฌูุฏ ูููุชุฑุฉ ูุตูุฑุฉ.  ูุฏู ุนููุงุฆูุง ูุธุงู ITSM ุ ูู ูุฐุง ุงููุซุงู ูู ServiceNow ุ ุฃูุดุฃูุง ูููุฐุฌ ุงูููุจ ุงูููุงุจู ูู ูุชุงููุฌ ุงูุฎุฏูุฉ.  ูู ุฃุฌู "ุทูุจ" ุฌูุงุฒ ุฌุฏูุฏ ุ ูุญุชุงุฌ ุงููุฏูุฑ ุฅูู ููุก ุงูุญููู ูุชุฃููุฏ "ุงูุทูุจ" ุ ูุจุนุฏ ุฐูู ูุชู ุฅุทูุงู ุณูุณูุฉ ุงูุนูููุฉ ุ ูุนูุฏ ุงูุฅุฎุฑุงุฌ ูุฌูุฒ ุงูุขูุฉ ููุงุณุชุฎุฏุงู. <br><br>  ูุฐุง ุ ุฏุนูุง ูููู ูุธุฑุฉ ุนูู ูุง ูุญุชุงุฌ ุงููุฏูุฑ ุฅูู ุชุญุฏูุฏู ูุฅูุดุงุก ุฌูุงุฒ ุงูุชุฑุงุถู ุฌุฏูุฏ: <br><br><img src="https://habrastorage.org/webt/3l/8d/yo/3l8dyowobrfvbgpznotayqjywvu.png"><br><br>  <b>ูุตู ุงูุฌูุงุฒ ุงูุธุงูุฑู: ูุตู ุงูุฌูุงุฒ ุงูุธุงูุฑู</b> <b><br></b>  ููุงู ุญุงุฌุฉ ุฅูู ุจุนุถ ุงูุชูุถูุญุงุช ููุง.  ูู ุญููุง ุ ูุชู ุงุณุชุฎุฏุงู PowerShell 5.1 ุจุดูู ูุดุท ุ ูุฐูู ุฃุซูุงุก ุงุณุชุฎุฏุงู ูุธุงู Windows ููุท ุ ุณูุญุงูู ูู ุงููุณุชูุจู ุฅุถุงูุฉ ุฏุนู ูุฃุฌูุฒุฉ Unix ูุงูุชุจุฏูู ุฅูู PowerShell Core. <br><br>  <b>ูุธุงู ุงูุชุดุบูู</b> ุ ูุธุงู ุงูุชุดุบูู.  ูุง ุชูุฌุฏ ุญูุงุฌุฒ ุฎุงุตุฉ ูุงุณุชุฎุฏุงู Windows 2008 (R2) ุ ููููุง ูุณุชุฎุฏู 2012R2 ุฃู 2016. <br><br>  <b>ุญุฌู</b> ุงูุฌูุงุฒ ุงูุธุงูุฑู ุ ุญุฌู ุงูุฌูุงุฒ ุงูุธุงูุฑู.  ููู ูููุง ุ ูููู ุชุญุฏูุฏ ุฐูู ุจุทุฑููุชู ุงูุฎุงุตุฉ ุ ูู ูุฐุง ุงููุซุงู ุตุบูุฑ 1CPU-4Gb Ram ุ ูุชูุณุท โโ2CPU-8Gb ุ ูุจูุฑ 4-16. <br><br>  <b>ุชุฎุฒูู VM</b> ุ ุงููุฑุต 0 (C: \) ูู ุญุฌู ุซุงุจุช ูุง ููููู ุชุบููุฑู ุ ููุท ูุญุฏุฏ ุงูุชุฎุฒูู ุงูุณุฑูุน / ุงูุจุทูุก ูุชุงุญ.  ูููู ุฃู ูููู "ุณุฑูุน" ุทุจูุฉ ุชุฎุฒูู ูุน SSD ุ ู "ุจุทูุก" ูููู ุชุฎุฒููู ุนูู ูุญุฑูุงุช ุงูุฃูุฑุงุต ุงูุตูุจุฉ "ุงูุนุงุฏูุฉ" (ุจุงูุทุจุน ุ SAN).  ูุญุชูู Disk1 (Disk2 ููุง ุจุนุฏู) ุฃูุถูุง ุนูู ูุญุฏุฏ ูุชุญุฏูุฏ ุงูุชุฎุฒูู ุ ุจุงูุฅุถุงูุฉ ุฅูู ุงูุญููู ูุฅุฏุฎุงู ุงูุญุฌู ุงููุทููุจ ุจุงูุบูุบุงุจุงูุช ุ ูุฎุทุงุจ ุงููุณู ูุญุฌู ุงููุชูุฉ (ููู ุฃูุฑ ููู ุจุงููุณุจุฉ ูู SQL Server). <br><br>  <b>ุงูุซูุฉ</b> ุ ูุญุฏุฏ ุฃู ุงูุฌูุงุฒ ูุฌุจ ุฃู ูููู ูุฑุชุจุทูุง ุจุงููุฌุงู ุฃู ูุง ุ ูุน ูุตูู ูู ุงูุดุจูุฉ ุงูุนุงูุฉ ุฃู ูุง. <br><br>  <b>ููุน</b> ูููุน ุงูุฌูุงุฒ.  ูููู ุชุนุฑูู ูู ุขูุฉ ุชูุฑูุจูุง ุนูู ุฃููุง ุชุทุจูู ุฃูุงูู ุฃู ุฎููู ุฃู ุบูุฑูุง ูู ุฌููุน ุงูุญุงูุงุช ุงูุฃุฎุฑู.  ุงุณุชูุงุฏูุง ุฅูู ุงูููุน ุงููุญุฏุฏ ุ ูููููุง ุชุญุฏูุฏ ุงูุดุจูุฉ ุงููุฑุนูุฉ ุงูุฃูุซุฑ ููุงุกูุฉ ููุฌูุงุฒ. <br><br>  <b>ุงูุจูุฆุฉ</b> ุ ูู ุงูุจููุฉ ุงูุชุญุชูุฉ ููุนููู ุ ููุฌุฏ ูุฑูุฒุงู ููุจูุงูุงุช: ุงูุฑุฆูุณู (ุงูุฅูุชุงุฌ) ูุงูุซุงููู (Dev / test) ุ DC ูุชุตู ุจูุงุณุทุฉ ููุงุฉ ุงุชุตุงู ุณุฑูุนุฉ ููููุฑ ุงูุชุณุงูุญ ูุน ุงูุฎุทุฃ.  ุจููุฌุจ ุงูุงุชูุงููุฉ ุ ุชุญุชูู ุฌููุน ุงูุฃุฌูุฒุฉ ุงูุงูุชุฑุงุถูุฉ ูู Primary DC ุนูู ุนููุงู IP ูุจุฏุฃ ูู 10.230 ุ ููู Secondary DC ุนูุฏ 10.231. <br><br>  <b>(SLA) ุงุชูุงููุฉ ูุณุชูู ุงูุฎุฏูุฉ</b> ุ ุชุคุซุฑ ูุฐู ุงููุนููุฉ ุนูู ุฌูุฏุฉ ุงูุฎุฏูุฉ ููุฐุง ุงูุฌูุงุฒ. <br><br>  <b>ุงูุชุทุจููุงุช</b>  ููุฏ ุฃุถููุง ุงููุฏุฑุฉ ุนูู ุชุซุจูุช SQL Server ูุชููููู.  ูุฌุจ ุชุญุฏูุฏ ุงูุฅุตุฏุงุฑ ูุงุณู ุงููุซูู ูุงูุชุฑุชูุจ.  ูู ุงููููู ุฃูุถูุง ุชูููู ูู ูู ุฏูุฑ ุฎุงุฏู ุงูููุจ ูุฃูุซุฑ ูู ุฐูู ุจูุซูุฑ. <br><br>  ูุญุชุงุฌ ุงูุขู ุฅูู ุชุญุฏูุฏ ููููุฉ ุชุฎุฒูู ุงูููู ุงููุญุฏุฏุฉ.  ูุฑุฑูุง ุฃู ุงูุชูุณูู ุงูุฃูุซุฑ ููุงุกูุฉ ูู ููู JSON.  ููุง ููุช ุณุงุจููุง ุ ุชุณุชุฎุฏู ุจูุฆุฉ ุงูุนููู ุฎุฏูุฉ ITSM ServiceNow ุ  ุงููุฏูุฑ ุ ุจุนุฏ ุชุญุฏูุฏ ุฌููุน ุงูููู ุงูุถุฑูุฑูุฉ ุ ูููุฑ ุนูู ุฒุฑ "ุงูุทูุจ" ูุจุนุฏ ุฐูู ServiceNow ููุฑุฑ ุฌููุน ุงููุนููุงุช ุฅูู ุจุฑูุงูุฌ PowerShell ุงููุตู (ุฅูู ServiceNow ุงูุฎููู) ุ ูุงูุฐู ุณููุดุฆ ููู JSON.  ูุจุฏู ุดูุก ูุซู ูุฐุง: <br><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">.\CreateConfiguration.ps1 -SecurityZone trusted -VMDescription "VM for CRM System" -Requestor "evgeniy.vpro" -OSVersion 2k16 -OSEdition Standard -BuildNewVM -VMEnvironment Prod -VMServiceLevel GOLD -VMSize Medium -Disk0Tier Fast -Disk1Size 50 -Disk1Tier Eco -Disk1Letter D -MSSQLServer -MSSQLInstanceName "Instance1" -SQLCollation Latin1_General_CI_AS -SQLEdition Standard -Disk2Size 35 -Disk3Size 65</code> </pre> <br><br>  ูู ูุต ุงูุจุฑูุงูุฌ ุงููุตู CreateConfiguration .ps1: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># PowerShell- $config = [ordered]@{} #    . $config.SecurityZone=$SecurityZone</code> </pre><br><br>  ูู ุงูููุงูุฉ ุ ูู ุจุชุตุฏูุฑ ูุงุฆููุง ุฅูู ููู JSON: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$ServerConfig = New-Object โTypeName PSObject $config ConvertTo-Json -InputObject $ServerConfig -Depth 100 | Out-File "C:\Configs\TargetNodes\Build\$($Hostname.ToLower()).json" -Force</code> </pre><br><br>  ุชูููู ุงูุนููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">{ "Hostname": "dsctest552", "SecurityZone": "trusted", "Domain": "testdomain", "Requestor": "evgeniy.vpro", "VM": { "Size": "Medium", "Environment": "Prod", "SLA": "GOLD", "DbEngine": "MSSQL", "RAM": 8, "Storage": [ { "Id": 0, "Tier": "Fast", "Size": "100", "Allocation": 4, "Letter": "C" }, { "Id": 1, "Tier": "Eco", "Size": 50, "Label": "Data", "Allocation": 64, "Letter": "D" }, { "Id": 2, "Tier": "Fast", "Size": 35, "Label": "Data", "Allocation": 64, "Letter": "E" }, { "Id": 3, "Tier": "Fast", "Size": 65, "Label": "Data", "Allocation": 64, "Letter": "F" } ] }, "Network": { "MAC": "", "IP": "10.230.168.50", "Gateway": "10.230.168.1", "VLAN": โVLAN168โ }, "OS": { "Version": "2k16", "Edition": "Standard", "Administrators": [ "LocaAdmin", "testdomain\\ Security-LocalAdmins" ] }, "OU": "OU=Servers,OU=Staging,DC=testdomain", "Applications": [ { "Application": "Microsoft SQL Server 2016", "InstanceName": "vd", "Collation": "Latin1_General_CI_AS", "Edition": "Standard", "Features": "SQLENGINE", "Folders": { "DataRoot": "E:\\MSSQL", "UserDB": "E:\\MSSQL\\MSSQL11.vd\\MSSQL\\Data", "UserLog": "E:\\MSSQL\\MSSQL11.vd\\MSSQL\\Log", "TempDB": "D:\\MSSQL\\MSSQL11.vd\\MSSQL\\TempDB", "TempDBLog": "D:\\MSSQL\\MSSQL11.vd\\MSSQL\\TempDB", "Backup": "E:\\MSSQL\\MSSQL11.vd\\MSSQL\\Backup" }, "MaxMemory": 2147483647 } ], "Description": "VM for CRM", "Certificate": { "File": null, "Thumbprint": null }, "Version": 0 }</code> </pre><br><br>  ุฑุจูุง ูุงุญุธุช ุฃู ูููุฐุฌ ุงูููุจ ูุง ูุญุชูู ุนูู ุงุณู ุฌูุงุฒ ุงูุชุฑุงุถู ูุนููุงู IP.  ูุญุตู ุนูู ูุฐู ุงูููู ุชููุงุฆููุง ุนูู ุงููุญู ุงูุชุงูู: <br><br>  <b>ูุญุชูู ุงุณู ุงูุฌูุงุฒ</b> ุ ITSM ServiceNow ุนูู ูุณู ุฎุงุต: CMDB (ูุงุนุฏุฉ ุจูุงูุงุช ุฅุฏุงุฑุฉ ุงูุชููุฆุฉ) ุ ุชููู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฐู ุจุชุฎุฒูู ุฌููุน ุงูุณุฌูุงุช ุญูู ุงูุฃุฌูุฒุฉ ุงูุงูุชุฑุงุถูุฉ ุงูููุฌูุฏุฉ ูุญุงูุชูุง ููุฑูู ุงูุฏุนู ูุงููุฒูุฏ.  ููุฏ ุฃูุดุฃูุง ุญูุงูู 200 ุณุฌู ุงุญุชูุงุทู ุจุญุงูุฉ "ููุฎุตุต".  ููุญุตูู ุนูู ุงุณู ููุฌูุงุฒ ุงูุธุงูุฑู ุ ูููู ุจุชูุฏูู ุทูุจ REST ูู CMDB ููุญุตู ุนูู ุฃูู ุณุฌู "ูุฌุงูู" ููุบูุฑ ุญุงูุชู ูู "ูุฎุตุต ุฅูู ุชุซุจูุช ูุนูู". <br><br>  <b>ุนููุงู IP ู VLAN</b> ุ ูููุง ุจูุดุฑ IPAM ุนูู ุดุจูุชูุง - ูุฐู ููุฒุฉ ูุถููุฉ ูู Windows Server 2016 ุชุณูุญ ูู ุจุฅุฏุงุฑุฉ ุนูุงููู IP ุนูู ุดุจูุชู.  ููุณ ูู ุงูุถุฑูุฑู ุนูู ุงูุฅุทูุงู ุงุณุชุฎุฏุงู ุฌููุน ููุฒุงุช IPAM (DHCP ุ DNS ุ AD) ุ ูููู ูุงุณุชุฎุฏุงููุง ููุท ููุงุนุฏุฉ ุจูุงูุงุช ูุนูุงููู IP ูุน ุงูุชุฏุงุฏ ูุญุชูู ูููุธุงุฆู.  ููุฏู ุงููุต ุงูุจุฑูุฌู ุงูุฐู ููุดุฆ ููู JSON ุทูุจูุง ุฅูู IPAM ููุญุตูู ุนูู ุฃูู ุนููุงู IP ูุฌุงูู ุนูู ุงูุดุจูุฉ ุงููุฑุนูุฉ.  ููุชู ุชุญุฏูุฏ ุงูุดุจูุฉ ุงููุฑุนูุฉ VLAN (ุงูุดุจูุฉ ุงููุฑุนูุฉ x / 24) ุงุณุชูุงุฏูุง ุฅูู ููู SLA ูุงูุจูุฆุฉ ูุงูุซูุฉ ูุงูููุน ุงููุญุฏุฏุฉ. <br>  ููู ุงูุชูููู ุฌุงูุฒ ุ ุฌููุน ุงูุญููู ูู ููุงููุง ุ ููููู ุฅูุดุงุก ุฌูุงุฒ.  ุงูุณุคุงู ูู "ููููุฉ ุชุฎุฒูู ุจูุงูุงุช ุงูุงุนุชูุงุฏ ูุฌููุน ูุตูุตูุงุ".  ูุณุชุฎุฏู ุญุฒูุฉ <a href="">CredentialManager</a> .  ุชุนูู ูุฐู ุงูุญุฒูุฉ ูุน ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช Windows Credential Manager ูุชุฎุฒูู ูููุงุช ุงููุฑูุฑ.  ูุซุงู ุนูู ุฅูุดุงุก ูููุฉ ูุฑูุฑ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">New-StoredCredential -Target "ESXi" -UserName "testdomain.eu\vmwareadm" -Password "veryultraP@ssw00rd." -Type Generic -Persist LocalMachine</code> </pre><br><br>  ุณุชููู ูููุฉ ุงููุฑูุฑ ูุชุงุญุฉ ูููุฑุงุกุฉ ุฏุงุฎู ูุฐุง ุงูุฌูุงุฒ ูุงูุญุณุงุจ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$ESXiAdmin = Get-StoredCredential -Type Generic -Target ESXi</code> </pre> <br><br>  ูุฏููุง ุฎุงุฏู ูุชู ููู ุชุฎุฒูู ุฌููุน ุงูุชููููุงุช ุจุงุณุชุฎุฏุงู GIT ุ ูุงูุขู ูููููุง ุจุดูู ููุซูู ุชุชุจุน ุฌููุน ุงูุชุบููุฑุงุช ูู ุงูุชููููุงุช: ูู ููุงุฐุง ูุฃูู ููุชู. <br><br>  ูุชู ุชูููู ุงููููุฉ ุงููุฌุฏููุฉ ุนูู ูุฐุง ุงูุฎุงุฏู: ุชุญูู ูู ุงููุฌูุฏ ูุน ุงูุชููููุงุช ูุงูุชุจ ูู ุณุฌู ุฃุญุฏุงุซ Windows ุญูู ุฌููุน ุงูุชุบููุฑุงุช. <br><br>  ุจุนุฏ 15 ุฏูููุฉ ุ ุณุชูุชุจ ุงููููุฉ ุงููุฌุฏููุฉ ุฅูู Windows EventLog ุฃูู ุชู ุงููุดู ุนู ููู ุชูููู ุฌุฏูุฏ. <br><br>  ุญุงู ุงูููุช ููุชุญูู ูู ูุฐุง ุงูุชูููู.  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ูุญุชุงุฌ ุฅูู ุงูุชุฃูุฏ ูู ุฃู ุงูููู ูุญุชูู ุนูู ุงูุชูุณูู ุงูุตุญูุญ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$Configuration=(Get-Content -Raw $File | Out-String | ConvertFrom-Json)</code> </pre> <br><br>  ุฅุฐุง ูุงู ูู ุดูุก ุนูู ูุง ูุฑุงู ุ ููุฏ ุญุงู ุงูููุช ูุจุฏุก ุฅูุดุงุก ุงูุฌูุงุฒ ูุชุดุบูู ุงูุจุฑูุงูุฌ ุงููุตู BuildVM.ps1. <br><br>  ูู BuildVM.ps1 ุ ูุชุญูู ูู ุฃู ููู ุงูุชูููู ูุญุชูู ุนูู ูุตู ูุฌููุน ุฎุตุงุฆุต ุงูุฌูุงุฒ ุงูุธุงูุฑู: ุงูุญุฌู ุ env ุ sla ุ ุงูููุน ุ ุงูุชุฎุฒูู ุ ram ุ ุงูุดุจูุฉ. <br><br>  ุชุฃูุฏ ูู ุงูุชุญูู ูู ูุฌูุฏ ุฌูุงุฒ ุจููุณ ุงูุงุณู ูู ุงูุจููุฉ ุงูุชุญุชูุฉ (CheckVM.ps1). <br>  ูููู ุจุงูุงุชุตุงู ูู ุฎูุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">VMWare PowerShell CLI</a> ุจู vSphere ุงูุฎุงุต ุจูุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$VmWareAdmin = Get-StoredCredential -Type Generic -Target ESXi Connect-VIServer -Server "vSphereSrv" -Credential $VmWareAdmin | Out-Null</code> </pre><br><br>  ุชุญูู ููุง ุฅุฐุง ูุงู ููุงู ุฌูุงุฒ ุจููุณ ุงูุงุณู ูู ุงูุจููุฉ ุงูุชุญุชูุฉ <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$VM=Get-VM $server -ErrorAction SilentlyContinue</code> </pre> <br><br>  ููู ุจุฅููุงู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Disconnect-VIServer * -Force -Confirm:$false</code> </pre> <br><br>  ุชุฃูุฏ ูู ุฃู ุงูุฌูุงุฒ ุบูุฑ ูุชููุฑ ุฃูุถูุง ุนูู WinRM <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$ping=Test-NetConnection -ComputerName $Configuration.Hostname -CommonTCPPort WINRM -InformationLevel Quiet -ErrorAction SilentlyContinue</code> </pre> <br><br>  ุฅุฐุง ูุงู $ VM ู $ ping ูุงุฑุบูู ุ ูููููู ุฅูุดุงุก ุฌูุงุฒ ุฌุฏูุฏ.  (ูุญู ูุชุนุงูู ูุน ุงูููุงูู ุนูุฏูุง ูุชู ุจุงููุนู ุฅูุดุงุก ุฌูุงุฒ ูุฏูููุง ูู ESXi ุฃู ูููู ูุฐุง ุงูุฌูุงุฒ ูู ูุฑูุฒ ุจูุงูุงุช ุขุฎุฑ.) <br><br><blockquote style=";text-align:right;direction:rtl">  ุจุถุน ูููุงุช ุนู ุงูุณูุงุฑุฉ.  ูุฐู ุตูุฑุฉ ุขูุฉ ุงูุชุฑุงุถูุฉ ูุนุฏุฉ ุชู ุงูุงูุชูุงุก ูููุง ุจูุงุณุทุฉ sysprep ูุชุญููููุง ุฅูู ูุงูุจ ูู vSphere.  ูุชู ุญูุธ ุงููุณุคูู ุงููุญูู ุจูููุฉ ุงููุฑูุฑ ุงููุนุฑููุฉ ูู ุงูุตูุฑุฉ ุ ููุง ูุชูู ูุฐุง ุงูุญุณุงุจ ุจุนุฏ sysprep ุ ููุง ูุณูุญ ููุง ุจุงููุตูู ุฅูู ูู ุฌูุงุฒ ูู ูุฐุง ุงููุงูุจ ุ ูุจุนุฏ ุฐูู ูููููุง ุงุณุชุจุฏุงู ูููุฉ ุงููุฑูุฑ ูุฐู ูุฃุบุฑุงุถ ุฃูููุฉ. </blockquote><br><br><h3 style=";text-align:right;direction:rtl">  ุฅูุดุงุก ุฌูุงุฒ ุงูุชุฑุงุถู <br></h3><br>  ุงุจุญุซ ุนู ูุฌููุนุฉ SLR ุงูููุงุจูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$Cluster=Get-Cluster -Name $Configuration.VM.SLA</code> </pre> <br><br>  ุชุญูู ูู ูุฌูุฏ ูุณุงุญุฉ ูุงููุฉ ุนูู ูุฎุฒู ุงูุจูุงูุงุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$DatastoreCluster = Get-DatastoreCluster |Where-Object {$_.Name -like $Datastore1Name} $Datastore1 = Get-Datastore -Location $DatastoreCluster |sort -Property "FreeSpaceGB" |select -Last 1 IF ($Datastore1.FreeSpaceGB -le "200"){ Write-Host -foreground red "STOP: Not enough datastore capacity for DISK" $vdisk.Id Break }</code> </pre><br><br>  ูุฐุงูุฑุฉ ูุงููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$VMHost = Get-VMHost -Location $Cluster |sort -Property "MemoryUsageGB" |select -First 1 IF ($VMHost.MemoryUsageGB -le "20"){ Write-Host -foreground red "STOP: No enough ESXi host capacity" Break }</code> </pre><br><br>  ูุฃุฎุฐ ูุงูุจูุง <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$VMTemplate = Get-Template -Name 'Win2016_Std_x64_Template'</code> </pre> <br><br>  ูุฅูุดุงุก ุขูุฉ ุงูุชุฑุงุถูุฉ ุฌุฏูุฏุฉ <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">New-VM -Name $Configuration.Hostname.ToUpper() -VMHost $VMHost -ResourcePool $ResourcePool -Datastore $Datastore -Template $VMTemplate -Location "AutoDeployed VMs"</code> </pre> <br><br>  ูู ุงูููู ุชูุตูู ูุงุฌูุฉ ุงูุดุจูุฉ ุจุดุจูุฉ ูุฑุนูุฉ ูุน ุชูููู DHCP. <br><br>  ูุจุฏุฃ ุงูุฌูุงุฒ ุงูุธุงูุฑู <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Start-VM $VM</code> </pre> <br><br>  ูุงุญูุธ ูุตู ุงูุฌูุงุฒ ุ ุจุญูุซ ููููู ูู ููุช ูุงุญู ุชุญุฏูุฏ ุงูุฌูุงุฒ ุนูู ูุณุชูู ุจุฑูุงูุฌ VMWare. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Set-Annotation -Entity $VM -CustomAttribute "Change request" -Value $Configuration.Request -Confirm:$false Set-VM $VM -Notes $Configuration.Description -Confirm:$false</code> </pre><br><br>  ุจุฏุฃ ุชุดุบูู ุงูุฌูุงุฒ ูุงูุขู ูููููุง ูุนุฑูุฉ ุนููุงู MAC ุงููุณุชูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$vMAC = (($VM | Get-NetworkAdapter | Select-Object -Property "MacAddress").MacAddress).Replace(':','')</code> </pre> <br><br>  ุงุญูุธ ูุฐู ุงููููุฉ ูู ููู JSON. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$Configuration.Network.MAC=$VMAC ConvertTo-Json -InputObject $Configuration -Depth 100 | Out-File "C:\Configs\TargetNodes\Build\$Hostname.json" -Force</code> </pre><br><br>  ูุฐุง ูู ุงูููุช ุงูููุงุณุจ ููุงูุชุฒุงู ุจุฌูุงุฒ Git ุงูุฎุงุต ุจูุง ุงูุฐู ุชู ุฅูุดุงุก ุงูุฌูุงุฒ ุจู ููุฏูู MAC ูุฑูุฏ ุฎุงุต ุจู. <br><br>  ูุจุฏุฃ ุงูุฌูุงุฒ ูู ุงูุชููุฆุฉ (ุจุนุฏ sysprep) ุ ูุฅุนุฏุงุฏ ุงููุนุฏุงุช ูุงูุชูููู ุงูุฃููู. <br><br>  ุฏุนูุง ููุชุธุฑ ุญุชู ูุชููุฑ ุฌูุงุฒ WinRM ุงูุฎุงุต ุจูุง ูุน ุงูุจุฑูุงูุฌ ุงููุตู FoundConnection.ps1. <br><br>  ุฃููุงู ุ ุงูุชุดู ูุง IP ุงูุฐู ุชููุชู ุงูุขูุฉ ูู DHCP: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># $MAC = $vMAC while($isOnline -ne $true){ if((Get-DhcpServerv4Lease -ClientId $MAC -ScopeId $StagingDHCPScope -ComputerName $DHCPServer -ErrorAction Ignore).IPAddress.IPAddressToString){ $tempIP=(Get-DhcpServerv4Lease -ClientId $MAC -ScopeId $StagingDHCPScope -ComputerName $DHCPServer).IPAddress.IPAddressToString break } else{ if($isOnline -ne $true){ Write-Host "`r$i`t" -NoNewline $i++ } } }</code> </pre><br><br>  ูุงูุขู ุณููุชุธุฑ ุ ุนูุฏูุง ูููู ุงูุฌูุงุฒ ูุชุงุญูุง ุนูู WinRM: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$LocalAdmin = Get-StoredCredential -Type Generic -Target LocalAdmin $i=0 $isOnline=$false while($isOnline -ne $true){ if(Invoke-Command -ComputerName $tempIP -ScriptBlock{ Get-ItemProperty -Path "Registry::\HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Component Based Servicing" } -Credential $LocalAdmin -ErrorAction SilentlyContinue){ $isOnline=$true break } else{ if($isOnline -ne $true){ Write-Host "`r$i" -NoNewline $i++ Start-Sleep -Seconds 1 } } }</code> </pre><br><br>  ุงูุขูุฉ ุฌุงูุฒุฉ ููููุงุฏุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  ุชูููู ุงูุญุงูุฉ ุงููุทููุจุฉ <br></h3><br>  ูุชูููู ุงูุชูููู ุงููุทููุจ ุ ูุณุชุฎุฏู ุฌุฒุก PowerShell - DSC (ุชูููู ุงูุญุงูุฉ ุงููุฑุบูุจุฉ).  ููุฌุฏ ุฎุงุฏู DSC Pull ุชู ุชููููู ุนูู ุงูุดุจูุฉ: dscpull.testdomain.eu. <br>  ูููุง ููู ุชูููู ุฎุงุฏู ุณุญุจ DSC ุงูุฎุงุต ุจูุง.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงู ุฌูุฏ ุญูู ุชูููู ุณุญุจ DSC.</a> <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Node $NodeName { WindowsFeature DSCServiceFeature { Ensure = "Present" Name = "DSC-Service" } xDscWebService PSDSCPullServer { Ensure = "Present" EndpointName = "PSDSCPullServer" Port = 8080 PhysicalPath = "$env:SystemDrive\inetpub\PSDSCPullServer" CertificateThumbPrint = $certificateThumbPrint ModulePath = "$env:PROGRAMFILES\WindowsPowerShell\DscService\Modules" ConfigurationPath = "$env:PROGRAMFILES\WindowsPowerShell\DscService\Configuration" State = "Started" DependsOn = "[WindowsFeature]DSCServiceFeature" RegistrationKeyPath = "$env:PROGRAMFILES\WindowsPowerShell\DscService" AcceptSelfSignedCertificates = $true UseSecurityBestPractices = $true } File RegistrationKeyFile { Ensure = 'Present' Type = 'File' DestinationPath = "$env:ProgramFiles\WindowsPowerShell\DscService\RegistrationKeys.txt" Contents = $RegistrationKey } }</code> </pre><br><br>  ููู ูุชุงุญุฉ ุนูู: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://dscpull.testdomain.eu:8080</a> <br><br>  ููุทุฉ ุงูููุงูุฉ: <a href="">https://dscpull.testdomain.eu:8080/PSDSCPullserver.svc</a> <br><br>  ูุฌุจ ุชุซุจูุช PowerShell 5.1 ุนูู ูุงูุฉ ุนููุงุก ูููู ุงูุณุญุจ <br>  ุฅู ูู ููู PowerShell 5.1 ูุซุจุชูุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$PSVersionTable.PSVersion.Major โlt 5</code> </pre> <br><br>  ุชุซุจูุช PowerShell 5.1: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Write-Host "Download PowerShell 5.1" Invoke-Command -ComputerName $Node -ScriptBlock { [System.Net.ServicePointManager]::SecurityProtocol=[System.Net.SecurityProtocolType]::Tls12;Invoke-WebRequest -Uri "https://dscpull.testdomain.eu:8080/Files/Updates/WMF.msu" -OutFile C:\TEMP\WMF.MSU } Write-Host "Extract PowerShell 5.1" Invoke-Command -ComputerName $Node -ScriptBlock {Start-Process -FilePath 'wusa.exe' -ArgumentList "C:\temp\WMF.msu /extract:C:\temp\" -Wait -PassThru } Write-Host "Apply PowerShell 5.1" Invoke-Command -ComputerName $Node -ScriptBlock {Start-Process -FilePath 'dism.exe' -ArgumentList "/online /add-package /PackagePath:C:\temp\WindowsBlue-KB3191564-x64.cab /Quiet" -Wait -PassThru } Write-Host "PowerShell 5.1 has been installed"</code> </pre><br><br>  ูุชู ูุดุฑ ุฎุงุฏู PKI ุฃูุถูุง ุนูู ุดุจูุชูุง.  ูุฐุง ุดุฑุท ููุชุดููุฑ ุงูุขูู ูุจูุงูุงุช ุงูุงุนุชูุงุฏ ุงููุฎุฒูุฉ ูู ูููุงุช msc DSC (ูููุงุช Mof ูู "ุงููุบุฉ" ุงูุชู ูุชุตู ุจูุง Pull Server ูุนููุงุฆู).  ุนูุฏูุง ูุญุงูู ุนููู ุงูุชุณุฌูู ุนูู Pull Server ุ ูู ุงูุถุฑูุฑู ุชุญุฏูุฏ ุดูุงุฏุฉ Thumbprint ูุจุนุฏ ุฐูู ุนูู Pull Server ุณูุณุชุฎุฏู ูุฐู ุงูุดูุงุฏุฉ ูุชุดููุฑ ูููุงุช ุงููุฑูุฑ.  ุฃุฏูุงู ุณูุฑู ููู ูุนูู. <br><br>  ุงุณุชูุฑุงุฏ CA ุงูุฌุฐุฑ ุฅูู ุงูุฌูุงุฒ ุงูุฌุฏูุฏ ุงูุฎุงุต ุจูุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> Invoke-Command -ComputerName $server -ScriptBlock{ $PKI="-----BEGIN CERTIFICATE----- MIIF2TCCA8GgAwIBAgIQSPIjcff9rotNdxbg3+ygqDANBgkqhkiG9w0BAQUFADAe **************************************************************** znafMvVx0B4tGEz2PFss/FviGdC3RohBHG0rF5jO50J4nS/3cGGm+HGdn1w/tZd0 a0FWpn9VCOSmXM2It+tSW1f4nZVt6T2kr1ZlTxkDhT7HMSGsrX/XJswzCkDGe3dE qrVVjNUkhVTaeeBWdujB5J6mcx7YkNsAUhODiS9Cf7FnYnxLFA72M0pijI48P5F0 ShM9HWAAUIrLkv13ug== -----END CERTIFICATE-----" $PKI | Out-File RootCA.cer Import-Certificate RootCA.cer -CertStoreLocation Cert:\LocalMachine\Root | select Thumbprint | Out-Null } -Credential $LocalAdmin | Out-Null</code> </pre><br><br>  ููุฒูุฏ ูู ุงูุนูู ุ ูุญุชุงุฌ ุฅูู ุฒูุฌ ูู ููุงุชูุญ RSA.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุณููุดุฆ ุดูุงุฏุฉ ูููุนุฉ ุฐุงุชููุง</a> ููุนูู ูุนูุง ูุคูุชูุง. <br><br>  ุงูุขู ูููููุง ุงูุชุณุฌูู ูู Pull Server: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$DscHostFQDN = [System.Net.Dns]::GetHostEntry([string]$env:computername).HostName $DscPullServerURL = "https://$($DscHostFQDN):8080/PSDSCPullserver.svc" $DscWebConfigChildPath = '\inetpub\psdscpullserver\web.config' $DscWebConfigPath = Join-Path -Path $env:SystemDrive -ChildPath $DscWebConfigChildPath $DscWebConfigXML = [xml](Get-Content $DscWebConfigPath) $DscRegKeyName = 'RegistrationKeys.txt' $DscRegKeyXMLNode = "//appSettings/add[@key = 'RegistrationKeyPath']" $DscRegKeyParentPath = ($DscWebConfigXML.SelectNodes($DscRegKeyXMLNode)).value $DscRegKeyPath = Join-Path -Path $DscRegKeyParentPath -ChildPath $DscRegKeyName $DscRegKey = Get-Content $DscRegKeyPath [DSCLocalConfigurationManager()] configuration RegisterOnPull { Node $Node { Settings { ConfigurationModeFrequencyMins = 1440 CertificateID = $Thumbprint RefreshMode ='Pull' RefreshFrequencyMins = 1440 RebootNodeIfNeeded = $true ConfigurationMode ='ApplyAndAutoCorrect' AllowModuleOverwrite = $true DebugMode = 'None' StatusRetentionTimeInDays = 1 } ConfigurationRepositoryWeb $([string]$env:computername) { ServerURL = $DscPullServerURL RegistrationKey = $DscRegKey CertificateID = $Thumbprint ConfigurationNames = @("$hostx") } } } RegisterOnPull -OutputPath $MetaConfigsStorage Set-DscLocalConfigurationManager -ComputerName $Node -Path $MetaConfigsStorage -Verbose -Force -Credential $LocalAdmin</code> </pre><br><br>  ุฃุฑุณู ุงูุชูููู ุงูุฃูู ุฅูู ุฃุฌูุฒุชูุง <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Configuration Rename { param ( [Parameter()] [System.String[]] $Node, $hostname ) Import-DscResource -ModuleName xComputerManagement Import-DscResource โModuleName PSDesiredStateConfiguration Node $Node { xComputer JoinDomain { Name = $hostname } } } Rename -Node $Node -OutputPath $DscConfigPath -hostname $hostname New-DscChecksum $DscConfigPath -Force Invoke-Command -ComputerName $Node -ScriptBlock{Update-DscConfiguration -Verbose -Wait } -Credential $LocalAdmin -Verbose</code> </pre><br><br>  ุณูููู ุงูุฎุงุฏู ุจุฅุนุงุฏุฉ ุงูุชุณููุฉ ุชููุงุฆููุง ูุฅุนุงุฏุฉ ุงูุชุดุบูู.  ุงูุขู ูููููุง ุชูููุฐ ุงูุงูุถูุงู ุฅูู ุงููุฌุงู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Configuration JoinAD { param ( [Parameter()] [System.String[]] $Node, [Parameter(Mandatory = $true)] [ValidateNotNullorEmpty()] [System.Management.Automation.PSCredential] $DomainAdmin, $hostname, $domain ) Import-DscResource -ModuleName xComputerManagement Import-DscResource โModuleName PSDesiredStateConfiguration Node $Node { xComputer JoinDomain { Name = $hostname DomainName = $domain Credential = $DomainAdmin JoinOU = "OU=Servers,OU=Staging,DC=testdomain,DC=eu" } GroupSet LocalAdmins { GroupName = @( 'Administrators') Ensure = 'Present' MembersToInclude = @( 'testdomain-eu\dscstaging' ) } } } $cd = @{ AllNodes = @( @{ NodeName = $Node PSDscAllowPlainTextPassword = $false PSDscAllowDomainUser=$true Certificatefile = $CertFile Thumbprint = $Certificate.ToString() } ) } JoinAD -Node $Node -OutputPath $DscConfigPath -DomainAdmin $DomainAdmin -hostname $hostname -ConfigurationData $cd -domain $domain New-DscChecksum $DscConfigPath -Force Invoke-Command -ComputerName $Node -ScriptBlock{Update-DscConfiguration -Verbose -Wait } -Credential $LocalAdmin -Verbose</code> </pre><br><br>  ุฅููู ูุง ูุจุฏู ุนููู ููู mof: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">instance of MSFT_Credential as $MSFT_Credential1ref { Password = "-----BEGIN CMS-----\nMIIBsgYJKoZIhvcNAQcDoIIBozCCAZ8CAQAxggFKMIIBRgIBADAuMBoxGDAWBgNVBAMMD1dJTi1H\nNFFKTFFQME4xNQIQOQN77pxew75HU6l7GPn99TANBgkqhkiG9w0BAQcwAASCAQAlhFf7Zs2gJbJEnc1DEK2yWbKcO+BEyD2cr6vKHdn\nQ9TrjvbysEOvYjT15o6MccwkMEwGCSqGSIb3DQEHATAdBglghkgBZQMEASoEEEdKJT+GX4IkPezR\nwYncyQiAIAFKxwJocH4ufRsq9L2Ipkp+VQCx2ljlwif6ac4X/PqG\n-----END CMS-----"; UserName = "testdomain.eu\\service_DomainJoin_001"; }; instance of MSFT_xComputer as $MSFT_xComputer1ref { ResourceID = "[xComputer]JoinDomain"; Credential = $MSFT_Credential1ref; DomainName = "testdomain.eu"; SourceInfo = "C:\\Program Files\\WindowsPowerShell\\Scripts\\JoinAD.ps1::34::9::xComputer"; Name = "dsctest51"; JoinOU = "OU=Servers,OU=Staging,DC=testdomain,DC=eu"; ModuleName = "xComputerManagement"; ModuleVersion = "4.1.0.0"; ConfigurationName = "JoinAD"; };</code> nMIIBsgYJKoZIhvcNAQcDoIIBozCCAZ8CAQAxggFKMIIBRgIBADAuMBoxGDAWBgNVBAMMD1dJTi1H \ nNFFKTFFQME4xNQIQOQN77pxew75HU6l7GPn99TANBgkqhkiG9w0BAQcwAASCAQAlhFf7Zs2gJbJEnc1DEK2yWbKcO + BEyD2cr6vKHdn \ nQ9TrjvbysEOvYjT15o6MccwkMEwGCSqGSIb3DQEHATAdBglghkgBZQMEASoEEEdKJT + GX4IkPezR \ nwYncyQiAIAFKxwJocH4ufRsq9L2Ipkp + VQCx2ljlwif6ac4X / PqG \ ู ----- END CMS -----". <code class="plaintext hljs">instance of MSFT_Credential as $MSFT_Credential1ref { Password = "-----BEGIN CMS-----\nMIIBsgYJKoZIhvcNAQcDoIIBozCCAZ8CAQAxggFKMIIBRgIBADAuMBoxGDAWBgNVBAMMD1dJTi1H\nNFFKTFFQME4xNQIQOQN77pxew75HU6l7GPn99TANBgkqhkiG9w0BAQcwAASCAQAlhFf7Zs2gJbJEnc1DEK2yWbKcO+BEyD2cr6vKHdn\nQ9TrjvbysEOvYjT15o6MccwkMEwGCSqGSIb3DQEHATAdBglghkgBZQMEASoEEEdKJT+GX4IkPezR\nwYncyQiAIAFKxwJocH4ufRsq9L2Ipkp+VQCx2ljlwif6ac4X/PqG\n-----END CMS-----"; UserName = "testdomain.eu\\service_DomainJoin_001"; }; instance of MSFT_xComputer as $MSFT_xComputer1ref { ResourceID = "[xComputer]JoinDomain"; Credential = $MSFT_Credential1ref; DomainName = "testdomain.eu"; SourceInfo = "C:\\Program Files\\WindowsPowerShell\\Scripts\\JoinAD.ps1::34::9::xComputer"; Name = "dsctest51"; JoinOU = "OU=Servers,OU=Staging,DC=testdomain,DC=eu"; ModuleName = "xComputerManagement"; ModuleVersion = "4.1.0.0"; ConfigurationName = "JoinAD"; };</code> </pre><br><br>  ุชุดููุฑ DSC ุจูุงูุงุช ุงูุงุนุชูุงุฏ ูู ุญุณุงุจ ุฎุฏูุฉ ูู ุญููู ูุณุคูู ุงููุฌุงู: testdomain.eu \\ service_DomainJoin_001 ูุน ุดูุงุฏุฉ ูููุนุฉ ุฐุงุชููุง.  ูููู ุนููู DSC ุจููุชุงุญู ุงูุฎุงุต ุจูู ุชุดููุฑ ุจูุงูุงุช ุงูุงุนุชูุงุฏ ูุชุทุจูู ุฌููุน ูุญุฏุงุช ุงูุชูููู ูุน ุจูุงูุงุช ุงุนุชูุงุฏ ุงููุฌุงู ุงููุญุฏุฏุฉ.  ูู ูุฐู ุงูุญุงูุฉ ุ ูููุฐ ุงูุงูุถูุงู ุฅูู ุงููุฌุงู ูู ุงููุญุฏุฉ ุงูุชูุธูููุฉ ุงููุญุฏุฏุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">GroupSet LocalAdmins { GroupName = @( 'Administrators') Ensure = 'Present' MembersToInclude = @( testdomain-eu\dscstaging' ) }</code> </pre><br><br>  ุชุถูู ูุฐู ุงููุญุฏุฉ dscstaging ุฅูู ุงููุณุคูููู ุงููุญูููู ููุฒูุฏ ูู ุงูุชูููู. <br><br>  ุจุนุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู ุ ุณูุชููู ูู ุฏุฎูู ุงูุฌูุงุฒ ุจุงุณุชุฎุฏุงู ุจูุงูุงุช ุงุนุชูุงุฏ ุงููุฌุงู. <br><br>  ูุญู ูู ุงูุชุธุงุฑ ุฃู ูุชููู ุงูุฎุงุฏู ุดูุงุฏุฉ ูู PKI (ูุฏููุง ุชูููู ุชุณุฌูู ุชููุงุฆู) ููู ุงููุณุชูุจู ุณูุนูู ูุน ุงูุดูุงุฏุฉ ุงูุตุงุฏุฑุฉ ุนู PKI ุงูุฎุงุต ุจูุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$vmcert=Invoke-Command -ComputerName $server -ScriptBlock{ return Get-ChildItem -Path cert:\LocalMachine\My | where {$_.EnhancedKeyUsageList.FriendlyName -eq "Document Encryption"-and $_.Issuer -eq "CN=TestDomain Issuing CA, DC=testdomain, DC=eu"} } -ErrorAction Ignore</code> </pre> <br><br>  ุงุดุชุฑู ุงูุขู ูู Pull Server ูุฑุฉ ุฃุฎุฑู ุจุงุณุชุฎุฏุงู ุจุตูุฉ ุงูุฅุจูุงู ุงููุญุฏุซุฉ. <br><br>  ูุฐุง ูู ุดูุก ุ ุงูุฌูุงุฒ ุงููุฑุชุจุท ุจุงููุฌุงู ุ ููููููุง ุงุณุชุฎุฏุงูู ุจุงูุทุฑููุฉ ุงูุชู ุชูุงุณุจูุง. <br><br><h3 style=";text-align:right;direction:rtl">  ูู ุจุชุซุจูุช SQL Server <br></h3><br>  ูุตู ููู JSON ูุชุทูุจุงุช MS SQL Server ุ ููุง ูุณุชุฎุฏู DSC ูุชุซุจูุช SQL Server ูุชููููู.  ูุฐุง ูุง ูุจุฏู ุนููู ุงูุชูููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Configuration $Node{ WindowsFeature "NetFramework35"{ Name = "NET-Framework-Core" Ensure = "Present" Source = "\\$DscHostFQDN\Files\Updates" } WindowsFeature "NetFramework45"{ Name = "NET-Framework-45-Core" Ensure= "Present" } SqlSetup "MSSQL2012NamedInstance"{ InstanceName = $MSSQL.InstanceName Features = $MSSQL.Features ProductKey = $ProductKey SQLCollation = $MSSQL.Collation SQLSysAdminAccounts = @('testdomain-EU\SQLAdmins',' testdomain-EU\Backup') InstallSharedDir = "C:\Program Files\Microsoft SQL Server" InstallSharedWOWDir = "C:\Program Files (x86)\Microsoft SQL Server" InstallSQLDataDir = $MSSQL.DataRoot SQLUserDBDir = $MSSQL.UserDBDir SQLUserDBLogDir = $MSSQL.UserLogDir SQLTempDBDir = $MSSQL.TempDBDir SQLTempDBLogDir = $MSSQL.TempDBLogDir SQLBackupDir = $MSSQL.BackupDir SourcePath = $SQLSource SAPwd = $SA SecurityMode = 'SQL' UpdateSource = ".\Updates" Action = "Install" ForceReboot = $True SQLSvcAccount = $SqlServiceCredential AgtSvcAccount = $SqlServiceCredential ISSvcAccount = $SqlServiceCredential BrowserSvcStartupType = "Automatic" DependsOn = '[WindowsFeature]NetFramework35', '[WindowsFeature]NetFramework45' }</code> </pre><br>  ุญูุซ ูุชู ุชุนุฑูู $ MSSQL: <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$MSSQL=$Configuration.Applications | where {$_.Application -eq "Microsoft SQL Server 2012"}</code> </pre> <br><br>  $ MSSQL.InstanceName - ูู ูุฐุง ููุถุญ ูู ููู Json ุงูุฎุงุต ุจูุง.  ุณูุคุฏู ุชุทุจูู ูุฐุง ุงูุชูููู ุฅูู ุชุซุจูุช MS SQL Server ูุน ุฌููุน ุงูุชุญุฏูุซุงุช ูู ูุฌูุฏ ุงูุชุญุฏูุซุงุช ูุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู ุฅุฐุง ูุฒู ุงูุฃูุฑ. <br><br>  ุงูุณูุงุฑุฉ ุฌุงูุฒุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  ุงูุฎุฏูุฉ ุงูุขู </h2><br>  ููุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุนุฏูุฏ ูู ูุงุฌูุงุช ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงููุชุงุญุฉ</a> ูู Service-Now.  ูุญู ูุณุชุฎุฏู Rest API. <br>  ููุญุตูู ุนูู ูุงุฆูุฉ ุจุงูุขูุงุช ุฐุงุช ุงูุญุงูุฉ ุงููุฎุตุตุฉ ุ ูุชู ุงุณุชุฎุฏุงู ุงุณุชุนูุงู ุงููููุฐุฌ: <br>  example.service-now.com/cmdb_ci_server_list.doุsysparm_query=install_status=16 ^ u_subtype = ^ ORDERBYname <br>  ูู PowerShell ุ ูุจุฏู ุงูุฃูุฑ ููุง ููู: <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$url="https://instance.service-now.com/api/now/table/cmdb_ci_server?sysparm_query=install_status=16^u_subtype=^ORDERBYname" $uri= new-object System.Uri("https://instance.service-now.com/") #       $credentials = (Get-StoredCredential -Type Generic -Target DSC).GetNetworkCredential() $credentials = new-object System.Net.NetworkCredential $credentials.UserName, $credentials.SecurePassword Add-Type -AssemblyName System.Net.Http $handler = New-Object System.Net.Http.HttpClientHandler $handler.CookieContainer = New-Object System.Net.CookieContainer $handler.UseCookies=$true $handler.Credentials=$credentials $HttpClient = New-Object System.Net.Http.HttpClient($handler) $HttpClient.BaseAddress= $uri $Header = New-Object System.Net.Http.Headers.MediaTypeWithQualityHeaderValue("application/json") $HttpClient.DefaultRequestHeaders.Accept.Clear() $HttpClient.DefaultRequestHeaders.Accept.Add($Header); $response=$HttpClient.GetAsync($url) $respStream=$response.Result.Content.ReadAsStringAsync() $Servers = $respStream.Result | ConvertFrom-Json #   Configuration Items  $ServersCI=$Servers.result</code> </pre> <br>  ูุงุฆู ุงูุตููู ุงูุฃูู ูู ุงุณู ุงููุถูู ุงูุฐู ูุญุชุงุฌู. <br>  ุฅุฐุง ูุงู ุงูุฌูุงุฒ ุฌุงูุฒูุง ุ ูููููู ุชุบููุฑ ุญุงูุฉ ุงูุฌูุงุฒ ูู Service-Now ุ ููุฐุง ุงูุจุฑูุงูุฌ ุงููุตู UpdateCI.ps1: <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">param( $CI, [ValidateSet("Allocated","In use","Pending install")] $NewStatus='In use' ) $url="https://instance.service-now.com/api/now/table/cmdb_ci_server?sysparm_query=name=$CI" $uri= new-object System.Uri("https://instance.service-now.com/") $credentials = (Get-StoredCredential -Type Generic -Target DSC).GetNetworkCredential() $credentials = new-object System.Net.NetworkCredential $credentials.UserName, $credentials.SecurePassword Add-Type -AssemblyName System.Net.Http $handler = New-Object System.Net.Http.HttpClientHandler $handler.CookieContainer = New-Object System.Net.CookieContainer $handler.UseCookies=$true $handler.Credentials=$credentials $HttpClient = New-Object System.Net.Http.HttpClient($handler) $HttpClient.BaseAddress= $uri $Header = New-Object System.Net.Http.Headers.MediaTypeWithQualityHeaderValue("application/json") $HttpClient.DefaultRequestHeaders.Accept.Clear() $HttpClient.DefaultRequestHeaders.Accept.Add($Header); $response=$HttpClient.GetAsync($url) $respStream=$response.Result.Content.ReadAsStringAsync() $Servers = $respStream.Result | ConvertFrom-Json $ServerCI=$Servers.result[0] $update=@{} if($NewStatus -eq "In use"){ $update.install_status=1 } if($NewStatus -eq "Pending install"){ $update.install_status=4 } $stringcontent = New-Object System.Net.Http.StringContent((ConvertTo-Json -InputObject $update -Depth 100),[System.Text.Encoding]::UTF8, "application/json"); $result=$HttpClient.PutAsync("https://instance.service-now.com/api/now/table/cmdb_ci_server/$($ServerCI.sys_id)", $stringcontent)</code> </pre> <br>  ููุญุตูู ุนูู ุงูุฌุฏูู ูุงูุณุฌูุงุช ุ ูุชู ุงุณุชุฎุฏุงู ุทูุจุงุช RET API GET ุ ูุชุบููุฑ ุทูุจุงุช ุงูุชุณุฌูู PUT / POST ุ ุงูุชู ุชุญุชุงุฌ ุฅูู ุชุบููุฑ ุญููููุง ูู ุงููุต. <br><br>  <i>ููุฏ ุฃูุดุฃูุง ุฃุฏุงุฉ ููุงุณุจุฉ ุจุงุณุชุฎุฏุงู ุฃุฏุงุฉ ุฑุณูููุฉ ูุซู Azure Portal ุ ูุงูุชู ุชุชูุญ ููุง ุฅุฏุงุฑุฉ ุงูุจููุฉ ุงูุชุญุชูุฉ ุงูุฏุงุฎููุฉ ูุฏุฑ ุงูุฅููุงู ููุง ููุนููุงุฆูุง.</i> <br>  PS 12.24.2018.  ูู ูุจุฏู ุฃู ูู ุดูุก ูุฏููุ  ุญุงู ุงูููุช ูุงุณุชุฎุฏุงู Azure DevOps.  ูู ุงูููุงูุฉ ุงูุชุงููุฉ ุ ุณุฃูุถุญ ูู ููููุฉ ุงูููุงู ุจูู ูุฐุง ูุน ุฎุท ุฃูุงุจูุจ Azure DevOps. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar425129/">https://habr.com/ru/post/ar425129/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar425113/index.html">"ุงูุทุจุงุนุฉ ุงูุฑูููุฉ" ุฃู ุชุฌุฑุจุชู ูู ุงูุฑูููุฉ ุงูุฑูููุฉ ูููุชุจ</a></li>
<li><a href="../ar425115/index.html">DevOps ุงููุงููุฉ: ุงููุฃุณุงุฉ ุงููููุงููุฉ ูู ุซูุงุซุฉ ุฃุนูุงู</a></li>
<li><a href="../ar425117/index.html">ุจุชุชุงู ููู ุชุฑุงูุฒุณุชูุฑ: ุฐุงูุฑุฉ ROM ุนุงููุฉ ุงููุซุงูุฉ ูู ุดุฑูุญุฉ Intel 8087 ุนุงุฆูุฉ</a></li>
<li><a href="../ar425123/index.html">ุงูููุจ ุงูุบุงูุถ ูุขูุฉ ุงูุทุจู Roland TR-808</a></li>
<li><a href="../ar425125/index.html">Pythonetc ุณุจุชูุจุฑ 2018</a></li>
<li><a href="../ar425131/index.html">ูุง ูุฌุจ ุฃู ุชูุฑุฃู ุนู ุชูููุฉ blockchain: ุงูุฃุฏูุฉ ูุงููุชุจ ูุงูููุงูุงุช</a></li>
<li><a href="../ar425133/index.html">ูุดุงูู ุงูุฏูุน ุนุจุฑ ุงูุญุฏูุฏ - ููุงุฐุง ูููู ูุชู ุงุณุชุฎุฏุงู blockchain ููุง</a></li>
<li><a href="../ar425135/index.html">ููุงุฐุง ูุนุชุจุฑ VoIP ุฎุฏูุฉ ูุนูููุงุช ูู ุงูููุงูุงุช ุงููุชุญุฏุฉ ุงูุฃูุฑูููุฉ ุ ููุงุฐุง ูุนูู ุจุงููุณุจุฉ ูุตูุงุนุฉ ุงูุงุชุตุงูุงุช ูุงููุณุชุฎุฏููู</a></li>
<li><a href="../ar425137/index.html">ูุญู ูุนูู ูู ูุญุฏุฉ ุงูุชุญูู ุจุณุฑุนุฉ ูููุงุกุฉ</a></li>
<li><a href="../ar425139/index.html">ูุฌูู ุงูุจูุจ โโุชุญุช ุนุฏุณุฉ ุงูุฐูุงุก ุงูุงุตุทูุงุนู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>