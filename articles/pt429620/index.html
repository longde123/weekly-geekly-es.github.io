<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï¥üèΩ üê£ ‚ìÇÔ∏è Como eu criei mapas dos continentes para o meu jogo üí≥ üõí üóÑÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Parte 1. SVG e sistemas de coordenadas 
 At√© recentemente, os tamanhos dos mapas no meu jogo Dragons Abound eram fixos e um pouco n√£o determin√≠sticos....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como eu criei mapas dos continentes para o meu jogo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429620/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/327/2a8/d08/3272a8d0885e3e2f041a6f2bdb7400c9.png" alt="imagem"></div><br><h2>  Parte 1. SVG e sistemas de coordenadas </h2><br>  At√© recentemente, os tamanhos dos mapas no meu jogo <i>Dragons Abound</i> eram fixos e um pouco n√£o determin√≠sticos.  Eu os considerei ‚Äúregionais‚Äù - n√£o mapas de todo o mundo, mas suas partes significativas, como, por exemplo, a costa oeste dos EUA ou parte da Europa.  Fiquei muito feliz com essa escala, mas queria experimentar um pouco o jogo para ver se conseguia gerar mapas de todo o mundo (ou pelo menos um maior).  Mas antes de come√ßar, vamos falar um pouco sobre os mapas do mundo da fantasia. <br><br>  O mundo √© um grande espa√ßo.  A maioria dos cart√µes "mundiais" de fantasia nem se parece com o tamanho real.  Tomemos, por exemplo, a Terra M√©dia, na qual a a√ß√£o do Senhor dos An√©is ocorre: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/90f/bc8/9f3/90fbc89f36ab284a974be18c66909558.jpg"></div><br>  Embora pare√ßa que um mundo imenso seja capturado nele, de fato, a Terra-m√©dia foi criada com base na Europa. <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a0/e6d/d95/7a0e6dd9576841e7ecf87babf2a66b93.webp"></div><br>  Ou seja, o mapa real do ‚Äúmundo‚Äù para o mundo Tolkien ser√° aproximadamente 50 vezes maior que o mapa da Terra-m√©dia (!).  De fato, a maioria dos mapas mundiais de fantasia que vi refletem um territ√≥rio do tamanho de um continente: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c95/17a/90e/c9517a90ef51440cda257b2300ba591e.png"></div><br>  Esta parece ser a maior √°rea que √© bem visualizada no estilo de cartas de fantasia. <br><br>  Ou seja, a tarefa de gerar "mapas do mundo" reais √© provavelmente muito ambiciosa.  √â melhor procurar criar um mapa do continente (ou parte do continente).  (No entanto, ainda √© mais conveniente considerar o cart√£o como o tamanho do "mundo"). Ent√£o, qual √© o tamanho do cart√£o?  Se os <i>cards</i> atuais dos <i>Dragons Abound</i> t√™m um tamanho "subcontinental", podemos assumir que voc√™ precisa gerar cards 8 a 10 vezes maiores. <br><br>  Antes de passar √† tarefa de gerar mapas grandes, preciso entender melhor os v√°rios sistemas de coordenadas que s√£o usados ‚Äã‚Äãno meu jogo.  Peguei emprestado muitos sistemas de coordenadas do c√≥digo-fonte de Martin O'Leary e suas intera√ß√µes podem ser confusas, mesmo quando voc√™ trabalha com eles por dois anos.  Normalmente, eu era capaz de fazer isso sem experimentar com eles, mas √© √≥bvio que precisarei fazer isso para gerar mapas grandes. <br><br>  Para come√ßar, o "mundo" do mapa regional est√° sendo gerado atualmente dentro de um quadrado de unidade.  Cada mapa regional possui coordenadas de (-0,5, -0,5) a (0,5, 0,5) e a origem (0,0) fica no meio da regi√£o. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/201/c65/c30/201c65c30244efe1e6cd4bd47e07b901.png"></div><br>  Uma das peculiaridades aqui √© que o eixo Y √© invertido em compara√ß√£o com o que estudamos em geometria escolar.  -0,5 est√° na parte superior do mapa e 0,5 est√° na parte inferior.  Na computa√ß√£o gr√°fica, o eixo Y geralmente √© invertido.  Ouvi dizer que isso √© explicado pela maneira como os primeiros monitores (TVs) realizam uma varredura de cima para baixo, ou seja, a primeira linha de varredura fica na parte superior, a seguinte imediatamente abaixo dela, e assim por diante, ou seja, o √≠ndice Y das linhas de varredura mudou de zero na parte superior para algum n√∫mero positivo l√° embaixo.  Seja como for, o mesmo sistema de coordenadas √© usado no formato SVG (Scalable Vector Graphics), e √© por isso que os <i>Drag√µes</i> tamb√©m s√£o <i>abundantes</i> . <br><br>  Este sistema de coordenadas √© independente de como o mapa √© exibido.  Este √© apenas um sistema sem dimens√£o para criar o mundo - a cidade est√° localizada em (0,12875, -0,223), a fronteira passa de (0,333, 0,010) a (0,333, 0,017) e assim por diante.  E, embora meus mapas regionais atuais estejam limitados a um intervalo de 0,5 a -0,5, esse n√£o √© o limite do sistema de coordenadas.  Eu posso criar um mundo al√©m desses limites. <br><br>  O pr√≥ximo sistema de coordenadas √© o que o SVG chama de viewbox.  Ele define as verdadeiras coordenadas que ser√£o usadas para desenhar os gr√°ficos.  Por exemplo, <i>Dragons Abound</i> no in√≠cio define a caixa de visualiza√ß√£o com as coordenadas (-500, -500) e tem uma largura de 1000 e uma altura de 1000: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/509/4f4/e4f/5094f4e4f04889dcc9f389fba59d2b24.png"></div><br>  (H√° um erro de digita√ß√£o na imagem, a parte superior do eixo Y deve ser -500, desculpe.) <br><br>  Voc√™ pode notar que, nesse caso, a transforma√ß√£o entre o primeiro e o segundo sistema de coordenadas consiste apenas na multiplica√ß√£o de todos por 1000. Isso √©.  para desenhar algo, o jogo encontra as coordenadas desse objeto, multiplica-as por 1000 e desenha SVG nessas coordenadas. <br><br>  Ou seja, posso usar as coordenadas da caixa de exibi√ß√£o para desenhar uma linha de (0, 0) a (250, 250).  Mas, de fato, n√£o quero desenhar uma linha de (0, 0) a (250, 250) na tela do computador.  Isso significa que, se eu quiser exibir o mapa em outro ponto da tela, terei que alterar as coordenadas de todos os objetos do mapa e redesenh√°-los.  Isso seria um trabalho enorme. <br><br>  Para controlar as coordenadas da exibi√ß√£o de gr√°ficos na tela, o SVG possui um terceiro sistema de coordenadas chamado viewport.  A janela de visualiza√ß√£o √© a parte da p√°gina na qual os gr√°ficos devem ser desenhados (na p√°gina da web, esse √© o elemento &lt;svg&gt;).  Tem largura, altura e localiza√ß√£o.  A localiza√ß√£o √© as coordenadas do canto superior esquerdo da janela de visualiza√ß√£o.  Ou seja, se eu exibisse o mapa na viewport com coordenadas (30, 100), que tem altura e largura de 800, o sistema de coordenadas da viewport ficaria assim: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/746/73e/f51/74673ef51f001d21b7871382c5dc0638.png"></div><br>  No SVG, a caixa de visualiza√ß√£o e a porta de visualiza√ß√£o dos sistemas de coordenadas s√£o conectadas uma √† outra, e o pr√≥prio SVG lida com a transi√ß√£o entre elas.  Simplesmente desenhamos o sistema de coordenadas da caixa de visualiza√ß√£o e tudo o que √© renderizado √© exibido no local da janela de visualiza√ß√£o correspondente.  (Existem alguns problemas ao criar uma viewbox e uma viewport com diferentes propor√ß√µes. Em seguida, os objetos s√£o cortados ou esticados, dependendo do valor do atributo <code>preserveAspectRatio</code> . Recomendo n√£o fazer isso.) <br><br>  Para resumir: uma cidade localizada nas coordenadas do mundo (0,10, 0,33) √© desenhada nas coordenadas (100, 330) e exibida na tela em (110, 764). <br><br>  Agora voc√™ pode entender por que isso pode ser confuso! <br><br>  O que acontece se eu alterar cada um desses sistemas de coordenadas?  Suponha que no primeiro sistema de coordenadas eu gere um mundo variando de -0,25 a 0,25 em cada eixo.  O mundo resultante ser√° quatro vezes menor que o mundo usual e preencher√° apenas a parte do meio da janela de exibi√ß√£o: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/894/11c/6c2/89411c6c2b1975f8512548a487191648.png"></div><br>  (Voc√™ tamb√©m pode observar artefatos nas bordas, que geralmente est√£o ocultos.) Da mesma forma, se eu dobrar o tamanho do primeiro sistema de coordenadas (SK), n√£o veremos a maior parte do mapa, pois estar√° fora das bordas da janela de visualiza√ß√£o. <br><br>  O que acontece se eu dobrar o tamanho da caixa de visualiza√ß√£o?  Bem, se eu tamb√©m dobrar a propor√ß√£o entre o primeiro SC e a caixa de visualiza√ß√£o (de 1000 a 2000), nada mudar√° muito.  Se a propor√ß√£o permanecer igual a 1000, o mapa ser√° dividido pela metade novamente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/859/f79/dfe/859f79dfe453741087cedce2d6918e16.png"></div><br>  No entanto, desta vez o cart√£o tem uma √°rea inicial de 1x1.  Podemos observar novamente artefatos nas bordas que geralmente est√£o ocultas (por exemplo, partes convexas das florestas).  Voc√™ tamb√©m pode ver que o padr√£o do oceano est√° errado - devo ter feito algumas suposi√ß√µes sobre o tamanho da caixa de visualiza√ß√£o.  Al√©m disso, parece que a b√∫ssola n√£o est√° localizada no canto do mapa, mas no canto da caixa de visualiza√ß√£o. <br><br>  E vice-versa, se eu reduzir o tamanho da caixa de exibi√ß√£o pela metade, isso criar√° um efeito de zoom no mapa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/26e/f0e/f8e/26ef0ef8e0a2db5298de4720d12193fe.png"></div><br>  Aqui vemos apenas o quarto do meio do mapa.  Essa n√£o √© uma maneira muito conveniente de ampliar, porque apenas metade do mapa apresenta alguns problemas - por exemplo, o marcador da cidade "South Owenson" foi al√©m da tela.  Al√©m disso, ele dobra o tamanho das fontes e outras coisas que eu n√£o preciso. <br><br>  Um aspecto mais √∫til da caixa de visualiza√ß√£o est√° mudando a origem.  At√© o momento, a caixa de visualiza√ß√£o foi centralizada no mapa, mas isso n√£o √© necess√°rio.  Por exemplo, posso mover o mapa para a direita centralizando a caixa de visualiza√ß√£o em um ponto no lado esquerdo do mapa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/970/bbf/662/970bbf662eb73852a4140af450c48fb8.png"></div><br>  Podemos notar novamente os efeitos nas fronteiras e alguns outros problemas, mas, em ess√™ncia, o mapa foi movido para a direita.  A utilidade disso pode n√£o ser √≥bvia, mas imagine que eu gerarei um mapa cuja largura seja duas vezes a largura de um mapa regular.  Por padr√£o, fica assim: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/327/fee/3ad/327fee3add9790b0a73a32d7e1ee04cf.png"></div><br>  Parece com qualquer outro mapa, mas, na realidade, √© apenas a parte central de um mapa maior.  Ou seja, agora eu posso alterar a caixa de visualiza√ß√£o para transferir outras partes do mapa para a janela de vis√£o geral: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/327/2a8/d08/3272a8d0885e3e2f041a6f2bdb7400c9.png"></div><br>  Aqui movi o ponto de vista para a esquerda, para ver uma parte do mundo a leste da vista original.  Alguns nomes no mapa foram alterados porque o <i>Dragons Abound</i> executa determinadas fun√ß√µes (por exemplo, atribui nomes aos objetos) com base em sua visibilidade.  Vou precisar mudar isso para que, ao mover a caixa de visualiza√ß√£o, o mapa permane√ßa constante.  No entanto, mais tarde poderei mover a caixa de visualiza√ß√£o em um mapa grande e gerar mapas regionais de qualquer √°rea desejada.  Ou seja, eu posso gerar e exibir mapas grandes do tamanho de um continente, mas tamb√©m posso gerar mapas regionais de √°reas dentro de um mapa grande. <br><br>  Resumindo: o jogo usa tr√™s sistemas de coordenadas.  O primeiro √© um SC abstrato para os objetos do mundo.  A segunda √© a caixa de visualiza√ß√£o, que define a √°rea vis√≠vel do mundo.  A terceira √© a janela de visualiza√ß√£o, que controla onde o mapa ser√° desenhado na tela.  Para desenhar um mundo maior, preciso expandir o primeiro SC.  Para exibir mais na tela, voc√™ precisa expandir a caixa de visualiza√ß√£o.  Tamb√©m posso mover a caixa de exibi√ß√£o para exibir diferentes partes do grande mundo. <br><br><h2>  Parte 2. Tornando os cart√µes permanentes </h2><br>  Na parte anterior, explorei os sistemas de coordenadas e aprendi como mover o SVG da janela de exibi√ß√£o para exibir apenas partes individuais do grande mundo.  No entanto, essa abordagem tem alguns problemas, porque anteriormente assumi que tudo o que √© invis√≠vel para n√≥s n√£o importa.  Nesta parte, eliminarei essas suposi√ß√µes para que seja poss√≠vel gerar e visualizar diferentes partes de mapas grandes imut√°veis. <br><br>  O problema com a localiza√ß√£o dos nomes, que descrevi na parte anterior, √© obviamente percept√≠vel nesses dois tipos de um cart√£o: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/327/fee/3ad/327fee3add9790b0a73a32d7e1ee04cf.png"></div><br>  Aqui √© o mesmo mundo, apenas a vis√£o √© deslocada para a esquerda: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/327/2a8/d08/3272a8d0885e3e2f041a6f2bdb7400c9.png"></div><br>  Voc√™ pode perceber que a geografia √© a mesma, mas muitos nomes foram alterados.  Como em dois tipos diferentes objetos s√£o vis√≠veis e o processo de cria√ß√£o de nomes √© controlado por n√∫meros aleat√≥rios, nomes diferentes s√£o obtidos. <br><br>  Olhando para o c√≥digo, descobri que quase todos os objetos recebem nomes, dependendo de sua visibilidade.  Mas h√° apenas uma exce√ß√£o que dificulta atribuir nomes a todos os objetos subseq√ºentes.  No nosso caso, a exce√ß√£o √© que os <i>Dragons Abound</i> geram apenas linhas costeiras vis√≠veis.  As raz√µes para isso s√£o muito confusas.  De fato, existe um ‚Äúlitoral‚Äù ao longo de todo o mundo, mas a cria√ß√£o dessa linha destr√≥i parte da l√≥gica do programa, porque abrange o mundo inteiro.  Para evitar isso, acabei de gerar apenas o litoral vis√≠vel.  Agora que o mapa pode se expandir muito al√©m da janela de visualiza√ß√£o, esta solu√ß√£o n√£o parece boa.  Em vez disso, preciso parar de gerar linhas costeiras quando me aproximar da borda real do mapa.  (Que ainda deixo fora da tela para ocultar problemas nas bordas.) <br><br>  Depois de eliminar esse problema, os nomes nas duas placas permanecem constantes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/39b/908/a83/39b908a83146f3161397cda6fbcba045.png"></div><br>  e: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6af/322/ad4/6af322ad4cb57591a51748243a8ac02e.png"></div><br>  Outra observa√ß√£o para o futuro: se eu usar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">recurso de interatividade</a> para alterar os nomes dos objetos do mapa, essa altera√ß√£o n√£o ser√° recriada em sua forma atual e provavelmente nem ser√° reproduz√≠vel.  Vale a pena considerar. <br><br>  Se voc√™ olhar atentamente para o mapa anterior, poder√° ver que a √°rea oce√¢nica pr√≥xima √† parte central inferior do mapa tem um r√≥tulo pendurado ‚ÄúMeb Island‚Äù.  Isso aconteceu porque os <i>Drag√µes Abundam</i> realmente acreditam que a regi√£o do oceano √© uma ilha.  N√£o entrarei em detalhes t√©cnicos, mas √© surpreendentemente dif√≠cil distinguir ilhas de lagos quando elas v√£o al√©m do mapa.  O algoritmo √© confuso com a mudan√ßa que fiz na gera√ß√£o de linhas costeiras invis√≠veis e, para evitar esses problemas, isso precisa ser corrigido. <br><br>  Agora vamos quadruplicar o tamanho do mapa e mostrar apenas um quarto dele na janela do mapa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f40/81f/8d4/f4081f8d4d2ac9dd3d7d35077ba23450.png"></div><br>  Em geral, tudo parece bom (existe um sistema interessante de rios no mapa, um lago grande, mas voc√™ pode ver que as cidades s√£o muito raras. Isso aconteceu porque os <i>Dragons Abound</i> geram de 10 a 20 cidades. Esse intervalo √© adequado para um mundo de tamanho normal, mas ruim, quando o tamanho √© quatro vezes maior, portanto, o intervalo precisa ser alterado de acordo com o tamanho relativo do mundo, e provavelmente em v√°rios locais. <br><br>  Aqui est√° o mesmo cart√£o ap√≥s corrigir o problema: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/821/113/b40/821113b400ab683c8fdfad87bccf3213.png"></div><br>  Agora, no mapa, h√° um n√∫mero mais l√≥gico de cidades e vilas, mas isso nos mostra outro problema.  Voc√™ pode ver muitos nomes extras nas bordas do mapa, por exemplo, Nanmrummombrook, Marwynnley e Noyewood no canto inferior esquerdo.  Isso acontece porque o m√©todo do c√≥digo de canal tenta coloc√°-los onde est√£o vis√≠veis.  Anteriormente, esse procedimento nunca precisava se preocupar com etiquetas fora da tela, porque em mapas de tamanho regional o mundo inteiro geralmente √© vis√≠vel.  Mas agora pode haver cidades e outros objetos localizados fora da tela.  Portanto, preciso adicionar l√≥gica ao procedimento de posicionamento de r√≥tulos que n√£o tenta criar r√≥tulos para objetos de mapa invis√≠veis. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b9d/022/b5a/b9d022b5a3c22d9f7e1f4c5e7c24771e.png"></div><br>  Agora a imagem √© mais l√≥gica.  √Ä direita, Cumden mal est√° vis√≠vel no mapa, mas o r√≥tulo ainda est√° localizado onde est√° vis√≠vel. <br><br>  H√° um aspecto que n√£o √© imediatamente percept√≠vel em mapas grandes: o n√∫mero de locais no mundo n√£o mudou.  Embora o mapa (em certo sentido) tenha se tornado quatro vezes maior, sua √°rea total ainda √© limitada pelo mesmo n√∫mero de locais.  O est√°gio inicial da gera√ß√£o de mapas era cobrir o mundo com um diagrama de Voronoi com um n√∫mero constante de locais.  Ou seja, quando o mapa se torna maior, as c√©lulas de Voronoi tamb√©m se tornam maiores. <br><br>  Seria l√≥gico escalar o n√∫mero de locais de acordo com o tamanho do mapa, mas, infelizmente, a depend√™ncia da velocidade de execu√ß√£o dos <i>Drag√µes Abundados</i> no n√∫mero de locais √© muito pior que a linear, ou seja, gerar um mapa com um grande n√∫mero de locais pode levar muito tempo.  Aqui est√° um exemplo de um cart√£o com resolu√ß√£o quad (n√∫mero de locais): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4bc/faa/7a6/4bcfaa7a64abf56cb1cf4aab84651215.png"></div><br>  Os locais adicionados alteram o processo de gera√ß√£o, portanto o terreno √© diferente dos mapas mostrados acima, mas nele voc√™ pode ver os detalhes adicionados nas costas. <br><br>  Felizmente, ao analisar o desempenho da gera√ß√£o de cart√µes grandes, notei que a maior parte do tempo do processador √© ocupada por problemas √≥bvios.  Ap√≥s a depura√ß√£o, eliminei os mais perturbadores, o que me permitiu criar mapas ainda mais.  Aqui est√° o cart√£o 4x completo: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/149/6f4/600/1496f4600dc18c1ffa955580e07d7161.png"></div><br>  Zoom de 25% realizado.  Parece mais ou menos o tamanho m√°ximo do mapa que o Chrome pode exibir.  O procedimento de gera√ß√£o mundial pode processar mapas maiores, mas, ao tentar exibi-los, o navegador trava.  Nesse sentido, o Firefox parece ser mais funcional;  Pode exibir cart√µes 9 vezes maiores que o tamanho original.  Aqui est√° parte desse mapa - eu o deixei em tamanho real, para que voc√™ possa abri-lo em uma janela separada para entender melhor o tamanho e os detalhes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15f/1a2/c98/15f1a2c98b85e749101f0a379e7b9937.png"></div><br>  O Firefox √© capaz de gerar mapas desse tamanho, mas s√≥ posso tirar capturas de tela no tamanho m√°ximo da janela do navegador.  Eu tenho uma fun√ß√£o para salvar o mapa como um arquivo PNG, mas ele pode salvar apenas a parte exibida do mapa.  Eu acho que voc√™ pode rolar o mapa, capturar telas individuais e conect√°-las, mas isso consumir√° muito tempo. <br><br>  A melhor solu√ß√£o √© salvar o pr√≥prio SVG para que ele possa ser aberto em um programa como o Inkscape. <br><br>  Eu costumava ser capaz de recortar e colar mapas SVG no Inkscape, mas os SVGs para mapas mundiais s√£o t√£o grandes que, quando tento cortar o navegador, ele trava!  Felizmente, encontrei o <a href="">FileSaver.js</a> e voc√™ pode us√°-lo para salvar o SVG diretamente em um arquivo e abri-lo no Inkscape, criando uma imagem muito grande. <br><br>  Pelo menos teoricamente.  Quando tento abrir esses mapas no Inkscape, encontro alguns problemas. <br><br>  O primeiro problema √© que as suposi√ß√µes do Inkscape s√£o diferentes das suposi√ß√µes do Chrome e Firefox em como abrir o SVG.  Em particular, se a cor do preenchimento n√£o for especificada no caminho, os navegadores assumir√£o que n√£o h√° preenchimento;  O Inkscape assume que o contorno est√° preenchido com preto.  Portanto, quando abro o SVG salvo no Inkscape, ele fica quase completamente preto, porque a camada superior do mapa n√£o cont√©m uma cor de preenchimento.  Isso pode ser corrigido especificando ‚Äúfill: none‚Äù nos locais necess√°rios, para que os contornos apare√ßam igualmente no navegador e no Inkscape. <br><br>  O segundo problema √© que o Inkscape apresenta erros no processamento de m√°scaras.  O Inkscape parece criar m√°scaras com apenas um elemento e lida mal com m√°scaras com v√°rios elementos.  <i>Dragons Abound</i> cria muitas m√°scaras com v√°rios elementos.  Voc√™ pode solucionar esse problema agrupando todos os elementos de cada m√°scara de jogo em um elemento de grupo (opcional). <br><br>  O terceiro problema est√° relacionado a imagens e outros recursos para download.  No SVG original, as refer√™ncias a eles s√£o indicadas em forma relativa, por exemplo, "images / background0.png".  Minhas fontes s√£o organizadas de forma que o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">servidor Web separado que eu use</a> possa encontrar esses recursos nos locais especificados.  Quando eu pego o mesmo SVG e o abro no Inkscape, esses caminhos relativos s√£o tratados como o URL ‚Äúfile:‚Äù e o Inkscape procura recursos relacionados √† pasta em que o SVG foi salvo.  Esse problema pode ser facilmente contornado salvando o SVG em uma pasta na qual j√° existem recursos nos lugares certos;  pode ser a mesma pasta raiz usada pelo servidor da Web ou outro local em que h√° c√≥pias de recursos nos mesmos caminhos (relativos). <br><br>  O quarto problema s√£o as fontes.  <i>Dragons Abound</i> usa fontes da Web e fontes armazenadas localmente;  ambos no formato WOFF2.  No navegador, eles s√£o aplicados ao texto usando o estilo de fam√≠lia de fontes CSS e, antes de gerar o mapa, todas as fontes poss√≠veis s√£o carregadas na p√°gina da Web para estarem prontas para uso.  Quando o mesmo arquivo √© aberto no jogo, ele procura por fontes no diret√≥rio de fontes do sistema e parece que nenhum outro diret√≥rio de fontes pode ser especificado de forma alguma.  Uma solu√ß√£o simples (pelo menos na m√°quina em que estou desenvolvendo) √© instalar as fontes usadas pelo jogo no diret√≥rio de fontes do sistema.  No entanto, n√£o √© t√£o simples quanto parece, porque os nomes das fontes devem corresponder e, no Windows, n√£o h√° maneiras f√°ceis de alterar o nome da fonte.  Mas, √© claro, esse esquema n√£o funcionar√° em computadores nos quais todas as fontes necess√°rias n√£o estejam instaladas.  Uma solu√ß√£o mais port√°til √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">incorporar fontes SVG nos mapas</a> .  Isso estar√° na minha lista de tarefas. <br><br>  No final, cheguei a essa interface de gera√ß√£o de mapas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/88e/e69/c3b/88ee69c3b069b7c369cbf3921b6a3eba.png"></div><br>  Os campos de entrada de extens√£o especificam o tamanho total do mundo, onde 1x1 √© o tamanho dos mapas de origem.  O tamanho da vbx (caixa de visualiza√ß√£o) determina o tamanho de um fragmento do mundo exibido no mapa;  na captura de tela, tamb√©m possui um valor de 1x1, ou seja, o mapa exibir√° o mundo inteiro.  Os campos vbx center especificam a localiza√ß√£o do centro do mapa no mundo;  0, 0 √© o centro do mundo.  Por fim, os par√¢metros SVG especificam o n√∫mero de pixels da tela por 1 unidade de tamanho da caixa de visualiza√ß√£o;  no valor de 775, um mapa 1x1 ser√° exibido na tela no valor de 775x775 pixels.  Isso √© conveniente quando eu crio um mapa muito grande.  Ao definir o par√¢metro como um valor baixo (por exemplo, 150 pixels), posso ajustar um mapa grande na tela como um todo. <br><br>  Alterando esses seis par√¢metros, posso controlar o tamanho do mundo e a fra√ß√£o do mundo que √© exibida no mapa.  O bot√£o Gerar funciona exatamente como voc√™ pode imaginar;  o bot√£o Exibir simplesmente exibe uma parte do mundo, ou seja, eu posso gerar um mundo e, em seguida, exibir suas partes individuais, alterando os par√¢metros da caixa de visualiza√ß√£o sem a necessidade de gerar novamente o mundo.  (Um programador implementaria isso melhor como escala e rolagem.) O bot√£o Salvar PNG salva o mapa vis√≠vel como um arquivo PNG;  O bot√£o Salvar SVG salva o arquivo SVG de todo o mapa.  O bot√£o Testar √© usado para executar o c√≥digo de teste, que muda durante o desenvolvimento de v√°rias fun√ß√µes. <br><br>  Agora que posso gerar e refletir todas as partes do grande mundo, posso adaptar a forma da terra a mapas maiores. <br><br><h2>  Parte 3. Formas de Sushi </h2><br>  Tendo feito v√°rias altera√ß√µes na parte anterior, agora posso gerar mundos muito maiores que os anteriores (at√© 8 vezes mais) e salv√°-los como grandes imagens gr√°ficas: <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/963/31e/c94/96331ec940b59a6f349603f0024f5cc7.png"></a> </div><br>  (Abra a imagem em uma janela separada para ver o mapa em resolu√ß√£o m√°xima de 4800x2400 no Flickr.) <br><br>  Eu gero esses mapas usando a mesma gera√ß√£o de procedimentos que criou os mapas regionais.  O mapa mostrado acima tem uma forma continental bastante regular e algumas ilhas externas interessantes.  No entanto, depende principalmente da sorte.  Aqui est√° outro mapa: <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/b03/406/fd1/b03406fd17f93c9e33cd8dd488b404c3.png"></a> </div><br>  Este cart√£o √© apenas o caos das ilhas e queijo de sushi su√≠√ßo. <br><br>  Aqui est√° outro exemplo, algo entre as duas cartas anteriores.  N√£o √© completamente realista, mas pode ser interessante para ambientes de fantasia: <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/7c3/c79/e98/7c3c79e98246dde23f7104428e9cf9b2.jpg"></a> </div><br>  √â uma enorme massa continental de terra, mas existem muitas formas estranhas de terra e, em geral, o mundo n√£o parece "real".  (Embora para algu√©m como esse mundo pare√ßa bastante adequado para a fantasia.) Ent√£o, que formas o mapa do "mundo" deve ter? <br><br>  A maioria dos mapas mundiais de fantasia que vi representam um grande continente insular (com pequenas ilhas ao redor), por exemplo, como este mapa de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Andelen</a> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/926/3f4/fb8/9263f4fb80cf2899f48693c31aa2566a.png"></div><br>  Ou a pen√≠nsula do continente, como neste mapa de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Angorun</a> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/75c/ef4/bc1/75cef4bc1d0e698c2a76ee77bfc74bd0.png"></div><br>  De tempos em tempos, um mapa √© feito inteiramente de terra ou de v√°rios continentes da ilha, mas √© mais prov√°vel que sejam exce√ß√µes √† regra. <br><br>  Para come√ßar, vamos descobrir a gera√ß√£o de continentes "insulares".  Como se v√™ no meu jogo, j√° havia uma fun√ß√£o que gera uma grande ilha central no mapa, levando em considera√ß√£o o tamanho do mapa; portanto, ela deve ser adequada para gerar a forma principal do continente.  Ru√≠do e ilhas adicionais cuidam do resto. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0a7/86e/0b5/0a786e0b59241b451f3c225c23328a47.png"></div><br>  Eu n√£o esperava um grande mar central neste mapa, mas √© uma surpresa agrad√°vel.  Aqui est√° outro exemplo: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f58/a14/788/f58a14788a7dbcd6fbaa25c9fb45457e.png"></div><br>  O problema com a fun√ß√£o da ilha central √© que ela come√ßa com um c√≠rculo que √© adequado para os mapas quadrados mostrados por mim, mas n√£o muito bom para os retangulares.  (Abaixo est√£o exemplos com uma pequena distor√ß√£o, para que as formas b√°sicas sejam mais claramente vis√≠veis.) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/30b/b43/073/30bb430737122e671fb2f2067fafea08.png"></div><br>  Isso √© facilmente corrigido mascarando o sushi em vez de um c√≠rculo com uma elipse (distorcida) obtida pelo tamanho do mapa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/393/7a9/2ea/3937a92ea08cd752739550bf59a89971.png"></div><br>  Essas ilhas centrais s√£o dimensionadas para preencher o mapa, mas em muitos casos, para mapas continentais, precisamos deixar uma ‚Äúfronteira‚Äù ao redor do continente.  Dois par√¢metros controlam o tamanho do mapa que preenche a ilha ao longo dos eixos X e Y. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad4/b00/94e/ad4b0094e542930350a964377888a640.png"></div><br>  Aqui est√° o mesmo sistema de gerenciamento de fronteiras com distor√ß√µes mais l√≥gicas: <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/357/9e1/121/3579e11217c879a587f11b30380e94b9.png"></a> </div><br>  Pode-se ver que as partes leste e oeste do mapa permanecem o oceano.  (Voc√™ pode abrir o mapa em uma janela separada para estud√°-lo com mais cuidado.) Isso significa que o mapa exibe o mundo inteiro (e suas bordas direita e esquerda podem ser conectadas) ou uma parte do mundo que pode ser conectada a outro mapa que tamb√©m possui um oceano a partir da borda correspondente. <br><br>  Um leitor atento que estudou o mapa anterior pode ter notado que os padr√µes do oceano e da terra param no meio do mapa.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anteriormente, eu tinha mapas com tamanho apenas 1x1, ent√£o os tamanhos dos padr√µes do oceano e da terra eram adaptados a esses mapas. Em mapas maiores, preciso ladrilhar manualmente os padr√µes no mapa, ent√£o adicionei esse recurso. (Existe uma maneira no SVG de executar a cria√ß√£o de mosaicos de padr√µes, mas no Chrome ele cont√©m um erro, portanto n√£o posso us√°-lo.) Essa √© uma boa fun√ß√£o, porque agora posso usar padr√µes menores de terra e oceano que ser√£o automaticamente agrupados. N√£o sei por que n√£o percebi isso antes! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, agora os continentes da ilha est√£o funcionando bem e passaremos √† implementa√ß√£o dos continentes ‚Äúpeninsulares‚Äù - mapas nos quais o continente aparece no mapa a partir de sua borda.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d9e/d75/914/d9ed75914bd6b4deaae08fb687b828e2.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesse caso, o continente n√£o pode entrar em colapso em tr√™s arestas. </font><font style="vertical-align: inherit;">Mas a principal caracter√≠stica desses mapas √© que eles t√™m uma conex√£o terrestre significativa entre o continente exibido no mapa e a terra fora do mapa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A maneira mais f√°cil de fornecer essa conex√£o fora do mapa √© definir um n√≠vel do mar baixo durante a gera√ß√£o. </font><font style="vertical-align: inherit;">Portanto, aumentaremos a √°rea de terra exibida no mapa, o que aumenta a probabilidade de grandes massas de terra e a ocorr√™ncia de terra (e n√£o do mar) ao longo das bordas do mapa.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/24d/adb/522/24dadb52258988326f096336470d97c3.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Obviamente, isso n√£o garante que a massa de terra seja muito interessante e, de fato, ser√° unificada: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c0b/c22/335/c0bc223356225dea02bfbd773495f36e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A semelhan√ßa de um √∫nico continente pode ser criada usando a mesma gera√ß√£o do continente da ilha, mas ao mesmo tempo deslocando a ilha para a borda do mapa. </font><font style="vertical-align: inherit;">Voc√™ obt√©m algo assim:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/209/981/20e/20998120e01c4c48f53419855cf6f703.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pode-se ver que o continente (principalmente) √© a ilha central, deslocada para cima e para a direita. </font><font style="vertical-align: inherit;">Como esse √© um continente e n√£o √© necess√°rio manter uma forma estrita de ilha, voc√™ pode adicionar mais distor√ß√£o √† forma.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e5f/000/523/e5f00052339289e504ffcd82b7481545.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obviamente, existem muitas outras abordagens para a gera√ß√£o de al√≠vio, mas essas duas, pelo menos, me d√£o a oportunidade de gerar as formas mais comuns de terra em escala continental. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um leitor atento pode notar as estranhas formas de florestas em forma de listras em muitos mapas dos continentes. </font><font style="vertical-align: inherit;">Da pr√≥xima vez, come√ßarei a lidar com os problemas dos modelos e biomas e√≥licos que causam essas esquisitices.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parte 4. Modelo de vento </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como foi dito, o tamanho dos continentes nos mapas de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragons Abound</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> come√ßou a mostrar padr√µes irreais de clima e biomas. Este exemplo mostra que a floresta est√° alinhada ao longo da dire√ß√£o predominante do vento:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/209/981/20e/20998120e01c4c48f53419855cf6f703.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O motivo n√£o est√° no c√≥digo quebrado; ao contr√°rio, os modelos clim√°ticos e bioma s√£o muito simples e, em larga escala, isso se torna aparente. Para lidar com esses problemas, comecei revisando o modelo de vento. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gostaria que meu modelo de vento refletisse melhor a din√¢mica do vento da Terra: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√©lulas Hadley</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ventos al√≠sios</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e similares. Essa din√¢mica pode ajudar a se livrar de padr√µes clim√°ticos estranhos nos mapas continentais. No entanto, quando foram adicionados, uma dolorosa insatisfa√ß√£o com o modelo de vento dos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Drag√µes Abundam</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lenta e muito complicada </font><font style="vertical-align: inherit;">, foi novamente revelada </font><font style="vertical-align: inherit;">. (Leia sobre a implementa√ß√£o inicial do modelo e√≥lico </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.) Depois de pensar nisso por v√°rios dias, decidi que a maioria dos problemas se resume ao fato de o mapa do jogo ser apresentado como um diagrama de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voronoi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . (Ou melhor, a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">triangula√ß√£o de Delaunay do</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diagrama de Voronoi.) Possui muitas vantagens ao gerar terreno - em combina√ß√£o com o ru√≠do, pode criar massas de terra com apar√™ncia natural. √â por isso que √© t√£o frequentemente usado para gerar al√≠vio. Por√©m, como os tri√¢ngulos individuais t√™m tamanhos e orienta√ß√µes diferentes, qualquer c√°lculo, incluindo modelos de vento que usam c√©lulas vizinhas, fica bastante complicado. Ser√° muito mais f√°cil modelar o vento atrav√©s de uma grade de √°reas id√™nticas espa√ßadas uniformemente. Al√©m disso, o modelo e√≥lico provavelmente n√£o precisa ser t√£o detalhado quanto a terra.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas n√£o quero abandonar completamente o diagrama de Voronoi, subjacente aos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Drag√µes Abundantes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . (No m√≠nimo, isso exigir√° a reescrita de quase todo o programa!) Em vez disso, quero experimentar vincular o mapa a uma grade uniforme, executar o modelo de vento nele e fazer a liga√ß√£o inversa. Se a perda de c√≥pias para frente e para tr√°s n√£o for muito grande, isso poder√° tornar o modelo de vento mais r√°pido e f√°cil. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qual grade devo usar? Idealmente, a grade deve consistir em √°reas iguais eq√ºidistantes dos seus vizinhos. E essa descri√ß√£o √© como uma grade de hex√°gonos.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/720/948/12a/72094812ad2adea8d6d71fa795146c44.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De fato, uma grade de hex√°gonos √© a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">melhor maneira de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dividir uma superf√≠cie plana em √°reas iguais. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O pr√≥ximo passo √© determinar como representar a grade de hex√°gonos no meu programa. Procurei um pouco na rede em busca de ajuda, e cada link retornou √† </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p√°gina sobre as grades de hex√°gonos de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Amit Patel ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tradu√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em Habr√©). Provavelmente, √© necess√°rio come√ßar com isso; Tamb√©m √© bom explorar primeiro o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">site</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Red Blob Games</font></a><font style="vertical-align: inherit;"> se voc√™ estiver procurando informa√ß√µes sobre como implementar a mec√¢nica de jogos. Amit explica melhor do que eu, ent√£o, se algo n√£o estiver claro, leia a p√°gina dele.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A primeira escolha a ser feita √© a maneira de armazenar a grade de hex√°gonos. </font><font style="vertical-align: inherit;">A maneira mais f√°cil √© armazen√°-lo como uma matriz bidimensional, ent√£o eu preciso da capacidade de vincular c√©lulas da grade √† matriz. </font><font style="vertical-align: inherit;">Existem muitas op√ß√µes aqui (leia </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a p√°gina de Amit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), mas usarei o que ele chama de √≠mpar-r:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e9c/a08/6bb/e9ca086bb2e5957db58d021c302c27f4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os n√∫meros em cada c√©lula s√£o os √≠ndices da c√©lula na matriz bidimensional. </font><font style="vertical-align: inherit;">(A imagem √© roubada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">da p√°gina</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Amit</font></a><font style="vertical-align: inherit;"> . Na p√°gina dele, eles s√£o interativos, por isso recomendo que experimente.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depois de fazer uma escolha, agora tenho que aprender a anexar √≠ndices a uma grade de hex√°gonos. </font><font style="vertical-align: inherit;">Por exemplo, se estou procurando uma c√©lula hexagonal (3, 3), quais ser√£o seus vizinhos? </font><font style="vertical-align: inherit;">Se cada c√©lula tiver uma largura de 5 pixels, quais ser√£o as coordenadas do centro da c√©lula (3, 3)?</font></font> E assim por diante<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lidar com isso pode ser dif√≠cil, ent√£o estou feliz que Amit tenha feito isso por mim. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supondo que possamos roubar tudo o que precisamos de Amit, primeiro preciso descobrir como organizar os hex√°gonos no mapa. Neste est√°gio, ainda n√£o preciso de uma matriz, posso fingir que √© e ver onde estar√£o os hex√°gonos. Se eu sei a localiza√ß√£o dos hex√°gonos, simplesmente divido a largura do mapa pela dist√¢ncia horizontal entre eles para obter o n√∫mero de colunas e fa√ßo o mesmo verticalmente para obter o n√∫mero de linhas, ap√≥s o que desenhei um hex√°gono em cada lugar:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ba/0e2/d39/7ba0e2d39d51e3ea0584734fbb584f19.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esses hex√°gonos s√£o muito maiores do que os que usarei para o modelo de vento, mas eles me mostram que tudo est√° colocado corretamente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui abri as bordas do mapa e desenhei apenas o hex√°gono central e nas bordas para verificar se realmente fechei o mapa inteiro:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f99/733/2a0/f997332a08696203af9e4cf044cf07cd.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As partes superior e inferior est√£o fora do mapa, mas a presen√ßa de v√°rias c√©lulas no exterior n√£o √© importante se eu n√£o perder uma parte do mapa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O pr√≥ximo passo √© criar uma matriz para a grade de hex√°gonos e encaixar todos os tri√¢ngulos de Delaunay nos hex√°gonos correspondentes. Como o Javascript n√£o suporta </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√≠ndices negativos de matrizes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , preciso mudar a c√©lula (0, 0) do centro do mapa para o canto superior direito. Tendo feito isso, vou em volta de todos os tri√¢ngulos de Delaunay e os adiciono √†s c√©lulas correspondentes da grade hexagonal. Posso verificar isso colorindo os hex√°gonos que cont√™m terra:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/848/f2e/1b7/848f2e1b78edb9dbfb91abdbff1bcf56.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para determinar se uma c√©lula √© terra, fa√ßo a m√©dia da altura de todos os locais que caem nessa c√©lula. </font><font style="vertical-align: inherit;">Voc√™ pode notar que, para alguns hex√°gonos costeiros, a m√©dia √© inferior a zero, mesmo na presen√ßa de terra. </font><font style="vertical-align: inherit;">Voc√™ tamb√©m pode usar a altura m√°xima de todos os locais no hex√°gono:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/66b/041/254/66b0412544abda9d618ab32784bd9ec8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesse caso, a pesquisa ocorre na dire√ß√£o oposta - o hex√°gono √© marcado como terra se houver alguma terra nele. </font><font style="vertical-align: inherit;">Qual √© o melhor depende do que voc√™ precisa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De qualquer forma, posso aumentar a precis√£o reduzindo o tamanho dos hex√°gonos:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c3b/0e7/1ec/c3b0e71ecf56429e04ea02a771b3a044.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora a costa ficou muito melhor, mas surgiu um novo problema - muitos hex√°gonos internos que n√£o s√£o considerados terra. Isso acontece porque quando os hex√°gonos se tornam pequenos o suficiente, em alguns deles n√£o h√° tri√¢ngulos de Delaunay. Portanto, eles n√£o t√™m "altura". (Isso tamb√©m demonstra a irregularidade dos tri√¢ngulos de Delaunay.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode usar esta solu√ß√£o - considere a altura dos tri√¢ngulos ausentes como a m√©dia de seus vizinhos ou o m√°ximo de seus vizinhos.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d51/ad8/30f/d51ad830fd84fa509f8f47c40b730f07.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em geral, quando a liga√ß√£o entre hex√°gonos e locais n√£o √© um para um, s√£o necess√°rias corre√ß√µes para preencher as informa√ß√µes ausentes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora que coloquei a grade de hex√°gonos no mapa, podemos come√ßar a implementar o modelo de vento. A id√©ia principal do modelo de vento √© simular alguns ventos (ventos al√≠sios) e distribu√≠-los por todo o mapa at√© atingirem um estado de imobilidade. No n√≠vel dos hex√°gonos (ou no n√≠vel dos locais, se eu fizer isso nos tri√¢ngulos de Delaunay), isso inclui dois est√°gios: (1) resumimos todos os ventos que entram no hex√°gono atual e (2) determinamos como o vento somado sai do hex√°gono.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A primeira etapa √© bastante simples. </font><font style="vertical-align: inherit;">Cada hex√°gono tem seis vizinhos e cada um desses hex√°gonos contribui. </font><font style="vertical-align: inherit;">Se considerarmos cada um dos ventos que entram no hex√°gono como um vetor, o vento total na c√©lula ser√° a soma desses vetores, ou seja, </font><font style="vertical-align: inherit;">dois ventos estritamente opostos de igual for√ßa se anulam. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O segundo est√°gio (determinar como o vento total sai do hex√°gono) requer reflex√£o. </font><font style="vertical-align: inherit;">O caso mais simples √© o vento soprando diretamente atrav√©s do hex√°gono:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e8a/982/d5a/e8a982d5af635e1fbee1e82f20c1990d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesse caso, esperamos que o vento se mova para a pr√≥xima c√©lula sem altera√ß√µes. </font><font style="vertical-align: inherit;">(Aqui, o vetor vermelho √© o vento original e o azul √© o vetor do vento em propaga√ß√£o.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas e se o vento n√£o soprar diretamente para a c√©lula vizinha?</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3cd/396/196/3cd3961960c15fa86e60cd421336e23d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesse caso, parece l√≥gico que parte do vento sopre em um hex√°gono diretamente acima dele, a outra parte em uma c√©lula localizada no sentido anti-hor√°rio a partir deste, e as propor√ß√µes devem depender da dire√ß√£o em que a seta aponta. </font><font style="vertical-align: inherit;">No nosso caso, a parte principal do vento se mover√° para a c√©lula superior e menos para a c√©lula vizinha. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tamb√©m √© necess√°rio decidir a dire√ß√£o do vento que se espalha. </font><font style="vertical-align: inherit;">Uma op√ß√£o √© manter a dire√ß√£o do vento original:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e31/e3f/6ef/e31e3f6ef05e18991e2e48462e47a05b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parece que esta √© a op√ß√£o mais realista, mas existe outra: alterar a dire√ß√£o do vento de acordo com a borda do hex√°gono em que ele se cruza: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/96b/caa/11d/96bcaa11d738b2468eccd1ea758b9e8d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essa abordagem √© menos precisa, mas tem uma vantagem: os ventos sempre estar√£o em uma das seis dire√ß√µes, o que pode simplificar os c√°lculos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outra dificuldade surge quando se considera o terreno. </font><font style="vertical-align: inherit;">O que deve acontecer quando uma montanha sobe ao vento?</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a95/c03/492/a95c0349265fe5581df74ebb33bbd4f5.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nesse caso, parte do vento passa sobre a montanha (possivelmente criando precipita√ß√£o), mas parte do vento vira para os lados. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5f4/e8b/fe3/5f4e8bfe34c0e0a8fd7a9bb784487ad9.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, a maneira como o vento sai do hex√°gono depende de sua dire√ß√£o, bem como da topografia nas c√©lulas vizinhas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora vamos falar sobre como representar vetores. </font><font style="vertical-align: inherit;">Existem duas op√ß√µes principais. </font><font style="vertical-align: inherit;">Primeiramente, um vetor pode ser representado como valores X e Y, por exemplo:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/253/4da/c67/2534dac673d43b8bf4d93f70254e540a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se desenharmos um vetor come√ßando em (0, 0), (X, Y) s√£o as coordenadas dos pontos finais. </font><font style="vertical-align: inherit;">Esse registro facilita muito a soma de vetores. </font><font style="vertical-align: inherit;">Apenas somamos todos os valores (X, Y) e obtemos um novo vetor:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9fd/b4c/427/9fdb4c427518523698ec72c34b854059.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Outra op√ß√£o √© usar o √¢ngulo e o comprimento do vetor: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c43/421/9c9/c434219c9ba69e9a29b5d73b665d5e96.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesta forma, √© f√°cil executar opera√ß√µes como girar vetores ou alterar seu comprimento. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para a maioria das opera√ß√µes exigidas no modelo e√≥lico, a primeira op√ß√£o √© melhor, mas em alguns casos a segunda √© melhor, portanto seria conveniente alternar entre elas, se necess√°rio. </font><font style="vertical-align: inherit;">Para n√£o reinventar a roda, procurei uma biblioteca de vetores para Javascript e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Victor.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> apareceu </font><font style="vertical-align: inherit;">, ent√£o aproveitei. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vou come√ßar adicionando um vetor de vento a cada hex√°gono e ver se consigo visualiz√°-lo:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d9e/1a2/b49/d9e1a2b49e115bbc4436a8e518164adb.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parece bom at√© agora. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O pr√≥ximo passo √© verificar se posso dividir corretamente o vetor de vento e distribu√≠-lo para a pr√≥xima c√©lula. Primeiro, voc√™ precisa calcular os √¢ngulos que levam a outras c√©lulas. Encontrei a resposta novamente na </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p√°gina de Amit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9f2/f9d/4a9/9f2f9d4a9c349dbb47ff2dc32ede0ff8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ou seja, um vetor a 0 graus aponta para um hex√°gono √† direita, a 60 graus - para um hex√°gono no canto inferior direito e assim por diante. Um vetor apontando entre essas duas dire√ß√µes √© proporcionalmente dividido entre duas c√©lulas - ou seja, um vetor em um √¢ngulo de 30 graus ser√° dividido igualmente entre a c√©lula √† direita e a c√©lula de baixo para a direita. Cada vetor fica em algum lugar entre os cantos das faces de duas c√©lulas vizinhas; portanto, basta olhar para o √¢ngulo do vetor do vento, descobrir que ele fica entre os cantos centrais de dois hex√°gonos e dividi-lo proporcionalmente entre esses dois hex√°gonos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por exemplo, se o vetor de vento tiver um √¢ngulo de 22 graus:</font></font><br><br><div style="text-align:center;"><img height="320" src="https://habrastorage.org/getpro/habr/post_images/147/fc8/add/147fc8add812755fa9abab8c5eb928aa.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ent√£o 38/60 do valor se propaga para a c√©lula √† direita e 22/60 do valor do vetor para a c√©lula no canto inferior direito. Se os vetores forem representados como um par de valores X e Y, voc√™ poder√° distribu√≠-los multiplicando cada valor do vetor original por uma fra√ß√£o (por exemplo, 22/60) e adicionando-o ao vetor vento no novo hex√°gono. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para testar isso, posso organizar os ventos em dire√ß√µes diferentes e coloc√°-los na parte superior e lateral do mapa e ver se eles podem se espalhar corretamente no mapa. Quando os ventos colidem, eles devem ser combinados e escolher a dire√ß√£o m√©dia com maior velocidade:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/039/482/4ac/0394824ac970c0887bb100c515ea300e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui vemos que os ventos se encontram ao longo da diagonal e se combinam para soprar em dire√ß√£o ao canto inferior. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O pr√≥ximo passo √© levar em considera√ß√£o a influ√™ncia da terra no vento. </font><font style="vertical-align: inherit;">Obviamente, modelos de vento reais s√£o muito complexos, mas estou principalmente interessado em como a geografia terrestre afeta os ventos de superf√≠cie. </font><font style="vertical-align: inherit;">No n√≠vel mais simples, essa √© a influ√™ncia das alturas e terras baixas na dire√ß√£o e velocidade do vento. </font><font style="vertical-align: inherit;">Eu experimentei muitas abordagens diferentes, mas como resultado, decidi por </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">duas regras simples</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O vento se afasta dos obst√°culos. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O vento diminui quando sobe e acelera, caindo. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um obst√°culo ocorre quando o vento sopra em uma cela com uma altura mais alta, por exemplo, em uma cela com uma montanha. </font><font style="vertical-align: inherit;">Quando isso acontece, olho as duas c√©lulas nas quais o vento sopra e mudo o √¢ngulo do vento para que ele aponte mais para a parte inferior dos dois hex√°gonos. </font><font style="vertical-align: inherit;">A magnitude das mudan√ßas de √¢ngulo depende da diferen√ßa nas alturas de duas c√©lulas; portanto, quando o vento sopra em duas c√©lulas vizinhas com montanhas, sua dire√ß√£o muda pouco, mas se sopra em uma c√©lula com uma montanha e uma c√©lula com uma plan√≠cie, ele se volta mais para a c√©lula vazia:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e6f/4cd/b90/e6f4cdb90eb194445cf21b3c5679e3ca.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A for√ßa do vento pode ser ajustada. </font><font style="vertical-align: inherit;">No mapa acima, ele √© muito forte, o que levar√° ao surgimento de muitos biomas irrealistas. </font><font style="vertical-align: inherit;">Aqui est√° um significado mais l√≥gico:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e70/676/6f8/e706766f8d1abfc1ad18b928b72d9c7e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma grande parte do movimento do vento causado pelos relevos ainda permanece, mas as grandes brechas e vales do vento forte se tornaram menores. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outra caracter√≠stica que aumenta o realismo √© a dispers√£o do vento. Por exemplo, o mapa acima mostra que o vento sopra para oeste logo acima da cidade de Breeches. Embora sopre longas dist√¢ncias, nunca se dissipa como seria de esperar. Quando um vento soprando encontra outro ar, ele geralmente puxa o vento junto com ele. Para simular isso, posso pegar uma pequena parte do vento soprando em cada hex√°gono e redistribu√≠-lo para todas as c√©lulas vizinhas. Aqui est√° a apar√™ncia do mapa acima com uma pequena dispers√£o:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/98d/53c/6d1/98d53c6d1659c068a8d36c58d692bd02.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como voc√™ pode ver, agora o vento sobre os cal√ß√µes come√ßou a se dissipar um pouco. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta opera√ß√£o determina a maior parte das dire√ß√µes do vento. A segunda parte √© a desacelera√ß√£o do vento ao subir e a acelera√ß√£o ao baixar. Eu posso perceber isso olhando a altura relativa da c√©lula da qual o vento vem, e a altura da c√©lula na qual o vento sopra, e acelerando / diminuindo a velocidade, se necess√°rio. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui est√° como tudo parece:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/633/2c0/d8b/6332c0d8b042591426238cceafaea5a8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora vemos que parte do vento soprando atrav√©s das altas montanhas na parte central da ilha foi cortada. E vice-versa - v√°rios novos ventos apareceram na parte ocidental da ilha, onde o ar se move de terras relativamente altas para o mar. (Esta √© uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">brisa costeira</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! Embora na verdade n√£o: o mecanismo √© diferente l√°.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora posso substituir um novo vento pelo algoritmo de precipita√ß√£o existente. Aqui est√° uma compara√ß√£o (ventos antigos √† esquerda, novos ventos √† direita):</font></font><br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/1e2/c41/3b4/1e2c413b436456e0964c50b794a402db.png"></a> </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Clique na imagem para ver uma vers√£o ampliada.) Obviamente, existem diferen√ßas entre os modelos de vento. Nos dois mapas, o vento sopra do leste. Montanhas pr√≥ximas ao centro do mapa viram o vento para o sul, causam fortes chuvas e criam um p√¢ntano e florestas ao sul das montanhas. Na parte inferior, o vento sopra sem nenhuma interfer√™ncia, e as florestas se formam ao longo da metade oriental da ilha. No modelo original de vento, vento suficiente passava sobre as montanhas e p√¢ntanos centrais para criar uma floresta na parte ocidental da ilha. No novo modelo, a maior parte do vento √© cortada e os biomas gramados se formam no lado mais distante das montanhas.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O modelo antigo possui variabilidade de par√¢metros aleat√≥rios (dentro de um determinado intervalo) e √© prov√°vel que alguma combina√ß√£o desses par√¢metros d√™ uma imagem mais parecida com um novo mapa. Mas, de fato, n√£o precisamos reproduzir o comportamento exato do modelo antigo, apenas um modelo que crie resultados convincentes.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O objetivo de tudo isso √© acelerar e simplificar a gera√ß√£o de vento, para que o novo comportamento do vento possa ser adicionado aos mapas continentais. </font><font style="vertical-align: inherit;">Eu fiz isso? </font><font style="vertical-align: inherit;">Criei um perfil do modelo de vento original e do novo modelo baseado em hex√°gono. </font><font style="vertical-align: inherit;">Verificou-se que o novo modelo √© 15 a 20 vezes mais r√°pido que o original (!). </font><font style="vertical-align: inherit;">Esta √© uma acelera√ß√£o muito significativa que tem pouco efeito nas cartas. </font><font style="vertical-align: inherit;">As experi√™ncias deixam claro que o modelo n√£o √© particularmente sens√≠vel ao tamanho dos hex√°gonos; portanto, se necess√°rio, posso acelerar o algoritmo ainda mais aumentando o tamanho das c√©lulas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Da pr√≥xima vez, trabalharemos no uso de um novo modelo de vento para implementar padr√µes de vento em escala continental e, em seguida, conect√°-los ao modelo e aos biomas de precipita√ß√£o.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt429620/">https://habr.com/ru/post/pt429620/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt429606/index.html">A maldita d√∫zia de PM: uma lista de livros para gerentes de projeto</a></li>
<li><a href="../pt429610/index.html">A hist√≥ria de como executar o emulador do Android ou economizar no processador intel</a></li>
<li><a href="../pt429612/index.html">Fulsteks s√£o eternos MIDLs. N√£o siga esse caminho se n√£o quiser sofrer</a></li>
<li><a href="../pt429616/index.html">√Årea de Trabalho Digital Parte 1: Citrix</a></li>
<li><a href="../pt429618/index.html">Jogo eletr√¥nico XO</a></li>
<li><a href="../pt429622/index.html">Rob√¥s substitu√≠ram a Amazon por 20.000 trabalhadores</a></li>
<li><a href="../pt429624/index.html">Como a NASA usar√° rob√¥s para criar combust√≠vel de foguete a partir de solo marciano</a></li>
<li><a href="../pt429626/index.html">Os crackers do genoma mostraram que nenhum DNA ser√° mais an√¥nimo</a></li>
<li><a href="../pt429628/index.html">Como criar um bot de bate-papo para o VKontakte usando Python, Django e webhook</a></li>
<li><a href="../pt429630/index.html">"Monstros em jogos ou diversificam o medo"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>