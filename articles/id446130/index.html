<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤°ğŸ¼ ğŸ¤›ğŸ¼ ğŸ§—ğŸ» Agregator Acara untuk Acara Unity3d ğŸ ğŸ‘©ğŸ¿â€ğŸ”¬ ğŸ—ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Gagasan untuk menulis agregator acara diperpanjang Anda sendiri untuk Unity3d sudah lama ditunggu. Setelah membaca beberapa artikel tentang topik ini,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Agregator Acara untuk Acara Unity3d</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446130/">  Gagasan untuk menulis agregator acara diperpanjang Anda sendiri untuk Unity3d sudah lama ditunggu.  Setelah membaca beberapa artikel tentang topik ini, saya menyadari bahwa tidak ada cukup "benar" (dalam Unity3d) dan agregator yang diperlukan bagi saya, semua solusi dilucuti dan tidak memiliki fungsi yang diperlukan. <br><br><h3>  Fungsi yang Diperlukan: </h3><br><ol><li>  Setiap kelas dapat berlangganan ke acara apa pun (seringkali agregator di unit membuat pelanggan Gameobject tertentu) </li><li>  Kemungkinan berlangganan dua kali dari kejadian spesifik ke acara tertentu harus dikecualikan (dalam alat standar Anda harus mengikuti ini sendiri) </li><li>  Seharusnya ada fungsionalitas baik manual berhenti berlangganan dan otomatis, dalam kasus menghapus instance / menonaktifkan monobekh (saya ingin berlangganan dan tidak mandi uap sehingga pelanggan tiba-tiba membuang kembali kuku) </li><li>  acara harus dapat mentransfer data / tautan dengan kompleksitas apa pun (saya ingin berlangganan dalam satu baris dan mendapatkan seluruh rangkaian data tanpa masalah) </li></ol><a name="habracut"></a><br><h3>  Di mana menerapkannya </h3><br><ol><li>  Ini sangat ideal untuk UI, ketika ada kebutuhan untuk meneruskan data dari objek apa pun tanpa koneksi apa pun. </li><li>  Pesan tentang perubahan data, beberapa analog dari kode reaktif. </li><li>  Untuk injeksi ketergantungan </li><li>  Callback global </li></ol><br><h3>  Poin lemah </h3><br><ol><li> Karena memeriksa pelanggan yang mati dan mengambil (saya akan mengungkapkan nanti) kode lebih lambat daripada solusi serupa </li><li>  Kelas / struct digunakan sebagai inti dari acara tersebut, agar tidak mengalokasikan memori + masalah utama, tidak disarankan untuk acara spam dalam pembaruan) </li></ol><br><h3>  Ideologi umum </h3><br>  Ideologi umumnya adalah bahwa bagi kami suatu peristiwa adalah paket data yang spesifik dan relevan.  Katakanlah kita menekan tombol pada antarmuka / joystick.  Dan kami ingin mengirim acara dengan tanda-tanda menekan tombol tertentu untuk diproses lebih lanjut.  Hasil pemrosesan klik adalah perubahan visual ke antarmuka dan beberapa jenis tindakan dalam logika.  Dengan demikian, mungkin ada pemrosesan / berlangganan di dua tempat berbeda. <br><br>  <b>Seperti apa paket acara / paket data dalam kasus saya:</b> <br><br><div class="spoiler">  <b class="spoiler_title">Contoh badan acara</b> <div class="spoiler_text"><pre><code class="javascript hljs">public struct ClickOnButtonEvent   {     public int ButtonID; <span class="hljs-comment"><span class="hljs-comment">//     enum    }</span></span></code> </pre> <br></div></div><br>  <b>Seperti apa langganan acara:</b> <br><br><pre> <code class="javascript hljs">public <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AddListener&lt;T&gt;(object listener, Action&lt;T&gt; action)</code> </pre><br>  Untuk berlangganan, kita perlu menentukan: <br>  Objek yang merupakan pelanggan (biasanya kelas itu sendiri di mana berlangganan, tetapi ini tidak perlu, pelanggan dapat menentukan salah satu instance kelas dari bidang kelas. <br>  Jenis / acara tempat kami berlangganan.  Ini adalah esensi utama dari agregator ini, bagi kami jenis kelas tertentu adalah peristiwa yang kami dengarkan dan proses. <br>  Berlangganan terbaik di Sedar dan Aktif; <br><br>  <b>Contoh</b> <br><br><pre> <code class="javascript hljs">public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Example</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MonoBehaviour</span></span></span><span class="hljs-class"> </span></span>{ private <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Awake() { EventAggregator.AddListener&lt;ClickOnButtonEvent&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, ClickButtonListener); } private <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ClickButtonListener(ClickOnButtonEvent obj) { Debug.Log(<span class="hljs-string"><span class="hljs-string">"  "</span></span> + obj.ButtonID); } }</code> </pre><br><h3>  Untuk memperjelas chip apa, pertimbangkan kasus yang lebih kompleks </h3><br>  <b>Kami memiliki ikon karakter yang:</b> <br><ol><li>  Ketahui karakter yang melekat pada mereka. </li><li>  Mencerminkan jumlah mana, hp, exp, dan status (setrum, kebutaan, ketakutan, kegilaan) </li></ol><br>  <b>Dan di sini Anda dapat melakukan beberapa acara</b> <br><br>  Untuk mengubah indikator: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> struct CharacterStateChanges { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Character Character; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Hp; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Mp; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Xp; }</code> </pre> <br>  Untuk mengubah status negatif: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> struct CharacterNegativeStatusEvent { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Character Character; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Statuses Statuses; <span class="hljs-comment"><span class="hljs-comment">//enum  }</span></span></code> </pre><br>  Mengapa dalam kedua kasus kita lulus kelas karakter?  Berikut adalah pelanggan acara dan penangannya: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ EventAggregator.AddListener&lt;CharacterNegativeStatusEvent&gt; (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, CharacterNegativeStatusListener); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CharacterNegativeStatusListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CharacterNegativeStatusEvent obj)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj.Character != _character) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; _currentStatus = obj.Statuses; }</code> </pre><br>  Ini adalah penanda dimana kami memproses acara dan memahami apa yang sebenarnya kami butuhkan. <br>  <b>Mengapa Anda tidak mengira Anda berlangganan langsung ke kelas Karakter?</b>  <b>Dan spam mereka?</b> <br>  Akan sulit untuk melakukan debut, lebih baik bagi sekelompok kelas / acara untuk membuat acara terpisah mereka sendiri. <br><br>  <b>Mengapa, sekali lagi, di dalam acara itu, jangan menaruh Karakter dan mengambil semuanya darinya?</b> <br>  Jadi omong-omong itu mungkin, tetapi sering di kelas ada batasan visibilitas, dan data yang diperlukan untuk acara tersebut mungkin tidak terlihat dari luar. <br><br>  <b>apakah kelasnya terlalu berat untuk digunakan sebagai marker?</b> <br>  Bahkan, dalam banyak kasus, penanda tidak diperlukan, sekelompok kelas yang diperbarui agak jarang.  Biasanya satu entitas tertentu membutuhkan suatu peristiwa - model pengontrol / tampilan, yang biasanya menampilkan keadaan karakter pertama.  Dan selalu ada solusi dangkal - ID dari berbagai jenis (dari inam, hingga hash kompleks, dll.). <br><br><h3>  Apa yang ada di balik tudung dan bagaimana cara kerjanya? </h3><br><div class="spoiler">  <b class="spoiler_title">Kode agregator langsung</b> <div class="spoiler_text"><pre> <code class="java hljs">namespace GlobalEventAggregator <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> delegate <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> EventHandler&lt;T&gt;(T e); { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventContainer</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IDebugable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> event EventHandler&lt;T&gt; _eventKeeper; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> readonly Dictionary&lt;WeakReference, EventHandler&lt;T&gt;&gt; _activeListenersOfThisType = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;WeakReference, EventHandler&lt;T&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> string Error = <span class="hljs-string"><span class="hljs-string">"null"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> bool </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HasDuplicates</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object listener)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _activeListenersOfThisType.Keys.Any(k =&gt; k.Target == listener); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddToEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object listener, EventHandler&lt;T&gt; action)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newAction = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WeakReference(listener); _activeListenersOfThisType.Add(newAction, action); _eventKeeper += _activeListenersOfThisType[newAction]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveFromEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object listener)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentEvent = _activeListenersOfThisType.Keys.FirstOrDefault(k =&gt; k.Target == listener); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentEvent != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { _eventKeeper -= _activeListenersOfThisType[currentEvent]; _activeListenersOfThisType.Remove(currentEvent); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EventContainer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object listener, EventHandler&lt;T&gt; action)</span></span></span><span class="hljs-function"> </span></span>{ _eventKeeper += action; _activeListenersOfThisType.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WeakReference(listener), action); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T t)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_activeListenersOfThisType.Keys.Any(k =&gt; k.Target.ToString() == Error)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> failObjList = _activeListenersOfThisType.Keys.Where(k =&gt; k.Target.ToString() == Error).ToList(); foreach (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fail in failObjList) { _eventKeeper -= _activeListenersOfThisType[fail]; _activeListenersOfThisType.Remove(fail); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_eventKeeper != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) _eventKeeper(t); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> string </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DebugInfo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ string info = string.Empty; foreach (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c in _activeListenersOfThisType.Keys) { info += c.Target.ToString() + <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> info; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventAggregator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Dictionary&lt;Type, object&gt; GlobalListeners = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;Type, object&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EventAggregator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ SceneManager.sceneUnloaded += ClearGlobalListeners; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClearGlobalListeners</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Scene scene)</span></span></span><span class="hljs-function"> </span></span>{ GlobalListeners.Clear(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AddListener&lt;T&gt;(object listener, Action&lt;T&gt; action) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> key = typeof(T); EventHandler&lt;T&gt; handler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EventHandler&lt;T&gt;(action); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GlobalListeners.ContainsKey(key)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lr = (EventContainer&lt;T&gt;)GlobalListeners[key]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lr.HasDuplicates(listener)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; lr.AddToEvent(listener, handler); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } GlobalListeners.Add(key, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EventContainer&lt;T&gt;(listener, handler)); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Invoke&lt;T&gt;(T data) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> key = typeof(T); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!GlobalListeners.ContainsKey(key)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventContainer = (EventContainer&lt;T&gt;)GlobalListeners[key]; eventContainer.Invoke(data); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> RemoveListener&lt;T&gt;(object listener) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> key = typeof(T); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GlobalListeners.ContainsKey(key)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventContainer = (EventContainer&lt;T&gt;)GlobalListeners[key]; eventContainer.RemoveFromEvent(listener); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> string </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DebugInfo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ string info = string.Empty; foreach (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> listener in GlobalListeners) { info += <span class="hljs-string"><span class="hljs-string">"     "</span></span> + listener.Key.ToString() + <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = (IDebugable)listener.Value; info += t.DebugInfo() + <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> info; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IDebugable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">string </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DebugInfo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; } }</code> </pre> <br></div></div><br>  <b>Mari kita mulai dengan yang utama</b> <br><br>  Ini adalah kamus di mana kuncinya adalah ketik dan nilainya adalah wadah <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventContainer</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IDebugable</span></span></span></span></code> </pre> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Dictionary&lt;Type, object&gt; GlobalListeners = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;Type, object&gt;();</code> </pre> <br>  Mengapa kita menyimpan wadah sebagai objek?  Kamus tidak tahu cara menyimpan obat generik.  Tetapi karena kuncinya, kita dapat dengan cepat membawa objek ke tipe yang kita butuhkan. <br><br>  <b>Apa isi wadah itu?</b> <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> event EventHandler&lt;T&gt; _eventKeeper; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> readonly Dictionary&lt;WeakReference, EventHandler&lt;T&gt;&gt; _activeListenersOfThisType = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;WeakReference, EventHandler&lt;T&gt;&gt;();</code> </pre> <br>  Ini berisi multidelegate generik dan koleksi di mana kuncinya adalah objek yang merupakan pelanggan, dan nilainya adalah metode penangan yang sama.  Faktanya, kamus ini berisi semua objek dan metode yang termasuk dalam jenis ini.  Akibatnya, kami menyebutnya multidelegate, dan ia memanggil semua pelanggan, ini adalah sistem acara "jujur" di mana tidak ada batasan pada pelanggan, tetapi di sebagian besar agregator lain, kumpulan kelas yang digeneralisasi baik oleh antarmuka khusus atau diwarisi dari kelas yang mengimplementasikan sistem tersebut di bawah tenda pesan. <br><br>  Ketika multidelegate dipanggil, pemeriksaan dilakukan untuk melihat apakah ada kunci mati, koleksi dibersihkan dari mayat, dan kemudian multidelegate dengan pelanggan yang relevan diambil.  Ini membutuhkan waktu, tetapi sekali lagi, pada kenyataannya, jika fungsionalitas acara dipisahkan, maka satu acara akan memiliki 3-5 pelanggan, sehingga pemeriksaannya tidak begitu menakutkan, manfaat kenyamanannya lebih jelas.  Untuk cerita jaringan di mana bisa ada seribu atau lebih pelanggan, agregator ini lebih baik tidak menggunakan.  Meskipun pertanyaannya tetap terbuka - jika Anda menghapus centang untuk mayat, yang lebih cepat - iterasi melalui array pelanggan dari 1k atau memanggil delegasi multi-dari pelanggan 1k. <br><br><h3>  Fitur penggunaan </h3><br>  Langganan paling baik didorong ke Sedarlah. <br><br>  Jika sebuah objek aktif aktif / nonaktif, lebih baik berlangganan Sedarlah dan Hidup, itu tidak akan masuk dua kali, tetapi kemungkinan GameObject yang tidak aktif akan diambil untuk mati akan dikecualikan. <br><br>  Faktur acara lebih baik daripada memulai, ketika semua pelanggan akan dibuat dan terdaftar. <br><br>  Agregator membersihkan daftar pada saat bongkar adegan.  Di beberapa agregator, disarankan untuk membersihkan pemuatan adegan - ini adalah file, acara pemuatan adegan muncul setelah Sedar / Aktif, pelanggan yang ditambahkan akan dihapus. <br><br>  Agregator memiliki - string statis publik DebugInfo (), Anda dapat melihat kelas mana yang berlangganan acara mana. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><b>Repositori GitHub</b></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id446130/">https://habr.com/ru/post/id446130/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id446118/index.html">Open Rack v3: apa yang diharapkan dari standar arsitektur rak server baru</a></li>
<li><a href="../id446120/index.html">Telekomunikasi AS untuk Memerangi Spam Telepon</a></li>
<li><a href="../id446124/index.html">Acara digital di Moskow dari tanggal 1 hingga 7 April</a></li>
<li><a href="../id446126/index.html">Santai pikiran orang yang malas tentang kriptografi dan perlindungan data</a></li>
<li><a href="../id446128/index.html">Fonogram sinar-X kembali: Serangan besar-besaran, Jonsi dan yang lainnya merilis rekaman "di tulang"</a></li>
<li><a href="../id446132/index.html">92,7% membuat cadangan, kehilangan data meningkat 30%. Apa yang salah</a></li>
<li><a href="../id446134/index.html">Ketergantungan Injeksi dalam Flutter</a></li>
<li><a href="../id446136/index.html">Mesin 3D Marmer Saya Dicetak</a></li>
<li><a href="../id446138/index.html">Betapa mudahnya mengatur startup Anda secara legal dalam bentuk kemitraan sederhana</a></li>
<li><a href="../id446142/index.html">Flat Earth: Eksperimen dan Bukti</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>