<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçüé® üé≥ üåç Fale sobre o PostgreSQL. Entrevista com Alexei Lesovsky no podcast Zinc Prod. Parte um üôéüèø ü§∂ ‚ò∏Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recentemente, convidamos Alexei Lesovsky, do Data Egret, para transmitir Zinc Sale . A conversa acabou sendo interessante e informativa. Por isso, ofe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fale sobre o PostgreSQL. Entrevista com Alexei Lesovsky no podcast Zinc Prod. Parte um</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485322/"><blockquote>  Recentemente, convidamos Alexei Lesovsky, do <a href="https://www.dataegret.ru/" rel="nofollow">Data Egret,</a> para transmitir <a href="https://soundcloud.com/znprod" rel="nofollow">Zinc Sale</a> .  A conversa acabou sendo interessante e informativa. Por isso, ofere√ßo a transcri√ß√£o desta edi√ß√£o.  Devido ao volume impressionante, foi necess√°rio dividir o texto em peda√ßos.  Se voc√™ estiver com pregui√ßa de esperar pela continua√ß√£o, basta ouvir a vers√£o em √°udio <a href="https://soundcloud.com/znprod/040-aleksey-lesovskiy-kak-vlyubit-v-sebya-postgres" rel="nofollow">aqui</a> . </blockquote><p>  Ol√° pessoal, esta √© a quadrag√©sima edi√ß√£o do podcast Zinc Prod, e Anton Okolelov, Nikita Vasilchenko e Oleg Gritsak s√£o anfitri√µes permanentes conosco no est√∫dio. </p><br><p>  <strong>Anton</strong> : Ent√£o, hoje temos um convidado, Alexey Lesovsky.  Lesha, por favor, apresente-se, quem voc√™ √©, o que faz e assim por diante. </p><a name="habracut"></a><br><p> <strong>Alexei</strong> : Ol√° pessoal, meu nome √© Alexei Lesovsky, pois Antokha j√° me apresentou.  Estou administrando o Postgres, sou o PostgreSQL DBA (administrador de banco de dados), trabalho com o login todos os dias, 7 dias por semana, e administro bancos de dados clientes.  Temos um escrit√≥rio - √© uma empresa de consultoria, est√° envolvida em administra√ß√£o, suporte e suporte.  E pessoas muito diferentes nos procuram com seus bancos de dados, como regra, s√£o empresas - pequenas, grandes, pequenas, de todos os tipos - t√™m problemas com o banco de dados, analisamos esses problemas e de alguma forma tentamos corrigi-los.  Na verdade, resolvemos os problemas de outras pessoas, outras empresas.  Algo assim. </p><br><p>  Bem, no meu tempo livre, gosto de fazer coisas diferentes, caminhar pela floresta, fazer snowboard, caminhar, beber cerveja </p><br><p>  <strong>Anton</strong> : beber cerveja defumada </p><br><p>  <strong>Nikita</strong> : antes do lan√ßamento Lyokha falou sobre cerveja defumada </p><br><p>  <strong>Alexei</strong> : sim, cerveja defumada, h√° uma deliciosa, eu recomendo.  Rauchbier Merzen. </p><br><p>  <strong>Anton</strong> : ok, por favor me diga, seu dbshnik, voc√™ trabalha h√° muito tempo, h√° v√°rios anos.  Qu√£o dif√≠cil √©?  Eles ligam para voc√™ √† noite e pedem para voc√™ consertar a base.  Liguei para voc√™ √†s cinco da manh√£ h√° cerca de um ano ou meio. </p><br><p>  <strong>Alexei</strong> : sim, era, era um problema. </p><br><p>  <strong>Anton</strong> : como voc√™ sobrevive, me diga </p><br><p>  <strong>Alexey</strong> : escute, trabalho desde 2014.  At√© 2014, trabalhei como administrador de Linux em desenvolvimento web.  O administrador tem muitas coisas, tivemos virtualiza√ß√£o kvm, havia muito Linux, havia todos os tipos de Ruby-on-Rails, nginxs, php, rails ... </p><br><p>  <strong>Oleg</strong> : Docker j√° esteve? </p><br><p>  <strong>Alexey</strong> : o docker acabou de come√ßar, n√£o o introduzimos em nenhum lugar da produ√ß√£o, mas as tend√™ncias para isso j√° come√ßaram. </p><br><p>  E havia muitos postgres em nosso escrit√≥rio.  Depois, persegui um longo rublo e decidi que poderia trabalhar em dois empregos ao mesmo tempo.  E ele come√ßou a trabalhar como administrador remotamente em um escrit√≥rio de Moscou.  Combinei dois trabalhos, apenas os bancos de dados foram administrados pela consultoria Postgresql.  Havia Max Boguk, Ilya Kosmodemyansky e, como administrador, comecei a fazer parte das tarefas associadas √† embaixada.  Bem, isto √©,  Comecei a pegar silenciosamente o p√£o deles.  E, em algum momento, Max me diz isso: ou√ßa e deixe voc√™ ir trabalhar conosco.  Voc√™ deixar√° todo o seu trabalho, em meio per√≠odo, e vir√° a n√≥s em per√≠odo integral. </p><br><p>  Bem, concordei, n√£o hesitei, em princ√≠pio me foi oferecido um sal√°rio compar√°vel, consegui um emprego e comecei a trabalhar em casa. Agora, desde 2014, acabo trabalhando h√° 5 anos, trabalho especificamente com o pai, bem, √† moda antiga, todos os tipos de temas administrativos, trabalho com eles por h√°bito.  I.e.  se em nossa empresa h√° um problema com algo para entender do lado do administrador, eles me jogam fora, eu entendo </p><br><p>  <strong>Anton</strong> : Mas, em geral, √© necess√°rio conhecer essas coisas de administrador?  N√£o est√° s√≥ l√°, a base est√° no v√°cuo, est√° girando em algum lugar, voc√™ precisa configurar o sistema operacional, certo? </p><br><p>  <strong>Alexei</strong> : sim, sim, √© exatamente porque ele geralmente depende muito dos subsistemas do sistema operacional, da mem√≥ria virtual e do gerenciamento de disco, ou seja,  √© como se ele pr√≥prio n√£o operasse diretamente recursos, como se descarregasse todo esse trabalho para o sistema operacional, e ele pr√≥prio gerencia E / S de disco, gerenciamento de p√°ginas de mem√≥ria, isso √© tudo, troca de processos e, portanto, se voc√™ encontrar um desligamento do postgres, precisar√° tamb√©m h√° um pequeno truque no sistema operacional, como tudo funciona l√° e como funciona na interface com o postgres. </p><br><p>  Se, por exemplo, comparar com o Oracle, o Oracle possui, por exemplo, seus pr√≥prios subsistemas que funcionam com entrada e sa√≠da, ou seja,  eles ultrapassaram o sistema operacional, eles podem trabalhar diretamente com o disco, mas no Posgres isso n√£o √©, voc√™ precisa saber como o sistema operacional funciona com o banco de dados. </p><br><p>  <strong>Oleg</strong> : voc√™ tinha que dar suporte ao postgres no Windows? </p><br><p>  <strong>Alexei</strong> : sim, eu tenho que, temos um cliente, eles est√£o no Windows, atendemos algum tipo de escrit√≥rio em S√£o Petersburgo, fizemos uma auditoria no banco de dados para eles.  A base deles era no Windows, era geralmente assustador, n√≥s nos conect√°vamos a algum protocolo atrav√©s do protocolo do terminal, a √Årea de Trabalho Remota foi aberta, lan√ßamos algumas coisas relacionadas √† grava√ß√£o do desempenho l√°.  Em suma, foi dif√≠cil, assustador, como um sonho terr√≠vel agora √© lembrado.  E agora os clientes est√£o basicamente todos sentados no Linux.  Praticamente ningu√©m est√° no Windows. </p><br><p>  <strong>Oleg</strong> : qual √© a principal dor no Postgre que todos podem perceber? </p><br><p>  <strong>Alexey</strong> : muitas pessoas querem um auto-filer e multi-master.  Bem, multimaster, √© claro, uma coisa assim, inating√≠vel.  Mas todo mundo trabalhou com o Galera (com o Mysql), e eles dizem: porque, tamb√©m queremos um multimaster em andamento. </p><br><p>  Bem, no progresso existem essas coisas, mas n√£o no pr√≥prio n√∫cleo progressivo, existem coisas que implementam o tipo de multimestre, mas que ainda n√£o foram produzidas.  Mas as pessoas querem um multimaster.  E as pessoas tamb√©m querem um arquivo autom√°tico.  Mas agora, gra√ßas a Deus que Patroni apareceu, no Patroni voc√™ pode fazer um auto-filer, as pessoas est√£o introduzindo-o lentamente.  Bem, em geral, do meu ponto de vista, Patroni se tornou o padr√£o de fato.  Muitas grandes empresas j√° est√£o implementando.  O mesmo Gitlab, eles fizeram relat√≥rios recentemente, usam o Patroni, est√£o felizes com tudo, todos est√£o felizes. </p><br><p>  <strong>Anton</strong> : Escute, voc√™ pode nos dizer em poucas palavras o que os clientes s√£o para programadores simples?  Estamos principalmente ouvindo l√≠deres de equipe e programadores </p><br><p>  <strong>Nikita</strong> : espere, posso te matar, e pedirei ainda mais aos n√£o programadores para explicar o que √© um multimaster </p><br><p>  <strong>Alexei</strong> : veja, imagine agora, Antokha √© um programador, ele escreve aplicativos, e o aplicativo precisa armazenar seus dados em algum lugar.  Ele os coloca na base, na embaixada.  Em algum momento, o banco de dados est√° localizado em um servidor e, em seguida, no servidor uma vez - e parou de funcionar.  A fonte de alimenta√ß√£o est√° queimada e o aplicativo precisa continuar trabalhando com a base.  E aqui surge a op√ß√£o de que precisamos ter algum tipo de c√≥pia do banco de dados e continuar trabalhando com ele.  E mude para ele e, idealmente, n√£o fa√ßa nenhuma altern√¢ncia para que nosso aplicativo conhe√ßa essa segunda base e continue a grav√°-la. </p><br><p>  Na verdade, √© uma multimaster, quando temos v√°rios n√≥s dispon√≠veis para leitura e grava√ß√£o, e nosso aplicativo pode trabalhar simultaneamente com eles e gravar dados em qualquer um desses n√≥s e ler dados desses n√≥s, mas a natureza √© t√£o organizada que n√£o idealmente alcan√ßado, e h√° pr√≥s e contras, h√° desvantagens, seus pr√≥prios casos de uso para o uso do multimaster.  O exemplo mais comum √© que voc√™ n√£o pode gravar os mesmos dados, relativamente falando, em duas inst√¢ncias, por exemplo, trabalhar com a mesma tabela, gravar na mesma tabela atrav√©s de dois servidores, haver√° conflitos e eles precisar√£o ser resolvidos, isso √© um problema portanto, √© necess√°rio escrever se escrevermos em uma tabela, depois escreveremos apenas atrav√©s de um servidor. </p><br><p>  <strong>Nikita</strong> : e isso est√° diretamente relacionado ao ventilador autom√°tico, sim, ele est√° conectado? </p><br><p>  <strong>Alexei</strong> : sim, e isso se deve ao auto-defensor, aqui, por assim dizer, um segue o outro.  Se n√£o pudermos pagar por um multimaster, queremos um tipo de mecanismo transparente que alterne o n√≥ sobressalente para o modo mestre, ou seja,  temos um aplicativo, ele funciona e, assim que o aplicativo √© eliminado do banco de dados, o desenvolvedor n√£o deseja alterar as configura√ß√µes desse aplicativo e indicar o novo endere√ßo do banco de dados, reiniciar o aplicativo, principalmente se houver muitos aplicativos.  Eu quero algum tipo de mecanismo transparente que funcione em algum lugar oculto, troque o banco de dados e nosso aplicativo funcione com o mesmo endere√ßo e continue lendo este banco de dados.  Para fazer isso, voc√™ j√° precisa de um arquivador autom√°tico que alterne de forma transparente o n√≥ sobressalente para o modo assistente e, para isso, o Patroni √© usado apenas </p><br><p>  <strong>Anton</strong> : Patroni √© um switch puro ou um fork do postgres, algum tipo de complemento? </p><br><p>  <strong>Alexei</strong> : esse, por assim dizer, √© um servi√ßo separado, um processo separado que √© executado em um host com um banco de dados.  E ele monitora o estado do cluster p√≥s-cluster.  Dois objetivos s√£o perseguidos aqui - autofailover e gerenciamento de cluster.  Mas, neste caso, obtemos um cluster distribu√≠do, mas temos v√°rios n√≥s no cluster, um mestre e v√°rias r√©plicas.  Portanto, √© necess√°rio monitorar constantemente o estado do cluster, ver constantemente se o mestre est√° ativo.  Se ele morreu de repente - voc√™ precisa mudar para o papel de "mestre" de outro servidor.  E para isso √© usado, em geral, existem duas abordagens: como apoiar esse cluster de visualiza√ß√µes, a representa√ß√£o no cluster de como ele deve viver no momento.  H√° uma op√ß√£o quando cada um dos n√≥s do cluster - eles checam um ao outro.  E voc√™ pode armazenar esse estado fora, ou seja,  Fora do cluster.  E apenas Patroni usa essa abordagem, ele pega e armazena o estado do cluster no terceiro sistema.  Geralmente, isso √© algum tipo de DCS (configura√ß√£o do sistema de armazenamento distribu√≠do).  Pode ser etcd, consul, ou pode ser kuberenetesovsky etcd.  I.e.  dependendo de qual √© a infraestrutura.  Bem, o Patroni simplesmente salva um estado de cluster neste sistema DCS e o atualiza. </p><br><p>  Se um dos n√≥s falhar repentinamente, um novo n√≥ ser√° selecionado.  Se esse mestre, por exemplo, caiu, um novo mestre √© selecionado e esse estado √© atualizado novamente no DCS.  E aqui, √†s custas da DCS, Patroni apoia a sa√∫de do cluster. </p><br><p>  <strong>Anton</strong> : E se a rede piscasse entre Patroni e a base? </p><br><p>  <strong>Alexei</strong> : Bem, veja, existe um banco de dados, ou √© algum tipo de servidor ou, digamos, no Kubernetes, pode ser algum tipo de sub.  Considere um caso simples, digamos que seja um servidor.  No mesmo servidor, temos um banco de dados em execu√ß√£o e, no mesmo servidor, o agente Patroni.  Este √© um processo leve, eles trabalham no mesmo host e se comunicam relativamente no host local.  Nossa rede pode piscar entre o reposit√≥rio DCS e o host em que a base e o Patroni trabalham. </p><br><p>  Pode haver op√ß√µes diferentes.  Dependendo da gravidade dessa piscada na rede.  Acontece que, se era um mestre, e ele se mostrou isolado, os outros n√≥s descobrir√£o que o mestre se foi.  Eles simplesmente selecionar√£o um novo mestre, e ele ver√° o antigo mestre isolado e Patroni o reiniciar√° no modo somente leitura.  Bem, para que n√£o haja c√©rebro dividido.  √â ruim se nosso aplicativo gravar em dois n√≥s ao mesmo tempo.  Ent√£o os desenvolvedores ter√£o que coletar os dados, e este √© um trabalho muito dif√≠cil - coletar esses dados de forma consistente.  Portanto, o mandril apenas reinicia o n√≥ em somente leitura e √© isso, e funciona.  Assim que a rede for restaurada, a Patroni poder√° acessar o DCS, eles coordenar√£o ainda mais a visualiza√ß√£o do cluster e chegar√£o a algum tipo de solu√ß√£o acordada.  Provavelmente esse n√≥ isolado, que era um mestre antigo, se conectar√° como uma r√©plica ao novo mestre ... </p><br><p>  <strong>Anton</strong> .  Bem, na pr√°tica, como isso funciona?  Existem problemas, armadilhas.  Para Oleg tomar e implementar, por exemplo, Patroni, ele precisa tomar uma decis√£o para isso. </p><br><p>  <strong>Oleg</strong> .  Sim imediatamente </p><br><p>  <strong>Alexey</strong> .  Bem, olha, estamos usando o Patroni com clientes desde o ano passado.  Temos o primeiro cliente que apareceu na minha opini√£o em novembro de 2018.  E naquela √©poca, n√£o t√≠nhamos uma id√©ia muito boa de como trabalhar com isso, mas durante o ano em que trabalhamos, em princ√≠pio, tudo nos conv√©m.  N√≥s aprendemos a cozinhar.  Em princ√≠pio, para trazer √† mente, em geral, ele realmente n√£o precisa de muitas etapas, literalmente duas ou tr√™s a√ß√µes do lado do postgres, do lado das configura√ß√µes do usu√°rio, e tudo isso funciona muito bem. </p><br><p>  A pe√ßa √© confi√°vel.  √â primeiro simples, est√° escrito em Python, consome pouca mem√≥ria e funciona em princ√≠pio de maneira confi√°vel.  A √∫nica coisa na infraestrutura deve ser esse DCS.  Mas, como regra, √© necess√°rio o Consul ou o etcd.  Mas para muitas empresas, isso j√° √© usado para todos os tipos de descoberta de servi√ßos diferentes; portanto, como regra, n√£o h√° problemas com isso. </p><br><p>  E que tipo de problemas surgem: o problema mais b√°sico sobre o qual as pessoas n√£o se sentem imediatamente √© que podemos perder alguns dos dados com o arquivador autom√°tico </p><br><p>  <strong>Oleg</strong> : por causa do atraso na replica√ß√£o? </p><br><p>  <strong>Alexei</strong> : imagine uma situa√ß√£o em que um arquivador autom√°tico ocorre durante a replica√ß√£o, o antigo mestre ficou offline, mas ainda escrevemos parte dos dados.  Suponha que houve algum tipo de atraso na replica√ß√£o, um novo mestre √© selecionado dentre outras r√©plicas.  Um novo mestre √© criado e se Patroni estiver configurado de forma que o n√≥ ca√≠do seja inclu√≠do automaticamente no cluster, por exemplo, a inicializa√ß√£o autom√°tica de servi√ßos √© ativada e, quando o antigo mestre aumenta, ele v√™ que n√£o √© mais um mestre, est√° atrasado, tentar√° se conectar ao novo mestre e se tornar sua sugest√£o.  E nesse momento ele executa o comando pg_rewind. </p><br><p>  Este comando rebobina o log de transa√ß√µes no n√≥ antigo (o mestre antigo) at√© que possa se conectar ao novo mestre, ou seja, o log de transa√ß√µes √© substitu√≠do.  Nesse ponto, podemos perder alguns dados.  No pr√≥prio Patroni, h√° pouca prote√ß√£o, existem algumas reviravoltas que permitem que as r√©plicas n√£o participem das elei√ß√µes com um grande atraso.  Se, por exemplo, todas as r√©plicas tiverem um atraso grande, as elei√ß√µes simplesmente n√£o ser√£o iniciadas e a interven√ß√£o manual do administrador ser√° necess√°ria para que o administrador entre e inicie o arquivo autom√°tico manualmente.  Ou todos v√£o esperar at√© que o velho mestre se levante.  At√© que seu trabalho seja restaurado.  E eles j√° estar√£o conectados a ele e continuar√£o a captur√°-lo. </p><br><p>  Bem, isto √©, no Patroni existem mecanismos que permitem que voc√™ n√£o perca dados, mas h√° um risco, ent√£o voc√™ precisa </p><br><p>  <strong>Anton</strong> : e a replica√ß√£o s√≠ncrona? </p><br><p>  <strong>Alexei</strong> : replica√ß√£o s√≠ncrona, quando usamos replica√ß√£o s√≠ncrona, perdemos desempenho.  Nem todo mundo pode ir para este acordo.  Mas se usarmos a replica√ß√£o s√≠ncrona, o risco de perda de dados ser√° reduzido.  Mas se usarmos v√°rios n√≥s, digamos mais de dois, ainda precisamos considerar a op√ß√£o quando tivermos um acidente na r√©plica mestre e na s√≠ncrona.  E ainda temos uma segunda r√©plica, e pode ser que possamos captur√°-la e perder alguns dados novamente.  Diferentes op√ß√µes s√£o poss√≠veis, elas precisam ser avaliadas, analisadas e entendidas se esse comportamento nos conv√©m ou n√£o. </p><br><p>  <strong>Anton</strong> : escute, apenas dois servidores caem - √© como prever uma invas√£o de alien√≠genas </p><br><p>  <strong>Aleksey</strong> : e h√° uma batida na velha </p><br><p>  <strong>Oleg</strong> : voc√™ se lembra da mesma liga√ß√£o √†s cinco da manh√£ com Lesha pela √∫ltima vez, com o que estava interessante, Anton, e n√£o com a perda imediata de duas bases? </p><br><p>  <strong>Anton</strong> : foi um fator humano.  Bem, sim, isso acontece. </p><br><p>  <strong>Alexey</strong> : a prop√≥sito, n√£o lembro o motivo da liga√ß√£o </p><br><p>  <strong>Anton</strong> : n√≥s transferimos dois servidores para l√°, eles trabalharam em paralelo, registraram dados, n√£o importa.  E os sistemas poderiam funcionar em um, mas um foi transferido para outro data center, ligado.  O segundo foi transportado at√© agora e houve algum tipo de fia√ß√£o tocada no momento da instala√ß√£o, e o antigo tamb√©m foi cortado - eles misturaram algo.  Em geral, n√≥s dois servidores ca√≠mos, come√ßamos a subir e, como eram rigidamente configurados para grava√ß√£o, tinham pontos de verifica√ß√£o muito raros ou algo assim.  Tudo come√ßou por um longo tempo, n√£o entendemos o que estava acontecendo </p><br><p>  <strong>Oleg</strong> : cem shows wal-logs </p><br><p>  <strong>Anton</strong> : n√£o entendemos o que estava acontecendo, por que n√£o come√ßou e, como resultado, tive que fazer uma liga√ß√£o.  Bem, na verdade n√£o havia nada de especial a ser feito ... </p><br><p>  <strong>Alexei</strong> : bem, h√° a √∫nica coisa que provavelmente conectamos, parecemos que tudo est√° em ordem </p><br><p>  <strong>Oleg</strong> : confirmou a morte do paciente </p><br><p>  <strong>Anton</strong> : na verdade, voc√™ s√≥ precisava esperar, em geral. </p><br><p>  <strong>Alexey</strong> .  Sim, este √© um problema conhecido.  Com algumas configura√ß√µes, os pontos de verifica√ß√£o s√£o longos.  Existe um problema. </p><br><p>  Mas, em geral, se voc√™ se lembra dessa chamada noturna, na pr√°tica raramente ligamos √† noite, temos uma automa√ß√£o especial configurada - em servi√ßo, tudo est√° como deveria, selecionado de acordo com uma programa√ß√£o especial.  Ent√£o, se voc√™ se lembra, bem, talvez a cada seis meses algu√©m ligue </p><br><p>  <strong>Oleg</strong> : tudo da nossa empresa √© prov√°vel </p><br><p>  <strong>Alexey</strong> : n√£o, diferente </p><br><p>  <strong>Anton</strong> : Oleg, ligue com mais frequ√™ncia </p><br><p>  <strong>Oleg</strong> : faremos uma transi√ß√£o hoje, provavelmente ligarei </p><br><p>  <strong>Alexey</strong> : n√≥s temos caras, o hor√°rio da noite est√° fechando, eles v√£o funcionar </p><br><p>  <strong>Anton</strong> : escute, Lech, voc√™ disse que Patroni tem alguns an√°logos.  Como eles diferem, quais s√£o </p><br><p>  <strong>Alexey</strong> : existem basicamente duas op√ß√µes, h√° repmgr, essa coisa apareceu h√° muito tempo, cerca de 10 anos atr√°s.  Ele implementa um mecanismo quando os n√≥s de um cluster p√≥s-gra√ßa checam um ao outro, quem est√° vivo, quem n√£o est√° vivo.  Mas, na minha opini√£o, isso n√£o √© muito, eu realmente n√£o gosto desse esquema de trabalho. </p><br><p>  E n√£o h√° um arquivador autom√°tico pronto para uso, o repmgr foi originalmente aprimorado especificamente para gerenciar o cluster e para alternar manualmente, para a altern√¢ncia.  E se voc√™ quiser arquivar automaticamente automaticamente, precisar√° instalar as demos repmgrd separadamente e, como se sabe, o arquivo autom√°tico ser√° iniciado aqui.  A coisa √© conveniente, boa, mas sim - n√£o temos um arquivador autom√°tico pronto para uso.  Voc√™ precisa coloc√°-lo separadamente.  Em geral, a coisa √© boa, conveniente, no sentido de ser bem configur√°vel, √© conveniente manter clusters baseados em cluster.  Ela √© t√£o flex√≠vel, personaliz√°vel.  As r√©plicas podem ser derramadas de v√°rias maneiras.  De backups, de r√©plicas a outras pessoas, do mestre.  Em suma, uma coisa t√£o flex√≠vel, porque 10 anos.  E muitos recursos diferentes foram introduzidos nele, √© muito bom. </p><br><p>  E outra op√ß√£o √© Stolon.  Ele apareceu mais ou menos na mesma √©poca que Patroni, um pouco mais tarde.  Est√° escrito em Go. </p><br><p>  Mas tem uma arquitetura mais ramificada.  Se voc√™ abrir o site do projeto, haver√° fotos e o pr√≥prio Stolon consiste em v√°rios componentes.  Ele tem n√≥s guardi√µes que trabalham com bancos de dados que geram Postges.  Depois, existem os chamados n√≥s Sentinel.  Eles monitoram o estado do cluster, verificam sua disponibilidade, verificam se os n√≥s est√£o ativos ou n√£o.  Eles gerenciam o estado do cluster e o reconfiguram se algo acontecer. </p><br><p>  E existem os chamados n√≥s proxy, todo o tr√°fego passa por eles.  O aplicativo cliente trabalha com proxies.   -,  -   ,       .  I.e.    .  ,   , Stolon     DCS,    consul, etcd.  -       . </p><br><p>    ,      -  ,    bare metal  ,  ,       - ,   .       .        (   -)    ,       ,       . </p><br><p>      ,     .      . ,           . ,         .     oltp-      .   Stolon    ,       . </p><br><p>     ,  6  8,    .     ,    ,  .   ,     ‚Äî wal_keep_segments ‚Äî   - ,   ,    , .      ,    -  . ,        .       .  I.e.        ,    . , ,    .   ,     ‚Äî     .      . </p><br><p> <strong></strong> : , ,   -  Citus?   ,    . </p><br><p> <strong></strong> : Citus ‚Äî    . Citus   ,      CitusDB, -.       ,      ,     ,     </p><br><p> <strong></strong> :  ? </p><br><p> <strong></strong> :  ,  ,    .      .           ,  pg autofailover.       ,      .    ,      ,   . ,      ,        .    ,   ,  .    ,       ,        .  I.e.         . </p><br><p> <strong></strong> :  Citus.    ,       ,          .   ‚Äî   ,    ... </p><br><p> <strong></strong> : , ,  </p><br><p> <strong></strong> : ,     ,           ,  ,   ,  </p><br><p> <strong></strong> :  ,     ,      .  ,   ,  ,   .     "in the wild"  .        ,    . </p><br><p>          ,       <a href="https://soundcloud.com/znprod" rel="nofollow">" "</a> ,   ! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt485322/">https://habr.com/ru/post/pt485322/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt485300/index.html">Novo surto de worms H2Miner que explora Redis RCE foi descoberto</a></li>
<li><a href="../pt485304/index.html">Alguns truques do elemento iframe</a></li>
<li><a href="../pt485312/index.html">DevOps para aplicativos m√≥veis</a></li>
<li><a href="../pt485316/index.html">Todas as SERPs do Google agora parecem an√∫ncios</a></li>
<li><a href="../pt485318/index.html">Adicionando beleza e interatividade aos notebooks Jupyter</a></li>
<li><a href="../pt485324/index.html">Multithreading em Qt Widgets</a></li>
<li><a href="../pt485326/index.html">Criando Micro Frontends Usando Elementos Angulares: Guia para Iniciantes</a></li>
<li><a href="../pt485328/index.html">Especifica√ß√µes sobre ester√≥ides</a></li>
<li><a href="../pt485330/index.html">Como vencer aleatoriamente sem alma em jogos roguelike</a></li>
<li><a href="../pt485334/index.html">Enquete de sess√£o</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>