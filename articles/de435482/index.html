<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∞üèº ‚õ∑Ô∏è ü§±üèø Zirkon-Highlight: vDSO (virtuelles dynamisches gemeinsames Objekt) üë©‚Äçüéì üë®‚Äç‚öïÔ∏è üçë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Zirkon? Was ist das? 


 Im August 2016 wurden ohne offizielle Ank√ºndigungen von Google die Quellen des neuen Betriebssystems entdeckt  Fuchsia. Diese...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zirkon-Highlight: vDSO (virtuelles dynamisches gemeinsames Objekt)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435482/"><h2 id="zircon-chto-eto">  Zirkon?  Was ist das? </h2><br><p>  Im August 2016 wurden ohne offizielle Ank√ºndigungen von Google die Quellen des neuen Betriebssystems entdeckt <img src="https://habrastorage.org/webt/s3/vk/vq/s3vkvqkdg0wsatckxecdfekkdyk.png">  Fuchsia.  Dieses Betriebssystem basiert auf einem Mikrokernel namens Zircon, der wiederum auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">LK (Little Kernel)</a> basiert. </p><br><blockquote>  Fuchsia ist nicht Linux </blockquote><br><div class="spoiler">  <b class="spoiler_title">Anmerkungen des √úbersetzers</b> <div class="spoiler_text"><p>  Ich nicht <del>  echter Schwei√üer </del>  Ich bin Entwickler und / oder Experte bei Zircon.  Der Text unter dem Schnitt ist eine <em>Zusammenstellung von</em> Teil√ºbersetzungen: die <a href="">offizielle Zircon vDSO-Dokumentation</a> und der Artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bewundern des Zirkons Teil 1:</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Grundlegendes zur</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Erstellung minimaler Prozesse</a> aus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@depletionmode</a> , wo ein kleiner <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gag</a> hinzugef√ºgt wurde (der f√ºr Spoiler entfernt wurde).  Konstruktive Vorschl√§ge zur Verbesserung des Artikels sind daher wie immer willkommen. </p></div></div><br><h2 id="o-chem-poydet-rech-v-state">  Was wird im Artikel besprochen? </h2><br><p>  vDSO in Zircon ist das <strong>einzige</strong> Mittel, um auf <a href="">Systemaufrufe (Syscalls) zuzugreifen</a> . </p><br><p>  Ist es wirklich unm√∂glich, die Prozessoranweisungen SYSENTER / SYSCALL direkt aus unserem Code aufzurufen?  Nein, diese Prozessoranweisungen sind nicht Teil des System-ABI.  Es ist dem Benutzercode untersagt, diese Anweisungen direkt zu befolgen. </p><br><p>  Wer mehr √ºber einen solchen architektonischen Schritt erfahren m√∂chte, lade Sie zu Cat ein. </p><br><p><img src="https://habrastorage.org/webt/ns/64/h3/ns64h3y_inuxdxyycmdcmedcjba.png"></p><a name="habracut"></a><br><h2 id="zircon-vdso-virtual-dynamic-shared-object">  Zircon vDSO (virtuelles dynamisches gemeinsames Objekt) </h2><br><p>  Das Akronym vDSO steht f√ºr Virtual Dynamic <strong>S</strong> hared <strong>O</strong> bject: </p><br><ul><li>  Dynamic Shared Object ist ein Begriff, der f√ºr gemeinsam genutzte Bibliotheken f√ºr das ELF-Format (.so-Dateien) verwendet wird. </li><li>  Dieses Objekt ist virtuell, da es nicht aus einer vorhandenen separaten Datei im Dateisystem geladen wird.  Das vDSO-Image wird direkt vom Kernel bereitgestellt. </li></ul><br><h2 id="podderzhka-so-storony-yadra">  Kernel-Unterst√ºtzung </h2><br><p>  Die Unterst√ºtzung von vDSO als einzigem kontrollierten ABI f√ºr Anwendungen im Benutzermodus wird auf zwei Arten implementiert: </p><br><ol><li><p> Projizieren eines virtuellen Speicherobjekts ( <a href="">VMO, Virtual Memory Object</a> ). <br><br>  Wenn <a href="">zx_vmar_map</a> VMO f√ºr vDSO verarbeitet (und <code>ZX_VM_PERM_EXECUTE</code> in den Argumenten angefordert wird), muss der Kernel den Offset und die Gr√∂√üe genau mit dem ausf√ºhrbaren vDSO-Segment √ºbereinstimmen.  Dies (einschlie√ülich) garantiert nur eine vDSO-Projektion in den Prozessspeicher.  Nach der ersten erfolgreichen Projektion von vDSO in den Prozess kann es nicht mehr gel√∂scht werden.  Ein Versuch, vDSO erneut in den Prozessspeicher zu projizieren, versucht, das projizierte VMO f√ºr vDSO oder ein Projekt mit dem falschen Offset und / oder der falschen Gr√∂√üe zu l√∂schen, schl√§gt mit dem Fehler <code>ZX_ERR_ACCESS_DENIED</code> . <br>  Der Offset und die Gr√∂√üe des vDSO-Codes werden beim Kompilieren aus der ELF-Datei extrahiert und dann im Kernel-Code verwendet, um die obigen √úberpr√ºfungen durchzuf√ºhren.  Nach der ersten erfolgreichen vDSO-Projektion merkt sich der Betriebssystemkern die Adresse f√ºr den Zielprozess, um die √úberpr√ºfungen zu beschleunigen. </p><br></li><li><p>  √úberpr√ºfen Sie die R√ºcksprungadressen f√ºr Systemaufruffunktionen. <br><br>  Wenn der Benutzermoduscode den Kernel aufruft, wird eine Systemanrufnummer auf niedriger Ebene im Register √ºbertragen.  Systemaufrufe auf niedriger Ebene sind die interne (private) Schnittstelle zwischen vDSO und dem Zirkonkern.  Einige (die meisten) entsprechen direkt den Systemaufrufen des √∂ffentlichen ABI, andere nicht. <br>  F√ºr jeden Systemaufruf auf niedriger Ebene im vDSO-Code gibt es einen festen Satz von Offsets im Code, die diesen Aufruf ausf√ºhren.  Der Quellcode f√ºr vDSO definiert interne Zeichen, die jeden dieser Speicherorte identifizieren.  Zur Kompilierungszeit werden diese Speicherorte aus der vDSO-Symboltabelle abgerufen und zum Generieren von Kernelcode verwendet, der die Vorhersage der G√ºltigkeit der Codeadresse f√ºr jeden Systemaufruf auf niedriger Ebene bestimmt.  Mit diesen Pr√§dikaten k√∂nnen Sie den aufrufenden Code angesichts des Versatzes vom Anfang des vDSO-Codesegments schnell auf G√ºltigkeit √ºberpr√ºfen. <br>  Wenn das Pr√§dikat feststellt, dass der aufrufende Code keinen Systemaufruf ausf√ºhren darf, wird eine synthetische Ausnahme ausgel√∂st, √§hnlich wie wenn der aufrufende Code versucht hat, eine nicht vorhandene oder privilegierte Anweisung auszuf√ºhren. </p><br></li></ol><br><h2 id="vdso-pri-sozdanii-novogo-processa">  vDSO beim Erstellen eines neuen Prozesses </h2><br><p>  Um die Ausf√ºhrung des ersten Threads eines neu erstellten Prozesses zu starten, wird der <a href="">Systemaufruf zx_process_start verwendet</a> .  Der letzte Parameter dieses Systemaufrufs (siehe arg2 in der Dokumentation) √ºbergibt das Argument f√ºr den ersten Thread des erstellten Prozesses.  Gem√§√ü der akzeptierten Vereinbarung ordnet der Programmlader vDSO dem Adressraum des neuen Prozesses (einer vom System ausgew√§hlten zuf√§lligen Stelle) zu und √ºbertr√§gt die Basisadresse der Zuordnung mit dem Argument arg2 an den ersten Thread des erstellten Prozesses.  Diese Adresse ist die Header-Adresse der ELF-Datei, unter der die erforderlichen benannten Funktionen f√ºr Systemaufrufe gefunden werden k√∂nnen. </p><br><h2 id="karta-pamyati-layout-vdso">  Speicherkarte (Layout) vDSO </h2><br><p>  vDSO ist eine regul√§re gemeinsam genutzte EFL-Bibliothek, die wie jede andere betrachtet werden kann.  Bei vDSO wird jedoch absichtlich eine kleine Teilmenge des gesamten ELF-Formats ausgew√§hlt.  Dies hat mehrere Vorteile: </p><br><ul><li>  Die Zuordnung eines solchen ELF zum Prozess ist einfach und enth√§lt keine komplexen Grenzf√§lle, die zur vollst√§ndigen Unterst√ºtzung von ELF-Programmen erforderlich sind. </li><li>  Die Verwendung von vDSO erfordert keine voll funktionsf√§hige dynamische ELF-Bindung.  Insbesondere hat vDSO keine dynamischen Umz√ºge.  Das Projizieren von PT_LOAD-Segmenten einer ELF-Datei ist die einzige erforderliche Aktion. </li><li>  Der vDSO-Code ist zustandslos und wiedereintrittsf√§hig.  Es funktioniert ausschlie√ülich mit Prozessorregistern und dem Stack.  Dies macht es f√ºr den Einsatz in einer Vielzahl von Kontexten mit minimalen Einschr√§nkungen geeignet, was dem obligatorischen ABI-Betriebssystem entspricht.  Es vereinfacht auch die Code-Analyse und -Verifizierung f√ºr Zuverl√§ssigkeit und Sicherheit. </li></ul><br><p>  Der gesamte vDSO-Speicher wird durch zwei aufeinanderfolgende Segmente dargestellt, von denen jedes ausgerichtete ganze Seiten enth√§lt: </p><br><ol><li>  Das erste Segment ist schreibgesch√ºtzt und enth√§lt ELF-Header sowie konstante Daten. </li><li>  Das zweite Segment ist ausf√ºhrbar und enth√§lt vDSO-Code. </li></ol><br><p>  Das gesamte vDSO-Image besteht nur aus den Seiten dieser beiden Segmente.  F√ºr die Anzeige des vDSO-Speichers sind nur zwei aus ELF-Headern extrahierte Werte erforderlich: die Anzahl der Seiten in jedem Segment. </p><br><h2 id="konstantnye-dannye-vremeni-zagruzki-os">  Konstante Daten zur Startzeit des Betriebssystems </h2><br><p>  Einige Systemaufrufe geben einfach Werte zur√ºck, die konstant sind (Werte m√ºssen zur Laufzeit angefordert werden und k√∂nnen nicht in Benutzermoduscode kompiliert werden).  Diese Werte werden entweder zur Kompilierungszeit im Kernel festgelegt oder beim Start vom Kernel festgelegt (Startparameter und Hardwareparameter).  Zum Beispiel: <a href="">zx_system_get_version ()</a> , <a href="">zx_system_get_num_cpus ()</a> und <a href="">zx_ticks_per_second ()</a> .  Der R√ºckgabewert der letzten Funktion wird beispielsweise vom <a href="">Kernel-Befehlszeilenparameter beeinflusst</a> . </p><br><div class="spoiler">  <b class="spoiler_title">Warten Sie, ist die Anzahl der CPUs eine Konstante?</b> <div class="spoiler_text"><p>  Interessanterweise besagt die Beschreibung der Funktion <a href="">zx_system_get_num_cpus ()</a> auch explizit, dass das Betriebssystem das <em>Hot-</em> <a href="">Swapping der</a> Anzahl der Prozessoren nicht unterst√ºtzt: </p><br><blockquote>  Diese Nummer kann sich w√§hrend eines Systemlaufs nur beim Booten nicht √§ndern. </blockquote><p>  Dies zeigt zumindest indirekt an, dass das Betriebssystem nicht als Server positioniert ist. </p></div></div><br><p>  Da diese Werte konstant sind, ist es nicht sinnvoll, f√ºr echte Systemaufrufe an den Betriebssystemkern zu zahlen.  Stattdessen handelt es sich bei ihrer Implementierung um einfache C ++ - Funktionen, die aus dem vDSO-Konstantensegment gelesene Daten zur√ºckgeben.  W√§hrend der Kompilierung erfasste Werte (z. B. die Versionszeichenfolge des Systems) werden einfach in vDSO kompiliert. </p><br><p>  F√ºr Werte, die beim Booten ermittelt wurden, sollte der Kernel den Inhalt von vDSO √§ndern.  Dies erfolgt mithilfe von fr√ºh ausf√ºhrbarem Code, der das VMO-vDSO bildet, bevor der Kernel den ersten Benutzerprozess startet (und ihm den VMO-Deskriptor √ºbergibt).  W√§hrend der Kompilierung werden Offsets aus dem vDSO-Image ( <a href="">vdso_constants</a> ) aus der ELF-Datei extrahiert und dann in den Kernel eingebettet.  Beim Booten zeigt der Kernel vor√ºbergehend Seiten, die sich √ºber <a href="">vdso_constants erstrecken,</a> in seinem eigenen Adressraum an, um die Struktur mit den richtigen Werten <a href="">vorinitialisieren zu</a> k√∂nnen (f√ºr den aktuellen Systemstart). </p><br><h2 id="k-chemu-vsya-eta-golovnaya-bol">  Warum all diese <em>Kopfschmerzen</em> ? </h2><br><p>  Einer der wichtigsten Gr√ºnde ist die Sicherheit.  Das hei√üt, wenn es einem Angreifer gelingt, beliebigen (Shell-) Code auszuf√ºhren, muss er vDSO-Funktionen verwenden, um Systemfunktionen aufzurufen.  Das erste Hindernis ist die oben erw√§hnte Randomisierung der vDSO-Startadresse f√ºr jeden erstellten Prozess.  Und da der Betriebssystemkern f√ºr das VMO (Virtual Memory Object) von vDSO verantwortlich ist, kann er ein v√∂llig anderes vDSO einem bestimmten Prozess zuordnen und so gef√§hrliche (und f√ºr einen bestimmten Prozess nicht ben√∂tigte) Systemaufrufe verhindern.  Beispiel: Sie k√∂nnen verhindern, dass <a href="">Treiber</a> untergeordnete Prozesse erzeugen oder MMIO-Bereiche projizieren.  Dies ist ein gro√üartiges Werkzeug, um die Angriffsfl√§che zu reduzieren. </p><br><p>  Hinweis: Derzeit wird die Unterst√ºtzung f√ºr mehrere vDSOs aktiv weiterentwickelt.  Es gibt bereits eine Proof-of-Concept-Implementierung und einfache Tests. Es sind jedoch weitere Arbeiten erforderlich, um die Zuverl√§ssigkeit der Implementierung zu verbessern und festzustellen, welche Optionen verf√ºgbar sind.  Das aktuelle Konzept bietet vDSO-Image-Optionen, mit denen nur eine Teilmenge der vollst√§ndigen vDSO-Systemaufrufschnittstelle exportiert wird. </p><br><div class="spoiler">  <b class="spoiler_title">Was ist mit anderen Betriebssystemen?</b> <div class="spoiler_text"><p>  Es ist zu beachten, dass √§hnliche Techniken bereits erfolgreich in anderen Betriebssystemen verwendet wurden.  Unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Windows gibt es beispielsweise eine ProcessSystemCallDisablePolicy</a> : </p><br><blockquote>  Win32k-Systemaufruf deaktivieren Einschr√§nkung, um die Verwendung von NTUser und GDI einzuschr√§nken </blockquote></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de435482/">https://habr.com/ru/post/de435482/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de435466/index.html">React Tutorial Teil 6: Einige Funktionen des Kurses, JSX und JavaScript</a></li>
<li><a href="../de435468/index.html">React Tutorial Teil 7: Inline-Stile</a></li>
<li><a href="../de435470/index.html">React Tutorial, Teil 8: Fortsetzung der Arbeit an einer TODO-Anwendung, Einf√ºhrung in die Komponenteneigenschaften</a></li>
<li><a href="../de435476/index.html">Mkcert: g√ºltige HTTPS-Zertifikate f√ºr localhost</a></li>
<li><a href="../de435480/index.html">Microsoft und Kroger werden Amazon einen Kampf auf dem Gebiet geben ... den Handel mit Lebensmitteln</a></li>
<li><a href="../de435484/index.html">Fuzzing Style 1989</a></li>
<li><a href="../de435488/index.html">Verspottet, stummelt und spioniert im Spock Framework</a></li>
<li><a href="../de435490/index.html">Google Steuer√§nderungen im Jahr 2019</a></li>
<li><a href="../de435494/index.html">Nahtloser Client-Server</a></li>
<li><a href="../de435496/index.html">Tesla klagte wegen eines Unfalls, bei dem Fahrer und Beifahrer des Modells S starben</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>