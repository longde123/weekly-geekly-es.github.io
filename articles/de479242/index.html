<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛶 🗂️ ⤵️ Wir stellen Yandex.Station fertig, um YouTube anzuschauen 👩🏾‍🚀 🐼 👨‍👦‍👦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Auf Yandex.Stations ist es unpraktisch, YouTube anzusehen. Es gibt keine Empfehlungen, Abonnements und auch die Suche funktioniert nicht normal. Desha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wir stellen Yandex.Station fertig, um YouTube anzuschauen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479242/">  Auf Yandex.Stations ist es unpraktisch, YouTube anzusehen.  Es gibt keine Empfehlungen, Abonnements und auch die Suche funktioniert nicht normal.  Deshalb habe ich ein Telegramm an den Bot geschrieben, um ein Video an ihn zu senden. <br><br><div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/3p/mb/iu/3pmbiuv8wfkjlr5yjfdndeyhfe4.gif"></div><br><br>  Unter dem Strich geht es <b>darum,</b> wie ich es gemacht habe, <b>obwohl es keine offizielle offene API gibt</b> . <br><a name="habracut"></a><br><h2>  Wie hat alles angefangen? </h2><br>  Ich bin Ingenieur.  Ich studiere ständig, wie verschiedene Technologien und Dinge funktionieren, und mache auch selbst viele interessante Projekte.  Als meine Freunde mir Yandex.Station gaben, kehrte ich das Aktivierungsprotokoll um und <a href="https://habr.com/ru/post/470293/">entwickelte die</a> Idee der Datenübertragung, die sich am Wow-Effekt orientierte. <br><br>  Ich habe einen blöden (nicht intelligenten) Fernseher und benutze als Hauptmedienkonsole die Station.  Alles ist in Ordnung, aber nur YouTube zu sehen ist völlig unangenehm.  Du kannst dich nicht in deinem YouTube-Konto anmelden. Dies bedeutet, dass keine Empfehlungen und Abonnements vorhanden sind.  Außerdem wird die Videosuche in der Station, wie ich es verstehe, über Yandex.Video durchgeführt.  Leider funktioniert ein solches Schema nicht sehr gut.  Manchmal gibt es keine Videos, auch wenn Sie den Namen buchstäblich aussprechen, und neue Videos können erst dann angesehen werden, wenn die Yandex-Suchmaschine sie indiziert. <br><br>  Ich habe mich fast damit abgefunden, dass man auf der Station kein YouTube ansehen kann, aber das hat sich vor ein paar Wochen geändert. <br><br><h2>  Was ist passiert? </h2><br>  Am Samstagmorgen habe ich beschlossen, mir die letzte Staffel von Silicon Valley anzuschauen.  Ich ging zu Kinopoisk und sah Folgendes: <br><br><div style="text-align:center;"><img width="300" src="https://habrastorage.org/webt/l9/ot/u7/l9otu7l6_zwt1v_zc2qsvgbdp6g.png"></div><br>  Nach einem Klick auf den Button flog das Video zu Yandex.Station und wurde dort weiter abgespielt.  Genau wie ChromeCast oder AirPlay.  Freude!  Ich war jedoch nicht von der Funktionalität an sich begeistert, sondern von der Möglichkeit, Videos an die Station zu senden. <br><br>  Ich habe vergessen, über die Serie nachzudenken - für das ganze Wochenende habe ich mich mit Reverse Engineering und Entwicklung befasst. <br><br><h2>  Lass es uns richtig machen. </h2><br>  Wir öffnen Kinopoisk oder Yandex.Video in Chrome - es gibt ausgezeichnete Tools für die Webentwicklung.  Suchen Sie die gewünschte Schaltfläche, klicken Sie mit der rechten Maustaste und wählen Sie "Das Objekt erkunden". <br><br><div style="text-align:center;"><img width="300" src="https://habrastorage.org/webt/ny/rq/et/nyrqetlz0e8rti6gmv33pe1bg5a.png"></div><br>  Dort kann man viel lernen, aber wir sind daran interessiert, welche Anforderung ausgeführt wird, wenn auf diese Schaltfläche geklickt wird.  Wir gehen zur Registerkarte "Netzwerk" der Entwicklertools und sehen uns die Anforderungen an. <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/pg/pc/zc/pgpczch8nxzxytxn7cucxl9gark.png"></div><br>  Ja, viele Statistiken fliegen davon, aber 2 interessante Anfragen sind sofort sichtbar.  Dies sind devices_online_stats und station. <br><br><h2>  Liste der Geräte abrufen </h2><br>  devices_online_stats - Aktive Benutzergeräte anfordern.  Einfache Get-Anfrage.  Wenn Sie in Yandex autorisiert sind, können Sie sich über Ihre Geräte informieren, indem Sie den Link in einem Browser öffnen: <br><br>  <a href="https://quasar.yandex.ru/devices_online_stats" rel="nofollow">quasar.yandex.ru/devices_online_stats</a> <br><br>  Was in der Antwort: <br><br><pre><code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"items"</span></span>:[ { <span class="hljs-attr"><span class="hljs-attr">"icon"</span></span>:<span class="hljs-string"><span class="hljs-string">"https://avatars.mds.yandex.net/get-yandex-station/1540981/yandexstationicon/orig"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-string"><span class="hljs-string">"************"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"online"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"platform"</span></span>:<span class="hljs-string"><span class="hljs-string">"yandexstation"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"screen_capable"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"screen_present"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"status"</span></span>:<span class="hljs-string"><span class="hljs-string">"ok"</span></span> }</code> </pre> <br>  Interessant und sehr intuitiv.  Ich habe die Stations-ID im Beispiel für alle Fälle durch Sternchen ersetzt, aber wir werden sie in Zukunft brauchen. <br><br><h2>  Video abspielen </h2><br>  Eine Anfrage an <a href="https://yandex.ru/video/station" rel="nofollow">yandex.ru/video/station wird</a> mit der POST-Methode gesendet.  Wiederholen Sie diesen Vorgang von der Konsole aus und empfangen Sie den Befehl wie folgt: <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/90/cz/dx/90czdx3um7nns9uufhik5ufzvlq.png"></div><br>  Führen Sie das Terminal aus und erhalten Sie die Antwort: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"status"</span></span>: <span class="hljs-string"><span class="hljs-string">"play"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"msg"</span></span>: <span class="hljs-string"><span class="hljs-string">"success"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"code"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }</code> </pre> <br>  Nach ein paar Sekunden startet das Video am Sender.  Erfolg! <br><br><h2>  Wir sammeln </h2><br>  Ich habe alle "zusätzlichen" Felder aus der Anfrage entfernt, damit sie funktionsfähig bleibt.  Um ein Video an die Station im Hauptteil und in den Headern der POST-Anforderung zu senden, müssen Sie nur 4 Parameter eingeben: <br><br><ul><li>  SessionID - Autorisierung in Yandex </li><li>  x-csrf-token </li><li>  provider_item_id - Link zum Video (oder Kennung für einige Dienste) </li><li>  device - Die Kennung des Geräts, das wir zuvor erhalten haben </li></ul><br>  Was ist x-csrf-token?  Wir werden jetzt nicht tief gehen.  Es kann einfach durch eine GET-Anfrage an <a href="https://frontend.vh.yandex.ru/csrf_token" rel="nofollow">frontend.vh.yandex.ru/csrf_token</a> abgerufen werden, wenn Sie in Yandex autorisiert sind. <br><br>  Zu diesem Zeitpunkt hatte ich bereits begonnen, alles in ein Python-Skript zu packen.  Infolgedessen sieht die Funktion zum Senden von Videos an die Station ungefähr so ​​aus: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendToScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(video_url)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># Auth and getting Session_id auth_data = { 'login': config.login, 'passwd': config.password } s = requests.Session() s.get("https://passport.yandex.ru/") s.post("https://passport.yandex.ru/passport?mode=auth&amp;retpath=https://yandex.ru", data=auth_data) Session_id = s.cookies["Session_id"] # Getting x-csrf-token token = s.get('https://frontend.vh.yandex.ru/csrf_token').text # Getting devices info </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> device selection here devices_online_stats = s.get("https://quasar.yandex.ru/devices_online_stats").text devices = json.loads(devices_online_stats)["items"] # Preparing request headers = { "x-csrf-token": token, } data = { "msg": { "provider_item_id": video_url }, "device": devices[0]["id"] } if "https://www.youtube" in video_url: data["msg"]["player_id"] = "youtube" # Sending command with video to device res = s.post("https://yandex.ru/video/station", data=json.dumps(data), headers=headers) return res.text</span></span></code> </pre> <br>  Möglicherweise haben Sie bemerkt, dass ich das Feld player_id hinzufüge, wenn ein Link von YouTube gesendet wird.  Tatsache ist, dass es auf der Station mehrere Spieler mit den Codes youtube, vh und ott gibt.  Standardmäßig wird vh verwendet, aber dann werden die Vorschau und der Titel des Videos unterbrochen.  Außerdem wird sein Status nicht zurückgesetzt, wenn der Film geändert wird, was häufig zu Fehlern führt (Möglicherweise waren nicht alle Felder in der Anforderung "redundant").  Soweit ich weiß, wird der Ott-Player für Streaming-Dienste verwendet, sodass Sie in Zukunft IPTV über den Sender sehen können. <br><br><h2>  Was ist das ergebnis </h2><br>  Jetzt habe ich einen Bot, über den wir Videos von YouTube an die Station senden.  Klicke einfach in der YouTube-Anwendung auf "Teilen" und sende den Link an Bot.  Übrigens, ich habe es "Box" genannt und ein Logo gemacht. <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/rv/su/bm/rvsubmacu1ugpftjfa5espxdbcq.jpeg"></div><br>  Ich habe es nicht veröffentlicht, um keine Logins und Passwörter zu sammeln.  Sie können jedoch dasselbe für sich selbst bereitstellen oder für die OAuth-Autorisierung oder das Senden von Videos von anderen Websites ändern.  Alle Quellen sind auf <a href="https://github.com/Krupnikas/yashhik" rel="nofollow">GitHub</a> verfügbar. <br><br>  Ich wollte eine Browsererweiterung so gestalten, dass sie mit jedem Video wie AirPlay funktioniert, habe jedoch festgestellt, dass es bequemer ist, die Anwendung vom Telefon aus zu senden.  Und für dieses Szenario ist ein Bot besser geeignet.  Hier ist ein Video seiner Arbeit: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Y3uzSJV2lmo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2>  Fazit </h2><br>  Wenn einem Ingenieur die Funktionalität fehlt, vervollständigt er sie selbst.  Jetzt benutzen wir diesen Bot wirklich regelmäßig - sehr praktisch :) <br><br>  Yandex Entwickler, bitte brechen Sie diese Anfrage nicht.  Dies ist keine Sicherheitslücke.  Funktioniert nur mit Authentifizierung.  Und wenn Sie - die Geräte-API öffentlich machen - können Sie noch viel mehr tun! <br><br>  Vielen Dank für das Lesen meiner Artikel!  Ich hoffe du warst interessiert. <br><br>  Viel Glück! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de479242/">https://habr.com/ru/post/de479242/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de479232/index.html">MQ JMS-Anwendungsentwicklung auf Spring Boot</a></li>
<li><a href="../de479234/index.html">Neuigkeiten aus der Welt von OpenStreetMap Nr. 488 (19.11.19 - 25.11.19)</a></li>
<li><a href="../de479236/index.html">Kivy. Erstellen Sie Pakete für Android und keine Zauberei</a></li>
<li><a href="../de479238/index.html">Funktionale Programmierung ist nicht das, was uns gesagt wird</a></li>
<li><a href="../de479240/index.html">Der Code, in dem wir leben</a></li>
<li><a href="../de479244/index.html">Präfixbaum mit Bitmap-Indizes</a></li>
<li><a href="../de479246/index.html">11 Richtungen für das Wachstum und die berufliche Entwicklung eines Programmierers</a></li>
<li><a href="../de479248/index.html">Mitap „Kubernetes in Aktion!“ - echte Erfahrung beim Aufbau skalierbarer Systeme</a></li>
<li><a href="../de479250/index.html">Wie ich gelernt habe, mit Mikrocontrollern zu arbeiten - eine Anfängererfahrung</a></li>
<li><a href="../de479252/index.html">Listenverständnis vs Karte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>