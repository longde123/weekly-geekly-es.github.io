<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👍🏼 👩🏾 🕝 كيفية الترميز الجغرافي مليون نقطة على سبارك بطريقة سريعة؟ 🦈 🏴󠁧󠁢󠁷󠁬󠁳󠁿 🚗</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="في مشروعي السابق ، واجهنا مهمة تنفيذ الترميز الجغرافي العكسي للعديد من أزواج الإحداثيات الجغرافية. الترميز الجغرافي العكسي هو إجراء يطابق عنوان أو اسم...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>كيفية الترميز الجغرافي مليون نقطة على سبارك بطريقة سريعة؟</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438046/" style=";text-align:right;direction:rtl">  في مشروعي السابق ، واجهنا مهمة تنفيذ الترميز الجغرافي <b>العكسي</b> للعديد من أزواج الإحداثيات الجغرافية.  الترميز الجغرافي العكسي هو إجراء يطابق عنوان أو اسم كائن ما على خريطة تنتمي إليها نقطة محددة بالإحداثيات أو تقترب منها.  وهذا هو ، نحن نأخذ الإحداثيات ، نقول هذه: @ 55.7602485،37.6170409 ، ونحصل على النتيجة إما "روسيا ، المنطقة الفيدرالية المركزية ، موسكو ، ساحة المسرح ، منزل مماثل" ، أو على سبيل المثال ، "مسرح البولشوي". <br><br>  إذا كان العنوان أو الاسم عند الإدخال ، وكانت الإحداثيات قيد الإخراج ، فإن هذه العملية هي <b>الترميز الجغرافي المباشر</b> ، ونأمل أن نتحدث عن هذا لاحقًا. <br><br>  كمدخلات ، كان لدينا حوالي 100 أو 200 ألف نقطة عند المدخلات التي تكمن في كتلة Hadoop كجدول Hive.  هذا هو توضيح حجم المهمة. <br><br>  تم اختيار Spark في النهاية كأداة للمعالجة ، على الرغم من أننا في هذه العملية جربنا كلاً من MapReduce و Apache Crunch.  لكن هذه قصة منفصلة ، ربما تستحق هذا المنصب. <br><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  حل مباشر مع وسائل بأسعار معقولة </h2><br>  بادئ ذي بدء ، حاولنا التعامل مع المشكلة ، إذا جاز التعبير.  كأداة ، كان هناك خادم ArcGIS يوفر خدمة ROD للترميز الجغرافي العكسي.  استخدامه بسيط للغاية ، ولهذا نقوم بإجراء طلب HTTP GET بعنوان URL التالي: <br><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">http://-url/GeocodeServer/reverseGeocode?&lt;&gt;</code> </pre> <br>  من بين العديد من المعلمات ، يكفي تعيين الموقع = x ، y (الشيء الرئيسي هو عدم الخلط بين أيٍّ منها هو خط العرض وأي خط طول ؛).  والآن لدينا بالفعل JSON مع النتائج: البلد ، المنطقة ، المدينة ، الشارع ، رقم المنزل.  مثال من الوثائق: <br><br><pre style=";text-align:right;direction:rtl"> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"address"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Match_addr"</span></span>: <span class="hljs-string"><span class="hljs-string">"Beeman's Redlands Pharmacy"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"LongLabel"</span></span>: <span class="hljs-string"><span class="hljs-string">"Beeman's Redlands Pharmacy, 255 Terracina Blvd, Redlands, CA, 92373, USA"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ShortLabel"</span></span>: <span class="hljs-string"><span class="hljs-string">"Beeman's Redlands Pharmacy"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Addr_type"</span></span>: <span class="hljs-string"><span class="hljs-string">"POI"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Pharmacy"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PlaceName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Beeman's Redlands Pharmacy"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AddNum"</span></span>: <span class="hljs-string"><span class="hljs-string">"255"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Address"</span></span>: <span class="hljs-string"><span class="hljs-string">"255 Terracina Blvd"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Block"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Sector"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Neighborhood"</span></span>: <span class="hljs-string"><span class="hljs-string">"South Redlands"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"District"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"City"</span></span>: <span class="hljs-string"><span class="hljs-string">"Redlands"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"MetroArea"</span></span>: <span class="hljs-string"><span class="hljs-string">"Inland Empire"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Subregion"</span></span>: <span class="hljs-string"><span class="hljs-string">"San Bernardino County"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Region"</span></span>: <span class="hljs-string"><span class="hljs-string">"California"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Territory"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Postal"</span></span>: <span class="hljs-string"><span class="hljs-string">"92373"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PostalExt"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"CountryCode"</span></span>: <span class="hljs-string"><span class="hljs-string">"USA"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"location"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"x"</span></span>: <span class="hljs-number"><span class="hljs-number">-117.20558993392585</span></span>, <span class="hljs-attr"><span class="hljs-attr">"y"</span></span>: <span class="hljs-number"><span class="hljs-number">34.037880040538894</span></span>, <span class="hljs-attr"><span class="hljs-attr">"spatialReference"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"wkid"</span></span>: <span class="hljs-number"><span class="hljs-number">4326</span></span>, <span class="hljs-attr"><span class="hljs-attr">"latestWkid"</span></span>: <span class="hljs-number"><span class="hljs-number">4326</span></span> } } }</code> </pre><br>  يمكنك أيضًا الإشارة إلى أنواع الإجابات التي نريدها - العناوين البريدية ، أو تحديد نقطة الاهتمام (POI) (نقطة الاهتمام ، هذه للحصول على إجابات مثل "مسرح البولشوي") ، أو ما إذا كنا نحتاج إلى تقاطعات الشوارع ، على سبيل المثال.  يمكنك أيضًا تحديد نصف القطر الذي سيتم من خلاله البحث عن كائن مسمى من النقطة المحددة. <br><br>  للتحقق بسرعة من جودة الاستجابة ، يمكنك تقدير المسافة بين نقطة البداية في معلمات الطلب والنقطة المستلمة - موقع استجابة الخدمة. <br><br>  يبدو أن كل شيء الآن سيكون على ما يرام.  ولكن كان هناك.  كان مثيل ArcGIS الخاص بنا بطيئًا جدًا ، وتم تخصيص الخادم لـ 4 مراكز ، وحوالي 8 غيغابايت من ذاكرة الوصول العشوائي.  نتيجة لذلك ، يمكن للمهمة على الكتلة قراءة 200 ألف نقطة لدينا بسرعة كبيرة ، ولكن تعتمد على أداء REST و ArcGIS.  والتكويد الجغرافي جميع النقاط استغرق ساعات.  في الوقت نفسه ، خصصنا حوالي 8 مراكز فقط على Hadoop ، وقليلًا من الذاكرة ، ولكن نظرًا لأن تحميل خادم ArcGIS كان قريبًا من 100٪ لعدة ساعات ، فإن الموارد الإضافية في المجموعة لم تعطنا أي شيء. <br><br>  لا يعرف ArcGIS كيفية إجراء عمليات الترميز الجغرافي العكسي دفعة واحدة ، لذلك يتم تنفيذ الطلب مرة واحدة لكل نقطة.  وبالمناسبة ، إذا لم تستجب الخدمة ، فنحن نتوقف عند انتهاء المهلة أو مع وجود خطأ ، وما يجب فعله بها يمثل مشكلة مع إجابة غير واضحة.  ربما حاول مرة أخرى ، أو ربما أكمل العملية بأكملها ، ثم كررها للنقاط الأولية. <br><br><h2 style=";text-align:right;direction:rtl">  التقريب الثاني ، ونحن نقدم ذاكرة التخزين المؤقت </h2><br>  بادئ ذي بدء ، اكتشفنا أن العديد من النقاط في مجموعتنا لها إحداثيات متكررة.  السبب بسيط - من الواضح أن دقة GPS ليست جيدة بما فيه الكفاية لإحداثيات النقاط التي تقع على بعد مترين عن بعضها البعض في الإخراج ، أو الإحداثيات التي تم الحصول عليها ليس من GPS ، ولكن من قاعدة أخرى ، تم إدخالها ببساطة في قاعدة البيانات المصدر.  بشكل عام ، لا يهم السبب في ذلك ، فالأمر الرئيسي هو أن هذا هو الوضع المعتاد للغاية ، وبالتالي فإن ذاكرة التخزين المؤقت للنتائج الواردة من الخدمة سوف تتيح لك الترميز الجغرافي لكل زوج من الإحداثيات مرة واحدة فقط.  ويمكننا تحمل ذاكرة ذاكرة التخزين المؤقت. <br><br>  في الواقع ، تم إجراء التعديل الأول للخوارزمية تافها - تم إضافة جميع النتائج التي تم الحصول عليها من REST إلى ذاكرة التخزين المؤقت ، وبالنسبة لجميع النقاط ، تم إجراء بحث لأول مرة عن الإحداثيات فيه.  لم نبدأ في إنشاء ذاكرة تخزين مؤقت مشتركة لجميع عمليات الشرارة - على كل عقدة من الكتلة التي كانت بها. <br><br>  بهذه الطريقة البسيطة ، تمكنا من الحصول على تسارع يصل إلى حوالي 10 مرات ، وهو ما يقابل تقريبًا عدد مرات الإحداثيات المتكررة في المجموعة الأصلية.  كان مقبولا بالفعل ، ولكن لا يزال بطيئا للغاية. <br><br>  حسنًا ، أخبرنا عميلنا في هذا الوقت ، إذا لم نتمكن من معرفة العناوين بشكل أسرع ، فهل يمكننا تحديد مدينة على الأقل بسرعة؟  وتناولنا ... <br><br><h2 style=";text-align:right;direction:rtl">  حل مبسط ، وتنفيذ Geomerty API </h2><br>  ماذا لدينا لتحديد المدينة؟  كان لدينا هندسة المناطق الروسية ، التقسيم الإداري الإقليمي ، تقريبا دقيقة لمناطق المدينة. <br><br>  يمكنك أن تأخذ هذه البيانات على سبيل المثال <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">هنا</a> .  ما هو هناك؟  هذه قاعدة بيانات للحدود الإدارية للاتحاد الروسي ، للمستويات من 2 (البلد) إلى 9 (المناطق الحضرية).  التنسيق إما geojson أو CSV (بينما تكون الهندسة نفسها بتنسيق wkt).  في المجموع ، قاعدة البيانات حوالي 20 ألف سجل. <br><br>  بدا حل مبسط جديد للمشكلة كما يلي: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  تحميل بيانات ADT إلى خلية. </li><li style=";text-align:right;direction:rtl">  لكل نقطة مع الإحداثيات ، ننظر في جدول التقسيم الإقليمي للمضلعات حيث تدخل هذه النقطة. </li><li style=";text-align:right;direction:rtl">  فرز المضلعات الموجودة حسب المستوى. </li></ol><br>  نتيجة لذلك ، نحصل على شيء مثل: روسيا ، والمنطقة الفيدرالية المركزية ، وموسكو ، ومثل هذه المنطقة الإدارية ، ومنطقة من هذا القبيل ، وهذا هو ، قائمة المناطق التي تنتمي إليها وجهة نظرنا. <br><br><h3 style=";text-align:right;direction:rtl">  تحميل ADT </h3><br>  لتنزيل ملف CSV بطريقة أسهل ، نستخدم <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الطائرات الورقية</a> .  يمكن لهذه الأداة أن تنشئ مخططًا جيدًا لخلية الخلية بناءً على رؤوس الأعمدة في ملف CSV.  في الواقع ، يأتي الاستيراد إلى ثلاثة أوامر (يتم تكرار أحدها لكل ملف مستوى): <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">kite-tools csv-schema admin_level_2.csv --class al --delimiter \; &gt;adminLevel.avrs kite-tools create dataset:hive:/default/levelswkt -s adminLevel.avrs kite-tools csv-import admin_level_2.csv dataset:hive:/default/levelswkt --delimiter \; ... kite-tools csv-import admin_level_10.csv dataset:hive:/default/levelswkt --delimiter \;</code> </pre><br>  ماذا فعلنا هنا؟  قام الفريق الأول ببناء نظام Avro لـ csv ، والذي حددنا له بعض معلمات المخطط (الفئة ، في هذه الحالة) ، وفاصل حقل لـ CSV.  بعد ذلك ، يجدر النظر إلى المخطط الذي تم الحصول عليه بأعينك ، ومن الممكن إجراء بعض التصحيحات ، لأن Kite لا ينظر في جميع سطور ملفنا ، ولكن في بعض العينات فقط ، لذلك يمكن أن يقوم في بعض الأحيان بافتراضات غير صحيحة حول نوع البيانات (رأيت ثلاثة أرقام - لقد رأيت ذلك العمود العددي ، ثم ذهب السطر). <br><br>  حسنًا ، بناءً على المخطط ، نقوم بإنشاء مجموعة بيانات (هذا هو المصطلح العام Kite ، تعميم الجداول في Hive ، الجداول في HBase ، وشيء آخر).  في هذه الحالة ، تكون قاعدة البيانات الافتراضية (بالنسبة لخلايا Hive فهي نفس قاعدة البيانات) ، و levelswkt هو اسم جدولنا. <br><br>  حسنًا ، تقوم أحدث الأوامر بتحميل ملفات CSV إلى مجموعة البيانات الخاصة بنا.  بعد اكتمال التنزيل بنجاح ، يمكنك بالفعل إكمال الطلب: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> levelswkt;</code> </pre> <br>  في مكان ما في هوى. <br><br><h3 style=";text-align:right;direction:rtl">  العمل مع الهندسة </h3><br>  للعمل مع الهندسة في Java ، اخترنا Esri <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Java Geometry API</a> (مطور ArcGIS).  من حيث المبدأ ، كان من الممكن اتخاذ أطر أخرى ، فهناك بعض الخيارات من Open Source ، على سبيل المثال ، <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">JTS Topology Suite</a> المعروفة أو <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Geotools</a> . <br><br>  المهمة الأولى تسمح لنا بالتعامل مع إطار آخر من نفس شركة Esri ، وتسمى <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Spatial Framework for Hadoop</a> ، وعلى أساس الأول.  في الواقع ، نحن بحاجة إلى ما يسمى SerDe منه ، وحدة إلغاء تسلسل التسلسل لـ Hive ، والذي يسمح لنا بتقديم مجموعة من ملفات geojson كجدول في Hive ، والتي يتم أخذ أعمدة منها من سمات geojson.  وتصبح الهندسة نفسها عمودًا آخر (مع البيانات الثنائية).  نتيجة لذلك ، لدينا جدول ، أحد أعمدةه هو هندسة منطقة معينة ، والباقي سماته (الاسم ، المستوى في ADT ، إلخ).  هذا الجدول متاح لتطبيق Spark. <br><br>  إذا قمنا بتحميل قاعدة البيانات بتنسيق CSV ، فلدينا عمود حيث تكون الأشكال الهندسية في شكل نص ، بتنسيق <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">WKT</a> .  في هذه الحالة ، يمكن لـ Spark إنشاء كائن هندسي في وقت التشغيل باستخدام واجهة برمجة تطبيقات Geometry. <br><br>  اخترنا تنسيق CSV (و WKT) ، لسبب واحد بسيط - كما يعلم الجميع ، تحتل روسيا على خريطة المنطقة بتنسيقات Chukotka تتجاوز 180 خط الطول.  يحتوي تنسيق geojson على قيود - يجب أن تقتصر جميع المضلعات الموجودة داخله على 180 درجة ، ويجب قطع تلك المضلعات التي تعبر خط الطول 180 إلى جزأين على طوله.  نتيجة لذلك ، عند استيراد الهندسة إلى واجهة برمجة تطبيقات الهندسة ، نحصل على كائن يقوم واجهة برمجة تطبيقات الهندسة (Geometry API) بتعريفه بشكل غير صحيح (Bounding Box) (مرفق المستطيل) للحدود الروسية.  اتضح أن الجواب هو -180.180 في خط الطول.  وهذا بالطبع ليس صحيحًا - في الواقع ، روسيا تأخذ حوالي 20 إلى -170 درجة.  هذه مشكلة في واجهة برمجة تطبيقات الهندسة ، فقد تكون هذه المشكلة ثابتة بالفعل ، ولكن كان علينا حلها. <br><br>  WKT لا يوجد لديه مثل هذه المشكلة.  قد تسأل ، لماذا نحتاج إلى صندوق ملزمة؟  ثم سأقول ؛) <br><br>  يبقى لحل مشكلة ما يسمى PIP ، نقطة في poligon.  يمكن لـ Java Geometry API القيام بذلك مرة أخرى ، بالنسبة إلينا ، هندسة بسيطة من النوع Point ، ومضلع ثانٍ (Multipoligon) للمنطقة ، وواحد يحتوي على طريقة. <br><br>  نتيجة لذلك ، بدا الحل الثاني ، وكذلك على الجبهة ، كما يلي: يقوم تطبيق Spark بتحميل ADT ، بما في ذلك الهندسة.  تم بناء شيء مثل اسم الخريطة-&gt; الهندسة منها (في الواقع أكثر تعقيدًا قليلاً ، نظرًا لأن ADTs مضمنة في بعضها البعض ، ونحن بحاجة للبحث فقط في تلك المستويات السفلية المضمنة في المستوى العلوي الموجود بالفعل. ونتيجة لذلك ، هناك نوع من شجرة الهندسة التي وفقا لبيانات المصدر لا تزال بحاجة إلى أن تبنى).  ثم نقوم بإنشاء مجموعة بيانات Spark باستخدام نقاطنا ، ولكل نقطة نطبق UDF الخاص بنا ، والذي يتحقق من إدخال النقطة في جميع الأشكال الهندسية (في الشجرة). <br><br>  تستغرق كتابة نسخة جديدة حوالي يوم عمل ، لأن إطار عمل المكاني لحزمة Hadoop تضمن أمثلة جيدة مباشرة لحل مهمة PIP (وإن كان ذلك باستخدام عدة وسائل أخرى). <br><br>  نبدأ ، و ... أوه ، رعب ، شيء ما لم يصبح أسرع.  مشاهدة مرة أخرى.  حان الوقت للتفكير في التحسين. <br><br><h2 style=";text-align:right;direction:rtl">  تبسيط الحل ، QuadTree </h2><br>  سبب الفرامل واضح تمامًا - على سبيل المثال ، هندسة روسيا ، أي  الحدود الخارجية ، هذه هي ميغابايت من geojson ، مضلع ضخم ، وليس واحدًا.  إذا كنت تتذكر كيفية حل مشكلة PIP ، فإن إحدى الطرق المعروفة هي بناء شعاع من نقطة ما ، والتحدث في مكان ما إلى ما لا نهاية ، وتحديد عدد النقاط التي تتقاطع فيها مع المضلع.  إذا كان عدد النقاط متساويًا ، تكون النقطة خارج المضلع ؛ وإذا كانت غريبة ، فهي في الداخل. <br><br>  فيما يلي وصف <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">من الويكي</a> . <br><br><img src="https://habrastorage.org/webt/rr/e4/pr/rre4praq1mhfcbtbekvdutvgge0.png"><br><br>  من الواضح أنه بالنسبة لمضلع ضخم ، يكون حل مشكلة التقاطع معقدًا عدة مرات كما توجد خطوط مستقيمة في مضلعنا.  لذلك ، من المرغوب فيه تجاهل تلك المضلعات بطريقة ما من الواضح أن النقطة لا يمكن إدخالها.  وكاختراق إضافي للحياة ، من الممكن إسقاط الشيك للدخول إلى حدود روسيا (إذا علمنا أن جميع الإحداثيات مشمولة بوضوح). <br><br>  لهذا ، <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">شجرة رباعي</a> مناسبة لنا.  لحسن الحظ ، يتم تنفيذ كل شيء في نفس واجهة برمجة تطبيقات الهندسة (وغيرها الكثير). <br><br><img src="https://habrastorage.org/webt/8l/ie/_x/8lie_xz2j_spgusj9mqul0ratsy.png" width="400" height="400"><br><br>  يبدو الحل المستند إلى شجرة شيئًا مثل هذا: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  تحميل ATD الهندسة </li><li style=";text-align:right;direction:rtl">  لكل هندسة نحدد مستطيل مرفق </li><li style=";text-align:right;direction:rtl">  وضعناها في QuadTree ، وحصلنا على المؤشر ردا </li><li style=";text-align:right;direction:rtl">  يتم تذكر الفهرس </li></ol><br>  بعد ذلك ، عند معالجة النقاط: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  نسأل QuadTree أي من الأشكال الهندسية التي يعرفها قد تتضمن نقطة </li><li style=";text-align:right;direction:rtl">  الحصول على مؤشرات الهندسة </li><li style=";text-align:right;direction:rtl">  فقط بالنسبة لهم نحن نتحقق من الحدوث عن طريق حل مشكلة PIP </li></ol><br>  كل هذا يستغرق أربع ساعات أخرى لتطوير.  نبدأ من جديد ، ونرى أن المهمة قد أنجزت بطريقة أو بأخرى بسرعة كبيرة.  نتحقق - كل شيء على ما يرام ، يتم استلام الحل.  وهذا كله في بضع دقائق.  QuadTree يعطينا العديد من أوامر تسارع الحجم. <br><br><h2 style=";text-align:right;direction:rtl">  ملخص </h2><br>  إذن ماذا انتهى بنا المطاف؟  حصلنا على آلية الترميز الجغرافي العكسي التي تتوازى بشكل فعال مع مجموعة Hadoop ، والتي تحل مشكلتنا الأولية بـ 200 ألف نقطة في حوالي دقيقة.  أي  يمكننا بسهولة تطبيق هذا الحل على ملايين النقاط. <br><br>  ما هي حدود هذا الحل؟  أولاً ، الأمر الواضح - يعتمد على بيانات ADT المتاحة لنا ، والتي قد لا تكون ذات صلة ب) تقتصر على روسيا فقط. <br><br>  والثاني - لسنا قادرين على حل مشكلة الترميز الجغرافي العكسي لكائنات أخرى غير المضلعات المغلقة.  وهذا يعني - للشوارع كذلك. <br><br><h2 style=";text-align:right;direction:rtl">  التنمية </h2><br>  ما الذي يمكن القيام به مع هذا؟ <br><br>  للحصول على هندسة ADT الحالية ، فإن أبسط شيء هو الحصول عليها من خريطة الشارع المفتوح.  بالطبع ، سيتعين عليهم العمل قليلاً ، لكن هذه مهمة قابلة للحل تمامًا.  إذا كان هناك اهتمام ، فسأتحدث عن مهمة تحميل بيانات OpenStreetMap إلى مجموعة Hadoop في وقت آخر. <br><br>  ما الذي يمكن عمله للشوارع والمنازل؟  من حيث المبدأ ، الشوارع في نفس OSM.  ولكن هذه ليست هياكل مغلقة ، ولكن الخطوط.  لتحديد أن النقطة "قريبة" من شارع معين ، سيتعين عليك إنشاء مضلع للشارع من نقاط متساوية الطول منه ، والتحقق مما إذا كانت قد دخلت فيه أم لا.  نتيجة لذلك ، يتحول نوع من النقانق ... يبدو مثل هذا: <br><br><img src="https://habrastorage.org/webt/6h/ky/of/6hkyoffev4qx6a07-vlw2vluytc.png"><br><br>  ما مدى قرب النقطة؟  هذه معلمة ، وتتوافق تقريبًا مع نصف القطر الذي يبحث فيه ArcGIS عن الكائنات ، والتي ذكرتها في البداية. <br><br>  وهكذا نجد شوارعًا تكون المسافة من نقطة أقل من حد معين (على سبيل المثال ، 100 متر).  وكلما كان هذا الحد أصغر ، كانت الخوارزمية تعمل بشكل أسرع ، ولكن على الأرجح لن تجد تطابقًا واحدًا. <br><br>  المشكلة الواضحة هي أنه من المستحيل حساب هذه المخازن المؤقتة المزعومة مسبقًا - حجمها معلمة للخدمة.  يجب أن تكون مبنية على الطاير ، بعد أن حددنا المنطقة المطلوبة في المدينة ، واخترنا من قاعدة OSM الشوارع التي تمر عبر هذه المنطقة.  ومع ذلك ، يمكن اختيار الشوارع مسبقًا. <br><br>  المنازل الموجودة في المنطقة التي تم العثور عليها لا تنتقل أيضًا إلى أي مكان ، لذلك يمكن بناء قائمتهم مسبقًا - لكن الدخول فيها سيظل قيد الدراسة. <br><br>  بمعنى أنه يجب عليك أولاً إنشاء فهرس للنموذج "city city" -&gt; قائمة بالمنازل التي تحتوي على روابط إلى الأشكال الهندسية ، وقائمة مشابهة لقائمة الشوارع. <br><br>  وبمجرد تحديدنا للمنطقة ، نحصل على قائمة المنازل والشوارع ، ونبني على طول شوارع الحدود ، وفقط بالنسبة لهم نحل مشكلة PIP (ربما باستخدام نفس التحسينات مثل حدود المناطق).  من الواضح أنه يمكن أيضًا بناء الشجرة الرباعية للمنازل في هذه الحالة مسبقًا ، وحفظها في مكان ما. <br><br>  هدفنا الرئيسي هو تقليل مقدار الحساب ، مع تعظيم وحفظ كل ما يمكن حسابه وحفظه مسبقًا.  في هذه الحالة ، ستتألف العملية من مرحلة بطيئة من فهارس البناء ، ومرحلة ثانية من الحساب ، والتي ستتم بالفعل بسرعة ، بالقرب من الإصدار عبر الإنترنت. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar438046/">https://habr.com/ru/post/ar438046/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar438026/index.html">RedisPipe - أكثر متعة معا</a></li>
<li><a href="../ar438028/index.html">لا تحتاج إلى blockchain: 8 حالات مستخدم شهيرة ولماذا لا تعمل</a></li>
<li><a href="../ar438034/index.html">Android و Rx و Kotlin ، أو كيفية جعل مخلب Lego يتقلص. الجزء 1</a></li>
<li><a href="../ar438036/index.html">3blue1brown و MIT باللغة الروسية</a></li>
<li><a href="../ar438044/index.html">مرحبا العالم التحليل</a></li>
<li><a href="../ar438052/index.html">التفاعل ، نمط العملية</a></li>
<li><a href="../ar438058/index.html">"تحليل البيانات في بيثون" في جزأين</a></li>
<li><a href="../ar438060/index.html">تقدير الاتجاه المكاني ، أو كيف لا تخافوا من مرشحات ماهوني وماجويك</a></li>
<li><a href="../ar438062/index.html">عنواني ليس منزل أو شارع ، عنواني هو الاتحاد السوفيتي؟</a></li>
<li><a href="../ar438064/index.html">قائمة التحقق: ما الذي يجب القيام به قبل بدء خدمات micros في همز</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>