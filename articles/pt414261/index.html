<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚≠êÔ∏è ü§µüèø üö¶ Onde voc√™ armazena os dados? üëµüèº üßùüèΩ üìµ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° Habr! Continuamos nossa s√©rie experimental de artigos, observando que voc√™ pode influenciar em tempo real o processo de cria√ß√£o de um jogo na UWP....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Onde voc√™ armazena os dados?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/microsoft/blog/414261/">  Ol√° Habr!  Continuamos nossa s√©rie experimental de artigos, observando que voc√™ pode influenciar em tempo real o processo de cria√ß√£o de um jogo na UWP.  Hoje, falaremos sobre a pergunta "Onde armazenar dados?", Que surge constantemente nas fileiras dos desenvolvedores.  Junte-se a n√≥s e compartilhe seus pensamentos nos coment√°rios! <br><br><img src="https://habrastorage.org/webt/bi/xw/n9/bixwn96nclriud-rklafycm_rma.jpeg"><a name="habracut"></a><br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>Parte 1: Por onde come√ßar</b></a> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 2: Tela inicial avan√ßada</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 3: Estilo do filho da m√£e</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 4: Obtendo dados do usu√°rio (volunt√°rio)</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 5: onde voc√™ armazena os dados?</a></b> </li></ul><br>  <i>Dou a palavra ao autor, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Alexei Plotnikov</a> .</i> <br><br>  Em um artigo anterior, eu levantei a quest√£o da sincroniza√ß√£o conveniente dos dados do usu√°rio entre os dispositivos e, em primeiro lugar, resolvi o problema com sua identifica√ß√£o; no entanto, essa √© a menor fra√ß√£o do que resta a ser feito para alcan√ßar os objetivos. <br><br>  Uma quest√£o muito mais complexa √© a maneira e, mais importante, a localiza√ß√£o dos dados do usu√°rio e, atrav√©s dos esfor√ßos da Microsoft, ao fazer uma pergunta, a primeira coisa que vem √† mente √© o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Microsoft Azure</a> .  A plataforma de nuvem do Azure inclui uma gama t√£o ampla de servi√ßos que parece que n√£o h√° tarefas que n√£o possam ser resolvidas com sua ajuda.  Seja verdade ou n√£o, n√£o posso julgar, mas minha tarefa est√° definitivamente dentro do poder desta plataforma.  No entanto, as primeiras coisas primeiro. <br><br>  Come√ßamos pequenos - o que √© uma nuvem?  Pela primeira vez, ouvi falar sobre a nuvem em 2012 e, em seguida, a frase "computa√ß√£o em nuvem" era mais usada.  A id√©ia inicial de tais c√°lculos era distribuir o trabalho de computa√ß√£o entre diferentes dispositivos que s√£o remotos um do outro.  Particularmente impressionante falou sobre o futuro, no qual at√© as tarefas mais dif√≠ceis ser√£o processadas em alguns momentos, devido ao fato de que os c√°lculos ser√£o distribu√≠dos entre todos os computadores do mundo. <br><br>  Na pr√°tica, tudo se resumia a data centers espalhados pelo mundo e fornecendo seu poder de computa√ß√£o aos consumidores, e o conceito inicial era apenas a distribui√ß√£o entre as m√°quinas dentro do data center e entre os pr√≥prios data centers (geralmente na mesma regi√£o). <br><br>  Com base no exposto, podemos assumir que, quando voc√™ ouve a palavra "nuvem", pode perceb√™-la como uma "hospedagem" mais familiar, com a √∫nica diferen√ßa de que o poder da nuvem pode ser expandido sem nenhum esfor√ßo adicional de sua parte. <br><br>  A segunda pergunta que voc√™ pode ter √© por que o Azure?  ‚ÄúComo este √© um artigo no blog da Microsoft, o autor falar√° apenas sobre os produtos deles‚Äù - voc√™ diz e estar√° errado.  Os motivos para usar o Azure s√£o muito mais comuns - como √© um produto da Microsoft, ele tem o mais alto grau de integra√ß√£o poss√≠vel com seus outros produtos, com a ajuda da qual meu aplicativo est√° sendo desenvolvido. <br><br>  No entanto, observo que a empresa faz todos os esfor√ßos para tornar o uso do Azure atraente para desenvolvedores para Android ou iOS.  Bem, o √∫ltimo problema mencionado, mas n√£o menos importante, √© o custo do uso da nuvem.  Como sou titular de uma assinatura do BizSpark, recebi um empr√©stimo mensal por uma bolsa com juros mais do que cobrindo minhas necessidades de nuvem, embora as condi√ß√µes fornecidas gratuitamente tamb√©m possam cobrir a maioria das necessidades de um desenvolvedor privado. <br><br>  Agora vamos para a sele√ß√£o direta de um mecanismo de sincroniza√ß√£o e armazenamento de dados.  N√£o vou ser astuto, como uma pessoa autodidata, muitas vezes tenho que lidar com tecnologias que n√£o tenho id√©ia antes de conhecer a UWP, resolvi problemas semelhantes usando bancos de dados SQL. <br><br>  No entanto, o UWP n√£o possui meios para trabalhar com DBMSs SQL cl√°ssicos, mas o SQLite √© oferecido como uma alternativa e, ap√≥s iniciar seu estudo, descobri que esse banco de dados √© interno, adequado para armazenamento e uso conveniente de dados locais, mas √© completamente inadequado para a localiza√ß√£o de dados. no armazenamento remoto.  J√° no processo de reda√ß√£o deste artigo, quando a tecnologia necess√°ria foi selecionada, me deparei com uma das solu√ß√µes do Azure no campo do desenvolvimento de aplicativos m√≥veis, que permite sincronizar dados da tabela SQLite entre dispositivos, mas depois de pensar com cuidado, permaneci na escolha inicial. <br><br>  A prop√≥sito, fazer a escolha inicial n√£o foi dif√≠cil, pois a Microsoft educadamente levou uma lista de tecnologias que o desenvolvedor da UWP provavelmente teria que enfrentar.  Nas vers√µes mais recentes do Visual Studio, ao criar um novo projeto UWP, voc√™ ver√° uma p√°gina com recomenda√ß√µes para come√ßar, onde um dos links diz "Adicionando um servi√ßo recomendado".  Ao clicar neste link, a guia "Conectar o servi√ßo" √© aberta e j√° vemos a op√ß√£o "Armazenamento em nuvem com o servi√ßo de armazenamento do Azure". <br><br><img src="https://habrastorage.org/webt/fr/wx/k9/frwxk9themsqsxrjnxuhfnuzljw.png"><br><br>  A intui√ß√£o sugere que √© exatamente isso que voc√™ precisa, por isso decidi me concentrar em um estudo aprofundado dessa quest√£o, com vistas a uma maior utiliza√ß√£o no projeto. <br><br>  O armazenamento em nuvem √© um conjunto de v√°rios produtos para tarefas diferentes, que podem ser lidos mais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> , mas eu estava interessado principalmente no armazenamento de tabelas, que acabou sendo o banco de dados NoSQL. <br><br>  O NoSQL √© um banco de dados sem esquema, ou seja, aquele em que a tabela n√£o precisa ser estruturada previamente.  De fato, a tabela nesse caso √© apenas parte do caminho para o que √© chamado de se√ß√£o, o que significa que uma √∫nica tabela pode conter linhas, por exemplo, com tr√™s e cinco colunas por vez.  Para entender completamente os recursos do armazenamento da tabela, aconselho a ler atentamente o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">manual</a> , mas considerarei esse t√≥pico do meu ponto de vista mundano, porque no final o material √© destinado a iniciantes, quem eu sou neste t√≥pico. <br><br>  <b>Para come√ßar, vamos descobrir como criar uma tabela NoSQL:</b> <br><br>  1. Registre uma conta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">gratuita do</a> Azure.  Se voc√™ tiver uma assinatura do MSDN ou BizSpark e j√° estiver ativada no Azure, poder√° pular esta etapa.  Uma conta gratuita oferece um empr√©stimo de US $ 200 para o primeiro m√™s e, em seguida, acesso gratuito a uma certa quantidade de recursos da maioria dos servi√ßos do Azure.  Traduzido para um idioma compreens√≠vel, tudo √© feito de maneira que voc√™ n√£o precise pagar at√© que seu produto receba o suficiente para cobrir as despesas, sem mencionar o uso do Azure para auto-educa√ß√£o. <br><br>  Mas mesmo se voc√™ ultrapassar o limite livre, os pre√ßos de um armazenamento de tabela s√£o muito mais fi√©is do que para uma quantidade semelhante de bancos de dados SQL.  Por exemplo, no momento da reda√ß√£o deste artigo, criei duas tabelas, at√© agora com apenas uma entrada.  Durante 18 dias do per√≠odo coberto pelo relat√≥rio, eu me virei para ela em m√©dia 20 a 30 vezes por dia e dois copeques foram baixados da conta de cr√©dito desse per√≠odo.  Ao escalonar esses custos para o volume planejado, percebi que eles s√£o mais do que cobertos pela receita potencial do aplicativo. <br><br>  2. Agora que voc√™ tem uma conta no Azure, continuamos a criar uma conta de armazenamento. <br><br><img src="https://habrastorage.org/webt/pk/zf/ci/pkzfciggnj3px9azcypmku_rgd8.png"><br><br>  Voc√™ pode fazer isso tudo na mesma p√°gina de Conex√£o de Servi√ßos do Visual Studio, que descrevi acima.  Se voc√™ fechar esta p√°gina repentinamente, poder√° abri-la clicando duas vezes em ‚ÄúServi√ßos Conectados‚Äù no Gerenciador de Solu√ß√µes.  Ap√≥s selecionar o servi√ßo necess√°rio, uma janela com as contas de armazenamento dispon√≠veis ser√° aberta e, para adicionar uma nova, clique no bot√£o correspondente. <br><br>  <b>Na nova janela, voc√™ precisar√° executar as seguintes etapas:</b> <br><br><ul><li>  Para come√ßar, voc√™ precisar√° fazer login com sua conta da Microsoft.  Voc√™ precisa usar a conta √† qual suas assinaturas est√£o vinculadas ou uma conta gratuita do Azure. </li><li>  Depois de fazer login na sua conta, sua assinatura (a) aparecer√° no campo "Assinatura".  Tudo √© simples com a escolha, ent√£o os coment√°rios s√£o sup√©rfluos. </li><li>  No campo "Nome", especifique o nome desejado do servi√ßo de armazenamento.  Como esse tamb√©m √© o nome de dom√≠nio do servi√ßo, ele deve ser exclusivo em todas as contas dispon√≠veis no Azure e n√£o apenas na sua. </li><li>  O campo "Categoria de pre√ßo" exigir√° que voc√™ entenda as diferen√ßas entre uma plataforma em nuvem e a hospedagem convencional, pois clicando no link abaixo do campo, voc√™ poder√° ver uma lista de pre√ßos, mas n√£o uma explica√ß√£o intelig√≠vel, que oferece cada op√ß√£o.  Obviamente, na natureza dos sitelinks, voc√™ pode encontrar informa√ß√µes abrangentes sobre todas essas abrevia√ß√µes, como GRS e LRS, mas isso √© sup√©rfluo para o desenvolvedor m√©dio.  √â suficiente entender que, quanto mais cara a tarifa, mais centros de dados estar√£o envolvidos no processamento e armazenamento dos seus dados e maior a probabilidade de sua seguran√ßa.  Para um projeto pequeno, a menor taxa de LRS √© boa. </li><li>  Um "grupo de recursos" √© uma combina√ß√£o de v√°rios servi√ßos do Azure para um √∫nico gerenciamento.  No nosso caso, crie um novo, atribuindo qualquer nome amig√°vel e siga em frente. </li><li>  A √∫ltima coisa a escolher √© o "Local" para o seu servi√ßo.  Por localiza√ß√£o, entende-se a localiza√ß√£o real dos data centers que ser√£o respons√°veis ‚Äã‚Äãpor trabalhar com nossos dados.  Observe que falo no plural, pois em uma regi√£o podem existir v√°rios data centers e o trabalho pode ser distribu√≠do entre eles (caso voc√™ escolha uma categoria de pre√ßo de consultoria).  Escolha a que mais se aproxima da sua base de usu√°rios principal.  No entanto, se voc√™ planeja crescer na escala do mundo inteiro e precisa de uma resposta m√°xima em qualquer lugar do mundo, ningu√©m o incomoda em cada vers√£o regional do aplicativo para criar uma conta de armazenamento separada e implementar a sincroniza√ß√£o de dados entre eles.  √â um alto n√≠vel de extensibilidade que √© a principal vantagem da nuvem. </li></ul><br>  3. Ap√≥s criar a conta de armazenamento, ela ser√° adicionada √† lista e voc√™ poder√° continuar clicando no bot√£o "Adicionar".  O resultado dessa a√ß√£o ser√° adicionar um pacote NuGet para trabalhar com o Azure ao projeto e salvar a cadeia de conex√£o no arquivo app.config do projeto. <br><br>  Infelizmente, √© imposs√≠vel trabalhar com valores desse arquivo no UWP (ou possivelmente com muletas terr√≠veis); portanto, basta copiar a seq√º√™ncia de conex√£o para o servi√ßo de armazenamento de l√° para um local conveniente no projeto e prosseguir para a pr√≥xima etapa. <br><br>  4. Agora resta criar uma tabela e come√ßar a trabalhar com ela.  E aqui come√ßa o trabalho individual, dependendo diretamente das tarefas. <br><br>  O fato √© que, antes de come√ßar a criar tabelas, voc√™ deve pensar cuidadosamente na arquitetura para armazenar seus dados.  Trabalhar com o armazenamento da tabela √© t√£o conveniente que criar uma nova tabela diretamente do c√≥digo √© uma quest√£o de apenas algumas linhas, e com essa conveni√™ncia, existe um desejo natural de alocar uma tabela separada para cada usu√°rio, porque no final a tarefa √© sincronizar dados entre seus dispositivos.  No entanto, ao trabalhar com uma tecnologia desconhecida, voc√™ n√£o deve tomar decis√µes precipitadas e precisa pesar cuidadosamente os pr√≥s e contras.  Um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo</a> especial <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no manual</a> pode ajudar a tomar a decis√£o certa, mas prepare-se para rel√™-lo v√°rias vezes, pois √© muito dif√≠cil aprender todos os dados imediatamente, especialmente levando em considera√ß√£o a massa de novos termos. <br><br>  Continuarei a hist√≥ria, levando em considera√ß√£o o fato de voc√™ ainda ler o manual e entender alguns dos recursos do trabalho com armazenamento de tabelas.  Por exemplo, percebi que conceitualmente uma tabela n√£o √© um tipo de unidade isolada e √© um local para um agrupamento l√≥gico de registros.  Isso √© f√°cil de entender se voc√™ apresentar a tabela como uma pasta na qual voc√™ armazena arquivos de dados.  Uma pasta por si s√≥ n√£o ocupa espa√ßo e n√£o √© parte integrante dos arquivos, mas apenas define uma parte do caminho para arquivos l√≥gicos, mas n√£o necess√°rios, a serem salvos nessa pasta. <br><br>  A conclus√£o disso √© bastante simples - ningu√©m se preocupa em armazenar as configura√ß√µes de todos os usu√°rios em uma tabela, o principal √© que o par de valores nas colunas PartitionKey e RowKey s√£o √∫nicos dentro da tabela.  Isso √© implementado novamente em meu projeto, j√° que o ID do usu√°rio atuar√° como PartitionKey e, por exemplo, a string "UserName" como RowKey, que nos permitir√° determinar o registro exclusivo no qual o nome do usu√°rio est√° armazenado.  Mas, como eu disse acima, precisamos pesar todos os pr√≥s e contras, ent√£o vamos pesar: <br><br><ul><li>  "Para" uma tabela separada para os dados de cada usu√°rio √© a conveni√™ncia de perceber a estrutura de dados.  Se considerarmos a tabela como uma pasta com arquivos, √© l√≥gico que todos os arquivos de um usu√°rio estejam na mesma pasta e √© mais comum trabalhar com essa arquitetura. </li><li>  Todos os outros fatores s√£o "contra" uma tabela separada.  Dados do usu√°rio em uma tabela separada - isso √© convenientemente preciso at√© que o n√∫mero dessas tabelas esteja na casa dos milhares.  Como a conta de armazenamento est√° em um n√≠vel superior acima da tabela, nenhum outro agrupamento √© fornecido para elas. <br><br>  Dada a base de usu√°rios em potencial, corremos o risco de se afogar em milhares de tabelas individuais, perdendo as que t√™m qualquer valor de prioridade.  Ao mesmo tempo, armazenar as configura√ß√µes de todos os usu√°rios em uma tabela simplifica a administra√ß√£o e trabalha com dados para coletar informa√ß√µes estat√≠sticas ou implementar fun√ß√µes sociais. <br><br>  Al√©m disso, o baixo custo do uso do armazenamento de tabelas permite duplicar todos os dados em tabelas separadas, de acordo com a l√≥gica necess√°ria.  Em particular, pretendo criar uma tabela adicional com o nome de usu√°rio, um link para o avatar e uma indica√ß√£o de pertencer ao pa√≠s, que ser√° usado para tabelas de classifica√ß√£o ou outras fun√ß√µes sociais que podem ser adicionadas ao aplicativo. </li></ul><br>  Ent√£o, quando voc√™ descobriu a estrutura de armazenamento de dados, vamos finalmente adicionar uma nova tabela.  Como nos recusamos a cri√°-lo no n√≠vel do c√≥digo, restam duas op√ß√µes: atrav√©s do portal da Web do Azure ou usando a ferramenta especial do Microsoft Azure Storage Explorer, que pode ser baixada em storageexplorer.com.  Nos dois casos, √© necess√°rio selecionar a conta de armazenamento desejada e, na se√ß√£o "Servi√ßo de tabelas / tabelas", selecione "+ Tabela / Criar tabela".  Na caixa de di√°logo exibida, digite o nome desejado e confirme as altera√ß√µes. <br><br><img src="https://habrastorage.org/webt/ca/0b/j9/ca0bj92etkk7v2qpp-r63wtymeq.png"><br><br>  Depois disso, voc√™ pode trabalhar com a nova tabela do c√≥digo sem problemas. <br><br>  As principais opera√ß√µes que executarei com a tabela s√£o a inser√ß√£o e extra√ß√£o de linhas, chamadas de "entidades" na terminologia de armazenamento da tabela.  Esse termo √© mais f√°cil de entender quando voc√™ percebe que, para inserir e recuperar uma entidade, ser√° necess√°rio mapear uma classe herdada de TableEntity de Microsoft.WindowsAzure.Storage.Table.  A classe herdeiro j√° conter√° alguns campos obrigat√≥rios, como, por exemplo, PartitionKey (nome da se√ß√£o) e RowKey (nome da linha), e os campos que implementamos independentemente ser√£o colunas na linha (propriedades da entidade). <br><br>  Considere um exemplo de tabela na qual uma lista de todos os jogadores com nome, avatar e afilia√ß√£o no pa√≠s ser√° armazenada. <br><br><pre><code class="cs hljs">    : Imports Microsoft.WindowsAzure.Storage Imports Microsoft.WindowsAzure.Storage.Table</code> </pre> <br>  Decidi colocar os m√©todos para trabalhar com a tabela em uma classe separada para facilitar o trabalho em diferentes pontos do aplicativo.  Crie-o e adicione imediatamente as constantes conhecidas anteriormente: <br><br><pre> <code class="cs hljs">Public Class AzureWorker Private Const AzureStorageConnectionString As String = <span class="hljs-string"><span class="hljs-string">"  ,     app.config"</span></span> Private Const GamerListTableNameString As String = <span class="hljs-string"><span class="hljs-string">"GamerList"</span></span> <span class="hljs-string"><span class="hljs-string">'    ‚Ä¶ End Class</span></span></code> </pre> <br>  Agora precisamos criar uma classe que mapearemos para a entidade (linha) dentro da tabela: <br><br><pre> <code class="cs hljs"> Private Class GamerListClodTableDataClass Inherits TableEntity Public Const RowKeyValue As String = <span class="hljs-string"><span class="hljs-string">"UserID"</span></span> <span class="hljs-function"><span class="hljs-function">Public Sub </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">New</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) RowKey</span></span> = RowKeyValue End Sub Public Property UserName As String = <span class="hljs-string"><span class="hljs-string">""</span></span> Public Property UserountryID As String = <span class="hljs-string"><span class="hljs-string">""</span></span> Public Property UserAvatar As String = <span class="hljs-string"><span class="hljs-string">""</span></span> End Class</code> </pre> <br>  A classe a ser mapeada deve ser herdada de TableEntity e ter campos para os dados que planejamos colocar na tabela.  Observe que a defini√ß√£o de valores para um RowKey ou PartitionKey no n√≠vel da classe n√£o √© necess√°ria, mas no meu caso, o RowKey √© definido porque √© imut√°vel, independentemente de outras entradas. <br><br>  Mas, como nesse est√°gio voc√™ provavelmente n√£o entendeu completamente a ess√™ncia de trabalhar com o armazenamento da tabela, explicarei a l√≥gica estabelecida nesse est√°gio.  A maneira mais r√°pida de trabalhar com uma tabela √© consultar a entidade pelo nome da string e do nome da se√ß√£o, portanto, √© necess√°rio conhecer esses dados com anteced√™ncia.  Al√©m disso, a combina√ß√£o de PartitionKey e RowKey deve ser exclusiva dentro da tabela, o que significa que √© l√≥gico escrever um ID de usu√°rio exclusivo em uma dessas chaves e atribuir √† segunda chave qualquer nome que sempre saberemos.  Isso √© exatamente o que √© feito na classe GamerListClodTableDataClass. <br><br>  O √∫ltimo est√°gio preparat√≥rio antes das consultas diretas √† tabela √© a cria√ß√£o de seu objeto em uma fun√ß√£o separada: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Private Shared Function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCloudTable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tableName As String</span></span></span><span class="hljs-function">) As CloudTable Dim storageAccount As CloudStorageAccount</span></span> = CloudStorageAccount.Parse(AzureStorageConnectionString) Dim tableClient As CloudTableClient = storageAccount.CreateCloudTableClient() Dim table As CloudTable = tableClient.GetTableReference(tableName) Return table End Function</code> </pre> <br>  Isso √© feito para n√£o duplicar o c√≥digo toda vez que queremos ler ou gravar dados na tabela.  Observe que este c√≥digo n√£o faz solicita√ß√µes diretas √† nuvem e ser√° executado sem problemas quando n√£o houver conex√£o.  Tudo o que ele faz √© criar passo a passo um objeto de tabela a partir dos dados existentes, como a cadeia de conex√£o de armazenamento e o nome da tabela. <br><br>  Por fim, vamos trabalhar diretamente com a tabela e come√ßar salvando os dados atuais do usu√°rio: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Public Shared Async Function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SavedOrUpdateUserData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">u As UserManager</span></span></span><span class="hljs-function">) As </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Task</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Of Boolean</span></span></span><span class="hljs-function">) Dim table As CloudTable</span></span> = GetCloudTable(GamerListTableNameString) Try If Await table.ExistsAsync Then Dim UserDataClodTableData As New GamerListClodTableDataClass With {.PartitionKey = u.UserId, .UserName = u.UserName.Trim, .UserountryID = u.UserountryID, .UserAvatar = <span class="hljs-string"><span class="hljs-string">"https://apis.live.net/v5.0/"</span></span> &amp; u.UserId &amp; <span class="hljs-string"><span class="hljs-string">"/picture"</span></span>} Dim insertOperation As TableOperation = TableOperation.InsertOrReplace(UserDataClodTableData) Await table.ExecuteAsync(insertOperation) Return True End If Catch ex As Exception End Try Return False End Function</code> </pre> <br>  A solicita√ß√£o √© feita como uma fun√ß√£o ass√≠ncrona para que o c√≥digo de chamada possa obter o resultado da execu√ß√£o (Verdadeiro em caso de sucesso e Falso em caso de falha).  Al√©m disso, um par√¢metro do tipo UserManager √© passado para a fun√ß√£o, que √© uma refer√™ncia √† classe com dados do usu√°rio.  Criamos essa classe em um artigo anterior, com a √∫nica diferen√ßa: nesta vers√£o, existe um campo UserountryID que armazena dados sobre o pa√≠s do usu√°rio. <br><br>  Para consultas √† tabela, primeiro voc√™ precisa criar seu objeto usando a cadeia de conex√£o ao reposit√≥rio e o nome da tabela (colocamos esse processo em uma fun√ß√£o separada anteriormente).  Em seguida, verifique a exist√™ncia da tabela e, embora tenhamos certeza de que temos uma tabela com esse nome, pode ocorrer um erro, por exemplo, devido √† falta de conectividade de rede ou devido a uma falha na nuvem (√© por isso que esse c√≥digo √© colocado no bot√£o Try / Catch).  Em seguida, antes de gravar na tabela, voc√™ precisa criar uma inst√¢ncia da classe UserDataClodTableData e atribuir o valor necess√°rio aos seus campos e s√≥ ent√£o criar a opera√ß√£o InsertOrReplace.  Como voc√™ pode imaginar, a partir do nome da opera√ß√£o, ela inserir√° uma nova linha na tabela se as linhas com o mesmo par de PartitionKey e RowKey n√£o existirem na tabela e substituir√° os dados, se essa linha j√° existir.  Bem, a equipe final do ExecuteAsync, de fato, executar√° a a√ß√£o planejada no lado do armazenamento da tabela. <br><br>  Ler dados de uma tabela √© t√£o f√°cil quanto escrev√™-los.  Vamos, por exemplo, solicitar um nome de usu√°rio: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Public Shared Async Function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetUserName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id As String</span></span></span><span class="hljs-function">) As </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Task</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Of String</span></span></span><span class="hljs-function">) Dim table As CloudTable</span></span> = GetCloudTable(GamerListTableNameString) Try If Await table.ExistsAsync Then Dim retrieveOperation As TableOperation = TableOperation.Retrieve(Of GamerListClodTableDataClass)(id, GamerListClodTableDataClass.RowKeyValue) Dim retrievedResult As TableResult = Await table.ExecuteAsync(retrieveOperation) If retrievedResult.<span class="hljs-function"><span class="hljs-function">Result IsNot Nothing Then Return </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CType</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">retrievedResult.Result, GamerListClodTableDataClass</span></span></span><span class="hljs-function">).UserName End If End If Catch ex As Exception End Try Return "" End Function</span></span></code> </pre> <br>  Esse c√≥digo quase n√£o difere do anterior e tamb√©m come√ßa criando um objeto de tabela e verificando sua exist√™ncia.  Al√©m disso, como na grava√ß√£o, criamos uma opera√ß√£o, mas desta vez uma opera√ß√£o de extra√ß√£o, que requer a indica√ß√£o de PartitionKey e RowKey.  Depois disso, extra√≠mos o resultado usando ExecuteAsync e trabalhamos com o objeto resultante do tipo TableResult, que na verdade se resume em converter a propriedade Result no tipo de classe que est√° sendo mapeada e extrair o nome do usu√°rio. <br><br>  O trabalho com uma tabela n√£o se limita √†s opera√ß√µes de leitura e grava√ß√£o e suporta muitos scripts diferentes.  Por exemplo, voc√™ pode criar uma consulta que extrair√° todas as entidades com o PartitionKey especificado ou todas as entidades que possuem o campo especificado, mas √© importante lembrar a velocidade de tais opera√ß√µes, bem como a quantidade de dados que ser√£o transmitidos pela rede. <br><br>  O exemplo acima √© o mais ideal do ponto de vista da velocidade da consulta, pois o sistema de endere√ßamento provavelmente encontrar√° uma entidade no caminho "nome do armazenamento \ nome da tabela \ PartitionKey + RowKey", no entanto, para obter apenas um nome, carregamos toda a entidade como um todo, o que n√£o √© ben√©fico sobre a quantidade de dados transferidos. <br><br>  A seguir, um c√≥digo de fun√ß√£o modificado, levando em considera√ß√£o a otimiza√ß√£o m√°xima da consulta: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Public Shared Async Function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetUserName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id As String</span></span></span><span class="hljs-function">) As </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Task</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Of String</span></span></span><span class="hljs-function">) Dim table As CloudTable</span></span> = GetCloudTable(GamerListTableNameString) Try If Await table.<span class="hljs-function"><span class="hljs-function">ExistsAsync Then Dim projectionQuery As </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TableQuery</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Of DynamicTableEntity</span></span></span><span class="hljs-function">)</span></span> = <span class="hljs-function"><span class="hljs-function">New </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TableQuery</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Of DynamicTableEntity</span></span></span><span class="hljs-function">)(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>).</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Where</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TableQuery.CombineFilters(TableQuery.GenerateFilterCondition(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"PartitionKey"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, QueryComparisons.Equal, id</span></span></span><span class="hljs-function">), "and", TableQuery.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateFilterCondition</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"RowKey"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, QueryComparisons.Equal, GamerListClodTableDataClass.RowKeyValue</span></span></span><span class="hljs-function">))).</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Select</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"UserName"</span></span></span></span><span class="hljs-function"><span class="hljs-params">}</span></span></span><span class="hljs-function">) Dim resolver As </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EntityResolver</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Of String</span></span></span><span class="hljs-function">)</span></span> = Function(pk, rk, ts, props, etag) <span class="hljs-function"><span class="hljs-function">Return </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">props</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"UserName"</span></span></span></span></span><span class="hljs-function">).StringValue End Function Dim result As </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TableQuerySegment</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Of String</span></span></span><span class="hljs-function">)</span></span> = Await table.ExecuteQuerySegmentedAsync(projectionQuery, resolver, Nothing) If result.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-function"><span class="hljs-function">Then Return </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">result</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">) End If End If Catch ex As Exception End Try Return "" End Function</span></span></code> </pre> <br>  Em vez de criar um objeto de opera√ß√£o, neste c√≥digo, criamos um objeto de solicita√ß√£o que cont√©m v√°rios m√©todos para determinar o que precisa ser obtido como resultado.  O m√©todo Where cria um filtro que indica a necessidade de retornar apenas as linhas para as quais PartitionKey e RowKey s√£o iguais aos valores especificados e o pr√≥ximo Select indica que apenas a coluna UserName precisa ser selecionada. <br><br>  Com essa consulta, n√£o faz sentido comparar o resultado com qualquer classe, portanto, o IDictionary √© usado como valor de retorno, onde a chave √© o nome da coluna e o valor √© o seu conte√∫do.  Como a fun√ß√£o ExecuteQuerySegmentedAsync n√£o sabe qual resultado de sua execu√ß√£o ser√° obtido, √© poss√≠vel (e neste caso necess√°rio) passar um delegado EntityResolver, que se refere a uma fun√ß√£o que utiliza o valor desejado do dicion√°rio.  O resultado de tudo isso se torna TableQuerySegment no primeiro √≠ndice do qual o nome do usu√°rio solicitado est√° armazenado. <br><br>  Em geral, o uso de consultas em vez da opera√ß√£o b√°sica de extra√ß√£o permite expandir significativamente as possibilidades de trabalhar com uma tabela, mas tenha cuidado, porque, diferentemente do SQL cl√°ssico, aqui a velocidade de processamento da consulta depende diretamente de seus par√¢metros.  Ningu√©m o incomoda para executar uma consulta para recuperar todos os registros de usu√°rios cujos nomes sejam iguais ao nome especificado, mas essa consulta ser√° mais longa que sua contraparte no SQL.  Para aprender isso, mais uma vez eu o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">indico</a> ao guia de design de tabelas que mencionei acima e tamb√©m recomendo que voc√™ estude o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo</a> , que fornece exemplos de como trabalhar com o armazenamento de tabelas. <br><br>  <i>Importante!</i>  <i>Os artigos de link usam c√≥digo para aplicativos cl√°ssicos do .NET e s√£o diferentes da implementa√ß√£o da UWP.</i>  <i>Felizmente, essa diferen√ßa n√£o √© significativa e os an√°logos s√£o intuitivos (na maioria das vezes as diferen√ßas est√£o no prefixo Async).</i> <br><br>  Em conclus√£o, vou compartilhar os resultados do uso do armazenamento do Azure no meu projeto no momento.  No primeiro in√≠cio, depois de receber o ID do usu√°rio e fazer o download dos dados do Live ID, sugiro que ele escolha um apelido (apelido), caso o nome armazenado no perfil n√£o seja adequado a ele.  Em seguida, o apelido inserido √© salvo na classe UserManager, em vez da classe padr√£o, e todos esses dados s√£o salvos na tabela GamerList.  No pr√≥ximo in√≠cio, o ID do usu√°rio √© recebido em segundo plano e um alias √© solicitado no reposit√≥rio.  Como resultado, o usu√°rio v√™ seu apelido no jogo, e n√£o o nome do perfil padr√£o. <br><br>  Tamb√©m no futuro, uma tabela com uma lista de usu√°rios ser√° √∫til para inserir fun√ß√µes sociais no jogo e, agora, criei pelo menos um aplicativo para esses dados.  Na implementa√ß√£o desta tarefa, ferramentas do Azure, como Armazenamento de Filas e Fun√ß√µes do Azure, ir√£o me ajudar novamente, mas falarei sobre isso em um dos seguintes artigos. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt414261/">https://habr.com/ru/post/pt414261/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt414243/index.html">Opus gr√°tis sobre contrata√ß√£o, entrevistas e lixo no mercado de pessoal de TI</a></li>
<li><a href="../pt414245/index.html">Modelo de regress√£o polinomial</a></li>
<li><a href="../pt414249/index.html">Infraestrutura de chave p√∫blica: biblioteca GCrypt como alternativa ao OpenSSL com suporte para criptografia russa</a></li>
<li><a href="../pt414251/index.html">Desenvolvimento sem programa√ß√£o: afinal de contas, life hack?</a></li>
<li><a href="../pt414253/index.html">Padr√µes para testadores. Proxy (alternativo)</a></li>
<li><a href="../pt414263/index.html">Existe vida fora de Roscosmos? Vis√£o geral da explora√ß√£o espacial privada russa</a></li>
<li><a href="../pt414265/index.html">Richard Hamming: Cap√≠tulo 7. Intelig√™ncia Artificial - II</a></li>
<li><a href="../pt414267/index.html">Como substituir um contador por um rob√¥?</a></li>
<li><a href="../pt414269/index.html">‚Äú20.000 IOPS por n√≥ t√™m bom desempenho com lat√™ncia de 5 ms.‚Äù Para OLTP - n√£o</a></li>
<li><a href="../pt414271/index.html">Como domesticar um disco r√≠gido em um laptop e impedir o estacionamento em 8 segundos de inatividade</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>