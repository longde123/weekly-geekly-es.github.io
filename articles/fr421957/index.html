<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôèüèø ‚ùî üë©‚Äçüëß‚Äçüëß Comment Yandex a cr√©√© la r√©alit√© augment√©e dans Maps pour iOS. Exp√©rience avec ARKit üñêüèæ ü§í üé°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il reste moins de gens qui peuvent √™tre surpris par la r√©alit√© augment√©e (RA). Pour certains, cette technologie est associ√©e √† un jouet pendant quelqu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment Yandex a cr√©√© la r√©alit√© augment√©e dans Maps pour iOS. Exp√©rience avec ARKit</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/421957/"><p>  Il reste moins de gens qui peuvent √™tre surpris par la r√©alit√© augment√©e (RA).  Pour certains, cette technologie est associ√©e √† un jouet pendant quelques heures.  D'autres trouvent cela plus pratique. </p><br><p>  Je m'appelle Dmitry et je d√©veloppe Yandex.Maps pour iOS.  Aujourd'hui, je vais dire aux lecteurs de Habr comment nous avons cr√©√© le routage en utilisant la r√©alit√© augment√©e.  Vous d√©couvrirez √©galement les fonctionnalit√©s de l'utilisation du framework ARKit, gr√¢ce auxquelles l'introduction de la r√©alit√© augment√©e n'est plus du ressort des seuls sp√©cialistes du domaine de la vision par ordinateur. </p><br><img width="800" src="https://habrastorage.org/webt/zb/le/i2/zblei2e2hojscltqyw2l1k4csds.png"><br><p><a name="habracut"></a>  En 2009, le magazine Esquire a √©t√© le premier parmi les m√©dias √† ajouter un support de r√©alit√© augment√©e √† son produit.  Sur la couverture du magazine, vous avez affich√© un code avec lequel vous pouvez voir Robert Downey Jr. "en direct". </p><br><img src="https://habrastorage.org/webt/0v/-a/58/0v-a585aysdjqwyfrmtrbxgv05k.jpeg"><br><p>  L'utilisation de la RA dans l'industrie du divertissement ne se limitait pas √† cela.  Un exemple frappant est le jeu Pokemon Go, sorti en 2016.  En juillet de la m√™me ann√©e, il avait √©t√© t√©l√©charg√© plus de 16 millions de fois.  Le succ√®s du jeu a conduit √† l'√©mergence de nombreux clones avec AR. </p><br><p>  Les √©v√©nements importants dans l'industrie de la RA au cours des derni√®res ann√©es peuvent √™tre consid√©r√©s comme les annonces de Google Glass et de Microsoft Hololens.  L'apparition de tels appareils montre le vecteur dans lequel √©voluent les grandes entreprises. </p><br><p>  Apple n'a pas fait exception.  En 2017, la soci√©t√© a introduit le cadre ARKit, dont l'importance pour l'industrie ne peut gu√®re √™tre surestim√©e.  Et nous en parlerons plus en d√©tail. </p><br><h2 id="arkit">  ARKit </h2><br><p>  Caract√©ristiques d'ARKit, facilitant l'utilisation de l'AR: </p><br><ul><li>  absence de besoin d'√©tiquettes sp√©ciales (marqueurs), </li><li>  int√©gration avec les infrastructures graphiques Apple 2D / 3D existantes - SceneKit, SpriteKit, Metal, </li><li>  haute pr√©cision dans la d√©termination de la position et de l'orientation de l'appareil dans l'espace, </li><li>  pas besoin de calibrer la cam√©ra ou les capteurs. </li></ul><br><p>  Sous le capot d'ARKit se trouve un syst√®me d'odom√©trie visuelle inertielle qui combine les donn√©es avec les sous-syst√®mes visuel (cam√©ra) et inertiel (acc√©l√©rom√®tre, gyroscope) de l'appareil pour d√©terminer la position et le d√©placement sur la sc√®ne.  L'√©l√©ment de connexion de ce syst√®me est le filtre de Kalman - un algorithme qui s√©lectionne √† chaque instant le meilleur des lectures des deux sous-syst√®mes et nous le fournit sous la forme de notre position et de notre orientation sur la sc√®ne.  ARKit a √©galement une ¬´compr√©hension¬ª de la sc√®ne - nous pouvons d√©finir des surfaces horizontales et verticales, ainsi que les conditions d'√©clairage de la sc√®ne.  Ainsi, lors de l'ajout d'un objet √† la sc√®ne, nous pouvons lui ajouter un √©clairage par d√©faut, gr√¢ce auquel l'objet sera plus r√©aliste. </p><br><div class="spoiler">  <b class="spoiler_title">Au fait</b> <div class="spoiler_text"><p>  Bient√¥t, la version 2.0 du framework sera publi√©e, dans laquelle de nouvelles fonctionnalit√©s seront ajout√©es et la pr√©cision de positionnement sera consid√©rablement am√©lior√©e. </p></div></div><br><p>  ARKit a permis aux d√©veloppeurs d'int√©grer la r√©alit√© augment√©e de haute qualit√© dans leurs applications tout en d√©pensant beaucoup moins d'efforts.  Nous allons le d√©montrer en utilisant l'exemple de Yandex.Maps. </p><br><h2 id="marshrutizaciya-s-ar-v-yandekskartah">  Routage avec AR sur Yandex.Maps </h2><br><p>  Habituellement, apr√®s l'annonce de la nouvelle version d'iOS, de nombreuses √©quipes de Yandex se r√©unissent pour discuter de la possibilit√© d'introduire de nouvelles fonctionnalit√©s dans leurs applications.  L'√©quipe Yandex.Mart a fait de m√™me.  Dans le mois qui a suivi l'annonce de ARKit, nous avons souvent discut√© de la fa√ßon de l'impl√©menter dans Maps.  Quel genre d'id√©es nous n'avons pas entendues les unes des autres!  Assez rapidement, nous sommes arriv√©s √† la conclusion que l'une des solutions les plus utiles et les plus en surface est l'utilisation de la r√©alit√© augment√©e dans le routage. </p><br><p>  Le choix de cette id√©e est d√ª au fait que de nombreux utilisateurs de cartes rencontrent souvent une situation o√π vous vous trouvez dans une zone inconnue et que vous devez d√©cider rapidement o√π aller.  L'approche standard pour l'utilisateur moyen de la carte consiste √† ouvrir l'application, √† construire un itin√©raire pour pi√©tons et, en tournant sur place, √† d√©terminer o√π se d√©placer.  L'id√©e d'introduire la r√©alit√© augment√©e dans le routage pi√©ton est de sauver l'utilisateur d'actions inutiles, montrant imm√©diatement o√π vous devez vous d√©placer directement au-dessus de l'image de la cam√©ra. </p><br><p>  Tout d'abord, je veux dire quelques mots sur le routage.  Qu'est-ce que je mets dans ce concept?  Du point de vue de l'impl√©mentation dans une application mobile, il s'agit d'un ensemble d'√©tapes assez standard qui permettent √† l'utilisateur de passer du point A au point B: </p><br><ul><li>  s√©lection des points de d√©part et d'arriv√©e, </li><li>  recevoir un itin√©raire sous forme d'un ensemble de points en coordonn√©es g√©ographiques (latitude, longitude), </li><li>  affichage sur la carte de la ligne de route, </li><li>  accompagner l'utilisateur avec des informations suppl√©mentaires tout en se d√©pla√ßant le long de l'itin√©raire. </li></ul><br><p>  Nous ne nous attarderons pas sur les deux premiers points.  Je peux seulement dire que nous obtenons l'itin√©raire via notre biblioth√®que multiplateforme Yandex.Mapkit, qui est √©galement √† votre disposition sous la forme d'un pod.  En quoi le routage en r√©alit√© augment√©e diff√®re-t-il du routage standard dans les cartes?  Tout d'abord, la principale diff√©rence est une carte presque compl√®tement cach√©e.  L'accent principal est mis sur la zone d'√©cran avec l'image du flux vid√©o de la cam√©ra, sur laquelle des √©l√©ments visuels suppl√©mentaires sont superpos√©s (marque d'arriv√©e, marque auxiliaire et image de la ligne de route).  Chacun de ces √©l√©ments visuels a sa propre charge s√©mantique et sa propre logique (quand et comment il doit √™tre affich√©).  Nous examinerons le r√¥le de chacun de ces √©l√©ments plus en d√©tail plus tard, mais pour l'instant je propose d'examiner les t√¢ches que nous avions devant nous: </p><br><ul><li>  apprendre √† positionner des objets sur la sc√®ne ARKit, en connaissant leurs coordonn√©es g√©ographiques, </li><li>  Apprenez √† dessiner l'interface utilisateur n√©cessaire sur une sc√®ne 3D avec des performances suffisantes. </li></ul><br><p>  Nous devions convertir les coordonn√©es des points g√©ographiques des coordonn√©es de la sc√®ne, s√©lectionner les points √† afficher et afficher toutes les interfaces utilisateur n√©cessaires au-dessus de l'image de la cam√©ra dans la bonne position.  Mais tout s'est av√©r√© un peu plus compliqu√© qu'il n'y paraissait √† premi√®re vue. </p><br><p>  Avant de commencer √† impl√©menter les fonctionnalit√©s directement, un de mes coll√®gues a √©t√© charg√© de cr√©er un prototype montrant la possibilit√© (ou l'impossibilit√©) de mettre en ≈ìuvre des fonctionnalit√©s similaires avec un ensemble d'outils accessibles.  Pendant deux semaines, nous avons regard√© San Sanych labourer les espaces ouverts de l'espace ouvert et les environs proches de notre bureau avec un t√©l√©phone √† la main et regarder le monde autour de nous √† travers le prisme de la cam√©ra.  En cons√©quence, nous avons obtenu un prototype fonctionnel qui montrait chaque point de l'itin√©raire comme une marque sur la sc√®ne avec une distance jusqu'√† lui.  Avec l'aide de ce prototype, il a √©t√© possible, dans une combinaison r√©ussie de circonstances, de se rendre du travail au m√©tro et de ne jamais se perdre.  Mais s√©rieusement, il a confirm√© la possibilit√© de mettre en ≈ìuvre la fonctionnalit√© pr√©vue.  Mais il restait un certain nombre de t√¢ches que notre √©quipe devait encore r√©soudre. </p><br><p>  Tout a commenc√© par l'√©tude des outils.  √Ä cette √©poque, une seule personne de l'√©quipe avait de l'exp√©rience avec les graphiques 3D.  Jetons un coup d'≈ìil aux outils que toute personne qui envisage de mettre en ≈ìuvre de telles id√©es avec ARKit devra utiliser. </p><br><h2 id="instrumenty-i-api">  Outils et API </h2><br><p>  La t√¢che principale du rendu des objets consiste √† cr√©er et √† g√©rer les objets de sc√®ne du framework SceneKit.  Avec l'av√®nement d'ARKit, la classe ARSCNView (le descendant de la classe SCNView - la classe de base pour travailler avec la sc√®ne dans SceneKit) est devenue disponible pour le d√©veloppeur, ce qui r√©sout la plupart des t√¢ches fastidieuses d'int√©gration d'ARKit et de SceneKit, √† savoir: </p><br><ul><li>  synchronisation de la position du t√©l√©phone dans l'espace avec la position de la cam√©ra sur la sc√®ne, </li><li>  le syst√®me de coordonn√©es de la sc√®ne co√Øncide avec le syst√®me de coordonn√©es ARKit, </li><li>  comme arri√®re-plan de la sc√®ne, le flux vid√©o de la cam√©ra de l'appareil est utilis√©. </li></ul><br><p>  L'objet ARSCNView fournit √©galement au d√©veloppeur un objet de session de r√©alit√© augment√©e qui peut √™tre d√©marr√© avec la configuration n√©cessaire, arr√™t√© ou abonn√© √† divers √©v√©nements √† l'aide de l'objet d√©l√©gu√©. </p><br><p>  Pour ajouter des objets √† la sc√®ne, des h√©ritiers ou directement des objets SCNNode sont utilis√©s.  Cette classe repr√©sente une position (vecteur tridimensionnel) dans le syst√®me de coordonn√©es de son parent.  Ainsi, nous obtenons un arbre d'objets sur la sc√®ne avec une racine dans un objet sp√©cial - le rootNode de notre sc√®ne.  Tout ici est tr√®s similaire √† la hi√©rarchie des objets UIView dans UIKit.  Les objets SCNNode peuvent √™tre affich√©s sur sc√®ne lorsqu'ils ajoutent de la mati√®re et de l'√©clairage. </p><br><p>  Afin d'ajouter de la r√©alit√© augment√©e √† une application mobile, vous devez √©galement conna√Ætre les principaux objets de l'API ARKit.  Le principal est l'objet de la session de r√©alit√© augment√©e - ARSession.  Cet objet effectue le traitement des donn√©es et est responsable du cycle de vie de la session de r√©alit√© augment√©e.  Le but de cet article n'est pas de redire la documentation d'ARKit et SceneKit, donc je n'√©crirai pas sur tous les param√®tres de configuration disponibles de la session de r√©alit√© augment√©e, mais je me concentrerai sur l'un des param√®tres les plus importants de la configuration de la session de r√©alit√© augment√©e pour les applications de navigation - worldAlignment.  Ce param√®tre d√©termine la direction des axes de la sc√®ne au moment de l'initialisation de la session.  En g√©n√©ral, lors de l'initialisation d'une session de r√©alit√© augment√©e, ARKit cr√©e un syst√®me de coordonn√©es avec un d√©but √† un point qui co√Øncide avec la position actuelle du t√©l√©phone dans l'espace et dirige l'axe de ce syst√®me en fonction de la valeur de la propri√©t√© woldAlignment.  Dans notre impl√©mentation, la valeur gravityAndHeading est utilis√©e, ce qui implique que les axes seront dirig√©s comme suit: l'axe Y - dans la direction oppos√©e √† la gravit√©, l'axe Z - au sud et l'axe X - √† l'est. </p><br><p><img src="https://habrastorage.org/webt/r7/cj/d5/r7cjd5acp__8jkrb83rfytbsnr4.png" alt="alignement du monde-gravit√©-et-cap"></p><br><p>  Avec une bonne combinaison de circonstances, les axes X / Z seront en effet align√©s avec les directions vers le sud / est, mais, en raison d'erreurs dans les relev√©s de la boussole, les axes peuvent √™tre dirig√©s selon un certain angle par rapport √† la direction d√©crite dans la documentation.  C'est l'un des probl√®mes auxquels nous avons d√ª faire face, mais nous en reparlerons plus tard. </p><br><p>  Maintenant que nous avons examin√© les outils de base, r√©sumons: mapper un itin√©raire √† l'aide de SceneKit ajoute des objets SCNNode √† la sc√®ne aux positions obtenues en convertissant des coordonn√©es g√©ographiques en coordonn√©es de sc√®ne.  Avant de parler de conversion de coordonn√©es et de mani√®re g√©n√©rale de placer des objets sur la sc√®ne, parlons des probl√®mes de rendu des √©l√©ments d'interface utilisateur, en supposant que nous connaissons la position des objets sur la sc√®ne. </p><br><h1 id="metka-finisha">  Marque d'arriv√©e </h1><br><p>  L'√©l√©ment visuel principal du parcours pi√©ton √† r√©alit√© augment√©e est la marque d'arriv√©e, qui affiche le point final de l'itin√©raire.  √âgalement au-dessus de la marque, nous montrons √† l'utilisateur la distance jusqu'au point final de l'itin√©raire. </p><br><p><img src="https://habrastorage.org/webt/xw/94/hx/xw94hxwjiepqzhlov9hwmig1wee.jpeg" alt="finition-rep√®re-aper√ßu"></p><br><h2 id="razmer">  La taille </h2><br><p>  Lorsque la conception de cette √©tiquette nous a √©t√© pr√©sent√©e pour la premi√®re fois, nous avons d'abord fait attention aux exigences relatives √† la taille de cette √©tiquette.  Ils n'ont pas ob√©i aux r√®gles de projection en perspective.  J'expliquerai que dans les moteurs tridimensionnels qui sont utilis√©s pour cr√©er, par exemple, des jeux informatiques, le ¬´look¬ª est mod√©lis√© en utilisant la projection en perspective.  Selon les r√®gles de projection en perspective, les objets distants sont repr√©sent√©s √† plus petite √©chelle et les lignes parall√®les ne sont g√©n√©ralement pas parall√®les.  Ainsi, la taille de projection de l'objet sur le plan de l'√©cran change lin√©airement (diminue) lorsque la cam√©ra s'√©loigne de l'objet sur la sc√®ne.  Il r√©sulte de la description des dispositions que la taille de la marque sur l'√©cran a une taille fixe (maximale) lorsqu'elle est supprim√©e √† moins de 50 m, puis diminue lin√©airement de 50 m √† 2 km, apr√®s quoi la taille minimale reste inchang√©e.  De telles exigences sont √©videmment dues √† la commodit√© de l'utilisateur.  Ils permettent √† l'utilisateur de ne jamais perdre le point final de l'itin√©raire de la vue, de sorte que l'utilisateur aura toujours une id√©e de l'endroit o√π se d√©placer. </p><br><p><img src="https://habrastorage.org/webt/zr/tm/lu/zrtmluh1rmc08_bop7wkkyak3z8.png" alt="finition-rep√®re-taille-exigences"></p><br><p>  Nous devions comprendre comment nous pouvions nous ins√©rer dans le m√©canisme de projection SceneKit qui fonctionnait selon certaines r√®gles.  Je veux tout de suite noter que nous avions environ deux semaines pour tout faire sur tout, donc nous n'avions tout simplement pas le temps de proc√©der √† une analyse approfondie des diff√©rentes approches pour r√©soudre les probl√®mes pos√©s.  Maintenant, analyser nos d√©cisions, les √©valuer est beaucoup plus simple, et nous pouvons conclure que la plupart des d√©cisions prises √©taient correctes.  L'exigence de taille, en fait, a √©t√© la premi√®re pierre d'achoppement.  Tous les probl√®mes d√©crits ci-dessous peuvent √™tre r√©solus √† l'aide de SceneKit et UIKit.  J'ai essay√© d'expliquer en d√©tail comment r√©soudre chacun des probl√®mes en utilisant les deux approches.  Quelle approche utiliser d√©pend de vous. </p><br><p>  Imaginons que nous avons d√©cid√© d'impl√©menter une √©tiquette de finition √† l'aide de SceneKit.  Si nous prenons en compte que l'√©tiquette selon les dispositions aurait d√ª ressembler √† un cercle √† l'√©cran, alors il devient √©vident que dans SceneKit l'objet √©tiquette devrait √™tre une sph√®re (puisque la projection de la sph√®re sur n'importe quel plan est un cercle).  Pour que la projection ait un certain rayon sur l'√©cran, d√©fini dans les exigences des concepteurs, il est n√©cessaire de conna√Ætre le rayon de la sph√®re √† chaque instant.  Ainsi, en pla√ßant une sph√®re d'un certain rayon sur la sc√®ne √† un certain point et en mettant constamment √† jour son rayon √† l'approche ou en s'√©loignant, nous obtiendrons une projection sur l'√©cran de la taille requise √† tout moment.  L'algorithme de d√©termination du rayon de la sph√®re √† un instant arbitraire est le suivant: </p><br><ol><li>  d√©finir la position de l'objet sur la sc√®ne - le centre de la sph√®re, </li><li>  trouver la projection de ce point sur le plan de l'√©cran (√† l'aide de l'API SceneKit), </li><li>  pour d√©terminer la taille requise de la marque sur l'√©cran, on trouve la distance de la cam√©ra au centre de la sph√®re sur la sc√®ne, </li><li>  nous d√©terminons la taille requise sur l'√©cran par la distance √† l'objet en utilisant les r√®gles d√©crites dans la conception, </li><li>  connaissant la taille de la marque sur l'√©cran (diam√®tre du cercle), on choisit n'importe quel point sur ce cercle, </li><li>  faire la projection inverse (unfojectPoint) du point s√©lectionn√©, </li><li>  nous trouvons la longueur du vecteur du point re√ßu sur la sc√®ne au centre de la sph√®re. </li></ol><br><p>  La valeur obtenue de la longueur du vecteur sera le rayon souhait√© de la sph√®re. </p><br><p><img src="https://habrastorage.org/webt/go/2o/zu/go2ozuggr3zpucmewdrrybxbedy.png" alt="finition-rep√®re-taille-solution-scenekit"></p><br><p>  Au moment de la mise en ≈ìuvre, nous n'avons pas pu trouver un moyen de d√©terminer la taille de l'objet sur la sc√®ne, et nous avons d√©cid√© de tracer la marque d'arriv√©e √† l'aide d'UIKit.  Dans ce cas, l'algorithme r√©p√®te les √©tapes 1 √† 5, apr√®s quoi un cercle de la taille souhait√©e est dessin√© √† l'√©cran avec le centre au point obtenu √† l'√©tape 2 √† l'aide des outils UIKit.  Un exemple d'impl√©mentation d'une √©tiquette utilisant UIKit peut √™tre trouv√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><br><div class="spoiler">  <b class="spoiler_title">Quelques mots sur le code</b> <div class="spoiler_text"><p>  √Ä la fin de l'article, j'ai donn√© plusieurs liens vers des mat√©riaux utiles et simplement int√©ressants, y compris des exemples, dans lesquels vous pouvez regarder en d√©tail le vrai code qui r√©sout les probl√®mes pr√©sent√©s dans l'article et impl√©mente les algorithmes pr√©sent√©s.  Le principal int√©r√™t √† mon avis est le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">prototype du routage pi√©ton</a> , qui regroupe toutes les fonctionnalit√©s, √† l'exception du m√©canisme de r√©glage des axes, qui est d√©crit en d√©tail ci-dessous. </p><br><p>  Le code ci-dessus ne pr√©tend pas √™tre l'optimalit√©, l'exhaustivit√© et la qualit√© de production =) </p></div></div><br><p>  La diff√©rence entre l'utilisation de SceneKit et UIKit dans ce cas r√©side √©galement dans le fait que lors de l'impl√©mentation sur SceneKit, l'objet SCNNode pour le point de terminaison de l'itin√©raire (marque de fin) sera cr√©√© avec le mat√©riau et la g√©om√©trie, car il doit √™tre visible, lors de l'utilisation d'UIKit. nous avons besoin de l'objet n≈ìud exclusivement pour rechercher la projection sur le plan de l'√©cran (pour d√©terminer le centre de la marque sur l'√©cran).  Dans ce cas, la g√©om√©trie et le mat√©riau n'ont pas besoin d'√™tre ajout√©s.  Notez que la distance de la cam√©ra √† l'objet SCNNode du point final de l'itin√©raire peut √™tre trouv√©e de deux mani√®res - en utilisant les coordonn√©es g√©ographiques des points, ou comme la longueur du vecteur entre les points sur la sc√®ne.  Cela est possible car l'objet cam√©ra est une propri√©t√© SCNNode.  Pour obtenir le n≈ìud de la cam√©ra, vous devez vous r√©f√©rer √† la propri√©t√© pointOfView de notre sc√®ne. </p><br><p>  Nous avons appris √† d√©terminer le rayon du n≈ìud de la marque d'arriv√©e √† un moment arbitraire lors de l'impl√©mentation sur SceneKit et la position de la vue de la marque d'arriv√©e si elle est impl√©ment√©e sur UIKit.  Reste √† comprendre quand il faut mettre √† jour ces valeurs?  Cet endroit est la m√©thode d'objet SCNSceneRendererDelegate: </p><br><pre><code class="hljs objectivec">renderer(_ renderer: <span class="hljs-built_in"><span class="hljs-built_in">SCNSceneRenderer</span></span>, didRenderScene scene: <span class="hljs-built_in"><span class="hljs-built_in">SCNScene</span></span>, atTime time: TimeInterval)</code> </pre> <br><p>  Cette m√©thode est appel√©e apr√®s chaque image de sc√®ne rendue.  En mettant √† jour les valeurs des propri√©t√©s dans le corps de cette m√©thode, nous obtenons une √©tiquette de finition correctement affich√©e. </p><br><h2 id="animaciya">  L'animation </h2><br><p>  Apr√®s que la marque d'arriv√©e soit apparue dans dev, nous avons ajout√© une animation d'ondulation √† cette marque.  Je pense que pour la plupart des d√©veloppeurs iOS, la cr√©ation d'animations n'est pas un gros probl√®me.  Mais en r√©fl√©chissant √† la m√©thode d'impl√©mentation, nous avons rencontr√© le probl√®me de mettre constamment √† jour le cadre de notre vue.  Notez que dans la plupart des cas, des animations sont ajout√©es aux objets UIView statiques.  Un probl√®me similaire - une mise √† jour constante du rayon de la g√©om√©trie du n≈ìud se pose lors de l'impl√©mentation √† l'aide de SceneKit.  Le fait est que l'animation puls√©e se r√©sume √† l'animation de la taille du cercle (pour UIKit) et du rayon de la sph√®re (pour SceneKit).  Oui, oui, nous savons que dans UIKit ce type d'animation peut √™tre fait en utilisant CALayer, mais pour la simplicit√© de la narration, j'ai d√©cid√© de consid√©rer ce probl√®me sym√©triquement pour les deux frameworks.  Consid√©rons une impl√©mentation sur UIKit.  Si vous ajoutez du code qui anime le m√™me cadre au code existant qui met √† jour le cadre de vue, l'animation sera interrompue en d√©finissant explicitement le cadre.  Par cons√©quent, comme solution √† ce probl√®me, nous avons d√©cid√© d'utiliser l'animation de la propri√©t√© transform.scale.xy de l'objet UIView.  Lors de l'impl√©mentation √† l'aide de SceneKit, vous devrez ajouter une animation de la propri√©t√© scale √† l'objet SCNNode.  La bonne chose √† propos de l'utilisation de SceneKit dans ce cas est le fait qu'il prend enti√®rement en charge CoreAnimation, donc l'apprentissage d'une nouvelle API n'est pas n√©cessaire.  Le code qui impl√©mente une animation similaire √† l'animation d'√©tiquette dans Yandex.Maps ressemble √† ceci: </p><br><pre> <code class="hljs objectivec">let animationGroup = <span class="hljs-built_in"><span class="hljs-built_in">CAAnimationGroup</span></span>.init() animationGroup.duration = <span class="hljs-number"><span class="hljs-number">1.0</span></span> animationGroup.repeatCount = .infinity let opacityAnimation = <span class="hljs-built_in"><span class="hljs-built_in">CABasicAnimation</span></span>(keyPath: <span class="hljs-string"><span class="hljs-string">"opacity"</span></span>) opacityAnimation.fromValue = <span class="hljs-built_in"><span class="hljs-built_in">NSNumber</span></span>(value: <span class="hljs-number"><span class="hljs-number">1.0</span></span>) opacityAnimation.toValue = <span class="hljs-built_in"><span class="hljs-built_in">NSNumber</span></span>(value: <span class="hljs-number"><span class="hljs-number">0.1</span></span>) let scaleAnimation = <span class="hljs-built_in"><span class="hljs-built_in">CABasicAnimation</span></span>(keyPath: <span class="hljs-string"><span class="hljs-string">"scale"</span></span>) scaleAnimation.fromValue = <span class="hljs-built_in"><span class="hljs-built_in">NSValue</span></span>(scnVector3: <span class="hljs-built_in"><span class="hljs-built_in">SCNVector3</span></span>(<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>)) scaleAnimation.toValue = <span class="hljs-built_in"><span class="hljs-built_in">NSValue</span></span>(scnVector3: <span class="hljs-built_in"><span class="hljs-built_in">SCNVector3</span></span>(<span class="hljs-number"><span class="hljs-number">1.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.2</span></span>)) animationGroup.animations = [opacityAnimation, scaleAnimation] finishNode.addAnimation(animationGroup, forKey: <span class="hljs-string"><span class="hljs-string">"animations"</span></span>)</code> </pre> <br><h2 id="bilbord">  Panneau d'affichage </h2><br><p>  Au d√©but de l'article, j'ai mentionn√© un panneau d'affichage avec une distance jusqu'au point final de l'itin√©raire, qui, en substance, est une √©tiquette avec du texte toujours situ√©e au-dessus de la marque d'arriv√©e.  Par tradition, je d√©crirai les probl√®mes inh√©rents aux impl√©mentations sur UIKit et SceneKit, expliquant les solutions possibles pour chacun des frameworks. </p><br><p>  Commen√ßons par UIKit.  Dans ce cas, le panneau d'affichage est un UILabel r√©gulier, dans lequel le texte est constamment mis √† jour, indiquant la distance jusqu'au point final de l'itin√©raire.  Examinons le probl√®me auquel nous sommes confront√©s. </p><br><p><img src="https://habrastorage.org/webt/in/ad/7t/inad7t6_f7xu3hskdge0--hka38.png" alt="finition-rep√®re-panneau d'affichage-probl√®me-uikit"></p><br><p>  Si vous d√©finissez une √©tiquette sur un cadre, puis faites pivoter le t√©l√©phone, nous verrons que le cadre ne change pas (il serait √©trange que ce ne soit pas le cas).  Dans le m√™me temps, nous souhaitons que l'√©tiquette reste parall√®le au plan de la terre. </p><br><p><img src="https://habrastorage.org/webt/wq/7w/13/wq7w13m7byfynimnxcuxktdkpyi.png" alt="fini-rep√®re-panneau-d'affichage-d√©sir√©-uikit"></p><br><p>  Je pense que tout le monde comprend que lors du changement d'orientation de l'appareil, nous devons tourner l'√©tiquette, mais sous quel angle?  Si vous excitez l'imagination et imaginez mentalement tous les axes des syst√®mes de coordonn√©es et des vecteurs impliqu√©s dans ce processus, nous pouvons conclure que l'angle de rotation est √©gal √† l'angle entre l'axe x du syst√®me de coordonn√©es UIKit et la projection de l'axe X du syst√®me de coordonn√©es SceneKit sur le plan de l'√©cran. </p><br><p><img src="https://habrastorage.org/webt/cx/2p/6r/cx2p6rgc8dcat469mz75u1qitbs.png" alt="solution-de-rep√®re-d'affichage-solution-uikit"></p><br><p>  Une t√¢che simple qui a une nouvelle fois prouv√© l'utilit√© du cours de g√©om√©trie scolaire. </p><br><p>  Lors de la mise en ≈ìuvre de la marque d'arriv√©e √† l'aide de SceneKit, vous devrez tr√®s probablement rendre le panneau d'affichage √† distance √† l'aide des outils SceneKit, ce qui signifie que vous aurez certainement la t√¢che de faire en sorte que l'objet SCNNode soit toujours orient√© vers la cam√©ra.  Je pense que le probl√®me deviendra plus clair si vous regardez l'image: </p><br><p><img src="https://habrastorage.org/webt/ns/pz/we/nspzwezwp8erjsfxoit4un1pgie.png" alt="finish-placemark-billboard-problem-scenekit"></p><br><p>  Ce probl√®me est r√©solu en utilisant l'API SCNBillboardConstraint.  En ajoutant une constante avec un axe libre Y √† la collection des interpr√©tations de notre n≈ìud, nous obtenons un n≈ìud qui tourne autour de l'axe Y de son syst√®me de coordonn√©es, afin d'√™tre toujours orient√© vers la cam√©ra.  La seule t√¢che du d√©veloppeur est de placer ce n≈ìud √† la bonne hauteur afin que le panneau d'affichage avec la distance soit toujours visible pour l'utilisateur. </p><br><pre> <code class="hljs objectivec">let billboardConstraint = <span class="hljs-built_in"><span class="hljs-built_in">SCNBillboardConstraint</span></span>() billboardConstraint.freeAxes = <span class="hljs-built_in"><span class="hljs-built_in">SCNBillboardAxis</span></span>.Y finishNode.constraints = [billboardConstraint]</code> </pre> <br><h1 id="vspomogatelnaya-metka">  Tag Assistant </h1><br><p>  L'une des principales caract√©ristiques du routage pi√©ton √† r√©alit√© augment√©e, √† l'int√©rieur de l'√©quipe, nous consid√©rons une marque auxiliaire - un √©l√©ment visuel sp√©cial qui appara√Æt √† l'√©cran au moment o√π le point final de l'itin√©raire quitte la zone de visibilit√© et montre √† l'utilisateur o√π tourner le t√©l√©phone pour que la marque apparaisse √† l'√©cran ligne d'arriv√©e. </p><br><p><img src="https://habrastorage.org/webt/ze/8x/wg/ze8xwgjihp8s2g9wl15r3epoui0.png" alt="finition-rep√®re-indice-aper√ßu"></p><br><p>  Je suis s√ªr que de nombreux lecteurs ont rencontr√© des fonctionnalit√©s similaires dans certains jeux, le plus souvent des tireurs.  Quelle surprise notre √©quipe a √©t√© lorsque nous avons vu cet √©l√©ment d'interface utilisateur dans les mises en page.  Je dois dire tout de suite que la mise en ≈ìuvre correcte d'une telle fonctionnalit√© peut n√©cessiter plus d'une heure d'exp√©rimentation de votre part, mais le r√©sultat final vaut le temps pass√©.  Nous avons commenc√© par d√©finir les exigences, √† savoir: </p><br><ul><li>  pour n'importe quelle orientation de l'appareil, l'√©tiquette se d√©place le long des bordures de l'√©cran, </li><li>  si l'utilisateur a tourn√© de 180 degr√©s jusqu'au point final de l'itin√©raire, l'√©tiquette est affich√©e en bas de l'√©cran, </li><li>  √† chaque instant, le virage vers la marque doit √™tre le virage le plus court vers le point final de l'itin√©raire. </li></ul><br><p>  Apr√®s avoir d√©crit les exigences, nous avons commenc√© la mise en ≈ìuvre.  Presque imm√©diatement, nous sommes arriv√©s √† la conclusion que le rendu se ferait avec UIKit.  Le principal probl√®me de la mise en ≈ìuvre a √©t√© la d√©termination du centre de ce label √† chaque instant.  Apr√®s avoir consid√©r√© la marque d'arriv√©e, une telle t√¢che ne devrait pas causer de difficult√©s, je ne m'attarderai donc pas sur sa solution en d√©tail.  Dans l'article, je ne donnerai qu'une description de l'algorithme pour choisir le centre de l'√©tiquette auxiliaire, et le code source peut √™tre trouv√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><br><p>  Algorithme du centre de recherche Algorithme de recherche: </p><br><ol><li>  cr√©er un objet SCNNode pour le point final de l'itin√©raire avec une position sur la sc√®ne obtenue √† partir des coordonn√©es g√©ographiques du point, </li><li>  trouver la projection d'un point sur le plan de l'√©cran, </li><li>  trouver l'intersection du segment du centre de l'√©cran au point de la projection trouv√©e avec les segments des limites de l'√©cran dans le syst√®me de coordonn√©es de l'√©cran. </li></ol><br><p><img src="https://habrastorage.org/webt/pm/77/-v/pm77-vmlq5p6zmi7qe0yfkm7rvo.png" alt="solution-indice-rep√®re-finition"></p><br><p>  Le point d'intersection trouv√© est le centre souhait√© de la marque auxiliaire.  Par analogie avec le code qui met √† jour les param√®tres d'√©tiquette de finition, nous avons plac√© le code qui rend l'√©tiquette auxiliaire dans la m√©thode d√©l√©gu√©e d√©j√† exprim√©e ci-dessus. </p><br><h1 id="poliliniya-marshruta">  Polyligne de routage </h1><br><p>  Apr√®s avoir construit un itin√©raire et vu la marque d'arriv√©e √† l'√©cran, l'utilisateur peut l'atteindre en s'orientant uniquement dans la direction de la marque, mais le routage est appel√© ainsi car il montre l'itin√©raire vers l'utilisateur.  Nous avons pens√© qu'il serait tr√®s √©trange de r√©duire la fonctionnalit√© du routage pi√©ton, √† l'exclusion de l'affichage de l'itin√©raire de la version AR.  Pour visualiser la ligne de route, il a √©t√© d√©cid√© d'afficher un ensemble de fl√®ches se d√©pla√ßant le long de celle-ci.  Dans ce cas, les concepteurs √©taient convaincus que les fl√®ches dispara√Ætraient pratiquement en s'√©loignant (la taille serait d√©termin√©e par les r√®gles de projection en perspective), et il a √©t√© d√©cid√© d'utiliser SceneKit pour la mise en ≈ìuvre. </p><br><p>  Avant de d√©crire la mise en ≈ìuvre, il est important de noter que, par conception, les fl√®ches auraient d√ª √™tre √† une distance de 3 m les unes des autres.  Si vous estimez le nombre d'objets (fl√®ches) qui doivent √™tre restitu√©s avec un parcours d'environ 1 km de long, alors ce sera environ 330 pi√®ces.  En m√™me temps, √† chaque objet s'ajoute une animation de mouvement le long de sa portion de route.  Notez que les fl√®ches √©loign√©es de la position de la cam√©ra sur la sc√®ne √† une distance d'environ 100-150 m√®tres sont pratiquement invisibles en raison de leur petite taille.  Apr√®s avoir pris en compte ces facteurs, il a √©t√© d√©cid√© de ne pas afficher tous les objets, mais d'afficher uniquement ceux qui sont retir√©s √† l'utilisateur sur une distance maximale de 100 m√®tres le long de la ligne de route, en mettant √† jour p√©riodiquement l'ensemble d'objets affich√©.  Nous affichons une quantit√© suffisante d'informations visuelles, √©liminant les calculs SceneKit inutiles et √©conomisant la batterie de l'utilisateur. </p><br><p><img src="https://habrastorage.org/webt/q3/fz/r6/q3fzr6zbcifepwqzs9gwncj8-3k.png" alt="itin√©raire-polyligne-aper√ßu"></p><br><p>  Regardons les principales √©tapes que nous avons d√ª r√©aliser pour obtenir le r√©sultat final: </p><br><ul><li>  s√©lection de la section de route pour laquelle nous afficherons les primitives, </li><li>  cr√©ation de mod√®les 3D, </li><li>  cr√©ation d'animation </li><li>  mettre √† jour lors de la conduite sur un itin√©raire. </li></ul><br><h2 id="vybor-uchastka-dlya-otobrazheniya">  S√©lection d'un trac√© √† afficher </h2><br><p>  Comme je l'ai not√© ci-dessus, nous n'affichons pas de fl√®ches pour l'ensemble de l'itin√©raire, mais s√©lectionnons la section optimale pour l'affichage.  Le choix d'un segment √† un moment arbitraire consiste √† rechercher le segment d'itin√©raire le plus proche (l'itin√©raire est une s√©quence de segments / segments) √† la position actuelle de l'utilisateur et √† s√©lectionner des segments de l'itin√©raire le plus proche vers le point final de l'itin√©raire jusqu'√† ce que leur longueur totale d√©passe 100 m√®tres. </p><br><p><img src="https://habrastorage.org/webt/ay/_r/jr/ay_rjrcnkgtufpecvwezfyv0b_g.png" alt="route-polyligne-route-s√©lection-de-partie"></p><br><h2 id="sozdanie-3d-modeli">  Cr√©ation de mod√®les 3D </h2><br><p>  Examinons plus en d√©tail le processus de cr√©ation d'un mod√®le 3D.  Dans la plupart des cas, tout ce que vous devez faire pour cr√©er un mod√®le 3D simple (comme notre fl√®che) est d'ouvrir n'importe quel √©diteur 3D, de passer un peu de temps √† le ma√Ætriser et √† y cr√©er ce mod√®le.  Dans le cas o√π les gars de votre √©quipe ont de l'exp√©rience en mod√©lisation 3D, ou s'ils ont le temps d'apprendre, par exemple, 3DMax (et il doit √™tre achet√©), alors vous √™tes incroyablement chanceux.  Malheureusement, au moment de la mise en ≈ìuvre de cette fonctionnalit√©, aucun de nous n'avait d'exp√©rience particuli√®re, il n'y avait pas de temps libre pour la formation, nous avons donc d√ª cr√©er un mod√®le, pour ainsi dire, avec des moyens improvis√©s.  Je veux dire la description du mod√®le dans le code.  Tout a commenc√© par la pr√©sentation d'un mod√®le 3D sous forme de triangles.  Ensuite, nous avons d√ª trouver manuellement les coordonn√©es des sommets de ces triangles dans le syst√®me de coordonn√©es du mod√®le, puis cr√©er un tableau d'indices des sommets des triangles.  Avec ces donn√©es √† notre disposition, nous pouvons cr√©er la g√©om√©trie n√©cessaire directement dans SceneKit.  Vous pouvez cr√©er un mod√®le similaire au n√¥tre, par exemple, comme ceci: </p><br><pre> <code class="hljs powershell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ARSCNArrowGeometry</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SCNGeometry</span></span></span></span> { convenience init(material: SCNMaterial) { let vertices: [<span class="hljs-type"><span class="hljs-type">SCNVector3</span></span>] = [ <span class="hljs-type"><span class="hljs-type">SCNVector3Make</span></span>(-<span class="hljs-number"><span class="hljs-number">0.02</span></span>, <span class="hljs-number"><span class="hljs-number">0.00</span></span>, <span class="hljs-number"><span class="hljs-number">0.00</span></span>), // <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-type"><span class="hljs-type">SCNVector3Make</span></span>(-<span class="hljs-number"><span class="hljs-number">0.02</span></span>, <span class="hljs-number"><span class="hljs-number">0.50</span></span>, -<span class="hljs-number"><span class="hljs-number">0.33</span></span>), // <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-type"><span class="hljs-type">SCNVector3Make</span></span>(-<span class="hljs-number"><span class="hljs-number">0.10</span></span>, <span class="hljs-number"><span class="hljs-number">0.44</span></span>, -<span class="hljs-number"><span class="hljs-number">0.50</span></span>), // <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-type"><span class="hljs-type">SCNVector3Make</span></span>(-<span class="hljs-number"><span class="hljs-number">0.22</span></span>, <span class="hljs-number"><span class="hljs-number">0.00</span></span>, -<span class="hljs-number"><span class="hljs-number">0.39</span></span>), // <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-type"><span class="hljs-type">SCNVector3Make</span></span>(-<span class="hljs-number"><span class="hljs-number">0.10</span></span>, -<span class="hljs-number"><span class="hljs-number">0.44</span></span>, -<span class="hljs-number"><span class="hljs-number">0.50</span></span>), // <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-type"><span class="hljs-type">SCNVector3Make</span></span>(-<span class="hljs-number"><span class="hljs-number">0.02</span></span>, -<span class="hljs-number"><span class="hljs-number">0.50</span></span>, -<span class="hljs-number"><span class="hljs-number">0.33</span></span>), // <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-type"><span class="hljs-type">SCNVector3Make</span></span>( <span class="hljs-number"><span class="hljs-number">0.02</span></span>, <span class="hljs-number"><span class="hljs-number">0.00</span></span>, <span class="hljs-number"><span class="hljs-number">0.00</span></span>), // <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-type"><span class="hljs-type">SCNVector3Make</span></span>( <span class="hljs-number"><span class="hljs-number">0.02</span></span>, <span class="hljs-number"><span class="hljs-number">0.50</span></span>, -<span class="hljs-number"><span class="hljs-number">0.33</span></span>), // <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-type"><span class="hljs-type">SCNVector3Make</span></span>( <span class="hljs-number"><span class="hljs-number">0.10</span></span>, <span class="hljs-number"><span class="hljs-number">0.44</span></span>, -<span class="hljs-number"><span class="hljs-number">0.50</span></span>), // <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-type"><span class="hljs-type">SCNVector3Make</span></span>( <span class="hljs-number"><span class="hljs-number">0.22</span></span>, <span class="hljs-number"><span class="hljs-number">0.00</span></span>, -<span class="hljs-number"><span class="hljs-number">0.39</span></span>), // <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-type"><span class="hljs-type">SCNVector3Make</span></span>( <span class="hljs-number"><span class="hljs-number">0.10</span></span>, -<span class="hljs-number"><span class="hljs-number">0.44</span></span>, -<span class="hljs-number"><span class="hljs-number">0.50</span></span>), // <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-type"><span class="hljs-type">SCNVector3Make</span></span>( <span class="hljs-number"><span class="hljs-number">0.02</span></span>, -<span class="hljs-number"><span class="hljs-number">0.50</span></span>, -<span class="hljs-number"><span class="hljs-number">0.33</span></span>), // <span class="hljs-number"><span class="hljs-number">11</span></span> ] let sources: [<span class="hljs-type"><span class="hljs-type">SCNGeometrySource</span></span>] = [<span class="hljs-type"><span class="hljs-type">SCNGeometrySource</span></span>(<span class="hljs-type"><span class="hljs-type">vertices</span></span>: <span class="hljs-type"><span class="hljs-type">vertices</span></span>)] let indices: [<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span><span class="hljs-number"><span class="hljs-number">32</span></span>] = [<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>] let geometryElements = [<span class="hljs-type"><span class="hljs-type">SCNGeometryElement</span></span>(<span class="hljs-type"><span class="hljs-type">indices</span></span>: <span class="hljs-type"><span class="hljs-type">indices</span></span>, <span class="hljs-type"><span class="hljs-type">primitiveType</span></span>: <span class="hljs-type"><span class="hljs-type">.triangles</span></span>)] self.init(sources: sources, elements: geometryElements) self.materials = [<span class="hljs-type"><span class="hljs-type">material</span></span>] } } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> func arrowBlue() -&gt; SCNGeometry { let material = SCNMaterial() material.diffuse.contents = UIColor.blue material.lightingModel = .constant <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ARSCNArrowGeometry(material: material) }</code> </pre> <br><p>  Le r√©sultat final ressemble √† ceci: </p><br><p><img src="https://habrastorage.org/webt/xp/ms/ov/xpmsovmunineo54tl2dh_7tkjqi.png" alt="route-polyligne-fl√®che-mod√®le"></p><br><h2 id="animaciya-linii-marshruta">  Animation de ligne de route </h2><br><p>  L'√©tape suivante sur la fa√ßon d'afficher une ligne anim√©e de l'itin√©raire a √©t√© l'√©tape de cr√©ation de l'animation elle-m√™me.  Mais comment r√©aliser l'animation qui, dans sa forme finale, semble que la fl√®che commence son mouvement au point de d√©part de la section s√©lectionn√©e de l'itin√©raire et "flotte" le long de l'itin√©raire jusqu'√† la fin de cette section? </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/k3myOucSs8I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Je ne d√©crirai pas toutes les fa√ßons possibles de cr√©er une telle animation, mais je m'attarderai plus en d√©tail sur la m√©thode que nous avons choisie.  Apr√®s avoir s√©lectionn√© une section de l'itin√©raire, nous la divisons en sections de m√™me longueur - sections de l'animation d'une fl√®che.  Chacune de ces sections est mise en √©vidence en couleur et a une longueur √©gale √† la distance entre les fl√®ches. </p><br><p><img src="https://habrastorage.org/webt/-t/rg/_1/-trg_11cxxxv3affm0cm3g3ur60.png" alt="partitionnement de route-polyligne-route-part"></p><br><p>  Au d√©but de chaque section, nous cr√©ons l'objet SCNNode de la fl√®che, dont l'animation consiste √† se d√©placer le long de sa section. </p><br><p><img src="https://habrastorage.org/webt/db/dc/cd/dbdccdds7qldg5d-2hbujicqrgm.png" alt="route-polyline-arrows-initial-position"></p><br><p>  Comme vous pouvez le voir, la section d'animation se compose parfois d'un segment, parfois de deux ou plus.  Tout d√©pend de l'√©tape (dans notre cas - 3 m√®tres) entre les fl√®ches et les coordonn√©es des points qui composent l'itin√©raire. </p><br><p>  Une animation de fl√®che est une s√©quence de deux √©tapes: </p><br><ul><li>  apparition dans la position initiale avec l'angle de rotation initial, </li><li>  une s√©quence de d√©calages le long de segments avec des rotations aux points de connexion des segments. </li></ul><br><p>  Sch√©matiquement, cela ressemble √† ceci: </p><br><p><img src="https://habrastorage.org/webt/f6/ha/7s/f6ha7sdwzchpv28sekjopugnrwo.png" alt="route-polyline-arrow-anitaion-steps"></p><br><p>  Il nous a sembl√© le moyen le plus simple de mettre en ≈ìuvre une telle animation √† l'aide de l'API SCNAction - une API d√©clarative qui vous permet de cr√©er facilement des animations s√©quentielles, de groupe et r√©p√©titives.  Vous pouvez regarder l'impl√©mentation plus en d√©tail <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Du fait que chaque fl√®che termine son animation au point de d√©part de la section d'animation de la fl√®che suivante, l'impression d'un mouvement continu de la fl√®che sur toute la section s√©lectionn√©e de l'itin√©raire est cr√©√©e. </p><br><p>  Sur ce point, je propose de compl√©ter l'examen de divers aspects du rendu et de passer √† la partie principale - d√©terminer les positions des objets sur la sc√®ne par les coordonn√©es g√©ographiques des objets. </p><br><h1 id="opredelenie-pozicii-obekta-na-scene">  D√©terminer la position d'un objet sur la sc√®ne </h1><br><p>  Nous commen√ßons la conversation sur la d√©termination de la position d'un objet sur la sc√®ne en consid√©rant les syst√®mes de coordonn√©es, dont la conversion doit √™tre effectu√©e.  Il n'y en a que 2: </p><br><ul><li>  coordonn√©es g√©od√©siques (ou g√©ographiques pour simplifier) ‚Äã‚Äã- la position des objets (points de route) dans le monde r√©el, </li><li>  Coordonn√©es cart√©siennes - la position des objets sur la sc√®ne (dans ARKit).  Rappelons que le syst√®me de coordonn√©es de la sc√®ne co√Øncide avec le syst√®me de coordonn√©es ARKit (dans le cas d'utilisation d'ARSCNView). </li></ul><br><p>  La traduction d'un syst√®me de coordonn√©es √† un autre et vice versa est possible du fait que les coordonn√©es dans ARKit sont mesur√©es en m√®tres, et le d√©calage entre deux coordonn√©es g√©od√©siques peut √™tre traduit avec une grande pr√©cision dans le d√©calage en m√®tres le long des axes X et Z du syst√®me de coordonn√©es ARKit √† petits d√©calages.  Permettez-moi de vous rappeler que les coordonn√©es g√©od√©siques sont des points avec une certaine longitude et latitude. </p><br><p>  Rappelons des concepts aussi importants du cours de la g√©ographie que les parall√®les et les m√©ridiens, et leurs propri√©t√©s de base: </p><br><ul><li>  <strong>Parall√®le</strong> est une ligne avec un degr√© de latitude.  Les longueurs des diff√©rents parall√®les sont diff√©rentes. </li><li>  <strong>M√©ridien</strong> - une ligne avec un degr√© de longitude.  Les longueurs de tous les m√©ridiens sont les m√™mes. </li></ul><br><p>  Voyons maintenant comment calculer le d√©calage en m√®tres, entre deux coordonn√©es g√©od√©siques avec des coordonn√©es <img src="https://habrastorage.org/getpro/habr/post_images/211/5b5/55a/2115b555a85046620be7a8523deb4d25.svg" alt="\ en ligne (lat_1, lon_1)">  et <img src="https://habrastorage.org/getpro/habr/post_images/5f8/1d8/647/5f81d86472cae8dabc2ac218803f8125.svg" alt="\ en ligne (lat_2, lon_2)">  : </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a44/a8c/946/a44a8c946ea2dc906e48fe45dae1a432.svg" alt="\ Delta x = \ Delta lon \ times metresInLonDegree (lat_ {0})">  , <img src="https://habrastorage.org/getpro/habr/post_images/96a/036/d49/96a036d490185172d1ac79635788e31b.svg" alt="\ Delta z = \ Delta lat \ times m√®tresInLatDegree"></p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/8f5/438/3f1/8f54383f1775fe7105087c4ff5891a18.svg" alt="metresInLonDegree (\ alpha) = \ frac {2 \ pi R_ \ text {lands} \ cos \ left (\ alpha \ right)} {360 ^ {¬∞}}">  , <img src="https://habrastorage.org/getpro/habr/post_images/afa/9ec/76a/afa9ec76ae9ee9dfdf5228c8ace8c603.svg" alt="metresInLatDegree = \ frac {2 \ pi R_ \ text {lands}} {360 ^ {¬∞}}"></p><br><div class="spoiler">  <b class="spoiler_title">Explication</b> <div class="spoiler_text"><p>  Le d√©placement en coordonn√©es g√©od√©siques correspond lin√©airement aux m√®tres uniquement pour de petits d√©placements.  Lors de grands d√©placements, il est n√©cessaire de prendre honn√™tement l'int√©grale. </p></div></div><br><p>  Maintenant que nous pouvons traduire le d√©calage d'un syst√®me de coordonn√©es √† un autre, nous devons d√©cider d'un point de r√©f√©rence - un point pour lequel la coordonn√©e g√©ographique et la coordonn√©e dans ARKit (coordonn√©e sur la sc√®ne) sont connues en m√™me temps.  Apr√®s avoir trouv√© un tel point, nous pouvons d√©terminer les coordonn√©es de n'importe quel objet sur la sc√®ne, en connaissant ses coordonn√©es g√©ographiques et en utilisant les formules ci-dessus. </p><br><p>  Pour plus de clart√©, consid√©rons un exemple: <br>  Au d√©but de la session de r√©alit√© augment√©e, nous avons demand√© √† CoreLocation notre coordonn√©e g√©ographique et l'avons re√ßue instantan√©ment - <img src="https://habrastorage.org/getpro/habr/post_images/fda/ae2/64a/fdaae264a0f9dd176411b6ff5755bff4.svg" alt="\ en ligne (lat_0, lon_0)">  .  Rappelant le fait que l'origine du syst√®me de coordonn√©es ARKit est au d√©but de la session au point o√π se trouve l'appareil, nous avons obtenu le point de r√©f√©rence, car nous connaissons la coordonn√©e g√©ographique et la coordonn√©e sur la sc√®ne <img src="https://habrastorage.org/getpro/habr/post_images/24e/b89/0e6/24eb890e6f1f8beac2b3c3cecfd8fe48.svg" alt="\ inline (x_0, y_0, z_0) = (0,0,0)">  .  Essayons de trouver la coordonn√©e sur la sc√®ne de l'objet avec une coordonn√©e g√©ographique <img src="https://habrastorage.org/getpro/habr/post_images/211/5b5/55a/2115b555a85046620be7a8523deb4d25.svg" alt="\ en ligne (lat_1, lon_1)">  .  Pour ce faire, recherchez le d√©calage en m√®tres entre la coordonn√©e g√©ographique de l'objet et la coordonn√©e g√©ographique de notre point de r√©f√©rence, puis ajoutez le d√©calage trouv√© √† la coordonn√©e sur la sc√®ne du point de r√©f√©rence.  La coordonn√©e r√©sultante sur la sc√®ne sera celle d√©sir√©e. </p><br><p><img src="https://habrastorage.org/webt/t5/n7/c7/t5n7c7_5qzbakweb9xcaal2ai0u.png" alt="coordonn√©es-conversion-objet-position-sur-sc√®ne"></p><br><p>  Je note que la position sur la sc√®ne trouv√©e de cette mani√®re ne correspondra √† la position de l'objet dans le monde r√©el que si les axes X / Z du syst√®me de coordonn√©es de la sc√®ne sont align√©s avec les directions vers le sud / est.  L'alignement des axes, en th√©orie, doit √™tre r√©alis√© en d√©finissant l'indicateur worldAlignment sur gravitiAndHeading.  Mais comme je l'ai dit au d√©but de l'article, c'est loin d'√™tre toujours le cas. </p><br><p>  Examinons plus en d√©tail la m√©thode de d√©termination du point de r√©f√©rence.  Pour ce faire, nous introduisons le concept d' <strong>estimation</strong> - un ensemble de coordonn√©es g√©ographiques et de coordonn√©es sur la sc√®ne. </p><br><p><img src="https://habrastorage.org/webt/gl/lu/ap/glluap6lmes0g1o2q124jkyb4y0.png" alt="coordonn√©es-conversion-estimation-d√©finition"></p><br><p>  La m√©thode propos√©e ci-dessus pour d√©terminer le point de r√©f√©rence peut ne pas toujours √™tre utilis√©e.  Au moment du d√©but d'une session de r√©alit√© augment√©e, une demande de CLLocation d'un utilisateur peut ne pas √™tre ex√©cut√©e imm√©diatement, de plus, la pr√©cision de la coordonn√©e obtenue peut avoir une grande erreur.  Il serait plus correct de demander √† SceneKit une position sur la sc√®ne au moment o√π nous obtenons la valeur de CoreLocation.  Dans ce cas, les composantes de l'estimation r√©sultante sont en effet obtenues en m√™me temps, et nous avons la possibilit√© d'utiliser n'importe laquelle des estimations comme point de r√©f√©rence.  Lorsque vous travaillez avec ARKit, l'erreur de d√©calage s'accumule au fil du temps, donc Apple ne recommande pas d'utiliser ARKit comme outil de navigation. </p><br><p>  Lorsque nous avons d√©cid√© d'impl√©menter le routage pi√©ton avec la r√©alit√© augment√©e, nous avons fait une petite recherche des solutions qui existaient √† l'√©poque, en utilisant ARKit pour des t√¢ches similaires, et sommes tomb√©s sur le cadre ARKit + CoreLocation.  L'id√©e de ce cadre √©tait que gr√¢ce √† ARKit nous pouvons d√©terminer plus pr√©cis√©ment l'emplacement de l'utilisateur que lors de l'utilisation exclusive de CoreLocation. </p><br><p>  Concept ARKit + CoreLocation: </p><br><ul><li>  lors de la r√©ception de CLLocation de CLLocationManager <br><ul><li>  demander une position sur la sc√®ne √† l'aide de scene.pointOfView.worldPosition </li><li>  enregistrer cette paire de coordonn√©es (estimation) dans le tampon </li></ul></li><li>  obtenir l'emplacement exact si n√©cessaire <br><ul><li>  choisissez la meilleure estimation </li><li>  calculer le d√©calage entre la position actuelle sur la sc√®ne et la position sur la sc√®ne de la meilleure estimation </li><li>  appliquer le d√©calage trouv√© √† la coordonn√©e g√©ographique de la meilleure estimation </li></ul></li></ul><br><p>          ,   ,   CoreLocation,       . </p><br><p>   ,   ¬´ ¬ª.   ,      . </p><br><p>     (,    ): </p><br><ul><li>    (  horizontalAccuracy), </li><li>       , </li><li>        100    . </li></ul><br><p>          CoreLocation   .    ,     ,     CoreLocation   ,             100    . </p><br><p>       ,           . ,             ,        ( 100 ). </p><br><h1 id="korrektirovka-sistemy-koordinat">    </h1><br><p>       ,   X/Z   ARKit        /   . ARKit    ,       ,            . </p><br><div class="spoiler">  <b class="spoiler_title">Pourquoi?</b> <div class="spoiler_text"><p>   ,       (,   IKEA,            ),       Y   ARKit ‚Äì        ,                   .        gravity   worldAlignment. </p></div></div><br><p>    ,          .        ,     ,            ,        .         .        AR     .        ,  ,    ,   ,  .       AR. </p><br><h2 id="opredelenie-ugla-korrekcii">    </h2><br><p>    ,      .  ,     <img src="https://habrastorage.org/getpro/habr/post_images/593/7e3/1a5/5937e31a59e1e414d1a9305d5826e3aa.svg" alt="\inline t_1">    CLLocationManager   <img src="https://habrastorage.org/getpro/habr/post_images/211/5b5/55a/2115b555a85046620be7a8523deb4d25.svg" alt="\inline (lat_1,lon_1)">      ‚Äî <img src="https://habrastorage.org/getpro/habr/post_images/1bc/c49/846/1bcc49846ef09e14c8b3855a701f4b9f.svg" alt="\inline (x_1,z_1)">  .     <img src="https://habrastorage.org/getpro/habr/post_images/1fb/2ab/c7a/1fb2abc7a7042f7bf12001fab25ae688.svg" alt="\inline t_2">      CLLocationManager ‚Äî <img src="https://habrastorage.org/getpro/habr/post_images/5f8/1d8/647/5f81d86472cae8dabc2ac218803f8125.svg" alt="\inline (lat_2,lon_2)">     <img src="https://habrastorage.org/getpro/habr/post_images/ed3/051/02d/ed305102d4e86b54584281d6590b0492.svg" alt="\inline (x_2,z_2)">  en cons√©quence. </p><br><p>      ARKit ‚Äî <img src="https://habrastorage.org/getpro/habr/post_images/9a1/682/65e/9a168265ec4504ebe5356d7a9803a313.svg" alt="\inline (\Delta x,\Delta z)">    2     CoreLocation    <img src="https://habrastorage.org/getpro/habr/post_images/1fb/2ab/c7a/1fb2abc7a7042f7bf12001fab25ae688.svg" alt="\inline t_2">  .   <img src="https://habrastorage.org/getpro/habr/post_images/5f8/1d8/647/5f81d86472cae8dabc2ac218803f8125.svg" alt="\inline (lat_2,lon_2)">    <img src="https://habrastorage.org/getpro/habr/post_images/0ad/186/b97/0ad186b971730a033bc621b7144413d2.svg" alt="\inline (lat_{2calc},lon_{2calc})">  .      ,    CoreLocation        .      .        ARKit     /. </p><br><p><img src="https://habrastorage.org/webt/kp/cy/jc/kpcyjc9rjyxrnlnmzaved-ytw8m.png" alt="coordinates-conversion-correction-angle-problem"></p><br><p>          ARKit      Y?          .         : </p><br><ol><li>      , </li><li>  , </li><li>     , </li><li>        , </li><li>     . </li></ol><br><p>   .   .   CLLocationManager'    ,               (  ),       (  ). </p><br><div class="spoiler"> <b class="spoiler_title">   ?</b> <div class="spoiler_text"><p>            .      ,     ,         .     , ,    GPS . </p></div></div><br><p>       1, 2       : <img src="https://habrastorage.org/getpro/habr/post_images/1a3/078/c21/1a3078c2199432c003ffc50a749fbb66.svg" alt="\inline initialBearing(1,2)">  et <img src="https://habrastorage.org/getpro/habr/post_images/2e5/fc3/325/2e5fc3325cde601c4f4c59dae3576b62.svg" alt="\inline initialBearing(1,2_{calc})">  o√π <img src="https://habrastorage.org/getpro/habr/post_images/993/049/474/9930494747afd3ba004e0f512635539e.svg" alt="\inline 2_{calc}"> ‚Äì    2,      ARKit.   <img src="https://habrastorage.org/getpro/habr/post_images/937/c05/90c/937c0590c7c66d7762185d852a9adf1c.svg" alt="\inline initialBearing(a,b)">   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> (  Bearing). </p><br><p><img src="https://habrastorage.org/webt/wp/lf/lv/wplflvaucl_3ntt7x-of1_pmj2q.png" alt="coordinates-conversion-correction-angle-calculation-for-pair"></p><br><p>                  .    ,        ? ,        ,  ,        ,         .          ,      ,    ,   horizontalAccuracy.  ,   ,          ,   .                    : </p><br><p><img src="https://habrastorage.org/webt/3m/qc/_k/3mqc_krnknduxupcmianxsturym.png" alt="coordinates-conversion-correction-angle-calculation-error"></p><br><p>  ,   ,                 . </p><br><p>    . ,          . : </p><br><ul><li>  N     , </li><li>       , </li><li> M      (  ?). </li></ul><br><p>  ,    ,    ,    ,       (),              .                ,  .    ,     ,           .   ,    ,     (    ).               . </p><br><p>  ,                . ,     ,      (          ,           ,     ). </p><br><h2 id="testirovanie">  Test </h2><br><p> ,      .  ,     ,    ,     .      2 : </p><br><ul><li>     , </li><li>        . </li></ul><br><p>  -      , ,   ,      ,         . </p><br><p>                .  , ,  100  CLLocation,          .   ,     , ,  10  (       10 ).            ?        ,        "".   ,        .    ,        ,       ,    .   ,       ,     .      ,      CoreLocation.     ,     .  ,      . </p><br><p>       .     ,            .   ,     (,       ),          ,       0 . ,    ,    . </p><br><p>       " ".              .      ,        ,     ,       ,        CLLocation,        ,            .        (         )       . </p><br><p>    ,           ARKit. </p><br><p><img src="https://habrastorage.org/webt/wv/qd/8i/wvqd8ikrpgvslsgndlmvmss13yu.png" alt="correction-angle-calculation-alg-testing-street-before-correction"></p><br><p> ,       . </p><br><p><img src="https://habrastorage.org/webt/jx/qb/aq/jxqbaqs21nprxhb6zhfueipyj2s.png" alt="correction-angle-calculation-alg-testing-street-after-correction"></p><br><p>    ( 3-4 )           ,    . </p><br><p><img src="https://habrastorage.org/webt/fd/1n/ct/fd1nctm6j9slks4r8rfhmmvkjz8.png" alt="correction-angle-calculation-alg-testing-street-after-last-correction"></p><br><p>          JS,       AR  CoreLocation. </p><br><p><img src="https://habrastorage.org/webt/4e/gk/2r/4egk2rlbx_5aloj-tc-2rcxqoaq.png" alt="correction-angle-calculation-alg-testing-tracks"></p><br><p>              ‚Äî     gravity   worldAlignment      .      ,          .              . </p><br><h1 id="vmesto-zaklyucheniya">  Au lieu d'une conclusion </h1><br><p>      Slack, ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> ,  ,         .                      AR.  .       AR  AppStore  2017 . ,      . </p><br><h1 id="poleznye-ssylki">  Liens utiles </h1><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> </li><li> ARKit+CoreLocation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   ARKit</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">    </a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> AR   </a> </li></ul><br><p>      ,           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> .</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr421957/">https://habr.com/ru/post/fr421957/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr421945/index.html">Google et Mastercard concluent un accord secret pour suivre les achats dans les magasins</a></li>
<li><a href="../fr421947/index.html">Bienvenue sur Android Devs Meetup le 8 septembre</a></li>
<li><a href="../fr421949/index.html">Suicide Squad Comment nous recrutons les d√©veloppeurs juniors les plus f√©roces</a></li>
<li><a href="../fr421953/index.html">Summ3r 0f h4ck: stage d'√©t√© chez Digital Security</a></li>
<li><a href="../fr421955/index.html">Le S√©nat ne veut pas de robots distraits par la bi√®re. Et quoi d'autre √† √©crire vendredi?</a></li>
<li><a href="../fr421959/index.html">Que faire lorsque ¬´ceci¬ª perd le lien de contexte</a></li>
<li><a href="../fr421961/index.html">Cr√©ation d'une d√©mo pour un ancien t√©l√©phone - AONDEMO</a></li>
<li><a href="../fr421963/index.html">Tenue de livres et comptable: leur r√¥le dans l'organisation</a></li>
<li><a href="../fr421965/index.html">¬´En plus de travailler, je travaille toujours¬ª - 10 questions pour le programmeur, troisi√®me √©dition</a></li>
<li><a href="../fr421967/index.html">Jouet pour enfants sur les √©l√©ments logiques</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>