<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😈 💪🏿 🧗 Nous démontons le protocole de la bouilloire Redmond G200S et le connectons au HomeAssistant 🕦 👩🏻‍🌾 🔧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Entrée 
 Il y a déjà eu un article sur le Gicktime consacré à l'analyse du protocole de la bouilloire Redmond SkyKettle. Cependant, là, ils ont parlé ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nous démontons le protocole de la bouilloire Redmond G200S et le connectons au HomeAssistant</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412583/"><h3>  Entrée </h3><br>  Il y a déjà eu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un article</a> sur le Gicktime consacré à l'analyse du protocole de la bouilloire Redmond SkyKettle.  Cependant, là, ils ont parlé du modèle RK-M171S, ici nous parlerons d'un G200S plus fonctionnel.  Dans ce modèle, le protocole d'interaction a changé, à cause duquel l'approche de l'auteur de l'article précédent ne fonctionne plus, et des fonctions supplémentaires de la veilleuse et d'indication de la température actuelle en couleur sont apparues. <br><br>  Dans cet article, je présenterai les résultats d'une analyse de protocole avec des exemples de code python (si quelqu'un veut développer son module / application pour contrôler la théière).  À la fin de l'article se trouve également un lien vers un module prêt à l'emploi pour connecter une théière à HomeAssistant (c'est ma première expérience d'écriture en python après avoir suivi un cours en ligne, donc ce module peut et doit même être amélioré). <br><br>  Tous ceux qui sont intéressés, bienvenue au chat. <br><a name="habracut"></a><br><h3>  Problèmes et tâches </h3><br>  Cette théière a un gros inconvénient (à l'exception de celles indiquées par l'auteur du premier article): dès que la théière est retirée du stand, l'heure actuelle est réinitialisée et, par conséquent, le planning ne peut pas être utilisé pour faire bouillir la théière.  Selon les idées des auteurs de cette création, à chaque fois après avoir remis la bouilloire sur le stand, vous devez lancer leur application propriétaire et synchroniser la bouilloire avec un smartphone.  Ainsi, au lieu de faciliter les tâches de routine, la technologie «intelligente» nous forme à effectuer des actions supplémentaires.  Mais tout a changé lorsque HomeAssistant est apparu dans la maison.  J'ai alors décidé de comprendre le protocole. <br><br><h3>  Les outils </h3><br>  Honnêtement, j'ai essayé de décompiler et d'analyser l'application d'origine, mais j'ai échoué.  Les outils que j'ai utilisés ne m'ont pas permis de comprendre la logique de la bouilloire.  Toutes les procédures et fonctions ont été obtenues par des «courbes», sans nom (par type a, b, c, etc.).  Peut-être que je n'ai pas assez d'expérience et de compétence.  Au final, j'ai suivi le même chemin que l'auteur de l'article précédent.  La seule différence significative est que j'ai utilisé le mode interactif de l'utilitaire gatttool.  L'avantage est que ce mode élimine toutes sortes de "races", à propos desquelles l'auteur du premier article a écrit. <br><br>  Puisque HomeAssistant est écrit en python, nous y écrirons toutes les commandes supplémentaires.  Pour utiliser le mode de fonctionnement interactif de gatttool en python, la bibliothèque pexpect nous aidera, vous permettant de générer l'essence des applications tierces et de surveiller leur sortie (notoirement courbée). <br><br><h3>  Pratique </h3><br>  J'enverrai à nouveau le premier article sur la description générale du protocole d'échange à l'auteur de l'article, donc sans plus tarder, nous procéderons aux commandes de contrôle. <br><br><ol><li>  <b>Installation et déconnexion</b> <br><br>  Établissez une connexion: <br><br><pre><code class="python hljs">child = pexpect.spawn(<span class="hljs-string"><span class="hljs-string">"gatttool -I -t random -b "</span></span> + mac, ignore_sighup=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>, timeout=<span class="hljs-number"><span class="hljs-number">3</span></span>) child.sendline(<span class="hljs-string"><span class="hljs-string">"connect"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'Connection successful.*\[LE\]&gt;'</span></span>, timeout=<span class="hljs-number"><span class="hljs-number">3</span></span>)</code> </pre> <br>  Ici mac est l'adresse du coquelicot de la théière. <br><br>  Nous rompons la connexion: <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"exit"</span></span>)</code> </pre> </li><li>  <b>Abonnez-vous aux notifications</b> <br><br>  Après avoir établi la connexion, tout d'abord, nous devons nous abonner pour recevoir des notifications de la bouilloire.  Sans cela, la théière percevra les commandes, mais elle ne pourra rien nous répondre sauf le texte «Avec succès». <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-cmd 0x000c 0100"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> </li><li>  <b>Se connecter</b> <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"ff"</span></span> + key + <span class="hljs-string"><span class="hljs-string">"aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) connectedStr = child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) answer = connectedStr.split()[<span class="hljs-number"><span class="hljs-number">3</span></span>] <span class="hljs-comment"><span class="hljs-comment"># parse: 00 - no 01 - yes child.expect(r'\[LE\]&gt;')</span></span></code> </pre> <br>  Ci-après, iter est une variable hexadécimale itérative entière de 0 à 64 (de 0 à 100 dans le système décimal).  Après chaque commande (réussie et non réussie), cette variable doit être augmentée de 1; lorsqu'elle atteint 64, elle est à nouveau réinitialisée à 0;  clé - clé d'autorisation hexadécimale de 8 octets (par exemple: ffffffffffffffff). <br><br>  Exemple de réponse: <br><blockquote>  valeur: 55 00 ff 01 aa </blockquote>  Le quatrième octet (01) signifie que la bouilloire vous a autorisé, sinon la réponse sera 00. <br></li><li>  <b>De la magie de la rue</b> <br>  Après autorisation, une demande «magique» est toujours envoyée, dont l'essence n'est pas claire pour moi.  Il existe une théorie selon laquelle il est nécessaire de "maintenir" l'état connecté.  Apparemment, si vous ne l'envoyez pas, la déconnexion se produit en une seconde et vous devez tout recommencer.  Si vous l'envoyez, le délai augmente considérablement, atteignant jusqu'à une douzaine de secondes.  Confirmer de manière fiable cela, je ne pouvais pas. <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"01aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Exemple de réponse: <br><blockquote>  valeur: 55 01 01 02 1d aa </blockquote><br>  Dans toutes mes expériences, la réponse a toujours été la suivante. <br><br>  <b>UPD:</b> dans les commentaires, ils ont suggéré que ce n'était pas du tout magique, mais simplement demander la version du logiciel; en conséquence, cette version est contenue dans la réponse.  Ainsi, cette demande peut généralement être supprimée car inutile. <br></li><li>  <b>Sync</b> <br>  Une commande qui synchronise l'heure dans une théière avec une horloge de serveur.  Elle a encore un effet.  Dans la bouilloire, il est possible d'afficher la température actuelle en mode veille en faisant clignoter une LED d'une certaine couleur.  Cette fonction ne fonctionne qu'après synchronisation.  Pour une description de la fonction elle-même, voir le paragraphe 11. <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"6e"</span></span> + timeNow + tmz + <span class="hljs-string"><span class="hljs-string">"0000aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Ici, tmz est le fuseau horaire au format hexadécimal inversé (par exemple, traduisez le fuseau horaire +3 en secondes, puis au format hexadécimal et obtenez hexadécimal (3 * 60 * 60) = 2a30, divisé en paires et produit 302a en ordre inverse).  Je ne sais pas quoi faire avec les fuseaux horaires négatifs, je ne l'ai pas testé, mais on soupçonne que le prochain octet tmz en est responsable.  Ici, timeNow est l'heure <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">unixtime</a> actuelle au format hexadécimal inversé.  L'algorithme est le même: nous obtenons l'heure actuelle en secondes, la traduisons en HEX, la divisons en paires et la sortons en ligne dans l'ordre inverse. <br><br>  Exemple de réponse: <br><blockquote>  valeur: 55 02 6e 00 aa </blockquote>  Dans toutes mes expériences, la réponse a toujours été la suivante. <br></li><li>  <b>Statistiques</b> <br>  La bouilloire a un mètre d'électricité consommée, la durée totale de fonctionnement et le nombre de démarrages.  Si quelqu'un n'a pas besoin de ces données, vous pouvez ignorer cet élément en toute sécurité. <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"4700aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) statusStr = child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) Watts = hexToDec(str(statusStr.split()[<span class="hljs-number"><span class="hljs-number">11</span></span>] + statusStr.split()[<span class="hljs-number"><span class="hljs-number">10</span></span>] + statusStr.split()[<span class="hljs-number"><span class="hljs-number">9</span></span>])) alltime = round(self._Watts/<span class="hljs-number"><span class="hljs-number">2200</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>) child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"5000aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) statusStr = child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) times = hexToDec(str(statusStr.split()[<span class="hljs-number"><span class="hljs-number">7</span></span>] + statusStr.split()[<span class="hljs-number"><span class="hljs-number">6</span></span>])) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Watts - renvoie l'énergie consommée en Wh * h, en tout temps - les heures de fonctionnement de la bouilloire, fois - le nombre de démarrages de la bouilloire.  hexToDec - une fonction de conversion au format décimal. <br></li><li>  <b>Lire le mode de fonctionnement actuel</b> <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"06aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) statusStr = child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) answer = statusStr.split() status = str(answer[<span class="hljs-number"><span class="hljs-number">11</span></span>]) temp = hexToDec(str(answer[<span class="hljs-number"><span class="hljs-number">8</span></span>])) mode = str(answer[<span class="hljs-number"><span class="hljs-number">3</span></span>])</code> </pre> <br>  Exemple de réponse: <br><blockquote>  valeur: 55 04 06 00 00 00 00 01 2a 1e 00 00 00 00 00 00 80 00 00 aa </blockquote>  Le quatrième octet est le mode de fonctionnement (mode): 00 - ébullition, 01 - chauffage à température, 03 - veilleuse.  Le sixième octet est la température hexadécimale à laquelle il est nécessaire de chauffer en mode chauffage, en mode ébullition, il est 00. Le neuvième octet est la température hexadécimale actuelle de l'eau (2a = 42 degrés Celsius).  Le douzième octet est l'état de la théière: 00 - éteint, 02 - allumé.  Le dix-septième octet est la durée de la bouilloire après avoir atteint la température souhaitée, par défaut, elle est de 80 en hexadécimal (apparemment, ce sont des unités relatives, certainement pas des secondes). <br></li><li>  <b>Enregistrer le mode de fonctionnement actuel</b> <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"05"</span></span> + mode + <span class="hljs-string"><span class="hljs-string">"00"</span></span> + temp + <span class="hljs-string"><span class="hljs-string">"00000000000000000000"</span></span> + howMuchBoil + <span class="hljs-string"><span class="hljs-string">"0000aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) statusStr = child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) answer = statusStr.split()[<span class="hljs-number"><span class="hljs-number">3</span></span>] child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Mode paramètres: 00 - ébullition, 01 - chauffage à température, 03 - veilleuse.  Le paramètre temp est la température hexadécimale à laquelle il est nécessaire de chauffer en mode «chauffage», en mode ébullition, il est 00. Le paramètre howMuchBoil est la durée de la bouilloire après avoir atteint la température souhaitée, la valeur par défaut est 80 en hexadécimal (apparemment, ce sont des unités relatives , certainement pas quelques secondes). <br><br>  Exemple de réponse: <br><blockquote>  valeur: 55 05 05 01 aa </blockquote>  Le quatrième octet de la réponse indique la réussite des réglages: 01 - réussi, 00 - échoué. <br></li><li>  <b>Exécuter le mode de fonctionnement actuel</b> <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"03aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) statusStr = self.child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) answer = statusStr.split()[<span class="hljs-number"><span class="hljs-number">3</span></span>] child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Exemple de réponse: <br><blockquote>  valeur: 55 06 03 01 aa </blockquote>  Le quatrième octet de la réponse indique le succès de l'inclusion: 01 - réussi, 00 - non réussi. <br></li><li>  <b>Arrêter le mode de fonctionnement actuel</b> <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"04aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) statusStr = self.child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) answer = statusStr.split()[<span class="hljs-number"><span class="hljs-number">3</span></span>] child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Exemple de réponse: <br><blockquote>  valeur: 55 07 04 01 aa </blockquote>  Le quatrième octet de la réponse indique la réussite de l'arrêt: 01 - avec succès, 00 - sans succès. <br></li><li>  <b>Afficher la température actuelle en couleur au repos</b> <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"37c8c8"</span></span> + onoff + <span class="hljs-string"><span class="hljs-string">"aa"</span></span>) <span class="hljs-comment"><span class="hljs-comment"># 00 - off, 01 - on child.expect("value: ") child.expect("\r\n") child.expect(r'\[LE\]&gt;')</span></span></code> </pre> <br>  Le paramètre onoff est soit 01 pour activer la fonction, soit 00 pour désactiver la fonction. <br><br>  Exemple de réponse: <br><blockquote>  valeur: 55 08 37 00 aa </blockquote>  Dans toutes mes expériences, la réponse a toujours été la suivante. <br></li><li>  <b>Enregistrer une palette de couleurs de différents modes de fonctionnement</b> <br>  Une palette de correspondance entre la couleur de la LED et la température est réglée dans le mode d'affichage de la température actuelle et des modes de chauffage et d'ébullition, ainsi que la palette de couleurs dans le mode veilleuse. <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"32"</span></span> + boilOrLight + scale_from + rand + rgb1 + scale_mid + rand + rgb_mid + scale_to + rand + rgb2 + <span class="hljs-string"><span class="hljs-string">"aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Le paramètre boilOrLight est 00 si nous réglons le mode d'affichage de la température actuelle ou 01 si nous réglons le mode nuit.  Le paramètre scale_from indique le début de la plage de changement de couleur et est égal à 00 en mode veilleuse et 28 en mode d'affichage de la température actuelle (28 est 40 au format décimal et c'est à partir de cette température qu'un changement de couleur en douceur va commencer).  Le paramètre scale_mid est le milieu de la plage et est 32 en mode veilleuse et 46 en mode d'affichage de la température actuelle.  Le paramètre scale_to indique la fin de la gamme de couleurs et vaut 64 dans les deux modes.  Le paramètre rgb1 est la couleur hexadécimale du début de la palette.  Le paramètre rgb_mid est la couleur hexadécimale du milieu de la palette (je le calcule comme le milieu entre les extrémités gauche et droite, mais théoriquement, vous pouvez spécifier n'importe quelle couleur, cela n'affectera que la beauté et la douceur du changement de couleur).  Le paramètre rgb2 est la couleur hexadécimale de la fin de la palette.  Le paramètre rand est un certain paramètre, dont je n'ai pas compris la valeur exactement, peut-être en quelque sorte lié à la luminosité de la couleur (exemples de valeurs: e5, cc). <br><br>  Exemple de réponse: <br><blockquote>  valeur: 55 09 32 00 aa </blockquote>  Dans toutes mes expériences, la réponse a toujours été la suivante. <br></li><li>  <b>Lisez la palette de couleurs des différents modes de fonctionnement</b> <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"33"</span></span> + boilOrLight + <span class="hljs-string"><span class="hljs-string">"aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) statusStr = self.child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Le paramètre boilOrLight peut être 00 - si nous réglons le mode d'affichage de la température actuelle ou 01 - si nous réglons le mode nuit. <br><br>  Exemple de réponse: <br><blockquote>  valeur: 55 10 33 01 00 7f 00 00 ff 32 7f 00 ff 00 64 7f ff 00 00 aa </blockquote>  Ici, les sixième, onzième et seizième octets (7f) sont le paramètre rand de l'élément 12. Le cinquième octet est scale_from, le dixième octet est scale_mid, le quinzième octet est scale_to.  Les septième + huitième + neuvième octets sont rgb_from.  Les douzième + treizième + quatorzième octets sont rgb_mid.  Dix-septième + dix-huitième + dix-neuvième octets - rgb_to. <br></li></ol><br><h3>  Conclusion </h3><br>  Si gatttool ne veut pas se connecter à la théière (c'est possible la première fois que vous vous connectez à des périphériques inconnus), essayez de rechercher la théière en utilisant os avant de connecter le module: <br><br><pre> <code class="bash hljs">sudo hciconfig device reset sudo timeout 1 hcitool lescan</code> </pre> <br><br>  appareil - identifiant de votre appareil Bluetooth (par exemple, hci0).  Assurez-vous que l'adresse du pavot de votre bouilloire est dans la liste des appareils trouvés.  Après cela: <br><br><pre> <code class="bash hljs">sudo hcitool lewladd mac sudo hcitool lerladd mac</code> </pre> <br><br>  mac - l'adresse du pavot de votre théière <br><br>  <b>UPD6</b> : amélioration significative du module bouilloire: <br>  1. Transféré le module de la plateforme en mode d'intégration <br>  2. Après l'ajout, vous aurez automatiquement 3 éléments: un chauffe-eau (température actuelle, température cible, ébullition et chauffage), un capteur (temps de synchronisation, énergie dépensée, heures de fonctionnement, nombre de démarrages) et la lumière (peut être utilisée comme lampe de nuit et choisir n'importe quelle couleur rétro-éclairage) <br>  3. Le module est maintenant disponible sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">GitHub</a> . <br>  4. Le module prend en charge l'installation via <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">HACS</a> <br>  5. Exemple de configuration: <br><pre> <code class="plaintext hljs">r4s_kettler: device: 'hci0' mac: 'FF:FF:FF:FF:FF:FF' password: 'ffffffffffffffff'</code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Captures d'écran de la nouvelle version</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/8j/gc/th/8jgcthd3i8cff7ebzchka-rsdyc.jpeg" alt="image"><br><img src="https://habrastorage.org/webt/bk/m7/yn/bkm7ynlfqahggnahmhfpbjb3ghe.jpeg" alt="image"><br><img src="https://habrastorage.org/webt/uk/wg/ve/ukwgvelc6s_evw1zzucwu_gly4w.jpeg" alt="image"><br><img src="https://habrastorage.org/webt/hj/wl/ft/hjwlft8f2k7yv1qjafxn2iqtcay.jpeg" alt="image"><br></div></div><br><br>  <b>UPD7</b> : informations non pertinentes <b>supprimées</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr412583/">https://habr.com/ru/post/fr412583/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr412571/index.html">Histoires de réussite de Kubernetes en production. Partie 9: Clusters CERN et 210 K8s</a></li>
<li><a href="../fr412573/index.html">Ce qui ne va pas avec le retour des Geektimes à Habr</a></li>
<li><a href="../fr412575/index.html">Chaque année, la musique pop devient de plus en plus monotone, car les mêmes personnes la composent</a></li>
<li><a href="../fr412579/index.html">Marvel: Infinity War ou Comment collecter des données pour votre projet en quelques minutes</a></li>
<li><a href="../fr412581/index.html">De l'âge de pierre à la Seconde Guerre mondiale: comment les robots sont utilisés pour rechercher des artefacts historiques</a></li>
<li><a href="../fr412587/index.html">Marionnette + Hiera. Pressez le maximum</a></li>
<li><a href="../fr412589/index.html">25 bibliothèques Android divertissantes. Printemps 2018</a></li>
<li><a href="../fr412591/index.html">Construire un jetpack: le 29 mai est le Memorial Day de Wendell Moore</a></li>
<li><a href="../fr412593/index.html">Nouveaux produits, plates-formes et tout-en-un: Webinaires HPE</a></li>
<li><a href="../fr412595/index.html">Rapport 2018 du Club de Rome, chapitre 1.1.2: «Financement»</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>