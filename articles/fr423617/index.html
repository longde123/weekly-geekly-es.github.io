<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßîüèæ üíé ‚ú¥Ô∏è Utilisation d'une batterie d'iPhone pour concevoir des appareils √©lectroniques portables üò∏ üë®üèΩ‚Äçüé® üíá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salutations, lecteur. 

 Tr√®s souvent, j'ai pour t√¢che de d√©velopper des appareils portables aliment√©s par une batterie Li-ion monocellulaire. Et, si ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Utilisation d'une batterie d'iPhone pour concevoir des appareils √©lectroniques portables</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423617/">  Salutations, lecteur. <br><br>  Tr√®s souvent, j'ai pour t√¢che de d√©velopper des appareils portables aliment√©s par une batterie Li-ion monocellulaire.  Et, si ce n'est g√©n√©ralement pas une pr√©occupation pour le client, alors, en tant qu'ing√©nieur exp√©riment√©, un frisson me traverse le dos quand je vois un tel savoir traditionnel.  Cela est d√ª au fait que l'√©valuation du niveau de la batterie, ainsi que la dur√©e de vie restante de la batterie, est une t√¢che tr√®s difficile, m√™me si √† premi√®re vue, cela peut sembler diff√©rent. <br><br><img src="https://habrastorage.org/webt/ws/kh/og/wskhog7wo9xnqs6b3-perfg2zpe.png"><br><br>  Il existe plusieurs options d'action dans ce cas, nous en parlerons ci-dessous. <br><a name="habracut"></a><br>  <b>-</b> Le plus simple est de ne rien faire pour d√©terminer le niveau de charge de la batterie.  Le circuit de charge sur une simple m√©moire lin√©aire (par exemple sur TP4054) et un convertisseur de tension pour alimenter l'appareil.  S'√©teint sans avertissement et au moment le plus inopportun. <br><br>  <b>-</b> Mesurer la tension de la batterie.  Le r√©sultat est √† peu pr√®s le m√™me que le paragraphe pr√©c√©dent, mais n√©cessite plus d'efforts.  Sch√©ma de mesure typique: <br><br><img src="https://habrastorage.org/webt/0g/ff/3y/0gff3ybn_7u0r95qrs7zinzrhr4.png"><br><br>  Il s'agit en fait d'un diviseur de tension pour les r√©sistances R19 et R21, connect√© via une cl√© VT6.  Le transistor VT7 est n√©cessaire pour √©liminer la puissance parasite du MK via la borne EN. <br>  VBAT - tension de la batterie <br>  VBAT_mes - tension arrivant √† l'ADC <br>  FR - signal de commande du diviseur (0-off, 1-on) <br><br>  Maintenant que nous connaissons la tension de la batterie, nous sommes de bons amis.  MAIS √ßa ne donne presque rien !!!  Le fait est qu'une courbe de d√©charge typique d'une batterie Li-ion, pour le moins, n'est pas lin√©aire et d√©pend de la consommation actuelle et de la temp√©rature de la batterie elle-m√™me: <br><br><img src="https://habrastorage.org/webt/i7/gz/d1/i7gzd1gllelpirlcxygnosgkody.gif"><br><br>  En regardant ces graphiques, pouvez-vous indiquer quelle est la capacit√© restante de la batterie √† une tension de 3,5 V?  Je pense que non ... <br><br>  Cette m√©thode peut √™tre am√©lior√©e un peu en utilisant le capteur de temp√©rature int√©gr√© dans le MC pour une estimation approximative de la temp√©rature de la batterie, ou vous pouvez soit mettre un capteur pour mesurer le courant, soit (si le courant de consommation est approximativement constant) construire une courbe de d√©charge pour une consommation de courant typique.  Cela permettra au moins une petite justification des co√ªts de main-d'≈ìuvre, mais il ne peut √™tre question d'aucune pr√©cision.  Pour indiquer la charge sur 3 LED - oui, ce sera le cas. <br><br>  Dans le cas d'une consommation de courant constante, vous pouvez prendre la dur√©e de vie de la batterie et estimer la charge consomm√©e et le temps consacr√© √† la charge pour √©valuer la charge accumul√©e.  Cette m√©thode donne une erreur cumulative, car l'√©talonnage ne peut se faire qu'en deux points (pleine charge ou d√©charge compl√®te), et ils ne sont pas toujours atteints.  De plus, √† mesure que la batterie se d√©t√©riore, la dur√©e de fonctionnement maximale doit √™tre ajust√©e, mais en g√©n√©ral, la m√©thode a droit √† la vie. <br><br>  <b>-</b> Cr√©ez votre propre syst√®me de surveillance de la charge de la batterie (BMS).  Pour sa mise en ≈ìuvre, nous avons besoin de capteurs de courant, de temp√©rature et de tension de batterie.  Nous pensons que MK existe d√©j√† dans l'appareil et il ne reste ¬´que¬ª √† √©crire des logiciels pour cela, ce qui m'a pris un peu moins d'un an. <br><br>  <b>-</b> Prenez la puce de jauge de gaz finie (par exemple, de TI ou Maxim Integrated), configurez-la, calibrez et travaillez.  Par exemple, le diagramme pour bq27220: <br><br><img src="https://habrastorage.org/webt/ob/c6/sk/obc6skpnnbt-w_ikd611wqplbhc.png"><br><br>  Il existe plusieurs nuances lors du choix de ce concept: <br><br><ol><li>  Dans le cas o√π la batterie est amovible, vous devez soit mettre le circuit pour d√©terminer la charge de la batterie elle-m√™me (sinon elle sera remise √† z√©ro une fois d√©connect√©e), soit utiliser des versions sp√©ciales de la jauge √† gaz qui permettent la d√©connexion de la batterie.  Dans le premier cas, la batterie de votre appareil devient unique et son remplacement n'est possible qu'avec votre participation, ce qui n'est pas toujours pratique.  Dans le second cas, il y a le probl√®me de placer le capteur de temp√©rature sur la batterie. </li><li>  Solution co√ªteuse.  Composants principaux: puce de jauge de gaz, puce de protection, transistors, thermistance, r√©sistance de capteur de courant. </li></ol><br>  <b>-</b> Utilisez des options plus simples pour des solutions cl√© en main comme CW2015: <br><br><img src="https://habrastorage.org/webt/qa/wh/fp/qawhfpgzcdscvtnrgh4jcgw0evq.png"><br><br>  Il s'agit de l'analogue chinois de la puce MAX17048.  Une puce absolument simple sans capteurs de temp√©rature et de courant, avec une faible pr√©cision correspondante, mais en m√™me temps bon march√©, facile √† utiliser et √† programmer.  Il a la possibilit√© de travailler sur le c√¥t√© de l'appareil, ce qui permet de ne pas modifier la batterie elle-m√™me.  Le microcircuit a √©t√© trouv√© sur les espaces ouverts du r√©seau en train d'√©crire du mat√©riel, il n'y a pas d'exp√©rience, mais il y a une envie de l'essayer, car l'option est vraiment int√©ressante.  Peut-√™tre que dans le prochain article je parlerai plus en d√©tail de cette puce. <br><br>  <b>-</b> Et enfin, la derni√®re m√©thode que je connais que je veux consacrer √† l'article d'aujourd'hui.  √Ä mon avis, cette m√©thode est la plus simple, mais donne le meilleur r√©sultat.  Il consiste dans le fait que nous prenons une batterie iPhone avec jauge de gaz int√©gr√©e et protection, nous connectons via HDQ ou I2C, interrogons et travaillons.  Dans ce cas, la batterie est d√©j√† assembl√©e et calibr√©e.  Voici un tableau avec les options de batterie que je connais: <br><br><img src="https://habrastorage.org/webt/rg/v-/ug/rgv-uggse_y-oethz2ppdzrtb_a.png"><br><br>  Le tableau est partiellement extrait des sites <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ripitapart.com</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.macplus.ru</a> .  Veuillez pr√™ter une attention particuli√®re au contr√¥leur inconnu marqu√© A1141.  Cette puce est fabriqu√©e par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PowerFlash</a> et ce sont toutes les informations qui pourraient √™tre trouv√©es.  L'auteur du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">blog √†</a> partir duquel j'ai pris la table n'√©tait pas s√ªr d'avoir obtenu la batterie d'origine de l'iPhone SE.  Gr√¢ce au rappel de <b>asterix_tyumen</b> , qui a d√©mont√© la batterie d'origine de SE, il a √©t√© constat√© qu'il en co√ªte sn27545.  Ci-dessous, nous serons oblig√©s d'examiner plus en d√©tail l'A1141.  Mais pour l'instant, regardons les batteries: <br><br><img src="https://habrastorage.org/webt/fc/lc/4l/fclc4lpb7ypo6w4vudjrg79zqko.png"><br><br>  Comme vous pouvez le voir, la batterie pour tous les go√ªts et couleurs, avec et sans pomme.  Ils peuvent √©galement √™tre connect√©s en parall√®le pour augmenter la capacit√©, avec une interrogation s√©par√©e.  Parmi les lacunes, il convient de noter que le rapport longueur / largeur est d'environ 3: 1, ce qui n'est pas toujours pratique, ainsi qu'un connecteur unique pour la connexion.  En raison de la popularit√© des t√©l√©phones Apple, ces batteries peuvent √™tre achet√©es en toute s√©curit√© dans de nombreux endroits et en grandes quantit√©s (il s'est av√©r√© que ce n'est pas enti√®rement vrai). <br><br>  Lors du d√©veloppement d'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lecteur RFID autonome sans fil,</a> nous avons choisi cette voie. <br><br><img src="https://habrastorage.org/webt/cp/hq/vh/cphqvhsqgrbt586x74tk4q3-xty.jpeg"><br><br>  La batterie de l'iPhone 6 a √©t√© choisie, ce qui nous convenait en termes de capacit√© et de taille.  Plusieurs exemplaires ont √©t√© achet√©s √† divers endroits pour v√©rification: <br><br><img src="https://habrastorage.org/webt/fk/vu/fj/fkvufjecvn19x89jigbrv776zfu.jpeg"><br><br>  Le bon a √©t√© achet√© en Chine, le reste √† Moscou.  Le co√ªt est de 6 √† 11 $.  Lorsqu'elles sont v√©rifi√©es, des r√©sultats plut√¥t int√©ressants seront obtenus.  Portez une attention particuli√®re √† la bo√Æte avec l'inscription "Orig", nous y reviendrons plus tard.  La v√©rification a √©t√© effectu√©e √† l'aide du lecteur RFID lui-m√™me, du programmateur TI EV2300 et de Battery Management Studio. <br><br>  Le circuit d'alimentation du lecteur RFID est repr√©sent√© sur la figure: <br><br><img src="https://habrastorage.org/webt/qo/6x/sx/qo6xsxtbahocxjy_psg6ufypuxk.png"><br><br>  M√©moire lin√©aire bas√©e sur STC4054 (TP4054), courant de charge 500 mA, interrupteur d'alimentation √† auto-s√©lection bas√© sur le commutateur Reed SF1, condensateur C19, diode VD4 et r√©sistance R15, ainsi qu'un convertisseur d'impulsions bas√© sur NCP1529. <br><br>  Le premier j'ai connect√© une copie de Chine pour 6 $: <br><br><img src="https://habrastorage.org/webt/nb/qx/pj/nbqxpjz_o9zlq-p6w5vbsafunvo.png"><br><br>  La batterie r√©pond, MAIS le courant n'a √©t√© affich√© ni pendant la charge ni pendant la d√©charge, la tension ne correspondait pas √† ce qui a √©t√© r√©ellement mesur√© et le degr√© de charge n'a pas chang√©.  La batterie n'a pas r√©pondu aux commandes.  Il y avait une supposition que cette instance √©tait un faux, alors j'en ai retir√© un ruban de protection pour regarder le tableau: <br><br><img src="https://habrastorage.org/webt/d7/u1/bt/d7u1btz9c2lmev89z_meth6c1li.jpeg"><br><br>  C'est un virage ... Je n'ai m√™me pas redessin√© le circuit - ici, il est clair qu'il y a un √©mulateur bq27545 et un circuit de protection contre les surcharges / surcharges.  Imm√©diatement, il y a eu une id√©e pour gagner du temps et ouvrir toutes les batteries. <br><br><img src="https://habrastorage.org/webt/nw/es/uv/nwesuvggds1wjz4xkcp-hix4n1s.jpeg"><br><br>  Le voisin √† gauche du coll√®gue chinois pour 8 $ est similaire √† la diff√©rence de marquage sur les jetons.  Le reste se comporte de la m√™me mani√®re.  Ces 2 exemplaires sont imm√©diatement √† la poubelle.  Malheureusement, je n'avais pas l'iPhone 6 √† port√©e de main pour v√©rifier ces batteries dans l'appareil cible, c'√©tait tr√®s int√©ressant de voir comment le t√©l√©phone se comporterait lorsqu'il fonctionnerait avec ces batteries. <br><br><img src="https://habrastorage.org/webt/ft/c5/v9/ftc5v9rgjn6dgcrau78bdndqccg.jpeg"><br><br>  Et ceci est une batterie centrale, co√ªtant 8 $.  Il a m√™me un capteur de courant et une sorte de microcircuit √† 8 broches avec un modeste marquage 6G3.  Dans Battery Management Studio, cette batterie pr√©tend √™tre le bq27545 plus habilement.  Le niveau de charge, la tension correcte, le courant de la batterie sont affich√©s.  Mais si tout cela √©tait r√©el, le faux ne serait pas un faux.  En r√©alit√©, la temp√©rature √©tait r√©gl√©e par une constante, le courant √©tait tr√®s mal mesur√©.  L'image montre la consommation actuelle du lecteur RFID, qui est mesur√©e par la batterie avec une lecture constante de la carte. <br><br><img src="https://habrastorage.org/webt/ze/tf/tl/zetftlpv8pt7ajm0rzslb9kn-tq.png"><br><br>  En r√©alit√©, elle s'√©l√®ve √† ~ 55 mA pour un tel mode de fonctionnement, et comme le champ lecteur est toujours allum√©, il ne peut pas √™tre nul.  Lors de la charge (lorsque le courant est constant sur une longue p√©riode de temps), le capteur de courant fonctionne correctement.  Naturellement, tous les autres param√®tres sont calcul√©s de mani√®re incorrecte (niveau de charge, dur√©e de fonctionnement jusqu'√† d√©charge compl√®te, etc.).  L'indicateur FC (charge compl√®te) est r√©gl√© sur 4,4 V. <br><br><img src="https://habrastorage.org/webt/j7/g_/dw/j7g_dwkhejdguxcchvr-schljyu.png"><br><br>  La batterie ne r√©pond pas aux commandes, les drapeaux QEN et RUP_DIS ne sont pas d√©finis.  En g√©n√©ral, il s'agit d'une tentative infructueuse des Chinois d'√©crire l'astuce bq27545 sur MK (en tout cas, je pense que oui).  Toujours √† la poubelle. <br><br>  Rappelez-vous, j'ai demand√© de porter une attention particuli√®re √† la copie dans la bo√Æte avec l'inscription "Orig"?  C'est lui qui s'est av√©r√© le plus proche possible de ce que nous recherchions (et comment ne pas croire la publicit√© maintenant?): <br><br><img src="https://habrastorage.org/webt/hg/oj/3d/hgoj3d1hpv0omsd1n427kc-wjl0.jpeg"><br><br>  Son co√ªt √©tait de 9 $.  Au centre, vous pouvez clairement voir la puce √©tiquet√©e SN27545 - c'est exactement ce que nous recherchions.  Avec cette instance, j'ai commenc√© √† travailler plus √©troitement.  Pendant le cycle d'essai de charge-d√©charge, des probl√®mes sont survenus.  Je n'ai pas pu obtenir le fanion FC (charge compl√®te), ce qui signifiait la fin du processus de charge.  Le courant de charge √† une tension de batterie proche de 4,2 V est devenu extr√™mement faible (environ 20 mA) et le processus de charge mena√ßait de ne jamais s'arr√™ter.  L'une des raisons possibles √©tait un c√¢ble USB avec une forte chute de tension (4,5 V a atteint la puce de m√©moire), nous l'avons remplac√© par un meilleur avec une chute de tension plus faible.  Les indicateurs se sont am√©lior√©s, la batterie charg√©e √† 4,2 V, le courant est tomb√© √† 0, mais le SOC (√©tat de charge - niveau de charge) n'a atteint que 85, de sorte que le drapeau FC n'a pas √©t√© d√©fini. <br><br><img src="https://habrastorage.org/webt/wi/yj/vk/wiyjvks7vaannnb1-rsbribojxm.png"><br><br>  Pendant plusieurs jours, j'ai conduit des cycles dans l'espoir que la batterie apprenne, mais cela n'a pas aid√©.  Le probl√®me s'est av√©r√© banal, mais sa recherche a pris 2 jours.  √Ä un moment donn√©, j'ai remarqu√© que la batterie √©tait de 4,35 V et c'√©tait la r√©ponse √† toutes les questions.  La m√©moire est standard √† 4,2V et je n'ai pas du tout remarqu√© que la batterie est √† 4,35V et qu'il y a une charge incompl√®te.  Les cartes √©tant d√©j√† fabriqu√©es, le seul moyen de sortir de la situation √©tait de chercher un remplacement pour le STC4054 avec une tension de 4,35V.  Il s'est av√©r√© que de tels microcircuits existent, mais vous ne pouvez pas les acheter dans notre grand pays (apparemment, ils sont compl√®tement impopulaires du mot).  Par cons√©quent, la version MCP73832T-3 a √©t√© command√©e avec quelques semaines d'attente. <br><br>  En attendant, les man√®ges command√©s, nous allons faire un patch de ferme collective pour v√©rifier le concept.  Pour ce faire, faites une "sauvegarde" de 0,15V pour la puce m√©moire √† l'aide d'une diode: <br><br><img src="https://habrastorage.org/webt/8s/ft/mi/8sftmi64vw_xtce2htduhh_gt44.png"><br><br>  Je dois admettre que la ferme collective a fonctionn√©, le drapeau FC a √©t√© r√©gl√©, tout fonctionne, mais la tension finale de la batterie est de 4,4 V (la baisse de la diode est sup√©rieure √† la 0,15 V requise). <br><br><img src="https://habrastorage.org/webt/wx/hb/aa/wxhbaaplpa9gagt0vpls28kzirk.png"><br><br>  Il est important de noter qu'il est possible de charger jusqu'√† 4,2 V avec une perte correspondante de ~ 15% de la capacit√©, tout en prolongeant consid√©rablement la dur√©e de vie de la batterie.  Nous avons termin√© la copie d'Orig - elle peut √™tre mise en d√©veloppement en toute s√©curit√©. <br><br>  Le dernier exemplaire est laiss√©.  Le plus cher (11 $), dans l'emballage le plus cool et n√©cessitant le plus de temps pour lui-m√™me.  Nous regardons √† l'int√©rieur: <br><br><img src="https://habrastorage.org/webt/ex/r-/kz/exr-kzemael4n2lpvhewzuq4-hm.jpeg"><br><br>  Il s'agit ici d'une puce A1141 inconnue pour laquelle il n'y a pas de documentation autre que la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">page constructeur</a> .  Connexion forc√©e quant au bq27545 dans Battery Management Studio, nous voyons l'image suivante: <br><br><img src="https://habrastorage.org/webt/cv/eq/fb/cveqfbcfpdguby-7cawqy06sivg.png"><br><br>  Poubelle pleine.  Lorsque vous essayez de charger avec un courant de ~ 500 mA, il affiche 125 mA, tandis que lors de la d√©charge avec un courant de ~ 25 mA, il affiche 214 mA.  Il est clair que si l'A1141 a des adresses de param√®tres diff√©rentes ou un format de stockage de donn√©es diff√©rent de celui du bq27545, rien ne brille sans documentation avec cette batterie.  Par cons√©quent, il a √©t√© mis de c√¥t√©, mais √† la fin de la r√©daction du mat√©riel, j'ai d√©cid√© de le relier √† nouveau.  J'ai pris la table de commande de la puce bq27545: <br><br><img src="https://habrastorage.org/webt/le/d2/bk/led2bk_-eatwxsizt2gdrnd8sly.png"><br><br>  Et j'ai lu les registres de tension (0x08 et 0x09) via le menu Advanced Comm: <br><br><img src="https://habrastorage.org/webt/kc/cl/9o/kccl9oh1im7n8upg5i9im3y8hoi.png"><br><br>  Obtenez 0x10 &lt;&lt; 8 |  0x38 = 4152 ou 4,152 V, ce qui correspond √† une tension de 4,15 V mesur√©e par un multim√®tre.  Donc si les donn√©es sont correctes, pourquoi 57mV est-il affich√© dans le programme ???  Nous remarquons que 57mV est exactement 0x38, c'est-√†-dire que la valeur est le registre 0x08.  Avec une tension de 4,152 V sur la batterie, le niveau de charge de 96% semble tout √† fait correct; vous pouvez l'obtenir en lisant les registres 0x2c et 0x2d.  Lire 0x2c = 0x60, 0x2d = 0 (dans le cas du param√®tre SOC, le registre le plus √©lev√© est toujours z√©ro).  Il y avait une hypoth√®se que le programme ou l'EV2300 ne peut pas lire (ou la batterie ne r√©pond pas) ni l'octet de poids fort dans la demande, ni un octet avec une adresse impaire.  Pour tester cette th√©orie, la batterie a √©t√© connect√©e directement au lecteur RFID et la batterie a √©t√© interrog√©e via le MK.  L'interface HDQ a √©t√© impl√©ment√©e selon un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">document de TI</a> .  La puce bq27545 utilise le protocole HDQ monofilaire pour communiquer avec le contr√¥leur de contr√¥le, qui sur le STM32 est assez facilement impl√©ment√© sur la base d'un UART monofilaire gr√¢ce √† la prise en charge du mode Half Duplex. <br><br>  Parce que  notre lecteur RFID fonctionne sur MicroPython, nous avons encapsul√© le travail avec HDQ dans une classe et obtenu le travail avec le contr√¥leur de charge sous la forme suivante: <br><br>  depuis hdq import HDQ <br>  bat = HDQ (pyb.UART (1)) <br>  bat.charge () # charge <br>  bat.read_u16 (0x14) # registre arbitraire <br><br>  En fait, il s'est av√©r√© que A1141 ne r√©pond pas √† une demande de lecture d'octets avec des adresses impaires. <br><img src="https://habrastorage.org/webt/wa/lo/jr/walojrft1ezmjmrguuotfjfjl5i.png"><br>  La forme d'onde montre qu'il y a une demande, mais aucune r√©ponse.  Quand ils ont ajout√© un red√©marrage de la logique d'√©change de donn√©es (Break) avant chaque demande - une fois sur deux, mais le microcircuit a commenc√© √† r√©pondre correctement. <br><br><img src="https://habrastorage.org/webt/t6/ht/oi/t6htoivlgn1nng-zodal_-hqbl4.png"><br><br>  Ensuite, nous avons compar√© le taux de change de l'EV2300 et la RFID du lecteur et il s'est av√©r√© que l'EV2300 utilise une vitesse de 10 √† 15% inf√©rieure √† celle des ensembles TI: <br><br><img src="https://habrastorage.org/webt/22/je/07/22je07teuaf7b5t0ppbkjf5zroy.png"><br><br>  Apr√®s avoir ralenti le HDQ et termin√© Break, la batterie a fonctionn√© normalement √† chaque demande!  Les principaux param√®tres de la batterie ont √©t√© lus: <br><br><img src="https://habrastorage.org/webt/jg/fu/r5/jgfur5j37kq31_df2x5oyci0lxe.png"><br><br>  Victoire compl√®te!  En fait, A1141 s'est av√©r√© √™tre un clone de haute qualit√© de bq27545 avec des d√©fauts mineurs.  Il reste √† parler des nuances du travail avec la batterie du c√¥t√© logiciel (en utilisant les modes veille, le courant de r√©veil, etc.), mais cela doublera la quantit√© d'enregistrement et, peut-√™tre, je l'√©crirai une autre fois. <br><br><h4>  Conclusions </h4><br>  Comme vous pouvez le voir, il existe de nombreuses options pour d√©velopper des appareils aliment√©s par des batteries Li-ion.  Honn√™tement, il √©tait initialement pr√©vu d'√©crire du mat√©riel dans le style de venu, vu, gagn√©, mais dans le processus, beaucoup de nuances sont apparues (la lutte avec A1141 est particuli√®rement bonne) et le mat√©riel s'est av√©r√© tr√®s int√©ressant et √©tendu.  Sur les 5 batteries, seulement 2 en fait peuvent √™tre utilis√©es normalement.  Par cons√©quent, le choix du fournisseur dans ce cas est tr√®s pertinent.  Si vous avez vu la batterie d'autres appareils contenant du BMS, √©crivez le mod√®le dans les commentaires.  Merci √† tous pour votre attention! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr423617/">https://habr.com/ru/post/fr423617/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr423603/index.html">RxSwift partie 1</a></li>
<li><a href="../fr423607/index.html">Linus Torvalds abandonne le style dur et prend du temps</a></li>
<li><a href="../fr423609/index.html">O√π vont les sites Web apr√®s la mort? Exp√©rience personnelle</a></li>
<li><a href="../fr423611/index.html">Paiement en un clic - bon ou mauvais?</a></li>
<li><a href="../fr423615/index.html">Comp√©tences professionnelles exig√©es des sp√©cialistes UX (tranche 2018)</a></li>
<li><a href="../fr423619/index.html">¬´J'ai l'intention d'acheter¬ª ou la fa√ßon la plus simple d'√©valuer la qualit√© d'une recherche d'√©picerie</a></li>
<li><a href="../fr423621/index.html">Comment sont les premi√®res ann√©es de la r√©volution des robots</a></li>
<li><a href="../fr423623/index.html">G√©rer pour un geek: pourquoi les compter?</a></li>
<li><a href="../fr423625/index.html">Rencontrez le premier touriste de la lune</a></li>
<li><a href="../fr423627/index.html">Venez apprendre l'administration classique: r√©glementations, outils, scripts Southbridge</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>