<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé† üîØ üë®‚ÄçüöÄ Exce√ß√µes [DotNetBook]: arquitetura de sistema de tipos ‚úåüèª üå≤ ‚õ©Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Com este artigo, continuo publicando uma s√©rie de artigos, cujo resultado ser√° um livro sobre o trabalho do .NET CLR e .NET em geral. Para links - bem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Exce√ß√µes [DotNetBook]: arquitetura de sistema de tipos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/clrium/blog/419927/"><p><img width="350" src="https://habrastorage.org/webt/vh/7j/tq/vh7jtqhzbne4h3rjhprca2pruhu.png" align="left">  Com este artigo, continuo publicando uma s√©rie de artigos, cujo resultado ser√° um livro sobre o trabalho do .NET CLR e .NET em geral.  Para links - bem-vindo ao gato. </p><br><h2 id="arhitektura-isklyuchitelnoy-situacii">  Arquitetura de exce√ß√£o </h2><br><p> Provavelmente, um dos problemas mais importantes em rela√ß√£o ao t√≥pico de exce√ß√µes √© o problema da constru√ß√£o de uma arquitetura de exce√ß√µes em seu aplicativo.  Esta quest√£o √© interessante por v√°rias raz√µes.  Quanto a mim, o principal √© a aparente simplicidade com a qual nem sempre √© √≥bvio o que fazer.  Essa propriedade √© inerente a todas as constru√ß√µes b√°sicas usadas em qualquer lugar: √© <code>IEnumerable</code> , <code>IDisposable</code> e <code>IObservable</code> entre outras.  Por um lado, eles acenam pela sua simplicidade, envolvendo-se no uso de si mesmos em v√°rias situa√ß√µes.  E, por outro lado, eles est√£o cheios de banheiras de hidromassagem e vaus, dos quais, sem saber √†s vezes nem sair.  E, talvez, olhando para o volume futuro, sua pergunta tenha amadurecido: ent√£o, o que √© isso em situa√ß√µes excepcionais? </p><br><blockquote><h3>  Nota </h3><br>  O cap√≠tulo publicado em Habr√© n√£o √© atualizado e, provavelmente, j√° est√° um pouco desatualizado.  E, portanto, consulte o original para obter textos mais recentes: <br><br><ul><li><img src="https://habrastorage.org/webt/3q/6g/qa/3q6gqaz40qx-jzscjf3jbxatxhg.png">  Livro do CLR: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub, sum√°rio</a> </li><li><img src="https://habrastorage.org/webt/3q/6g/qa/3q6gqaz40qx-jzscjf3jbxatxhg.png">  Livro do CLR: <a href="">GitHub, cap√≠tulo</a> </li><li><img src="https://habrastorage.org/webt/eo/6g/eo/eo6geog0tg5ernqmv2lcmufefta.png">  Livros da vers√£o 0.5.2, PDF: <a href="">GitHub Release</a> </li></ul><br></blockquote><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/97f/1d3/cf0/97f1d3cf0e2a6bf007066eb60a789c31.png"></a> </p><a name="habracut"></a><br><p>  Mas, para chegar a algumas conclus√µes sobre a constru√ß√£o da arquitetura de classes de situa√ß√µes excepcionais, precisamos acumular alguma experi√™ncia com voc√™ em rela√ß√£o √† sua classifica√ß√£o.  Afinal, apenas tendo entendido com o que lidaremos, como e em que situa√ß√µes o programador deve escolher o tipo de erro e em que - fa√ßa a escolha em rela√ß√£o √† captura ou igni√ß√£o de exce√ß√µes, √© poss√≠vel entender como √© poss√≠vel criar um sistema de tipos de maneira que fique √≥bvio para o seu c√≥digo.  Portanto, tentaremos classificar situa√ß√µes excepcionais (n√£o os tipos de exce√ß√µes em si, mas precisamente as situa√ß√µes) de acordo com v√°rios crit√©rios. </p><br><h3 id="po-teoreticheskoy-vozmozhnosti-perehvata-proektiruemogo-isklyucheniya">  De acordo com a possibilidade te√≥rica de capturar a exce√ß√£o projetada </h3><br><p>  Em termos de intercepta√ß√£o te√≥rica, as exce√ß√µes podem ser facilmente divididas em dois tipos: aquelas que interceptam com precis√£o e aquelas com alta probabilidade de intercepta√ß√£o.  Por que <em>com um alto grau de probabilidade</em> ?  Porque sempre haver√° algu√©m que tentar√° interceptar, embora isso n√£o tenha que ser completamente feito. </p><br><p>  Vamos primeiro revelar as caracter√≠sticas do primeiro grupo: exce√ß√µes que devem e ser√£o capturadas. </p><br><p>  Quando introduzimos uma exce√ß√£o desse tipo, por um lado, informamos ao subsistema externo que estamos em uma posi√ß√£o em que outras a√ß√µes em nossos dados n√£o fazem sentido.  Por outro lado, queremos dizer que nada global foi quebrado e, se formos removidos, nada mudar√° e, portanto, essa exce√ß√£o pode ser facilmente interceptada para melhorar a situa√ß√£o.  Essa propriedade √© muito importante: determina a criticidade do erro e a cren√ßa de que, se voc√™ capturar a exce√ß√£o e apenas limpar os recursos, poder√° executar o c√≥digo com seguran√ßa. </p><br><p>  O segundo grupo, por mais estranho que pare√ßa, √© respons√°vel por exce√ß√µes que n√£o precisam ser capturadas.  Eles s√≥ podem ser usados ‚Äã‚Äãpara gravar no log de erros, mas n√£o para corrigir a situa√ß√£o.  O exemplo mais simples s√£o as exce√ß√µes de grupo <code>ArgumentException</code> e <code>NullReferenceException</code> .  De fato, em uma situa√ß√£o normal, voc√™ n√£o deve, por exemplo, capturar a exce√ß√£o <code>ArgumentNullException</code> porque a origem do problema aqui ser√° voc√™ e n√£o mais ningu√©m.  Se voc√™ capturar essa exce√ß√£o, presume que cometeu um erro e forneceu o m√©todo ao qual n√£o poderia: </p><br><pre> <code class="plaintext hljs">void SomeMethod(object argument) { try { AnotherMethod(argument); } catch (ArgumentNullException exception) { // Log it } }</code> </pre> <br><p>  Nesse m√©todo, tentamos capturar uma <code>ArgumentNullException</code> .  Mas, na minha opini√£o, sua intercepta√ß√£o parece muito estranha: lan√ßar os argumentos corretos para o m√©todo √© inteiramente nossa preocupa√ß√£o.  N√£o seria correto reagir ap√≥s o fato: em tal situa√ß√£o, a coisa mais correta a ser feita √© verificar os dados transmitidos antecipadamente, antes de chamar o m√©todo, ou melhor ainda, construir o c√≥digo de tal maneira que simplesmente n√£o seja poss√≠vel receber par√¢metros incorretos. </p><br><p>  Outro grupo √© a elimina√ß√£o de erros fatais.  Se um determinado cache estiver quebrado e a opera√ß√£o do subsistema n√£o estiver correta em nenhum caso?  Ent√£o, este √© um erro fatal e o c√≥digo mais pr√≥ximo da pilha n√£o ser√° garantido para intercept√°-lo: </p><br><pre> <code class="plaintext hljs">T GetFromCacheOrCalculate() { try { if(_cache.TryGetValue(Key, out var result)) { return result; } else { T res = Strategy(Key); _cache[Key] = res; return res; } } catch (CacheCorreptedException exception) { RecreateCache(); return GetFromCacheOrCalculate(); } }</code> </pre> <br><p>  E permita que <code>CacheCorreptedException</code> seja uma exce√ß√£o, significando que "o cache no disco r√≠gido n√£o √© consistente".  Acontece que, se a causa de um erro desse tipo for fatal para o subsistema de armazenamento em cache (por exemplo, n√£o h√° permiss√µes para o arquivo de cache), o c√≥digo adicional se ele n√£o puder recriar o cache com o comando <code>RecreateCache</code> e, portanto, o fato de capturar essa exce√ß√£o ser√° um erro. </p><br><h3 id="po-fakticheskomu-perehvatu-isklyuchitelnoy-situacii">  Na intercepta√ß√£o real de uma exce√ß√£o </h3><br><p>  Outra quest√£o que interrompe nosso v√¥o de pensamento nos algoritmos de programa√ß√£o √© o entendimento: vale a pena capturar essas ou outras exce√ß√µes ou vale algu√©m que entende deix√°-las passar por elas.  Traduzindo para o idioma dos termos, a quest√£o que precisamos resolver √© distinguir entre √°reas de responsabilidade.  Vejamos o seguinte c√≥digo: </p><br><pre> <code class="plaintext hljs">namespace JetFinance.Strategies { public class WildStrategy : StrategyBase { private Random random = new Random(); public void PlayRussianRoulette() { if(DateTime.Now.Second == (random.Next() % 60)) { throw new StrategyException(); } } } public class StrategyException : Exception { /* .. */ } } namespace JetFinance.Investments { public class WildInvestment { WildStrategy _strategy; public WildInvestment(WildStrategy strategy) { _strategy = strategy; } public void DoSomethingWild() { ?try? { _strategy.PlayRussianRoulette(); } catch(StrategyException exception) { } } } } using JetFinance.Strategies; using JetFinance.Investments; void Main() { var foo = new WildStrategy(); var boo = new WildInvestment(foo); ?try? { boo.DoSomethingWild(); } catch(StrategyException exception) { } }</code> </pre><br><p>  Qual das duas estrat√©gias propostas est√° mais correta?  A √°rea de responsabilidade √© muito importante.  Inicialmente, pode parecer que, como o trabalho do <code>WildInvestment</code> e sua consist√™ncia depende inteiramente do <code>WildStrategy</code> , se o <code>WildInvestment</code> simplesmente ignorar essa exce√ß√£o, ele <code>WildInvestment</code> para um n√≠vel mais alto e n√£o ser√° necess√°rio fazer mais nada.  No entanto, observe que h√° um problema puramente arquitetural: o m√©todo <code>Main</code> captura uma exce√ß√£o de uma camada arquitetural, invocando um m√©todo arquiteturalmente diferente.  Como √© a apar√™ncia em termos de uso?  Sim, em geral, √© assim: </p><br><ul><li>  a preocupa√ß√£o com essa exce√ß√£o foi simplesmente superada por n√≥s; </li><li>  o usu√°rio desta classe n√£o tem certeza de que essa exce√ß√£o seja lan√ßada por v√°rios m√©todos antes de n√≥s, especificamente </li><li>  come√ßamos a atrair v√≠cios desnecess√°rios, dos quais nos livramos, causando uma camada intermedi√°ria. </li></ul><br><p>  No entanto, outra conclus√£o se segue dessa conclus√£o: devemos definir <code>catch</code> no m√©todo <code>DoSomethingWild</code> .  E isso √© um tanto estranho para n√≥s: o <code>WildInvestment</code> parece ser muito dependente de algu√©m.  I.e.  se o <code>PlayRussianRoulette</code> n√£o funcionar, <code>DoSomethingWild</code> tamb√©m: ele n√£o possui c√≥digos de retorno, mas deve jogar roleta.  O que fazer em uma situa√ß√£o aparentemente sem esperan√ßa?  A resposta √© realmente simples: estando em outra camada, o <code>DoSomethingWild</code> deve lan√ßar sua pr√≥pria exce√ß√£o, que se refere a essa camada e agrupar o original como a fonte original do problema - no <code>InnerException</code> : </p><br><pre> <code class="plaintext hljs">namespace JetFinance.Strategies { pubilc class WildStrategy { private Random random = new Random(); public void PlayRussianRoulette() { if(DateTime.Now.Second == (random.Next() % 60)) { throw new StrategyException(); } } } public class StrategyException : Exception { /* .. */ } } namespace JetFinance.Investments { public class WildInvestment { WildStrategy _strategy; public WildInvestment(WildStrategy strategy) { _strategy = strategy; } public void DoSomethingWild() { try { _strategy.PlayRussianRoulette(); } catch(StrategyException exception) { throw new FailedInvestmentException("Oops", exception); } } } public class InvestmentException : Exception { /* .. */ } public class FailedInvestmentException : Exception { /* .. */ } } using JetFinance.Investments; void Main() { var foo = new WildStrategy(); var boo = new WildInvestment(foo); try { boo.DoSomethingWild(); } catch(FailedInvestmentException exception) { } }</code> </pre> <br><p>  Voltando a exce√ß√£o para outra, basicamente transferimos os problemas de uma camada de aplicativo para outra, tornando seu trabalho mais previs√≠vel do ponto de vista do usu√°rio dessa classe: o m√©todo <code>Main</code> . </p><br><h3 id="po-voprosam-pereispolzovaniya">  Para problemas de reutiliza√ß√£o </h3><br><p>  Muitas vezes enfrentamos uma tarefa dif√≠cil: por um lado, somos pregui√ßosos demais para criar um novo tipo de exce√ß√£o e, quando decidimos, nem sempre √© claro do que pressionar: de que tipo usar como base.  Mas s√£o precisamente essas decis√µes que determinam toda a arquitetura de situa√ß√µes excepcionais.  Vamos examinar as solu√ß√µes populares e tirar algumas conclus√µes. </p><br><p>  Ao escolher o tipo de exce√ß√µes, voc√™ pode tentar usar uma solu√ß√£o j√° existente: encontre uma exce√ß√£o com um significado semelhante no nome e use-a.  Por exemplo, se nos foi dada uma entidade atrav√©s de um par√¢metro que de alguma forma n√£o nos conv√©m, podemos lan√ßar uma <code>InvalidArgumentException</code> , indicando a causa do erro em Message.  Esse cen√°rio parece bom, especialmente considerando que <code>InvalidArgumentException</code> est√° no grupo de exce√ß√µes que n√£o est√£o sujeitas a captura obrigat√≥ria.  Mas escolher <code>InvalidDataException</code> ser√° ruim se voc√™ estiver trabalhando com algum dado.  S√≥ porque esse tipo est√° na zona <code>System.IO</code> e dificilmente √© isso que voc√™ faz.  I.e.  Acontece que encontrar o tipo existente porque fazer o seu com pregui√ßa quase sempre ser√° a abordagem errada.  Quase n√£o h√° exce√ß√µes criadas para o c√≠rculo geral de tarefas.  Quase todos eles s√£o criados para situa√ß√µes espec√≠ficas e sua reutiliza√ß√£o ser√° uma viola√ß√£o grave da arquitetura de situa√ß√µes excepcionais.  N√£o apenas isso, tendo recebido uma exce√ß√£o de um determinado tipo (por exemplo, o mesmo <code>System.IO.InvalidDataException</code> ), o usu√°rio ficar√° confuso: por um lado, ele ver√° a fonte do problema no <code>System.IO</code> como um espa√ßo para nome da exce√ß√£o e, por outro, como um espa√ßo para nome do ponto de lan√ßamento completamente diferente.  Al√©m disso, pensando nas regras para lan√ßar essa exce√ß√£o, ela ir√° para o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sourcesource.microsoft.com</a> e encontra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">todos os locais onde √© lan√ßada</a> : </p><br><ul><li> <code>internal class System.IO.Compression.Inflater</code> </li> </ul><br><p>  E ele vai entender isso <del>  apenas algu√©m tem m√£os tortas </del>  a escolha do tipo de exce√ß√£o o confundiu, pois o m√©todo que lan√ßou a exce√ß√£o n√£o estava envolvido na compacta√ß√£o. </p><br><p>  Al√©m disso, para simplificar a reutiliza√ß√£o, voc√™ pode simplesmente criar e criar uma √∫nica exce√ß√£o declarando um campo <code>ErrorCode</code> com um c√≥digo de erro e viver feliz para sempre.  Parece: uma boa solu√ß√£o.  Lance a mesma exce√ß√£o em todos os lugares, definindo o c√≥digo, captura apenas uma <code>catch</code> aumentando assim a estabilidade do aplicativo: e n√£o h√° mais o que fazer.  No entanto, discorde desta posi√ß√£o.  Agindo dessa maneira durante todo o aplicativo, por um lado, √© claro, voc√™ simplifica sua vida.  Mas, por outro lado, voc√™ descarta a capacidade de capturar um subgrupo de exce√ß√µes, unido por algum recurso comum.  Como isso √© feito, por exemplo, com <code>ArgumentException</code> , que por si s√≥ combina um grupo inteiro de exce√ß√µes por heran√ßa.  O segundo fator menos importante s√£o folhas de c√≥digo excessivamente grandes e ileg√≠veis que organizar√£o a filtragem por c√≥digo de erro.  Mas se voc√™ tomar uma situa√ß√£o diferente: quando a finaliza√ß√£o do erro n√£o deve ser importante para o usu√°rio final, a introdu√ß√£o de um tipo de generaliza√ß√£o mais um c√≥digo de erro j√° parece um aplicativo muito mais correto: </p><br><pre> <code class="plaintext hljs">public class ParserException : Exception { public ParserError ErrorCode { get; } public ParserException(ParserError errorCode) { ErrorCode = errorCode; } public override string Message { get { return Resources.GetResource($"{nameof(ParserException)}{Enum.GetName(typeof(ParserError), ErrorCode)}"); } } } public enum ParserError { MissingModifier, MissingBracket, // ... } // Usage throw new ParserException(ParserError.MissingModifier);</code> </pre> <br><p>  O c√≥digo que protege a chamada do analisador √© quase sempre indiferente pelo motivo pelo qual a an√°lise foi bloqueada: o fato do erro em si √© importante.  No entanto, se isso se tornar importante, o usu√°rio sempre poder√° extrair o c√≥digo de erro da <code>ErrorCode</code> .  Para fazer isso, n√£o √© necess√°rio procurar as palavras necess√°rias subseq√ºentemente na <code>Message</code> . </p><br><p>  Se voc√™ come√ßar a ignorar problemas de reutiliza√ß√£o, poder√° criar um tipo de exce√ß√£o para cada situa√ß√£o.  Por um lado, parece l√≥gico: um tipo de erro √© um tipo de exce√ß√£o.  No entanto, aqui, como em tudo, o principal √© n√£o exagerar: tendo opera√ß√µes excepcionais em cada ponto de libera√ß√£o, voc√™ causa problemas de intercepta√ß√£o: o c√≥digo do m√©todo de chamada ser√° sobrecarregado com blocos de <code>catch</code> .  Afinal, ele precisa lidar com todos os tipos de exce√ß√µes que voc√™ deseja dar a ele.  Outro sinal de menos √© puramente arquitet√¥nico.  Se voc√™ n√£o usa heran√ßa, desorienta o usu√°rio dessas exce√ß√µes: pode haver muito em comum entre elas e √© necess√°rio intercept√°-las individualmente. </p><br><p>  No entanto, existem bons cen√°rios para a introdu√ß√£o de tipos espec√≠ficos para situa√ß√µes espec√≠ficas.  Por exemplo, quando ocorre uma discrimina√ß√£o n√£o para toda a entidade como um todo, mas para um m√©todo espec√≠fico.  Ent√£o esse tipo deve estar na hierarquia de heran√ßa em um local para que n√£o haja a possibilidade de intercept√°-lo junto com outra coisa: por exemplo, selecionando-o atrav√©s de um ramo de heran√ßa separado. </p><br><p>  Al√©m disso, se voc√™ combinar essas duas abordagens, poder√° obter uma caixa de ferramentas muito poderosa para trabalhar com um grupo de erros: voc√™ pode introduzir um tipo abstrato generalizado do qual herdar situa√ß√µes espec√≠ficas espec√≠ficas.  A classe base (nosso tipo de generaliza√ß√£o) deve estar equipada com uma propriedade abstrata que armazena o c√≥digo de erro, e os herdeiros substituir√£o essa propriedade para especificar esse c√≥digo de erro: </p><br><pre> <code class="plaintext hljs">public abstract class ParserException : Exception { public abstract ParserError ErrorCode { get; } public override string Message { get { return Resources.GetResource($"{nameof(ParserException)}{Enum.GetName(typeof(ParserError), ErrorCode)}"); } } } public enum ParserError { MissingModifier, MissingBracket } public class MissingModifierParserException : ParserException { public override ParserError ErrorCode { get; } =&gt; ParserError.MissingModifier; } public class MissingBracketParserException : ParserException { public override ParserError ErrorCode { get; } =&gt; ParserError.MissingBracket; } // Usage throw new MissingModifierParserException(ParserError.MissingModifier);</code> </pre> <br><p>  Quais s√£o as propriedades maravilhosas que obtemos com essa abordagem? </p><br><ul><li>  por um lado, mantivemos a captura de uma exce√ß√£o pelo tipo b√°sico; </li><li>  por outro lado, capturando uma exce√ß√£o pelo tipo b√°sico, ainda era poss√≠vel descobrir uma situa√ß√£o espec√≠fica; </li><li>  e mais a tudo o que √© poss√≠vel interceptar para um tipo espec√≠fico, e n√£o para um b√°sico, sem usar a estrutura plana das classes. </li></ul><br><p>  Quanto a mim, esta √© uma op√ß√£o muito conveniente. </p><br><h3 id="po-otnosheniyu-k-edinoy-gruppe-povedencheskih-situaciy">  Em rela√ß√£o a um √∫nico grupo de situa√ß√µes comportamentais </h3><br><p>  Que conclus√µes podem ser tiradas com base no racioc√≠nio descrito anteriormente?  Vamos tentar formul√°-los: </p><br><p>  Para come√ßar, vamos decidir o que se entende por situa√ß√µes.  Quando falamos sobre classes e objetos, estamos principalmente acostumados a operar entidades com algum estado interno sobre o qual podemos realizar a√ß√µes.  Acontece que, ao fazer isso, encontramos o primeiro tipo de situa√ß√£o comportamental: a√ß√µes em uma determinada entidade.  Al√©m disso, se voc√™ olhar para o gr√°fico de objetos como se fosse de fora, notar√° que ele √© logicamente combinado em grupos funcionais: o primeiro lida com cache, o segundo lida com bancos de dados e o terceiro realiza c√°lculos matem√°ticos.  As camadas podem passar por todos esses grupos funcionais: uma camada de log de v√°rios estados internos, log de processos, rastreamento de chamadas de m√©todos.  As camadas podem ser mais abrangentes: combinando v√°rios grupos funcionais.  Por exemplo, uma camada de modelo, uma camada de controlador, uma camada de apresenta√ß√£o.  Esses grupos podem estar na mesma assembl√©ia ou em grupos completamente diferentes, mas cada um deles pode criar suas pr√≥prias situa√ß√µes excepcionais. </p><br><p>  Acontece que, se voc√™ argumentar dessa maneira, poder√° criar uma hierarquia de tipos de situa√ß√µes excepcionais, com base no tipo pertencente a um grupo ou camada espec√≠fico, criando a capacidade de capturar exce√ß√µes ao c√≥digo para facilitar a navega√ß√£o sem√¢ntica nessa hierarquia de tipos. </p><br><p>  Vamos dar uma olhada no c√≥digo: </p><br><pre> <code class="plaintext hljs">namespace JetFinance { namespace FinancialPipe { namespace Services { namespace XmlParserService { } namespace JsonCompilerService { } namespace TransactionalPostman { } } } namespace Accounting { /* ... */ } }</code> </pre><br><p>  Como √© isso?  Quanto a mim, os espa√ßos para nome s√£o uma grande oportunidade para agrupar naturalmente tipos de exce√ß√µes de acordo com suas situa√ß√µes comportamentais: tudo o que pertence a determinados grupos deve estar l√°, incluindo exce√ß√µes.  Al√©m disso, quando voc√™ recebe uma certa exce√ß√£o, al√©m do nome de seu tipo, ver√° seu espa√ßo para nome, que determinar√° claramente sua afilia√ß√£o.  Lembre-se do exemplo de reutiliza√ß√£o <code>InvalidDataException</code> tipo <code>InvalidDataException</code> que √© realmente definido no espa√ßo para nome <code>System.IO</code> ?  Sua perten√ßa a esse espa√ßo para nome significa que, em ess√™ncia, uma exce√ß√£o desse tipo pode ser lan√ßada fora das classes localizadas no espa√ßo para nome <code>System.IO</code> ou em uma mais aninhada.  Mas a exce√ß√£o em si foi lan√ßada de um lugar completamente diferente, confundindo o pesquisador com o problema que surgiu.  Ao focar os tipos de exce√ß√£o nos mesmos espa√ßos de nome que os tipos que lan√ßam essas exce√ß√µes, voc√™ mant√©m a arquitetura de tipos consistente, por um lado, e, por outro lado, facilita para o desenvolvedor final entender os motivos do que aconteceu. </p><br><p>  Qual √© a segunda maneira de agrupar no n√≠vel do c√≥digo?  Heran√ßa: </p><br><pre> <code class="plaintext hljs">public abstract class LoggerExceptionBase : Exception { protected LoggerExceptionBase(..); } public class IOLoggerException : LoggerExceptionBase { internal IOLoggerException(..); } public class ConfigLoggerException : LoggerExceptionBase { internal ConfigLoggerException(..); }</code> </pre><br><p>  Al√©m disso, se no caso de entidades de aplicativo comuns, heran√ßa significa heran√ßa de comportamento e dados, combinando tipos por pertencer a um <em>√∫nico grupo de entidades</em> , ent√£o no caso de exce√ß√µes, heran√ßa significa pertencer a um <em>√∫nico grupo de situa√ß√µes</em> , uma vez que a ess√™ncia da exce√ß√£o n√£o √© a ess√™ncia, mas a problem√°tica. </p><br><p>  Combinando os dois m√©todos de agrupamento, podemos tirar algumas conclus√µes: </p><br><ul><li>  dentro da montagem ( <code>Assembly</code> ) deve estar presente o tipo b√°sico de exce√ß√µes que essa montagem lan√ßa.  Esse tipo de exce√ß√£o deve estar no espa√ßo para nome raiz do assembly.  Essa ser√° a primeira camada do agrupamento; </li><li>  Al√©m disso, dentro da pr√≥pria montagem, pode haver um ou mais namespaces diferentes.  Cada um deles divide a montagem em algumas zonas funcionais, definindo assim os grupos de situa√ß√µes que surgem nessa montagem.  Podem ser zonas de controladores, entidades de banco de dados, algoritmos de processamento de dados e outros.  Para n√≥s, esses namespaces s√£o um agrupamento de tipos por afilia√ß√£o funcional e, do ponto de vista de exce√ß√µes, um agrupamento por zonas problem√°ticas do mesmo assembly; </li><li>  a heran√ßa de exce√ß√µes pode ir apenas de tipos no mesmo espa√ßo para nome ou na raiz mais.  Isso garante uma compreens√£o inequ√≠voca da situa√ß√£o pelo usu√°rio final e a aus√™ncia de intercepta√ß√£o de exce√ß√µes <em>deixadas</em> ao interceptar de acordo com o tipo b√°sico. :     <code>global::Finiki.Logistics.OhMyException</code> ,  <code>catch(global::Legacy.LoggerExeption exception)</code> ,      : </li></ul><br><pre> <code class="plaintext hljs">namespace JetFinance.FinancialPipe { namespace Services.XmlParserService { public class XmlParserServiceException : FinancialPipeExceptionBase { // .. } public class Parser { public void Parse(string input) { // .. } } } public abstract class FinancialPipeExceptionBase : Exception { } } using JetFinance.FinancialPipe; using JetFinance.FinancialPipe.Services.XmlParserService; var parser = new Parser(); try { parser.Parse(); } catch (XmlParserServiceException exception) { // Something wrong in parser } catch (FinancialPipeExceptionBase exception) { // Something else wrong. Looks critical because we don't know real reason }</code> </pre><br><p> ,   :        , ,   ,       <code>XmlParserServiceException</code> . ,   ,      ,  <code>JetFinance.FinancialPipe.FinancialPipeExceptionBase</code> ,       :    <code>XmlParserService</code>    ,       .          ,               <code>catch</code>      :          . </p><br><p>     ? </p><br><ul><li>        .     .     ‚Äî      ,       : , -, UI.  I.e.     ; </li><li>        ,   :      ,      <code>catch</code> ; </li><li>       ‚Äì      .        ; </li><li>             ,       .      :       ,         , ,  . ,   -    :        ,   ‚Äî  ,  , ,        ; </li><li>         </li><li>       ,      :     ; </li><li>           ,  Mixed Mode c ErrorCode. </li></ul><br><h3 id="po-istochniku-oshibki">    </h3><br><p>             . ,     ,     : </p><br><ul><li>  unsafe ,    .      :         ,      (,   )     ; </li><li>     ,   ,      , ..       .        ,             ,     .  ,       ,       .            ‚Äî        ‚Äî  <code>InnerExcepton</code> .            ‚Äî          ; </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nosso pr√≥prio c√≥digo que foi inserido aleatoriamente em um estado n√£o consistente. </font><font style="vertical-align: inherit;">A an√°lise de texto √© um bom exemplo. </font><font style="vertical-align: inherit;">N√£o h√° depend√™ncias externas, n√£o h√° retirada </font></font><code>unsafe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas h√° um erro de an√°lise.</font></font></li></ul><br><blockquote><h3>  Link para o livro inteiro </h3><br><ul><li><img src="https://habrastorage.org/webt/3q/6g/qa/3q6gqaz40qx-jzscjf3jbxatxhg.png">  Livro do CLR: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> </li><li><img src="https://habrastorage.org/webt/eo/6g/eo/eo6geog0tg5ernqmv2lcmufefta.png">  Livros da vers√£o 0.5.0, PDF: <a href="">Vers√£o do GitHub</a> </li></ul><br></blockquote><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/97f/1d3/cf0/97f1d3cf0e2a6bf007066eb60a789c31.png"></a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt419927/">https://habr.com/ru/post/pt419927/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt419917/index.html">Redes neurais: implementa√ß√£o da tarefa sobre cogumelos em Tensor Flow e Python</a></li>
<li><a href="../pt419919/index.html">Controle de vers√£o dentro do SQL Server</a></li>
<li><a href="../pt419921/index.html">Como perder 10 milh√µes de pacotes por segundo</a></li>
<li><a href="../pt419923/index.html">Meu trabalho tempor√°rio, rel√≥gios da placa-m√£e</a></li>
<li><a href="../pt419925/index.html">Controle de vers√£o de arquivos individuais usando o GitHub Gist</a></li>
<li><a href="../pt419929/index.html">[DotNetBook] Eventos de exce√ß√£o e como obter StackOverflow e ExecutionEngineException do zero</a></li>
<li><a href="../pt419931/index.html">[DotNetBook] Hora de hist√≥rias divertidas: situa√ß√µes excepcionalmente excepcionais</a></li>
<li><a href="../pt419933/index.html">Como fazer pesquisas de usu√°rios no Github usando Angular</a></li>
<li><a href="../pt419935/index.html">Exatamente uma vez N√ÉO √© exatamente o mesmo: an√°lise do artigo</a></li>
<li><a href="../pt419939/index.html">Como eu tornei a navega√ß√£o no React Native n√£o t√£o terr√≠vel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>