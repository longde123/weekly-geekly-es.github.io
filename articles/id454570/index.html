<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👸 🖐🏾 🦆 Menciptakan game DOS lama di C ++ 17 👩🏾‍🏭 😨 🤳🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pada tahun 2016, saya mulai mengerjakan proyek hobi untuk merekayasa balik game Duke Nukem II dan menciptakan kembali mesinnya dari awal. Proyek ini d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Menciptakan game DOS lama di C ++ 17</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454570/">  Pada tahun 2016, saya mulai mengerjakan proyek hobi untuk merekayasa balik game <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener">Duke Nukem II</a> dan menciptakan kembali mesinnya dari awal.  Proyek ini disebut Rigel Engine dan tersedia dalam sumber terbuka ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener">halamannya di GitHub</a> ).  Hari ini, lebih dari dua setengah tahun kemudian, di mesin saya, Anda sudah dapat melewati seluruh episode shareware dari game asli dengan gameplay yang hampir sama dengan aslinya.  Berikut ini adalah video dengan bagian dari tingkat pertama: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Z3gCS5LvC2s" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Apa yang bisa dia lakukan?  Rigel Engine berfungsi sebagai pengganti lengkap untuk binari DOS asli ( <code>NUKEM2.EXE</code> ).  Anda bisa menyalinnya ke direktori game dan mempertimbangkan semua data dari itu, atau menentukan jalur ke data game sebagai argumen ke baris perintah.  Mesin dibangun dan dijalankan di bawah Windows, Mac OS X dan Linux.  Ini didasarkan pada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener">SDL</a> dan OpenGL 3 / OpenGL ES 2, dan ditulis dalam C ++ 17. <br><br>  Ini mengimplementasikan logika game dari semua musuh dan mekanik game dari episode Shareware, ditambah sebagian besar sistem menu.  Selain itu, Anda dapat mengimpor game yang disimpan dan tabel skor tinggi dari game asli ke dalamnya. <br><a name="habracut"></a><br>  Selain itu, mesin memiliki keunggulan dibandingkan yang asli: <br><br><ul><li>  Tidak diperlukan emulator atau perangkat keras lama, tidak diperlukan pengaturan </li><li>  Tanpa memuat layar - pilih "permainan baru" di menu, tekan Enter, dan segera mulai permainan </li><li>  Beberapa efek suara dapat dimainkan pada saat yang sama, yang tidak mungkin pada aslinya </li><li>  Tidak ada batasan jumlah efek simultan dari partikel, ledakan, dan sebagainya. </li><li>  Simpan file dan daftar skor tinggi untuk setiap pemain </li><li>  Menu jauh lebih responsif </li></ul><br>  Sejauh ini, saya tidak menganggap Mesin Rigel sepenuhnya "siap."  Tapi ini adalah tahap yang bagus dalam pengembangan dan kesempatan yang baik untuk menulis tentang mesin lagi (posting lama diterbitkan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener">sini</a> dan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener">sini</a> ).  Mari kita mulai dengan melihat keadaan kode saat ini dan mencari tahu bagaimana saya mendapatkannya. <br><br><h2>  Berapa banyak kode di mesin? </h2><br>  Pada saat penulisan, RigelEngine terdiri dari 270 file sumber yang berisi lebih dari 25 ribu baris kode (tidak ada komentar / baris kosong).  Dari jumlah tersebut, 10 file dan 2,5 ribu baris adalah unit test.  Rincian garis-garis kosong dan komentar tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener">sini</a> . <br><br>  Apa yang ada dalam semua kode ini?  Sedikit infrastruktur umum dan fungsi pendukung, seperti hal-hal dasar seperti rendering, dan sekelompok kecil logika.  Selain semua ini, bagian terbesar adalah: <br><br><ul><li>  parser / pengunduh untuk 14 format file berbeda yang digunakan dalam gim asli - 2 ribu baris kode (LOC) </li><li>  logika perilaku / logika permainan untuk 24 musuh / benda bermusuhan - 3.8k LOC </li><li>  logika game untuk 14 elemen interaktif dan mekanika game - 2k LOC </li><li>  logika kontrol pemain - 1.2k LOC </li><li>  154 entri konfigurasi (nilai kesehatan setiap musuh, jumlah poin yang diterima untuk item yang dikumpulkan, dll.) - 1k LOC </li><li>  31 spesifikasi untuk efek kehancuran (efek yang dipicu oleh penghancuran musuh atau objek yang dapat dirusak lainnya) - 254 LOC </li><li>  kode kontrol kamera - 159 LOC </li><li>  menu game deskripsi bahasa juru / cutscene - 643 LOC </li><li>  HUD dan kode UI lainnya adalah 818 LOC </li><li>  5 layar / mode di luar menu, misalnya, animasi awal, layar bonus, dll.  - 789 LOC </li></ul><br>  Tentu saja, semua kode ini perlu ditulis, dan ini membawa kita ke pertanyaan berikutnya. <br><br><h2>  Berapa banyak pekerjaan yang diperlukan? </h2><br>  Meskipun dua setengah tahun telah berlalu sejak awal proyek, saya belum mengerjakannya selama ini.  Selama beberapa bulan saya tidak melakukan proyek sama sekali, di beberapa yang lain saya hanya menghabiskan beberapa jam untuk itu.  Tapi ada kalanya saya bekerja di Rigel Engine dengan cukup aktif.  Melihat jadwal komit di Github, Anda bisa mendapatkan gambaran kasar tentang bagaimana pekerjaan saya didistribusikan dari waktu ke waktu: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c55/7f6/ee0/c557f6ee023574c46aea645b0001824d.png"></div><br>  Menurut jadwal, kita melihat bahwa 1081 komit dibuat untuk cabang utama.  Namun, bahkan sebelum membuat repositori, saya sedang mengerjakan yang tertutup, di mana ada 247 lebih banyak komit, yang secara total memberi kita 1328 komit.  Selain itu, ada beberapa cabang prototipe yang saya gunakan untuk penelitian dan eksperimen, tetapi tidak pernah dikombinasikan dengan yang utama;  selain itu, sebelum bergabung, saya terkadang memadatkan cerita komit besar menjadi cerita pendek. <br><br>  Saya juga harus mengatakan bahwa penulisan kode bukan satu-satunya bagian dari proyek - rekayasa balik adalah bagian penting lainnya.  Saya menghabiskan beberapa jam mempelajari kode yang dibongkar dari file executable asli di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener">Ida Pro</a> (dalam versi gratis), membuat catatan, menulis kodesemu, dan merencanakan implementasi elemen-elemen versi saya.  Selain itu, saya aktif menguji game asli, menjalankannya di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener">DOSBox</a> dan pada peralatan asli (mesin yang berbeda 386 dan 486 dibeli di eBay).  Saya mengumpulkan level tes untuk pengamatan terpisah dari musuh spesifik dan mempelajari mekanika game, merekam klip video menggunakan DOSBox, dan melihat melalui bingkai frame-by-frame untuk mengkonfirmasi kesimpulan saya yang dibuat saat mempelajari kode assembler.  Setelah musuh atau mekanik gim direalisasikan, saya biasanya merekam klip video dari versi saya dan membandingkannya satu per satu dengan yang asli untuk mengkonfirmasi keakuratan implementasi saya. <br><br>  Berikut beberapa foto catatan saya: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/884/da3/b64/884da3b64a95ce531a3d5dbb456265bc.jpg"></div><br>  <i>Membalikkan kode kontrol kamera rekayasa.</i>  <i>Kotak besar menunjukkan layar.</i>  <i>Garis putus-putus menunjukkan zona dimana pemain dapat bergerak tanpa menggerakkan kamera.</i>  <i>Jika Anda tertarik, kode kontrol kamera itu sendiri dapat ditemukan di <a href="" rel="noopener">sini</a> .</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ec4/2d3/5c6/ec42d35c6ee85e375b8ed6d94d37e24d.jpg"></div><br>  <i>Catatan umum untuk membantu Anda memahami kode perakitan.</i>  <i>Di sebelah kiri adalah prosedur untuk memperbarui gim asli di tingkat tinggi.</i>  <i>Di sebelah kanan adalah catatan pada bidang bit yang menunjukkan status beberapa objek game.</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/839/677/f8f/839677f8f3f9854d8e8ce6d349da396c.jpg"></div><br>  <i>Transkripsi kode assembler ke pseudocode.</i>  <i>Biasanya saya melakukannya secara mekanis, menyalin tanpa memikirkan apa yang dilakukan kode, dan kemudian menggunakan versi dalam pseudo-code untuk memahami logika yang mendasarinya.</i>  <i>Dan atas dasar itu, saya sudah datang dengan implementasi saya.</i>  <i>Lihat kode yang sudah selesai di <a href="" rel="noopener">sini</a> .</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8da/fd3/848/8dafd384867291ec44dc8bb9d9ff15b2.jpg"></div><br>  <i>Kode palsu dari versi logika musuh yang dibersihkan.</i>  <i>Header menunjukkan keadaan mesin negara, kode di bawah ini menjelaskan apa yang harus terjadi di masing-masing negara.</i>  <i>Itu dibuat berdasarkan pseudocode mentah yang diperoleh dengan menyalin kode assembler.</i>  <i>Kode siap dapat ditemukan di <a href="" rel="noopener">sini</a> .</i> <br><br>  Pada akhirnya, pekerjaan pada proyek tersebut ternyata sangat menarik, dan saya belajar banyak darinya: tentang reverse engineering, assembler x86 16-bit, pemrograman VGA tingkat rendah, pembatasan ketat yang harus dihadapi pengembang game PC di awal tahun 90-an;  selain itu, saya membuat banyak penemuan tentang fitur internal dari game asli dan betapa aneh dan aneh beberapa dari mereka diimplementasikan - topik ini sendiri layak mendapatkan serangkaian posting yang terpisah. <br><br><h2>  Apa selanjutnya </h2><br>  Selain menambahkan fungsi terakhir yang tersisa dan menyelesaikan dukungan untuk versi terdaftar, saya punya beberapa ide untuk meningkatkan dan memperluas kemampuan Mesin Rigel, belum lagi membersihkan dan refactoring kode - seperti biasa, cara terbaik untuk membuat arsitektur perangkat lunak menjadi jelas hanya setelah pembuatan perangkat lunak ini selesai. <br><br>  Adapun perbaikan di masa depan, berikut adalah beberapa poin yang saya pikirkan tentang penerapan: <br><br><ul><li>  Gerakan halus dengan interpolasi.  Gim ini memperbarui logikanya sekitar 15 kali per detik, dan dalam gim asli itu juga merupakan frame rate untuk rendering.  Di sisi lain, Mesin Rigel dapat dengan mudah bekerja dengan frekuensi 60 FPS dan lebih tinggi.  Saat ini, bingkai tambahan ini tidak memberikan keuntungan apa pun, tetapi saya pikir mereka dapat digunakan untuk bingkai menengah untuk mewujudkan pengguliran dan pergerakan objek yang lebih halus.  Logika permainan masih akan bekerja pada kecepatan yang sama, tetapi objek akan bergerak dengan lancar, dan tidak "melompat" dengan penambahan 8 piksel, seperti yang mereka lakukan sekarang.  Sebelumnya, saya membuat prototipe sistem seperti itu, dan itu terlihat hebat, meskipun perlu diperbaiki. </li><li>  Dukungan gamepad.  Dalam gim asli, ada dukungan untuk joystick, dan DosBox dapat mengemulasi mereka pada gamepad modern, tetapi penyiapannya mungkin sulit - persiapan konfigurasi dan kalibrasi dalam gim diperlukan.  Belum lagi bahwa tidak semua tombol controller didukung, tetapi untuk menggunakan menu Anda masih harus mengambil keyboard.  Oleh karena itu, saya percaya bahwa dukungan pengontrol asli akan secara signifikan meningkatkan gameplay. </li><li>  Peningkatan suara.  Saat ini, semua efek suara memiliki volume yang sama.  Objek yang menghasilkan suara, misalnya, memaksa medan, menjadi terdengar tajam ketika mereka menekan layar, dan putus sama tajam.  Saya ingin tahu bagaimana mereka akan terdengar jika volume efek di kejauhan memudar.  Sebagai contoh, kita hampir tidak bisa mendengar medan gaya ketika belum ada di layar, dan ketika mendekatinya akan menjadi lebih keras. </li><li>  Kamera jarak jauh / lihat sebagian besar level.  Gim ini tidak dirancang untuk ini, jadi kemungkinan ini dapat merusak gameplay - pemain akan mulai melihat musuh yang tidak aktif di luar layar, dan sejenisnya.  Tapi saya masih bertanya-tanya bagaimana tampilannya dan bermain.  Pada akhirnya, pemain sangat sering mengeluh tentang permainan ini karena ketidakmampuan mereka untuk melihat bagian yang cukup dari level.  Akan menarik untuk menambahkan opsi untuk mematikan HUD atau menggantinya dengan yang lebih minimal menggunakan transparansi. </li><li>  Tambah resolusi grafis.  Fitur ini sering ditemukan di banyak port / rekreasi permainan, dan akan menyenangkan untuk menambahkannya di sini.  Mesin sudah memungkinkan Anda untuk mengganti grafik sprite dengan gambar Anda sendiri, tetapi sejauh ini mereka tidak dapat memiliki resolusi yang lebih tinggi, karena semuanya dirender menjadi buffer kecil dengan peningkatan skala berikutnya.  Pertama, Anda perlu mengganti pendekatan ini sehingga penskalaan dapat dilakukan untuk objek individual. </li></ul><br>  Saya tidak punya peta jalan untuk masa depan, jadi saya bisa menerapkan poin ini dalam urutan apa pun.  Namun sebelum semua ini, langkah selanjutnya adalah integrasi Dear ImGui untuk merakit lebih lanjut menu opsi, yang belum ada dalam game;  selain itu, ini akan mengaktifkan atau menonaktifkan perbaikan di atas.  Pada akhirnya, saya akan mengatakan bahwa saya akan berterima kasih atas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener">bantuan</a> apa pun <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="noopener">dalam mengerjakan GitHub</a> ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id454570/">https://habr.com/ru/post/id454570/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id454552/index.html">Susunan docker Cara menunggu sampai wadah siap</a></li>
<li><a href="../id454556/index.html">Berita dari dunia OpenStreetMap No. 462 (05.21.2019-27.05.2019)</a></li>
<li><a href="../id454558/index.html">PHP Digest No. 157 (20 Mei - 3 Juni 2019)</a></li>
<li><a href="../id454562/index.html">Mengapa konsep bytecode tidak relevan seperti sebelumnya</a></li>
<li><a href="../id454568/index.html">Mozilla menyebut distribusi paket web yang ditandatangani secara digital oleh Google sebagai "buruk"</a></li>
<li><a href="../id454574/index.html">Pembelajaran mesin dalam keuangan mikro: membangun model penilaian untuk klien dengan sejarah kredit yang kosong</a></li>
<li><a href="../id454576/index.html">Penulis GandCrab berhenti bekerja: mereka mengklaim telah cukup mencuri</a></li>
<li><a href="../id454578/index.html">Bagaimana menghubungkan galeri PhotoSwipe di tampilan web android</a></li>
<li><a href="../id454582/index.html">Haruskah panjang array disimpan ke variabel lokal di C #?</a></li>
<li><a href="../id454584/index.html">Sekolah pengembangan antarmuka: analisis tugas untuk Minsk dan perangkat baru di Moskow</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>