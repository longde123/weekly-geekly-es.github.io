<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÉüèº üë©‚Äçüëß ü§òüèª Maschinelles Lernen f√ºr Vertica üòë üë©üèæ‚Äçüîß üëî</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anmerkung 
 In diesem Artikel m√∂chte ich meine eigenen Erfahrungen mit maschinellem Lernen in einem Data Warehouse auf Vertica teilen. 

 Ehrlich gesa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Maschinelles Lernen f√ºr Vertica</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436306/"><h2>  Anmerkung </h2><br>  In diesem Artikel m√∂chte ich meine eigenen Erfahrungen mit maschinellem Lernen in einem Data Warehouse auf Vertica teilen. <br><br>  Ehrlich gesagt bin ich kein erfahrener Analyst, der in der Lage sein wird, die gesamte Vielfalt der Forschungsmethoden und Datenvorhersagealgorithmen detailliert zu beschreiben.  Als Experte f√ºr Vertica und mit grundlegenden Erfahrungen mit ML werde ich dennoch versuchen, √ºber M√∂glichkeiten zu sprechen, wie man mit Predictive Analysis in Vertica unter Verwendung der integrierten Serverfunktionalit√§t und der R-Sprache arbeitet. <br><br><h2>  Bibliothek f√ºr maschinelles Lernen Vertica </h2><br>  Ab Version 7 wurde Vertica um die Bibliothek f√ºr maschinelles Lernen erweitert, mit der Sie: <br><br><ul><li>  Bereiten Sie Datenbeispiele f√ºr maschinelles Lernen vor </li><li> Modelle f√ºr maschinelles Lernen anhand vorbereiteter Daten trainieren; </li><li>  F√ºhren Sie eine pr√§diktive Analyse der Speicherdaten auf gespeicherten Modellen f√ºr maschinelles Lernen durch. </li></ul><br>  Die Bibliothek wird sofort mit der Vertica-Installation f√ºr alle Versionen geliefert, einschlie√ülich der kostenlosen Community.  Die Arbeit damit wird in Form eines Aufrufs von Funktionen unter SQL umrahmt, die in der Dokumentation mit Beispielen f√ºr die Verwendung auf vorbereiteten Demo-Daten ausf√ºhrlich beschrieben werden. <br><a name="habracut"></a><br><h2>  Ein Beispiel f√ºr die Arbeit mit ML in Vertica </h2><br>  Als einfaches Beispiel f√ºr die Funktionsweise von ML habe ich die mtcars-Demodaten verwendet, die Teil des ML-Datenbeispiels f√ºr Vertica sind.  Diese Daten enthalten zwei Tabellen: <br><br><ul><li>  mtcars_train - Daten, die f√ºr das Training von Modellen f√ºr maschinelles Lernen vorbereitet wurden </li><li>  mtcars - Daten zur Analyse </li></ul><br>  Schauen wir uns die Daten f√ºr das Training an: <br><br><pre><code class="sql hljs">=&gt;<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> mtcars_train;</code> </pre> <br><img src="https://habrastorage.org/webt/mu/4_/o0/mu4_o0ovpeupz4c3qkf1uvnegya.jpeg"><br><br>  Im Datensatz zu Automodellen werden deren Eigenschaften beschrieben.  Versuchen wir, das maschinelle Lernen so zu trainieren, dass anhand der Eigenschaften der Fahrzeuge vorhergesagt werden kann, welcher Getriebetyp im Fahrzeug enthalten ist - ein Schaltgetriebe oder ein Automatikgetriebe.  Dazu m√ºssen wir ein logistisches Regressionsmodell auf den vorbereiteten Daten aufbauen und die Abh√§ngigkeit des Kastentyps des Feldes ‚Äûam‚Äú und der Gewichtsfelder des Fahrzeugs ‚Äûwt‚Äú, der Anzahl der Zylinder ‚Äûzyl‚Äú und der Anzahl der Geschwindigkeiten im Kasten ‚ÄûZahnrad‚Äú ermitteln: <br><br><pre> <code class="sql hljs">=&gt;<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> LOGISTIC_REG(<span class="hljs-string"><span class="hljs-string">'logistic_reg_mtcars'</span></span>, <span class="hljs-string"><span class="hljs-string">'mtcars_train'</span></span>, <span class="hljs-string"><span class="hljs-string">'am'</span></span>, <span class="hljs-string"><span class="hljs-string">'cyl, wt, gear'</span></span>); Finished in 19 iterations</code> </pre> <br>  Die aufgerufene Funktion analysierte die Beziehung zwischen am und den zyl, wt, Zahnradfeldern, enth√ºllte die Abh√§ngigkeitsformel und schrieb das Ergebnis der Abh√§ngigkeitssimulation in die Vertica-Datenbank im Modell ‚Äûlogistic_reg_mtcars‚Äú.  Mit diesem gespeicherten Modell k√∂nnen Sie jetzt Daten zu Fahrzeugen analysieren und die Verf√ºgbarkeit von Automatikgetrieben vorhersagen. <br><br>  Informationen zum Modell k√∂nnen eingesehen werden: <br><br><pre> <code class="sql hljs">=&gt;<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> GET_MODEL_SUMMARY(<span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PARAMETERS</span></span> model_name=<span class="hljs-string"><span class="hljs-string">'logistic_reg_mtcars'</span></span>);</code> </pre> <br><img src="https://habrastorage.org/webt/hd/aj/gp/hdajgpkb3a4jvlq2-czafzt9mv0.jpeg"><br><br>  Jetzt verwenden wir das Modell f√ºr die Daten f√ºr Autos und speichern das Ergebnis in einer neuen Tabelle: <br><br><pre> <code class="sql hljs">=&gt;<span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> mtcars_predict_results <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> car_model, am, PREDICT_LOGISTIC_REG(cyl, wt, gear <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PARAMETERS</span></span> model_name=<span class="hljs-string"><span class="hljs-string">'logistic_reg_mtcars'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">prediction</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> mtcars );</code> </pre> <br>  Und Vergleichen der realen Werte von am mit denen, die in der Vorhersagevorhersage erhalten wurden: <br><br><pre> <code class="sql hljs">=&gt;<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> mtcars_predict_results;</code> </pre> <br><img src="https://habrastorage.org/webt/48/rt/zh/48rtzhy3c4ahjfqrupulpfy_mqy.jpeg"><br><br>  In diesem Fall stimmte die Prognose f√ºr 100% mit dem tats√§chlichen Kartentyp in den vorgestellten Modellen √ºberein.  Wenn Sie neue Daten f√ºr das Training vorbereiten m√∂chten, m√ºssen Sie das Modell l√∂schen und erneut speichern. <br><br><h2>  ML-Funktionalit√§t in Vertica </h2><br>  Die Vertica ML-Bibliothek unterst√ºtzt die folgenden Arten der Vorhersageanalyse: <br><br><ul><li>  <b>Prognose:</b> <br><ul><li>  Lineare Regression </li><li>  Zuf√§lliger Wald f√ºr die Regression </li><li>  SVM (Support Vector Machine) f√ºr die Regression </li></ul></li><li>  <b>Klassifizierung:</b> <br><ul><li>  Logistische Regression </li><li>  Naive Bayes </li><li>  Zuf√§lliger Wald zur Klassifizierung </li><li>  SVM (Support Vector Machine) zur Klassifizierung </li></ul></li><li>  <b>Clustering:</b> <br><ul><li>  k-bedeutet </li></ul></li></ul><br>  Um die Daten f√ºr das Training vorzubereiten, werden die folgenden Funktionen vorgestellt: <br><br><ul><li>  Datenausgleich </li><li>  Emissionsreinigung </li><li>  Codierung kategorialer (Text-) Spaltenwerte </li><li>  Fehlende Daten ersetzen </li><li>  Datennormalisierung </li><li>  Hauptkomponentenanalyse </li><li>  Datenerfassung </li><li>  Singularwertzerlegung </li></ul><br>  In Anbetracht der ML-Funktionalit√§t in Vertica k√∂nnen wir sagen, dass die integrierte Bibliothek es uns erm√∂glicht, eine Vielzahl von Problemen zu l√∂sen, aber nicht √ºber den R√ºckstand verf√ºgt, um die Muster und Abh√§ngigkeiten in den Daten zu untersuchen.  Es gibt Funktionen zum Vorbereiten von Daten f√ºr das maschinelle Lernen, aber ohne die Verteilung der Daten in Form von Diagrammen zu visualisieren, k√∂nnen nur Analysegurus mit Expertenwissen √ºber die analysierten Daten solche Daten ‚Äûvorbereiten‚Äú und Lernmodelle darauf trainieren. <br><br><h2>  R Studio mit Vertica </h2><br>  F√ºr eine gr√ºndlichere und interaktivere pr√§diktive Datenanalyse ist die R-Sprache ideal geeignet, die √ºber eine visuelle Umgebung f√ºr die Arbeit mit R Studio-Daten verf√ºgt.  Die konkreten Vorteile der Verwendung von R mit Vertica sind: <br><br><ul><li>  Interaktivit√§t der Umgebung mit der F√§higkeit, den Status f√ºr die weitere Analyse nach dem n√§chsten Lauf zu speichern; </li><li>  visuelle Anzeige von Daten in Form von Tabellen und Grafiken; </li><li>  R Sprachleistung f√ºr die Arbeit mit Datens√§tzen; </li><li>  eine Vielzahl von Vorhersageanalysealgorithmen √§hnlich den in Vertica ML vorgestellten. </li></ul><br>  Die Nachteile der Arbeit mit R mit Big Data sind die RAM-Anforderungen, die Geschwindigkeit der Arbeit mit Arrays mit gro√üen Datenmengen und die Notwendigkeit, Vertica-Daten zu importieren und zu exportieren.  Diese M√§ngel werden durch die M√∂glichkeit abgedeckt, geschriebene R-Funktionen f√ºr die direkte Ausf√ºhrung in einem Cluster in Vertica einzubetten, die im Folgenden beschrieben werden. <br><br><h2>  Eine kleine Einf√ºhrung in R. </h2><br>  Wir werden die Vorhersage f√ºr automatische Boxen auf Vertica-Daten mit R reproduzieren. Um Programmierer, die mit dieser Sprache nicht vertraut sind, nicht abzuschrecken, werde ich einen kurzen Kurs eines jungen K√§mpfers R durchf√ºhren. <br><br>  Die R-Sprache ist also dieselbe prozedurale Sprache, die Objekte, Klassen und Funktionen enth√§lt. <br>  Ein Objekt kann ein Datensatz (Vektor, Liste, Datensatz ...), ein Wert (Text, Nummer, Datum, Uhrzeit ...) oder eine Funktion sein.  F√ºr Werte werden numerische, Zeichenfolgen-, Boolesche und Datums- / Uhrzeittypen unterst√ºtzt.  Bei Datens√§tzen beginnt die Array-Nummerierung bei 1 und nicht bei 0. <br><br>  Klassischerweise wird anstelle von "=" in R der Zuweisungsoperator "&lt;-" verwendet.  Obwohl es nicht verboten ist, die Zuordnung zur anderen Seite "-&gt;" und sogar das √ºbliche "=" zu verwenden.  Der Operator "=" selbst wird beim Aufrufen von Funktionen verwendet, um benannte Parameter anzugeben. <br><br>  Anstelle von "."  "$" wird verwendet, um auf die Felder der Datens√§tze zuzugreifen.  Ein Punkt ist kein Schl√ºsselwort und wird in Objektnamen verwendet, um deren Lesbarkeit zu verbessern.  Daher wird "my.data $ field" als Array von Datens√§tzen des Felds "field" aus dem Datensatz "my.data" entschl√ºsselt. <br><br>  Sie k√∂nnen entweder einfache oder doppelte Anf√ºhrungszeichen verwenden, um Texte zu rahmen. <br><br>  <b>Am wichtigsten:</b> R ist auf die Arbeit mit Datens√§tzen ausgerichtet.  Selbst wenn der Code "a &lt;-1" sagt, stellen Sie sicher, dass R in sich selbst glaubt, dass "a" ein Array von 1 Element ist.  Das Sprachdesign erm√∂glicht es Ihnen, mit Datens√§tzen wie mit normalen Variablen zu arbeiten: Addieren und Subtrahieren, Verbinden und Trennen, Filtern nach Messungen.  Der einfachste Weg, ein Array mit seinen Elementen zu erstellen, besteht darin, die Funktion "c (durch Kommas getrennte Array-Elemente)" aufzurufen.  Der Name "c" wird anscheinend als kurze Abk√ºrzung f√ºr "Sammlung" verwendet, aber ich werde nicht sicher sagen. <br><br><h2>  Laden von Daten aus einem DBMS in R. </h2><br>  Um RDBMS √ºber ODBC f√ºr R zu verwenden, m√ºssen Sie das RODBC-Paket installieren.  Es kann in R Studio auf der Registerkarte Pakete oder mit dem Befehl R installiert werden: <br><br><pre> <code class="plaintext hljs">install.packages('RODBC') library('RODBC')</code> </pre> <br><br>  Jetzt k√∂nnen wir mit Vertica arbeiten.  Wir erstellen einen ODBC-Alias ‚Äã‚Äãf√ºr den Server und erhalten die Testdaten und den vollst√§ndigen Datensatz f√ºr das Auto: <br><br><pre> <code class="plaintext hljs">#    Vertica con &lt;- odbcConnect(dsn='VerticaDSN') #    mtcars_train mtcars.train &lt;- sqlQuery(con, "SELECT * FROM public.mtcars_train") #    mtcars&lt;/b&gt; mtcars.data &lt;- sqlQuery(con, "SELECT * FROM public.mtcars") #   odbcClose(con)</code> </pre> <br>  Beim Laden von Daten aus Quellen R f√ºr Felder mit Texttypen und Datum / Uhrzeit wird deren Zugeh√∂rigkeit zu Faktoren automatisch ermittelt.  Das Feld "am" ist vom numerischen Typ und R wird als numerischer Indikator und nicht als Faktor wahrgenommen, der keine logistische Regression zul√§sst.  Daher konvertieren wir dieses Feld in einen numerischen Faktor: <br><br><pre> <code class="plaintext hljs">mtcars.data$am = factor(mtcars.data$am) mtcars.train$am = factor(mtcars.train$am)</code> </pre> <br>  In R Studio ist es praktisch, Daten interaktiv zu beobachten, Diagramme der Vorhersageanalyse zu erstellen und Code in R mit folgenden Tipps zu schreiben: <br><br> <a href=""><img src="https://habrastorage.org/webt/r2/ft/b8/r2ftb85rnjcmpiblxomwdiicr7k.jpeg"></a> <br><br><h2>  Erstellen eines Modells in R. </h2><br>  Wir werden ein Modell der logistischen Regression √ºber den vorbereiteten Datensatz f√ºr dieselben Dimensionen wie in Vertica erstellen: <br><br><pre> <code class="plaintext hljs">mtcars.model &lt;- glm(formula = am ~ cyl + wt + gear, family = binomial(), data = mtcars.train)</code> </pre> <br>  <b>Erl√§uterung:</b> In der Sprache R wird die pr√§diktive Analyseformel wie folgt angegeben: <br><br><pre> <code class="plaintext hljs">&lt;  &gt;~&lt;   &gt;</code> </pre> <br><h2>  Analyse von Modelldaten in R. </h2><br>  Wir initialisieren den resultierenden Datensatz und nehmen von mtcars alle Datens√§tze f√ºr die erforderlichen Felder: <br><br><pre> <code class="plaintext hljs">mtcars.result &lt;- data.frame(car_model = mtcars.data$car_model, am = mtcars.data$am, predict = 0)</code> </pre> <br>  Mit dem erstellten Modell k√∂nnen Sie nun die Daten selbst analysieren: <br><br><pre> <code class="plaintext hljs">mtcars.result$predict &lt;- predict.glm(mtcars.model, newdata = subset(mtcars.data, select = c('cyl', 'wt', 'gear')), type = 'response' )</code> </pre> <br>  Das Analyseergebnis wird als Prozentsatz der Wahrscheinlichkeit der Prognose an das Vorhersagefeld zur√ºckgegeben.  In Analogie zu Vertica auf Werte 0 oder 1 vereinfachen, wobei die Prognose mit einer Wahrscheinlichkeit von mehr als 50% positiv ist: <br><br><pre> <code class="plaintext hljs">mtcars.result$predict &lt;- ifelse(mtcars.result$predict &gt; 0.5, 1, 0)</code> </pre> <br>  Wir berechnen die Gesamtzahl der Datens√§tze, f√ºr die das vorhergesagte Vorhersagefeld nicht mit dem tats√§chlichen Wert in am √ºbereinstimmt: <br><br><pre> <code class="plaintext hljs">nrow(mtcars[mtcars.result$am != mtcars.result$predict, ])</code> </pre> <br>  R gab Null zur√ºck.  Somit konvergierte die Prognose f√ºr alle Automodelle wie in Verticas ML. <br><br>  <b>Bitte beachten Sie:</b> Datens√§tze von mtcars wurden vom Filter (der erste Parameter in eckigen Klammern) mit allen Spalten zur√ºckgegeben (der zweite Parameter wurde nach dem Komma in eckigen Klammern weggelassen). <br><br><h2>  Daten lokal in R speichern und laden </h2><br>  Beim Beenden von R bietet das Studio an, den Status aller Objekte zu speichern, um nach einem Neustart weiterarbeiten zu k√∂nnen.  Wenn Sie aus irgendeinem Grund den Status einzelner Objekte speichern und anschlie√üend wiederherstellen m√ºssen, finden Sie hierf√ºr spezielle Funktionen in R: <br><br><pre> <code class="plaintext hljs">#      save(mtcars.model, file = 'mtcars.model') #      load('mtcars.model')</code> </pre> <br><h2>  Speichern von Daten von R nach Vertica </h2><br>  Wenn R Studio zum Vorbereiten von Daten f√ºr das Training von ML Vertica-Modellen verwendet wurde oder wenn die Analyse direkt darin durchgef√ºhrt wurde, was dann in der Vertica-Datenbank verwendet werden soll, k√∂nnen R-Datens√§tze in die Vertica-Tabelle geschrieben werden. <br><br>  Da die ODBC-Bibliothek f√ºr R f√ºr OLTP-RDBMS ausgelegt ist, k√∂nnen keine Tabellenerstellungsabfragen f√ºr Vertica korrekt generiert werden.  Um Daten erfolgreich aufzuzeichnen, m√ºssen Sie daher die erforderliche Tabelle in Vertica manuell mit SQL erstellen, deren Felder und Typen mit dem aufzeichnbaren Datensatz R √ºbereinstimmen. <br><br>  Au√üerdem sieht der Aufnahmevorgang selbst einfach aus (vergessen Sie nicht, die Verbindungsverbindung zu √∂ffnen und dann zu schlie√üen): <br><br><pre> <code class="plaintext hljs">sqlSave(con, mtcars.result, tablename = 'public.mtcars_result', append = TRUE, rownames = FALSE, colnames = FALSE)</code> </pre> <br><h2>  Verwenden von Vertica mit R. </h2><br>  Die interaktive Arbeit mit Daten in R Studio eignet sich gut f√ºr die Recherche und Aufbereitung von Daten.  Es ist jedoch f√ºr die Analyse von Datenstr√∂men und gro√üen Arrays im automatischen Modus v√∂llig ungeeignet.  Eine der Optionen f√ºr das hybride R-Vorhersageanalyseschema mit Vertica ist die Aufbereitung von Daten zum Lernen auf R und das Identifizieren von Abh√§ngigkeiten f√ºr das Erstellen von Modellen.  Anschlie√üend werden unter Verwendung der in Vertica integrierten ML-Funktionen die Prognosemodelle f√ºr auf R aufbereitete Daten unter Ber√ºcksichtigung der identifizierten Abh√§ngigkeiten der Variablen trainiert. <br><br>  Es gibt eine flexiblere Option, wenn die gesamte Leistung der R-Sprache direkt unter Vertica verwendet wird.  Zu diesem Zweck hat Vertica die R-Distribution in Form einer Plug-In-Bibliothek entwickelt, mit der Sie Transformationsfunktionen verwenden k√∂nnen, die in SQL-Abfragen direkt in der R-Sprache geschrieben sind. In der Dokumentation werden die Installation der R-Unterst√ºtzung f√ºr Vertica und die zus√§tzlichen R-Pakete, die f√ºr den Betrieb erforderlich sind, ausf√ºhrlich beschrieben. <br><br><h2>  Modell R in Vertica speichern </h2><br>  Um das zuvor von R Studio erstellte Analysemodell in R-Funktionen zu verwenden, die unter Vertica ausgef√ºhrt werden, m√ºssen Sie es auf Vertica-Servern speichern.  Das lokale Speichern auf jedem Server des Clusters mit einer Datei ist weder bequem noch zuverl√§ssig. Es k√∂nnen neue Server zum Cluster hinzugef√ºgt werden. Wenn Sie das Modell √§ndern, m√ºssen Sie daran denken, alle Dateien erneut zu schreiben. <br><br>  Am bequemsten ist es, das R-Modell in Text zu serialisieren und die Vertica-Funktion als UDF zu speichern, wodurch dieser Text als Konstante zur√ºckgegeben wird (vergessen Sie nicht, die Verbindungsverbindung zu √∂ffnen und dann zu schlie√üen): <br><br><pre> <code class="plaintext hljs">#     mtcars.model.text &lt;- rawToChar( serialize(mtcars.model, connection = NULL, ascii = TRUE)) #       Vertica # (     ) mtcars.func &lt;- paste0( "CREATE OR REPLACE FUNCTION public.MtCarsAnalizeModel() RETURN varchar(65000) AS BEGIN RETURN '", gsub("'", "''", mtcars.model.text), "'; END; GRANT EXECUTE ON FUNCTION public.MtCarsAnalizeModel() TO public;" ) #    Vertica sqlQuery(con, mtcars.func)</code> </pre> <br>  Das vorgeschlagene Verfahren erm√∂glicht die Umgehung der Beschr√§nkung von Vertica auf die √ºbertragenen Parameter in der Transformationsfunktion, wobei nur die √úbertragung von Konstanten oder Ausdr√ºcken von Konstanten erforderlich ist.  Vertica UDF SQL kompiliert nicht als Funktionen, sondern als berechnete Ausdr√ºcke, dh wenn beim √úbergeben eines Parameters anstelle des Aufrufs der Funktion der Text (in diesem Fall eine Konstante) √ºbertragen wird, der im obigen Code gespeichert wurde. <br><br>  Wenn Sie das Modell √§ndern, m√ºssen Sie seine Funktion in Vertica neu erstellen.  Es ist sinnvoll, diesen Code in eine universelle Funktion zu verpacken, die in Vertica eine Funktion mit dem angegebenen Namen aus dem √ºbergebenen Modell generiert. <br><br><h2>  R-Funktionen f√ºr Vertica </h2><br>  Um R-Funktionen mit Vertica zu verbinden, m√ºssen Sie Datenanalyse- und Registrierungsfunktionen in Vertica schreiben. <br><br>  Die Funktion zum Arbeiten mit Daten unter Vertica selbst sollte zwei Parameter haben: den resultierenden Datensatz (wie data.frame) und die Arbeitsparameter (wie list): <br><br><pre> <code class="plaintext hljs">MtCarsAnalize &lt;- function(data, parameters) { if ( is.null(parameters[['model']]) ) { stop("NULL value for model! Model cannot be NULL.") } else { model &lt;- unserialize(charToRaw(parameters[['model']])) } names(data) &lt;- c('car_model', 'cyl', 'wt', 'gear') result &lt;- data.frame(car_model = data$car_model, predict = 0) result$predict &lt;- predict.glm(model, newdata = subset(data, select = c('cyl', 'wt', 'gear')), type = 'response' ) result$predict &lt;- ifelse(result$predict &gt; 0.5, TRUE, FALSE) return(result) }</code> </pre> <br>  Im Hauptteil der Funktion wird √ºberpr√ºft, ob der Modellparameter √ºbergeben wird, dessen Text in eine bin√§re Form √ºbersetzt und in das Objekt des Analysemodells deserialisiert wird.  Da Vertica seine eigenen Feldnamen f√ºr die Funktion in das Dataset √ºbertr√§gt, werden explizite Feldnamen f√ºr das Dataset festgelegt.  Basierend auf den erhaltenen Daten wird eine Ergebnismenge mit dem Namen des Maschinenmodells erstellt und Null vorhergesagt.  Als n√§chstes wird eine Prognose nur unter Verwendung der Felder erstellt, die f√ºr die Analyse aus dem erhaltenen Datensatz erforderlich sind.  Das Vorhersagefeld der Ergebnismenge wird auf Boolesche Werte gesetzt (f√ºr eine √Ñnderung anstelle von numerischen) und das Ergebnis wird von der Funktion zur√ºckgegeben. <br><br>  Nun bleibt die Registrierung dieser Funktion in Vertica zu beschreiben: <br><br><pre> <code class="plaintext hljs">MtCarsAnalizeFactory &lt;- function() { list(name = MtCarsAnalize, udxtype = c("transform"), intype = c("varchar", "int", "float", "int"), outtype = c("varchar", "boolean"), outnames = c("car_model", "predict"), parametertypecallback=MtCarsAnalizeParameters) } MtCarsAnalizeParameters &lt;- function() { parameters &lt;- list(datatype = c("varchar"), length = 65000, scale = c("NA"), name = c("model")) return(parameters) }</code> </pre> <br>  Die MtCarsAnalizeFactory-Funktion beschreibt den Namen der f√ºr die Operation verwendeten Funktion, das Feld f√ºr den eingehenden und ausgehenden Datensatz und die zweite Funktion beschreibt den √ºbergebenen Parameter ‚ÄûModell‚Äú.  Feldtypen sind Vertica-Datentypen.  Beim √úbertragen und Zur√ºckgeben von Daten konvertiert Vertica die Werte automatisch in die erforderlichen Datentypen f√ºr die R-Sprache. Die Typkompatibilit√§tstabelle finden Sie in der Vertica-Dokumentation. <br><br>  Sie k√∂nnen die Funktion der schriftlichen Funktion f√ºr Vertica anhand der in R Studio hochgeladenen Daten testen: <br><br><pre> <code class="plaintext hljs">test.data = subset(mtcars.data, select = c('car_model', 'cyl', 'wt', 'gear')) test.params = list(model = mtcars.model.text) test.result = MtCarsAnalize(test.data, test.params)</code> </pre> <br><h2>  Verbinden Sie die Funktionsbibliothek mit Vertica </h2><br>  Wir speichern alle oben genannten Funktionen in einer einzigen Datei "mtcars_func.r" und laden diese Datei auf einen der Server aus dem Vertica-Cluster in "/ home / dbadmin" hoch. <br><br>  <b>Ein wichtiger Punkt:</b> In R Studio m√ºssen Sie die Option zum Speichern der √úbersetzung von Zeilen in Dateien im Posix (LF) -Modus festlegen.  Dies kann in den globalen Optionen, Abschnitt Code, Registerkarte Speichern erfolgen.  Wenn Sie unter Windows arbeiten, wird die Datei standardm√§√üig mit einem Wagenr√ºcklauf gespeichert und kann nicht auf Vertica hochgeladen werden. <br><br>  Wir stellen vom Vertica-Cluster, auf dem wir die Datei gespeichert und die Bibliothek geladen haben, eine Verbindung zum Server her: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIBRARY</span></span> MtCarsLibs <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'/home/dbadmin/mtcars_func.r'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> <span class="hljs-string"><span class="hljs-string">'R'</span></span>;</code> </pre> <br>  Jetzt k√∂nnen Sie in dieser Bibliothek die R-Funktion registrieren: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> TRANSFORM <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> public.MtCarsAnalize <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> <span class="hljs-string"><span class="hljs-string">'R'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-string"><span class="hljs-string">'MtCarsAnalizeFactory'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIBRARY</span></span> MtCarsLibs; <span class="hljs-keyword"><span class="hljs-keyword">GRANT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> TRANSFORM <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> public.MtCarsAnalize(<span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">float</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>;</code> </pre> <br><h2>  Rufen Sie R-Funktionen in Vertica auf </h2><br>  Wir rufen die R-Funktion auf und √ºbergeben ihr den Modelltext, der zuvor als UDF-Funktion gespeichert wurde: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> MtCarsAnalize(car_model, cyl, wt, gear <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PARAMETERS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> = public.MtCarsAnalizeModel()) <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> public.mtcars;</code> </pre> <br><img src="https://habrastorage.org/webt/8a/om/ve/8aomvezlxe_-0n4gnyonxkr25om.jpeg"><br><br>  Es kann √ºberpr√ºft werden, dass die Prognose wie in den vorherigen F√§llen zu 100% mit dem tats√§chlichen Stand der Dinge √ºbereinstimmt: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> c.*, p.predict, p.predict = c.am::<span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> valid <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> public.mtcars c <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> MtCarsAnalize(car_model, cyl, wt, gear <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PARAMETERS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> = public.MtCarsAnalizeModel()) <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> public.mtcars ) p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.car_model = p.car_model</code> </pre> <br>  <b>Bitte beachten Sie:</b> Die Transformationsfunktionen in Vertica geben ihren eigenen Datensatz aus Feldern und Datens√§tzen zur√ºck, die in den Funktionen definiert sind. Sie k√∂nnen jedoch in Abfragen verwendet werden, wenn sie in eine Unterabfrage eingeschlossen sind. <br><br>  Wenn R-Funktionen verbunden sind, kopiert Vertica den Quellcode in seine Installation, die es in Maschinencode kompiliert.  Die nach dem Herstellen einer Verbindung zur Bibliothek auf den Server hochgeladene Quell-R-Datei wird f√ºr weitere Arbeiten nicht ben√∂tigt.  Die Geschwindigkeit der Funktionen unter Ber√ºcksichtigung der bin√§ren Kompilierung ist hoch genug, um mit gro√üen Datenfeldern zu arbeiten. Es ist jedoch zu beachten, dass alle R-Operationen im Speicher ausgef√ºhrt werden und das Risiko eines Austauschs besteht, wenn kein Betriebssystemspeicher vorhanden ist, um die Anforderungen der Zusammenarbeit von Vertica und R zu erf√ºllen . <br><br>  Wenn die Funktion auf der Partition der in PARTITION BY for OVER angegebenen Daten aufgerufen wird, parallelisiert Vertica die Ausf√ºhrung jeder Partition auf den Clusterservern.  Wenn also zus√§tzlich zum Maschinenmodell noch ein Hersteller im Datensatz vorhanden war, k√∂nnen Sie diesen in PARTITION BY angeben und die Analyse f√ºr jeden Hersteller parallelisieren. <br><br><h2>  Andere M√∂glichkeiten des maschinellen Lernens von Vertica </h2><br>  Zus√§tzlich zu R kann Vertica eigene Transformationsfunktionen in C, Java und Python entwickeln.  Jede Sprache hat ihre eigenen Nuancen und Merkmale beim Schreiben und Verbinden mit Vertica.  All dies zusammen mit seiner eigenen ML bietet Vertica eine gute Reserve f√ºr die pr√§diktive Datenanalyse. <br><br><h2>  Danke und Links </h2><br>  Ich m√∂chte meinem Freund und Kollegen Vlad Malofeev aus Perm aufrichtig danken, der mich mit R bekannt gemacht und mir geholfen hat, es bei einem unserer gemeinsamen Projekte herauszufinden. <br><br>  In einem Projekt, in dem anhand von Daten aus dem vergangenen Jahr eine Prognose unter schwierigen Bedingungen f√ºr die Zukunft erstellt wurde, versuchten die Entwickler zun√§chst, SQL und Java zu verwenden.  Dies verursachte gro√üe Schwierigkeiten bei der Ber√ºcksichtigung der Qualit√§t dieser Quellen und verlangsamte die Entwicklung des Projekts erheblich.  Vlad kam mit R zum Projekt, wir verbanden R mit Vertica, er fuhr die Daten ins Studio und alles drehte sich und drehte sich sofort wundersch√∂n.  Buchst√§blich in Wochen wurde alles, was monatelang dauerte, geharkt, um das Projekt vor komplexem Code zu bewahren. <br><br>  Die Beispieldaten mit Autos k√∂nnen aus dem GIT-Repository heruntergeladen werden: <br><br><pre> <code class="plaintext hljs">git clone https://github.com/vertica/Machine-Learning-Examples</code> </pre> <br>  und auf Vertica hochladen: <br><br><pre> <code class="plaintext hljs">/opt/vertica/bin/vsql -d &lt;name of your database&gt; -f load_ml_data.sql</code> </pre> <br>  Wenn Sie tiefer in ML einsteigen und lernen m√∂chten, wie man mit R arbeitet, empfehle ich ein Buch in russischer Sprache <b>‚ÄûR in Aktion‚Äú.</b>  <b>Analyse und Visualisierung von Daten in der R-Sprache</b> . <b>‚Äú</b>  Es ist in einer einfachen, zug√§nglichen menschlichen Sprache geschrieben und eignet sich f√ºr Anf√§nger, die noch nicht auf maschinelles Lernen gesto√üen sind. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hier sehen</a> Sie Informationen zum Verbinden der R-Bibliothek mit Vertica. <br><br>  F√ºr diejenigen, die bereits begonnen haben, ML in Python zu studieren und zu verwenden, lohnt es sich, auf das IDE-Rodeo zu achten. Dies ist ein Analogon von R Studio, da ohne interaktive Qualit√§tsanalyse keine Analyse m√∂glich ist.  Ich denke, dass alles, was in diesem Artikel unter R auf √§hnliche Weise beschrieben wird, in Python entwickelt werden kann, einschlie√ülich des Speicherns des Modells in UDF-Funktionen und der Entwicklung von Analysefunktionen f√ºr Vertica.  Wenn Sie √ºberpr√ºfen, vergessen Sie nicht, sich √ºber die Ergebnisse in den Kommentaren abzumelden, ich werde f√ºr die Informationen dankbar sein. <br><br>  Vielen Dank f√ºr Ihre Zeit und die Hoffnung, dass ich die Einfachheit und die unglaublichen F√§higkeiten der Symbiose von R und Vertica demonstrieren konnte. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de436306/">https://habr.com/ru/post/de436306/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de436296/index.html">explizit im Detail</a></li>
<li><a href="../de436298/index.html">Ideen vom Tisch: virtuelles Vinyl</a></li>
<li><a href="../de436300/index.html">9 Top-Sicherheitspraktiken bei Kubernetes</a></li>
<li><a href="../de436302/index.html">Erfahrung mit der realen Importsubstitution mit dem russischen AERODISK-Speichersystem</a></li>
<li><a href="../de436304/index.html">Zimbra Collaboration Suite und der Kampf gegen Phishing</a></li>
<li><a href="../de436308/index.html">Rostelecom k√∂nnte ein Monopolist auf dem Markt f√ºr Rechenzentren werden</a></li>
<li><a href="../de436310/index.html">Wie Ivan DevOps. Gegenstand des Einflusses</a></li>
<li><a href="../de436312/index.html">Sprachsynthese f√ºr neuronale Netze unter Verwendung der Tacotron 2-Architektur oder ‚ÄûGet Alignment or Die Tryin '‚Äú</a></li>
<li><a href="../de436314/index.html">Das japanische Robo-Hotel "feuerte" die H√§lfte seiner Roboter aufgrund der von ihnen verursachten Probleme</a></li>
<li><a href="../de436316/index.html">Wie Smartcards IT-Projekte vorantreiben</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>