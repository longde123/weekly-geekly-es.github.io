<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✌️ 📌 🦏 一二三 Google Sheets的聊天机器人，以Alice的PvP游戏为例 😵 💲 🚆</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="出现后，爱丽丝以出乎意料的高质量语音合成和聊天机器人吸引了用户。 如今，她有望拥有有用的技能和有趣的游戏，其后端可以考虑用户的上下文并实现各种场景。 本文讨论了基于Google Sheets的一项技能的创建，Google Sheets是许多人所熟悉的工具，对于小型聊天机器人来说具有很大的潜力。 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>一二三 Google Sheets的聊天机器人，以Alice的PvP游戏为例</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414213/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/je/rg/em/jergemafxw-e_63-gibe4edxyie.png"></div><br> 出现后，爱丽丝以出乎意料的高质量语音合成和聊天机器人吸引了用户。 如今，她有望拥有有用的技能和有趣的游戏，其后端可以考虑用户的上下文并实现各种场景。 本文讨论了基于Google Sheets的一项技能的创建，Google Sheets是许多人所熟悉的工具，对于小型聊天机器人来说具有很大的潜力。 <br><br> 与真实人物玩游戏比与虚拟人物玩游戏更有趣，因此，举例来说，我们将为爱丽丝开发一款多人游戏。 <br><a name="habracut"></a><br><h2> 一个！ 对话对话 </h2><br> 游戏从规则开始。 我想到了这些：两个玩家中的每一个首先在三扇门后面放置一个宝物和一个陷阱，然后打开对手的任何一扇门。 打开宝藏-获取对手的硬币，打开陷阱-将硬币交给他。 硬币数量（从1到3）由玩家自己决定。 剩下的门后面是潘多拉魔盒（Pandora's box），您可以打开它找到/丢掉一些硬币。 您可以与Alice一起玩，也可以与其他用户一起玩。 <br><br> 爱丽丝的界面以对话形式解决，所有游戏互动均应通过消息传递实现。 游戏服务器对每个消息的处理由以下步骤表示： <br><br><ol><li> 恢复用户上下文； </li><li> 恢复上下文中的查询解释； </li><li> 形成响应消息； </li><li> 保存更改的用户上下文。 </li></ol><br><h3> 恢复并保存用户上下文 </h3><br> 用户的上下文包括他在游戏中的状态，包括以前的结果，脚本内的步骤和当前的对手以及用户名和游戏逻辑所需的其他信息。 <br><br> 在每个请求中， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">根据协议</a> ，Alice传递用户ID。 这足以保存并随后还原其上下文。 <br><br> 作为数据仓库，请使用Google表格。 该解决方案的客观优势包括免费使用，可见性和易用性。 内置的脚本编辑器允许您在Apps脚本（基于JavaScript）中描述游戏的逻辑，参考API表并将其发布为Web应用程序。 <br><br> 创建具有必要标题的表后，您可以转到脚本编辑器： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jd/rh/bo/jdrhbosnzge_mq5ms5h0oqnsnqo.png"></div><br> 可以在Apps脚本的一个项目中描述游戏的逻辑，将其组织为一组gs文件，然后进行发布： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nk/w0/kn/nkw0kn0ghmmskohgbtk_nefgc3o.png"></div><br> 发布时，必须指定应用程序对匿名用户的可用性： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/g1/sw/fq/g1swfqcp998ufhh96b6lvqb64x0.png"></div><br> 在输出时，您将获得发布的Web应用程序的URL。 脚本中的doGet（）和doPost（）函数将处理相应类型的请求，以便接收和保存用户上下文。 <br><br> 下面是使用API​​表进行数据处理的示意图： <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  var sheet = SpreadsheetApp.openById("&lt;id &gt;").getSheetByName("&lt; &gt;"); //  var range = sheet.getRange(&lt; &gt;); //   var values = range.getValues(); //    range.setValues(&lt; &gt;);</span></span></code> </pre> <br><h3> 在还原的上下文中解释请求 </h3><br> 在一般情况下，正确解释文本查询需要使用智能NLU算法。 而且，尽管这类算法在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Aimylogic所描述的</a>简单工具中都可以使用，但在这种情况下，我还是决定放弃自然语言处理， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">以求</a>简化。 <br><br> 在拟议的游戏中，玩家与爱丽丝的互动限于十二种可能的状态，并且可以减少为一小部分意图。 为简单起见，我总是向玩家提供三种可能的动作：发送“一个”，“两个”或“三个”。 对于其他任何请求，Alice要求澄清操作。 <br><br> 在这种情况下，该方案可归结为以下Apps脚本代码： <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     switch(user.state){ case "start": //       switch(utterance){ case “1️⃣ ”: case “2️⃣ ”: case “3️⃣ ”: //     default: //     } break; //    default: //      }</span></span></code> </pre><br> 对于用户，这样解决的交互表示为三个选项之一的选择，其含义在每个Alice的答案中均已明确定义。 选项本身由“一个”，“两个”，“三个”按钮表示，可显着加快游戏速度。 <br><br><h3> 响应消息生成 </h3><br> 爱丽丝的答案包括几个部分，每个部分都需要形成，包括： <br><br><ul><li> 要在屏幕上显示的文本； </li><li> 用于语音合成的文本； </li><li> 提示按钮集。 </li></ul><br> 最近，我提出了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">EASY对话</a>的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">概念</a> ，描述了设计对话界面的原理，包括针对Alice的对话。 爱丽丝的响应格式允许实现这些原则。 <br><br> 因此，将显示的文字和语音文字分开，可以使答案更加简洁自然。 您不能强迫Alice合成用户已经熟悉的长文本，也不能在消息文本和按钮名称中使用表情符号。 <br><br> 提示按钮实现了主动性原则：Alice总是指出并建议可能的措施以继续对话。 在建议的游戏场景中，按钮列表不取决于上下文，而是添加到每个消息中。 <br><br> 因此，我们有一个Google Table，其中包含通过网络应用程序的URL存储和检索的用户数据。 该应用程序是用Apps脚本编写的，它根据其上下文解释用户的操作并为响应消息生成数据。 <br><br> 它仍然可以连接到爱丽丝... <br><br><h2> 两个！ 整合性 </h2><br>  Yandex.Dialogs允许开发人员向Alice添加他们的技能。 连接技能可归结为三点： <br><br><ul><li> 激活 </li><li> 设计 </li><li> 网页挂钩。 </li></ul><br><h3> 激活与设计 </h3><br> 对于激活，重要的是选择一个爱丽丝能够很好地识别并符合Yandex <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">正式要求的</a>短语。 如果激活名称中有数字，请从键盘和语音输入时分别检查激活。 <br><br> 技能设计包括名称，说明，图标，类别等。 <br> 值得考虑的是，在目录中的技能列表中，仅显示图标和激活短语，并且目录中的搜索主要根据描述进行。 <br><br><h3> 获取网页挂钩 </h3><br> 网络挂钩是Alice将向您的技能发送消息并等待上述格式的JSON响应的地址。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/za/zy/4t/zazy4tve59hnchb4quwuokqv6ju.png"></div><br><br> 默认情况下，在Apps Script上创建的Web应用程序以html页面的形式返回响应，但是使用ContentService时，它也可以被强制返回JSON： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ContentService.createTextOutput(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">JSON</span></span></span></span><span class="xml"><span class="hljs-tag"> &gt;</span></span></span><span class="xml">)) .setMimeType(ContentService.MimeType.JSON);</span></span></code> </pre> <br> 但是，在使用ContentService时，Google会将用户的请求重定向到一个临时URL，而Yandex.Dialogs尚未准备好。 因此，Web应用程序的地址不适合用作Web挂钩。 <br><br> 有免费的服务提供适合Alice的Web挂钩， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">例如Zenbot</a> 。 在Zenbot中，对于所建议的游戏，您可以编写一个简短的脚本来访问Google Web应用程序并返回响应以及按钮。 顺便说一句，通过这种方式，游戏不仅可以与Alice集成，而且可以与其他渠道集成。 <br><br> 下面是提供游戏“一，二，三！”的示例脚本。 在Telegram机器人@RazDvaTriBot中： <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">context</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pattern</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$Text"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">var</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Utterance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$Text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">scope</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"input"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">get</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">url</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://script.google.com/macros/s/&lt;id -&gt;/exec"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">var</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Result"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"userId"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$req_telegram_chat"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utterance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$Utterance"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"channel"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"telegram"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">get</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">var</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Answer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'javascript: $Result.text'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">output</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$Answer"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sample</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sample</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">context</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br> 为了更灵活地处理请求，您可以使用例如Google App Engine编写自己的服务器。 该工具也可以免费使用。 <br><br> 在Google App Engine中创建一个项目后，您可以使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Cloud Shell</a>界面在一个网页上编写服务器代码，然后将其部署到https：// &lt;project id&gt; .appspot.com形式的所需URL，这将是Web挂钩的地址。 <br><br> 服务器操作包括以下步骤： <br><br><ol><li> 接收来自爱丽丝的请求数据； </li><li> 与游戏的网络应用程序进行交互； </li><li> 发送爱丽丝格式的回复。 </li></ol><br><h4> 接收/发送爱丽丝数据 </h4><br> 从Alice中获取会话，用户，消息的标识符以及请求的文本很重要。 以下是PHP中的示例： <br><br><pre> <code class="php hljs"> $data = json_decode(file_get_contents(<span class="hljs-string"><span class="hljs-string">"php://input"</span></span>)); $session_id = $data-&gt;session-&gt;session_id; $user_id = $data-&gt;session-&gt;user_id; $utterance = $data-&gt;request-&gt;original_utterance; $messageId = $data-&gt;session-&gt;message_id;</code> </pre><br> 作为答案，提示按钮和文本将返回到游戏中以进行显示和发音： <br><br><pre> <code class="php hljs"> $button1 = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1️⃣ '</span></span>, <span class="hljs-string"><span class="hljs-string">'hide'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $button2 = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'2️⃣ '</span></span>, <span class="hljs-string"><span class="hljs-string">'hide'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $button3 = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3️⃣ '</span></span>, <span class="hljs-string"><span class="hljs-string">'hide'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $yaButtons = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($button1, $button2, $button3); $yaResponse = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'text'</span></span> =&gt; $text, <span class="hljs-string"><span class="hljs-string">'tts'</span></span> =&gt; $tts, <span class="hljs-string"><span class="hljs-string">'buttons'</span></span> =&gt; $yaButtons, <span class="hljs-string"><span class="hljs-string">'end_session'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); $yaSession = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'session_id'</span></span> =&gt; $session_id, <span class="hljs-string"><span class="hljs-string">'message_id'</span></span> =&gt; $messageId, <span class="hljs-string"><span class="hljs-string">'user_id'</span></span> =&gt; $user_id); $yaResult = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'response'</span></span> =&gt; $yaResponse, <span class="hljs-string"><span class="hljs-string">'session'</span></span> =&gt; $yaSession, <span class="hljs-string"><span class="hljs-string">'version'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1.0'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode($yaResult);</code> </pre><br><h2> 三！ 同步处理 </h2><br> 从Web应用程序发送/接收数据需要时间，而且Alice渴望为用户提供答案，因此同步问题会干扰此问题。 <br><br> 自然，对于大型项目，Google表格不适合作为Alice技能的后端：响应时间随着大量并行请求而增加。 尽管如此，仍有一些建议可以优化聊天机器人，从而使一个小型项目在实时交互式对话系统中可行。 <br><br> 爱丽丝的同步协议超时-每个响应1.5秒。 如果服务器在此期间没有时间给出答案，则用户会本着“对不起，&lt;对话框名称&gt;没有响应”的精神看到一条悲伤的消息。 系统不提供任何线索下一步该怎么做。 <br><br> 为避免这种情况，您可以而且应该加快服务速度，并跟踪和处理超时。 游戏脚本操作期间最冗长的操作是读取和写入表数据。 因此，首先，这些操作的数量必须最小化，其次，希望将它们并行化。 <br><br> 一次读取表数据。 执行完逻辑后，脚本可以在结果记录结束之前立即为用户提供答案。 <br><br> 应允许在有限的时间内接收响应-例如1100毫秒： <br><br><pre> <code class="php hljs"> $request_params = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'userId'</span></span> =&gt; $user_id, <span class="hljs-string"><span class="hljs-string">'utterance'</span></span> =&gt; $utterance, <span class="hljs-string"><span class="hljs-string">'channel'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'alice'</span></span> ); $get_params = http_build_query($request_params); $ctx = stream_context_create(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>=&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'timeout'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1.1</span></span> ) )); $answer = file_get_contents(<span class="hljs-string"><span class="hljs-string">'https://script.google.com/macros/s/&lt;id -&gt;/exec?'</span></span>. $get_params, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, $ctx);</code> </pre><br> 如果GET请求准时收到了响应，我们可以将其发送给用户，并通过POST请求在后台启动结果保存。 否则，我们为用户提供带有按钮的存根文本以继续，并忽略脚本的结果，以便用户可以在当前上下文中重复其请求。 <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($answer === <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>) { $text = <span class="hljs-string"><span class="hljs-string">' ,   .'</span></span>; $tts = <span class="hljs-string"><span class="hljs-string">',   .'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $answer = json_decode($answer); $text = $answer-&gt;text; $tts = $answer-&gt;tts; <span class="hljs-comment"><span class="hljs-comment">//   $data2store = $answer-&gt;data; $postdata = json_encode(array( 'data' =&gt; $data2store )); $opts = array('http' =&gt; array( 'method' =&gt; 'POST', 'header' =&gt; 'Content-Type: application/json', 'content' =&gt; $postdata, 'timeout' =&gt; 0.1 ) ); $context = stream_context_create($opts); file_get_contents("https://script.google.com/macros/s/&lt;id -&gt;/exec", false, $context); }</span></span></code> </pre><br><img src="https://habrastorage.org/webt/a1/ez/od/a1ezodgm9tqdt2gudd7vfes9bn0.png" width="320" align="right"><br> 在Alice的多人游戏中，必须在游戏服务器和Yandex之间以及玩家之间解决同步任务。 如果玩家想与其他用户对战，则游戏本身会从最近想玩的对手中选择对手。 用户必须确认他们愿意互相玩游戏才能开始游戏。 <br><br> 目前，该技能无法启动向爱丽丝的用户发送消息。 因此，游戏脚本可用于检查对手的准备情况以及为比赛一轮分配的时间。 如果对手延迟游戏，则提示用户等待他：“还等对手吗？” 通过同意等待，用户将开始另一个检查。 如果游戏分钟结束，则游戏结束。 <br><br><h2> 结论 </h2><br>  Google表格作为聊天机器人后端的优势（免费除外）包括以下事实：它是开发过程中的调试工具，之后它成为技能管理员的控制台，可以通过任何设备进行协作编辑。 通过缺点-大量用户同时运行的延迟。 <br><br clear="right"> 我希望本文能帮助发烧友和开发人员快速为Alice或其他渠道创建有用的技能。 拟议的游戏可在Yandex.Dialog技能商店中找到，名称为“ 1、2、3 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">！</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">多人游戏</a> 。” <br><br> 除通用工具外，还有用于聊天机器人开发的专用解决方案。 我邀请读者参加关于我在该领域所知服务的小型调查。 该列表未包含所有现有产品-如果您使用其他工具，请提供带有名称的评论和简短评论，我们将不胜感激。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN414213/">https://habr.com/ru/post/zh-CN414213/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN414201/index.html">神码（GOD'S码）</a></li>
<li><a href="../zh-CN414203/index.html">骗局还是不骗局？ 我们通过五种方法检查ICO</a></li>
<li><a href="../zh-CN414207/index.html">创新者的问题，或为什么需要求助于他人的经验</a></li>
<li><a href="../zh-CN414209/index.html">IGNG-增量神经气体增量算法</a></li>
<li><a href="../zh-CN414211/index.html">基于W5500和ATMEGA8的TELNET服务器的开发</a></li>
<li><a href="../zh-CN414215/index.html">芯片中的自定义模块（Silicon IP）：工作原理</a></li>
<li><a href="../zh-CN414217/index.html">Vertex本地智能手机：质量第一，芯片第一，设计第一</a></li>
<li><a href="../zh-CN414219/index.html">莫斯科地区使用太阳能的经验：支持，反对和需要谁</a></li>
<li><a href="../zh-CN414221/index.html">在Swift 4中解析和使用Codable</a></li>
<li><a href="../zh-CN414223/index.html">C＃：向后兼容和重载</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>