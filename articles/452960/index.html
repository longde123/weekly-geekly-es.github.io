<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìù üéª üé≠ ¬°Responder√°s por todo! Contratos dirigidos por el consumidor a trav√©s de los ojos del desarrollador üë©üèæ‚Äçüè≠ ‚ùî üÜï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este art√≠culo, hablaremos sobre los problemas que resuelve Consumer Driven Contracts y mostraremos c√≥mo aplicarlo utilizando el ejemplo de Pact wit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>¬°Responder√°s por todo! Contratos dirigidos por el consumidor a trav√©s de los ojos del desarrollador</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/452960/">  En este art√≠culo, hablaremos sobre los problemas que resuelve Consumer Driven Contracts y mostraremos c√≥mo aplicarlo utilizando el ejemplo de Pact with Node.js y Spring Boot.  Y habla sobre las limitaciones de este enfoque. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gu/vg/za/guvgzadja02vflw5bi8mgh_wbbo.png"></div><br><h2>  Problema </h2><br>  Cuando se prueban productos, a menudo se usan pruebas de escenarios en las que se verifica la integraci√≥n de varios componentes del sistema en un entorno especialmente seleccionado.  Tales pruebas en los servicios en vivo dan el resultado m√°s confiable (sin contar las pruebas en la batalla).  Pero al mismo tiempo, son uno de los m√°s caros. <br><a name="habracut"></a><br><ul><li>  A menudo se cree err√≥neamente que el entorno de integraci√≥n no debe ser tolerante a fallas.  SLA, las garant√≠as para tales entornos rara vez se expresan, pero si no est√° disponible, los equipos tienen que retrasar los lanzamientos o esperar lo mejor e ir a la batalla sin pruebas.  Aunque todos saben que la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">esperanza no es una estrategia</a> .  Y las nuevas tecnolog√≠as de infraestructura solo complican el trabajo con entornos de integraci√≥n. </li><li>  <b>Otro dolor es trabajar con datos de prueba</b> .  Muchos escenarios requieren un cierto estado del sistema, accesorios.  ¬øQu√© tan cerca deber√≠an estar de combatir los datos?  ¬øC√≥mo actualizarlos antes de la prueba y limpiarlos una vez finalizados? </li><li> <b>Las pruebas son demasiado inestables</b> .  Y no solo por la infraestructura que mencionamos en el primer p√°rrafo.  ¬°La prueba puede fallar porque un equipo vecino lanz√≥ sus propios controles que rompieron el estado esperado del sistema!  Muchos cheques falsos negativos, pruebas escamosas terminan sus vidas en <code>@Ignored</code> .  Adem√°s, diferentes partes de la integraci√≥n pueden ser compatibles con diferentes equipos.  Lanzaron un nuevo candidato de lanzamiento con errores: rompieron a todos los consumidores.  Alguien resuelve este problema con bucles de prueba dedicados.  Pero a costa de multiplicar el costo del soporte. </li><li>  <b>Tales pruebas toman mucho tiempo</b> .  Incluso teniendo en cuenta la automatizaci√≥n, se pueden esperar resultados durante horas. </li><li>  Y para colmo, si la prueba realmente cay√≥ bien, est√° lejos de ser siempre posible encontrar inmediatamente la causa del problema.  Puede esconderse profundamente detr√°s de las capas de integraci√≥n.  O puede ser el resultado de una combinaci√≥n inesperada de estados de muchos componentes del sistema. </li></ul><br>  Las pruebas estables en un entorno de integraci√≥n requieren una inversi√≥n seria de control de calidad, desarrollo e incluso operaciones.  No es de extra√±ar que est√©n en la cima de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pir√°mide de prueba</a> .  Tales pruebas son √∫tiles, pero la econom√≠a de recursos no les permite verificarlo todo.  La principal fuente de su valor es el medio ambiente. <br><br>  Debajo de la misma pir√°mide hay otras pruebas en las que intercambiamos confianza por peque√±os dolores de cabeza de soporte, utilizando comprobaciones de aislamiento.  Cuanto m√°s granular, cuanto menor sea la escala de la prueba, menor ser√° la dependencia del entorno externo.  En la parte inferior de la pir√°mide hay pruebas unitarias.  Verificamos funciones individuales, clases, operamos no tanto con la sem√°ntica empresarial como con las construcciones de una implementaci√≥n espec√≠fica.  Estas pruebas dan retroalimentaci√≥n r√°pida. <br><br>  Pero tan pronto como bajemos por la pir√°mide, tenemos que reemplazar el medio ambiente con algo.  Los talones aparecen, como servicios completos y entidades individuales del lenguaje de programaci√≥n.  Es con la ayuda de enchufes que podemos probar los componentes de forma aislada.  Pero tambi√©n reducen la validez de los cheques.  ¬øC√≥mo asegurarse de que el c√≥digo auxiliar devuelve los datos correctos?  ¬øC√≥mo garantizar su calidad? <br><br>  <b>La soluci√≥n puede ser una documentaci√≥n completa</b> que describa varios escenarios y posibles estados de los componentes del sistema.  Pero cualquier formulaci√≥n a√∫n deja libertad de interpretaci√≥n.  Por lo tanto, una buena documentaci√≥n es un artefacto vivo que mejora constantemente a medida que el equipo comprende el √°rea del problema.  ¬øC√≥mo, entonces, garantizar el cumplimiento de los talones de documentaci√≥n? <br><br>  En muchos proyectos, puede observar una situaci√≥n en la que los talones est√°n escritos por los mismos tipos que desarrollaron el artefacto de prueba.  Por ejemplo, los desarrolladores de aplicaciones m√≥viles hacen stubs para sus propias pruebas.  Como resultado, los programadores pueden comprender la documentaci√≥n a su manera (lo cual es completamente normal), crean el c√≥digo auxiliar con el comportamiento esperado incorrecto, escriben el c√≥digo de acuerdo con √©l (con pruebas verdes) y se generan errores de integraci√≥n reales. <br><br>  Adem√°s, la documentaci√≥n generalmente se mueve hacia abajo: los clientes usan especificaciones de servicios (en este caso, otro servicio puede ser un cliente del servicio).  No expresa <strong>c√≥mo los</strong> consumidores usan los datos, qu√© datos se necesitan en absoluto, qu√© suposiciones hacen para esos datos.  La consecuencia de esta ignorancia es la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ley de Hyrum</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ek/bh/ho/ekbhhofe0ox95w50drdg8tybsbi.png" width="300"></div><br><br>  Hyrum Wright ha estado desarrollando herramientas p√∫blicas dentro de Google durante mucho tiempo y ha observado c√≥mo los cambios m√°s peque√±os pueden causar fallas en los clientes que utilizaron las funciones impl√≠citas (indocumentadas) de sus bibliotecas.  Dicha conectividad oculta complica la evoluci√≥n de la API. <br><br>  Estos problemas pueden resolverse hasta cierto punto mediante contratos dirigidos por el consumidor.  Al igual que cualquier enfoque y herramienta, tiene un rango de aplicabilidad y costo, que tambi√©n consideraremos.  Las implementaciones de este enfoque han alcanzado un nivel de madurez suficiente para probar sus proyectos. <br><br><h2>  ¬øQu√© es un CDC? </h2><br>  Tres elementos clave: <br><br><ul><li>  <b>El contrato</b>  Descrito usando algunos DSL, dependiendo de la implementaci√≥n.  Contiene una descripci√≥n de la API en forma de escenarios de interacci√≥n: si llega una solicitud espec√≠fica, entonces el cliente debe recibir una respuesta espec√≠fica. </li><li>  <b>Pruebas de clientes</b> .  Adem√°s, utilizan un trozo, que se genera autom√°ticamente a partir del contrato. </li><li>  <b>Pruebas para la API</b> .  Tambi√©n se generan a partir del contrato. </li></ul><br>  Por lo tanto, el contrato es ejecutable.  Y la caracter√≠stica principal del enfoque es que los requisitos para el comportamiento de la API van desde el cliente hasta el servidor. <br><br>  El contrato se centra en el comportamiento que <strong>realmente le</strong> importa al consumidor.  Hace expl√≠citas sus suposiciones sobre la API. <br><br>  El objetivo principal de los CDC es brindar una comprensi√≥n del comportamiento de la API a sus desarrolladores y a los desarrolladores de sus clientes.  Este enfoque se combina bien con BDD, en las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">reuniones de tres amigos</a> puede esbozar los espacios en blanco para el contrato.  En definitiva, este contrato tambi√©n sirve para mejorar las comunicaciones;  compartir una comprensi√≥n com√∫n del √°rea del problema e implementar la soluci√≥n dentro y entre los equipos. <br><br><h2>  Pacto </h2><br>  Considere usar CDC como ejemplo de Pact, una de sus implementaciones.  Supongamos que hacemos una aplicaci√≥n web para los participantes de la conferencia.  En la pr√≥xima iteraci√≥n, el equipo desarrolla un cronograma de presentaci√≥n, hasta ahora sin historias como votaci√≥n o notas, solo la salida de la cuadr√≠cula de informes.  El c√≥digo fuente para el ejemplo est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br>  En una reuni√≥n de <s>tres</s> cuatro amigos, se re√∫nen un producto, un probador, desarrolladores del backend y una aplicaci√≥n m√≥vil.  Dicen que <br><br><ul><li>  Se mostrar√° una lista con el texto en la interfaz de usuario: T√≠tulo del informe + Ponentes + Fecha y hora. </li><li>  Para hacer esto, el back-end debe devolver datos como en el ejemplo a continuaci√≥n. </li></ul><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"talks"</span></span>:[ { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>:<span class="hljs-string"><span class="hljs-string">"      "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"speakers"</span></span>:[ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">" "</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"time"</span></span>:<span class="hljs-string"><span class="hljs-string">"2019-05-27T12:00:00+03:00"</span></span> } ] }</code> </pre> <br>  Despu√©s de lo cual el desarrollador frontend va a escribir el c√≥digo del cliente (backend para frontend).  Instala una biblioteca de contrato de pacto en el proyecto: <br><br><pre> <code class="bash hljs">yarn add --dev @pact-foundation/pact</code> </pre> <br>  Y comienza a escribir una prueba.  Configura el servidor de c√≥digo auxiliar local, que simular√° el servicio con programaciones de informes: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> provider = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pact({ <span class="hljs-comment"><span class="hljs-comment">//      consumer: "schedule-consumer", provider: "schedule-producer", // ,     port: pactServerPort, //  pact     log: path.resolve(process.cwd(), "logs", "pact.log"), // ,     dir: path.resolve(process.cwd(), "pacts"), logLevel: "WARN", //  DSL  spec: 2 });</span></span></code> </pre> <br>  El contrato es un archivo JSON que describe los escenarios en los que el cliente interact√∫a con el servicio.  Pero no es necesario que lo describa manualmente, ya que se forma a partir de la configuraci√≥n del c√≥digo auxiliar en el c√≥digo.  El desarrollador antes de la prueba describe el siguiente comportamiento. <br><br><pre> <code class="javascript hljs">provider.setup().then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> provider .addInteraction({ <span class="hljs-attr"><span class="hljs-attr">uponReceiving</span></span>: <span class="hljs-string"><span class="hljs-string">"a request for schedule"</span></span>, <span class="hljs-attr"><span class="hljs-attr">withRequest</span></span>: { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">"/schedule"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">willRespondWith</span></span>: { <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: { <span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>: <span class="hljs-string"><span class="hljs-string">"application/json;charset=UTF-8"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">body</span></span>: { <span class="hljs-attr"><span class="hljs-attr">talks</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">"      "</span></span>, <span class="hljs-attr"><span class="hljs-attr">speakers</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">time</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-05-27T12:00:00+03:00"</span></span> } ] } } }) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> done()) );</code> </pre> <br>  Aqu√≠, en el ejemplo, especificamos la solicitud de servicio esperada espec√≠fica, pero pact-js tambi√©n admite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">varios m√©todos para determinar coincidencias</a> . <br><br>  Finalmente, el programador escribe una prueba de esa parte del c√≥digo que usa este c√≥digo auxiliar.  En el siguiente ejemplo, lo llamaremos directamente por simplicidad. <br><br><pre> <code class="javascript hljs">it(<span class="hljs-string"><span class="hljs-string">"fetches schedule"</span></span>, done =&gt; { fetch(<span class="hljs-string"><span class="hljs-string">`http://localhost:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${pactServerPort}</span></span></span><span class="hljs-string">/schedule`</span></span>) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function"> =&gt;</span></span> response.json()) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">json</span></span></span><span class="hljs-function"> =&gt;</span></span> expect(json).toStrictEqual({ <span class="hljs-attr"><span class="hljs-attr">talks</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">"      "</span></span>, <span class="hljs-attr"><span class="hljs-attr">speakers</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">time</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-05-27T12:00:00+03:00"</span></span> } ] })) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> done()); });</code> </pre> <br>  En un proyecto real, esto puede ser una prueba de unidad r√°pida de una funci√≥n de interpretaci√≥n de respuesta separada o una prueba de IU lenta para mostrar los datos recibidos de un servicio. <br><br>  Durante la ejecuci√≥n de la prueba, pact verifica que el c√≥digo auxiliar recibi√≥ la solicitud especificada en las pruebas.  Las discrepancias pueden verse como diferencias en el archivo pact.log. <br><br><pre> <code class="plaintext hljs">E, [2019-05-21T01:01:55.810194 #78394] ERROR -- : Diff with interaction: "a request for schedule" Diff -------------------------------------- Key: - is expected + is actual Matching keys and values are not shown { "headers": { - "Accept": "application/json" + "Accept": "*/*" } } Description of differences -------------------------------------- * Expected "application/json" but got "*/*" at $.headers.Accept</code> </pre> <br><br>  Si la prueba tiene √©xito, se genera un contrato en formato JSON.  Describe el comportamiento esperado de la API. <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"consumer"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"schedule-consumer"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"provider"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"schedule-producer"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"interactions"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"a request for schedule"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"request"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"/schedule"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"headers"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Accept"</span></span>: <span class="hljs-string"><span class="hljs-string">"application/json"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"status"</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-attr"><span class="hljs-attr">"headers"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Content-Type"</span></span>: <span class="hljs-string"><span class="hljs-string">"application/json;charset=UTF-8"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"body"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"talks"</span></span>:[ { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>:<span class="hljs-string"><span class="hljs-string">"      "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"speakers"</span></span>:[ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">" "</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"time"</span></span>:<span class="hljs-string"><span class="hljs-string">"2019-05-27T12:00:00+03:00"</span></span> } ] }}} ], <span class="hljs-attr"><span class="hljs-attr">"metadata"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"pactSpecification"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.0.0"</span></span> } } }</code> </pre> <br>  √âl le da este contrato al desarrollador de back-end.  Digamos que la API est√° en Spring Boot.  Pact tiene una biblioteca pact <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">-jvm-provider-spring</a> que puede funcionar con MockMVC.  Pero echaremos un vistazo al Spring Cloud Contract, que implementa los CDC en el ecosistema de Spring.  Utiliza su propio formato de contratos, pero tambi√©n tiene un punto de extensi√≥n para conectar convertidores de otros formatos.  Su formato de contrato nativo solo es compatible con el propio Spring Cloud Contract, a diferencia de Pact, que tiene bibliotecas para JVM, Ruby, JS, Go, Python, etc. <br><br>  Supongamos, en nuestro ejemplo, que el desarrollador de back-end usa Gradle para construir el servicio.  Conecta las siguientes dependencias: <br><br><pre> <code class="plaintext hljs">buildscript { // ... dependencies { classpath "org.springframework.cloud:spring-cloud-contract-pact:2.1.1.RELEASE" } } plugins { id "org.springframework.cloud.contract" version "2.1.1.RELEASE" // ... } // ... dependencies { // ... testImplementation 'org.springframework.cloud:spring-cloud-starter-contract-verifier' }</code> </pre> <br>  Y coloca el contrato del Pacto recibido del frotender en el directorio <code>src/test/resources/contracts</code> . <br><br>  De √©l, por defecto, el complemento spring-cloud-contract resta contratos.  Durante el ensamblaje, se ejecuta la tarea gradle generateContractTests, que genera la siguiente prueba en el directorio build / generate-test-sources. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContractVerifierTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContractsBaseTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate_aggregator_client_aggregator_service</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// given: MockMvcRequestSpecification request = given() .header("Accept", "application/json"); // when: ResponseOptions response = given().spec(request) .get("/scheduler"); // then: assertThat(response.statusCode()).isEqualTo(200); assertThat(response.header("Content-Type")).isEqualTo("application/json;charset=UTF-8"); // and: DocumentContext parsedJson = JsonPath.parse(response.getBody().asString()); assertThatJson(parsedJson).array("['talks']").array("['speakers']").contains("['name']").isEqualTo( /*...*/ ); assertThatJson(parsedJson).array("['talks']").contains("['time']").isEqualTo( /*...*/ ); assertThatJson(parsedJson).array("['talks']").contains("['title']").isEqualTo( /*...*/ ); } }</span></span></code> </pre> <br><br>  Al comenzar esta prueba, veremos un error: <br><br><pre> <code class="plaintext hljs">java.lang.IllegalStateException: You haven't configured a MockMVC instance. You can do this statically</code> </pre> <br>  Dado que podemos usar diferentes herramientas para las pruebas, necesitamos decirle al complemento cu√°l hemos configurado.  Esto se realiza a trav√©s de la clase base, que heredar√° las pruebas generadas a partir de los contratos. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContractsBaseTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ScheduleController scheduleController = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ScheduleController(); <span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ RestAssuredMockMvc.standaloneSetup(scheduleController); } }</code> </pre> <br><br>  Para usar esta clase base durante la generaci√≥n, debe configurar el complemento gradle spring-cloud-contract. <br><br><pre> <code class="plaintext hljs">contracts { baseClassForTests = 'ru.example.schedule.ContractsBaseTest' }</code> </pre> <br><br>  Ahora tenemos la siguiente prueba generada: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContractVerifierTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContractsBaseTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate_aggregator_client_aggregator_service</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... } }</span></span></code> </pre> <br>  La prueba comienza con √©xito, pero falla con un error de verificaci√≥n: el desarrollador a√∫n no ha escrito la implementaci√≥n del servicio.  Pero ahora puede hacerlo en base a un contrato.  Puede asegurarse de poder procesar la solicitud del cliente y devolver la respuesta esperada. <br><br>  El desarrollador del servicio sabe a trav√©s del contrato qu√© necesita hacer, qu√© comportamiento implementar. <br><br>  El pacto puede integrarse m√°s profundamente en el proceso de desarrollo.  Puede implementar un agente de Pact que agregue dichos contratos, admita su control de versiones y pueda mostrar un gr√°fico de dependencia. <br><br><img src="https://habrastorage.org/webt/dq/pd/v0/dqpdv0c4qk89kboewjxrafys1iq.png"><br><br>  La carga de un nuevo contrato generado al intermediario se puede realizar en el paso CI al construir el cliente.  Y en el c√≥digo del servidor indique la carga din√°mica del contrato por URL.  Spring Cloud Contract tambi√©n es compatible con esto. <br><br><h2>  Aplicabilidad de los CDC </h2><br>  ¬øCu√°les son las limitaciones de los contratos dirigidos por el consumidor? <br><br>  Para utilizar este enfoque <b>, debe pagar con herramientas adicionales</b> como pacto.  Los contratos per se son un artefacto adicional, otra abstracci√≥n que debe mantenerse cuidadosamente y aplicarse conscientemente pr√°cticas de ingenier√≠a. <br><br>  <b>No reemplazan las pruebas e2e</b> , ya que los stubs siguen siendo stubs: modelos de componentes del sistema real, que pueden ser un poco, pero no se corresponden con la realidad.  A trav√©s de ellos, los escenarios complejos no se pueden verificar. <br><br>  Adem√°s, los <b>CDC no reemplazan las pruebas funcionales de API</b> .  Son m√°s caros de soportar que las pruebas de unidades antiguas simples.  Los desarrolladores de pactos recomiendan utilizar las siguientes heur√≠sticas: si elimina el contrato y esto no causa errores o malas interpretaciones por parte del cliente, entonces no es necesario.  Por ejemplo, no es necesario describir absolutamente todos los c√≥digos de error de API a trav√©s de un contrato si el cliente los procesa de la misma manera.  En otras palabras, el contrato describe para el servicio <strong>solo lo que es importante para su cliente</strong> .  No m√°s, pero no menos. <br><br>  Demasiados contratos tambi√©n complican la evoluci√≥n de la API.  <b>Cada contrato adicional es una ocasi√≥n para pruebas rojas</b> .  Es necesario dise√±ar un CDC de tal manera que cada prueba de falla lleve una carga sem√°ntica √∫til que supere el costo de su soporte.  Por ejemplo, si el contrato fija la longitud m√≠nima de un determinado campo de texto que es indiferente al consumidor (√©l usa la t√©cnica <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Toleran Reader</a> ), entonces cada cambio a este valor m√≠nimo romper√° el contrato y los nervios de quienes lo rodean.  Dicha verificaci√≥n debe transferirse al nivel de la API misma e implementarse seg√∫n la fuente de restricciones. <br><br><h2>  Conclusi√≥n </h2><br>  Los CDC mejoran la calidad del producto al describir expl√≠citamente el comportamiento de integraci√≥n.  Ayuda a los clientes y desarrolladores de servicios a alcanzar un entendimiento com√∫n, le permite hablar a trav√©s del c√≥digo.  Pero esto tiene el costo de agregar herramientas, introducir nuevas abstracciones y acciones adicionales de los miembros del equipo. <br><br>  Al mismo tiempo, las herramientas y los marcos de trabajo de los CDC se est√°n desarrollando activamente y ya han alcanzado la madurez para las pruebas en sus proyectos.  Prueba :) <br><br><blockquote>  En la conferencia QualityConf del 27 al 28 de mayo, Andrei Markelov <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hablar√°</a> sobre las t√©cnicas de prueba en el producto, y Arthur Khineltsev hablar√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sobre el monitoreo de una</a> interfaz muy cargada, cuando el precio de incluso un peque√±o error es de decenas de miles de usuarios tristes. <br><br>  ¬°Ven a chatear por calidad! </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/452960/">https://habr.com/ru/post/452960/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../452946/index.html">Relectura de la filosof√≠a de programaci√≥n de Windows 95 / NT de Lou Greenaw</a></li>
<li><a href="../452952/index.html">Jornada de puertas abiertas de JetBrains en San Petersburgo</a></li>
<li><a href="../452954/index.html">Tiempo de construcci√≥n, velocidad de red y enrutamiento: c√≥mo mejoramos nuestra red de malla y un poco sobre redes neuronales</a></li>
<li><a href="../452956/index.html">Referencia de consumo de CPU para Istio y Linkerd</a></li>
<li><a href="../452958/index.html">JMAP: un protocolo abierto reemplaza a IMAP al intercambiar correos electr√≥nicos</a></li>
<li><a href="../452962/index.html">La principal causa de accidentes en los centros de datos es la colocaci√≥n entre la computadora y la silla.</a></li>
<li><a href="../452964/index.html">Una explicaci√≥n asequible de la hip√≥tesis de Riemann.</a></li>
<li><a href="../452966/index.html">El mito de la atenci√≥n plena: una visi√≥n "neuroc√©ntrica" ‚Äã‚Äãde la meditaci√≥n</a></li>
<li><a href="../452968/index.html">√çndices en PostgreSQL - 10 (Bloom)</a></li>
<li><a href="../452974/index.html">Programaci√≥n asincr√≥nica (curso completo)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>