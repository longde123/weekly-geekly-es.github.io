<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òÇÔ∏è üññ üìú O que aconteceu quando quebramos a exibi√ß√£o? üëáüèª üéóÔ∏è üëßüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Q RC OD E atrav√©s de um aplicativo m√≥vel para digitalizar os crach√°s de expositores de projetos de seguran√ßa da informa√ß√£o. 

 No ano passado, visitam...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O que aconteceu quando quebramos a exibi√ß√£o?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417621/">  Q <b>RC</b> OD <b>E</b> atrav√©s de um aplicativo m√≥vel para digitalizar os crach√°s de expositores de projetos de seguran√ßa da informa√ß√£o. <br><a name="habracut"></a><br>  No ano passado, visitamos uma grande exposi√ß√£o de projetos de seguran√ßa da informa√ß√£o em Londres.  Em prepara√ß√£o, recebemos nossos passes na forma de PDFs "imprima voc√™ mesmo". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3cf/c19/9ba/3cfc199ba6b29143007fb4871a3536b5.png" alt="Crach√° do expositor de Toms"></div><br>  Percebemos imediatamente dois tipos de c√≥digos de barras.  Curiosamente, o c√≥digo QR parecia muito denso, pois basta armazenar apenas o ID do participante.  Por natureza, curiosos, lan√ßamos um scanner QR e recebemos o conte√∫do do c√≥digo: <br><br><pre><code class="hljs objectivec">{<span class="hljs-string"><span class="hljs-string">"CJe"</span></span>;<span class="hljs-string"><span class="hljs-string">"BHEEZST"</span></span>,<span class="hljs-string"><span class="hljs-string">"DO"</span></span>;<span class="hljs-string"><span class="hljs-string">"Cvmmfuqsppg"</span></span>,<span class="hljs-string"><span class="hljs-string">"G"</span></span>;<span class="hljs-string"><span class="hljs-string">"upn"</span></span>,<span class="hljs-string"><span class="hljs-string">"KU"</span></span>;<span class="hljs-string"><span class="hljs-string">"Qfofusbujpo uftufs"</span></span>,<span class="hljs-string"><span class="hljs-string">"T"</span></span>;<span class="hljs-string"><span class="hljs-string">"xzbuu"</span></span>}</code> </pre> <br>  Acabou sendo quase-mas-n√£o-muito-JSON.  Uma das vantagens de um nome t√£o curto quanto o meu √© que ele chama sua aten√ß√£o em tais situa√ß√µes.  Portanto, notei imediatamente que meu nome estava codificado no ROT-25 ("tom" transformado em "upn").  Tamb√©m √© conhecida como Cifra de C√©sar, onde cada letra √© substitu√≠da por outra com um deslocamento fixo (nesse caso, a letra do alfabeto foi usada em vez de cada letra).  Ap√≥s executar a linha atrav√©s do decodificador (levando em considera√ß√£o a marca√ß√£o JSON), obtivemos: <br><br><pre> <code class="hljs objectivec">{<span class="hljs-string"><span class="hljs-string">"BId"</span></span>;<span class="hljs-string"><span class="hljs-string">"AGDDYRS"</span></span>,<span class="hljs-string"><span class="hljs-string">"CN"</span></span>;<span class="hljs-string"><span class="hljs-string">"Bulletproof"</span></span>,<span class="hljs-string"><span class="hljs-string">"F"</span></span>;<span class="hljs-string"><span class="hljs-string">"tom"</span></span>,<span class="hljs-string"><span class="hljs-string">"JT"</span></span>;<span class="hljs-string"><span class="hljs-string">"Penetration tester"</span></span>,<span class="hljs-string"><span class="hljs-string">"S"</span></span>;<span class="hljs-string"><span class="hljs-string">"wyatt"</span></span>}</code> </pre> <br>  Isso √© mais leg√≠vel. <br><br><h2>  Quebre isso? </h2><br>  Curiosamente, o c√≥digo QR armazena informa√ß√µes que parecem estar relacionadas ao campo BId no banco de dados.  Porque  Bem, isso √© bem simples.  Os organizadores fizeram um aplicativo m√≥vel para fornecedores que os ajuda a coletar os contatos dos participantes durante a exposi√ß√£o.  Assumimos que os dados s√£o criptografados em um c√≥digo QR, caso o sinal Wi-Fi ou celular seja inst√°vel. <br><br>  At√© o momento, podemos fazer pouco com essas informa√ß√µes, exceto para alterar nossos dados, a fim de evitar spam dos fornecedores do evento.  Seria engra√ßado, mas dificilmente digno de um email para o desenvolvedor do sistema.  Ent√£o, fomos ao Play Market e instalamos o aplicativo apropriado para ver o que ele faz. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/544/bf7/ff1/544bf7ff1910ec9044f73bf566dbb997.png" alt="Capturas de tela do aplicativo"></div><br>  E aqui encontramos um problema: n√£o t√≠nhamos os dados necess√°rios dos organizadores do evento.  Pensamos que poder√≠amos falsificar a resposta do servidor usando o proxy MiTM, e o aplicativo nos deixar√° ir.  Montamos o Burpsuite e gravamos algumas tentativas malsucedidas de login, na esperan√ßa de interceptar o tr√°fego e brincar com ele. <br><br>  Infelizmente, n√£o tivemos sucesso.  O aplicativo direcionou todas as solicita√ß√µes usando SOAP, e as respostas n√£o foram √≥bvias.  No entanto, o servidor publica documentos WSDL para o aplicativo. <br><br><h2>  Este n√£o √© o fim </h2><br>  Por que n√£o escrever um servi√ßo da Web falso para que voc√™ n√£o possa mais acessar o servidor de aplicativos real?  Poucas horas depois, t√≠nhamos esse servi√ßo e todo o tr√°fego estava ligado a ele.  Isso funciona!  O aplicativo autenticado com todos os dados e conectado a um evento falso. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c32/e23/0a9/c32e230a94d053e2bd63cc2f7849e4ba.png" alt="Show falso no aplicativo"></div><br>  Examinamos alguns emblemas e tudo parecia funcionar corretamente.  Progresso!  Depois de vagar pelo aplicativo por algum tempo, ficou claro que ele estava usando algum tipo de estrutura baseada no WebView.  Cavando um pouco no APK, encontramos v√°rias men√ß√µes ao Sencha e Ext.js, que confirmaram nossa suposi√ß√£o. <br><br>  E agora - o mais interessante.  Se um aplicativo consiste em uma mistura regular de HTML e JavaScript, ele pode ser vulner√°vel a ataques padr√£o da Web?  Embrulh√°mos alguns XSS no "n√£o-bastante-JSON" que o aplicativo espera, os digitalizou e ... <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/21c/64d/940/21c64d940bd21911a963ff8ee4a8a697.png" alt="ID falso no aplicativo"></div><br><h2>  N√≥s quebramos </h2><br>  √ìtimo!  A inje√ß√£o de HTML no campo "JT" mostrou a imagem.  Podemos adicionar o atributo "onerror" a essa tag para obter a execu√ß√£o do script, mas estamos limitados pela restri√ß√£o no comprimento m√°ximo do c√≥digo QR.  Como resultado, criamos uma carga √∫til que baixou o arquivo JS do servidor e o executou no dispositivo.  Aqui, por exemplo, est√° o teste alert () padr√£o: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/831/726/56e/83172656e9f9340bfec3447e8d24ac3f.png" alt="codificando um alerta"></div><br>  A digitaliza√ß√£o de um c√≥digo de barras aciona o XSS e executa o c√≥digo: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c9c/d23/7e2/c9cd237e297e61234ad05df380b52a3d.png" alt="Mostrando uma falha do XSS"></div><br>  N√≥s o picamos para que ele se encaixe perfeitamente no tamanho m√°ximo de um c√≥digo QR leg√≠vel, n√£o muito denso para impress√£o em um passe.  Depois de ler a documenta√ß√£o da API Ext.js e compar√°-la com o c√≥digo APK descompilado, conseguimos criar um c√≥digo de barras que: <br><br><ol><li>  Fa√ßa o download de um arquivo JS de um servidor remoto </li><li>  L√™ as chaves da sess√£o de um smartphone e as envia para o servidor </li><li>  L√™ o conte√∫do do banco de dados de contatos em cache do aplicativo, incluindo os nomes e endere√ßos de e-mail de todos cujos passes foram verificados por este dispositivo </li><li>  Exclui sua grava√ß√£o de um smartphone </li></ol><br>  Em seguida, o ataque se resume ao seguinte: o fornecedor digitaliza meu c√≥digo QR em troca de uma caneta gratuita e recebo uma lista completa de todos os contatos verificados por este dispositivo. <br><br>  Carga √∫til: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/23d/604/4fc/23d6044fccd94b03cdd82e833a6c0d65.png" alt="Mostrando a carga"><br><br>  Pedidos para o servidor web: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b3c/257/8de/b3c2578de409b7d6409e138f8aba5717.png" alt="Mostrando a resposta do servidor"><br><br><h2>  Tudo est√° bem quando acaba bem </h2><br>  Chamamos a aten√ß√£o dos fornecedores na exposi√ß√£o e, ap√≥s algumas discuss√µes, eles decidiram n√£o usar o aplicativo este ano.  Apenas algumas pessoas no evento se aproveitaram do aplicativo, enquanto os mais pequenos e preferidos eram pequenos scanners de c√≥digo de barras.  O aplicativo do Market foi baixado apenas cerca de 500 vezes.  No entanto, esse √© um vetor interessante para o XSS, que mostra que voc√™ realmente precisa filtrar os dados antes do uso, independentemente de sua origem. <br><br>  Embora esse aplicativo em particular n√£o tenha sido amplamente utilizado, imagine se a vulnerabilidade estivesse em um aplicativo usado por milhares ou baixado por milh√µes?  Todos esses dados seriam para invasores que os descartariam a seu crit√©rio: de campanhas de phishing a ataques de for√ßa bruta. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt417621/">https://habr.com/ru/post/pt417621/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt417607/index.html">Os testes A / B n√£o funcionam. Verifique o que voc√™ est√° fazendo de errado</a></li>
<li><a href="../pt417609/index.html">Especializa√ß√£o em programa√ß√£o esportiva no cursor</a></li>
<li><a href="../pt417613/index.html">Ceph como armazenamento conect√°vel: 5 informa√ß√µes pr√°ticas de um grande projeto</a></li>
<li><a href="../pt417615/index.html">Confiss√µes de Cracker de Disco para Apple II: Segredos das 4 da manh√£</a></li>
<li><a href="../pt417617/index.html">Cassandra para armazenar metadados: sucessos e falhas</a></li>
<li><a href="../pt417627/index.html">Hyper CRM ou Mini ERP? Neg√≥cios bagun√ßados</a></li>
<li><a href="../pt417629/index.html">Delphi e C ++ Builder Community Edition</a></li>
<li><a href="../pt417631/index.html">Tutorial em v√≠deo da grade CSS</a></li>
<li><a href="../pt417637/index.html">Desenvolvimento de um editor para cria√ß√£o de sites / desembarques (experi√™ncia)</a></li>
<li><a href="../pt417639/index.html">O reverso do Neuromancer. Parte 4: Som, Anima√ß√£o, Huffman, Github</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>