<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üç´ ü§πüèª üåõ API JSON - nous travaillons selon les sp√©cifications üìó üëï üï§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="R√©cemment, le d√©veloppement Web a √©t√© divis√©. Maintenant, nous ne sommes pas tous des programmeurs full-stack - nous sommes front-end et back-end. Et ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>API JSON - nous travaillons selon les sp√©cifications</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/433322/">  R√©cemment, le d√©veloppement Web a √©t√© divis√©.  Maintenant, nous ne sommes pas tous des programmeurs full-stack - nous sommes front-end et back-end.  Et la chose la plus difficile √† ce sujet, comme ailleurs, est le probl√®me de l'interaction et de l'int√©gration. <br><br>  Le frontend avec le backend interagit via l'API.  Et le r√©sultat du d√©veloppement dans son ensemble d√©pend de quelle API il s'agit, de la qualit√© ou de la mauvaise entente entre le backend et le frontend.  Si nous commen√ßons tous √† discuter ensemble de la fa√ßon de proc√©der √† la mise √† niveau et √† passer toute la journ√©e √† la retravailler, nous ne pourrons peut-√™tre pas passer aux t√¢ches commerciales. <br><br>  Afin de ne pas d√©raper et reproduire des holivars sur les noms des variables, vous avez besoin d'une bonne sp√©cification.  Parlons de ce que cela devrait √™tre de rendre la vie plus facile pour tout le monde.  Dans le m√™me temps, nous deviendrons des experts dans les abris √† v√©los. <br><br><img src="https://habrastorage.org/webt/o4/me/1u/o4me1uwmahvlwsnvqxyf_rzwa1i.jpeg"><br><a name="habracut"></a><br>  Commen√ßons de loin - avec le probl√®me que nous r√©solvons. <br><br>  Il √©tait une fois, en 1959, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cyril Parkinson</a> (√† ne pas confondre avec la maladie, il est √©crivain et figure √©conomique) a propos√© plusieurs lois int√©ressantes.  Par exemple, ces d√©penses augmentent avec le revenu, etc.  L'un d'eux est appel√© la loi de la trivialit√©: <br><br><blockquote>  Le temps pass√© √† discuter de l'√©l√©ment est inversement proportionnel au montant consid√©r√©. <br></blockquote><br>  Parkinson √©tait un √©conomiste, alors il a expliqu√© ses lois en termes √©conomiques, quelque chose comme √ßa.  Si vous venez au conseil d'administration et dites que vous avez besoin de 10 millions de dollars pour construire une centrale nucl√©aire, cette question sera probablement beaucoup moins discut√©e que l'allocation de 100 livres pour un abri √† v√©los pour les employ√©s.  Parce que tout le monde sait comment construire un abri √† v√©los, tout le monde a sa propre opinion, tout le monde se sent important et veut participer, et la centrale nucl√©aire est quelque chose d'abstrait et de lointain, 10 millions n'ont √©galement jamais √©t√© vus - il y a moins de questions. <br><br>  En 1999, la loi de la trivialit√© de Parkinson est apparue dans la programmation, qui a ensuite √©t√© activement d√©velopp√©e.  En programmation, cette loi se retrouve principalement dans la litt√©rature anglophone et sonne comme une m√©taphore.  Cela s'appelait l' <strong>effet Bikeshed</strong> (l'effet d'un abri √† v√©los), mais l'essence est la m√™me - nous sommes pr√™ts pour un abri √† v√©los et voulons discuter beaucoup plus longtemps que la construction d'une centrale √©lectrique. <br><br>  Ce terme a √©t√© invent√© par le d√©veloppeur danois Poul-Henning Kamp, qui a √©t√© impliqu√© dans la cr√©ation de FreeBSD.  Au cours du processus de conception, l'√©quipe a pass√© tr√®s longtemps √† discuter du fonctionnement de la fonction sommeil.  Voici une citation tir√©e d'une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lettre de</a> Poul-Henning Kamp (le d√©veloppement a ensuite √©t√© effectu√© par courrier √©lectronique): <br><br><blockquote>  C'√©tait une proposition de faire dormir (1) DTRT Si on me donnait un argument non entier qui √©teignait ce feu de camp particulier, je ne vais pas en dire plus √† ce sujet que cela, car c'est un √©l√©ment beaucoup plus petit qu'on ne le ferait attendez-vous de la longueur du fil, et il a d√©j√† re√ßu beaucoup plus d'attention que certains des * probl√®mes * que nous avons ici. <br></blockquote><br>  Dans cette lettre, il dit qu'il y a beaucoup de probl√®mes non r√©solus beaucoup plus importants: "Ne nous occupons pas du garage √† v√©los, nous allons faire quelque chose et aller de l'avant!" <br><br>  Poul-Henning Kamp a donc introduit en 1999 le terme effet bikeshed dans la litt√©rature anglophone, qui peut √™tre reformul√© comme suit: <br><br><blockquote>  La quantit√© de bruit cr√©√©e par le changement de code est inversement proportionnelle √† la complexit√© du changement. <br></blockquote><br>  Plus l'ajout ou le changement est simple, plus nous avons besoin d'avis √† ce sujet.  Je pense que beaucoup l'ont rencontr√©.  Si nous r√©solvons une question simple, par exemple, comment nommer les variables, cela n'a pas d'importance pour une machine - cette question provoquera un grand nombre d'holivars.  Mais les probl√®mes graves, vraiment importants pour les entreprises ne sont pas discut√©s et passent en arri√®re-plan. <br><br>  Selon vous, qu'est-ce qui est le plus important: comment communiquons-nous entre le backend et le frontend, ou les t√¢ches m√©tier que nous faisons?  Tout le monde pense diff√©remment, mais tout client, une personne qui s'attend √† ce que vous lui apportiez de l'argent, dira: "Fais-moi d√©j√† nos t√¢ches commerciales!"  Il ne se soucie absolument pas de la fa√ßon dont vous transf√©rez les donn√©es entre le backend et le frontend.  Peut-√™tre qu'il ne sait m√™me pas ce qu'est un backend et un frontend. <br><br>  Pour r√©sumer l'introduction, je voudrais dire: l' <strong>API est un abri √† v√©los.</strong> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/1cJVwn44iSc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien de</a></em> <em>pr√©sentation</em> <br><br>  <strong>√Ä propos de l'orateur:</strong> Alexey Avdeev ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Avdeev</a> ) travaille dans la soci√©t√© Neuron.Digital, qui s'occupe des neurones et en fait une interface cool pour eux.  Alex fait √©galement attention √† OpenSource et conseille tout le monde.  Il est engag√© dans le d√©veloppement depuis longtemps - depuis 2002, il a d√©couvert l'ancien Internet, quand les ordinateurs √©taient grands, Internet √©tait petit, et le manque de JS ne d√©rangeait personne et tout le monde faisait des sites Web sur les tables. <br><br><h2>  Comment g√©rer les hangars √† v√©los? <br></h2><br>  Apr√®s que le respect√© Cyril Parkinson ait d√©duit la loi de la trivialit√©, il a √©t√© beaucoup discut√©.  Il s'av√®re que l'effet d'un abri √† v√©lo ici peut √™tre facilement √©vit√©: <br><br><ol><li>  <strong>N'√©coutez pas les conseils.</strong>  Je pense que l'id√©e est moyenne - si vous n'√©coutez pas les conseils, vous pouvez faire une telle chose, surtout en programmation, et surtout si vous √™tes un d√©veloppeur novice. <br></li><li>  <strong>Faites comme vous voulez.</strong>  "Je suis artiste, je le vois!"  - pas d'effet bikeshed, tout ce dont vous avez besoin est fait, mais des choses tr√®s √©tranges apparaissent sur la sortie.  Cela se trouve souvent chez les pigistes.  Vous avez s√ªrement rencontr√© des t√¢ches que vous deviez accomplir pour d'autres d√©veloppeurs et dont la mise en ≈ìuvre vous a d√©rout√©. <br></li><li>  <strong>Est-il important de se demander?</strong>  Sinon, vous ne pouvez tout simplement pas en discuter, mais c'est une question de conscience personnelle. <br></li><li>  <strong>Utilisez des crit√®res objectifs.</strong>  Je parlerai de ce point dans le rapport.  Pour √©viter l'effet d'un abri √† v√©lo, vous pouvez utiliser des crit√®res qui disent objectivement ce qui est le mieux.  Ils existent. <br></li><li>  <strong>Ne parlez pas de ce que vous ne voulez pas √©couter des conseils.</strong>  Dans notre entreprise, les d√©veloppeurs backend d√©butants sont des introvertis, il arrive donc qu'ils fassent quelque chose dont ils ne parlent pas aux autres.  En cons√©quence, nous rencontrons des surprises.  Cette m√©thode fonctionne, mais en programmation ce n'est pas la meilleure option. <br></li><li>  Si vous ne vous souciez pas du probl√®me, vous pouvez simplement le <strong>laisser partir ou choisir l'une des options propos√©es</strong> qui ont surgi dans le processus de holivarov. <br></li></ol><br><h2>  Outil anti-bikeshedding <br></h2><br>  Je veux parler d' <strong>outils objectifs</strong> pour r√©soudre le probl√®me d'un abri √† v√©los.  Pour vous montrer ce qu'est un outil anti-bikeshedding, je vais vous raconter une petite histoire. <br><br>  Imaginez que nous ayons un d√©veloppeur backend novice.  Il est r√©cemment venu dans l'entreprise et a √©t√© charg√© de concevoir un petit service, par exemple un blog, pour lequel vous devez √©crire un protocole REST. <br><br><img src="https://habrastorage.org/webt/zn/9m/uk/zn9muk80uvsd_yuragws16ms70c.png">  <em>Roy Fielding, auteur de REST</em> <br><br>  Sur la photo, Roy Fielding, qui a soutenu en 2000 sa th√®se "Styles architecturaux et conception d'architectures logicielles r√©seau" et a ainsi introduit le terme REST.  De plus, il a invent√© HTTP et, en fait, est l'un des fondateurs d'Internet. <br><br>  REST est un ensemble de principes architecturaux qui expliquent comment concevoir des protocoles REST, des API REST, des services RESTful.  Ce sont des principes architecturaux assez abstraits et complexes.  Je suis s√ªr qu'aucun de vous n'a jamais vu une API enti√®rement conforme √† tous les principes RESTful. <br><br><h2>  Exigences de l'architecture REST <br></h2><br>  Je vais donner quelques exigences pour les protocoles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">REST</a> , auxquels je ferai ensuite r√©f√©rence et sur lesquels je m'appuierai.  Il y en a beaucoup, vous pouvez en lire plus sur Wikip√©dia. <br><br>  1. <strong>Le mod√®le client-serveur.</strong> <br>  Le principe le plus important de REST, c'est notre interaction avec le backend.  Selon REST, le backend est un serveur, le frontal est un client, et nous communiquons dans un format client-serveur.  Les appareils mobiles sont √©galement un client.  Les d√©veloppeurs de montres, de r√©frig√©rateurs, d'autres services - d√©veloppent √©galement la partie client.  L'API RESTful est le serveur auquel le client acc√®de. <br><br>  2. <strong>Manque de condition.</strong> <br>  Il ne doit pas y avoir d'√©tat sur le serveur, c'est-√†-dire que tout ce qui est n√©cessaire pour une r√©ponse vient dans la demande.  Lorsqu'une session est stock√©e sur le serveur, et selon cette session diff√©rentes r√©ponses arrivent, c'est une violation du principe REST. <br><br>  3. <strong>Uniformit√© de l'interface.</strong> <br>  C'est l'un des principes sous-jacents cl√©s sur lesquels l'API REST doit √™tre construite.  Il comprend les √©l√©ments suivants: <br><br><ul><li>  L'identification des ressources est la fa√ßon dont nous devons cr√©er une URL.  Sur REST, nous nous tournons vers le serveur pour une sorte de ressource. </li><li>  Manipulation des ressources par pr√©sentation.  Le serveur nous renvoie une vue diff√©rente de celle qui se trouve dans la base de donn√©es.  Peu importe que vous stockiez les informations dans MySQL ou PostgreSQL - nous avons une vue. </li><li>  Messages "auto-descriptifs" - c'est-√†-dire que le message contient un identifiant, des liens d'o√π vous pouvez r√©cup√©rer ce message - tout ce qui est n√©cessaire pour travailler √† nouveau avec cette ressource. </li><li>  Hypermedia est un lien vers les actions suivantes avec une ressource.  Il me semble que pas une seule API REST ne le fait, mais elle est d√©crite par Roy Fielding. </li></ul><br>  Il y a 3 autres principes que je ne cite pas car ils ne sont pas importants pour mon histoire. <br><br><h2>  Blog RESTful <br></h2><br>  Retour au d√©veloppeur backend d√©butant, √† qui on a demand√© de rendre un service pour le blog sur RESTful.  Voici un exemple de prototype. <br><br><img src="https://habrastorage.org/webt/op/wi/6l/opwi6l_tbihj0tvef8tu4feyoo4.png"><br><br>  Il s'agit d'un site sur lequel il y a des articles, vous pouvez les commenter, l'article et les commentaires ont un auteur - une histoire standard.  Notre d√©veloppeur d√©butant backend fera une API RESTful pour ce blog. <br><br>  Nous travaillons avec toutes les donn√©es du blog sur la base de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CRUD</a> . <br><img src="https://habrastorage.org/webt/4i/rk/hm/4irkhm7dcicexgmqomprfdraisu.png"><br>  Il devrait √™tre possible de cr√©er, lire, mettre √† jour et supprimer n'importe quelle ressource.  Essayons de demander √† notre d√©veloppeur principal de cr√©er un AP RESTful bas√© sur le principe de CRUD.  Autrement dit, √©crivez des m√©thodes pour cr√©er des articles, obtenir une liste d'articles ou un seul article, mettre √† jour et supprimer. <br><br>  Voyons comment il pourrait le faire. <br><img src="https://habrastorage.org/webt/m2/i2/ua/m2i2uadak8sdzbge_pvqlnpu55s.png"><br><br>  <strong>Tout va mal avec tous les principes de REST</strong> .  La chose la plus int√©ressante est que cela fonctionne.  J'ai en fait des API qui ressemblaient √† quelque chose comme √ßa.  Pour le client, c'est un abri √† v√©los, pour les d√©veloppeurs, c'est l'occasion de se d√©tendre et de discuter, et pour un d√©veloppeur novice, c'est juste un nouveau monde √©norme et courageux sur lequel il tr√©buche √† chaque fois, tombe, se fracasse la t√™te.  Il doit le refaire encore et encore. <br><img src="https://habrastorage.org/webt/k1/nj/lm/k1njlm8egbrcguim8am6juym76s.png"><br><br>  Il s'agit d'une option REST.  Sur la base des principes d'identification des ressources, nous travaillons avec des ressources - avec des articles et utilisons les m√©thodes HTTP propos√©es par Roy Fielding.  Il ne pouvait s'emp√™cher d'utiliser son travail pr√©c√©dent dans son prochain travail. <br><br>  Pour mettre √† jour les articles, beaucoup utilisent la m√©thode PUT; sa s√©mantique est l√©g√®rement diff√©rente.  La m√©thode PATCH met √† jour les champs qui ont √©t√© transmis et le PUT remplace simplement un article par un autre.  Par s√©mantique, PATCH est une fusion et PUT est un remplacement. <br><br>  Notre d√©veloppeur novice backend est tomb√©, ils l'ont ramass√© et ont dit: "Tout est en ordre, faites-le comme √ßa", et il l'a refait honn√™tement.  Mais il trouvera alors un long chemin √† travers les √©pines. <br><br>  <strong>Pourquoi est-ce si juste?</strong> <br><br><ul><li>  parce que Roy Fielding l'a dit; </li><li>  parce que c'est REST; </li><li>  car ce sont les principes architecturaux sur lesquels se fonde actuellement notre profession. </li></ul><br>  Cependant, il s'agit d'un "abri √† v√©los", et la m√©thode pr√©c√©dente fonctionnera.  Les ordinateurs communiquaient avant REST, et tout fonctionnait.  Mais maintenant, une norme est apparue dans l'industrie. <br><br><h2>  Supprimer l'article <br></h2><br>  Prenons l'exemple de la suppression d'un article.  Supposons qu'il existe une m√©thode de ressource normale DELETE / articles, qui supprime l'article par id.  HTTP contient des en-t√™tes.  L'en-t√™te Accept accepte le type de donn√©es que le client souhaite recevoir en r√©ponse.  Notre junior a √©crit un serveur qui retourne 200 OK, Content-Type: application / json, et passe un corps vide: <br><br> <code>01. <b><font color="#c6e90e">DELETE /articles/</font></b> 1 /1.1 <br> 02. Accept: <b><font color="#c6e90e">application/json</font></b></code> <br> <br> <code>01. HTTP/1.1 200 OK <br> 02. Content-Type: <b><font color="#c6e90e">application/json</font></b> <br> 03. null <br></code> <br>  Une <strong>erreur</strong> tr√®s <strong>courante a √©t√© commise ici - un corps vide</strong> .  Tout semble logique - l'article a √©t√© supprim√©, 200 OK, l'en-t√™te application / json est pr√©sent, mais le client va tr√®s probablement tomber.  Il g√©n√©rera une erreur car un corps vide n'est pas valide.  Si vous avez d√©j√† essay√© d'analyser une cha√Æne vide, vous √™tes confront√© au fait que tout analyseur json tr√©buche et se bloque √† ce sujet. <br><br>  Comment r√©soudre cette situation?  La meilleure option est probablement de passer json.  Si nous avons d√©clar√©: ¬´Acceptez, donnez-nous json¬ª, le serveur dit: ¬´Content-Type, je vous donne json¬ª, donnez json.  Un objet vide, un tableau vide - mettez quelque chose l√†-bas - ce sera la solution, et cela fonctionnera. <br><br>  Il y a encore une solution.  En plus de 200 OK, il existe un code de r√©ponse 204 - pas de contenu.  Avec lui, vous ne pouvez pas transmettre le corps.  Tout le monde ne le sait pas. <br><br>  J'ai donc conduit aux types de m√©dias. <br><br><h3>  Types de mime <br></h3><br>  Les types de m√©dias sont comme une extension de fichier, uniquement sur le Web.  Lorsque nous transmettons des donn√©es, nous devons informer ou demander quel type nous voulons recevoir en r√©ponse. <br><br><ul><li>  Par d√©faut, c'est text / plain - just text. </li><li>  Si rien n'est sp√©cifi√©, le navigateur signifiera probablement un flux d'application / octet - juste un flux de bits. </li></ul><br>  Vous pouvez sp√©cifier juste un type sp√©cifique: <br><br><ul><li>  application / pdf; </li><li>  image / png; </li><li>  application / json; </li><li>  application / xml; </li><li>  application / vnd.ms-excel. </li></ul><br>  Les en-t√™tes Content-Type et Accept sont et sont importants. <br><br><blockquote>  L'API et le client doivent transmettre les en-t√™tes Content-Type et Accept. <br></blockquote><br>  Si votre API est bas√©e sur JSON, passez toujours Accept: application / json et Content-Type application / json. <br><br>  Exemples de types de fichiers. <br><img src="https://habrastorage.org/webt/jd/v_/aa/jdv_aarpo9qnevtro5ddqbgw5ic.png"><br><br>  Les types de supports sont similaires √† ces types de fichiers, uniquement sur Internet. <br><br><h3>  Codes de r√©ponse <br></h3><br>  Le prochain exemple des aventures de notre d√©veloppeur junior est les codes de r√©ponse. <br><br><img src="https://habrastorage.org/webt/o4/tc/ci/o4tcci6wnmokubjjdecsy5vwclm.png"><br><br>  Le taux de r√©ponse le plus dr√¥le est de 200 OK.  Tout le monde l'aime - cela signifie que tout s'est bien pass√©.  J'ai m√™me eu un cas - j'ai re√ßu des <strong>erreurs 200 OK</strong> .  Quelque chose est effectivement tomb√© sur le serveur, en r√©ponse √† la r√©ponse vient une page HTML sur laquelle une erreur HTML a √©t√© compil√©e.  J'ai demand√© une application json avec le code 200 OK, et j'ai pens√© comment travailler avec elle?  Vous allez par r√©ponse, cherchez le mot "erreur", vous pensez que c'est une erreur. <br><br>  Cela fonctionne, cependant, dans HTTP, il existe de nombreux autres codes que vous pouvez utiliser, et REST vous recommande de les utiliser sur REST.  Par exemple, la cr√©ation d'une entit√© (article) peut √™tre r√©pondue: <br><br><ul><li>  <strong>201 Cr√©√©</strong> est un code r√©ussi.  L'article est cr√©√©, en r√©ponse, vous devez renvoyer l'article cr√©√©. </li><li>  <strong>202 Accept√©</strong> signifie que la demande a √©t√© accept√©e, mais son r√©sultat sera plus tard.  Ce sont des op√©rations de longue dur√©e.  Sur Accept√©, aucun corps ne peut √™tre retourn√©.  Autrement dit, si vous ne donnez pas le Content-Type dans la r√©ponse, le corps peut √©galement ne pas l'√™tre.  Ou texte / plan de type contenu - c'est tout, pas de questions.  Une cha√Æne vide est un texte / plan valide. </li><li>  <strong>204 Pas de contenu</strong> - le corps peut √™tre compl√®tement absent. </li><li>  <strong>403 Interdit</strong> - Vous n'√™tes pas autoris√© √† cr√©er cet article. </li><li>  <strong>404 Introuvable</strong> - vous avez grimp√© quelque part de travers, il n'y a pas de tel moyen, par exemple. </li><li>  <strong>409 Le conflit</strong> est un cas extr√™me que peu de gens utilisent.  Il est parfois n√©cessaire si vous g√©n√©rez un identifiant sur le client, et non sur le backend, et √† ce moment-l√†, quelqu'un a d√©j√† r√©ussi √† cr√©er cet article.  Le conflit est la bonne r√©ponse dans ce cas. </li></ul><br><h3>  Cr√©ation d'entit√© <br></h3><br>  L'exemple suivant: nous cr√©ons une entit√©, disons Content-Type: application / json, et passons cette application / json.  Cela fait du client - notre interface.  Cr√©ons cet article: <br><br> <code>01. POST /articles /1.1 <br> 02. Content-Type: application/json <br> 03. { "id": 1, "title": " JSON API"}</code> <br> <br>  Le code peut venir en r√©ponse: <br><br><ul><li>  422 Entit√© non traitable - Une entit√© non trait√©e.  Tout semble √™tre super - la s√©mantique, il y a du code; </li><li>  403 Interdit </li><li>  500 Erreur de serveur interne. </li></ul><br>  Mais il est absolument incompr√©hensible de savoir ce qui s'est exactement pass√©: quel type d'entit√© n'est pas trait√©, pourquoi ne devrais-je pas y aller et qu'est-il finalement arriv√© au serveur? <br><br><h3>  Erreurs de retour <br></h3><br>  Soyez s√ªr (et les juniors ne le savent pas) en r√©ponse, renvoyez des erreurs.  C'est s√©mantique et correct.  Soit dit en passant, Fielding n'a pas √©crit √† ce sujet, c'est-√†-dire qu'il a √©t√© invent√© plus tard et construit au-dessus de REST. <br><br>  Le backend peut retourner un tableau avec des erreurs en r√©ponse, il peut y en avoir plusieurs. <br><br> <code>01. HTTP/1.1 422 Unprocessable Entity <br> 02. Content-Type: application/json <br> 03. <br> 04. { "errors": [{ <br> 05.   "status": "422", <br> 06. <b><font color="#c6e90e">"title": "Title already exist",</font></b> <br> 07. }]}</code> <br> <br>  Chaque erreur peut avoir son propre statut et titre.  C'est tr√®s bien, mais cela va d√©j√† au niveau de la convention sur REST.  Cela pourrait √™tre notre outil anti-bikeshedding pour arr√™ter de discuter et cr√©er imm√©diatement une bonne API. <br><br><h2>  Ajouter une pagination <br></h2><br>  L'exemple suivant: les concepteurs viennent voir notre d√©veloppeur backend d√©butant et disent: ¬´Nous avons beaucoup d'articles, nous avons besoin de pagination.  Nous avons dessin√© celui-ci. " <br><img src="https://habrastorage.org/webt/fn/6l/9t/fn6l9tjzotvgzehwpbezkd0vcf4.png"><br><br>  Examinons-le plus en d√©tail.  Tout d'abord, 336 pages sont frappantes.  Quand j'ai vu √ßa, j'ai pens√© √† comment obtenir ce chiffre.  O√π obtenir 336, car lorsque je demande une liste d'articles, j'obtiens une liste d'articles.  Par exemple, il y en a 10 000, c'est-√†-dire que je dois t√©l√©charger tous les articles, les diviser par le nombre de pages et trouver ce nombre.  Pendant tr√®s longtemps, je chargerai ces articles, j'ai besoin d'un moyen d'obtenir rapidement le nombre d'entr√©es.  Mais si notre API renvoie une liste, alors o√π mettre ce nombre d'enregistrements en g√©n√©ral, car un tableau d'articles vient en r√©ponse.  Il s'av√®re que puisque le nombre d'enregistrements n'est plac√© nulle part, il doit √™tre ajout√© √† chaque article pour que chaque article dise: "Et nous sommes tous si nombreux!" <br><br>  Cependant, il existe une convention au-dessus de l'API REST qui r√©sout ce probl√®me. <br><br><h3>  Demande de liste <br></h3><br>  Pour rendre l'API extensible, vous pouvez imm√©diatement utiliser les param√®tres GET pour la pagination: la taille de la page en cours et son num√©ro, de sorte que exactement la partie de la page que nous avons demand√©e nous soit retourn√©e.  C'est pratique.  En r√©ponse, vous ne pouvez pas donner imm√©diatement un tableau, mais ajouter une imbrication suppl√©mentaire.  Par exemple, la cl√© de donn√©es contiendra un tableau, les donn√©es que nous avons demand√©es et la m√©ta-cl√©, qui n'existait pas auparavant, contiendra le total. <br><br> <code>01. GET /articles? <b><font color="#c6e90e">page[size]=30&amp;page[number]=2</font></b> <br> 02. Content-Type: application/json <br></code> <br> <code>01. HTTP/1.1 200 OK <br> 02. { <br> 03.   "data": [{ "id": 1, "title": "JSONAPI"}, ...], <br> 04.   "meta": { <b><font color="#c6e90e">"count": 10080</font></b> } <br> 05. } <br></code> <br>  De cette fa√ßon, l'API peut renvoyer des informations suppl√©mentaires.  En plus de compter, il peut y avoir d'autres informations - elles sont extensibles.  Maintenant, si le junior ne l'a pas fait tout de suite, et seulement apr√®s qu'on lui ait demand√© de faire la pyjinisation, alors il a <strong>fait le changement en arri√®re incompatible</strong> , a cass√© l'API, et tous les clients ont d√ª le refaire - g√©n√©ralement √ßa fait tr√®s mal. <br><br>  La pajinisation est diff√©rente.  Je propose plusieurs astuces de vie que vous pouvez utiliser. <br><br><h4>  [d√©calage] ... [limite] <br></h4><br> <code>01. GET /articles? <b><font color="#c6e90e">page[offset]=30&amp;page[limit]=30</font></b> <br> 02. Content-Type: application/json <br></code> <br> <code>01. HTTP/1.1 200 OK <br> 02. { <br> 03.   "data": [{ "id": 1, "title": "JSONAPI"}, ...], <br> 04.   "meta": { "count": 10080 } <br> 05. } <br></code> <br>  Ceux qui travaillent avec des bases de donn√©es peuvent d√©j√† avoir un sous-cortex [offset] ... [limit].  L'utiliser √† la place de la page [taille] ... la page [num√©ro] sera plus facile.  Il s'agit d'une approche l√©g√®rement diff√©rente. <br><br><h4>  Positionnement du curseur <br></h4><br> <code>01. GET /articles? <b><font color="#c6e90e">page[published_at]=1538332156</font></b> <br> 02. Content-Type: application/json</code> <br> <br> <code>01. HTTP/1.1 200 OK <br> 02. { <br> 03.    "data": [{ "id": 1, "title": "JSONAPI"}, ...], <br> 04.    "meta": { "count": 10080 } <br> 05. }</code> <br> <br>  L'emplacement du curseur utilise un pointeur sur l'entit√© avec laquelle commencer le chargement des enregistrements.  Par exemple, cela est tr√®s pratique lorsque vous utilisez la pagination ou le chargement dans des listes qui changent fr√©quemment.  Disons que de nouveaux articles sont constamment √©crits sur notre blog.  La troisi√®me page n'est plus la m√™me troisi√®me page qui sera dans une minute, mais si nous allons √† la quatri√®me page, nous obtiendrons des enregistrements de la troisi√®me page, car toute la liste se d√©placera. <br><br>  Ce probl√®me est r√©solu par la pagination du curseur.  Nous disons: "Chargez les articles qui viennent apr√®s l'article publi√© √† ce moment-l√†" - il ne peut d√©j√† y avoir aucun changement de mani√®re purement technologique, et c'est cool. <br><br><h2>  Probl√®me N +1 <br></h2><br>  Le prochain probl√®me que notre d√©veloppeur junior rencontrera certainement est le probl√®me N + 1 (les backenders comprendront).  Supposons que vous souhaitiez r√©pertorier une liste de 10 articles.  Nous t√©l√©chargeons une liste d'articles, chaque article a un auteur et pour chacun, vous devez t√©l√©charger un auteur.  Nous exp√©dions: <br><br><ul><li>  1 demande de liste d'articles; </li><li>  10 demandes pour les auteurs de chaque article. </li></ul><br>  Total: 11 requ√™tes pour afficher une petite liste. <br><br><h3>  Ajouter des liens <br></h3><br>  Sur le backend, ce probl√®me est r√©solu dans tous les ORM - il vous suffit de vous rappeler d'ajouter cette connexion.  Ces connexions peuvent √©galement √™tre utilis√©es sur l'extr√©mit√© avant.  Cela se fait comme suit: <br><br> <code>01. GET /articles? <b><font color="#c6e90e">include =author</font></b> <br> 02. Content-Type: application/json <br></code> <br>  Vous pouvez utiliser un param√®tre GET sp√©cial, appelez-le include (comme sur le backend), en disant quels liens nous devons charger avec les articles.  Supposons que nous t√©l√©chargions des articles et que nous voulions imm√©diatement mettre l'auteur en rapport avec les articles.  La r√©ponse ressemble √† ceci: <br><br> <code>01. /1.1 200  <br> 02. { "data": [{ <br> 03.  { attributes: { "id": 1, "title": "JSON API" }, <br> 04.  { relationships: { <br> 05. <b><font color="#c6e90e">"author": { "id": 1, "name": "Avdeev" } }</font></b> <br> 06.  }, ... <br> 07. }]}</code> <br> <br>  Les propres attributs d'article ont √©t√© transf√©r√©s aux donn√©es et les relations cl√©s ont √©t√© ajout√©es.  Nous mettons toutes les connexions dans cette cl√©.  Ainsi, avec une seule demande, nous avons re√ßu toutes les donn√©es qui avaient pr√©c√©demment re√ßu 11 demandes.  C'est un hack de vie cool qui r√©sout bien le probl√®me avec N + 1 sur l'extr√©mit√© avant. <br><br><h2>  Le probl√®me de la duplication des donn√©es <br></h2><br>  Supposons que vous souhaitiez afficher 10 articles indiquant l'auteur, tous les articles ont un auteur, mais l'objet avec l'auteur est tr√®s grand (par exemple, un nom de famille tr√®s long, qui prend un m√©gaoctet).  Un auteur est inclus 10 fois dans la r√©ponse, et 10 inclusions du m√™me auteur dans la r√©ponse prendront 10 Mo. <br><br>  √âtant donn√© que tous les objets sont identiques, le probl√®me qu'un auteur est inclus 10 fois (10 Mo) est r√©solu √† l'aide de la normalisation, qui est utilis√©e dans les bases de donn√©es.  √Ä l'avant, vous pouvez √©galement utiliser la normalisation pour travailler avec l'API - c'est tr√®s cool. <br><br> <code>01. /1.1 200  <br> 02. { "data": [{ <br> 03. "id": "1‚Ä≥, <b><font color="#c6e90e">"type": "article",</font></b> <br> 04. "attributes": { "title": "JSON API" }, <br> 05. "relationships": { ... } <br> 06.  "author": { "id": 1, <b><font color="#c6e90e">"type": "people"</font></b> } } <br> 07. }, ... ] <br> 08. }</code> <br> <br>  Nous marquons toutes les entit√©s avec un certain type (c'est un type de repr√©sentation, un type de ressource).  Roy Fielding a introduit le concept d'une ressource, c'est-√†-dire qu'ils ont demand√© des articles - ont re√ßu un ¬´article¬ª.  Dans les relations, nous mettons un lien vers le type de personnes, c'est-√†-dire que nous avons toujours les ressources humaines ailleurs.  Et la ressource elle-m√™me que nous prenons dans une cl√© distincte incluse, qui se trouve au m√™me niveau que les donn√©es. <br><br> <code>01. /1.1 200  <br> 02. { <br> 03. "data": [ ... ], <br> 04. <b><font color="#c6e90e">"included":</font></b> [{ <br> 05.  "id": 1, "type": "people", <br> 06.  "attributes": { "name": "Avdeev" } <br> 07. }] <br> 08. }</code> <br> <br>  Ainsi, toutes les entit√©s li√©es dans une seule instance tombent dans la cl√© sp√©ciale incluse.  Nous ne stockons que des liens, et les entit√©s elles-m√™mes sont stock√©es dans inclus. <br><br>  La taille de la demande a diminu√©.  Il s'agit d'un hack de vie dont le back-end de d√©but ne sait pas.  Il saura plus tard quand il aura besoin de casser l'API. <br><br><h3>  Tous les champs de ressources ne sont pas n√©cessaires <br></h3><br>  Le hack de vie suivant peut √™tre appliqu√© lorsque tous les champs de ressources ne sont pas n√©cessaires.  Cela se fait √† l'aide d'un param√®tre GET sp√©cial, qui r√©pertorie les attributs √† renvoyer, s√©par√©s par des virgules.  Par exemple, l'article est volumineux, et il peut y avoir des m√©gaoctets dans le champ de contenu, et nous devons afficher uniquement la liste des en-t√™tes - nous n'avons pas besoin du contenu dans la r√©ponse. <br><br> <code>GET /articles <b><font color="#c6e90e">?fields[article]=title /1.1</font></b></code> <br> <br> <code>01. /1.1 200 OK <br> 02. { "data": [{ <br> 03.  "id": "1‚Ä≥, "type": "article", <br> 04.  "attributes": { <b><font color="#c6e90e">"title": " JSON API"</font></b> }, <br> 05.  }, ... ] <br> 06. }</code> <br> <br>  Si vous avez besoin, par exemple, √©galement de la date de publication, vous pouvez √©crire une ¬´date de publication¬ª s√©par√©e par des virgules.  En r√©ponse, deux champs viendront en attributs.  Il s'agit d'une convention qui peut √™tre utilis√©e comme un outil anti-bikeshedding. <br><br><h3>  Recherche par articles <br></h3><br>  Nous avons souvent besoin de recherches et de filtres.  Il existe des conventions pour cela - filtres sp√©ciaux param√®tres GET: <br><br>  ‚óè <code>GET /articles <b><font color="#c6e90e">?filters[search]=api</font></b> HTTP/1.1</code> - recherche; <br>  ‚óè <code>GET /articles <b><font color="#c6e90e">?fiIters[from_date]=1538332156</font></b> HTTP/1.1</code> - t√©l√©charger des articles √† partir d'une date sp√©cifique; <br>  ‚óè <code>GET /articles <b><font color="#c6e90e">?filters[is_published]=true</font></b> HTTP/1.1</code> - t√©l√©chargez les articles qui viennent d'√™tre publi√©s; <br>  ‚óè <code>GET /articles <b><font color="#c6e90e">?fiIters[author]=1</font></b> HTTP/1.1</code> - t√©l√©chargez les articles avec le premier auteur. <br><br><h3>  Tri des articles <br></h3><br>  ‚óè <code>GET /articles <b><font color="#c6e90e">?sort=title</font></b> /1.1</code> - par titre; <br>  ‚óè <code>GET /articles <b><font color="#c6e90e">?sort=published_at</font></b> HTTP/1.1</code> - par date de publication; <br>  ‚óè <code>GET /articles <b><font color="#c6e90e">?sort=-published_at</font></b> HTTP/1.1</code> - par date de publication dans le sens oppos√©; <br>  ‚óè <code>GET /articles <b><font color="#c6e90e">?sort=author,-publisbed_at</font></b> HTTP/1.1</code> - d'abord par auteur, puis par date de publication dans le sens inverse, si les articles sont du m√™me auteur. <br><br><h2>  Besoin de changer les URL <br></h2><br>  Solution: l'hyperm√©dia, que j'ai d√©j√† mentionn√©, peut se faire comme suit.  Si nous voulons que l'objet (ressource) soit auto-descriptif, le client pourrait comprendre par hyperm√©dia ce qui peut √™tre fait avec lui, et le serveur pourrait se d√©velopper ind√©pendamment du client, alors vous pouvez ajouter des liens √† la liste d'articles, √† l'article lui-m√™me en utilisant des cl√©s de liens sp√©ciales : <br><br> <code><code>01. GET /articles /1.1 <br> 02. { <br> 03. "data": [{ <br> 04.  ... <br> 05. <b><font color="#c6e90e">"links": { "self": "http://localhost/articles/1"</font></b></code> }, <br> 06.  "relationships": { ... } <br> 07. }], <br> 08. <b><font color="#c6e90e">"links": { "self": " <code>http://localhost/articles</code> " }</font></b> <br> 09. } <br></code> <br>  Ou li√©, si nous voulons dire au client comment t√©l√©charger un commentaire sur cet article: <br><br> <code><code>01. ... <br> 02. "relationships": { <br> 03. "comments": { <br> 04.  "links": { <br> 05. <b><font color="#c6e90e">"self": "http://localhost/articles/l/relationships/comments</font></b></code> ", <br> 06. <b><font color="#c6e90e">"related": " <code>http://localhost/articles/l/comments</code> "</font></b> <br> 07.  } <br> 08. } <br> 09. }</code> <br>  Le client voit qu'il y a un lien, le suit, charge un commentaire.  S'il n'y a pas de lien, alors il n'y a pas de commentaires.  C'est pratique, mais si peu le font.  Fielding est venu avec les principes de REST, mais tous ne sont pas entr√©s dans notre industrie.  Nous en utilisons principalement deux ou trois. <br><br>  En 2013, tous les hacks de la vie dont je vous ai parl√©, Steve Klabnik a combin√© dans la sp√©cification de l'API JSON et s'est enregistr√© en tant que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nouveau type de m√©dia au-dessus de JSON</a> .  Notre d√©veloppeur backend junior, √©voluant progressivement, est donc arriv√© √† l'API JSON. <br><br><h2>  API JSON <br></h2><br>  Tout est d√©crit en d√©tail sur le site <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://jsonapi.org/implementations/</a> : il existe m√™me une liste de 170 impl√©mentations diff√©rentes de sp√©cifications pour 32 langages de programmation - et celles-ci ne sont ajout√©es qu'au catalogue.  Des biblioth√®ques, des analyseurs, des s√©rialiseurs, etc. ont d√©j√† √©t√© √©crits. <br><br>  Puisque cette sp√©cification est open source, tout le monde y investit.  J'ai, entre autres, √©crit quelque chose moi-m√™me.  Je suis s√ªr qu'il y en a beaucoup.  Vous pouvez vous joindre √† ce projet vous-m√™me. <br><br><h4>  Avantages de l'API JSON <br></h4><br>  La sp√©cification de l'API JSON r√©sout un certain nombre de probl√®mes - un <strong>accord commun pour tout le monde</strong> .  Puisqu'il existe un accord g√©n√©ral, nous <strong>ne discutons pas au sein de l'√©quipe</strong> - le garage √† v√©los est document√©.  Nous avons un accord sur les mat√©riaux pour fabriquer un abri √† v√©lo et comment le peindre. <br><br>  Maintenant, lorsque le d√©veloppeur fait quelque chose de mal et que je le vois, je ne lance pas la discussion, mais je dis: "Pas par l'API JSON!"  et montrer en place dans la sp√©cification.  Ils me d√©testent dans l'entreprise, mais s'y habituent progressivement, et tout le monde a commenc√© √† aimer l'API JSON.  Nous faisons de nouveaux services par d√©faut selon cette sp√©cification.  Nous avons une cl√© de date, nous sommes pr√™ts √† ajouter des m√©ta, √† inclure des cl√©s.  Il existe des filtres de param√®tres GET r√©serv√©s pour les filtres.  Nous ne discutons pas de ce qu'il faut appeler un filtre - nous utilisons cette sp√©cification.  Il d√©crit comment cr√©er une URL. <br><br>  Puisque nous ne discutons pas, mais que nous effectuons des t√¢ches commerciales, la <strong>productivit√© du d√©veloppement est plus √©lev√©e</strong> .  Nous avons les sp√©cifications d√©crites, le d√©veloppeur a lu le backend, fait l'API, nous l'avons viss√© - le client est content. <br><br>  <strong>Les probl√®mes populaires ont d√©j√† √©t√© r√©solus</strong> , par exemple, avec la pagination.  Il y a beaucoup d'indices dans la sp√©cification. <br><br>  Comme il s'agit de JSON (merci √† Douglas Crockford pour ce format), il est plus concis que XML, il est assez <strong>facile √† lire et √† comprendre</strong> . <br><br>  Le fait qu'il s'agisse d' <strong>Open Source</strong> peut √™tre √† la fois un plus et un moins, mais j'adore l'Open Source. <br><br><h4>  API JSON <br></h4><br>  L'objet a grandi (date, attributs, inclus, etc.) - le <strong>frontend a besoin d'analyser les r√©ponses:</strong> √™tre capable d'it√©rer sur des tableaux, de contourner l'objet et de savoir comment r√©duire les travaux.  Tous les d√©veloppeurs novices ne connaissent pas ces choses complexes.  Il existe des biblioth√®ques de s√©rialiseurs / d√©s√©rialiseurs, vous pouvez les utiliser.  En g√©n√©ral, cela fonctionne uniquement avec des donn√©es, mais les objets sont volumineux. <br><br>  Et le <strong>backend a</strong> mal: <br><br><ul><li>  Contr√¥le de l'embo√Ætement - inclure peut √™tre grimp√© tr√®s loin; </li><li>  La complexit√© des requ√™tes de base de donn√©es - elles sont parfois construites automatiquement et s'av√®rent tr√®s difficiles; </li><li>  S√©curit√© - vous pouvez grimper dans la jungle, surtout si vous connectez une sorte de biblioth√®que; </li><li>  La sp√©cification est difficile √† lire.  Elle est en anglais, et cela en a effray√© certains, mais peu √† peu tout le monde s'y est habitu√©; </li><li>  Toutes les biblioth√®ques n'impl√©mentent pas bien la sp√©cification - c'est un probl√®me Open Source. </li></ul><br><h4>  API JSON pi√®ges <br></h4><br>  Un peu de hardcore. <br><br>  <strong>Le nombre de relations dans le probl√®me n'est pas limit√©.</strong>  Si nous incluons, demandons des articles, y ajoutons des commentaires, alors en r√©ponse, nous recevrons tous les commentaires de cet article.  Il y a 10 000 commentaires - obtenez tous les 10 000 commentaires: <br><br> <code>GET /articles/1?include=comments /1.1</code> <br> <br> <code>01. ... <br> 02. "relationships": { <br> 03. "comments": { <br> 04.  "data": <b><font color="#c6e90e">[0 ... ‚àû]</font></b> <br> 05. } <br> 06. }</code> <br> <br>  Ainsi, en r√©alit√©, 5 Mo sont venus √† notre demande en r√©ponse: ¬´Il est √©crit dans le cahier des charges - il est n√©cessaire de reformuler correctement la demande: <br><br> <code>GET /comments? <b><font color="#c6e90e">filters[article]=1&amp;</font></b> page[size]=30 HTTP/1.1</code> <br> <br> <code>01. { <br> 02. "data": <b><font color="#c6e90e">[0 ... 29]</font></b> <br> 03. }</code> <br> <br>  Nous demandons des commentaires avec un filtre par article, disons: "30 pi√®ces, s'il vous pla√Æt" et obtenez 30 commentaires.  C'est l'ambigu√Øt√©. <br><br>  <strong>Les m√™mes choses peuvent √™tre formul√©es de mani√®re ambigu√´</strong> : <br><br>  ‚óè <code>GET /articles/1 <b><font color="#c6e90e">?include=comments</font></b> HTTP/1.1</code> - demander un article avec des commentaires; <br>  ‚óè <code>GET /articles/1/comments HTTP/1.1</code> - demander des commentaires sur l'article; <br>  ‚óè <code>GET /comments <b><font color="#c6e90e">?filters[article]=1</font></b> HTTP/1.1</code> - demander des commentaires avec un filtre par article. <br><br>  C'est la m√™me chose - les m√™mes donn√©es, qui sont obtenues de diff√©rentes mani√®res, il y a une certaine ambigu√Øt√©.  Cet √©cueil n'est pas imm√©diatement visible. <br><br>  <strong>Les relations polymorphes un √† plusieurs se</strong> glissent tr√®s rapidement dans REST. <br><br> <code>01. GET /comments?include=commentable /1.1 <br> 02. <br> 03. ... <br> 04. "relationships": { <br> 05. <b><font color="#c6e90e">"commentable"</font></b> : { <br> 06.  "data": { "type": "article", "id": "1‚Ä≥ } <br> 07. } <br> 08. }</code> <br> <br>  Il existe une connexion polymorphe commentable sur le backend - elle rampe dans REST.  Cela devrait donc arriver, mais cela peut √™tre d√©guis√©.  Vous ne pouvez pas le masquer dans l'API JSON - il sortira. <br><br>  <strong>Relations plusieurs-√†-plusieurs complexes avec des options avanc√©es</strong> .  De plus, toutes les tables de connexion sortent: <br><br> <code>01. GET /users?include <b><font color="#c6e90e">=users_comments</font></b> /1.1 <br> 02. <br> 03. ... <br> 04. "relationships": { <br> 05. "users_comments": { <br> 06.  "data": [{ "type": "users_comments", "id": "1‚Ä≥ }, ...] <br> 07. }, <br> 08. }</code> <br> <br><h2>  Swagger <br></h2><br>  Swagger est un outil d'√©criture de documentation en ligne. <br><br>  Disons que notre d√©veloppeur principal a √©t√© invit√© √† √©crire la documentation de son API, et il l'a √©crite.  C'est facile si l'API est simple.  S'il s'agit d'une API JSON, Swagger ne peut pas √™tre √©crit si facilement. <br><br>  <strong>Exemple:</strong> animalerie Swagger.  Chaque m√©thode peut √™tre ouverte, voir r√©ponse et exemples. <br><br><img src="https://habrastorage.org/webt/ul/lj/yk/ulljykpo7bhyw85r9ru69k2nuxe.png"><br><br>  Ceci est un exemple de mod√®le Pet.  Voici une interface sympa, tout est facile √† lire. <br><br><img src="https://habrastorage.org/webt/i9/rg/ir/i9rgirjcdxgm16ogmtopu6dnjrq.png"><br><br>  Et voici √† quoi ressemble la cr√©ation du mod√®le d'API JSON: <br><br><img src="https://habrastorage.org/webt/ty/14/kn/ty14knt_laxzsr2ozusbo0xkk0c.png"><br><br>  Ce n'est pas si g√©nial.  Nous avons besoin de donn√©es, dans des donn√©es quelque chose avec des relations, contient 5 types de mod√®les, etc.  Vous pouvez √©crire Swagger, l'API ouverte est une chose puissante, mais compliqu√©e. <br><br><h2>  Alternative <br></h2><br>  Il existe une sp√©cification OData, qui est apparue un peu plus tard - en 2015.  C'est ¬´La meilleure fa√ßon de se reposer¬ª, comme le garantit le site officiel.  Cela ressemble √† ceci: <br><br>  <code>01. GET http://services.odata.org/v4/TripRW/People HTTP/1.1</code> - demande GET; <br>  <code>02. OData-Version: 4.0</code> - en-t√™te sp√©cial avec version; <br>  <code>03. OData-MaxVersion: 4.0</code> - Deuxi√®me en-t√™te de version sp√©ciale <br><br>  La r√©ponse ressemble √† ceci: <br><br> <code>01. HTTP/1.1 200 OK <br> 02. Content-Type: application/json; odata.metadata=minimal <br> 03. OData-Version: 4.0 <br> 04. { <br> 05. '@odata.context': 'http://services.odata.org/V4/ <br> 06. '@odata.nextLink' : 'http://services.odata.org/V4/ <br> 07. 'value': [{ <br> 08.  '@odata.etag': 1W/108D1D5BD423E51581‚Ä≤, <br> 09.  'UserName': 'russellwhyte', <br> 10.  ... <br></code> <br>  Voici l'application √©tendue / json et l'objet. <br><br>  Nous n'avons pas utilis√© OData, tout d'abord, car c'est la m√™me chose que l'API JSON, mais ce n'est pas concis.  Il y a des objets √©normes et il me semble que tout est bien pire √† lire.  OData est √©galement sorti en Open Source, mais c'est plus compliqu√©. <br><br><h2>  Et GraphQL? <br></h2><br>  Naturellement, lorsque nous recherchions un nouveau format d'API, nous avons rencontr√© ce battage m√©diatique. <br><br>  ‚óè <strong>Seuil d'entr√©e √©lev√©.</strong> <br><br>  Du point de vue du frontend, tout semble cool, mais vous ne pouvez pas demander au nouveau d√©veloppeur d'√©crire GraphQL, car vous devez d'abord l'√©tudier.  C'est comme SQL - vous ne pouvez pas √©crire imm√©diatement SQL, vous devez au moins lire ce que c'est, parcourir les tutoriels, c'est-√†-dire que le seuil d'entr√©e augmente. <br><br>  ‚óè <strong>L'effet du big bang.</strong> <br><br>  S'il n'y avait pas d'API dans le projet, et que nous avons commenc√© √† utiliser GraphQL, apr√®s un mois nous avons r√©alis√© que cela ne nous convenait pas, il serait trop tard.  Dois √©crire des b√©quilles.  Vous pouvez √©voluer avec l'API JSON ou OData - le RESTful le plus simple, s'am√©liorant progressivement, se transforme en une API JSON. <br><br>  ‚óè L' <strong>enfer sur le backend.</strong> <br><br>  GraphQL appelle l'enfer sur le backend - un √† un, tout comme l'API JSON enti√®rement impl√©ment√©e, car GraphQL obtient un contr√¥le total sur les requ√™tes, et ceci est une biblioth√®que, et vous devrez r√©soudre un tas de questions: <br><br><ul><li>  contr√¥le de la nidification; </li><li>  r√©cursivit√© </li><li>  limitation de fr√©quence; </li><li>  contr√¥le d'acc√®s. </li></ul><br><h2>  Au lieu de conclusions <br></h2><br>  Je recommande d'arr√™ter de discuter sur le garage √† v√©los, de prendre l'outil anti-bikeshedding comme sp√©cification et de simplement cr√©er une API avec une bonne sp√©cification. <br><br>  Pour trouver votre norme pour r√©soudre le probl√®me d'un abri √† v√©los, vous pouvez consulter ces liens: <br><br>  ‚óè <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://jsonapi.org</a> <br>  ‚óè <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://www.odata.org</a> <br>  ‚óè <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://graphgl.org</a> <br> ‚óè <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://xmlrpc.scripting.com</a> <br> ‚óè <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.jsonrpc.org</a> <br><br> <strong>   :</strong> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">alexey-avdeev.com</a>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github</a> . <br><br><blockquote> ,  <strong>  </strong>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Frontend Conf</a> ,   27  28    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">++</a> .     ,        . <br><br> <strong>   ?</strong>      ?        ?    ,        ? <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> ! <br><br>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> ,  ,   ,    ,      . <br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr433322/">https://habr.com/ru/post/fr433322/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr433306/index.html">Visual studio 2019</a></li>
<li><a href="../fr433308/index.html">Transfert de la configuration PBX vers le service 3CX PBX Express</a></li>
<li><a href="../fr433316/index.html">Design digest: int√©gration, feedback, recherche d'id√©es et prise de d√©cision</a></li>
<li><a href="../fr433318/index.html">garbage.collect ()</a></li>
<li><a href="../fr433320/index.html">Disposition de la grille comme base des mises en page modernes</a></li>
<li><a href="../fr433324/index.html">Collecter le paquet de r√™ves avec Webpack</a></li>
<li><a href="../fr433326/index.html">Qualit√© du code</a></li>
<li><a href="../fr433328/index.html">Mieux vaut perdre un jour</a></li>
<li><a href="../fr433330/index.html">R√©solvez les mots crois√©s japonais avec SAT Solver</a></li>
<li><a href="../fr433332/index.html">Prise en charge de Python dans Azure Functions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>