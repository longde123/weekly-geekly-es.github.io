<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèì ‚è´ üèæ Guide de l'audit automatique des contrats intelligents. Partie 3: Mythril üë©üèº‚Äçüè´ üç£ üë®üèΩ‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avertissement 


 Cet article n'est pas une √©valuation de l'efficacit√© des analyseurs automatiques. Je les applique √† mes propres contrats, synth√©tisa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guide de l'audit automatique des contrats intelligents. Partie 3: Mythril</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442114/"><h2 id="warning">  <strong>Avertissement</strong> </h2><br><p>  Cet article n'est pas une √©valuation de l'efficacit√© des analyseurs automatiques.  Je les applique √† mes propres contrats, synth√©tisant intentionnellement des erreurs et √©tudie les r√©actions.  Une telle √©tude ne peut pas √™tre la base pour d√©terminer ¬´mieux-pire¬ª, pour cela il est logique de mener une √©tude en aveugle sur un large √©chantillon de contrats, ce qui, √©tant donn√© la nature capricieuse de ce type de logiciel, est extr√™mement difficile √† mener.  Il est tout √† fait possible qu'une petite erreur dans le contrat puisse d√©sactiver une grande partie de la logique de l'analyseur, et un simple signe heuristique peut ajouter une √©norme quantit√© de points √† l'analyseur en trouvant un bogue r√©pandu que les concurrents n'ont tout simplement pas r√©ussi √† ajouter.  Des erreurs dans la pr√©paration et la compilation des contrats peuvent √©galement jouer un r√¥le.  Tous les logiciels en question sont assez jeunes et sont constamment d√©velopp√©s, donc ne prenez pas les commentaires critiques comme des probl√®mes irr√©parables. </p><br><p> Le but de l'article est de donner au lecteur une compr√©hension du fonctionnement des m√©thodes d'analyse de code dans diff√©rents analyseurs et la capacit√© de les utiliser correctement, plut√¥t que de ¬´faire un choix¬ª.  Un choix raisonnable consiste √† utiliser plusieurs outils √† la fois, en se concentrant sur le plus appropri√© pour le contrat analys√©. </p><a name="habracut"></a><br><h2 id="nastroyka-i-podgotovka-k-zapusku">  <strong>Configuration et pr√©paration pour le lancement</strong> </h2><br><p>  Mythril utilise plusieurs types d'analyses √† la fois, voici quelques bons articles √† ce sujet: le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus important</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ceci</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cela</a> .  Avant de continuer, il est logique de les lire. </p><br><p>  Tout d'abord, construisons notre propre image Docker de Mythril (peu importe ce que nous voulons y changer?): </p><br><pre><code class="plaintext hljs">git clone https://github.com/ConsenSys/mythril-classic.git cd mythril-classic docker build -t myth .</code> </pre> <br><p>  Essayez maintenant de l'ex√©cuter sur nos <code>contracts/flattened.sol</code> (j'utilise le m√™me contrat qui a √©t√© discut√© dans l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">introduction</a> ), dans lequel il y a deux contrats principaux, <code>Ownable</code> de Zeppelin et notre <code>Booking</code> .  Nous avons toujours un probl√®me avec la version du compilateur, je l'ai corrig√© de la m√™me mani√®re que dans l'article pr√©c√©dent, en ajoutant des lignes au Dockerfile qui remplaceront la version du compilateur: </p><br><pre> <code class="plaintext hljs">COPY --from=ethereum/solc:0.4.20 /usr/bin/solc /usr/bin</code> </pre> <br><p>  Apr√®s avoir reconstruit l'image, vous pouvez essayer d'ex√©cuter l'analyse de contrat.  <code>-v4</code> imm√©diatement les <code>-v4</code> et <code>--verbose-report</code> pour voir tous les avertissements.  C'est parti: </p><br><pre> <code class="plaintext hljs">docker run -v $(pwd):/tmp \ -w /tmp myth:latest \ -v4 \ --verbose-report \ -x contracts/flattened.sol</code> </pre> <br><p>  Ici, nous travaillons avec un contrat aplati sans d√©pendances.  Pour analyser un contrat <code>Booking.sol</code> distinct et pour que Mythril r√©cup√®re toutes les d√©pendances, vous pouvez utiliser quelque chose comme ceci: </p><br><pre> <code class="plaintext hljs">docker run -v $(pwd):/tmp \ -w /tmp myth:latest \ --solc-args="--allow-paths /tmp/node_modules/zeppelin-solidity/ zeppelin-solidity=/tmp/node_modules/zeppelin-solidity" \ -v4 \ --verbose-report \ -x contracts/Booking.sol</code> </pre> <br><p>  Je pr√©f√®re travailler avec l'option aplatie, car  nous allons beaucoup modifier le code.  Mais Mythril a √©galement un mode extr√™mement pratique - <code>--truffle</code> , qui <code>--truffle</code> simplement tout ce que la <code>truffle</code> , v√©rifiant l'ensemble du projet pour les vuln√©rabilit√©s.  Une autre caract√©ristique importante est la possibilit√© de sp√©cifier le nom du contrat √† analyser via deux points, sinon Mythril analysera tous les contrats qu'il rencontre.  Nous pensons que l' <code>Ownable</code> de OpenZeppelin est un contrat s√©curis√©, et nous allons seulement analyser la <code>Booking</code> , donc la derni√®re ligne √† ex√©cuter est: </p><br><pre> <code class="plaintext hljs">docker run -v $(pwd):/tmp -w /tmp myth:latest -x contracts/flattened.sol:Booking -v4 --verbose-report</code> </pre> <br><h2 id="zapusk-i-deploy-kontrakta">  <strong>D√©marrer et d√©ployer le contrat</strong> </h2><br><p>  Nous d√©marrons l'analyseur avec la ligne ci-dessus, regardons la sortie, et nous obtenons, entre autres, cette ligne: </p><br><pre> <code class="plaintext hljs">mythril.laser.ethereum.svm [WARNING]: No contract was created during the execution of contract creation Increase the resources for creation execution (--max-depth or --create-timeout) The analysis was completed successfully. No issues were detected.</code> </pre> <br><p>  Il s'av√®re que notre contrat n'a pas √©t√© cr√©√© et "corrig√©" dans l'√©mulateur.  C'est pourquoi je recommande d'utiliser l'indicateur <code>-v4</code> pour tous les types d'analyse pour voir tous les messages et ne pas en rater un seul important.  Voyons ce qui ne va pas.  La solution √† ce probl√®me pratique est tr√®s importante pour comprendre comment utiliser correctement Mythril. </p><br><p>  Nous lisons donc √† propos de Mythril: <code>It uses concolic analysis, taint analysis and control flow checking to detect a variety of security vulnerabilities</code> .  Si vous n'√™tes pas tr√®s familier avec ces termes, je recommande le wiki sur les tests concoliques <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> , mais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">voici une</a> bonne pr√©sentation sur la v√©rification des taches pour x86.  En bref: Mythril √©mule l'ex√©cution d'un contrat, fixe les branches le long desquelles l'ex√©cution peut aller et essaie d'atteindre un √©tat ¬´cass√©¬ª du contrat, triant diverses combinaisons de param√®tres et essayant de contourner tous les chemins possibles.  Voici un exemple de diagramme d'action de l'article ci-dessus: </p><br><pre> <code class="plaintext hljs">1.      .   symbolic-,        . 2.      ,     ,   trace .    ,      ,    . 3.     . 4.       trace-. 5.  symbolic execution   trace,   symbolic ,    ,     ,     . 6.     ,          .    , . 7.   :   ,   ,   input-,     ,      .   input-   ,   .6    . 8.   .4</code> </pre> <br><p>  Si vous le simplifiez grandement, Mythril, apr√®s avoir rencontr√© une branche dans le code, peut comprendre sous quels ensembles de variables il est possible d'entrer dans l'une et l'autre branche.  Dans chaque branche, Mythril sait si cela conduit √† <code>assert</code> , <code>transfer</code> , <code>selfdestruct</code> et autres opcodes li√©s √† la s√©curit√©.  Par cons√©quent, Mythril analyse quels ensembles de param√®tres et de transactions peuvent entra√Æner une violation de la s√©curit√©.  Et la fa√ßon dont Mythril coupe les branches qui ne sont jamais contr√¥l√©es et analyse le flux de contr√¥le est sa principale astuce.  Plus de d√©tails sur l'intestin de Mythril et la marche des branches sont √©crits <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><br><p>  En raison de la nature d√©terministe de l'ex√©cution intelligente des contrats, la m√™me s√©quence d'instructions entra√Æne toujours strictement un seul ensemble de changements d'√©tat, quelle que soit la plate-forme, l'architecture ou l'environnement.  De plus, les fonctions dans les contrats intelligents sont plut√¥t courtes et les ressources sont extr√™mement limit√©es, donc les analyseurs comme Mythril, combinant ex√©cution symbolique et native, peuvent fonctionner extr√™mement efficacement pour les contrats intelligents. </p><br><p>  Dans le processus, Mythril utilise le concept "d'√©tat" - c'est le code du contrat, son environnement, un pointeur vers la commande actuelle, le stockage du contrat et l'√©tat de la pile.  Voici la documentation: </p><br><pre> <code class="plaintext hljs">The machine state Œº is defined as the tuple (g, pc, m, i, s) which are the gas available, the program counter pc ‚àà P256, the memory contents, the active number of words in memory (counting continuously from position 0), and the stack contents. The memory contents Œºm are a series of zeroes of size 256.</code> </pre> <br><p>  Le graphe de transition entre les √©tats est le principal objet d'√©tude.  En cas de lancement r√©ussi de l'analyse, des informations sur ce graphique sont affich√©es dans le journal d'analyse.  De plus, Mythril peut construire ce graphique sous une forme lisible par l'homme en utilisant l'option <code>--graph</code> . </p><br><p>  Maintenant, en comprenant plus ou moins ce que Mythril fera, nous continuerons de comprendre pourquoi le contrat n'est pas analys√© et d'o√π il vient. <code>[WARNING]: No contract was created during the execution of contract creation</code> .  Pour commencer, j'ai tordu les <code>--max-depth</code> <code>--create-timeout</code> et <code>--max-depth</code> (comme recommand√©) et, n'obtenant pas le r√©sultat, je pensais que le constructeur √©tait √† bl√¢mer - quelque chose ne fonctionnait pas.  Voici son code: </p><br><pre> <code class="plaintext hljs">function Booking( string _description, string _fileUrl, bytes32 _fileHash, uint256 _price, uint256 _cancellationFee, uint256 _rentDateStart, uint256 _rentDateEnd, uint256 _noCancelPeriod, uint256 _acceptObjectPeriod ) public payable { require(_price &gt; 0); require(_price &gt; _cancellationFee); require(_rentDateStart &gt; getCurrentTime()); require(_rentDateEnd &gt; _rentDateStart); require(_rentDateStart+_acceptObjectPeriod &lt; _rentDateEnd); require(_rentDateStart &gt; _noCancelPeriod); m_description = _description; m_fileUrl = _fileUrl; m_fileHash = _fileHash; m_price = _price; m_cancellationFee = _cancellationFee; m_rentDateStart = _rentDateStart; m_rentDateEnd = _rentDateEnd; m_noCancelPeriod = _noCancelPeriod; m_acceptObjectPeriod = _acceptObjectPeriod; }</code> </pre> <br><p>  Rappelez-vous l'algorithme d'action de Mythril.  Pour ex√©cuter la trace, vous devez appeler le constructeur du contrat, car toute ex√©cution ult√©rieure d√©pendra des param√®tres avec lesquels le constructeur a √©t√© appel√©.  Par exemple, si vous appelez le constructeur avec <code>_price == 0</code> , le constructeur <code>require(_price &gt; 0)</code> une exception sur <code>require(_price &gt; 0)</code> .  M√™me si Mythril parcourt les nombreuses valeurs de <code>_price</code> , le constructeur <code>_price</code> toujours si, par exemple, <code>_price &lt;= _cancellationFee</code> .  Dans ce contrat, il y a une douzaine de param√®tres associ√©s √† des restrictions strictes, et Mythril, bien s√ªr, ne peut pas deviner les combinaisons valides de param√®tres.  Il essaie d'aller √† la prochaine branche d'ex√©cution, triant les param√®tres du constructeur, mais il n'a pratiquement aucune chance de deviner - il y a trop de combinaisons de param√®tres.  Par cons√©quent, le calcul du contrat ne fonctionne pas - toutes les fa√ßons reposent sur une sorte d' <code>require(...)</code> , et nous obtenons le probl√®me ci-dessus. </p><br><p>  Maintenant, nous avons deux fa√ßons: la premi√®re consiste √† d√©sactiver tous les √©l√©ments <code>require</code> dans le constructeur en les commentant.  Mythril pourra alors appeler le constructeur avec n'importe quel ensemble de param√®tres et tout fonctionnera.  Mais cela signifie qu'en examinant un contrat avec de tels param√®tres, Mythril trouvera des erreurs possibles avec des valeurs incorrectes transmises au constructeur.  En termes simples, si Mythril trouve un bogue qui survient si le cr√©ateur du contrat sp√©cifie <code>_cancellationFee</code> un milliard de fois le prix de location de <code>_mprice</code> , alors il n'y a aucune utilit√© dans un tel bogue - un tel contrat ne sera jamais bloqu√© et les ressources pour trouver des erreurs seront d√©pens√©es.  Nous supposons que le contrat est toujours bloqu√© avec des param√®tres plus ou moins coh√©rents, donc pour une analyse plus approfondie, il est logique de sp√©cifier des param√®tres de constructeur plus r√©alistes afin que Mythril ne recherche pas les erreurs qui ne se produiront jamais si le contrat est correctement cl√¥tur√©. </p><br><p>  J'ai pass√© de nombreuses heures √† essayer de comprendre exactement o√π le d√©ploiement s'arr√™te, y compris et √† d√©sactiver diverses parties du constructeur.  En plus de mes probl√®mes, le constructeur utilise <code>getCurrentTime()</code> , qui retourne l'heure actuelle, et on ne sait pas comment cet appel g√®re Mythril.  Je ne d√©crirai pas ces aventures ici, car  tr√®s probablement avec une utilisation r√©guli√®re, ces subtilit√©s seront connues de l'auditeur.  Par cons√©quent, j'ai choisi la deuxi√®me fa√ßon: pour limiter les donn√©es d'entr√©e, et simplement supprim√© tous les param√®tres du constructeur, m√™me <code>getCurrentTime()</code> , simplement cod√© en dur les param√®tres n√©cessaires directement dans le constructeur (id√©alement, ces param√®tres devraient √™tre obtenus aupr√®s du client): </p><br><pre> <code class="plaintext hljs"> function Booking( ) public payable { m_description = "My very long booking text about hotel and beautiful sea view!"; m_fileUrl = "https://ether-airbnb.bam/some-url/"; m_fileHash = 0x1628f3170cc16d40aad2e8fa1ab084f542fcb12e75ce1add62891dd75ba1ffd7; m_price = 1000000000000000000; // 1 ETH m_cancellationFee = 100000000000000000; // 0.1 ETH m_rentDateStart = 1550664800 + 3600 * 24; // current time + 1 day m_rentDateEnd = 1550664800 + 3600 * 24 * 4; // current time + 4 days m_acceptObjectPeriod = 3600 * 8; // 8 hours m_noCancelPeriod = 3600 * 24; // 1 day require(m_price &gt; 0); require(m_price &gt; m_cancellationFee); require(m_rentDateStart &gt; 1550664800); require(m_rentDateEnd &gt; m_rentDateStart); require((m_rentDateStart + m_acceptObjectPeriod) &lt; m_rentDateEnd); require(m_rentDateStart &gt; m_noCancelPeriod); }</code> </pre> <br><p>  De plus, pour que tout commence, vous devez √©galement d√©finir le param√®tre <code>max-depth</code> .  Cela a fonctionn√© pour moi avec ce constructeur avec <code>--max-depth=34</code> sur l'instance AWS t2.medium.  Dans le m√™me temps, sur mon ordinateur portable, qui est plus puissant, tout commence sans <code>max-depth</code> .  A en juger par l'utilisation de ce <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">param√®tre</a> , il est n√©cessaire de construire des branches pour l'analyse, et sa valeur par d√©faut est l'infini ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">code</a> ).  Par cons√©quent, tournez-tournez ce param√®tre, mais assurez-vous que le contrat souhait√© est analys√©.  Vous pouvez comprendre cela par des messages comme: </p><br><pre> <code class="plaintext hljs">mythril.laser.ethereum.svm [INFO]: 248 nodes, 247 edges, 2510 total states mythril.laser.ethereum.svm [INFO]: Achieved 59.86% coverage for code: .............</code> </pre> <br><p>  La premi√®re ligne d√©crit simplement le graphique qui sera analys√©, lisez vous-m√™me le reste des lignes.  De s√©rieuses ressources informatiques sont n√©cessaires pour analyser les diff√©rentes branches qui peuvent √™tre ex√©cut√©es, donc lors de l'analyse de gros contrats, vous devrez attendre m√™me sur un ordinateur rapide. </p><br><h2 id="poisk-oshibok">  <strong>Rechercher des erreurs</strong> </h2><br><p>  Nous allons maintenant rechercher les erreurs et ajouter les n√¥tres.  Mythril recherche les branches dans lesquelles se d√©roulent la diffusion, l'autodestruction, l'affirmation et d'autres actions importantes du point de vue de la s√©curit√©.  Si l'une des instructions ci-dessus appara√Æt quelque part dans le code du contrat, Mythril examine les fa√ßons dont il est possible de se rendre dans cette agence et, de plus, affiche la s√©quence des transactions menant √† cette agence! </p><br><p>  Tout d'abord, voyons ce que Mythril a √©mis pour le contrat de <code>Booking</code> longue dur√©e.  Premier avertissement: </p><br><pre> <code class="plaintext hljs">==== Dependence on predictable environment variable ==== SWC ID: 116 Severity: Low Contract: Booking Function name: fallback PC address: 566 Estimated Gas Usage: 17908 - 61696 Sending of Ether depends on a predictable variable. The contract sends Ether depending on the values of the following variables: - block.timestamp Note that the values of variables like coinbase, gaslimit, block number and timestamp are predictable and/or can be manipulated by a malicious miner. Don't use them for random number generation or to make critical decisions. -------------------- In file: contracts/flattened.sol:142 msg.sender.transfer(msg.value-m_price)</code> </pre> <br><p>  et cela se produit parce que </p><br><pre> <code class="plaintext hljs">require(m_rentDateStart &gt; getCurrentTime());</code> </pre> <br><p>  dans la fonction de secours. </p><br><p>  Notez que Mythril a r√©alis√© que <code>getCurrentTime()</code> cache dans <code>getCurrentTime()</code> .  Malgr√© le fait que le sens du contrat n'est pas une erreur, le fait que Mythril associe <code>block.timestamp</code> √† la diffusion est excellent!  Dans ce cas, le programmeur doit comprendre que la d√©cision est prise sur la base de la valeur que le mineur peut contr√¥ler.  Et, si √† l'avenir une ench√®re ou une autre ench√®re pour un service survient √† ce lieu du contrat, il faut tenir compte de la possibilit√© d'attaques en cours. </p><br><p>  Voyons si Mythril voit une d√©pendance √† <code>block.timestamp</code> si nous cachons la variable dans un appel imbriqu√© comme ceci: </p><br><pre> <code class="plaintext hljs">function getCurrentTime() public view returns (uint256) { - return now; + return getCurrentTimeInner(); } + function getCurrentTimeInner() internal returns (uint256) { + return now; + }</code> </pre> <br><p>  Et oui!  Mythril continue de voir la connexion entre block.timestamp et le transfert de diffusion, c'est extr√™mement important pour l'auditeur.  Le lien entre la variable contr√¥l√©e par l'attaquant et la d√©cision prise apr√®s plusieurs changements dans l'√©tat du contrat peut √™tre tr√®s masqu√© par la logique, et Mythril vous permet de la suivre.  Bien qu'il ne soit pas utile de compter sur le fait que toutes les connexions possibles entre toutes les variables possibles seront <code>getCurrentTime()</code> pour vous: si vous continuez √† vous moquer de la fonction <code>getCurrentTime()</code> et √† effectuer une triple profondeur d'imbrication, l'avertissement dispara√Æt.  Chaque appel de fonction pour Mythril n√©cessite la cr√©ation de nouvelles branches d'√©tat, donc l'analyse de niveaux tr√®s profonds d'imbrication n√©cessitera d'√©normes ressources. </p><br><p>  Il y a, bien s√ªr, une chance assez s√©rieuse que j'utilise simplement de mani√®re incorrecte les param√®tres d'analyse ou que la coupure se produise quelque part dans les profondeurs de l'analyseur.  Comme je l'ai dit, le produit est en d√©veloppement actif, juste au moment de la r√©daction, je vois des commits dans le r√©f√©rentiel avec la mention de <code>max-depth</code> , alors ne prenez pas les probl√®mes actuels au s√©rieux, nous avons d√©j√† trouv√© suffisamment de preuves que Mythril peut tr√®s efficacement rechercher des connexions implicites entre variables. </p><br><p>  Tout d'abord, ajoutez au contrat une fonction qui donne la diffusion √† n'importe qui, mais seulement apr√®s que le client a envoy√© la diffusion au contrat.  Nous avons permis √† quiconque de ramasser 1/5 de l'√©ther, mais uniquement lorsque le contrat est en <code>State.PAID</code> (c'est-√†-dire uniquement apr√®s que le client a pay√© le num√©ro lou√© avec de l'√©ther).  Voici la fonction: </p><br><pre> <code class="plaintext hljs">function collectTaxes() external onlyState(State.PAID) { msg.sender.transfer(address(this).balance / 5); }</code> </pre> <br><p>  Mythril a trouv√© le probl√®me: </p><br><pre> <code class="plaintext hljs">==== Unprotected Ether Withdrawal ==== SWC ID: 105 Severity: High Contract: Booking Function name: collectTaxes() PC address: 2492 Estimated Gas Usage: 2135 - 2746 Anyone can withdraw ETH from the contract account. Arbitrary senders other than the contract creator can withdraw ETH from the contract account without previously having sent a equivalent amount of ETH to it. This is likely to be a vulnerability. -------------------- In file: contracts/flattened.sol:149 msg.sender.transfer(address(this).balance / 5) -------------------- -------------------- Transaction Sequence: { "2": { "calldata": "0x", "call_value": "0xde0b6b3a7640000", "caller": "0xdeadbeefdeadbeefdeadbeefdeadbeefdeadbeef" }, "3": { "calldata": "0x01b613a5", "call_value": "0x0", "caller": "0xdeadbeefdeadbeefdeadbeefdeadbeefdeadbeef" } }</code> </pre> <br><p>  G√©nial, c'est-√†-dire  Mythril a m√™me fait ressortir deux transactions, ce qui conduit au fait que vous pouvez retirer de l'√©ther du contrat.  Maintenant, changez l'exigence <code>State.RENT</code> en <code>State.RENT</code> , comme ceci: </p><br><pre> <code class="plaintext hljs">- function collectTaxes() external onlyState(State.PAID){ + function collectTaxes() external onlyState(State.RENT) {</code> </pre> <br><p>  Maintenant <code>collectTaxes()</code> ne peut √™tre appel√© que lorsque le contrat est dans l'√©tat <code>State.RENT</code> , et pour le moment il n'y a rien sur la balance, car  le contrat a d√©j√† envoy√© la totalit√© de l'√©mission au propri√©taire.  Et l'important ici est que cette fois, Mythril <strong>NE</strong> g√©n√®re <strong>PAS</strong> l'erreur <code>==== Unprotected Ether Withdrawal ====</code> !  Sous la condition <code>onlyState(State.RENT)</code> , l'analyseur n'est pas arriv√© √† la branche de code qui envoie de l'√©ther du contrat avec un solde non nul.  Mythril est pass√© par diff√©rentes options pour les param√®tres, mais vous ne pouvez entrer dans <code>State.RENT</code> qu'en envoyant toute la diffusion au bailleur.  Par cons√©quent, il est impossible d'acc√©der √† cette branche du code avec un solde non nul, et Mythril ne d√©range absolument pas l'auditeur! </p><br><p>  De la m√™me mani√®re, Mythril trouvera l' <code>selfdestruct</code> et <code>assert</code> , montrant √† l'auditeur quelles actions peuvent conduire √† la destruction du contrat ou √† la rupture d'une fonction importante.  Je ne donnerai pas ces exemples, essayez simplement de cr√©er une fonction similaire √† celle ci-dessus, en appelant uniquement <code>selfdestruct</code> et en d√©formant sa logique. </p><br><p>  N'oubliez pas non plus que l'une des parties de Mythril est l'ex√©cution symbolique, et cette approche, en elle-m√™me, sans √©muler l'ex√©cution, peut d√©terminer de nombreuses vuln√©rabilit√©s.  Par exemple, toute utilisation de "+", "-" et d'autres op√©rateurs arithm√©tiques peut √™tre consid√©r√©e comme une vuln√©rabilit√© de "d√©passement d'entier" si l'un des op√©randes est en quelque sorte contr√¥l√© par l'attaquant.  Mais je r√©p√®te encore une fois, la caract√©ristique la plus puissante de Mythril est la combinaison de l'ex√©cution symbolique et native et la d√©termination des valeurs des param√®tres conduisant √† une ramification logique. </p><br><h2 id="zaklyuchenie">  <strong>Conclusion</strong> </h2><br><p>  Bien s√ªr, pour montrer toute la gamme des probl√®mes potentiels que Mythril est capable de d√©tecter, il faudra non pas un, mais plusieurs articles.  Pour tout le reste, il sait tout faire dans une vraie blockchain, trouvant les contrats et les vuln√©rabilit√©s n√©cessaires par des signatures, construisant de beaux graphes d'appels, formatant des rapports.  Mythril vous permet √©galement d'√©crire vos propres scripts de test, fournissant une interface bas√©e sur python au contrat et vous permettant de tester des fonctions individuelles, de fixer des valeurs de param√®tres ou m√™me de mettre en ≈ìuvre votre propre strat√©gie pour travailler avec du code d√©sassembl√© avec un degr√© de flexibilit√© arbitraire. </p><br><p>  Mythril est encore un logiciel assez jeune, ce n'est pas IDA Pro, et il y a tr√®s peu de documentation sauf quelques articles.  La valeur de nombreux param√®tres ne peut √™tre lue que dans le code Mythril, en commen√ßant par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cli.py.</a>  J'esp√®re qu'une description compl√®te et approfondie du fonctionnement de chaque param√®tre appara√Ætra dans la documentation. </p><br><p>  De plus, lorsque le contrat est plus ou moins volumineux, la sortie d'un tas d'erreurs prend beaucoup de place, mais j'aimerais pouvoir recevoir des informations compress√©es sur l'erreur trouv√©e, car  lorsque vous travaillez avec Mythril, vous devez absolument regarder le chemin d'analyse, voir quels contrats ont √©t√© test√©s au mieux de vos capacit√©s et √™tre en mesure de d√©sactiver de force des erreurs sp√©cifiques que l'auditeur consid√®re comme faussement positives. </p><br><p>  Mais en g√©n√©ral, Mythril est un excellent et extr√™mement puissant outil d'analyse des contrats intelligents et devrait √† l'heure actuelle √™tre dans l'arsenal de tout auditeur.  Il vous permet au moins de pr√™ter attention aux parties critiques du code et de d√©tecter les relations cach√©es entre les variables. </p><br><p>  Pour r√©sumer, les recommandations d'utilisation de Mythril sont les suivantes: </p><br><ol><li>  Limitez autant que possible les conditions de d√©part du contrat √† l'√©tude.  Si lors de l'analyse Mythril d√©pensera beaucoup de ressources sur des branches qui ne seront jamais impl√©ment√©es en pratique, il perdra la capacit√© de trouver des bugs vraiment importants, vous devriez donc toujours essayer de restreindre la zone des branches potentielles. </li><li>  Assurez-vous que l'analyse des contrats a commenc√©, ne manquez pas les messages comme <code>mythril.laser.ethereum.svm [WARNING]: No contract was created during the execution of contract creation Increase the resources for creation execution (--max-depth or --create-timeout)</code> , sinon vous pourriez penser √† tort qu'il n'y a pas de bugs. </li><li>  Vous pouvez d√©sactiver arbitrairement les branches dans le code du contrat, ce qui donne moins de variation √† Mythril dans le choix des branches et l'√©conomie de ressources.  Essayez de le faire sans restrictions sur la <code>max-depth</code> , afin de ne pas "couper" l'analyse, mais attention √† ne pas masquer l'erreur. </li><li>  Faites attention √† chaque avertissement, m√™me les commentaires l√©gers valent parfois la peine d'ajouter au moins un commentaire au code du contrat, ce qui facilite la t√¢che des autres d√©veloppeurs. </li></ol><br><p>  Dans le prochain article, nous traiterons de l'analyseur Manticore, mais voici la table des mati√®res des articles pr√™ts ou pr√©vus pour l'√©criture: </p><br><p>  Partie 1. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Introduction.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Compilation, aplatissement, versions de Solidity</a> <br>  Partie 2. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Slither</a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partie 3. Mythril (cet article) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partie 4. Manticore (pendant l'√©criture) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partie 5. Echidna (pendant l'√©criture)</font></font></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr442114/">https://habr.com/ru/post/fr442114/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr442102/index.html">A la question des batteries</a></li>
<li><a href="../fr442104/index.html">Guide de l'utilisateur Kibana. Visualisation. Partie 5</a></li>
<li><a href="../fr442108/index.html">Guide pour les d√©veloppeurs pour cr√©er des applications AI</a></li>
<li><a href="../fr442110/index.html">Antipatterns Vim</a></li>
<li><a href="../fr442112/index.html">De nouveaux langages de programmation tuent tranquillement notre connexion avec la r√©alit√©</a></li>
<li><a href="../fr442116/index.html">Am√©lioration de la fonctionnalit√© des composants React avec React.memo ()</a></li>
<li><a href="../fr442118/index.html">Le pool minier Coinhive cesse de fonctionner</a></li>
<li><a href="../fr442120/index.html">Formation aux mod√®les TensorFlow avec Azure Machine Learning Service</a></li>
<li><a href="../fr442122/index.html">Un simple Levelord moscovite: une entrevue avec le cr√©ateur de Duke Nukem</a></li>
<li><a href="../fr442124/index.html">Facebook donnera aux utilisateurs la possibilit√© de nettoyer leur histoire</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>