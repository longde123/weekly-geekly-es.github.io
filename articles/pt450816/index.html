<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî° üé≥ üé∫ Cabe√ßalhos HTTP para o desenvolvedor respons√°vel üßìüèæ üé™ üë≤üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hoje, estar online √© uma condi√ß√£o comum para muitas pessoas. Todos compramos, comunicamos, lemos artigos, procuramos informa√ß√µes sobre v√°rios t√≥picos....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cabe√ßalhos HTTP para o desenvolvedor respons√°vel</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/450816/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/9l/a1/ll/9la1llcyspwwfylwvmocsfvgnfe.jpeg"></div><br>  Hoje, estar online √© uma condi√ß√£o comum para muitas pessoas.  Todos compramos, comunicamos, lemos artigos, procuramos informa√ß√µes sobre v√°rios t√≥picos.  A rede nos conecta ao mundo inteiro, mas, acima de tudo, conecta pessoas.  Eu mesmo uso a Internet h√° 20 anos e meu relacionamento com ela mudou oito anos atr√°s, quando me tornei desenvolvedor da Web. <br><br>  Os desenvolvedores conectam pessoas. <br>  Os desenvolvedores ajudam as pessoas. <br>  Os desenvolvedores d√£o oportunidades √†s pessoas. <br><br>  Os desenvolvedores podem criar uma rede para todos, mas essa capacidade deve ser usada com responsabilidade.  No final, √© importante criar coisas que ajudem as pessoas e as capacitem.  Neste artigo, quero falar sobre como os cabe√ßalhos HTTP podem ajud√°-lo a criar melhores produtos para o melhor trabalho de todos os usu√°rios na Internet. <br><a name="habracut"></a><br><h2>  HTTP - Protocolo de transfer√™ncia de hipertexto </h2><br>  Vamos falar sobre HTTP primeiro.  HTTP √© um protocolo usado pelos computadores para solicitar e enviar dados pela Internet. <br><br>  Quando o navegador solicita um recurso do servidor, ele usa HTTP.  Essa solicita√ß√£o inclui um conjunto de pares de valores-chave que cont√™m informa√ß√µes como a vers√£o do navegador ou os formatos de arquivo que ele entende.  Esses pares s√£o chamados de cabe√ßalhos de solicita√ß√£o. <br><br>  O servidor responde com o recurso solicitado, mas tamb√©m envia cabe√ßalhos de resposta contendo informa√ß√µes sobre o recurso ou o pr√≥prio servidor. <br><br><pre><code class="plaintext hljs">Request: GET https://the-responsible.dev/ Accept: text/html,application/xhtml+xml,application/xml Accept-Encoding: gzip, deflate, br Accept-Language: en-GB,en-US;q=0.9,en;q=0.8,de;q=0.7 ... Response: Connection: keep-alive Content-Type: text/html; charset=utf-8 Date: Mon, 11 Mar 2019 12:59:38 GMT ... Response Body</code> </pre> <br>  Hoje, o HTTP √© a base da Internet e oferece muitas maneiras de otimizar a experi√™ncia do usu√°rio.  Vamos ver como voc√™ pode usar cabe√ßalhos HTTP para criar uma rede segura e acess√≠vel. <br><br><h2>  A rede deve estar segura </h2><br>  Eu nunca me sentia em perigo quando procurava algo na Internet.  Mas quanto mais eu aprendia sobre a World Wide Web, mais eu me preocupava.  Voc√™ pode ler como os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hackers alteram as bibliotecas globais de CDN</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">os sites aleat√≥rios exploram a criptomoeda no navegador de seus visitantes</a> e como, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">atrav√©s da engenharia social, as pessoas obt√™m regularmente acesso a projetos de c√≥digo aberto bem-sucedidos</a> .  Isso n√£o √© bom.  Mas por que voc√™ deveria se importar? <br><br>  Se voc√™ est√° desenvolvendo para a web hoje, n√£o basta escrever c√≥digo.  Hoje, no desenvolvimento da web, muitas pessoas trabalham em um site.  Voc√™ tamb√©m pode usar muita fonte aberta.  Al√©m disso, para fins de marketing, voc√™ pode incluir v√°rios scripts de terceiros.  Centenas de pessoas fornecem c√≥digo em execu√ß√£o no seu site.  E os desenvolvedores precisam trabalhar em tais realidades. <br><br>  Todas essas pessoas e todo o c√≥digo-fonte podem ser confi√°veis? <br><br>  Eu n√£o acho que qualquer c√≥digo de terceiros deva ser confi√°vel.  Felizmente, existem maneiras de proteger seu site e torn√°-lo mais seguro.  Al√©m disso, ferramentas como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">capacete podem ser √∫teis, por exemplo, para aplica√ß√µes expressas</a> . <br><br>  <i>Se voc√™ deseja analisar a quantidade de c√≥digo de terceiros executado em seu site, procure no painel do desenvolvedor ou tente o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Request Map Generator.</a></i> <br><br><h2>  HTTPS e HSTS - verifique se sua conex√£o est√° segura </h2><br>  Uma conex√£o segura √© a base de uma internet segura.  Sem solicita√ß√µes criptografadas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://developers.google.com/web/fundamentals/security/encrypt-in-transit/why-">passando pelo</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://developers.google.com/web/fundamentals/security/encrypt-in-transit/why-">HTTPS</a> , voc√™ n√£o pode ter certeza de que n√£o h√° mais ningu√©m entre o site e os visitantes.  Uma pessoa pode configurar rapidamente uma rede Wi-Fi p√∫blica e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">lan√ßar um homem no meio do ataque</a> contra qualquer pessoa que se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">conecte a essa rede</a> .  Com que frequ√™ncia voc√™ usa Wi-Fi p√∫blico?  Al√©m disso, com que frequ√™ncia voc√™ verifica se √© confi√°vel? <br><br>  Felizmente, hoje os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">certificados TLS s√£o gratuitos</a> ;  O HTTPS tornou-se o padr√£o, e os navegadores fornecem recursos avan√ßados apenas para conex√µes seguras e at√© marcam sites n√£o HTTPS como inseguros, o que facilita a implementa√ß√£o deste protocolo.  Infelizmente, nem sempre estamos seguros quando estamos na Internet.  Quando algu√©m deseja abrir um site, ele n√£o insere o protocolo na barra de endere√ßos (e por que deveria?).  Isso resulta em uma solicita√ß√£o HTTP n√£o criptografada.  Sites em execu√ß√£o segura redirecionam o usu√°rio para HTTPS.  Mas e se algu√©m interceptar o primeiro pedido inseguro? <br><br>  Voc√™ pode usar os cabe√ßalhos de resposta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">HSTS</a> (HTTP Strict Transport Security) para informar aos navegadores que seu site funciona apenas por HTTPS. <br><br><pre> <code class="plaintext hljs">Strict-Transport-Security: max-age=1000; includeSubDomains; preload</code> </pre> <br>  Esse cabe√ßalho informa ao navegador que voc√™ n√£o deseja usar solicita√ß√µes HTTP e, em seguida, aplicar√° automaticamente as mesmas solicita√ß√µes √† mesma fonte com uma conex√£o segura.  Se voc√™ tentar abrir o mesmo URL via HTTP, o navegador usar√° novamente o HTTPS e redirecionar√° o usu√°rio. <br><br>  Voc√™ pode configurar por quanto tempo essa op√ß√£o deve permanecer ativa ( <code>max-age</code> em segundos) se desejar usar o HTTP novamente mais tarde.  Se voc√™ deseja habilitar subdom√≠nios, pode configur√°-lo usando <code>includeSubDomains</code> . <br><br>  Se voc√™ deseja fazer todo o poss√≠vel para que o navegador nunca solicite seu site via HTTP, tamb√©m √© poss√≠vel definir o ponteiro de <code>preload</code> - <code>preload</code> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">enviar seu site</a> para a lista global.  Se a configura√ß√£o HSTS do seu site corresponder √† <code>max-age</code> m√≠nima de um ano e estiver ativa para subdom√≠nios, ela poder√° ser inclu√≠da na lista interna do navegador para sites que funcionam apenas via HTTPS. <br><br>  Voc√™ j√° se perguntou por que n√£o pode mais usar vari√°veis ‚Äã‚Äãde ambiente local como <code>my-site.dev</code> em seu navegador via HTTP?  O motivo est√° precisamente nesta lista interna - <code>.dev</code> inclu√≠dos automaticamente nesta lista, pois em fevereiro de 2019 tornou-se um dom√≠nio de n√≠vel superior real. <br><br>  O cabe√ßalho HSTS n√£o apenas torna seu site um pouco mais seguro, mas tamb√©m acelera seu trabalho.  Imagine que algu√©m est√° acessando uma conex√£o m√≥vel lenta.  Se a primeira solicita√ß√£o foi feita por meio de HTTP apenas para receber um redirecionamento, o usu√°rio poder√° n√£o ver nada na tela por alguns segundos.  E com o HSTS, voc√™ pode salvar esses segundos e o navegador usar√° automaticamente o HTTPS. <br><br><h2>  CSP - indique claramente o que √© permitido em seu site </h2><br>  Agora que seu site est√° executando uma conex√£o segura, voc√™ pode encontrar um problema quando os navegadores come√ßarem a bloquear solicita√ß√µes que atingem um endere√ßo n√£o seguro devido a pol√≠ticas de conte√∫do mistas.  O cabe√ßalho <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CSP (Content Security Policy)</a> oferece uma √≥tima maneira de lidar com essas situa√ß√µes.  Voc√™ pode definir seu conjunto de regras do CSP usando os meta elementos no HTML fornecido ou atrav√©s de cabe√ßalhos HTTP. <br><br><pre> <code class="plaintext hljs">Content-Security-Policy: upgrade-insecure-requests</code> </pre> <br>  O ponteiro de <code>upgrade-insecure-requests</code> faz com que o navegador converta magicamente todas as solicita√ß√µes HTTP em solicita√ß√µes HTTPS. <br><br>  No entanto, o CSP n√£o se limita ao protocolo usado.  Ele oferece maneiras detalhadas de determinar quais recursos e atividades s√£o permitidos no seu site.  Voc√™ pode, por exemplo, especificar de quais scripts devem ser executados ou de onde baixar imagens.  Se algo n√£o for permitido, o navegador bloqueia esta a√ß√£o e evita poss√≠veis ataques ao seu site. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e57/f6a/ef6/e57f6aef63f9ad95c2954539290a7caa.jpg"><br><br>  No momento da reda√ß√£o deste artigo, havia 24 op√ß√µes de configura√ß√£o diferentes para o CSP.  Eles variam de scripts a folhas de estilo a funcion√°rios de servi√ßo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/281/7f5/713/2817f571357c4b488bd6dbcbbdec6ef0.png"><br><br>  <i>Voc√™ pode encontrar a resenha completa no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MDN.</a></i> <br><br>  Usando o CSP, voc√™ pode especificar o que seu site deve incluir e o que n√£o deve. <br><br><pre> <code class="plaintext hljs">Content-Security-Policy: default-src 'self'; script-src 'self' just-comments.com www.google-analytics.com production-assets.codepen.io storage.googleapis.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: images.contentful.com images.ctfassets.net www.gravatar.com www.google-analytics.com just-comments.com; font-src 'self' data:; connect-src 'self' cdn.contentful.com images.contentful.com videos.contentful.com images.ctfassets.net videos.ctfassets.net service.just-comments.com www.google-analytics.com; media-src 'self' videos.contentful.com videos.ctfassets.net; object-src 'self'; frame-src codepen.io; frame-ancestors 'self'; worker-src 'self'; block-all-mixed-content; manifest-src 'self' 'self'; disown-opener; prefetch-src 'self'</code> </pre> <br>  O conjunto de regras acima √© para o meu site pessoal e, se voc√™ acha que este exemplo de defini√ß√£o de CSP √© muito complicado, est√° absolutamente certo.  Eu implementei este kit na minha terceira tentativa, implantando e revertendo novamente, porque ele quebrou o site v√°rias vezes.  Mas existe uma maneira melhor. <br><br>  Para evitar invadir seu site, o CSP tamb√©m fornece um modo somente de relat√≥rio. <br><br><pre> <code class="plaintext hljs">Content-Security-Policy-Report-Only: default-src 'self'; ... report-uri https://stefanjudis.report-uri.com/r/d/csp/reportOnly</code> </pre> <br>  Usando o modo <code>Content-Security-Policy-Report-Only</code> , os navegadores simplesmente registram recursos que seriam bloqueados, em vez de realmente bloque√°-los.  Esse mecanismo de relat√≥rio permite verificar e configurar seu conjunto de regras. <br><br>  Os dois cabe√ßalhos, <code>Content-Security-Policy</code> e <code>Content-Security-Policy-Report-Only</code> , tamb√©m oferecem uma maneira de determinar o ponto final para o envio de um <code>report-uri</code> viola√ß√£o e informa√ß√µes de log ( <code>report-uri</code> ).  Voc√™ pode configurar o servidor de log e usar as informa√ß√µes de log enviadas para configurar as regras do CSP at√© que esteja pronto para enviar. <br><br>  O processo recomendado √© o seguinte: primeiro execute o CSP no modo de relat√≥rio, analise viola√ß√µes recebidas com tr√°fego real e somente quando nenhuma viola√ß√£o de seus recursos controlados for detectada, ative-a. <br><br>  <i>Se voc√™ estiver procurando por um servi√ßo que possa ajud√°-lo a lidar com essas revistas, recomendo o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">URI</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">relat√≥rio</a> , isso me ajuda muito.</i> <br><br><h2>  Implementa√ß√£o geral do CSP </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Hoje, os navegadores suportam bem o</a> CSP, mas infelizmente muitos sites n√£o o usam.  Para ver quantos sites entregam conte√∫do usando o CSP, enviei uma solicita√ß√£o ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://">HTTParchive</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://">constatei</a> que apenas 6% dos sites visualizados usam essa pol√≠tica.  Acho que podemos tornar a Internet mais segura e proteger nossos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">usu√°rios</a> contra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">minera√ß√£o de criptomoedas</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">involuntariamente</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d4/e19/246/6d4e192464d326a3722530d617cbaf78.jpg"><br><br><h2>  A rede deve estar acess√≠vel. </h2><br>  Enquanto escrevo este artigo, estou sentado em frente ao relativamente novo MacBook usando uma conex√£o Wi-Fi dom√©stica r√°pida.  Os desenvolvedores costumam esquecer que essa situa√ß√£o n√£o √© padr√£o para a maioria dos nossos usu√°rios.  As pessoas que visitam nossos sites usam telefones antigos e conex√µes duvidosas.  Sites pesados ‚Äã‚Äãe congestionados com centenas de consultas deixam uma impress√£o ruim. <br><br>  E n√£o se trata apenas da impress√£o.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">As pessoas pagam valores diferentes pelo tr√°fego, dependendo de onde moram</a> .  Imagine que voc√™ est√° criando um site para um hospital.  As informa√ß√µes podem ser cruciais e salvar vidas.  Se a p√°gina no site do hospital tiver 5 MB, ela n√£o funcionar√° apenas devagar, mas poder√° ser muito cara para quem mais precisa.  O pre√ßo de cinco megabytes de tr√°fego na Europa ou nos Estados Unidos √© insignificante em compara√ß√£o com o pre√ßo na √Åfrica.  Os desenvolvedores s√£o respons√°veis ‚Äã‚Äãpor tornar as p√°ginas da web acess√≠veis a todos.  Essa responsabilidade inclui fornecer os recursos certos, escolher as ferramentas certas (voc√™ realmente precisa de uma estrutura JS para o desembarque?) E evitar solicita√ß√µes. <br><br><h2>  Controle de cache - evite solicita√ß√µes de recursos imut√°veis </h2><br>  Hoje, um site pode conter centenas de recursos, de CSS a scripts e imagens.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>  Cache-Control</code></a> , os desenvolvedores podem especificar por quanto tempo o recurso deve ser considerado "novo" e pode ser retornado do cache do navegador. <br><br><pre> <code class="plaintext hljs">Cache-Control: max-age=30, public</code> </pre> <br>  Com a configura√ß√£o adequada do <code>Cache-Control</code> , a transfer√™ncia de dados √© preservada e os arquivos podem ser usados ‚Äã‚Äãno cache do navegador por um determinado n√∫mero de segundos ( <code>max-age</code> ).  Os navegadores devem verificar novamente os recursos em cache ap√≥s esse per√≠odo de tempo. <br><br>  No entanto, se os visitantes atualizarem a p√°gina, os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">navegadores a verificar√£o novamente de qualquer maneira, incluindo links para recursos</a> para garantir que os dados em cache ainda sejam v√°lidos.  Os servidores respondem com um cabe√ßalho 304, sinalizando que os dados em cache ainda s√£o v√°lidos, ou um cabe√ßalho 200 ao transmitir dados atualizados.  Isso permite que voc√™ salve os dados transferidos, mas n√£o necessariamente solicita√ß√µes feitas. <br><br>  √â aqui que a fun√ß√£o <code>immutable</code> entra em cena. <br><br><h2>  Imut√°vel - nunca solicite um recurso duas vezes </h2><br>  Nos aplicativos de front-end modernos, os arquivos CSS e de script geralmente t√™m nomes exclusivos, por exemplo, <code>styles.123abc.css</code> .  O nome deste arquivo depende do conte√∫do.  E quando voc√™ altera o conte√∫do dos arquivos, seus nomes tamb√©m mudam. <br><br>  Esses arquivos exclusivos podem ser armazenados em cache para sempre, inclusive quando um usu√°rio atualiza uma p√°gina.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code> immutable</code></a> pode impedir que o navegador verifique novamente o recurso em um intervalo de tempo espec√≠fico.  Isso √© muito importante para objetos com somas de verifica√ß√£o e ajuda a evitar solicita√ß√µes de valida√ß√£o repetidas. <br><br><pre> <code class="plaintext hljs">Cache-Control: max-age=31536000, public, immutable</code> </pre> <br>  A implementa√ß√£o do cache ideal √© muito dif√≠cil e, especialmente, o cache do navegador n√£o √© muito intuitivo, pois possui v√°rias configura√ß√µes.  Eu recomendo que voc√™ leia os seguintes materiais: <br><br><ul><li>  Harry Roberts escreveu um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">excelente guia para gerenciar seu cache e suas configura√ß√µes</a> . <br></li><li>  Jack Archibald deu dicas sobre as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">melhores t√©cnicas de armazenamento em cache</a> com ilustra√ß√µes. <br></li><li>  Ilya Grigorik prop√¥s um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/">excelente esquema tecnol√≥gico para armazenar em cache cabe√ßalhos</a> . <br></li></ul><br><h2>  Accept-Encoding - compress√£o m√°xima (no m√≠nimo) </h2><br>  Com a ajuda do <code>Cache control</code> de <code>Cache control</code> podemos salvar solicita√ß√µes e reduzir a quantidade de dados que s√£o transmitidos repetidamente pela rede.  N√£o podemos apenas salvar solicita√ß√µes, mas tamb√©m reduzir o que √© transmitido. <br><br>  Ao fornecer recursos, os desenvolvedores devem enviar o m√≠nimo de dados poss√≠vel.  Para recursos de texto como HTML, CSS e JavaScript, a compacta√ß√£o desempenha um papel importante na economia de dados transferidos. <br><br>  O m√©todo de compress√£o mais popular atualmente √© o GZIP.  Os servidores t√™m energia suficiente para compactar arquivos de texto rapidamente e fornecer dados compactados quando solicitados.  Mas o GZIP n√£o √© mais a melhor op√ß√£o. <br><br>  Se voc√™ examinar as solicita√ß√µes geradas pelo navegador para arquivos de texto, como HTML, CSS e JavaScript, e analisar os cabe√ßalhos, encontrar√° a <code>accept-encoding</code> entre eles. <br><br><pre> <code class="plaintext hljs">Accept-Encoding: gzip, deflate, br</code> </pre> <br>  Este cabe√ßalho informa ao servidor quais algoritmos de compacta√ß√£o ele entende.  O pouco conhecido par√¢metro <code>br</code> significa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">compacta√ß√£o de Brotli</a> e √© usado em sites de alto tr√°fego como Google e Facebook.  Para usar o Brotli, seu site deve funcionar via HTTPS. <br><br>  Esse algoritmo de compacta√ß√£o foi criado levando em considera√ß√£o o tamanho pequeno do arquivo.  Se voc√™ tentar compactar o arquivo manualmente no seu dispositivo local, ver√° que o Brotli realmente comprime melhor que o GZIP. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d5/681/a2b/6d5681a2b412489aae991170e16428e8.jpg"><br><br>  Voc√™ pode ter ouvido que a compress√£o Brotli √© mais lenta.  O motivo √© que Brotli possui 11 modos de compacta√ß√£o e, por padr√£o, √© obtido o que seleciona os arquivos menores, o que prolonga o procedimento.  O GZIP, por outro lado, possui 9 modos e, por padr√£o, √© selecionado um que leva em considera√ß√£o a velocidade de compacta√ß√£o e o tamanho do arquivo.  Como resultado, o modo Brotli n√£o √© adequado para compacta√ß√£o on-the-fly por padr√£o, mas se voc√™ alterar o modo, poder√° compactar arquivos pequenos na mesma velocidade que o GZIP.  Voc√™ pode us√°-lo para compacta√ß√£o em tempo real e consider√°-lo um substituto potencial para o GZIP para suportar navegadores. <br><br>  Al√©m disso, se voc√™ deseja salvar os arquivos o m√°ximo poss√≠vel, pode esquecer a compacta√ß√£o din√¢mica e gerar previamente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">arquivos GZIP otimizados usando os arquivos zopfli</a> e Brotli para manuten√ß√£o est√°tica. <br><br>  <i>Se voc√™ quiser ler mais sobre a compress√£o Brotli e sua compara√ß√£o com o GZIP, os funcion√°rios da Akamai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fizeram uma extensa pesquisa sobre este t√≥pico</a></i> . <br><br><h2>  Accept and Accept-CH - Servir recursos individuais para o usu√°rio </h2><br>  A otimiza√ß√£o de recursos de texto √© muito importante para salvar kilobytes, mas e quanto a recursos mais pesados, como imagens, para salvar ainda mais dados? <br><br><h4>  Aceitar - manuten√ß√£o de imagens no formato correto </h4><br>  Os navegadores n√£o apenas nos mostram quais algoritmos de compress√£o eles entendem.  Quando o navegador solicita uma imagem, ele tamb√©m fornece informa√ß√µes sobre quais formatos de arquivo ele entende. <br><br><pre> <code class="plaintext hljs">Accept: image/webp, image/apng, image/*,*/*;q=0.8</code> </pre> <br>  Por v√°rios anos, uma luta foi travada em torno de um novo formato de imagem, mas ganhou o webp.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Webp √© um formato de imagem inventado pelo Google</a> , e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">suporte para</a> esse formato agora √© muito relevante. <br><br>  Usando esse cabe√ßalho de solicita√ß√£o, os desenvolvedores podem enviar uma imagem da <code>webp</code> mesmo que o navegador solicite <code>image.jpg</code> , resultando em um tamanho de arquivo menor.  Dean Hume escreveu um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bom guia</a> sobre como aplicar isso.  Muito legal! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9ef/ce2/077/9efce2077a81469bfaa8840b8bb07b26.jpg"><br><br><h4>  Accept-CH - Exibindo imagens do tamanho certo </h4><br>  Voc√™ tamb√©m pode ativar os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">prompts do cliente</a> para navegadores que suportam esse recurso.  As dicas do cliente s√£o uma maneira de instruir os navegadores a enviar informa√ß√µes adicionais sobre a largura da √°rea de visualiza√ß√£o, a largura da imagem e at√© as condi√ß√µes da rede, como RTT (tempo de transmiss√£o e confirma√ß√£o) e o tipo de conex√£o, por exemplo, <code>2g</code> . <br><br>  Voc√™ pode ativar as dicas adicionando um meta elemento: <br><br><pre> <code class="plaintext hljs">&lt;meta http-equiv="Accept-CH" content="Viewport-Width, Downlink"&gt; &lt;meta http-equiv="Accept-CH-Lifetime" content="86400"&gt;</code> </pre> <br>  Ou definindo cabe√ßalhos na solicita√ß√£o HTML original: <br><br><pre> <code class="plaintext hljs">Accept-CH: Width, Viewport-Width Accept-CH-Lifetime: 100</code> </pre> <br>  Em solicita√ß√µes subsequentes, os navegadores come√ßar√£o a enviar informa√ß√µes adicionais por um determinado per√≠odo de tempo ( <code>Accept-CH-Lifetime</code> em segundos), o que pode ajudar os desenvolvedores a adaptar imagens √†s condi√ß√µes do usu√°rio sem alterar o HTML. <br><br>  Por exemplo, para obter mais informa√ß√µes, como a largura da imagem no lado do servidor, voc√™ pode fornecer √†s suas imagens o atributo de <code>sizes</code> para fornecer ao navegador informa√ß√µes adicionais sobre a apar√™ncia dessas imagens. <br><br><pre> <code class="plaintext hljs">&lt;!-- this images is laid over the full width | 100 viewport width --&gt; &lt;img class="w-100" src="/img/header.jpg" alt="" sizes="100vw"&gt;</code> </pre> <br>  Com o cabe√ßalho de resposta <code>Accept-CH</code> recebido e as imagens com o atributo size, os navegadores incluir√£o os cabe√ßalhos de <code>width</code> e <code>width</code> da <code>viewport-width</code> nas solicita√ß√µes de imagem, mostrando qual imagem √© a mais adequada. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ec1/fa5/15f/ec1fa515f2eaddf32e3f1ba8e3d9576c.jpg"><br><br>  Tendo um formato e tamanho de imagem compat√≠veis, voc√™ pode enviar dados adaptados sem precisar gravar elementos de imagem n√£o confi√°veis ‚Äã‚Äãe prestar aten√ß√£o apenas ao formato e tamanho do arquivo, conforme mostrado abaixo. <br><br><pre> <code class="plaintext hljs">&lt;pictur&gt; &lt;!-- serve WebP to Chrome, Edge, Firefox and Opera --&gt; &lt;source media="(min-width: 50em)" sizes="50vw" srcset="/image/thing-200.webp 200w, /image/thing-400.webp 400w, /image/thing-800.webp 800w, /image/thing-1200.webp 1200w, /image/thing-1600.webp 1600w, /image/thing-2000.webp 2000w" type="image/webp"&gt; &lt;source sizes="(min-width: 30em) 100vw" srcset="/image/thing-crop-200.webp 200w, /image/thing-crop-400.webp 400w, /image/thing-crop-800.webp 800w, /image/thing-crop-1200.webp 1200w, /image/thing-crop-1600.webp 1600w, /image/thing-crop-2000.webp 2000w" type="image/webp"&gt; &lt;!-- serve JPEG to others --&gt; &lt;surce media="(min-width: 50em)" sizes="50vw" srcset="/image/thing-200.jpg 200w, /image/thing-400.jpg 400w, /image/thing-800.jpg 800w, /image/thing-1200.jpg 1200w, /image/thing-1600.jpg 1600w, /image/thing-2000.jpg 2000w"&gt; &lt;surce sizes="(min-width: 30em) 100vw" srcset="/image/thing-crop-200.jpg 200w, /image/thing-crop-400.jpg 400w, /image/thing-crop-800.jpg 800w, /image/thing-crop-1200.jpg 1200w, /image/thing-crop-1600.jpg 1600w, /image/thing-crop-2000.jpg 2000w"&gt; &lt;!-- fallback for browsers that don't support picture --&gt; &lt;img src="/image/thing.jpg" width="50%"&gt; &lt;/pictur&gt;</code> </pre> <br>  Se voc√™ tiver acesso √† largura da janela de visualiza√ß√£o e do tamanho da imagem, poder√° colocar a l√≥gica de redimensionar recursos em primeiro plano em seus servidores. <br><br>  No entanto, lembre-se de que voc√™ n√£o deve criar imagens para qualquer largura simplesmente porque possui a largura exata da imagem.  Enviar imagens para um intervalo de tamanho espec√≠fico ( <code>image-200</code> , <code>image-300</code> , <code>...</code> ) ajuda a usar o cache da CDN e economiza tempo de computa√ß√£o. <br><br>  Al√©m disso, com tecnologias modernas, como profissionais de servi√ßo, voc√™ pode at√© interceptar e modificar solicita√ß√µes diretamente no cliente para servir os melhores arquivos de imagem.  Com as dicas de ferramentas do cliente ativadas, os profissionais de servi√ßo obt√™m acesso √†s informa√ß√µes de layout e, em combina√ß√£o com a API da imagem, como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cloudinary,</a> voc√™ pode configurar o URL da imagem diretamente no navegador para receber imagens do tamanho correto. <br><br>  <i>Se voc√™ estiver procurando informa√ß√µes mais detalhadas sobre dicas de clientes, leia artigos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jeremy Wagner</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ilya Grigorik</a> sobre este t√≥pico.</i> <br><br><h2>  A rede deve ter cuidado </h2><br>  Como cada um de n√≥s passa muitas horas por dia na rede, h√° o √∫ltimo aspecto que considero muito importante - a rede deve ter cuidado. <br><br><h4>  Pr√©-carregamento - reduz o tempo de espera </h4><br>  Como desenvolvedores, valorizamos o tempo de nossos usu√°rios.  Ningu√©m quer perder tempo.      ,           .      ,   ,        . <br><br>  :       ,     ,    .      ,    HTML      .               ,   ,     .          . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> Rel=preload</a>       ,       . <br><br>      HTML-: <br><br><pre> <code class="plaintext hljs">&lt;link rel="preload" href="/font.woff2" as="font" type="font/woff2" crossorigin="anonymous"&gt;</code> </pre> <br>  : <br><br><pre> <code class="plaintext hljs">Link: &lt;/font.woff2&gt;; rel=preload; as=font; no-push</code> </pre> <br>  ,       ,    ,      ,  .      . <br><br>                : <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>   . <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>    preload   ,   prefetch  preconnect. <br></li></ul><br><h4> Feature-Policy ‚Äî    </h4><br>      ,      .       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>   . <br><br> <i>     </i> .         ,  .        .      ,      ,     ‚Äî  . <br><br>  ,         ,          ?  ,       ? <br><br>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> Feature-Policy.      ,   ,       ,      ,    . <br><br><pre> <code class="plaintext hljs">Feature-Policy: vibrate 'none'; geolocation 'none'</code> </pre> <br>          .        , ,  ,         . <br><br><pre> <code class="plaintext hljs">&lt;iframe allow="camera 'none'; microphone 'none'"&gt;</code> </pre> <br>      <code>Feature-Policy</code> , , ,       .                ,     .      . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fa8/ada/e56/fa8adae56924a72210fc2009641eb8cb.jpg"><br><br> <i>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MDN.</a></i> <br><br>    ,        ‚Äî push-. ,   <code>Feature-Policy</code>  push- ,  .     ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub.</a> <br><br>  feature policy   ,           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  </a> , ,  ,      . <br><br><h2>      </h2><br>         ,      .          ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">¬´HTTP- ‚Äî  ¬ª</a> . <br><br>  ,      ‚Äî   .    , , ,  ‚Ä¶     . ,      ,     ,       -,      ,    -    . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt450816/">https://habr.com/ru/post/pt450816/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt450804/index.html">Impress√£o de metal 3D na ind√∫stria automotiva: comece pequeno</a></li>
<li><a href="../pt450806/index.html">Quando uma vari√°vel de ambiente acelera o processo em 40 vezes</a></li>
<li><a href="../pt450810/index.html">As 7 principais maneiras de verificar rapidamente as compet√™ncias dos especialistas em TI antes da entrevista</a></li>
<li><a href="../pt450812/index.html">PSR-14 - o principal evento em PHP</a></li>
<li><a href="../pt450814/index.html">Como o BGP funciona</a></li>
<li><a href="../pt450818/index.html">Da alta lat√™ncia do Ceph ao patch do kernel com o eBPF / BCC</a></li>
<li><a href="../pt450820/index.html">Comit√™ do programa FrontendConf: estruturas, horizontes, experi√™ncia mundial e miss√£o da confer√™ncia</a></li>
<li><a href="../pt450822/index.html">Estruturas desaparecendo</a></li>
<li><a href="../pt450824/index.html">O estado do css</a></li>
<li><a href="../pt450826/index.html">Como falar com o microcontrolador da JS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>