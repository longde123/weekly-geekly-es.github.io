<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔡 🎳 🎺 Cabeçalhos HTTP para o desenvolvedor responsável 🧓🏾 🎪 👲🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hoje, estar online é uma condição comum para muitas pessoas. Todos compramos, comunicamos, lemos artigos, procuramos informações sobre vários tópicos....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cabeçalhos HTTP para o desenvolvedor responsável</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/450816/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/9l/a1/ll/9la1llcyspwwfylwvmocsfvgnfe.jpeg"></div><br>  Hoje, estar online é uma condição comum para muitas pessoas.  Todos compramos, comunicamos, lemos artigos, procuramos informações sobre vários tópicos.  A rede nos conecta ao mundo inteiro, mas, acima de tudo, conecta pessoas.  Eu mesmo uso a Internet há 20 anos e meu relacionamento com ela mudou oito anos atrás, quando me tornei desenvolvedor da Web. <br><br>  Os desenvolvedores conectam pessoas. <br>  Os desenvolvedores ajudam as pessoas. <br>  Os desenvolvedores dão oportunidades às pessoas. <br><br>  Os desenvolvedores podem criar uma rede para todos, mas essa capacidade deve ser usada com responsabilidade.  No final, é importante criar coisas que ajudem as pessoas e as capacitem.  Neste artigo, quero falar sobre como os cabeçalhos HTTP podem ajudá-lo a criar melhores produtos para o melhor trabalho de todos os usuários na Internet. <br><a name="habracut"></a><br><h2>  HTTP - Protocolo de transferência de hipertexto </h2><br>  Vamos falar sobre HTTP primeiro.  HTTP é um protocolo usado pelos computadores para solicitar e enviar dados pela Internet. <br><br>  Quando o navegador solicita um recurso do servidor, ele usa HTTP.  Essa solicitação inclui um conjunto de pares de valores-chave que contêm informações como a versão do navegador ou os formatos de arquivo que ele entende.  Esses pares são chamados de cabeçalhos de solicitação. <br><br>  O servidor responde com o recurso solicitado, mas também envia cabeçalhos de resposta contendo informações sobre o recurso ou o próprio servidor. <br><br><pre><code class="plaintext hljs">Request: GET https://the-responsible.dev/ Accept: text/html,application/xhtml+xml,application/xml Accept-Encoding: gzip, deflate, br Accept-Language: en-GB,en-US;q=0.9,en;q=0.8,de;q=0.7 ... Response: Connection: keep-alive Content-Type: text/html; charset=utf-8 Date: Mon, 11 Mar 2019 12:59:38 GMT ... Response Body</code> </pre> <br>  Hoje, o HTTP é a base da Internet e oferece muitas maneiras de otimizar a experiência do usuário.  Vamos ver como você pode usar cabeçalhos HTTP para criar uma rede segura e acessível. <br><br><h2>  A rede deve estar segura </h2><br>  Eu nunca me sentia em perigo quando procurava algo na Internet.  Mas quanto mais eu aprendia sobre a World Wide Web, mais eu me preocupava.  Você pode ler como os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hackers alteram as bibliotecas globais de CDN</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">os sites aleatórios exploram a criptomoeda no navegador de seus visitantes</a> e como, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">através da engenharia social, as pessoas obtêm regularmente acesso a projetos de código aberto bem-sucedidos</a> .  Isso não é bom.  Mas por que você deveria se importar? <br><br>  Se você está desenvolvendo para a web hoje, não basta escrever código.  Hoje, no desenvolvimento da web, muitas pessoas trabalham em um site.  Você também pode usar muita fonte aberta.  Além disso, para fins de marketing, você pode incluir vários scripts de terceiros.  Centenas de pessoas fornecem código em execução no seu site.  E os desenvolvedores precisam trabalhar em tais realidades. <br><br>  Todas essas pessoas e todo o código-fonte podem ser confiáveis? <br><br>  Eu não acho que qualquer código de terceiros deva ser confiável.  Felizmente, existem maneiras de proteger seu site e torná-lo mais seguro.  Além disso, ferramentas como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">capacete podem ser úteis, por exemplo, para aplicações expressas</a> . <br><br>  <i>Se você deseja analisar a quantidade de código de terceiros executado em seu site, procure no painel do desenvolvedor ou tente o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Request Map Generator.</a></i> <br><br><h2>  HTTPS e HSTS - verifique se sua conexão está segura </h2><br>  Uma conexão segura é a base de uma internet segura.  Sem solicitações criptografadas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://developers.google.com/web/fundamentals/security/encrypt-in-transit/why-">passando pelo</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://developers.google.com/web/fundamentals/security/encrypt-in-transit/why-">HTTPS</a> , você não pode ter certeza de que não há mais ninguém entre o site e os visitantes.  Uma pessoa pode configurar rapidamente uma rede Wi-Fi pública e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">lançar um homem no meio do ataque</a> contra qualquer pessoa que se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">conecte a essa rede</a> .  Com que frequência você usa Wi-Fi público?  Além disso, com que frequência você verifica se é confiável? <br><br>  Felizmente, hoje os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">certificados TLS são gratuitos</a> ;  O HTTPS tornou-se o padrão, e os navegadores fornecem recursos avançados apenas para conexões seguras e até marcam sites não HTTPS como inseguros, o que facilita a implementação deste protocolo.  Infelizmente, nem sempre estamos seguros quando estamos na Internet.  Quando alguém deseja abrir um site, ele não insere o protocolo na barra de endereços (e por que deveria?).  Isso resulta em uma solicitação HTTP não criptografada.  Sites em execução segura redirecionam o usuário para HTTPS.  Mas e se alguém interceptar o primeiro pedido inseguro? <br><br>  Você pode usar os cabeçalhos de resposta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">HSTS</a> (HTTP Strict Transport Security) para informar aos navegadores que seu site funciona apenas por HTTPS. <br><br><pre> <code class="plaintext hljs">Strict-Transport-Security: max-age=1000; includeSubDomains; preload</code> </pre> <br>  Esse cabeçalho informa ao navegador que você não deseja usar solicitações HTTP e, em seguida, aplicará automaticamente as mesmas solicitações à mesma fonte com uma conexão segura.  Se você tentar abrir o mesmo URL via HTTP, o navegador usará novamente o HTTPS e redirecionará o usuário. <br><br>  Você pode configurar por quanto tempo essa opção deve permanecer ativa ( <code>max-age</code> em segundos) se desejar usar o HTTP novamente mais tarde.  Se você deseja habilitar subdomínios, pode configurá-lo usando <code>includeSubDomains</code> . <br><br>  Se você deseja fazer todo o possível para que o navegador nunca solicite seu site via HTTP, também é possível definir o ponteiro de <code>preload</code> - <code>preload</code> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">enviar seu site</a> para a lista global.  Se a configuração HSTS do seu site corresponder à <code>max-age</code> mínima de um ano e estiver ativa para subdomínios, ela poderá ser incluída na lista interna do navegador para sites que funcionam apenas via HTTPS. <br><br>  Você já se perguntou por que não pode mais usar variáveis ​​de ambiente local como <code>my-site.dev</code> em seu navegador via HTTP?  O motivo está precisamente nesta lista interna - <code>.dev</code> incluídos automaticamente nesta lista, pois em fevereiro de 2019 tornou-se um domínio de nível superior real. <br><br>  O cabeçalho HSTS não apenas torna seu site um pouco mais seguro, mas também acelera seu trabalho.  Imagine que alguém está acessando uma conexão móvel lenta.  Se a primeira solicitação foi feita por meio de HTTP apenas para receber um redirecionamento, o usuário poderá não ver nada na tela por alguns segundos.  E com o HSTS, você pode salvar esses segundos e o navegador usará automaticamente o HTTPS. <br><br><h2>  CSP - indique claramente o que é permitido em seu site </h2><br>  Agora que seu site está executando uma conexão segura, você pode encontrar um problema quando os navegadores começarem a bloquear solicitações que atingem um endereço não seguro devido a políticas de conteúdo mistas.  O cabeçalho <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CSP (Content Security Policy)</a> oferece uma ótima maneira de lidar com essas situações.  Você pode definir seu conjunto de regras do CSP usando os meta elementos no HTML fornecido ou através de cabeçalhos HTTP. <br><br><pre> <code class="plaintext hljs">Content-Security-Policy: upgrade-insecure-requests</code> </pre> <br>  O ponteiro de <code>upgrade-insecure-requests</code> faz com que o navegador converta magicamente todas as solicitações HTTP em solicitações HTTPS. <br><br>  No entanto, o CSP não se limita ao protocolo usado.  Ele oferece maneiras detalhadas de determinar quais recursos e atividades são permitidos no seu site.  Você pode, por exemplo, especificar de quais scripts devem ser executados ou de onde baixar imagens.  Se algo não for permitido, o navegador bloqueia esta ação e evita possíveis ataques ao seu site. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e57/f6a/ef6/e57f6aef63f9ad95c2954539290a7caa.jpg"><br><br>  No momento da redação deste artigo, havia 24 opções de configuração diferentes para o CSP.  Eles variam de scripts a folhas de estilo a funcionários de serviço. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/281/7f5/713/2817f571357c4b488bd6dbcbbdec6ef0.png"><br><br>  <i>Você pode encontrar a resenha completa no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MDN.</a></i> <br><br>  Usando o CSP, você pode especificar o que seu site deve incluir e o que não deve. <br><br><pre> <code class="plaintext hljs">Content-Security-Policy: default-src 'self'; script-src 'self' just-comments.com www.google-analytics.com production-assets.codepen.io storage.googleapis.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: images.contentful.com images.ctfassets.net www.gravatar.com www.google-analytics.com just-comments.com; font-src 'self' data:; connect-src 'self' cdn.contentful.com images.contentful.com videos.contentful.com images.ctfassets.net videos.ctfassets.net service.just-comments.com www.google-analytics.com; media-src 'self' videos.contentful.com videos.ctfassets.net; object-src 'self'; frame-src codepen.io; frame-ancestors 'self'; worker-src 'self'; block-all-mixed-content; manifest-src 'self' 'self'; disown-opener; prefetch-src 'self'</code> </pre> <br>  O conjunto de regras acima é para o meu site pessoal e, se você acha que este exemplo de definição de CSP é muito complicado, está absolutamente certo.  Eu implementei este kit na minha terceira tentativa, implantando e revertendo novamente, porque ele quebrou o site várias vezes.  Mas existe uma maneira melhor. <br><br>  Para evitar invadir seu site, o CSP também fornece um modo somente de relatório. <br><br><pre> <code class="plaintext hljs">Content-Security-Policy-Report-Only: default-src 'self'; ... report-uri https://stefanjudis.report-uri.com/r/d/csp/reportOnly</code> </pre> <br>  Usando o modo <code>Content-Security-Policy-Report-Only</code> , os navegadores simplesmente registram recursos que seriam bloqueados, em vez de realmente bloqueá-los.  Esse mecanismo de relatório permite verificar e configurar seu conjunto de regras. <br><br>  Os dois cabeçalhos, <code>Content-Security-Policy</code> e <code>Content-Security-Policy-Report-Only</code> , também oferecem uma maneira de determinar o ponto final para o envio de um <code>report-uri</code> violação e informações de log ( <code>report-uri</code> ).  Você pode configurar o servidor de log e usar as informações de log enviadas para configurar as regras do CSP até que esteja pronto para enviar. <br><br>  O processo recomendado é o seguinte: primeiro execute o CSP no modo de relatório, analise violações recebidas com tráfego real e somente quando nenhuma violação de seus recursos controlados for detectada, ative-a. <br><br>  <i>Se você estiver procurando por um serviço que possa ajudá-lo a lidar com essas revistas, recomendo o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">URI</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">relatório</a> , isso me ajuda muito.</i> <br><br><h2>  Implementação geral do CSP </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Hoje, os navegadores suportam bem o</a> CSP, mas infelizmente muitos sites não o usam.  Para ver quantos sites entregam conteúdo usando o CSP, enviei uma solicitação ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://">HTTParchive</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://">constatei</a> que apenas 6% dos sites visualizados usam essa política.  Acho que podemos tornar a Internet mais segura e proteger nossos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">usuários</a> contra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mineração de criptomoedas</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">involuntariamente</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d4/e19/246/6d4e192464d326a3722530d617cbaf78.jpg"><br><br><h2>  A rede deve estar acessível. </h2><br>  Enquanto escrevo este artigo, estou sentado em frente ao relativamente novo MacBook usando uma conexão Wi-Fi doméstica rápida.  Os desenvolvedores costumam esquecer que essa situação não é padrão para a maioria dos nossos usuários.  As pessoas que visitam nossos sites usam telefones antigos e conexões duvidosas.  Sites pesados ​​e congestionados com centenas de consultas deixam uma impressão ruim. <br><br>  E não se trata apenas da impressão.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">As pessoas pagam valores diferentes pelo tráfego, dependendo de onde moram</a> .  Imagine que você está criando um site para um hospital.  As informações podem ser cruciais e salvar vidas.  Se a página no site do hospital tiver 5 MB, ela não funcionará apenas devagar, mas poderá ser muito cara para quem mais precisa.  O preço de cinco megabytes de tráfego na Europa ou nos Estados Unidos é insignificante em comparação com o preço na África.  Os desenvolvedores são responsáveis ​​por tornar as páginas da web acessíveis a todos.  Essa responsabilidade inclui fornecer os recursos certos, escolher as ferramentas certas (você realmente precisa de uma estrutura JS para o desembarque?) E evitar solicitações. <br><br><h2>  Controle de cache - evite solicitações de recursos imutáveis </h2><br>  Hoje, um site pode conter centenas de recursos, de CSS a scripts e imagens.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>  Cache-Control</code></a> , os desenvolvedores podem especificar por quanto tempo o recurso deve ser considerado "novo" e pode ser retornado do cache do navegador. <br><br><pre> <code class="plaintext hljs">Cache-Control: max-age=30, public</code> </pre> <br>  Com a configuração adequada do <code>Cache-Control</code> , a transferência de dados é preservada e os arquivos podem ser usados ​​no cache do navegador por um determinado número de segundos ( <code>max-age</code> ).  Os navegadores devem verificar novamente os recursos em cache após esse período de tempo. <br><br>  No entanto, se os visitantes atualizarem a página, os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">navegadores a verificarão novamente de qualquer maneira, incluindo links para recursos</a> para garantir que os dados em cache ainda sejam válidos.  Os servidores respondem com um cabeçalho 304, sinalizando que os dados em cache ainda são válidos, ou um cabeçalho 200 ao transmitir dados atualizados.  Isso permite que você salve os dados transferidos, mas não necessariamente solicitações feitas. <br><br>  É aqui que a função <code>immutable</code> entra em cena. <br><br><h2>  Imutável - nunca solicite um recurso duas vezes </h2><br>  Nos aplicativos de front-end modernos, os arquivos CSS e de script geralmente têm nomes exclusivos, por exemplo, <code>styles.123abc.css</code> .  O nome deste arquivo depende do conteúdo.  E quando você altera o conteúdo dos arquivos, seus nomes também mudam. <br><br>  Esses arquivos exclusivos podem ser armazenados em cache para sempre, inclusive quando um usuário atualiza uma página.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code> immutable</code></a> pode impedir que o navegador verifique novamente o recurso em um intervalo de tempo específico.  Isso é muito importante para objetos com somas de verificação e ajuda a evitar solicitações de validação repetidas. <br><br><pre> <code class="plaintext hljs">Cache-Control: max-age=31536000, public, immutable</code> </pre> <br>  A implementação do cache ideal é muito difícil e, especialmente, o cache do navegador não é muito intuitivo, pois possui várias configurações.  Eu recomendo que você leia os seguintes materiais: <br><br><ul><li>  Harry Roberts escreveu um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">excelente guia para gerenciar seu cache e suas configurações</a> . <br></li><li>  Jack Archibald deu dicas sobre as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">melhores técnicas de armazenamento em cache</a> com ilustrações. <br></li><li>  Ilya Grigorik propôs um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/">excelente esquema tecnológico para armazenar em cache cabeçalhos</a> . <br></li></ul><br><h2>  Accept-Encoding - compressão máxima (no mínimo) </h2><br>  Com a ajuda do <code>Cache control</code> de <code>Cache control</code> podemos salvar solicitações e reduzir a quantidade de dados que são transmitidos repetidamente pela rede.  Não podemos apenas salvar solicitações, mas também reduzir o que é transmitido. <br><br>  Ao fornecer recursos, os desenvolvedores devem enviar o mínimo de dados possível.  Para recursos de texto como HTML, CSS e JavaScript, a compactação desempenha um papel importante na economia de dados transferidos. <br><br>  O método de compressão mais popular atualmente é o GZIP.  Os servidores têm energia suficiente para compactar arquivos de texto rapidamente e fornecer dados compactados quando solicitados.  Mas o GZIP não é mais a melhor opção. <br><br>  Se você examinar as solicitações geradas pelo navegador para arquivos de texto, como HTML, CSS e JavaScript, e analisar os cabeçalhos, encontrará a <code>accept-encoding</code> entre eles. <br><br><pre> <code class="plaintext hljs">Accept-Encoding: gzip, deflate, br</code> </pre> <br>  Este cabeçalho informa ao servidor quais algoritmos de compactação ele entende.  O pouco conhecido parâmetro <code>br</code> significa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">compactação de Brotli</a> e é usado em sites de alto tráfego como Google e Facebook.  Para usar o Brotli, seu site deve funcionar via HTTPS. <br><br>  Esse algoritmo de compactação foi criado levando em consideração o tamanho pequeno do arquivo.  Se você tentar compactar o arquivo manualmente no seu dispositivo local, verá que o Brotli realmente comprime melhor que o GZIP. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d5/681/a2b/6d5681a2b412489aae991170e16428e8.jpg"><br><br>  Você pode ter ouvido que a compressão Brotli é mais lenta.  O motivo é que Brotli possui 11 modos de compactação e, por padrão, é obtido o que seleciona os arquivos menores, o que prolonga o procedimento.  O GZIP, por outro lado, possui 9 modos e, por padrão, é selecionado um que leva em consideração a velocidade de compactação e o tamanho do arquivo.  Como resultado, o modo Brotli não é adequado para compactação on-the-fly por padrão, mas se você alterar o modo, poderá compactar arquivos pequenos na mesma velocidade que o GZIP.  Você pode usá-lo para compactação em tempo real e considerá-lo um substituto potencial para o GZIP para suportar navegadores. <br><br>  Além disso, se você deseja salvar os arquivos o máximo possível, pode esquecer a compactação dinâmica e gerar previamente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">arquivos GZIP otimizados usando os arquivos zopfli</a> e Brotli para manutenção estática. <br><br>  <i>Se você quiser ler mais sobre a compressão Brotli e sua comparação com o GZIP, os funcionários da Akamai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fizeram uma extensa pesquisa sobre este tópico</a></i> . <br><br><h2>  Accept and Accept-CH - Servir recursos individuais para o usuário </h2><br>  A otimização de recursos de texto é muito importante para salvar kilobytes, mas e quanto a recursos mais pesados, como imagens, para salvar ainda mais dados? <br><br><h4>  Aceitar - manutenção de imagens no formato correto </h4><br>  Os navegadores não apenas nos mostram quais algoritmos de compressão eles entendem.  Quando o navegador solicita uma imagem, ele também fornece informações sobre quais formatos de arquivo ele entende. <br><br><pre> <code class="plaintext hljs">Accept: image/webp, image/apng, image/*,*/*;q=0.8</code> </pre> <br>  Por vários anos, uma luta foi travada em torno de um novo formato de imagem, mas ganhou o webp.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Webp é um formato de imagem inventado pelo Google</a> , e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">suporte para</a> esse formato agora é muito relevante. <br><br>  Usando esse cabeçalho de solicitação, os desenvolvedores podem enviar uma imagem da <code>webp</code> mesmo que o navegador solicite <code>image.jpg</code> , resultando em um tamanho de arquivo menor.  Dean Hume escreveu um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bom guia</a> sobre como aplicar isso.  Muito legal! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9ef/ce2/077/9efce2077a81469bfaa8840b8bb07b26.jpg"><br><br><h4>  Accept-CH - Exibindo imagens do tamanho certo </h4><br>  Você também pode ativar os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">prompts do cliente</a> para navegadores que suportam esse recurso.  As dicas do cliente são uma maneira de instruir os navegadores a enviar informações adicionais sobre a largura da área de visualização, a largura da imagem e até as condições da rede, como RTT (tempo de transmissão e confirmação) e o tipo de conexão, por exemplo, <code>2g</code> . <br><br>  Você pode ativar as dicas adicionando um meta elemento: <br><br><pre> <code class="plaintext hljs">&lt;meta http-equiv="Accept-CH" content="Viewport-Width, Downlink"&gt; &lt;meta http-equiv="Accept-CH-Lifetime" content="86400"&gt;</code> </pre> <br>  Ou definindo cabeçalhos na solicitação HTML original: <br><br><pre> <code class="plaintext hljs">Accept-CH: Width, Viewport-Width Accept-CH-Lifetime: 100</code> </pre> <br>  Em solicitações subsequentes, os navegadores começarão a enviar informações adicionais por um determinado período de tempo ( <code>Accept-CH-Lifetime</code> em segundos), o que pode ajudar os desenvolvedores a adaptar imagens às condições do usuário sem alterar o HTML. <br><br>  Por exemplo, para obter mais informações, como a largura da imagem no lado do servidor, você pode fornecer às suas imagens o atributo de <code>sizes</code> para fornecer ao navegador informações adicionais sobre a aparência dessas imagens. <br><br><pre> <code class="plaintext hljs">&lt;!-- this images is laid over the full width | 100 viewport width --&gt; &lt;img class="w-100" src="/img/header.jpg" alt="" sizes="100vw"&gt;</code> </pre> <br>  Com o cabeçalho de resposta <code>Accept-CH</code> recebido e as imagens com o atributo size, os navegadores incluirão os cabeçalhos de <code>width</code> e <code>width</code> da <code>viewport-width</code> nas solicitações de imagem, mostrando qual imagem é a mais adequada. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ec1/fa5/15f/ec1fa515f2eaddf32e3f1ba8e3d9576c.jpg"><br><br>  Tendo um formato e tamanho de imagem compatíveis, você pode enviar dados adaptados sem precisar gravar elementos de imagem não confiáveis ​​e prestar atenção apenas ao formato e tamanho do arquivo, conforme mostrado abaixo. <br><br><pre> <code class="plaintext hljs">&lt;pictur&gt; &lt;!-- serve WebP to Chrome, Edge, Firefox and Opera --&gt; &lt;source media="(min-width: 50em)" sizes="50vw" srcset="/image/thing-200.webp 200w, /image/thing-400.webp 400w, /image/thing-800.webp 800w, /image/thing-1200.webp 1200w, /image/thing-1600.webp 1600w, /image/thing-2000.webp 2000w" type="image/webp"&gt; &lt;source sizes="(min-width: 30em) 100vw" srcset="/image/thing-crop-200.webp 200w, /image/thing-crop-400.webp 400w, /image/thing-crop-800.webp 800w, /image/thing-crop-1200.webp 1200w, /image/thing-crop-1600.webp 1600w, /image/thing-crop-2000.webp 2000w" type="image/webp"&gt; &lt;!-- serve JPEG to others --&gt; &lt;surce media="(min-width: 50em)" sizes="50vw" srcset="/image/thing-200.jpg 200w, /image/thing-400.jpg 400w, /image/thing-800.jpg 800w, /image/thing-1200.jpg 1200w, /image/thing-1600.jpg 1600w, /image/thing-2000.jpg 2000w"&gt; &lt;surce sizes="(min-width: 30em) 100vw" srcset="/image/thing-crop-200.jpg 200w, /image/thing-crop-400.jpg 400w, /image/thing-crop-800.jpg 800w, /image/thing-crop-1200.jpg 1200w, /image/thing-crop-1600.jpg 1600w, /image/thing-crop-2000.jpg 2000w"&gt; &lt;!-- fallback for browsers that don't support picture --&gt; &lt;img src="/image/thing.jpg" width="50%"&gt; &lt;/pictur&gt;</code> </pre> <br>  Se você tiver acesso à largura da janela de visualização e do tamanho da imagem, poderá colocar a lógica de redimensionar recursos em primeiro plano em seus servidores. <br><br>  No entanto, lembre-se de que você não deve criar imagens para qualquer largura simplesmente porque possui a largura exata da imagem.  Enviar imagens para um intervalo de tamanho específico ( <code>image-200</code> , <code>image-300</code> , <code>...</code> ) ajuda a usar o cache da CDN e economiza tempo de computação. <br><br>  Além disso, com tecnologias modernas, como profissionais de serviço, você pode até interceptar e modificar solicitações diretamente no cliente para servir os melhores arquivos de imagem.  Com as dicas de ferramentas do cliente ativadas, os profissionais de serviço obtêm acesso às informações de layout e, em combinação com a API da imagem, como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cloudinary,</a> você pode configurar o URL da imagem diretamente no navegador para receber imagens do tamanho correto. <br><br>  <i>Se você estiver procurando informações mais detalhadas sobre dicas de clientes, leia artigos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jeremy Wagner</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ilya Grigorik</a> sobre este tópico.</i> <br><br><h2>  A rede deve ter cuidado </h2><br>  Como cada um de nós passa muitas horas por dia na rede, há o último aspecto que considero muito importante - a rede deve ter cuidado. <br><br><h4>  Pré-carregamento - reduz o tempo de espera </h4><br>  Como desenvolvedores, valorizamos o tempo de nossos usuários.  Ninguém quer perder tempo.      ,           .      ,   ,        . <br><br>  :       ,     ,    .      ,    HTML      .               ,   ,     .          . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> Rel=preload</a>       ,       . <br><br>      HTML-: <br><br><pre> <code class="plaintext hljs">&lt;link rel="preload" href="/font.woff2" as="font" type="font/woff2" crossorigin="anonymous"&gt;</code> </pre> <br>  : <br><br><pre> <code class="plaintext hljs">Link: &lt;/font.woff2&gt;; rel=preload; as=font; no-push</code> </pre> <br>  ,       ,    ,      ,  .      . <br><br>                : <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>   . <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>    preload   ,   prefetch  preconnect. <br></li></ul><br><h4> Feature-Policy —    </h4><br>      ,      .       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>   . <br><br> <i>     </i> .         ,  .        .      ,      ,     —  . <br><br>  ,         ,          ?  ,       ? <br><br>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> Feature-Policy.      ,   ,       ,      ,    . <br><br><pre> <code class="plaintext hljs">Feature-Policy: vibrate 'none'; geolocation 'none'</code> </pre> <br>          .        , ,  ,         . <br><br><pre> <code class="plaintext hljs">&lt;iframe allow="camera 'none'; microphone 'none'"&gt;</code> </pre> <br>      <code>Feature-Policy</code> , , ,       .                ,     .      . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fa8/ada/e56/fa8adae56924a72210fc2009641eb8cb.jpg"><br><br> <i>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MDN.</a></i> <br><br>    ,        — push-. ,   <code>Feature-Policy</code>  push- ,  .     ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub.</a> <br><br>  feature policy   ,           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  </a> , ,  ,      . <br><br><h2>      </h2><br>         ,      .          ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">«HTTP- —  »</a> . <br><br>  ,      —   .    , , ,  …     . ,      ,     ,       -,      ,    -    . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt450816/">https://habr.com/ru/post/pt450816/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt450804/index.html">Impressão de metal 3D na indústria automotiva: comece pequeno</a></li>
<li><a href="../pt450806/index.html">Quando uma variável de ambiente acelera o processo em 40 vezes</a></li>
<li><a href="../pt450810/index.html">As 7 principais maneiras de verificar rapidamente as competências dos especialistas em TI antes da entrevista</a></li>
<li><a href="../pt450812/index.html">PSR-14 - o principal evento em PHP</a></li>
<li><a href="../pt450814/index.html">Como o BGP funciona</a></li>
<li><a href="../pt450818/index.html">Da alta latência do Ceph ao patch do kernel com o eBPF / BCC</a></li>
<li><a href="../pt450820/index.html">Comitê do programa FrontendConf: estruturas, horizontes, experiência mundial e missão da conferência</a></li>
<li><a href="../pt450822/index.html">Estruturas desaparecendo</a></li>
<li><a href="../pt450824/index.html">O estado do css</a></li>
<li><a href="../pt450826/index.html">Como falar com o microcontrolador da JS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>