<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§úüèº üìì ü§öüèΩ Wie schnell ist R f√ºr die Produktivit√§t? üßî üóº üÜî</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Es gibt eine so beliebte Klasse von Aufgaben, bei denen es notwendig ist, eine ziemlich gr√ºndliche Analyse des gesamten Volumens der von einem Informa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie schnell ist R f√ºr die Produktivit√§t?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429938/"><p>  Es gibt eine so beliebte Klasse von Aufgaben, bei denen es notwendig ist, eine ziemlich gr√ºndliche Analyse des gesamten Volumens der von einem Informationssystem (IS) aufgezeichneten Arbeitsketten durchzuf√ºhren.  Als IP kann es einen Dokumentenfluss, einen Service Desk, einen Bugtracker, ein elektronisches Journal, eine Lagerabrechnung usw. geben. Die Nuancen manifestieren sich in Datenmodellen, APIs, Datenmengen und anderen Aspekten, aber die Prinzipien zur L√∂sung solcher Probleme sind ungef√§hr dieselben.  Und der Rechen, auf den Sie treten k√∂nnen, ist auch sehr √§hnlich. </p><br><p>  Um diese Klasse von Problemen zu l√∂sen, passt R perfekt.  Aber um nicht entt√§uschend mit den Schultern zu zucken, dass R gut sein kann, aber oh, sehr langsam, ist es wichtig, auf die Leistung der ausgew√§hlten Datenverarbeitungsverfahren zu achten. </p><br><p>  Es ist eine Fortsetzung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fr√ºherer Ver√∂ffentlichungen</a> . <a name="habracut"></a></p><br><p> Normalerweise ist ein oberfl√§chlicher ‚ÄûStirn‚Äú -Ansatz nicht der effektivste.  99% der mit der Analyse und Verarbeitung von Daten verbundenen Aufgaben beginnen mit ihrem Import.  In diesem kurzen Aufsatz werden wir die Probleme betrachten, die in der Grundphase des Imports von Daten mit Daten im <code>json</code> Format auftreten, am Beispiel einer typischen Aufgabe der "tiefen" Analyse von Jira-Installationsdaten.  <code>json</code> unterst√ºtzt im Gegensatz zu <code>csv</code> ein komplexes Objektmodell, sodass das Parsen bei komplexen Strukturen sehr schwierig und langwierig werden kann. </p><br><h1 id="postanovka-zadachi">  Erkl√§rung des Problems </h1><br><p>  Gegeben: </p><br><ul><li>  jira wird im Softwareentwicklungsprozess als Task-Management-System und Bug-Tracker implementiert und verwendet. </li><li>  Es gibt keinen direkten Zugriff auf die Jira-Datenbank, die Interaktion erfolgt √ºber die REST-API (Galvanic Isolation). </li><li>  Die zu verwendenden JSON-Dateien haben eine sehr komplexe Baumstruktur mit verschachtelten Tupeln, die zum Hochladen des gesamten Aktionsverlaufs erforderlich sind.  Die Berechnung von Metriken erfordert eine relativ kleine Anzahl von Parametern, die √ºber verschiedene Hierarchieebenen verteilt sind. </li></ul><br><p>  Ein Beispiel f√ºr einen regul√§ren Jira Json in der Abbildung. </p><br><p><img src="https://habrastorage.org/webt/g1/me/t7/g1met7plll0ltss2wzho4bxzbcs.png"></p><br><p>  Es ist erforderlich: </p><br><ul><li>  Basierend auf Jira-Daten ist es notwendig, Engp√§sse und Punkte einer m√∂glichen Steigerung der Effizienz von Entwicklungsprozessen zu finden und die Qualit√§t des resultierenden Produkts basierend auf einer Analyse aller registrierten Aktionen zu verbessern. </li></ul><br><h1 id="reshenie">  L√∂sung </h1><br><p>  Theoretisch gibt es in R verschiedene Pakete, um json zu laden und in <code>data.frame</code> zu <code>data.frame</code> .  Das bequemste Paket ist <code>jsonlite</code> .  Die direkte Konvertierung der <code>data.frame</code> Hierarchie in <code>data.frame</code> jedoch aufgrund der mehrstufigen Verschachtelung und der starken Parametrisierung der Datensatzstruktur schwierig.  Das Festhalten an bestimmten Parametern, die sich beispielsweise auf die Geschichte der Aktionen beziehen, kann verschiedene ext.  Checks and Loops.  Das hei√üt,  Die Aufgabe kann gel√∂st werden, aber f√ºr eine JSON-Datei mit 32 Aufgaben (einschlie√ülich aller Artefakte und des gesamten Verlaufs der Aufgaben) dauert eine solche nichtlineare Analyse mit Jsonlite und Tidyverse auf einem Laptop mit durchschnittlicher Leistung ~ 10 Sekunden. </p><br><p>  10 Sekunden allein sind nicht viel.  Aber genau bis zu dem Moment, in dem es nicht zu viele dieser Dateien gibt.  Die Auswertung einer Probe beim Parsen und Laden unter Verwendung einer √§hnlichen "direkten" Methode ~ 4000 Dateien (~ 4 GB) ergab 8-9 Stunden Arbeit. </p><br><p>  Eine so gro√üe Anzahl von Dateien erschien aus einem bestimmten Grund.  Erstens hat Jira Zeitlimits f√ºr eine REST-Sitzung, es ist unm√∂glich, alles mit einem Strahl herauszuziehen.  Zweitens wird erwartet, dass der t√§gliche Upload von Daten zu aktualisierten Aufgaben in den Produktivkreislauf integriert wird.  Drittens, und dies wird weiter unten erw√§hnt, eignet sich die Aufgabe sehr gut f√ºr die lineare Skalierung, und Sie m√ºssen vom ersten Schritt an √ºber Parallelisierung nachdenken. </p><br><p>  Selbst 10-15 Iterationen in der Phase der Datenanalyse, die Ermittlung des erforderlichen Mindestparametersatzes, die Erkennung au√üergew√∂hnlicher oder fehlerhafter Situationen und die Entwicklung von Nachbearbeitungsalgorithmen verursachen Kosten in H√∂he von 2-3 Wochen (nur Z√§hlzeit). <br>  Nat√ºrlich ist eine solche ‚ÄûLeistung‚Äú nicht f√ºr Betriebsanalysen geeignet, die in den Produktivkreislauf integriert sind, und ist in der Phase der anf√§nglichen Datenanalyse und Prototypenentwicklung sehr ineffektiv. </p><br><p>  Ich √ºberspringe alle dazwischenliegenden Details und wende mich sofort der Antwort zu.  Wir erinnern uns an Donald Knuth, krempeln die √Ñrmel hoch und beginnen mit dem Mikrobenchen aller wichtigen Operationen, wobei wir r√ºcksichtslos alles abschneiden, was m√∂glich ist. </p><br><p>  Die resultierende L√∂sung wird auf die folgenden 10 Linien reduziert (dies ist ein gef√§lschtes Skelett ohne nachfolgendes nicht funktionierendes Bodykit): </p><br><pre> <code class="plaintext hljs">library(tidyverse) library(jsonlite) library(readtext) fnames &lt;- fs::dir_ls(here::here("input_data"), glob = "*.txt") ff &lt;- function(fname){ json_vec &lt;- readtext(fname, text_field = "texts", encoding = "UTF-8") %&gt;% .$text %&gt;% jqr::jq('[. | {issues: .issues}[] | .[]', '{id: .id, key: .key, created: .fields.created, type: .fields.issuetype.name, summary: .fields.summary, descr: .fields.description}]') jsonlite::fromJSON(json_vec, flatten = TRUE) } tictoc::tic("Loading with jqr-jsonlite single-threaded technique") issues_df &lt;- fnames %&gt;% purrr::map(ff) %&gt;% data.table::rbindlist(use.names = FALSE) tictoc::toc() system.time({fst::write_fst(issues_df, here::here("data", "issues.fst"))})</code> </pre> <br><p>  Was ist hier interessant? </p><br><ol><li>  Um den Ladevorgang zu beschleunigen, <code>readtext</code> es sich, spezielle, profilierte Pakete wie <code>readtext</code> . </li><li>  Mit dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>jq</code></a> Streaming-Parser k√∂nnen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>jq</code></a> alle erforderlichen Attribute in eine funktionale Sprache √ºbersetzen, auf die CPP-Ebene senken und die manuelle Bearbeitung verschachtelter Listen oder Listen in <code>data.frame</code> . </li><li>  Ein vielversprechendes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>bench</code></a> f√ºr Mikrobenchmarks ist erschienen.  Sie k√∂nnen damit nicht nur die Ausf√ºhrungszeit von Operationen, sondern auch die Manipulation des Speichers untersuchen.  Es ist kein Geheimnis, dass Sie beim Kopieren von Daten im Speicher viel verlieren k√∂nnen. </li><li>  F√ºr gro√üe Datenmengen und eine einfache Verarbeitung ist es bei der endg√ºltigen Entscheidung h√§ufig erforderlich, auf <code>tidyverse</code> und die zeitaufw√§ndigen Teile in <code>data.table</code> zu <code>data.table</code> . Insbesondere werden hier Tabellen mit <code>data.table</code> .  Ebenso wie alle Transformationen in der Nachbearbeitungsphase (die im Zyklus durch die <code>ff</code> Funktion enthalten sind, die auch mittels <code>data.table</code> mit dem Ansatz der Daten√§nderung durch Referenz vorgenommen wurden, oder Pakete, die mit <code>Rcpp</code> , beispielsweise <code>anytime</code> Pakete zum Arbeiten mit Datums- und <code>Rcpp</code> . </li><li>  Das <code>fst</code> Paket eignet sich sehr gut zum <code>fst</code> und anschlie√üenden Lesen von Daten in eine Datei.  Insbesondere dauert es nur einen Bruchteil einer Sekunde, um alle Jira-Verlaufsanalysen 4 Jahre lang zu speichern, und die Daten werden genau wie die R-Datentypen gespeichert, was f√ºr ihre sp√§tere Wiederverwendung gut ist. </li></ol><br><p>  W√§hrend der L√∂sung wurde ein Ansatz unter Verwendung des <code>rjson</code> Pakets in <code>rjson</code> .  Die <code>jsonlite::fromJSON</code> ungef√§hr zweimal langsamer als <code>rjson = rjson::fromJSON(json_vec)</code> , musste jedoch <code>rjson = rjson::fromJSON(json_vec)</code> , da die Daten NULL-Werte enthalten und in der von <code>rjson</code> <code>NULL</code> in <code>NA</code> konvertiert werden Vorteil, und der Code wird schwerer. </p><br><h1 id="zaklyuchenie">  Fazit </h1><br><ol><li>  Ein solches Refactoring f√ºhrte zu einer √Ñnderung der Verarbeitungszeit aller JSON-Dateien im Single-Thread-Modus auf demselben Laptop von 8 bis 9 Stunden auf 10 Minuten. </li><li>  Das Hinzuf√ºgen einer Parallelisierung der Aufgabe mit <code>foreach</code> belastete den Code praktisch nicht (+ 5 Zeilen), reduzierte jedoch die Ausf√ºhrungszeit auf 5 Minuten. </li><li>  Durch das √úbertragen der L√∂sung auf einen schwachen Linux-Server (nur 4 Kerne), das Ausf√ºhren auf einer SSD im Multithread-Modus wurde die Ausf√ºhrungszeit auf 40 Sekunden reduziert. </li><li>  Durch die Ver√∂ffentlichung auf einer produktiven Schaltung (20 Kerne, 3 GHz, SSD) wurde die Ausf√ºhrungszeit auf 6 bis 8 Sekunden reduziert, was f√ºr operative Analyseaufgaben mehr als akzeptabel ist. </li></ol><br><p>  Insgesamt gelang es im Rahmen der R-Plattform durch ein einfaches Code-Refactoring, die Ausf√ºhrungszeit von ~ 9 Stunden auf ~ 9 Sekunden zu reduzieren. </p><br><p>  Entscheidungen √ºber R k√∂nnen sehr schnell sein.  Wenn etwas f√ºr Sie nicht funktioniert, versuchen Sie es aus einem anderen Blickwinkel und mit neuen Techniken. </p><br><p>  Vorherige Ver√∂ffentlichung - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">"Analytical Parachute for Manager"</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de429938/">https://habr.com/ru/post/de429938/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de429922/index.html">Wie man aus einem einfachen Projekt eine langfristige Konstruktion macht oder alles Unn√∂tige abschneidet</a></li>
<li><a href="../de429928/index.html">Alles, was Sie √ºber Stress und starke Emotionen wissen m√ºssen</a></li>
<li><a href="../de429930/index.html">Splunk Einfache Fehlerbehebung bei Anwendungen</a></li>
<li><a href="../de429934/index.html">Was ist da</a></li>
<li><a href="../de429936/index.html">Soll ich auf Android unter iOS von Parallels warten?</a></li>
<li><a href="../de429940/index.html">Warum Pflanzen maschinelles Lernen brauchen</a></li>
<li><a href="../de429942/index.html">Holen Sie sich VK-Musik √ºber eine Drittanbieter-API</a></li>
<li><a href="../de429946/index.html">Wahnsinn und Erfolg von Oracle Database Code</a></li>
<li><a href="../de429948/index.html">Warum Produktmanager bei Fintech ben√∂tigt werden</a></li>
<li><a href="../de429950/index.html">So pflegen Sie gesunde Kommunikationsgewohnheiten von Remote-Teams</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>