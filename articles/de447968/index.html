<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏽‍🤝‍👨🏿 👱 🛍️ Schreiben in Rust + CUDA C. 👋🏼 🦐 👨‍👩‍👧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! 

 In diesem Handbuch möchte ich erklären, wie man Freunde CUDA C / C ++ und Rust findet. Als Beispiel schreiben wir ein kleines Pro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Schreiben in Rust + CUDA C.</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447968/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/n5/ej/gl/n5ejglhdaeghddnosdtr2jsq0om.png"></div><br>  Hallo allerseits! <br><br>  In diesem Handbuch möchte ich erklären, wie man Freunde CUDA C / C ++ und Rust findet.  Als Beispiel schreiben wir ein kleines Programm in Rust, um das Skalarprodukt von Vektoren zu berechnen. Die Berechnung des Skalarprodukts erfolgt auf der GPU mit CUDA C. <br><br>  Wen interessiert die Katze? <br><a name="habracut"></a><br><h2>  CUDA C. </h2><br>  Der erste Schritt ist die Installation des CUDA-Compilers - nvcc.  Was ist CUDA und warum muss ich es beschreiben? Ich kann es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> zum Beispiel lesen.  Ich kann nur sagen, dass Sie mit seiner Hilfe Code schreiben können, der auf NVIDIA-Grafikkarten (im Folgenden als GPU bezeichnet) ausgeführt wird, und deren gesamte Leistung für paralleles Rechnen und Grafikverarbeitung nutzen können.  In diesem Tutorial geht es nicht darum, wie man Code in CUDA schreibt, sondern wie man die Vorteile von Rust-Code nutzt und paralleles Computing auf die GPU schreibt. <br><br>  Installieren Sie also nvcc und das CUDA Toolkit.  Bei dieser Komplexität sollten keine detaillierten Anweisungen entstehen: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vor Ort</a> . <br><br><h2>  ROST + CUDA C. </h2><br>  Während dieses Tutorials werden wir, wie bereits erwähnt, ein Programm in Rust schreiben, um das Skalarprodukt zweier Vektoren zu finden. Der Berechnungsprozess selbst wird auf der GPU ausgeführt. <br><br><div class="spoiler">  <b class="spoiler_title">Das Skalarprodukt zweier Vektoren.</b> <div class="spoiler_text">  Angenommen, wir haben zwei Vektoren: <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>a</mi><mo>=</mo><mo stretchy=&quot;false&quot;>[</mo><msub><mi>a</mi><mn>1</mn></msub><mo>,</mo><msub><mi>a</mi><mn>2</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><msub><mi>a</mi><mi>n</mi></msub><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.808ex" height="2.762ex" viewBox="0 -831.5 7667.3 1189" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.83ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-61" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-3D" x="807" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-5B" x="1863" y="0"></use><g transform="translate(2142,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-31" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-2C" x="3125" y="0"></use><g transform="translate(3570,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-32" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-2C" x="4554" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-2E" x="4999" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-2E" x="5444" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-2E" x="5889" y="0"></use><g transform="translate(6334,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-6E" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-5D" x="7388" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mo>=</mo><mo stretchy="false">[</mo><msub><mi>a</mi><mn>1</mn></msub><mo>,</mo><msub><mi>a</mi><mn>2</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><msub><mi>a</mi><mi>n</mi></msub><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-1"> a = [a_1, a_2, ... a_n] </script>  und <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>b</mi><mo>=</mo><mo stretchy=&quot;false&quot;>[</mo><msub><mi>b</mi><mn>1</mn></msub><mo>,</mo><msub><mi>b</mi><mn>2</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>b</mi><mi>n</mi></msub><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.913ex" height="2.762ex" viewBox="0 -831.5 7712.5 1189" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.83ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-62" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-3D" x="707" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-5B" x="1763" y="0"></use><g transform="translate(2042,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-62" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-31" x="607" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-2C" x="2925" y="0"></use><g transform="translate(3370,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-62" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-32" x="607" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-2C" x="4254" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-2E" x="4699" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-2E" x="5144" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-2E" x="5589" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-2C" x="6034" y="0"></use><g transform="translate(6479,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-62" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-6E" x="607" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-5D" x="7433" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>b</mi><mo>=</mo><mo stretchy="false">[</mo><msub><mi>b</mi><mn>1</mn></msub><mo>,</mo><msub><mi>b</mi><mn>2</mn></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>b</mi><mi>n</mi></msub><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-2"> b = [b_1, b_2, ..., b_n] </script>  , das Skalarprodukt dieser Vektoren: <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>a</mi><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>b</mi><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>u</mi><msubsup><mi>m</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>n</mi></mrow></msubsup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>a</mi><mi>i</mi></msub><msub><mi>b</mi><mi>i</mi></msub></mrow></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="21.865ex" height="2.762ex" viewBox="0 -772.3 9413.9 1189" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.968ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-61" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-63" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-64" x="1213" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-6F" x="1736" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-74" x="2222" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-62" x="2583" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-3D" x="3290" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-73" x="4597" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-75" x="5066" y="0"></use><g transform="translate(5639,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-6E" x="1242" y="499"></use><g transform="translate(878,-308)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-3D" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMAIN-31" x="1124" y="0"></use></g></g><g transform="translate(7766,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-69" x="748" y="-213"></use><g transform="translate(873,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-62" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/447968/&amp;usg=ALkJrhj4Yb4500f_rJ6x1q8di7Y4ZkyEjA#MJMATHI-69" x="607" y="-213"></use></g></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>b</mi><mo>=</mo><mtext>&nbsp;</mtext><mi>s</mi><mi>u</mi><msubsup><mi>m</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>n</mi></mrow></msubsup><mrow class="MJX-TeXAtom-ORD"><msub><mi>a</mi><mi>i</mi></msub><msub><mi>b</mi><mi>i</mi></msub></mrow></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-3"> a \ cdot b = \ sum_ {i = 1} ^ {n} {a_ib_i} </script></p><br></div></div><br>  Beginnen wir mit der Erstellung unseres Programms.  Außerdem gehe ich davon aus, dass nvcc erfolgreich installiert wurde. Rustc und Fracht stehen auch für das Kompilieren von Rostcode. <br><br>  Erstellen Sie zunächst den Projektordner.  Erstellen Sie im Projektordner die Datei Cargo.toml, die Anweisungen für den Ladungssammler enthält.  Die Datei sieht folgendermaßen aus: <br><br><pre><code class="rust hljs">[package] name = <span class="hljs-string"><span class="hljs-string">"rust_cuda"</span></span> #   version = <span class="hljs-string"><span class="hljs-string">"0.1.0"</span></span> #   authors = [<span class="hljs-string"><span class="hljs-string">"MoonL1ght &lt;ixav1@icloud.com&gt;"</span></span>] #    build = <span class="hljs-string"><span class="hljs-string">"build.rs"</span></span> #    rust links = <span class="hljs-string"><span class="hljs-string">"cudart"</span></span> #  cuda,    [dependencies] libc = <span class="hljs-string"><span class="hljs-string">"0.2"</span></span> #  rust     rand = <span class="hljs-string"><span class="hljs-string">"0.5.5"</span></span> #  rust      [build-dependencies] cc = <span class="hljs-string"><span class="hljs-string">"1.0"</span></span> # rust     </code> </pre> <br>  Erstellen Sie auch im Projektstammordner die Datei build.rs, die Anweisungen zum Erstellen des Rostprogramms und zum Kompilieren des CUDA C-Codes enthält. <br><br>  Fügen Sie den Ordner src zum Projektstamm hinzu, in dem wir die Quellcodedateien ablegen.  Erstellen Sie im Ordner src vier Dateien: main.rs - den Code des Hauptprogramms, dot.cpp - C ++ - Bindung (Wrapper für CUDA C), dot_gpu.h, dot_gpu.cu - die Datei, die den auf der GPU ausgeführten Code enthält. <br><br>  Insgesamt haben wir eine solche Projektstruktur: <br><br><pre> <code class="rust hljs">rust-cuda/ src/ main.rs dot.cpp dot_gpu.h dot_gpu.cu Cargo.toml build.rs</code> </pre> <br>  In der Datei build.rs ist es am wichtigsten, Folgendes zu schreiben: <br><br><pre> <code class="rust hljs"><span class="hljs-built_in"><span class="hljs-built_in">println!</span></span>(<span class="hljs-string"><span class="hljs-string">"cargo:rustc-link-search=native=/Developer/NVIDIA/CUDA-10.1/lib"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">println!</span></span>(<span class="hljs-string"><span class="hljs-string">"cargo:rustc-link-search=/Developer/NVIDIA/CUDA-10.1/lib"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">println!</span></span>(<span class="hljs-string"><span class="hljs-string">"cargo:rustc-env=LD_LIBRARY_PATH=/Developer/NVIDIA/CUDA-10.1/lib"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">println!</span></span>(<span class="hljs-string"><span class="hljs-string">"cargo:rustc-link-lib=dylib=cudart"</span></span>);</code> </pre> <br>  Dabei ist /Developer/NVIDIA/CUDA-10.1/lib der Pfad zu den ausführbaren CUDA-Dateien. In einem Unix-ähnlichen System kann dieser Pfad beispielsweise mit dem folgenden Befehl gefunden werden: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">which</span></span> nvcc</code> </pre> <br>  Darüber hinaus müssen Sie in der Datei build.rs den Pfad zu den Dateien dot.cpp und dot_gpu.cpp angeben: <br><br><pre> <code class="rust hljs">.files(&amp;[<span class="hljs-string"><span class="hljs-string">"./src/dot.cpp"</span></span>, <span class="hljs-string"><span class="hljs-string">"./src/dot_gpu.cu"</span></span>])</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Alle build.rs Code</b> <div class="spoiler_text"><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">crate</span></span> cc; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span></span>() { cc::Build::new() .cuda(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) .cpp(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) .flag(<span class="hljs-string"><span class="hljs-string">"-cudart=shared"</span></span>) .files(&amp;[<span class="hljs-string"><span class="hljs-string">"./src/dot.cpp"</span></span>, <span class="hljs-string"><span class="hljs-string">"./src/dot_gpu.cu"</span></span>]) .compile(<span class="hljs-string"><span class="hljs-string">"dot.a"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">println!</span></span>(<span class="hljs-string"><span class="hljs-string">"cargo:rustc-link-search=native=/Developer/NVIDIA/CUDA-10.1/lib"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">println!</span></span>(<span class="hljs-string"><span class="hljs-string">"cargo:rustc-link-search=/Developer/NVIDIA/CUDA-10.1/lib"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">println!</span></span>(<span class="hljs-string"><span class="hljs-string">"cargo:rustc-env=LD_LIBRARY_PATH=/Developer/NVIDIA/CUDA-10.1/lib"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">println!</span></span>(<span class="hljs-string"><span class="hljs-string">"cargo:rustc-link-lib=dylib=cudart"</span></span>); }</code> </pre> <br></div></div><br>  Jetzt können Sie mit dem Schreiben des Hauptprogrammcodes beginnen.  In der Datei main.rs müssen Sie eine Schnittstelle für C / C ++ - Funktionen erstellen, um direkt aus Rust-Code aufzurufen.  Weitere Informationen hierzu finden Sie in der offiziellen Dokumentation im Abschnitt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">FFI</a> . <br><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> { <span class="hljs-comment"><span class="hljs-comment">//  C        fn dot(v1: *mut c_float, v2: *mut c_float, N: size_t) -&gt; c_float; }</span></span></code> </pre> <br>  Um es aufzurufen, müssen Sie den unsicheren Codeblock verwenden, da wir als Argumente einen veränderlichen Zeiger auf den Vec-Typ übergeben: <br><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsafe</span></span> { gpu_res = dot(v1.as_mut_ptr(), v2.as_mut_ptr(), VEC_SIZE); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Vollständiger main.rs-Dateicode</b> <div class="spoiler_text"><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">crate</span></span> libc; <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">crate</span></span> rand; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> libc::{c_float, size_t}; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> rand::Rng; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VEC_SIZE: <span class="hljs-built_in"><span class="hljs-built_in">usize</span></span> = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MAX: <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span> = <span class="hljs-number"><span class="hljs-number">10</span></span>.; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MIN: <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>.; <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dot</span></span></span></span>(v1: *<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> c_float, v2: *<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> c_float, N: size_t) -&gt; c_float; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cpu_dot</span></span></span></span>(v1: <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>&gt;, v2: <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>&gt;) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> res: <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>.; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>..v1.len() { res += v1[i] * v2[i]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> v1: <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>&gt; = <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>::new(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> v2: <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>&gt; = <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>::new(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> gpu_res: c_float; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> cpu_res: <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>.; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> rng = rand::thread_rng(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>..VEC_SIZE { v1.push(rng.gen_range(MIN, MAX)); v2.push(rng.gen_range(MIN, MAX)); } <span class="hljs-built_in"><span class="hljs-built_in">println!</span></span>(<span class="hljs-string"><span class="hljs-string">"{:?}"</span></span>, v1); <span class="hljs-built_in"><span class="hljs-built_in">println!</span></span>(<span class="hljs-string"><span class="hljs-string">"{:?}"</span></span>, v2); <span class="hljs-built_in"><span class="hljs-built_in">println!</span></span>(<span class="hljs-string"><span class="hljs-string">"GPU computing started"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">unsafe</span></span> { gpu_res = dot(v1.as_mut_ptr(), v2.as_mut_ptr(), VEC_SIZE); } <span class="hljs-built_in"><span class="hljs-built_in">println!</span></span>(<span class="hljs-string"><span class="hljs-string">"GPU computing finished"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">println!</span></span>(<span class="hljs-string"><span class="hljs-string">"GPU dot product result: {}"</span></span>, gpu_res); cpu_res = cpu_dot(v1, v2); <span class="hljs-built_in"><span class="hljs-built_in">println!</span></span>(<span class="hljs-string"><span class="hljs-string">"CPU dot product result: {}"</span></span>, cpu_res); }</code> </pre> <br></div></div><br>  Jetzt schreiben wir die Bindungen in C ++ sowie den Code zur Berechnung des Skalarprodukts von Vektoren in CUDA C. <br><br>  In die Datei dot.cpp schreiben wir die Bindungsfunktion, wir rufen diese Funktion tatsächlich aus dem Rust-Code auf: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *v1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *v2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> N)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> *gpu_res; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> res = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; gpu_res = gpu_dot(v1, v2, N); <span class="hljs-comment"><span class="hljs-comment">//   GPU for (int i = 0; i &lt; blocksPerGrid; i++) { res += gpu_res[i]; } free(gpu_res); return res; } }</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Vollständiger dot.cpp-Dateicode</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt; #include "dot_gpu.h" using namespace std; void display_vector(float *v, size_t N) { cout &lt;&lt; "["; for (size_t i = 0; i &lt; N; i++) { cout &lt;&lt; v[i]; if (i != N - 1) { cout &lt;&lt; ", "; } } cout &lt;&lt; "]" &lt;&lt; endl; } extern "C" { float dot(float *v1, float *v2, size_t N) { cout &lt;&lt; "Calling gpu dot product" &lt;&lt; endl; cout &lt;&lt; "Got two vectors from rust:" &lt;&lt; endl; display_vector(v1, N); display_vector(v2, N); float *gpu_res; float res = 0.0; gpu_res = gpu_dot(v1, v2, N); for (int i = 0; i &lt; blocksPerGrid; i++) { res += gpu_res[i]; } free(gpu_res); return res; } }</span></span></span></span></code> </pre> <br></div></div><br>  Das Folgende ist der Code aus der Datei dot_gpu.cu, in der die Hauptberechnung durchgeführt wird. Ich werde den Code selbst in diesem Tutorial nicht erklären, da er nicht für die CUDA-Programmierung vorgesehen ist. <br><br><div class="spoiler">  <b class="spoiler_title">dot_gpu.cu</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"dot_gpu.h"</span></span></span><span class="hljs-meta"> __global__ void dot__(float *v1, float *v2, float *res, int N) { __shared__ float cache [threadsPerBlock]; int tid = threadIdx.x + blockIdx.x * blockDim.x; int cacheIndex = threadIdx.x; float temp = 0.0; while (tid </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt; N) { temp += v1[tid] * v2[tid]; tid += blockDim.x * gridDim.x; } cache[cacheIndex] = temp; __syncthreads(); int i = blockDim.x / 2; while (i != 0) { if (cacheIndex &lt; i) { cache[cacheIndex] += cache[cacheIndex + i]; } __syncthreads(); i /= 2; } if (cacheIndex == 0) { res[blockIdx.x] = cache[0]; } } float * gpu_dot (float *v1, float *v2, size_t N) { float *dev_v1, *dev_v2, *dev_res, *res; res = new float[blocksPerGrid]; cudaMalloc((void**)&amp;dev_v1, N * sizeof(float)); cudaMalloc((void**)&amp;dev_v2, N * sizeof(float)); cudaMalloc((void**)&amp;dev_res, blocksPerGrid * sizeof(float)); cudaMemcpy(dev_v1, v1, N * sizeof(float), cudaMemcpyHostToDevice); cudaMemcpy(dev_v2, v2, N * sizeof(float), cudaMemcpyHostToDevice); dot__&lt;&lt;&lt;blocksPerGrid, threadsPerBlock&gt;&gt;&gt;(dev_v1, dev_v2, dev_res, (int)N); cudaMemcpy(res, dev_res, blocksPerGrid * sizeof(float), cudaMemcpyDeviceToHost); cudaFree(dev_v1); cudaFree(dev_v2); cudaFree(dev_res); return res; }</span></span></span></span></code> </pre> <br></div></div><br>  Alle unsere kleinen Programme sind geschrieben und bereit zum Erstellen.  Rufen Sie den folgenden Befehl auf, um es in der Konsole zusammenzustellen: <br><br><pre> <code class="bash hljs">cargo build</code> </pre> <br>  So führen Sie aus: <br><br><pre> <code class="bash hljs">cargo run</code> </pre> <br>  Nach dem Erstellen des Programms wird der Zielordner im Hauptverzeichnis des Projekts angezeigt.  Die ausführbare Datei unseres Programms befindet sich im Ordner: ./target/debug/ <br><br>  Wenn wir nur unsere ausführbare Datei ausführen, wird außerdem die folgende Fehlermeldung angezeigt: Die dyld-Bibliothek wurde nicht geladen.  Das heißt, er kann den Pfad zur dynamischen cuda-Bibliothek nicht finden.  Um dieses Problem zu lösen, können Sie die Umgebungsvariable LD_LIBRARY_PATH = path_to_CUDA_lib_directory / registrieren oder symbolische Links im Ordner rust rustchainchain für CUDA ausführen, bevor Sie die ausführbare Datei in der Konsole starten: <br><br><pre> <code class="bash hljs">ln -s /Developer/NVIDIA/CUDA-10.1/lib/* /Users/Alexander/.rustup/toolchains/nightly-x86_64-apple-darwin/lib</code> </pre> <br>  Wenn /Users/Alexander/.rustup/toolchains/nightly-x86_64-apple-darwin/lib mein Pfad zur installierten Rost-Toolchain ist, kann dies für Sie geringfügig abweichen. <br><br>  Beim Starten des Programms über den Frachtlauf ist ein solcher Fehler nicht aufgetreten, da wir die Umgebungsvariable LD_LIBRARY_PATH in der Datei build.rs registriert haben. <br><br><h2>  Zusammenfassend </h2><br>  Wir haben die Möglichkeit, CUDA C-Code direkt aus Rust-Code auszuführen.  Um dies zu überprüfen, haben wir ein kleines Programm erstellt, das mit Vektoren arbeitet und alle Berechnungen auf der GPU durchführt.  Der vollständige Code kann auch auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">github angezeigt werden</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de447968/">https://habr.com/ru/post/de447968/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de447958/index.html">CJM für falsches Auslösen von DrWeb Antivirus</a></li>
<li><a href="../de447960/index.html">Veeam Linux Backup unter Elbrus OS. Importsubstitution ['?' | '.' | '!']</a></li>
<li><a href="../de447962/index.html">Hacker können Tesla Model S mithilfe des Autopilotsystems fernsteuern</a></li>
<li><a href="../de447964/index.html">Mikrocomputertests für IoT</a></li>
<li><a href="../de447966/index.html">So verbinden Sie GitLab und Pantheon und optimieren Drupal- und WordPress-Workflows</a></li>
<li><a href="../de447970/index.html">Super einfache Javascript-Protokollierung - zwei Dekorateure und fertig</a></li>
<li><a href="../de447976/index.html">Entwicklung und Montage einer Fotolampe</a></li>
<li><a href="../de447980/index.html">Warum ist es unerlässlich, eine Marken-Taxi-App für Ihr Unternehmen zu investieren und zu entwickeln?</a></li>
<li><a href="../de447982/index.html">Digest: 10 Materialien zu Bildschirmen und Projektoren für das Heimkino</a></li>
<li><a href="../de447984/index.html">Uber hat Dokumente für einen Börsengang eingereicht</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>