<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§æüèø üßîüèø üé¨ Unifica√ß√£o de regras de valida√ß√£o pelo exemplo do n√∫cleo Asp + VueJS üë©üèø‚Äçü§ù‚Äçüë®üèª üßòüèæ üßê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este artigo descreve uma maneira simples de unificar regras de valida√ß√£o de entrada do usu√°rio para um aplicativo cliente-servidor. Usando um projeto ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Unifica√ß√£o de regras de valida√ß√£o pelo exemplo do n√∫cleo Asp + VueJS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473776/"><p><img src="https://habrastorage.org/webt/aq/-m/hx/aq-mhx5bf0a0_ablfc-ers0kvki.png"><br>  <em>Este artigo descreve uma maneira simples de unificar regras de valida√ß√£o de entrada do usu√°rio para um aplicativo cliente-servidor.</em>  <em>Usando um projeto simples como exemplo, mostrarei como isso pode ser feito usando o Asp net core e o Vue js.</em> </p><br><p>  Ao desenvolver aplicativos da Web, via de regra, enfrentamos a tarefa de dupla valida√ß√£o da entrada do usu√°rio.  Por um lado, a entrada do usu√°rio deve ser validada no cliente para reduzir solicita√ß√µes redundantes ao servidor e acelerar a valida√ß√£o em si para o usu√°rio.  Por outro lado, falando em valida√ß√£o, o servidor n√£o pode aceitar ‚Äúde f√©‚Äù que a valida√ß√£o do cliente realmente funcionou antes de enviar a solicita√ß√£o, porque  o usu√°rio pode desativar ou modificar o c√≥digo de valida√ß√£o.  Ou fa√ßa uma solicita√ß√£o manualmente da API do cliente. </p><a name="habracut"></a><br><p>  Portanto, a intera√ß√£o cliente-servidor cl√°ssica possui 2 n√≥s, com regras de valida√ß√£o de entrada do usu√°rio geralmente id√™nticas.  Este artigo como um todo foi discutido em mais de um artigo; uma solu√ß√£o leve ser√° descrita aqui usando o servidor ASP.Net Core API e o cliente Vue js como exemplo. </p><br><p> Para come√ßar, determinaremos que validaremos exclusivamente as solicita√ß√µes do usu√°rio (equipe), n√£o da entidade e, do ponto de vista da arquitetura cl√°ssica de tr√™s camadas, nossa valida√ß√£o est√° na Camada de Apresenta√ß√£o. </p><br><h1 id="servernaya-chast">  Lado do servidor </h1><br><p>  Enquanto estiver no Visual Studio 2019, criarei um projeto para um aplicativo de servidor, usando o modelo de aplicativo Web ASP.NET Core, com um tipo de API.  O ASP pronto para uso possui um mecanismo de valida√ß√£o bastante robusto e extens√≠vel - valida√ß√£o de modelo, segundo a qual, as propriedades de solicita√ß√£o de modelo s√£o marcadas com atributos de valida√ß√£o espec√≠ficos. </p><br><p>  Considere isso com um controlador simples como exemplo: </p><br><pre><code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Route(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"[controller]"</span></span></span><span class="hljs-meta">)</span></span>] [ApiController] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AccountController</span></span> : <span class="hljs-title"><span class="hljs-title">ControllerBase</span></span> { [HttpPost(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(Registration))] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Registration</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[FromBody]RegistrationRequest request</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Ok(<span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{request.Name}</span></span></span><span class="hljs-string">,  !"</span></span>); } }</code> </pre> <br><p>  A solicita√ß√£o para registrar um novo usu√°rio ter√° a seguinte apar√™ncia: </p><br><div class="spoiler">  <b class="spoiler_title">RegistrationRequest</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RegistrationRequest</span></span> { [StringLength(maximumLength: <span class="hljs-number"><span class="hljs-number">50</span></span>, MinimumLength = <span class="hljs-number"><span class="hljs-number">2</span></span>, ErrorMessage = <span class="hljs-string"><span class="hljs-string">"     2  50 "</span></span>)] [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">" "</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">"  . "</span></span>)] [EmailAddress(ErrorMessage = <span class="hljs-string"><span class="hljs-string">"  . "</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Email { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">" "</span></span>)] [MaxLength(<span class="hljs-number"><span class="hljs-number">100</span></span>, ErrorMessage = <span class="hljs-string"><span class="hljs-string">"{0}    {1} "</span></span>)] [MinLength(<span class="hljs-number"><span class="hljs-number">6</span></span>, ErrorMessage =<span class="hljs-string"><span class="hljs-string">"{0}    {1} "</span></span>)] [DisplayName(<span class="hljs-string"><span class="hljs-string">""</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Password { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">" "</span></span>)] [Range(<span class="hljs-number"><span class="hljs-number">18</span></span>,<span class="hljs-number"><span class="hljs-number">150</span></span>, ErrorMessage = <span class="hljs-string"><span class="hljs-string">"      18  150"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Age { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DisplayName(<span class="hljs-string"><span class="hljs-string">""</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Culture { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> </div></div><br><p>  Ele usa atributos de valida√ß√£o predefinidos do espa√ßo para nome System.ComponentModel.DataAnnotations.  As propriedades necess√°rias s√£o marcadas com o atributo Requerido.  Assim, ao enviar JSON vazio ("{}"), nossa API retornar√°: </p><br><pre> <code class="json hljs">{ ... <span class="hljs-attr"><span class="hljs-attr">"errors"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Age"</span></span>: [ <span class="hljs-string"><span class="hljs-string">" "</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"Name"</span></span>: [ <span class="hljs-string"><span class="hljs-string">" "</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"Email"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"  . "</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"Password"</span></span>: [ <span class="hljs-string"><span class="hljs-string">" "</span></span> ] } }</code> </pre> <br><p>  O primeiro problema que pode ser encontrado nesta fase √© a localiza√ß√£o das descri√ß√µes de erros.  A prop√≥sito, o ASP possui ferramentas de localiza√ß√£o integradas; consideraremos isso posteriormente. </p><br><p>  Para verificar o comprimento dos dados da sequ√™ncia, voc√™ pode usar os atributos com nomes falantes: StringLength, MaxLength e MinLength.  Ao mesmo tempo, formatando cadeias (chaves), os par√¢metros de atributo podem ser integrados a uma mensagem.  Por exemplo, para o nome de usu√°rio, inserimos o comprimento m√≠nimo e m√°ximo na mensagem e para a senha "nome de exibi√ß√£o" especificada no atributo com o mesmo nome.  O atributo Range √© respons√°vel por verificar o valor que deve estar no intervalo especificado. <br>  Vamos enviar uma solicita√ß√£o com um nome de usu√°rio e senha inaceitavelmente curtos: </p><br><pre> <code class="json hljs"> { <span class="hljs-attr"><span class="hljs-attr">"Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Password"</span></span> : <span class="hljs-string"><span class="hljs-string">"123"</span></span> }</code> </pre> <br><p>  Na resposta do servidor, voc√™ pode encontrar novas mensagens de erro de valida√ß√£o: </p><br><pre> <code class="json hljs"> <span class="hljs-string"><span class="hljs-string">"Name"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"     2  50 "</span></span> ], <span class="hljs-string"><span class="hljs-string">"Password"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"    6 "</span></span> ]</code> </pre> <br><p>  O problema, que por enquanto n√£o √© √≥bvio, √© que os valores de limite para o comprimento do nome e da senha tamb√©m devem estar presentes no aplicativo cliente.  Uma situa√ß√£o em que os mesmos dados s√£o definidos manualmente em dois ou mais locais √© um potencial terreno f√©rtil para bugs, um dos sinais de um design inadequado.  Vamos consertar. </p><br><p>  Armazenaremos tudo o que o cliente precisar√° em arquivos de recursos.  Mensagens em Controllers.AccountController.ru.resx e dados culturalmente independentes em um recurso compartilhado: Controllers.AccountController.resx.  Eu aderir a este formato: </p><br><pre> <code class="json hljs">{PropertyName}DisplayName {PropertyName}{RuleName} {PropertyName}{RuleName}Message</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Assim, temos a seguinte imagem</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/al/cr/zg/alcrzgje8f1btwzkgwzfrz6mgyq.png"></p></div></div><br><p>  Observe que, para validar o endere√ßo de email  mail √© usado express√£o regular.  E para valida√ß√£o de cultura, uma regra personalizada √© usada - "Valores" (lista de valores).  Voc√™ tamb√©m precisar√° verificar o campo de confirma√ß√£o da senha, que veremos mais adiante na interface do usu√°rio. </p><br><p>  Para acessar arquivos de recursos para uma cultura espec√≠fica, adicionamos suporte √† localiza√ß√£o no m√©todo Startup.ConfigureServices, indicando o caminho para os arquivos de recursos: </p><br><pre> <code class="cs hljs">services.AddLocalization(options =&gt; options.ResourcesPath = <span class="hljs-string"><span class="hljs-string">"Resources"</span></span>);</code> </pre> <br><p>  E tamb√©m no m√©todo Startup.Configure, determinando a cultura pelo cabe√ßalho da solicita√ß√£o do usu√°rio: </p><br><pre> <code class="cs hljs"> app.UseRequestLocalization(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RequestLocalizationOptions { DefaultRequestCulture = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RequestCulture(<span class="hljs-string"><span class="hljs-string">"ru-RU"</span></span>), SupportedCultures = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CultureInfo(<span class="hljs-string"><span class="hljs-string">"en-US"</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CultureInfo(<span class="hljs-string"><span class="hljs-string">"ru-RU"</span></span>) }, RequestCultureProviders = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;IRequestCultureProvider&gt; { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AcceptLanguageHeaderRequestCultureProvider() } });</code> </pre> <br><p>  Agora, para que dentro do controlador tenhamos acesso √† localiza√ß√£o, implementaremos uma depend√™ncia do tipo IStringLocalizer no construtor e modificaremos a express√£o de retorno da a√ß√£o Registration: <br></p><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Ok(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(_localizer[<span class="hljs-string"><span class="hljs-string">"RegisteredMessage"</span></span>], request.Name));</code> </pre> <br><p>  A classe ResxValidatior ser√° respons√°vel por verificar as regras, que usar√£o os recursos criados.  Ele cont√©m uma lista reservada de palavras-chave, rolos predefinidos e um m√©todo para verific√°-las. </p><br><div class="spoiler">  <b class="spoiler_title">ResxValidatior</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ResxValidator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> ValuesSeparator = <span class="hljs-string"><span class="hljs-string">','</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> RangeSeparator = <span class="hljs-string"><span class="hljs-string">'-'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Keywords { DisplayName, Message, Required, Pattern, Length, MinLength, MaxLength, Range, MinValue, MaxValue, Values, Compare } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Dictionary&lt;Keywords, Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;&gt; _rules = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;Keywords, Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;&gt;() { [Keywords.Required] = (v, arg) =&gt; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(v), [Keywords.Pattern] = (v, arg) =&gt; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(v) &amp;&amp; Regex.IsMatch(v, arg), [Keywords.Range] = (v, arg) =&gt; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(v) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>.TryParse(v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vLong) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>.TryParse(arg.Split(RangeSeparator)[<span class="hljs-number"><span class="hljs-number">0</span></span>].Trim(), <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vMin) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>.TryParse(arg.Split(RangeSeparator)[<span class="hljs-number"><span class="hljs-number">1</span></span>].Trim(), <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vMax) &amp;&amp; vLong &gt;= vMin &amp;&amp; vLong &lt;= vMax, [Keywords.Length] = (v, arg) =&gt; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(v) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>.TryParse(arg.Split(RangeSeparator)[<span class="hljs-number"><span class="hljs-number">0</span></span>].Trim(), <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vMin) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>.TryParse(arg.Split(RangeSeparator)[<span class="hljs-number"><span class="hljs-number">1</span></span>].Trim(), <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vMax) &amp;&amp; v.Length &gt;= vMin &amp;&amp; v.Length &lt;= vMax, [Keywords.MinLength] = (v, arg) =&gt; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(v) &amp;&amp; v.Length &gt;= <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.Parse(arg), [Keywords.MaxLength] = (v, arg) =&gt; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(v) &amp;&amp; v.Length &lt;= <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.Parse(arg), [Keywords.Values] = (v, arg) =&gt; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(v) &amp;&amp; arg.Split(ValuesSeparator).Select(x =&gt; x.Trim()).Contains(v), [Keywords.MinValue] = (v, arg) =&gt; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(v) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>.TryParse(v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vLong) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>.TryParse(arg, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> argLong) &amp;&amp; vLong &gt;= argLong, [Keywords.MaxValue] = (v, arg) =&gt; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(v) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>.TryParse(v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vLong) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>.TryParse(arg, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> argLong) &amp;&amp; vLong &lt;= argLong }; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IStringLocalizer _localizer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResxValidator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IStringLocalizer localizer</span></span></span><span class="hljs-function">)</span></span> { _localizer = localizer; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsValid</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> memberName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">out</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> message</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rules = _rules.Select(x =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { Name = x.Key, Check = x.Value, String = _localizer.GetString(memberName + x.Key) }).Where(x =&gt; x.String != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; !x.String.ResourceNotFound); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rule <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> rules) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!rule.Check(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, rule.String?.Value)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> messageResourceKey = <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{memberName}</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{rule.Name}</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Keywords.Message}</span></span></span><span class="hljs-string">"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> messageResource = _localizer[messageResourceKey]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> displayNameResourceKey = <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{memberName}</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Keywords.DisplayName}</span></span></span><span class="hljs-string">"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> displayNameResource = _localizer[displayNameResourceKey] ?? displayNameResourceKey; message = messageResource != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; !messageResource.ResourceNotFound ? <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(messageResource.Value, displayNameResource, rule.String?.Value) : messageResourceKey; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } message = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } }</code> </pre> </div></div><br><p>  Crie um atributo de valida√ß√£o personalizado que nosso validador chamar√°.  Aqui, a l√≥gica padr√£o √© obter o valor da propriedade verificada do modelo, seu nome e chamar o validador. </p><br><div class="spoiler">  <b class="spoiler_title">ResxAttribute</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">public sealed class ResxAttribute : ValidationAttribute { private readonly string _baseName; private string _resourceName; public ResxAttribute(string sectionName, string resourceName = null) { _baseName = sectionName; _resourceName = resourceName; } protected override ValidationResult IsValid(object value, ValidationContext validationContext) { if (_resourceName == null) _resourceName = validationContext.MemberName; var factory = validationContext .GetService(typeof(IStringLocalizerFactory)) as IStringLocalizerFactory; var localizer = factory?.Create(_baseName, System.Reflection.Assembly.GetExecutingAssembly().GetName().Name); ErrorMessage = ErrorMessageString; var currentValue = value as string; var validator = new ResxValidator(localizer); return validator.IsValid(_resourceName, currentValue, out var message) ? ValidationResult.Success : new ValidationResult(message); } }</code> </pre> </div></div><br><p>  Por fim, voc√™ pode substituir todos os atributos da solicita√ß√£o pelo universal, indicando o nome do recurso: </p><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Resx(sectionName: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Controllers.AccountController"</span></span></span><span class="hljs-meta">)</span></span>]</code> </pre> <br><p>  Testaremos a funcionalidade enviando a mesma solicita√ß√£o: </p><br><pre> <code class="json hljs"> { <span class="hljs-attr"><span class="hljs-attr">"Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Password"</span></span> : <span class="hljs-string"><span class="hljs-string">"123"</span></span> }</code> </pre> <br><p>  Para localiza√ß√£o, adicione Controllers.AccountController.en.resx com mensagens em ingl√™s e cabe√ßalho, com informa√ß√µes sobre a cultura: Accept-Language: en-US. </p><br><p>  Observe que agora podemos substituir as configura√ß√µes de uma cultura espec√≠fica.  No arquivo * .en.resx, especifiquei o tamanho m√≠nimo da senha de 8 e recebi uma mensagem apropriada: </p><br><pre> <code class="json hljs"> <span class="hljs-string"><span class="hljs-string">"Password"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"Password must be at least 8 characters"</span></span> ]</code> </pre> <br><p>  Para exibir mensagens id√™nticas durante a valida√ß√£o do cliente, voc√™ deve exportar de alguma forma a lista inteira de mensagens para a parte do cliente.  Para simplificar, criaremos um controlador separado que fornecer√° tudo o que voc√™ precisa para um aplicativo cliente no formato i18n. </p><br><div class="spoiler">  <b class="spoiler_title">Controlador local</b> <div class="spoiler_text"><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Route(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"[controller]"</span></span></span><span class="hljs-meta">)</span></span>] [ApiController] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LocaleController</span></span> : <span class="hljs-title"><span class="hljs-title">ControllerBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IStringLocalizerFactory _factory; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _assumbly; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _location; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LocaleController</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IStringLocalizerFactory factory</span></span></span><span class="hljs-function">)</span></span> { _factory = factory; _assumbly = System.Reflection.Assembly.GetExecutingAssembly().GetName().Name; _location = Path.Combine(Directory.GetCurrentDirectory(), <span class="hljs-string"><span class="hljs-string">"Resources"</span></span>); } [HttpGet(<span class="hljs-string"><span class="hljs-string">"Config"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetConfig</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> culture</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(culture)) { CultureInfo.CurrentCulture = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CultureInfo(culture); CultureInfo.CurrentUICulture = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CultureInfo(culture); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> resources = Directory.GetFiles(_location, <span class="hljs-string"><span class="hljs-string">"*.resx"</span></span>, SearchOption.AllDirectories) .Select(x =&gt; x.Replace(_location + Path.DirectorySeparatorChar, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty)) .Select(x =&gt; x.Substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, x.IndexOf(<span class="hljs-string"><span class="hljs-string">'.'</span></span>))) .Distinct(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> config = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> resource <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> resources.Select(x =&gt; x.Replace(<span class="hljs-string"><span class="hljs-string">'\\'</span></span>, <span class="hljs-string"><span class="hljs-string">'.'</span></span>))) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> section = _factory.Create(resource, _assumbly) .GetAllStrings() .OrderBy(x =&gt; x.Name) .ToDictionary(x =&gt; x.Name, x =&gt; x.Value); config.Add(resource.Replace(<span class="hljs-string"><span class="hljs-string">'.'</span></span>, <span class="hljs-string"><span class="hljs-string">'-'</span></span>), section); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = JsonConvert.SerializeObject(config, Formatting.Indented); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Ok(result); } }</code> </pre> </div></div><br><p>  Dependendo do idioma aceito, ele retornar√°: </p><br><div class="spoiler">  <b class="spoiler_title">Idioma de aceita√ß√£o: en-US</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"Controllers-AccountController"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"AgeDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Age"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AgeRange"</span></span>: <span class="hljs-string"><span class="hljs-string">"18 - 150"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AgeRangeMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"{0} must be {1}"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"EmailDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Email"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"EmailPattern"</span></span>: <span class="hljs-string"><span class="hljs-string">"^[-\\w.]+@([A-z0-9][-A-z0-9]+\\.)+[Az]{2,4}$"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"EmailPatternMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"Incorrect email"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"EmailRequired"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"EmailRequiredMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"Email required"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"LanguageDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Language"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"LanguageValues"</span></span>: <span class="hljs-string"><span class="hljs-string">"ru-RU, en-US"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"LanguageValuesMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"Incorrect language. Possible: {1}"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"NameDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Name"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"NameLength"</span></span>: <span class="hljs-string"><span class="hljs-string">"2 - 50"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"NameLengthMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"Name length must be {1} characters"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordConfirmCompare"</span></span>: <span class="hljs-string"><span class="hljs-string">"Password"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordConfirmCompareMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"Passwords must be the same"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordConfirmDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Password confirmation"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Password"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordMaxLength"</span></span>: <span class="hljs-string"><span class="hljs-string">"100"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordMaxLengthMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"{0} can't be greater than {1} characters"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordMinLength"</span></span>: <span class="hljs-string"><span class="hljs-string">"8"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordMinLengthMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"{0} must be at least {1} characters"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordRequired"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordRequiredMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"Password required"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"RegisteredMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"{0}, you've been registered!"</span></span> } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Idioma de aceita√ß√£o: en-RU</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"Controllers-AccountController"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"AgeDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AgeRange"</span></span>: <span class="hljs-string"><span class="hljs-string">"18 - 150"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AgeRangeMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"{0}     {1}"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"EmailDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">" . "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"EmailPattern"</span></span>: <span class="hljs-string"><span class="hljs-string">"^[-\\w.]+@([A-z0-9][-A-z0-9]+\\.)+[Az]{2,4}$"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"EmailPatternMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"  . "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"EmailRequired"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"EmailRequiredMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"  . "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"LanguageDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"LanguageValues"</span></span>: <span class="hljs-string"><span class="hljs-string">"ru-RU, en-US"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"LanguageValuesMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">" .  : {1}"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"NameDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"NameLength"</span></span>: <span class="hljs-string"><span class="hljs-string">"2 - 50"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"NameLengthMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"    {1} "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordConfirmCompare"</span></span>: <span class="hljs-string"><span class="hljs-string">"Password"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordConfirmCompareMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"  "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordConfirmDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordDisplayName"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordMaxLength"</span></span>: <span class="hljs-string"><span class="hljs-string">"100"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordMaxLengthMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"{0}    {1} "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordMinLength"</span></span>: <span class="hljs-string"><span class="hljs-string">"6"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordMinLengthMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"{0}    {1} "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordRequired"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"PasswordRequiredMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"RegisteredMessage"</span></span>: <span class="hljs-string"><span class="hljs-string">"{0},  !"</span></span> } }</code> </pre> </div></div><br><p>  A √∫ltima coisa a fazer √© permitir solicita√ß√µes de origem cruzada para o cliente.  Para fazer isso, em Startup.ConfigureServices, adicione: </p><br><pre> <code class="cs hljs"> services.AddCors();</code> </pre> <br><p>  e em Startup.Configure, adicione: </p><br><pre> <code class="cs hljs"> app.UseCors(x =&gt; x .AllowAnyOrigin() .AllowAnyMethod() .AllowAnyHeader());</code> </pre> <br><h1 id="klientskaya-chast">  Parte do cliente </h1><br><p>  Eu prefiro ver todas as partes do aplicativo em um IDE, portanto, criarei um projeto de aplicativo cliente usando o modelo do Visual Studio: aplicativo b√°sico da Web Vue.js.  Se voc√™ n√£o o possui / n√£o deseja entupir o VS com esses modelos, use o vue cli, pois instalarei v√°rios pacotes antes: vuetify, axios, vue-i18n. </p><br><p>  Solicitamos os arquivos de recursos convertidos do LocaleController, indicando a cultura no cabe√ßalho Accept-Language, e colocamos a resposta nos arquivos en.json e ru.json no diret√≥rio locales. </p><br><p>  Em seguida, precisamos de um servi√ßo para analisar a resposta com erros do servidor. </p><br><div class="spoiler">  <b class="spoiler_title">errorHandler.service.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ErrorHandlerService = { parseResponseError (error) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error.toString().includes(<span class="hljs-string"><span class="hljs-string">'Network Error'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'ServerUnavailable'</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error.response) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> statusText = error.response.statusText; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error.response.data &amp;&amp; error.response.data.errors) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> message = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> property <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> error.response.data.errors) { error.response.data.errors[property].forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entry) { message += entry + <span class="hljs-string"><span class="hljs-string">'\n'</span></span> } }) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> message } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error.response.data &amp;&amp; error.response.data.message) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> error.response.data.message } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (statusText) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> statusText } } } }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { ErrorHandlerService }</code> </pre> </div></div><br><p>  O validador vee-validate embutido no Vutify.js requer que voc√™ especifique uma matriz de fun√ß√µes de valida√ß√£o com o atributo rules, solicitaremos a elas do servi√ßo para trabalhar com recursos. </p><br><div class="spoiler">  <b class="spoiler_title">locale.service.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> i18n <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../i18n'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> LocaleService = { getRules(resource, options) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> rules = []; options = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.prepareOptions(options); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addRequireRule(rules, resource, options); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addPatternRule(rules, resource, options); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addRangeRule(rules, resource, options); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addLengthRule(rules, resource, options); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addMaxLengthRule(rules, resource, options); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addMinLengthRule(rules, resource, options); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addValuesRule(rules, resource, options); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addCompareRule(rules, resource, options); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rules; }, prepareOptions(options){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> getter = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> v; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> compared = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!options){ options = { <span class="hljs-attr"><span class="hljs-attr">getter</span></span>: getter, <span class="hljs-attr"><span class="hljs-attr">compared</span></span>: compared }; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!options.getter) options.getter = getter; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!options.compared) options.compared = compared; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> options; }, addRequireRule(rules, resource, options){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> settings = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRuleSettings(resource, <span class="hljs-string"><span class="hljs-string">'Required'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(settings){ rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> !!options.getter(v) || settings.message); } }, addPatternRule(rules, resource, options){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> settings = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRuleSettings(resource, <span class="hljs-string"><span class="hljs-string">'Pattern'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(settings){ rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> !!options.getter(v) || settings.message); rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">RegExp</span></span>(settings.value).test(options.getter(v)) || settings.message); } }, addRangeRule(rules, resource, options){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> settings = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRuleSettings(resource, <span class="hljs-string"><span class="hljs-string">'Range'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(settings){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> values = settings.value.split(<span class="hljs-string"><span class="hljs-string">'-'</span></span>); rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> !!options.getter(v) || settings.message); rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(options.getter(v)) &gt;= values[<span class="hljs-number"><span class="hljs-number">0</span></span>] &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(options.getter(v)) &lt;= values[<span class="hljs-number"><span class="hljs-number">1</span></span>] || settings.message); } }, addLengthRule(rules, resource, options){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> settings = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRuleSettings(resource, <span class="hljs-string"><span class="hljs-string">'Length'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(settings){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> values = settings.value.split(<span class="hljs-string"><span class="hljs-string">'-'</span></span>); rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> !!options.getter(v) || settings.message); rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> options.getter(v).length &gt;= values[<span class="hljs-number"><span class="hljs-number">0</span></span>] &amp;&amp; options.getter(v).length &lt;= values[<span class="hljs-number"><span class="hljs-number">1</span></span>] || settings.message); } }, addMaxLengthRule(rules, resource, options){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> settings = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRuleSettings(resource, <span class="hljs-string"><span class="hljs-string">'MaxLength'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(settings){ rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> !!options.getter(v) || settings.message); rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> options.getter(v).length &lt;= settings.value || settings.message); } }, addMinLengthRule(rules, resource, options){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> settings = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRuleSettings(resource, <span class="hljs-string"><span class="hljs-string">'MinLength'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(settings){ rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> !!options.getter(v) || settings.message); rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> options.getter(v).length &gt;= settings.value || settings.message); } }, addValuesRule(rules, resource, options){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> settings = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRuleSettings(resource, <span class="hljs-string"><span class="hljs-string">'Values'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(settings) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> values = settings.value.split(<span class="hljs-string"><span class="hljs-string">','</span></span>); rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> !!options.getter(v) || settings.message); rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> !!values.find(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x.trim() === options.getter(v)) || settings.message); } }, addCompareRule(rules, resource, options){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> settings = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRuleSettings(resource, <span class="hljs-string"><span class="hljs-string">'Compare'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(settings) { rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> settings.value === <span class="hljs-string"><span class="hljs-string">''</span></span> || !!settings.value || settings.message }); rules.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> options.getter(v) === options.compared() || settings.message; }); } }, getRuleSettings(resource, rule){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> value = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRuleValue(resource, rule); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> message = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRuleMessage(resource, rule, value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value === <span class="hljs-string"><span class="hljs-string">''</span></span> || value ? { <span class="hljs-attr"><span class="hljs-attr">value</span></span>: value, <span class="hljs-attr"><span class="hljs-attr">message</span></span>: message } : <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }, getRuleValue(resource, rule){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> key =<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${resource}</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${rule}</span></span></span><span class="hljs-string">`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getI18nValue(key); }, getDisplayName(resource){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> key =<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${resource}</span></span></span><span class="hljs-string">DisplayName`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getI18nValue(key); }, getRuleMessage(resource, rule, value){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> key =<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${resource}</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${rule}</span></span></span><span class="hljs-string">Message`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i18n.t(key, [<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getDisplayName(resource), value]); }, getI18nValue(key){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> value = i18n.t(key); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value !== key ? value : <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { LocaleService }</code> </pre> </div></div><br><p>  N√£o faz sentido descrever completamente esse servi√ßo, pois  duplica parcialmente a classe ResxValidator.  Observo que, para verificar a regra Comparar, onde √© necess√°rio comparar o valor da propriedade atual com outra, o objeto de op√ß√µes √© passado, no qual o delegado √© comparado, que retorna o valor para compara√ß√£o. </p><br><p>  Assim, um campo de formul√°rio t√≠pico ter√° a seguinte apar√™ncia: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-text-field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"displayFor('Name')"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:rules</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rulesFor('Name')"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v-model</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"model.Name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">prepend-icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"mdi-account"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-text-field</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Para o r√≥tulo, a fun√ß√£o wrapper √© chamada em locale.service, que passa o nome completo do recurso, bem como o nome da propriedade para a qual voc√™ deseja obter o nome de exibi√ß√£o.  Da mesma forma para as regras.  O modelo v especifica um modelo para armazenar dados inseridos. <br>  Para a propriedade de confirma√ß√£o da senha, passe os valores da pr√≥pria senha no objeto de op√ß√µes: </p><br><pre> <code class="xml hljs">:rules="rulesFor('PasswordConfirm', { compared:() =&gt; model.Password })"</code> </pre> <br><p>  O v-select para sele√ß√£o de idioma possui uma lista predefinida de elementos (isso √© feito para simplificar o exemplo) e onChange √© um manipulador.  Porque  como fazemos SPA, queremos alterar a localiza√ß√£o quando o usu√°rio seleciona um idioma; portanto, na sele√ß√£o onChange, o idioma selecionado √© verificado e, se foi alterado, o c√≥digo de idioma da interface muda: </p><br><pre> <code class="javascript hljs"> onCultureChange (value) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> culture = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cultures.find(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x.value === value); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.model.Culture = culture.value; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (culture.locale !== <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$i18n.locale) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$i18n.locale = culture.locale; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$refs.form.resetValidation(); } }</code> </pre> <br><p>  Isso √© tudo, o reposit√≥rio com um aplicativo ativo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">est√° aqui</a> . </p><br><p>  <strong>Resumindo, gostaria de observar</strong> que seria √≥timo armazenar os recursos em um √∫nico formato JSON, que solicitamos ao LocaleController, a fim de desat√°-lo das especificidades da estrutura ASP.  No ResxValidatior, √© poss√≠vel adicionar suporte para extensibilidade e regras personalizadas em particular, al√©m de destacar c√≥digo id√™ntico ao locale.service e reescrev√™-lo no estilo JS para simplificar o suporte.  No entanto, neste exemplo, concentro-me na simplicidade. </p><p></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt473776/">https://habr.com/ru/post/pt473776/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt473764/index.html">Parcel √© meu construtor de projetos favorito</a></li>
<li><a href="../pt473766/index.html">An√°lise est√°tica de grandes volumes de c√≥digo Python: experi√™ncia no Instagram. Parte 1</a></li>
<li><a href="../pt473768/index.html">Os 5 melhores livros para quem deseja melhorar suas habilidades</a></li>
<li><a href="../pt473770/index.html">An√°lise est√°tica de grandes volumes de c√≥digo Python: experi√™ncia no Instagram. Parte 2</a></li>
<li><a href="../pt473774/index.html">Nuvem segura no DF Cloud</a></li>
<li><a href="../pt473778/index.html">Otimiza√ß√£o de imagem: como usar a vis√£o AI do Google para entender os princ√≠pios de classifica√ß√£o de imagens</a></li>
<li><a href="../pt473780/index.html">Detec√ß√£o r√°pida de contorno em v√≠deo 4K: cores e formas complexas</a></li>
<li><a href="../pt473784/index.html">Como escrever um contrato inteligente para o WebAssembly em uma rede Ontology? Parte 2: C ++</a></li>
<li><a href="../pt473786/index.html">As inscri√ß√µes para o hackathon em Riga est√£o terminando. Pr√™mio - treinamento de curta dura√ß√£o na PhysTech</a></li>
<li><a href="../pt473788/index.html">Microprote√≠nas descobrem aspectos desconhecidos da biologia moderna</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>