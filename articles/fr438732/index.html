<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🆖 👃🏿 🕷️ Mesures de radioamateur: analyse du signal du bus I2C 🖌️ 👩🏾‍🤝‍👨🏿 ⬅️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comme je l'ai mentionné à plusieurs reprises dans mes publications, les projets d'amateur sont financés par le budget familial et un radio-amateur ne ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mesures de radioamateur: analyse du signal du bus I2C</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438732/"><img src="https://habrastorage.org/getpro/habr/post_images/9d6/512/d5a/9d6512d5a8bbea73ff0cbdf18361c8d4.png"><br><br>  Comme je l'ai mentionné à plusieurs reprises dans mes publications, les projets d'amateur sont financés par le budget familial et un radio-amateur ne peut généralement pas se permettre d'acheter un équipement de mesure coûteux.  Nous devons nous contenter de ce que nous avons.  Ou le fait qu'il est possible de profiter de "pendant un certain temps".  Et parfois à cause du désespoir, le radio-amateur doit «percer avec une scie et scier avec un vrille». <br><br>  Récemment, j'ai ressenti le besoin de savoir ce qui est réellement transmis dans l'appareil que je développe sur le bus I2C.  Ce fut ce moment heureux où vous pouviez vous permettre de «scier avec une scie». <br><a name="habracut"></a><br>  Vous pouvez découvrir comment les données sont échangées entre les appareils à l'aide du protocole I2C <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Pour analyser les signaux sur le bus I2C, vous pouvez utiliser à la fois un oscilloscope numérique à deux canaux avec mémoire et un analyseur logique. <br><br><h1>  Oscilloscope numérique double canal avec mémoire </h1><br>  Lorsque vous travaillez avec des équipements électroniques, l'oscilloscope est l'outil le plus polyvalent.  Les oscilloscopes numériques modernes ont un certain nombre de propriétés utiles qui permettent, entre autres, d'analyser les signaux du bus I2C. <br><br>  Dans ce cas, j'ai obtenu un oscilloscope numérique à deux canaux «pendant un certain temps» avec de la mémoire Rigol DS1102 (le prix sur le site Web du fabricant est de 461 $).  Cet appareil dispose de deux canaux de mesure avec une bande passante allant jusqu'à 100 MHz et une fréquence d'échantillonnage du signal de 1 GSa / s. <br><br>  CH1 était connecté au signal SCL.  CH2 était connecté au signal SDA.  Pour les deux canaux, une échelle de 1,00 V / div a été définie.  Échelle de balayage - 10 us / div.  Pour plus de clarté, le faisceau du premier canal est décalé vers la moitié supérieure de l'écran et le faisceau du deuxième canal vers le bas. <br><br>  Dans le menu Trigger, l'oscilloscope a été configuré pour une seule mesure avec le déclencheur en atteignant le front montant dans le canal CH1 de niveau 1,00 V: <br><br><img src="https://habrastorage.org/webt/w5/rh/6f/w5rh6fc6t7ylim2soe16el1y-su.jpeg"><br><br>  Après avoir allumé l'équipement testé, le gros bouton rouge Marche / Arrêt a été enfoncé.  L'oscilloscope est passé en mode veille, puis a démarré.  Au bout de quelques secondes, l'enregistrement a été arrêté manuellement. <br><br>  La forme d'onde obtenue a été enregistrée sur un support externe écran par écran: <br><br><img src="https://habrastorage.org/webt/jj/w-/uj/jjw-uj7azfuajleysvkjytbkqza.png"><br><br>  Analysons les signaux enregistrés.  Sur le premier écran, nous voyons un affichage des paramètres de l'appareil et un oscillogramme des signaux SCL (partie supérieure) et SDA (partie inférieure de l'écran), sur lesquels nous lisons de gauche à droite: <br><br><ul><li>  <b>Signal START</b> : le maître règle d'abord le niveau bas sur le bus SDA puis sur le bus SCL; </li><li>  <b>Adresse 7 bits</b> : lire 0x60 (1100000) sur le bus SDA le long des bords avant de la SCL; </li><li>  <b>signe du mode d'enregistrement</b> : on lit sur le bus SDA un niveau bas sur le bord d'attaque suivant du SCL; </li><li>  <b>Signal ACK</b> : après avoir transféré l'octet, le dispositif maître commute pour recevoir via le bus SDA, le SDA est réglé haut, le dispositif esclave définit le niveau bas sur le front descendant du SCL (en fait, le signal ACK), que le maître lit sur le front montant du SCL; </li><li>  <b>Signal STOP</b> : le maître passe au niveau haut sur le bus SCL puis sur le bus SDA </li></ul><br>  De même, lentement mais sûrement, vous pouvez décrypter manuellement le reste de l'enregistrement. <br><br><h1>  Analyseur logique de signal numérique </h1><br>  Le protocole peut être décrypté à l'aide d'une méthode plus simple utilisant un analyseur logique et un logiciel approprié. <br><br>  Pour une utilisation comme analyseur logique, j'ai été aimablement fourni par des collègues de Saleae Logic 8 (le prix sur le site Web du fabricant est de 399 $).  Le logiciel utilisé était la démo Saleae Logic 1.2.18 tirée du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site officiel</a> .  Lors de l'installation de ce logiciel, j'ai accepté un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">accord de licence</a> avec la condition, y compris, de ne pas utiliser ce logiciel avec un équipement tiers. <br><br>  Le programme comprenait un analyseur de protocole I2C.  CH0 a été attribué pour SCL et CH1 pour SDA.  Taux d'échantillonnage du signal 24 MSa / s. <br><br><img src="https://habrastorage.org/webt/pj/fx/jm/pjfxjmkkdap8oto_qytml1pwuco.png"><br><br>  Le lancement a été configuré sur le front "leader" de CH0.  Le format hexadécimal a été sélectionné pour afficher les données. <br><br><img src="https://habrastorage.org/webt/g3/dq/kk/g3dqkkhyebti856uuvvri6qb1iw.png"><br><br>  Après avoir allumé l'équipement sous test, un grand bouton vert de démarrage a été enfoncé, et après quelques secondes, un graphique est apparu à l'écran: <br><br><img src="https://habrastorage.org/webt/hj/ud/wi/hjudwij6fp19tjsbila6ryky11o.png"><br><br>  Je vois l'avantage maximal d'utiliser un analyseur logique dans la mesure où le programme lui-même déchiffre les données reçues.  Les résultats du déchiffrement sont entrés ligne par ligne dans la fenêtre Protocoles décodés.  Lorsque vous sélectionnez une ligne de données dans la fenêtre, le programme affiche l'emplacement de ces données sur le graphique. <br><br><h1>  Oscilloscope numérique vs analyseur logique </h1><br>  Pour comparer les options, j'ai «collé» quatre captures d'écran de l'écran de l'oscilloscope et un fragment du diagramme de l'analyseur logique dans l'éditeur graphique: <br><br><img src="https://habrastorage.org/webt/go/y8/-k/goy8-kswvkuwhlpepxz2bcp-s8u.png"><br><br>  Le début est indiqué par un cercle vert, l'arrêt est indiqué par un cercle rouge.  Le diagramme vérifie d'abord la présence d'un périphérique avec l'adresse 0x60 sur le bus, puis écrit 0x80 dans le registre 0xB7 de ce périphérique. <br><br>  Si nous abordons la comparaison des options «avec biais», nous pouvons voir que sur le diagramme de l'analyseur logique (fréquence d'échantillonnage 24 MSa / s) il y a une «gigue» du signal SCL, qui n'est pas présente, en tant que telle, sur l'oscillogramme avec une fréquence d'échantillonnage de 1 GSa / s.  Le reste de l'image est le même et l'analyseur logique déchiffre également correctement les données en mode automatique. <br><br>  Lors du choix de "soit-ou" dans le "résidu sec", nous avons, dans le cas d'un oscilloscope, un appareil universel coûteux qui n'est pas aussi pratique pour analyser un bus qu'un analyseur logique, mais pour un prix comparable.  Dans ces conditions, personnellement, en tant qu'ingénieur de la «vieille école», j'aurais acquis un oscilloscope numérique. <br><br>  Cependant, s'il existait un logiciel avec un accord de licence permettant l'utilisation de clones bon marché d'analyseurs logiques populaires, tels que Saleae Logic 8 ou DSLogic Plus ... <br><br><h1>  Et de tels logiciels existent </h1><br>  Les clones bon marché des analyseurs logiques populaires, et pas seulement, sont pris en charge par le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">logiciel</a> open source du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">projet sigrok</a> . <br><br>  Le lieu de travail a été collecté: <br><br><img src="https://habrastorage.org/webt/jv/b7/ui/jvb7uib7vtfwnq7h4z0_gpkc-xm.jpeg"><br><br>  Commence alors la «danse avec un tambourin».  Sur Windows 10, seule la version 32 bits de PulseView a été lancée.  Elle n'a pas déterminé la présence d'un clone chinois bon marché Saleae Logic dans le système (le prix sur le site Web du vendeur est de 7 $). <br><br>  Après cela, les pilotes WinUSB ont été installés dans Zadig pour le périphérique <b>Logic</b> , et après une nouvelle numérisation, il a été défini dans Zadig comme le périphérique <b>fx2latw</b> : <br><br><img src="https://habrastorage.org/webt/lx/t5/1c/lxt51c1hie09kwg5gxcco8uf8ay.png"><br><br>  Après cela, les pilotes WinUSB ont été à nouveau installés pour le périphérique <b>fx2latw</b> dans Zadig, et seulement après que PulseView a vu le périphérique Saleae Logic dans la liste.  L'appareil est connecté. <br><br>  Après avoir connecté l'appareil, les réglages de programme suivants ont été effectués (de gauche à droite sur la barre d'outils, en commençant par l'inscription "Saleae Logic"): <br><br><ul><li>  Le taux de capture pré-déclenchement = 2% est défini en appuyant sur un bouton avec une clé et un tournevis; </li><li>  les entrées supplémentaires sont désactivées en appuyant sur un bouton avec une sonde rouge; </li><li>  régler le volume d'enregistrement de 100 K échantillons; </li><li>  régler la fréquence d'échantillonnage à 24 MHz; </li><li>  L'analyseur de protocole I2C est activé en appuyant sur un bouton avec une icône jaune-verte. </li></ul><br>  Plus loin dans le panneau à gauche des canaux: <br><br><ul><li>  les canaux reçoivent des étiquettes de texte correspondant aux signaux; </li><li>  condition de déclenchement affectée au front montant du signal SDA; </li><li>  Les signaux I2C se voient attribuer des canaux correspondants. </li></ul><br>  Après avoir allumé l'équipement testé, le bouton Run a été enfoncé.  Le résultat est déjà familier: <br><br><img src="https://habrastorage.org/webt/k-/66/xd/k-66xd9p6bqrbfd6efb57rift58.png"><br><br>  Il semble que «danser avec un tambourin» en valait la peine! <br><br>  <b>UPD</b> : Après avoir installé manuellement le pilote <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">libusb-win32</a> dans le gestionnaire de périphériques pour le périphérique USB <b>Logic</b> , le programme PulseView a commencé à détecter de manière stable la présence de Saleae Logic dans le système sans manipuler Zadig. <br><br><h4>  Brèves conclusions: </h4><br>  L'article décrit la méthodologie d'analyse des signaux de bus I2C à l'aide d'un oscilloscope numérique avec mémoire et des analyseurs logiques avec des progiciels d'application. <br><br>  Une méthode universelle d'analyse du signal, mais pas bon marché et lente, est l'utilisation d'un oscilloscope numérique avec mémoire. <br><br>  Une méthode rapide et budgétaire d'analyse du signal, mais avec une tâche non triviale de connexion de l'équipement, est l'utilisation d'un clone peu coûteux d'un analyseur logique en conjonction avec PulseView. <br><br>  Je serais heureux si ma publication aidait les lecteurs à gagner du temps et de l'argent. <br><br>  Dans la prochaine publication, je vais vous expliquer comment j'ai mesuré la fréquence à laquelle le résonateur à quartz a démarré dans le synthétiseur de fréquence, sans fréquencemètre.  Mais c'est une autre histoire ... </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr438732/">https://habr.com/ru/post/fr438732/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr438714/index.html">Présentation de Veeam Backup & Replication 9.5 Update 4</a></li>
<li><a href="../fr438716/index.html">Utilisation de graphiques pour résoudre des systèmes clairsemés d'équations linéaires</a></li>
<li><a href="../fr438718/index.html">Le rouge est plus frais que le bleu: hiérarchie des couleurs entre les cultures</a></li>
<li><a href="../fr438726/index.html">Y Combinator: comment fermer une entreprise</a></li>
<li><a href="../fr438730/index.html">HomoLudens: Joyeux anniversaire, Sid Meyer (+ tous les articles en russe)</a></li>
<li><a href="../fr438734/index.html">Enchevêtrement de personnes partageant les mêmes idées</a></li>
<li><a href="../fr438736/index.html">DevDay for Managers: gérer l'informatique</a></li>
<li><a href="../fr438740/index.html">Gérer les secrets avec HashiCorp Vault</a></li>
<li><a href="../fr438746/index.html">En route vers les principes physiques de l'évolution biologique. Continuation</a></li>
<li><a href="../fr438748/index.html">L'infrastructure comme code, nous gagnons à l'échelle (Kirill Vetchinkin, TYME)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>