<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>โญ๏ธ ๐ ๐๐ฟ STM32F4 ููุญุฉ ุงูุชุตุญูุญ ูู ุดูู Raspberry Pi Factor ๐ ๐ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุณุงุก ุงูุฎูุฑ ุนุฒูุฒู ุงูุฎุจุฑูููุช! ุฃุฑูุฏ ุฃู ุฃุนุฑุถ ูุดุฑูุนู ููุฌูููุฑ - ููุญุฉ ุชุตุญูุญ ุตุบูุฑุฉ ุชุณุชูุฏ ุฅูู STM32 ุ ูููู ูู ุดูู Raspberry Pi. ูุฎุชูู ุนู ููุญุงุช ุงูุชุตุญูุญ ุงูุฃุฎุฑู ู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>STM32F4 ููุญุฉ ุงูุชุตุญูุญ ูู ุดูู Raspberry Pi Factor</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413101/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/m_/xs/9t/m_xs9tnnhio8gxliqrjhdj3zxxw.jpeg" alt="ุงูุตูุฑุฉ" align="left">  ูุณุงุก ุงูุฎูุฑ ุนุฒูุฒู ุงูุฎุจุฑูููุช!  ุฃุฑูุฏ ุฃู ุฃุนุฑุถ ูุดุฑูุนู ููุฌูููุฑ - ููุญุฉ ุชุตุญูุญ ุตุบูุฑุฉ ุชุณุชูุฏ ุฅูู STM32 ุ ูููู ูู ุดูู Raspberry Pi.  ูุฎุชูู ุนู ููุญุงุช ุงูุชุตุญูุญ ุงูุฃุฎุฑู ูู ุฃูู ูุญุชูู ุนูู ููุฏุณุฉ ูุชูุงููุฉ ูุน ุญุงูุงุช Raspberry Pi ููุญุฏุฉ ESP8266 ูููุฏู ูุงุณููู.  ููุฐูู ุฅุถุงูุงุช ูุทููุฉ ุนูู ุดูู ููุตู ูุจุทุงูุฉ micro-SD ูููุจุฑ ุตูุช ุณุชูุฑูู.  ููุงุณุชูุงุฏุฉ ูู ูู ูุฐู ุงูุซุฑูุฉ ุ ููุช ุจุชุทููุฑ ููุชุจุฉ ุนุงููุฉ ุงููุณุชูู ูุจุฑูุงูุฌ ุชุฌุฑูุจู (ูู C ++ 11).  ูู ุงูููุงูุฉ ุ ุฃุฑูุฏ ุฃู ุฃุตู ุจุงูุชูุตูู ูู ูู ุงูุฃุฌุฒุงุก ุงููุงุฏูุฉ ูุงูุจุฑูุฌูุงุช ููุฐุง ุงููุดุฑูุน. </p><a name="habracut"></a><br><p style=";text-align:right;direction:rtl">  ูู ููููู ุงูุงุณุชูุงุฏุฉ ูู ูุฐุง ุงููุดุฑูุนุ  ุฑุจูุง ุ ููุท ูุฃููุฆู ุงูุฐูู ูุฑูุฏูู ูุญุงู ูุฐู ุงูููุญุฉ ุจููุณู ุ ูุฃููู ูุง ุฃููุฑ ูู ุฃู ุฎูุงุฑุงุช ุญุชู ููุฅูุชุงุฌ ุนูู ูุทุงู ุตุบูุฑ.  ูุฐู ููุงูุฉ ุฎุงูุตุฉ.  ูู ุฑุฃูู ุ ูุบุทู ุงููุฌูุณ ูุฌููุนุฉ ูุงุณุนุฉ ุฅูู ุญุฏ ูุง ูู ุงูููุงู ุงูุชู ูุฏ ุชูุดุฃ ูู ุฅุทุงุฑ ุงูุญุฑู ุงูููุฒููุฉ ุงูุตุบูุฑุฉ ุจุงุณุชุฎุฏุงู WiFi ูุงูุตูุช. </p><br><p style=";text-align:right;direction:rtl">  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ุณุฃุญุงูู ุงูุฅุฌุงุจุฉ ุนูู ุงูุณุคุงู ููุงุฐุง ูุฐุง ููู.  ุงูุฏูุงูุน ุงูุฑุฆูุณูุฉ ููุฐุง ุงููุดุฑูุน ูู ููุง ููู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุฑุฌุน ุงุฎุชูุงุฑ ููุตุฉ STM32 ุฅูู ุงุนุชุจุงุฑุงุช ุฌูุงููุฉ ุจุญุชุฉ - ุฃุญุจ ูุณุจุฉ ุงูุณุนุฑ / ุงูุฃุฏุงุก ุ ุจุงูุฅุถุงูุฉ ุฅูู ูุฌููุนุฉ ูุจูุฑุฉ ูู ุงูุฃุฌูุฒุฉ ุงูุทุฑููุฉ ุ ุจุงูุฅุถุงูุฉ ุฅูู ุจูุฆุฉ ุชุทููุฑ ูุจูุฑุฉ ููุฑูุญุฉ ูู ุงูุดุฑูุฉ ุงููุตูุนุฉ ููุชุญูู (sw4stm ุ cubeMX ุ ููุชุจุฉ HAL). </li><li style=";text-align:right;direction:rtl">  ุจุงูุทุจุน ุ ููุงู ุงูุนุฏูุฏ ูู ููุญุงุช ุงูุชุตุญูุญ ูู ุงูุดุฑูุฉ ุงููุตูุนุฉ ููุญุฏุฉ ุงูุชุญูู ููุณูุง (Discovery ุ Nucleo) ุ ููุฐูู ูู ุงูุดุฑูุงุช ุงููุตูุนุฉ ูุฌูุงุช ุฎุงุฑุฌูุฉ (ุนูู ุณุจูู ุงููุซุงู ุ Olimex).  ููู ุชูุฑุงุฑ ุงูุนุฏูุฏ ูููู ูู ุงูููุฒู ูู ุดูููู ููุซู ูุดููุฉ ุจุงููุณุจุฉ ูู ุนูู ุงูุฃูู.  ูู ุฅุตุฏุงุฑู ุ ูุฏููุง ุทูุจูููุฌูุง ุจุณูุทุฉ ููููุฉ ูู ุทุจูุชูู ูููููุงุช ููุงุฆูุฉ ููุญุงู ุงููุฏูู. </li><li style=";text-align:right;direction:rtl">  ูุฃุฌูุฒุชูู ุ ุฃุฑูุฏ ุฃู ูููู ูุฏู ุญุงูุงุช ูุงุฆูุฉ ูู ุฃุฌู ุฅุฎูุงุก ุงูุฌูุฏุฉ ุงูููุฎูุถุฉ ููุฅููุชุฑูููุงุช ุจุงูุฏุงุฎู.  ููุงู ุนูู ุงูุฃูู ูุธุงูุงู ุฃุณุงุณูุงู ุดุงุฆุนุงู ููุฌุฏ ุจููุง ุนุฏุฏ ูุจูุฑ ูู ุงูุญุงูุงุช ุงูุฃูุซุฑ ุชููุนูุง: Arduino ู Raspberry Pi.  ุจุฏุง ูู ุงูุซุงูู ูููู ุฃูุซุฑ ููุงุกูุฉ ูู ุญูุซ ูููุน ุงูููุงุทุน ููููุตูุงุช.  ูุฐูู ุ ููุชุจุฑุน ูููุฏุณุฉ ุงูููุญุฉ ุ ุงุฎุชุฑุช ุฐูู. </li><li style=";text-align:right;direction:rtl">  ูุญุฏุฉ ุงูุชุญูู ุงูุชู ุงุฎุชุฑุชูุง ุนูู ูุชู ุงูุทุงุฆุฑุฉ ูุฒูุฏุฉ ุจุดุจูุฉ USB ู SDIO ู I2S.  ูู ูุงุญูุฉ ุฃุฎุฑู ุ ูุฅู ูุฐู ุงููุงุฌูุงุช ููุณูุง ูููุฏุฉ ุฃูุถูุง ูููุตุฉ ุงูููุงูุงุช ุงูููุฒููุฉ.  ููุฐุง ุงูุณุจุจ ุ ุจุงูุฅุถุงูุฉ ุฅูู ูุญุฏุฉ ุงูุชุญูู ุฐุงุช ุงูุฑุจุท ุงูููุงุณู ุ ุฃุถูุช ููุตู USB ูุจุทุงูุฉ SD ููุณุงุฑ ุตูุชู (ูุญูู ุฑููู ุฅูู ุชูุงุธุฑู ููุถุฎู) ุ ุจุงูุฅุถุงูุฉ ุฅูู ูุญุฏุฉ ูุงุณูููุฉ ุชุนุชูุฏ ุนูู ESP8266. </li></ul><br><h2 id="shema-i-komponenty" style=";text-align:right;direction:rtl">  ุงูุฏุงุฆุฑุฉ ูุงูููููุงุช </h2><br><p style=";text-align:right;direction:rtl">  ูุจุฏู ูู ุฃู ููุญุฉ ุฌูููุฉ ุฐุงุช ุงูุฎุตุงุฆุต ูุงูููููุงุช ุงูุชุงููุฉ ูุฏ ุธูุฑุช: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุญุฏุฉ ุชุญูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">STM32F405RG</a> : ARM 32 ุจุช Cortex-M4 ูุน ูุนุงูุฌ ุฑูุงุถู ุ ุชุฑุฏุฏ ูุตู ุฅูู 168 ููุฌุงูุฑุชุฒ ุ ุฐุงูุฑุฉ ููุงุด 1 ููุฌุงุจุงูุช ุ 196 ููููุจุงูุช ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู. <br><img src="https://habrastorage.org/webt/w1/je/fb/w1jefbi3tuwerk7nyio5awywiky.png" alt="ุฏุจุงุจูุณ ุชุญูู ูุณุชุนููุฉ"><br><img src="https://habrastorage.org/webt/-a/ta/sr/-atasrnz4pajsqagowftqvzok5q.png" alt="ุฑุจุท ุฌูุงุฒ ุงูุชุญูู"></li><li style=";text-align:right;direction:rtl">  ููุตู SWD ูุจุฑูุฌุฉ ูุญุฏุฉ ุงูุชุญูู (6 ุฏุจุงุจูุณ). </li><li style=";text-align:right;direction:rtl">  ุฒุฑ ุฅุนุงุฏุฉ ุงูุชุดุบูู ูุฅุนุงุฏุฉ ุงูุชุดุบูู. </li><li style=";text-align:right;direction:rtl">  LED ุซูุงุซู ุงูุฃููุงู.  ูู ูุงุญูุฉ ุ ูุชู ููุฏุงู ุซูุงุซุฉ ุฏุจุงุจูุณ ุชุญูู.  ูู ูุงุญูุฉ ุฃุฎุฑู ุ ุณุชุธู ููููุฏุฉ ุจุณุจุจ ุฌูุงุช ุงูุงุชุตุงู ุงููุญุฏูุฏุฉ ุนูู ููุตูุงุช GPIO ุ ููุชุตุญูุญ ูุซู ูุฐุง LED ุ ูุฅู ุงูุดูุก ูููุฏ ุฌุฏูุง. </li><li style=";text-align:right;direction:rtl">  ููุงุฑุชุฒ HSE ุนุงูู ุงูุชุฑุฏุฏ (16 ููุฌุงูุฑุชุฒ ููุณุงุนุฉ ุงูุฃุณุงุณูุฉ) ู LSE ุจุชุฑุฏุฏ ููุฎูุถ (32.7680 ูููููุฑุชุฒ ููุณุงุนุฉ ูู ุงูููุช ุงููุนูู). </li><li style=";text-align:right;direction:rtl">  ุชุชูุงูู ุฏุจุงุจูุณ GPIO ูุน ุฎุทูุฉ 2.54 ูู ูุน ุทุฑุงุฒุงุช ููุญุฉ ุงูููุญ. </li><li style=";text-align:right;direction:rtl">  ุจุฏูุงู ูู ููุจุณ ุงูุตูุช 3.5 ูู ูู Raspberry Pi ุ ููุช ุจูุถุน ููุตู ุงูุทุงูุฉ 5 ูููุช.  ูููููุฉ ุงูุฃููู ุ ุงููุฑุงุฑ ูุซูุฑ ููุฌุฏู.  ูููู ููุงู ุฅูุฌุงุจูุงุช.  ุงูุทุงูุฉ ูู ููุตู USB ููุฌูุฏุฉ ุงุฎุชูุงุฑููุง (ุงูุชูุงุตูู ุฃุฏูุงู) ุ ูููู ูุฐุง ุฎูุงุฑ ุณูุฆ ูุชุตุญูุญ ุงูุฃุฎุทุงุก ูู ุงูุฏุงุฆุฑุฉ ุ ูุฃู ุงูููุช ูุจู ุญุฑู ูููุฐ USB ููููุจููุชุฑ ูู ูุฐู ุงูุญุงูุฉ ูุฏ ูููู ูุตูุฑูุง ุฌุฏูุง. </li></ul><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/0s/qk/mk/0sqkmkrm5j1lt5bhkaiftrpz-y8.png" alt="ุฏุงุฆุฑุฉ ุงูุทุงูุฉ"></p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูููุฐ USB ุตุบูุฑ  ูู ูุงุญูุฉ ุ ูุชู ุชูุตููู ุนุจุฑ ุดุฑูุญุฉ ุงูุญูุงูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">STF203-22.TCT</a> ุจูููุฐ USB-OTG ุงูุฎุงุต <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุจูุญุฏุฉ</a> ุงูุชุญูู.  ูู ูุงุญูุฉ ุฃุฎุฑู ุ ูุชู ุชูุตูู ุฏุจูุณ ุงูุทุงูุฉ VBUS ุจููุตู GPIO.  ุฅุฐุง ููุช ุจุชูุตููู ุจุฏุจูุณ + 5 ูููุช ุ ูุณูุชู ุชุดุบูู ุงูููุญุฉ ูู ูููุฐ USB. </li></ul><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/4q/te/om/4qteom17ikstddtnjafa78pqpme.png" alt="ุฏุงุฆุฑุฉ USB"></p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุตู ูุจุทุงูุฉ ุฐุงูุฑุฉ micro-SD ุจุญุฒุงู: 47 ูููู ุฃูู ููุงููุงุช ุณุญุจ ุ ุชุฑุงูุฒุณุชูุฑ ุฅุฏุงุฑุฉ ุงูุทุงูุฉ ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">P-channel MOSFET BSH205</a> ) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุตุจุงุญ</a> ุฃุฎุถุฑ ุตุบูุฑ ุนูู ุฎุท ุงูุทุงูุฉ. </li></ul><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/qb/3x/el/qb3xelfstpguacjkqhnss45nlxk.png" alt="ูุฎุทุท ุจุทุงูุฉ Micro SD"></p><br><p style=";text-align:right;direction:rtl">  ูุชู ุชูุตูู ุจูุงุจุฉ ุงูุชุฑุงูุฒุณุชูุฑ ุจุฏุจูุณ PA15 ููุญุฏุฉ ุงูุชุญูู.  ูุฐุง ูู ุงุชุตุงู ุงููุธุงู ููุญุฏุฉ ุชุญูู JTDI ุ ููู ุฃูุฑ ูุซูุฑ ููุงูุชูุงู ูู ุฃูู ูู ุงููุถุน ุงูุฃููู ูุชู ุชููููู ููุงุชุฌ ุจูุณุชูู ุนุงูู (ุณุญุจ) ููุฌูุฏ.  ูุธุฑูุง ูุงุณุชุฎุฏุงู SWD ุจุฏูุงู ูู JTAG ููุจุฑูุฌุฉ ุ ุชุธู ุฌูุฉ ุงูุงุชุตุงู ูุฐู ูุฌุงููุฉ ููููู ุงุณุชุฎุฏุงููุง ูุฃุบุฑุงุถ ุฃุฎุฑู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุงูุชุญูู ูู ุงูุชุฑุงูุฒุณุชูุฑ.  ูุฐุง ูุฑูุญ - ุนูุฏูุง ูุชู ุชุทุจูู ุงูุทุงูุฉ ุนูู ุงูููุญุฉ ุ ูุชู ุฅูุบุงุก ุชูุดูุท ุจุทุงูุฉ ุงูุฐุงูุฑุฉ ุ ูุชูููููุง ุ ุชุญุชุงุฌ ุฅูู ุชุทุจูู ูุณุชูู ููุฎูุถ ูุชุซุจูุช ุฏุจูุณ PA15. </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุญูู ุฑููู ุฅูู ุชูุซููู ูุนุชูุฏ ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">UDA1334</a> .  ูุง ุชุญุชุงุฌ ูุฐู ุงูุดุฑูุญุฉ ุฅูู ุฅุดุงุฑุฉ ุณุงุนุฉ ุฎุงุฑุฌูุฉ ุ ููุง ูุณูู ุงุณุชุฎุฏุงููุง.  ูุชู ุฅุฑุณุงู ุงูุจูุงูุงุช ุนุจุฑ ูุงูู I2S.  ูู ูุงุญูุฉ ุฃุฎุฑู ุ ุชูุตู ูุฑูุฉ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู ูุง ูุตู ุฅูู 5 ููุซูุงุช ูุทุจูุฉ ุนูุฏ 47 ุฏุฑุฌุฉ ููุฑููุงูุช.  ุงูุญุฌู ููู ูู ูุฐู ุงูุญุงูุฉ.  ุฃุตุบุฑูุง ุงูุชู ุชู ุดุฑุงุคูุง ูู ุงูุชูุชุงููู ุจุญุฌู 1411 ุ ููู ููุณุช ุฑุฎูุตุฉ ุญุชู.  ููุน ุฐูู ุ ุณุฃูุชุจ ุนู ุงูุณุนุฑ ุจูุฒูุฏ ูู ุงูุชูุงุตูู ุฃุฏูุงู.  ุจุงููุณุจุฉ ููุทุงูุฉ ุงูุชูุงุธุฑูุฉ ุ ูุชู ุงุณุชุฎุฏุงู ุงููุซุจุช ุงูุฎุทู ุงูุฎุงุต ุจู ุ ููุชู ุชุดุบูู / ุฅููุงู ุทุงูุฉ ุงูุฌุฒุก ุงูุฑููู ุจูุงุณุทุฉ ุชุฑุงูุฒุณุชูุฑ ูุฒุฏูุฌ. </li></ul><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/4f/rh/ea/4frheacnbm39nin0t79ubdatfy8.png" alt="ุฏุงุฑุฉ DAC"></p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุถุฎู ุซูุงุฆู ุงูููุงุฉ ูุนุชูุฏ ุนูู ุดุฑูุญุชูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">31AP2005</a> .  ููุฒุชูุง ุงูุฑุฆูุณูุฉ ูู ุนุฏุฏ ุตุบูุฑ ูู ููููุงุช ุงูุฑุจุท (ููุท ูุฑุดุญุงุช ุงูุทุงูุฉ ูููุชุฑ ุงูุฅุฏุฎุงู).  ุฎุฑุฌ ุงูุตูุช - 4 ููุตุงุช ูุน ุฎุทูุฉ 2.54 ููู.  ุจุงููุณุจุฉ ูู ุ ูู ุฃูุฑุฑ ุจุนุฏ ูุง ูู ุงูุฃูุถู - ูุซู ูุฐุง ุงูุฎูุงุฑ ุงููุคูุช ุฃู ุ ูุซู ุงูููููุงุช ุงูููุฌูุฏุฉ ูู ุงูุชูุช ุ 3.5 ููู.  ููุงุนุฏุฉ ุนุงูุฉ ุ ูุฑุชุจุท 3.5 ูู ุจุณูุงุนุงุช ุงูุฑุฃุณ ุ ูู ุญุงูุชูุง ูุชุญุฏุซ ุนู ุชูุตูู ููุจุฑุงุช ุงูุตูุช. </li></ul><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ke/ge/qa/kegeqak09asea0z1npbr7u9clyw.png" alt="ุฏุงุฑุฉ ููุจุฑ ููุตูุช"></p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงููุญุฏุฉ ุงูุฃุฎูุฑุฉ ูู ุดุงู ESP11 ูุน ุฑุจุท (ุทุงูุฉ ุ ููุจุณ ุจุฑูุฌุฉ) ูููุฏู WiFi.  ูุชู ุชูุตูู ุงุณุชูุชุงุฌุงุช ููุญุฉ UART ุจุฌูุงุฒ ุงูุชุญูู ูุฅุฎุฑุงุฌูุง ูู ุงูููุช ููุณู ุจููุตู ุฎุงุฑุฌู (ููุนูู ูุน ุงูููุญุฉ ูุจุงุดุฑุฉ ูู ุงููุญุทุฉ ูุงูุจุฑูุฌุฉ).  ููุฌุฏ ููุชุงุญ ุทุงูุฉ (ุฎุงุฑุฌู ุฃู ุชุญูู ุฏุงุฆู ูู ูุชุญูู).  ููุงู LED ุฅุถุงูู ููุฅุดุงุฑุฉ ุฅูู ุงูุทุงูุฉ ูููุตู "FLASH" ููุถุน ุงูููุญุฉ ูู ูุถุน ุงูุจุฑูุฌุฉ. </li></ul><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/3d/cq/1d/3dcq1dpb4u-iog9jbnix9icc1ac.png" alt="ุฏุงุฑุฉ ESP"></p><br><p style=";text-align:right;direction:rtl">  ุจุงูุทุจุน ุ ESP8266 ููุณูุง ูู ูุญุฏุฉ ุชุญูู ุฌูุฏุฉ ุ ููููุง ูุง ุชุฒุงู ุฃูู ูู STM32F4 ูู ูู ูู ุงูุฃุฏุงุก ูุงูุฃุฌูุฒุฉ ุงูุทุฑููุฉ.  ูุนู ุ ูุฃุดุงุฑ ุงูุญุฌู ูุน ุณุนุฑ ูุฐู ุงููุญุฏุฉ ุฅูู ุฃููุง ูุงูุช ูุญุฏุฉ ููุฏู ุงูุณูุงุจ ูุฃุฎูู ุงูุฃูุจุฑ.  ูุชู ุงูุชุญูู ูู ุงููุญุฏุฉ ุงูููุทูุฉ ุจูุงุณุทุฉ USRT ุจุงุณุชุฎุฏุงู ุจุฑูุชูููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">AT</a> ูุต. </p><br><p style=";text-align:right;direction:rtl">  ุฒูุฌุงู ูู ุงูุตูุฑ: <br> <a href=""><img src="https://habrastorage.org/webt/if/zv/di/ifzvdi77bc5vhkauczq8kwfa6mg.jpeg"></a> <br> <a href=""><img src="https://habrastorage.org/webt/dg/go/lz/dggolzrzpwxghtqnwtdyf_plogo.jpeg"></a> </p><br><h2 id="podgotovka-modulya-esp11" style=";text-align:right;direction:rtl">  ุชุญุถูุฑ ูุญุฏุฉ ESP11 </h2><br><p style=";text-align:right;direction:rtl">  ESP8266 ุดูุก ูุนุฑูู.  ุฃูุง ูุชุฃูุฏ ูู ุฃู ุงููุซูุฑูู ุนูู ุฏุฑุงูุฉ ุจูุง ุจุงููุนู ุ ูุฐูู ุณูููู ุงูุฏููู ุงูุชูุตููู ุบูุฑ ุถุฑูุฑู ููุง.  ูุธุฑูุง ููููุฒุงุช ุงูุชุฎุทูุทูุฉ ูุชูุตูู ูุญุฏุฉ ESP11 ุจุงูููุญุฉ ุ ุณุฃูุฏู ููุท ุฏููููุง ููุฌุฒูุง โโูุฃููุฆู ุงูุฐูู ูุฑุบุจูู ูู ุชุบููุฑ ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ ุงูุฎุงุตุฉ ุจูุง: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุณุฃุณุชุฎุฏู</a> ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">esptool</a> ููุนูู ูุน ESP.  ุจุฎูุงู ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ ุงูููุงุณูุฉ ูู ุงูุดุฑูุฉ ุงููุตูุนุฉ ุ ูุฅู esptool ูุณุชูู ุนู ุงููุธุงู ุงูุฃุณุงุณู. </li><li style=";text-align:right;direction:rtl">  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ูู ุจุชุดุบูู ูุถุน ุงูุทุงูุฉ ุงูุฎุงุฑุฌูุฉ ุจุงุณุชุฎุฏุงู ูุตูุฉ ุงููุฑูุฑ ESP-PWR (ูููู ุจุฅุบูุงู ุฌูุงุช ุงูุงุชุตุงู 1 ู 2) ุ ููู ุจุชูุตูู ุงููุญุฏุฉ ุจุงูููุจููุชุฑ ุนุจุฑ ุฃู ูุญูู USART-USB.  ูุชุตู ุงููุญูู ุจุฏุจุงุจูุณ GRD / RX / TD.  ูุญู ูุฒููุฏ ุงููุฌูุณ: <br> <a href=""><img src="https://habrastorage.org/webt/qk/sg/_u/qksg_updoacqtvh5a_bmczc_poe.jpeg"></a> </li><li style=";text-align:right;direction:rtl">  ูุชุฃูุฏ ูู ุฃู ูุธุงู ุงูุชุดุบูู ูุชุนุฑู ุนูู ุงููุญูู.  ูู ุงููุซุงู ุงูุฎุงุต ุจู ุ ุฃุณุชุฎุฏู ูุญูููุง ูุนุชูุฏ ุนูู FT232 ุ ูุฐุง ูุน ูุงุฆูุฉ ุงูุฃุฌูุฒุฉ ุ ูุฌุจ ุฃู ูููู ูุฑุฆููุง ูุซู FT232 Serial (UART) IC: <br><pre style=";text-align:right;direction:rtl"><code class="bash hljs">&gt; lsusb ... Bus 001 Device 010: ID 0483:3748 STMicroelectronics ST-LINK/V2 Bus 001 Device 009: ID 0403:6001 Future Technology Devices International, Ltd FT232 Serial (UART) IC ...</code> </pre> </li><li style=";text-align:right;direction:rtl">  ุชุฎุชูู ESP8266 ููุณูุง ูู ุญุฌู ุฐุงูุฑุฉ ุงูููุงุด.  ูู ุงูููุงุฑุณุฉ ุงูุนูููุฉ ุ ูู ููุณ ูุญุฏุฉ ESP11 ุ ูุงุฌูุช ููุงู ูู 512 ููููุจุงูุช (4 ููุฌุงุจุช) ู 1 ููุฌุงุจุงูุช (8 ููุฌุงุจุช).  ูุฐุง ูุฅู ุฃูู ุดูุก ูุฌุจ ุงูุชุญูู ููู ูู ููุฏุงุฑ ุงูุฐุงูุฑุฉ ูู ุงููุณุฎุฉ ุงููุณุชุฎุฏูุฉ ูู ุงููุญุฏุฉ.  ูู ุจุฅููุงู ุชุดุบูู ุงูุทุงูุฉ ูู ุงูููุญุฉ ุ ููุถุน ุงููุญุฏุฉ ูู ูุถุน ุงูุจุฑูุฌุฉ ุ ูุฅุบูุงู ุงูุทุงุฆุฑ "ููุงุด": </li></ul><br><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/dr/i8/8p/dri88pfduzkumw9u2_euqtz2_va.jpeg"></a> </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู ุจุชุดุบูู ุงูุทุงูุฉ ุ ูู ุจุชุดุบูู esptool ุจุงููุนููุงุช ุงูุชุงููุฉ </li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">&gt; esptool.py --port /dev/ttyUSB0 flash_id Connecting.... Detecting chip <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>... ESP8266 Chip is ESP8266EX Uploading stub... Running stub... Stub running... Manufacturer: e0 Device: 4014 Detected flash size: 1MB Hard resetting...</code> </pre> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชููุฏ esptool ุฃููุง ูู ูุฐู ุงูุญุงูุฉ ูุชุนุงูู ูุน ูุญุฏุฉ ุจุณุนุฉ 1 ููุฌุงุจุงูุช ูู ุงูุฐุงูุฑุฉ. </li><li style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ููุฅุตุฏุงุฑ ุงูุฐู ูุญุชูู ุนูู 1 ููุบุงุจุงูุช ุ ููููู ุงุณุชุฎุฏุงู ุฃุญุฏุซ ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ESP8266 AT Bin V1.6.1</a> .  ููููุง ููุณุช ููุงุณุจุฉ ููุฅุตุฏุงุฑ ุงูุฐู ูุญุชูู ุนูู 4 ููุบุงุจุช ุ ูุงูุฐู ุชุญุชุงุฌ ุฅูู ุงุณุชุฎุฏุงู ุดูุก ุฃูุฏู ููู ุ ุนูู ุณุจูู ุงููุซุงู ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฐุง</a> .  ูุชููู ุงูุจุฑูุงูุฌ ุงูุซุงุจุช ูู ุนุฏุฉ ูููุงุช ุ ูุดุงุฑ ุฅูู ุนูุงููู ุงูุจุฏุก ููู ููู ูู ุงููุซููุฉ ุงูุฑุณููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ESP8266 AT In Set Set</a> .  ุชูุณุชุฎุฏู ุนูุงููู ุงูุจุฏุก ูุฐู ููุนููุงุช ูุฃุฏุงุฉ esptool ุงููุณุงุนุฏุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ุจุงููุณุจุฉ ููุญุฏุฉ ููุทูุฉ ุจุณุนุฉ 1 ููุฌุงุจุงูุช ุ ุณุชุจุฏู ูุนููุงุช esptool ุนูู ูุฐุง ุงููุญู (ูุฌุจ ุฃููุงู ุงุณุชุฎุฑุงุฌ ุฌููุน ุงููููุงุช ุงูุถุฑูุฑูุฉ ูู ุฃุฑุดูู ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ ูุฌูุนูุง ูู ุฏููู ุงูุนูู) <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">&gt; esptool.py --port /dev/ttyUSB0 write_flash 0x00000 boot.bin 0x01000 user1.1024.new.2.bin 0x7E000 blank.bin 0xFB000 blank.bin 0xFC000 esp_init_data_default.bin 0xFE000 blank.bin</code> </pre> </li><li style=";text-align:right;direction:rtl">  ูุญู ูุฒูุฏ ุงูุทุงูุฉ ุจุงููุฌูุณ ููุดุบู esptool ุจุงููุนููุงุช ุงููุญุฏุฏุฉ. </li><li style=";text-align:right;direction:rtl">  ุจุนุฏ ุงูุงูุชูุงุก ูู ุงูุจุฑูุงูุฌ ุงููุตู ุ ูู ุจุฅููุงู ุชุดุบูู ุงูุทุงูุฉ ูู ุงูููุญุฉ ุ ุงูุชุญ ูุตูุฉ "FLASH" ุ ูู ุจุชุดุบูู ุงูุชุญูู ูู ุงูุทุงูุฉ ูู ูุญุฏุฉ ุงูุชุญูู ุงูุฏูููุฉ.  ุงููุญุฏุฉ ุฌุงูุฒุฉ ููุนูู. </li></ul><br><h2 id="programmnoe-obespechenie" style=";text-align:right;direction:rtl">  ุงูุจุฑูุฌูุงุช </h2><br><p style=";text-align:right;direction:rtl">  ููุงู ุจุฑูุงูุฌ ุงุฎุชุจุงุฑ ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฌูุซุจ</a> .  ุชููู ุจูุง ููู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุนุฑุถ ูุญุฏุฉ ุงูุชุญูู ุนูุฏ ุฃูุตู ุชุฑุฏุฏ (168 ููุฌุง ูุฑุชุฒ) </li><li style=";text-align:right;direction:rtl">  ููุดุท ุณุงุนุฉ ุงูููุช ุงูุญูููู </li><li style=";text-align:right;direction:rtl">  ููุดุท ุจุทุงูุฉ SD ูููุฑุฃ ุชูููู ุงูุดุจูุฉ ููู.  ูุชู ุงุณุชุฎุฏุงู ููุชุจุฉ FatFS ููุนูู ูุน ูุธุงู ุงููููุงุช. </li><li style=";text-align:right;direction:rtl">  ูุคุณุณ ุงุชุตุงูุงู ุจุดุจูุฉ WLAN ุงููุญุฏุฏุฉ </li><li style=";text-align:right;direction:rtl">  ูุชุตู ุจุฎุงุฏู NTP ุงููุญุฏุฏ ููุทูุจ ุงูููุช ุงูุญุงูู ููู.  ูููุฏ ุงูุณุงุนุฉ. </li><li style=";text-align:right;direction:rtl">  ูุฑุงูุจ ุญุงูุฉ ุงูุนุฏูุฏ ูู ุงูููุงูุฐ ุงููุญุฏุฏุฉ.  ุฅุฐุง ุชุบูุฑุช ุญุงูุชูู ุ ูุฑุณู ุฑุณุงูุฉ ูุตูุฉ ุฅูู ุฎุงุฏู TCP ุงููุญุฏุฏ. </li><li style=";text-align:right;direction:rtl">  ุนูุฏ ุงูููุฑ ุนูู ุงูุฒุฑ ุงูุฎุงุฑุฌู ุ ูุฅูู ููุฑุฃ ููู * .wav ุงููุญุฏุฏ ูู ุจุทุงูุฉ SD ููููู ุจุชุดุบููู ูู ูุถุน ุบูุฑ ูุชุฒุงูู (I2S ุจุงุณุชุฎุฏุงู ูุญุฏุฉ ุชุญูู DMA). </li><li style=";text-align:right;direction:rtl">  ูุชู ุชูููุฐ ุงูุนูู ุจุงุณุชุฎุฏุงู ESP11 ุฃูุถูุง ูู ุงููุถุน ุบูุฑ ุงููุชุฒุงูู (ุญุชู ุงูุขู ุจุฏูู DMA ุ ููุท ุนูู ุงูููุงุทุนุงุช) </li><li style=";text-align:right;direction:rtl">  ุชุณุฌูู ุงูุฏุฎูู ุนุจุฑ USART1 (ุฏุจุงุจูุณ PB6 / PB7) </li><li style=";text-align:right;direction:rtl">  ูุจุงูุทุจุน ูููุถ ูุคุดุฑ LED. </li></ul><br><p style=";text-align:right;direction:rtl">  ูู ุญุจุฑู ูุงู ููุงู ุงูุนุฏูุฏ ูู ุงูููุงูุงุช ุงููุฎุตุตุฉ ูุจุฑูุฌุฉ STM32 ุนูู ูุณุชูู ููุฎูุถ ุฅูู ุญุฏ ูุง (ููุท ูู ุฎูุงู ุฅุฏุงุฑุฉ ุงูุชุณุฌูู ุฃู CMSIS).  ุนูู ุณุจูู ุงููุซุงู ุ ูู ุงูุฃุฎูุฑ ูุณุจููุง: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงุญุฏ</a> ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงุซูุงู</a> ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุซูุงุซุฉ</a> .  ุงูููุงูุงุช ุ ุจุงูุทุจุน ุ ุฐุงุช ุฌูุฏุฉ ุนุงููุฉ ุฌุฏูุง ุ ููู ุฑุฃูู ุงูุดุฎุตู ูู ุฃูู ูู ุฃุฌู ุชุทููุฑ ููุชุฌ ููุฑุฉ ูุงุญุฏุฉ ุ ุฑุจูุง ูุจุฑุฑ ูุฐุง ุงูููุฌ ููุณู.  ูููู ุจุงููุณุจุฉ ููุดุฑูุน ููุงูุฉ ุทููู ุงูุฃุฌู ุ ุนูุฏูุง ุชุฑูุฏ ุฃู ูููู ูู ุดูุก ุฌููููุง ููุงุจูุงู ููุชูุณูุน ุ ูุฅู ูุฐุง ุงูููุฌ ููุฎูุถ ููุบุงูุฉ.  ุฃุญุฏ ุฃุณุจุงุจ ุดุนุจูุฉ Arduino ูููุตุฉ ุจุฑูุฌูุงุช ุ ูู ุฑุฃูู ุ ูู ุฃู ูุคููู Arduino ุชุฑููุง ูุซู ูุฐุง ุงููุณุชูู ุงูููุฎูุถ ููููุฏุณุฉ ุงูููุฌูุฉ ูููุงุฆูุงุช.  ูุฐูู ุ ูุฑุฑุช ุฃู ุฃุฐูุจ ูู ููุณ ุงูุงุชุฌุงู ูุฃุถูู ุทุจูุฉ ุนุงููุฉ ุงููุณุชูู ููุฌูุฉ ูููุงุฆูุงุช ุฅูู ุญุฏ ูุง ููู ููุชุจุฉ HAL. </p><br><p style=";text-align:right;direction:rtl">  ูุจุงูุชุงูู ุ ูุชู ุงูุญุตูู ุนูู ุซูุงุซุฉ ูุณุชููุงุช ูู ุงูุจุฑูุงูุฌ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุดูู ููุชุจุงุช ุงูููุตูููุนูู (HAL ุ FatFS ุ ูู ุงููุณุชูุจู USB-OTG) ุงูุฃุณุงุณ </li><li style=";text-align:right;direction:rtl">  ุชุนุชูุฏ ููุชุจุฉ StmPlusPlus ุงูุฎุงุตุฉ ุจู ุนูู ูุฐุง ุงูุฃุณุงุณ.  ูุชุถูู ูุฌููุนุฉ ูู ุงููุฆุงุช ุงูุฃุณุงุณูุฉ (ูุซู System ู IOPort ู IOPin ู Timer ู RealTimeClock ู Usart ู Spi ู I2S) ููุฌููุนุฉ ูู ูุฆุงุช ุจุฑุงูุฌ ุงูุชุดุบูู ููุฃุฌูุฒุฉ ุงูุฎุงุฑุฌูุฉ (ูุซู SdCard ู Esp11 ู DcfReceiver ู Dac_MCP49x1 ู AudioDac_UDA1334 ููุง ุดุงุจู) ุ ููุฐูู ูุฆุงุช ุงูุฎุฏูุฉ ูุซู ูุดุบู WAV ุบูุฑ ุงููุชุฒุงูู. </li><li style=";text-align:right;direction:rtl">  ุจูุงุกู ุนูู ููุชุจุฉ StmPlusPlus ุ ูุชู ุฅูุดุงุก ุงูุชุทุจูู ููุณู. </li></ul><br><p style=";text-align:right;direction:rtl">  ุฃูุง ููุฌุฉ ุงููุบุฉ.  ุจูููุง ุฃูุง ูุฏูู ุฅูู ุญุฏ ูุง ุ ูุง ุฒูุช ูู C ++ 11.  ูุญุชูู ูุฐุง ุงููุนูุงุฑ ุนูู ุงูุนุฏูุฏ ูู ุงูููุฒุงุช ุงููููุฏุฉ ุจุดูู ุฎุงุต ูุชุทููุฑ ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ: ูุฆุงุช ุงูุชุนุฏุงุฏ ูุงุณุชุฏุนุงุก ุงููููุดุฆูู ุฐูู ุงูุฃููุงุณ ุงููุชุนุฑุฌุฉ ููุชุญูู ูู ุฃููุงุน ุงููุนููุงุช ุงูุชู ุชู ุชูุฑูุฑูุง ูุงูุญุงููุงุช ุงูุซุงุจุชุฉ ูุซู std :: array.  ุจุงูููุงุณุจุฉ ุ ุนูู ุญุจุฑู ููุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงูุฉ ุฑุงุฆุนุฉ</a> ุญูู ูุฐุง ุงูููุถูุน. </p><br><h3 id="biblioteka-stmplusplus" style=";text-align:right;direction:rtl">  ููุชุจุฉ StmPlusPlus </h3><br><p style=";text-align:right;direction:rtl">  ูููู ุงูุงุทูุงุน ุนูู ููุฏ ุงูููุชุจุฉ ุงููุงูู ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฌูุซุจ</a> .  ุณุฃุนุทู ููุง ุจุนุถ ุงูุฃูุซูุฉ ุงูุตุบูุฑุฉ ููุท ูุฅุธูุงุฑ ุงููููู ูุงูููุฑุฉ ูุงููุดููุงุช ุงููุงุชุฌุฉ ุนู ูุฐู ุงูููุฑุฉ. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุงููุซุงู ุงูุฃูู</strong> ูู ูุฆุฉ ูุงุณุชูุตุงุก ุญุงูุฉ ุฏุจูุณ ุจุดูู ุฏูุฑู (ุนูู ุณุจูู ุงููุซุงู ุ ุฒุฑ) ูุงุณุชุฏุนุงุก ุงููุนุงูุฌ ุนูุฏูุง ุชุชุบูุฑ ูุฐู ุงูุญุงูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Button</span></span></span><span class="hljs-class"> :</span></span> IOPin { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventHandler</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onButtonPressed</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Button *, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> numOccured)</span></span></span><span class="hljs-function"> </span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>; }; Button (PortName name, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> pin, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> pull, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> RealTimeClock &amp; _rtc, duration_ms _pressDelay = <span class="hljs-number"><span class="hljs-number">50</span></span>, duration_ms _pressDuration = <span class="hljs-number"><span class="hljs-number">300</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setHandler</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EventHandler * _handler)</span></span></span><span class="hljs-function"> </span></span>{ handler = _handler; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">periodic</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> RealTimeClock &amp; rtc; duration_ms pressDelay, pressDuration; time_ms pressTime; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> currentState; <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> numOccured; EventHandler * handler; };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญุฏุฏ ุงููููุดุฆ ุฌููุน ูุนููุงุช ุงูุฒุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">Button::Button (PortName name, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> pin, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> pull, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> RealTimeClock &amp; _rtc, duration_ms _pressDelay, duration_ms _pressDuration): IOPin{name, pin, GPIO_MODE_INPUT, pull, GPIO_SPEED_LOW}, rtc{_rtc}, pressDelay{_pressDelay}, pressDuration{_pressDuration}, pressTime{INFINITY_TIME}, currentState{<span class="hljs-literal"><span class="hljs-literal">false</span></span>}, numOccured{<span class="hljs-number"><span class="hljs-number">0</span></span>}, handler{<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>} { <span class="hljs-comment"><span class="hljs-comment">// empty }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูู ููู ุงูุชุนุงูู ูุน ูุซู ูุฐู ุงูุฃุญุฏุงุซ ููุซู ุฃููููุฉ ุ ููู ุงููุงุถุญ ุฃู ุงุณุชุฎุฏุงู ุงูููุงุทุนุงุช ุบูุฑ ุถุฑูุฑู.  ูุฐูู ุ ูุชู ุชูููุฐ ุณููุงุฑูููุงุช ุงูุถุบุท ุงููุฎุชููุฉ (ุนูู ุณุจูู ุงููุซุงู ุ ุถุบุทุฉ ูุงุญุฏุฉ ุฃู ุชุนููู) ูู ุงูุฅุฌุฑุงุก ุงูุฏูุฑู ุ ูุงูุฐู ูุฌุจ ุงุณุชุฏุนุงุคู ุจุดูู ุฏูุฑู ูู ุฑูุฒ ุงูุจุฑูุงูุฌ ุงูุฑุฆูุณู.  ูุญูู ุจุดูู ุฏูุฑู ุชุบููุฑ ุงูุญุงูุฉ ููุณุชุฏุนู ุจุดูู ูุชุฒุงูู ุงููุนุงูุฌ ุงูุธุงูุฑู onButtonPressed ุ ูุงูุฐู ูุฌุจ ุชูููุฐู ูู ุงูุจุฑูุงูุฌ ุงูุฑุฆูุณู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Button::periodic () { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (handler == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> newState = (gpioParameters.Pull == GPIO_PULLUP)? !getBit() : getBit(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentState == newState) { <span class="hljs-comment"><span class="hljs-comment">// state is not changed: check for periodical press event if (currentState &amp;&amp; pressTime != INFINITY_TIME) { duration_ms d = rtc.getUpTimeMillisec() - pressTime; if (d &gt;= pressDuration) { handler-&gt;onButtonPressed(this, numOccured); pressTime = rtc.getUpTimeMillisec(); ++numOccured; } } } else if (!currentState &amp;&amp; newState) { pressTime = rtc.getUpTimeMillisec(); numOccured = 0; } else { duration_ms d = rtc.getUpTimeMillisec() - pressTime; if (d &lt; pressDelay) { // nothing to do } else if (numOccured == 0) { handler-&gt;onButtonPressed(this, numOccured); } pressTime = INFINITY_TIME; } currentState = newState; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูููุฒุฉ ุงูุฑุฆูุณูุฉ ููุฐุง ุงูููุฌ ูู ุชููุน ุงูููุทู ูุงูุฑูุฒ ูุงูุชุดุงู ุญุฏุซ ูู ูุนุงูุฌุชู.  ูุง ูุชู ุงุณุชุฎุฏุงู HAL_GetTick ูุญุณุงุจ ุงูููุช ุ ูุงูุฐู ุ ุจุณุจุจ ููุนู (uint32_t) ุ ูุชู ุฅุนุงุฏุฉ ุชุนูููู ุนู ุทุฑูู ุชุฌุงูุฒ ุณุนุฉ ูู 2 ^ 32 ูููู ุซุงููุฉ (ูู 49 ููููุง).  ููุช ุจุชุทุจูู ูุตูู RealTimeClock ุ ุงูุฐู ูุญุณุจ ุจุงููููู ุซุงููุฉ ูู ุจุฏุงูุฉ ุงูุจุฑูุงูุฌ ุ ุฃู ุชุดุบูู ูุญุฏุฉ ุงูุชุญูู ูุซู uint64_t ุ ูุงูุชู ุชุนุทู ุญูุงูู 5 ^ 8 ุณููุงุช. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุงููุซุงู ุงูุซุงูู</strong> ูู ุงูุนูู ูุน ูุงุฌูุฉ ุงูุฃุฌูุฒุฉ ุ ูุงูุชู ููุฌุฏ ูููุง ุงูุนุฏูุฏ ูู ูุญุฏุฉ ุงูุชุญูู.  ุนูู ุณุจูู ุงููุซุงู ุ SPI.  ูู ูุฌูุฉ ูุธุฑ ุงูุจุฑูุงูุฌ ุงูุฑุฆูุณู ุ ูู ุงูููุงุฆู ุฌุฏูุง ุชุญุฏูุฏ ุงููุงุฌูุฉ ุงููุทููุจุฉ ููุท (SPI1 / SPI2 / SPI3) ุ ูุณูุชู ุชูููู ุฌููุน ุงููุนููุงุช ุงูุฃุฎุฑู ุงูุชู ุชุนุชูุฏ ุนูู ูุฐู ุงููุงุฌูุฉ ุจูุงุณุทุฉ ูููุดุฆ ุงููุฆุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Spi</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> TIMEOUT = <span class="hljs-number"><span class="hljs-number">5000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DeviceName</span></span></span><span class="hljs-class"> {</span></span> SPI_1 = <span class="hljs-number"><span class="hljs-number">0</span></span>, SPI_2 = <span class="hljs-number"><span class="hljs-number">1</span></span>, SPI_3 = <span class="hljs-number"><span class="hljs-number">2</span></span>, }; Spi (DeviceName _device, IOPort::PortName sckPort, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> sckPin, IOPort::PortName misoPort, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> misoPin, IOPort::PortName mosiPort, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> mosiPin, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> pull = GPIO_NOPULL); <span class="hljs-function"><span class="hljs-function">HAL_StatusTypeDef </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> direction, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> prescaler, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dataSize = SPI_DATASIZE_8BIT, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> CLKPhase = SPI_PHASE_1EDGE)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">HAL_StatusTypeDef </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> HAL_StatusTypeDef </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeBuffer</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *pData, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint16_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pSize)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HAL_SPI_Transmit(hspi, pData, pSize, TIMEOUT); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: DeviceName device; IOPin sck, miso, mosi; SPI_HandleTypeDef *hspi; SPI_HandleTypeDef spiParams; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">enableClock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">disableClock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชู ุชุฎุฒูู ูุนููุงุช ุงูุฏุจูุณ ููุนููุงุช ุงููุงุฌูุฉ ูุญูููุง ูู ุงููุตู.  ููุฃุณู ุ ุงุฎุชุฑุช ุฎูุงุฑ ุชูููุฐ ุบูุฑ ูุงุฌุญ ุชูุงููุง ุ ุนูุฏูุง ูุชู ุชูููุฐ ุฅุนุฏุงุฏุงุช ุงููุนููุงุช ุงุนุชูุงุฏูุง ุนูู ูุงุฌูุฉ ูุนููุฉ ูุจุงุดุฑุฉู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">Spi::Spi (DeviceName _device, IOPort::PortName sckPort, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> sckPin, IOPort::PortName misoPort, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> misoPin, IOPort::PortName mosiPort, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> mosiPin, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> pull): device(_device), sck(sckPort, sckPin, GPIO_MODE_AF_PP, pull, GPIO_SPEED_HIGH, <span class="hljs-literal"><span class="hljs-literal">false</span></span>), miso(misoPort, misoPin, GPIO_MODE_AF_PP, pull, GPIO_SPEED_HIGH, <span class="hljs-literal"><span class="hljs-literal">false</span></span>), mosi(mosiPort, mosiPin, GPIO_MODE_AF_PP, pull, GPIO_SPEED_HIGH, <span class="hljs-literal"><span class="hljs-literal">false</span></span>), hspi(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (device) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> DeviceName::SPI_1: <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> SPI1 sck.setAlternate(GPIO_AF5_SPI1); miso.setAlternate(GPIO_AF5_SPI1); mosi.setAlternate(GPIO_AF5_SPI1); spiParams.Instance = SPI1; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> break; ... case DeviceName::SPI_3: #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> SPI3 sck.setAlternate(GPIO_AF6_SPI3); miso.setAlternate(GPIO_AF6_SPI3); mosi.setAlternate(GPIO_AF6_SPI3); spiParams.Instance = SPI3; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> break; } spiParams.Init.Mode = SPI_MODE_MASTER; spiParams.Init.DataSize = SPI_DATASIZE_8BIT; spiParams.Init.CLKPolarity = SPI_POLARITY_HIGH; spiParams.Init.CLKPhase = SPI_PHASE_1EDGE; spiParams.Init.FirstBit = SPI_FIRSTBIT_MSB; spiParams.Init.TIMode = SPI_TIMODE_DISABLE; spiParams.Init.CRCCalculation = SPI_CRCCALCULATION_DISABLE; spiParams.Init.CRCPolynomial = 7; spiParams.Init.NSS = SPI_NSS_SOFT; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุณ ุงููุฎุทุท ูุทุจู ุฅุฌุฑุงุกุงุช enableClock ู disableClock ุ ูุงูุชู ุชููู ูุงุจูุฉ ููุชูุณุนุฉ ุจุดูู ุณูุก ููุงุจูุฉ ููููู ุจุดูู ุณูุก ุฅูู ูุญุฏุงุช ุงูุชุญูู ุงูุฃุฎุฑู.  ูู ูุฐู ุงูุญุงูุฉ ุ ูู ุงูุฃูุถู ุงุณุชุฎุฏุงู ุงูููุงูุจ ุญูุซ ุชููู ูุนููุฉ ุงููุงูุจ ูู ุงุณู ูุงุฌูุฉ HAL (SPI1 ู SPI2 ู SPI3) ููุนููุงุช ุงูุฏุจูุณ (GPIO_AF5_SPI1) ูุดูุก ูุชุญูู ูู ุชุดุบูู / ุฅููุงู ุงูุณุงุนุฉ.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงู</a> ููุงู ูุซูุฑ ููุงูุชูุงู ุญูู ูุฐุง ุงูููุถูุน ุ ุนูู ุงูุฑุบู ูู ุฃูู ูุฑุงุฌุน ูุญุฏุงุช ุชุญูู AVR ุ ูุงูุชู ุ ูุน ุฐูู ุ ูุง ุชุญุฏุซ ูุฑููุง ุฃุณุงุณููุง. </p><br><p style=";text-align:right;direction:rtl">  ูุชู ุงูุชุญูู ูู ุจุฏุงูุฉ ูููุงูุฉ ุงูุชุญููู ุจุทุฑููุชูู ูุจุฏุก / ุฅููุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">HAL_StatusTypeDef Spi::start (<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> direction, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> prescaler, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> dataSize, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> CLKPhase) { hspi = &amp;spiParams; enableClock(); spiParams.Init.Direction = direction; spiParams.Init.BaudRatePrescaler = prescaler; spiParams.Init.DataSize = dataSize; spiParams.Init.CLKPhase = CLKPhase; HAL_StatusTypeDef status = HAL_SPI_Init(hspi); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (status != HAL_OK) { USART_DEBUG(<span class="hljs-string"><span class="hljs-string">"Can not initialize SPI "</span></span> &lt;&lt; (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)device &lt;&lt; <span class="hljs-string"><span class="hljs-string">": "</span></span> &lt;&lt; status); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> status; } <span class="hljs-comment"><span class="hljs-comment">/* Configure communication direction : 1Line */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (spiParams.Init.Direction == SPI_DIRECTION_1LINE) { SPI_1LINE_TX(hspi); } <span class="hljs-comment"><span class="hljs-comment">/* Check if the SPI is already enabled */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((spiParams.Instance-&gt;CR1 &amp; SPI_CR1_SPE) != SPI_CR1_SPE) { <span class="hljs-comment"><span class="hljs-comment">/* Enable SPI peripheral */</span></span> __HAL_SPI_ENABLE(hspi); } USART_DEBUG(<span class="hljs-string"><span class="hljs-string">"Started SPI "</span></span> &lt;&lt; (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)device &lt;&lt; <span class="hljs-string"><span class="hljs-string">": BaudRatePrescaler = "</span></span> &lt;&lt; spiParams.Init.BaudRatePrescaler &lt;&lt; <span class="hljs-string"><span class="hljs-string">", DataSize = "</span></span> &lt;&lt; spiParams.Init.DataSize &lt;&lt; <span class="hljs-string"><span class="hljs-string">", CLKPhase = "</span></span> &lt;&lt; spiParams.Init.CLKPhase &lt;&lt; <span class="hljs-string"><span class="hljs-string">", Status = "</span></span> &lt;&lt; status); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> status; } HAL_StatusTypeDef Spi::stop () { USART_DEBUG(<span class="hljs-string"><span class="hljs-string">"Stopping SPI "</span></span> &lt;&lt; (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)device); HAL_StatusTypeDef retValue = HAL_SPI_DeInit(&amp;spiParams); disableClock(); hspi = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> retValue; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  <strong>ุงูุนูู ูุน ูุงุฌูุฉ ุงูุฃุฌูุฒุฉ ุจุงุณุชุฎุฏุงู ุงูููุงุทุนุงุช</strong> .  ุชุทุจู ุงููุฆุฉ ูุงุฌูุฉ I2S ุจุงุณุชุฎุฏุงู ุฌูุงุฒ ุชุญูู DMA.  I2S (Inter-IC Sound) ูู ุนุจุงุฑุฉ ุนู ูุธููุฉ ุฅุถุงููุฉ ููุฃุฌูุฒุฉ ูุงูุจุฑุงูุฌ ุนุจุฑ SPI ุ ูุงูุชู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุชุฎุชุงุฑ ุชุฑุฏุฏ ุงูุณุงุนุฉ ูุชุชุญูู ูู ุงููููุงุช ุงุนุชูุงุฏูุง ุนูู ุจุฑูุชูููู ุงูุตูุช ููุนุฏู ุงูุจุช. </p><br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูุญุงูุฉ ุ ูุชู ุชูุฑูุซ ูุฆุฉ I2S ูู ูุฆุฉ "ุงููููุฐ" ุ ุฃู ุฃู I2S ุนุจุงุฑุฉ ุนู ูููุฐ ุจุฎุตุงุฆุต ุฎุงุตุฉ.  ูุชู ุชุฎุฒูู ุจุนุถ ุงูุจูุงูุงุช ูู ููุงูู HAL (ุจุงูุฅุถุงูุฉ ุฅูู ุงูุฑุงุญุฉ ุ ูุงูุต ููููุฉ ุงูุจูุงูุงุช).  ูุชู ููู ุจุนุถ ุงูุจูุงูุงุช ูู ุงูููุฏ ุงูุฑุฆูุณู ุนู ุทุฑูู ุงูุฑูุงุจุท (ุนูู ุณุจูู ุงููุซุงู ุ ุจููุฉ irqPrio). </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">I2S</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IOPort { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> IRQn_Type I2S_IRQ = SPI2_IRQn; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> IRQn_Type DMA_TX_IRQ = DMA1_Stream4_IRQn; I2S (PortName name, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> pin, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> InterruptPriority &amp; prio); <span class="hljs-function"><span class="hljs-function">HAL_StatusTypeDef </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> standard, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> audioFreq, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dataFormat)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> HAL_StatusTypeDef </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transmit</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint16_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * pData, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint16_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HAL_I2S_Transmit_DMA(&amp;i2s, pData, size); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processI2SInterrupt</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ HAL_I2S_IRQHandler(&amp;i2s); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDmaTxInterrupt</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ HAL_DMA_IRQHandler(&amp;i2sDmaTx); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: I2S_HandleTypeDef i2s; DMA_HandleTypeDef i2sDmaTx; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> InterruptPriority &amp; irqPrio; };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ูููุดุฆู ุจุชุนููู ุฌููุน ุงููุนููุงุช ุงูุซุงุจุชุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">I2S::I2S (PortName name, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> pin, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> InterruptPriority &amp; prio): IOPort{name, GPIO_MODE_INPUT, GPIO_NOPULL, GPIO_SPEED_FREQ_LOW, pin, <span class="hljs-literal"><span class="hljs-literal">false</span></span>}, irqPrio{prio} { i2s.Instance = SPI2; i2s.Init.Mode = I2S_MODE_MASTER_TX; i2s.Init.Standard = I2S_STANDARD_PHILIPS; <span class="hljs-comment"><span class="hljs-comment">// will be re-defined at communication start i2s.Init.DataFormat = I2S_DATAFORMAT_16B; // will be re-defined at communication start i2s.Init.MCLKOutput = I2S_MCLKOUTPUT_DISABLE; i2s.Init.AudioFreq = I2S_AUDIOFREQ_44K; // will be re-defined at communication start i2s.Init.CPOL = I2S_CPOL_LOW; i2s.Init.ClockSource = I2S_CLOCK_PLL; i2s.Init.FullDuplexMode = I2S_FULLDUPLEXMODE_DISABLE; i2sDmaTx.Instance = DMA1_Stream4; i2sDmaTx.Init.Channel = DMA_CHANNEL_0; i2sDmaTx.Init.Direction = DMA_MEMORY_TO_PERIPH; i2sDmaTx.Init.PeriphInc = DMA_PINC_DISABLE; i2sDmaTx.Init.MemInc = DMA_MINC_ENABLE; i2sDmaTx.Init.PeriphDataAlignment = DMA_PDATAALIGN_HALFWORD; i2sDmaTx.Init.MemDataAlignment = DMA_MDATAALIGN_HALFWORD; i2sDmaTx.Init.Mode = DMA_NORMAL; i2sDmaTx.Init.Priority = DMA_PRIORITY_LOW; i2sDmaTx.Init.FIFOMode = DMA_FIFOMODE_ENABLE; i2sDmaTx.Init.FIFOThreshold = DMA_FIFO_THRESHOLD_FULL; i2sDmaTx.Init.MemBurst = DMA_PBURST_SINGLE; i2sDmaTx.Init.PeriphBurst = DMA_PBURST_SINGLE; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชู ุงูุชุญูู ูู ุจุฏุงูุฉ ููู ุงูุจูุงูุงุช ูู ุฎูุงู ุทุฑู ุงูุจุฏุก ุ ููู ุงููุณุคููุฉ ุนู ุชูููู ูุนููุงุช ุงููููุฐ ุ ูุชุณุฌูู ููุช ุงููุงุฌูุฉ ุ ูุชูููู ุงูููุงุทุนุงุช ุ ูุจุฏุก DMA ุ ูุจุฏุก ุงููุงุฌูุฉ ููุณูุง ูุน ูุนููุงุช ุงูุฅุฑุณุงู ุงููุญุฏุฏุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">HAL_StatusTypeDef I2S::start (<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> standard, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> audioFreq, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> dataFormat) { i2s.Init.Standard = standard; i2s.Init.AudioFreq = audioFreq; i2s.Init.DataFormat = dataFormat; setMode(GPIO_MODE_AF_PP); setAlternate(GPIO_AF5_SPI2); __HAL_RCC_SPI2_CLK_ENABLE(); HAL_StatusTypeDef status = HAL_I2S_Init(&amp;i2s); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (status != HAL_OK) { USART_DEBUG(<span class="hljs-string"><span class="hljs-string">"Can not start I2S: "</span></span> &lt;&lt; status); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HAL_ERROR; } __HAL_RCC_DMA1_CLK_ENABLE(); __HAL_LINKDMA(&amp;i2s, hdmatx, i2sDmaTx); status = HAL_DMA_Init(&amp;i2sDmaTx); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (status != HAL_OK) { USART_DEBUG(<span class="hljs-string"><span class="hljs-string">"Can not initialize I2S DMA/TX channel: "</span></span> &lt;&lt; status); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HAL_ERROR; } HAL_NVIC_SetPriority(I2S_IRQ, irqPrio.first, irqPrio.second); HAL_NVIC_EnableIRQ(I2S_IRQ); HAL_NVIC_SetPriority(DMA_TX_IRQ, irqPrio.first + <span class="hljs-number"><span class="hljs-number">1</span></span>, irqPrio.second); HAL_NVIC_EnableIRQ(DMA_TX_IRQ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HAL_OK; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅุฌุฑุงุก ุงูุชููู ููุนู ุนูุณ ุฐูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> I2S::stop () { HAL_NVIC_DisableIRQ(I2S_IRQ); HAL_NVIC_DisableIRQ(DMA_TX_IRQ); HAL_DMA_DeInit(&amp;i2sDmaTx); __HAL_RCC_DMA1_CLK_DISABLE(); HAL_I2S_DeInit(&amp;i2s); __HAL_RCC_SPI2_CLK_DISABLE(); setMode(GPIO_MODE_INPUT); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุงู ุงูุนุฏูุฏ ูู ุงูููุฒุงุช ุงููุซูุฑุฉ ููุงูุชูุงู ููุง: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุชู ุชุนุฑูู ุงูููุงุทุนุงุช ุงููุณุชุฎุฏูุฉ ูู ูุฐู ุงูุญุงูุฉ ุนูู ุฃููุง ุซูุงุจุช ุซุงุจุชุฉ.  ูุฐุง ูุงูุต ูุณูููุฉ ุงูุชุญูู ุฅูู ูุญุฏุงุช ุชุญูู ุฃุฎุฑู. </li><li style=";text-align:right;direction:rtl">  ูุถูู ุชูุธูู ุงูุฑูุฒ ูุฐุง ุฃู ุฏุจุงุจูุณ ุงููููุฐ ุชููู ุฏุงุฆููุง ูู ุญุงูุฉ GPIO_MODE_INPUT ุนูุฏูุง ูุง ูููู ููุงู ุฅุฑุณุงู.  ูุฐุง ุฒุงุฆุฏ. </li><li style=";text-align:right;direction:rtl">  ูุชู ููู ุฃููููุฉ ุงูููุงุทุนุงุช ูู ุงูุฎุงุฑุฌ ุ ุฃู ุฃู ููุงู ูุฑุตุฉ ุฌูุฏุฉ ูุชุนููู ุฎุฑูุทุฉ ุฃููููุฉ ุงูููุงุทุนุฉ ูู ููุงู ูุงุญุฏ ูู ุงูุฑูุฒ ุงูุฑุฆูุณู.  ูุฐุง ุฃูุถุง ุฒุงุฆุฏ. </li><li style=";text-align:right;direction:rtl">  ุชุนุทูู ุฅุฌุฑุงุก ุงูุฅููุงู DMA1.  ูู ูุฐู ุงูุญุงูุฉ ุ ูููู ุฃู ูููู ููุฐุง ุงูุชุจุณูุท ุนูุงูุจ ุณูุจูุฉ ููุบุงูุฉ ุฅุฐุง ุงุณุชูุฑ ุดุฎุต ุขุฎุฑ ูู ุงุณุชุฎุฏุงู DMA1.  ูุชู ุญู ุงููุดููุฉ ุนู ุทุฑูู ุฅูุดุงุก ุณุฌู ูุฑูุฒู ูููุณุชููููู ููุฐู ุงูุฃุฌูุฒุฉ ุ ูุงูุชู ุณุชููู ูุณุคููุฉ ุนู ุงูุชูููุช. </li><li style=";text-align:right;direction:rtl">  ุชุจุณูุท ุขุฎุฑ - ูุง ูุคุฏู ุฅุฌุฑุงุก ุงูุจุฏุก ุฅูู ุฅุนุงุฏุฉ ุงููุงุฌูุฉ ุฅูู ุญุงูุชูุง ุงูุฃุตููุฉ ูู ุญุงูุฉ ุญุฏูุซ ุฎุทุฃ (ูุฐุง ูุงูุต ุ ูููู ูููู ุฅุตูุงุญู ุจุณูููุฉ).  ูู ุงูููุช ููุณู ุ ูุชู ุชุณุฌูู ุงูุฃุฎุทุงุก ุจูุฒูุฏ ูู ุงูุชูุตูู ุ ููู ุฒุงุฆุฏ. </li><li style=";text-align:right;direction:rtl">  ุนูุฏ ุงุณุชุฎุฏุงู ูุฐู ุงููุฆุฉ ุ ูุฌุจ ุฃู ูุนุชุฑุถ ุงูููุฏ ุงูุฑุฆูุณู ููุงุทุนุงุช SPI2_IRQn ู DMA1_Stream4_IRQn ูุงูุชุฃูุฏ ูู ุฃู ุงูุนูููุฉ ุงูููุงุจูุฉ I2SInterrupt ู processDmaTxInterrupt ูุชู ุงุณุชุฏุนุงุคูุง. </li></ul><br><h3 id="osnovnaya-programma" style=";text-align:right;direction:rtl">  ุงูุจุฑูุงูุฌ ุงูุฑุฆูุณู </h3><br><p style=";text-align:right;direction:rtl">  ูุชู ูุชุงุจุฉ ุงูุจุฑูุงูุฌ ุงูุฑุฆูุณู ุจุงุณุชุฎุฏุงู ุงูููุชุจุฉ ุงูููุตููุฉ ุฃุนูุงู ุจูู ุจุณุงุทุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ HAL_Init(); <span class="hljs-function"><span class="hljs-function">IOPort </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">defaultPortA</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IOPort::PortName::A, GPIO_MODE_INPUT, GPIO_PULLDOWN)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">IOPort </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">defaultPortB</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IOPort::PortName::B, GPIO_MODE_INPUT, GPIO_PULLDOWN)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">IOPort </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">defaultPortC</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IOPort::PortName::C, GPIO_MODE_INPUT, GPIO_PULLDOWN)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// System frequency 168MHz System::ClockDiv clkDiv; clkDiv.PLLM = 16; clkDiv.PLLN = 336; clkDiv.PLLP = 2; clkDiv.PLLQ = 7; clkDiv.AHBCLKDivider = RCC_SYSCLK_DIV1; clkDiv.APB1CLKDivider = RCC_HCLK_DIV8; clkDiv.APB2CLKDivider = RCC_HCLK_DIV8; clkDiv.PLLI2SN = 192; clkDiv.PLLI2SR = 2; do { System::setClock(clkDiv, FLASH_LATENCY_3, System::RtcType::RTC_EXT); } while (System::getMcuFreq() != 168000000L); MyApplication app; appPtr = &amp;app; app.run(); }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ููุง ุจุชููุฆุฉ ููุชุจุฉ HAL ุ ูุชููุฆุฉ ุฌููุน ุฃุทุฑุงู ูุญุฏุฉ ุงูุชุญูู ุนู ุทุฑูู ุงูุฅุฏุฎุงู (GPIO_MODE_INPUT / PULLDOWN) ุจุดูู ุงูุชุฑุงุถู.  ูููู ุจุถุจุท ุชุฑุฏุฏ ูุญุฏุฉ ุงูุชุญูู ุ ูุจุฏุก ุงูุณุงุนุฉ (ุจูุง ูู ุฐูู ุงูุณุงุนุฉ ูู ุงูููุช ุงูุญูููู ูู ุงูููุงุฑุชุฒ ุงูุฎุงุฑุฌู).  ุจุนุฏ ุฐูู ุ ูู ููุท Java ููููุงู ุ ูููู ุจุฅูุดุงุก ูุซูู ูุชุทุจูููุง ูุงุณุชุฏุนุงุก ุทุฑููุฉ ุงูุชุดุบูู ุงูุฎุงุตุฉ ุจู ุ ูุงูุชู ุชููุฐ ูู ููุทู ุงูุชุทุจูู. </p><br><p style=";text-align:right;direction:rtl">  ูู ูุณู ูููุตู ุ ูุฌุจ ุนูููุง ุชุญุฏูุฏ ุฌููุน ุงูููุงุทุนุงุช ุงููุณุชุฎุฏูุฉ.  ูุธุฑูุง ูุฃููุง ููุชุจ ุจูุบุฉ C ++ ุ ูุงูููุงุทุนุงุช ูู ุฃุดูุงุก ูู ุนุงูู C ุ ูุฅููุง ุจุญุงุฌุฉ ุฅูู ุฅุฎูุงุกูุง ููููุง ูุฐูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SysTick_Handler</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ HAL_IncTick(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (appPtr != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { appPtr-&gt;getRtc().onMilliSecondInterrupt(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DMA2_Stream3_IRQHandler</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ Devices::SdCard::getInstance()-&gt;processDmaRxInterrupt(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DMA2_Stream6_IRQHandler</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ Devices::SdCard::getInstance()-&gt;processDmaTxInterrupt(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SDIO_IRQHandler</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ Devices::SdCard::getInstance()-&gt;processSdIOInterrupt(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPI2_IRQHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ appPtr-&gt;getI2S().processI2SInterrupt(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DMA1_Stream4_IRQHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ appPtr-&gt;getI2S().processDmaTxInterrupt(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HAL_I2S_TxCpltCallback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(I2S_HandleTypeDef *channel)</span></span></span><span class="hljs-function"> </span></span>{ appPtr-&gt;processDmaTxCpltCallback(channel); } ... }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุนูู ูุฆุฉ MyApplication ุนู ุฌููุน ุงูุฃุฌูุฒุฉ ุงููุณุชุฎุฏูุฉ ุ ูููุดุฆู ุงูููุงููุงุช ูุฌููุน ูุฐู ุงูุฃุฌูุฒุฉ ุ ููุง ุชููุฐ ูุนุงูุฌุงุช ุงูุฃุญุฏุงุซ ุงููุงุฒูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyApplication</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RealTimeClock::EventHandler, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyApplication</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RealTimeClock::EventHandler, WavStreamer::EventHandler, Devices::Button::EventHandler { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> INPUT_PINS = <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Number of monitored input pins private: UsartLogger log; RealTimeClock rtc; IOPin ledGreen, ledBlue, ledRed; PeriodicalEvent heartbeatEvent; IOPin mco; // Interrupt priorities InterruptPriority irqPrioI2S; InterruptPriority irqPrioEsp; InterruptPriority irqPrioSd; InterruptPriority irqPrioRtc; // SD card IOPin pinSdPower, pinSdDetect; IOPort portSd1, portSd2; SdCard sdCard; bool sdCardInserted; // Configuration Config config; // ESP Esp11 esp; EspSender espSender; // Input pins std::array&lt;IOPin, INPUT_PINS&gt; pins; std::array&lt;bool, INPUT_PINS&gt; pinsState; // I2S2 Audio I2S i2s; AudioDac_UDA1334 audioDac; WavStreamer streamer; Devices::Button playButton; ...</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐุง ุ ูู ุงููุงูุน ุ ูุชู ุงูุฅุนูุงู ุนู ุฌููุน ุงูุฃุฌูุฒุฉ ุงููุณุชุฎุฏูุฉ ุจุดูู ุซุงุจุช ุ ููุง ูุฏ ูุคุฏู ุฅูู ุฒูุงุฏุฉ ูู ุงูุฐุงูุฑุฉ ุงููุณุชุฎุฏูุฉ ุ ููููู ูุจุณุท ุฅูู ุญุฏ ูุจูุฑ ุงููุตูู ุฅูู ุงูุจูุงูุงุช.  ูู ูููุดุฆ ูุฆุฉ MyApplication ุ ูู ุงูุถุฑูุฑู ุงูุงุชุตุงู ุจูุตููู ุฌููุน ุงูุฃุฌูุฒุฉ ุ ูุจุนุฏ ุฐูู ุ ุนูุฏ ุจุฏุก ุฅุฌุฑุงุก ุงูุชุดุบูู ุ ุณูุชู ุชููุฆุฉ ุฌููุน ุฃุฌูุฒุฉ ุงูุชุญูู ุงูุฏูููุฉ ุงููุณุชุฎุฏูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"> MyApplication::MyApplication () : <span class="hljs-comment"><span class="hljs-comment">// logging log(Usart::USART_1, IOPort::B, GPIO_PIN_6, GPIO_PIN_7, 115200), // RTC rtc(), ledGreen(IOPort::C, GPIO_PIN_1, GPIO_MODE_OUTPUT_PP), ledBlue(IOPort::C, GPIO_PIN_2, GPIO_MODE_OUTPUT_PP), ledRed(IOPort::C, GPIO_PIN_3, GPIO_MODE_OUTPUT_PP), heartbeatEvent(rtc, 10, 2), mco(IOPort::A, GPIO_PIN_8, GPIO_MODE_AF_PP), // Interrupt priorities irqPrioI2S(6, 0), // I2S DMA interrupt priority: 7 will be also used irqPrioEsp(5, 0), irqPrioSd(3, 0), // SD DMA interrupt priority: 4 will be also used irqPrioRtc(2, 0), // SD card pinSdPower(IOPort::A, GPIO_PIN_15, GPIO_MODE_OUTPUT_PP, GPIO_PULLDOWN, GPIO_SPEED_HIGH, true, false), pinSdDetect(IOPort::B, GPIO_PIN_3, GPIO_MODE_INPUT, GPIO_PULLUP), portSd1(IOPort::C, /* mode = */GPIO_MODE_OUTPUT_PP, /* pull = */GPIO_PULLUP, /* speed = */GPIO_SPEED_FREQ_VERY_HIGH, /* pin = */GPIO_PIN_8 | GPIO_PIN_9 | GPIO_PIN_10 | GPIO_PIN_11 | GPIO_PIN_12, /* callInit = */false), portSd2(IOPort::D, /* mode = */GPIO_MODE_OUTPUT_PP, /* pull = */GPIO_PULLUP, /* speed = */GPIO_SPEED_FREQ_VERY_HIGH, /* pin = */GPIO_PIN_2, /* callInit = */false), sdCard(pinSdDetect, portSd1, portSd2), sdCardInserted(false), // Configuration config(pinSdPower, sdCard, "conf.txt"), //ESP esp(rtc, Usart::USART_2, IOPort::A, GPIO_PIN_2, GPIO_PIN_3, irqPrioEsp, IOPort::A, GPIO_PIN_1), espSender(rtc, esp, ledRed), // Input pins pins { { IOPin(IOPort::A, GPIO_PIN_4, GPIO_MODE_INPUT, GPIO_PULLUP), IOPin(IOPort::A, GPIO_PIN_5, GPIO_MODE_INPUT, GPIO_PULLUP), IOPin(IOPort::A, GPIO_PIN_6, GPIO_MODE_INPUT, GPIO_PULLUP), IOPin(IOPort::A, GPIO_PIN_7, GPIO_MODE_INPUT, GPIO_PULLUP), IOPin(IOPort::C, GPIO_PIN_4, GPIO_MODE_INPUT, GPIO_PULLUP), IOPin(IOPort::C, GPIO_PIN_5, GPIO_MODE_INPUT, GPIO_PULLUP), IOPin(IOPort::B, GPIO_PIN_0, GPIO_MODE_INPUT, GPIO_PULLUP), IOPin(IOPort::B, GPIO_PIN_1, GPIO_MODE_INPUT, GPIO_PULLUP) } }, // I2S2 Audio Configuration // PB10 --&gt; I2S2_CK // PB12 --&gt; I2S2_WS // PB15 --&gt; I2S2_SD i2s(IOPort::B, GPIO_PIN_10 | GPIO_PIN_12 | GPIO_PIN_15, irqPrioI2S), audioDac(i2s, /* power = */ IOPort::B, GPIO_PIN_11, /* mute = */ IOPort::B, GPIO_PIN_13, /* smplFreq = */ IOPort::B, GPIO_PIN_14), streamer(sdCard, audioDac), playButton(IOPort::B, GPIO_PIN_2, GPIO_PULLUP, rtc) { mco.activateClockOutput(RCC_MCO1SOURCE_PLLCLK, RCC_MCODIV_5); }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุซุงู ุ ูุนุงูุฌ ุงูุฃุญุฏุงุซ ููููุฑ ุนูู ุฒุฑ ูุจุฏุฃ / ูุชููู ุนู ุชุดุบูู ููู WAV: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> MyApplication::onButtonPressed (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Devices::Button * b, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> numOccured) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b == &amp;playButton) { USART_DEBUG(<span class="hljs-string"><span class="hljs-string">"play button pressed: "</span></span> &lt;&lt; numOccured); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (streamer.isActive()) { USART_DEBUG(<span class="hljs-string"><span class="hljs-string">" Stopping WAV"</span></span>); streamer.stop(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { USART_DEBUG(<span class="hljs-string"><span class="hljs-string">" Starting WAV"</span></span>); streamer.start(AudioDac_UDA1334::SourceType:: STREAM, config.getWavFile()); } } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฃุฎูุฑูุง ุ ุชููู ุทุฑููุฉ ุงูุชุดุบูู ุงูุฑุฆูุณูุฉ ุชูููู ุงูุฃุฌูุฒุฉ (ุนูู ุณุจูู ุงููุซุงู ุ ุชุนููู MyApplication ููุนุงูุฌ ููุฃุญุฏุงุซ) ุ ูุชุจุฏุฃ ุญููุฉ ูุง ููุงุฆูุฉ ุ ุญูุซ ุชุดูุฑ ุจุดูู ุฏูุฑู ุฅูู ุชูู ุงูุฃุฌูุฒุฉ ุงูุชู ุชุชุทูุจ ุงูุชูุงููุง ุฏูุฑููุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> MyApplication::run () { <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>.initInstance(); USART_DEBUG(<span class="hljs-string"><span class="hljs-string">"Oscillator frequency: "</span></span> &lt;&lt; System::getExternalOscillatorFreq() &lt;&lt; <span class="hljs-string"><span class="hljs-string">", MCU frequency: "</span></span> &lt;&lt; System::getMcuFreq()); HAL_StatusTypeDef status = HAL_TIMEOUT; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { status = rtc.start(<span class="hljs-number"><span class="hljs-number">8</span></span> * <span class="hljs-number"><span class="hljs-number">2047</span></span> + <span class="hljs-number"><span class="hljs-number">7</span></span>, RTC_WAKEUPCLOCK_RTCCLK_DIV2, irqPrioRtc, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); USART_DEBUG(<span class="hljs-string"><span class="hljs-string">"RTC start status: "</span></span> &lt;&lt; status); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (status != HAL_OK); sdCard.setIrqPrio(irqPrioSd); sdCard.initInstance(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sdCard.isCardInserted()) { updateSdCardState(); } USART_DEBUG(<span class="hljs-string"><span class="hljs-string">"Input pins: "</span></span> &lt;&lt; pins.size()); pinsState.fill(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); USART_DEBUG(<span class="hljs-string"><span class="hljs-string">"Pin state: "</span></span> &lt;&lt; fillMessage()); esp.assignSendLed(&amp;ledGreen); streamer.stop(); streamer.setHandler(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); streamer.setVolume(<span class="hljs-number"><span class="hljs-number">1.0</span></span>); playButton.setHandler(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> reportState = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { updateSdCardState(); playButton.periodic(); streamer.periodic(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isInputPinsChanged()) { USART_DEBUG(<span class="hljs-string"><span class="hljs-string">"Input pins change detected"</span></span>); ledBlue.putBit(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); reportState = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } espSender.periodic(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (espSender.isOutputMessageSent()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (reportState) { espSender.sendMessage(config, <span class="hljs-string"><span class="hljs-string">"TCP"</span></span>, config.getServerIp(), config.getServerPort(), fillMessage()); reportState = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!reportState) { ledBlue.putBit(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (heartbeatEvent.isOccured()) { ledGreen.putBit(heartbeatEvent.occurance() == <span class="hljs-number"><span class="hljs-number">1</span></span>); } } }</code> </pre> <br><h3 id="nemnogo-eksperimentov" style=";text-align:right;direction:rtl">  ุงููููู ูู ุงูุชุฌุฑูุจ </h3><br><p style=";text-align:right;direction:rtl">   โ    .    โ 168 MHz. ,   ,      172 MHz   180 MHz,          ,      ,         MCO.     ,   USART  I2S, ,  ,      HAL. </p><br><h2 id="cena" style=";text-align:right;direction:rtl">  </h2><br><p style=";text-align:right;direction:rtl">        .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=http://htmlpreview.github.io/%3F">github</a>     .    - ,            <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Mouser</a> (   ).     37      .            .  ,        STM  Olimex,      . </p><br><h2 id="problemy-i-perspektivy" style=";text-align:right;direction:rtl">    </h2><br><p style=";text-align:right;direction:rtl">        .       ,   : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">        (   ).  ,       ,            .       :     4  8 .        PLL,         . </li><li style=";text-align:right;direction:rtl">    ,       .      47 ฮผF  . ,    . </li><li style=";text-align:right;direction:rtl">   SWD      .    -  ,     .     . </li><li style=";text-align:right;direction:rtl">     .     SMD ,    .       3       . </li></ul><br><h2 id="dokumentaciya" style=";text-align:right;direction:rtl">  </h2><br><p style=";text-align:right;direction:rtl">    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">github</a>   GPL v3: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://docs.google.com/viewer%3Furl%3D"></a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://docs.google.com/viewer%3Furl%3D"></a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://docs.google.com/viewer%3Furl%3D"> </a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://docs.google.com/viewer%3Furl%3D"> </a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=http://htmlpreview.github.io/%3F"> </a> </li></ul><br><p style=";text-align:right;direction:rtl">   ! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar413101/">https://habr.com/ru/post/ar413101/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar413091/index.html">ุชุณุฌูู ูุฑูุญ ูู SpringBoot + Log4j2 + Maven</a></li>
<li><a href="../ar413093/index.html">ูู ุงูุชุธุงุฑ ุณุจุงู ุชุฌุงุฑ ุงููุถุงุก ูู ุงูููุงูุงุช ุงููุชุญุฏุฉ ูุงูุตูู</a></li>
<li><a href="../ar413095/index.html">ุชุทุจูู ุชูููุงุช ุงูุดุจูุงุช ุงูุนุตุจูุฉ: ุชุทููุฑ ุงูุจุฑูุฌูุงุช</a></li>
<li><a href="../ar413097/index.html">ุจูุงุกู ุนูู ุจุฑูุงูุฌ ุนูู ูุณุชูู ุงููุคุณุณุฉ ุ ุชู ุงุฎุชุจุงุฑู ููุงููู ุงููุฑุงุช: ุชู ุฅุตุฏุงุฑ openSUSE Leap 15</a></li>
<li><a href="../ar413099/index.html">ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุนูู ูุงู ุจูู</a></li>
<li><a href="../ar413103/index.html">ุชู ุฅุตุฏุงุฑ ุชุญุฏูุซ 3CX v15.5 ุชุญุฏูุซ 5 Beta ู REST ูุน AmoCRM</a></li>
<li><a href="../ar413105/index.html">ููุงุญุธุงุช ูููุฑ ุฅูุชุฑูุช ุงูุฃุดูุงุก. ุงูุชูุดูุท ูุงูุฃูู ูู LoraWAN</a></li>
<li><a href="../ar413107/index.html">ุชุฑุฌูุฉ ูููู ูุดุฑูุน Svelto.ECS. ุฅุทุงุฑ ECS ูู Unity3D</a></li>
<li><a href="../ar413109/index.html">ููููุฉ ุจูุงุก ููุตุฉ ุชูุงูู ููุชุฌุงุช SaaS: ุชุฌุฑุจุฉ ุงูุณุญุจ ุงูุณุญุงุจูุฉ ููููุตู</a></li>
<li><a href="../ar413111/index.html">STM32 + NetBeans =ุ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>