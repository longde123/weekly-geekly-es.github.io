<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∞üèø üçß üõÑ Distribuya uniformemente los puntos a trav√©s de la esfera en pytorch y tensorflow ü¶â üë©üèæ üç∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este texto est√° escrito para aquellos que est√©n interesados ‚Äã‚Äãen el aprendizaje profundo, que quieran usar diferentes m√©todos de las bibliotecas pytor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Distribuya uniformemente los puntos a trav√©s de la esfera en pytorch y tensorflow</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/hh/blog/424227/"><p>  Este texto est√° escrito para aquellos que est√©n interesados ‚Äã‚Äãen el aprendizaje profundo, que quieran usar diferentes m√©todos de las bibliotecas pytorch y tensorflow para minimizar la funci√≥n de muchas variables, que est√©n interesados ‚Äã‚Äãen aprender c√≥mo convertir un programa ejecutado secuencialmente en c√°lculos matriciales vectorizados realizados usando numpy.  Tambi√©n puede aprender c√≥mo hacer una caricatura a partir de datos visualizados usando PovRay y vapory. </p><br><p><img src="https://habrastorage.org/webt/kz/fa/h2/kzfah2g6zgoehvsimumi8hy9nie.jpeg"></p><a name="habracut"></a><br><h3 id="otkuda-zadacha">  ¬øDe d√≥nde es la tarea? </h3><br><blockquote>  Cada uno minimiza su funcionalidad (c) Cient√≠fico de datos an√≥nimos </blockquote><p> En <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">una de las publicaciones anteriores de nuestro blog</a> , concretamente en el p√°rrafo "Rake No. 6", hablamos sobre la tecnolog√≠a DSSM, que le permite convertir texto en vectores.  Para encontrar tal mapeo, uno necesita encontrar los coeficientes de las transformaciones lineales que minimizan la funci√≥n de p√©rdida bastante compleja.  Comprender lo que sucede cuando se aprende un modelo de este tipo es dif√≠cil debido a la gran dimensionalidad de los vectores.  Para desarrollar una intuici√≥n que le permita elegir el m√©todo de optimizaci√≥n y establecer los par√°metros de este m√©todo, puede considerar una versi√≥n simplificada de esta tarea.  Ahora deje que los vectores est√©n en nuestro espacio tridimensional habitual, luego son f√°ciles de dibujar.  Y la funci√≥n de p√©rdida ser√° el potencial de separar los puntos y atraer a la esfera de la unidad.  En este caso, la soluci√≥n al problema ser√° una distribuci√≥n uniforme de puntos sobre la esfera.  La calidad de la soluci√≥n actual es f√°cil de evaluar a simple vista. </p><br><p>  Entonces, buscaremos una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Definici√≥n de Mathworld">distribuci√≥n uniforme sobre la esfera de una</a> cantidad dada <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2">n</span></span></span><script type="math/tex" id="MathJax-Element-1"> n </script>  puntos.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Wikilibros">Tal distribuci√≥n</a> es a veces necesaria para la ac√∫stica con el fin de comprender en qu√© direcci√≥n lanzar una onda en un cristal.  Signalman: para descubrir c√≥mo poner sat√©lites en √≥rbita para lograr comunicaciones de la mejor calidad.  Meteor√≥logo: para la colocaci√≥n de estaciones de monitoreo del clima. </p><br><p>  Para algunos <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4">n</span></span></span><script type="math/tex" id="MathJax-Element-2"> n </script>  La tarea <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Respuesta de Stackoverflow con s√≥lidos plat√≥nicos">se resuelve f√°cilmente</a> .  Por ejemplo, si <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-6">n</span><span class="MJXp-mo" id="MJXp-Span-7" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-8">8</span></span></span><script type="math/tex" id="MathJax-Element-3"> n = 8 </script>  , podemos tomar el cubo y sus v√©rtices ser√°n la respuesta al problema.  Tambi√©n tenemos suerte si <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-9"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-10">n</span></span></span><script type="math/tex" id="MathJax-Element-4"> n </script>  ser√° igual al n√∫mero de v√©rtices del icosaedro, dodecaedro u otro s√≥lido plat√≥nico.  De lo contrario, la tarea no es tan simple. </p><br><p>  Para un n√∫mero suficientemente grande de puntos, hay una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="matem√°tica espiral discreta">f√≥rmula con coeficientes seleccionados emp√≠ricamente</a> , hay varias opciones m√°s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Una vez m√°s sobre la espiral.">aqu√≠</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="correcci√≥n de desniveles">aqu√≠</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Sitio web del programa de matem√°ticas">aqu√≠</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="investigaci√≥n b√°sica">aqu√≠</a> .  Pero hay una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Stackoverflow ruso">soluci√≥n</a> m√°s universal, aunque m√°s compleja, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Stackoverflow ruso">a la</a> que se dedica este art√≠culo. </p><br><p>  Resolvemos un problema muy similar al <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="La tarea de Thomson en bocetos">problema de Thomson</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="El problema de Thomson en Wikipedia">wiki</a> ).  Dispersi√≥n <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-11"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12">n</span></span></span><script type="math/tex" id="MathJax-Element-5"> n </script>  puntos al azar, y luego haz que se atraigan a una superficie, como una esfera, y se alejen unos de otros.  La atracci√≥n y la repulsi√≥n est√°n determinadas por la funci√≥n - potencial.  En el valor m√≠nimo de la funci√≥n potencial, los puntos se ubicar√°n en la esfera de la manera m√°s uniforme. </p><br><p>  Esta tarea es muy similar al proceso de aprendizaje de los modelos de aprendizaje autom√°tico (ML), durante el cual se minimiza la funci√≥n de p√©rdida.  Pero un cient√≠fico de datos generalmente observa c√≥mo disminuye un solo n√∫mero, y podemos ver c√≥mo cambia la imagen.  Si tenemos √©xito, veremos c√≥mo los puntos colocados aleatoriamente dentro del cubo con el lado 1 divergen a lo largo de la superficie de la esfera: </p><br><p><img src="https://habrastorage.org/webt/52/sl/vj/52slvj5tsk6xdd-d1ymry_lty1i.png"></p><br><p>  Esquem√°ticamente, el algoritmo para resolver el problema se puede representar de la siguiente manera.  Cada punto ubicado en un espacio tridimensional corresponde a una fila de la matriz <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-13"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14">X</span></span></span><script type="math/tex" id="MathJax-Element-6"> X </script>  .  La funci√≥n de p√©rdida se calcula a partir de esta matriz. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-15"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-16">L</span></span></span><script type="math/tex" id="MathJax-Element-7"> L </script> , cuyo valor m√≠nimo corresponde a una distribuci√≥n uniforme de puntos sobre la esfera.  El valor m√≠nimo se encuentra usando las <code>tensorflow</code> <code>pytorch</code> y <code>tensorflow</code> , que permiten calcular el gradiente de la funci√≥n de p√©rdida por la matriz <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-17"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-18">X</span></span></span><script type="math/tex" id="MathJax-Element-8"> X </script>  y bajar al m√≠nimo utilizando uno de los m√©todos implementados en la biblioteca: SGD, ADAM, ADAGRAD, etc. </p><br><p><img src="https://habrastorage.org/webt/aq/ol/q_/aqolq_qbiybgyykwurj9dzap1nw.png"></p><br><h3 id="schitaem-potencial">  Consideramos el potencial </h3><br><p>  Debido a su simplicidad, expresividad y capacidad para servir como interfaz para bibliotecas escritas en otros idiomas, Python es ampliamente utilizado para resolver problemas de aprendizaje autom√°tico.  Por lo tanto, los ejemplos de c√≥digo en este art√≠culo est√°n escritos en Python.  Para c√°lculos r√°pidos de matriz, usaremos la biblioteca numpy.  Para minimizar la funci√≥n de muchas variables: pytorch y tensorflow. </p><br><p>  Dispersamos al azar puntos en el cubo con el lado 1. Tengamos 500 puntos, y la interacci√≥n el√°stica es 1000 veces m√°s significativa que la electrost√°tica: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np n = <span class="hljs-number"><span class="hljs-number">500</span></span> k = <span class="hljs-number"><span class="hljs-number">1000</span></span> X = np.random.rand(n, <span class="hljs-number"><span class="hljs-number">3</span></span>)</code> </pre> <br><p>  Este c√≥digo gener√≥ una matriz <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-19"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20">X</span></span></span><script type="math/tex" id="MathJax-Element-9"> X </script>  el tama√±o <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-21"><span class="MJXp-mn" id="MJXp-Span-22">3</span><span class="MJXp-mtext" id="MJXp-Span-23">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-25">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-26">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-27">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-28">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-29">n</span></span></span><script type="math/tex" id="MathJax-Element-10"> 3 \ veces n </script>  lleno de n√∫meros aleatorios del 0 al 1: </p><br><p><img src="https://habrastorage.org/webt/vn/vf/s-/vnvfs-cf0qee5vhmzn3vwidsn64.png"></p><br><p>  Suponemos que cada fila de esta matriz corresponde a un punto.  Y en tres columnas se registran las coordenadas. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-30"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-31">x</span><span class="MJXp-mo" id="MJXp-Span-32" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-33">y</span><span class="MJXp-mo" id="MJXp-Span-34" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-35">z</span></span></span><script type="math/tex" id="MathJax-Element-11"> x, y, z </script>  Todos nuestros puntos. </p><br><p>  El potencial de interacci√≥n el√°stica de un punto con la superficie de una esfera unitaria. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-36"><span class="MJXp-msubsup" id="MJXp-Span-37"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-38" style="margin-right: 0.05em;">u</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-39" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-40" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-41">k</span><span class="MJXp-mtext" id="MJXp-Span-42">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-43">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-45">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-46">t</span><span class="MJXp-mo" id="MJXp-Span-47" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-48">1</span><span class="MJXp-mo" id="MJXp-Span-49" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-50">r</span><span class="MJXp-msubsup" id="MJXp-Span-51"><span class="MJXp-mo" id="MJXp-Span-52" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-53" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mrow" id="MJXp-Span-54"><span class="MJXp-mo" id="MJXp-Span-55" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mn" id="MJXp-Span-56">2</span></span></span><script type="math/tex" id="MathJax-Element-12"> u_1 = k \ cdot (1 - r) ^ 2/2 </script>  .  Potencial de interacci√≥n electrost√°tica de puntos <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-57"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-58">p</span></span></span><script type="math/tex" id="MathJax-Element-13"> p </script>  y <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60">q</span></span></span><script type="math/tex" id="MathJax-Element-14"> q </script>  - <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-61"><span class="MJXp-msubsup" id="MJXp-Span-62"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-63" style="margin-right: 0.05em;">u</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-64" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-65" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-66">1</span><span class="MJXp-mrow" id="MJXp-Span-67"><span class="MJXp-mo" id="MJXp-Span-68" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mrow" id="MJXp-Span-69"><span class="MJXp-mo" id="MJXp-Span-70" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-msubsup" id="MJXp-Span-71"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-72" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-73" style="vertical-align: -0.4em;">p</span></span><span class="MJXp-mo" id="MJXp-Span-74" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-msubsup" id="MJXp-Span-75"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-76" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-77" style="vertical-align: -0.4em;">q</span></span><span class="MJXp-mrow" id="MJXp-Span-78"><span class="MJXp-mo" id="MJXp-Span-79" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mrow" id="MJXp-Span-80"><span class="MJXp-mo" id="MJXp-Span-81" style="margin-left: 0em; margin-right: 0em;">$</span></span></span></span><script type="math/tex" id="MathJax-Element-15"> u_2 = 1 / | r_p - r_q | $ </script>  .  El potencial completo consiste en la interacci√≥n electrost√°tica de todos los pares de puntos y la interacci√≥n el√°stica de cada punto con la superficie de la esfera: </p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-82"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-83">U</span><span class="MJXp-mo" id="MJXp-Span-84" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-85"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-86" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-87" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-88" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-89" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-90" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-91" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-92" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-93"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-94" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-95" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-96" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-97" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-98">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-99">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-100">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-101">m</span><span class="MJXp-mtext" id="MJXp-Span-102">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-103">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-104">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-105">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-106">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-107">t</span><span class="MJXp-msubsup" id="MJXp-Span-108"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-109" style="margin-right: 0.05em;">s</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-114"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-115">n</span><span class="MJXp-mo" id="MJXp-Span-116">‚àí</span><span class="MJXp-mn" id="MJXp-Span-117">1</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-110"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-111">p</span><span class="MJXp-mo" id="MJXp-Span-112">=</span><span class="MJXp-mn" id="MJXp-Span-113">1</span></span></span></span></span></span></span><span class="MJXp-mtext" id="MJXp-Span-118">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-119">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-120">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-121">m</span><span class="MJXp-mtext" id="MJXp-Span-122">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-123">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-124">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-125">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-126">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127">t</span><span class="MJXp-msubsup" id="MJXp-Span-128"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-129" style="margin-right: 0.05em;">s</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-136"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-137">n</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-130"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-131">q</span><span class="MJXp-mo" id="MJXp-Span-132">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-133">p</span><span class="MJXp-mo" id="MJXp-Span-134">+</span><span class="MJXp-mn" id="MJXp-Span-135">1</span></span></span></span></span></span></span><span class="MJXp-mtext" id="MJXp-Span-138">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-139">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-140">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-141">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-142">c</span><span class="MJXp-mn" id="MJXp-Span-143">1</span><span class="MJXp-mrow" id="MJXp-Span-144"><span class="MJXp-mtext" id="MJXp-Span-145">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-146">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-147">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-148">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-149">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-150">E</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-151">l</span><span class="MJXp-mrow" id="MJXp-Span-152"><span class="MJXp-mo" id="MJXp-Span-153" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mtext" id="MJXp-Span-154">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-155">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-156">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-157">c</span><span class="MJXp-mrow" id="MJXp-Span-158"><span class="MJXp-msubsup" id="MJXp-Span-159"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-160" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-161" style="vertical-align: -0.4em;">p</span></span></span><span class="MJXp-mo" id="MJXp-Span-162" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mtext" id="MJXp-Span-163">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-164">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-165">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-166">c</span><span class="MJXp-mrow" id="MJXp-Span-167"><span class="MJXp-msubsup" id="MJXp-Span-168"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-169" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-170" style="vertical-align: -0.4em;">q</span></span></span><span class="MJXp-mtext" id="MJXp-Span-171">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-172">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-173">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-174">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-175">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-176">t</span><span class="MJXp-mrow" id="MJXp-Span-177"><span class="MJXp-mo" id="MJXp-Span-178" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span></span><span class="MJXp-mo" id="MJXp-Span-179" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-180">k</span><span class="MJXp-mtext" id="MJXp-Span-181">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-182">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-183">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-184">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-185">t</span><span class="MJXp-mtext" id="MJXp-Span-186">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-187">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-188">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-189">m</span><span class="MJXp-mtext" id="MJXp-Span-190">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-191">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-192">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-193">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-194">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-195">t</span><span class="MJXp-msubsup" id="MJXp-Span-196"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-197" style="margin-right: 0.05em;">s</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-202">n</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-198"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-199">p</span><span class="MJXp-mo" id="MJXp-Span-200">=</span><span class="MJXp-mn" id="MJXp-Span-201">1</span></span></span></span></span></span></span><span class="MJXp-mtext" id="MJXp-Span-203">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-204">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-205">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-206">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-207">t</span><span class="MJXp-mo" id="MJXp-Span-208" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-209">1</span><span class="MJXp-mo" id="MJXp-Span-210" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mrow" id="MJXp-Span-211"><span class="MJXp-mo" id="MJXp-Span-212" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mtext" id="MJXp-Span-213">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-214">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-215">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-216">c</span><span class="MJXp-mrow" id="MJXp-Span-217"><span class="MJXp-msubsup" id="MJXp-Span-218"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-219" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-220" style="vertical-align: -0.4em;">p</span></span></span><span class="MJXp-mrow" id="MJXp-Span-221"><span class="MJXp-mo" id="MJXp-Span-222" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mtext" id="MJXp-Span-223">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-224">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-225">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-226">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-227">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-228">t</span><span class="MJXp-msubsup" id="MJXp-Span-229"><span class="MJXp-mo" id="MJXp-Span-230" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-231" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mtext" id="MJXp-Span-232">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-233">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-234">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-235">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-236">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-237">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-238">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-239">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-240">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-241">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-242">w</span><span class="MJXp-mtext" id="MJXp-Span-243">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-244">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-245">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-246">n</span></span></span><script type="math/tex;mode=display" id="MathJax-Element-16"> U (x_1, ..., x_n) = \ sum \ limits _ {p = 1} ^ {n - 1} \ sum \ limits _ {q = p + 1} ^ {n} \ frac 1 {\ left El | \ vec {x_p} - \ vec {x_q} \ right | } + k \ cdot \ sum \ limits _ {p = 1} ^ n \ left (1 - | \ vec {x_p} | \ right) ^ 2 \ rightarrow \ min </script></p><br><p>  En principio, el valor potencial se puede calcular usando esta f√≥rmula: </p><br><pre> <code class="python hljs">L_for = <span class="hljs-number"><span class="hljs-number">0</span></span> L_for_inv = <span class="hljs-number"><span class="hljs-number">0</span></span> L_for_sq = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(n): p_distance = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">3</span></span>): p_distance += x[p, i]**<span class="hljs-number"><span class="hljs-number">2</span></span> p_distance = math.sqrt(p_distance) L_for_sq += k * (<span class="hljs-number"><span class="hljs-number">1</span></span> - p_distance)**<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-comment"><span class="hljs-comment">#     ,     for q in range(p + 1, n): if q != p: pq_distance = 0 for i in range(3): pq_distance += (x[p, i] - x[q, i]) ** 2 pq_distance = math.sqrt(pq_distance) L_for_inv += 1 / pq_distance #      L_for = (L_for_inv + L_for_sq) / n print('loss =', L_for)</span></span></code> </pre> <br><p>  Pero hay un peque√±o problema.  Por unos pat√©ticos 2000 puntos, este programa se ejecutar√° durante 2 segundos.  Ser√° mucho m√°s r√°pido si calculamos este valor utilizando c√°lculos matriciales vectorizados.  La aceleraci√≥n se logra tanto mediante la implementaci√≥n de operaciones matriciales utilizando los lenguajes "r√°pidos" fortran y C, como mediante el uso de operaciones de procesador vectorizadas que permiten realizar una acci√≥n sobre una gran cantidad de datos de entrada en un ciclo de reloj. </p><br><p>  Veamos la matriz. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-247"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-248">S</span><span class="MJXp-mo" id="MJXp-Span-249" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-250">X</span><span class="MJXp-mtext" id="MJXp-Span-251">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-252">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-253">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-254">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-255">t</span><span class="MJXp-msubsup" id="MJXp-Span-256"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-257" style="margin-right: 0.05em;">X</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-258" style="vertical-align: 0.5em;">T</span></span></span></span><script type="math/tex" id="MathJax-Element-17"> S = X \ cdot X ^ T </script>  .  Tiene muchas propiedades interesantes y a menudo se encuentra en c√°lculos relacionados con la teor√≠a de clasificadores lineales en ML.  Entonces, si suponemos que en la fila de la matriz <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-259"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-260">X</span></span></span><script type="math/tex" id="MathJax-Element-18"> X </script>  con √≠ndices <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-261"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-262">p</span></span></span><script type="math/tex" id="MathJax-Element-19"> p </script>  y <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-263"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-264">q</span></span></span><script type="math/tex" id="MathJax-Element-20"> q </script>  los vectores espaciales tridimensionales se escriben <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-265"><span class="MJXp-mtext" id="MJXp-Span-266">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-267">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-268">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-269">c</span><span class="MJXp-mrow" id="MJXp-Span-270"><span class="MJXp-msubsup" id="MJXp-Span-271"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-272" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-273" style="vertical-align: -0.4em;">p</span></span></span><span class="MJXp-mo" id="MJXp-Span-274" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-275">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-276">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-277">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-278">c</span><span class="MJXp-mrow" id="MJXp-Span-279"><span class="MJXp-msubsup" id="MJXp-Span-280"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-281" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-282" style="vertical-align: -0.4em;">q</span></span></span></span></span><script type="math/tex" id="MathJax-Element-21"> \ vec {r _ p}, \ vec {r_q} </script>  entonces la matriz <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-283"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-284">S</span></span></span><script type="math/tex" id="MathJax-Element-22"> S </script>  consistir√° en productos escalares de estos vectores.  Tales vectores <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-285"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-286">n</span></span></span><script type="math/tex" id="MathJax-Element-23"> n </script>  piezas, luego la dimensi√≥n de la matriz <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-287"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-288">S</span></span></span><script type="math/tex" id="MathJax-Element-24"> S </script>  es igual a <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-289"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-290">n</span><span class="MJXp-mtext" id="MJXp-Span-291">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-292">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-293">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-294">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-295">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-296">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-297">n</span></span></span><script type="math/tex" id="MathJax-Element-25"> n \ veces n </script>  . </p><br><p><img src="https://habrastorage.org/webt/kh/bw/ct/khbwctgydbzj51g5qwybvxtr9wo.png"></p><br><p>  En la diagonal de la matriz <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-298"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-299">S</span></span></span><script type="math/tex" id="MathJax-Element-26"> S </script>  colocar cuadrados de longitudes de vectores <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-300"><span class="MJXp-mtext" id="MJXp-Span-301">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-302">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-303">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-304">c</span><span class="MJXp-mrow" id="MJXp-Span-305"><span class="MJXp-msubsup" id="MJXp-Span-306"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-307" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-308" style="vertical-align: -0.4em;">p</span></span></span><span class="MJXp-mo" id="MJXp-Span-309" style="margin-left: 0.111em; margin-right: 0.167em;">:</span><span class="MJXp-msubsup" id="MJXp-Span-310"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-311" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-312" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-313">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-314">p</span></span></span><span class="MJXp-mo" id="MJXp-Span-315" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-316"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-317" style="margin-right: 0.05em;">r</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-319">2</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-318">p</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-27"> \ vec {r_p}: s_ {p p} = r_p ^ 2 </script>  .  Sabiendo esto, consideremos todo el potencial de interacci√≥n.  Comenzamos calculando dos matrices auxiliares.  En una matriz diagonal <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-320"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-321">S</span></span></span><script type="math/tex" id="MathJax-Element-28"> S </script>  se repetir√° en filas, en otra, en columnas. </p><br><p><img src="https://habrastorage.org/webt/ms/np/ps/msnppskk5fbczwgqvelu3jgeo80.png"></p><br><p>  Ahora veamos el valor de la expresi√≥n <code>p_roll + q_roll - 2 * S</code> </p><br><p><img src="https://habrastorage.org/webt/cc/py/ii/ccpyiidioj3yrxqnpxxbuyt8ht0.png"></p><br><p>  Art√≠culo indexado <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-322"><span class="MJXp-mo" id="MJXp-Span-323" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-324">p</span><span class="MJXp-mo" id="MJXp-Span-325" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-326">q</span><span class="MJXp-mo" id="MJXp-Span-327" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-29"> (p, q) </script>  matriz <code>sq_dist</code> es igual <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-328"><span class="MJXp-msubsup" id="MJXp-Span-329"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-330" style="margin-right: 0.05em;">r</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-332">2</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-331">p</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-333" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-334"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-335" style="margin-right: 0.05em;">r</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-337">2</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-336">q</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-338" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mn" id="MJXp-Span-339">2</span><span class="MJXp-mtext" id="MJXp-Span-340">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-341">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-342">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-343">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-344">t</span><span class="MJXp-mo" id="MJXp-Span-345" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mtext" id="MJXp-Span-346">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-347">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-348">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-349">c</span><span class="MJXp-mrow" id="MJXp-Span-350"><span class="MJXp-msubsup" id="MJXp-Span-351"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-352" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-353" style="vertical-align: -0.4em;">p</span></span></span><span class="MJXp-mo" id="MJXp-Span-354" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-355">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-356">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-357">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-358">c</span><span class="MJXp-mrow" id="MJXp-Span-359"><span class="MJXp-msubsup" id="MJXp-Span-360"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-361" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-362" style="vertical-align: -0.4em;">q</span></span></span><span class="MJXp-mo" id="MJXp-Span-363" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-364" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-365" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mtext" id="MJXp-Span-366">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-367">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-368">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-369">c</span><span class="MJXp-mrow" id="MJXp-Span-370"><span class="MJXp-msubsup" id="MJXp-Span-371"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-372" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-373" style="vertical-align: -0.4em;">p</span></span></span><span class="MJXp-mo" id="MJXp-Span-374" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mtext" id="MJXp-Span-375">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-376">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-377">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-378">c</span><span class="MJXp-mrow" id="MJXp-Span-379"><span class="MJXp-msubsup" id="MJXp-Span-380"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-381" style="margin-right: 0.05em;">r</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-382" style="vertical-align: -0.4em;">q</span></span></span><span class="MJXp-msubsup" id="MJXp-Span-383"><span class="MJXp-mo" id="MJXp-Span-384" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-385" style="vertical-align: 0.5em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-30"> r_p ^ 2 + r_q ^ 2 - 2 \ cdot (\ vec {r_p}, \ vec {r_q}) = (\ vec {r_p} - \ vec {r_q}) ^ 2 </script>  .  Es decir, tenemos una matriz de cuadrados de distancias entre puntos. </p><br><h3 id="elektrostaticheskoe-ottalkivanie-na-sfere">  Repulsi√≥n electrost√°tica en una esfera. </h3><br><p>  <code>dist = np.sqrt(sq_dist)</code> - matriz de distancias entre puntos.  Necesitamos calcular el potencial, teniendo en cuenta la repulsi√≥n de puntos entre ellos y la atracci√≥n hacia la esfera.  Coloque las unidades en diagonal y reemplace cada elemento con el inverso (¬°no piense que invertimos la matriz!): <code>rec_dist_one = 1 / (dist + np.eye(n))</code> .  El resultado es una matriz en la diagonal de la cual hay unidades, otros elementos son los potenciales de la interacci√≥n electrost√°tica entre los puntos. </p><br><p>  Ahora agregamos el potencial cuadr√°tico de atracci√≥n a la superficie de la esfera de la unidad.  La distancia desde la superficie de la esfera. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-386"><span class="MJXp-mo" id="MJXp-Span-387" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-388">1</span><span class="MJXp-mo" id="MJXp-Span-389" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-390">r</span><span class="MJXp-mo" id="MJXp-Span-391" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-31"> (1 - r) </script>  .  Aj√∫stalo y multipl√≠calo por <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-392"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-393">k</span></span></span><script type="math/tex" id="MathJax-Element-32"> k </script>  , que define la relaci√≥n entre el papel de la repulsi√≥n electrost√°tica de part√≠culas y la atracci√≥n de una esfera.  Total <code>k = 1000</code> , <code>all_interactions = rec_dist_one - torch.eye(n) + (d.sqrt() - torch.ones(n))**2</code> .  La funci√≥n de p√©rdida tan esperada, que minimizaremos: <code>t = all_interactions.sum()</code> </p><br><p>  Un programa que calcula el potencial usando la biblioteca numpy: </p><br><pre> <code class="python hljs">S = X.dot(XT) <span class="hljs-comment"><span class="hljs-comment">#    pp_sq_dist = np.diag(S) #  p_roll = pp_sq_dist.reshape(1, -1).repeat(n, axis=0) #     q_roll = pp_sq_dist.reshape(-1, 1).repeat(n, axis=1) #     pq_sq_dist = p_roll + q_roll - 2 * S #      pq_dist = np.sqrt(pq_sq_dist) #    pp_dist = np.sqrt(pp_sq_dist) #      surface_dist_sq = (pp_dist - np.ones(n)) ** 2 #       rec_pq_dist = 1 / (pq_dist + np.eye(n)) - np.eye(n) #      L_np_rec = rec_pq_dist.sum() / 2 #     L_np_surf = k * surface_dist_sq.sum() #       L_np = (L_np_rec + L_np_surf) / n #   ,     print('loss =', L_np)</span></span></code> </pre> <br><p>  Aqu√≠ las cosas est√°n un poco mejor: 200 ms en 2000 puntos. </p><br><p>  Usamos pytorch: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> torch pt_x = torch.from_numpy(X) <span class="hljs-comment"><span class="hljs-comment"># pt_x -   tensor   pytorch pt_S = pt_x.mm(pt_x.transpose(0, 1)) # mm - matrix multiplication pt_pp_sq_dist = pt_S.diag() pt_p_roll = pt_pp_sq_dist.repeat(n, 1) pt_q_roll = pt_pp_sq_dist.reshape(-1, 1).repeat(1, n) pt_pq_sq_dist = pt_p_roll + pt_q_roll - 2 * pt_S pt_pq_dist = pt_pq_sq_dist.sqrt() pt_pp_dist = pt_pp_sq_dist.sqrt() pt_surface_dist_sq = (pt_pp_dist - torch.ones(n, dtype=torch.float64)) ** 2 pt_rec_pq_dist = 1/ (pt_pq_dist + torch.eye(n, dtype=torch.float64)) - torch.eye(n, dtype=torch.float64) L_pt = (pt_rec_pq_dist.sum() / 2 + k * pt_surface_dist_sq.sum()) / n print('loss =', float(L_pt))</span></span></code> </pre> <br><p>  Y finalmente tensorflow: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tensorflow <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> tf tf_x = tf.placeholder(name=<span class="hljs-string"><span class="hljs-string">'x'</span></span>, dtype=tf.float64) tf_S = tf.matmul(tf_x, tf.transpose(tf_x)) tf_pp_sq_dist = tf.diag_part(tf_S) tf_p_roll = tf.tile(tf.reshape(tf_pp_sq_dist, (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>)), (n, <span class="hljs-number"><span class="hljs-number">1</span></span>)) tf_q_roll = tf.tile(tf.reshape(tf_pp_sq_dist, (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)), (<span class="hljs-number"><span class="hljs-number">1</span></span>, n)) tf_pq_sq_dist = tf_p_roll + tf_q_roll - <span class="hljs-number"><span class="hljs-number">2</span></span> * tf_S tf_pq_dist = tf.sqrt(tf_pq_sq_dist) tf_pp_dist = tf.sqrt(tf_pp_sq_dist) tf_surface_dist_sq = (tf_pp_dist - tf.ones(n, dtype=tf.float64)) ** <span class="hljs-number"><span class="hljs-number">2</span></span> tf_rec_pq_dist = <span class="hljs-number"><span class="hljs-number">1</span></span> / (tf_pq_dist + tf.eye(n, dtype=tf.float64)) - tf.eye(n, dtype=tf.float64) L_tf = (tf.reduce_sum(tf_rec_pq_dist) / <span class="hljs-number"><span class="hljs-number">2</span></span> + k * tf.reduce_sum(tf_surface_dist_sq)) / n glob_init = tf.local_variables_initializer() <span class="hljs-comment"><span class="hljs-comment">#     with tf.Session() as tf_s: #     glob_init.run() #   res, = tf_s.run([L_tf], feed_dict={tf_x: x}) #   print(res)</span></span></code> </pre> <br><p>  Compare el rendimiento de estos tres enfoques: </p><br><table><tbody><tr><td>  N </td><td>  pit√≥n </td><td>  numpy </td><td>  Pytorch </td><td>  Tensorflow </td></tr><tr><td>  2000 </td><td>  4.03 </td><td>  0,083 </td><td>  1.11 </td><td>  0,205 </td></tr><tr><td>  10,000 </td><td>  99 </td><td>  2,82 </td><td>  2,18 </td><td>  7,9 </td></tr></tbody></table><br><p>  Los c√°lculos vectorizados dan una ganancia de m√°s de un orden decimal y medio en relaci√≥n con el c√≥digo de Python puro.  La "placa de la caldera" en pytorch es visible: los c√°lculos de vol√∫menes peque√±os toman una cantidad de tiempo notable, pero casi no cambian con el aumento del volumen de los c√°lculos. </p><br><h3 id="vizualizaciya">  Visualizaci√≥n </h3><br><p>  Hoy en d√≠a, los datos se pueden visualizar utilizando una gran cantidad de paquetes, como Matlab, Wolfram Mathematica, Maple, Matplotlib, etc., etc. En estos paquetes hay muchas funciones complejas que hacen cosas complejas.  Desafortunadamente, si te enfrentas a una tarea simple pero no est√°ndar, te encuentras desarmado.  Mi soluci√≥n favorita en esta situaci√≥n es povray.  Este es un programa muy poderoso que generalmente se usa para crear im√°genes fotorrealistas, pero se puede usar como un "ensamblador de visualizaci√≥n".  Por lo general, no importa cu√°n dif√≠cil sea la superficie que desea mostrar, solo p√≠dale a povray que dibuje esferas con centros en esa superficie. </p><br><p>  Usando la biblioteca de vapor, puede crear una escena povray directamente en python, renderizarla y ver el resultado.  Ahora se ve as√≠: </p><br><p><img src="https://habrastorage.org/webt/fh/1j/6x/fh1j6xkcdedx1m4s0x9clmsgjse.gif"></p><br><p>  La imagen se obtiene de la siguiente manera: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vapory <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PIL <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Image <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_scene</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(moment)</span></span></span><span class="hljs-function">:</span></span> angle = <span class="hljs-number"><span class="hljs-number">2</span></span> * math.pi * moment / <span class="hljs-number"><span class="hljs-number">360</span></span> r_camera = <span class="hljs-number"><span class="hljs-number">7</span></span> camera = vapory.Camera(<span class="hljs-string"><span class="hljs-string">'location'</span></span>, [r_camera * math.cos(angle), <span class="hljs-number"><span class="hljs-number">1.5</span></span>, r_camera * math.sin(angle)], <span class="hljs-string"><span class="hljs-string">'look_at'</span></span>, [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">'angle'</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>) light1 = vapory.LightSource([<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">-3</span></span>], <span class="hljs-string"><span class="hljs-string">'color'</span></span>, [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) light2 = vapory.LightSource([<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-string"><span class="hljs-string">'color'</span></span>, [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) plane = vapory.Plane([<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">-1</span></span>, vapory.Pigment(<span class="hljs-string"><span class="hljs-string">'color'</span></span>, [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>])) box = vapory.Box([<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>], vapory.Pigment(<span class="hljs-string"><span class="hljs-string">'Col_Glass_Clear'</span></span>), vapory.Finish(<span class="hljs-string"><span class="hljs-string">'F_Glass9'</span></span>), vapory.Interior(<span class="hljs-string"><span class="hljs-string">'I_Glass1'</span></span>)) spheres = [vapory.Sphere( [float(r[<span class="hljs-number"><span class="hljs-number">0</span></span>]), float(r[<span class="hljs-number"><span class="hljs-number">1</span></span>]), float(r[<span class="hljs-number"><span class="hljs-number">2</span></span>])], <span class="hljs-number"><span class="hljs-number">0.05</span></span>, vapory.Texture(vapory.Pigment(<span class="hljs-string"><span class="hljs-string">'color'</span></span>, [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]))) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> r <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> x] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vapory.Scene(camera, objects=[light1, light2, plane, box] + spheres, included=[<span class="hljs-string"><span class="hljs-string">'glass.inc'</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">360</span></span>): flnm = <span class="hljs-string"><span class="hljs-string">'out/sphere_{:03}.png'</span></span>.format(t) scene = create_scene(t) scene.render(flnm, width=<span class="hljs-number"><span class="hljs-number">800</span></span>, height=<span class="hljs-number"><span class="hljs-number">600</span></span>, remove_temp=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) clear_output() display(Image.open(flnm))</code> </pre> <br><p>  A partir de un mont√≥n de archivos, los gifs animados se ensamblan usando ImageMagic: </p><br><pre> <code class="bash hljs">convert -delay 10 -loop 0 sphere_*.png sphere_all.gif</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">En github</a> puedes ver el c√≥digo de trabajo, cuyos fragmentos se dan aqu√≠.  En el segundo art√≠culo, hablar√© sobre c√≥mo comenzar a minimizar lo funcional para que los puntos salgan del cubo y se distribuyan uniformemente por la esfera. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es424227/">https://habr.com/ru/post/es424227/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es424209/index.html">Wireless Grace: revisi√≥n de los auriculares Snom A170</a></li>
<li><a href="../es424211/index.html">Comprensi√≥n de la interfaz de almacenamiento de contenedores (en Kubernetes y m√°s)</a></li>
<li><a href="../es424215/index.html">Olmo C√≥modo e inc√≥modo</a></li>
<li><a href="../es424217/index.html">Razonamiento para guerras santas, as√≠ como una s√∫plica por la paz</a></li>
<li><a href="../es424223/index.html">Clientes desechables. Segmentaci√≥n para compras repetidas</a></li>
<li><a href="../es424229/index.html">Kubernetes en producci√≥n: servicios</a></li>
<li><a href="../es424231/index.html">C√≥mo ganar dinero con los hosters</a></li>
<li><a href="../es424233/index.html">Computadora ense√±ada a detectar demencia con una precisi√≥n del 93%</a></li>
<li><a href="../es424235/index.html">C√≥mo usar STATSPACK en lugar de AWR en Oracle Standard Edition</a></li>
<li><a href="../es424237/index.html">¬°Carga tus cerebros directamente! Tiempos de ejecuci√≥n, compiladores y rendimiento en Joker 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>