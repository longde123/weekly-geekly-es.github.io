<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧘🏿 📍 😜 Parpadea con LED antiguos o cuando advertimos de "incendios" en el proyecto 👨🏾 🙆🏽 🏜️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La rutina es un campo enorme para la automatización. Si una tarea requiere mucha energía, requiere perseverancia y se repite de vez en cuando, esta es...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Parpadea con LED antiguos o cuando advertimos de "incendios" en el proyecto</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/2gis/blog/438106/"><p><img src="https://habrastorage.org/webt/29/ky/np/29kynpsxkjuzjwdby5s9o7czujw.png"></p><br><p>  La rutina es un campo enorme para la automatización.  Si una tarea requiere mucha energía, requiere perseverancia y se repite de vez en cuando, esta es una señal segura de que se deben tomar un par de pasos para reducir este dolor recurrente.  Y puede convertir la implementación en un buen technofanchik. </p><br><p>  Hoy hablaré sobre la automatización del sistema de alerta, monitoreo y alertas.  Debajo del corte, una luz intermitente polaca en 1984 y ni un solo disparo fallido.  El código y las instrucciones de montaje están incluidos. </p><a name="habracut"></a><br><p>  Recientemente cumplí 8 años.  8 años desde que trabajo en 2GIS.  En esta ocasión, un amigo preguntó: “¿Cómo aguantas tanto tiempo?  ¿No había deseo de probar algo nuevo? </p><br><p> Surgió.  Y aún surge.  Y todavía lo intentas.  Me pruebo en nuevos roles, equipos, tecnologías.  Por que no  Después de todo, el trabajo no es solo y no se trata tanto de "venir a las 9:00, abrir un administrador de tareas y asumir otra tarea, ir a casa a las 18:00" y ni siquiera "¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡  Nuevamente somos DDoS'yat, vamos a presionar request_limit aquí mismo, y aquí vamos a sacudir las IP, y aquí ... Oh, ¿cómo es que ya son las 3 de la mañana? "  Todo esto está mal.  El trabajo se trata del equipo, las relaciones, las reuniones nocturnas en la cocina.  Sobre tareas interesantes y un ambiente de vida confortable, después de todo.  Todo mata la indiferencia y la rutina.  No sé cómo trabajar con el primero, no me di cuenta por mí mismo, pero les contaré sobre el segundo. </p><br><p>  Hoy nos saldremos de los caminos trillados: un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">semáforo en la oficina</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">y uno más</a> ;  y automatizar alertas, monitoreo y alertas.  Pero para hacer el próximo semáforo para el servidor de compilación, se fue.  Tenemos muchas construcciones, sucursales y pruebas, pero no queremos robar el depósito de la policía de tránsito por una docena de semáforos.  ¡Visualizaremos los "fuegos"! </p><br><h1>  Sistema de monitoreo estándar </h1><br><p><img src="https://habrastorage.org/webt/hp/q0/ct/hpq0ctxkqoknb410zxwps-ceyhs.jpeg"></p><br><p>  Aquí hay una pantalla típica que cuelga en nuestra oficina.  El 95% del tiempo, muestra cuán animado es nuestro proyecto y qué le sucede.  Paralelamente, hay un canal en Slack con notificaciones de lanzamientos y errores. </p><br><p>  Para no distraer a todo el equipo, se nombra a un oficial de servicio durante una semana, que actúa como maestro de liberación y se dispara a sí mismo si sucede algo terrible.  Su tarea es descubrir lo que sucedió, y arreglarlo usted mismo, o encontrar a alguien que lo arregle. </p><br><p>  También utilizamos este monitor para las reuniones diarias: abrimos el tablero de Kanban en Jira y nos vamos. </p><br><h1>  Que esta mal </h1><br><p>  El estado de servicio no cancela las tareas de trabajo.  Si la persona responsable de los incendios vagó demasiado lejos en los pasillos de su mente, el resultado puede ser menos operativo de lo requerido.  Esto llevó a la idea de que para una felicidad completa necesitamos una advertencia más significativa que las notificaciones interminables de Slack. </p><br><h1>  ¡Automatízalo! </h1><br><p>  La idea se hizo más fuerte cuando se descubrió en el Avito un excelente flasher polaco vintage de 1984.  Si hay un incendio en alguna parte, ¡entonces encienda esto!  La cosa fue prometida incluso en condiciones casi de trabajo.  500 rublos y ella está en mi mochila.  Así que agreguemos un poco de IoT hype y bocetos arduino. </p><br><p><img src="https://habrastorage.org/webt/6u/hg/ty/6uhgtyey8v4painxacw_ufdqog4.png"></p><br><h1>  Plan de acción </h1><br><p>  ¡El plan era simple y brillante!  Tomamos una fuente de alimentación de 12 voltios, agregamos un Sonoff SV - esp8266 con un relé y todos los flejes y la alimentación necesarios de 12 voltios.  Estamos parpadeando algo como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://wifi-iot.ru/</a> , atrapamos una luz intermitente: ¡lucro!  Tenemos un dispositivo conectado a través de Wi-Fi con una API REST y otras 1000 funciones. </p><br><h1>  Sobre gastos </h1><br><p><img src="https://habrastorage.org/webt/xf/sw/4j/xfsw4jknxqlkun2ol0dvj_q4baa.png"></p><br><p>  Cable de alimentación con un enchufe plano de la radio de una abuela o del mercado de productos de radio más cercano: 60 rublos <br>  Fuente de alimentación 12v 10w con Aliexpress o todos los mismos productos de radio - 260 rublos <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sonoff SV</a> - $ 4.85 + envío <br>  Flasher vintage - no tiene precio (500 rublos) </p><br><h1>  Opinión corporativa de Wi-Fi </h1><br><p>  Para acciones tan audaces, el Wi-Fi corporativo con certificados EAP-PEAP y otras palabras aterradoras dijeron "¡No pasarás!". </p><br><p><img src="https://habrastorage.org/webt/oy/n-/nt/oyn-nth-sypocgf1vdx0hxz8fuq.jpeg"></p><br><p>  Puede arremangarse, google <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/esp8266/Arduino/issues/1032</a> , tome un SDK nuevo y escriba todo usted mismo rápidamente.  Pero entonces el tecnofanch se convierte en una larga excavación y debate.  Pospondré esta opción hasta el lanzamiento de la versión 2.0, mejorada y reparada. </p><br><h1>  Productos blandos </h1><br><p>  Tome el amado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">olartamonov</a> Arduino, una dispersión de lo que ha estado desempolvando en cajones durante N años, y recoja un monstruo de Frankenstein.  Un almacén de piezas para el hogar será suficiente para verificar la viabilidad del MVP y desecharlo después de depurar la hermosa y brillante versión 2.0. </p><br><p><img src="https://habrastorage.org/webt/ac/om/-9/acom-9r68ntrxwj6ag8ii0ysvhe.jpeg"></p><br><p>  La solución es torpe: Arduino se conecta a la red a través de Ethernet, recibe IP a través de DHCP, escucha las solicitudes HTTP y parpadea el "LED".  Cualquiera en la noche puede armar una solución de este tipo de ejemplos de IDE Arduino (pero nunca, ¡escuchen, nunca la usen! Esto es un infierno). </p><br><div class="spoiler">  <b class="spoiler_title">¿Qué usar?</b> <div class="spoiler_text"><p>  Para aquellos que todavía están llorando, pinchando, pero aún comiendo un cactus, sugiero que se transfieran al menos a PlatformIO (instalado en Atom o VSCode), pero es mejor no usarlo en absoluto, sino leer un curso de conferencias sobre STM32 o algo más útil.  Y yo, tan mordido como un niño por arduinistas, terminaré mi acto sucio :) </p></div></div><br><p>  El código está publicado en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github</a> , no hay autorización, API ramificada y hermosas páginas html.  ¡Solo MVP, solo hardcore!  Use bajo su propio riesgo, advertí. </p><br><h1>  Productos sólidos </h1><br><p>  Cuando se escribe el software, es hora de iniciar una luz intermitente.  A continuación se muestra un diagrama que debería ayudar a comprender el dispositivo. </p><br><h2>  En espera: </h2><br><p><img src="https://habrastorage.org/webt/x6/oo/s9/x6oos9z3gfgyp2gk9k8hwjaann4.png"></p><br><h2>  Realidad: </h2><br><p><img src="https://habrastorage.org/webt/fo/7a/t1/fo7at166uyswi0-uhsyqianycfg.jpeg"></p><br><p>  Entonces reemplace Sonoff SV con: <br>  Arduino UNO + wiznet w5100 + Relé </p><br><p>  Conexión por pines: <br>  DIGITAL 10 - SS <br>  DIGITAL 11 - MOSI <br>  DIGITAL 12 - MISO <br>  DIGITAL 13 - SCK <br>  GND - GND <br>  5V - 5V </p><br><p>  Conectamos el relé aún más fácilmente: el pin de señal en DIGITAL 4, el cable de alimentación al intermitente lo conectamos en el espacio en C (común) y NC (normalmente cerrado). </p><br><p>  <strong>Achtung!</strong> <br>  Consulte la documentación de sus dispositivos.  ¡No es un hecho que conectando una placa Ethernet a 5 voltios no obtendrá un humo extraño cuando realice las pruebas!  En mi caso, todo es normal y el módulo está diseñado para una potencia de 5 voltios. </p><br><h1>  Productos plasticos </h1><br><p>  Un anuncio en Avito dijo que la luz intermitente estaba casi operativa.  Con los años, solo un detalle ha muerto en él: el engranaje girando el reflector. </p><br><p><img src="https://habrastorage.org/webt/sx/6j/vi/sx6jviptedu-vrq_aj7ez2jryt0.jpeg"></p><br><p>  Exhalamos, tomamos Fusion360 en nuestras manos, simulamos uno nuevo e imprimimos en una impresora 3D de oficina. </p><br><div class="spoiler">  <b class="spoiler_title">Proceso de modelado de engranajes</b> <div class="spoiler_text"><p>  Verificamos los radios y otras características del engranaje, luchamos con los parámetros de subextrusión y rebanadora <br><img src="https://habrastorage.org/webt/vm/sr/fw/vmsrfwhkdv3815zocydv9fntdyu.jpeg"></p><br><p>  Seguimos modelando <br><img src="https://habrastorage.org/webt/hp/mv/z5/hpmvz5doqty3zajkkxakgnajk_s.png"></p><br><p>  Imprimimos, probamos <br><img src="https://habrastorage.org/webt/lt/an/j2/ltanj2vww5u6phkeiv6mluezm1w.gif"></p><br><p>  Personaliza un poco más e imprime de nuevo.  Los remaches originales fueron taladrados y reemplazados con una combinación de tornillos M3 convencionales y tuercas autoblocantes.  No te olvides de agregar asientos para ellos. <br><img src="https://habrastorage.org/webt/zy/t-/nd/zyt-ndarwrrswyepbnyy96ia99o.png"></p><br><p><img src="https://habrastorage.org/webt/8e/ja/aj/8ejaajyh2kiup7bcse5wjzkzhbg.jpeg"></p></div></div><br><p>  Lubrique los engranajes, reemplace los cables, vuelva a armar, ¡funciona! </p><br><p>  Sería bueno imprimir el engranaje de nylon, pero la primera letra pequeña falló y la segunda sonda de Bestfilament ya no fue suficiente para la segunda. </p><br><h1>  Para qué estamos, ¡pase lo que pase! </h1><br><p><img src="https://habrastorage.org/webt/zr/gw/vp/zrgwvpeop5ig3rjqjqnkq0f5mnc.gif"></p><br><h4 id="kak-zastavit-migalku-vklyuchatsya-kogda-proizoshlo-chto-to-iz-ryada-von-vyhodyaschee">  ¿Cómo hacer que se encienda la luz intermitente cuando sucede algo fuera de lo común? </h4><br><p>  Elemental!  Utilizamos Grafana en el trabajo, por lo que acabamos de comenzar un nuevo canal de notificación con el tipo WebHook, que envía una solicitud para encender la luz de emergencia de acuerdo con ciertos criterios.  Se apaga después de unos segundos, para no escalar la atmósfera aún más. </p><br><p>  ¿Cuánto tiempo tomó todo este desastre?  Un par de noches, si no distraído.  Además, medio día de tiempo de trabajo para configurar la integración con otros sistemas internos. </p><br><p>  El technofanchik fue exitoso, el equipo trajo beneficios, finalmente se presentan fotos del proceso de ensamblaje. </p><br><div class="spoiler">  <b class="spoiler_title">Aquí está frente a nosotros, una luz intermitente con cables</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ez/fb/q7/ezfbq7hfzeexf6w8w9wfbjwohcu.jpeg"><br><img src="https://habrastorage.org/webt/as/qq/5-/asqq5-j3yotupe_cniquxe4psn8.jpeg"><br><img src="https://habrastorage.org/webt/p7/au/zx/p7auzx-p5ilvxb2k636yiplhb3y.jpeg"><br><img src="https://habrastorage.org/webt/y8/wb/3w/y8wb3weqcxns3azl1kq_2tbsxfg.jpeg"><br><img src="https://habrastorage.org/webt/il/qe/jf/ilqejfnwtv6dsypzxlfphpp4bik.jpeg"><br><img src="https://habrastorage.org/webt/cr/-o/qb/cr-oqbz0oz8jfeik7pydles-8h4.jpeg"></p></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/438106/">https://habr.com/ru/post/438106/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../438094/index.html">Los matices de las herramientas Target Length y Tuning Meter en PADS Professional / Xpedition</a></li>
<li><a href="../438096/index.html">Libros que vale la pena leer para cada gerente de producto</a></li>
<li><a href="../438098/index.html">Spring, bytecode, JDK: los 10 mejores informes de JBreak 2018</a></li>
<li><a href="../438100/index.html">A dónde van los datos: 12 ataques, hacks y fugas</a></li>
<li><a href="../438104/index.html">No es un blockchain</a></li>
<li><a href="../438108/index.html">SEO y contexto: ¿qué elegir y si elegir?</a></li>
<li><a href="../438110/index.html">Rieles + Postgres + enlaces</a></li>
<li><a href="../438112/index.html">Encontrar una bala de plata: actores + FRP en React</a></li>
<li><a href="../438116/index.html">Análisis del impacto ambiental de los medios musicales: música digital, grabaciones analógicas y CD.</a></li>
<li><a href="../438118/index.html">Dex-Net 4.0 permite a los robots Ambidextro elegir lo mejor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>