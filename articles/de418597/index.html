<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¶ üèπ üòÑ Funktionen zum Dokumentieren von PostgreSQL-Datenbanken. Teil drei üëºüèø üßìüèø üå¶Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dies ist der dritte Teil des Artikels, der benutzerdefinierte Funktionen f√ºr die Arbeit mit Systemverzeichnissen beschreibt: pg_class, pg_attribute, p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Funktionen zum Dokumentieren von PostgreSQL-Datenbanken. Teil drei</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418597/">  Dies ist der dritte Teil des Artikels, der benutzerdefinierte Funktionen f√ºr die Arbeit mit Systemverzeichnissen beschreibt: pg_class, pg_attribute, pg_constraints usw. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zc/rx/ta/zcrxta08dnfat5cqpgid4lyq7by.png"></div><br>  In diesem Abschnitt des Artikels werden Funktionen erl√§utert, die die <b>Eigenschaften von Sequenzen, geerbten Tabellen</b> und die <b>besonderen Eigenschaften von Tabellenattributen zur√ºckgeben</b> . <br><a name="habracut"></a><br><p>  <b>Siehe auch</b> <br>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Funktionen zum Dokumentieren von PostgreSQL-Datenbanken.</a></b>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil eins</a> ;</b> <br>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Funktionen zum Dokumentieren von PostgreSQL-Datenbanken.</a></b>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil zwei</a> ;</b> <br>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Funktionen zum Dokumentieren von PostgreSQL-Datenbanken.</a></b>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Das Ende (Teil vier)</a> .</b> <br><br>  Die erste H√§lfte des Artikels enth√§lt Kommentare zur Implementierung von Funktionen.  Der zweite ist der Quellcode der Funktionen.  F√ºr diejenigen Leser, die nur an den Ausgangstexten interessiert sind, empfehlen wir, sofort mit dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anhang fortzufahren</a> . <br><br></p><h3>  Struktur einer Funktion, die eine Liste von Merkmalen von Tabellensequenzen zur√ºckgibt </h3><br><img src="https://habrastorage.org/webt/i6/dw/f_/i6dwf_jd0ofjr-vqmeide0l1vws.png"><br>  <i>Abb.</i>  <i>2. Funktionen, von denen die Funktionen von admtf_Table_Sequences abh√§ngen</i> <br><br>  <strong>Tabelle 11. Zweck der Funktionen.</strong> <br><br><table width="95" border="1"><tbody><tr><th width="5">  Nein, nein. </th><th width="10">  Titel </th><th width="40">  Termin </th></tr><tr><td width="5">  1 </td><td width="10">  admtf_Sequence_Features </td><td width="40">  Die Funktion gibt eine Liste der Tabellensequenzmerkmale zur√ºck. </td></tr><tr><td width="5">  2 </td><td width="10">  admtf_Table_Sequences </td><td width="40">  Die Funktion gibt eine Liste der Datenbanktabellenfolgen und ihrer Eigenschaften zur√ºck. </td></tr></tbody></table><br><h3>  <b>Admtf_Sequence_Features-</b> Funktion - Liste der Datenbanksequenzmerkmale </h3><br><a name="tfSeqF_def"></a><p>  Die Funktion admtf_Sequence_Features gibt eine Liste der Datenbank-SEQUENCE-Merkmale zur√ºck.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Der Quellcode kann hier angezeigt und heruntergeladen werden</a> . </p><br><p>  Die Funktion <b>admtf_Sequence_Features</b> gibt eine Liste der Datenbanksequenzmerkmale ( <b>SEQUENCE</b> ) zur√ºck. </p>  . <br><p>  Als Parameter verwendet die Funktion den Namen der Sequenz ( <b>a_SequenceName</b> ) und den Namen des Schemas, in dem die Sequenz erstellt wird ( <b>a_SchemaName</b> ). </p><br><p>  Die Notwendigkeit f√ºr die Funktion <b>admtf_Sequence_Features</b> ergab sich, weil die Hauptmerkmale der Sequenz tats√§chlich in einer Tabelle gespeichert sind, deren Name mit dem Namen der Sequenz √ºbereinstimmt, und Daten mit der <b>Anweisung SELECT daraus</b> extrahiert werden.  In diesem Fall werden der Name der Sequenz, der Name des Schemas und der Kommentar zur Sequenz in den <b>Verzeichnissen pg_class</b> , <b>pg_namespace</b> und <b>pg_description</b> gespeichert. </p><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> kr_road_network_vertices_pgr_id_seq;</code> </pre> <br><p>  <b><i>Bemerkung 6</i></b> </p><br><p>  <b>PostgreSQL</b> 10 trennte die Eigenschaften der Sequenz und die Eigenschaften ihrer Zust√§nde.  Zu diesem <b>Zweck wurde das</b> Verzeichnis <b>pg_sequence</b> mit Sequenzmerkmalen eingef√ºhrt, das den Anfangswert ( <b>start_value</b> ), das Inkrement ( <b>increment_by</b> ) und den Maximalwert ( <b>max_value</b> ) der Sequenz enth√§lt.  Der letzte von der Sequenz zur√ºckgegebene Wert ( <b>last_value</b> ) wurde in der "Tabelle" mit dem Namen der Sequenz belassen. </p><p></p><p>  <strong>Das Ende der Bemerkung.</strong> </p><br><p>  Die Darstellung jeder Sequenz als Analogon der Tabelle wird meiner Meinung nach durch die Notwendigkeit bestimmt, den zuletzt verwendeten Wert der Sequenz ( <b>last_value</b> ) zu speichern, der ein Merkmal des Zustands der Sequenz ist, jedoch nicht der Sequenz selbst. </p><br><p>  Der Sequenzeintrag im Verzeichnis <b>pg_class</b> unterscheidet sich vom Tabelleneintrag durch den Wert des Beziehungstyps (relkind = <font color="red">'S'</font> ). </p><br><p>  Um die Eigenschaften einer beliebigen Sequenz zu extrahieren, m√ºssen Sie dynamisches SQL verwenden. </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> <span class="hljs-string"><span class="hljs-string">'SELECT last_value,start_value,increment_by,max_value FROM '</span></span>|| <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SchemaName)||<span class="hljs-string"><span class="hljs-string">'.'</span></span>||<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SequenceName) <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> v_SequenceLastValue,v_SequenceStartValue, v_SequenceIncrementBy,v_SequenceMaxValue ;</code> </pre><br><br>  <strong>Tabelle 12. Das Ergebnis der Ausf√ºhrung der Funktion admtf_Sequence_Features ('public', 'kr_road_network_vertices_pgr_id_seq').</strong> <br><br><table width="25"><tbody><tr><th width="5">  Titel </th><th width="5">  Kommentar </th><th width="10">  Strom </th><th width="5">  Starten Sie </th><th width="5">  Inkrementieren </th><th width="10">  Das Ende </th></tr><tr><td width="15">  kr_road_network <br>  _vertices_pgr_id <br>  _seq </td><td width="20">  Sequenz </td><td width="10">  138023 </td><td width="5">  1 </td><td width="5">  1 </td><td width="10">  9223372036854775807 </td></tr></tbody></table><br><h3>  Funktion admtf_Table_Sequences Liste der Datenbanktabellenfolgen und ihrer Eigenschaften </h3><br><a name="tfTableS_def"></a><p>  Die Funktion <b>admtf_Table_Sequences</b> gibt eine Liste von Sequenzen ( <b>SEQUENCE</b> ) der Datenbanktabelle zur√ºck, die die Werte ihrer Felder und die Eigenschaften dieser Sequenzen generiert.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Der Quellcode kann hier angezeigt und heruntergeladen werden</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hier ist eine Version einer Funktion, die keinen Cursor verwendet</a> . </p><br><p>  Als Parameter verwendet die Funktion den Namen der <b>Quelltabelle</b> ( <b>a_TableName</b> ) und den Namen des Schemas, in dem die Tabelle erstellt wird ( </p><p>  a_SchemaName </p>  ) <br><img src="https://habrastorage.org/webt/io/cc/ib/ioccibem_rgf_rjzsnmd5va1xt0.png"><br><div class="spoiler">  <b class="spoiler_title">der Quellcode des Operators in der Abbildung</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> pseq.relname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SequenceName,snsp.nspname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SequenceSchemaName, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(dsc.description,<span class="hljs-string"><span class="hljs-string">',    '</span></span> ||da.attname) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SequenceDescription, d.depType <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> DependcyType,da.attname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> AttributeName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_depend d <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class pseq <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> d.objid = pseq.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace snsp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> pseq.relnamespace=snsp.oid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_Description dsc <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> pseq.oid=dsc.objoid <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> dsc.objsubid=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class tbl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> d.refobjid = tbl.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace nsp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.relnamespace=nsp.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_attribute da <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> da.attrelid= d.refobjid <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> da.attnum= d.refobjsubid <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(nsp.nspname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SchemaName) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(tbl.relname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_TableOID) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> tbl.relkind = <span class="hljs-string"><span class="hljs-string">'r'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pseq.relkind = <span class="hljs-string"><span class="hljs-string">'S'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> pseq.relname;</code> </pre><br></div></div><br><p>  Eine Beschreibung einer einzelnen Sequenz ist eine Kombination aus einem Datensatz in <b>pg_class</b> , der sie als physikalische Beziehung beschreibt, und einer bedingten Tabelle mit dem Namen der Sequenz, die Daten zu den spezifischen Merkmalen der Sequenz enth√§lt </p><br><p>  Informationen zur Beziehung zwischen der Sequenz und der <b>Quelltabelle werden im</b> Systemverzeichnis <b>pg_depend</b> gespeichert. </p><br><br>  <strong>Tabelle 13. Attribute des Verzeichnisses <b>pg_depend,</b> die zur Implementierung der Funktion ben√∂tigt werden.</strong> <br><table width="25"><tbody><tr><th width="5">  Titel </th><th width="5">  Beschreibung </th></tr><tr><td width="10">  objid </td><td width="20">  OID der Sequenz im Verzeichnis pg_class </td></tr><tr><td width="10">  objsubid </td><td width="20">  Dieses Feld enth√§lt Null </td></tr><tr><td width="10">  refobjid </td><td width="20">  OID der Tabelle, in deren Feldern die Sequenz verwendet wird </td></tr><tr><td width="10">  refobjsubid </td><td width="20">  Tabellenattributnummer, deren Werte mit einer Sequenz gef√ºllt werden </td></tr></tbody></table><br><p>  Zus√§tzlich greift die Funktion auf die Katalogdaten <b>pg_namespace</b> und <b>pg_description</b> zu, um die Diagramme und Kommentare sowohl der Sequenz als auch der <b>Quelltabelle</b> zu extrahieren. </p><br><p>  Um das Attribut einer Tabelle zu bestimmen, deren Werte mithilfe einer Sequenz gef√ºllt werden, greift die <b>Funktion</b> unter der Bedingung <b>attrelid = refobjid AND attnum = refobjsubid</b> auf das Verzeichnis <b>pg_attribute zu</b> .  (In diesem Zustand werden die Namen der Attribute des Verzeichnisses <b>pg_depend</b> rechts vom Gleichheitszeichen angegeben.) </p><br><p>  Die besonderen Merkmale von Tabellensequenzen werden in einer Schleife durch Aufrufen von <b>admtf_Sequence_Features</b> abgerufen.  Der Zyklus wird verwendet, weil mehr als eine Sequenz zugewiesen werden kann, um die Felder der Tabelle auszuf√ºllen. </p><br>  <strong>Tabelle 14. Das Ergebnis der Ausf√ºhrung der Funktion admtf_Table_Sequences ('public', 'kr_road_network_vertices_pgr').</strong> <br><br><table width="25"><tbody><tr><th width="5">  Titel </th><th width="5">  Kommentar </th><th width="5">  Starten Sie </th><th width="5">  Inkrementieren </th><th width="10">  Das Ende </th><th width="10">  Das Feld </th></tr><tr><td width="15">  kr_road_network <br>  _vertices_pgr_id <br>  _seq </td><td width="20">  Sequenzgenerierung von ID-Feldwerten </td><td width="5">  1 </td><td width="5">  1 </td><td width="10">  9223372036854775807 </td><td width="10">  id </td></tr></tbody></table><br><a name="tfTableS_woc_def"></a><h4>  Version ohne Cursor </h4><br><p>  In einer <b>PostgreSQL-</b> Umgebung mit einer Version unter 10 ist es h√∂chstwahrscheinlich unm√∂glich, die Funktion <b>admtf_Table_Sequences</b> ohne Verwendung eines Cursors zu implementieren. <br>  Aber die gl√ºcklichen Besitzer von Version 10 k√∂nnen gut auf einen Cursor verzichten, denn  Sie verf√ºgen √ºber das Verzeichnis <b>pg_sequence</b> .  In diesem Fall k√∂nnen alle Merkmale der Sequenz mit einer einzigen <b>SELECT-Anweisung</b> abgerufen werden. </p><br><p>  In der gegebenen Funktionsimplementierung wird unter Verwendung der Fensterfunktion <b>RANK () OVER (PARTITION BY pseq.relname)</b> die Sequenznummer der Sequenz berechnet, die zum F√ºllen der Quellentabelle verwendet wird. </p><br><img src="https://habrastorage.org/webt/1z/qa/r7/1zqar7uba-68o2ya1l_o37ph5jc.png"><br><div class="spoiler">  <b class="spoiler_title">der Quellcode des Operators in der Abbildung</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RANK</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> pseq.relname) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SequenceNo, pseq.relname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SequenceName,snsp.nspname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SequenceSchemaName, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(dsc.description,<span class="hljs-string"><span class="hljs-string">',    '</span></span> ||da.attname) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SequenceDescription, seq.seqstart <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SequenceStartValue,seq.seqincrement <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SequenceIncrementBy, seq.seqmax <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SequenceMaxValue, d.depType <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> DependcyType,da.attname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> AttributeName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_depend d <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class pseq <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> d.objid = pseq.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_sequence seq <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> seq.seqrelid= pseq.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace snsp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> pseq.relnamespace=snsp.oid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_Description dsc <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> pseq.oid=dsc.objoid <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> dsc.objsubid=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class tbl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> d.refobjid = tbl.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace nsp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.relnamespace=nsp.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_attribute da <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> da.attrelid= d.refobjid <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> da.attnum= d.refobjsubid <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(nsp.nspname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SchemaName) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(tbl.relname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_TableOID) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> tbl.relkind = <span class="hljs-string"><span class="hljs-string">'r'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pseq.relkind = <span class="hljs-string"><span class="hljs-string">'S'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> pseq.relname;</code> </pre><br></div></div><br><p>  <strong>Bemerkung 7</strong> </p>  . <br><p>  Diese Version der Funktion gibt nicht den letzten von der Sequenz generierten Wert zur√ºck ( <b>last_value</b> ). </p><p></p><p>  <strong>Das Ende der Bemerkung.</strong> </p><br><h3>  Admtf_Table_InheritanceChildrens-Funktion - Liste der Merkmale geerbter Tabellen </h3><br><a name="tfTableIC_def"></a><p>  Die Funktion <b>admtf_Table_InheritanceChildrens</b> gibt eine Liste der Merkmale der geerbten Tabellen ( <b>INHERITS</b> ) der Datenbanktabelle zur√ºck.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Der Quellcode kann hier angezeigt und heruntergeladen werden</a> . </p><br><p>  Als Parameter verwendet die Funktion den Namen der <b>Quelltabelle</b> ( <b>a_TableName</b> ) und den Namen des Schemas, in dem die Tabelle erstellt wird ( <b>a_SchemaName</b> ). </p><br><p>  Die Beschreibung einer einzelnen Legacy-Tabelle befindet sich im Eintrag in <b>pg_class</b> .  <b>Um jedoch</b> nach geerbten Tabellen mit dem Namen der <b>Quelltabelle</b> zu suchen, m√ºssen Sie den <b>Systemkatalog pg_depend</b> verwenden. </p><br>  <strong>Tabelle 15. Attribute des Verzeichnisses <b>pg_depend,</b> die zur Implementierung der Funktion ben√∂tigt werden.</strong> <br><table width="25"><tbody><tr><th width="5">  Titel </th><th width="5">  Beschreibung </th></tr><tr><td width="10">  objid </td><td width="20">  OID der geerbten Tabelle im Verzeichnis pg_class </td></tr><tr><td width="10">  refobjid </td><td width="20">  OID der Quelltabelle </td></tr></tbody></table><br><img src="https://habrastorage.org/webt/pa/ew/kl/paewklf4g7qvftdb99sss0efwqc.png"><br><div class="spoiler">  <b class="spoiler_title">der Quellcode des Operators in der Abbildung</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> rtbl.relname,rnspc.nspname,rdsc.description,rtbl.relnatts::<span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>, rtbl.relchecks::<span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>, rtbl.relhaspkey,rtbl.relhasindex,rtbl.relhassubclass, rtbl.reltuples::<span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_class tbl <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace nspc <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.relnamespace = nspc.oid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_Description dsc <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.oid=dsc.objoid <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> dsc.objsubid=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_depend dp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.oid=dp.refobjid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class rtbl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> rtbl.OID=dp.objid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace rnspc <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> rtbl.relnamespace = rnspc.oid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_Description rdsc <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> rtbl.oid=rdsc.objoid <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> rdsc.objsubid=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(nspc.nspname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SchemaName) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(tbl.relname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_TableOID) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> tbl.relkind = <span class="hljs-string"><span class="hljs-string">'r'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> rtbl.relkind = <span class="hljs-string"><span class="hljs-string">'r'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> rtbl.relname;</code> </pre><br></div></div><br><p>  Dar√ºber hinaus greift die Funktion auf die Verzeichnisdaten <b>pg_namespace</b> und <b>pg_description</b> zu, um Schemas und Kommentare sowohl f√ºr die geerbte als auch f√ºr die <b>Quelltabelle</b> zu extrahieren. </p><br>  <strong>Tabelle 16. Das Ergebnis der Ausf√ºhrung der Funktion admtf_Table_InheritanceChildrens ('public', 'np_house').</strong> <br><br><table width="95" border="1"><tbody><tr><th width="10">  Titel </th><th width="20">  Kommentar </th><th width="5">  Attribute </th><th width="5">  ?  Prim√§rschl√ºssel </th><th width="5">  ?  Indizes </th><th width="5">  ?  Nachkommen </th><th width="5">  Anzahl der Datens√§tze </th></tr><tr><td width="10">  np_house 04201 000000 </td><td width="20">  H√§user in Siedlungen (Bezirk Achinsky) </td><td width="5">  15 </td><td width="5">  f </td><td width="5">  f </td><td width="5">  f </td><td width="5">  5651 </td></tr><tr><td width="10">  np_house 4208 000 000 </td><td width="20">  H√§user in Siedlungen (Bezirk Bogotolsky) </td><td width="5">  15 </td><td width="5">  f </td><td width="5">  f </td><td width="5">  f </td><td width="5">  4314 </td></tr></tbody></table><br><p>  Die Anzahl der Datens√§tze in der generierten Tabelle wird aus dem reltuple-Attribut des Verzeichnisses pg_class ausgew√§hlt.  Und obwohl dieser Wert oft genau mit der tats√§chlichen Anzahl von Eintr√§gen in der Tabelle √ºbereinstimmt, ist er immer noch ein gesch√§tzter Wert.  Vielleicht m√∂chten Sie als Ergebnis den genauen Wert erhalten.  Zum Beispiel wie in der Abbildung gezeigt. </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> <span class="hljs-string"><span class="hljs-string">'SELECT COUNT(*) FROM '</span></span>||<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SchemaName)||<span class="hljs-string"><span class="hljs-string">'.'</span></span>||<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_TableName) <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> v_TableNumberOfRowCalc;</code> </pre><br><p>  Um diese Aussage im Text zu erf√ºllen, muss die Funktion <b>admtf_Table_InheritanceChildrens zun√§chst</b> einen Cursor verwenden. </p><br><p>  Zweitens m√∂chte ich, dass die Funktion sowohl die gesch√§tzte als auch die genaue Anzahl der Tabelleneintr√§ge anzeigt. </p><br><p>  Daher verf√ºgt die Funktion √ºber einen weiteren optionalen Parameter - den Modus zum <b>Abrufen</b> der Anzahl der Tabelleneintr√§ge ( <b>a_Mode</b> ), der die Werte "Sch√§tzung" ( <font color="red">Sch√§tzung</font> ) oder "genau" ( <font color="red">genau</font> ) annimmt. </p><br><a name="fnTableRC_def"></a><br><p>  Zus√§tzlich wurde die Funktion <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">admfn_Table_RowCount erstellt</a> , die die genaue Anzahl der Tabelleneintr√§ge zur√ºckgibt, und das Attribut reltuple wird in der R√ºckgabeliste <b>SELECT</b> durch die folgende Konstruktion ersetzt. </p><br><img src="https://habrastorage.org/webt/3f/t_/xf/3ft_xftbnboqxguantdpivkdtva.png"><br><div class="spoiler">  <b class="spoiler_title">der Quellcode des Operators in der Abbildung</b> <div class="spoiler_text"><pre> <code class="sql hljs">CASE WHEN a_Mode = 'exactly' THEN admfn_Table_RowCount(rnspc.nspname,rtbl.relname) ELSE reltuples <span class="hljs-keyword"><span class="hljs-keyword">END</span></span></code> </pre><br></div></div><br><p>  Infolgedessen gibt die Funktion den gesch√§tzten Wert des Indikators "Anzahl der Tabelleneintr√§ge" zur√ºck, wenn der Parameter <b>a_Mode</b> nicht <b>die</b> Anforderung <b>angibt</b> , den genauen Wert zur√ºckzugeben. </p><br><h3>  Struktur einer Funktion, die eine Liste von Tabellenattributmerkmalen zur√ºckgibt </h3><br><img src="https://habrastorage.org/webt/hi/du/at/hiduatp-_vtmifufs_u53_roz2q.png"><br>  <i>Abb.</i>  <i>3. Funktionen, die admtf_Attribute_Features aufruft</i> <br><img src="https://habrastorage.org/webt/ip/3e/rx/ip3erx3a2sj9_kkoeriysoppfom.png"><br><div class="spoiler">  <b class="spoiler_title">Textversion der Tabelle in der Abbildung</b> <div class="spoiler_text">  <strong>Tabelle 17. Zweck der Funktionen.</strong> <br><br><table width="95" border="1"><tbody><tr><th width="5">  Nein, nein. </th><th width="10">  Titel </th><th width="40">  Termin </th></tr><tr><td width="5">  1 </td><td width="10">  admtf_Attribute_PKFeatures </td><td width="40">  Die Funktion gibt das Attribut Pr√§senzpr√§senz im Prim√§rschl√ºssel (PRIMARY KEY) sowie einige seiner Merkmale als Teil dieses Schl√ºssels zur√ºck. </td></tr><tr><td width="5">  2 </td><td width="10">  admtf_Attribute_FKFeatures </td><td width="40">  Die Funktion gibt das Attribut Pr√§senzpr√§senz im Fremdschl√ºssel (FOREIGN KEY) sowie einige seiner Merkmale als Teil dieses Schl√ºssels zur√ºck. </td></tr><tr><td width="5">  3 </td><td width="10">  admtf_Attribute_Features </td><td width="40">  Die Funktion gibt eine Liste der Tabellenattributmerkmale zur√ºck. </td></tr></tbody></table><br></div></div><br><h3>  Funktion <b>admtf_Attribute_PKFeatures</b> - - ob das Attribut im Prim√§rschl√ºssel vorhanden ist </h3><br><a name="tfAttPK_def"></a><br><p>  Die Funktion <b>admtf_Attribute_PKFeatures</b> gibt ein Zeichen f√ºr das Vorhandensein eines Tabellenattributs im Prim√§rschl√ºssel (PRIMARY KEY) der Tabelle zur√ºck. Wenn es vorhanden ist, wie lautet die Seriennummer in diesem Schl√ºssel seitdem  Prim√§rschl√ºssel kann zusammengesetzt sein. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Der Quellcode kann hier angezeigt und heruntergeladen werden</a> . </p><br><p>  Als Parameter verwendet die Funktion die OID der <b>Quelltabelle</b> ( <b>a_TableOID</b> ) und die Seriennummer des gew√ºnschten Attributs ( <b>a_AttributeNo</b> ). </p><br><p>  Die Funktion extrahiert die <b>erforderlichen</b> Daten aus dem Verzeichniseintrag <b>pg_constraint</b> , der die (CONSTRAINT) <b>-Einschr√§nkungen</b> der <b>Quelltabelle</b> enth√§lt, einschlie√ülich der Prim√§rschl√ºsseleinschr√§nkung.  Die OID der gew√ºnschten Tabelle wird im <b>Conrelid-</b> Feld gespeichert, die Beschreibung des Prim√§rschl√ºssels wird in einem Datensatz gespeichert, in dem das Contype-Feld den Wert <font color="red">'' p 'enth√§lt.</font> </p>  . <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> v_PKAttributeList,rs_isAttributePK conkey,<span class="hljs-built_in"><span class="hljs-built_in">ARRAY</span></span>[a_AttributeNo]&lt;@conkey <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_constraint c <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> c.contype=<span class="hljs-string"><span class="hljs-string">'p'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> c.conrelid=a_TableOID;</code> </pre><br><p>  Das auf diese Weise gefundene Schl√ºsselfeld enth√§lt ein Array von Attributnummern, aus denen der Prim√§rschl√ºssel besteht.  Um das Vorhandensein des <b>Quellattributs</b> im Prim√§rschl√ºssel zu √ºberpr√ºfen, reicht es daher aus, den logischen Ausdruck <b>ARRAY [a_AttributeNo] &lt;@ conkey</b> zu berechnen. </p><br><p>  Wenn das Attribut im Prim√§rschl√ºssel vorhanden ist, wird seine Sequenznummer in der Schleife berechnet. </p><br><h3>  Funktion <b>admtf_Attribute_FKFeatures</b> - <b>Gibt an,</b> ob das Attribut im Fremdschl√ºssel vorhanden ist </h3><br><a name="tfAttFK_def"></a><br><p>  Die Funktion <b>admtf_Attribute_FKFeatures</b> gibt ein Zeichen f√ºr das Vorhandensein eines Tabellenattributs in einem oder mehreren Fremdschl√ºsseln (FOREIGN KEY) der Tabelle zur√ºck. Wenn vorhanden, wie lauten die Folgenummern in diesen Schl√ºsseln, weil  Fremdschl√ºssel kann zusammengesetzt sein. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Der Quellcode kann hier angezeigt und heruntergeladen werden</a> . </p><br><p>  Als Parameter verwendet die Funktion die OID der <b>Quelltabelle</b> ( <b>a_TableOID</b> ) und die Seriennummer des gew√ºnschten Attributs ( <b>a_AttributeNo</b> ). </p><br><p>  Die Funktion ruft die <b>erforderlichen</b> Daten aus dem Verzeichniseintrag <b>pg_constraint ab</b> , der CONSTRAINT der <b>Quelltabelle</b> enth√§lt, einschlie√ülich, aber nicht beschr√§nkt auf Fremdschl√ºsseleinschr√§nkungen.  Die OID der gew√ºnschten Tabelle wird im <b>Conrelid-</b> Feld gespeichert, die Beschreibung des Prim√§rschl√ºssels wird in einem Datensatz gespeichert, in dem das Contype-Feld den Wert <font color="red">'' f 'enth√§lt.</font> </p>  . <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_constraint c <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> c.contype=<span class="hljs-string"><span class="hljs-string">'f '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> c.conrelid=a_TableOID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-built_in"><span class="hljs-built_in">ARRAY</span></span>[a_AttributeNo]&lt;@conkey <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> c.oid;</code> </pre><br><p>  Das auf diese Weise gefundene Schl√ºsselfeld enth√§lt ein Array von Attributnummern, aus denen der Fremdschl√ºssel besteht.  Um das Vorhandensein des <b>Quellattributs</b> im Fremdschl√ºssel zu √ºberpr√ºfen, reicht es daher aus, den logischen Ausdruck <b>ARRAY [a_AttributeNo] &lt;@ conkey</b> zu berechnen. </p><br><p>  Wenn das Attribut im Fremdschl√ºssel vorhanden ist, wird in der Schleife ein Array seiner Sequenznummern in den Fremdschl√ºsseln gebildet, die es enthalten.  Zus√§tzlich werden zwei weitere Arrays aus den Namen der Tabellen und ihren Attributen gebildet, auf die das Quellattribut in den Fremdschl√ºsseln verweist, die es enthalten. </p><br><p>  Tabellennamen werden aus dem Verzeichniseintrag <b>pg_class</b> durch eine Kennung (OID) abgerufen, die aus dem Konfrelidfeld des Fremdschl√ºsseleintrags abgerufen wird. </p><br><p>  Verwenden Sie ein Array mit Seriennummern aus dem Feld, um den Namen des Attributs der externen Tabelle abzurufen </p><p>  confkey </p>  (Es unterscheidet sich vom obigen Array durch den Buchstaben " <b>f</b> " im Namen).  Aus diesem Array wird die Seriennummer des Attributs der externen Tabelle extrahiert, der das externe Attribut entspricht.  Durch diese Seriennummer des Attributs der externen Tabelle und ihrer OID im Verzeichnis pg_attribute wird ein Eintrag f√ºr die Beschreibung des Attributs erstellt und dessen Name abgerufen. <br><h3>  <b>Admtf_Attribute_Features-</b> Funktion - Liste der Tabellenattributmerkmale </h3><br><a name="tfAttF_def"></a><p>  Die Funktionen <b>admtf_Attribute_Features geben</b> eine Liste der folgenden Tabellenattributmerkmale zur√ºck.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Der Quellcode kann hier angezeigt und heruntergeladen werden</a> . </p><br><img src="https://habrastorage.org/webt/tu/bz/me/tubzmeucr-nzriafiuufgbv31ew.png"><br><div class="spoiler">  <b class="spoiler_title">Die Textversion der Tabelle in der Abbildung</b> <div class="spoiler_text"><table width="95" border="1"><tbody><tr><th width="5">  Nein, nein. </th><th width="10">  Titel </th><th width="10">  Typ </th><th width="40">  Termin </th></tr><tr><td width="5">  1 </td><td width="10">  Attributname </td><td width="10">  Name </td><td width="40">  Der Name des Quellattributs. </td></tr><tr><td width="5">  2 </td><td width="10">  UserTypeName </td><td width="10">  VARCHAR (256) </td><td width="40">  Benutzerdefinierter Quellattributtyp </td></tr><tr><td width="5">  3 </td><td width="10">  Typename </td><td width="10">  VARCHAR (256) </td><td width="40">  Basistyp des Quellattributs </td></tr><tr><td width="5">  4 </td><td width="10">  isNotNULL </td><td width="10">  BOOLEAN </td><td width="40">  ?  Nullg√ºltigkeit </td></tr><tr><td width="5">  5 </td><td width="10">  isAttributePK </td><td width="10">  BOOLEAN </td><td width="40">  ?  Teilnahme an PK </td></tr><tr><td width="5">  6 </td><td width="10">  ColumnPKNo </td><td width="10">  SMALLINT </td><td width="40">  Attribut Seriennummer in PK </td></tr><tr><td width="5">  7 </td><td width="10">  Beschreibung </td><td width="10">  TEXT </td><td width="40">  Kommentar zum Quellattribut </td></tr><tr><td width="5">  8 </td><td width="10">  isAttributeFK </td><td width="10">  BOOLEAN </td><td width="40">  ?  Teilnahme an FK </td></tr><tr><td width="5">  9 </td><td width="10">  FKeyName </td><td width="10">  Name [] </td><td width="40">  Ein Array von Namen von Einschr√§nkungstabellen, in denen der Fremdschl√ºssel definiert ist </td></tr><tr><td width="5">  10 </td><td width="10">  ColumnFKNo </td><td width="10">  SMALLINT [] </td><td width="40">  Array von Attributsequenznummern in Fremdschl√ºsseln einer Tabelle </td></tr><tr><td width="5">  11 </td><td width="10">  FKTableName </td><td width="10">  Name [] </td><td width="40">  Array von Tabellen, auf die durch Fremdschl√ºssel verwiesen wird </td></tr><tr><td width="5">  12 </td><td width="10">  FKTableColumnName </td><td width="10">  Name [] </td><td width="40">  Array von Attributnamen in externen Tabellen, die dem Quellattribut entsprechen </td></tr></tbody></table><br></div></div><br><p>  Als Parameter verwendet die Funktion die OID der <b>Quelltabelle</b> ( <b>a_TableOID</b> ) und die Seriennummer des gew√ºnschten Attributs ( <b>a_AttributeNo</b> ). <br>  Die Werte der <b>Felder</b> <b>AttributeName</b> und <b>isNotNULL</b> werden aus dem Verzeichniseintrag <b>pg_attribute</b> abgerufen, der den Werten der Eingabeparameter entspricht. </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> attr.attname, attr.attnotnull <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_attribute <span class="hljs-keyword"><span class="hljs-keyword">attr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> attr.attrelid =a_TableOID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> attr.attnum=a_AttributeNo; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> rs_isAttributePK,rs_ColumnPKNo <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> admtf_Attribute_PKFeatures (a_TableOID,a_AttributeNo); <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> rs_isAttributeFK,rs_FKeyName,rs_ColumnFKNo, rs_FKTableName,rs_FKTableColumnName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> admtf_Attribute_FKFeatures (a_TableOID,a_AttributeNo);</code> </pre><br><p>  Die Werte der <b>Felder</b> <b>isAttributePK</b> und <b>ColumnPKNo werden</b> von der Funktion <b>admtf_Attribute_PKFeatures zur√ºckgegeben</b> . </p><br><p>  Die Werte der <b>Felder isAttributeFK</b> , <b>FKeyName</b> , <b>ColumnFKNo</b> , <b>FKTableName</b> und <b>FKTableColumnName werden</b> von der Funktion <b>admtf_Attribute_FKFeatures zur√ºckgegeben</b> . </p><br><p>  Ein Aufruf von <b>admtf_Attribute_Features ((SELECT OID FROM pg_class WHERE relname = 'street'), 2 :: SMALLINT)</b> f√ºhrt zu folgendem Ergebnis. </p><br>  <strong>Tabelle 18. Ergebnis der Ausf√ºhrung der Funktion admtf_Attribute_Features</strong> <br><table width="95" border="1"><tbody><tr><th width="10">  Attributname </th><th width="10">  UserTypeName </th><th width="10">  Typename </th><th width="10">  isNotNULL </th><th width="10">  isAttributePK </th><th width="10">  ColumnPKNo </th></tr><tr><td width="10">  localityid </td><td width="10">  localityid </td><td width="10">  Ganzzahl </td><td>  Ganzzahl </td><td>  Ganzzahl </td><td width="2">  Ganzzahl </td></tr></tbody></table><br><br><table width="95" border="1"><tbody><tr><th width="10">  Beschreibung </th><th width="10">  isAttributeFK </th><th width="10">  FKeyName </th><th width="10">  ColumnFKNo </th><th width="10">  FKTableName </th><th width="10">  FKTableColumnName </th></tr><tr><td width="10">  Community ID </td><td width="10">  t </td><td width="10">  {fk_street_locality} </td><td>  {2} </td><td>  {Ort} </td><td width="2">  {localityid} </td></tr></tbody></table><br><a name="Script2"></a><h2>  ANHANG 1. Skripte </h2><br><a name="tfSeqF"></a><h3>  Erstellen der Funktion admtf_Sequence_Features </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kommentare zum Funktionsquellcode finden Sie hier.</a> <br><div class="spoiler">  <b class="spoiler_title">Funktionscode</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Sequence_Features (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,a_SequenceName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>); <span class="hljs-comment"><span class="hljs-comment">/****************************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     ,   */</span></span> <span class="hljs-comment"><span class="hljs-comment">/****************************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Sequence_Features (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'public'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_SequenceName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (rs_SequenceName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,rs_SequenceDescription <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span>,rs_NumberOfAttribute <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>,rs_SequenceLastValue <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, rs_SequenceStartValue <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>,rs_SequenceIncrementBy <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>,rs_SequenceMaxValue <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> c_SequenceKind <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>:=<span class="hljs-string"><span class="hljs-string">'S'</span></span>; v_SequenceOID OID; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceName NAME; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceDescription TEXT; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceStartValue BIGINT; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_SequenceIncrementBy BIGINT; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceMaxValue BIGINT; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_SequenceLastValue BIGINT; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_SequenceNumberOfRowCalc INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> <span class="hljs-comment"><span class="hljs-comment">--************************************************************************ BEGIN SELECT INTO rs_SequenceName,rs_SequenceDescription,rs_NumberOfAttribute tbl.relname, COALESCE(dsc.description,'') AS r_SequenceDescription, tbl.relnatts::INTEGER,tbl.relchecks::INTEGER,tbl.relhaspkey, tbl.relhasindex,tbl.relhassubclass,tbl.reltuples::INTEGER FROM pg_class tbl INNER JOIN pg_namespace nspc ON tbl.relnamespace = nspc.oid LEFT OUTER JOIN pg_Description dsc ON tbl.oid=dsc.objoid AND dsc.objsubid=0 WHERE nspc.nspname=LOWER(a_SchemaName) AND tbl.relkind=c_SequenceKind AND tbl.relname =LOWER(a_SequenceName); IF FOUND THEN EXECUTE 'SELECT last_value,start_value,increment_by,max_value FROM '||LOWER(a_SchemaName)||'.'||LOWER(a_SequenceName) INTO v_SequenceLastValue,v_SequenceStartValue, v_SequenceIncrementBy,v_SequenceMaxValue ; RETURN QUERY SELECT rs_SequenceName,rs_SequenceDescription, rs_NumberOfAttribute,v_SequenceLastValue, v_SequenceStartValue,v_SequenceIncrementBy, v_SequenceMaxValue; END IF; RETURN; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Sequence_Features(a_SchemaName NAME,a_SequenceName NAME) IS '    ,  '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; BEGIN TRANSACTION; DROP FUNCTION IF EXISTS admtf_Sequence_Features (a_SchemaName VARCHAR(256),a_SequenceName VARCHAR(256)); /****************************************************************************/ /*     ,   */ /****************************************************************************/ CREATE OR REPLACE FUNCTION admtf_Sequence_Features (a_SchemaName VARCHAR(256) default 'public', /*     */ a_SequenceName VARCHAR(256) default NULL /*   */ ) RETURNS TABLE (rs_SequenceName VARCHAR(256),rs_SequenceDescription TEXT, rs_NumberOfAttribute INTEGER,rs_SequenceLastValue BIGINT, rs_SequenceStartValue BIGINT,rs_SequenceIncrementBy BIGINT, rs_SequenceMaxValue BIGINT) AS $BODY$ DECLARE c_SequenceKind CONSTANT CHAR:='S'; --******************************************************** BEGIN RETURN QUERY SELECT sf.rs_SequenceName::VARCHAR(256), sf.rs_SequenceDescription::TEXT, sf.rs_NumberOfAttribute::INTEGER, sf.rs_SequenceLastValue::BIGINT, sf.rs_SequenceStartValue::BIGINT, sf.rs_SequenceIncrementBy::BIGINT, sf.rs_SequenceMaxValue::BIGINT FROM admtf_Sequence_Features(a_SchemaName::NAME,a_SequenceName::NAME) sf; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Sequence_Features(a_SchemaName VARCHAR(256),a_SequenceName VARCHAR(256)) IS '    ,  '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Sequence_Features('public'::VARCHAR(255),'k_dorogi_dijkstra_seq_seq'::VARCHAR(255)); SELECT * FROM admtf_Sequence_Features('public'::NAME,'kr_road_network_vertices_pgr_id_seq'::NAME);</span></span></code> </pre><br></div></div><br><a name="tfTableS"></a><br><h3>  Erstellen der Funktion admtf_Table_Sequences </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kommentare zum Funktionsquellcode finden Sie hier.</a> <br><div class="spoiler">  <b class="spoiler_title">Funktionscode</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Table_Sequences (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*********************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*    ,     */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*********************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Table_Sequences (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'public'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (r_SequenceNumber <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>,r_SequenceName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, r_SequenceSchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_SequenceDescription <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span>, r_SequenceStartValue <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>,r_SequenceIncrementBy <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, r_SequenceMaxValue <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>,r_DependType <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, r_RefTableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_RefTableSchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, r_RefAttributeName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> v_TableOID <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>;<span class="hljs-comment"><span class="hljs-comment">/* OID */</span></span> v_Sequence RECORD;<span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceOID INTEGER;<span class="hljs-comment"><span class="hljs-comment">/* OID */</span></span> v_SequenceName NAME; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceSchemaName NAME; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_SequenceDescription TEXT; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceStartValue BIGINT; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_SequenceIncrementBy BIGINT; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceMaxValue BIGINT; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_DependcyType NAME; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_AttributeName NAME; <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> v_SequenceNumber SMALLINT; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> c_Delimiter CONSTANT VARCHAR(2):=','; <span class="hljs-comment"><span class="hljs-comment">--********************************************************************* BEGIN v_SequenceNumber:=0; FOR v_Sequence IN SELECT pseq.relname AS SequenceName, snsp.nspname AS SequenceSchemaName, COALESCE(dsc.description,',    '||da.attname) AS SequenceDescription, d.depType AS DependcyType,da.attname AS AttributeName FROM pg_depend d INNER JOIN pg_class pseq ON d.objid = pseq.oid INNER JOIN pg_namespace snsp ON pseq.relnamespace=snsp.oid LEFT OUTER JOIN pg_Description dsc ON pseq.oid=dsc.objoid AND dsc.objsubid=0 INNER JOIN pg_class tbl ON d.refobjid = tbl.oid INNER JOIN pg_namespace nsp ON tbl.relnamespace=nsp.oid INNER JOIN pg_attribute da ON da.attrelid= d.refobjid AND d.refobjsubid=da.attnum WHERE tbl.relkind = 'r' AND pseq.relkind = 'S' AND LOWER(nsp.nspname)=LOWER(a_SchemaName) AND LOWER(tbl.relname)=LOWER(a_TableName) ORDER BY pseq.relname LOOP v_SequenceNumber:=v_SequenceNumber+1; v_SequenceName:=v_Sequence.SequenceName; v_SequenceSchemaName:=v_Sequence.SequenceSchemaName; v_DependcyType:=v_Sequence.DependcyType; v_AttributeName:=v_Sequence.AttributeName; v_SequenceDescription:=v_Sequence.SequenceDescription; SELECT INTO v_SequenceStartValue,v_SequenceIncrementBy, v_SequenceMaxValue rs_SequenceStartValue,rs_SequenceIncrementBy, rs_SequenceMaxValue FROM admtf_Sequence_Features(v_SequenceSchemaName,v_SequenceName); RETURN QUERY SELECT v_SequenceNumber,v_SequenceName, v_SequenceSchemaName,v_SequenceDescription, v_SequenceStartValue,v_SequenceIncrementBy, v_SequenceMaxValue,v_DependcyType, a_TableName,a_SchemaName,v_AttributeName; END LOOP; RETURN; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Sequences(a_SchemaName NAME, a_TableName NAME) IS '  ,    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; BEGIN TRANSACTION; DROP FUNCTION IF EXISTS admtf_Table_Sequences (a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)); /**********************************************************************/ /*    ,     */ /**********************************************************************/ CREATE OR REPLACE FUNCTION admtf_Table_Sequences (a_SchemaName VARCHAR(256) default 'public', /*     */ a_TableName VARCHAR(256) default NULL /*   */ ) RETURNS TABLE (r_SequenceNumber SMALLINT,r_SequenceName VARCHAR(256), r_SequenceSchemaName VARCHAR(256),r_SequenceDescription TEXT, r_SequenceStartValue BIGINT,r_SequenceIncrementBy BIGINT, r_SequenceMaxValue BIGINT,r_DependType VARCHAR(256), r_RefTableName VARCHAR(256),r_RefTableSchemaName VARCHAR(256), r_RefAttributeName VARCHAR(256)) AS $BODY$ DECLARE c_Delimiter CONSTANT VARCHAR(2):=','; --****************************************************** BEGIN RETURN QUERY SELECT ts.r_SequenceNumber::SMALLINT, ts.r_SequenceName::VARCHAR(256), ts.r_SequenceSchemaName::VARCHAR(256) , ts.r_SequenceDescription::TEXT, ts.r_SequenceStartValue::BIGINT, ts.r_SequenceIncrementBy::BIGINT, ts.r_SequenceMaxValue::BIGINT, ts.r_DependType::VARCHAR(256), ts.r_RefTableName::VARCHAR(256), ts.r_RefTableSchemaName::VARCHAR(256), ts.r_RefAttributeName::VARCHAR(256) FROM admtf_Table_Sequences(a_SchemaName::NAME,a_TableName::NAME) ts; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Sequences(a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)) IS '  ,    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Table_Sequences('public'::VARCHAR(255),'kr_road_network_vertices_pgr'::VARCHAR(255)); SELECT * FROM admtf_Table_Sequences('public'::NAME,'kr_road_network_vertices_pgr'::NAME);</span></span></code> </pre><br></div></div><br><a name="tfTableS_woc"></a><h3>   admtf_Table_Sequences   (PostgreSQL 10) </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">       .</a> <br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Table_Sequences (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*********************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*    ,     */</span></span> <span class="hljs-comment"><span class="hljs-comment">/**********************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Table_Sequences (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'public'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (r_SequenceNumber <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>,r_SequenceName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, r_SequenceSchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_SequenceDescription <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span>, r_SequenceStartValue <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>,r_SequenceIncrementBy <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, r_SequenceMaxValue <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>,r_DependType <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, r_RefTableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_RefTableSchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, r_RefAttributeName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> v_TableOID <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* OID */</span></span> v_Sequence RECORD; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceOID INTEGER; <span class="hljs-comment"><span class="hljs-comment">/* OID */</span></span> v_SequenceName NAME; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceSchemaName NAME; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_SequenceDescription TEXT; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceStartValue BIGINT; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_SequenceIncrementBy BIGINT; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceMaxValue BIGINT; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_DependcyType NAME; <span class="hljs-comment"><span class="hljs-comment">/*        */</span></span> v_AttributeName NAME; <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> v_SequenceNumber SMALLINT; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> c_Delimiter CONSTANT VARCHAR(2):=','; <span class="hljs-comment"><span class="hljs-comment">--****************************************************************** BEGIN v_SequenceNumber:=0; FOR v_Sequence IN SELECT pseq.relname AS SequenceName, snsp.nspname AS SequenceSchemaName, COALESCE(dsc.description,',    '||da.attname) AS SequenceDescription, d.depType AS DependcyType,da.attname AS AttributeName FROM pg_depend d INNER JOIN pg_class pseq ON d.objid = pseq.oid INNER JOIN pg_namespace snsp ON pseq.relnamespace=snsp.oid LEFT OUTER JOIN pg_Description dsc ON pseq.oid=dsc.objoid AND dsc.objsubid=0 INNER JOIN pg_class tbl ON d.refobjid = tbl.oid INNER JOIN pg_namespace nsp ON tbl.relnamespace=nsp.oid INNER JOIN pg_attribute da ON da.attrelid= d.refobjid ND d.refobjsubid=da.attnum WHERE tbl.relkind = 'r' AND pseq.relkind = 'S' AND LOWER(nsp.nspname)=LOWER(a_SchemaName) AND LOWER(tbl.relname)=LOWER(a_TableName) ORDER BY pseq.relname LOOP v_SequenceNumber:=v_SequenceNumber+1; v_SequenceName:=v_Sequence.SequenceName; v_SequenceSchemaName:=v_Sequence.SequenceSchemaName; v_DependcyType:=v_Sequence.DependcyType; v_AttributeName:=v_Sequence.AttributeName; v_SequenceDescription:=v_Sequence.SequenceDescription; SELECT INTO v_SequenceStartValue,v_SequenceIncrementBy,v_SequenceMaxValue rs_SequenceStartValue,rs_SequenceIncrementBy,rs_SequenceMaxValue FROM admtf_Sequence_Features(v_SequenceSchemaName,v_SequenceName); RETURN QUERY SELECT v_SequenceNumber,v_SequenceName, v_SequenceSchemaName,v_SequenceDescription, v_SequenceStartValue,v_SequenceIncrementBy, v_SequenceMaxValue,v_DependcyType, a_TableName,a_SchemaName,v_AttributeName; END LOOP; RETURN; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Sequences(a_SchemaName NAME, a_TableName NAME) IS '  ,    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; BEGIN TRANSACTION; DROP FUNCTION IF EXISTS admtf_Table_Sequences (a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)); /**********************************************************************/ /*    ,     */ /**********************************************************************/ CREATE OR REPLACE FUNCTION admtf_Table_Sequences (a_SchemaName VARCHAR(256) default 'public', /*     */ a_TableName VARCHAR(256) default NULL /*   */ ) RETURNS TABLE (r_SequenceNumber SMALLINT,r_SequenceName VARCHAR(256), r_SequenceSchemaName VARCHAR(256),r_SequenceDescription TEXT, r_SequenceStartValue BIGINT,r_SequenceIncrementBy BIGINT, r_SequenceMaxValue BIGINT,r_DependType VARCHAR(256), r_RefTableName VARCHAR(256),r_RefTableSchemaName VARCHAR(256), r_RefAttributeName VARCHAR(256)) AS $BODY$ DECLARE c_Delimiter CONSTANT VARCHAR(2):=','; --******************************************************* BEGIN RETURN QUERY SELECT ts.r_SequenceNumber::SMALLINT, ts.r_SequenceName::VARCHAR(256), ts.r_SequenceSchemaName::VARCHAR(256), ts.r_SequenceDescription::TEXT, ts.r_SequenceStartValue::BIGINT, ts.r_SequenceIncrementBy::BIGINT, ts.r_SequenceMaxValue::BIGINT, ts.r_DependType::VARCHAR(256), ts.r_RefTableName::VARCHAR(256), ts.r_RefTableSchemaName::VARCHAR(256), ts.r_RefAttributeName::VARCHAR(256) FROM admtf_Table_Sequences(a_SchemaName::NAME,a_TableName::NAME) ts; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Sequences(a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)) IS '  ,    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Table_Sequences('public'::VARCHAR(255), 'kr_road_network_vertices_pgr'::VARCHAR(255)); SELECT * FROM admtf_Table_Sequences('public'::NAME, 'kr_road_network_vertices_pgr'::NAME);</span></span></code> </pre><br></div></div><br><a name="fnTableRC"></a><br><h3>   admfn_Table_RowCount </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">       .</a> <br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admfn_Table_RowCount (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>); <span class="hljs-comment"><span class="hljs-comment">/******************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*       */</span></span> <span class="hljs-comment"><span class="hljs-comment">/******************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admfn_Table_RowCount (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'public'</span></span>,<span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> v_TableNumberOfRowCalc <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> v_Found BOOLEAN; <span class="hljs-comment"><span class="hljs-comment">--*********************************************************** BEGIN IF a_SchemaName ~ E'^[a-z_0-9]+$' AND a_TableName ~ E'^[a-z_0-9]+$' THEN EXECUTE 'SELECT count(*) FROM ' ||a_SchemaName ||'.'|| a_TableName INTO v_TableNumberOfRowCalc; ELSE SELECT INTO v_Found true FROM pg_class tbl INNER JOIN pg_namespace nspc ON tbl.relnamespace = nspc.oid WHERE tbl.relkind='r' AND tbl.relname=a_TableName AND nspc.nspname=a_SchemaName; IF FOUND THEN EXECUTE 'SELECT count(*) FROM ' || CASE WHEN a_SchemaName ~ E'^[a-z_0-9]+$' THEN a_SchemaName ELSE quote_ident(a_SchemaName) END ||'.'|| CASE WHEN a_TableName ~ E'^[a-z_0-9]+$' THEN a_TableName ELSE quote_ident(a_TableName) END INTO v_TableNumberOfRowCalc; ELSE SELECT INTO v_Found true FROM pg_class tbl INNER JOIN pg_namespace nspc ON tbl.relnamespace = nspc.oid WHERE tbl.relkind='r' AND LOWER(tbl.relname)= LOWER(a_TableName) AND nspc.nspname=LOWER(a_SchemaName); IF FOUND THEN EXECUTE 'SELECT count(*) FROM ' || a_SchemaName ||'.'||a_TableName INTO v_TableNumberOfRowCalc; END IF; END IF; END IF; RETURN v_TableNumberOfRowCalc; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admfn_Table_RowCount(a_SchemaName NAME,a_TableName NAME) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION;BEGIN TRANSACTION; DROP FUNCTION IF EXISTS admfn_Table_RowCount (a_SchemaName VARCHAR(256),a_TableName VARCHAR(256)); /********************************************************************/ /*       */ /********************************************************************/ CREATE OR REPLACE FUNCTION admfn_Table_RowCount (a_SchemaName VARCHAR(256) default 'public',/*     */ a_TableName VARCHAR(256) default NULL /*   */ ) RETURNS BIGINT AS $BODY$ DECLARE v_TableNumberOfRowCalc BIGINT; /*  */ --********************************************************* BEGIN RETURN admfn_Table_RowCount(a_SchemaName::NAME,a_TableName::NAME); END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admfn_Table_RowCount(a_SchemaName VARCHAR(256),a_TableName VARCHAR(256)) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECt admfn_Table_RowCount('public'::NAME,'Street'::NAME); SELECt admfn_Table_RowCount('public'::VARCHAR(256),'Street'::VARCHAR(256));</span></span></code> </pre><br></div></div><br><a name="tfTableIC"></a><h3>   admtf_Table_InheritanceChildrens </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">       .</a> <br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Table_InheritanceChildrens (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,a_Mode <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>)); <span class="hljs-comment"><span class="hljs-comment">/************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*       */</span></span> <span class="hljs-comment"><span class="hljs-comment">/************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Table_InheritanceChildrens (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'public'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> a_Mode <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'estimate'</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (rs_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,rs_TableDescription <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span>, rs_NumberOfAttribute <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>,rs_NumberOfChecks <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>, rs_hasPKey <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>,rs_hasIndex <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>, rs_hasSubClass <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>,rs_NumberOfRow <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> c_TableKind <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>:=<span class="hljs-string"><span class="hljs-string">'r'</span></span>; c_ExactlyMode CONSTANT VARCHAR(10):='exactly'; c_EstimateMode CONSTANT VARCHAR(10):='estimate'; v_TableOID OID; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SchemaName NAME; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_TableName NAME; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_TableDescription TEXT; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_TableNumberOfRowCalc INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_InheritanceRECORD RECORD; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_InheritanceOID OID; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RETURN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">QUERY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> rtbl.relname,rdsc.description,rtbl.relnatts::<span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>, rtbl.relchecks::<span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>,rtbl.relhaspkey,rtbl.relhasindex, rtbl.relhassubclass, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> a_Mode=c_ExactlyMode <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> admfn_Table_RowCount(rnspc.nspname,rtbl.relname)::<span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> rtbl.reltuples::<span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_class tbl <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace nspc <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.relnamespace = nspc.oid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_Description dsc <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.oid=dsc.objoid <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> dsc.objsubid=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_depend dp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.oid=dp.refobjid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class rtbl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> rtbl.OID=dp.objid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace rnspc <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> rtbl.relnamespace = rnspc.oid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_Description rdsc <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> rtbl.oid=rdsc.objoid <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> rdsc.objsubid=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> nspc.nspname=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SchemaName) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> tbl.relkind=c_TableKind <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> rtbl.relkind=c_TableKind <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> tbl.relname =<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_TableName) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> rtbl.relname; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Table_InheritanceChildrens(a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,a_Mode <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'    '</span></span>; <span class="hljs-comment"><span class="hljs-comment">--ROLLBACK TRANSACTION; COMMIT TRANSACTION; BEGIN TRANSACTION; DROP FUNCTION IF EXISTS admtf_Table_InheritanceChildrens (a_SchemaName VARCHAR(256),a_TableName VARCHAR(256),a_TableName NAME,a_Mode VARCHAR(10)); /************************************************************************/ /*       */ /************************************************************************/ CREATE OR REPLACE FUNCTION admtf_Table_InheritanceChildrens (a_SchemaName VARCHAR(256) default 'public',/*     */ a_TableName VARCHAR(256) default NULL,/*   */ a_Mode VARCHAR(10) default 'estimate' /*     */ ) RETURNS TABLE (rs_TableName VARCHAR(256),rs_TableDescription TEXT, rs_NumberOfAttribute INTEGER,rs_NumberOfChecks INTEGER, rs_hasPKey BOOLEAN,rs_hasIndex BOOLEAN, rs_hasSubClass BOOLEAN,rs_NumberOfRow INTEGER) AS $BODY$ DECLARE c_TableKind CONSTANT CHAR:='r'; BEGIN RETURN QUERY SELECT tic.rs_TableName::VARCHAR(256),tic.rs_TableDescription::TEXT, tic.rs_NumberOfAttribute::INTEGER,tic.rs_NumberOfChecks::INTEGER, tic.rs_hasPKey::BOOLEAN,tic.rs_hasIndex::BOOLEAN, tic.rs_hasSubClass::BOOLEAN,tic.rs_NumberOfRow::INTEGER FROM admtf_Table_InheritanceChildrens(a_SchemaName::NAME, a_TableName::NAME,a_Mode::VARCHAR(10)) tic; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_InheritanceChildrens(a_SchemaName VARCHAR(256),a_TableName VARCHAR(256),a_Mode VARCHAR(10)) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Table_InheritanceChildrens('public'::NAME,'np_house'::NAME); SELECT * FROM admtf_Table_InheritanceChildrens('public'::VARCHAR(256),'np_house'::VARCHAR(256));</span></span></code> </pre><br></div></div><br><a name="tfAttPK"></a><h3>   admtf_Attribute_PKFeatures </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">       .</a> <br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Attribute_PKFeatures (a_TableOID <span class="hljs-keyword"><span class="hljs-keyword">OID</span></span>,a_AttributeNo <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>); <span class="hljs-comment"><span class="hljs-comment">/***************************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*        . */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   ,          */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-comment"><span class="hljs-comment">/***************************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Attribute_PKFeatures (a_TableOID <span class="hljs-keyword"><span class="hljs-keyword">OID</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> a_AttributeNo <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (rs_isAttributePK <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>,rs_PKeyName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>,rs_ColumnPKNo <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> C_PKAttributeList_NDims <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>:=<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_PKAttributeList SMALLINT[]; <span class="hljs-comment"><span class="hljs-comment">/*       */</span></span> v_PKAttributeIndx INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> v_PKAttributeLBound INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> v_PKAttributeUBound INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> <span class="hljs-comment"><span class="hljs-comment">--********************************************************************** BEGIN rs_isAttributePK:=false; rs_ColumnPKNo:=NULL; SELECT INTO rs_PKeyName,v_PKAttributeList,rs_isAttributePK conname,conkey,ARRAY[a_AttributeNo]&lt;@conkey FROM pg_constraint c WHERE c.contype='p' and c.conrelid=a_TableOID; IF FOUND AND rs_isAttributePK THEN --      v_PKAttributeLBound:=array_lower(v_PKAttributeList,C_PKAttributeList_NDims); v_PKAttributeUBound:=array_upper(v_PKAttributeList,C_PKAttributeList_NDims); v_PKAttributeIndx:=v_PKAttributeLBound; WHILE v_PKAttributeIndx &lt;= v_PKAttributeUBound AND a_AttributeNo&lt;&gt;v_PKAttributeList[v_PKAttributeIndx] LOOP v_PKAttributeIndx:=v_PKAttributeIndx+1; END LOOP; IF v_PKAttributeIndx&lt;=v_PKAttributeUBound THEN rs_ColumnPKNo:=v_PKAttributeIndx; END IF; END IF; RETURN QUERY SELECT rs_isAttributePK,rs_PKeyName,rs_ColumnPKNo; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Attribute_PKFeatures(a_TableOID OID,a_AttributeNo SMALLINT) IS '              '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Attribute_PKFeatures((SELECT OID FROM pg_class WHERE relname='street'),3::SMALLINT);</span></span></code> </pre><br></div></div><br><a name="tfAttFK"></a><h3>   admtf_Attribute_FKFeatures </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">       .</a> <br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Attribute_FKFeatures (a_TableOID <span class="hljs-keyword"><span class="hljs-keyword">OID</span></span>,a_AttributeNo <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>); <span class="hljs-comment"><span class="hljs-comment">/****************************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*        . */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   ,         */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   . */</span></span> <span class="hljs-comment"><span class="hljs-comment">/****************************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/****************************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Attribute_FKFeatures (a_TableOID <span class="hljs-keyword"><span class="hljs-keyword">OID</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> a_AttributeNo <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (rs_isAttributeFK <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>,rs_FKeyName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>[],rs_ColumnFKNo <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>[],rs_FKTableName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>[],rs_FKTableColumnName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>[]) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> C_FKAttributeList_NDims <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>:=<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_FKAttributeList SMALLINT[]; <span class="hljs-comment"><span class="hljs-comment">/*       */</span></span> v_RefAttributeList SMALLINT[]; <span class="hljs-comment"><span class="hljs-comment">/*     , */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_FKAttributeIndx INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> v_RefAttributeListIndx INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*     , */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_FKAttributeLBound INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> v_FKAttributeUBound INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> v_FKConstraintIndx INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_FKeyName name; <span class="hljs-comment"><span class="hljs-comment">/*   , */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_FKTableName name; <span class="hljs-comment"><span class="hljs-comment">/*  ,     */</span></span> v_FKTableColumnName name; <span class="hljs-comment"><span class="hljs-comment">/*    , */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_RefAttributeNo SMALLINT; <span class="hljs-comment"><span class="hljs-comment">/*     , */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_Constraint pg_constraint%ROWTYPE; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*  (CONSTRANT) */</span></span> <span class="hljs-comment"><span class="hljs-comment">--****************************************************************************************************** BEGIN rs_isAttributeFK:=false; rs_ColumnFKNo:=NULL; v_FKConstraintIndx:=0; FOR v_Constraint IN SELECT * FROM pg_constraint c WHERE c.contype='f' and c.conrelid=a_TableOID AND ARRAY[a_AttributeNo]&lt;@conkey ORDER BY c.oid LOOP v_FKConstraintIndx:=v_FKConstraintIndx+1; rs_isAttributeFK:=true; v_FKeyName:=v_Constraint.conname; v_FKAttributeList:=v_Constraint.conkey; v_RefAttributeList:=v_Constraint.confkey; v_FKAttributeLBound:=array_lower(v_FKAttributeList,C_FKAttributeList_NDims); v_FKAttributeUBound:=array_upper(v_FKAttributeList,C_FKAttributeList_NDims); v_FKAttributeIndx:=v_FKAttributeLBound; WHILE v_FKAttributeIndx &lt;= v_FKAttributeUBound AND a_AttributeNo&lt;&gt;v_FKAttributeList[v_FKAttributeIndx] LOOP v_FKAttributeIndx:=v_FKAttributeIndx+1; END LOOP; rs_FKeyName[v_FKConstraintIndx]:=v_FKeyName; rs_ColumnFKNo[v_FKConstraintIndx]:=v_FKAttributeIndx; SELECT INTO v_FKTableName ftbl.relname FROM pg_class ftbl WHERE ftbl.oid=v_Constraint.confrelid; rs_FKTableName[v_FKConstraintIndx]:=v_FKTableName; v_RefAttributeNo:=v_RefAttributeList[v_FKAttributeIndx]; v_FKTableColumnName:=NULL; SELECT INTO v_FKTableColumnName attname FROM pg_attribute a WHERE a.attrelid=v_Constraint.confrelid AND a.attnum=v_RefAttributeNo; rs_FKTableColumnName[v_FKConstraintIndx]:=v_FKTableColumnName; END LOOP; RETURN QUERY SELECT rs_isAttributeFK,rs_FKeyName,rs_ColumnFKNo, rs_FKTableName,rs_FKTableColumnName; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Attribute_FKFeatures(a_TableOID OID,a_AttributeNo SMALLINT) IS '              '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Attribute_FKFeatures((SELECT OID FROM pg_class WHERE relname='street'),4::SMALLINT);</span></span></code> </pre><br></div></div><br><a name="tfAttF"></a><br><h3>   admtf_Attribute_Features </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">       .</a> <br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Attribute_Features (a_TableOID <span class="hljs-keyword"><span class="hljs-keyword">OID</span></span>,a_AttributeNo <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>); <span class="hljs-comment"><span class="hljs-comment">/****************************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> <span class="hljs-comment"><span class="hljs-comment">/****************************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Attribute_Features (a_TableOID <span class="hljs-keyword"><span class="hljs-keyword">OID</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> a_AttributeNo <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span><span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (rsa_AttributeName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>,rsa_UserTypeName <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">256</span></span>),rsa_TypeName <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">256</span></span>),rsa_isNotNULL <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>,rsa_isAttributePK <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>, rsa_ColumnPKNo <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>,rsa_Description <span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>,rsa_isAttributeFK <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>,rsa_FKeyName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>[],rsa_ColumnFKNo <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>[],rsa_FKTableName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>[],rsa_FKTableColumnName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>[]) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> v_Return_Error <span class="hljs-built_in"><span class="hljs-built_in">Integer</span></span> := <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-comment"><span class="hljs-comment">--********************************************************************* BEGIN SELECT INTO rsa_AttributeName,rsa_UserTypeName,rsa_TypeName, rsa_isNotNULL,rsa_Description attr.attname, CASE WHEN COALESCE(typ.typbasetype,0)&gt;0 THEN typ.typname::VARCHAR(100) ELSE ''END AS r_UserTypeName, FORMAT_TYPE(COALESCE(NULLIF(typ.typbasetype,0),typ.oid), COALESCE(NULLIF(typ.typtypmod,-1),attr.atttypmod))::VARCHAR(256) AS r_TypeName, attr.attnotnull AS r_isNotNULL, dsc.description AS r_Description FROM pg_attribute attr LEFT OUTER JOIN pg_type typ ON attr.atttypid=typ.oid LEFT OUTER JOIN pg_type btyp ON typ.typbasetype=btyp.oid LEFT OUTER JOIN pg_description dsc ON dsc.objoid=attr.attrelid AND dsc.objsubid=attr.attnum WHERE attr.attrelid =a_TableOID AND attr.attnum=a_AttributeNo; SELECT INTO rsa_isAttributePK,rsa_ColumnPKNo rs_isAttributePK,rs_ColumnPKNo FROM admtf_Attribute_PKFeatures(a_TableOID,a_AttributeNo); SELECT INTO rsa_isAttributeFK,rsa_FKeyName,rsa_ColumnFKNo,rsa_FKTableName, rsa_FKTableColumnName rs_isAttributeFK,rs_FKeyName, rs_ColumnFKNo,rs_FKTableName,rs_FKTableColumnName FROM admtf_Attribute_FKFeatures(a_TableOID,a_AttributeNo); RETURN QUERY SELECT rsa_AttributeName,rsa_UserTypeName,rsa_TypeName,rsa_isNotNULL, rsa_isAttributePK,rsa_ColumnPKNo,rsa_Description,rsa_isAttributeFK, rsa_FKeyName,rsa_ColumnFKNo,rsa_FKTableName,rsa_FKTableColumnName; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Attribute_Features(a_TableOID OID,a_AttributeNo SMALLINT) IS '   '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Attribute_Features ((SELECT OID FROM pg_class WHERE relname='street'),2::SMALLINT);</span></span></code> </pre><br></div></div><br><h3>  Siehe auch </h3><br> <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">     PostgreSQL.  </a> ;</b> <br> <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">     PostgreSQL.  </a> .</b> <br> <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">     PostgreSQL. ( )</a> .</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de418597/">https://habr.com/ru/post/de418597/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de418585/index.html">Erstellen einer lokalen Cross-Country-Karte des Roboters</a></li>
<li><a href="../de418587/index.html">Neue 3CX-Clients f√ºr Android und iOS mit OPUS- und PUSH-Codec f√ºr mehrere Ger√§te</a></li>
<li><a href="../de418589/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends f√ºr die letzte Woche Nr. 324 (23. - 29. Juli 2018)</a></li>
<li><a href="../de418591/index.html">Bug Bounty Kyivstar: Belohnung f√ºr Administratorzugriff auf Jira-, AWS-, Apple-, Google Developer- und Bitbucket-Dienste - 50 US-Dollar</a></li>
<li><a href="../de418593/index.html">Nicht alle drahtlosen Kopfh√∂rer sind gleicherma√üen n√ºtzlich oder ein paar Worte zum Codec-Problem</a></li>
<li><a href="../de418599/index.html">5 Datenquellen, die APM-Daten in Anwendungsleistungsanalysen umwandeln</a></li>
<li><a href="../de418601/index.html">Die ganze Wahrheit √ºber RTOS. Artikel 7. Nucleus SE: Einf√ºhrung</a></li>
<li><a href="../de418603/index.html">Matrix PowerWatch Smartwatch, die niemals aufgeladen werden muss</a></li>
<li><a href="../de418605/index.html">Analysten: Die Microsoft-Kapitalisierung k√∂nnte 1 Billion US-Dollar erreichen</a></li>
<li><a href="../de418607/index.html">Auswahl eines Anbieters f√ºr Unternehmens-WLAN</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>