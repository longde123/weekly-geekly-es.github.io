<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑🏿‍🤝‍🧑🏽 🚋 🦁 Crypt, XOR, Hacken von unverschlüsseltem ZIP und PRSP. Problemlösung mit r0ot-mi Crypto. Teil 2 🐋 👩🏽‍🤝‍👩🏻 🏛️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel lernen wir die Crypt-Funktion kennen, wie man Passwörter für ein ZIP-Archiv mit unverschlüsselten Dateinamen auswählt, sich mit dem ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Crypt, XOR, Hacken von unverschlüsseltem ZIP und PRSP. Problemlösung mit r0ot-mi Crypto. Teil 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482680/"><img src="https://habrastorage.org/webt/ux/pz/a0/uxpza0t6_t38ztc07yhtciypf8g.jpeg" alt="Bild"><br><br>  In diesem Artikel lernen wir die Crypt-Funktion kennen, wie man Passwörter für ein ZIP-Archiv mit unverschlüsselten Dateinamen auswählt, sich mit dem Dienstprogramm xortool vertraut macht und auch mit einem Pseudozufallszahlengenerator umgeht.  Vorherige Artikel zu diesem Thema: <br><br>  Teil 1 - <a href="https://habr.com/ru/post/472628/">Kodierungen, Shift-Chiffre, Brute-Hashes und Bilderzeugung mit PIL-Python.</a> <br><br><div class="spoiler">  <b class="spoiler_title">Organisatorische Informationen</b> <div class="spoiler_text">  Speziell für diejenigen, die etwas Neues lernen und sich in einem der Bereiche Informations- und Computersicherheit weiterentwickeln möchten, werde ich folgende Kategorien beschreiben und besprechen: <br><br><ul><li>  PWN; </li><li>  Kryptographie (Crypto); </li><li>  Netzwerktechnologien (Netzwerk); </li><li>  Reverse (Reverse Engineering); </li><li>  Steganographie (Stegano); </li><li>  Suche und Ausnutzung von WEB-Schwachstellen. </li></ul><br>  Darüber hinaus werde ich meine Erfahrungen in den Bereichen Computerforensik, Analyse von Malware und Firmware, Angriffe auf drahtlose Netzwerke und lokale Netzwerke, Durchführung von Pentests und Schreiben von Exploits teilen. <br><a name="habracut"></a><br>  Damit Sie sich über neue Artikel, Software und andere Informationen informieren können, habe ich <a href="https://t.me/RalfHackerChannel" rel="nofollow">in Telegram</a> einen <a href="https://t.me/RalfHackerChannel" rel="nofollow">Channel</a> und eine <a href="https://t.me/RalfHackerPublicChat" rel="nofollow">Gruppe erstellt, um alle Fragen</a> im Bereich ICD <a href="https://t.me/RalfHackerPublicChat" rel="nofollow">zu diskutieren</a> .  Auch ich werde Ihre persönlichen Wünsche, Fragen, Anregungen und Empfehlungen <a href="https://t.me/hackerralf8" rel="nofollow">persönlich</a> berücksichtigen <a href="https://t.me/hackerralf8" rel="nofollow">und auf alle antworten</a> . <br><br>  Alle Informationen werden nur zu Bildungszwecken bereitgestellt.  Der Autor dieses Dokuments übernimmt keine Verantwortung für Schäden, die jemandem durch die Verwendung von Kenntnissen und Methoden entstehen, die er durch das Studium dieses Dokuments erlangt hat. <br></div></div><br><br><h2>  ELF64 - PID-Verschlüsselung </h2><br><img src="https://habrastorage.org/webt/zp/9w/da/zp9wdanzxvhz4uiuusjcfd5coe8.png" alt="Bild"><br><br>  Wir schauen uns den Quellcode an.  Das Programm nimmt einen String als Argument und vergleicht ihn mit dem, was die cryt-Funktion von der PID des Programms und dem String "$ 1 $ awesome" zurückgibt. <br><br>  Die cryt-Funktion ist eine Bibliotheksfunktion, mit der der Passwort-Hash berechnet wird.  Die Ausgabe der Funktion ist nicht nur ein Hash, sondern eine Textzeile, die auch Salt, den verwendeten Hash-Algorithmus und die Parameter enthält, mit denen der Hash empfangen wurde, z. B. die Anzahl der Runden und andere Optionen. <br><br><img src="https://habrastorage.org/webt/jq/3f/3y/jq3f3y-d2srjnkudzwbrhxwsfsk.png" alt="Bild"><br><br>  Diese Funktion ist in den Programmiersprachen Perl, PHP, Pike, Python und Ruby enthalten.  Daher müssen Sie die PID erraten, mit der das Programm gestartet wird.  Nachdem wir uns über SSH verbunden haben, sehen wir, dass sie uns ein Programm, seine Quelle und eine Datei mit einem Passwort geben. <br><br><img src="https://habrastorage.org/webt/9m/8i/k7/9m8ik71wa-fei5gcp-hbcm01mpk.png" alt="Bild"><br><br>  Unter Linux erhält jede neu ausgeführte Anwendung den ungefähren inkrementellen freien PID-Wert.  Führen Sie beispielsweise ps mehrmals hintereinander aus.  Die PID wird jedes Mal erhöht. <br><br><img src="https://habrastorage.org/webt/iu/sr/db/iusrdb1rfj_k3rh116obbcee_ds.png" alt="Bild"><br><br>  Sie können also den Hash aus jeder freien PID berechnen und mit diesem Wert als Argument das Programm endlos ausführen.  Nehmen wir die PID, zum Beispiel 30000, und führen Sie die Verschlüsselungsfunktion aus.  Ich werde es in Python tun. <br><br><img src="https://habrastorage.org/webt/im/yh/pr/imyhpredd7_yoo0jvvlcjlz9zbg.png" alt="Bild"><br><br>  Führen Sie nun eine Endlosschleife der Programmausführung aus. <br><br><img src="https://habrastorage.org/webt/vx/y6/mr/vxy6mrtke5wyblw7fmzaz0_92nw.png" alt="Bild"><br><br>  Und eine Minute später erhalten wir eine Shell, von der wir das Passwort lesen. <br><br><img src="https://habrastorage.org/webt/m1/zu/u7/m1zuu7o4dytba97nopsqm0a-qck.png" alt="Bild"><br><br><h2>  Datei - PKZIP </h2><br><img src="https://habrastorage.org/webt/8h/fh/n8/8hfhn8x1q1c6mng5btrn9n3tpxm.png" alt="Bild"><br><br>  Laden Sie die Datei herunter, die sie uns geben.  Dies ist ein passwortgeschütztes ZIP-Archiv.  Lass uns das Passwort durchgehen.  Da die Dateinamen nicht verschlüsselt sind, machen wir es zum Dienstprogramm fcrackzip und nehmen rockyou.txt als Wörterbuch. <br><br><img src="https://habrastorage.org/webt/sd/mi/qt/sdmiqt3lilxfpbaxz8chexwtlrk.png" alt="Bild"><br><br>  Nach dem Entpacken erhalten wir eine Textdatei, in der steht, dass die Antwort das Passwort aus dem Archiv ist. <br><br><img src="https://habrastorage.org/webt/lp/m5/uq/lpm5uqukykoth4k-y_gjf8t2qqi.png" alt="Bild"><br><br><h2>  Bekannter Klartext - XOR </h2><br><img src="https://habrastorage.org/webt/eg/it/va/egitvahzvebbcqatvgwcqfclo-g.png" alt="Bild"><br><br>  Wir erhalten ein mit XOR BMP verschlüsseltes Bild.  Da wir XOR verwendet haben (ich nehme an, mit einem kurzen Schlüssel) und einen großen Chiffretext haben, können Sie xortool verwenden. <br><br><img src="https://habrastorage.org/webt/fe/uo/_r/feuo_rxvnihxkyvnz92balmp0ka.png" alt="Bild"><br><br>  Xortool glaubt daher, dass die wahrscheinlichste Schlüssellänge 6 ist. Lassen Sie uns ihn bitten, den Schlüssel zu bestimmen. <br><br><img src="https://habrastorage.org/webt/2j/tb/ol/2jtbol6v5yhbd0swhdy8cnbpn7g.png" alt="Bild"><br><br>  Großartig.  Der Schlüssel ist definiert, aber xortool selbst hat die Datei entschlüsselt und im Verzeichnis xortool_out gespeichert. <br><br><img src="https://habrastorage.org/webt/ul/wr/u4/ulwru45g91prmp9990nawqeu98c.png" alt="Bild"><br><br><h2>  Code - Pseudozufallszahlengenerator </h2><br><img src="https://habrastorage.org/webt/pd/pr/ns/pdprnsnnnqtgmthwxzpzzbgtg0e.png" alt="Bild"><br><br>  Wir erhalten ein Programm, mit dem die Datei verschlüsselt wird, sowie die Datei selbst.  Darüber hinaus heißt es, dass die Verschlüsselung im Dezember 2012 stattgefunden hat. Bereinigen wir den Code. <br><br>  Zu Beginn des Programms wird die aktuelle Uhrzeit gespeichert (genauer gesagt die seit dem 1. Januar 1970 verstrichene Uhrzeit).  Als nächstes wird das Vorhandensein des Programmparameters überprüft - der Pfad zur Datei. <br><br><img src="https://habrastorage.org/webt/te/ve/w6/tevew6jfzkm_160_8kit7_8ue-i.png" alt="Bild"><br><br><img src="https://habrastorage.org/webt/cf/bc/lo/cfbclozjtg9e6itqoj7t6rznmg4.png" alt="Bild"><br><br>  Dann wird diese Datei zum Lesen geöffnet und eine neue Datei zum Schreiben erstellt.  Die Deskriptoren beider Dateien werden an die Funktion crypt_file übergeben. <br><br><img src="https://habrastorage.org/webt/2h/ri/ya/2hriyayc7ulxizar3dhk_6ndj7m.png" alt="Bild"><br><br>  In crypt_file invertiert die Funktion genere_key () den 32-Byte-Schlüssel, der zum XOR-Verschlüsseln der Datei verwendet wird.  Das Verschlüsselungsergebnis wird in die neu erstellte Datei geschrieben. <br><br><img src="https://habrastorage.org/webt/tf/ed/s1/tfeds1s1m5txk8llicyfh6hmrbc.png" alt="Bild"><br><br>  Der Schlüssel wird pseudozufällig kompiliert.  Aus dem angezeigten Alphabet wird bei jedem Schritt ein Wert ausgewählt, der von dem Holdrand-Wert abhängt, der sich auch bei jedem Schritt ändert, und der ganz am Anfang der aktuellen Zeit entspricht. <br><br><img src="https://habrastorage.org/webt/c3/hm/mp/c3hmmpadb0yoqdaor0er7q_xtes.png" alt="Bild"><br><br>  Daher müssen wir mögliche Schlüssel generieren.  Der Python-Quellcode sieht so aus. <br><pre><code class="python hljs">keys = [] charset = <span class="hljs-string"><span class="hljs-string">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ123456789"</span></span> l = len(charset) holdrand = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Rand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> holdrand holdrand = holdrand * <span class="hljs-number"><span class="hljs-number">214013</span></span> + <span class="hljs-number"><span class="hljs-number">2531011</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((holdrand &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x7fff</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">genere_key</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> key = <span class="hljs-string"><span class="hljs-string">""</span></span>.join( [ charset[Rand()%l] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">32</span></span>) ] ) keys.append(key) start = ? fin = ? <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ts <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(start, fin): holdrand = ts genere_key()</code> </pre> <br><br>  Jetzt beschäftigen wir uns mit den Grenzen der Zeit.  Da die Verschlüsselung im Dezember 2012 durchgeführt wurde, müssen alle möglichen Werte vom 1. bis 31. Dezember sortiert werden. <br><br><img src="https://habrastorage.org/webt/_p/vj/i-/_pvji-osfxwv0e941u66gdemhmu.png" alt="Bild"><br><br><pre> <code class="python hljs">start = <span class="hljs-number"><span class="hljs-number">1354320000</span></span> fin = <span class="hljs-number"><span class="hljs-number">1356998400</span></span></code> </pre> <br><br>  Wir haben uns für die Grenzen entschieden, aber es wird noch viele Schlüssel geben.  Zum Glück hat die Datei ihre Endung - das ist bz2. <br><br><img src="https://habrastorage.org/webt/3m/ue/tq/3muetqnmr68aqqxdhurwzs-vae4.png" alt="Bild"><br><br>  Das heißt, die ersten drei Bytes der Datei müssen "BZh" sein, das vierte muss eines der Zeichen von "1" bis "9" sein und die nächsten sechs Bytes müssen 0x314159265359 sein.  Fügen wir einen Filter für die Schlüssel hinzu.  Dazu benötigen wir die ersten Bytes des Chiffretexts. <br><br><img src="https://habrastorage.org/webt/vq/dw/wf/vqdwwfaeqhc31rflnns7gr2wuiu.png" alt="Bild"><br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">key_filter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key)</span></span></span><span class="hljs-function">:</span></span> ctext = <span class="hljs-string"><span class="hljs-string">"\x23\x17\x5d\x70\x5a\x11\x6d\x67\x37\x08"</span></span> BZh = <span class="hljs-string"><span class="hljs-string">"BZh"</span></span> sign = <span class="hljs-string"><span class="hljs-string">""</span></span>.join( [ chr(ord(ctext[i])^ord(BZh[i])) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">3</span></span>) ] ) byte4 = <span class="hljs-string"><span class="hljs-string">""</span></span>.join( [ chr(ord(ctext[<span class="hljs-number"><span class="hljs-number">3</span></span>])^ord(i)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">"123456789"</span></span> ] ) bytePI = chr(ord(ctext[<span class="hljs-number"><span class="hljs-number">4</span></span>])^<span class="hljs-number"><span class="hljs-number">0x31</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sign <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> key[:<span class="hljs-number"><span class="hljs-number">3</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> key[<span class="hljs-number"><span class="hljs-number">3</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> byte4 <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> key[<span class="hljs-number"><span class="hljs-number">4</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> bytePI: print(key)</code> </pre> <br><br>  Und wir bekommen nur einen Schlüssel. <br><br><img src="https://habrastorage.org/webt/zv/yp/4i/zvyp4iyuuxu-m2daciww8howgbe.png" alt="Bild"><br><br>  Mit demselben Xortool können Sie die Datei mit dem Schlüssel als Proxy speichern. <br><br><img src="https://habrastorage.org/webt/b6/8t/ly/b68tlygv2_abbqakbsmc1bucywi.png" alt="Bild"><br><br>  Damit haben Sie das Archiv entschlüsselt. <br><br>  Sie können sich uns <a href="https://t.me/RalfHackerChannel" rel="nofollow">per Telegramm anschließen</a> .  Bauen wir eine Community auf, in der es Menschen geben wird, die sich in vielen Bereichen der IT auskennen. Dann können wir uns gegenseitig in allen Fragen der IT- und Informationssicherheit helfen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de482680/">https://habr.com/ru/post/de482680/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de482670/index.html">Verwenden einer Hybridfestplatte auf einem MacBook und Installieren von Windows darauf</a></li>
<li><a href="../de482672/index.html">Geschäftsbericht Habrapost - 2019</a></li>
<li><a href="../de482674/index.html">„Unmittelbar nach den Ferien“: Seminare, Meisterkurse und Technologiewettbewerbe an der ITMO University</a></li>
<li><a href="../de482676/index.html">Effektive Sortierung von Daten vom Typ Struct</a></li>
<li><a href="../de482678/index.html">Wie ich mich für eine SMS-Suche für iOS entschieden habe und was dabei herauskam</a></li>
<li><a href="../de482682/index.html">Qt Tool Automation</a></li>
<li><a href="../de482684/index.html">Ich habe in zwei Wochen mein eigenes Dipfake erstellt und $ 552</a></li>
<li><a href="../de482686/index.html">Wissenschaftler automatisieren Tierverhaltensforschung, um die Gehirnfunktion zu entschlüsseln</a></li>
<li><a href="../de482690/index.html">Erstellen Sie Ihren Publisher in Combine</a></li>
<li><a href="../de482692/index.html">Intel NUC Home für Arbeit und Virtualisierung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>