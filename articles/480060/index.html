<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßòüèª üà∑Ô∏è üöî Clasificador simple P300 en datos abiertos üèß üëº üåö</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mi colega Rafael Grigoryan eegdude escribi√≥ recientemente un art√≠culo sobre por qu√© la humanidad necesitaba EEG y qu√© fen√≥menos significativos se pued...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Clasificador simple P300 en datos abiertos</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480060/"><p>  Mi colega Rafael Grigoryan <a href="https://habr.com/ru/users/eegdude/" class="user_link">eegdude</a> <a href="https://m.habr.com/ru/post/479164/">escribi√≥ recientemente</a> un art√≠culo sobre por qu√© la humanidad necesitaba EEG y qu√© fen√≥menos significativos se pueden registrar en √©l.  Hoy, en continuaci√≥n del tema de las interfaces neuronales, utilizamos uno de los conjuntos de datos abiertos registrados en un juego utilizando la mec√°nica P300 para visualizar la se√±al EEG, ver la estructura de los potenciales llamados, construir los clasificadores principales, evaluar la calidad con la que podemos predecir la presencia de dicho potencial llamado. </p><br><p>  Perm√≠tame recordarle que P300 es un potencial llamado (VP), una respuesta espec√≠fica del cerebro asociada con la toma de decisiones y los est√≠mulos distintivos (que veremos a continuaci√≥n).  Generalmente se usa para construir BCI moderno. </p><br><p><img src="https://habrastorage.org/webt/l5/xn/iy/l5xniylmkybexkk6cym8dbhrmjq.png"></p><br><p>  Para hacer la clasificaci√≥n EEG, puedes llamar a tus amigos, escribir un juego sobre mapaches y demonios en realidad virtual, escribir tus propias reacciones y escribir un art√≠culo cient√≠fico (hablar√© de esto en otro momento), pero afortunadamente, cient√≠ficos de todo el mundo realiz√≥ algunos experimentos para nosotros y solo queda descargar los datos. </p><br><p>  Se puede encontrar un an√°lisis de c√≥mo construir una interfaz neuronal en el P300 con c√≥digo y visualizaciones paso a paso, as√≠ como un enlace al repositorio debajo del gato. </p><a name="habracut"></a><br><p>  El art√≠culo muestra solo los puntos principales del c√≥digo, la versi√≥n completa reproducible en el cuaderno jupyter <a href="https://gitlab.com/impulse-neiry_public/posts">para buscar aqu√≠</a> </p><br><p>  Desde el punto de vista de un EEG, el P300 es solo una explosi√≥n en un momento determinado en ciertos canales.  Hay muchas formas de llamarlo, por ejemplo, si se concentra en un objeto y se activa en un momento aleatorio (cambia de forma, color, brillo o salta en alg√∫n lugar).  As√≠ es como se implement√≥ en la antig√ºedad. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/wKDimrzvwYA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  En t√©rminos generales, el esquema es el siguiente: hay varios est√≠mulos (generalmente de 3 a 7) en el campo de visi√≥n de una persona.  Una persona elige uno de ellos y se enfoca en √©l (una buena manera es contar el n√∫mero de activaciones), luego cada objeto parpadea en un orden aleatorio.  Conociendo el tiempo de activaci√≥n de cada est√≠mulo, ahora podemos mirar el pr√≥ximo EEG y determinar si hubo un pico caracter√≠stico en √©l (lo veremos en las visualizaciones a continuaci√≥n).  Como la persona se concentr√≥ en un solo est√≠mulo, el pico deber√≠a ser uno.  Por lo tanto, en estas interfaces neuronales, se selecciona una de varias opciones (letras para escribir, acciones en el juego y Dios sabe qu√© m√°s).  Si hay m√°s de siete opciones, puede colocarlas en la cuadr√≠cula y reducir la tarea a seleccionar una fila + columna.  As√≠ es como se escribe arriba el cl√°sico deletreador de matriz P300. </p><br><p>  En el caso del conjunto de datos considerado hoy, la parte visual (como el nombre) fue tomada de los famosos <a href="https://en.wikipedia.org/wiki/Space_Invaders">proveedores de espacio del</a> juego.  Se ve√≠a algo como esto </p><br><p><img src="https://habrastorage.org/webt/xg/yb/du/xgybdulftmr0dpr4muypl7avlro.png" alt="Juego de Brain Inviders"></p><br><p>  De hecho, este es el mismo deletreador, solo las letras son reemplazadas por extraterrestres. <br>  El <a href="https://www.youtube.com/watch%3Fv%3Ds73l8ZfQcWw">video del proceso del juego</a> y <a href="https://arxiv.org/ftp/arxiv/papers/1905/1905.05182.pdf">los informes t√©cnicos</a> tambi√©n se conservaron. </p><br><p>  De una forma u otra, los datos recopilados con este juego aparecieron en Internet y podemos acceder a ellos.  Los datos consisten en 16 canales de EEG y un canal de eventos, que muestran en qu√© momentos se activaron el objetivo (hecho por el jugador) y los incentivos no objetivo, y trabajaremos con ellos. </p><br><p> La mayor√≠a de los conjuntos de datos para BCI fueron grabados por neurofisi√≥logos, y estos son tipos a los que realmente no les importa la compatibilidad, por lo que los formatos de datos son muy diversos: desde diferentes versiones de archivos <code>.mat</code> hasta formatos "est√°ndar" <a href="https://en.wikipedia.org/wiki/European_Data_Format"><code>.edf</code></a> y <a href="https://en.wikipedia.org/wiki/General_Data_Format_for_Biomedical_Signals"><code>.gdf</code></a> . <br>  Lo m√°s importante que necesita saber sobre estos formatos es que no desea analizarlos o trabajar con ellos directamente. <br>  Afortunadamente, un grupo de entusiastas de <a href="https://neurotechx.com/">NeuroTechX</a> escribi√≥ descargadores para algunos conjuntos de datos directamente en numpy. <br>  Estos <a href="https://github.com/NeuroTechX/moabb/tree/master/moabb">gestores de</a> arranque son parte del proyecto <a href="https://github.com/NeuroTechX/moabb/tree/master/moabb">moabb</a> que dice ser una soluci√≥n universal para BCI. </p><br><h2 id="zagruzka-syrogo-dataseta">  Descargar conjunto de datos sin procesar </h2><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> moabb.datasets sampling_rate = <span class="hljs-number"><span class="hljs-number">512</span></span> m_dataset = moabb.datasets.bi2013a( NonAdaptive=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, Adaptive=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, Training=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, Online=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, ) m_dataset.download() m_data = m_dataset.get_data()</code> </pre> <br><p>  En esta etapa, obtuvimos una estructura <a href="https://mne.tools/stable/generated/mne.io.Raw.html">RawEDF</a> que contiene registros EEG.  Esta es una estructura del paquete <a href="https://mne.tools/stable/index.html"><code>mne</code></a> , los bi√≥logos generalmente la usan para interactuar con las se√±ales: esta estructura tiene m√©todos incorporados para filtrar, visualizar, almacenar etiquetas, y nunca se sabe.  Pero no iremos por este camino desde  la interfaz del paquete tiende a ser inestable (la versi√≥n actual es <code>0.19</code> , pero usaremos <code>0.17</code> ya que la nueva versi√≥n ya no lee el conjunto de datos) y est√° mal documentada, a trav√©s de esto nuestros resultados pueden volverse irreproducibles. </p><br><p>  Lo que tomamos de la estructura resultante son las etiquetas de canal en <a href="https://en.wikipedia.org/wiki/10%25E2%2580%259320_system_(EEG)">el sistema 10-20</a> .  Esta es una disposici√≥n internacional de electrodos en la cabeza de una persona, creada para que los cient√≠ficos puedan correlacionar las zonas del cerebro y las ubicaciones de los canales de EEG.  A continuaci√≥n se muestra la disposici√≥n de los electrodos en el sistema 10-10 (difiere de 10-20 por el doble de la densidad de marcado) y los canales que se registraron en este conjunto de datos est√°n marcados en rojo. <br><img src="https://habrastorage.org/webt/j0/x0/uq/j0x0uq27-vjl277bgamcuuz3qpy.jpeg" alt="sistema 10-10"></p><br><pre> <code class="python hljs">print(m_data[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-string"><span class="hljs-string">'session_1'</span></span>][<span class="hljs-string"><span class="hljs-string">'run_1'</span></span>]) <span class="hljs-comment"><span class="hljs-comment"># &lt;RawEDF | 1.gdf, n_channels x n_times : 17 x 159232 (311.0 sec), ~20.7 MB, data loaded&gt; channels = m_data[1]['session_1']['run_1'].ch_names[:-1] channels # ['FP1', 'FP2', 'F5', 'AFz', 'F6', 'T7', 'Cz', 'T8', 'P7', 'P3', 'Pz', 'P4', 'P8', 'O1', 'Oz', 'O2']</span></span></code> </pre><br><p>  Primero, a partir de los datos descargados para cada sujeto, asignamos matrices de EEG continuo durante 16 segundos y todas las etiquetas para este intervalo (en los datos, este es solo otro canal en el que se se√±alan los comienzos de los eventos que nos interesan). </p><br><p>  En esta etapa, mantenemos la longitud m√°xima del EEG continuo para no encontrar efectos de borde durante el filtrado posterior. </p><br><pre> <code class="python hljs">raw_dataset = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, sessions <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sorted(m_data.items()): eegs, markers = [], [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item, run <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sorted(sessions[<span class="hljs-string"><span class="hljs-string">'session_1'</span></span>].items()): data = run.get_data() eegs.append(data[:<span class="hljs-number"><span class="hljs-number">-1</span></span>]) markers.append(data[<span class="hljs-number"><span class="hljs-number">-1</span></span>]) raw_dataset.append((eegs, markers))</code> </pre> <br><h2 id="filtraciya-i-razdelenie-na-epohi">  Filtrado y Separaci√≥n </h2><br><p>  En general, para revisar los m√©todos de preprocesamiento y clasificaci√≥n del EEG, puedo recomendar <a href="https://iopscience.iop.org/article/10.1088/1741-2552/aab2f2/meta">una excelente visi√≥n general</a> de los maestros de las interfaces de neurocomputadoras.  Adem√°s, no hace mucho tiempo se lanz√≥ una <a href="https://iopscience.iop.org/article/10.1088/1741-2552/ab0ab5">revisi√≥n</a> m√°s <a href="https://iopscience.iop.org/article/10.1088/1741-2552/ab0ab5">reciente de</a> las pruebas de redes neuronales. </p><br><p>  El preprocesamiento m√≠nimo de la se√±al EEG para la clasificaci√≥n incluye 3 pasos: </p><br><ul><li>  diezmado </li><li>  filtrado </li><li>  escalado </li></ul><br><p>  Para implementar estos pasos, utilizaremos el viejo <code>sklearn</code> y su paradigma para transformadores y tuber√≠as para que nuestro preprocesamiento pueda ser f√°cilmente extensible. <br>  El c√≥digo de los transformadores se coloca en un archivo separado, a continuaci√≥n describiremos algunos detalles. </p><br><p>  <strong>Diezmacion</strong> </p><br><p>  Por alguna raz√≥n, en algunos art√≠culos y ejemplos de procesamiento, encontr√© una disminuci√≥n en la frecuencia de la se√±al simplemente arrojando muestras en el estilo <code>eeg = eeg[:, ::10]</code> .  Esto es completamente incorrecto (por qu√©, vea cualquier libro sobre procesamiento de se√±ales).  Utilizamos la <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.decimate.html"><code>  scipy</code></a> est√°ndar <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.decimate.html"><code>  scipy</code></a> . </p><br><p>  <strong>Filtrado</strong> </p><br><p>  Aqu√≠, tambi√©n confiamos en filtros <code>scipy</code> seleccionando un filtro de paso de banda Butterworth de 4 √≥rdenes y aplic√°ndolo en la direcci√≥n hacia adelante y hacia atr√°s ( <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.filtfilt.html"><code>filtfilt</code></a> ) para mantener la fase.  Frecuencias de corte: de 0,5 a 20 Hz, este es el rango est√°ndar para nuestra tarea. </p><br><p>  <strong>Escalamiento</strong> </p><br><p>  Utilizamos un <code>StandardScaler</code> por canal (resta el promedio, se divide por la desviaci√≥n est√°ndar), que ve todas las se√±ales de la muestra.  De hecho, se introduce una peque√±a fuga de datos en este punto.  formalmente, el escalador tambi√©n ve datos de la muestra de prueba, pero con vol√∫menes de datos suficientemente grandes, la media y la desviaci√≥n son las mismas. <br>  La masturbaci√≥n se realiza canal por canal para que dentro del mismo conjunto de datos sea posible agregar datos de diferentes sensores que tengan diferentes √≥rdenes de magnitud y naturaleza (por ejemplo, <a href="https://ru.wikipedia.org/wiki/%25D0%25AD%25D0%25BB%25D0%25B5%25D0%25BA%25D1%2582%25D1%2580%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F_%25D0%25B0%25D0%25BA%25D1%2582%25D0%25B8%25D0%25B2%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D1%258C_%25D0%25BA%25D0%25BE%25D0%25B6%25D0%25B8">reacci√≥n galv√°nica de la piel (RAG)</a> ) </p><br><p>  Adem√°s de las operaciones anteriores, tambi√©n fue posible distinguir artefactos en el EEG (parpadeo, movimientos de masticaci√≥n, movimientos de la cabeza), pero este conjunto de datos ya est√° muy limpio, as√≠ que vamos a dejarlo hasta la pr√≥xima. </p><br><pre> <code class="python hljs">reload(transformers) decimation_factor = <span class="hljs-number"><span class="hljs-number">10</span></span> final_rate = sampling_rate // decimation_factor epoch_duration = <span class="hljs-number"><span class="hljs-number">0.9</span></span> <span class="hljs-comment"><span class="hljs-comment"># seconds epoch_count = int(epoch_duration * final_rate) eeg_pipe = make_pipeline( transformers.Decimator(decimation_factor), transformers.ButterFilter(sampling_rate // decimation_factor, 4, 0.5, 20), transformers.ChannellwiseScaler(StandardScaler()), ) markers_pipe = transformers.MarkersTransformer(labels_mapping, decimation_factor)</span></span></code> </pre> <br><p>  A continuaci√≥n, aplicaremos la tuber√≠a de preprocesamiento a nuestros datos y cortaremos la se√±al EEG continua en √©pocas.  Llamaremos a la √©poca el per√≠odo de tiempo inmediatamente despu√©s de la activaci√≥n del est√≠mulo con una duraci√≥n caracter√≠stica de 0.5-1 segundo, en nuestro caso, la duraci√≥n es de 900 ms, aunque puede acortarse. </p><br><p>  En nuestro conjunto de datos hay 16 canales de EEG, despu√©s de aplicar el diezmado, la frecuencia caer√° a 50 Hz, por lo que una √©poca se describir√° mediante una matriz <code>(16, 45)</code> - 900 ms a 50 Hz son 45 muestras de tiempo. </p><br><p>  Las etiquetas en este conjunto de datos son solo binarios: marcan las se√±ales objetivo (ocultas por el jugador, activo, 1) y no objetivo (vac√≠o, 0). </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> eegs, _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> raw_dataset: eeg_pipe.fit(eegs) dataset = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> eegs, markers <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> raw_dataset: epochs = [] labels = [] filtered = eeg_pipe.transform(eegs) markups = markers_pipe.transform(markers) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> signal, markup <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> zip(filtered, markups): epochs.extend([signal[:, start:(start + epoch_count)] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> start <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> markup[:, <span class="hljs-number"><span class="hljs-number">0</span></span>]]) labels.extend(markup[:, <span class="hljs-number"><span class="hljs-number">1</span></span>]) dataset.append((np.array(epochs), np.array(labels)))</code> </pre> <br><pre> <code class="python hljs">dataset[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>].shape, dataset[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>].shape <span class="hljs-comment"><span class="hljs-comment"># ((1308, 16, 45), (1308,))</span></span></code> </pre> <br><p>  Entonces obtuvimos un <code>Pytorch</code> de <code>Pytorch</code> estilo Pytorch en el que el primer √≠ndice cuenta a diferentes personas.  Con esta estructura, podemos realizar una validaci√≥n cruzada dentro de los datos de una persona y probar la tolerancia del clasificador entre diferentes personas (el llamado aprendizaje de transferencia, predicci√≥n sin calibraci√≥n).  Los datos de una persona consisten en una serie de eras y etiquetas de clase.  El n√∫mero de eras para cada persona var√≠a ligeramente debido a las caracter√≠sticas de la grabaci√≥n. </p><br><h2 id="issledovanie-i-vizualizaciya-dannyh">  Investigaci√≥n y visualizaci√≥n de datos. </h2><br><p>  Primero, eche un vistazo a una de las se√±ales continuas antes de dividir en √©pocas. </p><br><p>  A pesar de que ya se ha filtrado, no muestra ninguna activaci√≥n en el ojo y se parece m√°s a alg√∫n tipo de ruido. </p><br><p><img src="https://habrastorage.org/webt/mb/xy/js/mbxyjsh7g4ch3an8smi2wtpujpw.png" alt="Se√±al de EEG filtrada de una carrera del juego"></p><br><p>  Si consideramos solo una √©poca objetivo de nuestro conjunto de datos, entonces veremos un aumento caracter√≠stico en el intervalo de 400-600 ms.  Este es nuestro potencial buscado P300. </p><br><p><img src="https://habrastorage.org/webt/eu/v9/k-/euv9k-t6w0nss44m2fnvt_mrhxs.png" alt="√©poca p300"></p><br><p>  En total, en nuestro conjunto de datos hay aproximadamente 35 mil √©pocas, es decir, activaci√≥n de est√≠mulo.  Cada persona tiene aproximadamente 1300 a 1750 (esto se debe al hecho de que alguien derrib√≥ a los alien√≠genas m√°s r√°pido y alguien m√°s lento). </p><br><p>  Tambi√©n hay un notable desequilibrio en las clases: 1 a 5 a favor de los est√≠mulos vac√≠os.  Tenemos 6 filas y columnas en la matriz y solo una de ellas es el objetivo.  M√°s tarde volveremos a esto cuando discutamos las m√©tricas obtenidas. </p><br><p><img src="https://habrastorage.org/webt/ed/7n/jb/ed7njbim3sdcge3lpb-_ll8ucls.png" alt="equilibrio de clase"></p><br><p>  Ahora es el momento de ver la diferencia entre la se√±al objetivo y la no objetivo </p><br><p><img src="https://habrastorage.org/webt/c5/tx/oa/c5txoadzfwl8qzg8t-29siuftnw.png" alt="respuesta media del conjunto de datos"></p><br><p>  En el gr√°fico de la izquierda, puede ver que las se√±ales promedio var√≠an mucho, y ambas tienen una respuesta no espec√≠fica en la regi√≥n de 180 ms, pero el objetivo tiene mucha m√°s amplitud, el objetivo tambi√©n tiene una joroba caracter√≠stica de 250 a 500 ms: este es el notorio P300. </p><br><p>  Con tal diferencia en la se√±al, nuestra tarea puede parecer un poco insignificante, pero si agregamos la desviaci√≥n est√°ndar en cada punto al gr√°fico, veremos que la imagen no es tan optimista: la se√±al es bastante ruidosa.  Y esto a pesar del hecho de que la relaci√≥n se√±al / ruido para el P300 se considera una de las m√°s altas en neurofisiolog√≠a. </p><br><p>  (En realidad, estos gr√°ficos no se construyen con honestidad, ya que la se√±al vac√≠a se promedia en cinco veces m√°s muestras diferentes, por lo que las desviaciones aleatorias se ahogan m√°s, pero como podemos ver en la dispersi√≥n del mismo orden, esto no ayuda demasiado) </p><br><p><img src="https://habrastorage.org/webt/7b/nw/hw/7bnwhwdx7xrbkvwgqiw9jc5um5g.png" alt="Respuesta media de la persona"></p><br><p>  Tambi√©n es √∫til observar las se√±ales promedio de una persona. </p><br><p>  Aqu√≠ se encuentra el comentario anterior sobre el promedio "deshonesto": la se√±al vac√≠a es notablemente m√°s amplitud que con el promedio sobre todo.  Adem√°s, el pico de P300 en una persona es mayor debido a un promedio menor. </p><br><p>  Es importante tener en cuenta otra caracter√≠stica de la se√±al de una persona: tiene una forma ligeramente diferente a la generalizada.  La variabilidad interpersonal de las reacciones neurofisiol√≥gicas es bastante alta, a√∫n veremos la influencia de este factor en el trabajo de los clasificadores.  Sin embargo, las diferencias intrapersonales (una persona en un estado de √°nimo diferente, nivel de estr√©s, fatiga) tambi√©n es bastante grande. </p><br><p><img src="https://habrastorage.org/webt/jt/kj/sj/jtkjsjbgmym86-unjyshdxgtd80.png" alt="png"></p><br><p>  A continuaci√≥n, vemos el barrido canal por canal de las se√±ales.  El punto de vista aqu√≠ coincide con la imagen de arriba, que representa la posici√≥n de los electrodos: nariz arriba, etc. </p><br><p>  La respuesta de cada parte de la cabeza es diferente.  En Fp1,2, se pronuncian dos picos negativos que preceden al pico positivo.  Adem√°s, en algunos canales hay dos picos positivos, y en algunos, uno o algo de transici√≥n entre ellos. </p><br><p>  Los diferentes canales son de diferente importancia para determinar la presencia de P300, se puede estimar usando diferentes m√©todos: calcular informaci√≥n mutua (informaci√≥n mutua) o el m√©todo de agregar-eliminar (tambi√©n conocido como regresi√≥n gradual).  La aplicaci√≥n de estos m√©todos nos ocuparemos en otro momento. </p><br><p>  Vale la pena recordar que medimos la diferencia de potencial entre los electrodos con electrodos, lo que significa que podemos construir mapas de voltaje para toda la cabeza en ciertos puntos en el tiempo usando cambios de voltaje en puntos individuales.  Est√° claro que si hay 16 electrodos, la precisi√≥n de dicha tarjeta deja mucho que desear, pero se debe formar algo de comprensi√≥n.  ( <code>mne</code> por defecto espera ver microvoltios, pero ya hemos aplicado la escala, por lo que los valores absolutos no son correctos) </p><br><p><img src="https://habrastorage.org/webt/zq/2y/kz/zq2ykzbpc6oxqz2woyizwuswod4.png" alt="png"></p><br><p><img src="https://habrastorage.org/webt/l5/xn/iy/l5xniylmkybexkk6cym8dbhrmjq.png" alt="png"></p><br><h2 id="klassifikaciya">  Clasificaci√≥n </h2><br><p>  Finalmente, es hora de aplicar m√©todos de aprendizaje autom√°tico a nuestra muestra. </p><br><p>  Se eligieron varios b√°sicos como clasificadores: un registro.  Regresi√≥n, el m√©todo de vector de soporte (SVM) y varios m√©todos que utilizan el an√°lisis de correlaci√≥n del paquete <a href="https://github.com/alexandrebarachant/pyRiemann"><code>pyriemann</code></a> (los detalles de cada m√©todo se pueden encontrar en la documentaci√≥n), vale la pena se√±alar que estos m√©todos fueron especialmente desarrollados para su aplicaci√≥n al EEG y con su ayuda se ganaron <a href="https://www.kaggle.com/c/inria-bci-challenge/discussion/12819">varios</a> <a href="https://www.kaggle.com/c/grasp-and-lift-eeg-detection/discussion/16479">concursos</a> kaggle </p><br><pre> <code class="python hljs">clfs = { <span class="hljs-string"><span class="hljs-string">'LR'</span></span>: ( make_pipeline(Vectorizer(), LogisticRegression()), {<span class="hljs-string"><span class="hljs-string">'logisticregression__C'</span></span>: np.exp(np.linspace(<span class="hljs-number"><span class="hljs-number">-4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>))}, ), <span class="hljs-string"><span class="hljs-string">'LDA'</span></span>: ( make_pipeline(Vectorizer(), LDA(shrinkage=<span class="hljs-string"><span class="hljs-string">'auto'</span></span>, solver=<span class="hljs-string"><span class="hljs-string">'eigen'</span></span>)), {}, ), <span class="hljs-string"><span class="hljs-string">'SVM'</span></span>: ( make_pipeline(Vectorizer(), SVC()), {<span class="hljs-string"><span class="hljs-string">'svc__C'</span></span>: np.exp(np.linspace(<span class="hljs-number"><span class="hljs-number">-4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>))}, ), <span class="hljs-string"><span class="hljs-string">'CSP LDA'</span></span>: ( make_pipeline(CSP(), LDA(shrinkage=<span class="hljs-string"><span class="hljs-string">'auto'</span></span>, solver=<span class="hljs-string"><span class="hljs-string">'eigen'</span></span>)), {<span class="hljs-string"><span class="hljs-string">'csp__n_components'</span></span>: (<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>), <span class="hljs-string"><span class="hljs-string">'csp__cov_est'</span></span>: (<span class="hljs-string"><span class="hljs-string">'concat'</span></span>, <span class="hljs-string"><span class="hljs-string">'epoch'</span></span>)}, ), <span class="hljs-string"><span class="hljs-string">'Xdawn LDA'</span></span>: ( make_pipeline(Xdawn(<span class="hljs-number"><span class="hljs-number">2</span></span>, classes=[<span class="hljs-number"><span class="hljs-number">1</span></span>]), Vectorizer(), LDA(shrinkage=<span class="hljs-string"><span class="hljs-string">'auto'</span></span>, solver=<span class="hljs-string"><span class="hljs-string">'eigen'</span></span>)), {}, ), <span class="hljs-string"><span class="hljs-string">'ERPCov TS LR'</span></span>: ( make_pipeline(ERPCovariances(estimator=<span class="hljs-string"><span class="hljs-string">'oas'</span></span>), TangentSpace(), LogisticRegression()), {<span class="hljs-string"><span class="hljs-string">'erpcovariances__estimator'</span></span>: (<span class="hljs-string"><span class="hljs-string">'lwf'</span></span>, <span class="hljs-string"><span class="hljs-string">'oas'</span></span>)}, ), <span class="hljs-string"><span class="hljs-string">'ERPCov MDM'</span></span>: ( make_pipeline(ERPCovariances(), MDM()), {<span class="hljs-string"><span class="hljs-string">'erpcovariances__estimator'</span></span>: (<span class="hljs-string"><span class="hljs-string">'lwf'</span></span>, <span class="hljs-string"><span class="hljs-string">'oas'</span></span>)}, ), }</code> </pre> <br><p><img src="https://habrastorage.org/webt/3x/yb/qc/3xybqcusgidyxfs5lfcilxqn-gs.png" alt="registro de validaci√≥n cruzada"></p><br><p>  El esquema m√°s com√∫n de las interfaces neuronales es "calibraci√≥n + trabajo", es decir  Primero, es necesario que una persona se concentre en los est√≠mulos previamente indicados durante alg√∫n tiempo, y solo despu√©s de eso predecimos su elecci√≥n.  Este enfoque tiene la desventaja obvia de una etapa inicial aburrida. </p><br><p>  Para evaluar el rendimiento de nuestros m√©todos en este modo, realizaremos la validaci√≥n cruzada dentro de las eras de una persona. <br>  La m√©trica de precisi√≥n en este caso no es relevante debido al desequilibrio del conjunto de datos (la l√≠nea base aqu√≠ es 5/6 ~ 83%), por lo que prefiero mirar el tres de precisi√≥n de recuperaci√≥n-f1. </p><br><p>  Para revisar todo el conjunto de datos, promediamos los resultados de dicha validaci√≥n cruzada en todas las personas.  En general, el rendimiento de los mejores modelos es bastante alto en comparaci√≥n con lo que tenemos en <a href="https://impulse-neiry.com/">Neiry</a> en las condiciones de "campo" de un parque de atracciones (recuerdo que este conjunto de datos se registr√≥ en el laboratorio). </p><br><p>  En este conjunto de datos solo hay etiquetas binarias para los datos.  En general, necesitamos resolver el problema multiclase de elegir uno de los est√≠mulos (por cierto, est√° equilibrado ya que cada est√≠mulo se activa el mismo n√∫mero de veces).  Para resolverlo, el n√∫mero de activaciones de cada est√≠mulo generalmente se fija (por ejemplo, 6 est√≠mulos de 5 activaciones cada uno) y todos los est√≠mulos se activan aleatoriamente (30 veces), se obtienen 30 √©pocas y se suman las probabilidades de sus activaciones para ser objetivo, despu√©s de lo cual el est√≠mulo que ha alcanzado el m√°ximo El importe se reconoce como objetivo.  Demostraremos la implementaci√≥n de este enfoque en una publicaci√≥n futura en un conjunto de datos adecuado. </p><br><p><img src="https://habrastorage.org/webt/zx/-o/lm/zx-olmert9y5wdjpebgqa1dy8zm.png" alt="crossvalidate_dataset"></p><br><p>  El segundo esquema se llama transferencia de aprendizaje, es decir, la transferencia del clasificador entre personas.  El hecho es que cuando hacemos la calibraci√≥n, en realidad volvemos a entrenar a la forma m√°xima de una persona, por lo que podemos predecirlo bien en las pruebas posteriores.  En ausencia de calibraci√≥n, el clasificador pre-entrenado deber√≠a poder aislar el concepto P300 sin conocer de antemano la forma de onda de una persona en particular. </p><br><p>  Llevaremos a cabo dos experimentos: entrenaremos el clasificador en una persona, y pronosticaremos cinco, y luego aumentaremos la muestra de entrenamiento a 10 personas y compararemos los resultados para asegurarnos de que los modelos puedan aumentar su capacidad de generalizaci√≥n. </p><br><p>  Entrenamiento para 1 persona <br><img src="https://habrastorage.org/webt/fk/n5/5w/fkn55wh6yl7hfpjtjrqesq8gm8e.png" alt="transfer_validate_1"></p><br><p>  Entrenamiento para 10 personas. <br><img src="https://habrastorage.org/webt/in/ol/kq/inolkqy3-fezzcavmstah4vwhic.png" alt="transfer_valiidate_10"></p><br><p>  Entonces f1 subi√≥ de 0.23 a 0.4 para un mejor clasificador (en ambos casos es una regresi√≥n logar√≠tmica con la misma regularizaci√≥n). </p><br><p>  Esto significa que la capacidad predictiva ha aumentado de "no" a "aceptable".  Seg√∫n nuestra experiencia, con tales m√©tricas del problema binario, 5 activaciones de cada est√≠mulo son suficientes para lograr la precisi√≥n del problema multiclase de aproximadamente el 75%. </p><br><p>  Al final, quiero se√±alar que el m√©todo anterior es bastante primitivo, lo que se puede ver, por ejemplo, por un alto grado de regularizaci√≥n de la regresi√≥n logar√≠tmica: los canales en los datos est√°n bastante correlacionados y hay varios enfoques para resolver esta circunstancia. </p><br><h2 id="zaklyuchenie">  Conclusi√≥n </h2><br><p>  Hoy, nos familiarizamos m√°s con el potencial evocado del P300 y construimos una tuber√≠a simple para la interfaz neuronal.  Recomiendo a aquellos interesados ‚Äã‚Äãen abrir una computadora port√°til por su cuenta (ubicada en el <a href="https://gitlab.com/impulse-neiry_public/posts">repositorio</a> ) y experimentar con opciones de visualizaci√≥n y clasificadores. </p><br><p>  Teniendo una comprensi√≥n b√°sica de los m√©todos de trabajo con la se√±al EEG, podremos examinar m√°s a fondo este tema: aplicar m√©todos avanzados de preprocesamiento, as√≠ como redes neuronales, para resolver los problemas de la construcci√≥n de interfaces neuronales.  Continuar√° ... </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/480060/">https://habr.com/ru/post/480060/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../480048/index.html">Desmitificando el nuevo .NET Core 3 Worker Service</a></li>
<li><a href="../480050/index.html">Estudios de campo del concepto de "Documentaci√≥n como c√≥digo"</a></li>
<li><a href="../480052/index.html">SEO vs. PPC - ¬øQu√© es mejor para su negocio?</a></li>
<li><a href="../480056/index.html">Activaci√≥n de c√°mara oculta por navegadores: ¬øBig Brother o error de c√°lculo tecnol√≥gico?</a></li>
<li><a href="../480058/index.html">Estrella transformadora en el √°rbol de navidad</a></li>
<li><a href="../480062/index.html">10 sistemas de control. ¬øD√≥nde es m√°s conveniente comunicarse sobre tareas y compartir archivos?</a></li>
<li><a href="../480064/index.html">Aprender palabras agrupadas tem√°ticamente</a></li>
<li><a href="../480068/index.html">[Actualizaci√≥n] Nuestra gente es golpeada, y estaremos en silencio?</a></li>
<li><a href="../480070/index.html">Reaccionar beneficios: ¬øuna bendici√≥n para las empresas?</a></li>
<li><a href="../480072/index.html">Kubernetes: ¬øpor qu√© es tan importante configurar la gesti√≥n de recursos del sistema?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>