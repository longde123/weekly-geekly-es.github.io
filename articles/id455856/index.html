<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚û°Ô∏è üóÉÔ∏è üôÜ Suhu nirkabel, kelembaban dan sensor tekanan atmosfer pada nRF52832 üöù üëåüèæ üïú</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salam untuk semua pembaca Habr! Artikel hari ini akan membahas tentang sensor suhu, kelembaban, dan tekanan atmosfer dengan masa pakai baterai yang la...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Suhu nirkabel, kelembaban dan sensor tekanan atmosfer pada nRF52832</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455856/">  Salam untuk semua pembaca Habr!  Artikel hari ini akan membahas tentang sensor suhu, kelembaban, dan tekanan atmosfer dengan masa pakai baterai yang lama.  Sensor bekerja pada mikrokontroler nRF52832 ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">lembar data</a> ).  Untuk mendapatkan suhu, kelembaban dan tekanan atmosfer, sensor - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">datasheet</a> BME280 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">digunakan</a> .  Sensor ini didukung oleh baterai CR2430 / CR2450 / CR2477.  Konsumsi dalam mode transmisi adalah 8mA, dalam mode tidur 5mA.  Jadi, soal pesanan. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9h/zc/oz/9hzcoz0baoaqnma6cgsr0vct0vg.jpeg"></div><a name="habracut"></a><br>  Ini adalah proyek Arduino, program ini ditulis dalam Arduino IDE. Perpustakaan Adafruit Industries digunakan untuk mengoperasikan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sensor BME280</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sensor github</a> |  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github BME280</a> .  Untuk bekerja dengan papan nRF52832, Ardeino IDE menggunakan proyek Sandeep Mistry - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github</a> .  Transfer data ke pengontrol Smart House dilakukan sesuai dengan protokol Mysensors - github <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">board</a> |  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">protokol | perpustakaan</a> . <br><br>  Papan sensor dikembangkan dalam program Diptrace.  Dimensi papan adalah 36,8mm X 25mm. <br><br><img src="https://habrastorage.org/webt/py/m_/vw/pym_vwe6xnvqencxzywzqq0kjay.png"><br><br><div class="spoiler">  <b class="spoiler_title">Daftar komponen yang digunakan</b> <div class="spoiler_text"><ul><li>  C1 - cap0603 100nF </li><li>  C2 - cap0603 100nF </li><li>  R1 - res0603 332 </li><li>  R2 - res0603 85b </li><li>  R3 - res0603 113 </li><li>  R4 - res0603 912 </li><li>  R5 - res0603 113 </li><li>  R6 - res0603 512 </li><li>  R7 - res0603 512 </li><li>  RGBL1 - led0805 rgb </li><li>  SWD - PPHF 2x3 6p 1.27mm </li><li>  U1 - YJ-16048 nRF52832 </li><li>  U2 - BME280 </li><li>  CONNECT - saklar kebijaksanaan KLS7-TS5401 </li><li>  RESET - tombol jam KLS7-TS5401 </li><li>  Tempat Baterai KW-BS-2450-2-SMT </li><li>  Saklar Dsc0012 </li></ul><br></div></div><br>  Biaya dipesan melalui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">jlcpcb.com</a> - $ 2 untuk 5 buah warna apa pun. <br><br><img src="https://habrastorage.org/webt/lm/t6/bn/lmt6bn5pw_3jadqubz5bgrfawcq.jpeg"><br><br><img src="https://habrastorage.org/webt/pm/38/at/pm38attlfjfbrocsgd5coqa3p-e.jpeg"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tautan ke arsip dengan file gerber</a> <br><br>  Sensor bekerja sesuai dengan protokol Mysensors.  Menambahkan perangkat apa pun ke jaringan Mysensors mudah.  Mari kita lihat contoh sensor ini, saya akan menghilangkan penjelasan kode sensor BME280, tidak ada yang berubah ketika bekerja dengan jaringan Mysensors. <br><br><blockquote><pre><code class="plaintext hljs">#define MY_DEBUG //   #define MY_RADIO_NRF5_ESB //   (  rfm69, rfm95, nrf24l01, nrf51-52) #define MY_RF24_PA_LEVEL (NRF5_PA_MAX) //    #define MY_DISABLED_SERIAL //   #define MY_PASSIVE_NODE //   (   mysensors), PASSIVE        ,   , ,  #define MY_NODE_ID 1 //     #define MY_PARENT_NODE_ID 0 //       //#define MY_PARENT_NODE_IS_STATIC //  PARENT_NODE        //#define MY_TRANSPORT_UPLINK_CHECK_DISABLED //      #include &lt;MySensors.h&gt; // -  MySensors #define TEMP_CHILD_ID 0 //     #define HUM_CHILD_ID 1 //     #define BARO_CHILD_ID 2 //      #define CHILD_ID_VOLT 254 //      MyMessage voltMsg(CHILD_ID_VOLT, V_VOLTAGE); //       MyMessage temperatureMsg(TEMP_CHILD_ID, V_TEMP); //      MyMessage humidityMsg(HUM_CHILD_ID, V_HUM); //      MyMessage pressureMsg(BARO_CHILD_ID, V_PRESSURE); //     </code> </pre> </blockquote>  Penyajian sensor dan sensor di pengontrol rumah pintar: <br><br><blockquote><pre> <code class="plaintext hljs"> sendSketchInfo("BME280 Sensor", "1.0"); //  ,   present(CHILD_ID_VOLT, S_MULTIMETER, "Battery"); //    ,  ,  present(TEMP_CHILD_ID, S_TEMP, "TEMPERATURE [C or F]"); //   ,  ,  present(HUM_CHILD_ID, S_HUM, "HUMIDITY [%]"); //   ,  ,  present(BARO_CHILD_ID, S_BARO, "PRESSURE [hPa or mmHg]"); //    ,  , </code> </pre></blockquote><br>  Transfer data ke pengontrol rumah pintar: <br><blockquote><pre> <code class="plaintext hljs">send(voltMsg.set(batteryVoltage)); //       mW sendBatteryLevel(currentBatteryPercent); //       % send(temperatureMsg.set(temperature, 1)); //    ,  1    send(humidityMsg.set(humidity, 0)); //    ,  0    send(pressureMsg.set(pressure, 0)); //    ,  0   </code> </pre><br></blockquote><br><div class="spoiler">  <b class="spoiler_title">Kode program Arduino</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#include &lt;Wire.h&gt; #include &lt;SPI.h&gt; #include &lt;Adafruit_Sensor.h&gt; #include &lt;Adafruit_BME280.h&gt; //#define MY_DEBUG #define MY_RADIO_NRF5_ESB #define MY_RF24_PA_LEVEL (NRF5_PA_MAX) #define MY_DISABLED_SERIAL #define MY_PASSIVE_NODE #define MY_NODE_ID 1 #define MY_PARENT_NODE_ID 0 //#define MY_PARENT_NODE_IS_STATIC //#define MY_TRANSPORT_UPLINK_CHECK_DISABLED #include &lt;MySensors.h&gt; bool sleep_flag; bool metric = true; bool last_sent_value; uint16_t currentBatteryPercent; uint16_t lastBatteryPercent = 1000; uint16_t battery_vcc_min = 2150; uint16_t battery_vcc_max = 2950; uint16_t batteryVoltage; uint16_t battery_alert_level = 25; uint32_t default_sleep_time = 60000; uint32_t SLEEP_TIME; uint32_t newmillisforbatt; uint32_t battsendinterval = 3600000; float tempThreshold = 0.5; float humThreshold = 5; float presThreshold = 1; float pres_mmThreshold = 1; float temperature; float pressure; float pressure_mm; float humidity; float lastTemperature = -1; float lastHumidity = -1; float lastPressure = -1; float lastPressure_mm = -1; #define SEALEVELPRESSURE_HPA (1013.25) Adafruit_BME280 bme; #define TEMP_CHILD_ID 0 #define HUM_CHILD_ID 1 #define BARO_CHILD_ID 2 #define CHILD_ID_VOLT 254 MyMessage voltMsg(CHILD_ID_VOLT, V_VOLTAGE); MyMessage temperatureMsg(TEMP_CHILD_ID, V_TEMP); MyMessage humidityMsg(HUM_CHILD_ID, V_HUM); MyMessage pressureMsg(BARO_CHILD_ID, V_PRESSURE); void preHwInit() { pinMode(21, INPUT); pinMode(25, OUTPUT); digitalWrite(25, HIGH); pinMode(26, OUTPUT); digitalWrite(26, HIGH); pinMode(27, OUTPUT); digitalWrite(27, HIGH); } void before() { NRF_POWER-&gt;DCDCEN = 1; NRF_NFCT-&gt;TASKS_DISABLE = 1; NRF_NVMC-&gt;CONFIG = 1; NRF_UICR-&gt;NFCPINS = 0; NRF_NVMC-&gt;CONFIG = 0; if (NRF_SAADC-&gt;ENABLE) { NRF_SAADC-&gt;TASKS_STOP = 1; while (NRF_SAADC-&gt;EVENTS_STOPPED) {} NRF_SAADC-&gt;ENABLE = 0; while (NRF_SAADC-&gt;ENABLE) {} } pinMode(BLUE_LED, OUTPUT); pinMode(RED_LED, OUTPUT); digitalWrite(BLUE_LED, HIGH); digitalWrite(RED_LED, HIGH); digitalWrite(27, LOW); } void setup() { digitalWrite(27, HIGH); bme_initAsleep(); wait(100); sendBatteryStatus(); wait(100); } void presentation() { sendSketchInfo("EFEKTA BME280 Sensor", "1.2"); present(CHILD_ID_VOLT, S_MULTIMETER, "Battery"); present(TEMP_CHILD_ID, S_TEMP, "TEMPERATURE [C or F]"); present(HUM_CHILD_ID, S_HUM, "HUMIDITY [%]"); present(BARO_CHILD_ID, S_BARO, "PRESSURE [hPa or mmHg]"); } void loop() { wait(10); bme.takeForcedMeasurement(); wait(100); sendData(); if (millis() - newmillisforbatt &gt;= battsendinterval) { sleep_flag = 1; sendBatteryStatus(); } if (sleep_flag == 0) { sleep(SLEEP_TIME); sleep_flag = 1; } } void blinky(uint8_t pulses, uint8_t repit, uint8_t ledColor) { for (int x = 0; x &lt; repit; x++) { if (x &gt; 0) { sleep(500); } for (int i = 0; i &lt; pulses; i++) { if (i &gt; 0) { sleep(100); } digitalWrite(ledColor, LOW); wait(20); digitalWrite(ledColor, HIGH); } } } void sendBatteryStatus() { wait(20); batteryVoltage = hwCPUVoltage(); wait(2); if (batteryVoltage &gt; battery_vcc_max) { currentBatteryPercent = 100; } else if (batteryVoltage &lt; battery_vcc_min) { currentBatteryPercent = 0; } else { if (lastBatteryPercent == 1000) { currentBatteryPercent = (100 * (batteryVoltage - battery_vcc_min)) / (battery_vcc_max - battery_vcc_min) + 5; } else { currentBatteryPercent = (100 * (batteryVoltage - battery_vcc_min)) / (battery_vcc_max - battery_vcc_min) - 5; } } sendBatteryLevel(currentBatteryPercent); wait(100); if (lastBatteryPercent &lt; battery_alert_level) { blinky(3, 1, RED_LED); } else { blinky((last_sent_value == true ? 2 : 1), 1, BLUE_LED); } sleep_flag = 0; newmillisforbatt = millis(); } void sendData() { temperature = bme.readTemperature(); wait(20); humidity = bme.readHumidity(); wait(20); pressure = bme.readPressure() / 100.0F; if (!metric) { temperature = temperature * 9.0 / 5.0 + 32.0; } else { pressure = pressure * 0.75006375541921; } CORE_DEBUG(PSTR("MY_TEMPERATURE: %d\n"), (int)temperature); CORE_DEBUG(PSTR("MY_HUMIDITY: %d\n"), (int)humidity); CORE_DEBUG(PSTR("MY_PRESSURE: %d\n"), (int)pressure); if (abs(temperature - lastTemperature) &gt;= tempThreshold) { send(temperatureMsg.set(temperature, 1)); lastTemperature = temperature; sleep(1000); } if (abs(humidity - lastHumidity) &gt;= humThreshold) { send(humidityMsg.set(humidity, 0)); lastHumidity = humidity; sleep(1000); } if (abs(pressure - lastPressure) &gt;= presThreshold) { send(pressureMsg.set(pressure, 0)); lastPressure = pressure; sleep(1000); } sleep_flag = 0; } void bme_initAsleep() { if (! bme.begin(&amp;Wire)) { while (1); } bme.setSampling(Adafruit_BME280::MODE_FORCED, Adafruit_BME280::SAMPLING_X1, // temperature Adafruit_BME280::SAMPLING_X1, // pressure Adafruit_BME280::SAMPLING_X1, // humidity Adafruit_BME280::FILTER_OFF ); wait(1000); }</code> </pre><br></div></div><br>  Housing untuk sensor dikembangkan di editor 3D: <br><br><img src="https://habrastorage.org/webt/9f/dj/r4/9fdjr4mn4affjihaw2giugkx2uu.jpeg"><br><br>  Itu dicetak pada printer 3D ANYCUBIC FOTON, resin putih dari produsen yang sama digunakan, ketebalan lapisan dipilih sedang - 50 mikron.  Waktu pencetakan untuk kasing dan sampul adalah 3 jam. <br><br><div class="spoiler">  <b class="spoiler_title">Model kasus STL</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">drive.google.com/file/d/1sH7OFHDXGyClALwycZTnVrVWeZSRsDGL/view?usp=sharing</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">drive.google.com/file/d/1zNQZM34oHIe2Ph-Pr222O_wTTxD_gLIl/view?usp=sharing</a> <br></div></div><br><img src="https://habrastorage.org/webt/lp/df/64/lpdf648jqpmp28pybdnfrz4kcwy.jpeg"><br><br><img src="https://habrastorage.org/webt/li/v2/sa/liv2sasn4i5hfwmsl14ti55o2go.jpeg"><br><br><img src="https://habrastorage.org/webt/wa/pp/ij/wappijzhaisof7jyjywn1wevqdo.jpeg"><br><br>  Jaringan MySensors di mana sensor bekerja berkomunikasi dengan sistem rumah pintar Magordomo.  Sensor terdaftar dalam modul Maysensors Majordomo terlihat seperti ini: <br><img src="https://habrastorage.org/webt/qx/y1/wu/qxy1wul0sz3bvt7sot-ylgjrbds.jpeg"><br><br><img src="https://habrastorage.org/webt/sk/xy/uj/skxyuj-xjhrs_jfnmx_9_ym0ope.jpeg"><br><br><div class="spoiler">  <b class="spoiler_title">Uji video</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/HkxbiTkkVXA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br><br>  Bagi mereka yang ingin melakukan hal yang sama untuk diri mereka sendiri, artikel ini menyediakan tautan ke semua yang Anda butuhkan. <br><br>  Tempat di mana Anda selalu senang membantu semua orang yang ingin berkenalan dengan <b>MYSENSORS</b> (memasang papan, bekerja dengan mikrokontroler nRF5 di lingkungan IDE Arduino, kiat bekerja dengan protokol <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mysensors</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">@mysensors_rus</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id455856/">https://habr.com/ru/post/id455856/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id455846/index.html">Komputasi Terdistribusi di Julia</a></li>
<li><a href="../id455848/index.html">Teknik untuk menghindari perilaku tidak terdefinisi saat mengakses singleton</a></li>
<li><a href="../id455850/index.html">Kotak Alat untuk Peneliti - Edisi Ketiga: Mencari dan Bekerja dengan Sumber</a></li>
<li><a href="../id455852/index.html">Pengangkatan sinus dan implantasi simultan</a></li>
<li><a href="../id455854/index.html">Bagaimana menerapkan Menu Konteks di iOS 13</a></li>
<li><a href="../id455858/index.html">Jaringan TV kabel untuk yang terkecil. Bagian 9: Headend</a></li>
<li><a href="../id455860/index.html">Pengembangan BPM muda yang modis, modis, di Camunda</a></li>
<li><a href="../id455862/index.html">Apa yang Baru di AWS: DATA API, Analisis Data Kinesis, S3 Path</a></li>
<li><a href="../id455868/index.html">Mengatasi Hukum Moore: Teknologi Transistor Masa Depan</a></li>
<li><a href="../id455872/index.html">Taruhan apa yang dibuat Bezos pada tahun 1997 sehingga Amazon sekarang memegang 50% pasar e-commerce di AS dan 14% di dunia?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>