<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗒️ 🕵️ 👨‍💻 نحن نكتب مترجمًا بسيطًا في Lisp - II 🔞 📿 🎠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="المقال السابق 

 نقوم بتنفيذ عامل التعيين 
 الآن دعنا نعلم المترجم كيفية التعامل مع عامل التعيين. وهنا نواجه المهمة الكلاسيكية المتمثلة في ضمان حساب ا...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>نحن نكتب مترجمًا بسيطًا في Lisp - II</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421445/" style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">المقال السابق</a> <br><br><h3 style=";text-align:right;direction:rtl">  نقوم بتنفيذ عامل التعيين </h3><br>  الآن دعنا نعلم المترجم كيفية التعامل مع عامل التعيين.  وهنا نواجه المهمة الكلاسيكية المتمثلة في ضمان حساب الصيغة الجبرية الواردة في التدوين المألوف لنا منذ سنوات دراستنا.  إذا كان لنا أن نصنع مترجمًا ، فسنحتاج إلى حساب قيمة الصيغة.  في حالتنا ، سيتم حساب نواة Lisp (في وقت التشغيل).  ونحتاج فقط إلى تحويل الصيغة من التدوين المعتاد إلى Lisp. <br>  العلامة التي نعرفها تسمى "تدوين infix" (علامة العملية تقع بين المعاملات).  في Lisp ، يتم وضع علامة العملية قبل المعاملات (يسمى هذا التدوين "ترميز البادئة").  وبالتالي ، فإن مهمتنا هي تحويل نموذج infix إلى البادئة. <br><br>  يمكنك حل هذه المشكلة بطرق مختلفة ... <br><a name="habracut"></a><br>  أقترح تحويل الصيغة إلى ما يسمى  "النموذج البولندي العكسي" (SCF).  إن التدوين البولندي العكسي (الذي سمي على اسم عالم الرياضيات البولندي لوكاشفيتش) هو شكل من أشكال التدوين غير المحظورة حيث توجد علامات العمليات بعد المعاملات ("تدوين ما بعد الإصلاح").  الترجمة من postfix إلى شكل البادئة بسيطة للغاية.  يمكن للمرء "حل المشكلة في إجراء واحد" - تنفيذ التحويل من البادئة إلى البادئة على الفور.  لكن هذا القرار سيكون أكثر تعقيدًا إلى حد ما.  ومع ذلك ، يمكن لأولئك الذين يرغبون في القيام بذلك بأنفسهم. <br><br>  وسوف نشارك في تحويل الصيغة في SCR.  عند الإدخال ، لدينا صيغة جبرية في تدوين infix ، يتم تقديمها في شكل قائمة Lisp متعددة المستويات.  على سبيل المثال ، هذا: <br><br> <code>(12 + x / ( y ^ 2 + z ^ 4))</code> <br> <br>  في SCR ، سيكون لهذا التعبير الشكل التالي (للوهلة الأولى - غريب): <br><br> <code>(12 xy 2 ^ z 4 ^ + / +)</code> <br> <br>  لحساب قيمة الصيغة في شكل SCR ، تحتاج إلى مكدس (بنية بيانات تقوم بتخزين البيانات وتسليمها على أساس مبدأ "من يأتي أولاً - الذهاب أولاً").  الحساب بسيط للغاية.  تتم قراءة القائمة مرة واحدة.  ولكل عنصر ، يتم تنفيذ الإجراءات التالية: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  يتم دفع عدد (القيم المتغيرة) ببساطة إلى المكدس ؛ </li><li style=";text-align:right;direction:rtl">  يتم تنفيذ العملية على العدد المقابل من المعاملات من أعلى المكدس. </li></ul><br>  يرجى ملاحظة أنه لا توجد أقواس في SCF ، ويتم تنفيذ العمليات حسب ترتيب كتابتها (الأولويات ، كما في نموذج infix ، لم تعد هنا). <br><br>  قد يحتوي التعبير الذي نريد ترجمته إلى SCR على أرقام ومتغيرات ووظائف وإشارات عملية.  هناك مشكلة - كيف تميز متغير عن دالة؟  الطريقة الطبيعية لحل هذه المشكلة هي عمل قائمة بجميع العمليات والوظائف والتحقق من الحرف المطلوب في هذه القائمة: إذا تم العثور على الحرف في القائمة ، فهذه عملية ، وإلا فهي متغيرة. <br>  بالإضافة إلى ذلك ، لكل وظيفة / عملية ، تحتاج إلى تخزين <b>قيمتها</b> (عدد الوسيطات).  قد تبدو قائمة العمليات الأساسية كما يلي: <br><br><pre style=";text-align:right;direction:rtl"> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">setq</span></span> *oplist* '((+ <span class="hljs-number"><span class="hljs-number">2</span></span>) (- <span class="hljs-number"><span class="hljs-number">2</span></span>) (* <span class="hljs-number"><span class="hljs-number">2</span></span>) (/ <span class="hljs-number"><span class="hljs-number">2</span></span>) (^ <span class="hljs-number"><span class="hljs-number">2</span></span>) (\ <span class="hljs-number"><span class="hljs-number">2</span></span>) (% <span class="hljs-number"><span class="hljs-number">2</span></span>) (= <span class="hljs-number"><span class="hljs-number">2</span></span>) (== <span class="hljs-number"><span class="hljs-number">2</span></span>) (/= <span class="hljs-number"><span class="hljs-number">2</span></span>) (&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>) (&gt;= <span class="hljs-number"><span class="hljs-number">2</span></span>) (&lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) (&lt;= <span class="hljs-number"><span class="hljs-number">2</span></span>) (and <span class="hljs-number"><span class="hljs-number">2</span></span>) (or <span class="hljs-number"><span class="hljs-number">2</span></span>) (not <span class="hljs-number"><span class="hljs-number">1</span></span>) (sin <span class="hljs-number"><span class="hljs-number">1</span></span>) (cos <span class="hljs-number"><span class="hljs-number">1</span></span>) (abs <span class="hljs-number"><span class="hljs-number">1</span></span>) (exp <span class="hljs-number"><span class="hljs-number">1</span></span>) (log <span class="hljs-number"><span class="hljs-number">1</span></span>) (sqrt <span class="hljs-number"><span class="hljs-number">1</span></span>)))</code> </pre><br>  وتجدر الإشارة إلى أنه في عملية المترجم قد تزيد هذه القائمة.  والحقيقة هي أن الوظائف الأساسية البسيطة تُرجع القيم ويمكنها المشاركة في التعبيرات.  يجب إضافة أسماء هذه الوظائف وقيمتها إلى قائمة * oplist *.  يمكن القيام بذلك في إجراء الإجراء proc في الفرع الذي يعالج بيان proc.  يمكن إنشاء متغير * oplist * في إجراء البدء (ويتم إتلافه قبل الاكتمال).  ويمكن تنفيذ إضافة دالة في رمز الإجراء على النحو التالي: <br><br><pre style=";text-align:right;direction:rtl"> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">cond</span></span> ((<span class="hljs-name"><span class="hljs-name">eq</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> stmt) 'proc) (<span class="hljs-name"><span class="hljs-name">setq</span></span> proc-name (<span class="hljs-name"><span class="hljs-name">nth</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> stmt)) (<span class="hljs-name"><span class="hljs-name">setq</span></span> proc-parm (<span class="hljs-name"><span class="hljs-name">nth</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> stmt)) (<span class="hljs-name"><span class="hljs-name">setq</span></span> *oplist* (<span class="hljs-name"><span class="hljs-name">cons</span></span> (<span class="hljs-name"><span class="hljs-name">list</span></span> proc-name (<span class="hljs-name"><span class="hljs-name">length</span></span> proc-parm)) *oplist*)))</code> </pre><br>  الآن من الضروري لكل عملية تحدث في الوظيفة تحديد أولوية معينة.  يتم تحديد الأولويات من خلال الوظيفة التالية: <br><br><pre style=";text-align:right;direction:rtl"> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defun</span></span> prty (<span class="hljs-name"><span class="hljs-name">OP</span></span>) (<span class="hljs-name"><span class="hljs-name">cond</span></span> ((<span class="hljs-name"><span class="hljs-name">EQ</span></span> OP 'and) <span class="hljs-number"><span class="hljs-number">1</span></span>) ((<span class="hljs-name"><span class="hljs-name">EQ</span></span> OP 'or) <span class="hljs-number"><span class="hljs-number">1</span></span>) ((<span class="hljs-name"><span class="hljs-name">EQ</span></span> OP '&gt;) <span class="hljs-number"><span class="hljs-number">2</span></span>) ((<span class="hljs-name"><span class="hljs-name">EQ</span></span> OP '&gt;=) <span class="hljs-number"><span class="hljs-number">2</span></span>) ((<span class="hljs-name"><span class="hljs-name">EQ</span></span> OP '&lt;) <span class="hljs-number"><span class="hljs-number">2</span></span>) ((<span class="hljs-name"><span class="hljs-name">EQ</span></span> OP '&lt;=) <span class="hljs-number"><span class="hljs-number">2</span></span>) ((<span class="hljs-name"><span class="hljs-name">EQ</span></span> OP '=) <span class="hljs-number"><span class="hljs-number">2</span></span>) ((<span class="hljs-name"><span class="hljs-name">EQ</span></span> OP '==) <span class="hljs-number"><span class="hljs-number">2</span></span>) ((<span class="hljs-name"><span class="hljs-name">EQ</span></span> OP '/=) <span class="hljs-number"><span class="hljs-number">2</span></span>) ((<span class="hljs-name"><span class="hljs-name">EQ</span></span> OP '+) <span class="hljs-number"><span class="hljs-number">3</span></span>) ((<span class="hljs-name"><span class="hljs-name">EQ</span></span> OP '-) <span class="hljs-number"><span class="hljs-number">3</span></span>) ((<span class="hljs-name"><span class="hljs-name">EQ</span></span> OP '*) <span class="hljs-number"><span class="hljs-number">4</span></span>) ((<span class="hljs-name"><span class="hljs-name">EQ</span></span> OP '/) <span class="hljs-number"><span class="hljs-number">4</span></span>) ((<span class="hljs-name"><span class="hljs-name">EQ</span></span> OP '\) <span class="hljs-number"><span class="hljs-number">4</span></span>) ((<span class="hljs-name"><span class="hljs-name">EQ</span></span> OP '%) <span class="hljs-number"><span class="hljs-number">4</span></span>) ((<span class="hljs-name"><span class="hljs-name">EQ</span></span> OP '^) <span class="hljs-number"><span class="hljs-number">5</span></span>) ((<span class="hljs-name"><span class="hljs-name">member</span></span> op (<span class="hljs-name"><span class="hljs-name">mapcar</span></span> 'car *oplist*)) <span class="hljs-number"><span class="hljs-number">6</span></span>)))</code> </pre><br>  تعطى الأولوية الدنيا للعمليات المنطقية "و" و "أو".  ثم هناك عمليات المقارنة ، ثم الجمع والطرح ، إلخ.  الوظائف لها الأولوية القصوى. <br><br>  الآن نحن نصف الخوارزمية لترجمة التعبير في SCR.  تقبل الدالة inf2ipn معلمة واحدة مطلوبة (صيغة الإدخال) واثنتين اختياريتين (قائمة التشغيل وقائمة المجمع).  في قائمة البطاريات ، يتم تجميع النتيجة.  تفحص الوظيفة قائمة الإدخال وتعمل على النحو التالي: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  إذا كان العنصر التالي هو رقم أو متغير ، يتم إدخاله في البطارية. </li><li style=";text-align:right;direction:rtl">  إذا كان العنصر التالي عبارة عن قائمة ، يتم تطبيق الوظيفة على هذه القائمة بشكل متكرر ، وتتم إضافة نتيجتها إلى البطارية. </li><li style=";text-align:right;direction:rtl">  إذا كان العنصر التالي عبارة عن عملية ، فعندها مع رزمة فارغة من العمليات ، يتم دفع العنصر التالي إلى رصة العمليات.  مع رصة عملية غير فارغة ، تتم مقارنة أولوية العملية الواردة بأعلى رصة العملية.  في حالة وصول عملية ذات أولوية أعلى ، يتم دفعها إلى مكدس العمليات. </li><li style=";text-align:right;direction:rtl">  إذا وصلت عملية ذات أولوية أعلى من الجزء العلوي من المكدس ، فسيتم نقل الجزء العلوي من مجموعة العمليات إلى المجمع ، ويتم إدخال العملية التي تم الوصول إليها حديثًا في تكديس العمليات. </li><li style=";text-align:right;direction:rtl">  إذا تم استنفاد قائمة الإدخال وكانت حزمة العملية فارغة ، فستقوم الوظيفة بإرجاع بطارية معكوسة (فرع طرفي).  وبخلاف ذلك ، تقوم الوظيفة بإرجاع بطارية معكوسة مع قائمة العمليات المرفقة مسبقًا من المكدس. </li></ul><br>  الوظيفة التي تميز العملية عن المعامل بسيطة للغاية - يتعلق الأمر بالتحقق مما إذا كان الحرف المحدد في قائمة * oplist * الشاملة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defun</span></span> is-op (<span class="hljs-name"><span class="hljs-name">o</span></span>) (<span class="hljs-name"><span class="hljs-name">member</span></span> o (<span class="hljs-name"><span class="hljs-name">mapcar</span></span> 'car *oplist*)))</code> </pre><br>  ووظيفة النقل في SCR لها الشكل: <br><br><pre style=";text-align:right;direction:rtl"> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defun</span></span> inf2ipn (<span class="hljs-name"><span class="hljs-name">f</span></span> <span class="hljs-symbol"><span class="hljs-symbol">&amp;optional</span></span> (<span class="hljs-name"><span class="hljs-name">s</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) (<span class="hljs-name"><span class="hljs-name">r</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) (<span class="hljs-name"><span class="hljs-name">cond</span></span> ((<span class="hljs-name"><span class="hljs-name">null</span></span> f) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">null</span></span> s) (<span class="hljs-name"><span class="hljs-name">reverse</span></span> r) (<span class="hljs-name"><span class="hljs-name">inf2ipn</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> (<span class="hljs-name"><span class="hljs-name">cdr</span></span> s) (<span class="hljs-name"><span class="hljs-name">cons</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> s) r)))) ((<span class="hljs-name"><span class="hljs-name">listp</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> f)) (<span class="hljs-name"><span class="hljs-name">inf2ipn</span></span> (<span class="hljs-name"><span class="hljs-name">cdr</span></span> f) s (<span class="hljs-name"><span class="hljs-name">append</span></span> (<span class="hljs-name"><span class="hljs-name">reverse</span></span> (<span class="hljs-name"><span class="hljs-name">inf2ipn</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> f))) r))) ((<span class="hljs-name"><span class="hljs-name">numberp</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> f)) (<span class="hljs-name"><span class="hljs-name">inf2ipn</span></span> (<span class="hljs-name"><span class="hljs-name">cdr</span></span> f) s (<span class="hljs-name"><span class="hljs-name">cons</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> f) r))) ((<span class="hljs-name"><span class="hljs-name">not</span></span> (<span class="hljs-name"><span class="hljs-name">is-op</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> f))) (<span class="hljs-name"><span class="hljs-name">inf2ipn</span></span> (<span class="hljs-name"><span class="hljs-name">cdr</span></span> f) s (<span class="hljs-name"><span class="hljs-name">cons</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> f) r))) (<span class="hljs-name"><span class="hljs-name">t</span></span> (<span class="hljs-name"><span class="hljs-name">cond</span></span> ((<span class="hljs-name"><span class="hljs-name">null</span></span> s) (<span class="hljs-name"><span class="hljs-name">inf2ipn</span></span> (<span class="hljs-name"><span class="hljs-name">cdr</span></span> f) (<span class="hljs-name"><span class="hljs-name">cons</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> f) s) r)) ((<span class="hljs-name"><span class="hljs-name">&gt;</span></span> (<span class="hljs-name"><span class="hljs-name">prty</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> f)) (<span class="hljs-name"><span class="hljs-name">prty</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> s))) (<span class="hljs-name"><span class="hljs-name">inf2ipn</span></span> (<span class="hljs-name"><span class="hljs-name">cdr</span></span> f) (<span class="hljs-name"><span class="hljs-name">cons</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> f) s) r)) (<span class="hljs-name"><span class="hljs-name">t</span></span> (<span class="hljs-name"><span class="hljs-name">let</span></span> ((<span class="hljs-name"><span class="hljs-name">a</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> s))) (<span class="hljs-name"><span class="hljs-name">inf2ipn</span></span> (<span class="hljs-name"><span class="hljs-name">cdr</span></span> f) (<span class="hljs-name"><span class="hljs-name">cons</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> f) (<span class="hljs-name"><span class="hljs-name">cdr</span></span> s)) (<span class="hljs-name"><span class="hljs-name">cons</span></span> ar))))))))</code> </pre><br>  يمكنك التحقق من وظيفة هذه الوظيفة عن طريق الاتصال بها مباشرة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">inf2ipn</span></span> '(<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">3</span></span> * 6)) ==&gt; (2 3 6 * +) (<span class="hljs-name"><span class="hljs-name">inf2ipn</span></span> '((<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">3</span></span>) * 6)) ==&gt; (2 3 + 6 *) (<span class="hljs-name"><span class="hljs-name">inf2ipn</span></span> '(<span class="hljs-number"><span class="hljs-number">3</span></span> + a * sin ( 5 + x))) ==&gt; (3 A 5 X + SIN * +)</code> </pre><br>  الحصول على إدخال بادئة من SCR أمر بسيط للغاية.  تقبل الدالة ipn2inf التعبير في SCR ومعلمة محرك الأقراص.  تعمل الوظيفة على النحو التالي: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  إذا كانت قائمة الإدخال فارغة ، فسيتم إرجاع رأس المحرك ؛ </li><li style=";text-align:right;direction:rtl">  إذا كان العنصر التالي رقمًا أو متغيرًا ، فإن هذه الذرة مرتبطة بمحرك الأقراص ؛ </li><li style=";text-align:right;direction:rtl">  إذا كان العنصر التالي عبارة عن عملية لـ arity n ، يتم إلحاق قائمة تتكون من رمز هذه العملية ومقطع معكوس لمحرك الطول n بمحرك الأقراص بدون عناصر n الأولى. </li></ul><br>  إليك ما يبدو في الكود: <br><br><pre style=";text-align:right;direction:rtl"> <code class="lisp hljs"><span class="hljs-comment"><span class="hljs-comment">;;    (defun arity (o) (iter (for a in *oplist*) (when (eq o (car a)) (return (cadr a))))) ;;      (defun ipn2pref (f &amp;optional (s nil)) (cond ((null f) (car s)) ((numberp (car f)) (ipn2pref (cdr f) (cons (car f) s))) ((is-op (car f)) (let ((ar (arity (car f)))) (ipn2pref (cdr f) (cons (cons (car f) (reverse (subseq s 0 ar))) (subseq s ar))))) (t (ipn2pref (cdr f) (cons (car f) s))))) ;; -,      (defun i2p (f) (ipn2pref (inf2ipn f)))</span></span></code> </pre><br>  تحقق من صحة الرمز: <br><br><pre style=";text-align:right;direction:rtl"> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">i2p</span></span> '(<span class="hljs-number"><span class="hljs-number">3</span></span> + a * sin ( 5 + x))) ==&gt; (+ 3 (* A (SIN (+ <span class="hljs-number"><span class="hljs-number">5</span></span> X)))) (<span class="hljs-name"><span class="hljs-name">i2p</span></span> '((<span class="hljs-number"><span class="hljs-number">3</span></span> + a) * sin ( 5 ) + x)) ==&gt; (* (+ <span class="hljs-number"><span class="hljs-number">3</span></span> A) (+ (SIN <span class="hljs-number"><span class="hljs-number">5</span></span>) X)) (<span class="hljs-name"><span class="hljs-name">i2p</span></span> '((<span class="hljs-number"><span class="hljs-number">3</span></span> + a) * sin ( 5 ^ 2 - x ) + x)) ==&gt; (* (+ <span class="hljs-number"><span class="hljs-number">3</span></span> A) (+ (SIN (- (^ <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) X)) X))</code> </pre><br>  الآن يبقى فقط لكتابة معالج عامل التعيين وتوصيله بمعالج الإجراءات.  يمكن تنفيذ معالج المهمة كما يلي: <br><br><pre style=";text-align:right;direction:rtl"> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defun</span></span> action-set (<span class="hljs-name"><span class="hljs-name">meat</span></span>) (<span class="hljs-name"><span class="hljs-name">let</span></span> ((<span class="hljs-name"><span class="hljs-name">name-var</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> meat)) (<span class="hljs-name"><span class="hljs-name">r-value</span></span> (<span class="hljs-name"><span class="hljs-name">i2p</span></span> (<span class="hljs-name"><span class="hljs-name">cddr</span></span> meat)))) `(setq ,name-var ,r-value)))</code> </pre><br>  من المفترض أن تشير معلمة اللحوم إلى تعيين القائمة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="lisp hljs">( = )</code> </pre> <br>  يتم التعرف على عامل التخصيص في وظيفة الإجراء proc ، التي تأخذ الشكل: <br><br><pre style=";text-align:right;direction:rtl"> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defun</span></span> action-proc (<span class="hljs-name"><span class="hljs-name">fi</span></span>) (<span class="hljs-name"><span class="hljs-name">let</span></span> ((<span class="hljs-name"><span class="hljs-name">stmt</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) (<span class="hljs-name"><span class="hljs-name">proc-name</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) (<span class="hljs-name"><span class="hljs-name">proc-parm</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) (<span class="hljs-name"><span class="hljs-name">loc-var</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) (<span class="hljs-name"><span class="hljs-name">lv</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) (<span class="hljs-name"><span class="hljs-name">body</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) (<span class="hljs-name"><span class="hljs-name">loop</span></span> (<span class="hljs-name"><span class="hljs-name">setq</span></span> stmt (<span class="hljs-name"><span class="hljs-name">mk-intf</span></span> (<span class="hljs-name"><span class="hljs-name">getLine</span></span> fi))) (<span class="hljs-name"><span class="hljs-name">when</span></span> (<span class="hljs-name"><span class="hljs-name">null</span></span> stmt) (<span class="hljs-name"><span class="hljs-name">return</span></span> <span class="hljs-literal"><span class="hljs-literal">t</span></span>)) (<span class="hljs-name"><span class="hljs-name">cond</span></span> ((<span class="hljs-name"><span class="hljs-name">eq</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> stmt) 'proc) (<span class="hljs-name"><span class="hljs-name">setq</span></span> proc-name (<span class="hljs-name"><span class="hljs-name">nth</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> stmt)) (<span class="hljs-name"><span class="hljs-name">setq</span></span> proc-parm (<span class="hljs-name"><span class="hljs-name">nth</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> stmt))) ((<span class="hljs-name"><span class="hljs-name">eq</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> stmt) 'end_proc) (<span class="hljs-name"><span class="hljs-name">return</span></span> <span class="hljs-literal"><span class="hljs-literal">t</span></span>)) ((<span class="hljs-name"><span class="hljs-name">eq</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> stmt) 'print) (<span class="hljs-name"><span class="hljs-name">setq</span></span> body (<span class="hljs-name"><span class="hljs-name">append</span></span> body (<span class="hljs-name"><span class="hljs-name">list</span></span> (<span class="hljs-name"><span class="hljs-name">cons</span></span> 'printline (<span class="hljs-name"><span class="hljs-name">cdr</span></span> stmt)))))) ((<span class="hljs-name"><span class="hljs-name">eq</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> stmt) 'input) (<span class="hljs-name"><span class="hljs-name">setq</span></span> body (<span class="hljs-name"><span class="hljs-name">append</span></span> body (<span class="hljs-name"><span class="hljs-name">list</span></span> (<span class="hljs-name"><span class="hljs-name">list</span></span> 'setq (<span class="hljs-name"><span class="hljs-name">cadr</span></span> stmt) (<span class="hljs-name"><span class="hljs-name">list</span></span> 'read) ))))) ((<span class="hljs-name"><span class="hljs-name">eq</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> stmt) 'local) (<span class="hljs-name"><span class="hljs-name">setq</span></span> loc-var (<span class="hljs-name"><span class="hljs-name">append</span></span> loc-var (<span class="hljs-name"><span class="hljs-name">cdr</span></span> stmt)))) ((<span class="hljs-name"><span class="hljs-name">eq</span></span> (<span class="hljs-name"><span class="hljs-name">cadr</span></span> stmt) '=) (<span class="hljs-name"><span class="hljs-name">setq</span></span> body (<span class="hljs-name"><span class="hljs-name">append</span></span> body (<span class="hljs-name"><span class="hljs-name">list</span></span> (<span class="hljs-name"><span class="hljs-name">action-set</span></span> stmt))))) (<span class="hljs-name"><span class="hljs-name">t</span></span> (<span class="hljs-name"><span class="hljs-name">printsline</span></span> (<span class="hljs-name"><span class="hljs-name">strCat</span></span> <span class="hljs-string"><span class="hljs-string">"****  "</span></span> (<span class="hljs-name"><span class="hljs-name">output</span></span> stmt) <span class="hljs-string"><span class="hljs-string">"  "</span></span>)) (<span class="hljs-name"><span class="hljs-name">setq</span></span> *flagerr* <span class="hljs-literal"><span class="hljs-literal">t</span></span>)))) (<span class="hljs-name"><span class="hljs-name">iter</span></span> (<span class="hljs-name"><span class="hljs-name">for</span></span> a in (<span class="hljs-name"><span class="hljs-name">setof</span></span> loc-var)) (<span class="hljs-name"><span class="hljs-name">collecting</span></span> (<span class="hljs-name"><span class="hljs-name">list</span></span> a <span class="hljs-number"><span class="hljs-number">0</span></span>) into lv)) `(defun ,proc-name ,proc-parm (let ,lv ,@body))))</code> </pre><br>  دعونا نتحقق من أداء الكود الخاص بنا.  نقوم بتحميل الكود في بيئة Lisp ، واستدعاء وظيفة البدء وترجمة الإجراء التالي: <br><br> <code>0001 proc main() <br> 0002 local x,y,z <br> 0003 x=3 <br> 0004 y=4 <br> 0005 z=x^2+y^2 <br> 0006 print z <br> 0007 end_proc <br></code> <br><br>  دعونا نرى ما أنتج مترجمنا: <br><br><pre style=";text-align:right;direction:rtl"> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">getd</span></span> 'main) ==&gt; (<span class="hljs-name"><span class="hljs-name">EXPR</span></span> NIL (<span class="hljs-name"><span class="hljs-name">LET</span></span> ((<span class="hljs-name"><span class="hljs-name">X</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-name"><span class="hljs-name">Y</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-name"><span class="hljs-name">Z</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)) (<span class="hljs-name"><span class="hljs-name">SETQ</span></span> X <span class="hljs-number"><span class="hljs-number">3</span></span>) (<span class="hljs-name"><span class="hljs-name">SETQ</span></span> Y <span class="hljs-number"><span class="hljs-number">4</span></span>) (<span class="hljs-name"><span class="hljs-name">SETQ</span></span> Z (<span class="hljs-name"><span class="hljs-name">+</span></span> (^ X <span class="hljs-number"><span class="hljs-number">2</span></span>) (^ Y <span class="hljs-number"><span class="hljs-number">2</span></span>))) (<span class="hljs-name"><span class="hljs-name">PRINTLINE</span></span> Z)))</code> </pre><br>  يبدو أن كل شيء على ما يرام.  الآن ، دعنا نسمي إجراءنا والحصول على النتيجة المتوقعة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">main</span></span>) <span class="hljs-number"><span class="hljs-number">25</span></span> ==&gt; <span class="hljs-number"><span class="hljs-number">25</span></span></code> </pre><br>  سيتعامل مترجمنا أيضًا مع الوظائف المضمنة بشكل صحيح.  للتحقق من ذلك ، سننفذ ، على سبيل المثال ، الكود التالي: <br><br> <code>0001 proc main() <br> 0002 local x,y,z,pi <br> 0003 pi=3.1415926535 <br> 0004 x=sin(pi/6) <br> 0005 y=cos(pi/6) <br> 0006 z=x^2+y^2 <br> 0007 print x <br> 0018 print y <br> 0019 print z <br> 0010 end_proc <br></code> <br><br>  ونحصل على: <br><br><pre style=";text-align:right;direction:rtl"> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">main</span></span>) <span class="hljs-number"><span class="hljs-number">0.499999999987039</span></span> <span class="hljs-number"><span class="hljs-number">0.866025403791922</span></span> <span class="hljs-number"><span class="hljs-number">1.0</span></span> ==&gt; <span class="hljs-number"><span class="hljs-number">1.0</span></span></code> </pre><br>  مترجمنا ينبض بالحياة أمام أعيننا! <br><br>  ومع ذلك ، فقد ابتعدنا كثيرًا: سعينا لتحقيق الهدف النهائي ، لم نفكر على الإطلاق في الأخطاء التي يمكن أن يرتكبها المستخدم (المبرمج الذي يستخدم المصغر - الأساسي).  بطريقة جيدة ، كان علينا أن نفكر في الأخطاء على الفور ، ولكننا بدأنا للتو العمل ، ولم نذهب بعيدًا جدًا ، ولم يفت الأوان لتقديم معالجة الأخطاء والتشخيصات في الشفرة.  بالإضافة إلى ذلك ، من الواضح أن "التحسينات الطفيفة" تقترح (على سبيل المثال ، يطلب المترجم من المشغل أن يشغل سطرًا واحدًا بالضبط ، وهو أمر غير ملائم). <br><br>  سيتم تخصيص المقالة التالية لكل هذه الأسئلة. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><b>يتبع</b></a> <br><br>  يمكن تنزيل رمز هذه المقالة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">هنا.</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar421445/">https://habr.com/ru/post/ar421445/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar421433/index.html">بقي يوم واحد بالضبط قبل بدء تشغيل الخادم.</a></li>
<li><a href="../ar421435/index.html">"لماذا نفعل كل هذا؟" - منشئ بريزما وقائد مشروع VK السابق حول مشروعه السري الجديد</a></li>
<li><a href="../ar421439/index.html">قدم اليابانيون معالجًا أوليًا للكمبيوتر العملاق exaflops: كيف تعمل الرقاقة</a></li>
<li><a href="../ar421441/index.html">يبدأ Embox في تسلق جبل Elbrus</a></li>
<li><a href="../ar421443/index.html">الجديد في سوقنا: نظرة عامة على هواتف Snom D385 و D785 IP</a></li>
<li><a href="../ar421447/index.html">Redmadrobot iOS Meetup</a></li>
<li><a href="../ar421451/index.html">كيف تحمي طفلك من القمامة على اليوتيوب وتصنع مشغل مخصص بقائمة بيضاء من القنوات</a></li>
<li><a href="../ar421453/index.html">الحالة: أعلن سونوس علناً وقد "يخرج من الغرفة"</a></li>
<li><a href="../ar421455/index.html">أطلقت اليابان أول تجربة سريرية في العالم للخلايا الجذعية باستخدام مرض باركنسون</a></li>
<li><a href="../ar421461/index.html">متتبع الوقت للنصوص ومحرّر المستندات وجداول البيانات من Google</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>