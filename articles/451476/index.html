<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üß° üë©üèæ‚Äçü§ù‚Äçüë©üèº üîü LLVM en t√©rminos de Go üßúüèΩ üéÖüèΩ üï∫üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El desarrollo del compilador es una tarea muy dif√≠cil. Pero, afortunadamente, con el desarrollo de proyectos como LLVM, la soluci√≥n a este problema se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>LLVM en t√©rminos de Go</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/451476/">  El desarrollo del compilador es una tarea muy dif√≠cil.  Pero, afortunadamente, con el desarrollo de proyectos como LLVM, la soluci√≥n a este problema se simplifica enormemente, lo que permite que incluso un solo programador cree un nuevo lenguaje cercano al rendimiento C. El trabajo con LLVM se complica por el hecho de que este sistema est√° representado por una gran cantidad de c√≥digo, equipado con una peque√±a documentaci√≥n.  Para intentar corregir esta falla, el autor del material que publicamos hoy demostrar√° ejemplos de c√≥digo escrito en Go y mostrar√° c√≥mo se traducen primero a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Go SSA</a> y luego a LLVM IR usando el compilador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">TinyGO</a> .  El c√≥digo IR SSA y LLVM de Go ha sido ligeramente editado; algo que no es relevante para las explicaciones dadas aqu√≠ se ha eliminado para que estas explicaciones sean m√°s comprensibles. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f4a/50e/d6d/f4a50ed6d13e445eaf3d9c55293e7999.jpg" alt="imagen"></div><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Primer ejemplo</font> </h2><br>  La primera funci√≥n que analizar√© aqu√≠ es un mecanismo simple para agregar n√∫meros: <br><br><pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myAdd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, b </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b }</code> </pre> <br>  Esta funci√≥n es muy simple y, tal vez, nada es m√°s f√°cil de inventar.  Se traduce al siguiente c√≥digo Go SSA: <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myAdd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, b </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">entry</span></span></span><span class="hljs-function">:   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t0</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">                                                    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t0</span></span></span></span></code> </pre> <br>  Con esta representaci√≥n de la funci√≥n, las sugerencias sobre los tipos de datos se colocan a la derecha, en la mayor√≠a de los casos puede ignorarlas. <br><br>  Este peque√±o ejemplo ya le permite ver la esencia de un aspecto de SSA.  Es decir, al convertir el c√≥digo a la forma SSA, cada expresi√≥n se divide en las partes m√°s elementales en las que consiste.  En nuestro caso, el comando <code>return a + b</code> , de hecho, representa dos operaciones: sumar dos n√∫meros y devolver el resultado. <br><br>  Adem√°s, aqu√≠ puede ver los bloques b√°sicos del programa, en este c√≥digo solo hay un bloque: la entrada (bloque de entrada).  Hablaremos m√°s sobre los bloques a continuaci√≥n. <br><br>  El c√≥digo Go SSA se puede convertir f√°cilmente a LLVM IR: <br><br><pre> <code class="go hljs">define i64 @myAdd(i64 %a, i64 %b) { entry: %<span class="hljs-number"><span class="hljs-number">0</span></span> = add i64 %a, %b ret i64 %<span class="hljs-number"><span class="hljs-number">0</span></span> }</code> </pre> <br>  Puede notar que aunque aqu√≠ se usan otras construcciones sint√°cticas, la estructura de la funci√≥n b√°sicamente no ha cambiado.  El c√≥digo IR LLVM es ligeramente m√°s fuerte que el c√≥digo Go SSA, similar a C. Aqu√≠, en la declaraci√≥n de la funci√≥n, primero viene una descripci√≥n del tipo de datos devuelto, el tipo del argumento se indica antes del nombre del argumento.  Adem√°s, para simplificar el an√°lisis IR, los nombres de las entidades globales est√°n precedidos por el s√≠mbolo <code>@</code> , y antes de los nombres de las entidades locales por el car√°cter <code>%</code> (la funci√≥n tambi√©n se considera una entidad global). <br><br>  Una de las caracter√≠sticas de este c√≥digo a las que debe prestar atenci√≥n es que la decisi√≥n de representar el tipo Go <code>int</code> , que puede representarse mediante un valor de 32 bits o 64 bits, seg√∫n el compilador y el prop√≥sito de la compilaci√≥n, se toma al crear LLVM C√≥digo IR  Esta es una de las muchas razones por las que el c√≥digo IR LLVM no es independiente de la plataforma.  Dicho c√≥digo creado para una plataforma no puede simplemente tomarse y compilarse para otra plataforma (a menos que aborde esta tarea <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">con extrema precauci√≥n</a> ). <br><br>  Otro punto interesante que vale la pena se√±alar es que el tipo <code>i64</code> no es un entero con signo: es neutral en t√©rminos de representar el signo del n√∫mero.  Dependiendo de la instrucci√≥n, puede representar tanto n√∫meros con signo como n√∫meros sin signo.  En el caso de representar la operaci√≥n de suma, esto no juega un papel, por lo que no hay diferencia en trabajar con n√∫meros con o sin signo.  Aqu√≠, me gustar√≠a se√±alar que en C, el desbordamiento de una variable entera con signo lleva a un comportamiento indefinido, por lo tanto, la interfaz de Clang agrega el indicador <code>nsw</code> (sin envoltura firmada) a la operaci√≥n, lo que indica a LLVM que puede proceder de la suposici√≥n de que con Adem√°s nunca se produce desbordamiento. <br><br>  Esto puede ser importante para algunas optimizaciones.  Por ejemplo, la adici√≥n de dos valores de <code>i16</code> en una plataforma de 32 bits (con registros de 32 bits) requiere, una vez completada la adici√≥n, que la operaci√≥n de extensi√≥n de signo permanezca en el rango de <code>i16</code> .  Debido a esto, a menudo es m√°s eficiente realizar operaciones enteras teniendo en cuenta el tama√±o de la m√°quina del registro. <br><br>  Lo que sucede en el futuro con este c√≥digo IR no es particularmente interesante para nosotros ahora.  El c√≥digo est√° optimizado (pero en el caso de un ejemplo tan simple como el nuestro, nada ya est√° optimizado), y luego se convierte en c√≥digo de m√°quina. <br><br><h2>  <font color="#3AC1EF">Segundo ejemplo</font> </h2><br>  El siguiente ejemplo, que examinaremos, ser√° un poco m√°s complicado.  Es decir, estamos hablando de una funci√≥n que suma la porci√≥n de enteros: <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(numbers []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span></span> {   n := <span class="hljs-number"><span class="hljs-number">0</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(numbers); i++ {       n += numbers[i]   }   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n }</code> </pre> <br>  Este c√≥digo se convierte al siguiente c√≥digo Go SSA: <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(numbers []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">entry</span></span></span><span class="hljs-function">:   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jump</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">:   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t0</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phi</span></span></span><span class="hljs-function"> [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">entry</span></span></span><span class="hljs-function">: 0:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">body</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t6</span></span></span><span class="hljs-function">] #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">n</span></span></span><span class="hljs-function">                       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phi</span></span></span><span class="hljs-function"> [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">entry</span></span></span><span class="hljs-function">: 0:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">body</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t7</span></span></span><span class="hljs-function">] #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">                       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">len</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(numbers)</span></span></span><span class="hljs-function">                                              </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t3</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t1</span></span></span><span class="hljs-function"> &lt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t2</span></span></span><span class="hljs-function">                                                  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t3</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">goto</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">body</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">done</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">body</span></span></span><span class="hljs-function">:   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t4</span></span></span><span class="hljs-function"> = &amp;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">numbers</span></span></span><span class="hljs-function">[</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t1</span></span></span><span class="hljs-function">]                                             *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t5</span></span></span><span class="hljs-function"> = *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t4</span></span></span><span class="hljs-function">                                                       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t6</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t0</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t5</span></span></span><span class="hljs-function">                                                   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t7</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t1</span></span></span><span class="hljs-function"> + 1:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">                                                </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jump</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">done</span></span></span><span class="hljs-function">:   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t0</span></span></span></span></code> </pre> <br>  Aqu√≠ ya puede ver m√°s construcciones espec√≠ficas para la presentaci√≥n de c√≥digo en forma de SSA.  Probablemente la caracter√≠stica m√°s obvia de este c√≥digo es el hecho de que no hay comandos de control de flujo estructurados.  Para controlar el flujo de los c√°lculos, solo hay saltos condicionales e incondicionales y, si consideramos este comando como un comando para controlar el flujo, un comando de retorno. <br><br>  De hecho, aqu√≠ puede prestar atenci√≥n al hecho de que el programa no est√° dividido en bloques usando llaves (como en los lenguajes de la familia C).  Est√° dividido por etiquetas, que se asemeja a los lenguajes de ensamblaje, y se presenta en forma de bloques base.  En SSA, los bloques base son secuencias contiguas de c√≥digo que comienzan con una etiqueta y terminan con instrucciones para completar el bloque base, por ejemplo, <code>return</code> y <code>jump</code> . <br><br>  Otro detalle interesante de este c√≥digo es la instrucci√≥n <code>phi</code> .  La instrucci√≥n es bastante inusual, puede tomar alg√∫n tiempo resolverlo.  Recuerde que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SSA</a> es la abreviatura de asignaci√≥n est√°tica individual.  Esta es una representaci√≥n intermedia del c√≥digo utilizado por los compiladores, en el que cada variable se asigna solo una vez.  Esto es excelente para expresar funciones simples como nuestra funci√≥n <code>myAdd</code> que se muestra arriba, pero no para funciones m√°s complejas como la funci√≥n de <code>sum</code> discutida en esta secci√≥n.  En particular, durante la ejecuci√≥n del bucle, las variables <code>i</code> y <code>n</code> cambian. <br><br>  SSA omite la restricci√≥n en una sola asignaci√≥n de valores variables usando la llamada instrucci√≥n <code>phi</code> (su nombre se toma del alfabeto griego).  El hecho es que para que la representaci√≥n SSA del c√≥digo pueda formarse para lenguajes como C, debe recurrir a algunos trucos.  El resultado de llamar a esta instrucci√≥n es el valor actual de la variable ( <code>i</code> o <code>n</code> ), y se utiliza una lista de bloques base como sus par√°metros.  Por ejemplo, considere esta instrucci√≥n: <br><br><pre> <code class="go hljs">t0 = phi [entry: <span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.body: t6] #n</code> </pre> <br>  Su significado es el siguiente: si el bloque base anterior era un bloque de <code>entry</code> (entrada), entonces <code>t0</code> es constante <code>0</code> , y si el bloque base anterior era <code>for.body</code> , entonces debe tomar el valor <code>t6</code> de este bloque.  Todo esto puede parecer bastante misterioso, pero gracias a este mecanismo, la SSA est√° asegurada.  Desde el punto de vista humano, todo esto complica la comprensi√≥n del c√≥digo, pero el hecho de que cada valor se asigne solo una vez simplifica enormemente muchas optimizaciones. <br><br>  Tenga en cuenta que si est√° escribiendo su propio compilador, generalmente no tiene que lidiar con tales cosas.  Incluso Clang no genera todas estas instrucciones de <code>phi</code> , usa el mecanismo de <code>alloca</code> (se parece a trabajar con variables locales ordinarias).  Luego, al realizar un pase de optimizaci√≥n de LLVM, llamado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mem2reg</a> , las instrucciones de <code>alloca</code> se convierten al formulario SSA.  Sin embargo, TinyGo recibe informaci√≥n de Go SSA, que, convenientemente, ya se ha convertido al formulario SSA. <br><br>  Otra innovaci√≥n de este fragmento de c√≥digo intermedio es que el acceso a los elementos del segmento por √≠ndice se presenta en la forma de la operaci√≥n de c√°lculo de la direcci√≥n y la operaci√≥n de desreferenciaci√≥n del puntero obtenido.  Aqu√≠ puede ver la adici√≥n directa de constantes al c√≥digo IR (por ejemplo, <code>1:int</code> ).  En el ejemplo con la funci√≥n <code>myAdd</code> esto no se us√≥.  Ahora que hemos descubierto estas caracter√≠sticas, veremos en qu√© se convertir√° este c√≥digo al convertirlo al formulario IR LLVM: <br><br><pre> <code class="go hljs">define i64 @sum(i64* %ptr, i64 %<span class="hljs-built_in"><span class="hljs-built_in">len</span></span>, i64 %<span class="hljs-built_in"><span class="hljs-built_in">cap</span></span>) { entry: br label %<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.loop <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.loop:                                         ; preds = %<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.body, %entry %<span class="hljs-number"><span class="hljs-number">0</span></span> = phi i64 [ <span class="hljs-number"><span class="hljs-number">0</span></span>, %entry ], [ %<span class="hljs-number"><span class="hljs-number">5</span></span>, %deref.next ] %<span class="hljs-number"><span class="hljs-number">1</span></span> = phi i64 [ <span class="hljs-number"><span class="hljs-number">0</span></span>, %entry ], [ %<span class="hljs-number"><span class="hljs-number">6</span></span>, %deref.next ] %<span class="hljs-number"><span class="hljs-number">2</span></span> = icmp slt i64 %<span class="hljs-number"><span class="hljs-number">1</span></span>, %<span class="hljs-built_in"><span class="hljs-built_in">len</span></span> br i1 %<span class="hljs-number"><span class="hljs-number">2</span></span>, label %<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.body, label %<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.done <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.body:                                         ; preds = %<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.loop %<span class="hljs-number"><span class="hljs-number">3</span></span> = getelementptr i64, i64* %ptr, i64 %<span class="hljs-number"><span class="hljs-number">1</span></span> %<span class="hljs-number"><span class="hljs-number">4</span></span> = load i64, i64* %<span class="hljs-number"><span class="hljs-number">3</span></span> %<span class="hljs-number"><span class="hljs-number">5</span></span> = add i64 %<span class="hljs-number"><span class="hljs-number">0</span></span>, %<span class="hljs-number"><span class="hljs-number">4</span></span> %<span class="hljs-number"><span class="hljs-number">6</span></span> = add i64 %<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> br label %<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.loop <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.done:                                         ; preds = %<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.loop ret i64 %<span class="hljs-number"><span class="hljs-number">0</span></span> }</code> </pre> <br>  Aqu√≠, como antes, podemos ver la misma estructura, que incluye otras construcciones sint√°cticas.  Por ejemplo, en llamadas <code>phi</code> , se intercambian valores y etiquetas.  Sin embargo, tambi√©n hay algo a lo que vale la pena prestar especial atenci√≥n. <br><br>  Para empezar, aqu√≠ puede ver una firma completamente diferente de la funci√≥n.  LLVM no admite cortes, como resultado, en forma de optimizaci√≥n, el compilador TinyGo, que gener√≥ este c√≥digo intermedio, dividi√≥ la descripci√≥n de esta estructura de datos en partes.  Podr√≠a representar tres elementos de corte ( <code>ptr</code> , <code>len</code> y <code>cap</code> ) como una estructura (estructura), pero presentarlos como tres entidades separadas permite algunas optimizaciones.  Otros compiladores pueden presentar el segmento de alguna otra manera, depende de las convenciones para llamar a las funciones de la plataforma de destino. <br><br>  Otra caracter√≠stica interesante de este c√≥digo es el uso de la <code>getelementptr</code> (a menudo llamada GEP para abreviar). <br><br>  Esta instrucci√≥n funciona con punteros y se usa para obtener un puntero a un elemento de divisi√≥n.  Por ejemplo, compar√©moslo con el siguiente c√≥digo escrito en C: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* sliceptr(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> *ptr, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index) {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &amp;ptr[index]; }</code> </pre> <br>  O con el siguiente equivalente a esto: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* sliceptr(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> *ptr, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index) {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ptr + index; }</code> </pre> <br>  Lo m√°s importante aqu√≠ es que la instrucci√≥n <code>getelementptr</code> no realiza operaciones de desreferenciaci√≥n.  Solo calcula un nuevo puntero basado en el existente.  Se puede interpretar como <code>mul</code> y <code>add</code> a nivel de hardware.  Los detalles sobre las instrucciones de GEP se pueden encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br>  Otra caracter√≠stica interesante de este c√≥digo intermedio es el uso de la instrucci√≥n <code>icmp</code> .  Esta es una instrucci√≥n de prop√≥sito general utilizada para implementar comparaciones de enteros.  El resultado de esta instrucci√≥n es siempre un valor de tipo <code>i1</code> , un valor l√≥gico.  En este caso, se realiza una comparaci√≥n usando la palabra clave <code>slt</code> (con signo menor que), ya que estamos comparando dos n√∫meros representados previamente por el tipo <code>int</code> .  Si tuvi√©ramos que comparar dos enteros sin signo, entonces <code>icmp</code> como una instrucci√≥n, y la palabra clave utilizada en la comparaci√≥n ser√≠a <code>ult</code> .  Para comparar n√∫meros de coma flotante, se utiliza otra instrucci√≥n, <code>fcmp</code> , que funciona de manera similar. <br><br><h2>  <font color="#3AC1EF">Resumen</font> </h2><br>  Creo que en este art√≠culo examin√© las caracter√≠sticas m√°s importantes de LLVM IR.  Por supuesto, todav√≠a hay muchas cosas.  En particular, la representaci√≥n intermedia del c√≥digo puede contener muchas anotaciones, lo que permite tener en cuenta ciertas caracter√≠sticas de optimizaci√≥n conocidas por el compilador durante los pases de optimizaci√≥n que no pueden expresarse en IR de ninguna otra manera.  Por ejemplo, estos son los <code>inbounds</code> de la instrucci√≥n <code>inbounds</code> , o los <code>nuw</code> <code>nsw</code> y <code>nuw</code> , que se pueden agregar a la instrucci√≥n <code>add</code> .  Lo mismo se aplica a la palabra clave <code>private</code> , que indica al optimizador que la funci√≥n marcada por √©l no ser√° referenciada desde fuera de la unidad de compilaci√≥n actual.  Esto le permite realizar muchas optimizaciones interprocedurales interesantes, como eliminar argumentos no utilizados. <br><br>  Puede leer m√°s sobre LLVM en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> , a la que a menudo se referir√° cuando desarrolle su propio compilador basado en LLVM.  Aqu√≠ hay una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">gu√≠a</a> que analiza el desarrollo del compilador para un lenguaje muy simple.  Ambas fuentes de informaci√≥n ser√°n √∫tiles al crear su propio compilador. <br><br>  <b>Estimados lectores!</b>  ¬øUsas LLVM? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/451476/">https://habr.com/ru/post/451476/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451460/index.html">Julia en el laberinto</a></li>
<li><a href="../451462/index.html">Escriba menos c√≥digo duplicado usando carpetas en Laravel</a></li>
<li><a href="../451464/index.html">Frontend Weekly Digest (6-12 de mayo de 2019)</a></li>
<li><a href="../451466/index.html">graphql - trampas</a></li>
<li><a href="../451468/index.html">El resumen de materiales frescos del mundo del front-end para la √∫ltima semana No. 364 (6 al 12 de mayo de 2019)</a></li>
<li><a href="../451478/index.html">Acelerar la exploraci√≥n de datos utilizando la biblioteca de perfiles de pandas</a></li>
<li><a href="../451480/index.html">¬øPor qu√© el Ministerio de Industria y Comercio proh√≠be el almacenamiento de datos en equipos extranjeros?</a></li>
<li><a href="../451482/index.html">Competencias de un programador moderno desde un √°ngulo diferente</a></li>
<li><a href="../451488/index.html">C√°lculo de canibalizaci√≥n basado en la prueba cl√°sica A / B y el m√©todo bootstrap</a></li>
<li><a href="../451492/index.html">Siete variables inesperadas de Bash</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>