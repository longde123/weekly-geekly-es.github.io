<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฎ ๐ ๐ฉโ๐ฆ ุชูููู ุฎุงุฏู ููุดุฑ ุชุทุจูู Rails ุจุงุณุชุฎุฏุงู Ansible ๐ข ๐ง ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ููุฐ ููุช ููุณ ุจุจุนูุฏ ุ ููุช ุจุญุงุฌุฉ ุฅูู ูุชุงุจุฉ ุงูุนุฏูุฏ ูู ูุชุจ ุงููุนุจ ุบูุฑ ุงููุฑุฆูุฉ ูุฅุนุฏุงุฏ ุงูุฎุงุฏู ููุดุฑ ุชุทุจูู ุงููุถุจุงู. ูุจุดูู ูุฏูุด ุ ูู ุฃุฌุฏ ุฏููููุง ุจุณูุทูุง ุฎุทูุฉ ุจุฎุทูุฉ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุชูููู ุฎุงุฏู ููุดุฑ ุชุทุจูู Rails ุจุงุณุชุฎุฏุงู Ansible</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460769/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ููุฐ ููุช ููุณ ุจุจุนูุฏ ุ ููุช ุจุญุงุฌุฉ ุฅูู ูุชุงุจุฉ ุงูุนุฏูุฏ ูู ูุชุจ ุงููุนุจ ุบูุฑ ุงููุฑุฆูุฉ ูุฅุนุฏุงุฏ ุงูุฎุงุฏู ููุดุฑ ุชุทุจูู ุงููุถุจุงู.  ูุจุดูู ูุฏูุด ุ ูู ุฃุฌุฏ ุฏููููุง ุจุณูุทูุง ุฎุทูุฉ ุจุฎุทูุฉ.  ูู ุฃูู ุฃุฑุบุจ ูู ูุณุฎ ูุชุงุจ ุงููุนุจ ุงูุฎุงุต ุจุดุฎุต ุขุฎุฑ ุฏูู ููู ูุง ูุงู ูุญุฏุซ ูููุชูุฌุฉ ูุฐูู ุงุถุทุฑุฑุช ุฅูู ูุฑุงุกุฉ ุงููุซุงุฆู ูุฌูุน ูู ุดูุก ุจููุณู.  ุฑุจูุง ุดุฎุต ูููููู ุงููุณุงุนุฏุฉ ูู ุชุณุฑูุน ูุฐู ุงูุนูููุฉ ูุน ูุฐู ุงููุงุฏุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุฃูู ุดูุก ูุฌุจ ูููู ูู ุฃู ansible ูููุฑ ูู ูุงุฌูุฉ ููุงุฆูุฉ ูุฃุฏุงุก ูุงุฆูุฉ ูุญุฏุฏุฉ ูุณุจููุง ูู ุงูุฅุฌุฑุงุกุงุช ุนูู ุงูุฎุงุฏู (ุงูุฎูุงุฏู) ุนู ุจูุนุฏ ุนุจุฑ SSH.  ูุง ููุฌุฏ ุณุญุฑ ููุง ุ ูุง ููููู ุชุซุจูุช ุงููููู ุงูุฅุถุงูู ูุงูุฎุฑูุฌ ูู ูุฑุจุน ุชุนุทู ุงูุตูุฑ ูู ูุดุฑ ุงูุชุทุจูู ุงูุฎุงุต ุจู ูุน ุนุงูู ูููุงุก ุ ููุฑุงูุจุฉ ูุบูุฑูุง ูู ุงูุฃุดูุงุก ุงูุฌูุฏุฉ.  ูู ุฃุฌู ูุชุงุจุฉ ูุชุงุจ ุงููุนุจ ุ ูุฌุจ ุฃู ุชุนุฑู ุจุงูุถุจุท ูุง ุชุฑูุฏ ุงูููุงู ุจู ูููููุฉ ุงูููุงู ุจุฐูู.  ูุฐูู ุ ุฃูุง ูุง ุฃุญุจ ูุชุจ ุงููุนุจ ุงูุฌุงูุฒุฉ ูู ุฌูุซุจ ุ ุฃู ููุงูุงุช ูุซู: "ุงููุณุฎ ูุงูุชุดุบูู ุ ุณุชูุฌุญ". </p><a name="habracut"></a><br><h2 id="chto-nam-nuzhno" style=";text-align:right;direction:rtl">  ูุงุฐุง ูุญุชุงุฌุ </h2><br><p style=";text-align:right;direction:rtl">  ููุง ููุช ุ ูู ุฃุฌู ูุชุงุจุฉ ูุชุงุจ ุงููุนุจ ุ ูุฃูุช ุจุญุงุฌุฉ ุฅูู ูุนุฑูุฉ ูุง ุชุฑูุฏ ุงูููุงู ุจู ูููููุฉ ุงูููุงู ุจุฐูู.  ุฏุนูุง ููุฑุฑ ูุง ูุญุชุงุฌู.  ูุชุทุจูู Rails ุ ุณูุญุชุงุฌ ุฅูู ุนุฏุฉ ุญุฒู ูุธุงู: nginx ุ postgresql (redis ุ ุฅูุฎ).  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุญู ุจุญุงุฌุฉ ุฅูู ุฑูุจู ุฅุตุฏุงุฑ ูุนูู.  ูู ุงูุฃูุถู ุชุซุจูุชู ูู ุฎูุงู rbenv (rvm ุ asdf ...).  ูุนุฏ ุชุดุบูู ูู ูุฐุง ูู ุฌุฐุฑ ุงููุณุชุฎุฏู ุฏุงุฆููุง ููุฑุฉ ุณูุฆุฉ ุ ูุฐูู ุชุญุชุงุฌ ุฅูู ุฅูุดุงุก ูุณุชุฎุฏู ูููุตู ูุชูููู ุงูุญููู ูู.  ุจุนุฏ ุฐูู ุ ุชุญุชุงุฌ ุฅูู ุชุญููู ุงูููุฏ ุงูุฎุงุต ุจูุง ุฅูู ุงูุฎุงุฏู ุ ููุณุฎ ุงูุชููุฆุฉ ูู nginx ุ ู postgres ุ ูุบูุฑูุง ูุจุฏุก ุฌููุน ูุฐู ุงูุฎุฏูุงุช. </p><br><p style=";text-align:right;direction:rtl">  <strong>ูุชูุฌุฉ ูุฐูู ุ ุชุณูุณู ุงูุฅุฌุฑุงุกุงุช ููุง ููู:</strong> </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุณุฌูู ุงูุฏุฎูู ูุฌุฐุฑ </li><li style=";text-align:right;direction:rtl">  ุชุซุจูุช ุญุฒู ุงููุธุงู </li><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ูุณุชุฎุฏู ุฌุฏูุฏ ุ ุชูููู ุงูุญููู ุ ููุชุงุญ ุณู </li><li style=";text-align:right;direction:rtl">  ุชูููู ุญุฒู ุงููุธุงู (nginx ููุง ุฅูู ุฐูู) ูุชุดุบูููุง </li><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ูุณุชุฎุฏู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ููููู ุฅูุดุงุก ูุงุนุฏุฉ ุจูุงูุงุช ุนูู ุงูููุฑ) </li><li style=";text-align:right;direction:rtl">  ุชุณุฌูู ุงูุฏุฎูู ููุณุชุฎุฏู ุฌุฏูุฏ </li><li style=";text-align:right;direction:rtl">  ุชุซุจูุช rbenv ูุฑูุจู </li><li style=";text-align:right;direction:rtl">  ุชุซุจูุช ุงููุฌูุน </li><li style=";text-align:right;direction:rtl">  ููุก ุฑูุฒ ุงูุชุทุจูู </li><li style=";text-align:right;direction:rtl">  ูุจุฏุฃ ุฎุงุฏู ุจููุง </li></ol><br><p style=";text-align:right;direction:rtl">  ุนูุงูุฉ ุนูู ุฐูู ุ ูููู ุงูููุงู ุจุงูุฎุทูุงุช ุงูุฃุฎูุฑุฉ ุจุงุณุชุฎุฏุงู capistrano ุ ุนูู ุงูุฃูู ูููููุง ูุณุฎ ุงูููุฏ ุฅูู ุฏูุงุฆู ุงูุฅุตุฏุงุฑ ูู ุงููุฑุจุน ุ ูุชุจุฏูู ุงูุฅุตุฏุงุฑ ุจุฑูุฒ ุงุฑุชุจุงุท ุนูุฏ ูุดุฑ ูุงุฌุญ ุ ููุณุฎ ุงูุชููููุงุช ูู ุงูุฏููู ุงููุดุชุฑู ุ ูุฅุนุงุฏุฉ ุชุดุบูู puma ุ ุฅูุฎ.  ูู ูุฐุง ูููู ุงูููุงู ุจู ูุน Ansible ุ ููู ููุงุฐุงุ </p><br><h2 id="faylovaya-struktura" style=";text-align:right;direction:rtl">  ูููู ุงูููู </h2><br><p style=";text-align:right;direction:rtl">  ูุญุชูู Ansible ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุจููุฉ ููู</a> ุตุงุฑูุฉ ูุฌููุน ูููุงุชู ุ ูุฐูู ูู ุงูุฃูุถู ุงูุงุญุชูุงุธ ุจูุง ุฌููุนูุง ูู ุฏููู ูููุตู.  ูููุณ ูู ุงูููู ููุบุงูุฉ ูุง ุฅุฐุง ูุงู ุณูููู ูู ุชุทุจูู ุงููุถุจุงู ููุณู ุ ุฃู ุจุดูู ูููุตู.  ููููู ุชุฎุฒูู ุงููููุงุช ูู ูุณุชูุฏุน ุจูุงุจุฉ ูููุตู.  ุดุฎุตูุง ุ ูุงู ุงูุฃูุฑ ุงูุฃูุซุฑ ููุงุกูุฉ ุจุงููุณุจุฉ ูู ูุฅูุดุงุก ุฏููู ุบูุฑ ูุฑุฆู ูู / config ูุฏููู ุงููุถุจุงู ููุชุทุจูู ูุชุฎุฒูู ูู ุดูุก ูู ูุณุชูุฏุน ูุงุญุฏ. </p><br><h3 id="simple-playbook" style=";text-align:right;direction:rtl">  ููุงุนุฏ ุงููุนุจุฉ ุงูุจุณูุทุฉ </h3><br><p style=";text-align:right;direction:rtl">  Playbook ูู ููู yml ูุตู ูุงุฐุง ูููู ูุฌุจ ุฃู ูููู ansible ุจุงุณุชุฎุฏุงู ุจูุงุก ุฌููุฉ ุฎุงุต.  ุฏุนูุง ููุดุฆ ุฃูู ูุชุงุจ ูุนุจ ูุง ููุนู ุดูุฆูุง: </p><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">--- - name: Simple playbook hosts: all</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ุ ูููู ุจุจุณุงุทุฉ ุฃู ูุชุงุจ ุงููุนุจ ุงูุฎุงุต ุจูุง ูุณูู <code>Simple Playbook</code> ูุฃูู ูุฌุจ ุชุดุบูู ูุญุชููุงุชู ูุฌููุน ุงููุถูููู.  ูููููุง ุญูุธู ูู ุงูุฏููู / ansible ุจุงุณู <code>playbook.yml</code> ููุญุงููุฉ ุชุดุบููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">ansible-playbook ./playbook.yml PLAY [Simple Playbook] ************************************************************************************************************************************ skipping: no hosts matched</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู Ansible ุฅูู ูุง ูุนุฑู ุงููุถูููู ุงูุฐูู ูุชุทุงุจููู ูุน ูู ุงููุงุฆูุฉ.  ูุฌุจ ุฃู ูุชู ุณุฑุฏูุง ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููู ูุฎุฒูู</a> ุฎุงุต. </p><br><p style=";text-align:right;direction:rtl">  ูููู ุจุฅูุดุงุฆู ูู ููุณ ุงูุฏููู ansible: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">123.123.123.123</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐูู ุญุฏุฏ ููุท ุงููุถูู (ูู ุงููุงุญูุฉ ุงููุซุงููุฉ ุ ูุถูู VPS ุงูุฎุงุต ุจู ููุงุฎุชุจุงุฑุงุช ุ ุฃู ููููู ุชุณุฌูู ูุถูู ูุญูู) ูุญูุธู ุชุญุช ุงุณู <code>inventory</code> . <br>  ููููู ุชุฌุฑุจุฉ ุชุดุบูู ansible ุจุงุณุชุฎุฏุงู ููู invetory: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">ansible-playbook ./playbook.yml -i inventory PLAY [Simple Playbook] ************************************************************************************************************************************ TASK [Gathering Facts] ************************************************************************************************************************************ PLAY RECAP ************************************************************************************************************************************</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู ูุฏูู ูุตูู ssh ุฅูู ุงููุถูู ุงููุญุฏุฏ ุ ูุณูููู ansible ุจุงูุงุชุตุงู ูุฌูุน ุงููุนูููุงุช ุญูู ุงููุธุงู ุงูุจุนูุฏ.  (ุงูุงูุชุฑุงุถู ุงูููุงู [ุฌูุน ุงูุญูุงุฆู]) ูุจุนุฏ ุฐูู ุณูู ููุฏู ุชูุฑูุฑุง ูุฑุญููุง ููุฌุฒุง (PLAY RECAP). </p><br><p style=";text-align:right;direction:rtl">  ุงูุชุฑุงุถููุง ุ ูุชู ุงุณุชุฎุฏุงู ุงุณู ุงููุณุชุฎุฏู ุงูุฐู ุณุฌูุช ุจููุฌุจู ุชุณุฌูู ุงูุฏุฎูู ุฅูู ุงููุธุงู ููุงุชุตุงู.  ุนูู ุงูุฃุฑุฌุญ ูู ูููู ุนูู ุงููุถูู.  ูู ููู playbook ุ ููููู ุชุญุฏูุฏ ุงููุณุชุฎุฏู ุงูุฐู ูุฌุจ ุงุณุชุฎุฏุงูู ููุงุชุตุงู ุจุงุณุชุฎุฏุงู ุชูุฌูู remote_user.  ุฃูุถูุง ุ ุบุงูุจูุง ูุง ุชููู ุงููุนูููุงุช ุนู ุงููุธุงู ุงูุจุนูุฏ ุบูุฑ ุถุฑูุฑูุฉ ูู ููุฌุจ ุฃูุง ุชุถูุน ุงูููุช ูู ุฌูุนูุง.  ููููู ุฃูุถูุง ุฅููุงู ูุฐู ุงููููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">--- - name: Simple playbook hosts: all remote_user: root become: true gather_facts: no</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุญุงูู ุชุดุบูู playbook ูุฑุฉ ุฃุฎุฑู ูุชุฃูุฏ ูู ุฃู ุงูุงุชุตุงู ูุนูู.  (ุฅุฐุง ุญุฏุฏุช ุฌุฐุฑ ุงููุณุชุฎุฏู ุ ููุฌุจ ุนููู ุฃูุถูุง ุชุญุฏูุฏ ุงูุฃูุฑ ูุตุจุญ: ุงูุชูุฌูู ุงูุญูููู ููุญุตูู ุนูู ุญููู ูุฑุชูุนุฉ. ููุง ุชููู ุงููุซุงุฆู: <code>become set to 'true'/'yes' to activate privilege escalation.</code> ุฑุบู ุฃูู ููุณ ูู ุงููุงุถุญ ุณุจุจ ุฐูู) . </p><br><p style=";text-align:right;direction:rtl">  ุฑุจูุง ุชุญุตู ุนูู ุฎุทุฃ ุจุณุจุจ ุงูุฎุทุฃ ุงูุฐู ูุง ูููู ููุชุฑุฌู ุจุงูุซูู ุชุญุฏูุฏู ุ ุซู ููููู ุชุญุฏูุฏู ูุฏูููุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">ansible_python_interpreter: /usr/bin/python3</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุญูุซ ููููู ุงูุนุซูุฑ ุนูู <code>whereis python</code> ูุน ุฃูุฑ <code>whereis python</code> . </p><br><h3 id="ustanovka-sistemnyh-paketov" style=";text-align:right;direction:rtl">  ุชุซุจูุช ุญุฒู ุงููุธุงู </h3><br><p style=";text-align:right;direction:rtl">  ูุฃุชู Ansible ูุน ุงูุนุฏูุฏ ูู ุงููุญุฏุงุช ุงูููุทูุฉ ููุนูู ูุน ุญุฒู ุงููุธุงู ุงููุฎุชููุฉ ุ ูุฐูู ูุง ูุชุนูู ุนูููุง ูุชุงุจุฉ ูุตูุต bash ูุฃู ุณุจุจ ูู ุงูุฃุณุจุงุจ.  ูุญุชุงุฌ ุงูุขู ุฅูู ุฅุญุฏู ูุฐู ุงููุญุฏุงุช ูุชุญุฏูุซ ุงููุธุงู ูุชุซุจูุช ุญุฒู ุงููุธุงู.  ูุฏู Ubuntu Linux ุนูู VPS ุ ุนูู ุงูุชูุงูู ุ ูุชุซุจูุช ุงูุญุฒู ุ ูููููู ุงุณุชุฎุฏุงู <code>apt-get</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุญุฏุฉ ููุทูุฉ ูุฐูู</a> .  ุฅุฐุง ููุช ุชุณุชุฎุฏู ูุธุงู ุชุดุบูู ูุฎุชูููุง ุ ููุฏ ุชุญุชุงุฌ ุฅูู ูุญุฏุฉ ููุทูุฉ ูุฎุชููุฉ (ุชุฐูุฑ ุ ููุช ูู ุงูุจุฏุงูุฉ ุฅููุง ุจุญุงุฌุฉ ุฅูู ูุนุฑูุฉ ูุง ุณูู ููุนูู ูุณุจููุง) ูููู.  ููุน ุฐูู ุ ูุฅู ุจูุงุก ุงูุฌููุฉ ูู ุงููุฑุฌุญ ุฃู ุชููู ููุงุซูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุญู ูููู ููุงุนุฏ ุงููุนุจุฉ ุงูุชู ูุชุจุนูุง ุจุงูููุงู ุงูุฃููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">--- - name: Simple playbook hosts: all remote_user: root become: true gather_facts: no tasks: - name: Update system apt: update_cache=yes - name: Install system dependencies apt: name: git,nginx,redis,postgresql,postgresql-contrib state: present</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงููููุฉ ูู ุงููููุฉ ุงูุชู ุณูููุฐูุง ansible ุนูู ุงูุฎูุงุฏู ุงูุจุนูุฏุฉ.  ูุนุทู ุงููููุฉ ุงุณูุงู ูุชุชุจุน ุชูุฏููุง ูู ุงูุณุฌู.  ููุตู ุ ุจุงุณุชุฎุฏุงู ุจูุงุก ุฌููุฉ ูุญุฏุฉ ููุทูุฉ ูุนููุฉ ุ ูุง ุงูุฐู ูุฌุจ ุงูููุงู ุจู.  ูู ูุฐู ุงูุญุงูุฉ ุ <code>apt: update_cache=yes</code> - ูููู ุชุญุฏูุซ ุญุฒู ุงููุธุงู ุจุงุณุชุฎุฏุงู ุงููุญุฏุฉ ุงูููุทูุฉ apt.  ุงููุฑูู ุงูุซุงูู ูู ุฃูุซุฑ ุชุนููุฏุง ููููุง.  ูููู ุจุชูุฑูุฑ ูุงุฆูุฉ ุงูุญุฒู ุฅูู ุงููุญุฏุฉ ุงูููุทูุฉ apt ุ ููููู ุฃู ุญุงูุชูุง ูุฌุจ ุฃู ุชููู <code>present</code> ุ ุฃู ูููู ูุชุซุจูุช ูุฐู ุงูุญุฒู.  ูุจุงููุซู ุ ูููููุง ุฃู ูููู ููู ุฃู ูุชู ุญุฐููุง ุฃู ุชุญุฏูุซูุง ุ ุจุจุณุงุทุฉ ุนู ุทุฑูู ุชุบููุฑ <code>state</code> .  ูุฑุฌู ููุงุญุธุฉ ุฃูู ููู ุชุนูู ุงููุถุจุงู ูุน postgresql ุ ูุญุชุงุฌ ุฅูู ุญุฒูุฉ postgresql ุงูุชู ูููู ุจุชุซุจูุชูุง ุญุงูููุง.  ูุญุชุงุฌ ูุฐุง ูุฑุฉ ุฃุฎุฑู ุฅูู ุฃู ูููู ูุนุฑูููุง ููุนููุง ุ ููู ูููู ุจุฐูู ansible ุจุญุฏ ุฐุงุชู. </p><br><p style=";text-align:right;direction:rtl">  ุญุงูู ุชุดุบูู playbook ูุฑุฉ ุฃุฎุฑู ูุชุญูู ูู ุชุซุจูุช ุงูุญุฒู. </p><br><h3 id="sozdanie-novyh-polzovateley" style=";text-align:right;direction:rtl">  ุฅูุดุงุก ูุณุชุฎุฏููู ุฌุฏุฏ. </h3><br><p style=";text-align:right;direction:rtl">  ููุนูู ูุน ุงููุณุชุฎุฏููู ุ ูุญุชูู Ansible ุฃูุถูุง ุนูู ูุญุฏุฉ - ูุณุชุฎุฏู.  ุฃุถู ูููุฉ ุฃุฎุฑู (ุฃุฎููุช ุงูุฃุฌุฒุงุก ุงููุนุฑููุฉ ุจุงููุนู ูู playbook ูุฑุงุก ุงูุชุนูููุงุช ุ ุญุชู ูุง ุชูุณุฎูุง ุจุงููุงูู ูู ูู ูุฑุฉ): </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">--- - name: Simple playbook # ... tasks: # ... - name: Add a new user user: name: my_user shell: /bin/bash password: "{{ 123qweasd | password_hash('sha512') }}"</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฎูู ูุณุชุฎุฏููุง ุฌุฏูุฏูุง ููุถุน ูู ูููุฉ ูุฑูุฑ ููููุฉ ูุฑูุฑ.  ุซู ููุงุฌู ุงูุนุฏูุฏ ูู ุงููุดุงูู.  ูุงุฐุง ูู ูุงู ูุฌุจ ุฃู ุชููู ุฃุณูุงุก ุงููุณุชุฎุฏููู ูุฎุชููุฉ ูููุถูููู ุงููุฎุชููููุ  ูุนู ุ ูุฅุจูุงุก ูููุฉ ุงููุฑูุฑ ููุชูุญุฉ ูู playbook ูู ููุฑุฉ ุณูุฆุฉ ููุบุงูุฉ.  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ุณูุถุน ุงุณู ุงููุณุชุฎุฏู ููููุฉ ุงููุฑูุฑ ูู ูุชุบูุฑุงุช ุ ููู ููุงูุฉ ุงูููุงู ุณูู ุฃุนุฑุถ ููููุฉ ุชุดููุฑ ูููุฉ ุงููุฑูุฑ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">--- - name: Simple playbook # ... tasks: # ... - name: Add a new user user: name: "{{ user }}" shell: /bin/bash password: "{{ user_password | password_hash('sha512') }}"</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชู ุชุนููู ุงููุชุบูุฑุงุช ุจุงุณุชุฎุฏุงู ุฃููุงุณ ูุฒุฏูุฌุฉ ูุฌุนุฏ ูู ููุงุนุฏ ุงููุนุจุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุณูุดูุฑ ุฅูู ููู ุงููุชุบูุฑุงุช ูู ููู ุงููุฎุฒูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">123.123.123.123 [all:vars] user=my_user user_password=123qweasd</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุชุจู ุฅูู ุงูุชูุฌูู <code>[all:vars]</code> - ุญูุซ ูุดูุฑ ุฅูู ุฃู ุงููุฌููุนุฉ ุงูุชุงููุฉ ูู ุงููุต ูู ุงููุชุบูุฑุงุช (vars) ููู ูุงุจูุฉ ููุชุทุจูู ุนูู ุฌููุน ุงููุถูููู (ุงููู). </p><br><p style=";text-align:right;direction:rtl">  ุจูุงุก <code>"{{ user_password | password_hash('sha512') }}"</code> ูุซูุฑ ููุงูุชูุงู ุฃูุถูุง.  ุงูุญูููุฉ ูู ุฃู ansible ูุง ูููู ุจุชุนููู ุงููุณุชุฎุฏู ูู ุฎูุงู <code>user_add</code> ููุง ุชูุนู ูุฏูููุง.  ููู ูุญูุธ ุฌููุน ุงูุจูุงูุงุช ูุจุงุดุฑุฉ ุ ูููุฐุง ุงูุณุจุจ ูุฌุจ ุนูููุง ุฃูุถูุง ุชุญููู ูููุฉ ุงููุฑูุฑ ุฅูู ุนูุงูุฉ ุชุฌุฒุฆุฉ ูุณุจููุง ุ ููุฐุง ูุง ููุนูู ูุฐุง ุงูุฃูุฑ. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนูุง ูุถูู ูุณุชุฎุฏููุง ุฅูู ูุฌููุนุฉ sudo.  ููุน ุฐูู ุ ูุจู ูุฐุง ุชุญุชุงุฌ ุฅูู ุงูุชุฃูุฏ ูู ูุฌูุฏ ูุซู ูุฐู ุงููุฌููุนุฉ ูุฃู ูุง ุฃุญุฏ ุณููุนู ุฐูู ูู ุฃุฌููุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">--- - name: Simple playbook # ... tasks: # ... - name: Ensure a 'sudo' group group: name: sudo state: present - name: Add a new user user: name: "{{ user }}" shell: /bin/bash password: "{{ user_password | password_hash('sha512') }}" groups: "sudo"</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุฃูุฑ ุจุณูุท ุจูุง ููู ุงูููุงูุฉ ุ ููุฏููุง ุฃูุถูุง ูุญุฏุฉ ููุทูุฉ ูููุฌููุนุงุช ูุฅูุดุงุก ูุฌููุนุงุช ุ ูุน ุจูุงุก ุฌููุฉ ูุดุจู ุฌุฏูุง apt.  ุซู ูููู ุชุณุฌูู ูุฐู ุงููุฌููุนุฉ ูููุณุชุฎุฏู ( <code>groups: "sudo"</code> ). <br>  ูู ุงููููุฏ ุฃูุถูุง ุฅุถุงูุฉ ููุชุงุญ ssh ุฅูู ูุฐุง ุงููุณุชุฎุฏู ุญุชู ูุชููู ูู ุชุณุฌูู ุงูุฏุฎูู ุชุญุชู ุฏูู ูููุฉ ูุฑูุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">--- - name: Simple playbook # ... tasks: # ... - name: Ensure a 'sudo' group group: name: sudo state: present - name: Add a new user user: name: "{{ user }}" shell: /bin/bash password: "{{ user_password | password_hash('sha512') }}" groups: "sudo" - name: Deploy SSH Key authorized_key: user: "{{ user }}" key: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}" state: present</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูุญุงูุฉ ุ ูุนุฏ ุงูุฅูุดุงุก <code>"{{ lookup('file', '~/.ssh/id_rsa.pub') }}"</code> ูุซูุฑูุง ููุงูุชูุงู - ููู ููุณุฎ ูุญุชููุงุช ููู id_rsa.pub (ูุฏ ูุฎุชูู ุงุณูู) ุ ุฃู ุงูุฌุฒุก ุงูุนูููู ูู ุงูููุชุงุญ ssh ูุชุญูููู ุฅูู ูุงุฆูุฉ ุงูููุงุชูุญ ุงููุนุชูุฏุฉ ูููุณุชุฎุฏู ุนูู ุงูุฎุงุฏู. </p><br><h3 id="roli" style=";text-align:right;direction:rtl">  ุฏูุฑ </h3><br><p style=";text-align:right;direction:rtl">  ูููู ุงุณุชุฎุฏุงู ุงูููุงู ุงูุซูุงุซ ุงูุฎุงุตุฉ ุจุงูุฅูุดุงุก ุจุณูููุฉ ููุฌููุนุฉ ููุงู ูุงุญุฏุฉ ุ ูุณูููู ูู ุงูุฌูุฏ ุงูุงุญุชูุงุธ ุจูุฐู ุงููุฌููุนุฉ ูููุตูุฉ ุนู ูุชุงุจ ุงููุนุจ ุงูุฑุฆูุณู ุญุชู ูุง ุชููู ุฃูุซุฑ ูู ุงููุงุฒู.  ููุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฃุฏูุงุฑ</a> ููุฐุง ูู ansible. <br>  ููููุง ููููู ุงูููู ุงููุดุงุฑ ุฅููู ูู ุงูุจุฏุงูุฉ ุ ูุฌุจ ูุถุน ุงูุฃุฏูุงุฑ ูู ุฏููู ุฃุฏูุงุฑ ูููุตู ุ ููู ุฏูุฑ - ุฏููู ูููุตู ูุญูู ููุณ ุงูุงุณู ุ ุฏุงุฎู ุงูููุงู ุ ุงููููุงุช ุ ุงูููุงูุจ ุ ุฅูุฎ. <br>  ูููู ุจุฅูุดุงุก ุจููุฉ ุงูููู: <code>./ansible/roles/user/tasks/main.yml</code> (ุงูุฑุฆูุณู ูู ุงูููู ุงูุฑุฆูุณู ุงูุฐู ุณูุชู ุชุญูููู ูุชูููุฐู ุนูุฏูุง ูููู ุงูุฏูุฑ ูุชุตูุงู ุจูุชุงุจ ุงูุชุดุบูู ุ ูููู ุชูุตูู ูููุงุช ุงูุฏูุฑ ุงูุฃุฎุฑู ููู).  ููููู ุงูุขู ููู ุฌููุน ุงูููุงู ุงููุชุนููุฉ ุจุงููุณุชุฎุฏู ุฅูู ูุฐุง ุงูููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># Create user and add him to groups - name: Ensure a 'sudo' group group: name: sudo state: present - name: Add a new user user: name: "{{ user }}" shell: /bin/bash password: "{{ user_password | password_hash('sha512') }}" groups: "sudo" - name: Deploy SSH Key authorized_key: user: "{{ user }}" key: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}" state: present</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู playbook ุงูุฑุฆูุณู ุ ูุฌุจ ุนููู ุชุญุฏูุฏ ุงุณุชุฎุฏุงู ุฏูุฑ ุงููุณุชุฎุฏู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">--- - name: Simple playbook hosts: all remote_user: root gather_facts: no tasks: - name: Update system apt: update_cache=yes - name: Install system dependencies apt: name: git,nginx,redis,postgresql,postgresql-contrib state: present roles: - user</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃูุถูุง ุ ูุฏ ูููู ูู ุงูููุทูู ุฅุฌุฑุงุก ุชุญุฏูุซ ูููุธุงู ูุจู ุฌููุน ุงูููุงู ุงูุฃุฎุฑู ุ ูุฐูู ููููู ุฅุนุงุฏุฉ ุชุณููุฉ ูุชูุฉ <code>tasks</code> ุงูุชู ุชู ุชุนุฑูููุง ูู <code>pre_tasks</code> . </p><br><h3 id="nastroyka-nginx" style=";text-align:right;direction:rtl">  ุฅุนุฏุงุฏ Nginx </h3><br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุชุซุจูุช Nginx ูุนูุง ุจุงููุนู ุ ุชุญุชุงุฌ ุฅูู ุชููููู ูุชุดุบููู.  ุฏุนููุง ููุนู ุฐูู ุนูู ุงูููุฑ ูู ูุฐุง ุงูุฏูุฑ.  ุฅูุดุงุก ุจููุฉ ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">- ansible - roles - nginx - files - tasks - main.yml - templates</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญู ุงูุขู ุจุญุงุฌุฉ ุฅูู ูููุงุช ูููุงูุจ.  ุงููุฑู ุจูู ุงูุงุซููู ูู ุฃู ุงููููุงุช ุบูุฑ ุงููุฑุฆูุฉ ูุชู ูุณุฎูุง ูุจุงุดุฑุฉ ุ ููุง ูู.  ููุฌุจ ุฃู ุชุญุชูู ุงูููุงูุจ ุนูู ุงูุงูุชุฏุงุฏ j2 ููููููุง ุงุณุชุฎุฏุงู ููู ุงููุชุบูุฑุงุช ุจุงุณุชุฎุฏุงู ููุณ ุงูุฃููุงุณ ุงููุฒุฏูุฌุฉ ุงููุชุนุฑุฌุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนูุง ูุฏุฑุฌ nginx ูู ููู <code>main.yml</code> .  ููุฐุง ุ ูุฏููุง ูุญุฏุฉ systemd: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># Copy nginx configs and start it - name: enable service nginx and start systemd: name: nginx state: started enabled: yes</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ูุง ูููู ููุท ุฃูู ูุฌุจ ุชุดุบูู nginx (ุนูู ุณุจูู ุงููุซุงู ุ ุชุดุบููู) ุ ูููู ูููู ุนูู ุงูููุฑ ุฃูู ูุฌุจ ุชููููู. <br>  ุงูุขู ุงูุณุฎ ูููุงุช ุงูุชูููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># Copy nginx configs and start it - name: enable service nginx and start systemd: name: nginx state: started enabled: yes - name: Copy the nginx.conf copy: src: nginx.conf dest: /etc/nginx/nginx.conf owner: root group: root mode: '0644' backup: yes - name: Copy template my_app.conf template: src: my_app_conf.j2 dest: /etc/nginx/sites-available/my_app.conf owner: root group: root mode: '0644'</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ุจุฅูุดุงุก ููู ุชูููู nginx ุงูุฑุฆูุณู (ููููู ุฃุฎุฐู ูุจุงุดุฑุฉู ูู ุงูุฎุงุฏู ุฃู ูุชุงุจุชู ุจููุณู).  ููุฐูู ููู ุงูุชููุฆุฉ ูุชุทุจูููุง ูู ุฏููู sites_available (ูุฐุง ููุณ ุถุฑูุฑููุง ููููู ูููุฏ).  ูู ุงูุญุงูุฉ ุงูุฃููู ุ ูุณุชุฎุฏู ูุญุฏุฉ ุงููุณุฎ ููุณุฎ ุงููููุงุช (ูุฌุจ ุฃู ูููู ุงูููู ูู <code>/ansible/roles/nginx/files/nginx.conf</code> ).  ูู ุงูุซุงูู - ูุณุฎ ุงููุงูุจ ุ ุงุณุชุจุฏุงู ููู ุงููุชุบูุฑุงุช.  ูุฌุจ ุฃู ูููู ุงููุงูุจ ูู <code>/ansible/roles/nginx/templates/my_app.j2</code> ).  ููุฏ ูุจุฏู ูุซู ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">upstream {{ app_name }} { server unix:{{ app_path }}/shared/tmp/sockets/puma.sock; } server { listen 80; server_name {{ server_name }} {{ inventory_hostname }}; root {{ app_path }}/current/public; try_files $uri/index.html $uri.html $uri @{{ app_name }}; .... }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุชุจู ุฅูู <code>{{ app_path }}</code> <code>{{ app_name }}</code> ู <code>{{ app_path }}</code> ู <code>{{ server_name }}</code> ู <code>{{ inventory_hostname }}</code> - ููุฐู ูููุง ูุชุบูุฑุงุช ุณุชุณุชุจุฏู ููููุง ูู ุงููุต ุงููุงูุจ ูุจู ุงููุณุฎ.  ูุฐุง ูููุฏ ุฅุฐุง ููุช ุชุณุชุฎุฏู ููุงุนุฏ ุงููุนุจุฉ ุงูุชู ุชูุงุฑุณูุง ููุฌููุนุงุช ูุถููุฉ ูุฎุชููุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูููููุง ุงุณุชููุงู ููู ุงููุฎุฒูู ูุฏููุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">[production] 123.123.123.123 [staging] 231.231.231.231 [all:vars] user=my_user user_password=123qweasd [production:vars] server_name=production app_path=/home/www/my_app app_name=my_app [staging:vars] server_name=staging app_path=/home/www/my_stage app_name=my_stage_app</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูููุง ุจุชุดุบูู ูุชุงุจ ุงููุนุจ ุงูุฎุงุต ุจูุง ุงูุขู ุ ูุณูุคุฏู ุงูููุงู ุงููุญุฏุฏุฉ ูููุง ุงููุถูููู.  ูููู ูู ุงูููุช ููุณู ุ ุจุงููุณุจุฉ ุฅูู ุงููุถูู ุงููุฑุญูู ุ ุณุชุฎุชูู ุงููุชุบูุฑุงุช ุนู ุงูุฅูุชุงุฌ ุ ูููุณ ููุท ูู ุงูุฃุฏูุงุฑ ููุชุจ ุงูุชุดุบูู ุ ูููู ุฃูุถูุง ูู ุงูุชููููุงุช nginx.  <code>{{ inventory_hostname }}</code> ูุง ุชุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ูู ููู ุงููุฎุฒูู - ูุฐุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุชุบูุฑ ุฎุงุต ansible</a> ูุงููุถูู ุงูุฐู ูุชู ุชุดุบูู playbook ุญุงูููุง ุจู ูุฎุฒูู ููุงู. <br>  ุฅุฐุง ููุช ุชุฑูุฏ ุฃู ูููู ูุฏูู ููู ูุฎุฒูู ููุนุฏูุฏ ูู ุงููุถูููู ุ ููุชู ุชุดุบููู ููุฌููุนุฉ ูุงุญุฏุฉ ููุท ุ ูููู ุงูููุงู ุจุฐูู ุจุงุณุชุฎุฏุงู ุงูุฃูุฑ ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">ansible-playbook -i inventory ./playbook.yml -l "staging"</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฎูุงุฑ ุขุฎุฑ ูู ุฃู ูููู ูุฏูู ูููุงุช ุฌุฑุฏ ูููุตูุฉ ููุฌููุนุงุช ูุฎุชููุฉ.  ุฃู ููููู ุฏูุฌ ุทุฑููุชูู ุฅุฐุง ูุงู ูุฏูู ุงูุนุฏูุฏ ูู ุงููุถูููู ุงููุฎุชูููู. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนูุง ูุนูุฏ ุฅูู ุชูููู nginx.  ุจุนุฏ ูุณุฎ ูููุงุช ุงูุชูููู ุ ูุญุชุงุฌ ุฅูู ุฅูุดุงุก ุฑุงุจุท ูู sitest_enabled ุนูู my_app.conf ูู sites_available.  ูุฅุนุงุฏุฉ ุชุดุบูู ุฅูุฌู ุฅูุณ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">... # old code in mail.yml - name: Create symlink to sites-enabled file: src: /etc/nginx/sites-available/my_app.conf dest: /etc/nginx/sites-enabled/my_app.conf state: link - name: restart nginx service: name: nginx state: restarted</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุดูุก ุจุณูุท ููุง - ูุฑุฉ ุฃุฎุฑู ุ ูุญุฏุงุช ansible ูุน ุจูุงุก ุฌููุฉ ููุงุณู ุฅูู ุญุฏ ูุง.  ูููู ููุงู ููุทุฉ ูุงุญุฏุฉ.  ุฅุนุงุฏุฉ ุชุดุบูู nginx ูู ูู ูุฑุฉ ูุง ูุนูู ูู.  ูุงุญุธุช ุฃููุง ูุง ููุชุจ ุฃูุงูุฑ ูู ุงููููุฐุฌ: "ุงูุนู ูุซู ูุฐุง" ุ ูุจุฏู ุจูุงุก ุงูุฌููุฉ ุฃุดุจู "ูุฌุจ ุฃู ูููู ููุฐู ุงูุญุงูุฉ".  ูุบุงูุจุง ูุง ุชููู ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ูุนูู ุจูุง ansible.  ุฅุฐุง ูุงูุช ุงููุฌููุนุฉ ููุฌูุฏุฉ ุจุงููุนู ุฃู ูุงูุช ุญุฒูุฉ ุงููุธุงู ูุซุจุชุฉ ุจุงููุนู ุ ูุณูููู ansible ุจุงูุชุญูู ูู ุฐูู ูุชุฎุทู ุงููููุฉ.  ุฃูุถุง ุ ูู ูุชู ูุณุฎ ุงููููุงุช ุฅุฐุง ูุงูุช ุชุชุฒุงูู ุชูุงูุง ูุน ูุง ูู ููุฌูุฏ ุจุงููุนู ุนูู ุงูุฎุงุฏู.  ูููููุง ุงูุงุณุชูุงุฏุฉ ูู ูุฐุง ูุฅุนุงุฏุฉ ุชุดุบูู nginx ููุท ุฅุฐุง ุชู ุชุบููุฑ ูููุงุช ุงูุชูููู.  ููุฌุฏ ุชูุฌูู ุณุฌู ููุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># Copy nginx configs and start it - name: enable service nginx and start systemd: name: nginx state: started enabled: yes - name: Copy the nginx.conf copy: src: nginx.conf dest: /etc/nginx/nginx.conf owner: root group: root mode: '0644' backup: yes register: restart_nginx - name: Copy template my_app.conf template: src: my_app_conf.j2 dest: /etc/nginx/sites-available/my_app.conf owner: root group: root mode: '0644' register: restart_nginx - name: Create symlink to sites-enabled file: src: /etc/nginx/sites-available/my_app.conf dest: /etc/nginx/sites-enabled/my_app.conf state: link - name: restart nginx service: name: nginx state: restarted when: restart_nginx.changed</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุญุงูุฉ ุชุบููุฑ ุฃุญุฏ ูููุงุช ุงูุชูููู ุ ุณูุชู ุชูููุฐ <code>restart_nginx</code> ูุณูุชู ุชุณุฌูู ูุชุบูุฑ <code>restart_nginx</code> .  ูููุท ุฅุฐุง ุชู ุชุณุฌูู ูุฐุง ุงููุชุบูุฑ ุ ุณูุชู ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุฏูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุญุณููุง ุ ุจุงูุทุจุน ุ ุชุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ุฏูุฑ nginx ุฅูู playbook ุงูุฑุฆูุณู. </p><br><h3 id="nastroyka-postgresql" style=";text-align:right;direction:rtl">  ุฅุนุฏุงุฏ Postgresql </h3><br><p style=";text-align:right;direction:rtl">  ูุญุชุงุฌ ุฅูู ุชูููู postgresql ูุน systemd ุ ุชูุงููุง ููุง ูุนููุง ูุน nginx ุ ููุฐูู ุฅูุดุงุก ูุณุชุฎุฏู ุณูุณุชุฎุฏูู ูููุตูู ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุงุนุฏุฉ ุงูุจูุงูุงุช ููุณูุง. <br>  ูู <code>/ansible/roles/postgresql/tasks/main.yml</code> ุงูุฏูุฑ <code>/ansible/roles/postgresql/tasks/main.yml</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># Create user in postgresql - name: enable postgresql and start systemd: name: postgresql state: started enabled: yes - name: Create database user become_user: postgres postgresql_user: name: "{{ db_user }}" password: "{{ db_password }}" role_attr_flags: SUPERUSER - name: Create database become_user: postgres postgresql_db: name: "{{ db_name }}" encoding: UTF-8 owner: "{{ db_user }}"</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุฃุตู ููููุฉ ุฅุถุงูุฉ ูุชุบูุฑุงุช ุฅูู ุงููุฎุฒูู ุ ููุฏ ุชู ุฐูู ุจุงููุนู ุนุฏุฉ ูุฑุงุช ุ ุจุงูุฅุถุงูุฉ ุฅูู ุจูุงุก ุฌููุฉ postgresql_db ู postgresql_user.  ูููู ุงูุงุทูุงุน ุนูู ุงููุฒูุฏ ูู ุงูุจูุงูุงุช ูู ุงููุซุงุฆู.  ุงูุชูุฌูู <code>become_user: postgres</code> ุงูุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู <code>become_user: postgres</code> .  ูุงูุญูููุฉ ูู ุฃู ุงููุณุชุฎุฏู postgres ุจุดูู ุงูุชุฑุงุถู ููุท ูุฏูู ุญู ุงููุตูู ุฅูู ูุงุนุฏุฉ ุจูุงูุงุช postgresql ูููุท ูุญููุง.  ูุณูุญ ููุง ูุฐุง ุงูุชูุฌูู ุจุชูููุฐ ุงูุฃูุงูุฑ ููุงุจุฉ ุนู ูุฐุง ุงููุณุชุฎุฏู (ูุง ูู ููู ูุฏููุง ุจุงูุทุจุน ุฅููุงููุฉ ุงููุตูู). <br>  ุฃูุถูุง ุ ูุฏ ุชุถุทุฑ ุฅูู ุฅุถุงูุฉ ุณุทุฑ ุฅูู pg_hba.conf ููุชุญ ุงููุตูู ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุณุชุฎุฏู ุฌุฏูุฏ.  ูููู ุงูููุงู ุจุฐูู ุจููุณ ุงูุทุฑููุฉ ุงูุชู ูููุง ุจูุง ุจุชุบููุฑ ุงูุชูููู nginx. </p><br><p style=";text-align:right;direction:rtl">  ูุจุงูุทุจุน ุชุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ุฏูุฑ postgresql ุฅูู playbook ุงูุฑุฆูุณู. </p><br><h3 id="ustanovka-ruby-cherez-rbenv" style=";text-align:right;direction:rtl">  ุชุซุจูุช ุฑูุจู ูู ุฎูุงู rbenv </h3><br><p style=";text-align:right;direction:rtl">  ูุง ูุญุชูู Ansible ุนูู ูุญุฏุงุช ููุนูู ูุน rbenv ุ ูููู ูุชู ุชุซุจูุชู ุนู ุทุฑูู ุงุณุชูุณุงุฎ ูุณุชูุฏุน git.  ูุฐูู ุ ุชุตุจุญ ูุฐู ุงููููุฉ ุงูุฃูุซุฑ ุบูุฑ ููุงุณู.  ูููู ุจุฅูุดุงุก ุงูุฏูุฑ / ุบูุฑ <code>/ansible/roles/ruby_rbenv/main.yml</code> ููุง ูุงุจุฏุฃ ูู ููุฆู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># Install rbenv and ruby - name: Install rbenv become_user: "{{ user }}" git: repo=https://github.com/rbenv/rbenv.git dest=~/.rbenv</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญู ูุณุชุฎุฏู ูุฑุฉ ุฃุฎุฑู ุชูุฌูู ุฃุตุจุญ Bec_user ููุนูู ูู ุชุญุช ุงููุณุชุฎุฏู ุงูุฐู ุฃูุดุฃูุงู ููุฐู ุงูุฃุบุฑุงุถ.  ููุฐ ูุชู ุชุซุจูุช rbenv ูู ุงูุฏููู ุงูุฑุฆูุณู ุ ูููุณ ุนูู ุงูุตุนูุฏ ุงูุนุงููู.  ููุณุชุฎุฏู ุฃูุถูุง ูุญุฏุฉ git ูุงุณุชูุณุงุฎ ุงููุณุชูุฏุน ุนู ุทุฑูู ุชุญุฏูุฏ repo ู dest. </p><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ูุญุชุงุฌ ุฅูู ุชุณุฌูู rbenv init ูู bashrc ูุฅุถุงูุฉ rbenv ุฅูู PATH ูู ููุณ ุงูููุงู.  ููุฐุง ุ ูุฏููุง ูุญุฏุฉ lineinfile: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">- name: Add rbenv to PATH become_user: "{{ user }}" lineinfile: path: ~/.bashrc state: present line: 'export PATH="${HOME}/.rbenv/bin:${PATH}"' - name: Add rbenv init to bashrc become_user: "{{ user }}" lineinfile: path: ~/.bashrc state: present line: 'eval "$(rbenv init -)"'</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุซู ุชุซุจูุช ruby_build: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">- name: Install ruby-build become_user: "{{ user }}" git: repo=https://github.com/rbenv/ruby-build.git dest=~/.rbenv/plugins/ruby-build</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฃุฎูุฑุง ุชุซุจูุช ุฑูุจู.  ูุชู ุฐูู ุนุจุฑ rbenv ุ ุฃู ูุฌุฑุฏ ุฃูุฑ bash: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">- name: Install ruby become_user: "{{ user }}" shell: | export PATH="${HOME}/.rbenv/bin:${PATH}" eval "$(rbenv init -)" rbenv install {{ ruby_version }} args: executable: /bin/bash</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ุฃู ูุฑูู ูุชูููุฐ ูููู.  ููุน ุฐูู ุ ูุฅููุง ููุงุฌู ุญูููุฉ ุฃู ansible ูุง ูุนูู ุงูููุฏ ุงูููุฌูุฏ ูู bashrc ูุจู ุชุดุบูู ุงูุฃูุงูุฑ.  ูุฐูู ุ ุณูู ูุชุนูู ุชุญุฏูุฏ rbenv ูุจุงุดุฑุฉ ูู ููุณ ุงูุจุฑูุงูุฌ ุงููุตู. </p><br><p style=";text-align:right;direction:rtl">  ุงููุดููุฉ ุงูุชุงููุฉ ูู ุฃู ุงูุฃูุฑ shell ูุง ููุฌุฏ ูุฏูู ุญุงูุฉ ูู ุญูุซ ansible.  ููุฐุง ูุนูู ุฃู ุงูุชุญูู ุงูุชููุงุฆู ูุง ุฅุฐุง ูุงู ูุฐุง ุงูุฅุตุฏุงุฑ ูู ุฑูุจู ูุซุจุช ุฃู ูุง.  ูููููุง ุฃู ููุนู ุฐูู ุจุฃููุณูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">- name: Install ruby become_user: "{{ user }}" shell: | export PATH="${HOME}/.rbenv/bin:${PATH}" eval "$(rbenv init -)" if ! rbenv versions | grep -q {{ ruby_version }} then rbenv install {{ ruby_version }} &amp;&amp; rbenv global {{ ruby_version }} fi args: executable: /bin/bash</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุจูู ูุชุซุจูุช ุงููุฌููุน: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">- name: Install bundler become_user: "{{ user }}" shell: | export PATH="${HOME}/.rbenv/bin:${PATH}" eval "$(rbenv init -)" gem install bundler</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุฑุฉ ุฃุฎุฑู ุ ุฃุถู ุฏูุฑูุง ruby_rbenv ุฅูู playbook ุงูุฑุฆูุณู. </p><br><h3 id="shared-files" style=";text-align:right;direction:rtl">  ุงููููุงุช ุงููุดุชุฑูุฉ. </h3><br><p style=";text-align:right;direction:rtl">  ุจุดูู ุนุงู ุ ูููู ุฅููุงู ูุฐุง ุงูุฅุนุฏุงุฏ.  ุซู ูุจูู ูุชุดุบูู capistrano ูุณูููู ุจูุณุฎ ุงูููุฏ ููุณู ุ ูุฅูุดุงุก ุงูุฏูุงุฆู ุงููุงุฒูุฉ ูุชุดุบูู ุงูุชุทุจูู (ุฅุฐุง ุชู ุชูููู ูู ุดูุก ุจุดูู ุตุญูุญ).  ููุน ุฐูู ุ ุบุงูุจูุง ูุง ูุญุชุงุฌ capistrano ุฅูู ูููุงุช ุชูููู ุฅุถุงููุฉ ุ ูุซู <code>database.yml</code> ุฃู <code>.env</code> ูุณุฎูุง ุชูุงููุง ูุซู ุงููููุงุช ูุงูููุงูุจ ูู nginx.  ูุง ููุฌุฏ ุณูู ุฏูุฉ ูุงุญุฏุฉ.  ูุจู ูุณุฎ ุงููููุงุช ุ ุชุญุชุงุฌ ุฅูู ุฅูุดุงุก ุจููุฉ ุฏููู ููู ุ ูุซู ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># Copy shared files for deploy - name: Ensure shared dir become_user: "{{ user }}" file: path: "{{ app_path }}/shared/config" state: directory</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญุฏุฏ ุฏููููุง ูุงุญุฏูุง ููุท ูุณูู ููุดุฆ ansible ุงููุงูุฏ ุชููุงุฆููุง ุ ุฅุฐุง ูุฒู ุงูุฃูุฑ. </p><br><h2 id="ansible-vault" style=";text-align:right;direction:rtl">  ูุจู Ansible </h2><br><p style=";text-align:right;direction:rtl">  ููุฏ ุชุนุซุฑุช ุจุงููุนู ุญูููุฉ ุฃู ุงูุจูุงูุงุช ุงูุณุฑูุฉ ูุซู ูููุฉ ูุฑูุฑ ุงููุณุชุฎุฏู ูุฏ ุชุธูุฑ ูู ุงููุชุบูุฑุงุช.  ุฅุฐุง ููุช ุจุฅูุดุงุก ููู <code>.env</code> ููุชุทุจูู ุ ู <code>database.yml</code> ุ ููุฌุจ ุฃู ูููู ููุงู ุงููุฒูุฏ ูู ูุฐู ุงูุจูุงูุงุช ุงููุงูุฉ.  ุณูููู ูู ุงูุฌููู ุฃู ูุฎูููู ุนู ุฃุนูู ุงููุชุทูููู.  ูุณุชุฎุฏู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุจู Ansible</a> ููุฐุง ุงูุบุฑุถ. </p><br><p style=";text-align:right;direction:rtl">  ูููู ุจุฅูุดุงุก ููู ูููุชุบูุฑุงุช <code>/ansible/vars/all.yml</code> (ููุง ููููู ุฅูุดุงุก ูููุงุช ูุฎุชููุฉ ููุฌููุนุงุช ูุฎุชููุฉ ูู ุงููุถูููู ุ ุชูุงููุง ูุซู ููู ุงููุฎุฒูู: production.yml ุ staging.yml ุ ุฅูุฎ). <br>  ูู ูุฐุง ุงูููู ุ ุชุญุชุงุฌ ุฅูู ููู ุฌููุน ุงููุชุบูุฑุงุช ุงูุชู ูุฌุจ ุชุดููุฑูุง ุจุงุณุชุฎุฏุงู ุจูุงุก ุฌููุฉ yml ุงูููุงุณู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># System vars user_password: 123qweasd db_password: 123qweasd # ENV vars aws_access_key_id: xxxxx aws_secret_access_key: xxxxxx aws_bucket: bucket_name rails_secret_key_base: very_secret_key_base</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุซู ูููู ุชุดููุฑ ูุฐุง ุงูููู ุจุงุณุชุฎุฏุงู ุงูุฃูุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">ansible-vault encrypt ./vars/all.yml</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุทุจูุนุฉ ุงูุญุงู ุ ุฃุซูุงุก ุงูุชุดููุฑ ุณูููู ูู ุงูุถุฑูุฑู ุชุนููู ูููุฉ ูุฑูุฑ ููู ุงูุชุดููุฑ.  ููููู ุฑุคูุฉ ูุง ูุธูุฑ ุฏุงุฎู ุงูููู ุจุนุฏ ุงุณุชุฏุนุงุก ูุฐุง ุงูุฃูุฑ. </p><br><p style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู <code>ansible-vault decrypt</code> ูููู ูู ุชุดููุฑ ุงูููู ูุชุนุฏููู ุซู ุชุดููุฑู ูุฑุฉ ุฃุฎุฑู. </p><br><p style=";text-align:right;direction:rtl">  ููุนูู ุ ูู ุชุดููุฑ ุงูููู ููุณุช ุถุฑูุฑูุฉ.  ููููู ุชุฎุฒููู ูู ุดูู ูุดูุฑ ูุชุดุบูู playbook ูุน ุงููุณูุทุฉ <code>--ask-vault-pass</code> .  ุณูุทูุจ Ansible ูููุฉ ูุฑูุฑ ูุงูุญุตูู ุนูู ุงููุชุบูุฑุงุช ูุฅููุงู ุงูููุงู.  ุณุชุจูู ุฌููุน ุงูุจูุงูุงุช ูุดูุฑุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุจุฏู ุงูุฃูุฑ ุงููุงูู ููุนุฏูุฏ ูู ูุฌููุนุงุช ุงููุถูู ูุงููุจู ุบูุฑ ุงููุฑุบูุจ ููู ูุซู ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">ansible-playbook -i inventory ./playbook.yml -l "staging" --ask-vault-pass</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููู ุฃุนุทูู ุงููุต ุงููุงูู ูููุชุจ ูุงูุฃุฏูุงุฑ ุ ุงูุชุจ ูููุณู.  ูุฃู ุงูุดูุก ุบูุฑ ุงููุงุถุญ ูู - ุฅุฐุง ูู ุชููู ูุง ูุฌุจ ุงูููุงู ุจู ุ ููู ููุนู ุฐูู. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar460769/">https://habr.com/ru/post/ar460769/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar460743/index.html">ุฑูุฑูุฉ ุฏููู ุงููุจุชุฏุฆูู</a></li>
<li><a href="../ar460745/index.html">ุฎุจุฑุฉ ูู ุงุณุชุฎุฏุงู ูุญุฏุฉ GSM ูู ุฃุชูุชุฉ ุงูููุฒู</a></li>
<li><a href="../ar460747/index.html">ุงูุจุญุซ ุนู ุงูุฃุฑุจุงุญ ุฃู ุชุดุฏูุฏ ุงูููุณุฑุงุช: ุชููู Spotify ุนู ุงูุนูู ูุน ุงููุคูููู ูุจุงุดุฑุฉู - ูุงุฐุง ูุนูู ุฐูู</a></li>
<li><a href="../ar460751/index.html">ููู ุฃุทูููุง ุงูุฑูุจูุชุงุช ูู ุชุดูุฑููุจูู ุงูุตุบูุฑุฉ. ุงูุฌุฒุก 1</a></li>
<li><a href="../ar460755/index.html">ROS Trolley Robot - ุงูุฌุฒุก ุงูุฃูู: ุงูุญุฏูุฏ</a></li>
<li><a href="../ar460773/index.html">ุชุทุจูู ูุทุงุจูุฉ ุงูููุท ูู Java</a></li>
<li><a href="../ar460777/index.html">ูุฐุง ูู ุงูุฏูุฑ: ููุงุฐุง ุบูุฑุช Apple ูุชุทูุจุงุช ูุทูุฑู ุงูุชุทุจููุงุช</a></li>
<li><a href="../ar460779/index.html">ุชุตุญูุญ ูุชูุฏู</a></li>
<li><a href="../ar460783/index.html">ุฅุฌูุงุน ุนูู ุณูุนุฉ ุงูุนูุฏุฉ. ูู ูู ุถุฑูุฑูุ</a></li>
<li><a href="../ar460785/index.html">ุชุทุจููุงุช ุงููุชุจ ุงูุฅููุชุฑูููุฉ ุนูู ูุธุงู ุงูุชุดุบูู Android. ุงูุฌุฒุก 1. ููุฏูุฉ ูุงูุชุทุจููุงุช ุงูููุชุจูุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>