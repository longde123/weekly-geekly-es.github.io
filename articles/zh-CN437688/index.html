<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤­ ğŸš¬ ğŸ’¸ OpenSceneGraphï¼šåŸºæœ¬ç¼–ç¨‹æŠ€æœ¯ ğŸ¤ŸğŸ½ ğŸ–¥ï¸ ğŸ§“ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¼•è¨€ 
 è€ƒè™‘åˆ°OpenSceneGraphå¼•æ“åŠå…¶æä¾›çš„è½¯ä»¶çš„ç»†èŠ‚ï¼Œæœ¬æ–‡å°†ä¸ä»…ä»…å…³æ³¨å›¾å½¢ï¼Œè€Œæ˜¯åº”å¦‚ä½•ç»„ç»‡ä½¿ç”¨å›¾å½¢çš„åº”ç”¨ç¨‹åºã€‚ 

 ä¼—æ‰€å‘¨çŸ¥ï¼Œä»»ä½•è½¯ä»¶äº§å“æˆåŠŸçš„å…³é”®éƒ½æ˜¯è®¾è®¡è‰¯å¥½çš„ä½“ç³»ç»“æ„ï¼Œè¯¥ä½“ç³»ç»“æ„èƒ½å¤Ÿç»´æŠ¤å’Œæ‰©å±•ç¼–å†™çš„ä»£ç ã€‚ ä»è¿™ä¸ªæ„ä¹‰ä¸Šè®²ï¼Œæˆ‘ä»¬æ­£åœ¨è€ƒè™‘çš„å¼•æ“å¤„äºè¾ƒé«˜æ°´å¹³ï¼Œä¸ºå¼€å‘äººå‘˜æä¾›äº†éå¸¸å¹¿æ³›...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>OpenSceneGraphï¼šåŸºæœ¬ç¼–ç¨‹æŠ€æœ¯</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437688/"><img src="https://habrastorage.org/webt/py/ks/3w/pyks3wlvjf_zfef-sqocutbnimk.jpeg" alt="å›¾ç‰‡"><br><h1> å¼•è¨€ </h1><br> è€ƒè™‘åˆ°OpenSceneGraphå¼•æ“åŠå…¶æä¾›çš„è½¯ä»¶çš„ç»†èŠ‚ï¼Œæœ¬æ–‡å°†ä¸ä»…ä»…å…³æ³¨å›¾å½¢ï¼Œè€Œæ˜¯åº”å¦‚ä½•ç»„ç»‡ä½¿ç”¨å›¾å½¢çš„åº”ç”¨ç¨‹åºã€‚ <br><br> ä¼—æ‰€å‘¨çŸ¥ï¼Œä»»ä½•è½¯ä»¶äº§å“æˆåŠŸçš„å…³é”®éƒ½æ˜¯è®¾è®¡è‰¯å¥½çš„ä½“ç³»ç»“æ„ï¼Œè¯¥ä½“ç³»ç»“æ„èƒ½å¤Ÿç»´æŠ¤å’Œæ‰©å±•ç¼–å†™çš„ä»£ç ã€‚ ä»è¿™ä¸ªæ„ä¹‰ä¸Šè®²ï¼Œæˆ‘ä»¬æ­£åœ¨è€ƒè™‘çš„å¼•æ“å¤„äºè¾ƒé«˜æ°´å¹³ï¼Œä¸ºå¼€å‘äººå‘˜æä¾›äº†éå¸¸å¹¿æ³›çš„å·¥å…·åŒ…ï¼Œæä¾›äº†çµæ´»çš„æ¨¡å—åŒ–ä½“ç³»ç»“æ„çš„æ„å»ºã€‚ <br><br> æœ¬æ–‡ç¯‡å¹…ç›¸å½“é•¿ï¼Œæ¦‚è¿°äº†å¼€å‘äººå‘˜å¼•æ“æä¾›çš„å„ç§å·¥å…·å’ŒæŠ€æœ¯ï¼ˆå¦‚æœéœ€è¦ï¼Œå¯æä¾›è®¾è®¡æ¨¡å¼ï¼‰ã€‚ æœ¬æ–‡çš„æ‰€æœ‰éƒ¨åˆ†éƒ½æä¾›äº†ç¤ºä¾‹ï¼Œå…¶ä»£ç å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æˆ‘çš„å­˜å‚¨åº“ä¸­è·å–</a> ã€‚ <br><a name="habracut"></a><br><h1>  1.è§£æå‘½ä»¤è¡Œé€‰é¡¹ </h1><br> åœ¨C / C ++ä¸­ï¼Œå‘½ä»¤è¡Œå‚æ•°é€šè¿‡å‚æ•°ä¼ é€’ç»™mainï¼ˆï¼‰å‡½æ•°ã€‚ åœ¨è¿‡å»çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä»”ç»†åœ°å°†è¿™äº›å‚æ•°æ ‡è®°ä¸ºæœªä½¿ç”¨ï¼Œç°åœ¨æˆ‘ä»¬å°†ä½¿ç”¨å®ƒä»¬æ¥å‘Šè¯‰æˆ‘ä»¬çš„ç¨‹åºå¯åŠ¨æ—¶ä¸€äº›æ•°æ®ã€‚ <br><br>  OSGå…·æœ‰å†…ç½®çš„å‘½ä»¤è¡Œè§£æå·¥å…·ã€‚ <br><br> åˆ›å»ºä»¥ä¸‹ç¤ºä¾‹ <br><br><div class="spoiler">  <b class="spoiler_title">å‘½ä»¤è¡Œç¤ºä¾‹</b> <div class="spoiler_text">  <strong>ä¸»æ–‡ä»¶</strong> <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osgDB/ReadFile&gt; #include &lt;osgViewer/Viewer&gt; #endif // MAIN_H</span></span></span></span></code> </pre> <br>  <strong>main.cpp</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> int main(int argc, char *argv[]) { osg::ArgumentParser args(&amp;argc, argv); std::string filename; args.read(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"--model"</span></span></span><span class="hljs-meta">, filename); osg::ref_ptr</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osg::Node&gt; root = osgDB::readNodeFile(filename); osgViewer::Viewer viewer; viewer.setSceneData(root.get()); return viewer.run(); }</span></span></span></span></code> </pre><br></div></div><br> åœ¨QtCreatorä¸­è®¾ç½®ç¨‹åºå¯åŠ¨å‚æ•° <br><br><img src="https://habrastorage.org/webt/41/le/8p/41le8pjjdv2q-in3idhgnpe6-ao.png"><br><br> è¿è¡Œç¨‹åºæ‰§è¡Œï¼Œæˆ‘ä»¬å¾—åˆ°ç»“æœï¼ˆå¡è½¦æ¨¡å‹<a href="">å–è‡ªç›¸åŒçš„OpenSceneGraph-Data</a> ï¼‰ <br><br><img src="https://habrastorage.org/webt/t-/_o/bb/t-_obbiwlzwuax1e336kqd6tosy.png"><br><br> ç°åœ¨è®©æˆ‘ä»¬é€è¡Œçœ‹ä¸€ä¸ªç¤ºä¾‹ <br><br><pre> <code class="cpp hljs">osg::<span class="hljs-function"><span class="hljs-function">ArgumentParser </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">args</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&amp;argc, argv)</span></span></span></span>;</code> </pre><br> åˆ›å»ºosg :: ArgumentParserå‘½ä»¤è¡Œè§£æå™¨ç±»çš„å®ä¾‹ã€‚ åˆ›å»ºåï¼Œå°†å‘ç±»æ„é€ å‡½æ•°ä¼ é€’ç”±æ“ä½œç³»ç»Ÿçš„mainï¼ˆï¼‰å‡½æ•°æ¥å—çš„å‚æ•°ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> filename; args.read(<span class="hljs-string"><span class="hljs-string">"--model"</span></span>, filename);</code> </pre><br> æˆ‘ä»¬åˆ†æå‚æ•°ï¼Œå³åœ¨å…¶ä¸­å¯»æ‰¾â€œ â€“modelâ€é”®ï¼Œå¹¶å°†å…¶å€¼æ”¾å…¥å­—ç¬¦ä¸²æ–‡ä»¶åä¸­ã€‚ å› æ­¤ï¼Œä½¿ç”¨æ­¤å¯†é’¥ï¼Œæˆ‘ä»¬å°†å…·æœ‰ä¸‰ç»´æ¨¡å‹çš„æ–‡ä»¶åä¼ è¾“åˆ°ç¨‹åºã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åŠ è½½æ­¤æ¨¡å‹å¹¶æ˜¾ç¤ºå®ƒ <br><br><pre> <code class="cpp hljs">osg::ref_ptr&lt;osg::Node&gt; root = osgDB::readNodeFile(filename); osgViewer::Viewer viewer; viewer.setSceneData(root.get()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> viewer.run();</code> </pre><br>  osg :: ArgumentParserç±»çš„readï¼ˆï¼‰æ–¹æ³•æœ‰å¾ˆå¤šé‡è½½ï¼Œä½¿æ‚¨ä¸ä»…å¯ä»¥ä»å‘½ä»¤è¡Œè¯»å–å­—ç¬¦ä¸²å€¼ï¼Œè¿˜å¯ä»¥è¯»å–æ•´æ•°ï¼Œæµ®ç‚¹æ•°ï¼Œå‘é‡ç­‰ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥è¯»å–floatç±»å‹çš„æŸä¸ªå‚æ•° <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> size = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; args.read(<span class="hljs-string"><span class="hljs-string">"--size"</span></span>, size);</code> </pre><br> å¦‚æœæ­¤å‚æ•°æœªåœ¨å‘½ä»¤è¡Œä¸Šæ˜¾ç¤ºï¼Œåˆ™å…¶å€¼å°†ä¿ç•™åˆå§‹åŒ–sizeå˜é‡åçš„å€¼ã€‚ <br><br><h1>  2.é€šçŸ¥å’Œæ—¥å¿—è®°å½•æœºåˆ¶ </h1><br>  OpenSceneGraphå…·æœ‰é€šçŸ¥æœºåˆ¶ï¼Œå¯è®©æ‚¨åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ä»¥åŠç”±å¼€å‘äººå‘˜å¯åŠ¨æ—¶æ˜¾ç¤ºè°ƒè¯•æ¶ˆæ¯ã€‚ åœ¨è·Ÿè¸ªå’Œè°ƒè¯•ç¨‹åºæ—¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å¸®åŠ©ã€‚  OSGé€šçŸ¥ç³»ç»Ÿæ”¯æŒå¼•æ“æ ¸å¿ƒçº§åˆ«åŠå…¶æ’ä»¶çš„è¯Šæ–­ä¿¡æ¯ï¼ˆé”™è¯¯ï¼Œè­¦å‘Šï¼Œé€šçŸ¥ï¼‰çš„è¾“å‡ºã€‚ å¼€å‘äººå‘˜å¯ä»¥åœ¨ç¨‹åºæ“ä½œæœŸé—´ä½¿ç”¨osg :: notifyï¼ˆï¼‰å‡½æ•°æ˜¾ç¤ºè¯Šæ–­æ¶ˆæ¯ã€‚ <br><br> é€šè¿‡æ“ä½œç¬¦é‡è½½&lt;&lt;ï¼Œæ­¤å‡½æ•°å¯ä»¥ç”¨ä½œæ ‡å‡†C ++åº“çš„æ ‡å‡†è¾“å‡ºæµã€‚ å®ƒä»¥æ¶ˆæ¯çº§åˆ«ä½œä¸ºå‚æ•°ï¼šå§‹ç»ˆï¼Œè‡´å‘½ï¼Œè­¦å‘Šï¼Œé€šçŸ¥ï¼Œä¿¡æ¯ï¼ŒDEBUG_INFOå’ŒDEBUG_FPã€‚ ä¸¾ä¸ªä¾‹å­ <br><br><pre> <code class="cpp hljs">osg::notify(osg::WARN) &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Some warning message"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>;</code> </pre><br> æ˜¾ç¤ºå¸¦æœ‰ç”¨æˆ·å®šä¹‰æ–‡æœ¬çš„è­¦å‘Šã€‚ <br><br>  OSGé€šçŸ¥å¯ä»¥åŒ…å«æœ‰å…³ç¨‹åºçŠ¶æ€ï¼Œè®¡ç®—æœºå›¾å½¢å­ç³»ç»Ÿçš„æ‰©å±•ä»¥åŠå¼•æ“å¯èƒ½å‡ºç°çš„é—®é¢˜çš„é‡è¦ä¿¡æ¯ã€‚ <br><br> åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œéœ€è¦å°†æ­¤æ•°æ®è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œè€Œä¸æ˜¯å°†å…¶è¾“å‡ºåˆ°æ–‡ä»¶ï¼ˆä»¥æ—¥å¿—çš„å½¢å¼ï¼‰æˆ–ä»»ä½•å…¶ä»–ç•Œé¢ï¼ŒåŒ…æ‹¬å›¾å½¢å°éƒ¨ä»¶ï¼Œè€Œä¸æ˜¯è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚ è¯¥å¼•æ“åŒ…å«ä¸€ä¸ªç‰¹æ®Šçš„ç±»osg :: NotifyHandlerï¼Œè¯¥ç±»å°†é€šçŸ¥é‡å®šå‘åˆ°å¼€å‘äººå‘˜éœ€è¦çš„è¾“å‡ºæµã€‚ <br><br> é€šè¿‡ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œè€ƒè™‘å¦‚ä½•å°†é€šçŸ¥è¾“å‡ºé‡å®šå‘åˆ°æ–‡æœ¬æ—¥å¿—æ–‡ä»¶ã€‚ ç¼–å†™ä»¥ä¸‹ä»£ç  <br><br><div class="spoiler">  <b class="spoiler_title">é€šçŸ¥èŒƒä¾‹</b> <div class="spoiler_text">  <strong>ä¸»æ–‡ä»¶</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osgDB/ReadFile&gt; #include &lt;osgViewer/Viewer&gt; #include &lt;fstream&gt; #endif // MAIN_H</span></span></span></span></code> </pre><br>  <strong>main.cpp</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> class LogFileHandler : public osg::NotifyHandler { public: LogFileHandler(const std::string &amp;file) { _log.open(file.c_str()); } virtual ~LogFileHandler() { _log.close(); } virtual void notify(osg::NotifySeverity severity, const char *msg) { _log </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&lt; msg; } protected: std::ofstream _log; }; int main(int argc, char *argv[]) { osg::setNotifyLevel(osg::INFO); osg::setNotifyHandler(new LogFileHandler("../logs/log.txt")); osg::ArgumentParser args(&amp;argc, argv); osg::ref_ptr&lt;osg::Node&gt; root = osgDB::readNodeFiles(args); if (!root) { OSG_FATAL &lt;&lt; args.getApplicationName() &lt;&lt; ": No data loaded." &lt;&lt; std::endl; return -1; } osgViewer::Viewer viewer; viewer.setSceneData(root.get()); return viewer.run(); }</span></span></span></span></code> </pre><br></div></div><br> ä¸ºäº†é‡å®šå‘è¾“å‡ºï¼Œæˆ‘ä»¬ç¼–å†™LogFileHandlerç±»ï¼Œå®ƒæ˜¯osg :: NotifyHandlerçš„åç»§ã€‚ æ­¤ç±»çš„æ„é€ å‡½æ•°å’Œææ„å‡½æ•°æ§åˆ¶ä¸æ–‡æœ¬æ–‡ä»¶å…³è”çš„_logè¾“å‡ºæµçš„æ‰“å¼€å’Œå…³é—­ã€‚  notifyï¼ˆï¼‰æ–¹æ³•æ˜¯ç±»ä¼¼çš„åŸºç±»æ–¹æ³•ï¼Œæˆ‘ä»¬å°†å…¶é‡æ–°å®šä¹‰ä¸ºåœ¨æ“ä½œæœŸé—´é€šè¿‡msgå‚æ•°è¾“å‡ºåˆ°OSGå‘é€çš„æ–‡ä»¶é€šçŸ¥ã€‚ <br><br>  <strong>ç±»LogFileHandler</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LogFileHandler</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> osg::NotifyHandler { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: LogFileHandler(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> &amp;file) { _log.open(file.c_str()); } <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~LogFileHandler() { _log.close(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notify</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(osg::NotifySeverity severity, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *msg)</span></span></span><span class="hljs-function"> </span></span>{ _log &lt;&lt; msg; } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::ofstream _log; };</code> </pre><br> æ¥ä¸‹æ¥ï¼Œåœ¨ä¸»ç¨‹åºä¸­ï¼Œè¿›è¡Œå¿…è¦çš„è®¾ç½® <br><br><pre> <code class="cpp hljs">osg::setNotifyLevel(osg::INFO);</code> </pre><br> è®¾ç½®INFOé€šçŸ¥çš„çº§åˆ«ï¼Œå³å°†æœ‰å…³å¼•æ“è¿è¡Œçš„æ‰€æœ‰ä¿¡æ¯ï¼ˆåŒ…æ‹¬å½“å‰çš„æ­£å¸¸è¿è¡Œé€šçŸ¥ï¼‰è¾“å‡ºåˆ°æ—¥å¿—ã€‚ <br><br><pre> <code class="cpp hljs">osg::setNotifyHandler(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LogFileHandler(<span class="hljs-string"><span class="hljs-string">"../logs/log.txt"</span></span>));</code> </pre><br> å®‰è£…é€šçŸ¥å¤„ç†ç¨‹åºã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¤„ç†å‘½ä»¤è¡Œå‚æ•°ï¼Œåœ¨å…¶ä¸­ä¼ é€’åŠ è½½æ¨¡å‹çš„è·¯å¾„ <br><br><pre> <code class="cpp hljs">osg::<span class="hljs-function"><span class="hljs-function">ArgumentParser </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">args</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&amp;argc, argv)</span></span></span></span>; osg::ref_ptr&lt;osg::Node&gt; root = osgDB::readNodeFiles(args); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!root) { OSG_FATAL &lt;&lt; args.getApplicationName() &lt;&lt; <span class="hljs-string"><span class="hljs-string">": No data loaded."</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; }</code> </pre><br> åŒæ—¶ï¼Œæˆ‘ä»¬å¤„ç†å‘½ä»¤è¡Œä¸Šç¼ºå°‘æ•°æ®çš„æƒ…å†µï¼Œä½¿ç”¨OSG_FATALå®ä»¥æ‰‹åŠ¨æ¨¡å¼åœ¨æ—¥å¿—ä¸­æ˜¾ç¤ºä¸€æ¡æ¶ˆæ¯ã€‚ ä½¿ç”¨ä»¥ä¸‹å‚æ•°è¿è¡Œç¨‹åº <br><br><img src="https://habrastorage.org/webt/mc/h4/so/mch4sot5pfjjpq9vb2dlolnjllm.png"><br><br> è¾“å‡ºåˆ°è¿™æ ·çš„æ—¥å¿—æ–‡ä»¶ <br><br><div class="spoiler">  <b class="spoiler_title">OSGæ—¥å¿—ç¤ºä¾‹</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Opened DynamicLibrary osgPlugins-3.7.0/mingw_osgdb_osgd.dll CullSettings::readEnvironmentalVariables() CullSettings::readEnvironmentalVariables() Opened DynamicLibrary osgPlugins-3.7.0/mingw_osgdb_deprecated_osgd.dll OSGReaderWriter wrappers loaded OK CullSettings::readEnvironmentalVariables() void StateSet::setGlobalDefaults() void StateSet::setGlobalDefaults() ShaderPipeline disabled. StateSet::setGlobalDefaults() Setting up GL2 compatible shaders CullSettings::readEnvironmentalVariables() CullSettings::readEnvironmentalVariables() CullSettings::readEnvironmentalVariables() CullSettings::readEnvironmentalVariables() ShaderComposer::ShaderComposer() 0xa5ce8f0 CullSettings::readEnvironmentalVariables() ShaderComposer::ShaderComposer() 0xa5ce330 View::setSceneData() Reusing existing scene0xa514220 CameraManipulator::computeHomePosition(0, 0) boundingSphere.center() = (-6.40034 1.96225 0.000795364) boundingSphere.radius() = 16.6002 CameraManipulator::computeHomePosition(0xa52f138, 0) boundingSphere.center() = (-6.40034 1.96225 0.000795364) boundingSphere.radius() = 16.6002 Viewer::realize() - No valid contexts found, setting up view across all screens. Applying osgViewer::ViewConfig : AcrossAllScreens . . . . ShaderComposer::~ShaderComposer() 0xa5ce330 ShaderComposer::~ShaderComposer() 0xa5ce8f0 ShaderComposer::~ShaderComposer() 0xa5d6228 close(0x1)0xa5d3e50 close(0)0xa5d3e50 ContextData::unregisterGraphicsContext 0xa5d3e50 DatabasePager::RequestQueue::~RequestQueue() Destructing queue. DatabasePager::RequestQueue::~RequestQueue() Destructing queue. DatabasePager::RequestQueue::~RequestQueue() Destructing queue. DatabasePager::RequestQueue::~RequestQueue() Destructing queue. ShaderComposer::~ShaderComposer() 0xa5de4e0 close(0x1)0xa5ddba0 close(0)0xa5ddba0 ContextData::unregisterGraphicsContext 0xa5ddba0 Done destructing osg::View DatabasePager::RequestQueue::~RequestQueue() Destructing queue. DatabasePager::RequestQueue::~RequestQueue() Destructing queue. DatabasePager::RequestQueue::~RequestQueue() Destructing queue. DatabasePager::RequestQueue::~RequestQueue() Destructing queue. Closing DynamicLibrary osgPlugins-3.7.0/mingw_osgdb_osgd.dll Closing DynamicLibrary osgPlugins-3.7.0/mingw_osgdb_deprecated_osgd.dll</code> </pre><br></div></div><br> æ²¡å…³ç³»ï¼Œæ­¤ä¿¡æ¯å¯¹æ‚¨è€Œè¨€ä¼¼ä¹æ¯«æ— æ„ä¹‰-å°†æ¥ï¼Œè¿™æ ·çš„ç»“è®ºå¯ä»¥å¸®åŠ©è°ƒè¯•ç¨‹åºä¸­çš„é”™è¯¯ã€‚ <br><br> é»˜è®¤æƒ…å†µä¸‹ï¼ŒOSGå°†æ¶ˆæ¯å‘é€åˆ°std :: coutæ ‡å‡†è¾“å‡ºï¼Œå¹¶å°†é”™è¯¯æ¶ˆæ¯å‘é€åˆ°std :: cerræµã€‚ ä½†æ˜¯ï¼Œé€šè¿‡è¦†ç›–é€šçŸ¥å¤„ç†ç¨‹åºï¼ˆå¦‚ç¤ºä¾‹ä¸­æ‰€ç¤ºï¼‰ï¼Œå¯ä»¥å°†æ­¤è¾“å‡ºé‡å®šå‘åˆ°ä»»ä½•è¾“å‡ºæµï¼ŒåŒ…æ‹¬GUIå…ƒç´ ã€‚ <br><br> è¯·è®°ä½ï¼Œè®¾ç½®è¾ƒé«˜çº§åˆ«çš„é€šçŸ¥ï¼ˆä¾‹å¦‚FATALï¼‰æ—¶ï¼Œç³»ç»Ÿå°†å¿½ç•¥æ‰€æœ‰è¾ƒä½çº§åˆ«çš„é€šçŸ¥ã€‚ ä¾‹å¦‚ï¼Œåœ¨ç±»ä¼¼æƒ…å†µä¸‹ <br><br><pre> <code class="cpp hljs">osg::setNotifyLevel(osg::FATAL); . . . osg::notify(osg::WARN) &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Some message."</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>;</code> </pre><br> è‡ªå®šä¹‰æ¶ˆæ¯å°†ä¸ä¼šæ˜¾ç¤ºã€‚ <br><br><h1>  3.æ‹¦æˆªå‡ ä½•å±æ€§ </h1><br>  osg :: Geometryç±»ç®¡ç†ä¸€ç»„æè¿°é¡¶ç‚¹çš„æ•°æ®ï¼Œå¹¶ä½¿ç”¨ä¸€ç»„æœ‰åºçš„å›¾å…ƒæ˜¾ç¤ºå¤šè¾¹å½¢ç½‘æ ¼ã€‚ ä½†æ˜¯ï¼Œæ­¤ç±»ä¸äº†è§£æ¨¡å‹çš„æ‹“æ‰‘å…ƒç´ ï¼Œä¾‹å¦‚é¢ï¼Œè¾¹ä»¥åŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚ è¿™ç§ç»†å¾®å·®åˆ«å¯é˜²æ­¢è¯¸å¦‚åœ¨åˆ¶ä½œæ¨¡å‹åŠ¨ç”»æ—¶ç§»åŠ¨æŸäº›é¢å­”ä¹‹ç±»çš„äº‹æƒ…ã€‚  OSGå½“å‰ä¸æ”¯æŒæ­¤åŠŸèƒ½ã€‚ <br><br> ä½†æ˜¯ï¼Œå¼•æ“å®ç°äº†è®¸å¤šå‡½å­ï¼Œä½¿æ‚¨å¯ä»¥é‡æ–°è¯»å–ä»»ä½•å¯¹è±¡çš„å‡ ä½•å±æ€§ï¼Œå¹¶ä½¿ç”¨å®ƒä»¬å¯¹å¤šè¾¹å½¢ç½‘æ ¼çš„æ‹“æ‰‘è¿›è¡Œå»ºæ¨¡ã€‚ åœ¨C ++ä¸­ï¼Œå‡½å­æ˜¯ä¸€ç§å…è®¸æ‚¨å°†å¯¹è±¡ç”¨ä½œå‡½æ•°çš„æ„é€ ã€‚ <br><br>  osg :: Drawableç±»ä¸ºå¼€å‘äººå‘˜æä¾›äº†å››ç§ç±»å‹çš„å‡½å­ï¼š <br><br><ol><li>  osg :: Drawable :: AttributeFunctor-è¯»å–é¡¶ç‚¹çš„å±æ€§ä½œä¸ºæŒ‡é’ˆæ•°ç»„ã€‚ å®ƒå…·æœ‰è®¸å¤šç”¨äºåº”ç”¨ä¸åŒæ•°æ®ç±»å‹çš„é¡¶ç‚¹å±æ€§çš„è™šæ‹Ÿæ–¹æ³•ã€‚ è¦ä½¿ç”¨æ­¤å‡½å­ï¼Œæ‚¨å¿…é¡»æè¿°è¯¥ç±»å¹¶è¦†ç›–å…¶ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­å°†æ‰§è¡Œå¼€å‘äººå‘˜æ‰€éœ€çš„æ“ä½œ <br></li></ol><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( osg::Drawable::AttributeType type, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size, osg::Vec3* ptr )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  3-     ptr. //      }</span></span></code> </pre><br><ol><li>  osg :: Drawable :: ConstAttributeFunctor-å…ˆå‰å‡½å­çš„åªè¯»ç‰ˆæœ¬ï¼šæŒ‡å‘å‘é‡æ•°ç»„çš„æŒ‡é’ˆä½œä¸ºå¸¸é‡å‚æ•°ä¼ é€’ <br></li><li>  osg :: PrimitiveFunctor-æ¨¡ä»¿æ¸²æŸ“OpenGLå¯¹è±¡çš„è¿‡ç¨‹ã€‚ ä»¥æ¸²æŸ“å¯¹è±¡ä¸ºå¹Œå­ï¼Œè°ƒç”¨äº†å¼€å‘äººå‘˜é‡å†™çš„å‡½å­æ–¹æ³•ã€‚ è¯¥ä»¿å‡½æ•°å…·æœ‰ä¸¤ä¸ªé‡è¦çš„æ¨¡æ¿å­ç±»ï¼šosg :: TemplatePrimitiveFunctor &lt;&gt;å’Œosg :: TriangleFunctor &lt;&gt;ã€‚ è¿™äº›ç±»æ¥æ”¶åŸå§‹é¡¶ç‚¹ä½œä¸ºå‚æ•°ï¼Œå¹¶ä½¿ç”¨operatorï¼ˆï¼‰è¿ç®—ç¬¦å°†å®ƒä»¬ä¼ é€’ç»™ç”¨æˆ·æ–¹æ³•ã€‚ <br></li><li>  osg :: PrimitiveIndexFunctor-æ‰§è¡Œä¸ä¸Šä¸€ä¸ªå‡½å­ç›¸åŒçš„æ“ä½œï¼Œä½†æ¥å—å›¾å…ƒçš„é¡¶ç‚¹ç´¢å¼•ä½œä¸ºå‚æ•°ã€‚ <br></li></ol><br> ä»osg :: Drawableæ´¾ç”Ÿçš„ç±»ï¼ˆä¾‹å¦‚osg :: ShapeDrawableå’Œosg :: Geometryï¼‰å…·æœ‰ç”¨äºåº”ç”¨å„ç§å‡½å­çš„acceptï¼ˆï¼‰æ–¹æ³•ã€‚ <br><br><h1>  4.ä½¿ç”¨åŸå§‹å‡½å­çš„ç¤ºä¾‹ </h1><br> æˆ‘ä»¬ä»¥æ”¶é›†å…³äºä¸‰è§’å½¢é¢å’Œæˆ‘ä»¬å…ˆå‰ç¡®å®šçš„æŸäº›å‡ ä½•å½¢çŠ¶çš„ç‚¹çš„ä¿¡æ¯ä¸ºä¾‹æ¥è¯´æ˜æ‰€æè¿°çš„åŠŸèƒ½ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å‡½å­ç¤ºä¾‹</b> <div class="spoiler_text">  <strong>ä¸»æ–‡ä»¶</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osg/Geode&gt; #include &lt;osg/Geometry&gt; #include &lt;osg/TriangleFunctor&gt; #include &lt;osgViewer/Viewer&gt; #include &lt;iostream&gt; #endif</span></span></span></span></code> </pre><br>  <strong>main.cpp</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> std::string vec2str(const osg::Vec3 &amp;v) { std::string tmp = std::to_string(vx()); tmp += </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">; tmp += std::to_string(vy()); tmp += </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" "</span></span></span><span class="hljs-meta">; tmp += std::to_string(vz()); return tmp; } struct FaceCollector { void operator()(const osg::Vec3 &amp;v1, const osg::Vec3 &amp;v2, const osg::Vec3 &amp;v3) { std::cout </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&lt; "Face vertices: " &lt;&lt; vec2str(v1) &lt;&lt; "; " &lt;&lt; vec2str(v2) &lt;&lt; "; " &lt;&lt; vec2str(v3) &lt;&lt; std::endl; } }; int main(int argc, char *argv[]) { (void) argc; (void) argv; osg::ref_ptr&lt;osg::Vec3Array&gt; vertices = new osg::Vec3Array; vertices-&gt;push_back( osg::Vec3(0.0f, 0.0f, 0.0f) ); vertices-&gt;push_back( osg::Vec3(0.0f, 0.0f, 1.0f) ); vertices-&gt;push_back( osg::Vec3(1.0f, 0.0f, 0.0f) ); vertices-&gt;push_back( osg::Vec3(1.0f, 0.0f, 1.5f) ); vertices-&gt;push_back( osg::Vec3(2.0f, 0.0f, 0.0f) ); vertices-&gt;push_back( osg::Vec3(2.0f, 0.0f, 1.0f) ); vertices-&gt;push_back( osg::Vec3(3.0f, 0.0f, 0.0f) ); vertices-&gt;push_back( osg::Vec3(3.0f, 0.0f, 1.5f) ); vertices-&gt;push_back( osg::Vec3(4.0f, 0.0f, 0.0f) ); vertices-&gt;push_back( osg::Vec3(4.0f, 0.0f, 1.0f) ); osg::ref_ptr&lt;osg::Vec3Array&gt; normals = new osg::Vec3Array; normals-&gt;push_back( osg::Vec3(0.0f, -1.0f, 0.0f) ); osg::ref_ptr&lt;osg::Geometry&gt; geom = new osg::Geometry; geom-&gt;setVertexArray(vertices.get()); geom-&gt;setNormalArray(normals.get()); geom-&gt;setNormalBinding(osg::Geometry::BIND_OVERALL); geom-&gt;addPrimitiveSet(new osg::DrawArrays(GL_QUAD_STRIP, 0, 10)); osg::ref_ptr&lt;osg::Geode&gt; root = new osg::Geode; root-&gt;addDrawable(geom.get()); osgViewer::Viewer viewer; viewer.setSceneData(root.get()); osg::TriangleFunctor&lt;FaceCollector&gt; functor; geom-&gt;accept(functor); return viewer.run(); }</span></span></span></span></code> </pre><br></div></div><br> çœç•¥äº†æˆ‘ä»¬å¤šæ¬¡è€ƒè™‘çš„åˆ›å»ºå‡ ä½•çš„è¿‡ç¨‹ï¼Œè®©æˆ‘ä»¬æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ã€‚ æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªFaceCollectorç»“æ„ï¼Œä¸ºæ­¤æˆ‘ä»¬é‡æ–°å®šä¹‰operatorï¼ˆï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤º <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FaceCollector</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> osg::Vec3 &amp;v1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> osg::Vec3 &amp;v2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> osg::Vec3 &amp;v3)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Face vertices: "</span></span> &lt;&lt; vec2str(v1) &lt;&lt; <span class="hljs-string"><span class="hljs-string">"; "</span></span> &lt;&lt; vec2str(v2) &lt;&lt; <span class="hljs-string"><span class="hljs-string">"; "</span></span> &lt;&lt; vec2str(v3) &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } };</code> </pre><br> è°ƒç”¨æ­¤è¿ç®—ç¬¦æ—¶ï¼Œå®ƒå°†æ˜¾ç¤ºå¼•æ“ä¼ è¾“ç»™å®ƒçš„ä¸‰ä¸ªé¡¶ç‚¹çš„åæ ‡ã€‚ éœ€è¦ä½¿ç”¨vec2strå‡½æ•°å°†osg :: Vec3å‘é‡çš„ç»„ä»¶è½¬æ¢ä¸ºstd :: stringã€‚ è¦è°ƒç”¨å‡½å­ï¼Œè¯·åˆ›å»ºå‡½å­çš„å®ä¾‹ï¼Œç„¶åé€šè¿‡acceptï¼ˆï¼‰æ–¹æ³•å°†å…¶ä¼ é€’ç»™å‡ ä½•å¯¹è±¡ <br><br><pre> <code class="cpp hljs">osg::TriangleFunctor&lt;FaceCollector&gt; functor; geom-&gt;accept(functor);</code> </pre><br> å¦‚ä¸Šæ‰€è¿°ï¼Œæ­¤è°ƒç”¨æ¨¡ä»¿äº†å‡ ä½•å›¾å½¢çš„æ¸²æŸ“ï¼Œé€šè¿‡è°ƒç”¨é‡å†™çš„ä»¿å‡½æ•°æ–¹æ³•æ¥æ›¿æ¢å›¾å½¢æœ¬èº«ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†åœ¨æ„æˆç¤ºä¾‹å‡ ä½•å›¾å½¢çš„æ¯ä¸ªä¸‰è§’å½¢çš„â€œç»˜åˆ¶â€æœŸé—´è°ƒç”¨å®ƒã€‚ <br><br> åœ¨å±å¹•ä¸Šï¼Œæˆ‘ä»¬å¾—åˆ°äº†è¿™æ ·çš„å‡ ä½• <br><br><img src="https://habrastorage.org/webt/ai/-a/6v/ai-a6vj4eeubetgk0bpicmjbgfm.png"><br><br> å’Œè¿™æ ·çš„ç´¯èµ˜æ§åˆ¶å° <br><br><pre> <code class="plaintext hljs">Face vertices: 0.000000 0.000000 0.000000; 0.000000 0.000000 1.000000; 1.000000 0.000000 0.000000 Face vertices: 0.000000 0.000000 1.000000; 1.000000 0.000000 1.500000; 1.000000 0.000000 0.000000 Face vertices: 1.000000 0.000000 0.000000; 1.000000 0.000000 1.500000; 2.000000 0.000000 0.000000 Face vertices: 1.000000 0.000000 1.500000; 2.000000 0.000000 1.000000; 2.000000 0.000000 0.000000 Face vertices: 2.000000 0.000000 0.000000; 2.000000 0.000000 1.000000; 3.000000 0.000000 0.000000 Face vertices: 2.000000 0.000000 1.000000; 3.000000 0.000000 1.500000; 3.000000 0.000000 0.000000 Face vertices: 3.000000 0.000000 0.000000; 3.000000 0.000000 1.500000; 4.000000 0.000000 0.000000 Face vertices: 3.000000 0.000000 1.500000; 4.000000 0.000000 1.000000; 4.000000 0.000000 0.000000</code> </pre><br> å®é™…ä¸Šï¼Œå½“è°ƒç”¨geom-&gt; acceptï¼ˆ...ï¼‰æ—¶ï¼Œä¸ä¼šæ¸²æŸ“ä¸‰è§’å½¢ï¼Œè€Œæ˜¯æ¨¡æ‹ŸOpenGLè°ƒç”¨ï¼Œè€Œä¸æ˜¯æ¨¡æ‹Ÿä¸‰è§’å½¢çš„é¡¶ç‚¹æ•°æ®ï¼Œè€Œæ˜¯æ¨¡æ‹Ÿå®ƒä»¬çš„æ¸²æŸ“ <br><br><img src="https://habrastorage.org/webt/gx/gp/il/gxgpilewn7pw26w9tdy-e28ypds.png"><br><br>  osg :: TemplatePrimitiveFunctorç±»ä¸ä»…æ”¶é›†æœ‰å…³ä¸‰è§’å½¢çš„æ•°æ®ï¼Œè€Œä¸”è¿˜æ”¶é›†ä»»ä½•å…¶ä»–OpenGLåŸè¯­çš„æ•°æ®ã€‚ è¦å®ç°æ­¤æ•°æ®çš„å¤„ç†ï¼Œå¿…é¡»åœ¨templateå‚æ•°ä¸­è¦†ç›–ä»¥ä¸‹è¿ç®—ç¬¦ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   void operator()( const osg::Vec3&amp;, bool ); //   void operator()( const osg::Vec3&amp;, const osg::Vec3&amp;, bool ); //   void operator()( const osg::Vec3&amp;, const osg::Vec3&amp;, const osg::Vec3&amp;, bool ); //   void operator()( const osg::Vec3&amp;, const osg::Vec3&amp;, const osg::Vec3&amp;, const osg::Vec3&amp;, bool );</span></span></code> </pre><br><br><h1>  5.è®¿å®¢æ¨¡å¼ </h1><br> è®¿é—®è€…æ¨¡å¼ç”¨äºè®¿é—®æ“ä½œä»¥æ›´æ”¹åœºæ™¯å›¾çš„å…ƒç´ ï¼Œè€Œæ— éœ€æ›´æ”¹è¿™äº›å…ƒç´ çš„ç±»ã€‚ è®¿å®¢ç±»å®ç°æ‰€æœ‰ç›¸å…³çš„è™šæ‹ŸåŠŸèƒ½ï¼Œä»¥é€šè¿‡åŒé‡è°ƒåº¦æœºåˆ¶å°†å…¶åº”ç”¨äºå„ç§ç±»å‹çš„å…ƒç´ ã€‚ ä½¿ç”¨è¿™ç§æœºåˆ¶ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡åœ¨ç‰¹æ®Šæ“ä½œå‘˜çš„å¸®åŠ©ä¸‹å®ç°æ‰€éœ€çš„åŠŸèƒ½æ¥åˆ›å»ºè‡ªå·±çš„è®¿é—®è€…å®ä¾‹ï¼Œå¹¶å°†è®¿é—®è€…åŠ¨æ€ç»‘å®šåˆ°å„ç§ç±»å‹çš„åœºæ™¯å›¾å…ƒç´ ï¼Œè€Œæ— éœ€æ›´æ”¹å…ƒç´ æœ¬èº«çš„åŠŸèƒ½ã€‚ è¿™æ˜¯æ‰©å±•å…ƒç´ åŠŸèƒ½è€Œä¸å®šä¹‰è¿™äº›å…ƒç´ çš„å­ç±»çš„å¥½æ–¹æ³•ã€‚ <br><br> ä¸ºäº†åœ¨OSGä¸­å®ç°æ­¤æœºåˆ¶ï¼Œå®šä¹‰äº†osg :: NodeVisitorç±»ã€‚ ä»osg :: NodeVisitorç»§æ‰¿çš„ç±»åœ¨åœºæ™¯å›¾å‘¨å›´ç§»åŠ¨ï¼Œè®¿é—®æ¯ä¸ªèŠ‚ç‚¹ï¼Œå¹¶å°†å¼€å‘äººå‘˜å®šä¹‰çš„æ“ä½œåº”ç”¨äºè¯¥èŠ‚ç‚¹ã€‚ è¿™æ˜¯ç”¨äºå¹²é¢„èŠ‚ç‚¹æ›´æ–°å’Œè£å‰ªä¸å¯è§èŠ‚ç‚¹ä»¥åŠåº”ç”¨ä¸ä¿®æ”¹åœºæ™¯èŠ‚ç‚¹çš„å‡ ä½•å½¢çŠ¶æœ‰å…³çš„å…¶ä»–ä¸€äº›æ“ä½œçš„ä¸»è¦ç±»ï¼Œä¾‹å¦‚osgUtil :: SmoothingVisitorï¼ŒosgUtil :: Simplifierå’ŒosgUtil :: TriStripVisitorã€‚ <br><br> è¦å¯¹è®¿é—®è€…è¿›è¡Œå­ç±»åŒ–ï¼Œæˆ‘ä»¬å¿…é¡»é‡å†™osg :: NodeVisitoråŸºç±»æä¾›çš„ä¸€ä¸ªæˆ–å¤šä¸ªè™šæ‹Ÿé‡è½½çš„applyï¼ˆï¼‰æ–¹æ³•ã€‚ å¤§å¤šæ•°ä¸»è¦çš„OSGèŠ‚ç‚¹ç±»å‹éƒ½å…·æœ‰è¿™äº›æ–¹æ³•ã€‚ å½“éå†åœºæ™¯å›¾æ—¶ï¼Œè®¿é—®è€…å°†è‡ªåŠ¨ä¸ºæ¯ä¸ªè®¿é—®çš„èŠ‚ç‚¹è°ƒç”¨applyï¼ˆï¼‰æ–¹æ³•ã€‚ å¼€å‘äººå‘˜å°†è¦†ç›–ä»–éœ€è¦çš„æ¯ç§èŠ‚ç‚¹ç±»å‹çš„applyï¼ˆï¼‰æ–¹æ³•ã€‚ <br><br> åœ¨æ‰§è¡Œapplyï¼ˆï¼‰æ–¹æ³•æ—¶ï¼Œå¼€å‘äººå‘˜å¿…é¡»åœ¨é€‚å½“çš„æ—¶å€™è°ƒç”¨osg :: NodeVisitoråŸºç±»çš„traverseï¼ˆï¼‰æ–¹æ³•ã€‚ å¦‚æœå½“å‰èŠ‚ç‚¹æ²¡æœ‰å¯ä»¥è¿›è¡Œè½¬æ¢çš„å­èŠ‚ç‚¹ï¼Œåˆ™è¿™å°†å¯åŠ¨è®¿é—®è€…åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„è¿‡æ¸¡ï¼Œè¯¥èŠ‚ç‚¹æ˜¯å±‚æ¬¡ç»“æ„çº§åˆ«çš„å­èŠ‚ç‚¹æˆ–é‚»å±…èŠ‚ç‚¹ã€‚ ç¼ºå°‘å¯¹éå†ï¼ˆï¼‰çš„è°ƒç”¨æ„å‘³ç€åœæ­¢éå†åœºæ™¯å›¾ï¼Œå…¶ä½™åœºæ™¯å›¾å°†è¢«å¿½ç•¥ã€‚ <br><br>  applyï¼ˆï¼‰æ–¹æ³•çš„é‡è½½å…·æœ‰ç»Ÿä¸€çš„æ ¼å¼ <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( osg::Node&amp; )</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( osg::Geode&amp; )</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( osg::Group&amp; )</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( osg::Transform&amp; )</span></span></span></span>;</code> </pre><br> è¦ç»•è¿‡è®¿é—®è€…å¯¹è±¡çš„å½“å‰èŠ‚ç‚¹çš„å­å›¾ï¼Œå¿…é¡»è®¾ç½®çˆ¬ç½‘æ¨¡å¼ï¼Œä¾‹å¦‚ï¼Œ <br><br><pre> <code class="cpp hljs">ExampleVisitor visitor; visitor-&gt;setTraversalMode( osg::NodeVisitor::TRAVERSE_ALL_CHILDREN ); node-&gt;accept( visitor );</code> </pre><br> æ—è·¯æ¨¡å¼ç”±å¤šä¸ªæšä¸¾å™¨è®¾ç½® <br><br><ol><li>  TRAVERSE_ALL_CHILDREN-åœ¨æ‰€æœ‰å­èŠ‚ç‚¹ä¹‹é—´ç§»åŠ¨ã€‚ <br></li><li>  TRAVERSE_PARENTS-ä»å½“å‰èŠ‚ç‚¹ä¼ å›ï¼Œè€Œä¸åˆ°è¾¾æ ¹èŠ‚ç‚¹ <br></li><li>  TRAVERSE_ACTIVE_CHILDREN-ç»•è¿‡ä¸“ç”¨æ´»åŠ¨èŠ‚ç‚¹ï¼Œå³é‚£äº›é€šè¿‡osg :: SwitchèŠ‚ç‚¹æ¿€æ´»å¯è§æ€§çš„èŠ‚ç‚¹ã€‚ <br></li></ol><br><br><h1>  6.ç‡ƒçƒ§èˆ±çš„ç»“æ„åˆ†æ </h1><br> å¼€å‘äººå‘˜å§‹ç»ˆå¯ä»¥åˆ†æç”±ä»æ–‡ä»¶åŠ è½½çš„æ¨¡å‹ç”Ÿæˆçš„åœºæ™¯å›¾çš„é‚£éƒ¨åˆ†ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å‡½å­ç¤ºä¾‹</b> <div class="spoiler_text">  <strong>ä¸»æ–‡ä»¶</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osgDB/ReadFile&gt; #include &lt;osgViewer/Viewer&gt; #include &lt;iostream&gt; #endif</span></span></span></span></code> </pre><br>  <strong>main.cpp</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ class InfoVisitor : public osg::NodeVisitor { public: InfoVisitor() : _level(0) { setTraversalMode(osg::NodeVisitor::TRAVERSE_ALL_CHILDREN); } std::string spaces() { return std::string(_level * 2, ' '); } virtual void apply(osg::Node &amp;node); virtual void apply(osg::Geode &amp;geode); protected: unsigned int _level; }; //------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ void InfoVisitor::apply(osg::Node &amp;node) { std::cout &lt;&lt; spaces() &lt;&lt; node.libraryName() &lt;&lt; "::" &lt;&lt; node.className() &lt;&lt; std::endl; _level++; traverse(node); _level--; } //------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ void InfoVisitor::apply(osg::Geode &amp;geode) { std::cout &lt;&lt; spaces() &lt;&lt; geode.libraryName() &lt;&lt; "::" &lt;&lt; geode.className() &lt;&lt; std::endl; _level++; for (unsigned int i = 0; i &lt; geode.getNumDrawables(); ++i) { osg::Drawable *drawable = geode.getDrawable(i); std::cout &lt;&lt; spaces() &lt;&lt; drawable-&gt;libraryName() &lt;&lt; "::" &lt;&lt; drawable-&gt;className() &lt;&lt; std::endl; } traverse(geode); _level--; } //------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ int main(int argc, char *argv[]) { osg::ArgumentParser args(&amp;argc, argv); osg::ref_ptr&lt;osg::Node&gt; root = osgDB::readNodeFiles(args); if (!root.valid()) { OSG_FATAL &lt;&lt; args.getApplicationName() &lt;&lt; ": No data leaded. " &lt;&lt; std::endl; return -1; } InfoVisitor infoVisitor; root-&gt;accept(infoVisitor); osgViewer::Viewer viewer; viewer.setSceneData(root.get()); return viewer.run(); }</span></span></span></span></code> </pre><br></div></div><br> æˆ‘ä»¬åˆ›å»ºInfoVisitorç±»ï¼Œå¹¶ä»osg :: NodeVisitorç»§æ‰¿å®ƒ <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InfoVisitor</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> osg::NodeVisitor { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: InfoVisitor() : _level(<span class="hljs-number"><span class="hljs-number">0</span></span>) { setTraversalMode(osg::NodeVisitor::TRAVERSE_ALL_CHILDREN); } <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">spaces</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(_level * <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(osg::Node &amp;node)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(osg::Geode &amp;geode)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _level; };</code> </pre><br>  protected _levelå±æ€§å°†æŒ‡å‘æˆ‘ä»¬çš„è®¿é—®è€…ç±»å½“å‰æ‰€åœ¨çš„åœºæ™¯å›¾çš„çº§åˆ«ã€‚ åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œåˆå§‹åŒ–çº§åˆ«è®¡æ•°å™¨å¹¶è®¾ç½®èŠ‚ç‚¹éå†çš„æ¨¡å¼-ç»•è¿‡æ‰€æœ‰å­èŠ‚ç‚¹ã€‚ <br><br> ç°åœ¨é‡æ–°å®šä¹‰èŠ‚ç‚¹çš„applyï¼ˆï¼‰æ–¹æ³• <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> InfoVisitor::apply(osg::Node &amp;node) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; spaces() &lt;&lt; node.libraryName() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"::"</span></span> &lt;&lt; node.className() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; _level++; traverse(node); _level--; }</code> </pre><br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†è¾“å‡ºå½“å‰èŠ‚ç‚¹çš„ç±»å‹ã€‚ èŠ‚ç‚¹çš„libraryNameï¼ˆï¼‰æ–¹æ³•æ˜¾ç¤ºå®ç°è¯¥èŠ‚ç‚¹çš„OSGåº“çš„åç§°ï¼Œè€ŒclassNameæ–¹æ³•æ˜¾ç¤ºèŠ‚ç‚¹ç±»çš„åç§°ã€‚ è¿™äº›æ–¹æ³•æ˜¯é€šè¿‡ä½¿ç”¨OSGåº“ä»£ç ä¸­çš„å®æ¥å®ç°çš„ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; spaces() &lt;&lt; node.libraryName() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"::"</span></span> &lt;&lt; node.className() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>;</code> </pre><br> ä¹‹åï¼Œæˆ‘ä»¬å¢åŠ å›¾çº§åˆ«è®¡æ•°å™¨ï¼Œå¹¶è°ƒç”¨traverseï¼ˆï¼‰æ–¹æ³•ï¼Œä»¥å¼€å§‹å‘å­èŠ‚ç‚¹çš„æ›´é«˜çº§åˆ«çš„è¿‡æ¸¡ã€‚ ä»éå†ï¼ˆï¼‰è¿”å›ä¹‹åï¼Œæˆ‘ä»¬å†æ¬¡å‡å°è®¡æ•°å™¨å€¼ã€‚ å¾ˆå®¹æ˜“çŒœåˆ°traverseï¼ˆï¼‰å¼•å‘äº†å¯¹applyï¼ˆï¼‰æ–¹æ³•çš„é‡å¤è°ƒç”¨ï¼Œå¯¹äºä»å½“å‰èŠ‚ç‚¹å¼€å§‹çš„å­å›¾ï¼Œå·²ç»é‡å¤äº†traverseï¼ˆï¼‰ã€‚ æˆ‘ä»¬å¾—åˆ°é€’å½’çš„è®¿é—®è€…æ‰§è¡Œï¼Œç›´åˆ°å‘½ä¸­åœºæ™¯å›¾çš„æœ«ç«¯èŠ‚ç‚¹ã€‚ <br><br> å¯¹äºç±»å‹ä¸ºosg :: Geodeçš„ç»ˆç«¯èŠ‚ç‚¹ï¼Œå…¶applyï¼ˆï¼‰æ–¹æ³•çš„é‡è½½å°†è¢«è¦†ç›– <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> InfoVisitor::apply(osg::Geode &amp;geode) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; spaces() &lt;&lt; geode.libraryName() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"::"</span></span> &lt;&lt; geode.className() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; _level++; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; geode.getNumDrawables(); ++i) { osg::Drawable *drawable = geode.getDrawable(i); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; spaces() &lt;&lt; drawable-&gt;libraryName() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"::"</span></span> &lt;&lt; drawable-&gt;className() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } traverse(geode); _level--; }</code> </pre><br> ä½¿ç”¨ç±»ä¼¼çš„å·¥ä½œä»£ç ï¼Œé™¤äº†æˆ‘ä»¬åœ¨è¿æ¥åˆ°å½“å‰å‡ ä½•èŠ‚ç‚¹çš„æ‰€æœ‰å‡ ä½•å¯¹è±¡ä¸Šæ˜¾ç¤ºæ•°æ® <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; geode.getNumDrawables(); ++i) { osg::Drawable *drawable = geode.getDrawable(i); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; spaces() &lt;&lt; drawable-&gt;libraryName() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"::"</span></span> &lt;&lt; drawable-&gt;className() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; }</code> </pre><br> åœ¨mainï¼ˆï¼‰å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¤„ç†å‘½ä»¤è¡Œå‚æ•°ï¼Œé€šè¿‡è¯¥å‚æ•°æˆ‘ä»¬ä¼ é€’åŠ è½½åˆ°åœºæ™¯ä¸­çš„æ¨¡å‹åˆ—è¡¨å¹¶å½¢æˆåœºæ™¯ <br><br><pre> <code class="cpp hljs">osg::<span class="hljs-function"><span class="hljs-function">ArgumentParser </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">args</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&amp;argc, argv)</span></span></span></span>; osg::ref_ptr&lt;osg::Node&gt; root = osgDB::readNodeFiles(args); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!root.valid()) { OSG_FATAL &lt;&lt; args.getApplicationName() &lt;&lt; <span class="hljs-string"><span class="hljs-string">": No data leaded. "</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; }</code> </pre><br> åŒæ—¶ï¼Œæˆ‘ä»¬å¤„ç†ä¸å‘½ä»¤è¡Œä¸­ç¼ºå°‘æ¨¡å‹æ–‡ä»¶åæœ‰å…³çš„é”™è¯¯ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè®¿é—®è€…ç±»ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™åœºæ™¯å›¾ä»¥æ‰§è¡Œ <br><br><pre> <code class="cpp hljs">InfoVisitor infoVisitor; root-&gt;accept(infoVisitor);</code> </pre><br> æ¥ä¸‹æ¥æ˜¯å¯åŠ¨æŸ¥çœ‹å™¨çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†å¾ˆå¤šæ¬¡ã€‚ ç”¨å‚æ•°å¯åŠ¨ç¨‹åºä¹‹å <br><br><pre> <code class="bash hljs">$ visitor ../data/cessnafire.osg</code> </pre><br> æˆ‘ä»¬å°†åœ¨æ§åˆ¶å°çœ‹åˆ°ä»¥ä¸‹è¾“å‡º <br><br><pre> <code class="plaintext hljs">osg::Group osg::MatrixTransform osg::Geode osg::Geometry osg::Geometry osg::MatrixTransform osgParticle::ModularEmitter osgParticle::ModularEmitter osgParticle::ParticleSystemUpdater osg::Geode osgParticle::ParticleSystem osgParticle::ParticleSystem osgParticle::ParticleSystem osgParticle::ParticleSystem</code> </pre><br> å®é™…ä¸Šï¼Œæˆ‘ä»¬å¾—åˆ°äº†åŠ è½½åœºæ™¯çš„å®Œæ•´æ ‘ã€‚ è¯·é—®ï¼Œå“ªé‡Œæœ‰é‚£ä¹ˆå¤šèŠ‚ç‚¹ï¼Ÿ ä¸€åˆ‡éƒ½éå¸¸ç®€å•-.osgæ ¼å¼çš„æ¨¡å‹æœ¬èº«æ˜¯å®¹å™¨ï¼Œè¯¥å®¹å™¨ä¸ä»…å­˜å‚¨æœ‰å…³æ¨¡å‹å‡ ä½•æ•°æ®çš„æ•°æ®ï¼Œè€Œä¸”è¿˜ä»¥OSGåœºæ™¯çš„å­å›¾å½¢å¼å­˜å‚¨æœ‰å…³å…¶ç»“æ„çš„å…¶ä»–ä¿¡æ¯ã€‚ æ¨¡å‹çš„å‡ ä½•å½¢çŠ¶ï¼Œè½¬æ¢ï¼Œå®ç°çƒŸé›¾å’Œç«ç„°çš„ç²’å­æ•ˆæœéƒ½æ˜¯OSGåœºæ™¯å›¾çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»»ä½•åœºæ™¯éƒ½å¯ä»¥ä»* .osgä¸‹è½½æˆ–ä»æŸ¥çœ‹å™¨ä¸­å¸è½½ä¸º* .osgæ ¼å¼ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ˜¯åº”ç”¨è®¿å®¢æœºåˆ¶çš„ç®€å•ç¤ºä¾‹ã€‚</font><font style="vertical-align: inherit;">å®é™…ä¸Šï¼Œåœ¨å†…éƒ¨è®¿é—®è€…ä¸­ï¼Œæ‚¨å¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶æ‰§è¡Œå¾ˆå¤šæ“ä½œæ¥ä¿®æ”¹èŠ‚ç‚¹ã€‚</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7.é€šè¿‡é‡å†™traverseï¼ˆï¼‰æ–¹æ³•æ¥æ§åˆ¶åœºæ™¯å›¾ä¸­èŠ‚ç‚¹çš„è¡Œä¸º </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨OSGçš„ä¸€ç§é‡è¦æ–¹æ³•æ˜¯é‡å†™traverseï¼ˆï¼‰æ–¹æ³•ã€‚æ¯æ¬¡ç»˜åˆ¶æ¡†æ¶æ—¶éƒ½ä¼šè°ƒç”¨æ­¤æ–¹æ³•ã€‚å®ƒä»¬æ¥å—ç±»å‹ä¸ºosg :: NodeVisitorï¼†çš„å‚æ•°ï¼Œè¯¥å‚æ•°æŠ¥å‘Šå½“å‰æ­£åœ¨æ‰§è¡Œåœºæ™¯å›¾çš„å“ªä¸ªé€šé“ï¼ˆæ›´æ–°ï¼Œäº‹ä»¶å¤„ç†æˆ–å‰ªè¾‘ï¼‰ã€‚å¤§å¤šæ•°OSGä¸»æœºéƒ½é‡å†™æ­¤æ–¹æ³•æ¥å®ç°å…¶åŠŸèƒ½ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åº”å½“è®°ä½ï¼Œé‡å†™traverseï¼ˆï¼‰æ–¹æ³•å¯èƒ½å¾ˆå±é™©ï¼Œå› ä¸ºå®ƒä¼šå½±å“éå†åœºæ™¯å›¾çš„è¿‡ç¨‹ï¼Œå¹¶å¯èƒ½å¯¼è‡´åœºæ™¯çš„é”™è¯¯æ˜¾ç¤ºã€‚å¦‚æœè¦å‘å‡ ç§ç±»å‹çš„èŠ‚ç‚¹æ·»åŠ æ–°åŠŸèƒ½ï¼Œä¹Ÿå¾ˆä¸æ–¹ä¾¿ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†ä½¿ç”¨èŠ‚ç‚¹å›è°ƒï¼Œæœ‰å…³å…¶çš„å¯¹è¯å°†é™ä½ä¸€äº›ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å·²ç»çŸ¥é“osg :: SwitchèŠ‚ç‚¹å¯ä»¥æ§åˆ¶å…¶å­èŠ‚ç‚¹çš„æ˜¾ç¤ºï¼ŒåŒ…æ‹¬æŸäº›èŠ‚ç‚¹çš„æ˜¾ç¤ºå’Œå…³é—­å…¶ä»–èŠ‚ç‚¹çš„æ˜¾ç¤ºã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ä»–ä¸çŸ¥é“å¦‚ä½•è‡ªåŠ¨æ‰§è¡Œæ­¤æ“ä½œï¼Œå› æ­¤æˆ‘ä»¬å°†åŸºäºæ—§èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹å°†æ ¹æ®å†…éƒ¨è®¡æ•°å™¨çš„å€¼åœ¨ä¸åŒæ—¶é—´ç‚¹åœ¨å­èŠ‚ç‚¹ä¹‹é—´åˆ‡æ¢ã€‚</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Animswitchç¤ºä¾‹</font></font></b> <div class="spoiler_text">  <strong>ä¸»æ–‡ä»¶</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osg/Switch&gt; #include &lt;osgDB/ReadFile&gt; #include &lt;osgViewer/Viewer&gt; #endif</span></span></span></span></code> </pre><br>  <strong>main.cpp</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ class AnimatingSwitch : public osg::Switch { public: AnimatingSwitch() : osg::Switch(), _count(0) {} AnimatingSwitch(const AnimatingSwitch &amp;copy, const osg::CopyOp &amp;copyop = osg::CopyOp::SHALLOW_COPY) : osg::Switch(copy, copyop), _count(copy._count) {} META_Node(osg, AnimatingSwitch); virtual void traverse(osg::NodeVisitor &amp;nv); protected: unsigned int _count; }; void AnimatingSwitch::traverse(osg::NodeVisitor &amp;nv) { if (!((++_count) % 60) ) { setValue(0, !getValue(0)); setValue(1, !getValue(1)); } osg::Switch::traverse(nv); } //------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ int main(int argc, char *argv[]) { (void) argc; (void) argv; osg::ref_ptr&lt;osg::Node&gt; model1 = osgDB::readNodeFile("../data/cessna.osg"); osg::ref_ptr&lt;osg::Node&gt; model2 = osgDB::readNodeFile("../data/cessnafire.osg"); osg::ref_ptr&lt;AnimatingSwitch&gt; root = new AnimatingSwitch; root-&gt;addChild(model1.get(), true); root-&gt;addChild(model2.get(), false); osgViewer::Viewer viewer; viewer.setSceneData(root.get()); return viewer.run(); }</span></span></span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªä¾‹å­ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬æ­£åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„AnimatingSwitchç±»ï¼Œè¯¥ç±»ç»§æ‰¿è‡ªosg :: Switchã€‚</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AnimatingSwitch</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> osg::Switch { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: AnimatingSwitch() : osg::Switch(), _count(<span class="hljs-number"><span class="hljs-number">0</span></span>) {} AnimatingSwitch(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AnimatingSwitch &amp;copy, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> osg::CopyOp &amp;copyop = osg::CopyOp::SHALLOW_COPY) : osg::Switch(copy, copyop), _count(copy._count) {} META_Node(osg, AnimatingSwitch); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">traverse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(osg::NodeVisitor &amp;nv)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _count; }; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AnimatingSwitch::traverse(osg::NodeVisitor &amp;nv) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!((++_count) % <span class="hljs-number"><span class="hljs-number">60</span></span>) ) { setValue(<span class="hljs-number"><span class="hljs-number">0</span></span>, !getValue(<span class="hljs-number"><span class="hljs-number">0</span></span>)); setValue(<span class="hljs-number"><span class="hljs-number">1</span></span>, !getValue(<span class="hljs-number"><span class="hljs-number">1</span></span>)); } osg::Switch::traverse(nv); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ­¤ç±»åŒ…å«é»˜è®¤æ„é€ å‡½æ•°ã€‚ </font></font><br><br><pre> <code class="cpp hljs">AnimatingSwitch() : osg::Switch(), _count(<span class="hljs-number"><span class="hljs-number">0</span></span>) {}</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä»¥åŠæ ¹æ®OSGè¦æ±‚åˆ›å»ºçš„ç”¨äºå¤åˆ¶çš„æ„é€ å‡½æ•° </font></font><br><br><pre> <code class="cpp hljs">AnimatingSwitch(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AnimatingSwitch &amp;copy, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> osg::CopyOp &amp;copyop = osg::CopyOp::SHALLOW_COPY) : osg::Switch(copy, copyop), _count(copy._count) {}</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤åˆ¶çš„æ„é€ å‡½æ•°åº”åŒ…å«ä»¥ä¸‹å‚æ•°ï¼šå¯¹è¦å¤åˆ¶çš„ç±»å®ä¾‹çš„å¸¸é‡å¼•ç”¨ï¼Œä»¥åŠç”¨äºæŒ‡å®šç±»çš„å¤åˆ¶è®¾ç½®çš„osg :: CopyOpå‚æ•°ã€‚</font><font style="vertical-align: inherit;">è·Ÿç€å¾ˆå¥‡æ€ªçš„å­—æ¯</font></font><br><br><pre> <code class="cpp hljs">META_Node(osg, AnimatingSwitch);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ˜¯ä¸€ä¸ªå®ï¼Œå®ƒæ„æˆä»osg :: Nodeæ´¾ç”Ÿçš„ç±»çš„åä»£æ‰€å¿…éœ€çš„ç»“æ„ã€‚</font><font style="vertical-align: inherit;">åœ¨æˆ‘ä»¬é‡è§†è¯¥å®ä¹‹å‰ï¼Œé‡è¦çš„æ˜¯åœ¨å®šä¹‰æ‰€æœ‰å­ç±»æ—¶ï¼Œä»osg :: Switchç»§æ‰¿æ—¶å¿…é¡»å­˜åœ¨è¯¥å®ã€‚</font><font style="vertical-align: inherit;">è¯¥ç±»åŒ…å«å—ä¿æŠ¤çš„å­—æ®µ_count-æˆ‘ä»¬æ ¹æ®å…¶åˆ‡æ¢çš„è®¡æ•°å™¨ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬åœ¨é‡å†™traverseï¼ˆï¼‰æ–¹æ³•æ—¶å®ç°äº†åˆ‡æ¢</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AnimatingSwitch::traverse(osg::NodeVisitor &amp;nv) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!((++_count) % <span class="hljs-number"><span class="hljs-number">60</span></span>) ) { setValue(<span class="hljs-number"><span class="hljs-number">0</span></span>, !getValue(<span class="hljs-number"><span class="hljs-number">0</span></span>)); setValue(<span class="hljs-number"><span class="hljs-number">1</span></span>, !getValue(<span class="hljs-number"><span class="hljs-number">1</span></span>)); } osg::Switch::traverse(nv); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ¯å½“è®¡æ•°å™¨çš„å€¼ï¼ˆå¢åŠ æ¯ä¸ªæ–¹æ³•è°ƒç”¨çš„å€¼ï¼‰ä¸º60çš„å€æ•°æ—¶ï¼Œå°±ä¼šåˆ‡æ¢èŠ‚ç‚¹çš„æ˜¾ç¤ºçŠ¶æ€ã€‚æˆ‘ä»¬ç¼–è¯‘ç¤ºä¾‹å¹¶è¿è¡Œå®ƒ </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/z5/fl/2u/z5fl2uhbnzxafceoro_wbga-pk4.gif"></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºtraverseï¼ˆï¼‰æ–¹æ³•ä¸æ–­ä¸ºå„ç§ç±»å‹çš„èŠ‚ç‚¹é‡æ–°å®šä¹‰ï¼Œå› æ­¤å®ƒåº”æä¾›ä¸€ç§è·å–è½¬æ¢çŸ©é˜µå’Œæ¸²æŸ“çŠ¶æ€çš„æœºåˆ¶ï¼Œä»¥ä¾›å…¶é‡è½½ç®—æ³•è¿›ä¸€æ­¥ä½¿ç”¨ã€‚</font><font style="vertical-align: inherit;">è¾“å…¥å‚æ•°osg :: NodeVisitoræ˜¯ä½¿ç”¨èŠ‚ç‚¹è¿›è¡Œå„ç§æ“ä½œçš„å…³é”®ã€‚</font><font style="vertical-align: inherit;">ç‰¹åˆ«æ˜¯ï¼Œå®ƒæŒ‡ç¤ºåœºæ™¯å›¾çš„å½“å‰éå†ç±»å‹ï¼Œä¾‹å¦‚æ›´æ–°ï¼Œå¤„ç†äº‹ä»¶å’Œä¿®å‰ªä¸å¯è§çš„é¢å­”ã€‚</font><font style="vertical-align: inherit;">å‰ä¸¤ä¸ªä¸èŠ‚ç‚¹å›è°ƒæœ‰å…³ï¼Œåœ¨ç ”ç©¶åŠ¨ç”»æ—¶å°†äºˆä»¥è€ƒè™‘ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ä»¥é€šè¿‡å°†osg :: NodeVisitorè½¬æ¢ä¸ºosg :: CullVisitorå¯¹è±¡æ¥æ ‡è¯†å‰ªè¾‘é€šé“</font></font><br><br><pre> <code class="cpp hljs">osgUtil::CullVisitor *cv = <span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;osgUtil::CullVisitor *&gt;(&amp;nv); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cv) { <span class="hljs-comment"><span class="hljs-comment">///  - ,     }</span></span></code> </pre><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8.å›è°ƒæœºåˆ¶ </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬é€šè¿‡åœ¨åœºæ™¯æ¸²æŸ“å‘¨æœŸå†…æ›´æ”¹å…¶å˜æ¢çš„å‚æ•°æ¥å®ç°åœºæ™¯å¯¹è±¡çš„åŠ¨ç”»ã€‚æ­£å¦‚å¾ˆå¤šæ¬¡æåˆ°çš„é‚£æ ·ï¼Œè¿™ç§æ–¹æ³•åœ¨å¤šçº¿ç¨‹æ¸²æŸ“ä¸­åŒ…å«æ½œåœ¨çš„å±é™©åº”ç”¨ç¨‹åºè¡Œä¸ºã€‚ä¸ºäº†è§£å†³æ­¤é—®é¢˜ï¼Œä½¿ç”¨äº†éå†åœºæ™¯å›¾æ—¶æ‰§è¡Œçš„å›è°ƒæœºåˆ¶ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¼•æ“ä¸­æœ‰å‡ ç§å›è°ƒç±»å‹ã€‚å›è°ƒç”±ç‰¹æ®Šç±»å®ç°ï¼Œå…¶ä¸­osg :: NodeCallbackè®¾è®¡ä¸ºå¤„ç†åœºæ™¯èŠ‚ç‚¹çš„æ›´æ–°è¿‡ç¨‹ï¼Œè€Œosg :: Drawable :: UpdateCallbackï¼Œosg :: Drawable :: EventCallbackå’Œosg :: Drawableï¼šCullCallback-æ‰§è¡Œç›¸åŒçš„åŠŸèƒ½ï¼Œä½†æ˜¯ç”¨äºå‡ ä½•å¯¹è±¡ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">osg :: NodeCallbackç±»å…·æœ‰å¼€å‘äººå‘˜æä¾›çš„å¯é‡å†™è™šæ‹Ÿè¿ç®—ç¬¦ï¼ˆï¼‰è¿ç®—ç¬¦ï¼Œç”¨äºå®ç°å…¶è‡ªèº«çš„åŠŸèƒ½ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ä½¿å›è°ƒèµ·ä½œç”¨ï¼Œæ‚¨å¿…é¡»é€šè¿‡è°ƒç”¨setUpdateCallbackï¼ˆï¼‰æˆ–addUpdateCallbackï¼ˆï¼‰æ–¹æ³•å°†è°ƒç”¨ç±»çš„å®ä¾‹é™„åŠ åˆ°å°†å¯¹å…¶è¿›è¡Œå¤„ç†çš„èŠ‚ç‚¹ã€‚</font><font style="vertical-align: inherit;">æ¸²æŸ“æ¯ä¸€å¸§æ—¶ï¼Œåœ¨åœºæ™¯å›¾ä¸­çš„èŠ‚ç‚¹æ›´æ–°æœŸé—´ä¼šè‡ªåŠ¨è°ƒç”¨operatorï¼ˆï¼‰è¿ç®—ç¬¦ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸‹è¡¨åˆ—å‡ºäº†OSGä¸­å¯ä¾›å¼€å‘äººå‘˜ä½¿ç”¨çš„å›è°ƒã€‚</font></font><br><br><table><thead><tr><th> å </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å›è°ƒå‡½å­ </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è™šæ–¹æ³• </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é™„ç€å¯¹è±¡çš„æ–¹æ³• </font></font></th></tr></thead><tbody><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> èŠ‚ç‚¹æ›´æ–° </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> osg :: NodeCallback </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¿ç®—å­ï¼ˆï¼‰ </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> osg ::èŠ‚ç‚¹:: setUpdateCallbackï¼ˆï¼‰ </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> èŠ‚ç‚¹äº‹ä»¶ </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> osg :: NodeCallback </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¿ç®—å­ï¼ˆï¼‰ </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> osg ::èŠ‚ç‚¹:: setEventCallbackï¼ˆï¼‰ </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> èŠ‚ç‚¹è£å‰ª </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> osg :: NodeCallback </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¿ç®—å­ï¼ˆï¼‰ </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> osg ::èŠ‚ç‚¹:: setCullCallbackï¼ˆï¼‰ </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å‡ ä½•æ›´æ–° </font></font></td><td> osg::Drawable::UpdateCallback </td><td> update() </td><td> osg::Drawable::setUpdateCallback() </td></tr><tr><td>   </td><td> osg::Drawable::EventCallback </td><td> event() </td><td> osg::Drawable::setEventCallback() </td></tr><tr><td>   </td><td> osg::Drawable::CullCallback </td><td> cull() </td><td> osg::Drawable::setCullCallback() </td></tr><tr><td>   </td><td> osg::StateAttributeCallback </td><td> operator() </td><td> osg::StateAttribute::setUpdateCallback() </td></tr><tr><td>   </td><td> osg::StateAttributeCallback </td><td> operator() </td><td> osg::StateAttribute::setEventCallback() </td></tr><tr><td>   </td><td> osg::Uniform::Callback </td><td> operator() </td><td> osg::Uniform::setUpdateCallback() </td></tr><tr><td>   </td><td> osg::Uniform::Callback </td><td> operator() </td><td> osg::Uniform::setEvevtCallback() </td></tr><tr><td>       </td><td> osg::Camera::DrawCallback </td><td> operator() </td><td> osg::Camera::PreDrawCallback() </td></tr><tr><td>       </td><td> osg::Camera::DrawCallback </td><td> operator() </td><td> osg::Camera::PostDrawCallback() </td></tr></tbody></table><br><br><h1> 9.  osg::Switch     </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¨å¾®é«˜ä¸€ç‚¹ï¼Œæˆ‘ä»¬å†™äº†ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯´æ˜äº†åˆ‡æ¢ä¸¤ç§é£æœºæ¨¡å‹çš„æƒ…å†µã€‚</font><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å°†é‡å¤è¿™ä¸ªç¤ºä¾‹ï¼Œä½†æ˜¯æˆ‘ä»¬å°†ä½¿ç”¨OSGå›è°ƒæœºåˆ¶æ­£ç¡®åœ°å®Œæˆæ‰€æœ‰æ“ä½œã€‚</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸¦ç¤ºä¾‹çš„å›è°ƒ</font></font></b> <div class="spoiler_text">  <strong>ä¸»æ–‡ä»¶</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osg/Switch&gt; #include &lt;osgDB/ReadFile&gt; #include &lt;osgViewer/Viewer&gt; #endif</span></span></span></span></code> </pre><br>  <strong>main.cpp</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ class SwitchingCallback : public osg::NodeCallback { public: SwitchingCallback() : _count(0) {} virtual void operator()(osg::Node *node, osg::NodeVisitor *nv); protected: unsigned int _count; }; //------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ void SwitchingCallback::operator()(osg::Node *node, osg::NodeVisitor *nv) { osg::Switch *switchNode = static_cast&lt;osg::Switch *&gt;(node); if ( !((++_count) % 60) &amp;&amp; switchNode ) { switchNode-&gt;setValue(0, !switchNode-&gt;getValue(0)); switchNode-&gt;setValue(1, !switchNode-&gt;getValue(0)); } traverse(node, nv); } //------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ int main(int argc, char *argv[]) { (void) argc; (void) argv; osg::ref_ptr&lt;osg::Node&gt; model1 = osgDB::readNodeFile("../data/cessna.osg"); osg::ref_ptr&lt;osg::Node&gt; model2 = osgDB::readNodeFile("../data/cessnafire.osg"); osg::ref_ptr&lt;osg::Switch&gt; root = new osg::Switch; root-&gt;addChild(model1, true); root-&gt;addChild(model2, false); root-&gt;setUpdateCallback( new SwitchingCallback ); osgViewer::Viewer viewer; viewer.setSceneData(root.get()); return viewer.run(); }</span></span></span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ‚¨å¿…é¡»åˆ›å»ºä¸€ä¸ªä»osg :: NodeCallbackç»§æ‰¿çš„ç±»ï¼Œè¯¥ç±»æ§åˆ¶osg :: SwitchèŠ‚ç‚¹ </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SwitchingCallback</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> osg::NodeCallback { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: SwitchingCallback() : _count(<span class="hljs-number"><span class="hljs-number">0</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(osg::Node *node, osg::NodeVisitor *nv)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _count; };</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_countè®¡æ•°å™¨å°†æ§åˆ¶osg :: SwitchèŠ‚ç‚¹ä»ä¸€ä¸ªå­èŠ‚ç‚¹æ˜ å°„åˆ°å¦ä¸€ä¸ªå­èŠ‚ç‚¹çš„åˆ‡æ¢ï¼Œå…·ä½“å–å†³äºå…¶å€¼ã€‚</font><font style="vertical-align: inherit;">åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åˆå§‹åŒ–è®¡æ•°å™¨ï¼Œç„¶åé‡æ–°å®šä¹‰è™šæ‹Ÿæ“ä½œç¬¦ï¼ˆï¼‰æ–¹æ³•</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SwitchingCallback::<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>()(osg::Node *node, osg::NodeVisitor *nv) { osg::Switch *switchNode = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;osg::Switch *&gt;(node); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !((++_count) % <span class="hljs-number"><span class="hljs-number">60</span></span>) &amp;&amp; switchNode ) { switchNode-&gt;setValue(<span class="hljs-number"><span class="hljs-number">0</span></span>, !switchNode-&gt;getValue(<span class="hljs-number"><span class="hljs-number">0</span></span>)); switchNode-&gt;setValue(<span class="hljs-number"><span class="hljs-number">1</span></span>, !switchNode-&gt;getValue(<span class="hljs-number"><span class="hljs-number">0</span></span>)); } traverse(node, nv); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è°ƒç”¨å·¥ä½œçš„èŠ‚ç‚¹é€šè¿‡nodeå‚æ•°ä¼ é€’ç»™å®ƒã€‚</font><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬è‚¯å®šçŸ¥é“è¿™å°†æ˜¯osg :: Switchç±»å‹çš„èŠ‚ç‚¹ï¼Œå› æ­¤æˆ‘ä»¬å°†æŒ‡å‘è¯¥èŠ‚ç‚¹çš„æŒ‡é’ˆé™æ€è½¬æ¢ä¸ºæŒ‡å‘è¯¥switchèŠ‚ç‚¹çš„æŒ‡é’ˆ</font></font><br><br><pre> <code class="cpp hljs">osg::Switch *switchNode = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;osg::Switch *&gt;(node);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬å°†ä½¿ç”¨æ­¤æŒ‡é’ˆçš„æœ‰æ•ˆå€¼ä»¥åŠè®¡æ•°å™¨å€¼ä¸º60çš„å€æ•°åˆ‡æ¢æ˜¾ç¤ºçš„å­èŠ‚ç‚¹ã€‚ </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !((++_count) % <span class="hljs-number"><span class="hljs-number">60</span></span>) &amp;&amp; switchNode ) { switchNode-&gt;setValue(<span class="hljs-number"><span class="hljs-number">0</span></span>, !switchNode-&gt;getValue(<span class="hljs-number"><span class="hljs-number">0</span></span>)); switchNode-&gt;setValue(<span class="hljs-number"><span class="hljs-number">1</span></span>, !switchNode-&gt;getValue(<span class="hljs-number"><span class="hljs-number">0</span></span>)); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¸è¦å¿˜è®°è°ƒç”¨traverseï¼ˆï¼‰æ–¹æ³•ä»¥ç»§ç»­åœºæ™¯å›¾çš„é€’å½’éå† </font></font><br><br><pre> <code class="cpp hljs">traverse(node, nv);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¨‹åºä»£ç çš„å…¶ä½™éƒ¨åˆ†éƒ½å¾ˆç®€å•ï¼Œé™¤äº†ä»¥ä¸‹è¡Œ </font></font><br><br><pre> <code class="cpp hljs">root-&gt;setUpdateCallback( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SwitchingCallback );</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†åˆ›å»ºçš„å›è°ƒåˆ†é…ç»™osg :: Switchç±»å‹çš„æ ¹èŠ‚ç‚¹ã€‚</font><font style="vertical-align: inherit;">è¯¥ç¨‹åºçš„å·¥ä½œæ–¹å¼ä¸å‰é¢çš„ç¤ºä¾‹ç›¸ä¼¼</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/z5/fl/2u/z5fl2uhbnzxafceoro_wbga-pk4.gif"></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨äº†ç¥ç§˜çš„traverseï¼ˆï¼‰æ–¹æ³•æ¥å®ç°ä¸¤ä¸ªç›®çš„ï¼šåœ¨åç»§ç±»ä¸­é‡å†™æ­¤æ–¹æ³•ï¼Œå¹¶åœ¨osg :: NodeVisitorç±»ä¸Šè°ƒç”¨æ­¤æ–¹æ³•ä»¥ç»§ç»­éå†åœºæ™¯å›¾ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨åˆšåˆšæ£€æŸ¥çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨è°ƒç”¨traverseï¼ˆï¼‰çš„ç¬¬ä¸‰ä¸ªé€‰é¡¹ï¼Œå°†æŒ‡å‘èŠ‚ç‚¹çš„æŒ‡é’ˆå’ŒæŒ‡å‘è®¿é—®è€…å®ä¾‹çš„æŒ‡é’ˆä½œä¸ºå‚æ•°ä¼ é€’ã€‚ä¸å‰ä¸¤ç§æƒ…å†µä¸€æ ·ï¼Œå¦‚æœåœ¨è¯¥èŠ‚ç‚¹ä¸Šæœªè°ƒç”¨traverseï¼ˆï¼‰ï¼Œåˆ™åœºæ™¯å›¾çš„çˆ¬ç½‘å°†åœæ­¢ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">addUpdateCallbackï¼ˆï¼‰æ–¹æ³•è¿˜ç”¨äºå‘èŠ‚ç‚¹æ·»åŠ å›è°ƒã€‚ä¸setUpdateCallbackï¼ˆï¼‰ä¸åŒï¼Œå®ƒç”¨äºå‘ç°æœ‰å›è°ƒä¸­æ·»åŠ å¦ä¸€ä¸ªå›è°ƒã€‚å› æ­¤ï¼ŒåŒä¸€èŠ‚ç‚¹å¯èƒ½æœ‰å¤šä¸ªå›è°ƒã€‚</font></font><br><br><h1> ç»“è®º </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬æ£€æŸ¥äº†ä½¿ç”¨OpenSceneGraphå›¾å½¢å¼•æ“å¼€å‘åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨çš„åŸºæœ¬æŠ€æœ¯ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œè¿™ä¸æˆ‘æƒ³è°ˆçš„æ‰€æœ‰è¦ç‚¹ç›¸å»ç”šè¿œï¼ˆå°½ç®¡äº‹å®è¯æ˜è¿™ç¯‡æ–‡ç« å¾ˆé•¿ï¼‰ï¼Œå› æ­¤</font></font><br><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¾…ç»­...</a></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN437688/">https://habr.com/ru/post/zh-CN437688/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN437676/index.html">åˆ©ç”¨å¤§å­¦å’Œä¼ä¸šåŠ é€Ÿå™¨åœ¨ç¾å›½å¯åŠ¨B2Båˆåˆ›ä¼ä¸š</a></li>
<li><a href="../zh-CN437680/index.html">æˆ‘åœ¨YouTubeä¸Šçš„DIYæ”¶è—</a></li>
<li><a href="../zh-CN437682/index.html">ç¼–å†™å¦ä¸€ä¸ªKubernetesæ¨¡æ¿å·¥å…·</a></li>
<li><a href="../zh-CN437684/index.html">æœ€é«˜ç®—æ³•-æœ‰åçº²</a></li>
<li><a href="../zh-CN437686/index.html">å­¦ä¹ å»ï¼šç¼–å†™å…·æœ‰ç«¯åˆ°ç«¯åŠ å¯†çš„p2p Messenger</a></li>
<li><a href="../zh-CN437694/index.html">åˆ†æå®ç”¨ç¨‹åºFiles.walkFileTreeï¼ˆï¼‰;</a></li>
<li><a href="../zh-CN437696/index.html">ï¼ƒ283ç§»åŠ¨å¼€å‘äººå‘˜çš„æœ‰è¶£ææ–™æ‘˜è¦ï¼ˆ1æœˆ21æ—¥è‡³27æ—¥ï¼‰</a></li>
<li><a href="../zh-CN437698/index.html">WIPOç¿»è¯‘ä¸“åˆ©ç¿»è¯‘æœåŠ¡-æˆ‘çš„ç»éªŒ</a></li>
<li><a href="../zh-CN437702/index.html">Googleæ±‚èŒé¢è¯•è§£æï¼šåŒä¹‰æŸ¥è¯¢</a></li>
<li><a href="../zh-CN437704/index.html">å¯¹å­¦æ ¡è¯¾ç¨‹çš„ä¸°å¯ŒçŸ¥è¯†å¯ä»¥æŒ‡ç¤ºä¸æ˜¯æœ€é«˜çš„æ™ºåŠ›</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>