<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⚗️ 👨🏻‍🌾 🦍 Das Upgrade gehört dazu, doppelt so schnell zu arbeiten (database_validations gem) ▪️ 🖌️ 👨🏾‍🚒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel werde ich zeigen, warum Sie db_belongs_to aus dem db_belongs_to database_validations anstelle des üblichen belongs_to . 


 Ich bin ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Das Upgrade gehört dazu, doppelt so schnell zu arbeiten (database_validations gem)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431734/"><p> In diesem Artikel werde ich zeigen, warum Sie <code>db_belongs_to</code> aus dem <code>db_belongs_to</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">database_validations</a> anstelle des üblichen <code>belongs_to</code> . </p><a name="habracut"></a><br><p>  Ich bin sicher, die meisten von Ihnen kennen <code>belongs_to</code> von ORM <code>belongs_to</code> .  <code>belongs_to</code> Sie jedoch, dass das Initialisieren einer Verbindung mit <code>belongs_to</code> in Ihrem Modell auch das Vorhandensein einer Verbindung validiert <code>belongs_to</code>  Dies liegt daran, dass <code>belongs_to</code> standardmäßig die Option <code>optional: false</code> . </p><br><p>  Jedes Mal, wenn Sie ein neues Objekt speichern oder ein vorhandenes aktualisieren, führen Sie für jeden Ihrer Links eine zusätzliche SQL SELECT-Abfrage aus. </p><br><p>  <strong>Beispiel</strong> </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> &lt; ActiveRecord::Base </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">belongs_to</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">company</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">belongs_to</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">country</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">first</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">update</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">some_field</span></span></span><span class="hljs-class">: '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">something</span></span></span><span class="hljs-class">') </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#        SELECT,  ,   `company`  `country` </span></span></span></span></code> </pre> <br><p>  Sie sollten sich auch darüber im Klaren sein, dass dieser Ansatz die Datenbankintegrität nicht garantiert  Links können später (bei nachfolgenden oder parallelen Anfragen) problemlos gelöscht werden. </p><br><pre> <code class="ruby hljs">user.update(...) user.company.destroy! =&gt;     ,  ,          ,       (     )</code> </pre> <br><p>  Um dieses Problem zu lösen, können Sie Ihrer Datenbank die entsprechende Fremdschlüsseleinschränkung hinzufügen.  Mit dieser Einschränkung können Sie immer sicher sein, dass diese Verbindung besteht. </p><br><p>  Was ist mit Leistung?  Warum müssen wir SELECT-Abfragen an die Datenbank durchführen, wenn wir bereits sicher sind, dass die Datenintegrität erhalten bleibt (unter Verwendung der Fremdschlüsseleinschränkung)? </p><br><p>  Die Antwort ist einfach - keine Notwendigkeit.  Um dies zu ermöglichen, müssen wir das Problem der Behandlung der <code>ActiveRecord::InvalidForeignKey</code> Ausnahme lösen, die wir erhalten, wenn wir versuchen, die Verbindung zu speichern, die sich nicht in der Datenbank befindet.  Dies ist erforderlich, um das gleiche Verhalten wie bei <code>belongs_to</code> , damit <code>errors</code> dieselben Fehler enthalten. </p><br><p>  Um nicht die gesamte Verarbeitung selbst zu schreiben, ist das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Juwel database_validations</a> hilfreich.  Dieses Juwel enthielt bereits <code>validates_db_uniqueness_of</code> , das den Leuten gefallen hat (ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beitrag auf dem Hub</a> ), und hat jetzt <code>db_belongs_to</code> , was sehr einfach in Ihrem Projekt zu implementieren ist.  <code>db_belongs_to</code> verbessert die Leistung und stellt die Datenintegrität sicher. </p><br><p>  Die Methode erledigt einige Dinge für Sie: </p><br><ul><li>  Überprüft beim Start der Anwendung, ob in der Datenbank die richtige Fremdschlüsseleinschränkung vorhanden ist. </li><li>  Analysiert Datenbankausnahmen und stellt geeignete Fehler für die <code>errors</code> Ihres Objekts bereit. </li><li>  Beseitigt die Notwendigkeit, zusätzliche SQL-Abfragen an die Datenbank auszuführen. </li></ul><br><p>  Ich empfehle Ihnen, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">database_validations</a> in Ihren Projekten zu verwenden.  Dieses Juwel wurde bereits in der Produktionsumgebung getestet und hat sich als sehr gut erwiesen.  Trotz seiner einfachen Implementierung kann es die Leistung Ihres Projekts erheblich verbessern  <em>Je häufiger Sie es verwenden, desto mehr sparen Sie. Weitere</em> Informationen finden <em>Sie</em> in den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gruppen-Benchmarks</a> . </p><br><p>  <em>Jedes Feedback ist willkommen!</em>  <em>Wir sind für jeden Beitrag zum Projekt dankbar!</em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de431734/">https://habr.com/ru/post/de431734/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de431722/index.html">Rückblick: Wie die Ära der Transistoren begann und wie sich die Startup-Kultur in den 1940er und 1950er Jahren entwickelte</a></li>
<li><a href="../de431724/index.html">Tableau Software führt die Visualisierungsoberfläche für natürliche Sprachen ein</a></li>
<li><a href="../de431726/index.html">Implementierung eines einfachen ternären Systems</a></li>
<li><a href="../de431730/index.html">Windows Server 2019</a></li>
<li><a href="../de431732/index.html">Testers Sicht auf die Wartbarkeit von Software</a></li>
<li><a href="../de431736/index.html">Das Tor schließt sich. Es bleibt genau ein Monat, bis die Schwelle für zollfreies Einkaufen gesenkt wird</a></li>
<li><a href="../de431740/index.html">Live-Übertragung Microsoft Connect-Konferenz (); 2018</a></li>
<li><a href="../de431742/index.html">Azure Day Konferenz in Moskau</a></li>
<li><a href="../de431744/index.html">Analyse des Finales des Quizwettbewerbs am hh.ru-Stand unter # HolyJS18</a></li>
<li><a href="../de431748/index.html">So reduzieren Sie das Risiko von Aktieninvestitionen: 3 nützliche Tools</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>