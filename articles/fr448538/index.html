<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖐🏽 🍜 🏎️ Créez une solution de basculement basée sur Oracle RAC et l'architecture AccelStor Shared-Nothing 🖋️ 🤵🏿 🌒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Un nombre considérable d'applications d'entreprise et de systèmes de virtualisation ont leurs propres mécanismes pour créer des solutions tolérantes a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Créez une solution de basculement basée sur Oracle RAC et l'architecture AccelStor Shared-Nothing</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/accelstor/blog/448538/"><p>  Un nombre considérable d'applications d'entreprise et de systèmes de virtualisation ont leurs propres mécanismes pour créer des solutions tolérantes aux pannes.  En particulier, Oracle RAC (Oracle Real Application Cluster) est un cluster de deux serveurs de base de données Oracle ou plus travaillant ensemble pour équilibrer la charge et fournir une tolérance aux pannes au niveau du serveur / de l'application.  Pour travailler dans ce mode, un stockage commun est requis, dont le rôle est généralement le stockage. </p><br><p>  Comme nous l'avons déjà expliqué dans l'un de nos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">articles</a> , le système de stockage en lui-même, malgré la présence de composants dupliqués (y compris les contrôleurs), présente encore des points de défaillance - principalement sous la forme d'un ensemble de données unique.  Par conséquent, pour construire une solution Oracle avec des exigences de fiabilité accrues, le schéma «N serveurs - un stockage» doit être compliqué. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/l3/lh/1t/l3lh1tmhqobqcqow6yxo-g3j8lc.png"></div><br><a name="habracut"></a><br><p>  Tout d'abord, bien sûr, vous devez décider des risques contre lesquels nous essayons de nous assurer.  Dans cet article, nous ne considérerons pas la protection contre les menaces telles qu'une météorite est arrivée.  La création d'une solution de reprise après sinistre dispersée géographiquement restera donc un sujet pour l'un des articles suivants.  Nous examinons ici la solution de récupération après sinistre Cross-Rack, lorsque la protection est construite au niveau des armoires de serveur.  Les armoires elles-mêmes peuvent être situées dans la même pièce ou dans des pièces différentes, mais généralement dans le même bâtiment. </p><br><p>  Ces armoires doivent contenir tous les équipements et logiciels nécessaires pour assurer le fonctionnement des bases de données Oracle quel que soit l'état du "voisin".  En d'autres termes, en utilisant la solution de reprise après sinistre Cross-Rack, nous éliminons les risques d'échec: </p><br><ul><li>  Serveurs d'applications Oracle </li><li>  Systèmes de stockage </li><li>  Systèmes de commutation </li><li>  Panne complète de tous les équipements de l'armoire: <br><ul><li>  Panne de courant </li><li>  Panne du système de refroidissement </li><li>  Facteurs externes (homme, nature, etc.) </li></ul></li></ul><br><p>  La duplication des serveurs Oracle implique le principe même d'Oracle RAC et est implémentée via l'application.  La duplication des outils de commutation n'est pas non plus un problème.  Mais avec la duplication du système de stockage, tout n'est pas si simple. </p><br><p>  L'option la plus simple consiste à répliquer les données du stockage principal vers la sauvegarde.  Synchrone ou asynchrone, selon les capacités de stockage.  La réplication asynchrone soulève immédiatement la question de la cohérence des données avec Oracle.  Mais même s'il existe une intégration logicielle avec l'application, en tout cas, en cas d'accident sur le système de stockage principal, une intervention manuelle des administrateurs sera nécessaire afin de basculer le cluster vers le stockage de sauvegarde. </p><br><p>  Une option plus complexe est celle des «virtualiseurs» logiciels et / ou matériels des systèmes de stockage, qui élimineront les problèmes de cohérence et d'intervention manuelle.  Mais la complexité du déploiement et de l'administration ultérieure, ainsi que le coût très indécent de telles solutions, en effrayent beaucoup. </p><br><p>  Pour les scénarios tels que la reprise après sinistre sur plusieurs racks, la baie All Flash AccelStor NeoSapphire ™ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">H710</a> utilisant l'architecture Shared-Nothing est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">parfaite</a> .  Ce modèle est un système de stockage à deux unités utilisant sa propre technologie FlexiRemap® pour travailler avec des lecteurs flash.  Grâce au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">FlexiRemap®</a> NeoSapphire ™ H710, il peut fournir jusqu'à 600K IOPS @ 4K en écriture aléatoire et 1M + IOPS @ 4K en lecture aléatoire, ce qui est impossible avec un stockage RAID classique. </p><br><p>  Mais la principale caractéristique du NeoSapphire ™ H710 est l'exécution de deux nœuds en tant que boîtiers séparés, chacun ayant sa propre copie des données.  La synchronisation des nœuds s'effectue via l'interface externe InfiniBand.  Grâce à cette architecture, les nœuds peuvent être répartis sur différents emplacements sur des distances allant jusqu'à 100 m, fournissant ainsi la solution de reprise après sinistre Cross-Rack.  Les deux nœuds fonctionnent complètement en mode synchrone.  Du côté de l'hôte, le H710 ressemble à un stockage ordinaire à double contrôleur.  Par conséquent, aucune option logicielle et matérielle supplémentaire et des paramètres particulièrement complexes ne doivent être effectués. </p><br><p>  Si vous comparez toutes les solutions de reprise après incident Cross-Rack décrites ci-dessus, la version AccelStor se démarque des autres: </p><br><table><tbody><tr><th></th><th>  Architecture AccelStor NeoSapphire ™ Shared Nothing </th><th>  Virtualiseur logiciel ou matériel de stockage </th><th>  Solution de réplication </th></tr><tr><td colspan="4">  <b>La disponibilité</b> </td></tr><tr><td>  Échec du serveur </td><td>  <b>Aucun temps d'arrêt</b> </td><td>  <b>Aucun temps d'arrêt</b> </td><td>  <b>Aucun temps d'arrêt</b> </td></tr><tr><td>  Panne de commutateur </td><td>  <b>Aucun temps d'arrêt</b> </td><td>  <b>Aucun temps d'arrêt</b> </td><td>  <b>Aucun temps d'arrêt</b> </td></tr><tr><td>  Échec de stockage </td><td>  <b>Aucun temps d'arrêt</b> </td><td>  <b>Aucun temps d'arrêt</b> </td><td>  <font color="green"><b>Temps d'arrêt</b></font> </td></tr><tr><td>  Panne de l'armoire entière </td><td>  <b>Aucun temps d'arrêt</b> </td><td>  <b>Aucun temps d'arrêt</b> </td><td>  <font color="green"><b>Temps d'arrêt</b></font> </td></tr><tr><td colspan="4">  <b>Coût et complexité</b> </td></tr><tr><td>  Coût de la solution </td><td>  Faible * </td><td>  <font color="green">Élevé</font> </td><td>  <font color="green">Élevé</font> </td></tr><tr><td>  Difficulté de déploiement </td><td>  Faible </td><td>  <font color="green">Élevé</font> </td><td>  <font color="green">Élevé</font> </td></tr></tbody></table><br><p>  <i>* AccelStor NeoSapphire ™ est toujours une baie All Flash, qui par définition ne coûte pas «3 kopecks», d'autant plus qu'elle dispose d'une réserve de capacité double.</i>  <i>Cependant, en comparant le coût total de la solution basée sur celle-ci avec des coûts similaires d'autres fournisseurs, le coût peut être considéré comme faible.</i> </p><br><p>  La topologie de connexion des serveurs d'applications et de tous les nœuds de baies Flash ressemblera à ceci: </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/5i/gb/cw/5igbcwdvm92bpabsylae4iysdra.png"></div><br><p>  Lors de la planification de la topologie, il est également fortement recommandé de dupliquer les commutateurs de gestion et les interconnexions de serveurs. </p><br><p>  Ci-après, nous parlerons de la connexion via Fibre Channel.  Dans le cas de l'utilisation d'iSCSI, tout sera le même, ajusté pour les types de commutateurs utilisés et les paramètres de baie légèrement différents. </p><br><h3>  Travaux préparatoires sur le réseau </h3><br><div class="spoiler">  <b class="spoiler_title">Matériel et logiciels utilisés</b> <div class="spoiler_text"><p>  <b>Spécifications du serveur et du commutateur</b> </p><br><table><tbody><tr><th>  Composants </th><th>  La description </th></tr><tr><td>  Serveurs Oracle Database 11g </td><td>  Deux </td></tr><tr><td>  Système d'exploitation serveur </td><td>  Oracle Linux </td></tr><tr><td>  Version de la base de données Oracle </td><td>  11g (RAC) </td></tr><tr><td>  Processeurs par serveur </td><td>  Deux processeurs Intel® Xeon® E5-2667 v2 à 16 cœurs à 3,30 GHz </td></tr><tr><td>  Mémoire physique par serveur </td><td>  128 Go </td></tr><tr><td>  Réseau FC </td><td>  FC 16 Gb / s avec trajets multiples </td></tr><tr><td>  FC HBA </td><td>  Emulex Lpe-16002B </td></tr><tr><td>  Ports publics 1 GbE dédiés pour la gestion des clusters </td><td>  Adaptateur Ethernet Intel RJ45 </td></tr><tr><td>  Commutateur FC 16 Gb / s </td><td>  Brocade 6505 </td></tr><tr><td>  Ports privés 10 GbE dédiés pour la synchronisation des données </td><td>  Intel X520 </td></tr></tbody></table><br><p>  <b>AccelStor NeoSapphhire ™ All Flash Array Specification</b> </p><br><table><tbody><tr><th>  Composants </th><th>  La description </th></tr><tr><td>  Système de stockage </td><td>  Modèle haute disponibilité NeoSapphire ™: H710 </td></tr><tr><td>  Version d'image </td><td>  4.0.1 </td></tr><tr><td>  Nombre total de disques </td><td>  48 </td></tr><tr><td>  Taille du lecteur </td><td>  1,92 To </td></tr><tr><td>  Type de lecteur </td><td>  SSD </td></tr><tr><td>  Ports cibles FC </td><td>  16 ports 16 Go (8 par nœud) </td></tr><tr><td>  Ports de gestion </td><td>  Le câble Ethernet 1 GbE se connectant aux hôtes via un commutateur Ethernet </td></tr><tr><td>  Port Heartbeat </td><td>  Le câble Ethernet 1 GbE se connectant entre deux nœuds de stockage </td></tr><tr><td>  Port de synchronisation des données </td><td>  Câble InfiniBand 56 Gb / s </td></tr></tbody></table><br></div></div><br><p>  Avant de commencer à utiliser un tableau, vous devez l'initialiser.  Par défaut, l'adresse de contrôle des deux nœuds est la même (192.168.1.1).  Vous devez vous y connecter un par un et définir de nouvelles adresses de gestion (déjà différentes) et configurer la synchronisation de l'heure, après quoi les ports de gestion peuvent être connectés à un seul réseau.  Après cela, les nœuds sont combinés en une paire HA en attribuant des sous-réseaux aux connexions Interlink. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/c3/kw/sp/c3kwspwqm38yl7ennakzykubswq.jpeg"></div><br><p>  Une fois l'initialisation terminée, vous pouvez contrôler la baie à partir de n'importe quel nœud. </p><br><p>  Ensuite, créez les volumes nécessaires et publiez-les pour les serveurs d'applications. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/6h/4s/gf/6h4sgfinagrbbngoououu-lg1au.png"></div><br><p>  Il est fortement recommandé de créer plusieurs volumes pour Oracle ASM, car cela augmentera le nombre de cibles pour les serveurs, ce qui améliorera finalement les performances globales (plus d'informations sur les files d'attente dans un autre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> ). </p><br><div class="spoiler">  <b class="spoiler_title">Configuration de test</b> <div class="spoiler_text"><table><tbody><tr><th>  Nom du volume de stockage </th><th>  Taille du volume </th></tr><tr><td>  Data01 </td><td>  200 Go </td></tr><tr><td>  Data02 </td><td>  200 Go </td></tr><tr><td>  Data03 </td><td>  200 Go </td></tr><tr><td>  Data04 </td><td>  200 Go </td></tr><tr><td>  Data05 </td><td>  200 Go </td></tr><tr><td>  Data06 </td><td>  200 Go </td></tr><tr><td>  Data07 </td><td>  200 Go </td></tr><tr><td>  Data08 </td><td>  200 Go </td></tr><tr><td>  Data09 </td><td>  200 Go </td></tr><tr><td>  Données10 </td><td>  200 Go </td></tr><tr><td>  Grid01 </td><td>  1 Go </td></tr><tr><td>  Grid02 </td><td>  1 Go </td></tr><tr><td>  Grid03 </td><td>  1 Go </td></tr><tr><td>  Grid04 </td><td>  1 Go </td></tr><tr><td>  Grid05 </td><td>  1 Go </td></tr><tr><td>  Grid06 </td><td>  1 Go </td></tr><tr><td>  Redo01 </td><td>  100 Go </td></tr><tr><td>  Redo02 </td><td>  100 Go </td></tr><tr><td>  Redo03 </td><td>  100 Go </td></tr><tr><td>  Redo04 </td><td>  100 Go </td></tr><tr><td>  Redo05 </td><td>  100 Go </td></tr><tr><td>  Redo06 </td><td>  100 Go </td></tr><tr><td>  Redo07 </td><td>  100 Go </td></tr><tr><td>  Redo08 </td><td>  100 Go </td></tr><tr><td>  Redo09 </td><td>  100 Go </td></tr><tr><td>  Redo10 </td><td>  100 Go </td></tr></tbody></table><br></div></div><br><h3>  Quelques explications sur les modes de fonctionnement de la baie et les processus qui se produisent dans les situations d'urgence </h3><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/5m/_k/uu/5m_kuurlb-2fy52d8p1tzufcyic.png"></div><br><p>  Chaque jeu de données de noeud a un paramètre «numéro de version».  Après l'initialisation initiale, il est identique et égal à 1. Si, pour une raison quelconque, le numéro de version est différent, il y a toujours une synchronisation des données de l'ancienne version vers la plus jeune, après quoi le numéro est aligné pour la version la plus jeune, c'est-à-dire  cela signifie que les copies sont identiques.  Raisons pour lesquelles les versions peuvent varier: </p><br><ul><li>  Redémarrage planifié de l'un des nœuds </li><li>  Un accident sur l'un des nœuds dû à un arrêt brutal (alimentation, surchauffe, etc.). </li><li>  Connexion InfiniBand rompue avec incapacité de synchronisation </li><li>  Plantage sur l'un des nœuds en raison d'une corruption des données.  Cela nécessitera déjà la création d'un nouveau groupe HA et une synchronisation complète de l'ensemble de données. </li></ul><br><p>  Dans tous les cas, le nœud restant en ligne augmente son numéro de version de un, de sorte qu'après avoir reconnecté la paire, synchronisez son ensemble de données. </p><br><p>  Si la connexion est perdue via la liaison Ethernet, Heartbeat bascule temporairement vers InfiniBand et revient dans les 10 secondes après sa restauration. </p><br><h3>  Configuration d'hôte </h3><br><p>  Pour garantir la tolérance aux pannes et augmenter les performances, vous devez activer la prise en charge MPIO pour la baie.  Pour ce faire, ajoutez des lignes au fichier /etc/multipath.conf, puis rechargez le service multichemin </p><br><div class="spoiler">  <b class="spoiler_title">Texte masqué</b> <div class="spoiler_text">  appareils { <br>  appareil { <br>  fournisseur "AStor" <br>  path_grouping_policy "group_by_prio" <br>  path_selector "file d'attente-longueur 0" <br>  path_checker "tur" <br>  comporte "0" <br>  hardware_handler "0" <br>  prio "const" <br>  restauration immédiate <br>  fast_io_fail_tmo 5 <br>  dev_loss_tmo 60 <br>  user_friendly_names oui <br>  detect_prio oui <br>  rr_min_io_rq 1 <br>  no_path_retry 0 <br>  } <br>  } <br><br></div></div><br><p>  De plus, pour qu'ASM fonctionne avec MPIO via ASMLib, vous devez modifier le fichier / etc / sysconfig / oracleasm, puis exécuter /etc/init.d/oracleasm scandisks </p><br><div class="spoiler">  <b class="spoiler_title">Texte masqué</b> <div class="spoiler_text"><p>  # ORACLEASM_SCANORDER: modèles de correspondance pour commander l'analyse du disque <br>  ORACLEASM_SCANORDER = "dm" </p><br><br><p>  # ORACLEASM_SCANEXCLUDE: modèles de correspondance pour exclure les disques de l'analyse <br>  ORACLEASM_SCANEXCLUDE = "sd" </p><br><p></p><h4>  Remarque </h4><br><p>  <i>Si vous ne souhaitez pas utiliser ASMLib, vous pouvez utiliser les règles UDEV, qui constituent la base d'ASMLib.</i> </p><br><p>  <i>À partir de la version 12.1.0.2 Oracle Database, l'option est disponible pour l'installation dans le cadre du logiciel ASMFD.</i> </p><br></div></div><br><p>  Assurez-vous que les disques créés pour Oracle ASM sont alignés avec la taille du bloc avec lequel la baie travaille physiquement (4K).  Sinon, des problèmes de performances peuvent survenir.  Par conséquent, vous devez créer des volumes avec les paramètres appropriés: </p><br><p>  <i>parted / dev / mapper / device-name mklabel gpt mkpart primary 2048s 100% align-check optimal 1</i> </p><br><h3>  Distribution de bases de données sur les volumes créés pour notre configuration de test </h3><br><table><tbody><tr><th>  Nom du volume de stockage </th><th>  Taille du volume </th><th>  Mappage des LUN de volume </th><th>  Détails du périphérique de volume ASM </th><th>  Taille de l'unité d'allocation </th></tr><tr><td>  Data01 </td><td>  200 Go </td><td rowspan="26">  Mappez tous les volumes de stockage au système de stockage tous les ports de données </td><td rowspan="10">  Redondance: normale <br>  Nom: DGDATA <br>  Objectif: Fichiers de données <br></td><td rowspan="10">  4 Mo </td></tr><tr><td>  Data02 </td><td>  200 Go </td></tr><tr><td>  Data03 </td><td>  200 Go </td></tr><tr><td>  Data04 </td><td>  200 Go </td></tr><tr><td>  Data05 </td><td>  200 Go </td></tr><tr><td>  Data06 </td><td>  200 Go </td></tr><tr><td>  Data07 </td><td>  200 Go </td></tr><tr><td>  Data08 </td><td>  200 Go </td></tr><tr><td>  Data09 </td><td>  200 Go </td></tr><tr><td>  Données10 </td><td>  200 Go </td></tr><tr><td>  <font color="#248dee">Grid01</font> </td><td>  <font color="#248dee">1 Go</font> </td><td rowspan="3">  <font color="#248dee">Redondance: normale</font> <font color="#248dee"><br></font>  <font color="#248dee">Nom: DGGRID1</font> <font color="#248dee"><br></font>  <font color="#248dee">Objectif: Grille: CRS et vote</font> <br></td><td rowspan="3">  <font color="#248dee">4 Mo</font> </td></tr><tr><td>  <font color="#248dee">Grid02</font> </td><td>  <font color="#248dee">1 Go</font> </td></tr><tr><td>  <font color="#248dee">Grid03</font> </td><td>  <font color="#248dee">1 Go</font> </td></tr><tr><td>  Grid04 </td><td>  1 Go </td><td rowspan="3">  Redondance: normale <br>  Nom: DGGRID2 <br>  Objectif: Grille: CRS et vote <br></td><td rowspan="3">  4 Mo </td></tr><tr><td>  Grid05 </td><td>  1 Go </td></tr><tr><td>  Grid06 </td><td>  1 Go </td></tr><tr><td>  <font color="#248dee">Redo01</font> </td><td>  <font color="#248dee">100 Go</font> </td><td rowspan="5">  <font color="#248dee">Redondance: normale</font> <font color="#248dee"><br></font>  <font color="#248dee">Nom: DGREDO1</font> <font color="#248dee"><br></font>  <font color="#248dee">Objectif: rétablir le journal du thread 1</font> <font color="#248dee"><br></font> <br></td><td rowspan="5">  <font color="#248dee">4 Mo</font> </td></tr><tr><td>  <font color="#248dee">Redo02</font> </td><td>  <font color="#248dee">100 Go</font> </td></tr><tr><td>  <font color="#248dee">Redo03</font> </td><td>  <font color="#248dee">100 Go</font> </td></tr><tr><td>  <font color="#248dee">Redo04</font> </td><td>  <font color="#248dee">100 Go</font> </td></tr><tr><td>  <font color="#248dee">Redo05</font> </td><td>  <font color="#248dee">100 Go</font> </td></tr><tr><td>  Redo06 </td><td>  100 Go </td><td rowspan="5">  Redondance: normale <br>  Nom: DGREDO2 <br>  Objectif: rétablir le journal du thread 2 <br><br></td><td rowspan="5">  4 Mo </td></tr><tr><td>  Redo07 </td><td>  100 Go </td></tr><tr><td>  Redo08 </td><td>  100 Go </td></tr><tr><td>  Redo09 </td><td>  100 Go </td></tr><tr><td>  Redo10 </td><td>  100 Go </td></tr></tbody></table><br><div class="spoiler">  <b class="spoiler_title">Paramètres de la base de données</b> <div class="spoiler_text"><ul><li>  Taille du bloc = 8K </li><li>  Espace d'échange = 16 Go </li><li>  Désactiver AMM (gestion automatique de la mémoire) </li><li>  Désactiver les pages immenses transparentes </li></ul><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Autres réglages</b> <div class="spoiler_text"><p>  <u># vi /etc/sysctl.conf</u> <br>  ✓ fs.aio-max-nr = 1048576 <br>  ✓ fs.file-max = 6815744 <br>  ✓ kernel.shmmax 103079215104 <br>  ✓ kernel.shmall 31457280 <br>  ✓ kernel.shmmn 4096 <br>  ✓ kernel.sem = 250 32000 100 128 <br>  ✓ net.ipv4.ip_local_port_range = 9000 65500 <br>  ✓ net.core.rmem_default = 262144 <br>  ✓ net.core.rmem_max = 4194304 <br>  ✓ net.core.wmem_default = 262144 <br>  ✓ net.core.wmem_max = 1048586 <br>  ✓ vm.swappiness = 10 <br>  ✓ vm.min_free_kbytes = 524288 # ne le définissez pas si vous utilisez Linux x86 <br>  ✓ vm.vfs_cache_pressure = 200 <br>  ✓ vm.nr_hugepages = 57000 </p><br><br><p>  <u># vi /etc/security/limits.conf</u> <br>  ✓ grille soft nproc 2047 <br>  ✓ grille dure nproc 16384 <br>  ✓ grille nofile doux 1024 <br>  ✓ grille nofile dur 65536 <br>  ✓ soft stack de grille 10240 <br>  ✓ pile dure de grille 32768 <br>  ✓ oracle soft nproc 2047 <br>  ✓ oracle hard nproc 16384 <br>  ✓ oracle soft nofile 1024 <br>  ✓ nofile dur oracle 65536 <br>  ✓ pile souple oracle 10240 <br>  ✓ disque dur oracle 32768 <br>  ✓ soft lock 120795954 <br>  ✓ mémlock dur 120795954 <br></p><br><p>  <u>sqlplus «/ as sysdba»</u> <br>  modifier les processus de définition du système = 2000 scope = spfile; <br>  alter system set open_cursors = 2000 scope = spfile; <br>  alter system set session_cached_cursors = 300 scope = spfile; <br>  alter system set db_files = 8192 scope = spfile; <br></p><br><br></div></div><br><h3>  Test de tolérance aux pannes </h3><br><p>  À des fins de démonstration, HammerDB a été utilisé pour émuler la charge OLTP.  Configuration de HammerDB: </p><br><table><tbody><tr><td>  <b>Nombre d'entrepôts</b> </td><td>  256 </td></tr><tr><td>  Total des transactions par utilisateur </td><td>  1000000000000 </td></tr><tr><td>  Utilisateurs virtuels </td><td>  256 </td></tr></tbody></table><br><p>  En conséquence, l'indicateur TPM 2.1M a été obtenu, ce qui est loin de la limite de performance de la baie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">H710</a> , mais c'est le «plafond» pour la configuration matérielle actuelle des serveurs (principalement due aux processeurs) et leur nombre.  Le but de ce test est toujours de démontrer la tolérance aux pannes de la solution dans son ensemble, et non d'atteindre des performances maximales.  Par conséquent, nous allons simplement construire sur cette figure. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/3o/ds/id/3odsid2wr0ynssl4zuu8idq8dfq.png"></div><br><h3>  Test de défaillance d'un des nœuds </h3><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/ar/tf/og/artfogfilgwzy2vtxlsyvkp98vu.png"></div><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/zk/iv/xt/zkivxtazysrew4hhzjan-vujnma.png"></div><br><p>  Les hôtes ont perdu certains des chemins d'accès au magasin, continuant à travailler sur les autres avec le deuxième nœud.  Les performances ont chuté pendant quelques secondes en raison de la restructuration des chemins, puis sont revenues à la normale.  Aucune interruption de service n'est survenue. </p><br><h3>  Test de défaillance de l'armoire avec tous les équipements </h3><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/mq/my/2b/mqmy2bzrge24zhnj217spj2rts4.png"></div><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/eq/nh/-8/eqnh-8pwbhyzqgdleh1tsiafkr0.png"></div><br><p>  Dans ce cas, la performance a également chuté pendant quelques secondes en raison de la restructuration des chemins, puis est revenue à la moitié de la valeur de l'indicateur d'origine.  Le résultat a été divisé par deux par rapport à l'original en raison de l'exclusion du fonctionnement d'un serveur d'applications.  Il n'y a pas eu non plus d'interruption de service. </p><br><blockquote>  Si vous avez besoin d'implémenter une solution de reprise après sinistre Cross-Rack tolérante aux pannes pour Oracle à un coût raisonnable et avec peu d'efforts de déploiement / administration, alors travailler avec Oracle RAC et l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">architecture AccelStor Shared-Nothing</a> serait l'une des meilleures options.  Au lieu d'Oracle RAC, il peut y avoir tout autre logiciel qui prévoit la mise en cluster, le même SGBD ou les systèmes de virtualisation, par exemple.  Le principe de construction de la solution restera le même.  Et le score final est nul pour RTO et RPO. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr448538/">https://habr.com/ru/post/fr448538/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr448528/index.html">Service VPN Wireguard gratuit sur AWS</a></li>
<li><a href="../fr448530/index.html">Comment le mégaphone a dormi sur les abonnements mobiles</a></li>
<li><a href="../fr448532/index.html">Centre de données spatiales. Résumant l'expérience</a></li>
<li><a href="../fr448534/index.html">Pourquoi avons-nous besoin de commutateurs industriels avec CEM améliorée?</a></li>
<li><a href="../fr448536/index.html">Transparence - La panacée des bouchers</a></li>
<li><a href="../fr448540/index.html">VMware NSX pour les plus petits. Partie 5. Configuration de l'équilibreur de charge</a></li>
<li><a href="../fr448544/index.html">Faisceaux en acier. Comment sont-ils formés</a></li>
<li><a href="../fr448546/index.html">UITableView tailles d'en-tête et de pied de page automatiques avec AutoLayout</a></li>
<li><a href="../fr448548/index.html">La construction dans l'art: de Brueghel à Vasya Lozhkin</a></li>
<li><a href="../fr448550/index.html">Ouverture du concours de rapport à #PAYMENTSECURITY 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>