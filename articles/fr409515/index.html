<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßö üë©üèΩ‚Äçüé® üëÆ SDK OMower pour robots √† roues (open source, mat√©riel ouvert) üíº ‚úâÔ∏è ‚õπüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Enfin, nous avons pu publier le SDK promis pour le projet OMower (une plate-forme mat√©rielle et logicielle ouverte pour les robots √† roues bas√©e sur l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SDK OMower pour robots √† roues (open source, mat√©riel ouvert)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/409515/">  Enfin, nous avons pu publier le SDK promis pour le projet OMower (une plate-forme mat√©rielle et logicielle ouverte pour les robots √† roues bas√©e sur le contr√¥leur ATSAM3X8E 32 bits avec prise en charge du d√©veloppement dans Arduino IDE).  Le niveau d'ach√®vement du logiciel n'est pas tr√®s bon (par exemple, il n'y a pas de classes pour les capteurs de pare-chocs, de pluie et d'herbe, certaines fonctions ne sont pas enti√®rement d√©bogu√©es), mais m√™me dans sa forme actuelle, le robot peut conduire avec une grande pr√©cision via RTK GPS, il prend en charge presque tout ce qui est n√©cessaire pour tondeuses - sonars, p√©rim√®tre c√¢bl√©, boussole et navigation GPS, charge √† partir d'une station de charge ou d'un panneau solaire. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/LkU6-B6TZKI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mon pr√©c√©dent article sur le projet OMower</a> <br><a name="habracut"></a><br>  Le code SDK et les fichiers Kicad avec le circuit et le c√¢blage de la carte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">se trouvent sur le github</a> . <br><br>  Seules deux plates-formes sont actuellement prises en charge - la carte OMower v3 avec les pilotes de moteur double Polulu MC33926 et un tas de pilotes de moteur Arduino Due + IHM12A1 (machine de test sur un petit ch√¢ssis √† quatre roues).  Le support Ardumower bas√© sur Arduino Due peut √™tre ajout√©.  Il est hautement souhaitable d'avoir une carte IMU GY-80, sans elle, la navigation ne fonctionne pas simplement (bien que vous puissiez faire un simple homme de tondeuse qui conduit accidentellement √† l'int√©rieur du p√©rim√®tre du fil). <br><br>  Dans la nouvelle quatri√®me version de la carte, il est pr√©vu de mettre une IMU MPU9250 dessus et d'ajouter une puce FRAM pour enregistrer les param√®tres utilisateur non dans le flash interne du contr√¥leur (qui est r√©initialis√© lorsque le firmware est recharg√©), eh bien, toutes sortes de cartes peuvent y √™tre stock√©es.  De plus, j'augmenterai probablement les tailles des ensembles r√©sistance et condensateur, souder le 0402 ¬´sur le genou¬ª avec un s√®che-cheveux √©tait un plaisir en dessous de la moyenne, et augmenter l'espace pour les connecteurs afin que vous puissiez les mettre avec des pinces, pas seulement des broches collantes. <br><br>  Le code API est √©crit sous la forme d'une poign√©e de classes (fichiers omower - *. H) que vous devez inclure en tant qu'objets dans votre logiciel (et, facultativement, les inclure tous, vous ne pouvez prendre que ceux qui sont n√©cessaires, √† l'exception des bases).  Pour simplifier la compr√©hension et les tests, OMower_Simple a √©t√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©crit</a> , qui ex√©cute un ensemble assez important de commandes √©mises via pfodApp √† partir de n'importe quel smartphone. <br><br>  Le SDK prend le contr√¥le de toutes les fonctions de bas niveau et fonctionne principalement sur les interruptions, ce qui donne au programmeur logiciel final la possibilit√© d'√©crire un logiciel ind√©pendamment des d√©tails sp√©cifiques d'un robot particulier, et de mani√®re tr√®s libre (vous pouvez √©crire une machine d'√©tat, ou vous pouvez simplement appeler la fonction de d√©marrage du lecteur et attendez que le robot atteigne le point souhait√©).  Seules les proc√©dures d'appel aux fonctions d'initialisation et de contr√¥le de la conduite du robot tombent sur les √©paules du programmeur (instructions sur o√π aller, en fait, et traiter les op√©rations des sonars et autres capteurs). <br><br>  Pour connecter des p√©riph√©riques externes suppl√©mentaires sur la carte (et la prise en charge dans le SDK, bien s√ªr) - il existe de nombreux connecteurs externes.  Par exemple, les servo variateurs standard avec une entr√©e PPM peuvent connecter jusqu'√† quatre pi√®ces (voire six si vous refusez deux moteurs).  Il y a beaucoup de capteurs ¬´standard¬ª pour la tondeuse, il y a jusqu'√† six de ces sonars et quatre des capteurs de p√©rim√®tre.  Bien s√ªr, dans la plupart des cas, cela n'est pas n√©cessaire et une partie de leurs connecteurs peut √™tre utilis√©e pour connecter d'autres appareils (presque toutes les sorties du microcontr√¥leur sont sorties).  La partie intellectuelle (traitement RTK GPS, connectivit√© avec wifi) est r√©alis√©e par Orange PI Zero, qui est install√© dans un connecteur sp√©cial. <br><br>  Je m'excuse d'avance pour la courbe et le code inachev√© √† certains endroits, j'ai d√ª creuser dans d'autres projets, et beaucoup de difficult√©s de toutes sortes se sont r√©v√©l√©es auxquelles je pouvais √† peine faire face.  Mais j'ai appris beaucoup de nouvelles choses, par exemple, que la courbure de l'ellipse de la Terre √† nos endroits est de pr√®s de 40 m√®tres, et que les p√¥les magn√©tiques de la Terre parcourent des dizaines de kilom√®tres d'ann√©e en ann√©e (sans en tenir compte, le robot a voyag√© de point en point avec des lignes tr√®s courbes).  Parfois, il semblait que je lan√ßais une fus√©e spatiale et non une tonte de pelouse.  :) <br><br>  Eh bien, en bonus, j'ai √©galement expos√© les sources de mon firmware pour l'arduino avec Decawave DW1000, qui organise un mini-r√©seau de ces appareils et permet au robot de d√©terminer son emplacement √† l'int√©rieur ou o√π le GPS RTK ne peut tout simplement pas d√©terminer ses coordonn√©es (avec un support pour une quantit√© presque infinie √©tiquettes et division en pi√®ces).  Ce <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">firmware est</a> encore tr√®s, tr√®s brut, mais il peut √™tre utile pour quelqu'un. <br><br>  Mise √† jour, j'ai d√©cid√© de compl√©ter l'article avec une histoire sur la fa√ßon dont il est organis√© √† l'int√©rieur: <br><br>  L'utilisateur du SDK doit d√©terminer tous les objets dont il a besoin, appeler la fonction begin () pour tout le monde (initialisation mat√©rielle, une seule fois), puis d√©finir les valeurs de leurs param√®tres (apr√®s les avoir lues dans le flash ou juste les valeurs par d√©faut), appeler init () pour tout le monde (la fonction peut utilis√© pour r√©initialiser l'appareil dont l'objet est responsable), d√©finissez les fonctions de crochet pour poll10 / poll20 / poll50 (10, 20 et 50 fois par seconde) √† partir desquelles il doit appeler les fonctions poll * () correspondantes de tous les objets utilis√©s.  Th√©oriquement, il √©tait possible d'automatiser tout cela dans le code du SDK lui-m√™me, mais j'ai d√©cid√© de ne pas le faire en raison de la consommation suppl√©mentaire de ressources du contr√¥leur.  Un exemple de l'utilisation dont vous avez besoin pour regarder OMower_Simple.ino <br><br>  L'une des classes principales est l'objet moteurs (omower-motors.h), qui contr√¥le les pilotes de moteur √† partir de sa fonction poll10 ().  L'utilisateur appelle simplement le roll / move (tourner et rouler sans navigation) ou rollCourse / moveCourse (rouler avec navigation / correction bas√© sur les donn√©es d'un objet enfant de la classe navThing qui, via les fonctions readCourseError (), donne la valeur de l'√©cart par rapport √† la direction de conduite souhait√©e ) <br><br>  Les d√©riv√©s de navThing sont des objets des classes imu et gps (omower-imu.h et omower-gps.h), le premier est charg√© de lire et de convertir les donn√©es de la boussole / acc√©l√©rom√®tre / gyroscope sous une forme pratique (il donne les valeurs de la boussole et de l'inclinaison en degr√©s sur deux axes )  La seconde - traite les donn√©es GPS et oriente l'objet moteurs dans la bonne direction si vous avez besoin d'un trajet en coordonn√©es GPS ou RTK GPS (pour ce dernier, la correction est calcul√©e lorsque l'antenne n'est pas plac√©e au centre du corps du robot et correction √† court terme par des capteurs de l'odom√®tre).  Le programme utilisateur est responsable de la communication avec le r√©cepteur GPS lui-m√™me et transmet les cha√Ænes NMEA ou les coordonn√©es pr√™tes √† l'objet gps. <br><br>  L'objet de tonte (omower-mow.h) est responsable du moteur de cisaillement et de son palan actionneur avec un moteur pas √† pas (le cas √©ch√©ant).  L'utilisateur indique √† quelle vitesse tourner et quelle hauteur de coupe r√©gler. <br><br>  L'objet pwmServo (omower-pwmservo.h) contr√¥le les sorties PWM-A / B / C / D / E / F / G / H (cela ne peut pas √™tre fait via d'autres biblioth√®ques en raison de conflits possibles avec les temporisateurs). <br><br>  L'objet de puissance (omower-power.h) est charg√© de contr√¥ler les r√©gulateurs de charge et de convertir les valeurs ADC en volts et amp√®res que tout le monde comprend.  Le programme utilisateur doit d√©tecter l'apparition de tension sur les √©lectrodes de charge et appeler la fonction d'activation de la charge, puis il r√©cup√©rera les cycles PWM des r√©gulateurs pour correspondre au courant de charge. <br><br>  √âtant donn√© que l'utilisation d'objets Arduin Serial * standard peut interrompre le traitement des interruptions (voir ci-dessous), il existe un objet s√©rie (omower-serial.h) pour lire et transmettre les ports s√©rie.  Malheureusement, le m√™me probl√®me existe avec les bus I2C, ils doivent √™tre utilis√©s en utilisant les fonctions d√©finies dans due-i2c-blocking.h. <br><br>  Les fonctions des autres objets sont claires par leur nom, vous pouvez simplement regarder les commentaires dans les fichiers d'en-t√™te (omower-sonars.h, omower-rtc.h, omower-current * .h, omower-odometry.h, etc.). <br><br>  Maintenant sur les interruptions au niveau le plus bas.  L'objet ch√¢ssis (omower-chassis.h) configure TIM7 √† 100 interruptions par seconde.  √Ä chaque interruption, 12 canaux de la puce ADC MAX11617 sont lus (entr√©s dans un tableau sp√©cial, d'o√π les objets SDK OMower lisent leurs valeurs - max11617-adc-scan.h).  √Ä chaque seconde - une interruption logicielle est g√©n√©r√©e pour le crochet de fonction poll50 (), √† chaque cinqui√®me - poll20 (), √† chaque dixi√®me - poll10 ().  Ils fonctionnent tous de mani√®re asynchrone (ce qui est pratique, mais impose des restrictions sur l'utilisation du bus I2C, plus tard, je pr√©vois d'y ajouter des transactions / s√©maphores). <br><br>  Le temporisateur TIM5 est √©galement configur√© pour g√©n√©rer des interruptions avec une fr√©quence de 38462 hertz.  √Ä partir de cette interruption, tous les canaux du contr√¥leur ADC interne sont lus et entr√©s dans un tableau sp√©cial (il prend √©galement en charge la saisie de chaque valeur re√ßue pour le tampon s√©lectionn√© dans le tampon en anneau, ce qui est fait, par exemple, par la classe de p√©rim√®tre, en filtrant ces √©chantillons plus tard en utilisant la transform√©e de Fourier). <br><br>  Pour g√©n√©rer des informations de d√©bogage, il existe une fonction debug () avec une priorit√© minimale pour l'affichage des messages (c'est-√†-dire que le d√©bogage n'est pas effectu√©, rien ne sera √©mis vers la console, mais √† tout moment vous pouvez activer au moins le niveau maximum, il sera spamm√©).  Dans les formats de valeurs de d√©bogage (* format printf), les nombres √† virgule flottante sont pris en charge (contrairement aux fonctions Arduin standard). <br><br>  Mise √† jour: La nouvelle quatri√®me version de la carte OMower, jusqu'√† pr√©sent uniquement un circuit (en attente de la fabrication du PCB).  Comprend en outre une boussole / acc√©l√©rom√®tre MPU9250, 128 kilo-octets de F-RAM pour enregistrer les param√®tres, les cartes, les waypoints et autres choses, tous les connecteurs avec verrous (Molex 22-11-20x3 / 10-11-20x3, compatible avec l'ancienne version √† partir d'un 2.54- broches), convertisseurs de niveau logique 74HC4050 pour sonars et odom√®tres, convertisseurs de puissance 3,3 / 5 volts plus puissants (jusqu'√† trois amp√®res), deux sorties PWM / PPM suppl√©mentaires sur les connecteurs, lignes s√©par√©es pour un contr√¥le ind√©pendant du deuxi√®me pilote de moteur pas √† pas, plus de condensateurs tampons pour la stabilit√© Grands √©l√©ments CMS pour un assemblage facile  des modifications mineures. <br><br> <a href=""><img src="https://habrastorage.org/webt/xz/r_/sr/xzr_srcxrfx72fdh4nvtuaqgjuo.png"></a> <br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr409515/">https://habr.com/ru/post/fr409515/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr409503/index.html">Nouvel an, nouveaux records: 50e prime de Mersenne retrouv√©e</a></li>
<li><a href="../fr409505/index.html">Tapis de souris en verre √† faire soi-m√™me</a></li>
<li><a href="../fr409507/index.html">Le record de bruit blanc sur YouTube a re√ßu cinq r√©clamations de cinq d√©tenteurs de droits d'auteur diff√©rents</a></li>
<li><a href="../fr409509/index.html">Les chercheurs pensent qu'un bot a augment√© le prix du bitcoin de 150 $ √† 1000 $</a></li>
<li><a href="../fr409511/index.html">SORM au d√©triment des op√©rateurs, et Yarovaya?</a></li>
<li><a href="../fr409517/index.html">L'esprit a commenc√© quand les dieux ont cess√© de parler</a></li>
<li><a href="../fr409519/index.html">T√©lescope James Webb v√©rifi√© par des temp√©ratures ultra-basses et un vide</a></li>
<li><a href="../fr409521/index.html">Nouveaux stabilisateurs DJI Osmo Mobile 2 et Ronin-S</a></li>
<li><a href="../fr409523/index.html">Conversation avec la voiture: la capacit√© d'entendre et d'√©couter</a></li>
<li><a href="../fr409525/index.html">Comment une seule entreprise peut repousser les limites de ce qui est possible dans le domaine des v√©hicules a√©riens sans pilote</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>