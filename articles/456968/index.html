<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>丘勇 游꺒 游꼖 Historia simple detr치s de tokens de actualizaci칩n y acceso 游땢 游댇 游닜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hoy en d칤a, el esquema de seguridad que se basa en dos tokens es bastante com칰n. Hay mucha informaci칩n sobre el tema en Internet. A menudo solo hay un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Historia simple detr치s de tokens de actualizaci칩n y acceso</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456968/"><p>  Hoy en d칤a, el esquema de seguridad que se basa en dos tokens es bastante com칰n.  Hay mucha informaci칩n sobre el tema en Internet.  A menudo solo hay una descripci칩n de qu칠 son los tokens de actualizaci칩n y acceso y c칩mo usarlos. </p><br><p>  Para comprender el concepto detr치s de los tokens, me gustar칤a hacer un experimento de pensamiento simple. </p><a name="habracut"></a><br><p>  Imaginemos que usted es un estudiante al que le gusta el dinero pero a menudo tiene alrededor de cero en el saldo de su cuenta. </p><br><p>  En el camino a su universidad, abre la aplicaci칩n m칩vil de su banco para verificar el saldo de su cuenta. </p><br><p>  Para mostrarle que una aplicaci칩n de saldo necesita ejecutar una solicitud al servidor del banco: </p><br><p><code>GET http://api.mybank.com/balance HTTP 1.1</code> <br>  y recibe respuesta </p><br><p> <code>{ balance: '$0.0' }</code> </p> <br><p><img src="https://habrastorage.org/getpro/habr/post_images/34e/6c1/118/34e6c1118c8eab96d9cf2f1fb5e08381.jpg" alt="imagen"></p><br><p>  Ser칤a bueno si nadie, excepto usted, pudiera verificar su cuenta bancaria.  Para hacerlo, agreguemos un encabezado especial con el nombre de usuario y su contrase침a 칰nica: </p><br><p>  `Autorizaci칩n: Nombre de usuario Contrase침a </p><br><p>  Autorizaci칩n: JohnDwayson QWERTY1` </p><br><p>  Ahora el servidor puede autenticarlo con su nombre de usuario y contrase침a personales.  Significa que el par JohnDwayson QWERTY1 debe mantenerse en un lugar secreto en su tel칠fono m칩vil para protegerse de alguien a quien no se le permite gastar su dinero.  Ser칤a a칰n mejor si pudi칠ramos evitar almacenar la contrase침a pero nadie quiere ingresarla con demasiada frecuencia. </p><br><p>  Cuando usamos nuestra aplicaci칩n m칩vil durante 30 minutos en un autob칰s, enviar치 su contrase침a a trav칠s de la red muchas veces en 30 minutos. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/6ce/bf9/719/6cebf9719d878e3dafb4886da36f602e.jpg" alt="imagen"></p><br><p>  Cada requset contiene contrase침a <br>  Continuemos nuestro experimento mental.  Todav칤a est치s en un autob칰s y tu aplicaci칩n env칤a una solicitud al servidor. </p><br><p>  쯈u칠 sucede si hay un fraude a su alrededor en un autob칰s y 칠l puede interceptar uno o pocos paquetes http desde su tel칠fono m칩vil al servidor del banco? </p><br><p>  Si la aplicaci칩n actualiza la informaci칩n cada minuto, el fraude tendr치 30 posibilidades para cruzar las solicitudes y obtener su contrase침a. </p><br><p>  Supongamos que rob칩 5-6 mensajes.  Su contrase침a ahora est치 comprometida y el fraude puede usarla para acceder a la informaci칩n de su cuenta. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/7b9/a22/be2/7b9a22be2ee33521e8dfe0f47f0efcab.jpg" alt="imagen"></p><br><p>  El hombre en el medio puede escuchar la contrase침a <br>  쯈u칠 puede hacer 칠l con esta informaci칩n?  Buenas noticias de que no puede gastar su dinero ya que usted no lo tiene ... todav칤a :) Tampoco puede cambiar su contrase침a, ya que en este caso lo notar치 y puede usar SMS de un banco para recuperar la contrase침a.  La antigua contrase침a robada en este caso ya no ser치 v치lida y el estudiante ahorrar치 su dinero </p><br><p>  Pero lo que puede hacer es seguir revisando su saldo en paralelo con usted.  Puede escribir f치cilmente un script de Python que verificar치 su cuenta cada 10 segundos y tan pronto como reciba dinero, puede gastar cada centavo para comprar bitcoins.  Probablemente sea peor si su gui칩n gastara entre 5 y 10 d칩lares cada d칤a, y es probable que no se note durante los meses o a침os. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b87/89e/74e/b8789e74e3f8ae941983355ea3dedb97.jpg" alt="imagen"></p><br><p>  Hacker espera tu dinero <br>  Para evitar esto, podemos pedirle al usuario que cambie su contrase침a despu칠s de un tiempo.  Digamos que la contrase침a ser치 v치lida por 3 meses.  Lo bueno es que despu칠s de 3 meses perder치 el acceso a su cuenta.  Lo malo es que perder치 el acceso a su cuenta solo despu칠s de 3 meses.  Obviamente, para evitar esto, podemos pedirle que cambie su contrase침a cada mes o semana.  Pero puede ser molesto para los usuarios finales. </p><br><p>  Ser칤a bueno si no usamos nuestra contrase침a con demasiada frecuencia en nuestras solicitudes.  Para hacerlo, podemos presentar un punto final especial: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://api.mybank.com/login</a> .  Vamos a enviar nuestras credenciales solo a este punto final y, a cambio, el servidor generar치 para nosotros un token especial.  Sea solo una cadena 칰nica, GUID, que el servidor almacena en su base de datos.  Llamemos a esta cadena 칰nica es token de acceso.  Lo usaremos en lugar de nuestro nombre de usuario y contrase침a en el encabezado de cada solicitud de conversaci칩n con el servidor.  Similar a la contrase침a, configuremos el tiempo de vencimiento para el token de acceso. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/392/944/d8f/392944d8f66fb4563d637793b335c552.jpg" alt="imagen"></p><br><p>  Para actualizar el saldo no necesitamos una contrase침a <br>  Reproduzcamos nuestro experimento mental. </p><br><p>  Estamos en el autob칰s y alguien rob칩 nuestra solicitud http para verificar el saldo.  Pero ahora el fraude solo tiene token de acceso. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/fcf/0e8/1d2/fcf0e81d2b2bc322b7921606dab4a6a4.jpg" alt="imagen"></p><br><p>  No es suficiente robar solo token de acceso <br>  쯈u칠 hacker puede hacer ahora con esta informaci칩n?  En primer lugar, 칠l todav칤a no puede gastar su dinero.  En segundo lugar, no puede cambiar la contrase침a, ya que simplemente no la conoce.  Adem치s, ahora el tiempo de vencimiento de la contrase침a y el token de acceso es dos configuraciones separadas.  Podemos dejar el tiempo de caducidad de la contrase침a como 3 meses y debemos elegir la caducidad del token de acceso.  Nos gustar칤a establecer este tiempo lo m치s corto posible, porque para obtener un nuevo token de acceso no podemos usar el token en s칤.  Si alguien roba esta ficha, podr치 renovarla todo el tiempo que quiera. </p><br><p>  Cuando el token de acceso caduca, para obtener uno nuevo debemos enviar nuevamente las credenciales de usuario.  Si est치 en un autob칰s durante los 30 minutos y su tiempo de vencimiento para el token de acceso es de 15 minutos, debe enviar su contrase침a al menos 2 veces.  Por lo general, queremos actualizar el token de acceso antes, digamos cada 10 minutos, de lo contrario, el usuario puede notar algunos retrasos para obtener un nuevo token.  Adem치s, resuelve el problema cuando fallan pocas solicitudes al mismo tiempo debido al token caducado y debemos volver a intentarlo en el orden correcto despu칠s de obtener un token nuevo. </p><br><p>  Ahora los resultados son mejores.  El fraude tiene acceso a nuestros datos solo durante 10 minutos en lugar de 3 meses.  Pero todav칤a tiene un buen cambio para robar nuestra contrase침a y es posible que no nos demos cuenta hasta que robe nuestro dinero. </p><br><p>  El problema ahora es obtener el token de acceso, a칰n necesitamos la contrase침a.  쯈u칠 pasa si vamos a generar una cadena 칰nica m치s?  Un token especial utilizado solo para obtener token de acceso. </p><br><p>  Para lograr esto, nuestro punto final de inicio de sesi칩n debe aceptar nombre de usuario y contrase침a y devolver un nuevo token llamado token de actualizaci칩n.  Que almacenaremos en nuestra aplicaci칩n m칩vil.  El token de actualizaci칩n puede tener un tiempo de vencimiento m치s largo, por ejemplo, un mes. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/51f/780/30c/51f78030c23d685c5a8d5d5267f671ab.jpg" alt="imagen"></p><br><p>  Renueve el flujo para los tokens de actualizaci칩n y acceso <br>  Cada vez que necesitamos renovar el token de acceso, necesitamos enviar solo un token de actualizaci칩n.  Por lo tanto, nuestra contrase침a se enviar치 al servidor solo una vez al mes o rara vez.  B치sicamente solo necesitamos contrase침a solo para recuperar el primer token de actualizaci칩n. </p><br><p>  Todav칤a necesitamos token de acceso para ejecutar solicitudes para obtener algunos datos del servidor.  Entonces </p><br><p> <code>POST /login with username and password returns us refresh token</code> <br> <code>POST /renew with refresh token returns us access token</code> <br> <code>POST /balance with access token returns us actual balance</code> </p> <br><p>  Repitamos nuestro experimento nuevamente. </p><br><p>  Estamos en un bus  Nuestro estudiante est치 revisando su saldo. </p><br><p>  Pero ahora nuestra aplicaci칩n utiliza un token de actualizaci칩n que se almacena en alg칰n lugar de un archivo en el tel칠fono m칩vil. </p><br><p>  La aplicaci칩n est치 enviando solicitudes como: </p><br><p> <code>POST /renew</code> <br> <code>GET /balance</code> <br> <code>GET /balance</code> <br> <code>GET /balance</code> <br> <code>POST /renew</code> <br> <code>GET /balance</code> <br> <code>GET /balance</code> <br> <code>GET /balance</code> </p> <br><p>  Como antes, el pirata inform치tico se cruza con pocas solicitudes con token de acceso en un bus. </p><br><p>  Como el tiempo de vencimiento para el token de acceso es de 15 minutos y estamos actualizando los tokens cada 10 minutos. </p><br><p>  El hacker puede usar informaci칩n robada solo por 10 minutos o menos. </p><br><p>  쯈u칠 sucede si se cruza con una de las solicitudes / renovar y tiene token de actualizaci칩n y acceso?  Te칩ricamente, puede usar el token de actualizaci칩n durante un mes para obtener nuevos tokens de acceso y a칰n as칤 poder robar dinero. </p><br><p>  Pero si regeneramos ambos tokens en cada solicitud de renovaci칩n / y el servidor almacena solo un token de actualizaci칩n a la vez.  La copia de fraude del token de actualizaci칩n tambi칠n se volvi칩 inv치lida en 10 minutos y no puede usarla sin avisarnos que el token est치 comprometido.  Si intenta renovar el token, invalidar치 nuestro token y nos veremos obligados a volver a iniciar sesi칩n. </p><br><p>  Una ventaja m치s del token de actualizaci칩n es que no necesitamos almacenar la contrase침a en una aplicaci칩n o navegador y solo almacenamos el 칰ltimo token de actualizaci칩n. </p><br><p>  Lo interesante es que el token de acceso no puede ser solo una cadena aleatoria, sino que puede contener informaci칩n 칰til.  Por ejemplo, puede ser tiempo de vencimiento, ID de usuario y rol de usuario.  En este caso, se denomina token aut칩nomo y el servidor no necesita acceso a la base de datos para validar el token y los permisos del usuario.  Puede ser muy 칰til en microservicios ya que puede aumentar el rendimiento y disminuir el acoplamiento entre microservicios. </p><br><p>  Est치 un poco fuera del tema del art칤culo, pero vale la pena mencionar el <code>scope</code> . <br>  쯈u칠 sucede si pediremos / renovaremos el punto final solo para el token de acceso que puede usarse exclusivamente para verificar el saldo? <br>  Si el usuario quiere gastar algo de dinero, 쯗eber칤a recibir un segundo token diferente por eso?  Podemos llamar a este par치metro 'alcance'. <br>  Entonces podemos pedir / renovar? Scope = [balance, noticias].  Si nuestro pirata inform치tico a칰n conserva este token, 춰no puede usarlo para gastar nuestro dinero! </p><br><p>  La idea basada en dos tokens brinda una mayor seguridad de uso que solo una contrase침a o un token por dise침o.  En lugar de elegir una contrase침a m치s larga o algoritmos de seguridad m치s fuertes. </p><br><p>  Esta fue mi explicaci칩n del concepto b치sico detr치s de los tokens y c칩mo funcionan. </p><br><p>  En una pr치ctica, hay algunas implementaciones diferentes de este concepto que se pueden buscar f치cilmente en Google. </p><br><p>  Peque침a nota sobre la flexibilidad para elegir un tiempo de vencimiento para la contrase침a y los tokens. </p><br><p>  El tiempo de vencimiento t칤pico puede ser: </p><br><p>  Para la contrase침a es de 3 a 6 meses.  Es bueno tener esta limitaci칩n.  Como las bases de datos pueden ser robadas y el usuario puede reutilizar la misma contrase침a en todos los servicios. </p><br><p>  Para el token de actualizaci칩n, el tiempo de vencimiento puede ser de aproximadamente una semana o un mes.  Para las personas que trabajan en una oficina con alg칰n sitio web, es 칰til tener este tiempo al menos m치s de un fin de semana.  De lo contrario, deben ingresar la contrase침a todos los lunes. </p><br><p>  El tiempo de vencimiento del token de acceso puede estar en un rango de 10 a 60 minutos.  Un tiempo m치s corto requiere m치s solicitudes de renovaci칩n, pero un tiempo m치s largo puede dar m치s posibilidades de fraude. </p><br><p>  <b>Conclusi칩n</b> </p><br><p>  Necesitamos usar una contrase침a para obtener un token de actualizaci칩n de larga duraci칩n.  Luego env칤e un token de actualizaci칩n para obtener un token de acceso de corta duraci칩n.  Que utilizar token de acceso para ejecutar solicitudes 칰tiles. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/456968/">https://habr.com/ru/post/456968/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../456948/index.html">Webinar grupal del IB el 27 de junio, "C칩mo contrarrestar los ataques de ingenier칤a social: 쮺칩mo reconocer los trucos de los piratas inform치ticos y defenderse de ellos?"</a></li>
<li><a href="../456956/index.html">WWDC19: una mirada al interior</a></li>
<li><a href="../456958/index.html">Libros electr칩nicos y sus formatos: hablando de EPUB: su historia, pros y contras</a></li>
<li><a href="../456962/index.html">Datos del museo Art. Bobinas con OS 6.1 para computadoras EC</a></li>
<li><a href="../456966/index.html">NAS arrogante</a></li>
<li><a href="../456972/index.html">5 excelentes formas de animar aplicaciones React en 2019</a></li>
<li><a href="../456974/index.html">Creaci칩n de prototipos en realidad virtual: 5 formas de probar una hip칩tesis</a></li>
<li><a href="../456976/index.html">Gett support. 쮺칩mo hacemos que todo funcione?</a></li>
<li><a href="../456980/index.html">Stand-up, Scrum, Reuniones diarias: qu칠 es y por qu칠</a></li>
<li><a href="../456982/index.html">Los sistemas de radionavegaci칩n utilizados por las aeronaves para un aterrizaje seguro son inseguros y propensos a agrietarse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>