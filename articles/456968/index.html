<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⚓️ 🌯 🍇 Historia simple detrás de tokens de actualización y acceso 😘 🔈 📶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hoy en día, el esquema de seguridad que se basa en dos tokens es bastante común. Hay mucha información sobre el tema en Internet. A menudo solo hay un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Historia simple detrás de tokens de actualización y acceso</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456968/"><p>  Hoy en día, el esquema de seguridad que se basa en dos tokens es bastante común.  Hay mucha información sobre el tema en Internet.  A menudo solo hay una descripción de qué son los tokens de actualización y acceso y cómo usarlos. </p><br><p>  Para comprender el concepto detrás de los tokens, me gustaría hacer un experimento de pensamiento simple. </p><a name="habracut"></a><br><p>  Imaginemos que usted es un estudiante al que le gusta el dinero pero a menudo tiene alrededor de cero en el saldo de su cuenta. </p><br><p>  En el camino a su universidad, abre la aplicación móvil de su banco para verificar el saldo de su cuenta. </p><br><p>  Para mostrarle que una aplicación de saldo necesita ejecutar una solicitud al servidor del banco: </p><br><p><code>GET http://api.mybank.com/balance HTTP 1.1</code> <br>  y recibe respuesta </p><br><p> <code>{ balance: '$0.0' }</code> </p> <br><p><img src="https://habrastorage.org/getpro/habr/post_images/34e/6c1/118/34e6c1118c8eab96d9cf2f1fb5e08381.jpg" alt="imagen"></p><br><p>  Sería bueno si nadie, excepto usted, pudiera verificar su cuenta bancaria.  Para hacerlo, agreguemos un encabezado especial con el nombre de usuario y su contraseña única: </p><br><p>  `Autorización: Nombre de usuario Contraseña </p><br><p>  Autorización: JohnDwayson QWERTY1` </p><br><p>  Ahora el servidor puede autenticarlo con su nombre de usuario y contraseña personales.  Significa que el par JohnDwayson QWERTY1 debe mantenerse en un lugar secreto en su teléfono móvil para protegerse de alguien a quien no se le permite gastar su dinero.  Sería aún mejor si pudiéramos evitar almacenar la contraseña pero nadie quiere ingresarla con demasiada frecuencia. </p><br><p>  Cuando usamos nuestra aplicación móvil durante 30 minutos en un autobús, enviará su contraseña a través de la red muchas veces en 30 minutos. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/6ce/bf9/719/6cebf9719d878e3dafb4886da36f602e.jpg" alt="imagen"></p><br><p>  Cada requset contiene contraseña <br>  Continuemos nuestro experimento mental.  Todavía estás en un autobús y tu aplicación envía una solicitud al servidor. </p><br><p>  ¿Qué sucede si hay un fraude a su alrededor en un autobús y él puede interceptar uno o pocos paquetes http desde su teléfono móvil al servidor del banco? </p><br><p>  Si la aplicación actualiza la información cada minuto, el fraude tendrá 30 posibilidades para cruzar las solicitudes y obtener su contraseña. </p><br><p>  Supongamos que robó 5-6 mensajes.  Su contraseña ahora está comprometida y el fraude puede usarla para acceder a la información de su cuenta. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/7b9/a22/be2/7b9a22be2ee33521e8dfe0f47f0efcab.jpg" alt="imagen"></p><br><p>  El hombre en el medio puede escuchar la contraseña <br>  ¿Qué puede hacer él con esta información?  Buenas noticias de que no puede gastar su dinero ya que usted no lo tiene ... todavía :) Tampoco puede cambiar su contraseña, ya que en este caso lo notará y puede usar SMS de un banco para recuperar la contraseña.  La antigua contraseña robada en este caso ya no será válida y el estudiante ahorrará su dinero </p><br><p>  Pero lo que puede hacer es seguir revisando su saldo en paralelo con usted.  Puede escribir fácilmente un script de Python que verificará su cuenta cada 10 segundos y tan pronto como reciba dinero, puede gastar cada centavo para comprar bitcoins.  Probablemente sea peor si su guión gastara entre 5 y 10 dólares cada día, y es probable que no se note durante los meses o años. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b87/89e/74e/b8789e74e3f8ae941983355ea3dedb97.jpg" alt="imagen"></p><br><p>  Hacker espera tu dinero <br>  Para evitar esto, podemos pedirle al usuario que cambie su contraseña después de un tiempo.  Digamos que la contraseña será válida por 3 meses.  Lo bueno es que después de 3 meses perderá el acceso a su cuenta.  Lo malo es que perderá el acceso a su cuenta solo después de 3 meses.  Obviamente, para evitar esto, podemos pedirle que cambie su contraseña cada mes o semana.  Pero puede ser molesto para los usuarios finales. </p><br><p>  Sería bueno si no usamos nuestra contraseña con demasiada frecuencia en nuestras solicitudes.  Para hacerlo, podemos presentar un punto final especial: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://api.mybank.com/login</a> .  Vamos a enviar nuestras credenciales solo a este punto final y, a cambio, el servidor generará para nosotros un token especial.  Sea solo una cadena única, GUID, que el servidor almacena en su base de datos.  Llamemos a esta cadena única es token de acceso.  Lo usaremos en lugar de nuestro nombre de usuario y contraseña en el encabezado de cada solicitud de conversación con el servidor.  Similar a la contraseña, configuremos el tiempo de vencimiento para el token de acceso. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/392/944/d8f/392944d8f66fb4563d637793b335c552.jpg" alt="imagen"></p><br><p>  Para actualizar el saldo no necesitamos una contraseña <br>  Reproduzcamos nuestro experimento mental. </p><br><p>  Estamos en el autobús y alguien robó nuestra solicitud http para verificar el saldo.  Pero ahora el fraude solo tiene token de acceso. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/fcf/0e8/1d2/fcf0e81d2b2bc322b7921606dab4a6a4.jpg" alt="imagen"></p><br><p>  No es suficiente robar solo token de acceso <br>  ¿Qué hacker puede hacer ahora con esta información?  En primer lugar, él todavía no puede gastar su dinero.  En segundo lugar, no puede cambiar la contraseña, ya que simplemente no la conoce.  Además, ahora el tiempo de vencimiento de la contraseña y el token de acceso es dos configuraciones separadas.  Podemos dejar el tiempo de caducidad de la contraseña como 3 meses y debemos elegir la caducidad del token de acceso.  Nos gustaría establecer este tiempo lo más corto posible, porque para obtener un nuevo token de acceso no podemos usar el token en sí.  Si alguien roba esta ficha, podrá renovarla todo el tiempo que quiera. </p><br><p>  Cuando el token de acceso caduca, para obtener uno nuevo debemos enviar nuevamente las credenciales de usuario.  Si está en un autobús durante los 30 minutos y su tiempo de vencimiento para el token de acceso es de 15 minutos, debe enviar su contraseña al menos 2 veces.  Por lo general, queremos actualizar el token de acceso antes, digamos cada 10 minutos, de lo contrario, el usuario puede notar algunos retrasos para obtener un nuevo token.  Además, resuelve el problema cuando fallan pocas solicitudes al mismo tiempo debido al token caducado y debemos volver a intentarlo en el orden correcto después de obtener un token nuevo. </p><br><p>  Ahora los resultados son mejores.  El fraude tiene acceso a nuestros datos solo durante 10 minutos en lugar de 3 meses.  Pero todavía tiene un buen cambio para robar nuestra contraseña y es posible que no nos demos cuenta hasta que robe nuestro dinero. </p><br><p>  El problema ahora es obtener el token de acceso, aún necesitamos la contraseña.  ¿Qué pasa si vamos a generar una cadena única más?  Un token especial utilizado solo para obtener token de acceso. </p><br><p>  Para lograr esto, nuestro punto final de inicio de sesión debe aceptar nombre de usuario y contraseña y devolver un nuevo token llamado token de actualización.  Que almacenaremos en nuestra aplicación móvil.  El token de actualización puede tener un tiempo de vencimiento más largo, por ejemplo, un mes. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/51f/780/30c/51f78030c23d685c5a8d5d5267f671ab.jpg" alt="imagen"></p><br><p>  Renueve el flujo para los tokens de actualización y acceso <br>  Cada vez que necesitamos renovar el token de acceso, necesitamos enviar solo un token de actualización.  Por lo tanto, nuestra contraseña se enviará al servidor solo una vez al mes o rara vez.  Básicamente solo necesitamos contraseña solo para recuperar el primer token de actualización. </p><br><p>  Todavía necesitamos token de acceso para ejecutar solicitudes para obtener algunos datos del servidor.  Entonces </p><br><p> <code>POST /login with username and password returns us refresh token</code> <br> <code>POST /renew with refresh token returns us access token</code> <br> <code>POST /balance with access token returns us actual balance</code> </p> <br><p>  Repitamos nuestro experimento nuevamente. </p><br><p>  Estamos en un bus  Nuestro estudiante está revisando su saldo. </p><br><p>  Pero ahora nuestra aplicación utiliza un token de actualización que se almacena en algún lugar de un archivo en el teléfono móvil. </p><br><p>  La aplicación está enviando solicitudes como: </p><br><p> <code>POST /renew</code> <br> <code>GET /balance</code> <br> <code>GET /balance</code> <br> <code>GET /balance</code> <br> <code>POST /renew</code> <br> <code>GET /balance</code> <br> <code>GET /balance</code> <br> <code>GET /balance</code> </p> <br><p>  Como antes, el pirata informático se cruza con pocas solicitudes con token de acceso en un bus. </p><br><p>  Como el tiempo de vencimiento para el token de acceso es de 15 minutos y estamos actualizando los tokens cada 10 minutos. </p><br><p>  El hacker puede usar información robada solo por 10 minutos o menos. </p><br><p>  ¿Qué sucede si se cruza con una de las solicitudes / renovar y tiene token de actualización y acceso?  Teóricamente, puede usar el token de actualización durante un mes para obtener nuevos tokens de acceso y aún así poder robar dinero. </p><br><p>  Pero si regeneramos ambos tokens en cada solicitud de renovación / y el servidor almacena solo un token de actualización a la vez.  La copia de fraude del token de actualización también se volvió inválida en 10 minutos y no puede usarla sin avisarnos que el token está comprometido.  Si intenta renovar el token, invalidará nuestro token y nos veremos obligados a volver a iniciar sesión. </p><br><p>  Una ventaja más del token de actualización es que no necesitamos almacenar la contraseña en una aplicación o navegador y solo almacenamos el último token de actualización. </p><br><p>  Lo interesante es que el token de acceso no puede ser solo una cadena aleatoria, sino que puede contener información útil.  Por ejemplo, puede ser tiempo de vencimiento, ID de usuario y rol de usuario.  En este caso, se denomina token autónomo y el servidor no necesita acceso a la base de datos para validar el token y los permisos del usuario.  Puede ser muy útil en microservicios ya que puede aumentar el rendimiento y disminuir el acoplamiento entre microservicios. </p><br><p>  Está un poco fuera del tema del artículo, pero vale la pena mencionar el <code>scope</code> . <br>  ¿Qué sucede si pediremos / renovaremos el punto final solo para el token de acceso que puede usarse exclusivamente para verificar el saldo? <br>  Si el usuario quiere gastar algo de dinero, ¿debería recibir un segundo token diferente por eso?  Podemos llamar a este parámetro 'alcance'. <br>  Entonces podemos pedir / renovar? Scope = [balance, noticias].  Si nuestro pirata informático aún conserva este token, ¡no puede usarlo para gastar nuestro dinero! </p><br><p>  La idea basada en dos tokens brinda una mayor seguridad de uso que solo una contraseña o un token por diseño.  En lugar de elegir una contraseña más larga o algoritmos de seguridad más fuertes. </p><br><p>  Esta fue mi explicación del concepto básico detrás de los tokens y cómo funcionan. </p><br><p>  En una práctica, hay algunas implementaciones diferentes de este concepto que se pueden buscar fácilmente en Google. </p><br><p>  Pequeña nota sobre la flexibilidad para elegir un tiempo de vencimiento para la contraseña y los tokens. </p><br><p>  El tiempo de vencimiento típico puede ser: </p><br><p>  Para la contraseña es de 3 a 6 meses.  Es bueno tener esta limitación.  Como las bases de datos pueden ser robadas y el usuario puede reutilizar la misma contraseña en todos los servicios. </p><br><p>  Para el token de actualización, el tiempo de vencimiento puede ser de aproximadamente una semana o un mes.  Para las personas que trabajan en una oficina con algún sitio web, es útil tener este tiempo al menos más de un fin de semana.  De lo contrario, deben ingresar la contraseña todos los lunes. </p><br><p>  El tiempo de vencimiento del token de acceso puede estar en un rango de 10 a 60 minutos.  Un tiempo más corto requiere más solicitudes de renovación, pero un tiempo más largo puede dar más posibilidades de fraude. </p><br><p>  <b>Conclusión</b> </p><br><p>  Necesitamos usar una contraseña para obtener un token de actualización de larga duración.  Luego envíe un token de actualización para obtener un token de acceso de corta duración.  Que utilizar token de acceso para ejecutar solicitudes útiles. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/456968/">https://habr.com/ru/post/456968/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../456948/index.html">Webinar grupal del IB el 27 de junio, "Cómo contrarrestar los ataques de ingeniería social: ¿Cómo reconocer los trucos de los piratas informáticos y defenderse de ellos?"</a></li>
<li><a href="../456956/index.html">WWDC19: una mirada al interior</a></li>
<li><a href="../456958/index.html">Libros electrónicos y sus formatos: hablando de EPUB: su historia, pros y contras</a></li>
<li><a href="../456962/index.html">Datos del museo Art. Bobinas con OS 6.1 para computadoras EC</a></li>
<li><a href="../456966/index.html">NAS arrogante</a></li>
<li><a href="../456972/index.html">5 excelentes formas de animar aplicaciones React en 2019</a></li>
<li><a href="../456974/index.html">Creación de prototipos en realidad virtual: 5 formas de probar una hipótesis</a></li>
<li><a href="../456976/index.html">Gett support. ¿Cómo hacemos que todo funcione?</a></li>
<li><a href="../456980/index.html">Stand-up, Scrum, Reuniones diarias: qué es y por qué</a></li>
<li><a href="../456982/index.html">Los sistemas de radionavegación utilizados por las aeronaves para un aterrizaje seguro son inseguros y propensos a agrietarse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>