<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê≠ üò§ üîè Couchbase bei Telecom üé• üëÇüèº üòë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die digitale Transformation ist ein globaler Trend f√ºr gro√üe Unternehmen und f√ºr die Anpassung eines Unternehmens an moderne Kundenbed√ºrfnisse von ent...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Couchbase bei Telecom</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436762/"><p>  Die digitale Transformation ist ein globaler Trend f√ºr gro√üe Unternehmen und f√ºr die Anpassung eines Unternehmens an moderne Kundenbed√ºrfnisse von entscheidender Bedeutung.  Neben den √ºblichen Problemen der Zentralisierung von Systemen f√ºr gro√üe Unternehmen und der Kombination von Abrechnungssystemen und Abonnentendatenbanken kommen Anforderungen an eine hohe Verf√ºgbarkeit und eine Echtzeitbetriebsart hinzu, an die Kunden bereits von Branchenf√ºhrern (Google, Amazon, Netflix) gew√∂hnt sind. </p><br><p>  Neue Herausforderungen erfordern neue Technologien und Ans√§tze, die erforderlich sind, um die Zeit f√ºr die Einf√ºhrung von Funktionen zu verk√ºrzen, die f√ºr den Kunden bequem sind, personalisierte kommerzielle Angebote, eine schnelle Reaktion auf die Angebote der Wettbewerber sowie die Kostenkontrolle f√ºr Systeme, IT-Infrastruktur, Rechenzentren und qualifiziertes Personal.  Diese Trends sind auch ein gro√ües Minus: die Komplexit√§t der Architektur und der aufgebl√§hten Transaktionsdatenbanken, die den Informationsfluss und die Verarbeitung von Informationen nicht bew√§ltigen k√∂nnen.  Technologien der vorherigen Generation haben eine vertikale Skalierungsobergrenze.  Beispielsweise wird eine Oracle DBMS-Instanz auf x86-Prozessoren mit einer Last von einer Milliarde Transaktionen pro Tag an der Grenze des leistungsst√§rksten Servers ausgef√ºhrt. </p><br><img src="https://habrastorage.org/webt/ai/bq/m-/aibqm-rewdzdcsg-6vtcbcv36lw.gif"><br><p>  Um einer solchen Belastung standzuhalten, mit der die Internetbranche seit langem konfrontiert ist, wird ein neuer Stapel von Technologien verwendet, z. B. In-Memory-Caches und NoSQL-Datenbanken.  Apple verwendet also Cassandra, Sberbank - Ignite (GridGain), in MegaFon verwenden wir Couchbase und Tarantool. </p><br><p>  MegaFon verwendet verschiedene Architekturmuster f√ºr das In-Memory-DBMS: </p><br><ol><li>  Einfacher Cache, der planm√§√üig oder nach Ereignis aus der Datenbank und den Anwendungen aktualisiert wird </li><li>  Alle √Ñnderungen an der Datenbank werden √ºber den Cache (Durchschreibeskript) vorgenommen, z. B. durch Verbinden eines Oracle-Clients mit DCP Couchbase </li></ol><br><p><a name="habracut"></a>  F√ºr eines unserer Entscheidungsfindungssysteme f√ºr die Lebensdauer des Abonnenten verwenden wir die erste Vorlage, da nur eine Anwendung f√ºr die Gesamtheit der Daten eine Entscheidung trifft und diese an alle Systeme einschlie√ülich der Oracle-Datenbank sendet.  Einer der hellsten F√§lle bei der Verwendung des Lebenszyklus eines Teilnehmers ist das Sperren und Entsperren bei einem negativen Kontostand.  Schlie√ülich m√∂chten alle Teilnehmer von Mobilfunkbetreibern nach dem Auff√ºllen des Guthabens sofort Kontakt aufnehmen und Anrufe t√§tigen.  Dank einer separaten Anwendung und Couchbase konnten wir die Zeit zum Verlassen der Sperre von 90 Sekunden auf 30 Sekunden verk√ºrzen, und dies ist nicht die Grenze.  Nur die Aufzeichnung √ºber die √Ñnderung des Status des Teilnehmers wird in die Hauptdatenbank aufgenommen (Abb. 1). </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lf/to/o5/lftoo5voqj_ycrfngqgwo74_i6w.png"></div><br>  <i>Abbildung 1 (Interaktionsbeispiel)</i> <br><br><p>  Durch den Einsatz neuer Technologien konnten wir die Zeit bis zum Verlassen der Finanzsperre dreimal verk√ºrzen.  Um die aktuellen Ergebnisse zu erhalten, haben wir bei der architektonischen Transformation der Abrechnungsschaltung und bei der Auswahl der NoSQL-Datenbank einen langen Weg zur√ºckgelegt. </p><br><p>  Warum haben wir uns f√ºr Couchbase entschieden?  Daf√ºr gibt es mehrere Gr√ºnde. </p><br><p>  <strong>Leistungsanforderung</strong> </p><br><ol><li>  Verarbeitung von bis zu 200.000 Anfragen pro Sekunde. </li><li>  Die durchschnittliche Antwortzeit (50%) betr√§gt bis zu 5 ms (innerhalb eines einzelnen Rechenzentrums). </li><li>  Die maximale Antwortzeit (99%) betr√§gt bis zu 15 ms (innerhalb eines Rechenzentrums). </li><li>  Maximale Einf√ºgeleistung 500 MB / Sek </li><li>  Maximale Anzahl von Einf√ºgevorg√§ngen 100.000 / s </li><li>  Maximale Anzahl von √Ñnderungsvorg√§ngen (Dokumentaktualisierungen) 100.000 / s </li><li>  Maximale Leistung von √Ñnderungen (Dokumentaktualisierungen) 500 MB / s </li><li>  Maximale Anzahl von Lesevorg√§ngen 100.000 / s </li><li>  Maximale Lesegeschwindigkeit 500 MB / s </li></ol><br><p>  <strong>Hochleistungs-Schl√ºsselsuche und Datenzugriff</strong> </p><br><p>  Das Herzst√ºck von Couchbase ist Distributed Key Vault (KV).  Das KV-Repository ist ein √§u√üerst einfacher Datenverwaltungsansatz, bei dem eine eindeutige Kennung (Schl√ºssel) zusammen mit einer beliebigen Information gespeichert wird.  Das KV-Repository selbst kann alle Daten akzeptieren, sei es ein bin√§rer Blob oder ein JSON-Dokument.  Aufgrund der Einfachheit der KV-Implementierung wird der Datenzugriff mit minimaler Verz√∂gerung sichergestellt.  Wie unsere Erfahrung zeigt, ist die Netzwerklatenz 2-3 Mal h√∂her als die Bereitstellung von Schl√ºsseldaten auf der Couchbase-Seite. </p><br><p>  <strong>Dynamisches Speicherschema (</strong> <strong>JSON)</strong> </p><br><p>  Dokumente werden im JSON-Format auf dem Couchbase-Server gespeichert.  Das Format unterst√ºtzt sowohl grundlegende Datentypen wie Zahlen, Zeichenfolgen und komplexe Typen als auch integrierte W√∂rterb√ºcher und Arrays. </p><br><p>  Das Datenschema in Couchbase ist ein logisches Konstrukt, das von der Anwendung und dem Entwickler definiert wird.  Aufgrund seiner Flexibilit√§t und der M√∂glichkeit, mehrere Optionen zu verwenden, k√∂nnen wir im Dokument ein Tag verwenden, beispielsweise mit Versionsinformationen.  Auf diese Weise kann die Anwendung bestimmen, in welchem ‚Äã‚ÄãModus das Dokument verarbeitet werden soll, und eine reibungslose Migration der Datenbank auf das neue Datenschema sicherstellen. </p><br><p>  <strong>Hohe Verf√ºgbarkeit</strong> </p><br><p>  Einer der Bestandteile eines Informationssystems ist seine Verf√ºgbarkeit.  Couchbase bietet eine hohe Datenverf√ºgbarkeit mit vielen verschiedenen Funktionen.  Eine davon ist die Datenreplikation (die Verteilung mehrerer Kopien von Daten auf verschiedenen Clusterservern), mit der Sie einen Dienst w√§hrend der routinem√§√üigen Wartung oder des Ausfalls einiger Server bereitstellen k√∂nnen. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/5e/jd/3h/5ejd3hwshvqdvwjeuqlovji9ocy.png"></div><br>  <i>Abbildung 2 (Couchbase Server-Replikate)</i> <br><br><p>  Das zweite wichtige Merkmal f√ºr Hochverf√ºgbarkeit ist das interne DCP (Database Change Protocol).  Es bietet eine schnelle √úbertragung von √Ñnderungen an alle Kopien von Daten, Sekund√§rindizes (GSI), cluster√ºbergreifender Replikation (XDCR) und externen Verbrauchern. </p><br><p>  <strong>Bidirektionale Replikation</strong> </p><br><p>  In Unternehmen empfiehlt es sich, Redundanz f√ºr alle Gesch√§ftsprozesse und Ger√§te zu verwenden.  Im Idealfall handelt es sich um eine Sicherung im Aktiv-Aktiv-Modus, wenn automatisch zwischen Problemknoten gewechselt wird.  Die bidirektionale Replikation in Couchbase aktiviert den AA-Modus.  Das Testen der Replikation hat jedoch gezeigt, dass sie nur in nahe gelegenen Rechenzentren wirksam ist.  Bei einem Abstand von mehr als 100 km treten Konflikte auf.  Couchbase verf√ºgt √ºber Konfliktl√∂sungsmechanismen: basierend auf Zeitstempel und Sequenznummer.  Aufgrund der Zeitverz√∂gerung im Netzwerk gelangen veraltete Daten jedoch in die Datenbank.  Wir haben die Verwendung der bidirektionalen Replikation (Cluster-√ºbergreifende Konsistenz) aufgegeben.  Alle √Ñnderungen werden nur in einem Cluster ausgef√ºhrt.  Die Datenverf√ºgbarkeit im Lesemodus wird in allen Rechenzentren (AA) bereitgestellt. </p><br><p>  <strong>Horizontale Skalierung</strong> </p><br><p>  Eines der wichtigsten Merkmale der meisten NoSQL-Datenbanken ist die horizontale Skalierung (Abb. 3).  Der Hauptunterschied von Couchbase ist die Unterst√ºtzung der mehrdimensionalen Skalierung, wenn wir im Cluster nur die Leistung des gew√ºnschten Dienstes steigern k√∂nnen.  Zum Beispiel verwendet das Spiel Pokemon GO eine geteilte Architektur.  Zu Beginn des Projekts wurden 5 Server mit kombinierten Diensten verwendet.  Nachdem sie die Last erh√∂ht hatten, verwendeten sie eine vielf√§ltige Architektur: 5 Datenserver und 55 Server f√ºr die Verarbeitung von Abfragen und Indizes.  Einer der Nachteile der Skalierung mit Couchbase besteht darin, dass der Orchestrator Probleme hat, wenn mehr als 50 Datumsknoten im Cluster vorhanden sind. </p><br><p></p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/79/9c/ne/799cnegj-o20dtxdfcasl3ihm1u.png"></div><br><p>  <i>Abbildung 3 MDB</i> </p><br><p>  <strong>IS-Anforderungen</strong> </p><br><p>  Die Anforderungen an die Informationssicherheit haben unsere Wahl in geringerem Ma√üe beeinflusst, aber ihre Pr√§senz im System hat ein zus√§tzliches Argument f√ºr die eine oder andere Datenbank geliefert.  Da der Cache m√∂glicherweise personenbezogene Daten enth√§lt, m√ºssen wir die Anforderungen des Regulators unbedingt befolgen.  Es lohnt sich zu entscheiden: Werden wir zus√§tzliche Ger√§te verwenden oder k√∂nnen wir diese mit der Datenbank selbst bereitstellen ?! </p><br><p>  In der Unternehmensversion unterst√ºtzt Couchbase die Verkehrsverschl√ºsselung, Datenverschl√ºsselung und den personalisierten Zugriff.  Dies spart Geld bei Ger√§ten wie dem Cisco ASA. </p><br><p>  <strong>Einfaches Upgrade</strong> </p><br><p>  Eine der wesentlichen St√§rken von Couchbase ist der transparente Aktualisierungsmechanismus und die Unterst√ºtzung √§lterer Versionen der API.  W√§hrend des Cluster-Upgrades funktioniert es im Kompatibilit√§tsmodus.  Neue Mechanismen funktionieren erst nach einem vollst√§ndigen Cluster-Upgrade.  Die Auswirkungen auf die Ausf√ºhrung von Anwendungen sind aufgrund der Unterst√ºtzung der alten API minimal. </p><br><p>  <strong>PS:</strong> Upgrade / Downgrade ist nur bei benachbarten Hauptversionen zul√§ssig </p><br><p>  <strong>Zus√§tzliche Funktionalit√§t</strong> </p><br><p>  <em>Logische Verteilung</em> </p><br><p>  Ein weiteres interessantes Feature ist die Kombination von Servern in einem Cluster zu logischen Gruppen, an die Replikate angeh√§ngt sind.  Auf diese Weise k√∂nnen Sie vollst√§ndige Kopien von Replikaten desselben Clusters an verschiedene Autogates verteilen.  Dies erm√∂glicht, dass eines der Autoh√§user keine vollst√§ndige Kopie der Daten in der zweiten hat </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/yf/nf/po/yfnfpots5tbrzzew39w4xsehey8.png"></div><br>  <i>Abbildung 4 Server Gropus</i> <br><br><p>  <b>Sichern &amp; Wiederherstellen</b> </p><br><p>  Couchbase enth√§lt vorgefertigte Sicherungs- und Wiederherstellungstools.  Der Sicherungsprozess kann in drei Modi ausgef√ºhrt werden: vollst√§ndig, differenziell und kumulativ.  Dies erm√∂glicht in einigen F√§llen, Speicherplatz und Prozessorressourcen zu sparen. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xe/in/ff/xeinff0eawasua0xiu4ec3yon1y.png"></div><br><p>  <strong>Couchbase gegen Mongo</strong> </p><br><p>  Es ist schwierig, die Frage nach der Auswahl alternativer NoSQL-Datenbanken zu beantworten, und h√§ufig ist das beste Unix das, das Ihr Administrator kennt.  Versuchen wir zu formulieren, warum wir Couchbase bevorzugen und nicht eine andere sehr beliebte Plattform - MongoDB. </p><br><p>  Es ist ziemlich schwierig, zwei verschiedene Projekte mit unterschiedlicher Architektur und Funktionalit√§t zu vergleichen.  Einer der Parameter, auf die wir geachtet haben, ist die einfache Wartung und die M√∂glichkeit, das System schnell neu zu konfigurieren, um die Anforderungen des Unternehmens zu erf√ºllen. </p><br><p>  Tabelle 1 Vergleich </p><br><table><tbody><tr><td><p><strong>&nbsp;</strong></p><br></td><td><p>  <strong>Couchbase</strong> </p><br></td><td><p>  <strong>Mongodb</strong> </p><br></td></tr><tr><td><p>  <strong>Skalieren</strong> </p><br></td><td><p>  Automatisch f√ºr den gesamten Datensatz </p><br></td><td><p>  Manuelle Tastenauswahl </p><br></td></tr><tr><td><p>  <strong>Datenverteilung</strong> </p><br></td><td><p>  Die Daten werden immer gleichm√§√üig auf alle Datenknoten verteilt. </p><br></td><td><p>  Falsches Markup kann zu einer verzerrten Datenverteilung f√ºhren </p><br></td></tr><tr><td><p>  <strong>Host / Replikat hinzuf√ºgen / entfernen</strong> </p><br></td><td><p>  Es wird in einem Schritt √ºber die GUI mit neuem Ausgleich hinzugef√ºgt </p><br></td><td><p>  Eine ziemlich schwierige Aufgabe mit Gewichtsberechnungen f√ºr jede Sammlung </p><br></td></tr><tr><td><p>  <strong>Rack- / Rechenzentrumsverteilung Verteilung</strong> </p><br></td><td><p>  Implementiert durch logische Gruppen </p><br></td><td><p>  Nicht implementiert </p><br></td></tr><tr><td><p>  <strong>Automatischer Lastausgleich</strong> </p><br></td><td><p>  Jeder Knoten verf√ºgt √ºber die gleiche Anzahl aktiver Datens√§tze zum Lesen und Schreiben. </p><br></td><td><p>  Nicht ausgeglichen.  Sekund√§rknoten unterst√ºtzen keine Aufzeichnung </p><br></td></tr><tr><td><p>  <strong>Indexskalierung</strong> </p><br></td><td><p>  Aufgrund der Vielfalt der Architektur k√∂nnen Sie flexibel einen separaten Knotenindex hinzuf√ºgen </p><br></td><td><p>  Eine harte Skalierung des Index ist mit einer Datenskalierung verbunden. </p><br></td></tr><tr><td><p>  <strong>Cluster-Metadaten</strong> </p><br></td><td><p>  Auf alle Clusterknoten verteilt </p><br></td><td><p>  Konfigurationsserver erforderlich </p><br></td></tr><tr><td><p>  <strong>Integrierte Suche</strong> </p><br></td><td><p>  N1LQ (SQL ++) </p><br></td><td><p>  JSON-Anfrage </p><br></td></tr></tbody></table><br><p>  Tabelle 2 Replikationsvergleich </p><br><table><tbody><tr><td><p><strong>&nbsp;</strong></p><br></td><td><p>  <strong>Couchbase</strong> </p><br></td><td><p>  <strong>Mongodb</strong> </p><br></td></tr><tr><td><p>  <strong>Architektur</strong> </p><br></td><td><p>  Die Intercluster-Replikation hat keine Abh√§ngigkeiten, Cluster sind unabh√§ngig voneinander </p><br></td><td><p>  Nur Intracluster-Erweiterung </p><br></td></tr><tr><td><p>  <strong>Konfigurationsflexibilit√§t</strong> </p><br></td><td><p>  Flexibel (Einrichten einzelner Eimer, Filter, Tuning) </p><br></td><td><p>  Geschwindigkeitsabstimmung </p><br></td></tr><tr><td><p>  <strong>Topologie</strong> </p><br></td><td><p>  Bidirektionale Replikation, Stern, Kette usw. </p><br></td><td><p>  Stern </p><br></td></tr><tr><td><p>  <strong>Aktiv Aktiv Modus</strong> </p><br></td><td><p>  Unterst√ºtzt von </p><br></td><td><p>  Wird nicht unterst√ºtzt </p><br></td></tr></tbody></table><br><p>  Insgesamt ist Couchbase flexibler und einfacher in den f√ºr unsere Aufgaben erforderlichen Einstellungen und der sich schnell √§ndernden Hybridarchitektur. </p><br><p>  <strong>Betriebserfahrung</strong> </p><br><p>  Zun√§chst m√∂chten wir die Nummern angeben, mit denen das System und der Cluster jetzt auf Couchbase arbeiten. </p><br><ol><li>  √úber 80 Millionen Abonnenten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">[i]</a> </li><li>  380 Millionen JSON-Kundeninformationsdokumente </li><li>  3,5-TB-Festplatte (wir verwenden Memcached, Informationen auf der Festplatte werden f√ºr einen schnellen Start gespeichert) </li><li>  3 TB RAM </li><li>  50.000 Operationen pro Sekunde (Abb. 5) </li><li>  50 Microservices, die den gesamten Nachrichtenfluss verarbeiten </li></ol><br><p></p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lv/nq/wc/lvnqwc_jmlr5jukgm10-ibu7qd8.png"></div><br>  <i>Abbildung 5 Laden</i> <br><p>  Die ersten Meilensteine ‚Äã‚Äãder Transformation haben wir mit der dritten Version von Couchbase begonnen.  In der ersten Phase, zu Beginn des Projekts, funktionierten alle Anwendungen stabil.  Bei der √úbersetzung zus√§tzlicher Logik in einen neuen Mechanismus wurden wir jedoch mit der Tatsache konfrontiert, dass der View-Mechanismus unvorhersehbar zu funktionieren begann.  Das hei√üt,  Irgendwann <strong>friert</strong> der Prozess <strong>ein</strong> und diese Ansichten von einem solchen Knoten kehren nicht mehr zur√ºck.  Gleichzeitig wurde der Zugriff auf Daten und deren Verarbeitung nicht unterbrochen.  Das Problem konnte recht einfach behoben werden - durch Neustart des Knotens, wodurch die Verf√ºgbarkeit des Dienstes im Allgemeinen verringert wurde.  W√§hrend der Kommunikation mit dem technischen Support von Couchbase wurde uns ein undokumentierter Befehl angeboten, der nur den Ansichtsprozess neu startet </p><br><p>  <em>curl -s --data 'cb_couch_sup: restart_couch ().'</em>  <em>-u Administrator: pass <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://127.0.0.1:8091/diag/eval</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><strong>[ii]</strong></a></em> </p><br><p>  Der Befehl ist nur in Version 3.x g√ºltig. </p><br><p>  <em>curl -s --data 'couch_server_sup: restart_core_server ().'</em>  <em>-u Administrator: Administrator</em> <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://127.0.0.1:8091/diag/eval</a></em> </p><br><p>  Der Befehl ist nur in Version 4.x g√ºltig. </p><br><p>  Ein weiteres Problem der dritten Version war der Mechanismus zur Komprimierung fehlerhafter Daten (Komprimierung).  Es musste manuell gem√§√ü den ausgel√∂sten √úberwachungsmetriken gestartet werden.  Beide Probleme hielten nicht nur die Schicht, sondern auch die Funktionsingenieure unter Spannung. </p><br><p>  In diesem Zusammenhang haben wir uns f√ºr die Migration auf die vierte Version entschieden.  Die Migration mit minimalen Auswirkungen auf den Service dauerte ungef√§hr zwei Wochen.  Der Aktualisierungsprozess selbst erfordert keine komplexen Aktionen und Steuerelemente. Beim Hinzuf√ºgen oder Entfernen eines Knotens wird jedoch eine Neuverteilung gestartet, die mindestens zwei Stunden dauert.  Dabei haben wir einen Weg gefunden, den Aktualisierungsprozess √ºber einen Pufferserver zu beschleunigen: In diesem Fall wird kein sauberer Neuausgleichsprozess gestartet, sondern Daten von einem Knoten auf einen anderen √ºbertragen.  Dies reduzierte den Aktualisierungsprozess auf 30 Minuten. </p><br><p>  Bei der Aktualisierung eines Industrieclusters muss die folgende Nuance ber√ºcksichtigt werden: Arbeiten im Kompatibilit√§tsmodus, wenn der Cluster im Modus der j√ºngsten Softwareversion arbeitet.  Positiv zu vermerken ist, dass der Upgrade-Prozess reibungslos und problemlos abl√§uft. Sie k√∂nnen jedoch erst dann neue Funktionen wie den neuen Komprimierungsmechanismus N1QL verwenden, wenn der gesamte Cluster vollst√§ndig aktualisiert wurde. </p><br><p>  Nach dem Update konnten wir nur ein Problem beheben - die Komprimierung.  Es begann richtig zu funktionieren.  Mit dem View-Mechanismus blieb das Problem weiterhin bestehen, obwohl es viel seltener wiederholt wurde.  Es war nur durch die Kr√§fte der Couchbase-Entwickler in Version 4.6.4 m√∂glich, dies zu korrigieren. </p><br><p>  Im Rahmen der L√∂sung von Problemen mit dem technischen Support wurde klar, dass der Ansichtsmechanismus nicht mehr aktualisiert wird.  Dies erfolgte auf der Grundlage, dass die meisten Couchbase-Clients keine Ansichten f√ºr die Zwecke verwenden, f√ºr die sie erstellt wurden, und Couchbase einen neuen N1QL-Mechanismus entwickelte.  Es wird von einem separaten Dienst ausgef√ºhrt und ist jetzt nicht mehr von Datenknoten abh√§ngig (Abb. 7). </p><br><p></p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/df/xn/x2/dfxnx2uou3mvgpgdvtetuzsshj0.png"></div><br>  <i>Abbildung 7 Knotenrollen</i> <br><br><p>  Wir haben alle kritischen Probleme mit Version 4.6.4 geschlossen.  Aufgrund der Zunahme der Datenmenge entschieden sie sich jedoch f√ºr die Migration auf die f√ºnfte Version, wo sie eine neue Datenbank f√ºr die Indizes hinzuf√ºgten und bei unseren Daten die Menge an Speicher und Festplatten eineinhalb Mal abnahm.  Leider konnten wir keinen R√ºckgang der Datenmenge auf Datenknoten feststellen. </p><br><p>  <strong>Schlussfolgerungen</strong> </p><br><p>  Im Allgemeinen erwies sich Couchbase als ausgereiftes System, das auch in unspezifischen F√§llen eine hohe Last aufweist (Viber - wird als Datenbank verwendet).  Innerhalb der MegaFon-Hybridarchitektur kann der Cluster ohne Ausfallzeiten der Ger√§te und ohne ernsthafte Serverrekonfiguration problemlos f√ºr jeden Zweck angepasst werden. Dadurch kann das Unternehmen im Allgemeinen die Personalkosten senken und den Service f√ºr den Teilnehmer so bequem wie m√∂glich gestalten. </p><br><p>  PAO MegaFon </p><br><p>  2018 Kovalchuk Egor </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">[i] Das</a> System verarbeitet nicht nur Teilnehmer, sondern auch Ger√§te mit integrierten SIM-Karten, Modems usw. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">[ii]</a> Konsultieren Sie vor dem Gebrauch einen Spezialisten </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de436762/">https://habr.com/ru/post/de436762/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de436748/index.html">Hexapod von Grund auf neu entwickeln (Teil 3) - Kinematik</a></li>
<li><a href="../de436750/index.html">Trendanalyse des russischen YouTube f√ºr 2018</a></li>
<li><a href="../de436752/index.html">Der Kuchen ist eine L√ºge</a></li>
<li><a href="../de436754/index.html">Q2VKPT: Quake II mit realistischer Beleuchtung komplett neu geschrieben</a></li>
<li><a href="../de436756/index.html">Isomorphismus eilt zur Rettung</a></li>
<li><a href="../de436764/index.html">Erstellen Sie Ihre jsfiddle, Teil 1</a></li>
<li><a href="../de436768/index.html">Die Zusammenfassung interessanter Materialien f√ºr den mobilen Entwickler # 282 (vom 14. bis 20. Januar)</a></li>
<li><a href="../de436770/index.html">Russische Mobilfunkbetreiber verdienen in den Wolken</a></li>
<li><a href="../de436772/index.html">Gesetz "√úber Kommunikation" und Verwundbarkeit in Boten</a></li>
<li><a href="../de436774/index.html">Die Methode zur Entf√ºhrung von Konten "in gro√üen Mengen" durch Zugriff auf die Dienste eines Mobilfunkbetreibers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>