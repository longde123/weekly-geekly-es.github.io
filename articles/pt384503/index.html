<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äç‚öïÔ∏è üëêüèø üç® M√°quina de cubo de Rubik baseada em FAC üõÄüèª üò∞ üêì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="H√° pouco tempo, juntamente com Wilbert Swinkels, terminamos o trabalho em uma m√°quina que coleta o Cubo de Rubik. Eles escreveram sobre n√≥s no blog of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>M√°quina de cubo de Rubik baseada em FAC</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/384503/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√° pouco tempo, juntamente com </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wilbert Swinkels,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> terminamos o trabalho em uma m√°quina que coleta o Cubo de Rubik. </font><font style="vertical-align: inherit;">Eles </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">escreveram</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre n√≥s </font><font style="vertical-align: inherit;">no blog oficial do Raspberry Pi e recebemos muitas cr√≠ticas elogiosas. </font><font style="vertical-align: inherit;">No entanto, no segmento russo da rede, o projeto de alguma forma passou despercebido. </font><font style="vertical-align: inherit;">Ent√£o, decidi corrigir essa omiss√£o postando aqui uma vers√£o traduzida e aumentada da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">postagem original</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.youtube.com/embed/vpAKfSYueMI%3Ffeature%3Doembed&amp;usg=ALkJrhjtKkgOwZGQ-pQqjnx8zGDbXyWkwQ" frameborder="0" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sob o corte, falaremos (principalmente) sobre a parte do software desta m√°quina, a parte mec√¢nica pode ser encontrada na </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p√°gina oficial do</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> projeto (sim, sabemos que √© uma pequena "velha escola")</font></font><br>
<a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TL; DR</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para os impacientes, alguns links:</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P√°gina oficial do projeto</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementa√ß√µes do algoritmo bif√°sico de Kotsemba (Python e C)</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outras obras de Wilbert</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Site da Wilbert FAC</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Site oficial do sistema FAC</font></font></a></li>
</ul><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introdu√ß√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo come√ßou com o fato de que, em maio deste ano, conheci acidentalmente Wilbert Swinkels. Fiquei simplesmente chocado ao ver suas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cria√ß√µes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : cada um desses mecanismos, de pequenos a grandes, pode ser chamado com seguran√ßa de obra de arte. E quanto mais voc√™ olha para o dispositivo deles, mais impressionado com a beleza deles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â claro que, quando Wilbert me convidou para ajud√°-lo com a m√°quina de montagem de cubos de Rubik, n√£o hesitei nem um segundo, principalmente porque j√° havia </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descoberto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> uma paix√£o por cubos coloridos. Naquela √©poca, ele j√° trabalhava na m√°quina h√° mais de 4 (!) Anos, mas a parte do software ainda estava para ser escrita.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu n√£o tinha experi√™ncia com programa√ß√£o para Raspberry Pi e Arduino, mas no geral a tarefa me pareceu bastante simples. </font><font style="vertical-align: inherit;">Claro, eu estava errado :)</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hardware</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pr√≥pria m√°quina √© constru√≠da usando um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sistema FAC modular</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">√â como um designer sovi√©tico, mas criado para prototipar mecanismos s√©rios e complexos. </font><font style="vertical-align: inherit;">Na segunda metade do s√©culo passado, foi usado ativamente nos laborat√≥rios da Philips e outras empresas e universidades. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando conheci Wilbert, ele j√° havia tentado duas vezes "reviver" o carro. </font><font style="vertical-align: inherit;">Nas duas vezes, os estudantes da Universidade de Amsterd√£ aceitaram o caso e, infelizmente, ambas perderam o interesse no projeto ap√≥s v√°rias tentativas frustradas. </font><font style="vertical-align: inherit;">Um deles chegou a defender um diploma de bacharel nesse assunto, apesar de a m√°quina n√£o ter conseguido coletar o cubo (levante sua m√£o para aqueles que se reconhecem aqui).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microcontrolador</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, decidimos usar o Raspberry Pi em vez do Arduino. </font><font style="vertical-align: inherit;">Isso se deve principalmente ao fato de que algoritmos "inteligentes" para resolver o Cubo de Rubik exigem uma quantidade significativa de mem√≥ria e energia do processador. </font><font style="vertical-align: inherit;">Nas tentativas anteriores, um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">algoritmo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> primitivo de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">tr√™s camadas foi usado</font></a><font style="vertical-align: inherit;"> , mas desta vez decidimos usar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o algoritmo de Kotsemba</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Al√©m disso, eu realmente n√£o queria escrever tudo em C (embora em parte fosse necess√°rio). </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/53b/142/5d4/53b1425d42fca6feb8f98819c3f4ff39.jpg" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na vers√£o padr√£o do Raspberry Pi, como n√£o t√≠nhamos pinos suficientes para conectar todos os motores dispon√≠veis, solicitamos o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kit de Desenvolvimento</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A prop√≥sito, eu recomendo fortemente: n√£o apenas mais pinos, mas eles s√£o, na minha opini√£o, mais l√≥gicos √† parte. </font><font style="vertical-align: inherit;">Al√©m disso, esta placa possui dois conectores para a c√¢mera em vez de um.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A primeira vers√£o do scanner</font></font></h3><br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/465/d0e/05d/465d0e05d87cd5c11a732f3d448ac6b4.jpg" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ler a configura√ß√£o inicial do cubo, era necess√°rio um dispositivo de digitaliza√ß√£o. A ideia √© muito simples: por sua vez, iluminamos a superf√≠cie do cubo com tr√™s LEDs: vermelho, verde e azul. Cada vez que medimos a luz refletida usando um resistor fotossens√≠vel. Teoricamente, devemos obter valores RGB que possam ser usados ‚Äã‚Äãpara reconhecer a cor do quadrado. Dos programadores anteriores, ainda temos c√≥digo de prova de conceito para o Arduino, que, ao que parece, funcionou sob certas condi√ß√µes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O primeiro problema que encontramos foi uma incompatibilidade de tens√£o. Como voc√™ sabe, a unidade l√≥gica nos pinos do Arduino √© de 5V, enquanto o Raspberry Pi √© de 3,3V. Felizmente, os controladores de motor de passo que usamos continuaram a funcionar, apesar de alterar a amplitude dos pulsos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acabou sendo muito mais cr√≠tico que o Raspberry Pi n√£o possua entradas anal√≥gicas. Por causa disso, o Raspberry n√£o pode simplesmente captar e ler a tens√£o no fotorresistor. Provavelmente isso √© √≥bvio para aqueles que pelo menos uma vez se depararam com isso, mas a princ√≠pio nem pensei nisso. Pesquisando na rede por uma solu√ß√£o, deparamos com </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Em poucas palavras, adicionamos um capacitor ao circuito e medimos o tempo durante o qual ele cobrar√° de zero a uma unidade l√≥gica (podemos detect√°-lo usando um pino digital). </font><font style="vertical-align: inherit;">O tempo de carregamento ser√° proporcional √† resist√™ncia do fotorresistor, para que possamos avaliar a quantidade de luz. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/40a/8d9/d2b/40a8d9d2b30365e9e4fd4c3cf3615798.jpg" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa abordagem n√£o √© apenas extremamente confi√°vel (dedicar tempo em um script Python Python no Linux com v√°rios processos em segundo plano √© uma coisa ingrata), mas tamb√©m √© imposs√≠vel demorar muito. </font><font style="vertical-align: inherit;">Para suavizar os desvios aleat√≥rios nas leituras, tivemos que ler v√°rias vezes, livrar-se dos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valores extremos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font><font style="vertical-align: inherit;">calcular </font><font style="vertical-align: inherit;">a m√©dia dos valores restantes. </font><font style="vertical-align: inherit;">No entanto, ainda conseguimos fazer com que esse scanner funcionasse:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.youtube.com/embed/z4iJ0hNQulo%3Ffeature%3Doembed&amp;usg=ALkJrhjXRjBzspmEUH_1BLzXncbpBaurGQ" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A segunda vers√£o (final) do scanner</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O scanner de capacitor funcionou muito bem, mas foi muito lento. Demorou cerca de dois minutos para varrer todo o cubo de Rubik e, quando a varredura foi conclu√≠da, o espectador havia perdido todo o interesse. Portanto, decidimos retornar ao Arduino e compramos um pequeno Arduino Mini especificamente para controlar o scanner. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/21a/9e5/775/21a9e5775f5e15affb6792ae5f67b984.jpg" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fazer amigos do Arduino com o Raspberry Pi acabou incrivelmente simples: dois fios, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um conversor de voltagem</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> entre eles e pronto - temos uma interface serial. E se voc√™ estragar um protocolo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Min</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> simples </font><font style="vertical-align: inherit;">, programar esse neg√≥cio √© um prazer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Transferi toda a l√≥gica de controle do scanner para o Arduino. </font><font style="vertical-align: inherit;">A velocidade da digitaliza√ß√£o aumentou significativamente. </font><font style="vertical-align: inherit;">Gra√ßas √†s entradas anal√≥gicas, podemos ler a tens√£o diretamente dos fotorresistores, e esses valores s√£o muito precisos. </font><font style="vertical-align: inherit;">Al√©m disso, como o Arduino √© montado diretamente no scanner, precisamos de muito menos fios do scanner para o Raspberry Pi!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algoritmo de constru√ß√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Montar o cubo de Rubik do ponto de vista matem√°tico √© uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tarefa</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bastante </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">trabalhosa</font></a><font style="vertical-align: inherit;"> . Obviamente, estamos falando em encontrar a solu√ß√£o ideal, e n√£o "algumas". Fiquei surpreso quando descobri que o n√∫mero de Deus (o limite inferior exato para o n√∫mero de movimentos necess√°rios para resolver um cubo arbitr√°rio) foi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">encontrado apenas em 2010</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste projeto, quer√≠amos reduzir o tempo total necess√°rio para calcular a solu√ß√£o e montar, portanto, nem um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">algoritmo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> simples de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">tr√™s camadas se</font></a><font style="vertical-align: inherit;"> aproximou de n√≥s </font><font style="vertical-align: inherit;">(ele funciona rapidamente, mas oferece solu√ß√µes com cem movimentos), nem um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">algoritmo ideal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (as solu√ß√µes s√£o curtas, mas o processo de renderiza√ß√£o no Raspberry Pi levaria uma eternidade). Como resultado, decidimos pelo magn√≠fico </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">algoritmo "bif√°sico"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Matem√°tico alem√£o Herbert Kociemba. Ele √© capaz de emitir decis√µes abaixo do ideal (uma m√©dia de 20 movimentos), mantendo-o dentro de um tempo razo√°vel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No site do autor, voc√™ pode encontrar a implementa√ß√£o do algoritmo em Java. A primeira coisa que fiz foi traduzir esse c√≥digo em Python. N√£o foi nada dif√≠cil, pois a maior parte do programa √© opera√ß√µes matem√°ticas e enumera√ß√£o de op√ß√µes. No entanto, n√£o levei em conta que o algoritmo </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">realmente</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> requer </font><i><b><font style="vertical-align: inherit;">muitos</font></b></i><font style="vertical-align: inherit;"> recursos. Encontrar uma solu√ß√£o no primeiro lan√ßamento levou mais de um minuto (!) No meu laptop. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sob </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pypy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com o JIT ativado, a solu√ß√£o demorou 1 segundo no laptop, mas no Raspberry Pi ainda demorou cerca de um minuto. </font><font style="vertical-align: inherit;">Ap√≥s v√°rias tentativas de acelerar o trabalho do programa Python (numpy, multiprocessamento), decidi reescrever o algoritmo em C. No entanto, a solu√ß√£o agora leva de 1 a 2 segundos, mesmo para Raspberry. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Postei as duas implementa√ß√µes do algoritmo no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Controle da m√°quina</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O pr√≥ximo passo foi escrever um programa que controlasse a parte mec√¢nica: mover os motores, levando em considera√ß√£o as rela√ß√µes de transmiss√£o e as limita√ß√µes do mecanismo (por exemplo, os suportes laterais s√≥ podem ser girados quando o fundo estiver em uma determinada posi√ß√£o, caso contr√°rio, isso interferir√°). </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/b89/c9b/3e0/b89c9b3e0780fae3e7dd5b28a8aa209d.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m do programa principal, criei um shell interativo que me salvou muito tempo ao depurar. </font><font style="vertical-align: inherit;">Em geral, essa parte n√£o era incomum em termos de programa√ß√£o. </font><font style="vertical-align: inherit;">Para depurar a verifica√ß√£o, gerei os resultados como imagens.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Digitaliza√ß√£o e reconhecimento de cores</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At√© esse ponto, tudo era interessante, mas n√£o dif√≠cil. </font><font style="vertical-align: inherit;">Duas semanas ap√≥s o in√≠cio do trabalho, a m√°quina j√° podia coletar um cubo de um determinado estado. </font><font style="vertical-align: inherit;">Restou apenas aprender a ler a configura√ß√£o inicial do cubo usando um scanner. </font><font style="vertical-align: inherit;">J√° t√≠nhamos um programa de trabalho para o Arduino, por isso n√£o esper√°vamos surpresas. </font><font style="vertical-align: inherit;">No entanto, essa parte do projeto acabou sendo a mais dif√≠cil e levamos mais 2 meses de trabalho.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Indica√ß√µes Photoresistor</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como escrevi acima, come√ßamos com um circuito de scanner com capacitores. O erro dessa abordagem foi horr√≠vel; portanto, para obter valores utiliz√°veis, tive que fazer medi√ß√µes v√°rias vezes e depois me livrar das emiss√µes. Depois disso, obtivemos algo assim (este √© o resultado da digitaliza√ß√£o do cubo montado em uma sala escura): </font></font><br>
<br>
<img src="https://habrastorage.org/files/d0d/0eb/467/d0d0eb4676f54a8c9319882658278664.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ pode ver, o resultado est√° longe de ser o ideal. Primeiro, os valores para a mesma cor s√£o diferentes em posi√ß√µes diferentes, pois os fotorresistores e os LEDs ‚Äúolham‚Äù em dire√ß√µes ligeiramente diferentes. Em segundo lugar, algumas cores est√£o muito pr√≥ximas umas das outras no espa√ßo de cores e, √†s vezes, os intervalos de valores se sobrep√µem (por exemplo, laranja e vermelho √†s vezes d√£o o mesmo valor). E, finalmente, as leituras dependem muito da ilumina√ß√£o externa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Visualmente, o erro do scanner nos capacitores pode ser visto no diagrama a seguir (em geral, h√° </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uma vers√£o interativa aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ): </font></font><br>
<br>
<img src="https://habrastorage.org/files/8a6/489/4fd/8a64894fd9a249a1a297ac2743930120.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Olhando para tr√°s, pergunto-me como conseguimos fazer a digitaliza√ß√£o funcionar com esses resultados, embora isso exigisse uma calibra√ß√£o cuidadosa e complicada dos valores em quest√£o vai um pouco mais baixo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como eu disse, o scanner de capacitor funcionou, mas foi muito lento. </font><font style="vertical-align: inherit;">Quando o substitu√≠mos por outro, pelo Arduino embutido, as leituras ficaram muito mais "cheias" (a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vers√£o interativa est√° aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br>
<br>
<img src="https://habrastorage.org/files/c6e/0a8/8b5/c6e0a88b595747aa87ef2c35bdf634fe.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calibra√ß√£o e agrupamento de leituras</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora que t√≠nhamos as leituras brutas de RGB dos fotorresistores, tivemos que identificar as cores para fornecer a configura√ß√£o do cubo ao algoritmo de constru√ß√£o. Duas abordagens diferentes foram imediatamente sugeridas aqui: o uso de intervalos de cores e o algoritmo de agrupamento.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A primeira abordagem √© uma solu√ß√£o "frontal": foi poss√≠vel determinar experimentalmente os intervalos de valores para cada lado do cubo (de fato, para dividir o espa√ßo de cores em √°reas separadas) e, em seguida, simplesmente combinar os valores de acordo com sua perten√ßa a um determinado intervalo. Nesse caso, cada uma das 9 posi√ß√µes poss√≠veis na borda do cubo deve ser considerada separadamente. Este m√©todo √© muito f√°cil de programar, mas possui duas desvantagens significativas. Primeiro, ele nos liga a cores espec√≠ficas, o que significa que s√≥ podemos coletar um cubo de Rubik estritamente definido. E segundo, os intervalos de valores poss√≠veis dependem muito da ilumina√ß√£o externa. Al√©m disso, descobrimos que, dependendo da luz ambiente, a mesma leitura pode corresponder a cores diferentes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A segunda abordagem requer calibra√ß√£o preliminar dos valores para que a mesma cor produz os mesmos resultados em todas as 9 posi√ß√µes na borda do cubo. </font><font style="vertical-align: inherit;">Nesse caso, podemos usar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o algoritmo de agrupamento</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para combinar os valores em 6 grupos. </font><font style="vertical-align: inherit;">Ao mesmo tempo, n√£o importa em que cores o cubo √© pintado, se elas forem diferentes. </font><font style="vertical-align: inherit;">Infelizmente, esse m√©todo tamb√©m teve que ser "rejeitado" devido √† natureza probabil√≠stica dos algoritmos de agrupamento: eles podem produzir um resultado "bom", mas n√£o garantem sua precis√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ambas as abordagens t√™m seus pr√≥s e contras, portanto, como resultado, usamos algo entre:</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antes de tudo, fazemos uma calibra√ß√£o artificial das leituras do scanner para normalizar os valores. </font><font style="vertical-align: inherit;">Os coeficientes s√£o obtidos experimentalmente.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">converta os valores RGB resultantes em HSV</font></font></li>
<li>   ,    S ()</li>
<li>     </li>
<li>    ,     .</li>
</ol><br>
<br>
<h3>   </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mesmo com um bom algoritmo de agrupamento, a verifica√ß√£o frequentemente falhava devido √†s condi√ß√µes ambientais. </font><font style="vertical-align: inherit;">O algoritmo, calibrado em um quarto escuro, n√£o conseguiu lidar com a tarefa em condi√ß√µes diurnas e vice-versa. </font><font style="vertical-align: inherit;">Al√©m disso, se a ilumina√ß√£o externa era muito brilhante (luz solar direta), o scanner geralmente parava de funcionar, pois a influ√™ncia dos LEDs se tornava quase impercept√≠vel. </font><font style="vertical-align: inherit;">Wilbert fez um trabalho minucioso ao isolar o scanner da luz ambiente. </font><font style="vertical-align: inherit;">Eu tive que passar por tr√™s itera√ß√µes: cada vez que pens√°vamos que seria suficiente, e cada vez que encontramos outra lacuna atrav√©s da qual a ilumina√ß√£o externa ca√≠a no fotorresistor.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/d4c/a1e/795/d4ca1e795ba1c28d27a3fa8ebbc8c5cb.jpg" alt="imagem"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trabalhar neste projeto foi incrivelmente empolgante. √â muito bom ver o carro ganhar vida diante de seus olhos e √© especialmente legal ver como ele funciona, justificando todos os seus esfor√ßos. No entanto, isso n√£o pode ser comparado ao estoque de conhecimento que conseguimos obter no processo. Eu n√£o poderia imaginar que teria que estudar um monte de materiais sobre eletr√¥nica, mec√¢nica, √°lgebra e at√© estat√≠stica matem√°tica, e ao longo do caminho para encontrar uma d√∫zia de utilit√°rios e bibliotecas √∫teis. √â por isso que estou t√£o feliz por ter tido a oportunidade de trabalhar neste projeto.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/238/e22/a67/238e22a6758025d7fbda1f52441b75a2.jpg" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seja como for, este carro √© apenas um prot√≥tipo. </font><font style="vertical-align: inherit;">N√£o estabelecemos o objetivo de quebrar o recorde de velocidade e certamente n√£o percebemos todo o potencial das pe√ßas mec√¢nicas. </font><font style="vertical-align: inherit;">Mas definitivamente tentaremos fazer isso na pr√≥xima vers√£o da m√°quina, na qual j√° come√ßamos a trabalhar. </font><font style="vertical-align: inherit;">L√° vamos usar a c√¢mera para digitalizar, e o design dos manipuladores sofreu mudan√ßas significativas. </font><font style="vertical-align: inherit;">E, claro, se voc√™ tiver alguma d√∫vida, sugest√£o ou dica, ficarei feliz em ouvi-los nos coment√°rios.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt384503/">https://habr.com/ru/post/pt384503/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt384489/index.html">–ù–æ–≤—ã–π —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Ç–≤–µ—Ä–¥–æ—Ç–µ–ª—å–Ω—ã–π –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å –æ—Ç –∫–æ—Ä–µ–π—Å–∫–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è ‚Äî Samsung 950 Pro</a></li>
<li><a href="../pt384491/index.html">Rob√¥s estacionam melhor que humanos</a></li>
<li><a href="../pt384493/index.html">Rel√≥gio eletr√¥nico Qlocktwo-style</a></li>
<li><a href="../pt384499/index.html">Acer Revo One: –º–∏–Ω–∏–∞—Ç—é—Ä–Ω—ã–π –∫–æ–º–ø—å—é—Ç–µ—Ä —à–∏—Ä–æ–∫–æ–≥–æ —Å–ø–µ–∫—Ç—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è</a></li>
<li><a href="../pt384501/index.html">Som no seu bolso por 500 000r: Astell & Kern AK380 + Astell & Kern Layla</a></li>
<li><a href="../pt384505/index.html">Fones de ouvido com tecnologia de condu√ß√£o √≥ssea: o que s√£o, por que s√£o necess√°rios e onde comprar</a></li>
<li><a href="../pt384507/index.html">O tempo de inatividade do datacenter da Amazon trava Netflix, Heroku e outros servi√ßos</a></li>
<li><a href="../pt384509/index.html">A NVIDIA instalar√° sua melhor placa de v√≠deo para laptop GeForce GTX 980</a></li>
<li><a href="../pt384511/index.html">–°—Ç–∞—Ä—Ç–æ–≤—ã–µ –≥—Ä–∞–±–ª–∏ ‚Äî –∫–∞–∫ –º—ã –æ—Ç–∫—Ä—ã–≤–∞–ª–∏ –∏–≥—Ä–æ–≤—É—é –ø–ª–æ—â–∞–¥–∫—É</a></li>
<li><a href="../pt384513/index.html">Postos de gasolina solares m√≥veis EV ARC - realidades e perspectivas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>