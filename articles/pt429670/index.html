<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïñ üî™ üìû Script Java! = JavaScript. Cinco javas em uma classe. N√≥s escrevemos para nos lembrarmos para sempre üëª üèÇüèΩ üõÑ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nesta semana, o grupo JUG.ru provavelmente divulgar√° um an√∫ncio. At√© eu dizer o que. A participa√ß√£o em projetos secretos desperta a criatividade, ent√£...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Script Java! = JavaScript. Cinco javas em uma classe. N√≥s escrevemos para nos lembrarmos para sempre</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/429670/"><iframe width="560" height="315" src="https://www.youtube.com/embed/7SCwk02RPA0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Nesta semana, o grupo JUG.ru provavelmente divulgar√° um an√∫ncio.  At√© eu dizer o que.  A participa√ß√£o em projetos secretos desperta a criatividade, ent√£o aqui est√° outro v√≠deo noturno sobre Java. <br><br>  Not√≠cias incr√≠veis: agora n√£o h√° uma hora e meia de dura√ß√£o, mas cerca de 20 minutos, e ainda h√° algo para assistir.  Um pouco menos do que completamente, consiste em um screencast.  Quem n√£o suporta esse lixo de v√≠deo e gosta de consumir descriptografia de texto, teve que cortar muito texto ap√≥s o corte.  Welkam, e Java pode estar com voc√™. <br><a name="habracut"></a><br>  Em breve, 12 java ser√£o lan√ßados, e muitos ainda est√£o sentados em Semerochka e acreditam que, se atualizarem, n√£o ver√£o algo particularmente novo ou interessante.  Nesta edi√ß√£o super curta, aprenderemos como transformar a vida de nossos colegas no inferno com a ajuda do Java com script e, em alguns lugares, vou estragar novos gadgets.  Bem, os obscurantistas, √© claro, n√£o ser√£o salvos do progresso. <br><br>  Diga-me, por que voc√™ est√° atualizando sua ideia?  Aparecem constantemente novos recursos, alguns novos atalhos, aumentando dez vezes a sua produtividade como desenvolvedor.  Mas voc√™ n√£o sabe sobre eles.  Voc√™ est√° realmente lendo esta not√≠cia?  Se voc√™ √© um usu√°rio m√©dio, provavelmente n√£o.  Voc√™, em princ√≠pio, n√£o se importa com a maior parte do tempo.  Voc√™ est√° atualizando a id√©ia simplesmente porque ... voc√™ pode.  Porque as peles s√£o lindas, o tema sombrio, a barra de toque do MacBook.  Mas essa explica√ß√£o n√£o falha diante das autoridades como a resposta "por que comprar a id√©ia". <br><br>  Em vez disso, podemos dizer que, em 29 de outubro, mais recentemente, o JetBrains fixou o suporte para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">linhas brutas</a> na vers√£o beta do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Idea</a> .  A ideia est√° na vers√£o beta, as linhas est√£o na pr√©-visualiza√ß√£o, mas isso n√£o √© mais importante para ningu√©m.  Se voc√™ √© t√£o teimoso que coloca 12 java, tem problemas mais s√©rios.  Eu sei por mim mesmo. <br><br>  Vamos ver como fica na pr√°tica.  Para fazer isso, tente resolver algum tipo de problema de demonstra√ß√£o.  Muitas vezes h√° o problema de criar scripts para algo.  Por exemplo, em jogos de computador, essas s√£o miss√µes, em jenkins, s√£o scripts de constru√ß√£o e assim por diante.  Geralmente, Python ou Groove √© usado para isso, e vamos usar Java nu!  Porque  Porque n√≥s podemos, em tr√™s linhas, e mesmo sem hacks.  Parece uma √≥tima id√©ia :-) <br><br><h1>  Onde assistir </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tudo est√° no github</a> . <br><br><h1>  √Çmbito de aplica√ß√£o </h1><br>  Imagine que temos um arquivo como este: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> io.javawatch; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloHabrPrototype</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello Habr!"</span></span>; } };</code> </pre> <br>  Queremos que ele seja executado n√£o ao compilar o aplicativo inteiro, mas como uma string - ap√≥s o lan√ßamento.  Como um script, √© isso. <br><br><h1>  Manualmente </h1><br>  Primeiro voc√™ precisa ultrapassar tudo em uma string. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String SOURCE = <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" package io.javawatch;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" public class HelloHabr {\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" public String get() {\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" return \"Hello Habr!\";\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" }\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" };"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String CNAME = <span class="hljs-string"><span class="hljs-string">"io.javawatch.HelloHabr"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String CODE_CACHE_DIR = <span class="hljs-string"><span class="hljs-string">"C:/temp/codeCache"</span></span>;</code> </pre><br>  Todas essas "\ n" vantagens e recuos parecem extremamente infelizes. <br><br>  Anteriormente, tudo o que pod√≠amos fazer era colocar o c√≥digo em um arquivo e l√™-lo.  Esta √© provavelmente uma boa solu√ß√£o, mas nem sempre √© adequada.  Por exemplo, voc√™ √© um palestrante em uma confer√™ncia e demonstra o c√≥digo dos slides.  Mesmo a constru√ß√£o acima √© muito melhor do que apenas uma refer√™ncia n√£o fundamentada de que voc√™ tem um c√≥digo em algum lugar que faz algo l√°.  A troca de slides consome tempo e aten√ß√£o do p√∫blico.  Bem e assim por diante.  Em suma, casos, quando voc√™ precisar do c√≥digo exatamente em linha, poder√° criar. <br><br>  Agora temos a oportunidade de nos livrar do lixo usando strings cruas.  Levantamos o cursor no c√≥digo, pressione Alt + Enter (ou o que for executado nos sistemas operacionais Quck Fix no Idea).  Selecione "converter para literal de cadeia de caracteres brutos" e obtenha esta nyashka: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String SOURCE = ` <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> io.javawatch; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloHabr</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello Habr!"</span></span>; } };`; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String CNAME = <span class="hljs-string"><span class="hljs-string">"io.javawatch.HelloHabr"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String CODE_CACHE_DIR = <span class="hljs-string"><span class="hljs-string">"C:/temp/codeCache"</span></span>;</code> </pre><br>  Na minha opini√£o, por causa desse recurso, j√° vale a pena correr para instalar o JDK 12. <br><br>  A prop√≥sito, para que o recurso funcione, voc√™ precisar√° fazer v√°rias coisas: <br><br><ul><li>  Fa√ßa o download do JDK 12 e registre-se nas configura√ß√µes do projeto </li><li>  Nas configura√ß√µes globais de javac, defina o sinalizador <code>--release</code> , bytecode vers√£o 12, sinalizadores adicionais <code>--enable-preview</code> <code>-Xlint:preview</code> </li><li>  Agora, em qualquer configura√ß√£o de execu√ß√£o / depura√ß√£o, voc√™ precisa adicionar o sinalizador da VM <code>--enable-preview</code> </li></ul><br>  Se voc√™ n√£o entende, como √© feito, veja meu screencast no cabe√ßalho da postagem, tudo fica bem claro l√°. <br><br>  Agora, para come√ßar, voc√™ precisa executar tr√™s etapas simples: transforme a string em uma representa√ß√£o interna conveniente da fonte, compile-a e execute: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* 1 */</span></span> RuntimeSource file = RuntimeSource.create(); <span class="hljs-comment"><span class="hljs-comment">//SimpleJavaFileObject /* 2 */ compile(Collections.singletonList(file)); /* 3 */ String result = run(); /* 4 */ /* ??? */ /* 5 */ /* PROFIT! */ System.out.println(result); }</span></span></code> </pre><br>  Existe uma classe <code>SimpleJavaFileObject</code> para "representa√ß√£o conveniente", mas possui um recurso interessante.  √â crutalmente abstrato.  Ou seja, seu m√©todo principal, que a fonte compilada deve retornar, sempre lan√ßa uma execu√ß√£o na esperan√ßa de que a subclassesemos: <br><br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * This implementation always throws {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@linkplain</span></span></span><span class="hljs-comment"> * UnsupportedOperationException}. Subclasses can change this * behavior as long as the contract of {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> FileObject} is * obeyed. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CharSequence </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCharContent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ignoreEncodingErrors)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UnsupportedOperationException(); }</code> </pre><br>  Ent√£o voc√™ tem que escrever um pouco do seu herdeiro.  Observe que o construtor <code>SimpleJavaFileObject</code> original deseja um URI para a classe compilada, mas onde o obtemos?  Portanto, sugiro apenas coloc√°-lo da maneira mais √≥bvia, como aqui na fun√ß√£o <code>buildURI</code> : <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RuntimeSource</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleJavaFileObject</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String contents = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CharSequence </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCharContent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ignoreEncodingErrors)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> contents; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> RuntimeSource </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeSource(CNAME, SOURCE); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RuntimeSource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String className, String contents)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(buildURI(className), Kind.SOURCE); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.contents = contents; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> URI </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildURI</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String className)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// io.javawatch.HelloHabr -&gt; // string:///io/javawatch/HelloHabr.java URI uri = URI.create("string:///" + className.replace('.', '/') + Kind.SOURCE.extension); System.out.println(uri); return uri; }</span></span></code> </pre><br>  Agora vamos √† compila√ß√£o: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;RuntimeSource&gt; files)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ File ccDir = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(CODE_CACHE_DIR); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ccDir.exists()) { FileUtils.deleteDirectory(ccDir); FileUtils.forceMkdir(ccDir); } JavaCompiler compiler = ToolProvider.getSystemJavaCompiler(); Logger c = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Logger(); StandardJavaFileManager fileManager = compiler.getStandardFileManager(c, Locale.ENGLISH, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); Iterable options = Arrays.asList(<span class="hljs-string"><span class="hljs-string">"-d"</span></span>, CODE_CACHE_DIR, <span class="hljs-string"><span class="hljs-string">"--release=12"</span></span>, <span class="hljs-string"><span class="hljs-string">"--enable-preview"</span></span>, <span class="hljs-string"><span class="hljs-string">"-Xlint:preview"</span></span>); JavaCompiler.CompilationTask task = compiler.getTask(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, fileManager, c, options, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, files); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (task.call()) { System.out.println(<span class="hljs-string"><span class="hljs-string">"compilation ok"</span></span>); } }</code> </pre><br>  Observe: passamos quatro sinalizadores para montagem, tr√™s dos quais s√£o respons√°veis ‚Äã‚Äãpor prescrever exatamente as mesmas op√ß√µes que fizemos com o mouse nas configura√ß√µes de javac na Idea. <br><br>  E, finalmente, execute nossa classe tempor√°ria: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> ClassNotFoundException, IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException, MalformedURLException </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   File ccDir = new File(CODE_CACHE_DIR); ClassLoader loader = new URLClassLoader(new URL[]{ccDir.toURL()}); var clss = loader.loadClass("io.javawatch.HelloHabr"); // Java 10 //    Object instance = clss.getConstructor().newInstance(); // Java 9 // Object instance = clss.newInstance(); Method thisMethod = clss.getDeclaredMethod("get"); Object result = thisMethod.invoke(instance); return (String) result; }</span></span></code> </pre><br>  Observe que <code>var clss = loader.loadClass</code> de escrever do que a <code>Class&lt;?&gt; clss = loader.loadClass</code> e n√£o apresenta novos vorings.  A palavra-chave <code>var</code> apareceu no Top Ten. <br><br>  Observe tamb√©m que <code>clss.newInstance()</code> proposto que <code>clss.newInstance()</code> seja cortado a partir de Nine.  Ele engole exce√ß√µes, o que √© ruim.  O Nine sugere primeiro chamar <code>getConstructor</code> , que √© parametrizado e lan√ßa as exce√ß√µes corretas. <br><br>  Observe tamb√©m que chamei a vari√°vel de <code>class</code> palavra, mas Java n√£o jurou.  Li√ß√£o de casa: voc√™ pode fazer isso de v√°rias maneiras, precisa entender qual √© a mais interessante e por qu√™. <br><br>  Bem, em geral, isso √© tudo.  Isso funciona. <br><br><h1>  Automa√ß√£o </h1><br>  Aqui o cr√≠tico exclama: tudo est√° em preto aqui, porque existem bibliotecas no mundo Java que compilam tudo para voc√™ em uma linha. <br><br>  OK, vamos dar uma olhada.  Aqui est√° o c√≥digo na biblioteca JOOR, localizada na parte superior do Google: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> io.javawatch; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.joor.Reflect; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.function.Supplier; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Automatic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Supplier&lt;String&gt; supplier = Reflect.compile( <span class="hljs-string"><span class="hljs-string">"io.javawatch.HelloHabr"</span></span>, ` <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> io.javawatch; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloHabr</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">util</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">function</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Supplier</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello Habr!"</span></span>; } };` ).create().get(); System.out.println(supplier.get()); } }</code> </pre><br>  Como se estivesse tudo bem.  De fato, em uma linha, exceto que eu tive que arrastar o saplayer. <br><br>  Mas h√° uma nuance.  Tente retornar "Ol√° Habr!"  como literal de string bruto: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ``Hello Habr!``; }</code> </pre><br>  Tudo ir√° falhar instantaneamente com o erro "(use --able-preview para ativar literais de strings brutos)".  Mas n√≥s j√° o ativamos?  Sim, para o inferno com dois.  N√≥s o inclu√≠mos no Idea, e o JOOR o constr√≥i com um compilador de sistema!  Vamos dar uma olhada no que h√° dentro: <br><br><pre> <code class="java hljs">JavaCompiler compiler = ToolProvider.getSystemJavaCompiler(); ompiler.getTask(out, fileManager, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, files).call();</code> </pre><br>  E quanto a n√≥s quando chamamos o mesmo JavaCompiler? <br><br><pre> <code class="java hljs"> Iterable options = Arrays.asList(<span class="hljs-string"><span class="hljs-string">"-d"</span></span>, CODE_CACHE_DIR, <span class="hljs-string"><span class="hljs-string">"--release=12"</span></span>, <span class="hljs-string"><span class="hljs-string">"--enable-preview"</span></span>, <span class="hljs-string"><span class="hljs-string">"-Xlint:preview"</span></span>); JavaCompiler.CompilationTask task = compiler.getTask(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, fileManager, c, options, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, files);</code> </pre><br>  E no JOOR, existe apenas um nulo, em vez de op√ß√µes.  Eles nem podem passar por dentro! <br><br>  Provavelmente, √© uma boa id√©ia enviar uma solicita√ß√£o de recebimento ao Github no JOOR.  Se eu n√£o vou fazer isso sozinho, voc√™ faz, n√£o √©? <br><br>  E a moral √© simples, tenha medo de presentes de c√≥digo aberto.  √Äs vezes, √© mais f√°cil escrever uma pequena parede de texto, mas ter controle sobre ela. <br><br><h1>  Maneira mais f√°cil </h1><br>  Existe uma maneira de n√£o escrever uma parede de texto e n√£o usar bibliotecas suspeitas.  A partir do Java 9, temos um shell interativo (semelhante ao do Python, Ruby e outras linguagens de script) que pode executar comandos Java.  E, claro, est√° escrito no pr√≥prio Java e est√° dispon√≠vel como uma classe Java.  Voc√™ pode criar uma inst√¢ncia e simplesmente executar a atribui√ß√£o necess√°ria diretamente: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shell</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jShell = JShell.create(); <span class="hljs-comment"><span class="hljs-comment">//Java 9 jShell.eval("String result;"); jShell.eval(`result = "Hello Habr!";`); //Java 12 var result = jShell.variables() //Streams: Java 8, var: Java 10 .filter((@Nullable var v) -&gt; v.name().equals("result")) //var+lambda: Java 11 .findAny() .get(); System.out.println(jShell.varValue(result)); } }</span></span></code> </pre><br>  Os streams apareceram no Java 8 e agora s√£o usados ‚Äã‚Äãem todos os lugares, e voc√™ nem precisa chamar <code>stream()</code> , outros o chamam por voc√™.  Nesse caso, chamar as <code>variables()</code> retorna exatamente o fluxo, n√£o o ArrayList, como algu√©m de uma inf√¢ncia dif√≠cil teria feito.  O resultado do fluxo pode ser imediatamente derramado em <code>var</code> . <br><br>  Observe que agora voc√™ pode escrever <code>var</code> tamb√©m nos par√¢metros lambda.  Esse recurso est√° presente desde o Java 11. <br><br>  Em geral, esta √© uma classe muito significativa.  Ele usa v√°rios recursos de diferentes gera√ß√µes de Java e tudo isso parece hol√≠stica e harmoniosamente.  Estou certo de que essas coisas ser√£o usadas por todos e em qualquer lugar, portanto o c√≥digo no Java 12 ser√° diretamente visualmente diferente do que t√≠nhamos no Java 7. <br><br><h1>  Resumir </h1><br>  Vimos alguns recursos: <br><br><ul><li>  8: Stream (para aqueles no tanque) </li><li>  9: JShell e novos m√©todos descontinuados </li><li>  10: palavra-chave var </li><li>  11: Desenvolvimento de Var para par√¢metros lambda </li><li>  12: Literais de cadeia bruta e seu suporte no IntelliJ IDEA </li></ul><br>  Um pequeno aviso para iniciantes.  Se voc√™ constantemente faz isso em aplicativos reais sem nenhum significado especial, seus colegas ficam loucos a princ√≠pio, tentando entender o que voc√™ escreveu, e ent√£o eles podem venc√™-lo com muita dor.  E n√£o estou falando sobre novos recursos Java agora, mas sobre compila√ß√£o em tempo de execu√ß√£o, √© claro. <br><br>  Se voc√™ quiser aprender mais sobre Java como uma linguagem, dever√°, por exemplo, examinar os relat√≥rios de Tagir Valeev.  Voc√™ o conhece como um cara do topo do hub Java em Habr√©, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">lany</a> .  No Joker, ele falou sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Amber</a> , e na JPoint - seus famosos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">quebra</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cabe√ßas</a> , e assim por diante.  L√°, e sobre a linguagem Java e sobre o IntelliJ IDEA, tudo est√° l√°.  Tudo isso pode ser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">encontrado no YouTube</a> .  Na verdade, por ci√∫mes de Tagir, que pode dizer algo sobre a pr√≥pria linguagem, mas n√£o o fa√ßo, e este post acabou.  Tamb√©m haver√° novos curingas e o JPoint, mas discutiremos isso mais tarde. <br><br>  Eu cumpri meu dever moral, um dever para Java.  Do meu lado, as balas voaram.  E voc√™ a√≠, nos sete, que n√£o tem o d√©cimo segundo Java, fique aqui, tudo de bom, bom humor e sa√∫de.  Obrigada </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt429670/">https://habr.com/ru/post/pt429670/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt429654/index.html">Melhorando o gerenciamento de projetos</a></li>
<li><a href="../pt429656/index.html">A intelig√™ncia artificial tamb√©m est√° enganada. Como o Amazon Go nos ataca nos EUA - uma loja do futuro sem caixas e vendedores</a></li>
<li><a href="../pt429658/index.html">Internet via sat√©lite SpaceX Starlink - ‚ÄúPrint Money License‚Äù</a></li>
<li><a href="../pt429662/index.html">Rompemos a prote√ß√£o contra bots</a></li>
<li><a href="../pt429668/index.html">O Google PageSpeed ‚Äã‚ÄãInsights foi atualizado drasticamente. O que mudar√°?</a></li>
<li><a href="../pt429676/index.html">Backup em fita</a></li>
<li><a href="../pt429678/index.html">Como convertemos 10 milh√µes de linhas de c√≥digo C ++ no padr√£o C ++ 14 (e depois no C ++ 17)</a></li>
<li><a href="../pt429680/index.html">Curso MIT "Seguran√ßa de sistemas de computadores". Aula 17: Autentica√ß√£o de Usu√°rio, Parte 1</a></li>
<li><a href="../pt429682/index.html">Curso MIT "Seguran√ßa de sistemas de computadores". Aula 17: Autentica√ß√£o de Usu√°rio, Parte 2</a></li>
<li><a href="../pt429684/index.html">Firebase Summit 2018: brevemente sobre o principal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>