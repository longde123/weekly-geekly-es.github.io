<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå∂Ô∏è üîí ü§® Resolvendo problemas de tipo de dados no Ruby ou Torne os dados confi√°veis ‚Äã‚Äãnovamente üëÜüèº üë©üèª‚Äçüé§ üßîüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neste artigo, gostaria de falar sobre quais s√£o os problemas com os tipos de dados no Ruby, quais problemas encontrei, como eles podem ser resolvidos ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Resolvendo problemas de tipo de dados no Ruby ou Torne os dados confi√°veis ‚Äã‚Äãnovamente</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433180/">  Neste artigo, gostaria de falar sobre quais s√£o os problemas com os tipos de dados no Ruby, quais problemas encontrei, como eles podem ser resolvidos e como garantir que os dados com os quais trabalhamos possam ser confi√°veis. <br><br><img src="https://habrastorage.org/webt/re/27/5n/re275nqouf3ucrd8gxrmv0cvboq.png" alt="imagem"><br><a name="habracut"></a><br>  Primeiro, voc√™ precisa decidir quais s√£o os tipos de dados.  Vejo uma defini√ß√£o muito bem-sucedida do termo, que pode ser encontrada no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">HaskellWiki</a> . <br><blockquote>  Os tipos s√£o como voc√™ descreve os dados com os quais seu programa trabalhar√°. </blockquote>  Mas o que h√° de errado com os tipos de dados no Ruby?  Para descrever o problema de maneira abrangente, gostaria de destacar v√°rias raz√µes. <br><br><h4>  Raz√£o 1. Problemas do pr√≥prio Ruby </h4><br>  Como voc√™ sabe, Ruby usa <b>digita√ß√£o din√¢mica estrita com suporte para os chamados.</b>  <b>digita√ß√£o de pato</b> .  O que isso significa? <br><br>  A digita√ß√£o forte exige convers√£o expl√≠cita e n√£o produz essa convers√£o por si s√≥, como √© o caso, por exemplo, em JavaScript.  Portanto, a seguinte listagem de c√≥digo no Ruby falhar√°: <br><br><pre><code class="javascript hljs"><span class="hljs-number"><span class="hljs-number">1</span></span> + <span class="hljs-string"><span class="hljs-string">'1'</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span> #=&gt; <span class="hljs-built_in"><span class="hljs-built_in">TypeError</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> can<span class="hljs-string"><span class="hljs-string">'t be coerced into Integer)</span></span></code> </pre> <br>  Na digita√ß√£o din√¢mica, a verifica√ß√£o de tipo ocorre em tempo de execu√ß√£o, o que nos permite n√£o especificar os tipos de vari√°veis ‚Äã‚Äãe usar a mesma vari√°vel para armazenar valores de tipos diferentes: <br><br><pre> <code class="javascript hljs">x = <span class="hljs-number"><span class="hljs-number">123</span></span> x = <span class="hljs-string"><span class="hljs-string">"123"</span></span> x = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>]</code> </pre><br>  A declara√ß√£o a seguir √© geralmente dada como uma explica√ß√£o do termo "digita√ß√£o de pato": se ele se parece com um pato, nada como um pato e grasna como um pato, √© mais prov√°vel que seja um pato.  I.e.  A digita√ß√£o com patos, contando com o comportamento dos objetos, fornece uma flexibilidade adicional na cria√ß√£o de nossos sistemas.  Por exemplo, no exemplo abaixo, o valor para n√≥s n√£o √© o tipo do argumento de <code>collection</code> , mas sua capacidade de responder a mensagens em <code>blank?</code>  e <code>map</code> : <br><br><pre> <code class="javascript hljs">def process(collection) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> collection.blank? collection.map { |item| do_something_with(item) } end</code> </pre><br>  A capacidade de criar esses "patos" √© uma ferramenta muito poderosa.  No entanto, como qualquer outra ferramenta poderosa, requer muito cuidado ao usar.  Isso pode ser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">verificado pela pesquisa da Rollbar</a> , onde analisaram mais de 1000 aplica√ß√µes ferrovi√°rias e identificaram os erros mais comuns.  E 2 dos 10 erros mais comuns est√£o conectados precisamente ao fato de o objeto n√£o poder responder a uma mensagem espec√≠fica.  E, portanto, verificar o comportamento do objeto que a digita√ß√£o com patos nos fornece em muitos casos pode n√£o ser suficiente. <br><br>  Podemos observar como a verifica√ß√£o de tipo √© adicionada aos idiomas din√¢micos de uma forma ou de outra: <br><br><ul><li>  TypeScript leva a verifica√ß√£o de tipo para desenvolvedores JavaScript </li><li>  Dicas de tipo foram adicionadas no Python 3 </li><li>  O dializador faz um bom trabalho de verifica√ß√£o de tipo para Erlang / Elixir </li><li>  √çngreme e sorvete adicionam verifica√ß√£o de tipo no Ruby 2.x </li></ul><br>  No entanto, antes de falar sobre outra ferramenta para trabalhar com tipos de maneira mais eficiente no Ruby, vejamos mais dois problemas para os quais gostaria de encontrar uma solu√ß√£o. <br><br><h4>  Raz√£o 2. O problema geral dos desenvolvedores em v√°rias linguagens de programa√ß√£o </h4><br>  Vamos lembrar a defini√ß√£o dos tipos de dados que eu dei no in√≠cio do artigo: <blockquote>  Os tipos s√£o como voc√™ descreve os dados com os quais seu programa trabalhar√°. </blockquote>  I.e.  Os tipos foram criados para nos ajudar a descrever dados de nossa √°rea de assunto em que nossos sistemas operam.  No entanto, geralmente em vez de operar com os tipos de dados que criamos a partir de nossa √°rea de assunto, usamos tipos primitivos, como n√∫meros, seq√º√™ncias de caracteres, matrizes etc., que n√£o dizem nada sobre nossa √°rea de assunto.  Esse problema geralmente √© classificado como Obsess√£o primitiva (obsess√£o por primitivos). <br><br>  Aqui est√° um exemplo t√≠pico de Obsess√£o Primitiva: <br><br><pre> <code class="javascript hljs">price = <span class="hljs-number"><span class="hljs-number">9.99</span></span> # vs Money = Struct.new(:amount_cents, :currency) price = Money.new(<span class="hljs-number"><span class="hljs-number">9</span></span>_99, <span class="hljs-string"><span class="hljs-string">'USD'</span></span>)</code> </pre><br>  Em vez de descrever o tipo de dados para trabalhar com dinheiro, n√∫meros regulares s√£o frequentemente usados.  E esse n√∫mero, como qualquer outro tipo primitivo, n√£o diz nada sobre a nossa √°rea de assunto.  Na minha opini√£o, esse √© o maior problema do uso de primitivas, em vez de criar seu pr√≥prio sistema de tipos, onde esses tipos descrever√£o dados da nossa √°rea de assunto.  N√≥s mesmos rejeitamos as vantagens que podemos obter com o uso de tipos. <br><br>  Falarei sobre essas vantagens logo ap√≥s abordar outra quest√£o que nossa estrutura favorita do Ruby on Rails nos ensinou, gra√ßas √† qual, tenho certeza, a maioria das pessoas aqui veio para o Ruby. <br><br><h4>  Raz√£o 3. O problema que a estrutura do Ruby on Rails nos acostumava </h4><br>  O Ruby on Rails, ou melhor, a estrutura <code>ActiveRecord</code> ORM embutida, nos ensinou que objetos que est√£o em um estado inv√°lido s√£o normais.  Na minha opini√£o, isso est√° longe de ser a melhor id√©ia.  E vou tentar explicar isso. <br><br>  Veja este exemplo: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> &lt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationRecord</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">validates</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">platform</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">presence</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class"> </span></span>= App.new app.valid? # =&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre><br>  N√£o √© dif√≠cil entender que o objeto do <code>app</code> ter√° um estado inv√°lido: a valida√ß√£o do modelo do <code>App</code> exige que os objetos desse modelo tenham um atributo de <code>platform</code> e nosso objeto tenha esse atributo vazio. <br><br>  Agora, vamos tentar passar esse objeto em um estado inv√°lido para um servi√ßo que espera o objeto <code>App</code> como argumento e execute algumas a√ß√µes, dependendo do atributo de <code>platform</code> desse objeto: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DoSomethingWithAppPlatform</span></span></span><span class="hljs-class"> # @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">param</span></span></span><span class="hljs-class"> [</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class"> # # @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> [</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class">) # </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">something</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">platform</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DoSomethingWithAppPlatform</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class">)</span></span></code> </pre><br>  Nesse caso, mesmo a verifica√ß√£o de tipo seria aprovada.  No entanto, como esse atributo est√° vazio para o objeto, n√£o est√° claro como o servi√ßo lidar√° com esse caso.  De qualquer forma, tendo a capacidade de criar objetos em um estado inv√°lido, nos condenamos √† necessidade de lidar constantemente com casos em que um estado inv√°lido vazou para o nosso sistema. <br><br>  Mas vamos pensar em um problema mais profundo.  Em geral, por que verificamos a validade dos dados?  Como regra, para garantir que um estado inv√°lido n√£o vaze para nossos sistemas.  Se √© t√£o importante garantir que um estado inv√°lido n√£o seja permitido, por que permitimos que objetos com um estado inv√°lido sejam criados?  Especialmente quando estamos lidando com objetos importantes como o modelo ActiveRecord, que geralmente se refere √† l√≥gica comercial raiz.  Na minha opini√£o, isso parece uma p√©ssima id√©ia. <br><br>  Portanto, resumindo tudo isso, temos os seguintes problemas ao trabalhar com dados no Ruby / Rails: <br><br><ul><li>  a pr√≥pria linguagem possui um mecanismo para verificar o comportamento, mas n√£o os dados </li><li>  n√≥s, como desenvolvedores em outros idiomas, tendemos a usar tipos de dados primitivos em vez de criar um sistema de tipos para nossa √°rea de assunto </li><li>  O Rails nos acostumou ao fato de que a presen√ßa de objetos em um estado inv√°lido √© normal, embora essa solu√ß√£o pare√ßa uma p√©ssima id√©ia </li></ul><br><h4>  Como esses problemas podem ser resolvidos? </h4><br>  Gostaria de considerar uma das solu√ß√µes para os problemas descritos acima, usando um exemplo de implementa√ß√£o de recursos reais no Appodeal.  No processo de coleta de estat√≠sticas nas estat√≠sticas de usu√°rios ativos di√°rios (daqui por diante DAU) para aplicativos que usam o Appodeal para gerar receita, chegamos aproximadamente √† seguinte estrutura de dados que precisamos coletar: <br><br><pre> <code class="javascript hljs">DailyActiveUsersData = Struct.new( :app_id, :country_id, :user_id, :ad_type, :platform_id, :ad_id, :first_request_date, <span class="hljs-attr"><span class="hljs-attr">keyword_init</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> )</code> </pre><br>  Essa estrutura tem os mesmos problemas que escrevi acima: <br><br><ul><li>  qualquer verifica√ß√£o de tipo est√° completamente ausente, o que torna claro quais valores os atributos dessa estrutura podem levar </li><li>  n√£o h√° descri√ß√£o dos dados usados ‚Äã‚Äãnessa estrutura e, em vez dos tipos espec√≠ficos para o nosso dom√≠nio, s√£o usadas primitivas </li><li>  estrutura pode existir em um estado inv√°lido </li></ul><br>  Para resolver esses problemas, decidimos usar as bibliotecas <code>dry-types</code> e <code>dry-struct</code> .  <code>dry-types</code> √© um sistema <code>dry-types</code> simples e extens√≠vel para Ruby, √∫til para fundi√ß√£o, aplica√ß√£o de v√°rias restri√ß√µes, defini√ß√£o de estruturas complexas etc. <code>dry-struct</code> √© uma biblioteca criada sobre <code>dry-types</code> que fornece uma DSL conveniente para definir estruturas digitadas / aulas. <br><br>  Para descrever os dados da nossa √°rea de assunto usada na estrutura para coletar DAUs, foi criado o seguinte sistema de tipos: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span> Types include Dry::Types.module AdTypeId = Types::Strict::Integer.enum(AD_TYPES.invert) EntityId = Types::Strict::Integer.constrained(gt: <span class="hljs-number"><span class="hljs-number">0</span></span>) PlatformId = Types::Strict::Integer.enum(PLATFORMS.invert) Uuid = Types::Strict::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.constrained(format: UUID_REGEX) Zero = Types.Constant(<span class="hljs-number"><span class="hljs-number">0</span></span>) end</code> </pre><br>  Agora recebemos uma descri√ß√£o dos dados que s√£o usados ‚Äã‚Äãem nosso sistema e que podemos usar na estrutura.  Como voc√™ pode ver, os tipos <code>EntityId</code> e <code>Uuid</code> t√™m algumas limita√ß√µes, e os tipos enumer√°veis <code>AdTypeId</code> e <code>PlatformId</code> podem ter apenas valores de um conjunto espec√≠fico.  Como trabalhar com esses tipos?  Considere o <code>PlatformId</code> como um exemplo: <br><br><pre> <code class="javascript hljs">#     enumerable- PLATFORMS = { <span class="hljs-string"><span class="hljs-string">'android'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'fire_os'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'ios'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> }.freeze #       , #     Types::PlatformId[<span class="hljs-number"><span class="hljs-number">1</span></span>] == Types::PlatformId[<span class="hljs-string"><span class="hljs-string">'android'</span></span>] #    ,    #   ,     Types::PlatformId[<span class="hljs-string"><span class="hljs-string">'fire_os'</span></span>] # =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> #     ,   Types::PlatformId[<span class="hljs-string"><span class="hljs-string">'windows'</span></span>] # =&gt; Dry::Types::ConstraintError</code> </pre><br>  Ent√£o, usando os pr√≥prios tipos, descobri.  Agora vamos aplic√°-los √† nossa estrutura.  Como resultado, obtivemos o seguinte: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DailyActiveUsersData</span></span></span><span class="hljs-class"> &lt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Dry</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app_id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">country_id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user_id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ad_type</span></span></span><span class="hljs-class">, (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AdTypeId</span></span></span><span class="hljs-class"> «Ä </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Zero</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">platform_id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlarformId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ad_id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Uuid</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">first_request_date</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Strict</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Date</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  O que vemos agora na estrutura de dados da DAU?  Usando <code>dry-types</code> <code>dry-struct</code> nos livramos dos problemas associados √† falta de verifica√ß√£o do tipo de dados e √† falta de descri√ß√£o dos dados.  Agora, qualquer pessoa, tendo examinado essa estrutura e a descri√ß√£o dos tipos usados ‚Äã‚Äãnela, pode entender quais valores cada atributo pode assumir. <br><br>  Quanto ao problema com objetos em estado inv√°lido, <code>dry-struct</code> nos salva disso: se tentarmos inicializar a estrutura com valores inv√°lidos, obteremos um erro.  E para os casos em que a corre√ß√£o dos dados √© essencial (e, no caso da coleta de DAU, √© o caso conosco), na minha opini√£o, obter uma exce√ß√£o √© muito melhor do que tentar lidar com dados inv√°lidos posteriormente.  Al√©m disso, se o processo de teste estiver bem estabelecido para voc√™ (e esse √© exatamente o caso conosco), com alta probabilidade o c√≥digo que gera esses erros simplesmente n√£o chegar√° ao ambiente de produ√ß√£o. <br><br>  Al√©m da incapacidade de inicializar objetos em um estado inv√°lido, o <code>dry-struct</code> tamb√©m n√£o permite alterar objetos ap√≥s a inicializa√ß√£o.  Gra√ßas a esses dois fatores, temos a garantia de que os objetos dessas estruturas estar√£o em um estado v√°lido e voc√™ poder√° confiar com seguran√ßa nesses dados em qualquer lugar do sistema. <br><br><h4>  Sum√°rio </h4><br>  Neste artigo, tentei descrever os problemas que voc√™ pode encontrar ao trabalhar com dados no Ruby, al√©m de falar sobre as ferramentas que usamos para solucionar esses problemas.  E, gra√ßas √† implementa√ß√£o dessas ferramentas, parei de me preocupar com a corre√ß√£o dos dados com os quais estamos trabalhando.  Isso n√£o √© perfeito?  Esse n√£o √© o objetivo de nenhum instrumento - facilitar nossa vida em algum aspecto dele?  E na minha opini√£o, <code>dry-types</code> <code>dry-struct</code> seu trabalho perfeitamente! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt433180/">https://habr.com/ru/post/pt433180/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt433168/index.html">Por que um programador faz um est√°gio na cozinha - uma conversa com o Dodo Pizza sobre gemba, .NET e abertura</a></li>
<li><a href="../pt433172/index.html">Apertamos o modo multijogador no jogo para celular "Crie palavras de palavras" no iOS e Android escritas em C ++</a></li>
<li><a href="../pt433174/index.html">Nem todos os patches s√£o igualmente √∫teis.</a></li>
<li><a href="../pt433176/index.html">API remota do Docker de autentica√ß√£o de certificado com verifica√ß√£o de revoga√ß√£o</a></li>
<li><a href="../pt433178/index.html">Como restauramos um arquivo .wav danificado</a></li>
<li><a href="../pt433182/index.html">√â poss√≠vel treinar um agente para negociar no mercado de a√ß√µes com refor√ßos? Implementa√ß√£o da linguagem R</a></li>
<li><a href="../pt433184/index.html">Lan√ßamento do ASP.NET Core 2.2. Novidades (2 de 3)</a></li>
<li><a href="../pt433186/index.html">N√£o basta contar pol√≠gonos para otimizar modelos 3D</a></li>
<li><a href="../pt433188/index.html">Um projeto de lei sobre o trabalho aut√¥nomo de Runet foi enviado √† Duma do Estado</a></li>
<li><a href="../pt433192/index.html">Kubernetes: uma solu√ß√£o de projeto pessoal incrivelmente acess√≠vel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>