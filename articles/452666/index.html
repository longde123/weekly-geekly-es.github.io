<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåµ ‚ôøÔ∏è üôáüèº C√≥mo hacer posibles micropagos en tu aplicaci√≥n üõ°Ô∏è üë®üèº‚Äçüé§ üó°Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Esta semana pas√© codificando mi primera aplicaci√≥n p√∫blica para mascotas basada en el bot de chat de Telegram que act√∫a como una billetera de Bitcoin ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo hacer posibles micropagos en tu aplicaci√≥n</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452666/"><p>  Esta semana pas√© codificando mi primera aplicaci√≥n p√∫blica para mascotas basada en el bot de chat de Telegram que act√∫a como una billetera de Bitcoin y permite enviar y recibir consejos entre los usuarios de Telegram y otras llamadas "aplicaciones Lightning".  Supongo que est√° familiarizado con Bitcoin y Telegram en general, intentar√© publicar en breve y sin profundizar en los detalles.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Puede encontrar</a> m√°s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">recursos sobre Bitcoin aqu√≠</a> y Telegram es simplemente un mensajero instant√°neo que le permite crear sus aplicaciones personalizadas (chat-bots) utilizando su plataforma. </p><br><h3>  ¬øCu√°les son los puntos clave de dicha aplicaci√≥n? </h3><br><ul><li>  Permite calificar las ideas y respuestas de otros usuarios con un valor real en lugar de <br>  'Me gusta virtual'.  Esto lleva la conversaci√≥n en l√≠nea a un nivel completamente nuevo. </li><li>  Ejemplo real de aplicaci√≥n de micropagos en funcionamiento que puede actuar con otras entidades <br>  a trav√©s de internet utilizando un protocolo abierto </li><li>  Todos los m√≥dulos son proyectos de c√≥digo abierto y pueden reutilizarse y ajustarse f√°cilmente <br>  para tu propio proyecto.  La aplicaci√≥n no se retransmite en servicios comerciales de terceros. <br>  Incluso cae en el campo del comercio electr√≥nico, que actualmente est√° casi cerrado, la aplicaci√≥n <br>  Se basa en soluciones abiertas. </li></ul><br><h3>  ¬øCu√°les son los casos de uso? </h3><br><p>  algo como esto ... <br></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/097/02b/175/09702b1750c94616a10fc66c1275c00f.png" alt="imagen"></div><a name="habracut"></a><br>  o asi .. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ef/1ff/85f/3ef1ff85f1e7b77662c63a9d4d838666.png" alt="imagen"></div><br><p>  ¬øQu√© significan los n√∫meros?  Estas son <b>unidades de bitcoin: satoshis</b> .  A mediados de 2019 1000 satoshis tiene un valor de $ 0.06.  Puede gastarlo en l√≠nea o cambiarlo a su moneda local utilizando muchos servicios disponibles.  Por lo tanto, este no es solo otro <i>"n√∫mero en una base de datos"</i> o un <i>"cup√≥n que puede gastar en nuestra tienda asociada"</i> , sino un <b>dinero real de Internet</b> . </p><br><p>  Puede preguntar qu√© hacer si no tiene ning√∫n bitcoin para usar en la aplicaci√≥n.  Simplemente puede recibir una sugerencia del usuario de la aplicaci√≥n existente o comprar una peque√±a cantidad de bitcoin en varios intercambios o billeteras bitcoin para tel√©fono m√≥vil o PC. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/883/661/461/883661461bdc686aec7d084d5d581236.png" alt="imagen"><img src="https://habrastorage.org/getpro/habr/post_images/779/716/5d9/7797165d93d292700d9a41a171d882a6.png" alt="imagen"><img src="https://habrastorage.org/getpro/habr/post_images/8fe/33b/84b/8fe33b84bb127132304634363bb4af42.png" alt="imagen"></p><br><p>  Cuando tienes bitcoin, puedes iniciar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@atomic_tipbot</a> y hacer un / dep√≥sito. </p><br><p>  Ver√° una factura, puede seleccionar el m√©todo de pago preferido y enviar dinero simplemente escaneando el c√≥digo QR o presionando el bot√≥n ( <i>"abrir en la billetera"</i> ) en la factura. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/8fe/33b/84b/8fe33b84bb127132304634363bb4af42.png" alt="imagen"><img src="https://habrastorage.org/getpro/habr/post_images/4a3/da5/f76/4a3da5f76574ac9ebb2161d56bceff62.png" alt="imagen"><img src="https://habrastorage.org/getpro/habr/post_images/54d/a43/0be/54da430be68237193dee82ade50bab37.png" alt="imagen"></p><br><p>  Confirme el pago en su billetera m√≥vil y ver√° una pantalla de confirmaci√≥n casi instant√°neamente en Telegram. </p><br><p>  Hasta ahora hemos tocado dos partes separadas de la aplicaci√≥n: el back-end de telegram bot y el sistema de procesamiento de pagos (en realidad, m√°s bien como su front-end). </p><br><p>  Para crear este bot de Telegram, he usado el bot de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Python Telegram</a> .  Y, por supuesto, el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">bot es de c√≥digo abierto</a> . </p><br><p>  Como un sistema de procesamiento de pagos para generar facturas, verificar el estado, enviar notificaciones y cuidar de UX, se utiliza <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">BTCPayServer,</a> cuya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n se puede encontrar aqu√≠</a> . </p><br><p>  Si est√° buscando c√≥mo procesar eventos de pago directamente, puede consultar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">las p√°ginas del manual de Electrum CLI</a> para pagos en cadena y ver soluciones para pagos fuera de cadena (Lightning) como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Lightning-charge</a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sparko</a> . </p><br><h3>  ¬°Dijiste 'sin terceros' y 'sin servicios en la nube'? </h3><br><p>  Si, eso es verdad.  En mi aplicaci√≥n, uso el alojamiento compartido gratuito de la instancia de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">BTCPayServer</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">BTCPayJungle</a> , pero es posible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">activar</a> incluso en su propio servidor dedicado.  Solo recuerde que necesita aproximadamente ~ 500 GB de espacio para almacenar la cadena de bloques de Bitcoin y Litecoin.  BTCPayServer no posee ninguna clave privada o informaci√≥n confidencial que pueda permitir a los piratas inform√°ticos controlar los fondos en su billetera.  Para los pagos en cadena (est√°ndar) debe proporcionar la clave xpub de su billetera a BTCPayServer para que pueda generar direcciones p√∫blicas.  De esta manera, la arquitectura BTCPay hace posible procesar pagos de manera no confiable incluso en un entorno compartido.  Es muy simple de configurar si usa billeteras comprobadas como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Electrum</a> . </p><br><h3>  ¬øQu√© es la red Lightning? </h3><br><p>  Es algo as√≠ como un complemento de Bitcoin que agrega una capa de abstracci√≥n adicional y permite realizar transacciones de bitcoin instant√°neas y casi gratuitas.  Todo esto es posible gracias a la magia criptogr√°fica de m√∫ltiples firmas, que a menudo se llama <em>contrato inteligente</em> .  Existen m√∫ltiples implementaciones del protocolo LN.  Estoy usando la implementaci√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">c-lightning</a> C. </p><br><p>  La principal diferencia entre los pagos dentro y fuera de la cadena (Lightning) est√° en c√≥mo se almacenan las transacciones.  Todas <b>las</b> transacciones en <b>cadena</b> se transmiten a toda la red, por lo que cada nodo bitcoin en ejecuci√≥n registrar√° esta transacci√≥n en blockchain, si se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">extrae el</a> bloque que contiene esta transacci√≥n.  Hola, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">BitFury</a> , ¬øestoy en lo cierto?  ;) Es por eso que llamamos a tales transacciones <b>en cadena</b> .  Dichas transacciones se almacenar√°n en blockchain hasta el final de su existencia.  Es posible rastrear, analizar y monitorear p√∫blicamente cualquier transacci√≥n de este tipo a trav√©s de la red. </p><br><p>  En caso de transacciones <b>fuera de la cadena</b> (Lightning), las cosas suceden de otra manera.  Cada nodo de rayo tiene <i>(puede ser muchas)</i> direcciones en la cadena, desde donde comienza todo.  Cuando se reciben fondos en dicha direcci√≥n, el uso del nodo de t√©cnicas de criptograf√≠a puede abrir el llamado <i>canal de rayos</i> a otro nodo, lo que significa que estos dos nodos llegaron a un acuerdo sobre la disponibilidad de fondos entre ellos.  M√°s tarde, todas las transacciones que se realizan a trav√©s del canal (transacciones propias, o puede ser una transacci√≥n enrutada desde otro nodo) se almacenan solo en esos dos nodos (y el nodo intermedio si existiera).  Las √∫nicas transacciones que se almacenan en las redes blockchain son las transacciones de apertura y cierre de canales.  Es por eso que las transacciones Lightning que llamamos <b>fuera de la cadena</b> .  Principalmente existen solo en el archivo de base de datos de nodos. </p><br><h3>  Todo se visualiza en el diagrama. </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/3c6/636/b8c/3c6636b8c98d52aab9bd09ff9c52afcb.png" alt="imagen"><br><p>  Cuento corto: </p><br><p>  1) El usuario env√≠a un mensaje y solicita un dep√≥sito al bot en <b>Telegram</b> </p><br><p>  2) Telegram activa la <b>aplicaci√≥n python</b> de bot </p><br><p>  3) la <b>aplicaci√≥n Python</b> env√≠a una solicitud a <b>BTCPayServer</b> </p><br><p>  4) BTCPayServer genera direcciones entrantes para BTC y LTC, y tambi√©n se pone en contacto con <b>lightning-charge</b> , que obtiene datos del demonio <b>c-lightning</b> .  Como resultado, obtenemos un marco HTML bien manejado para el procesamiento de pagos </p><br><p>  5) El usuario paga la factura y ver√° la confirmaci√≥n </p><br><p>  6) <b>BTCPayServer</b> env√≠a una <i>notificaci√≥n de pago de</i> <b>factura</b> (IPN) a la URL de devoluci√≥n de llamada especificada, en nuestro caso, <br>  ir√° a <b>callbacks.py</b> (otra aplicaci√≥n de Python para escuchar las devoluciones de llamada) </p><br><p>  7) De acuerdo con los detalles completos del pago, el saldo del usuario cambia y el usuario recibe una notificaci√≥n </p><br><p>  <i>... si el usuario decide retirar fondos (propinas que recibi√≥) ...</i> </p><br><p>  8) <b>La aplicaci√≥n Python de Bot</b> escucha el texto o la imagen de QR, cuando recibe datos de la factura (cadena larga de caracteres) luego env√≠a la solicitud para pagar esa factura a otra aplicaci√≥n Python <b>paylightning.py *</b> , que inicializa los pagos usando c-lightning RPC </p><br><img src="https://habrastorage.org/getpro/habr/post_images/518/3dc/c81/5183dcc817817f1aa676ff74d17d08bb.png" alt="imagen"><br><p>  <i>* Para ser justos, necesito mencionar que mi envoltorio de pago paylightning.py est√° incompleto y puede dar resultados falsos negativos en algunos casos espec√≠ficos.</i>  <i>Debe usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un contenedor de pago bien probado para c-lightning</a> en caso de uso similar a la producci√≥n.</i> </p><br><p>  Los usuarios pueden enviarse consejos entre ellos en chats grupales y enviar / recibir <b>valor</b> sin ning√∫n l√≠mite.  Pero eso no es todo.  Gracias al protocolo Lightning Network, que se encuentra en alg√∫n tipo de red de pago unificada y simplificada, puede enviar las mismas monedas de saldo a aplicaciones completamente diferentes.  Hay otro tip-bot de bitcoin en telegram: @lntxbot.  El usuario puede solicitar un dep√≥sito a este bot </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f09/c3a/ef9/f09c3aef995f7a82560987646b0d8ee0.png" alt="imagen"><img src="https://habrastorage.org/getpro/habr/post_images/1e2/344/82c/1e234482c56aa0df1d4b341ecfe3beb8.png" alt="imagen"></p><br><p>  ¬°Simplemente reenv√≠e datos de @lntxbot a @atomic_tipbot y voul'a! </p><br><p>  Esto ya no es un 'intercambio de n√∫meros en la base de datos' sino un pago entre dos 'bases de datos' separadas y no relacionadas.  Bot ya tiene pocos 'LApps' integrados: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sat2.io</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lnsms.world</a> . </p><br><p>  <b>Usted puede preguntar, ¬øqu√© significa exactamente la <i>integraci√≥n de LApp</i> ?</b> </p><br><p>  Cada nodo de <i>Lightning Network</i> act√∫a como una billetera bitcoin.  Tiene equilibrio tanto dentro como fuera de la cadena.  El saldo en cadena generalmente se usa para abrir canales y almacenar fondos de canales cerrados, en tareas de mantenimiento de nodos cortos.  El saldo fuera de la cadena es exactamente lo que se usa para intercambiar fondos entre nodos.  Las funciones principales de cada nodo es la capacidad de enviar o recibir fondos, por lo que el nodo como software proporciona m√©todos de <i><b>pago</b></i> y <i><b>facturaci√≥n</b></i> .  En breve mostrar√© c√≥mo sucede: </p><br><pre><code class="bash hljs">user@ln-node:/ % lightning-cli invoice 1000000000 internal_description external_description { <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"expires_at"</span></span> : 1558709834, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6"</span></span> }</code> </pre> <br><p>  La <a href="">factura BOLT11</a> se genera en este caso, que es un formato unificado para solicitudes de pago en la red Bitcoin (as√≠ como Litecoin).  Esta cadena incluye datos sobre el destinatario de la factura, el importe, la marca de tiempo, la caducidad, etc.  Para decodificar esta cadena, c-lightning proporciona el m√©todo decodepay: </p><br><pre> <code class="bash hljs">user@ln-node:/ % lightning-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 { <span class="hljs-string"><span class="hljs-string">"currency"</span></span> : <span class="hljs-string"><span class="hljs-string">"bc"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558105034, <span class="hljs-string"><span class="hljs-string">"expiry"</span></span> : 604800, <span class="hljs-string"><span class="hljs-string">"payee"</span></span> : <span class="hljs-string"><span class="hljs-string">"025a14b8ed40583d67aec92da19453e0b2d1fbbf75f96f85d3dd0ff61a51ee0490"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 1000000000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"1000000000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"external_description"</span></span>, <span class="hljs-string"><span class="hljs-string">"min_final_cltv_expiry"</span></span> : 10, <span class="hljs-string"><span class="hljs-string">"routes"</span></span> : [ [ { <span class="hljs-string"><span class="hljs-string">"pubkey"</span></span> : <span class="hljs-string"><span class="hljs-string">"03a20c0c2ae4508b669a70e5f82f08f69a3da5da3bf0c973673c3fe977db0f61e3"</span></span>, <span class="hljs-string"><span class="hljs-string">"short_channel_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"574012x1255x1"</span></span>, <span class="hljs-string"><span class="hljs-string">"fee_base_msat"</span></span> : 1000, <span class="hljs-string"><span class="hljs-string">"fee_proportional_millionths"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"cltv_expiry_delta"</span></span> : 144 } ] ], <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"signature"</span></span> : <span class="hljs-string"><span class="hljs-string">"304502210099f31dffd18b6db8296637db3e3a1ffbaf7b7db087a2ad1eedb7639f25e78b25022079038370073681aa1e1a7a05de6588e98ead078896d0a37a15b755c212dc3d37"</span></span> }</code> rayo-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 <code class="bash hljs">user@ln-node:/ % lightning-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 { <span class="hljs-string"><span class="hljs-string">"currency"</span></span> : <span class="hljs-string"><span class="hljs-string">"bc"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558105034, <span class="hljs-string"><span class="hljs-string">"expiry"</span></span> : 604800, <span class="hljs-string"><span class="hljs-string">"payee"</span></span> : <span class="hljs-string"><span class="hljs-string">"025a14b8ed40583d67aec92da19453e0b2d1fbbf75f96f85d3dd0ff61a51ee0490"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 1000000000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"1000000000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"external_description"</span></span>, <span class="hljs-string"><span class="hljs-string">"min_final_cltv_expiry"</span></span> : 10, <span class="hljs-string"><span class="hljs-string">"routes"</span></span> : [ [ { <span class="hljs-string"><span class="hljs-string">"pubkey"</span></span> : <span class="hljs-string"><span class="hljs-string">"03a20c0c2ae4508b669a70e5f82f08f69a3da5da3bf0c973673c3fe977db0f61e3"</span></span>, <span class="hljs-string"><span class="hljs-string">"short_channel_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"574012x1255x1"</span></span>, <span class="hljs-string"><span class="hljs-string">"fee_base_msat"</span></span> : 1000, <span class="hljs-string"><span class="hljs-string">"fee_proportional_millionths"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"cltv_expiry_delta"</span></span> : 144 } ] ], <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"signature"</span></span> : <span class="hljs-string"><span class="hljs-string">"304502210099f31dffd18b6db8296637db3e3a1ffbaf7b7db087a2ad1eedb7639f25e78b25022079038370073681aa1e1a7a05de6588e98ead078896d0a37a15b755c212dc3d37"</span></span> }</code> </pre> <br><p>  En caso de que necesitemos pagar alguna factura, debemos usar el m√©todo de pago de c-lightning: </p><br><pre> <code class="bash hljs">user@ln-node:/ % lightning-cli pay lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j { <span class="hljs-string"><span class="hljs-string">"id"</span></span> : 163, <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"c3e644a005f56e33df89facbce2c9dfcabbef5d105285a98272cacc77ab2de63"</span></span>, <span class="hljs-string"><span class="hljs-string">"destination"</span></span> : <span class="hljs-string"><span class="hljs-string">"03021c5f5f57322740e4ee6936452add19dc7ea7ccf90635f95119ab82a62ae268"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 200000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi_sent"</span></span> : 200003, <span class="hljs-string"><span class="hljs-string">"amount_sent_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200003msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558106072, <span class="hljs-string"><span class="hljs-string">"status"</span></span> : <span class="hljs-string"><span class="hljs-string">"complete"</span></span>, <span class="hljs-string"><span class="hljs-string">"payment_preimage"</span></span> : <span class="hljs-string"><span class="hljs-string">"1a9552b9f4e9199e26839353f870b12cc85b7674a2fb134e78aa370032611019"</span></span>, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j"</span></span> }</code> rayo-cli lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j pago <code class="bash hljs">user@ln-node:/ % lightning-cli pay lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j { <span class="hljs-string"><span class="hljs-string">"id"</span></span> : 163, <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"c3e644a005f56e33df89facbce2c9dfcabbef5d105285a98272cacc77ab2de63"</span></span>, <span class="hljs-string"><span class="hljs-string">"destination"</span></span> : <span class="hljs-string"><span class="hljs-string">"03021c5f5f57322740e4ee6936452add19dc7ea7ccf90635f95119ab82a62ae268"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 200000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi_sent"</span></span> : 200003, <span class="hljs-string"><span class="hljs-string">"amount_sent_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200003msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558106072, <span class="hljs-string"><span class="hljs-string">"status"</span></span> : <span class="hljs-string"><span class="hljs-string">"complete"</span></span>, <span class="hljs-string"><span class="hljs-string">"payment_preimage"</span></span> : <span class="hljs-string"><span class="hljs-string">"1a9552b9f4e9199e26839353f870b12cc85b7674a2fb134e78aa370032611019"</span></span>, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j"</span></span> }</code> </pre> <br><p>  Todos los estados de pagos son manejados por toda la red y su propio nodo.  No tiene la necesidad (pero tiene la posibilidad de hacerlo) de comunicarse con los desarrolladores de aplicaciones del lado receptor o su API, alg√∫n proveedor de procesamiento de tarjetas o cualquier banco para obtener confirmaci√≥n sobre su pago o liberar fondos de su cuenta cuenta  No hay devoluciones de cargo ni ning√∫n otro tipo de influencia externa en el saldo de sus cuentas.  Todo lo que necesita es un software que act√∫e seg√∫n las reglas de red descentralizadas.  Esta es una soluci√≥n para intercambiar un valor a trav√©s de Internet, sin la necesidad de ning√∫n tipo de √°rbitro en el medio que decida sobre su compatibilidad de pago con algunas reglas, a veces incluso antes desconocidas para todas las partes.  No hay reglas "internas" en bitcoin, todas las reglas que su aplicaci√≥n necesita completar son abiertas y conocidas. </p><br><p>  Esto hace posible <b>el</b> intercambio de valor <b>directo</b> , <b>casi gratis</b> e <b>instant√°neo a</b> trav√©s de Internet entre personas o incluso el software en s√≠ mismo de manera verdaderamente aut√≥noma. </p><br><p>  Si hay una manera de obtener datos de pago de otra aplicaci√≥n, puede actuar con ellos en sentido financiero.  Como en nuestro ejemplo, lnsms.world es una aplicaci√≥n web que le permite enviar sms a cualquier n√∫mero y pagar con bitcoin.  Para integrar dicha opci√≥n en nuestra aplicaci√≥n, simplemente necesitamos pasar los datos requeridos del formulario web a lnsms.world: </p><br><pre> <code class="python hljs">payload = { <span class="hljs-string"><span class="hljs-string">'number'</span></span>: phone_number, <span class="hljs-string"><span class="hljs-string">'text'</span></span>: text, <span class="hljs-string"><span class="hljs-string">'force_unicode'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } send_req = requests.post(<span class="hljs-string"><span class="hljs-string">'https://lnsms.world/invoice'</span></span>, data=payload) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> send_req.status_code == <span class="hljs-number"><span class="hljs-number">201</span></span>: plain_invoice = str(send_req.text)</code> </pre> <br><p>  No s√© por qu√© motivo, pero lnsms responde con el c√≥digo de estado 201 HTTP y devuelve la factura BOLT11.  Bueno, eso es suficiente para pagar esta factura y nuestros usuarios enviar√°n sms poco despu√©s de recibir el pago.  Podemos cobrar una tarifa por encima o no, esa es nuestra libre elecci√≥n. </p><br><p>  Ahora, imagine, que su bot es en realidad una aplicaci√≥n m√°s √∫til y no paga a otro bot, sino a otra entidad, conectada a Internet.  O, ¬øpueden ser pagos entre software, m√°quinas, tiendas, proveedores de servicios de forma peri√≥dica que se repiten cada pocos segundos?  ¬øSientes el poder de los micropagos?  As√≠ ser√° la Internet de las cosas.  Ya hay proyectos como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://althea.org/</a> y en un futuro cercano enfrentaremos grandes cambios en el campo que llamamos comercio electr√≥nico. </p><br><p>  Si le gusta esta publicaci√≥n e intenta realizar pagos con bitcoins usted mismo, puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dejarme un consejo en mi p√°gina de propinas</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/452666/">https://habr.com/ru/post/452666/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../452648/index.html">PHP: c√≥mo analizar un archivo XML complejo y no ahogarse en c√≥digo nativo</a></li>
<li><a href="../452652/index.html">Semana de la seguridad 21: un agujero en Whatsapp, una nueva vulnerabilidad en los procesadores Intel, Zero-Day en Windows</a></li>
<li><a href="../452656/index.html">Desarrollo del "firmware" m√°s simple para FPGAs instalados en Redd, y depuraci√≥n utilizando la prueba de memoria como ejemplo</a></li>
<li><a href="../452662/index.html">Servidores HPE en Selectel</a></li>
<li><a href="../452664/index.html">Factur√© $ 18,000 por una p√°gina web est√°tica ... y me sal√≠ con la suya</a></li>
<li><a href="../452668/index.html">C√≥mo verificar las cookies para el cumplimiento de GDPR: una nueva herramienta abierta ayudar√°</a></li>
<li><a href="../452670/index.html">¬øQui√©nes son los ingenieros de datos y c√≥mo se convierten?</a></li>
<li><a href="../452672/index.html">Habr semanal. Conoce la versi√≥n piloto de Habrapodcast</a></li>
<li><a href="../452674/index.html">Eventos digitales en Mosc√∫ del 21 al 26 de mayo</a></li>
<li><a href="../452682/index.html">Pron√≥stico y discusi√≥n: los sistemas de almacenamiento h√≠brido dar√°n paso a todo flash</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>