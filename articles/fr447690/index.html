<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé™ üôåüèΩ ‚úÖ Configuration compilable d'un syst√®me distribu√© ‚è™ üßôüèø üåÑ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, nous aimerions partager une mani√®re int√©ressante de g√©rer la configuration d'un syst√®me distribu√©. 
 La configuration est repr√©sent√©...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Configuration compilable d'un syst√®me distribu√©</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/primetalk/blog/447690/"><p>  Dans cet article, nous aimerions partager une mani√®re int√©ressante de g√©rer la configuration d'un syst√®me distribu√©. <br>  La configuration est repr√©sent√©e directement en langage Scala de mani√®re s√©curis√©e.  Un exemple d'impl√©mentation est d√©crit en d√©tail.  Divers aspects de la proposition sont discut√©s, y compris l'influence sur le processus de d√©veloppement global. </p><br><p><img src="https://habrastorage.org/webt/71/bl/ax/71blaxtldz-ia4yftyebaxbam7c.png" alt="Processus global de gestion de la configuration"></p><br><p>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">en russe</a> ) </p><a name="habracut"></a><br><h3 id="introduction">  Pr√©sentation </h3><br><p>  La construction de syst√®mes distribu√©s robustes n√©cessite l'utilisation d'une configuration correcte et coh√©rente sur tous les n≈ìuds.  Une solution typique consiste √† utiliser une description textuelle du d√©ploiement (terraform, ansible ou quelque chose de similaire) et des fichiers de configuration g√©n√©r√©s automatiquement (souvent - d√©di√©s √† chaque n≈ìud / r√¥le).  Nous voudrions √©galement utiliser les m√™mes protocoles des m√™mes versions sur chaque n≈ìud communiquant (sinon nous rencontrerions des probl√®mes d'incompatibilit√©).  Dans le monde JVM, cela signifie qu'au moins la biblioth√®que de messagerie doit √™tre de la m√™me version sur tous les n≈ìuds communicants. </p><br><p>  Qu'en est-il du test du syst√®me?  Bien s√ªr, nous devrions avoir des tests unitaires pour tous les composants avant de passer aux tests d'int√©gration.  Pour pouvoir extrapoler les r√©sultats des tests √† l'ex√©cution, nous devons nous assurer que les versions de toutes les biblioth√®ques sont conserv√©es identiques dans les environnements d'ex√©cution et de test. </p><br><p>  Lors de l'ex√©cution de tests d'int√©gration, il est souvent beaucoup plus facile d'avoir le m√™me chemin de classe sur tous les n≈ìuds.  Nous devons simplement nous assurer que le m√™me chemin de classe est utilis√© lors du d√©ploiement.  (Il est possible d'utiliser diff√©rents chemins de classe sur diff√©rents n≈ìuds, mais il est plus difficile de repr√©senter cette configuration et de la d√©ployer correctement.) Donc, pour garder les choses simples, nous ne consid√©rerons que des chemins de classe identiques sur tous les n≈ìuds. </p><br><p>  La configuration a tendance √† √©voluer avec le logiciel.  Nous utilisons g√©n√©ralement des versions pour identifier divers <br>  √©tapes de l'√©volution du logiciel.  Il semble raisonnable de couvrir la configuration sous la gestion des versions et d'identifier diff√©rentes configurations avec certaines √©tiquettes.  S'il n'y a qu'une seule configuration en production, nous pouvons utiliser la version unique comme identifiant.  Parfois, nous pouvons avoir plusieurs environnements de production.  Et pour chaque environnement, nous pourrions avoir besoin d'une branche de configuration distincte.  Ainsi, les configurations peuvent √™tre √©tiquet√©es avec une branche et une version pour identifier de mani√®re unique diff√©rentes configurations.  Chaque √©tiquette et version de branche correspond √† une combinaison unique de n≈ìuds distribu√©s, de ports, de ressources externes et de versions de biblioth√®que de chemin de classe sur chaque n≈ìud.  Ici, nous couvrirons uniquement la branche unique et identifierons les configurations par une version d√©cimale √† trois composants (1.2.3), de la m√™me mani√®re que les autres artefacts. </p><br><p>  Dans les environnements modernes, les fichiers de configuration ne sont plus modifi√©s manuellement.  En r√®gle g√©n√©rale, nous g√©n√©rons <br>  configurer les fichiers au moment du d√©ploiement et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ne jamais les toucher par la</a> suite.  On pourrait donc se demander pourquoi utilisons-nous toujours le format texte pour les fichiers de configuration?  Une option viable consiste √† placer la configuration √† l'int√©rieur d'une unit√© de compilation et √† b√©n√©ficier de la validation de la configuration au moment de la compilation. </p><br><p>  Dans cet article, nous examinerons l'id√©e de conserver la configuration dans l'artefact compil√©. </p><br><h3 id="compilable-configuration">  Configuration compilable </h3><br><p>  Dans cette section, nous allons discuter d'un exemple de configuration statique.  Deux services simples - le service d'√©cho et le client du service d'√©cho sont en cours de configuration et d'impl√©mentation.  Ensuite, deux syst√®mes distribu√©s diff√©rents avec les deux services sont instanci√©s.  L'un est pour une configuration √† n≈ìud unique et l'autre pour une configuration √† deux n≈ìuds. </p><br><p>  Un syst√®me distribu√© typique se compose de quelques n≈ìuds.  Les n≈ìuds pourraient √™tre identifi√©s en utilisant un certain type: </p><br><pre><code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Backend</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Frontend</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span></span></code> </pre> <br><p>  ou juste </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">hostName: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><p>  ou m√™me </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Singleton</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Singleton</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span></code> </pre> <br><p>  Ces n≈ìuds remplissent diff√©rents r√¥les, ex√©cutent certains services et devraient pouvoir communiquer avec les autres n≈ìuds au moyen de connexions TCP / HTTP. </p><br><p>  Pour la connexion TCP, au moins un num√©ro de port est requis.  Nous voulons √©galement nous assurer que le client et le serveur parlent le m√™me protocole.  Afin de mod√©liser une connexion entre des n≈ìuds, d√©clarons la classe suivante: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TcpEndPoint</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Protocol</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">node: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">NodeId</span></span></span></span><span class="hljs-class"><span class="hljs-params">, port: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Port</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Protocol</span></span></span></span><span class="hljs-class"><span class="hljs-params">]</span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><p>  o√π <code>Port</code> est juste un <code>Int</code> dans la plage autoris√©e: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PortNumber</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Refined</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>, <span class="hljs-type"><span class="hljs-type">Closed</span></span>[_0, <span class="hljs-type"><span class="hljs-type">W</span></span>.`<span class="hljs-number"><span class="hljs-number">65535</span></span>`.<span class="hljs-type"><span class="hljs-type">T</span></span>]]</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Types raffin√©s</b> <div class="spoiler_text"><p>  Voir la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">raffin√©e</a> .  En bref, cela permet d'ajouter des contraintes de temps de compilation √† d'autres types.  Dans ce cas, <code>Int</code> ne peut avoir que des valeurs 16 bits pouvant repr√©senter le num√©ro de port.  Il n'est pas n√©cessaire d'utiliser cette biblioth√®que pour cette approche de configuration.  Cela semble juste tr√®s bien. </p></div></div><br><p>  Pour HTTP (REST), nous pourrions √©galement avoir besoin d'un chemin d'acc√®s au service: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UrlPathPrefix</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Refined</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>, <span class="hljs-type"><span class="hljs-type">MatchesRegex</span></span>[<span class="hljs-type"><span class="hljs-type">W</span></span>.`<span class="hljs-string"><span class="hljs-string">"[a-zA-Z_0-9/]*"</span></span>`.<span class="hljs-type"><span class="hljs-type">T</span></span>]] <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PortWithPrefix</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Protocol</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">portNumber: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">PortNumber</span></span></span></span><span class="hljs-class"><span class="hljs-params">, pathPrefix: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">UrlPathPrefix</span></span></span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Type fant√¥me</b> <div class="spoiler_text"><p>  Afin d'identifier le protocole lors de la compilation, nous utilisons la fonction Scala de d√©claration de l'argument de type <code>Protocol</code> qui n'est pas utilis√© dans la classe.  C'est un soi-disant <em>type fant√¥me</em> .  Au moment de l'ex√©cution, nous avons rarement besoin d'une instance d'identifiant de protocole, c'est pourquoi nous ne la stockons pas.  Pendant la compilation, ce type fant√¥me offre une s√©curit√© de type suppl√©mentaire.  Nous ne pouvons pas passer le port avec un protocole incorrect. </p></div></div><br><p>  L'un des protocoles les plus utilis√©s est l'API REST avec s√©rialisation Json: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JsonHttpRestProtocol</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RequestMessage</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ResponseMessage</span></span></span><span class="hljs-class">]</span></span></code> </pre> <br><p>  o√π <code>RequestMessage</code> est le type de base des messages que le client peut envoyer au serveur et <code>ResponseMessage</code> est le message de r√©ponse du serveur.  Bien s√ªr, nous pouvons cr√©er d'autres descriptions de protocole qui sp√©cifient le protocole de communication avec la pr√©cision souhait√©e. </p><br><p>  Aux fins de cet article, nous utiliserons une version plus simple du protocole: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleHttpGetRest</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RequestMessage</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ResponseMessage</span></span></span><span class="hljs-class">]</span></span></code> </pre> <br><p>  Dans ce protocole, le message de demande est ajout√© √† l'URL et le message de r√©ponse est renvoy√© sous forme de cha√Æne ordinaire. </p><br><p>  Une configuration de service peut √™tre d√©crite par le nom du service, une collection de ports et certaines d√©pendances.  Il existe plusieurs fa√ßons de repr√©senter tous ces √©l√©ments dans Scala (par exemple, <code>HList</code> , types de donn√©es alg√©briques).  Aux fins de cet article, nous utiliserons Cake Pattern et repr√©senterons des pi√®ces combinables (modules) comme traits.  (Cake Pattern n'est pas une exigence pour cette approche de configuration compilable. C'est juste une impl√©mentation possible de l'id√©e.) </p><br><p>  Les d√©pendances pourraient √™tre repr√©sent√©es en utilisant le mod√®le de g√¢teau comme points de terminaison d'autres n≈ìuds: </p><br><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoProtocol</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">A</span></span></span><span class="hljs-class">] </span></span>= <span class="hljs-type"><span class="hljs-type">SimpleHttpGetRest</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>, <span class="hljs-type"><span class="hljs-type">A</span></span>] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">A</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">portNumber</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PortNumber</span></span> = <span class="hljs-number"><span class="hljs-number">8081</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">echoPort</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PortWithPrefix</span></span>[<span class="hljs-type"><span class="hljs-type">EchoProtocol</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>]] = <span class="hljs-type"><span class="hljs-type">PortWithPrefix</span></span>[<span class="hljs-type"><span class="hljs-type">EchoProtocol</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>]](portNumber, <span class="hljs-string"><span class="hljs-string">"echo"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">echoService</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">HttpSimpleGetEndPoint</span></span>[<span class="hljs-type"><span class="hljs-type">NodeId</span></span>, <span class="hljs-type"><span class="hljs-type">EchoProtocol</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>]] = providedSimpleService(echoPort) }</code> </pre> <br><p>  Le service d'√©cho n'a besoin que d'un port configur√©.  Et nous d√©clarons que ce port prend en charge le protocole d'√©cho.  Notez que nous n'avons pas besoin de sp√©cifier un port particulier pour le moment, car les traits permettent les d√©clarations de m√©thodes abstraites.  Si nous utilisons des m√©thodes abstraites, le compilateur n√©cessitera une impl√©mentation dans une instance de configuration.  Ici, nous avons fourni l'impl√©mentation ( <code>8081</code> ) et elle sera utilis√©e comme valeur par d√©faut si nous la sautons dans une configuration concr√®te. </p><br><p>  Nous pouvons d√©clarer une d√©pendance dans la configuration du client du service d'√©cho: </p><br><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoClientConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">A</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testMessage</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-string"><span class="hljs-string">"test"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pollInterval</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">FiniteDuration</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">echoServiceDependency</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">HttpSimpleGetEndPoint</span></span>[_, <span class="hljs-type"><span class="hljs-type">EchoProtocol</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>]] }</code> </pre> <br><p>  La d√©pendance a le m√™me type que <code>echoService</code> .  En particulier, il exige le m√™me protocole.  Par cons√©quent, nous pouvons √™tre s√ªrs que si nous connectons ces deux d√©pendances, elles fonctionneront correctement. </p><br><div class="spoiler">  <b class="spoiler_title">Mise en place des services</b> <div class="spoiler_text"><p>  Un service a besoin d'une fonction pour d√©marrer et s'arr√™ter normalement.  (La possibilit√© d'arr√™ter un service est essentielle pour les tests.) Encore une fois, il existe quelques options pour sp√©cifier une telle fonction pour une configuration donn√©e (par exemple, nous pourrions utiliser des classes de type).  Pour cet article, nous utiliserons √† nouveau Cake Pattern.  Nous pouvons repr√©senter un service utilisant <code>cats.Resource</code> qui fournit d√©j√† le bracketing et la lib√©ration des ressources.  Afin d'acqu√©rir une ressource, nous devons fournir une configuration et un certain contexte d'ex√©cution.  Ainsi, la fonction de d√©marrage du service pourrait ressembler √†: </p><br><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResourceReader</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">[_], </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class">] </span></span>= <span class="hljs-type"><span class="hljs-type">Reader</span></span>[<span class="hljs-type"><span class="hljs-type">Config</span></span>, <span class="hljs-type"><span class="hljs-type">Resource</span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>, <span class="hljs-type"><span class="hljs-type">A</span></span>]] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">[_]] </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">resource</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> implicit resolver: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">AddressResolver</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">F</span></span></span></span><span class="hljs-class"><span class="hljs-params">], timer: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Timer</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">F</span></span></span></span><span class="hljs-class"><span class="hljs-params">], contextShift: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">ContextShift</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">F</span></span></span></span><span class="hljs-class"><span class="hljs-params">], ec: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">ExecutionContext</span></span></span></span><span class="hljs-class"><span class="hljs-params">, applicative: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Applicative</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">F</span></span></span></span><span class="hljs-class"><span class="hljs-params">] </span></span></span><span class="hljs-class">)</span></span>: <span class="hljs-type"><span class="hljs-type">ResourceReader</span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>, <span class="hljs-type"><span class="hljs-type">Config</span></span>, <span class="hljs-type"><span class="hljs-type">Unit</span></span>] }</code> </pre> <br><p>  o√π </p><br><ul><li>  <code>Config</code> - type de configuration requis par ce d√©marreur de service </li><li>  <code>AddressResolver</code> - un objet d'ex√©cution qui a la capacit√© d'obtenir des adresses r√©elles d'autres n≈ìuds (continuez √† lire pour plus de d√©tails). </li></ul><br><p>  les autres types proviennent de <code>cats</code> : </p><br><ul><li>  <code>F[_]</code> - type d'effet (dans le cas le plus simple, <code>F[A]</code> pourrait √™tre juste <code>() =&gt; A</code> Dans cet article, nous utiliserons <code>cats.IO</code> ) </li><li>  <code>Reader[A,B]</code> - est plus ou moins synonyme d'une fonction <code>A =&gt; B</code> </li><li>  <code>cats.Resource</code> - a des moyens d'acqu√©rir et de lib√©rer </li><li>  <code>Timer</code> - permet de dormir / mesurer le temps </li><li>  <code>ContextShift</code> - analogue d' <code>ExecutionContext</code> </li><li>  <code>Applicative</code> - wrapper de fonctions en vigueur (presque une monade) (nous pourrions √©ventuellement le remplacer par autre chose) </li></ul><br><p>  En utilisant cette interface, nous pouvons impl√©menter quelques services.  Par exemple, un service qui ne fait rien: </p><br><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeroServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">[_]] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">&lt;</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Any</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resource</span></span></span></span>(...): <span class="hljs-type"><span class="hljs-type">ResourceReader</span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>, <span class="hljs-type"><span class="hljs-type">Config</span></span>, <span class="hljs-type"><span class="hljs-type">Unit</span></span>] = <span class="hljs-type"><span class="hljs-type">Reader</span></span>(_ =&gt; <span class="hljs-type"><span class="hljs-type">Resource</span></span>.pure[<span class="hljs-type"><span class="hljs-type">F</span></span>, <span class="hljs-type"><span class="hljs-type">Unit</span></span>](())) }</code> </pre> </div></div><br><p>  (Voir le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">code source</a> pour d'autres impl√©mentations de services - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">service d'√©cho</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©cho client</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">contr√¥leurs √† vie</a> .) </p><br><p>  Un n≈ìud est un objet unique qui ex√©cute quelques services (le d√©marrage d'une cha√Æne de ressources est activ√© par Cake Pattern): </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleNodeImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeroServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IO</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoServiceService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoClientService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FiniteDurationLifecycleServiceImpl</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">EchoConfig</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-type"><span class="hljs-type">EchoClientConfig</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-type"><span class="hljs-type">FiniteDurationLifecycleConfig</span></span> }</code> </pre> <br><p>  Notez que dans le n≈ìud, nous sp√©cifions le type exact de configuration requis par ce n≈ìud.  Le compilateur ne nous permet pas de construire l'objet (Cake) avec un type insuffisant, car chaque trait de service d√©clare une contrainte sur le type <code>Config</code> .  De plus, nous ne pourrons pas d√©marrer le n≈ìud sans fournir une configuration compl√®te. </p><br><div class="spoiler">  <b class="spoiler_title">R√©solution d'adresse de n≈ìud</b> <div class="spoiler_text"><p>  Afin d'√©tablir une connexion, nous avons besoin d'une v√©ritable adresse d'h√¥te pour chaque n≈ìud.  Il peut √™tre connu plus tard que d'autres parties de la configuration.  Par cons√©quent, nous avons besoin d'un moyen de fournir un mappage entre l'identifiant du n≈ìud et son adresse r√©elle.  Ce mappage est une fonction: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeAddress</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NodeId</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">host: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Uri</span></span></span></span><span class="hljs-class"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Host</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AddressResolver</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">[_]] </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve</span></span></span></span>[<span class="hljs-type"><span class="hljs-type">NodeId</span></span>](nodeId: <span class="hljs-type"><span class="hljs-type">NodeId</span></span>): <span class="hljs-type"><span class="hljs-type">F</span></span>[<span class="hljs-type"><span class="hljs-type">NodeAddress</span></span>[<span class="hljs-type"><span class="hljs-type">NodeId</span></span>]] }</code> </pre> <br><p>  Il existe plusieurs fa√ßons d'impl√©menter une telle fonction. </p><br><ol><li>  Si nous connaissons les adresses r√©elles avant le d√©ploiement, pendant l'instanciation des h√¥tes de n≈ìuds, nous pouvons g√©n√©rer du code Scala avec les adresses r√©elles et ex√©cuter la g√©n√©ration par la suite (qui effectue des v√©rifications de temps de compilation puis ex√©cute la suite de tests d'int√©gration).  Dans ce cas, notre fonction de mappage est connue statiquement et peut √™tre simplifi√©e en quelque chose comme une <code>Map[NodeId, NodeAddress]</code> . </li><li>  Parfois, nous n'obtenons des adresses r√©elles qu'√† un moment ult√©rieur lorsque le n≈ìud est r√©ellement d√©marr√©, ou nous n'avons pas d'adresses de n≈ìuds qui n'ont pas encore √©t√© d√©marr√©s.  Dans ce cas, nous pourrions avoir un service de d√©couverte qui est d√©marr√© avant tous les autres n≈ìuds et chaque n≈ìud peut publier son adresse dans ce service et s'abonner aux d√©pendances. </li><li>  Si nous pouvons modifier <code>/etc/hosts</code> , nous pouvons utiliser des noms d'h√¥te pr√©d√©finis (comme <code>my-project-main-node</code> et <code>echo-backend</code> ) et simplement associer ce nom √† l'adresse IP au moment du d√©ploiement. </li></ol><br><p>  Dans cet article, nous ne couvrons pas ces cas plus en d√©tail.  En fait, dans notre exemple de jouet, tous les n≈ìuds auront la m√™me adresse IP - <code>127.0.0.1</code> . </p></div></div><br><p>  Dans cet article, nous consid√©rerons deux configurations de syst√®me r√©parties: </p><br><ol><li>  Disposition √† n≈ìud unique, o√π tous les services sont plac√©s sur le n≈ìud unique. </li><li>  Disposition √† deux n≈ìuds, o√π le service et le client sont sur des n≈ìuds diff√©rents. </li></ol><br><p>  La configuration pour une disposition √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">n≈ìud unique</a> est la suivante: </p><br><div class="spoiler">  <b class="spoiler_title">Configuration √† n≈ìud unique</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleNodeConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoClientConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FiniteDurationLifecycleConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Singleton</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">//</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">identifier</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">of</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">the</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">single</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">node</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">//</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">configuration</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">of</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">server</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Singleton</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nodeId</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-type"><span class="hljs-type">Singleton</span></span> <span class="hljs-comment"><span class="hljs-comment">/** Type safe service port specification. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">portNumber</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PortNumber</span></span> = <span class="hljs-number"><span class="hljs-number">8088</span></span> <span class="hljs-comment"><span class="hljs-comment">// configuration of client /** We'll use the service provided by the same host. */ def echoServiceDependency = echoService override def testMessage: UrlPathElement = "hello" def pollInterval: FiniteDuration = 1.second // lifecycle controller configuration def lifetime: FiniteDuration = 10500.milliseconds // additional 0.5 seconds so that there are 10 requests, not 9. }</span></span></code> </pre> </div></div><br><p>  Ici, nous cr√©ons une configuration unique qui √©tend la configuration du serveur et du client.  Nous configurons √©galement un contr√¥leur de cycle de vie qui terminera normalement le client et le serveur apr√®s un intervalle de <code>lifetime</code> . </p><br><p>  Le m√™me ensemble d'impl√©mentations et de configurations de service peut √™tre utilis√© pour cr√©er la configuration d'un syst√®me avec deux n≈ìuds distincts.  Nous avons juste besoin de cr√©er <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">deux configurations de n≈ìuds distinctes</a> avec les services appropri√©s: </p><br><div class="spoiler">  <b class="spoiler_title">Configuration √† deux n≈ìuds</b> <div class="spoiler_text"><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeServerConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SigTermLifecycleConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">NodeIdImpl</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nodeId</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-type"><span class="hljs-type">NodeServer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">portNumber</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PortNumber</span></span> = <span class="hljs-number"><span class="hljs-number">8080</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeClientConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoClientConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FiniteDurationLifecycleConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// NB! dependency specification def echoServiceDependency = NodeServerConfig.echoService def pollInterval: FiniteDuration = 1.second def lifetime: FiniteDuration = 10500.milliseconds // additional 0.5 seconds so that there are 10 request, not 9. def testMessage: String = "dolly" }</span></span></code> </pre> </div></div><br><p>  Voyez comment nous sp√©cifions la d√©pendance.  Nous mentionnons le service fourni par l'autre n≈ìud comme une d√©pendance du n≈ìud actuel.  Le type de d√©pendance est v√©rifi√© car il contient un type fant√¥me qui d√©crit le protocole.  Et √† l'ex√©cution, nous aurons l'ID de n≈ìud correct.  C'est l'un des aspects importants de l'approche de configuration propos√©e.  Il nous permet de d√©finir le port une seule fois et de nous assurer que nous r√©f√©ren√ßons le bon port. </p><br><div class="spoiler">  <b class="spoiler_title">Impl√©mentation √† deux n≈ìuds</b> <div class="spoiler_text"><p>  Pour cette configuration, nous utilisons exactement les m√™mes impl√©mentations de services.  Aucun changement.  Cependant, nous cr√©ons deux impl√©mentations de n≈ìuds diff√©rentes qui contiennent diff√©rents ensembles de services: </p><br><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TwoJvmNodeServerImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeroServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IO</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoServiceService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SigIntLifecycleServiceImpl</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">EchoConfig</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-type"><span class="hljs-type">SigTermLifecycleConfig</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TwoJvmNodeClientImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeroServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IO</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoClientService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FiniteDurationLifecycleServiceImpl</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">EchoClientConfig</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-type"><span class="hljs-type">FiniteDurationLifecycleConfig</span></span> }</code> </pre> <br><p>  Le premier n≈ìud impl√©mente le serveur et n'a besoin que d'une configuration c√¥t√© serveur.  Le deuxi√®me n≈ìud impl√©mente le client et a besoin d'une autre partie de la configuration.  Les deux n≈ìuds n√©cessitent une sp√©cification de dur√©e de vie.  Aux fins de ce poste de service, le n≈ìud aura une dur√©e de vie infinie qui pourrait √™tre termin√©e √† l'aide de <code>SIGTERM</code> , tandis que le client d'√©cho se terminera apr√®s la dur√©e finie configur√©e.  Voir l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">application de d√©marrage</a> pour plus de d√©tails. </p></div></div><br><h4 id="overall-development-process">  Processus de d√©veloppement global </h4><br><p>  Voyons comment cette approche change la fa√ßon dont nous travaillons avec la configuration. </p><br><p>  La configuration en tant que code sera compil√©e et produit un artefact.  Il semble raisonnable de s√©parer l'artefact de configuration des autres artefacts de code.  Souvent, nous pouvons avoir une multitude de configurations sur la m√™me base de code.  Et bien s√ªr, nous pouvons avoir plusieurs versions de diff√©rentes branches de configuration.  Dans une configuration, nous pouvons s√©lectionner des versions particuli√®res de biblioth√®ques et cela restera constant chaque fois que nous d√©ploierons cette configuration. </p><br><p>  Un changement de configuration devient un changement de code.  Il devrait donc √™tre couvert par le m√™me processus d'assurance qualit√©: </p><br><p>  Ticket -&gt; PR -&gt; revue -&gt; fusion -&gt; int√©gration continue -&gt; d√©ploiement continu </p><br><p>  Il y a les cons√©quences suivantes de l'approche: </p><br><ol><li><p>  La configuration est coh√©rente pour l'instance d'un syst√®me particulier.  Il semble qu'il n'y ait aucun moyen d'avoir une connexion incorrecte entre les n≈ìuds. </p><br></li><li><p>  Il n'est pas facile de modifier la configuration dans un seul n≈ìud.  Il semble d√©raisonnable de se connecter et de modifier certains fichiers texte.  La d√©rive de la configuration devient donc moins possible. </p><br></li><li><p>  Les petits changements de configuration ne sont pas faciles √† faire. </p><br></li><li><p>  La plupart des changements de configuration suivront le m√™me processus de d√©veloppement et passeront un certain examen. </p><br></li></ol><br><p>  Avons-nous besoin d'un r√©f√©rentiel s√©par√© pour la configuration de production?  La configuration de production peut contenir des informations sensibles que nous aimerions garder hors de port√©e de nombreuses personnes.  Il peut donc √™tre utile de conserver un r√©f√©rentiel s√©par√© avec un acc√®s restreint qui contiendra la configuration de production.  Nous pouvons diviser la configuration en deux parties - une qui contient la plupart des param√®tres de production ouverts et une qui contient la partie secr√®te de la configuration.  Cela permettrait √† la plupart des d√©veloppeurs d'acc√©der √† la grande majorit√© des param√®tres tout en restreignant l'acc√®s aux choses vraiment sensibles.  Il est facile d'accomplir cela en utilisant des traits interm√©diaires avec des valeurs de param√®tres par d√©faut. </p><br><h3 id="variations">  Variations </h3><br><p>  Voyons les avantages et les inconv√©nients de l'approche propos√©e par rapport aux autres techniques de gestion de configuration. </p><br><p>  Tout d'abord, nous √©num√©rons quelques alternatives aux diff√©rents aspects de la mani√®re propos√©e de g√©rer la configuration: </p><br><ol><li>  Fichier texte sur la machine cible. </li><li>  Stockage de valeurs-cl√©s centralis√© (comme <code>etcd</code> / <code>etcd</code> ). </li><li>  Composants de sous-processus qui pourraient √™tre reconfigur√©s / red√©marr√©s sans red√©marrer le processus. </li><li>  Configuration hors contr√¥le d'artefact et de version. </li></ol><br><p>  Le fichier texte donne une certaine flexibilit√© en termes de correctifs ad hoc.  L'administrateur d'un syst√®me peut se connecter au n≈ìud cible, apporter une modification et simplement red√©marrer le service.  Ce n'est peut-√™tre pas aussi bon pour les syst√®mes plus gros.  Aucune trace n'est laiss√©e derri√®re le changement.  Le changement n'est pas examin√© par une autre paire d'yeux.  Il pourrait √™tre difficile de d√©terminer la cause du changement.  Il n'a pas √©t√© test√©.  Du point de vue d'un syst√®me distribu√©, un administrateur peut simplement oublier de mettre √† jour la configuration dans l'un des autres n≈ìuds. </p><br><p>  (Btw, si finalement il sera n√©cessaire de commencer √† utiliser des fichiers de configuration de texte, nous n'aurons qu'√† ajouter un analyseur + validateur qui pourrait produire le m√™me type de <code>Config</code> et qui serait suffisant pour commencer √† utiliser des configurations de texte. Cela montre √©galement que le la complexit√© de la configuration au moment de la compilation est un peu plus petite que la complexit√© des configurations bas√©es sur du texte, car dans la version bas√©e sur le texte, nous avons besoin de code suppl√©mentaire.) </p><br><p>  Le stockage centralis√© des valeurs-cl√©s est un bon m√©canisme de distribution des m√©ta-param√®tres d'application.  Ici, nous devons r√©fl√©chir √† ce que nous consid√©rons comme des valeurs de configuration et √† ce qui ne sont que des donn√©es.  √âtant donn√© une fonction <code>C =&gt; A =&gt; B</code> nous appelons g√©n√©ralement les valeurs rarement changeantes <code>C</code> "configuration", tandis que les donn√©es fr√©quemment modifi√©es <code>A</code> - ne sont que des donn√©es d'entr√©e.  La configuration doit √™tre fournie √† la fonction plus t√¥t que les donn√©es <code>A</code>  Compte tenu de cette id√©e, nous pouvons dire que c'est la fr√©quence attendue des changements qui pourrait √™tre utilis√©e pour distinguer les donn√©es de configuration des seules donn√©es.  De plus, les donn√©es proviennent g√©n√©ralement d'une source (utilisateur) et la configuration provient d'une source diff√©rente (admin).  Le traitement des param√®tres qui peuvent √™tre modifi√©s apr√®s l'initialisation du processus entra√Æne une augmentation de la complexit√© de l'application.  Pour ces param√®tres, nous devrons g√©rer leur m√©canisme de livraison, l'analyse et la validation, en g√©rant les valeurs incorrectes.  Par cons√©quent, afin de r√©duire la complexit√© du programme, nous ferions mieux de r√©duire le nombre de param√®tres qui peuvent changer au moment de l'ex√©cution (ou m√™me les √©liminer compl√®tement). </p><br><p>  Du point de vue de ce post, nous devrions faire une distinction entre les param√®tres statiques et dynamiques.  Si la logique de service n√©cessite une modification rare de certains param√®tres lors de l'ex√©cution, nous pouvons les appeler des param√®tres dynamiques.  Sinon, ils sont statiques et pourraient √™tre configur√©s en utilisant l'approche propos√©e.  Pour la reconfiguration dynamique, d'autres approches pourraient √™tre n√©cessaires.  Par exemple, certaines parties du syst√®me peuvent √™tre red√©marr√©es avec les nouveaux param√®tres de configuration d'une mani√®re similaire au red√©marrage de processus s√©par√©s d'un syst√®me distribu√©. <br>  (Mon humble avis est d'√©viter la reconfiguration du runtime car cela augmente la complexit√© du syst√®me. <br>  Il serait peut-√™tre plus simple de simplement compter sur la prise en charge par le syst√®me d'exploitation des processus de red√©marrage.  Cependant, cela pourrait ne pas toujours √™tre possible.) </p><br><p>  Un aspect important de l'utilisation de la configuration statique qui fait parfois penser √† la configuration dynamique (sans autres raisons) est le temps d'arr√™t du service pendant la mise √† jour de la configuration.  En effet, si nous devons apporter des modifications √† la configuration statique, nous devons red√©marrer le syst√®me pour que les nouvelles valeurs deviennent effectives.  Les exigences pour les temps d'arr√™t varient selon les syst√®mes, il n'est donc pas si critique que cela.  Si c'est critique, nous devons planifier √† l'avance les red√©marrages du syst√®me.  Par exemple, nous pourrions impl√©menter le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">drainage de connexion AWS ELB</a> .  Dans ce sc√©nario, chaque fois que nous devons red√©marrer le syst√®me, nous d√©marrons une nouvelle instance du syst√®me en parall√®le, puis nous y basculons ELB, tout en laissant l'ancien syst√®me terminer la maintenance des connexions existantes. </p><br><p>  Qu'en est-il de conserver la configuration √† l'int√©rieur de l'artefact versionn√© ou √† l'ext√©rieur?  Conserver la configuration √† l'int√©rieur d'un artefact signifie dans la plupart des cas que cette configuration a pass√© le m√™me processus d'assurance qualit√© que les autres artefacts.  On peut donc √™tre s√ªr que la configuration est de bonne qualit√© et fiable.  Au contraire, la configuration dans un fichier s√©par√© signifie qu'il n'y a aucune trace de qui et pourquoi a apport√© des modifications √† ce fichier.  Est-ce important?  Nous pensons que pour la plupart des syst√®mes de production, il est pr√©f√©rable d'avoir une configuration stable et de haute qualit√©. </p><br><p>  La version de l'artefact permet de savoir quand il a √©t√© cr√©√©, quelles valeurs il contient, quelles fonctionnalit√©s sont activ√©es / d√©sactiv√©es, qui √©tait responsable de chaque modification de la configuration.  Cela peut n√©cessiter des efforts pour conserver la configuration √† l'int√©rieur d'un artefact et c'est un choix de conception √† faire. </p><br><h3 id="pros--cons">  Avantages et inconv√©nients </h3><br><p>  Ici, nous aimerions souligner certains avantages et discuter de certains inconv√©nients de l'approche propos√©e. </p><br><h4 id="advantages">  Les avantages </h4><br><p>  Caract√©ristiques de la configuration compilable d'un syst√®me distribu√© complet: </p><br><ol><li>  Contr√¥le statique de la configuration.  Cela donne un haut niveau de confiance, que la configuration est correcte compte tenu des contraintes de type. </li><li>  Langage de configuration riche.  En r√®gle g√©n√©rale, d'autres approches de configuration sont limit√©es √† au plus la substitution de variables. <br>  En utilisant Scala on peut utiliser un large √©ventail de fonctionnalit√©s linguistiques pour am√©liorer la configuration.  Par exemple, nous pouvons utiliser des traits pour fournir des valeurs par d√©faut, des objets pour d√©finir une port√©e diff√©rente, nous pouvons nous r√©f√©rer √† des valeurs d√©finies une seule fois dans la port√©e externe (DRY).  Il est possible d'utiliser des s√©quences litt√©rales ou des instances de certaines classes ( <code>Seq</code> , <code>Map</code> , etc.). </li><li>  DSL  Scala a un support d√©cent pour les √©crivains DSL.  On peut utiliser ces fonctionnalit√©s pour √©tablir un langage de configuration plus pratique et convivial pour l'utilisateur final, de sorte que la configuration finale soit au moins lisible par les utilisateurs du domaine. </li><li>  Int√©grit√© et coh√©rence entre les n≈ìuds.  L'un des avantages d'avoir la configuration pour l'ensemble du syst√®me distribu√© en un seul endroit est que toutes les valeurs sont d√©finies strictement une fois puis r√©utilis√©es dans tous les endroits o√π nous en avons besoin.  Saisissez √©galement des d√©clarations de port s√ªrs pour garantir que dans toutes les configurations correctes possibles, les n≈ìuds du syst√®me parleront la m√™me langue.  Il existe des d√©pendances explicites entre les n≈ìuds, ce qui rend difficile d'oublier de fournir certains services. </li><li>  Haute qualit√© des changements.  L'approche globale consistant √† transmettre les modifications de configuration par le biais d'un processus de relations publiques normal √©tablit des normes de qualit√© √©lev√©es √©galement dans la configuration. </li><li>  Changements de configuration simultan√©s.  Chaque fois que nous apportons des modifications √† la configuration, le d√©ploiement automatique garantit que tous les n≈ìuds sont mis √† jour. </li><li>  Simplification d'application.  L'application n'a pas besoin d'analyser et de valider la configuration et de g√©rer les valeurs de configuration incorrectes.  Cela simplifie l'application globale.  (Une certaine augmentation de la complexit√© se trouve dans la configuration elle-m√™me, mais c'est un compromis conscient vers la s√©curit√©.) Il est assez simple de revenir √† la configuration ordinaire - ajoutez simplement les pi√®ces manquantes.  Il est plus facile de commencer avec la configuration compil√©e et de reporter la mise en ≈ìuvre de pi√®ces suppl√©mentaires √† une date ult√©rieure. </li><li>  Configuration versionn√©e.  Du fait que les changements de configuration suivent le m√™me processus de d√©veloppement, nous obtenons ainsi un artefact avec une version unique.  Cela nous permet de changer de configuration si n√©cessaire.  Nous pouvons m√™me d√©ployer une configuration utilis√©e il y a un an et elle fonctionnera exactement de la m√™me mani√®re.  Une configuration stable am√©liore la pr√©visibilit√© et la fiabilit√© du syst√®me distribu√©.  La configuration est fixe au moment de la compilation et ne peut pas √™tre facilement alt√©r√©e sur un syst√®me de production. </li><li>  Modularit√©  Le cadre propos√© est modulaire et les modules pourraient √™tre combin√©s de diverses mani√®res pour <br>  prendre en charge diff√©rentes configurations (configurations / mises en page).  En particulier, il est possible d'avoir une disposition √† n≈ìud unique √† petite √©chelle et un param√®tre √† n≈ìuds multiples √† grande √©chelle.  Il est raisonnable d'avoir plusieurs configurations de production. </li><li>  Test  √Ä des fins de test, on peut impl√©menter un service fictif et l'utiliser comme d√©pendance de mani√®re s√ªre.  Quelques dispositions de test diff√©rentes avec diff√©rentes pi√®ces remplac√©es par des maquettes pourraient √™tre maintenues simultan√©ment. </li><li>  Test d'int√©gration.  Parfois, dans les syst√®mes distribu√©s, il est difficile d'ex√©cuter des tests d'int√©gration.  En utilisant l'approche d√©crite pour taper la configuration s√ªre du syst√®me distribu√© complet, nous pouvons ex√©cuter toutes les pi√®ces distribu√©es sur un seul serveur de mani√®re contr√¥lable.  Il est facile d'imiter la situation <br>  lorsque l'un des services devient indisponible. </li></ol><br><h4 id="disadvantages">  Inconv√©nients </h4><br><p>  L'approche de configuration compil√©e est diff√©rente de la configuration "normale" et peut ne pas convenir √† tous les besoins.  Voici certains des inconv√©nients de la configuration compil√©e: </p><br><ol><li>  Configuration statique.  Il pourrait ne pas convenir √† toutes les applications.  Dans certains cas, il est n√©cessaire de fixer rapidement la configuration en production en contournant toutes les mesures de s√©curit√©.  Cette approche rend la t√¢che plus difficile.  La compilation et le red√©ploiement sont requis apr√®s toute modification de configuration.  C'est √† la fois la caract√©ristique et le fardeau. </li><li>  G√©n√©ration de configuration.  Lorsque la configuration est g√©n√©r√©e par un outil d'automatisation, cette approche n√©cessite une compilation ult√©rieure (qui peut √† son tour √©chouer).  Cela peut n√©cessiter des efforts suppl√©mentaires pour int√©grer cette √©tape suppl√©mentaire dans le syst√®me de g√©n√©ration. </li><li>  Instruments.  Il existe de nombreux outils utilis√©s aujourd'hui qui reposent sur des configurations bas√©es sur du texte.  Certains d'entre eux <br>  ne sera pas applicable lors de la compilation de la configuration. </li><li>  Un changement de mentalit√© est n√©cessaire.  Les d√©veloppeurs et DevOps connaissent bien les fichiers de configuration de texte.  L'id√©e de compiler la configuration peut leur para√Ætre √©trange. </li><li>  Avant d'introduire une configuration compilable, un processus de d√©veloppement logiciel de haute qualit√© est requis. </li></ol><br><p>  Il y a quelques limites √† l'exemple impl√©ment√©: </p><br><ol><li>  Si nous fournissons une configuration suppl√©mentaire qui n'est pas demand√©e par l'impl√©mentation du n≈ìud, le compilateur ne nous aidera pas √† d√©tecter l'impl√©mentation absente.  Cela pourrait √™tre r√©solu en utilisant <code>HList</code> ou ADT (classes de cas) pour la configuration des n≈ìuds au lieu des traits et du mod√®le de g√¢teau. </li><li>  Nous devons fournir un passe-partout dans le fichier de configuration: ( <code>package</code> , <code>import</code> , d√©clarations d' <code>object</code> ; <br>  <code>override def</code> pour les param√®tres qui ont des valeurs par d√©faut).  Cela pourrait √™tre partiellement r√©solu en utilisant une DSL. </li><li>  Dans cet article, nous ne couvrons pas la reconfiguration dynamique de clusters de n≈ìuds similaires. </li></ol><br><h3 id="conclusion">  Conclusion </h3><br><p>  Dans cet article, nous avons discut√© de l'id√©e de repr√©senter la configuration directement dans le code source d'une mani√®re s√ªre.  L'approche pourrait √™tre utilis√©e dans de nombreuses applications en remplacement des configurations XML et autres configurations bas√©es sur du texte.  Bien que notre exemple ait √©t√© impl√©ment√© dans Scala, il pourrait √©galement √™tre traduit dans d'autres langages compilables (comme Kotlin, C #, Swift, etc.).  On pourrait essayer cette approche dans un nouveau projet et, au cas o√π cela ne conviendrait pas bien, passer √† l'ancienne. </p><br><p>  Bien s√ªr, la configuration compilable n√©cessite un processus de d√©veloppement de haute qualit√©.  En retour, il promet de fournir une configuration robuste de haute qualit√©. </p><br><p>  Cette approche pourrait √™tre √©tendue de diff√©rentes mani√®res: </p><br><ol><li>  On pourrait utiliser des macros pour effectuer la validation de la configuration et √©chouer au moment de la compilation en cas d'√©chec de contraintes de logique m√©tier. </li><li>  Un DSL pourrait √™tre impl√©ment√© pour repr√©senter la configuration d'une mani√®re conviviale pour le domaine. </li><li>  Gestion dynamique des ressources avec ajustements de configuration automatiques.  Par exemple, lorsque nous ajustons le nombre de n≈ìuds de cluster, nous pouvons souhaiter (1) que les n≈ìuds obtiennent une configuration l√©g√®rement modifi√©e;  (2) gestionnaire de cluster pour recevoir les nouvelles informations sur les n≈ìuds. </li></ol><br><h3 id="thanks">  Merci </h3><br><p>  Je voudrais remercier Andrey Saksonov, Pavel Popov, Anton Nehaev pour leurs commentaires inspirants sur le brouillon de ce post qui m'ont aid√© √† le rendre plus clair. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr447690/">https://habr.com/ru/post/fr447690/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr447680/index.html">Exercices d'√©mulation: manuel Xbox 360 FMA</a></li>
<li><a href="../fr447682/index.html">Space Data Center: 24 heures avant le lancement</a></li>
<li><a href="../fr447684/index.html">Comment afficher les valeurs de l'entreprise dans un bureau (sans affiches ni slogans)</a></li>
<li><a href="../fr447686/index.html">Un param√®tre tr√®s important des lampes LED, que peu de gens connaissent</a></li>
<li><a href="../fr447688/index.html">√Ä la question sur le bitset</a></li>
<li><a href="../fr447694/index.html">Configuration du syst√®me distribu√© compil√©</a></li>
<li><a href="../fr447696/index.html">Pourquoi les villes s'opposent √† Amazon Go, les premiers magasins non cash</a></li>
<li><a href="../fr447698/index.html">Poudlard rouge: acad√©micien sans dipl√¥me</a></li>
<li><a href="../fr447700/index.html">La flexibilit√© √©motionnelle est la cl√© de la croissance personnelle.</a></li>
<li><a href="../fr447702/index.html">Le cercle math√©matique id√©al n'existe pas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>