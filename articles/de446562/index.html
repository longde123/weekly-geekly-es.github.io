<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèä üï∫üèΩ üîÑ Asynchronit√§t in der Programmierung üë¶üèæ üÄÑÔ∏è üë©‚Äçüíº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Im Bereich der Entwicklung hoch geladener Multithread- oder verteilter Anwendungen kommt es h√§ufig zu Diskussionen √ºber asynchrone Programmierung. Heu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Asynchronit√§t in der Programmierung</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/446562/"><p>  Im Bereich der Entwicklung hoch geladener Multithread- oder verteilter Anwendungen kommt es h√§ufig zu Diskussionen √ºber asynchrone Programmierung.  Heute werden wir uns eingehend mit Asynchronit√§t befassen und untersuchen, was es ist, wenn es auftritt, wie es sich auf den Code und die Programmiersprache auswirkt, die wir verwenden.  Wir werden herausfinden, warum Futures und Versprechen ben√∂tigt werden, und Coroutinen und Betriebssysteme ansprechen.  Dadurch werden die Kompromisse, die sich w√§hrend der Softwareentwicklung ergeben, deutlicher. </p><br><p>  Das Material basiert auf einer Abschrift eines Berichts von Ivan Puzyrevsky, einem Lehrer an der Yandex Data Analysis School. </p><br><p><img src="https://habrastorage.org/webt/zl/f-/6v/zlf-6v_wphtcesgmq7cvpvfctbk.png"></p><a name="habracut"></a><br><h1 id="videozapis">  Videoaufnahme </h1><br><iframe width="560" height="315" src="https://www.youtube.com/embed/g7dno0SupKY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><a name="section1"></a><br><h1 id="1-soderzhanie">  1. Inhalt </h1><br><div class="spoiler">  <b class="spoiler_title">Versteckter Text</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1. Inhalt</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2. Einf√ºhrung</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">3. Grundlegende Konzepte</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">3.1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Thread der Ausf√ºhrung</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">3.2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Multitasking und Parallelit√§t</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4. Blockieren und warten</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4.1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Nicht blockierendes Warten</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">5. Futures / Versprechen</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">5.1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Future &amp; Promise-Schnittstelle</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">5.2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Composition Computing</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">5.3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beispiele</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">5.4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beliebiger Kombinator</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">5.5.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">All-Kombinator</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">5.6.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">R√ºckrufanpassung</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">6. So machen Sie Code mit Coroutine lesbar</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">6.1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Coroutinen</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">6.2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Entwurf einer WaitFor-Implementierung</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">6.3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wie ist der Planungszyklus?</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">6.4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Coroutine TS</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">7. Was hast du erhalten?</a> </li></ul></div></div><br><a name="section2"></a><br><h1 id="2-vvedenie">  2. Einf√ºhrung </h1><br><p> Hallo allerseits, mein Name ist Ivan Puzyrevsky, ich arbeite f√ºr Yandex.  In den letzten sechs Jahren besch√§ftigte ich mich mit der Infrastruktur der Datenspeicherung und -verarbeitung, jetzt wechselte ich zum Produkt - auf der Suche nach Reisen, Hotels und Tickets.  Da ich lange in der Infrastruktur gearbeitet habe, habe ich viel Erfahrung mit dem Schreiben verschiedener geladener Anwendungen gesammelt.  Unsere Infrastruktur arbeitet t√§glich rund um die Uhr und ohne Unterbrechung auf Tausenden von Maschinen.  Nat√ºrlich m√ºssen Sie Code schreiben, damit er zuverl√§ssig und effizient funktioniert und die Aufgaben des Unternehmens l√∂st. </p><br><p>  Heute werden wir √ºber Asynchronit√§t sprechen.  Was ist Asynchronit√§t?  Es ist ein Missverh√§ltnis von etwas mit etwas in der Zeit.  Aus dieser Beschreibung geht im Allgemeinen nicht hervor, wor√ºber ich heute sprechen werde.  Um das Problem irgendwie zu kl√§ren, brauche ich ein Beispiel a la "Hallo Welt!".  Asynchronit√§t tritt normalerweise beim Schreiben von Netzwerkanwendungen auf, daher habe ich ein Netzwerkanalogon von ‚ÄûHallo Welt!‚Äú.  Dies ist eine Ping-Pong-App.  Der Code sieht folgenderma√üen aus: </p><br><pre> <code class="cpp hljs">socket s; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> x; x = read_from_socket(s, <span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x == <span class="hljs-string"><span class="hljs-string">"ping"</span></span>) { write_to_socket(s, <span class="hljs-string"><span class="hljs-string">"pong"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p>  Ich erstelle einen Socket, lese eine Zeile von dort und √ºberpr√ºfe, ob es Ping ist, dann schreibe ich Pong als Antwort.  Sehr einfach und klar.  Was passiert, wenn Sie solchen Code auf Ihrem Computerbildschirm sehen?  Wir betrachten diesen Code als eine Folge dieser Schritte: </p><br><p><img src="https://habrastorage.org/webt/va/3e/dk/va3edk8_ja838w9qo7apppwyy50.png"></p><br><p>  Aus Sicht der realen physischen Zeit ist alles etwas voreingenommen. </p><br><p><img src="https://habrastorage.org/webt/od/wo/4g/odwo4gzguqz7nr_odgsksityvda.png"></p><br><p>  Diejenigen, die solchen Code tats√§chlich geschrieben und ausgef√ºhrt haben, wissen das nach dem Leseschritt und nach dem Schritt <br>  Schreiben ist ein ziemlich auff√§lliges Zeitintervall, in dem unser Programm aus Sicht unseres Codes nichts zu tun scheint, aber unter der Haube die Maschine arbeitet, die wir "Eingabe-Ausgabe" nennen. </p><br><p><img src="https://habrastorage.org/webt/ye/jl/67/yejl67r3goweaiupb1wjieg5i2a.png"><br>  W√§hrend der E / A werden Pakete √ºber das Netzwerk und die gesamte damit verbundene schwere Arbeit auf niedriger Ebene ausgetauscht.  Lassen Sie uns ein Gedankenexperiment durchf√ºhren: Nehmen Sie ein solches Programm, f√ºhren Sie es auf einem physischen Prozessor aus und tun Sie so, als h√§tten wir kein Betriebssystem. Was wird passieren?  Der Prozessor kann nicht anhalten, er f√ºhrt weiterhin Ma√ünahmen durch, ohne Anweisungen zu befolgen, und verschwendet nur vergeblich Energie. </p><br><p><img src="https://habrastorage.org/webt/pg/lu/xp/pgluxpmbkl8ho9w-2docuab2iqg.png"></p><br><p>  Es stellt sich die Frage, ob wir in dieser Zeit etwas N√ºtzliches tun k√∂nnen.  Dies ist eine sehr nat√ºrliche Frage, deren Antwort es uns erm√∂glichen w√ºrde, Prozessorleistung zu sparen und sie f√ºr etwas N√ºtzliches zu verwenden, w√§hrend unsere Anwendung nichts zu tun scheint. </p><br><a name="section3"></a><br><h1 id="3-osnovnye-ponyatiya">  3. Grundlegende Konzepte </h1><br><a name="section3-1"></a><br><h2 id="31-potok-vypolneniya">  3.1.  Thread der Ausf√ºhrung </h2><br><p>  Wie k√∂nnen wir uns dieser Aufgabe n√§hern?  Lassen Sie uns die Konzepte in Einklang bringen.  Ich werde "Ausf√ºhrungsfluss" sagen und mich auf eine sinnvolle Abfolge elementarer Operationen oder Schritte beziehen.  Die Aussagekraft wird durch den Kontext bestimmt, in dem ich vom Ablauf der Ausf√ºhrung spreche.  Das hei√üt, wenn es sich um einen Single-Thread-Algorithmus handelt (Aho-Korasik, Graphensuche), dann ist dieser Algorithmus selbst bereits ein Thread der Ausf√ºhrung.  Er unternimmt einige Schritte, um das Problem zu l√∂sen. </p><br><p>  Wenn es sich um eine Datenbank handelt, kann ein Ausf√ºhrungsthread Teil der von der Datenbank ausgef√ºhrten Aktionen sein, um eine eingehende Anforderung zu bedienen.  Gleiches gilt f√ºr Webserver.  Wenn ich eine Art Mobil- oder Webanwendung schreibe, um den Betrieb eines Benutzers zu bedienen, z. B. Klicken auf eine Schaltfl√§che, Netzwerkinteraktionen, Interaktion mit lokalem Speicher usw.  Die Abfolge dieser Aktionen aus Sicht meiner mobilen Anwendung ist auch ein separater aussagekr√§ftiger Ausf√ºhrungsfluss.  Aus Sicht des Betriebssystems ist ein Prozess oder ein Prozessthread auch ein aussagekr√§ftiger Ausf√ºhrungsthread. </p><br><a name="section3-2"></a><br><h2 id="32-mnogozadachnost-i-parallelizm">  3.2.  Multitasking und Parallelit√§t </h2><br><p>  Der Eckpfeiler der Produktivit√§t ist die F√§higkeit, einen solchen Trick auszuf√ºhren: Wenn ich einen Ausf√ºhrungsthread habe, der L√ºcken in seinem physischen Zeitscan enth√§lt, dann f√ºlle diese L√ºcken mit etwas N√ºtzlichem - folge den Schritten anderer Ausf√ºhrungsthreads. </p><br><p><img src="https://habrastorage.org/webt/vw/x1/si/vwx1sijti5ahggnjozkymza2hna.png"></p><br><p>  Datenbanken bedienen normalerweise viele Clients gleichzeitig.  Wenn wir die Arbeit an mehreren Ausf√ºhrungsthreads im Rahmen eines Ausf√ºhrungsthreads einer h√∂heren Ebene kombinieren k√∂nnen, spricht man von Multitasking.  Das hei√üt, Multitasking ist, wenn ich Aktionen im Rahmen eines gr√∂√üeren Ausf√ºhrungsflusses ausf√ºhre, die der L√∂sung kleinerer Aufgaben untergeordnet sind. </p><br><p>  Es ist wichtig, das Konzept des Multitasking nicht mit Parallelit√§t zu verwechseln.  Parallelit√§t - <br>  Dies sind Eigenschaften der Laufzeitumgebung, die es erm√∂glichen, in einem Schritt in einem Schritt Fortschritte in verschiedenen Ausf√ºhrungsthreads zu erzielen.  Wenn ich zwei physische Prozessoren habe, k√∂nnen sie in einem Taktzyklus zwei Anweisungen ausf√ºhren.  Wenn das Programm auf einem Prozessor ausgef√ºhrt wird, dauert es zwei Taktzyklen, um dieselben zwei Anweisungen auszuf√ºhren. </p><br><p><img src="https://habrastorage.org/webt/nq/n5/yf/nqn5yf1pee8kwgi3rw1lxmnyomi.png"></p><br><p>  Es ist wichtig, diese Konzepte nicht zu verwechseln, da sie in verschiedene Kategorien fallen.  Multitasking ist eine Funktion Ihres Programms, die intern als variable Arbeit f√ºr verschiedene Aufgaben strukturiert ist.  Parallelit√§t ist eine Eigenschaft der Laufzeitumgebung, mit der Sie mehrere Aufgaben in einem Taktzyklus bearbeiten k√∂nnen. </p><br><p>  In vielerlei Hinsicht schreiben asynchroner Code und das Schreiben von asynchronem Code Multitasking-Code.  Die Hauptschwierigkeit besteht darin, wie ich Aufgaben codiere und wie ich sie verwalte.  Deshalb werden wir heute dar√ºber sprechen - Multitasking-Code schreiben. </p><br><a name="section4"></a><br><h1 id="4-blokirovanie-i-ozhidanie">  4. Blockieren und warten </h1><br><p><img src="https://habrastorage.org/getpro/habr/post_images/da7/042/897/da7042897d750697821baf6381db92ea.png"></p><br><p>  Beginnen wir mit einem einfachen Beispiel.  Zur√ºck zum Tischtennis: </p><br><pre> <code class="cpp hljs">socket s; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> x; x = read_from_socket(s, <span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x == <span class="hljs-string"><span class="hljs-string">"ping"</span></span>) { write_to_socket(s, <span class="hljs-string"><span class="hljs-string">"pong"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p>  Wie wir bereits besprochen haben, wird der Ausf√ºhrungsthread nach dem Einschlafen und den wei√üen Linien blockiert und blockiert.  Normalerweise sagen wir: "Der Fluss ist blockiert." </p><br><pre> <code class="cpp hljs">socket s; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> x; x = read_from_socket(s, <span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* thread is blocked here */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x == <span class="hljs-string"><span class="hljs-string">"ping"</span></span>) { write_to_socket(s, <span class="hljs-string"><span class="hljs-string">"pong"</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* thread is blocked here */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p>  Dies bedeutet, dass der Ausf√ºhrungsfluss einen Punkt erreicht hat, an dem ein Ereignis erforderlich ist, um ihn fortzusetzen.  Insbesondere bei unserer Netzwerkanwendung ist es erforderlich, dass Daten √ºber das Netzwerk eintreffen, oder umgekehrt haben wir einen freien Puffer zum Schreiben von Daten in das Netzwerk.  Ereignisse k√∂nnen unterschiedlich sein.  Wenn wir √ºber Zeitaspekte sprechen, k√∂nnen wir warten, bis der Timer ausgel√∂st wird oder ein anderer Prozess abgeschlossen ist.  Die Ereignisse hier sind eine Art abstrakte Sache, √ºber sie ist es wichtig zu verstehen, dass sie erwartet werden k√∂nnen. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c91/02f/7ca/c9102f7ca66291666b9df9c05ce7f46e.png"></p><br><p>  Wenn wir einfachen Code schreiben, geben wir implizit die Kontrolle √ºber die Ereigniserwartung auf eine h√∂here Ebene.  In unserem Fall das Betriebssystem.  Als eine Einheit einer h√∂heren Ebene ist sie daf√ºr verantwortlich, auszuw√§hlen, welche Aufgabe als n√§chstes ausgef√ºhrt wird, und sie ist auch daf√ºr verantwortlich, das Auftreten von Ereignissen zu verfolgen. </p><br><p>  Unser Code, den wir als Entwickler schreiben, ist gleichzeitig in Bezug auf die Arbeit an einer Aufgabe strukturiert.  Das Code-Snippet aus dem Beispiel behandelt eine Verbindung: Es liest Ping von einer Verbindung und schreibt Pong in eine Verbindung. </p><br><p>  Der Code ist klar.  Sie k√∂nnen es lesen und verstehen, was es tut, wie es funktioniert, welches Problem es l√∂st, welche Invarianten es hat und so weiter.  Gleichzeitig verwalten wir die Aufgabenplanung in einem solchen Modell sehr schlecht.  Im Allgemeinen haben Betriebssysteme Priorit√§tskonzepte. Wenn Sie jedoch weiche Echtzeitsysteme geschrieben haben, wissen Sie, dass die unter Linux verf√ºgbaren Tools nicht ausreichen, um gen√ºgend vern√ºnftige Echtzeitsysteme zu erstellen. </p><br><p>  Dar√ºber hinaus ist das Betriebssystem eine komplizierte Sache, und das Umschalten des Kontexts von unserer Anwendung zum Kernel kostet einige Mikrosekunden, was uns mit einigen einfachen Berechnungen eine Sch√§tzung von etwa 20-100.000 Kontextwechseln pro Sekunde ergibt.  Das hei√üt, wenn wir einen Webserver schreiben, k√∂nnen wir in einer Sekunde ungef√§hr 20.000 Anfragen verarbeiten, vorausgesetzt, die Verarbeitung von Anfragen ist zehnmal teurer als das System. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c12/68f/503/c1268f5037154f9f0f5ac5bc82dfc531.png"></p><br><a name="section4-1"></a><br><h2 id="41-neblokiruyuschee-ozhidanie">  4.1.  Nicht blockierendes Warten </h2><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ffe/97f/c42/ffe97fc42eca8beb2dae841358b31b8e.png"></p><br><p>  Wenn Sie zu der Situation kommen, dass Sie effizienter mit dem Netzwerk arbeiten m√ºssen, suchen Sie im Internet nach Hilfe und verwenden select / epoll.  Im Internet steht geschrieben, dass Sie epoll ben√∂tigen, wenn Sie Tausende von Verbindungen gleichzeitig bedienen m√∂chten, da dies ein guter Mechanismus ist und so weiter.  Sie √∂ffnen die Dokumentation und sehen ungef√§hr so: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">select</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> nfds, fd_set* readfds, fd_set* writefds, fd_set* exceptfds, struct timeval* timeout)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FD_CLR</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fd, fd_set* </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">set</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FD_ISSET</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fd, fd_set* </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">set</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FD_SET</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fd, fd_set* </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">set</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FD_ZERO</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fd_set* </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">set</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">epoll_ctl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> epfd, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> op, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fd, struct epoll_event* event)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">epoll_wait</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> epfd, struct epoll_event* events, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maxevents, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> timeout)</span></span></span></span>;</code> </pre> <br><p>  Funktionen, bei denen die Schnittstelle entweder viele Deskriptoren enth√§lt, mit denen Sie arbeiten (im Fall von select), oder viele Ereignisse, die √ºbergeben werden <br>  √ºber die Grenzen Ihrer Anwendung hinweg den Kernel des Betriebssystems, den Sie verarbeiten m√ºssen (im Fall von epoll). </p><br><p>  Es ist auch erw√§hnenswert, dass Sie nicht zu select / epoll kommen k√∂nnen, sondern zu einer Bibliothek wie libuv, die keine Ereignisse in der API enth√§lt, aber viele R√ºckrufe enth√§lt.  Die Bibliotheksoberfl√§che sagt: "Lieber Freund, geben Sie einen R√ºckruf zum Lesen des Sockets, den ich aufrufen werde, wenn die Daten angezeigt werden." </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uv_timer_start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uv_timer_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* handle, uv_timer_cb cb, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint64_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> timeout, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint64_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> repeat)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">typedef</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*uv_timer_cb)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uv_timer_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* handle)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uv_read_start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uv_stream_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* stream, uv_alloc_cb alloc_cb, uv_read_cb read_cb)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uv_read_stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uv_stream_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">*)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">typedef</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*uv_read_cb)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uv_stream_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* stream, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ssize_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> nread, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uv_buf_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* buf)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uv_write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uv_write_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* req, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uv_stream_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* handle, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uv_buf_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bufs[], </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> nbufs, uv_write_cb cb)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">typedef</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*uv_write_cb)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uv_write_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* req, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> status)</span></span></span></span>;</code> </pre> <br><p>  Was hat sich gegen√ºber unserem Synchroncode im vorherigen Kapitel ge√§ndert?  Der Code ist asynchron geworden.  Dies bedeutet, dass wir die Logik in die Anwendung √ºbernommen haben, um den Zeitpunkt zu bestimmen, zu dem Ereignisse √ºberwacht werden.  Explizite Select / Epoll-Aufrufe sind die Punkte, an denen wir das Betriebssystem um Informationen zu den aufgetretenen Ereignissen bitten.  Wir haben auch die Auswahl der Aufgabe, an der wir als n√§chstes arbeiten m√∂chten, in unseren Anwendungscode aufgenommen. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/458/28b/5f2/45828b5f2463ec94abf292e8a5db86bf.png"></p><br><p>  An den Beispielen f√ºr Schnittstellen k√∂nnen Sie erkennen, dass es grunds√§tzlich zwei Mechanismen zur Einf√ºhrung von Multitasking gibt.  Eine Art "ziehen", wenn wir <br>  Wir zeichnen viele der Ereignisse heraus, auf die wir warten, und reagieren dann irgendwie darauf.  Bei diesem Ansatz ist es einfach, den Overhead um eins zu amortisieren <br>  ein Ereignis und erzielen daher einen hohen Durchsatz in der Kommunikation √ºber die Menge der aufgetretenen Ereignisse.  Normalerweise basieren alle Netzwerkelemente wie die Interaktion des Kernels mit der Netzwerkkarte oder die Interaktion von Ihnen und dem Betriebssystem auf Abfragemechanismen. </p><br><p>  Der zweite Weg ist ein "Push" -Mechanismus, bei dem eine bestimmte externe Entit√§t eindeutig hereinkommt, den Ausf√ºhrungsfluss unterbricht und sagt: "Behandeln Sie jetzt bitte das Ereignis, das gerade eingetroffen ist."  Dies ist ein Ansatz mit R√ºckrufen, mit Unix-Signalen und mit Unterbrechungen auf Prozessorebene, wenn eine externe Entit√§t eindeutig in Ihren Ausf√ºhrungsthread eindringt und sagt: "Nun, bitte, wir arbeiten an diesem Ereignis."  Dieser Ansatz wurde entwickelt, um die Verz√∂gerung zwischen dem Auftreten eines Ereignisses und der Reaktion darauf zu verringern. </p><br><p>  Warum m√∂chten wir C ++ - Entwickler, die bestimmte Anwendungsprobleme schreiben und l√∂sen, m√∂glicherweise ein Ereignismodell in unseren Code ziehen?  Wenn wir die Arbeit an vielen Aufgaben per Drag &amp; Drop in unseren Code ziehen und verwalten, k√∂nnen wir aufgrund des fehlenden √úbergangs zum Kernel und umgekehrt etwas schneller arbeiten und pro Zeiteinheit n√ºtzlichere Aktionen ausf√ºhren. </p><br><p>  Was f√ºhrt dies in Bezug auf den Code, den wir schreiben?  Nehmen wir zum Beispiel nginx, einen sehr verbreiteten Hochleistungs-HTTP-Server.  Wenn Sie den Code lesen, basiert er auf einem asynchronen Modell.  Der Code ist ziemlich schwer zu lesen.  Wenn Sie sich fragen, was genau bei der Verarbeitung einer einzelnen HTTP-Anforderung passiert, stellt sich heraus, dass der Code viele Fragmente enth√§lt, die in verschiedenen Dateien und in verschiedenen Winkeln der Codebasis angeordnet sind.  Jedes Fragment erledigt einen kleinen Arbeitsaufwand als Teil der Bearbeitung der gesamten HTTP-Anforderung.  Z.B: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ngx_http_request_handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ngx_event_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *ev)</span></span></span><span class="hljs-function"> </span></span>{ ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c-&gt;close) { ngx_http_terminate_request(r, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ev-&gt;write) { r-&gt;write_event_handler(r); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { r-&gt;read_event_handler(r); } ... } <span class="hljs-comment"><span class="hljs-comment">/* where the handler... */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">typedef</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*ngx_http_event_handler_pt)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ngx_http_request_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *r)</span></span></span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ngx_http_request_s</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">/*... */</span></span> ngx_http_event_handler_pt read_event_handler; <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }; <span class="hljs-comment"><span class="hljs-comment">/* ...is set when switching to the next processing stage */</span></span> r-&gt;read_event_handler = ngx_http_request_empty_handler; r-&gt;read_event_handler = ngx_http_block_reading; r-&gt;read_event_handler = ngx_http_test_reading; r-&gt;read_event_handler = ngx_http_discarded_request_body_handler; r-&gt;read_event_handler = ngx_http_read_client_request_body_handler; r-&gt;read_event_handler = ngx_http_upstream_rd_check_broken_connection; r-&gt;read_event_handler = ngx_http_upstream_read_request_handler;</code> </pre> <br><p>  Es gibt eine Anforderungsstruktur, die an den Ereignishandler weitergeleitet wird, wenn der Socket Lese- oder Schreibzugriff signalisiert.  Ferner wechselt dieser Handler im Verlauf des Programms abh√§ngig vom Zustand der Anforderungsverarbeitung st√§ndig.  Entweder lesen wir die Header oder wir lesen den Hauptteil der Anfrage oder wir fragen vorgelagert nach Daten - im Allgemeinen gibt es viele verschiedene Zust√§nde. </p><br><p>  Ein solcher Code ist schwer zu lesen, da er im Wesentlichen als Reaktion auf Ereignisse beschrieben wird.  Wir sind in so und so einem Zustand und reagieren auf bestimmte Weise auf die Ereignisse, die gekommen sind.  Es fehlt ein ganzheitliches Bild des gesamten Prozesses der Verarbeitung einer HTTP-Anfrage. </p><br><p>  Eine andere Option, die h√§ufig in JavaScript verwendet wird, besteht darin, auf R√ºckrufen basierenden Code zu erstellen, wenn wir unseren R√ºckruf an den Schnittstellenaufruf weiterleiten, in dem normalerweise ein anderer verschachtelter R√ºckruf f√ºr das Ereignis vorhanden ist, und so weiter. </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LibuvStreamWrap::ReadStart() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> uv_read_start(stream(), [](<span class="hljs-keyword"><span class="hljs-keyword">uv_handle_t</span></span>* handle, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> suggested_size, <span class="hljs-keyword"><span class="hljs-keyword">uv_buf_t</span></span>* buf) { <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;LibuvStreamWrap*&gt;(handle-&gt;data)-&gt;OnUvAlloc(suggested_size, buf); }, [](<span class="hljs-keyword"><span class="hljs-keyword">uv_stream_t</span></span>* stream, <span class="hljs-keyword"><span class="hljs-keyword">ssize_t</span></span> nread, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uv_buf_t</span></span>* buf) { <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;LibuvStreamWrap*&gt;(stream-&gt;data)-&gt;OnUvRead(nread, buf); }); } <span class="hljs-comment"><span class="hljs-comment">/* ...for example, parsing http... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (p=data; p != data + len; p++) { ch = *p; reexecute: <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (CURRENT_STATE()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> s_start_req_or_res: <span class="hljs-comment"><span class="hljs-comment">/*... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> s_res_or_resp_H: <span class="hljs-comment"><span class="hljs-comment">/*... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> s_res_HT: <span class="hljs-comment"><span class="hljs-comment">/*... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> s_res_HTT: <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> s_res_HTTP: <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> s_res_http_major: <span class="hljs-comment"><span class="hljs-comment">/*... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> s_res_http_dot: <span class="hljs-comment"><span class="hljs-comment">/*... */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span></code> </pre> <br><p>  Der Code ist wieder sehr fragmentiert, es gibt kein Verst√§ndnis f√ºr den aktuellen Stand, wie wir an der Anfrage arbeiten.  Viele Informationen werden durch Schlie√üungen √ºbertragen, und Sie m√ºssen mentale Anstrengungen unternehmen, um die Logik der Verarbeitung einer einzelnen Anforderung zu rekonstruieren. </p><br><p>  Durch die Einf√ºhrung von Multitasking in unseren Code (die Logik, Arbeitsaufgaben auszuw√§hlen und zu multiplexen) erhalten wir effektiven Code und Kontrolle √ºber die Priorisierung von Aufgaben, verlieren jedoch viele davon an Lesbarkeit.  Dieser Code ist schwer zu lesen und schwer zu pflegen. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/da5/a8a/151/da5a8a1517fb18945a330ae4c2b6d722.png"></p><br><p>  Warum?  Angenommen, ich habe einen einfachen Fall, zum Beispiel, ich lese eine Datei und √ºbertrage sie √ºber das Netzwerk.  In einer nicht blockierenden Version entspricht dieser Fall einer solchen linearen Zustandsmaschine: </p><br><ul><li>  Ausgangszustand </li><li>  Beginnen Sie mit dem Lesen einer Datei. </li><li>  Warten auf eine Antwort vom Dateisystem, </li><li>  Schreiben einer Datei in einen Socket, </li><li>  Endzustand. </li></ul><br><p>  Angenommen, ich m√∂chte dieser Datei Informationen aus der Datenbank hinzuf√ºgen.  Eine einfache Option: </p><br><ul><li>  Ausgangszustand </li><li>  eine Datei lesen </li><li>  Lesen Sie die Datei </li><li>  Lesen aus der Datenbank </li><li>  aus der Datenbank lesen, </li><li>  Ich arbeite mit einer Steckdose </li><li>  schrieb an die Steckdose. </li></ul><br><p>  Es scheint ein linearer Code zu sein, aber die Anzahl der Zust√§nde hat zugenommen. </p><br><p>  Dann denken Sie, dass es sch√∂n w√§re, die beiden Schritte zu parallelisieren - Lesen aus einer Datei und aus einer Datenbank.  Die Wunder der Kombinatorik beginnen: Sie befinden sich im Ausgangszustand und fordern das Lesen der Datei und der Daten aus der Datenbank an.  Dann k√∂nnen Sie entweder in einen Zustand gelangen, in dem Daten aus der Datenbank vorhanden sind, aber keine Datei vorhanden ist, oder umgekehrt - es gibt Daten aus der Datei, jedoch nicht aus der Datenbank.  Als n√§chstes m√ºssen Sie in einen Zustand gehen, in dem Sie eines von zwei Dingen haben.  Auch dies sind zwei Zust√§nde.  Dann m√ºssen Sie in einen Zustand gehen, in dem Sie beide Zutaten haben.  Dann schreiben Sie sie in die Steckdose und so weiter. </p><br><p>  Je komplexer die Anwendung, desto mehr Zust√§nde, desto mehr Codefragmente m√ºssen in Ihrem Kopf kombiniert werden.  Unbequem.  Oder Sie schreiben R√ºckrufnudeln, deren Lesen unpraktisch ist.  Wenn ein Verzweigungssystem geschrieben wird, kommt eines Tages eine Zeit, in der Sie es nicht l√§nger tolerieren k√∂nnen. </p><br><a name="section5"></a><br><h1 id="5-futurespromises">  5. Futures / Versprechen </h1><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f93/0ea/b0a/f930eab0a9a5556b0db5d21f23d98190.png"></p><br><p>  Um das Problem zu l√∂sen, m√ºssen Sie die Situation einfacher betrachten. </p><br><p><img src="https://habrastorage.org/webt/-v/6e/gb/-v6egbslm8_jjhwcsevjffbe35s.png"></p><br><p>  Es gibt ein Programm, es hat schwarze und rote Kreise.  Unser Hinrichtungsfluss sind schwarze Kreise;  manchmal wechseln sie sich mit rot ab, wenn der Stream seine Arbeit nicht fortsetzen kann.  Das Problem ist, dass Sie f√ºr unseren schwarzen Ausf√ºhrungsfaden in den n√§chsten schwarzen Kreis gelangen m√ºssen, der nicht bekannt ist, wann. </p><br><p>  Das Problem ist, dass wir dem Computer beim Schreiben von Code in einer Programmiersprache erkl√§ren, was jetzt zu tun ist.  Ein Computer ist eine relativ einfache Sache, die Anweisungen erwartet, die wir in der Programmiersprache schreiben.  Sie wartet auf Anweisungen f√ºr den n√§chsten Kreis, und in unserer Programmiersprache gibt es nicht genug Geld, um zu sagen: "Bitte tun Sie in Zukunft etwas, wenn etwas passiert." </p><br><p><img src="https://habrastorage.org/webt/vp/8f/mx/vp8fmxhtnkukhqym-baw3g4mzyg.png"></p><br><p>  In einer Programmiersprache arbeiten wir mit verst√§ndlichen momentanen Aktionen: Aufrufen einer Funktion, arithmetische Operationen usw.  Sie beschreiben den spezifischen n√§chsten n√§chsten Schritt.  Gleichzeitig muss zur Verarbeitung der Anwendungslogik nicht der n√§chste physische Schritt, sondern der n√§chste logische Schritt beschrieben werden: Was ist zu tun, wenn beispielsweise Daten aus der Datenbank angezeigt werden? </p><br><p><img src="https://habrastorage.org/webt/6m/by/ma/6mbyma_pagz74dx-j2ch1ixpxpg.png"></p><br><p>  Daher brauchen wir einen Mechanismus, um diese Fragmente zu kombinieren.  In dem Fall, als wir synchronen Code geschrieben haben, haben wir die Frage vollst√§ndig unter der Haube versteckt und gesagt, dass das Betriebssystem damit umgehen w√ºrde, es erlauben w√ºrde, unsere Threads zu unterbrechen und neu zu planen. </p><br><p>  In Level 1 haben wir die B√ºchse dieser Pandora ge√∂ffnet und sie hat eine Menge Schalter, Gro√ü- und Kleinschreibung, Bedingungen, Verzweigungen und Zust√§nde in den Code gebracht.  Ich m√∂chte einen Kompromiss, damit der Code relativ lesbar ist, aber alle Vorteile von Level 1 beibeh√§lt. </p><br><p>  Zum Gl√ºck haben Barbara Liskov und Luba Shirir, die 1988 an verteilten Systemen beteiligt waren, das Problem erkannt und festgestellt, dass sprachliche √Ñnderungen erforderlich sind.  Es ist notwendig, der Programmiersprache Konstrukte hinzuzuf√ºgen, die es erm√∂glichen, zeitliche Beziehungen zwischen Ereignissen auszudr√ºcken - zum aktuellen Zeitpunkt und zu einem ungewissen Zeitpunkt in der Zukunft. </p><br><p>  Diese werden Versprechen genannt.  Das Konzept ist cool, aber seit zwanzig Jahren verstaubt es in einem Regal.       ‚Äî  ,   Twitter,      Ruby on Rails  Scala,     ,  ,      ,      future  .     Your Server as a Function.   ,        . </p><br><p>   Scala,    , ++ ? </p><br><p>    ,   Future.      T c  :       ,  -    . </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class"> &lt;T&gt;</span></span></code> </pre> <br><p>         ,    ,  ,     .   ,   ¬´¬ª,  ,      .     Future     ¬´¬ª,  Promise ‚Äî  ¬´¬ª.        ;  ,  JavaScript, Promise ‚Äî      ,   Java ‚Äì   Future. </p><br><p>   ,     .     ,       ,     boost::future ( std::future) ‚Äî      ,     . </p><br><a name="section5-1"></a><br><h2 id="51-interfeys-future--promise">  5.1.  Future &amp; Promise </h2><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> T&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">T* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TryGet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Subscribe</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::function&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T&amp;)&gt; cb)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;R&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Then</span></span></span><span class="hljs-class">( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">:</span></span>:function&lt;R(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T&amp;)&gt; f); <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;R&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Then</span></span></span><span class="hljs-class">( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">:</span></span>:function&lt;Future&lt;R&gt;(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T&amp;)&gt; f); }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MakeFuture</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&amp; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">);</span></span></code> </pre> <br><p>  , ,  - ,      .  , ,      ,   . ,      ,       ‚Äî   ,   ,   .       Then,      . </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Promise</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T&amp; value)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TrySet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T&amp; value)</span></span></span></span>; Future&lt;T&gt; ToFuture() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Promise</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NewPromise</span></span></span><span class="hljs-class">();</span></span></code> </pre> <br><p>   .      ,       .    ¬´, , ,      ¬ª. </p><br><a name="section5-2"></a><br><h2 id="52-kompoziciya-vychisleniy">  5.2.   </h2><br><p><img src="https://habrastorage.org/getpro/habr/post_images/676/e68/6b7/676e686b75c6875ba0a914567bc46839.png"></p><br><p>    ?  ,         .  Then ‚Äî  ,      . </p><br><p> ,      ‚Äî future --,     -  t ‚Äî       .    , ,   ,        f,  -     r. </p><br><p>          t     f.        ,  ,      r. </p><br><p>   :    t,      ,   r      .       : </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">template</span></span></span><span class="hljs-class"> &lt;class R&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;R&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T&gt;:</span></span>:Then(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::function&lt;R(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T&amp;)&gt; f) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> promise = NewPromise&lt;R&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;Subscribe([promise] (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T&amp; t) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> r = f(t); promise.Set(r); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> promise.ToFuture(); }</code> </pre> <br><p>  : </p><br><ul><li>  <code>Promise</code>  <code>R</code> , </li><li>    <code>Future&lt;T&gt;</code>    <code>t</code> , </li><li>   ,    <code>r = f(t)</code> , </li><li>  <code>r</code>   <code>Promise</code> , </li><li>      <code>Promise</code> . </li></ul><br><p>      <code>f</code> ,     <code>R</code> ,  <code>Future&lt;R&gt;</code> ,         <code>R</code> .  : </p><br><ul><li>          <code>T</code> , </li><li>  ,     <code>T</code> ,  ,      <code>R</code> , </li><li>     ,      <code>R</code> ,    ,        . </li></ul><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">template</span></span></span><span class="hljs-class"> &lt;class R&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;R&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T&gt;:</span></span>:Then(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::function&lt;Future&lt;R&gt;(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T&amp;)&gt; f) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> promise = NewPromise&lt;R&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;Subscribe([promise] (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T&amp; t) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> that = f(t); that.Subscribe([promise] (R r) { promise.Set(r); }); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> promise.ToFuture(); }</code> </pre> <br><p>        ,   -    t.        f,        r,    .    ,       ,   . </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/3c6/92f/064/3c692f06489d41c745a0d1b51085b278.png"></p><br><p>    ,    Then   : </p><br><ul><li>   <code>Promise</code> , </li><li>  <code>Subscribe</code>   -, </li><li>  <code>Promise</code> ,   <code>Future</code> . </li></ul><br><p>      ,       .    ,       ,    ,            . </p><br><p>     ,   ,          ,     -.   ,  ,   -,   Subscribe.       ,    ,   ,  -  .   ,    . </p><br><a name="section5-3"></a><br><h2 id="53-primery">  5.3.  Beispiele </h2><br><p>       AsyncComputeValue,      GPU,        .   Then,    ,        (2v+1) <sup>2</sup> . </p><br><pre> <code class="cpp hljs">Future&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; value = AsyncComputeValue(); <span class="hljs-comment"><span class="hljs-comment">//    value.Subscribe([] (int v) { std::cerr &lt;&lt; "Value is: " &lt;&lt; v &lt;&lt; std::endl; });</span></span></code> </pre> <br><p>      .  ,    :   (2v+1) <sup>2</sup>       .       ,            . </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  (2v+1)^2 Future&lt;int&gt; anotherValue = value .Then([] (int v) { return 2 * v; }) .Then([] (int u) { return u + 1; }) .Then([] (int w) { return w * w; });</span></span></code> </pre> <br><p>     ,     ,       .       . </p><br><p>  .   :   ,       ;       ;       . </p><br><pre> <code class="cpp hljs">Future&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; GetDbKey(); Future&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; LoadDbValue(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> key); Future&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; SendToMars(<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> message); Future&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; ExploreOuterSpace() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetDbKey() <span class="hljs-comment"><span class="hljs-comment">// Future&lt;int&gt; .Then(&amp;LoadDbValue) // Future&lt;string&gt; .Then(&amp;SendToMars); // Future&lt;void&gt; } ExploreOuterSpace().Subscribe( [] () { std::cout &lt;&lt; "Mission Complete!" &lt;&lt; std::endl; });</span></span></code> </pre> <br><p>         ‚Äî ExploreOuterSpace.           Then;    ‚Äî    ‚Äî    ,     .         ( ) .      . </p><br><a name="section5-4"></a><br><h2 id="54-any-kombinator">  5.4. Any- </h2><br><p>  :     <code>Future</code>    ,       ,      . ,  ,          : </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Any</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f1</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f2</span></span></span><span class="hljs-class">) {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> promise = NewPromise&lt;T&gt;(); f1.Subscribe([promise] (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T&amp; t) { promise.TrySet(t); }); f2.Subscribe([promise] (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T&amp; t) { promise.TrySet(t); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> promise.ToFuture(); } <span class="hljs-comment"><span class="hljs-comment">//    </span></span></code> </pre> <br><p>   ,      Any-,      Future  :   ,   .      ,    ,  . </p><br><p>   ,  ,       ,     ,  ,    .      ¬´   DB1,    DB2,        ‚Äî  - ¬ª. </p><br><a name="section5-5"></a><br><h2 id="55-all-kombinator">  5.5. All- </h2><br><p>    .                  ,       ,  ,     ( T1  T2),    T1  T2   ,        ,   . </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T1</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T2</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;std::tuple&lt;T1, T2&gt;&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">All</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T1&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f1</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T2&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f2</span></span></span><span class="hljs-class">) {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> promise = NewPromise&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::tuple&lt;T1, T2&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> result = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::make_shared&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::tuple&lt;T1, T2&gt; &gt;(); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> counter = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::make_shared&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::atomic&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; &gt;(<span class="hljs-number"><span class="hljs-number">2</span></span>); f1.Subscribe([promise, result, counter] (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T1&amp; t1) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::get&lt;<span class="hljs-number"><span class="hljs-number">0</span></span>&gt;(*result) = t1; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (--(*counter) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { promise.Set(*result)); } }); f2.Subscribe([promise, result, counter] (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T2&amp; t2) { <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> promise.ToFuture(); } <span class="hljs-comment"><span class="hljs-comment">//    </span></span></code> </pre> <br><p>    nginx.   ,      ,        .     nginx    ¬´ ¬ª, ¬´  ¬ª, ¬´    ¬ª   .  All-         ,     .      . </p><br><a name="section5-6"></a><br><h2 id="56-adaptaciya-obratnogo-vyzova">  5.6.    </h2><br><p>   Future  Promises ‚Äî     legacy-,   .     callback-    ,     ,   :   Future,     ,   callback-  Future. </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   cb     void LegacyAsyncComputeStuff(std::function&lt;void(int)&gt; cb); //      Future Future&lt;int&gt; ModernAsyncComputeStuff() { auto promise = NewPromise&lt;int&gt;(); LegacyAsyncComputeStuff( [promise] (int value) { promise.Set(value); }); return promise.ToFuture(); }</span></span></code> </pre> <br><p> :      ,              Future  . </p><br><a name="section6"></a><br><h1 id="6-kak-sdelat-kod-chitaemee-s-pomoschyu-korutin"> 6.        </h1><br><p><img src="https://habrastorage.org/getpro/habr/post_images/19a/093/212/19a093212125673ff89cc4196c59583a.png"></p><br><p>   ,     ,     .  . </p><br><pre> <code class="cpp hljs">Future&lt;Request&gt; GetRequest(); Future&lt;Payload&gt; QueryBackend(Request req); Future&lt;Response&gt; HandlePayload(Payload pld); Future&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; Reply(Request req, Response rsp); <span class="hljs-comment"><span class="hljs-comment">// req  2 :  QueryBackend   Reply GetRequest().Subscribe( [] (Request req) { auto rsp = QueryBackend(req) .Then(&amp;HandlePayload) .Then(Bind(&amp;Reply, req)); });</span></span></code> </pre> <br><p>      .    Request,   -   .  ,     .  ,   ,        ,    .  ,   -      . </p><br><p>  ,  ,     .  Was zu tun ist?   ‚Äî  ,    request  payload,     ‚Äî  ,      . </p><br><p> ,   Java   Netty. ,      ,        .  ,        ,    . </p><br><p>      ,    GetRequest, QueryBackend, HandlePayload   Reply   ,     Future. </p><br><p>     ,   ,   Future   T ‚Äî   WaitFor. <br></p><pre> <code class="cpp hljs">Future&lt;Request&gt; GetRequest(); Future&lt;Payload&gt; QueryBackend(Request req); Future&lt;Response&gt; HandlePayload(Payload pld); Future&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; Reply(Request req, Response rsp); <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WaitFor</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">future</span></span></span><span class="hljs-class">);</span></span> <span class="hljs-comment"><span class="hljs-comment">// req  2 :  QueryBackend   Reply GetRequest().Subscribe( [] (Request req) { auto rsp = QueryBackend(req) .Then(&amp;HandlePayload) .Then(Bind(&amp;Reply, req)); });</span></span></code> </pre> <br><p>      : </p><br><pre> <code class="cpp hljs">Future&lt;Request&gt; GetRequest(); Future&lt;Payload&gt; QueryBackend(Request req); Future&lt;Response&gt; HandlePayload(Payload pld); Future&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; Reply(Request req, Response rsp); <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WaitFor</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">future</span></span></span><span class="hljs-class">);</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> req = WaitFor(GetRequest()); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> pld = WaitFor(QueryBackend(req)); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> rsp = WaitFor(HandlePayload(pld)); WaitFor(Reply(req, rsp));</code> </pre> <br><p>   :    Future,    .    .         ,    .      . </p><br><p>     .                    .     -  0,     ,  , mutex+cvar  future.        .          ,     . </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/99d/f77/3e4/99df773e4d1922427ab7dc98fde28b8f.png"></p><br><a name="section6-1"></a><br><h2 id="61-korutiny"> 6.1.  </h2><br><p>  ,        .        ,  ,     ,   ,    - ,   .     ,    <i>-</i> . </p><br><p>       ‚Äî ¬´¬ª      ,  ,    .       .     .  : boost::asio  boost::fiber. </p><br><p>         ,                .  Wie kann man das machen? </p><br><a name="section6-2"></a><br><h2 id="62-chernovik-realizacii-waitfor"> 6.2.   WaitFor </h2><br><p>   , , boost::context,        :  ,   ;  ,              .    x86/64       ,       ,         . </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//      class MachineContext; //     from,    to void SwitchContext(MachineContext* from, MachineContext* to); //      ‚Äì boost::context //    // * x86_64-ASM (push...-movq(rsp,eip)-pop...-jmpq) // * makecontext/swapcontext // * setjmp/longjmp</span></span></code> </pre> <br><p>      ,       goto:    ,     ,        ,   . </p><br><p>      ,  -   .     Fiber ‚Äî   .       +Future.  ,      ,         Future,    . </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Fiber</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> MachineContext context_; Future&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; future_; };</code> </pre> <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Scheduler</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WaitFor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Future&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; future)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; MachineContext loop_context_; Fiber* current_fiber_; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">deque</span></span>&lt;Fiber*&gt; run_queue_; };</code> </pre> <br><p>  Future   ,     ,    ,     .    :   Loop,      ,    ,   ,        ,    . </p><br><p>     WaitFor? </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">thread_local</span></span> Scheduler* ThisScheduler; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WaitFor</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">future</span></span></span><span class="hljs-class">) {</span></span> ThisScheduler-&gt;WaitFor(future.As&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt;()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> future.Get(); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Scheduler::WaitFor(Future&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; future) { current_fiber_-&gt;future_ = future; SwitchContext(¬§t_fiber_-&gt;context_, &amp;loop_context_); }</code> </pre> <br><p>   :  ,   -   ,      ,      Future  void,        .           . </p><br><p>  <code>Future&lt;void&gt;</code>   ,     ,    -  . </p><br><p>   WaitFor    :   : ¬´     Fiber   Future¬ª,        ( )       . </p><br><p>  ,        : <br> <code>ThisScheduler-&gt;WaitFor</code>  <code>return future.Get()</code> ,         . </p><br><p>      ?  ,       Future,      . </p><br><a name="section6-3"></a><br><h2 id="63-kak-ustroen-cikl-planirovaniya">  6.3.     </h2><br><p>   -  , ,    ,     -     ,    .    SwitchContext   ,    2 ‚Äî       . </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Scheduler::Loop() { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// (1)     (= !) current_fiber_ = run_queue_.front(); run_queue_.pop_front(); SwitchContext(&amp;loop_context_, ¬§t_fiber_-&gt;context_); // (2) ,      //‚Ä¶</span></span></code> </pre> <br><p>   ?   ,   ,    ,     Future,       Future, ,     ,           . </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Scheduler::Loop() { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// (1)     ‚Ä¶ // (2) ,      if (current_fiber_-&gt;future_) { current_fiber_-&gt;future_.Subscribe( [this, fiber = current_fiber_] { fiber-&gt;future_ = nullptr; run_queue_.push_back(fiber); }); } //‚Ä¶</span></span></code> </pre> <br><p>   ,      .       : </p><br><p>     WaitFor ‚Äî   . </p><br><p><img src="https://habrastorage.org/webt/_4/m8/ao/_4m8aoag2egfc2mzczah2xf6a9i.png"></p><br><p>    Switch-    . </p><br><p><img src="https://habrastorage.org/webt/sa/hg/kz/sahgkzqleux5-htiqo-58lb0gua.png"></p><br><p>     Future    (  ),   ,         .   -               Fiber. </p><br><p><img src="https://habrastorage.org/webt/hg/cm/gc/hgcmgclv5raicu_tlfywmw0yrpi.png"></p><br><p>   WaitFor     Future ,     - , Future  .     : </p><br><pre> <code class="cpp hljs">Future&lt;Request&gt; GetRequest(); Future&lt;Payload&gt; QueryBackend(Request req); Future&lt;Response&gt; HandlePayload(Payload pld); Future&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; Reply(Request req, Response rsp); <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WaitFor</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">future</span></span></span><span class="hljs-class">);</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> req = WaitFor( GetRequest()); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> pld = WaitFor( QueryBackend(req)); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> rsp = WaitFor( HandlePayload(pld)); WaitFor( Reply(req, rsp));</code> </pre> <br><p>    ,    ,      ,   .         ,    ,    . </p><br><a name="section6-4"></a><br><h2 id="64-coroutine-ts">  6.4. Coroutine TS </h2><br><p>    ?   ‚Äî .   Coroutine TS,        ,  WaitFor  CoroutineWait,    CoroutineTS ‚Äî  -  .     ,         - . ,    Waiter  Co,     ,    . </p><br><a name="section7"></a><br><h1 id="7-chto-poluchili"> 7.  ? </h1><br><p>   .           ,   ,    ,    .     ,       ,     ,    . </p><br><p>     ‚Äî  .    ,                  .       .     ,     . ,         ,        ,         ,      . </p><br><p>       -    ,        ,               .    ,  .      ,                ,          . </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e02/3b7/924/e023b79240490a7b561152aa0972b3ac.png"></p><br><p>         ,   ?    ,     . </p><br><p>   .       ,     ,   ,  ,      .       .       ,     ,     ,    ,    . </p><br><p>    nginx,  ,  ,  ,       ,    .        ,     ,  ,    future  promises. </p><br><p>     ,       ,    ,     ,       ,      ,      ,      . </p><br><p>       futures, promises  actors.    .             ,    . </p><br><p> :      , ,   ,     .               ,    , ,      ,   .     ? ,   . </p><br><blockquote>  Minute der Werbung. 19-20      C++ Russia 2019.      , , Grimm Rainer    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">¬´Concurrency and parallelism in C++17 and C++20/23¬ª</a> ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   C++</a> .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a> ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a> .  ,         ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">-</a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de446562/">https://habr.com/ru/post/de446562/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de446550/index.html">Probleme mit Koordinatormustern und was hat RouteComposer damit zu tun?</a></li>
<li><a href="../de446552/index.html">Arbeiten mit APDU-Befehlen anhand des Beispiel-EToken</a></li>
<li><a href="../de446554/index.html">Yandex Resident Program oder Wie man aus einem erfahrenen Backend ein ML-Ingenieur wird</a></li>
<li><a href="../de446558/index.html">Exotische Datenstrukturen: Modifizierte Merkle Patricia Trie</a></li>
<li><a href="../de446560/index.html">"Courtesy Exchange": die Essenz des Konflikts zwischen den beiden bekanntesten Streaming-Unternehmen</a></li>
<li><a href="../de446566/index.html">Projekt Null. Wie Amazon mit F√§lschungen umgehen will</a></li>
<li><a href="../de446568/index.html">Umbraco 8 umfangreiches CMS-Update: Was ist neu?</a></li>
<li><a href="../de446570/index.html">Die Geschichte der ersten GPU: Rendition V√©rit√© 1000</a></li>
<li><a href="../de446572/index.html">Editor.js ist ein ausgezeichneter Editor, der Quellcode im JSON-Format speichert</a></li>
<li><a href="../de446576/index.html">Importsubstitution oder wie russische Hubschrauber etwas falsch gemacht haben</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>