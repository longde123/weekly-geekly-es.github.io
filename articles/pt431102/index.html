<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äçüé§ üí° üèÑ Como o endere√ßo f√≠sico √© exibido nas cadeias e bancos de DRAM üí∏ üßó üê¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em um artigo anterior, discutimos como os processadores Intel Sandy Bridge mapeiam endere√ßos f√≠sicos no cache L3. 

 Agora, mostrarei como os controla...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como o endere√ßo f√≠sico √© exibido nas cadeias e bancos de DRAM</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431102/">  Em um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo anterior,</a> discutimos como os processadores Intel Sandy Bridge mapeiam endere√ßos f√≠sicos no cache L3. <br><br>  Agora, mostrarei como os controladores de mem√≥ria desses processadores mapeiam endere√ßos f√≠sicos para um local na DRAM - em particular, os n√∫meros de linha, banco e coluna nos m√≥dulos DRAM.  Chame de <i>mapeamento de endere√ßo DRAM</i>  Eu uso uma m√°quina de teste como exemplo. <br><br><h4>  Motiva√ß√£o: Bug de Rowhammer </h4><br>  Estou interessado em mapear endere√ßos DRAM, no que se refere a um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bug do Rowhammer</a> . <br><br>  O Rowhammer √© um problema em alguns m√≥dulos DRAM, em que certos modelos de acesso √† mem√≥ria dos piores casos podem levar √† corrup√ß√£o da mem√≥ria.  Nessas DRAMs, a ativa√ß√£o repetida de uma linha de mem√≥ria ("entupimento de linha") causa ru√≠do el√©trico que altera os bits nas c√©lulas vulner√°veis ‚Äã‚Äãdas linhas adjacentes. <br><a name="habracut"></a><br>  Essas ativa√ß√µes de linha repetidas podem ser causadas pelo acesso m√∫ltiplo a um par de endere√ßos DRAM que est√£o em linhas diferentes do mesmo banco DRAM.  Conhecer o mapeamento de endere√ßos DRAM √© √∫til porque indica quais pares de endere√ßos atendem a essa propriedade "um banco, linha diferente" (mesmo banco, linha diferente; SBDR). <br><br><h4>  Adivinhando e verificando o mapeamento de endere√ßos </h4><br>  Para o teste, eu tenho uma m√°quina com m√≥dulos DRAM vulner√°veis ‚Äã‚Äãao bug Rowhammer.  A execu√ß√£o de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rowhammer_test</a> nesta m√°quina mostra uma pequena altera√ß√£o. <br><br>  Gostaria de saber o esquema de mapeamento de endere√ßo DRAM para esta m√°quina, mas n√£o est√° documentado publicamente: aqui est√° o processador Sandy Bridge, mas a Intel n√£o documenta o mapeamento de endere√ßo usado pelos controladores de mem√≥ria desses processadores. <br><br>  De fato, o teste <code>rowhammer_test</code> n√£o precisa conhecer pares de endere√ßos SBDR.  Ele apenas tenta v√°rias vezes martelar em pares de endere√ßos selecionados aleatoriamente.  Geralmente 1/8 ou 1/16 deles s√£o pares SBDR, porque em nosso carro existem 8 bancos em cada DIMM (e 16 bancos no total).  Portanto, n√£o precisamos conhecer o mapeamento de endere√ßos DRAM para causar uma pequena altera√ß√£o na mem√≥ria, mas esse conhecimento ajudar√° a realizar o teste de maneira mais proposital. <br><br>  Embora o mapeamento de endere√ßos n√£o esteja documentado, achei que poderia fazer uma suposi√ß√£o razo√°vel sobre isso com base na geometria DRAM e, em seguida, verifique a suposi√ß√£o com base nos endere√ßos f√≠sicos relatados por <code>rowhammer_test</code> .  O teste relata os endere√ßos f√≠sicos onde os bits mudam ( <i>"v√≠timas"</i> ) e os pares de endere√ßos f√≠sicos que fazem essas altera√ß√µes ( <i>"agressores"</i> ).  Como esses pares devem ser pares SBDR, podemos verificar um mapeamento hipot√©tico de endere√ßos para esses dados emp√≠ricos. <br><br><h4>  Geometria da mem√≥ria </h4><br>  A primeira etapa: verifique quantos DIMMs est√£o instalados na m√°quina e como eles est√£o organizados internamente. <br><br>  Posso solicitar informa√ß√µes de DIMM usando a <code>decode-dimms</code> no Linux (no Ubuntu, est√° no pacote <code>I2C-tools</code> ).  Essa ferramenta decodifica os metadados <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SPD (Serial Presence Detect)</a> no DIMM. <br><br>  Na minha m√°quina de teste, dois <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SO-DIMMs de</a> quatro gigabytes, que fornecem 8 GB de mem√≥ria. <br><br>  A <code>decode-dimms</code> reporta as seguintes informa√ß√µes para cada um dos m√≥dulos: <br><br><pre>  Tamanho 4096 MB
 Bancos x Linhas x Colunas x Bits 8 x 15 x 10 x 64
 Fileiras 2 </pre><br>  Isso significa que os dois DIMMs: <br><br><ul><li>  Cada banco possui 2 ^ 15 linhas (32768 linhas). </li><li>  Cada linha cont√©m 2 ^ 10 * 64 bits = 2 ^ 16 bits = 2 ^ 13 bytes = 8 KB. </li></ul><br>  Cada DIMM possui 2 fileiras e 8 bancos.  A verifica√ß√£o cruzada da capacidade do DIMM fornece o tamanho esperado: <br><br>  8 KB por linha * 32768 linhas * 2 classifica√ß√µes * 8 bancos = 4096 MB = 4 GB <br><br><h4>  Mapeando endere√ßos DRAM </h4><br>  No meu computador de teste, bits de endere√ßos f√≠sicos s√£o usados ‚Äã‚Äãda seguinte maneira: <br><br><ul><li>  <b>Bits 0-5</b> : esses s√£o os 6 bits inferiores do √≠ndice de bytes na string (ou seja, o √≠ndice de 6 bits da linha de cache de 64 bytes). </li><li>  <b>Bit 6</b> : este √© um n√∫mero de canal de 1 bit que seleciona entre dois DIMMs. </li><li>  <b>Bits 7-13</b> : os 7 bits superiores do √≠ndice em uma linha (ou seja, os bits superiores do n√∫mero da coluna). </li><li>  <b>Bits 14-16</b> : XOR com os 3 bits inferiores do n√∫mero da linha, o que fornece um n√∫mero banc√°rio de 3 bits. </li><li>  <b>Bit 17</b> : Um n√∫mero de classifica√ß√£o de 1 bit que seleciona entre duas classifica√ß√µes DIMM (que geralmente s√£o os dois lados de um chip DIMM). </li><li>  <b>Bits 18-32</b> : n√∫mero da linha de 15 bits. </li><li>  <b>Bits 33+</b> : eles podem ser configurados porque a mem√≥ria f√≠sica come√ßa com endere√ßos f√≠sicos maiores que 0. </li></ul><br><h4>  Por que essa exibi√ß√£o? </h4><br>  Esse mapeamento √© <code>rowhammer_test</code> aos resultados de <code>rowhammer_test</code> (veja abaixo), mas tamb√©m podemos explicar que os bits de endere√ßo s√£o mapeados de maneira a fornecer um bom desempenho para padr√µes t√≠picos de acesso √† mem√≥ria, como acesso sequencial e acesso por etapas ou etapas ( acesso restrito): <br><br><ul><li>  <b>Canais de simultaneidade</b> .  A coloca√ß√£o de um n√∫mero de canal no bit 6 significa que as linhas de cache ser√£o alternadas entre dois canais (ou seja, dois DIMMs) que podem ser acessados ‚Äã‚Äãem paralelo.  Isso significa que, se acessarmos os endere√ßos sequencialmente, a carga ser√° distribu√≠da por dois canais. <br><br>  A prop√≥sito, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ivy Bridge</a> (sucessora de Sandy Bridge) parece complicar a exibi√ß√£o do n√∫mero do canal.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A apresenta√ß√£o da Intel</a> menciona "hash de canal" e afirma que "permite selecionar um canal com base em v√°rios bits de endere√ßo.  Historicamente, era "A [6]".  Isso garante uma distribui√ß√£o mais uniforme do acesso √† mem√≥ria pelos canais. ‚Äù </li><li>  <b>Escorregamento banc√°rio</b> : em geral, a organiza√ß√£o dos n√∫meros das colunas, bancos e linhas deve minimizar a mudan√ßa frequente de linhas ativas do banco (debulha do banco). <br><br>  Uma pequena introdu√ß√£o: os m√≥dulos DRAM s√£o organizados em bancos, que, por sua vez, s√£o organizados em linhas.  Cada banco possui uma ‚Äúlinha ativada atual‚Äù: seu conte√∫do √© copiado para o <i>buffer</i> da <i>linha</i> , que atua como um cache, que pode ser acessado rapidamente.  O acesso a outra linha leva mais tempo, pois precisa ser ativado primeiro.  Portanto, ao mapear endere√ßos DRAM, os pares SBDR s√£o transportados o mais longe poss√≠vel no espa√ßo de endere√ßo f√≠sico. <br><br>  Linhas de persegui√ß√£o (martelamento de linha) √© um caso especial de escorregamento de um banco quando duas linhas espec√≠ficas s√£o ativadas alternadamente (possivelmente de prop√≥sito). </li><li>  <b>Paralelismo do banco</b> : os bancos podem ser acessados ‚Äã‚Äãem paralelo (embora em menor grau que os canais), portanto o n√∫mero do banco muda antes do n√∫mero da linha √† medida que o endere√ßo aumenta. </li><li>  <b>Esquema XOR</b> : XOR'introduzir os bits menos significativos de um n√∫mero de linha em um n√∫mero de banco √© um truque para evitar escorregar no banco ao acessar matrizes em grandes etapas.  Por exemplo, na exibi√ß√£o acima, XOR'ing for√ßa os endere√ßos X e X + 256k a serem localizados em bancos diferentes, sem formar um par SBDR. <br><br>  Os esquemas de XOR para banco / linha s√£o descritos em v√°rias literaturas, por exemplo: <br><ul><li>  Tese de doutorado de David Tavei Wang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">‚ÄúSistemas modernos de DRAM: algoritmos de an√°lise e planejamento de desempenho‚Äù</a> , 2005. Consulte a se√ß√£o 5.3.5 ‚ÄúSuaviza√ß√£o de endere√ßos banc√°rios (colis√£o de etapas)‚Äù.  Voc√™ tamb√©m pode encontrar informa√ß√µes excelentes sobre a tecnologia DRAM em geral nesta disserta√ß√£o. </li><li>  O artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">‚ÄúReduzindo atrasos na DRAM com a hierarquia de mem√≥ria integrada‚Äù</a> , 2001. Veja a figura.  3) </li></ul></li></ul><br><h4>  Reconcilia√ß√£o com rowhammer_test </h4><br>  A execu√ß√£o de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rowhammer_test_ext</a> (uma vers√£o estendida do <code>rowhammer_test</code> ) em uma m√°quina de teste por 6 horas revelou uma mudan√ßa repetida de bits em 22 lugares.  (consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dados de origem e c√≥digo de an√°lise</a> ). <br><br>  O teste para strings de cunhagem gera conjuntos de tr√™s endere√ßos (A1, A2, V): <br><br><ul><li>  V √© o endere√ßo da v√≠tima, onde vemos a mudan√ßa de bits. </li><li>  A1 e A2 s√£o os endere√ßos do agressor que criamos. </li><li>  Classifique A1 e A2 para que A1 fique mais pr√≥ximo de V que A2.  N√≥s assumimos provisoriamente que um endere√ßo mais pr√≥ximo, A1, realmente causa uma pequena altera√ß√£o (embora isso n√£o seja necessariamente verdadeiro se um mapeamento mais complexo de endere√ßos DRAM for usado). </li></ul><br>  Para todos esses resultados, esperamos que tr√™s propriedades sejam conclu√≠das: <br><br><ul><li>  <b>Linha</b> : os n√∫meros de <b>linha</b> A1 e V devem ser diferentes de 1, ou seja,  eles devem estar em linhas adjacentes.  (A2 pode ter qualquer n√∫mero de linha). <br><br>  Essa propriedade facilita a determina√ß√£o de onde est√£o os bits mais baixos do n√∫mero da linha no endere√ßo f√≠sico. <br><br>  O teste mostrou que essa propriedade √© v√°lida para todos, exceto dois resultados.  Nestes dois resultados, os n√∫meros das linhas diferem por 3 em vez de 1. </li><li>  <b>Banco</b> : V, A1 e A2 devem ter o mesmo n√∫mero de banco.  De fato, essa propriedade se manifestou em todos os 22 resultados.  Ele √© salvo somente ao aplicar o esquema XOR'ing de linhas / bancos. </li><li>  <b>Canal</b> : V, A1 e A2 devem ter o mesmo n√∫mero de canal.  Isso vale para todos os resultados.  Acontece que todos os resultados t√™m canal = 0, porque <code>rowhammer_test</code> seleciona apenas endere√ßos alinhados em 4k e, portanto, testa apenas um canal (talvez isso possa ser considerado um bug). </li></ul><br><h4>  Poss√≠veis testes adicionais </h4><br>  No futuro, voc√™ pode executar mais duas experi√™ncias para verificar se o mapeamento de endere√ßo DRAM avalia corretamente a propriedade SBDR: <br><br><ul><li>  <b>Medi√ß√£o do tempo</b> : o acesso m√∫ltiplo a pares de endere√ßos SBDR deve ser mais lento que o acesso m√∫ltiplo a pares sem SBDR, porque o primeiro causa a ativa√ß√£o das linhas e o segundo n√£o. </li><li>  <b>Teste exaustivo de Rowhammer</b> : assim que encontrarmos o endere√ßo do agressor A1, que causa uma mudan√ßa repetida de bits, podemos verificar isso em muitos valores de A2.  O efeito da cunhagem (A1, A2) mudar√° os bits apenas se for um par de SBDR. </li></ul><br>  Al√©m disso, a remo√ß√£o de um DIMM da unidade de sistema deve remover o bit do canal do mapeamento de endere√ßo DRAM e alterar os endere√ßos do agressor e da v√≠tima.  Isso tamb√©m pode ser verificado. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt431102/">https://habr.com/ru/post/pt431102/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt431090/index.html">Um bot VK, um C # e uma laranja</a></li>
<li><a href="../pt431092/index.html">ROS: mapa de profundidade no Raspberry Pi "baixo n√≠vel de sangue"</a></li>
<li><a href="../pt431094/index.html">Paci√™ncia Sort</a></li>
<li><a href="../pt431096/index.html">Como criar um produto de bot de bate-papo</a></li>
<li><a href="../pt431098/index.html">Mesmo um inc√™ndio n√£o √© um obst√°culo ou o Zimbra Speed ‚Äã‚ÄãRecovery ap√≥s um desastre</a></li>
<li><a href="../pt431104/index.html">Como desenvolvemos a Neoflex Expertise em DevOps</a></li>
<li><a href="../pt431106/index.html">Quanto dinheiro os americanos gastaram nesta sexta-feira negra e o que os smartphones t√™m a ver com isso?</a></li>
<li><a href="../pt431108/index.html">Como transformar imagens de sat√©lite em mapas. Vis√£o computacional em Yandex</a></li>
<li><a href="../pt431110/index.html">Pare de alimentar os editores. A UE est√° desenvolvendo regras para o livre acesso obrigat√≥rio √† pesquisa</a></li>
<li><a href="../pt431112/index.html">Como usar m√©todos de m√≠nimos quadrados para avaliar recursos e monitorar bancos de dados Oracle</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>