<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§≥üèø üë®‚Äç‚öïÔ∏è üë∑ Comment cuisiner RTSP sur votre site Web en 2020, ou pourquoi les verrats n'auront pas la chance de s'enfuir üë´ üò® üêü</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le RTSP est un protocole de signalisation simple qu'ils ne peuvent remplacer par rien depuis de nombreuses ann√©es d√©j√†, et il faut admettre qu'ils n'e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment cuisiner RTSP sur votre site Web en 2020, ou pourquoi les verrats n'auront pas la chance de s'enfuir</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flashphoner/blog/479008/"><p><img src="https://habrastorage.org/webt/0o/qj/i7/0oqji7xkok-ssze_oqdnr2kmfcg.jpeg"></p><br><p>  Le RTSP est un protocole de signalisation simple qu'ils ne peuvent remplacer par rien depuis de nombreuses ann√©es d√©j√†, et il faut admettre qu'ils n'essaient pas vraiment. </p><br><p>  Par exemple, nous avons une cam√©ra IP qui prend en charge RTSP.  Quiconque a d√©j√† test√© le trafic avec un c√¢ble Sharkwire vous dira que d'abord il y a DESCRIBE, puis PLAY, puis le trafic commence √† couler directement via RTP ou envelopp√© dans le canal TCP par exemple. </p><a name="habracut"></a><br><p>  Un sch√©ma typique d'√©tablissement d'une connexion RTSP ressemble √† ceci: </p><br><p><img src="https://habrastorage.org/webt/yi/i9/kw/yii9kwulxpxxz1dywpppxqdy0ko.png"></p><br><p>  Il est concevable que le support du protocole RTSP ne soit pas n√©cessaire pour les navigateurs et soit √† peu pr√®s autant utilis√© que la cinqui√®me roue, par cons√©quent les navigateurs ne sont pas press√©s de l'impl√©menter √† grande √©chelle, et cela n'arrivera presque jamais.  D'un autre c√¥t√©, les navigateurs pourraient cr√©er des connexions TCP directes, ce qui r√©soudrait la t√¢che, mais maintenant, il se heurte √† des probl√®mes de s√©curit√©: avez-vous d√©j√† vu un navigateur qui permettrait √† un script d'utiliser directement les protocoles de transport? </p><br><p>  Mais les gens exigent que les flux soient disponibles dans "n'importe quel navigateur sans installer de logiciel suppl√©mentaire", et les startuppers √©crivent sur leurs sites Web, "vous n'avez rien √† installer, cela fonctionnera dans tous les navigateurs pr√™ts √† l'emploi", quand ils souhaitez afficher un flux provenant d'une cam√©ra IP. </p><br><p>  Dans cet article, nous allons explorer comment cela peut √™tre r√©alis√©.  Et comme l'ann√©e √† venir contient un chiffre rond, ajoutons de l'actualit√© √† notre article et collons-y une √©tiquette avec 2020, d'autant plus qu'il en est vraiment ainsi. </p><br><p>  Alors, quelles technologies d'affichage vid√©o pour une page Web doivent √™tre oubli√©es en 2020?  C'est Flash dans le navigateur.  C'est mort.  Il n'existe plus, rayez-le de la liste. </p><br><h3 id="three-useful-methods">  Trois m√©thodes utiles </h3><br><p>  Les outils qui vous permettront de regarder un flux vid√©o dans votre navigateur aujourd'hui sont: </p><br><ol><li>  WebRTC </li><li>  Hls </li><li>  Websocket + MSE </li></ol><br><h4 id="what-is-wrong-with-webrtc">  Quel est le probl√®me avec WebRTC </h4><br><p>  En deux mots: elle est gourmande en ressources et compliqu√©e. </p><br><p>  Vous allez le faire signe, "Que voulez-vous dire par gourmand en ressources?", Comme les processeurs sont puissants de nos jours, la m√©moire est bon march√©, alors quel est le probl√®me?  Eh bien, tout d'abord, c'est le cryptage obligatoire de tout le trafic m√™me si vous n'en avez pas besoin.  Deuxi√®mement, WebRTC est une connexion bidirectionnelle compliqu√©e et un √©change de r√©troaction d'√©gal √† √©gal sur la qualit√© du canal (homologue √† serveur, dans ce cas): √† chaque instant, un d√©bit binaire est calcul√©, des pertes de paquets d√©tect√©es, des d√©cisions sur leur redirection prise, et la synchronisation audio-vid√©o est calcul√©e par rapport √† tout cela, la soi-disant l√®vresync, qui fait co√Øncider les l√®vres de l'orateur avec leurs mots.  Tous ces calculs, ainsi que le trafic entrant sur le serveur, allouent et lib√®rent des gigaoctets de RAM en temps r√©el, et si quelque chose se passe mal, un serveur de 256 gigaoctets avec un processeur √† 48 c≈ìurs se mettra facilement en rotation malgr√© tous les gigaherzs, nanom√®tres et DDR 10 √† bord. </p><br><p>  C'est donc une sorte de chasse aux √©cureuils avec un missile Iskander.  Tout ce que nous devons aspirer, c'est un flux RTSP, puis l'afficher, et ce que WebRTC dit, "Oui, allez, mais vous devrez payer pour cela." </p><br><h4 id="why-webrtc-is-good">  Pourquoi WebRTC est bon </h4><br><p> La latence.  C'est vraiment bas.  Si vous √™tes pr√™t √† sacrifier les performances et la complexit√© pour la faible latence, WebRTC est la variante la plus appropri√©e pour vous. </p><br><h4 id="why-hls-is-good">  Pourquoi HLS est bon </h4><br><p>  En deux mots: √ßa peut fonctionner partout </p><br><p>  HLS est un tout-terrain lent dans le monde de l'affichage de contenu en direct.  Il peut fonctionner partout gr√¢ce √† deux choses: le transport HTTP et le patronage d'Apple.  En effet, le protocole HTTP est omnipr√©sent, je peux sentir sa pr√©sence m√™me lorsque j'√©cris ces lignes.  Ainsi, peu importe o√π vous vous trouvez et quelle ancienne tablette vous utilisez pour surfer sur le net, HLS (HTTP Live Streaming) vous parviendra et vous livrera la vid√©o sur votre √©cran. </p><br><p>  C'est assez bien, mais ... </p><br><h4 id="why-hls-is-bad">  Pourquoi HLS est mauvais </h4><br><p>  La latence.  Il existe par exemple des projets de vid√©osurveillance de chantier.  Une installation est en construction depuis des ann√©es, et pendant tout ce temps, la mauvaise cam√©ra enregistre des vid√©os du chantier de construction jour et nuit, 24/7.  Ceci est un exemple d'une situation o√π la faible latence n'est pas n√©cessaire. </p><br><p>  Un autre exemple est celui des sangliers.  De vrais sangliers.  Les agriculteurs de l'Ohio souffrent d'une invasion de sangliers qui se nourrissent des cultures et les pi√©tinent comme des sauterelles, ce qui constitue une menace pour le bien-√™tre financier des fermes.  Des startuppers entreprenants ont lanc√© un syst√®me de vid√©osurveillance √† partir de cam√©ras RTSP qui surveille le terrain en temps r√©el et d√©clenche un pi√®ge lorsque les intrus envahissent.  Dans ce cas, la faible latence est d'une importance critique, et si HLS est utilis√© (avec une latence de 15 secondes), les verrats s'enfuiront avant l'activation du pi√®ge. </p><br><p><img src="https://habrastorage.org/webt/g4/ha/iw/g4haiwkwu7jqrhh65c804phjt-q.jpeg"></p><br><p>  Voici un autre exemple: des pr√©sentations vid√©o o√π quelqu'un vous montre un produit et attend une r√©ponse rapide.  Dans le cas d'une latence √©lev√©e, ils vous montreront le produit sur l'appareil photo, puis demanderont: ¬´Alors, comment aimez-vous √ßa?¬ª, Et cela ne vous parviendra qu'en 15 secondes.  En 15 secondes, le signal peut se d√©placer vers la Lune et revenir 12 fois.  Non, nous ne voulons pas d'une telle latence.  Cela ressemble plut√¥t √† une vid√©o pr√©enregistr√©e qu'√† Live.  Mais la vid√©o pr√©enregistr√©e, car c'est ainsi que HLS fonctionne: il enregistre des parties d'une vid√©o sur un disque ou dans la m√©moire du serveur, et le lecteur t√©l√©charge les parties enregistr√©es.  C'est ainsi que HTTP Live fonctionne, ce qui n'est pas du tout Live. </p><br><p>  Pourquoi cela arrive-t-il?  La pr√©sence mondiale du protocole HTTP et sa simplicit√© entra√Ænent sa lenteur car HTTP n'√©tait pas initialement destin√© au t√©l√©chargement et √† l'affichage rapides de milliers de gros fragments vid√©o (segments HLS).  Ils sont bien s√ªr t√©l√©charg√©s et jou√©s avec une haute qualit√©, mais tr√®s lentement: cela prend 15 secondes ou plus pour qu'ils soient t√©l√©charg√©s, mis en m√©moire tampon et d√©cod√©s. </p><br><p>  Il convient de noter ici qu'Apple a annonc√© son HLS Low Latency √† l'automne 2019, mais c'est d√©j√† une autre histoire.  Jetons un regard plus d√©taill√© sur leurs r√©sultats plus tard.  Et maintenant, nous avons √©galement MSE en stock. </p><br><h4 id="why-mse-is-good">  Pourquoi MSE est bon </h4><br><p>  Media Source Extension est une prise en charge native de la lecture de vid√©os par paquets dans le navigateur.  Il peut √™tre appel√© lecteur natif pour H.264 et AAC, sur lequel vous pouvez alimenter des segments vid√©o et qui n'est pas li√© √† un protocole de transport, contrairement √† HLS.  Pour cette raison, vous pouvez choisir le transport via le protocole Websockets.  En d'autres termes, les segments ne seront plus t√©l√©charg√©s en utilisant l'ancienne technologie Request-Response (HTTP), mais se d√©verseront facilement via la connexion Websockets qui est presque un canal TCP direct.  Ceci est d'une grande utilit√© en ce qui concerne la r√©duction des retards qui peuvent devenir aussi bas que 3-5 secondes.  Une telle latence n'est pas fantastique mais convient √† la plupart des projets qui ne n√©cessitent pas de temps r√©el difficile.  La complexit√© et l'intensit√© des ressources sont √©galement relativement faibles car un canal TCP est ouvert et presque les m√™mes segments HLS le traversent, qui sont collect√©s par le lecteur et envoy√©s pour √™tre lus. </p><br><h4 id="why-mse-is-bad">  Pourquoi MSE est mauvais </h4><br><p>  Cela ne peut pas fonctionner partout.  Comme pour WebRTC, sa p√©n√©tration dans les navigateurs est plus faible.  Les iPhones (iOS) ont une histoire particuli√®rement remarquable d'√©chec de lecture de MSE, ce qui rend MSE difficilement appropri√© comme seule solution pour une startup. <br>  Il est enti√®rement disponible dans les navigateurs suivants: Edge, Firefox, Chrome, Safari, navigateur Android, Opera Mobile, Chrome pour Android, Firefox pour Android, navigateur UC pour Android. </p><br><p><img src="https://habrastorage.org/webt/xt/oq/wn/xtoqwnjdoosqb6fhopu9rvoxsxy.png"></p><br><p>  La prise en charge limit√©e de MSE est apparue dans iOS Safari il y a assez peu de temps, √† commencer par iOS 13. </p><br><p><img src="https://habrastorage.org/webt/fl/wd/-n/flwd-nksnux1tlprjriupeajyvm.png"></p><br><h3 id="rtsp-leg">  Jambe RTSP </h3><br><p>  Nous avons discut√© de la livraison dans la direction du serveur vid√©o&gt; du navigateur.  En plus de cela, vous aurez √©galement besoin de ces deux choses: </p><br><p>  1) Pour livrer votre vid√©o de la cam√©ra IP au serveur. <br>  2) Pour convertir la vid√©o dans l'un des formats / protocoles d√©crits ci-dessus. </p><br><p>  C'est l√† que le c√¥t√© serveur entre en jeu. </p><br><p>  Ta-dah ... Rencontrez <a href="https://flashphoner.com/">Web Call Server 5</a> (ou simplement WCS pour vos amis).  Quelqu'un doit recevoir le trafic RTSP, d√©semballer correctement la vid√©o, la convertir en WebRTC, HLS ou MSE, de pr√©f√©rence sans √™tre surcompress√© par le transcodeur, et l'envoyer vers le navigateur sous une forme pr√©sentable, non corrompu par des artefacts et des gels. </p><br><p>  La t√¢che n'est pas compliqu√©e √† premi√®re vue, mais il peut y avoir tellement d'emb√ªches cach√©es, de cam√©ras chinoises et de nuances de conversion derri√®re elle que c'est vraiment horrible.  Ce n'est pas possible sans hacks en fait, mais cela fonctionne et fonctionne bien.  En production. </p><br><h4 id="the-delivery-scheme">  Le sch√©ma de livraison </h4><br><p>  En cons√©quence, un sch√©ma complet de livraison de contenu RTSP avec conversion sur un serveur interm√©diaire commence √† prendre forme. </p><br><p><img src="https://habrastorage.org/webt/jm/7e/oj/jm7eojlfeztudqtrwzjebgu4t9e.png"></p><br><p>  L'une des questions les plus fr√©quemment pos√©es par nos coll√®gues indiens est: ¬´Est-ce possible?  Directement, sans serveur? ‚Äù.  Non, ce n'est pas le cas;  vous aurez besoin du c√¥t√© serveur qui fera le travail.  Dans le cloud, sur le mat√©riel, sur corei7 dans votre balcon, mais vous ne pouvez pas vous en passer. </p><br><h4 id="lets-get-back-to-our-year-2020">  Revenons √† notre ann√©e 2020 </h4><br><p>  Alors, voici la recette pour cuisiner un RTSP dans votre navigateur: </p><br><ol><li>  <a href="">Prenez un nouveau WCS (Web Call Server)</a> . </li><li>  Ajoutez WebRTC, HLS ou MSE au go√ªt. </li><li><p>  Servez-les sur la page Web. </p><br><p>  Bon repas! </p><br></li></ol><br><h3 id="no-this-isnt-all-yet">  Non, ce n'est pas encore tout. </h3><br><p>  Les neurones enqu√™teurs voudront certainement poser cette question: ¬´Comment?  Vraiment, <a href="https://flashphoner.com/embedding-html5-rtsp-player-into-a-web-page/">comment cela peut-il √™tre fait</a> ?  √Ä quoi cela ressemblera-t-il dans le navigateur? " </p><br><p>  Nous aimerions attirer votre attention sur le lecteur WebRTC minimaliste assembl√© comme un effort de table de cuisine. </p><br><p>  1) Connectez le script principal de l'API flashphoner.js et le script my_player.js, que nous allons cr√©er un peu plus tard, √† la page Web. </p><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"../../../../flashphoner.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">my_player.js</span></span></span><span class="hljs-tag">"&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  2) Initialiser l'API dans le corps de la page Web </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"init_api()"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  3) Ajoutez div, qui servira de conteneur pour les vid√©os, √† la page.  D√©finissez les tailles et la limite pour cela. </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"myVideo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width:320px;height:240px;border: solid 1px"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  4) Ajoutez le bouton Lecture, le clic sur qui initialisera la connexion au serveur et commencera √† lire la vid√©o </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"connect()"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"PLAY"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br><p>  5) Cr√©ons maintenant le script my_player.js qui contiendra le code principal de notre lecteur.  D√©crire les constantes et les variables </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> SESSION_STATUS = Flashphoner.constants.SESSION_STATUS; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> STREAM_STATUS = Flashphoner.constants.STREAM_STATUS; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> session;</code> </pre> <br><p>  6) Initialiser l'API lorsqu'une page HTML est charg√©e </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init_api</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"init api"</span></span>); Flashphoner.init({ }); }</code> </pre> <br><p>  7) Connectez-vous au serveur WCS via WebSocket.  Pour que tout fonctionne correctement, remplacez "wss: //demo.flashphoner.com" par votre adresse WCS </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ session = Flashphoner.createSession({<span class="hljs-attr"><span class="hljs-attr">urlServer</span></span>: <span class="hljs-string"><span class="hljs-string">"wss://demo.flashphoner.com"</span></span>}).on(SESSION_STATUS.ESTABLISHED, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">session</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"connection established"</span></span>); playStream(session); }); }</code> </pre> <br><p>  8) Apr√®s cela, transmettez les deux param√®tres suivants, "nom" et "affichage", o√π "nom" est l'URL RTSP du flux en cours de lecture, et "affichage" est l'√©l√©ment de myVideo dans lequel notre lecteur sera install√©.  D√©finissez ici √©galement l'URL de votre flux, au lieu du n√¥tre. </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">playStream</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> options = {<span class="hljs-attr"><span class="hljs-attr">name</span></span>:<span class="hljs-string"><span class="hljs-string">"rtsp://b1.dnsdojo.com:1935/live/sys2.stream"</span></span>,<span class="hljs-attr"><span class="hljs-attr">display</span></span>:<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"myVideo"</span></span>)}; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stream = session.createStream(options).on(STREAM_STATUS.PLAYING, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stream</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"playing"</span></span>); }); stream.play(); }</code> </pre> <br><p>  Enregistrez les fichiers et essayez de lancer le lecteur.  Votre flux RTSP est-il lu? </p><br><p>  Lorsque nous l'avons <a href="https://flashphoner.com/testing-rtsp-html5-player/">test√©</a> , celui-ci a √©t√© jou√©: rtsp: //b1.dnsdojo.com: 1935 / live / sys2.stream. </p><br><p>  Et voici √† quoi √ßa ressemble: </p><br><p>  Le joueur avant de cliquer sur le bouton Lecture </p><br><p><img src="https://habrastorage.org/webt/pe/ej/6n/peej6nfw2lthkmmnsrypojl6bzq.png"></p><br><p>  Le joueur avec une vid√©o lanc√©e </p><br><p><img src="https://habrastorage.org/webt/w3/h8/yo/w3h8yozn6madl2tolxx_xg3yljs.png"></p><br><p>  Il n'y a pas beaucoup de code du tout: </p><br><p>  HTML </p><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"../../../../flashphoner.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">my_player.js</span></span></span><span class="hljs-tag">"&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"init_api()"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"myVideo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width:320px;height:240px;border: solid 1px"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">/&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"connect()"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"PLAY"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Javascript </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//Status constants var SESSION_STATUS = Flashphoner.constants.SESSION_STATUS; var STREAM_STATUS = Flashphoner.constants.STREAM_STATUS; //Websocket session var session; //Init Flashphoner API on page load function init_api() { console.log("init api"); Flashphoner.init({ }); } //Connect to WCS server over websockets function connect() { session = Flashphoner.createSession({urlServer: "wss://demo.flashphoner.com"}).on(SESSION_STATUS.ESTABLISHED, function(session){ console.log("connection established"); playStream(session); }); } //Playing stream with given name and mount the stream into myVideo div element function playStream() { var options = {"rtsp://b1.dnsdojo.com:1935/live/sys2.stream",display:document.getElementById("myVideo")}; var stream = session.createStream(options).on(STREAM_STATUS.PLAYING, function(stream) { console.log("playing"); }); stream.play(); }</span></span></code> </pre> <br><p>  demo.flashphoner.com est utilis√© comme serveur.  Le code complet de l'exemple est disponible ci-dessous, au bas de la page contenant les liens. <br>  Bon streaming! </p><br><h3 id="links">  Les liens </h3><br><p>  <a href="https://github.com/flashphoner/flashphoner_client/tree/wcs_api-2.0/examples/demo/streaming/player">Code joueur sur github</a> </p><br><p>  <a href="https://flashphoner.com/ip-camera-streaming-via-rtsp-for-webrtc-and-websocket-browsers/">Int√©gration d'un lecteur RTSP dans une page Web ou une application mobile</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr479008/">https://habr.com/ru/post/fr479008/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr478998/index.html">Pourquoi voulons-nous toujours voir le nombre d'or? Tentative (infructueuse) d'analyse √©volutive √† l'aide de r√©seaux de neurones C ++</a></li>
<li><a href="../fr479000/index.html">Stage Parallels √† 14 ans</a></li>
<li><a href="../fr479002/index.html">Gamification des processus m√©tiers. Comment √ßa marche?</a></li>
<li><a href="../fr479004/index.html">Est-il possible de se prot√©ger des recruteurs ennuyeux?</a></li>
<li><a href="../fr479006/index.html">Les chroniques de Book Hunger II</a></li>
<li><a href="../fr479012/index.html">SviMik: ¬´Il y a deux opinions oppos√©es √† ce sujet dans l'OSM¬ª</a></li>
<li><a href="../fr479016/index.html">5 √©tapes pour prot√©ger les secrets commerciaux</a></li>
<li><a href="../fr479018/index.html">Docker pour le front-end. Partie 2. Que faites-vous?</a></li>
<li><a href="../fr479020/index.html">L'histoire de la fa√ßon dont Google Play a ray√© dix ans de mon travail en une heure</a></li>
<li><a href="../fr479022/index.html">Les t√©l√©viseurs intelligents Samsung, LG, Vizio et TCL prennent chaque seconde des "empreintes digitales" de l'√©cran et les envoient au serveur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>