<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏿 🧛🏿 👨‍🌾 Ketika pengujian melalui metode publik mulai bau (contoh) 🤛🏿 ▶️ 🤰🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam artikel tentang pengujian metode publik, saya menyinggung pengujian unit logika kelas pribadi. Saya pikir akan bermanfaat untuk mengulangi tesis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ketika pengujian melalui metode publik mulai bau (contoh)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420567/">  Dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel tentang pengujian metode publik, saya</a> menyinggung pengujian unit logika kelas pribadi.  Saya pikir akan bermanfaat untuk mengulangi tesis ini, karena mayoritas, menurut pendapat saya, merasa bahwa kita berbicara tentang pengujian metode pribadi, meskipun itu tentang logika pribadi.  Pada artikel ini saya ingin menggambarkan tesis utama dengan contoh praktis.  Di bawah kat contoh dengan sedikit analisis. <a name="habracut"></a><br><br><h3>  Contoh stok </h3><br>  Untuk mengilustrasikan masalahnya, saya memberikan sebuah contoh.  Idenya diambil dari satu proyek nyata.  Idealnya, seperti seseorang mungkin memperhatikan, kelas harus ditulis berbeda.  Tetapi sekarang tidak ada yang akan menulis ulang (atau refactor), karena  ini akan menghabiskan banyak waktu untuk mengedit dan menguji apa yang berhasil.  Karena itu, tidak akan disetujui.  Dalam hal ini, Anda perlu mengubah kode dan perubahan harus benar.  Jadi, ini kodenya.  Logika penting terkonsentrasi dalam metode ProcessMessage.  Tujuan: Untuk memperkenalkan bendera baru logika bisnis dalam pemrosesan pesan.  Bendera ini memiliki logika non-sepele. <br><br>  Bagaimana Anda menerapkan dan menguji bendera? <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Messaging; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">PublicMethodNottrivialSample</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MessageProcessorService</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> _lockObject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CancellationTokenSource _cancellationSource; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Action _receiveMessage; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _listenerThreads = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (_lockObject) { _cancellationSource = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CancellationTokenSource(); Task.Factory.StartNew(() =&gt; InitializeReceiveLoop(_cancellationSource.Token), _cancellationSource.Token); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeReceiveLoop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">CancellationToken cancellationToken</span></span></span><span class="hljs-function">)</span></span> { _receiveMessage = () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!cancellationToken.IsCancellationRequested) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MessageQueueTransaction msgTx = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MessageQueueTransaction()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { msgTx.Begin(); <span class="hljs-comment"><span class="hljs-comment">//   MessageQueue queue = new MessageQueue(); Message message = queue.Receive(msgTx); //    ,    if (!cancellationToken.IsCancellationRequested) { ProcessMessage(message); } msgTx.Commit(); } catch (Exception ex) { // some logging } } } }; for (int n = 0; n &lt; _listenerThreads; n++) { StartProcessingLoop(cancellationToken); } } private void ProcessMessage(Message message) { //   ,     } private void StartProcessingLoop(CancellationToken cancellationToken) { Task.Factory.StartNew(_receiveMessage, cancellationToken); } } }</span></span></code> </pre> <br>  Kelas menunjukkan bahwa satu-satunya metode publik adalah Mulai ().  Anda dapat mengujinya jika Anda mengubah tanda tangan, tetapi dalam hal ini antarmuka publik akan berubah.  Selain itu, Anda perlu mengubah beberapa metode untuk mengembalikan utas yang sedang berjalan dan kemudian menunggu sampai selesai dalam pengujian. <br><br>  Tetapi, seperti yang kita ingat, persyaratan hanya menyangkut implementasi bendera dalam proses pemrosesan pesan, dan tidak menyiratkan perubahan dalam pengoperasian mekanisme penerimaan pesan.  Oleh karena itu, tidak peduli siapa yang membuat perubahan, saya akan berharap bahwa hanya satu metode yang akan diperbaiki, dan unit test hanya akan berhubungan dengan logika yang bisa berubah.  Untuk mencapai ini, tetap dalam kerangka prinsip itu sulit: tes akan berubah menjadi non-sepele, yang akan memerlukan baik penolakan untuk menulisnya, atau kode yang rumit.  Inilah cara pengujian dimulai melalui metode publik.  Dan kemudian seseorang akan secara emosional menulis: "TDD adalah waktu yang lama", "Pelanggan tidak membayar", atau "Tes tidak berfungsi dengan baik". <br><br>  Secara umum, perlu untuk menguji kode seperti itu, tetapi tidak dengan tes unit, tetapi dengan tes integrasi. <br><br><h3>  "Kamu catur, atau pergi" </h3><br>  Tentu saja, menulis tes unit untuk logika yang diubah diperlukan.  Saya percaya bahwa dilema, dalam hal ini, adalah memilih cara yang paling murah untuk menulis tes, daripada kode yang berguna.  Di sini saya maksudkan fakta bahwa apa pun yang Anda lakukan: refactoring untuk metode publik atau solusi lain - Anda akan melakukan ini untuk menulis tes, dan tidak menyelesaikan persyaratan dari tugas klien.  Dalam hal ini, disarankan untuk mengevaluasi biaya dan efek.  Selain solusi di atas dengan refactoring, ada beberapa solusi alternatif.  Saya bawa semuanya, di bawah ini kita akan membahas Pro dan Kontra: <br><br><ol><li>  metode pribadi dapat diuji </li><li>  dapatkah metodenya dipublikasikan </li><li>  dapat dibuat internal </li><li>  dapat ditarik ke dalam kelas terpisah sebagai metode publik </li></ol><br>  Jika kita membandingkan tiga metode pertama dengan solusi melalui metode publik, tetapi semuanya membutuhkan lebih sedikit biaya tenaga kerja (dengan swasta bukan fakta).  Juga, mereka semua, pada kenyataannya, adalah solusi yang sama, dengan sedikit perbedaan gaya.  Karena  hasilnya akan diperoleh dengan cara apa pun, oleh karena itu, menurut pendapat saya, pilihan yang mendukung salah satu solusi ini tidak boleh didasarkan pada kemampuan teknis bahasa, tetapi pada apa yang ingin Anda tunjukkan kepada pengembang lain: <br><br><ol><li>  jika metode ini dapat dijalankan dari mana saja dalam solusi dan itu adalah bagian dari perilaku kelas, maka buat itu publik dan tarik ke antarmuka kelas; </li><li>  jika metode ini dapat digunakan dari kelas lain, tetapi hanya di dalam majelis ini, maka lakukan <b>internal</b> ; </li><li>  jika metode hanya dapat digunakan di dalam kelas utama, di mana ia dapat dipanggil dari metode lain, maka buatlah itu <b>terlindungi internal</b> . </li></ol><br>  Metode internal dapat dibuat terlihat oleh majelis uji menggunakan atribut InternalsVisibleTo dan dipanggil seperti biasa.  Pendekatan ini membuat tes menulis lebih mudah, dan hasilnya akan sama. <br><br><h3>  Menguji ProsesMessage </h3><br>  Mari kita kembali ke tugas.  Mengikuti pendekatan di atas, saya akan membuat beberapa perubahan: <br><br><ul><li>  akan membuat ProcessMessage publik </li><li>  akan membuat metode internal baru yang dilindungi untuk logika bendera (mis. GetFlagValue) </li><li>  akan menulis tes untuk GetFlagValue untuk semua kasus </li><li>  Saya akan menulis tes untuk ProcessMessage untuk memastikan bahwa GetFlagValue digunakan dengan benar: parameter dilewatkan dengan benar dan benar-benar digunakan </li></ul><br>  Saya akan mengklarifikasi bahwa saya tidak akan menulis tes unit untuk semua kasus menggunakan GetFlagValue dalam metode ProcessMessage, asalkan saya menguji kasus ini dalam tes unit GetFlagValue.  Dalam kasus yang tidak ditemukan, mereka harus ditambahkan.  Dalam hal ini, pendekatan utama tetap: <br><br><ul><li>  semua kasus dicakup oleh tes unit GetFlagValue </li><li>  Tes unit ProcessMessage memverifikasi bahwa metode flag digunakan dengan benar </li></ul><br>  Saya percaya bahwa sesuai dengan ini, Anda dapat menulis hanya satu unit test untuk ProcessMessage dan beberapa untuk GetFlagValue. <br><br>  Sesuatu seperti itu.  Pendapat anda </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id420567/">https://habr.com/ru/post/id420567/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id420555/index.html">Alan Kay: "Komputer adalah instrumen yang musiknya adalah ide"</a></li>
<li><a href="../id420559/index.html">Bagaimana IaaS memasuki ritel dan produksi: siapa dan mengapa beralih ke infrastruktur virtual</a></li>
<li><a href="../id420561/index.html">Rekonstruksi gambar: serat 1 km, jaringan saraf tiruan dan pembelajaran dalam</a></li>
<li><a href="../id420563/index.html">Analisis laporan Dmitry Stolyarov tentang pemantauan Kubernetes</a></li>
<li><a href="../id420565/index.html">Pelajari OpenGL. Pelajaran 5.9 - Render yang Tertunda</a></li>
<li><a href="../id420571/index.html">Headphone pintar - tren 2018: penyaringan lingkungan, pelatih audio, gerakan kepala dan koneksi langsung dengan Alexa</a></li>
<li><a href="../id420573/index.html">Akademi Android: sekarang di Moskow</a></li>
<li><a href="../id420575/index.html">Apa yang harus dibaca tentang suara di film, video, dan game</a></li>
<li><a href="../id420577/index.html">Intisari materi menarik untuk pengembang ponsel # 266 (pada 13 Agustus - 19 Agustus)</a></li>
<li><a href="../id420579/index.html">CPU 24-core, tapi saya tidak bisa mengetikkan email</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>