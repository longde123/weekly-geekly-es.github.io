<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìπ üïô üëò Wie wir ein Kryptow√§hrungs-Zahlungssystem erstellt haben: f√ºnf Hauptprobleme üà≥ üòò üßùüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! In Kontakt steht B2Broker, ein Anbieter von Liquidit√§ts- und Technologiel√∂sungen f√ºr die Makler- und B√∂rsenbranche. Eines unserer Produkte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie wir ein Kryptow√§hrungs-Zahlungssystem erstellt haben: f√ºnf Hauptprobleme</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/b2broker/blog/441338/"> Hallo Habr!  In Kontakt steht B2Broker, ein Anbieter von Liquidit√§ts- und Technologiel√∂sungen f√ºr die Makler- und B√∂rsenbranche.  Eines unserer Produkte ist die Handelsplattform B2BX.exchange.  Als wir die Plattform im Sommer 2017 starteten, haben wir dar√ºber nachgedacht, wie Kryptow√§hrungen akzeptiert und welche Verarbeitung verwendet werden soll.  Leider war zu diesem Zeitpunkt niemand bereit, zumindest irgendwelche Garantien f√ºr die Verwundbarkeit des Vertrags zu geben, und die Geschichte des Angriffs auf die DAO-Plattform war noch in der m√ºndlichen Verhandlung.  Wir wollten nicht in die Fu√üstapfen des DAO treten.  Dar√ºber hinaus hatten wir einige Erfahrungen mit der Annahme von Zahlungen √ºber die Blockchain.  Deshalb haben wir uns entschlossen, den gesamten Zyklus der Blockchain-Zahlungen unabh√§ngig zu berechnen.  In diesem Beitrag werden wir dar√ºber sprechen, was wir getan haben und am interessantesten dar√ºber, welche Probleme wir dabei l√∂sen mussten. <br><br><img src="https://habrastorage.org/webt/uk/hg/wc/ukhgwczsncwbugsyinbvjlnoqg4.jpeg"><br>  <i>Quelle: ripplecoinnews.com</i> <br><a name="habracut"></a><br>  Bei der Arbeit am Zahlungssystem haben wir festgestellt, dass wir einen Service nicht nur f√ºr unsere B2BX.exchange-Plattform, sondern auch f√ºr ein v√∂llig unabh√§ngiges Produkt erbringen k√∂nnen.  Wir haben es B2BinPay genannt. <br><br><h2>  Woraus besteht B2BinPay? </h2><br>  Das Zahlungssystem ist in mehrere grundlegende Teile unterteilt.  Alle von ihnen sind in PHP geschrieben. <br><br>  <i>Der erste Teil des Systems</i> ist f√ºr die Interaktion mit Blockchains verantwortlich, dh f√ºr den Empfang, das Senden und die Verfolgung von Zahlungen. <br><br>  <i>Der zweite Teil</i> ist die API.  Er besch√§ftigt sich mit Verbrauchern von Dienstleistungen und B√∂rsen: benachrichtigt den Eingang von Geldern, f√ºhrt den Austausch von Kryptow√§hrungen durch.  Die API wird mit dem Laravel-Framework geschrieben. <br><br>  <i>Der dritte Teil</i> ist das Erwerbsb√ºro f√ºr Verbraucher.  Es spiegelt den Zustand des Gesamtsystems, der verbundenen Geldb√∂rsen und ihrer Salden, aktiven Transaktionen und Konten wider.  Vielleicht verbinden wir bald die klassische Fiat-Akquisition.  Um ein B√ºro zu erstellen, haben wir Yii2 verwendet. <br><br>  Ein separater Block ist ein System f√ºr die Arbeit mit ICO-Projekten.  Sie k√∂nnen Token in allen Phasen des Verkaufs verteilen.  Dar√ºber hinaus besteht die M√∂glichkeit, einen Vertrag (ERC-20) und ein pers√∂nliches Konto zu entwickeln.  Mit diesen Tools bieten wir einen schl√ºsselfertigen ICO-Service. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a55/f8a/420/a55f8a42069d438bd4350ec1b9170d6a.png"><br><br>  Aus Sicherheitsgr√ºnden werden alle Daten zu Brieftaschen in verschl√ºsselter Form in der Datenbank gespeichert. Selbst wenn ein Angreifer Zugriff darauf erh√§lt, kann er kein Geld aus Brieftaschen abheben.  Die Zwei-Faktor-Benutzerauthentifizierung ist verbunden.  Schlie√ülich kann der H√§ndler eine Whitelist mit IP-Adressen erstellen, die mit der API zusammenarbeiten k√∂nnen. <br><br>  Wir bieten Systemfehlertoleranz f√ºr eine gro√üe Anzahl von Servern, einschlie√ülich Backup-Servern.  Jeder Blockchain-Knoten befindet sich auf einem separaten Server mit eingeschr√§nktem Zugriff von au√üen. <br><br><h2>  Auf welche Probleme sind wir gesto√üen? </h2><br>  Blockchains sind unterschiedlich.  Einige sind schlecht dokumentiert und haben keine aktive Community.  Dies war haupts√§chlich der Grund f√ºr unsere Hauptprobleme. <br><br>  <b>1. Die Ethereum-API kann keine Listen eingehender Kontotransaktionen zur√ºckgeben</b> <br><br>  Bei der Erstellung eines Kontos generiert unser Zahlungssystem eine eindeutige Adresse, an die der Benutzer einen bestimmten Betrag in der ausgew√§hlten W√§hrung √ºberweisen muss.  Mit einer bestimmten H√§ufigkeit erhalten wir eine Liste der eingehenden Transaktionen und √ºberpr√ºfen deren Brieftaschenadressen.  Dann √ºberpr√ºfen wir die Adressen der Brieftaschen mit den Adressen der nicht bezahlten Rechnungen.  Wie sich herausstellte, erlaubt die √úbertragung nicht den Empfang von Informationen √ºber eingehende Transaktionen. <br><br>  <i>Was zu tun ist?</i>  Wir haben uns entschieden, Transaktionen √ºber einen Drittanbieter-Service zu erhalten - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">etherscan.io</a> .  Da er jedoch einige Probleme aufgedeckt hat, wechseln wir zu Explorer, einem Dienst, der von unseren Programmierern geschrieben wurde. <br><br>  <b>2. Einige Blockchains sind √§u√üerst selten dokumentiert</b> <br><br>  Hier ist ein typischer Fall: Irgendwie haben wir einen Knoten f√ºr eine der wenig bekannten Kryptow√§hrungen bereitgestellt und nach einigen Tagen keine Transaktionen mehr akzeptiert, ohne dass Fehler gemeldet wurden.  Wir haben es neu gestartet, aber einige Tage sp√§ter wiederholte sich die Situation. <br><br>  <i>Was zu tun ist?</i>  Als sie anfingen, es herauszufinden, stellten sie fest, dass das Problem in einem der Parameter in der Konfigurationsdatei liegt.  In der Dokumentation gab es kein Wort zu diesem Parameter, daher musste ich alles durch Ausprobieren konfigurieren. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/278/407/ad7/278407ad73a6e58552c85444469fe6cc.png"><br><br>  <b>3. Die Bereitstellung einer privaten Blockchain zum Testen der Funktionalit√§t ist schwierig oder einfach unm√∂glich</b> <br><br>  Einmal mussten wir eine Blockchain f√ºr die NEO-Kryptow√§hrung bereitstellen.  Wir haben ein fertiges Docker-Image gefunden, alles gem√§√ü den Anweisungen ausgef√ºhrt und einen Fehler erhalten.  Eine schnelle Analyse der Skripte f√ºhrte zu nichts, Google forderte auch nichts auf. <br><br>  <i>Was zu tun ist?</i>  Wir haben ein Problem mit github erstellt, etwa einen Monat lang dar√ºber diskutiert und uns schlie√ülich f√ºr die Bereitstellung von testnet entschieden.  Aber nicht jede Kryptow√§hrung hat ein Testnetz.  Und wenn ja, m√ºssen Sie meistens einen Antrag auf Testm√ºnzen senden und eine Weile warten.  Die Entwicklung einer privaten Blockchain auf offiziellen Websites wird in den meisten F√§llen nicht einmal in Betracht gezogen, sodass Sie L√∂sungen von Drittanbietern verwenden m√ºssen. <br><br>  Fairerweise ist es erw√§hnenswert, dass Sie in den meisten F√§llen Antworten auf Fragen erhalten k√∂nnen, die sich auf die Infrastruktur einer bestimmten Kryptow√§hrung beziehen.  Die n√ºtzlichste Ressource in diesem Sinne ist Github. Dann sollten Sie zu den offiziellen Foren und zu Reddit gehen. <br><br>  <b>4. Unangemessene Wiederverwendung von Code</b> <br><br>  Bitcoin hat schlie√ülich viele Kopien mit einzelnen Blockchains und Bl√∂cken - verwechseln Sie sie nicht mit Gabeln.  In den meisten F√§llen haben solche Kryptow√§hrungen eine absolut identische Bitcoin-API.  Um nicht denselben Code zu multiplizieren, verwenden wir f√ºr die Arbeit mit solchen Kopien dieselbe Klasse wie f√ºr die Arbeit mit der W√§hrung von Satoshi Nakamoto. <br><br>  Aber es kann nicht so einfach sein.  Als wir Dogecoin integrieren mussten, folgten wir dem beschriebenen Szenario, konfigurierten und stellten testnet bereit.  Infolgedessen fielen einige Tests und es gab Probleme beim Erstellen von Transaktionen. <br><br>  <i>Was zu tun ist?</i>  Zuerst haben wir den Test durch den Debugger ausgef√ºhrt.  Es stellte sich heraus, dass Dogecoin in der Anforderung zum Erstellen einer Transaktion die √úbertragung des Betrags in Form einer Zeichenfolge nicht zul√§sst, wie dies bei Bitcoin der Fall ist.  Aus diesem Grund mussten wir die Methode in der untergeordneten Klasse neu definieren.  Dies ist √ºbrigens der einzige festgestellte Unterschied in den Dogecoin- und Bitcoin-APIs.  Was seine Bedeutung ist, ist unverst√§ndlich. <br><br>  <b>5. Nicht alle Kryptow√§hrungen erm√∂glichen die Generierung einer unbegrenzten Anzahl eindeutiger Adressen</b> <br><br>  Hier ist alles einfach: Ohne diese Generation k√∂nnen wir den Zahlungsausweis an der Adresse nicht verwenden. <br><br>  <i>Was zu tun ist?</i>  In solchen Situationen verwenden wir eine eindeutige Nachricht, die beim Senden der Zahlung an die Transaktion angeh√§ngt wird.  Leider vergessen einige Kunden, diese Nachrichten anzugeben, und fragen sich dann, warum die Zahlung nicht automatisch gutgeschrieben wurde. <br><br><h2>  Wie in CMS integrieren? </h2><br>  Wir haben B2BinPay-Plugins f√ºr WordPress, Woocommerce, Magento, PrestaShop erstellt.  Hier kam der Appetit mit dem Essen - urspr√ºnglich hatten wir nicht vor, das System durch Plugins f√ºr CMS zu bewerben.  F√ºr jedes Plugin haben wir eine √úberpr√ºfung im System durchgef√ºhrt.  Das Schlimmste ist f√ºr das Magento-Plugin passiert. Wir werden Ihnen mehr √ºber diesen Test erz√§hlen. <br><br>  Die √úberpr√ºfung gliedert sich in zwei Teile - Technik und Marketing.  Die technische Inspektion besteht aus vier Schritten: <br><br><ul><li>  Code-Schn√ºffler <br></li><li>  Installation &amp; Lacktest <br></li><li>  Kopieren Einf√ºgen Einf√ºgen Detektor <br></li><li>  Manuelle Qualit√§tssicherung <br></li></ul><br>  Die ersten drei Phasen sind vollst√§ndig automatisiert, daher ist es besser, einige Dinge in der Entwicklungsphase zu ber√ºcksichtigen.  Um Ihr Leben w√§hrend des Tests zu vereinfachen, m√ºssen Sie zun√§chst die Regeln f√ºr Code Sniffer beachten. <br><br>  Die Magento-Regeln f√ºr Code Sniffer entsprechen den Standards PSR-1 und PSR-2. Dies ist eines der wenigen CMS, dessen Entwickler moderne Entwicklungsans√§tze in PHP einhalten.  Dar√ºber hinaus haben die Mitarbeiter von Magento ein separates Regelwerk ver√∂ffentlicht, mit dessen Hilfe Fehler in den XML-Konfigurationen der Erweiterungsstruktur gefunden und die allgemein akzeptierten Pr√ºfungen erg√§nzt werden k√∂nnen.  Ein Skript zum √úberpr√ºfen des Inhalts des fertigen Pakets wird ebenfalls auf dessen Github-Konto ver√∂ffentlicht. Dieses Skript sollte auch verwendet werden, bevor Sie Ihre Entwicklung zur automatisierten √úberpr√ºfung senden. <br><br>  Die grundlegende Magento-Installation enth√§lt eine Bootstrap-Klasse f√ºr phpunit: Sie k√∂nnen damit Tests f√ºr Ihr Plugin schreiben.  Ehrlich gesagt haben wir immer noch nicht herausgefunden, ob die Verf√ºgbarkeit von Tests zum raschen Abschluss der technischen √úberpr√ºfung beitr√§gt. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b1b/cb5/134/b1bcb5134b3cd04941ba6f07096d7016.png"><br><br>  Die ersten drei Stufen der technischen Inspektion erfolgen automatisch.  F√ºr die vierte Phase und f√ºr die Marketing√ºberpr√ºfung m√ºssen Sie geduldig sein: Beide Prozesse werden von Personen ausgef√ºhrt, und aus diesem Grund werden Warteschlangen gebildet. <br><br>  Wir haben ungef√§hr 5 Tage auf die Ergebnisse der manuellen Qualit√§tssicherung gewartet, was im Grunde normal ist.  Jeder unserer Antr√§ge auf Marketing Review wurde jedoch seit mehr als einer Woche bearbeitet.  Hier war es f√ºr die Tester wichtig, dass wir in den ersten Abs√§tzen die Integration mit dem von uns angebotenen Service und dessen Preismodell aufschreiben und erst dann die Vorteile unseres Plugins angeben. <br><br><h2>  Zukunftspl√§ne </h2><br>  Wir glauben, dass sich B2BinPay im Hinblick auf die Interaktion mit Benutzern als recht einfach erwiesen hat und daher sowohl f√ºr neue Unternehmen auf dem Kryptomarkt als auch f√ºr fortgeschrittene Unternehmen - beispielsweise im Bereich des Online-Verkaufs - von Vorteil ist, wenn ein stabiles und sicheres Produkt ben√∂tigt wird. <br><br>  Zu Beginn des ersten Umlaufs von M√ºnzen akzeptierten wir Bitcoin, Bitcoin CASH, Litecoin, DASH, Ethereum, Monero und andere.  Jetzt bieten wir unter unserer estnischen Firma Dienstleistungen f√ºr H√§ndler und Geldb√∂rsen f√ºr Unternehmenskunden an, f√ºr die wir zwei Lizenzen erhalten haben - f√ºr den Austausch von Kryptow√§hrungen und f√ºr Geldb√∂rsen. <br><br>  Beim Einbinden von Kunden erstellen wir f√ºr jeden H√§ndler einen vollwertigen KYC. Danach kann der H√§ndler Kryptow√§hrungen akzeptieren, die automatisch in Dollar, Euro oder Pfund umgerechnet und auf das Bankkonto des H√§ndlers √ºberwiesen werden. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gerne</a> beantworten wir Ihre Fragen zur Erstellung von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">B2BinPay</a> und zum Produkt selbst im Prinzip.  Dar√ºber hinaus suchen wir jetzt aktiv nach Gleichgesinnten, die √ºber Python-Programmierkenntnisse verf√ºgen und bereit sind, sich unserem Team anzuschlie√üen.  Jetzt in St. Petersburg haben wir offene Stellen f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teamleiter</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Senior Developer er√∂ffnet</a> .  Wir freuen uns auf Ihren Lebenslauf! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de441338/">https://habr.com/ru/post/de441338/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de441328/index.html">√úber Quantencomputer und freien Willen</a></li>
<li><a href="../de441330/index.html">[Spoiler] Film Wandering Earth: Die Sonne st√ºrzt ab. Der chinesische und ein russischer Astronaut mit einer Flasche Wodka werden alle retten</a></li>
<li><a href="../de441332/index.html">Kolonie. Kapitel 26: Port Demetrio</a></li>
<li><a href="../de441334/index.html">"Elektrisches Personal" - jetzt definitiv</a></li>
<li><a href="../de441336/index.html">RTOS oder nicht RTOS ist die Frage</a></li>
<li><a href="../de441340/index.html">Das kulturelle Erbe Kasachstans in 3D-Modellen</a></li>
<li><a href="../de441344/index.html">Treten Sie in den Himmel. Eine ehrliche Geschichte √ºber eine ernsthafte Leidenschaft f√ºr das Fallschirmspringen</a></li>
<li><a href="../de441346/index.html">Treffen Sie einen Content-Strategen: Ein Interview mit Dmitry Kabanov, Kurator von Techstars Startup Digest und SXSW-Berater</a></li>
<li><a href="../de441348/index.html">Direktes Routing und Balancing mit NFT vs Nginx</a></li>
<li><a href="../de441350/index.html">Ist Haskell wirklich die Sprache der Genies und der Wissenschaft?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>