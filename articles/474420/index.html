<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíú üéê üôèüèæ Formaci√≥n del termostato: como sucedi√≥ üßóüèæ ü§òüèæ üï∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Despu√©s de varios a√±os de fruct√≠fero trabajo, se decidi√≥ llevar al p√∫blico nuestro primer producto de control clim√°tico en un hogar inteligente: un te...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Formaci√≥n del termostato: como sucedi√≥</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474420/"><img src="https://habrastorage.org/webt/hq/ic/rj/hqicrj2h1bv5ytdxhdsxlst1uv0.png"><br><br>  Despu√©s de varios a√±os de fruct√≠fero trabajo, se decidi√≥ llevar al p√∫blico nuestro primer producto de control clim√°tico en un hogar inteligente: un termostato inteligente para controlar un piso c√°lido. <br><a name="habracut"></a><br><h3>  ¬øQu√© es este dispositivo? </h3><br>  Este es un termostato inteligente para cualquier suelo radiante el√©ctrico de hasta 3kW.  Se controla a trav√©s de la aplicaci√≥n, p√°gina web, HTTP, MQTT, por lo que se integra f√°cilmente en todos los sistemas dom√©sticos inteligentes.  Para los m√°s populares, desarrollaremos complementos. <br><br>  Puede controlar no solo una calefacci√≥n el√©ctrica por suelo radiante, sino tambi√©n un cabezal t√©rmico en un piso calentado por agua, una caldera o una sauna el√©ctrica.  Adem√°s, usando nrf, el termostato podr√° comunicarse con varios sensores.  Casi todos los sensores relacionados con el clima est√°n actualmente en desarrollo.  Dado que el dispositivo est√° basado en ESP, decidimos que ser√≠a inapropiado seleccionar las opciones de personalizaci√≥n de los usuarios.  Por lo tanto, lo haremos para que el usuario pueda transferir el dispositivo al modo desarrollador e instalar otro firmware, por ejemplo, con soporte para HomeKit o proyectos de terceros. <br><br>  * Despu√©s de instalar firmware de terceros con soporte para HomeKit u otros proyectos populares, no es posible volver al original a trav√©s de OTA (Over-the-Air). <br><cut></cut><br><h3>  Las dificultades que encontramos </h3><br>  Decir que no estaban all√≠ ser√≠a una tonter√≠a.  Tratar√© de describir los problemas m√°s dif√≠ciles que aparecieron y c√≥mo los resolvimos. <br><br>  El recinto para el dispositivo fue un desaf√≠o.  Y el costo de los recursos y el costo del tiempo (desarrollado alrededor de un a√±o). <br><br>  Hab√≠a muchas opciones en el mercado.  Y el m√°s popular es la impresi√≥n 3D.  Vamos a estimar: <br>  Impresi√≥n 3D cl√°sica.  La calidad es pobre, la velocidad de producci√≥n tambi√©n.  Utilizamos la impresi√≥n 3D para prototipos, pero no era adecuada para la producci√≥n. <br><br>  Impresora 3D de fotopol√≠mero.  Aqu√≠ la calidad es muchas veces mejor, pero entra el efecto del precio.  Los prototipos impresos en una impresora similar, representaban unos 4000 rublos, y esta es una parte del cuerpo de dos.  Puede comprar su impresora, lo que reducir√° el precio, pero a√∫n as√≠ el precio ser√° el espacio, y la velocidad no es satisfactoria. <br><br>  Fundici√≥n de silicona.  Consideramos que esta es la mejor opci√≥n.  La calidad estaba en el nivel, el precio es alto, pero no cr√≠tico.  Incluso el primer lote se orden√≥ en 20 casos para ensayos de campo. <br><br>  Pero todo cambi√≥ el caso.  Una tarde, accidentalmente publiqu√© en un chat interno para desarrolladores que, con los casos como una jamba, el precio es alto.  Y al d√≠a siguiente, un colega escribi√≥ en un mensaje personal que el amigo de su amigo tiene TPA (m√°quina de termopl√°stico).  Y en la primera etapa, puedes hacer un molde para √©l.  Este mensaje ha cambiado todo! <br><br>  Ya hab√≠a considerado el uso de TPA, pero ni siquiera me detuvo la necesidad de pedir un lote de 5000 unidades como m√≠nimo (aunque si puede probarlo, puede encontrar menos a trav√©s de los chinos).  Me detuvo el precio de un molde.  Alrededor de $ 5000.  No estaba listo para establecer esta cantidad de una vez.  La cantidad del molde a trav√©s de nuestro colega reci√©n acu√±ado no fue c√≥smica, vari√≥ entre $ 2000 y $ 2500.  Adem√°s, fue a recibirnos y acordamos que el pago se realizar√° a plazos.  Entonces se resolvi√≥ el problema con los casos. <br><br>  La segunda e igualmente importante dificultad que encontramos es el hierro. <br><br>  No cuente la cantidad de revisiones de hierro.  Seg√∫n estimaciones conservadoras, la opci√≥n presentada es la s√©ptima, sin contar las intermedias.  En √©l, intentamos resolver todas las deficiencias identificadas en el proceso de prueba. <br><br>  Entonces, antes pens√© que no hab√≠a necesidad de un perro guardi√°n de hardware.  Ahora, sin √©l, el dispositivo no entrar√° en serie: debido al capricho de la plataforma que hemos elegido. <br>  Otra entrada anal√≥gica al ESP.  Anteriormente, pensaba que cada pin ESP es universal.  Pero ESP solo tiene un pin anal√≥gico.  Aprenda que esto sucedi√≥ en la pr√°ctica, lo que condujo a la alteraci√≥n y el reordenamiento de las placas de circuito impreso. <br><br>  <i>La primera versi√≥n de placas de circuito impreso.</i> <br><br><img src="https://habrastorage.org/webt/t-/hf/9n/t-hf9nry-pzvsm4shzy4fyta_kc.jpeg"><br><br><img src="https://habrastorage.org/webt/ok/d8/w7/okd8w7vazoijv851jztumvoj0w8.png"><br><br>  <i>La segunda versi√≥n de placas de circuito impreso.</i> <br><br><img src="https://habrastorage.org/webt/yf/c5/9c/yfc59crkqt9oclmawidome-mwm8.jpeg"><br><br><img src="https://habrastorage.org/webt/1o/wl/j0/1owlj0hbceqg4dbxcqsq94g43su.png"><br><br>  <i>La pen√∫ltima versi√≥n de placas de circuito impreso, donde tuve que resolver urgentemente problemas con el pin anal√≥gico</i> <br><br><img src="https://habrastorage.org/webt/hs/ka/q5/hskaq5caccyx6b9ws6fo8lwysh0.jpeg"><br><br><img src="https://habrastorage.org/webt/px/ek/hp/pxekhp2fjamqqcd3nk3oajbjc-8.jpeg"><br><br>  En cuanto al software, tambi√©n hubo un mont√≥n de trampas. <br><br>  Por ejemplo, roll-off peri√≥dico de ESP.  A pesar del hecho de que ping va a ella, la p√°gina no se abre.  Solo hay una soluci√≥n: reescribir la biblioteca.  Quiz√°s hay otros, pero todos los que intentamos no dieron resultado. <br><br>  El segundo problema importante, por extra√±o que parezca, es la cantidad de solicitudes a ESP al abrir una p√°gina.  Al usar GET o ajax, nos enfrentamos al hecho de que el n√∫mero de solicitudes se volvi√≥ indecentemente grande.  Debido a esto, el ESP se comport√≥ de manera impredecible, podr√≠a reiniciar o procesar la solicitud durante unos segundos.  La soluci√≥n fue cambiar a sockets web.  Despu√©s de eso, el n√∫mero de solicitudes ha disminuido significativamente. <br><br>  El tercer problema es la interfaz web.  M√°s informaci√≥n sobre √©l estar√° en un art√≠culo separado, que se publicar√° m√°s adelante. <br><br>  Por ahora, solo dir√© que la mejor opci√≥n en este momento es usar VUE.JS. <br><br>  Este marco es el m√°s adecuado de todos los que hemos probado. <br><br>  Las opciones de interfaz se pueden ver en los enlaces a continuaci√≥n. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">adaptive.lytko.com</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mobile.lytko.com</a> <br><br><h3>  La formaci√≥n del termostato </h3><br>  Una vez superadas todas las dificultades, llegamos al siguiente resultado: <br><br><img src="https://habrastorage.org/webt/1r/q5/ai/1rq5aidxmw2b4zsct8rl9y8lhim.png"><br><br><img src="https://habrastorage.org/webt/fj/t8/zd/fjt8zdyi7j829j1yr8w3hps1sna.png"><br><br>  <b>Construcci√≥n</b> <br><br>  El termostato consta de tres tableros (m√≥dulos): <br><br><ol><li>  Gerente; </li><li>  Gestionado </li><li>  Tablero de la exhibici√≥n </li></ol><br>  <b>La</b> placa de <b>control</b> es la placa en la que se encuentran ESP12, Hardware watchdog y nRF24 para trabajar con sensores futuros.  Al inicio, el dispositivo admite el sensor digital DS18B20.  Pero proporcionamos la capacidad de conectar sensores anal√≥gicos de fabricantes externos.  Y en una de las futuras actualizaciones de software del dispositivo, agregaremos la capacidad de usar sensores que vienen con termostatos de terceros. <br><br><img src="https://habrastorage.org/webt/nr/gf/vm/nrgfvmey1i1qjmiz5zuqbywn4i8.jpeg"><br><br>  <b>Gestionado</b> : placa de administraci√≥n de energ√≠a y carga.  Colocaron una fuente de alimentaci√≥n de 750 mA, terminales para conectar sensores de temperatura y rel√©s de 16 A para controlar la carga. <br><br><img src="https://habrastorage.org/webt/s4/ka/o-/s4kao-dmzluqeabuwu1g35kggsg.jpeg"><br><br>  <b>Pantalla</b> : en la etapa de desarrollo, seleccionamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la pantalla Nextion de</a> 2.4 pulgadas. <br><br>  Sobre √©l, puede encontrar f√°cilmente informaci√≥n en Internet.  Agregar√© por mi cuenta que es conveniente para casi todos, excepto el precio.  Una pantalla de 2.4 pulgadas cuesta alrededor de 1,200 rublos, lo que no afecta el precio final de la mejor manera. <br><br>  Entonces se decidi√≥ hacer un an√°logo a nuestras necesidades, pero con un precio m√°s bajo.  Es cierto que tendr√° que programarse de la manera cl√°sica, y no desde el entorno del Editor de Nextion.  Es m√°s dif√≠cil, pero estamos listos para ello. <br><br>  Un an√°logo ser√° una matriz de 2.4 pulgadas con una pantalla t√°ctil y una placa con STM32 a bordo para controlarlo y reducir la carga en el ESP12.  Todo el control ser√° similar a Nextion by UART, as√≠ como memoria de 32 MB y una tarjeta flash completa para grabar registros. <br><br>  El dise√±o modular facilita el cambio de uno de los m√≥dulos y la salida es un dispositivo completamente diferente. <br><br>  Por ejemplo, ya hay opciones para el "tablero 2" en varias versiones: <br><br><ul><li>  <b>Opci√≥n 1</b> - para calefacci√≥n por suelo radiante.  Fuente de alimentaci√≥n de 220v.  El rel√© controla cualquier carga despu√©s de s√≠ mismo. </li><li>  <b>Opci√≥n 2</b> : para calefacci√≥n de piso de agua o v√°lvula de bater√≠a.  Alimentado por 24V AC.  Control de v√°lvula 24v. </li><li>  <b>Opci√≥n 3</b> - alimentado por 220v.  Controlar una l√≠nea separada, como una caldera o sauna el√©ctrica. </li></ul><br><h3>  Ep√≠logo </h3><br>  No soy un desarrollador profesional.  Logr√© unir a las personas con un objetivo.  En su mayor parte, todos trabajan para la idea;  para hacer algo realmente valioso;  lo que ser√° √∫til para el usuario final. <br><br>  Estoy seguro de que a alguien no le gustar√° el dise√±o del caso;  alguien: la apariencia de la p√°gina.  Este es tu derecho!  Pero nosotros mismos hicimos todo este camino, a trav√©s de cr√≠ticas constantes de lo que estamos haciendo, y lo m√°s importante: por qu√©.  Si no hay preguntas como las anteriores, estaremos encantados de hablar en los comentarios. <br><br>  <b>La cr√≠tica constructiva es buena, y estamos agradecidos por ello.</b> <br><br>  La historia de la idea <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  Para los interesados: <br><br><ol><li>  Para todas las preguntas: grupo en Telegram <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">LytkoG</a> </li><li>  Siga las noticias: canal de noticias Telegram <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Lytko News</a> </li></ol><br>  Y s√≠, nos drogamos con lo que hacemos. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/474420/">https://habr.com/ru/post/474420/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../474404/index.html">An√°lisis de los problemas resueltos del campeonato de programaci√≥n de Yandex (desarrollo front-end) 2019</a></li>
<li><a href="../474406/index.html">La primera aparici√≥n de BlueKeep en la naturaleza registrada</a></li>
<li><a href="../474408/index.html">¬øRevoluci√≥n o evoluci√≥n del modelo de objeto de p√°gina?</a></li>
<li><a href="../474414/index.html">Escribimos nuestro propio motor voxel</a></li>
<li><a href="../474418/index.html">Conferencia 27 de DEFCON. Beneficios de los productos hacker para macOS. Parte 1</a></li>
<li><a href="../474422/index.html">Fascinantes plataformas de c√≥digo abierto para desarrollar aplicaciones m√≥viles</a></li>
<li><a href="../474424/index.html">Entrenamiento combinado: qu√© es y c√≥mo funciona</a></li>
<li><a href="../474426/index.html">La serie animada "C√≠rculo matem√°tico"</a></li>
<li><a href="../474430/index.html">DevOpsDays Moscow: una conferencia que la comunidad hace para la comunidad</a></li>
<li><a href="../474434/index.html">Propia bot de Telegram para rastrear el tiempo de actividad de sus servidores en Python y Docker</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>