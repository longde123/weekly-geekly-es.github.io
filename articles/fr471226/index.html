<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§æüèø üßïüèø üç≥ Linux a plusieurs visages: comment travailler sur n'importe quelle distribution üëáüèΩ üôåüèΩ üßùüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La cr√©ation d'une application de sauvegarde qui s'ex√©cute sur n'importe quelle distribution n'est pas une t√¢che facile. Pour vous assurer que Veeam Ag...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Linux a plusieurs visages: comment travailler sur n'importe quelle distribution</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/veeam/blog/471226/"><img src="https://habrastorage.org/webt/ry/zz/2e/ryzz2enp795e4whkxs9rgxbmwsm.jpeg"><br><br>  La cr√©ation d'une application de sauvegarde qui s'ex√©cute sur n'importe quelle distribution n'est pas une t√¢che facile.  Pour vous assurer que Veeam Agent pour Linux fonctionne sur les distributions de RHEL 6 et Debian 6, jusqu'√† openSUSE Leap 15.1 et Ubuntu 19.04, vous devez r√©soudre une s√©rie de probl√®mes, en particulier lorsque vous consid√©rez que le module du noyau fait partie du produit logiciel. <br><br>  Cet article est bas√© sur une pr√©sentation √† la conf√©rence <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LinuxPiter 2019</a> . <br><a name="habracut"></a><br>  Linux n'est pas seulement l'un des syst√®mes d'exploitation les plus populaires.  En fait, c'est une plate-forme sur la base de laquelle vous pouvez faire quelque chose d'unique, quelque chose de v√¥tre.  Pour cette raison, Linux a de nombreuses distributions qui diff√®rent dans un ensemble de composants logiciels.  Et le probl√®me se pose ici: pour que le produit logiciel fonctionne sur n'importe quelle distribution, vous devez prendre en compte les caract√©ristiques de chacune. <br><br><h2>  Gestionnaires de packages.  .deb vs .rpm </h2><br>  Commen√ßons par le probl√®me √©vident de la distribution du produit pour diff√©rentes distributions. <br>  La fa√ßon la plus courante de distribuer des produits logiciels est de placer le package dans le r√©f√©rentiel afin que le gestionnaire de packages int√©gr√© au syst√®me puisse l'installer √† partir de l√†. <br>  Cependant, nous avons deux formats de packages populaires: <i>rpm</i> et <i>deb</i> .  Donc, tout le monde devra soutenir. <br><br>  Dans le monde des packages deb, le niveau de compatibilit√© est incroyable.  Le m√™me paquet s'installe √©galement bien et fonctionne √† la fois sur Debian 6 et Ubuntu 19.04.  Les normes pour le processus de construction de paquets et leur utilisation, √©tablies dans les anciennes distributions Debian, restent pertinentes dans la nouvelle version de Linux Mint et du syst√®me d'exploitation √©l√©mentaire.  Par cons√©quent, dans le cas de Veeam Agent pour Linux, un package deb pour chaque plate-forme mat√©rielle est suffisant. <br><br>  Mais dans le monde des packages rpm, les diff√©rences sont grandes.  Tout d'abord, en raison du fait qu'il existe deux distributeurs compl√®tement ind√©pendants de Red Hat et SUSE, pour lesquels la compatibilit√© n'est absolument pas n√©cessaire.  Deuxi√®mement, ces distributeurs ont des distributions de ceux-ci.  support et exp√©rimental.  Entre eux, la compatibilit√© n'est pas non plus n√©cessaire.  Il s'est av√©r√© que pour el6, el7 et el8 leurs propres packages.  Paquet s√©par√© pour Fedora.  Packages pour SLES11 et 12 et s√©par√©s pour openSUSE.  Le probl√®me principal est les d√©pendances et les noms de package. <br><br><h2>  Probl√®me de d√©pendance </h2><br>  H√©las, les m√™mes packages se retrouvent souvent sous des noms diff√©rents dans des distributions diff√©rentes.  Vous trouverez ci-dessous une liste partielle des d√©pendances des packages veeam. <br><div class="scrollable-table"><table><tbody><tr><th>  Pour EL7: </th><th>  Pour SLES 12: </th></tr><tr><td><ul><li>  libblkid </li><li>  libgcc </li><li>  libstdc ++ </li><li>  ncurses-libs </li><li>  Fuse-libs </li><li>  biblioth√®ques de fichiers </li><li>  veeamsnap = 3.0.2.1185 </li></ul></td><td><ul><li>  libblkid1 </li><li>  libgcc_s1 </li><li>  libstdc ++ 6 </li><li>  libmagic1 </li><li>  libfuse2 </li><li>  veeamsnap-kmp = 3.0.2.1185 </li></ul></td></tr></tbody></table></div><br>  Par cons√©quent, la liste des d√©pendances est unique √† la distribution. <br><br>  Cela empire lorsqu'une version mise √† jour commence √† se cacher sous l'ancien nom du package. <br><br>  <b>Un exemple:</b> <br><br>  Fedora 24 a mis √† jour le package <i>ncurses</i> de la version 5 √† la version 6. Notre produit a √©t√© construit avec la version 5 afin d'assurer la compatibilit√© avec les anciennes distributions.  Pour utiliser l'ancienne 5e version de la biblioth√®que sur Fedora 24, j'ai d√ª utiliser le paquet <i>ncurses-compat-libs</i> . <br><br>  Par cons√©quent, deux packages apparaissent pour Fedora, avec des d√©pendances diff√©rentes. <br><br>  Plus int√©ressant.  Apr√®s la prochaine mise √† jour du package de distribution, le package <i>ncurses-compat-libs</i> avec la 5e version de la biblioth√®que n'est pas disponible.  Il n'est pas rentable pour un distributeur d'extraire d'anciennes biblioth√®ques dans une nouvelle version de distribution.  Apr√®s un certain temps, le probl√®me a √©t√© r√©p√©t√© dans les distributions SUSE. <br><br>  Par cons√©quent, pour certaines distributions, j'ai d√ª abandonner la d√©pendance explicite de <i>ncurses-libs</i> et corriger le produit afin qu'il puisse fonctionner avec n'importe quelle version de la biblioth√®que. <br><br>  Soit dit en passant, dans la 8e version de Red Hat, il n'y a plus de m√©ta-package <i>python qui</i> faisait r√©f√©rence au bon vieux <i>python 2.7</i> .  Il existe <i>python2</i> et <i>python</i> 3. <br><br><h2>  Alternative aux gestionnaires de packages </h2><br>  Le probl√®me des d√©pendances est ancien et √©vident depuis longtemps.  Rappelez-vous juste l'enfer de la d√©pendance. <br>  Combinez diff√©rentes biblioth√®ques et applications afin qu'elles fonctionnent toutes de mani√®re stable et n'entrent pas en conflit - en fait, tout distributeur Linux essaie de r√©soudre ce probl√®me. <br><br>  Le gestionnaire de paquets canonique <b>Snappy</b> essaie de r√©soudre ce probl√®me de mani√®re tr√®s diff√©rente.  L'id√©e principale: l'application s'ex√©cute dans un bac √† sable isol√© et prot√©g√© du syst√®me principal.  Si l'application a besoin de biblioth√®ques, elles sont livr√©es avec l'application elle-m√™me. <br><br>  <b>Flatpak</b> vous permet √©galement d'ex√©cuter des applications dans le bac √† sable √† l'aide de conteneurs Linux.  Il existe √©galement <b>AppImage</b> , qui vous permet de cr√©er des images portables de programmes. <br><br>  Ces solutions vous permettent de cr√©er un package pour toutes les distributions.  Dans le cas de <b>Flatpak</b> et <b>AppImage, l'</b> installation et le lancement de l'application sont possibles m√™me √† l'insu de l'administrateur. <br><br>  Le probl√®me principal est que toutes les applications ne peuvent pas s'ex√©cuter dans le bac √† sable et sans privil√®ges <i>root</i> .  Certains ont besoin d'un acc√®s direct √† la plateforme.  Je ne parle pas des modules du noyau, qui d√©pendent fortement du noyau et ne rentrent pas dans le concept du bac √† sable. <br><br>  Le deuxi√®me probl√®me est que les distributions populaires de Red Hat et SUSE dans l'environnement d'entreprise ne prennent pas encore en charge Snappy et Flatpak. <br><br>  √Ä cet √©gard, Veeam Agent pour Linux n'est ni sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">snapcraft.io</a> ni sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">flathub.org</a> . <br><br>  √Ä la fin de la question sur les gestionnaires de packages, je note qu'il existe une option pour abandonner compl√®tement les gestionnaires de packages en combinant des fichiers binaires et un script pour les installer dans un package. <br><br>  Un tel ensemble vous permet de cr√©er un package commun pour diff√©rentes distributions et plates-formes, d'effectuer un processus d'installation interactif, en effectuant la personnalisation n√©cessaire.  Je suis tomb√© sur de tels packages pour Linux uniquement √† partir de VMware. <br><br><h2>  Probl√®me de mise √† jour </h2><br><img src="https://habrastorage.org/webt/ny/8c/-k/ny8c-kdpc74mgrym0nszgkd0d04.png"><br>  M√™me si tous les probl√®mes de d√©pendance sont r√©solus, le programme peut fonctionner diff√©remment sur la m√™me distribution.  Le point est dans les mises √† jour. <br><br>  Il existe 3 strat√©gies de mise √† niveau: <br><br><ul><li>  Le plus simple est de ne jamais mettre √† jour.  Configur√© le serveur et oubli√©.  Pourquoi les mises √† jour si tout fonctionne?  Les probl√®mes commencent la premi√®re fois que vous contactez l'assistance.  Le cr√©ateur de la distribution ne prend en charge qu'une version mise √† jour. </li><li>  Vous pouvez faire confiance au distributeur et configurer des mises √† jour automatiques.  Dans ce cas, un appel au support est probable imm√©diatement apr√®s une mise √† jour infructueuse. </li><li>  L'option de mise √† jour manuelle uniquement apr√®s l'avoir ex√©cut√©e sur l'infrastructure de test est la plus fid√®le, mais co√ªteuse et longue.  Tout le monde n'est pas en mesure de se le permettre. </li></ul><br>  √âtant donn√© que diff√©rents utilisateurs utilisent diff√©rentes strat√©gies de mise √† jour, vous devez prendre en charge la derni√®re version et toutes les versions pr√©c√©dentes.  Cela complique le processus de d√©veloppement et le processus de test ajoute un casse-t√™te au service de support. <br><br><h2>  Vari√©t√© de plates-formes mat√©rielles </h2><br>  Diverses plates-formes mat√©rielles sont un probl√®me largement sp√©cifique au code natif.  Au minimum, vous devez collecter des fichiers binaires pour chaque plate-forme prise en charge. <br><br>  Dans le projet Veeam Agent pour Linux, nous ne pouvons toujours pas prendre en charge au moins quelque chose comme RISC. <br><br>  Je ne m'attarderai pas sur cette question en d√©tail.  Je ne d√©crirai que les principaux probl√®mes: les types d√©pendants de la plate-forme tels que <code>size_t</code> , l'alignement des structures et l'ordre des octets. <br><br><h2>  Liaison statique et / ou dynamique </h2><br><img src="https://habrastorage.org/webt/x7/im/9v/x7im9v9gtvi7lkwmodbajd0au_g.jpeg"><br>  Et voici la question ¬´Comment √©tablir un lien avec les biblioth√®ques - dynamiquement ou statiquement?¬ª  m√©rite d'√™tre discut√©. <br><br>  En r√®gle g√©n√©rale, les applications Linux C / C ++ utilisent la liaison dynamique.  Cela fonctionne tr√®s bien si l'application est con√ßue sp√©cifiquement pour une distribution sp√©cifique. <br><br>  Si la t√¢che consiste √† couvrir une vari√©t√© de distributions avec un fichier binaire, vous devez vous concentrer sur la distribution prise en charge la plus ancienne.  Pour nous, il s'agit de Red Hat 6. Il contient gcc 4.4, que m√™me la norme C ++ 11 ne prend pas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">enti√®rement en</a> charge. <br><br>  Nous construisons notre projet en utilisant gcc 6.3, qui prend enti√®rement en charge C ++ 14.  Naturellement, dans ce cas sur Red Hat 6, la biblioth√®que libstdc ++ et boost doit √™tre tra√Æn√©e.  Le moyen le plus simple de les lier est statiquement. <br><br>  Mais h√©las, toutes les biblioth√®ques ne peuvent pas √™tre li√©es statiquement. <br><br>  Tout d'abord, les biblioth√®ques syst√®me, telles que <i>libfuse</i> , <i>libblkid,</i> doivent √™tre li√©es dynamiquement pour s'assurer qu'elles sont compatibles avec le noyau et ses modules. <br><br>  Deuxi√®mement, il y a une subtilit√© avec les licences. <br><br>  La licence GPL permet essentiellement de lier des biblioth√®ques uniquement avec du code opensource.  MIT et BSD permettent la liaison statique et permettent aux biblioth√®ques d'√™tre incluses dans le projet.  Mais LGPL ne semble pas contredire la liaison statique, mais n√©cessite le partage des fichiers n√©cessaires √† la liaison. <br><br>  En g√©n√©ral, l'utilisation de la liaison dynamique prot√©gera contre la n√©cessit√© de fournir quelque chose. <br><br><h2>  Cr√©ation d'applications C / C ++ </h2><br>  Pour cr√©er des applications C / C ++ pour diff√©rentes plates-formes et distributions, il suffit de s√©lectionner ou de compiler une version appropri√©e de gcc et d'utiliser des compilateurs crois√©s pour des architectures sp√©cifiques, afin de collecter l'ensemble complet des biblioth√®ques.  Ce travail est tout √† fait r√©alisable, mais plut√¥t g√™nant.  Et il n'y a aucune garantie que le compilateur et les biblioth√®ques s√©lectionn√©s fourniront une option viable. <br><br>  Un plus √©vident: l'infrastructure est grandement simplifi√©e, car l'ensemble du processus d'assemblage peut √™tre effectu√© sur une seule machine.  De plus, il suffit de collecter un ensemble de fichiers binaires pour une architecture et vous pouvez les regrouper dans des packages pour diff√©rentes distributions.  C'est ainsi que les packages veeam pour Veeam Agent pour Linux sont construits. <br><br>  Contrairement √† cette option, vous pouvez simplement pr√©parer la ferme de g√©n√©ration, c'est-√†-dire plusieurs machines pour l'assemblage.  Chacune de ces machines fournira la compilation de l'application et l'assemblage du package pour une distribution particuli√®re et une architecture sp√©cifique.  Dans ce cas, la compilation est effectu√©e par les moyens que le distributeur a pr√©par√©s.  Autrement dit, l'√©tape de pr√©paration du compilateur et la s√©lection des biblioth√®ques ne sont plus n√©cessaires.  De plus, le processus d'assemblage peut √™tre facilement parall√©lis√©. <br><br>  Il y a cependant un inconv√©nient √† cette approche: pour chaque distribution dans la m√™me architecture, vous devrez assembler votre propre ensemble de fichiers binaires.  Un autre inconv√©nient est que de nombreuses machines doivent √™tre maintenues pour allouer une grande quantit√© d'espace disque et de RAM. <br><br>  Ainsi, les packages KMOD du module de noyau veeamsnap pour les distributions Red Hat sont collect√©s. <br><br><h2>  Service de construction ouvert </h2><br>  Les coll√®gues de SUSE ont essay√© d'impl√©menter un terrain d'entente en tant que service sp√©cial pour la compilation d'applications et la construction de packages - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">openbuildservice</a> . <br><br>  En substance, c'est un hyperviseur qui cr√©e une machine virtuelle, y installe tous les packages n√©cessaires, compile l'application et compile le package dans cet environnement isol√©, apr√®s quoi une telle machine virtuelle est lib√©r√©e. <br><br><img src="https://habrastorage.org/webt/y0/4p/uy/y04puyokz_w-fexue3zcgpvhcgc.png"><br><br>  Le planificateur impl√©ment√© dans OpenBuildService d√©terminera le nombre de machines virtuelles qu'il peut ex√©cuter pour la vitesse de g√©n√©ration de package optimale.  Le m√©canisme de signature int√©gr√© lui-m√™me signera les packages et les placera dans le r√©f√©rentiel int√©gr√©.  Le syst√®me de contr√¥le de version int√©gr√© enregistre l'historique des modifications et des assemblages.  Reste √† ajouter simplement votre code source √† ce syst√®me.  M√™me le serveur lui-m√™me n'est pas n√©cessaire d'augmenter, mais vous pouvez utiliser celui ouvert. <br><br>  Ici, cependant, il y a un probl√®me: une telle moissonneuse-batteuse est difficile √† int√©grer dans l'infrastructure existante.  Par exemple, le contr√¥le de version n'est pas n√©cessaire, nous avons d√©j√† le n√¥tre pour les sources.  Le m√©canisme de signature est diff√©rent: un serveur sp√©cial est utilis√©.  Le r√©f√©rentiel n'est √©galement pas n√©cessaire. <br><br>  De plus, la prise en charge d'autres distributions - par exemple, Red Hat - est impl√©ment√©e assez mal, ce qui est compr√©hensible. <br><br>  L'avantage de ce service est la prise en charge rapide de la prochaine version de la distribution SUSE.  Avant l'annonce officielle de la version, les packages requis pour l'assemblage sont t√©l√©charg√©s dans le r√©f√©rentiel public.  Une nouvelle appara√Æt dans la liste des distributions disponibles sur OpenBuildService.  Nous mettons une coche et elle est ajout√©e au plan de montage.  Ainsi, l'ajout d'une nouvelle version de la distribution s'effectue en presque un clic. <br><br>  Dans notre infrastructure, en utilisant OpenBuildService, nous assemblons toute la vari√©t√© des packages KMP du module de noyau veeamsnap pour les distributions SUSE. <br><br>  De plus, je voudrais m'attarder sur les probl√®mes sp√©cifiques aux modules du noyau. <br><br><h2>  noyau ABI </h2><br>  Historiquement, les modules du noyau Linux ont √©t√© distribu√©s sous forme source.  Le fait est que les cr√©ateurs du noyau ne se p√®sent pas sur le soin de maintenir une API stable pour les modules du noyau, et encore plus au niveau binaire, puis kABI. <br><br>  Pour construire un module pour le noyau vanilla, les en-t√™tes de ce noyau particulier sont requis, et cela ne fonctionnera que sur ce noyau. <br><br>  DKMS vous permet d'automatiser le processus d'assemblage des modules lors de la mise √† jour du noyau.  En cons√©quence, les utilisateurs du r√©f√©rentiel Debian (et ses nombreux parents) utilisent des modules du noyau soit √† partir du r√©f√©rentiel de distribution, soit assembl√©s √† partir des sources √† l'aide de DKMS. <br><br>  Cependant, cette situation n'est pas particuli√®rement confortable avec le segment Entreprise.  Les distributeurs de code propri√©taires souhaitent distribuer le produit sous forme de binaires compil√©s. <br><br>  Les administrateurs ne souhaitent pas conserver les outils de d√©veloppement sur les serveurs de production pour des raisons de s√©curit√©.  Les distributeurs Enterprise Linux - tels que Red Hat et SUSE - ont d√©cid√© qu'ils pouvaient maintenir un kABI stable pour leurs utilisateurs.  En cons√©quence, les packages KMOD pour Red Hat et les packages KMP pour SUSE sont apparus. <br><br>  L'essence de cette solution est assez simple.  L'API du noyau est gel√©e pour une version sp√©cifique de la distribution.  Le distributeur d√©clare qu'il utilise le noyau, par exemple, 3.10, et n'apporte que des corrections et am√©liorations qui n'affectent en aucune fa√ßon les interfaces du noyau, et les modules assembl√©s pour le tout premier noyau peuvent √™tre utilis√©s pour tous les suivants sans recompilation. <br><br>  Red Hat annonce la compatibilit√© kABI pour la distribution tout au long du cycle de vie.  Autrement dit, le module assembl√© pour rhel 6.0 (version de novembre 2010) devrait √©galement fonctionner sur la version 6.10 (version de juin 2018).  Et cela fait presque 8 ans.  Naturellement, la t√¢che est plut√¥t compliqu√©e. <br>  Nous avons enregistr√© plusieurs cas o√π, en raison de probl√®mes de compatibilit√© kABI, le module veeamsnap a cess√© de fonctionner. <br><br>  Apr√®s que le module veeamsnap compil√© pour RHEL 7.0 se soit av√©r√© incompatible avec le noyau de RHEL 7.5, mais qu'il a charg√© et garanti l'abandon du serveur, nous avons refus√© d'utiliser la compatibilit√© kABI pour RHEL 7 en g√©n√©ral. <br><br>  Actuellement, le package KMOD pour RHEL 7 contient un assembly pour chaque version et un script qui fournit le chargement du module. <br><br>  SUSE a abord√© la t√¢che de compatibilit√© kABI plus attentivement.  Ils offrent la compatibilit√© kABI dans un seul service pack. <br><br>  Par exemple, la sortie de SLES 12 a eu lieu en septembre 2014. Et SLES 12 SP1 est d√©j√† en d√©cembre 2015, c'est-√†-dire qu'un peu plus d'un an s'est √©coul√©.  Bien que les deux versions utilisent le noyau 3.12, elles ne sont pas compatibles avec kABI.  De toute √©vidence, le maintien de la compatibilit√© kABI pendant un an est beaucoup plus facile.  Le cycle annuel de mise √† jour des modules de base ne devrait pas poser de probl√®mes aux cr√©ateurs des modules. <br><br>  Gr√¢ce √† cette politique SUSE, nous n'avons r√©solu aucun probl√®me de compatibilit√© kABI dans notre module veeamsnap.  Certes, le nombre de packages pour SUSE est presque un ordre de grandeur plus grand. <br><br><h2>  Patches et backports </h2><br>  Malgr√© le fait que les distributeurs tentent d'assurer la compatibilit√© kABI et la stabilit√© du noyau, ils essaient √©galement d'am√©liorer les performances et d'√©liminer les d√©fauts de ce noyau stable. <br><br>  De plus, en plus de leur propre ¬´travail sur les erreurs¬ª, les d√©veloppeurs du noyau Linux d'entreprise suivent les changements dans le noyau vanilla et les transf√®rent dans leur noyau ¬´stable¬ª. <br><br>  Parfois, cela conduit √† de nouvelles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">erreurs</a> . <br><br>  La derni√®re version de Red Hat 6 a fait une erreur dans l'une des mises √† jour mineures.  Cela a conduit au fait que le module veeamsnap √©tait garanti de planter le syst√®me lorsque l'instantan√© a √©t√© publi√©.  En comparant les sources du noyau avant et apr√®s la mise √† jour, nous avons d√©couvert que le backport √©tait √† bl√¢mer.  Un correctif similaire a √©t√© fait dans la version 4.19 du noyau vanilla.  Mais seulement dans le noyau vanilla, ce correctif a bien fonctionn√©, et lors du transfert vers la version "stable" 2.6.32, il y avait un probl√®me avec spin-lock. <br><br>  Bien s√ªr, tout le monde a toujours des erreurs, mais cela valait-il la peine de faire glisser le code de 4.19 √† 2.6.32, risquant de compromettre la stabilit√©? .. Je ne suis pas s√ªr ... <br><br>  Pire encore, lorsque le marketing est li√© au remorqueur de la guerre, la ¬´stabilit√©¬ª &lt;-&gt; ¬´la modernisation¬ª.  Le d√©partement marketing a besoin que le c≈ìur de la distribution mise √† jour soit stable, d'une part, et en m√™me temps meilleur en performance et dot√© de nouvelles fonctionnalit√©s.  Cela conduit √† d'√©tranges compromis. <br><br>  Lorsque j'ai essay√© de construire un module sur le noyau 4.4 de SLES 12 SP3, j'ai √©t√© surpris d'y trouver des fonctionnalit√©s de vanilla 4.8.  √Ä mon avis, l'impl√©mentation d'E / S de bloc du noyau 4.4 de SLES 12 SP3 ressemble plus √† un noyau 4.8 que la version pr√©c√©dente du noyau 4.4 stable de SLES12 SP2.  Je ne peux pas juger quel pourcentage de code a √©t√© transf√©r√© du noyau 4.8 vers SLES 4.4 pour SP3, mais je n'ai toujours pas la possibilit√© d'appeler le noyau le m√™me 4.4 stable. <br><br>  La chose la plus d√©sagr√©able √† ce sujet est que lorsque vous √©crivez un module qui fonctionne aussi bien sur diff√©rents c≈ìurs, vous ne pouvez plus compter sur la version du noyau.  Nous devons √©galement prendre en compte la distribution.  Il est bon que parfois vous puissiez vous impliquer dans une d√©finition qui appara√Æt avec de nouvelles fonctionnalit√©s, mais cette fonctionnalit√© n'appara√Æt pas toujours. <br><br>  Par cons√©quent, le code est entour√© de directives sophistiqu√©es pour la compilation conditionnelle. <br><br>  Il existe √©galement des correctifs qui modifient l'API du noyau document√©e. <br>  Je suis tomb√© sur un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">kit de</a> distribution <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">KDE n√©on</a> 5.16 et j'ai √©t√© tr√®s surpris de voir que l'appel lookup_bdev dans cette version du noyau a chang√© la liste des param√®tres d'entr√©e. <br><br>  Pour se r√©unir, nous avons d√ª ajouter un script dans le makefile qui v√©rifie si la fonction lookup_bdev a un param√®tre de masque. <br><br><h2>  Signature des modules du noyau </h2><br>  Mais revenons √† la question de la distribution des packages. <br><br>  L'un des avantages de kABI stable est que les modules du noyau peuvent √™tre sign√©s en tant que fichier binaire.  Dans ce cas, le d√©veloppeur peut √™tre s√ªr que le module n'a pas √©t√© accidentellement endommag√© ou modifi√© intentionnellement.  Vous pouvez le v√©rifier avec la commande modinfo. <br><br>  Les distributions Red Hat et SUSE vous permettent de v√©rifier la signature d'un module et de le t√©l√©charger uniquement si le certificat appropri√© est enregistr√© dans le syst√®me.  Le certificat est la cl√© publique par laquelle le module est sign√©.  Nous le distribuons dans un package s√©par√©. <br><br>  Le probl√®me ici est que les certificats peuvent √™tre int√©gr√©s au noyau (ils sont utilis√©s par les distributeurs) ou doivent √™tre √©crits dans une m√©moire EFI non volatile √† l'aide de l'utilitaire <i>mokutil</i> .  Lors de l'installation du certificat, l'utilitaire <i>mokutil</i> n√©cessite un red√©marrage du syst√®me et m√™me avant le chargement du noyau du syst√®me d'exploitation, il propose √† l'administrateur d'autoriser le t√©l√©chargement du nouveau certificat. <br><br>  Ainsi, l'ajout d'un certificat n√©cessite un acc√®s physique administrateur au syst√®me.  Si la machine est situ√©e quelque part dans le cloud ou juste dans une salle de serveurs distante et que l'acc√®s se fait uniquement via le r√©seau (par exemple, via ssh), il sera impossible d'ajouter un certificat. <br><br><h2>  EFI sur les machines virtuelles </h2><br>  Malgr√© le fait que EFI a longtemps √©t√© pris en charge par presque tous les cr√©ateurs de la carte m√®re, lors de l'installation du syst√®me, l'administrateur peut ne pas penser au besoin d'EFI, et il peut √™tre d√©sactiv√©. <br><br>  Tous les hyperviseurs ne prennent pas en charge EFI.  VMWare vSphere prend en charge EFI depuis la version 5. <br>  Microsoft Hyper-V a √©galement re√ßu la prise en charge EFI, √† commencer par Hyper-V pour Windows Server 2012R2. <br><br>  Cependant, dans la configuration par d√©faut, cette fonctionnalit√© est d√©sactiv√©e pour les machines Linux, ce qui signifie que le certificat ne peut pas √™tre install√©. <br><br>  Dans vSphere 6.5, vous pouvez d√©finir l'option <b>Secure Boot</b> uniquement dans l'ancienne version de l'interface Web qui fonctionne via Flash.  L'interface utilisateur Web sur HTML-5 est loin derri√®re. <br><br><h2>  Distributions exp√©rimentales </h2><br>  Et enfin, consid√©rons la question des distributions exp√©rimentales et des distributions sans support officiel.  D'une part, de telles distributions sont peu susceptibles d'√™tre trouv√©es sur les serveurs d'organisations s√©rieuses.  Il n'y a pas de support officiel pour de telles distributions.  Par cons√©quent, pour les fournir.  le support produit sur une telle distribution n'est pas possible. <br><br>  Cependant, ces distributions deviennent une plate-forme pratique pour tester de nouvelles solutions exp√©rimentales.  Par exemple, Fedora, OpenSUSE Tumbleweed ou la version instable de Debian.  Ils sont assez stables.  Ils ont toujours de nouvelles versions de programmes et toujours un nouveau noyau.  Apr√®s un an, cette fonctionnalit√© exp√©rimentale peut √™tre dans la mise √† jour RHEL, SLES ou Ubuntu. <br><br>  Donc, si quelque chose ne fonctionne pas sur le kit de distribution exp√©rimental, c'est l'occasion de trier le probl√®me et de le r√©soudre.  Vous devez √™tre pr√©par√© au fait que cette fonctionnalit√© appara√Ætra bient√¥t sur les serveurs de production des utilisateurs. <br><br>  La liste actuelle des distributions officiellement prises en charge pour la version 3.0 se trouve <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Mais la v√©ritable liste des distributions sur lesquelles notre produit est capable de fonctionner est beaucoup plus large. <br><br>  Personnellement, j'√©tais int√©ress√© par une exp√©rience avec le syst√®me d'exploitation Elbrus.  Apr√®s la mise √† jour du package veeam, notre produit a √©t√© install√© et gagn√©.  √Ä propos de cette exp√©rience, j'ai √©crit sur Habr√© dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> . <br><br>  Eh bien, le support des nouvelles distributions continue.  Nous attendons la sortie de la version 4.0.  La b√™ta est sur le point d'appara√Ætre, alors restez √† l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">aff√ªt des nouveaut√©s</a> ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr471226/">https://habr.com/ru/post/fr471226/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr471210/index.html">Dieu ... Ballade sur un programmeur</a></li>
<li><a href="../fr471212/index.html">10 trucs et astuces pour vous aider √† devenir le meilleur d√©veloppeur sur VueJS</a></li>
<li><a href="../fr471216/index.html">La longue histoire du guide - comment j'ai √©crit un service pour des sentiers de randonn√©e intelligents pendant 5 ans</a></li>
<li><a href="../fr471220/index.html">Cockpit - simplifiez les t√¢ches administratives typiques sous Linux gr√¢ce √† une interface Web pratique</a></li>
<li><a href="../fr471222/index.html">La compr√©hension des politiques de confidentialit√© des applications et des services aidera les r√©seaux de neurones</a></li>
<li><a href="../fr471228/index.html">Grokay PyTorch</a></li>
<li><a href="../fr471232/index.html">Mon exp√©rience de connexion du LPS331AP √† Omega Onion2</a></li>
<li><a href="../fr471236/index.html">Dosim√®tre pour Seryozha. Partie III. Radiom√®tre national</a></li>
<li><a href="../fr471240/index.html">¬´Bitchy Betty¬ª et interfaces audio modernes: pourquoi parlent-elles d'une voix f√©minine?</a></li>
<li><a href="../fr471242/index.html">Introduction √† Bash Shell</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>