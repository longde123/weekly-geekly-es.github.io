<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ¼â€ğŸ’¼ ğŸ¤² ğŸ’­ æ˜¾å¾®é•œä¸‹çš„Django ğŸ‘± ğŸ–•ğŸ¾ ğŸ¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¦‚æœæ ¹æ®Artyom Malyshevï¼ˆ proofit404 ï¼‰çš„æŠ¥å‘Šæ‹æ‘„ç”µå½±ï¼Œé‚£ä¹ˆå¯¼æ¼”å°†æ˜¯Quentin Tarantino-ä»–å·²ç»åˆ¶ä½œäº†ä¸€éƒ¨å…³äºDjangoçš„ç”µå½±ï¼Œä»–è¿˜å°†æ‹æ‘„ç¬¬äºŒéƒ¨ç”µå½±ã€‚ Djangoå†…éƒ¨æœºåˆ¶ç”Ÿå‘½å‘¨æœŸä¸­çš„æ‰€æœ‰è¯¦ç»†ä¿¡æ¯ï¼Œä»HTTPè¯·æ±‚çš„ç¬¬ä¸€ä¸ªå­—èŠ‚åˆ°å“åº”çš„æœ€åä¸€ä¸ªå­—èŠ‚ã€‚ è§£æå™¨å½¢å¼...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>æ˜¾å¾®é•œä¸‹çš„Django</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/433482/"> å¦‚æœæ ¹æ®Artyom Malyshevï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">proofit404</a> ï¼‰çš„æŠ¥å‘Šæ‹æ‘„ç”µå½±ï¼Œé‚£ä¹ˆå¯¼æ¼”å°†æ˜¯Quentin Tarantino-ä»–å·²ç»åˆ¶ä½œäº†ä¸€éƒ¨å…³äºDjangoçš„ç”µå½±ï¼Œä»–è¿˜å°†æ‹æ‘„ç¬¬äºŒéƒ¨ç”µå½±ã€‚  Djangoå†…éƒ¨æœºåˆ¶ç”Ÿå‘½å‘¨æœŸä¸­çš„æ‰€æœ‰è¯¦ç»†ä¿¡æ¯ï¼Œä»HTTPè¯·æ±‚çš„ç¬¬ä¸€ä¸ªå­—èŠ‚åˆ°å“åº”çš„æœ€åä¸€ä¸ªå­—èŠ‚ã€‚ è§£æå™¨å½¢å¼ï¼ŒSQLçš„æ‰“åŒ…æ“ä½œï¼ŒHTMLæ¨¡æ¿å¼•æ“çš„å®ç°çš„ç‰¹æ®Šæ•ˆæœã€‚ è°åœ¨ç®¡ç†è¿æ¥æ± ï¼Œå¦‚ä½•ç®¡ç†ï¼Ÿ æ‰€æœ‰è¿™äº›éƒ½æŒ‰æ—¶é—´é¡ºåºå¤„ç†WSGIå¯¹è±¡ã€‚ åœ¨è¯¥å›½çš„æ‰€æœ‰å±å¹•ä¸Š-è§£ç â€œæ˜¾å¾®é•œä¸‹çš„Djangoâ€ã€‚ <br><br><img src="https://habrastorage.org/webt/np/fq/rq/npfqrqbbgfwn2lktbgdq9h4xhgg.jpeg"><br><br>  <strong>å…³äºæ¼”è®²è€…ï¼šArtyom Malyshev</strong>æ˜¯Dry Pythoné¡¹ç›®çš„åˆ›å§‹äººï¼Œä¹Ÿæ˜¯Django Channels 1.0ç‰ˆçš„æ ¸å¿ƒå¼€å‘äººå‘˜ã€‚ ä»–ä»äº‹Pythonå·²æœ‰5å¹´çš„å†å²ï¼Œå¹¶æ›¾å¸®åŠ©åœ¨ä¸‹è¯ºå¤«å“¥ç½—å¾·ç»„ç»‡Python Ranntsä¼šè®®ã€‚ æ‚¨å¯èƒ½å¯¹Artyomå¾ˆç†Ÿæ‚‰ï¼Œç»°å·ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">PROOFIT404</a> ã€‚ æŠ¥å‘Šçš„æ¼”ç¤ºå­˜å‚¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨æ­¤å¤„</a> ã€‚ <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/AvGl7Vi2yT4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> æ›¾å‡ ä½•æ—¶ï¼Œæˆ‘ä»¬å¯åŠ¨äº†æ—§ç‰ˆæœ¬çš„Djangoã€‚ ç„¶åå¥¹çœ‹èµ·æ¥å¾ˆå®³æ€•å’Œæ‚²ä¼¤ã€‚ <br><br><img src="https://habrastorage.org/webt/yv/i5/a9/yvi5a9ueicvuhwgsyf8npzvojne.jpeg"><br><br> ä»–ä»¬çœ‹åˆ°<code>self_check</code>é€šè¿‡äº†ï¼Œæˆ‘ä»¬æ­£ç¡®å®‰è£…äº†æ‰€æœ‰ä¸œè¥¿ï¼Œä¸€åˆ‡æ­£å¸¸ï¼Œç°åœ¨æ‚¨å¯ä»¥ç¼–å†™ä»£ç äº†ã€‚ ä¸ºäº†å®ç°æ‰€æœ‰è¿™äº›ï¼Œæˆ‘ä»¬å¿…é¡»è¿è¡Œ<code>django-admin runserver</code> ã€‚ <br><br><pre> <code class="plaintext hljs">$ django-admin runserver Performing system checksâ€¦ System check identified no issues (0 silenced). You have unapplied migrations; your app may not work properly until they are applied. Run 'python manage.py migrate1 to apply them. August 21, 2018 - 15:50:53 Django version 2.1, using settings 'mysite.settings' Starting development server at http://127.0.0.1:8000/Quit the server with CONTROL-C.</code> </pre><br> è¯¥è¿‡ç¨‹å¼€å§‹ï¼Œå¤„ç†HTTPè¯·æ±‚ï¼Œæ‰€æœ‰ä¸å¯æ€è®®çš„äº‹æƒ…å‘ç”Ÿåœ¨å†…éƒ¨ï¼Œå¹¶ä¸”æ‰§è¡Œäº†æˆ‘ä»¬è¦å‘ç”¨æˆ·å±•ç¤ºçš„æ‰€æœ‰ä»£ç ã€‚ <br><br><h2> å®‰è£…æ–¹å¼ <br></h2><br> å½“æˆ‘ä»¬ä½¿ç”¨ä¾‹å¦‚<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">pipå’Œpackage manager</a>å®‰è£…Djangoæ—¶ï¼Œ <code>django-admin</code>å‡ºç°åœ¨ç³»ç»Ÿä¸Šã€‚ <br><br><pre> <code class="python hljs">$ pip install Django <span class="hljs-comment"><span class="hljs-comment"># setup.py from setuptools import find_packages, setup setup( name='Django', entry_points={ 'console_scripts': [ 'django-admin = django.core.management:execute_from_command_line' ] }, )</span></span></code> </pre><br> å‡ºç°<code>entry_points setuptools</code> ï¼Œå®ƒæŒ‡å‘<code>execute_from_command_line</code>å‡½æ•°ã€‚ å¯¹äºä»»ä½•å½“å‰è¿›ç¨‹ï¼Œæ­¤åŠŸèƒ½éƒ½æ˜¯ä½¿ç”¨Djangoè¿›è¡Œä»»ä½•æ“ä½œçš„åˆ‡å…¥ç‚¹ã€‚ <br><br><h3> å¼•å¯¼ç¨‹åº <br></h3><br> å‡½æ•°å†…éƒ¨ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ  <strong>Bootstrap</strong> ï¼Œåˆ†ä¸ºä¸¤ä¸ªè¿­ä»£ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># django.core.management django.setup().</span></span></code> </pre><br><h4> é…ç½®è®¾ç½® <br></h4><br> é¦–å…ˆæ˜¯<strong>é˜…è¯»é…ç½®</strong> ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> django.conf.global_settings import_module(os.environ[<span class="hljs-string"><span class="hljs-string">"DJANGO_SETTINGS_MODULE"</span></span>])</code> </pre><br>  <code>global_settings</code>é»˜è®¤è®¾ç½®<code>global_settings</code> ï¼Œç„¶åå°è¯•ä»ç¯å¢ƒå˜é‡ä¸­æ‰¾åˆ°ç”¨æˆ·ç¼–å†™çš„<code>DJANGO_SETTINGS_MODULE</code>æ¨¡å—ã€‚ è¿™äº›è®¾ç½®åˆå¹¶åˆ°ä¸€ä¸ªåç§°ç©ºé—´ä¸­ã€‚ <br><br> è‡³å°‘åœ¨Djangoä¸­å†™è¿‡â€œ Helloï¼Œworldâ€çš„ä»»ä½•äººéƒ½çŸ¥é“æœ‰<code>INSTALLED_APPS</code>æˆ‘ä»¬åœ¨å…¶ä¸­ç¼–å†™ç”¨æˆ·ä»£ç ã€‚ <br><br><h4> å¡«å……åº”ç”¨ <br></h4><br> åœ¨ç¬¬äºŒéƒ¨åˆ†ä¸­ï¼Œæ‰€æœ‰è¿™äº›åº”ç”¨ç¨‹åºï¼ˆæœ¬è´¨ä¸Šæ˜¯ç¨‹åºåŒ…ï¼‰éƒ½è¢«ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°è¿­ä»£ã€‚ æˆ‘ä»¬ä¸ºæ¯ä¸ªConfigåˆ›å»ºï¼Œå¯¼å…¥ç”¨äºä¸æ•°æ®åº“ä¸€èµ·ä½¿ç”¨çš„æ¨¡å‹ï¼Œå¹¶æ£€æŸ¥æ¨¡å‹çš„å®Œæ•´æ€§ã€‚ æ­¤å¤–ï¼Œæ¡†æ¶è¿è¡Œ<code>Check</code> ï¼Œå³ï¼Œå®ƒæ£€æŸ¥æ¯ä¸ªæ¨¡å‹éƒ½æœ‰ä¸€ä¸ªä¸»é”®ï¼Œæ‰€æœ‰å¤–é”®éƒ½æŒ‡å‘ç°æœ‰å­—æ®µï¼Œå¹¶ä¸”Nullå­—æ®µæœªå†™åœ¨BooleanFieldä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨äº†NullBooleanFieldã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> entry <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> settings.INSTALLED_APPS: cfg = AppConfig.create(entry) cfg.import_models()</code> </pre><br> è¿™æ˜¯å¯¹æ¨¡å‹ï¼Œç®¡ç†é¢æ¿ï¼Œä»»ä½•å¯¹è±¡çš„æœ€ä½é™åº¦çš„å®Œæ•´æ€§æ£€æŸ¥-æ— éœ€è¿æ¥æ•°æ®åº“ï¼Œä¹Ÿæ— éœ€ä»»ä½•è¶…çº§å¤æ‚å’Œç‰¹å®šçš„æ“ä½œã€‚ åœ¨æ­¤é˜¶æ®µï¼ŒDjangoå°šä¸çŸ¥é“æ‚¨è¦æ±‚æ‰§è¡Œå“ªä¸ªå‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸åŒºåˆ†ä»<code>runserver</code>æˆ–<code>shell</code> <code>migrate</code> ã€‚ <br><br> ç„¶åï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªæ¨¡å—ä¸­æ‰¾åˆ°è‡ªå·±ï¼Œè¯¥æ¨¡å—å°è¯•é€šè¿‡å‘½ä»¤è¡Œå‚æ•°çŒœæµ‹æˆ‘ä»¬è¦æ‰§è¡Œå“ªä¸ªå‘½ä»¤ä»¥åŠå®ƒä½äºå“ªä¸ªåº”ç”¨ç¨‹åºä¸­ã€‚ <br><br><h2> ç®¡ç†å‘½ä»¤ <br></h2><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># django.core.management subcommand = sys.argv[1] app_name = find(pkgutils.iter_modules(settings.INSTALLED_APPS)) module = import_module( '%s.management.commands.%s' % (app_name, subcommand) ) cmd = module.Command() cmd.run_from_argv(self.argv)</span></span></code> </pre><br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œrunserveræ¨¡å—å°†å…·æœ‰å†…ç½®çš„<code>django.core.management.commands.runserver</code>æ¨¡å—ã€‚ å¯¼å…¥æ¨¡å—åï¼ŒæŒ‰ç…§æƒ¯ä¾‹ï¼Œå…¨å±€ç±»<code>Command</code>åœ¨å†…éƒ¨è¢«è°ƒç”¨ï¼Œè¢«å®ä¾‹åŒ–ï¼Œç„¶åæˆ‘ä»¬è¯´ï¼šâ€œ <em>æˆ‘æ‰¾åˆ°äº†ï¼Œåœ¨è¿™é‡Œï¼Œæ‚¨å…·æœ‰ç”¨æˆ·ä¼ é€’çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œå¹¶å¯¹å®ƒä»¬è¿›è¡Œå¤„ç†</em> ã€‚â€ <br><br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è½¬åˆ°runserveræ¨¡å—ï¼Œçœ‹çœ‹<b>Djangoæ˜¯ç”±â€œ regexp and sticksâ€ç»„æˆçš„</b> ï¼Œä»Šå¤©æˆ‘å°†è¯¦ç»†è®¨è®ºï¼š <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># django.core.management.commands.runserver naiveip_re = re.compile(r"""^(?: (?P&lt;addr&gt; (?P&lt;ipv4&gt;\d{1,3}(?:\.\d{1,3}){3}) | # IPv4 address (?P&lt;ipv6&gt;\[[a-fA-F0-9:]+\]) | # IPv6 address (?P&lt;fqdn&gt;[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*) # FQDN ):)?(?P&lt;port&gt;\d+)$""", re.X)</span></span></code> </pre><br><h3> æŒ‡ä»¤ <br></h3><br> å‘ä¸‹æ»šåŠ¨ä¸€ä¸ªåŠå±-æœ€åï¼Œæˆ‘ä»¬è¿›å…¥å¯åŠ¨æœåŠ¡å™¨çš„å›¢é˜Ÿçš„å®šä¹‰ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># django.core.management.commands.runserver class Command(BaseCommand): def handle(self, *args, **options): httpd = WSGIServer(*args, **options) handler = WSGIHandler() httpd.set_app(handler) httpd.serve_forever()</span></span></code> </pre><br>  <code>BaseCommand</code>æ‰§è¡Œæœ€å°‘çš„ä¸€ç»„æ“ä½œï¼Œä»¥ä½¿å‘½ä»¤è¡Œå‚æ•°ç”Ÿæˆç”¨äºè°ƒç”¨<code>*args</code>å’Œ<code>**options</code>å‡½æ•°çš„<code>*args</code> ã€‚ æˆ‘ä»¬çœ‹åˆ°åœ¨è¿™é‡Œåˆ›å»ºäº†WSGIæœåŠ¡å™¨å®ä¾‹ï¼Œåœ¨æ­¤WSGIæœåŠ¡å™¨ä¸­å®‰è£…äº†å…¨å±€WSGIHandler-è¿™æ­£æ˜¯<strong>God Object Django</strong> ã€‚ æˆ‘ä»¬å¯ä»¥è¯´è¿™æ˜¯æ¡†æ¶çš„å”¯ä¸€å®ä¾‹ã€‚ å®ä¾‹é€šè¿‡<code>set application</code>å…¨å±€å®‰è£…åœ¨æœåŠ¡å™¨ä¸Šï¼Œå¹¶è¯´ï¼šâ€œåœ¨äº‹ä»¶å¾ªç¯ä¸­æ—‹è½¬ï¼Œæ‰§è¡Œè¯·æ±‚ã€‚â€ <br><br><blockquote> æ€»æ˜¯æœ‰ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼ŒæŸä¸ªç¨‹åºå‘˜ä¸ºä»–åˆ†é…ä»»åŠ¡ã€‚ <br></blockquote><br><h2>  WSGIæœåŠ¡å™¨ <br></h2><br> ä»€ä¹ˆæ˜¯<strong>WSGIHandler</strong> ï¼Ÿ  WSGIæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒå…è®¸æ‚¨ä»¥æœ€å°çš„æŠ½è±¡çº§åˆ«å¤„ç†HTTPè¯·æ±‚ï¼Œå¹¶ä¸”çœ‹èµ·æ¥åƒæŸç§å‡½æ•°å½¢å¼çš„ä¸œè¥¿ã€‚ <br><br><h3>  WSGIå¤„ç†ç¨‹åº <br></h3><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># django.core.handlers.wsgi class WSGIHandler: def __call__(self, environ, start_response): signals.request_started.send() request = WSGIRequest(environ) response = self.get_response(request) start_response(response.status, response.headers) return response</span></span></code> </pre><br> ä¾‹å¦‚ï¼Œè¿™é‡Œæ˜¯å®šä¹‰äº†<code>call</code>çš„ç±»çš„å®ä¾‹ã€‚ ä»–ç­‰å¾…å­—å…¸æ¡ç›®ï¼Œå…¶ä¸­æ ‡é¢˜å°†æ˜¾ç¤ºä¸ºå­—èŠ‚å’Œæ–‡ä»¶å¤„ç†ç¨‹åºã€‚ éœ€è¦å¤„ç†ç¨‹åºæ‰èƒ½è¯»å–è¯·æ±‚çš„<code>&lt;body&gt;</code> ã€‚ æœåŠ¡å™¨æœ¬èº«è¿˜æä¾›äº†å›è°ƒ<code>start_response</code>ä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åœ¨ä¸€åŒ…ä¸­å‘é€<code>response.headers</code>åŠå…¶æ ‡å¤´ï¼ˆä¾‹å¦‚statusï¼‰ã€‚ <br><br> æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å“åº”å¯¹è±¡å°†å“åº”ä¸»ä½“ä¼ é€’ç»™æœåŠ¡å™¨ã€‚  <strong>å“åº”</strong>æ˜¯å¯ä»¥è¿­ä»£çš„ç”Ÿæˆå™¨ã€‚ <br><br> æ‰€æœ‰ä¸ºWSGIç¼–å†™çš„æœåŠ¡å™¨-Gunicornï¼ŒuWSGIï¼ŒWaitressï¼Œéƒ½åœ¨æ­¤æ¥å£ä¸Šå·¥ä½œå¹¶ä¸”å¯ä»¥äº’æ¢ã€‚ æˆ‘ä»¬ç°åœ¨æ­£åœ¨è€ƒè™‘å¼€å‘æœåŠ¡å™¨ï¼Œä½†ä»»ä½•æœåŠ¡å™¨éƒ½è¾¾åˆ°äº†åœ¨Djangoä¸­çªç ´ç¯å¢ƒå’Œå›è°ƒçš„åœ°æ­¥ã€‚ <br><br><h2> ç¥ç‰©é‡Œé¢æ˜¯ä»€ä¹ˆï¼Ÿ <br></h2><br>  Djangoå†…éƒ¨çš„å…¨å±€God Objectå‡½æ•°å†…éƒ¨ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ <br><br><ul><li> è¦æ±‚ã€‚ </li><li> ä¸­é—´å•†å“ã€‚ </li><li> è·¯ç”±è¯·æ±‚æŸ¥çœ‹ã€‚ </li><li>  VIEW-è§†å›¾å†…çš„ç”¨æˆ·ä»£ç å¤„ç†ã€‚ </li><li> è¡¨å•-ä½¿ç”¨è¡¨å•ã€‚ </li><li>  ORMã€‚ </li><li> æ¨¡æ¿ </li><li> å›åº”ã€‚ </li></ul><br> æˆ‘ä»¬ä»Djangoéœ€è¦çš„æ‰€æœ‰æœºå™¨éƒ½åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å‘ç”Ÿï¼Œè¯¥å‡½æ•°åˆ†å¸ƒåœ¨æ•´ä¸ªæ¡†æ¶ä¸­ã€‚ <br><br><h3> ç´¢å– <br></h3><br> ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨è¯¥ç¯å¢ƒï¼Œæˆ‘ä»¬åœ¨æŸäº›ç‰¹æ®Šå¯¹è±¡ä¸­åŒ…è£…äº†WSGIç¯å¢ƒï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„å­—å…¸ã€‚ ä¾‹å¦‚ï¼Œé€šè¿‡ä½¿ç”¨ç±»ä¼¼äºå­—å…¸çš„ä¸œè¥¿æ¥æŸ¥æ‰¾ç”¨æˆ·è¯·æ±‚çš„é•¿åº¦ï¼Œè€Œä¸æ˜¯ä½¿ç”¨éœ€è¦è§£æçš„å­—èŠ‚ä¸²å¹¶åœ¨å…¶ä¸­æŸ¥æ‰¾é”®å€¼æ¡ç›®ï¼Œæ›´æ–¹ä¾¿ã€‚ ä½¿ç”¨Cookieæ—¶ï¼Œæˆ‘ä¹Ÿä¸æƒ³æ‰‹åŠ¨è®¡ç®—å­˜å‚¨æœŸæ˜¯å¦å·²åˆ°æœŸï¼Œå¹¶ä»¥æŸç§æ–¹å¼å¯¹å…¶è¿›è¡Œè§£é‡Šã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># django.core.handlers.wsgi class WSGIRequest(HttpRequest): @cached_property def GET(self): return QueryDict(self.environ['QUERY_STRING']) @property def POST(self): self._load_post_and_files() return self._post @cached_property def COOKIES(self): return parse_cookie(self.environ['HTTP_COOKIE'])</span></span></code> </pre><br> è¯·æ±‚åŒ…å«è§£æå™¨ï¼Œä»¥åŠä¸€ç»„å¤„ç†ç¨‹åºï¼Œç”¨äºæ§åˆ¶POSTè¯·æ±‚æ­£æ–‡çš„å¤„ç†ï¼šæ— è®ºæ˜¯å†…å­˜ä¸­çš„æ–‡ä»¶è¿˜æ˜¯ç£ç›˜ä¸Šçš„ä¸´æ—¶å­˜å‚¨æ–‡ä»¶ã€‚ ä¸€åˆ‡éƒ½åœ¨è¯·æ±‚ä¸­å†³å®šã€‚  Djangoä¸­çš„Requestä¹Ÿæ˜¯ä¸€ä¸ªèšåˆå™¨å¯¹è±¡ï¼Œæ‰€æœ‰ä¸­é—´ä»¶éƒ½å¯ä»¥åœ¨å…¶ä¸­å­˜å‚¨æˆ‘ä»¬éœ€è¦çš„æœ‰å…³ä¼šè¯ï¼Œèº«ä»½éªŒè¯å’Œç”¨æˆ·æˆæƒçš„ä¿¡æ¯ã€‚ æˆ‘ä»¬å¯ä»¥è¯´è¿™ä¹Ÿæ˜¯ä¸€ä¸ªä¸Šå¸å¯¹è±¡ï¼Œä½†æ˜¯æ›´å°ã€‚ <br><br> è¿›ä¸€æ­¥çš„è¯·æ±‚è¿›å…¥ä¸­é—´ä»¶ã€‚ <br><br><h3> ä¸­é—´ä»¶ <br></h3><br>  <strong>ä¸­é—´ä»¶</strong>æ˜¯åŒ…è£…å™¨ï¼ŒåŒ…è£…å…¶ä»–åŠŸèƒ½ï¼ˆå¦‚è£…é¥°å™¨ï¼‰ã€‚ åœ¨æ”¾å¼ƒå¯¹ä¸­é—´ä»¶çš„æ§åˆ¶ä¹‹å‰ï¼Œåœ¨callæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ç»™å‡ºå“åº”æˆ–è°ƒç”¨å·²ç»åŒ…è£…å¥½çš„ä¸­é—´ä»¶ã€‚ <br><br> ä»ç¨‹åºå‘˜çš„è§’åº¦æ¥çœ‹ï¼Œè¿™å°±æ˜¯ä¸­é—´ä»¶çš„æ ·å­ã€‚ <br><br><h4> è®¾å®šå€¼ <br></h4><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># settings.py MIDDLEWARE = [ 'django.middleware.security.SecurityMiddleware', 'django.middleware.csrf.CsrfViewMiddleware', 'django.contrib.sessions.middleware.SessionMiddleware', 'django.contrib.auth.middleware.AuthenticationMiddleware', ]</span></span></code> </pre><br><h4> å®šä¹‰ <br></h4><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Middleware</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, get_response=None)</span></span></span><span class="hljs-function">:</span></span> self.get_response = get_response <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__call__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, request)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.get_response(request)</code> </pre><br> ä»Djangoçš„è§’åº¦æ¥çœ‹ï¼Œä¸­é—´ä»¶çœ‹èµ·æ¥åƒä¸€ç§å †æ ˆï¼š <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># django.core.handlers.base def load_middleware(self): handler = convert_exception_to_response(self._get_response) for middleware_path in reversed(settings.MIDDLEWARE): middleware = import_string(middleware_path) instance = middleware(handler) handler = convert_exception_to_response(instance) self._middleware_chain = handler</span></span></code> </pre><br><h4> ç”³è¯· <br></h4><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_response</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, request)</span></span></span><span class="hljs-function">:</span></span> set_urlconf(settings.ROOT_URLCONF) response = self._middleware_chain(request) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response</code> </pre><br> æˆ‘ä»¬é‡‡ç”¨åˆå§‹çš„<code>get_response</code>å‡½æ•°ï¼Œå°†å…¶åŒ…è£…åœ¨å¤„ç†ç¨‹åºä¸­ï¼Œè¯¥å¤„ç†ç¨‹åºä¼šå°†ä¾‹å¦‚<code>permission error</code>å’Œ<code>not found error</code>è½¬æ¢ä¸ºæ­£ç¡®çš„HTTPä»£ç ã€‚ æˆ‘ä»¬ä»åˆ—è¡¨ä¸­å°†æ‰€æœ‰å†…å®¹åŒ…è£…åœ¨ä¸­é—´ä»¶æœ¬èº«ä¸­ã€‚ ä¸­é—´ä»¶å †æ ˆä¸æ–­å¢é•¿ï¼Œæ¯ä¸ªä¸‹ä¸€ä¸ªéƒ½åŒ…è£…äº†å‰ä¸€ä¸ªã€‚ è¿™ä¸ä»…å°†é›†ä¸­çš„è£…é¥°å™¨å †æ ˆåº”ç”¨äºé¡¹ç›®ä¸­çš„æ‰€æœ‰è§†å›¾éå¸¸ç›¸ä¼¼ã€‚ æ— éœ€æ ¹æ®é¡¹ç›®åŠ¨æ‰‹å®‰æ’åŒ…è£…å™¨ï¼Œä¸€åˆ‡éƒ½å¾ˆæ–¹ä¾¿ä¸”åˆä¹é€»è¾‘ã€‚ <br><br> æˆ‘ä»¬ç»å†äº†7ä¸ªä¸­é—´ä»¶åœˆå­ï¼Œæˆ‘ä»¬çš„è¯·æ±‚å¹¸å…äº†ä¸‹æ¥ï¼Œå¹¶å†³å®šå¯¹å®ƒè¿›è¡Œå¤„ç†ã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬è¿›å…¥äº†è·¯ç”±æ¨¡å—ã€‚ <br><br><h3> è·¯ç”±é€‰æ‹© <br></h3><br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å†³å®šä¸ºç‰¹å®šè¯·æ±‚è°ƒç”¨å“ªä¸ªå¤„ç†ç¨‹åºã€‚ è§£å†³äº†ï¼š <br><br><ul><li> åŸºäºç½‘å€ï¼› </li><li> åœ¨WSGIè§„èŒƒä¸­ï¼Œè°ƒç”¨request.path_infoã€‚ </li></ul><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># django.core.handlers.base def _get_response(self, request): resolver = get_resolver() view, args, kwargs = resolver.resolve(request.path_info) response = view(request, *args, **kwargs) return response</span></span></code> </pre><br><h4> ä¹Œå°”æ–¯ <br></h4><br> æˆ‘ä»¬ä½¿ç”¨è§£æå™¨ï¼Œä¸ºå®ƒæä¾›å½“å‰è¯·æ±‚çš„urlï¼Œå¹¶æœŸæœ›å®ƒè¿”å›è§†å›¾å‡½æ•°æœ¬èº«ï¼Œå¹¶ä»ç›¸åŒçš„urlä¸­è·å¾—ç”¨äºè°ƒç”¨viewçš„å‚æ•°ã€‚ ç„¶å<code>get_response</code>è°ƒç”¨è§†å›¾ï¼Œå¤„ç†å¼‚å¸¸å¹¶å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># urls.py urlpatterns = [ path('articles/2003/', views.special_case_2003), path('articles/&lt;int:year&gt;/', views.year_archive), path('articles/&lt;int:year&gt;/&lt;int:month&gt;/', views.month_archive) ]</span></span></code> </pre><br><h4> è§£æå™¨ <br></h4><br> è¿™æ˜¯è§£æå™¨çš„å¤–è§‚ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># django.urls.resolvers _PATH_RE = re.compile( r'&lt;(?:(?P&lt;converter&gt;[^&gt;:]+):)?(?P&lt;parameter&gt;\w+)&gt;' ) def resolve(self, path): for pattern in self.url_patterns: match = pattern.search(path) if match: return ResolverMatch( self.resolve(match[0]) ) raise Resolver404({'path': path})</span></span></code> </pre><br> è¿™ä¹Ÿæ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½†æ˜¯æ˜¯é€’å½’çš„ã€‚ å®ƒè¿›å…¥URLçš„ä¸€éƒ¨åˆ†ï¼ŒæŸ¥æ‰¾ç”¨æˆ·æƒ³è¦çš„å†…å®¹ï¼šå…¶ä»–ç”¨æˆ·ï¼Œå¸–å­ï¼Œåšå®¢ï¼Œæˆ–è€…æ˜¯æŸç§è½¬æ¢ç¨‹åºï¼Œä¾‹å¦‚ï¼Œéœ€è¦è§£å†³çš„ç‰¹å®šå¹´ä»½ï¼Œæ”¾å…¥å‚æ•°å¹¶è½¬æ¢ä¸ºintã€‚ <br><br> å…¶ç‰¹å¾æ˜¯resolveæ–¹æ³•çš„é€’å½’æ·±åº¦å§‹ç»ˆç­‰äºè°ƒç”¨è§†å›¾çš„å‚æ•°æ•°é‡ã€‚ å¦‚æœå‡ºäº†ç‚¹é—®é¢˜ï¼Œè€Œæˆ‘ä»¬æ²¡æœ‰æ‰¾åˆ°ç‰¹å®šçš„ç½‘å€ï¼Œåˆ™ä¼šå‘ç”Ÿæœªæ‰¾åˆ°çš„é”™è¯¯ã€‚ <br><br> ç„¶åï¼Œæˆ‘ä»¬ç»ˆäºäº†è§£äº†ç¨‹åºå‘˜ç¼–å†™çš„ä»£ç ã€‚ <br><br><h3> æ£€è§† <br></h3><br> åœ¨æœ€ç®€å•çš„è¡¨ç¤ºå½¢å¼ä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ªä»å“åº”è¿”å›è¯·æ±‚çš„å‡½æ•°ï¼Œä½†åœ¨å…¶ä¸­æ‰§è¡Œé€»è¾‘ä»»åŠ¡ï¼šâ€œå¦‚æœæœ‰ä¸€å¤©â€-è®¸å¤šé‡å¤æ€§ä»»åŠ¡ã€‚  Djangoä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªåŸºäºç±»çš„è§†å›¾ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æŒ‡å®šç‰¹å®šçš„è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶ä¸”æ‰€æœ‰è¡Œä¸ºå°†ç”±ç±»æœ¬èº«ä»¥æ­£ç¡®çš„æ ¼å¼è¿›è¡Œè§£é‡Šã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># django.views.generic.edit class ContactView(FormView): template_name = 'contact.html' form_class = ContactForm success_url = '/thanks/'</span></span></code> </pre><br><h4> æ–¹æ³•æµç¨‹å›¾ <br></h4><br><pre> <code class="python hljs">self.dispatch() self.post() self.get_form() self.form_valid() self.render_to_response()</code> </pre><br> æ­¤å®ä¾‹çš„<code>dispatch</code>æ–¹æ³•å·²ç»åœ¨urlæ˜ å°„ä¸­ï¼Œè€Œä¸æ˜¯å‡½æ•°ä¸­ã€‚ åŸºäºHTTPè°“è¯çš„è°ƒåº¦å¯ä»¥äº†è§£è°ƒç”¨å“ªç§æ–¹æ³•ï¼šPOSTæ¥äº†ï¼Œæˆ‘ä»¬å¾ˆå¯èƒ½å¸Œæœ›å®ä¾‹åŒ–formå¯¹è±¡ï¼Œå¦‚æœformæœ‰æ•ˆï¼Œåˆ™å°†å…¶ä¿å­˜åˆ°æ•°æ®åº“å¹¶æ˜¾ç¤ºæ¨¡æ¿ã€‚ æ‰€æœ‰è¿™äº›éƒ½æ˜¯é€šè¿‡æ„æˆæ­¤ç±»çš„å¤§é‡mixinå®Œæˆçš„ã€‚ <br><br><h3> å½¢å¼ <br></h3><br> åœ¨è¿›å…¥Djangoè§†å›¾ä¹‹å‰ï¼Œå¿…é¡»å…ˆé€šè¿‡å¥—æ¥å­—è¯»å–è¡¨å•-é€šè¿‡WSGIç¯å¢ƒä¸­çš„åŒä¸€æ–‡ä»¶å¤„ç†ç¨‹åºã€‚  form-dataæ˜¯ä¸€ä¸ªå­—èŠ‚æµï¼Œåœ¨å…¶ä¸­æè¿°äº†åˆ†éš”ç¬¦-æˆ‘ä»¬å¯ä»¥è¯»å–è¿™äº›å—å¹¶è¿›è¡Œä¸€äº›å¤„ç†ã€‚ å®ƒå¯ä»¥æ˜¯é”®-å€¼å¯¹åº”å…³ç³»ï¼Œå¦‚æœå®ƒæ˜¯å­—æ®µï¼Œæ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œç„¶ååˆæ˜¯æŸä¸ªå­—æ®µ-ä¸€åˆ‡éƒ½æ··åˆäº†ã€‚ <br><br><pre> <code class="python hljs">Content-Type: multipart/form-data;boundary=<span class="hljs-string"><span class="hljs-string">"boundary"</span></span> --boundary name=<span class="hljs-string"><span class="hljs-string">"field1"</span></span> value1 --boundary name=<span class="hljs-string"><span class="hljs-string">"field2"</span></span>; value2</code> </pre><br><h4> è§£æå™¨ <br></h4><br> è§£æå™¨åŒ…æ‹¬3ä¸ªéƒ¨åˆ†ã€‚ <br><br> ä»å­—èŠ‚æµä¸­åˆ›å»ºæœŸæœ›çš„è¯»æ•°çš„å—è¿­ä»£å™¨å˜æˆå¯ä»¥äº§ç”Ÿ<code>boundaries</code>çš„è¿­ä»£å™¨ã€‚ å®ƒä¿è¯å¦‚æœæœ‰ä¸œè¥¿è¿”å›ï¼Œå®ƒå°†æ˜¯è¾¹ç•Œã€‚ è¿™æ˜¯å¿…éœ€çš„ï¼Œä»¥ä¾¿åœ¨è§£æå™¨å†…éƒ¨ä¸å¿…å­˜å‚¨è¿æ¥çŠ¶æ€ï¼Œä»å¥—æ¥å­—è¯»å–æˆ–ä¸è¯»å–ä»¥æœ€å°åŒ–æ•°æ®å¤„ç†é€»è¾‘ã€‚ <br><br> æ¥ä¸‹æ¥ï¼Œç”Ÿæˆå™¨åŒ…è£…<strong>LazyStream</strong> ï¼Œå®ƒå†æ¬¡ä»ä¸­åˆ›å»ºä¸€ä¸ªç›®æ ‡æ–‡ä»¶ï¼Œä½†å…·æœ‰é¢„æœŸçš„è¯»æ•°ã€‚ å› æ­¤ï¼Œè§£æå™¨å·²ç»å¯ä»¥éå†å„ä¸ªå­—èŠ‚å¹¶ä»ä¸­æ„å»ºé”®å€¼ã€‚ <br><br>  <strong>æ­¤å¤„çš„å­—æ®µå’Œæ•°æ®å°†å§‹ç»ˆä¸ºå­—ç¬¦ä¸²</strong> ã€‚ å¦‚æœæˆ‘ä»¬æ”¶åˆ°ISOæ ¼å¼çš„æ•°æ®æ—¶é—´ï¼Œåˆ™Djangoè¡¨å•ï¼ˆç”±ç¨‹åºå‘˜ç¼–å†™ï¼‰å°†ä½¿ç”¨æŸäº›å­—æ®µï¼ˆä¾‹å¦‚æ—¶é—´æˆ³ï¼‰æ¥æ¥æ”¶ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># django.http.multipartparser self._post = QueryDict(mutable=True) stream = LazyStream(ChunkIter(self._input_data)) for field, data in Parser(stream): self._post.append(field, force_text(data))</span></span></code> </pre><br> æ­¤å¤–ï¼Œè¡¨å•å¾ˆå¯èƒ½å¸Œæœ›å°†è‡ªèº«ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œç„¶åä»è¿™é‡Œå¼€å§‹Django ORMã€‚ <br><br><h3>  ORM <br></h3><br> å¤§çº¦é€šè¿‡æ­¤ç±»DSLæ¥æ‰§è¡ŒORMè¯·æ±‚ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># models.py Entry.objects.exclude( pub_date__gt=date(2005, 1, 3), headline='Hello', )</span></span></code> </pre><br> ä½¿ç”¨é”®ï¼Œæ‚¨å¯ä»¥æ”¶é›†ç±»ä¼¼çš„SQLè¡¨è¾¾å¼ï¼š <br><br><pre> <code class="python hljs">SELECT * WHERE NOT (pub_date &gt; <span class="hljs-string"><span class="hljs-string">'2005-1-3'</span></span> AND headline = <span class="hljs-string"><span class="hljs-string">'Hello'</span></span>)</code> </pre><br> æ€ä¹ˆæ ·äº† <br><br><h4> æŸ¥è¯¢é›† <br></h4><br>  <code>exclude</code>æ–¹æ³•åœ¨å†…éƒ¨å…·æœ‰<code>Query</code>å¯¹è±¡ã€‚ è¯¥å¯¹è±¡å°†å‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œå¹¶åˆ›å»ºå¯¹è±¡çš„å±‚æ¬¡ç»“æ„ï¼Œæ¯ä¸ªå¯¹è±¡å±‚æ¬¡ç»“æ„éƒ½å¯ä»¥å°†è‡ªèº«ä½œä¸ºå­—ç¬¦ä¸²å˜æˆSQLæŸ¥è¯¢çš„å•ç‹¬éƒ¨åˆ†ã€‚ <br><br> éå†æ ‘æ—¶ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½è½®è¯¢å…¶å­èŠ‚ç‚¹ï¼Œæ¥æ”¶åµŒå¥—çš„SQLæŸ¥è¯¢ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†SQLæ„é€ ä¸ºå­—ç¬¦ä¸²ã€‚ ä¾‹å¦‚ï¼Œé”®å€¼å°†ä¸æ˜¯å•ç‹¬çš„SQLå­—æ®µï¼Œä½†å°†ä¸å€¼å€¼è¿›è¡Œæ¯”è¾ƒã€‚ æŸ¥è¯¢çš„ä¸²è”å’Œæ‹’ç»ä¸é€’å½’æ ‘éå†çš„å·¥ä½œæ–¹å¼ç›¸åŒï¼Œå¯¹äºæ¯ä¸ªè°ƒç”¨è¯¥èŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼Œéƒ½å¼ºåˆ¶è½¬æ¢ä¸ºSQLã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># django.db.models.query sql.Query(Entry).where.add( ~Q( Q(F('pub_date') &gt; date(2005, 1, 3)) &amp; Q(headline='Hello') ) )</span></span></code> </pre><br><h4> ç¼–è¯‘å™¨ <br></h4><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># django.db.models.expressions class Q(tree.Node): AND = 'AND' OR = 'OR' def as_sql(self, compiler, connection): return self.template % self.field.get_lookup('gt')</span></span></code> </pre><br><h3> è¾“å‡ºé‡ <br></h3><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>Q(headline=<span class="hljs-string"><span class="hljs-string">'Hello'</span></span>) <span class="hljs-comment"><span class="hljs-comment"># headline = 'Hello' &gt;&gt;&gt; F('pub_date') # pub_date &gt;&gt;&gt; F('pub_date') &gt; date(2005, 1, 3) # pub_date &gt; '2005-1-3' &gt;&gt;&gt; Q(...) &amp; Q(...) # ... AND ... &gt;&gt;&gt; ~Q(...) # NOT â€¦</span></span></code> </pre><br> ä¸€ä¸ªå°çš„è¾…åŠ©ç¼–è¯‘å™¨è¢«ä¼ é€’ç»™æ­¤æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥å°†MySQLçš„æ–¹è¨€ä¸PostgreSQLåŒºåˆ«å¼€æ¥ï¼Œå¹¶æ­£ç¡®æ’åˆ—ç‰¹å®šæ•°æ®åº“çš„æ–¹è¨€ä¸­ä½¿ç”¨çš„è¯­æ³•ç³–ã€‚ <br><br><h3> æ•°æ®åº“è·¯ç”± <br></h3><br> å½“æˆ‘ä»¬æ”¶åˆ°SQLæŸ¥è¯¢æ—¶ï¼Œè¯¥æ¨¡å‹ä¼šè§¦å‘æ•°æ®åº“è·¯ç”±å¹¶è¯¢é—®å…¶ä½äºå“ªä¸ªæ•°æ®åº“ä¸­ã€‚ åœ¨99ï¼…çš„æƒ…å†µä¸‹ï¼Œå®ƒå°†æ˜¯é»˜è®¤æ•°æ®åº“ï¼Œåœ¨å…¶ä½™1ï¼…çš„æƒ…å†µä¸‹-å±äºè‡ªå·±çš„æ•°æ®åº“ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># django.db.utils class ConnectionRouter: def db_for_read(self, model, **hints): if model._meta.app_label == 'auth': return 'auth_db'</span></span></code> </pre><br> ä»ç‰¹å®šçš„åº“æ¥å£ï¼ˆä¾‹å¦‚Python MySQLæˆ–Psycopg2ï¼‰åŒ…è£…æ•°æ®åº“é©±åŠ¨ç¨‹åºï¼Œä¼šåˆ›å»ºDjangoå¯ä»¥ä½¿ç”¨çš„é€šç”¨å¯¹è±¡ã€‚ æœ‰ä¸€ä¸ªç”¨äºæ¸¸æ ‡çš„åŒ…è£…å™¨ï¼Œä¸€ä¸ªç”¨äºäº‹åŠ¡çš„åŒ…è£…å™¨ã€‚ <br><br><h4> è¿é€šæ±  <br></h4><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># django.db.backends.base.base class BaseDatabaseWrapper: def commit(self): self.validate_thread_sharing() self.validate_no_atomic_block() with self.wrap_database_errors: return self.connection.commit()</span></span></code> </pre><br> åœ¨è¿™ä¸ªç‰¹å®šçš„è¿æ¥ä¸­ï¼Œæˆ‘ä»¬å°†è¯·æ±‚å‘é€åˆ°æ­£åœ¨æ•²æ•°æ®åº“çš„å¥—æ¥å­—ï¼Œå¹¶ç­‰å¾…æ‰§è¡Œã€‚ åº“ä¸Šçš„åŒ…è£…å™¨å°†ä»¥è®°å½•çš„å½¢å¼ä»æ•°æ®åº“ä¸­è¯»å–äººä¸ºçš„å“åº”ï¼Œè€ŒDjangoä»è¯¥æ•°æ®ä¸­ä»¥Pythonç±»å‹æ”¶é›†æ¨¡å‹å®ä¾‹ã€‚ è¿™ä¸æ˜¯ä¸€ä¸ªå¤æ‚çš„è¿­ä»£ã€‚ <br><br> æˆ‘ä»¬å°†ä¸€äº›å†…å®¹å†™å…¥æ•°æ®åº“ï¼Œè¯»å–äº†ä¸€äº›å†…å®¹ï¼Œç„¶åå†³å®šä½¿ç”¨HTMLé¡µé¢å°†å…¶å‘ŠçŸ¥ç”¨æˆ·ã€‚ ä¸ºæ­¤ï¼ŒDjangoä½¿ç”¨äº†ç¤¾åŒºä¸å–œæ¬¢çš„æ¨¡æ¿è¯­è¨€ï¼Œè¯¥æ¨¡æ¿è¯­è¨€çœ‹èµ·æ¥åƒæ˜¯ç¼–ç¨‹è¯­è¨€ï¼Œä»…åœ¨HTMLæ–‡ä»¶ä¸­ã€‚ <br><br><h3> èŒƒæœ¬ <br></h3><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.template.loader <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> render_to_string render_to_string(<span class="hljs-string"><span class="hljs-string">'my_template.html'</span></span>, {<span class="hljs-string"><span class="hljs-string">'entries'</span></span>: ...})</code> </pre><br><h4> ä»£å· <br></h4><br><pre> <code class="python hljs">&lt;ul&gt; {% <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> entry <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> entries %} &lt;li&gt;{{ entry.name }}&lt;/li&gt; {% endfor %} &lt;/ul&gt;</code> </pre><br><h4> è§£æå™¨ <br></h4><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># django.template.base BLOCK_TAG_START = '{%' BLOCK_TAG_END = '%}' VARIABLE_TAG_START = '{{' VARIABLE_TAG_END = '}}' COMMENT_TAG_START = '{#' COMMENT_TAG_END = '#}' tag_re = (re.compile('(%s.*?%s|%s.*?%s|%s.*?%s)' % (re.escape(BLOCK_TAG_START), re.escape(BLOCK_TAG_END), re.escape(VARIABLE_TAG_START), re.escape(VARIABLE_TAG_END), re.escape(COMMENT_TAG_START), re.escape(COMMENT_TAG_END))))</span></span></code> </pre><br> æƒŠå–œ-regexpå†æ¬¡å‡ºç°ã€‚ åªæœ‰åœ¨ç»“å°¾å¤„æ‰æœ‰é€—å·ï¼Œå¹¶ä¸”åˆ—è¡¨ä¼šå¾ˆä½ã€‚ è¿™å¯èƒ½æ˜¯æˆ‘åœ¨è¯¥é¡¹ç›®ä¸­è§è¿‡çš„æœ€å›°éš¾çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚ <br><br><h3>  Lexer <br></h3><br> æ¨¡æ¿å¤„ç†ç¨‹åºå’Œè§£é‡Šå™¨éå¸¸ç®€å•ã€‚ æœ‰ä¸€ä¸ªè¯æ³•åˆ†æå™¨ï¼Œä½¿ç”¨regexpå°†æ–‡æœ¬è½¬æ¢ä¸ºå°æ ‡è®°åˆ—è¡¨ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># django.template.base def tokenize(self): for bit in tag_re.split(template_string): lineno += bit.count('\n') yield bit</span></span></code> </pre><br> æˆ‘ä»¬éå†ä»¤ç‰Œåˆ—è¡¨ï¼Œçœ‹çœ‹ï¼šâ€œä½ æ˜¯è°ï¼Ÿ å°†æ‚¨åŒ…è£¹åœ¨æ ‡ç­¾èŠ‚ç‚¹ä¸­ã€‚â€ ä¾‹å¦‚ï¼Œå¦‚æœè¿™æ˜¯æŸäº›<code>if</code>æˆ–<code>for</code>æˆ–<code>for</code> ï¼Œåˆ™æ ‡è®°å¤„ç†ç¨‹åºå°†é‡‡ç”¨é€‚å½“çš„å¤„ç†ç¨‹åºã€‚  <code>for</code>å¤„ç†å™¨æœ¬èº«å†æ¬¡å‘Šè¯‰è§£æå™¨ï¼šâ€œè¯·å‘æˆ‘é˜…è¯»ç›´åˆ°ç»“æŸæ ‡è®°çš„æ‰€æœ‰ä»¤ç‰Œåˆ—è¡¨ã€‚â€ <br><br> æ“ä½œå†æ¬¡è½¬åˆ°è§£æå™¨ã€‚ <br><br><blockquote> èŠ‚ç‚¹ï¼Œæ ‡ç­¾å’Œè§£æå™¨æ˜¯ç›¸äº’é€’å½’çš„ï¼Œé€’å½’çš„æ·±åº¦é€šå¸¸ç­‰äºæ ‡ç­¾æœ¬èº«å¯¹æ¨¡æ¿çš„åµŒå¥—ã€‚ <br></blockquote><br><h4> è§£æå™¨ <br></h4><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> tokens: token = tokens.pop() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> token.startswith(BLOCK_TAG_START): <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> TagNode(token) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> token.startswith(VARIABLE_TAG_START): ...</code> </pre><br> æ ‡è®°å¤„ç†ç¨‹åºä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç‰¹å®šçš„èŠ‚ç‚¹ï¼Œä¾‹å¦‚å¸¦æœ‰<code>for</code>å¾ªç¯çš„èŠ‚ç‚¹ï¼Œä¸ºæ­¤<code>render</code>æ–¹æ³•ã€‚ <br><br><h4> å¯¹äºå¾ªç¯ <br></h4><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># django.template.defaulttags @register.tag('for') def do_for(parser, token): args = token.split_contents() body = parser.parse(until=['endfor']) return ForNode(args, body)</span></span></code> </pre><br><h4> å¯¹äºèŠ‚ç‚¹ <br></h4><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ForNode</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Node)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, context)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> context.push(): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.args: <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> self.body.render(context)</code> </pre><br>  <code>render</code>æ–¹æ³•æ˜¯ä¸€ä¸ªæ¸²æŸ“æ ‘ã€‚ æ¯ä¸ªä¸Šå±‚èŠ‚ç‚¹å¯ä»¥è½¬åˆ°ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œè¦æ±‚å¥¹è¿›è¡Œæ¸²æŸ“ã€‚ ç¨‹åºå‘˜ä¹ æƒ¯äºåœ¨è¿™ä¸ªæ¨¡æ¿ä¸­æ˜¾ç¤ºä¸€äº›å˜é‡ã€‚ è¿™æ˜¯é€šè¿‡<code>context</code>å®Œæˆçš„-å®ƒä»¥å¸¸è§„è¯å…¸çš„å½¢å¼å‘ˆç°ã€‚ è¿™æ˜¯ä¸€å †å­—å…¸ï¼Œç”¨äºåœ¨æˆ‘ä»¬è¾“å…¥æ ‡ç­¾æ—¶æ¨¡æ‹Ÿä½œç”¨åŸŸã€‚ ä¾‹å¦‚ï¼Œå¦‚æœ<code>context</code>æœ¬èº«æ›´æ”¹äº†<code>for</code>å¾ªç¯å†…çš„å…¶ä»–æ ‡ç­¾ï¼Œåˆ™å½“æˆ‘ä»¬é€€å‡ºå¾ªç¯æ—¶ï¼Œæ‰€åšçš„æ›´æ”¹å°†è¢«å›æ»šã€‚ ä¹‹æ‰€ä»¥æ–¹ä¾¿ï¼Œæ˜¯å› ä¸ºå½“ä¸€åˆ‡éƒ½æ˜¯å…¨çƒæ€§çš„æ—¶ï¼Œå°±å¾ˆéš¾è¿›è¡Œå·¥ä½œã€‚ <br><br><h3> å›åº” <br></h3><br> æœ€åï¼Œæˆ‘ä»¬å¾—åˆ°äº†HTTPå“åº”ï¼š <br><br><blockquote> ä¸–ç•Œæ‚¨å¥½ï¼ <br></blockquote><br> æˆ‘ä»¬å¯ä»¥æŠŠçº¿ç»™ç”¨æˆ·ã€‚ <br><br><ul><li> ä»è§†å›¾è¿”å›æ­¤å“åº”ã€‚ </li><li> æŸ¥çœ‹åˆ—è¡¨ä¸­é—´ä»¶ã€‚ </li><li> å“åº”çš„ä¸­é—´ä»¶å¯ä»¥ä¿®æ”¹ï¼Œè¡¥å……å’Œæ”¹è¿›ã€‚ </li><li> å“åº”å¼€å§‹åœ¨WSGIHandlerå†…éƒ¨è¿›è¡Œè¿­ä»£ï¼Œéƒ¨åˆ†å†™å…¥å¥—æ¥å­—ï¼Œæµè§ˆå™¨ä»æˆ‘ä»¬çš„æœåŠ¡å™¨æ¥æ”¶å“åº”ã€‚ </li></ul><br> æ‰€æœ‰ç”¨Djangoç¼–å†™çš„è‘—ååˆ›ä¸šå…¬å¸ï¼Œä¾‹å¦‚Bitbucketæˆ–Instagramï¼Œéƒ½ä»¥ä¸€ä¸ªå¾ˆå°çš„å‘¨æœŸå¼€å§‹ï¼Œæ¯ä¸ªç¨‹åºå‘˜éƒ½è¦ç»å†ä¸€æ¬¡ã€‚ <br><br> æ‰€æœ‰è¿™äº›ä»¥åŠåœ¨Moscow Python Conf ++ä¸Šçš„æ¼”ç¤ºï¼Œå¯¹äºæ‚¨æ›´å¥½åœ°äº†è§£æ‚¨æ‰‹ä¸­çš„å†…å®¹ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒæ˜¯å¿…ä¸å¯å°‘çš„ã€‚ ç”¨ä»»ä½•é­”æœ¯ï¼Œæ‚¨éƒ½å¿…é¡»èƒ½å¤Ÿçƒ¹é¥ªæ­£åˆ™è¡¨è¾¾å¼çš„å¾ˆå¤§ä¸€éƒ¨åˆ†ã€‚ <br><br><blockquote>  Artyom Malyshevå’Œå…¶ä»–23ä½å‡ºè‰²çš„æ¼”è®²è€…<strong>å°†äº4æœˆ5</strong>æ—¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è«æ–¯ç§‘Python Conf ++</a>ä¼šè®®ä¸Šå†æ¬¡ä¸ºæˆ‘ä»¬æä¾›æœ‰å…³Pythonä¸»é¢˜çš„å¤§é‡æ€æƒ³å’Œè®¨è®ºã€‚ ç ”ç©¶<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ—¶é—´è¡¨ï¼Œ</a>å¹¶åŠ å…¥ç»éªŒäº¤æµï¼Œä»¥ä½¿ç”¨Pythonè§£å†³å„ç§é—®é¢˜ã€‚ <br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN433482/">https://habr.com/ru/post/zh-CN433482/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN433472/index.html">Unity 2018.3å‘å¸ƒ</a></li>
<li><a href="../zh-CN433474/index.html">ä»å†…åˆ°å¤–çš„çš®æ—ç‰¹ã€‚ ä»–æ˜¯æ€ä¹ˆåšåˆ°çš„</a></li>
<li><a href="../zh-CN433476/index.html">50ç§èŠ¹èœè‰²</a></li>
<li><a href="../zh-CN433478/index.html">ä¸ºä»€ä¹ˆåœ¨Tinkoff Magazineä¸­é€‰æ‹©Django</a></li>
<li><a href="../zh-CN433480/index.html">éœåˆ©ç“¦å°¼å…³äºçŸ­æ¯›ç»’çš„æ•…äº‹</a></li>
<li><a href="../zh-CN433486/index.html">åˆæ€ä¹ˆäº† éé“¶è¡Œå€Ÿè®°å¡çš„å¤å…´</a></li>
<li><a href="../zh-CN433488/index.html">åœ£è¯èŠ‚Scrumèšä¼š-UPDå¹¿æ’­æ··æ­</a></li>
<li><a href="../zh-CN433490/index.html">Creality CR-X 3Dæ‰“å°æœºè¯„è®º</a></li>
<li><a href="../zh-CN433494/index.html">ä½ æ°¸è¿œä¸ä¼šçŸ¥é“çš„10ä¸ªè‹±è¯­ä¹ è¯­</a></li>
<li><a href="../zh-CN433496/index.html">å›½æœ‰ä¼ä¸šæœ‰ä¹‰åŠ¡åœ¨2022å¹´ä¹‹å‰è½¬å‘å®¶ç”¨è½¯ä»¶</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>