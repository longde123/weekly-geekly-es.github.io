<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏻‍🏫 🏠 🆓 Porting Quake3 🧔🏿 💇🏾 💠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam sistem operasi Embox (di mana saya adalah pengembangnya), dukungan untuk OpenGL muncul beberapa waktu lalu, tetapi tidak ada pemeriksaan kinerja...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Porting Quake3</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/embox/blog/428634/"><img src="https://habrastorage.org/webt/or/0q/lb/or0qlb1hvs2q5j4-xfsfv5uofys.png" align="right" width="320"><br><p>  Dalam sistem operasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Embox</a> (di mana saya adalah pengembangnya), dukungan untuk OpenGL muncul beberapa waktu lalu, tetapi tidak ada pemeriksaan kinerja yang masuk akal, hanya menyajikan adegan dengan beberapa grafis primitif. </p><br><p>  Saya tidak pernah tertarik dengan gamedev, meskipun, tentu saja, saya suka game, dan memutuskan - ini adalah cara yang baik untuk bersenang-senang, tetapi pada saat yang sama memeriksa OpenGL dan melihat bagaimana game berinteraksi dengan OS. </p><br><p>  Pada artikel ini, saya akan berbicara tentang cara membangun dan menjalankan Quake3 di Embox. </p><a name="habracut"></a><br><p>  Lebih tepatnya, kita tidak akan menjalankan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Quake3</a> sendiri, tetapi berdasarkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ioquake3</a> , yang juga memiliki kode sumber terbuka.  Untuk kesederhanaan, kami akan memanggil ioquake3 just gempa :) </p><br><p>  Saya akan segera melakukan reservasi bahwa artikel tersebut tidak menganalisis kode sumber Quake dan arsitekturnya (Anda dapat membacanya di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> , ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">terjemahan di Habré</a> ), dan artikel ini akan fokus pada cara memastikan game diluncurkan pada sistem operasi yang baru. </p><br><p>  Fragmen kode yang disajikan dalam artikel disederhanakan untuk pemahaman yang lebih baik: memeriksa kesalahan dihilangkan, pseudo-code digunakan, dan sebagainya.  Sumber asli dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">repositori kami</a> . </p><br><h2 id="zavisimosti">  Ketergantungan </h2><br><p>  Anehnya, tidak banyak perpustakaan diperlukan untuk membangun Quake3.  Kami akan membutuhkan: </p><br><ul><li> POSIX + LibC - <code>malloc()</code> / <code>memcpy()</code> / <code>printf()</code> dan seterusnya </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">libcurl</a> - jaringan </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mesa3D</a> - Dukungan OpenGL </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SDL</a> - input dan dukungan perangkat audio </li></ul><br><p>  Dengan paragraf pertama, dan semuanya jelas - tanpa fungsi-fungsi ini sulit dilakukan ketika berkembang di C, dan penggunaan panggilan ini sangat diharapkan.  Oleh karena itu, dukungan untuk antarmuka ini tersedia di hampir semua sistem operasi, dan dalam hal ini, praktis tidak perlu menambahkan fungsionalitas.  Saya harus berurusan dengan yang lain. </p><br><h3 id="libcurl">  libcurl </h3><br><p>  Itu yang paling sederhana.  Libc cukup untuk membangun libcurl (tentu saja, beberapa fitur tidak akan tersedia, tetapi mereka tidak akan diperlukan).  Mengkonfigurasi dan membangun perpustakaan ini secara statis sangat sederhana. </p><br><p>  Biasanya, baik aplikasi dan perpustakaan dihubungkan secara dinamis, tetapi karena  di Embox, mode utama menautkan dalam satu gambar, kami akan menghubungkan semuanya secara statis. </p><br><p>  Bergantung pada sistem build yang digunakan, langkah-langkah spesifik akan bervariasi, tetapi artinya adalah seperti ini: </p><br><pre> <code class="hljs powershell">wget https://curl.haxx.se/download/curl<span class="hljs-literal"><span class="hljs-literal">-7</span></span>.<span class="hljs-number"><span class="hljs-number">61.1</span></span>.tar.gz tar <span class="hljs-literal"><span class="hljs-literal">-xf</span></span> curl<span class="hljs-literal"><span class="hljs-literal">-7</span></span>.<span class="hljs-number"><span class="hljs-number">61.1</span></span>.tar.gz cd curl<span class="hljs-literal"><span class="hljs-literal">-7</span></span>.<span class="hljs-number"><span class="hljs-number">61.1</span></span> ./configure -<span class="hljs-literal"><span class="hljs-literal">-enable</span></span><span class="hljs-literal"><span class="hljs-literal">-static</span></span> -<span class="hljs-literal"><span class="hljs-literal">-host</span></span>=i386<span class="hljs-literal"><span class="hljs-literal">-unknown</span></span><span class="hljs-literal"><span class="hljs-literal">-none</span></span> <span class="hljs-literal"><span class="hljs-literal">-disable</span></span><span class="hljs-literal"><span class="hljs-literal">-shared</span></span> make ls ./lib/.libs/libcurl.a <span class="hljs-comment"><span class="hljs-comment">#      </span></span></code> </pre> <br><h3 id="mesaopengl">  Mesa / OpenGL </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mesa</a> adalah kerangka kerja open source untuk bekerja dengan grafik, mendukung sejumlah antarmuka (OpenCL, Vulkan, dan lainnya), tetapi dalam hal ini kami tertarik dengan OpenGL.  Porting kerangka besar seperti itu adalah topik dari artikel terpisah.  Saya akan membatasi diri hanya untuk apa yang sudah dimiliki Embox Mesa3D :) Tentu saja, setiap implementasi OpenGL cocok di sini. </p><br><h3 id="sdl">  Sdl </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SDL</a> adalah kerangka kerja lintas platform untuk bekerja dengan perangkat input, audio dan grafik. </p><br><p>  Untuk saat ini, kami akan memalu semuanya kecuali gambar, dan untuk menggambar bingkai, kami akan menulis fungsi rintisan untuk melihat kapan mereka mulai dipanggil. </p><br><p>  Backend untuk bekerja dengan grafik diatur dalam <code>SDL2-2.0.8/src/video/SDL_video.c</code> . </p><br><p>  Itu terlihat seperti ini: </p><br><pre> <code class="hljs cs"><span class="hljs-comment"><span class="hljs-comment">/* Available video drivers */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> VideoBootStrap *bootstrap[] = { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> SDL_VIDEO_DRIVER_COCOA &amp;COCOA_bootstrap, #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> SDL_VIDEO_DRIVER_X11 &amp;X11_bootstrap, #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> ... }</span></span></code> </pre> <br><p>  Agar tidak repot dengan dukungan "normal" untuk platform baru, cukup tambahkan <code>VideoBootStrap</code> Anda </p><br><p>  Untuk kesederhanaan, Anda dapat mengambil sesuatu sebagai dasar, misalnya <code>src/video/qnx/video.c</code> atau <code>src/video/raspberry/SDL_rpivideo.c</code> , tapi pertama-tama kami akan membuat implementasinya hampir kosong: </p><br><pre> <code class="hljs cpp"><span class="hljs-comment"><span class="hljs-comment">/* SDL_sysvideo.h */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VideoBootStrap</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *name; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *desc;``` <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> (*available) (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>); SDL_VideoDevice *(*create) (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> devindex); } VideoBootStrap; <span class="hljs-comment"><span class="hljs-comment">/* embox_video.c */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> SDL_VideoDevice *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createDevice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> devindex)</span></span></span><span class="hljs-function"> </span></span>{ SDL_VideoDevice *device; device = (SDL_VideoDevice *)SDL_calloc(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(SDL_VideoDevice)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (device == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> device; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">available</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } VideoBootStrap EMBOX_bootstrap = { <span class="hljs-string"><span class="hljs-string">"embox"</span></span>, <span class="hljs-string"><span class="hljs-string">"EMBOX Screen"</span></span>, available, createDevice };</code> </pre><br><p>  Tambahkan <code>VideoBootStrap</code> Anda ke array: </p><br><pre> <code class="hljs cs"><span class="hljs-comment"><span class="hljs-comment">/* Available video drivers */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> VideoBootStrap *bootstrap[] = { &amp;EMBOX_bootstrap, <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> SDL_VIDEO_DRIVER_COCOA &amp;COCOA_bootstrap, #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> SDL_VIDEO_DRIVER_X11 &amp;X11_bootstrap, #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> ... }</span></span></code> </pre> <br><p>  Pada dasarnya, pada titik ini Anda sudah dapat mengkompilasi SDL.  Seperti halnya libcurl, detail kompilasi akan bergantung pada sistem build tertentu, tetapi Anda perlu melakukan sesuatu seperti ini: </p><br><pre> <code class="hljs powershell">./configure -<span class="hljs-literal"><span class="hljs-literal">-host</span></span>=i386<span class="hljs-literal"><span class="hljs-literal">-unknown</span></span><span class="hljs-literal"><span class="hljs-literal">-none</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-enable</span></span><span class="hljs-literal"><span class="hljs-literal">-static</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-enable</span></span><span class="hljs-literal"><span class="hljs-literal">-audio</span></span>=no \ -<span class="hljs-literal"><span class="hljs-literal">-enable</span></span><span class="hljs-literal"><span class="hljs-literal">-video</span></span><span class="hljs-literal"><span class="hljs-literal">-directfb</span></span>=no \ -<span class="hljs-literal"><span class="hljs-literal">-enable</span></span><span class="hljs-literal"><span class="hljs-literal">-directfb</span></span><span class="hljs-literal"><span class="hljs-literal">-shared</span></span>=no \ -<span class="hljs-literal"><span class="hljs-literal">-enable</span></span><span class="hljs-literal"><span class="hljs-literal">-video</span></span><span class="hljs-literal"><span class="hljs-literal">-vulkan</span></span>=no \ -<span class="hljs-literal"><span class="hljs-literal">-enable</span></span><span class="hljs-literal"><span class="hljs-literal">-video</span></span><span class="hljs-literal"><span class="hljs-literal">-dummy</span></span>=no \ -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-x</span></span>=no make ls build/.libs/libSDL2.a <span class="hljs-comment"><span class="hljs-comment">#     </span></span></code> </pre> <br><h2 id="sobiraem-sam-quake">  Kami mengumpulkan gempa itu sendiri </h2><br><p>  Quake3 melibatkan penggunaan perpustakaan dinamis, tetapi kami akan menautkannya secara statis, seperti yang lainnya. </p><br><p>  Untuk melakukan ini, atur beberapa variabel di Makefile </p><br><pre> <code class="hljs objectivec">CROSS_COMPILING=<span class="hljs-number"><span class="hljs-number">1</span></span> USE_OPENAL=<span class="hljs-number"><span class="hljs-number">0</span></span> USE_OPENAL_DLOPEN=<span class="hljs-number"><span class="hljs-number">0</span></span> USE_RENDERER_DLOPEN=<span class="hljs-number"><span class="hljs-number">0</span></span> SHLIBLDFLAGS=-<span class="hljs-keyword"><span class="hljs-keyword">static</span></span></code> </pre> <br><h2 id="pervyy-zapusk">  Peluncuran pertama </h2><br><p>  Untuk mempermudah, kita akan berjalan di qemu / x86.  Untuk melakukan ini, Anda perlu menginstalnya (di sini dan di bawah ini akan ada perintah untuk Debian, untuk paket distribusi lainnya dapat dipanggil secara berbeda). </p><br><pre> <code class="hljs sql">sudo apt <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> qemu-<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>-i386</code> </pre> <br><p>  Dan peluncurannya sendiri: </p><br><pre> <code class="hljs powershell">qemu<span class="hljs-literal"><span class="hljs-literal">-system</span></span><span class="hljs-literal"><span class="hljs-literal">-i386</span></span> <span class="hljs-literal"><span class="hljs-literal">-kernel</span></span> build/base/bin/embox <span class="hljs-literal"><span class="hljs-literal">-m</span></span> <span class="hljs-number"><span class="hljs-number">1024</span></span> <span class="hljs-literal"><span class="hljs-literal">-vga</span></span> std <span class="hljs-literal"><span class="hljs-literal">-serial</span></span> stdio</code> </pre> <br><p>  Namun, ketika memulai Gempa, kami segera mendapatkan kesalahan </p><br><pre> <code class="hljs go">&gt; quake3 EXCEPTION [<span class="hljs-number"><span class="hljs-number">0x6</span></span>]: error = <span class="hljs-number"><span class="hljs-number">00000000</span></span> EAX=<span class="hljs-number"><span class="hljs-number">00000001</span></span> EBX=<span class="hljs-number"><span class="hljs-number">00d</span></span>56370 ECX=<span class="hljs-number"><span class="hljs-number">80200001</span></span> EDX=<span class="hljs-number"><span class="hljs-number">0781</span></span>abfd GS=<span class="hljs-number"><span class="hljs-number">00000010</span></span> FS=<span class="hljs-number"><span class="hljs-number">00000010</span></span> ES=<span class="hljs-number"><span class="hljs-number">00000010</span></span> DS=<span class="hljs-number"><span class="hljs-number">00000010</span></span> EDI=<span class="hljs-number"><span class="hljs-number">007</span></span>b5740 ESI=<span class="hljs-number"><span class="hljs-number">007</span></span>b5740 EBP=<span class="hljs-number"><span class="hljs-number">338968</span></span>ec EIP=<span class="hljs-number"><span class="hljs-number">0081d</span></span>370 CS=<span class="hljs-number"><span class="hljs-number">00000008</span></span> EFLAGS=<span class="hljs-number"><span class="hljs-number">00210202</span></span> ESP=<span class="hljs-number"><span class="hljs-number">37895d</span></span>6d SS=<span class="hljs-number"><span class="hljs-number">53535353</span></span></code> </pre><br><p>  Kesalahan tidak ditampilkan oleh game, tetapi oleh sistem operasi. <del>  Debag menunjukkan bahwa kesalahan ini disebabkan oleh dukungan SIMD yang tidak lengkap untuk x86 di QEMU: bagian dari instruksi tidak didukung dan melempar pengecualian perintah yang tidak dikenal (Opcode Tidak Valid). </del>  <em>upd: Seperti yang disarankan oleh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">WGH</a> dalam komentar, masalah sebenarnya adalah bahwa saya lupa untuk secara eksplisit mengaktifkan dukungan SSE di cr0 / cr4, jadi semuanya baik-baik saja dengan QEMU.</em> </p><br><p>  Ini terjadi bukan di Quake itu sendiri, tetapi di OpenLibM (ini adalah perpustakaan yang kami gunakan untuk mengimplementasikan fungsi matematika - <code>sin()</code> , <code>expf()</code> dan sejenisnya).  Patch OpenLibm sehingga <code>__test_sse()</code> tidak melakukan pemeriksaan nyata pada SSE, tetapi hanya percaya bahwa tidak ada dukungan. </p><br><p>  Langkah-langkah di atas sudah cukup untuk dijalankan, output berikut terlihat di konsol: </p><br><pre> <code class="hljs coffeescript">&gt; quake3 ioq3 <span class="hljs-number"><span class="hljs-number">1.36</span></span> linux-x86_64 Nov <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2018</span></span> SSE instruction set <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> available ----- FS_Startup ----- We are looking <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the current search path: <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>.q3a/baseq3 ./baseq3 ---------------------- <span class="hljs-number"><span class="hljs-number">0</span></span> files <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> pk3 files <span class="hljs-string"><span class="hljs-string">"pak0.pk3"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> missing. Please copy it <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> your legitimate Q3 CDROM. Point Release files are missing. Please re-install the <span class="hljs-number"><span class="hljs-number">1.32</span></span> point release. Also check that your ioq3 executable <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the correct place <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> that every file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the <span class="hljs-string"><span class="hljs-string">"baseq3 "</span></span> directory <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> present <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> readable ERROR: couldn<span class="hljs-string"><span class="hljs-string">'t open crashlog.txt</span></span></code> </pre> <br><p>  Sudah tidak buruk, Quake3 mencoba memulai dan bahkan menampilkan pesan kesalahan!  Seperti yang Anda lihat, ia tidak memiliki file di direktori <code>baseq3</code> .  Ini berisi suara, tekstur dan semua itu.  Catatan, <code>pak0.pk3</code> harus diambil dari CD-ROM berlisensi (ya, open source tidak menyiratkan penggunaan gratis). </p><br><h3 id="podgotovka-diska">  Persiapan disk </h3><br><pre> <code class="hljs pgsql">sudo apt install qemu-utils #  qcow2- qemu-img <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> -f qcow2 quake.img <span class="hljs-number"><span class="hljs-number">1</span></span>G #   nbd sudo modprobe nbd max_part=<span class="hljs-number"><span class="hljs-number">63</span></span> #  qcow2-      sudo qemu-nbd -c /dev/nbd0 quake.img sudo mkfs.ext4 /dev/nbd0 sudo mount /dev/nbd0 /mnt cp -r <span class="hljs-type"><span class="hljs-type">path</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>/q3/baseq3 /mnt sync sudo umount /mnt sudo qemu-nbd -d /dev/nbd0</code> </pre> <br><p>  Sekarang Anda dapat mentransfer perangkat blok ke qemu </p><br><pre> <code class="hljs powershell">qemu<span class="hljs-literal"><span class="hljs-literal">-system</span></span><span class="hljs-literal"><span class="hljs-literal">-i386</span></span> <span class="hljs-literal"><span class="hljs-literal">-kernel</span></span> build/base/bin/embox <span class="hljs-literal"><span class="hljs-literal">-m</span></span> <span class="hljs-number"><span class="hljs-number">1024</span></span> <span class="hljs-literal"><span class="hljs-literal">-vga</span></span> std <span class="hljs-literal"><span class="hljs-literal">-serial</span></span> stdio <span class="hljs-literal"><span class="hljs-literal">-hda</span></span> quake.img</code> </pre> <br><p>  Ketika sistem dimulai, pasang disk di <code>/mnt</code> dan jalankan quake3 di direktori ini, kali ini crash kemudian </p><br><pre> <code class="hljs dos">&gt; mount -t ext4 /dev/hda1 /mnt &gt; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /mnt &gt; quake3 ioq3 <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">36</span></span> linux-x86_64 Nov <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2018</span></span> SSE instruction <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> available ----- FS_Startup ----- We are looking <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the current search <span class="hljs-built_in"><span class="hljs-built_in">path</span></span>: //.q3a/baseq3 ./baseq3 ./baseq3/pak8.pk3 (<span class="hljs-number"><span class="hljs-number">9</span></span> files) ./baseq3/pak7.pk3 (<span class="hljs-number"><span class="hljs-number">4</span></span> files) ./baseq3/pak6.pk3 (<span class="hljs-number"><span class="hljs-number">64</span></span> files) ./baseq3/pak5.pk3 (<span class="hljs-number"><span class="hljs-number">7</span></span> files) ./baseq3/pak4.pk3 (<span class="hljs-number"><span class="hljs-number">272</span></span> files) ./baseq3/pak3.pk3 (<span class="hljs-number"><span class="hljs-number">4</span></span> files) ./baseq3/pak2.pk3 (<span class="hljs-number"><span class="hljs-number">148</span></span> files) ./baseq3/pak1.pk3 (<span class="hljs-number"><span class="hljs-number">26</span></span> files) ./baseq3/pak0.pk3 (<span class="hljs-number"><span class="hljs-number">3539</span></span> files) ---------------------- <span class="hljs-number"><span class="hljs-number">4073</span></span> files <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> pk3 files execing default.cfg couldn't exec q3config.cfg couldn't exec autoexec.cfg Hunk_Clear: reset the hunk ok Com_RandomBytes: using weak randomization ----- Client Initialization ----- Couldn't read q3history. ----- Initializing Renderer ---- ------------------------------- QKEY building random string Com_RandomBytes: using weak randomization QKEY generated ----- Client Initialization Complete ----- ----- R_Init ----- tty]EXCEPTION [<span class="hljs-number"><span class="hljs-number">0</span></span>xe]: error = <span class="hljs-number"><span class="hljs-number">00000000</span></span> EAX=<span class="hljs-number"><span class="hljs-number">00000000</span></span> EBX=<span class="hljs-number"><span class="hljs-number">00</span></span>d2a2d4 ECX=<span class="hljs-number"><span class="hljs-number">00000000</span></span> EDX=<span class="hljs-number"><span class="hljs-number">111011</span></span>e0 GS=<span class="hljs-number"><span class="hljs-number">00000010</span></span> <span class="hljs-built_in"><span class="hljs-built_in">FS</span></span>=<span class="hljs-number"><span class="hljs-number">00000010</span></span> ES=<span class="hljs-number"><span class="hljs-number">00000010</span></span> DS=<span class="hljs-number"><span class="hljs-number">00000010</span></span> EDI=<span class="hljs-number"><span class="hljs-number">0366</span></span>d158 ESI=<span class="hljs-number"><span class="hljs-number">111011</span></span>e0 EBP=<span class="hljs-number"><span class="hljs-number">37869918</span></span> EIP=<span class="hljs-number"><span class="hljs-number">00000000</span></span> CS=<span class="hljs-number"><span class="hljs-number">00000008</span></span> EFLAGS=<span class="hljs-number"><span class="hljs-number">00010212</span></span> ESP=<span class="hljs-number"><span class="hljs-number">006</span></span>ef6ca SS=<span class="hljs-number"><span class="hljs-number">111011</span></span>e0 EXCEPTION [<span class="hljs-number"><span class="hljs-number">0</span></span>xe]: error = <span class="hljs-number"><span class="hljs-number">00000000</span></span></code> </pre> <br><p><del>  Kesalahan ini lagi dengan SIMD di Qemu. </del>  <em>upd: Seperti yang disarankan oleh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">WGH</a> dalam komentar, masalah sebenarnya adalah bahwa saya lupa untuk secara eksplisit mengaktifkan dukungan SSE di cr0 / cr4, jadi semuanya baik-baik saja dengan QEMU.</em>  Kali ini, instruksi digunakan di mesin virtual Quake3 x86.  Masalahnya dipecahkan dengan mengganti implementasi untuk x86 dengan VM yang ditafsirkan (lebih lanjut tentang mesin virtual Quake3 dan, pada prinsipnya, fitur arsitektur, Anda dapat membaca semuanya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di artikel yang sama</a> ).  Setelah itu, fungsi kami untuk SDL mulai dipanggil, tetapi, tentu saja, tidak ada yang terjadi, karena  fungsi-fungsi ini belum melakukan apa-apa. </p><br><h2 id="dobavlyaem-podderzhku-grafiki">  Tambahkan dukungan grafis </h2><br><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> SDL_VideoDevice *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createDevice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> devindex)</span></span></span><span class="hljs-function"> </span></span>{ ... device-&gt;GL_GetProcAddress = glGetProcAddress; device-&gt;GL_CreateContext = glCreateContext; ... } <span class="hljs-comment"><span class="hljs-comment">/*   OpenGL- */</span></span> <span class="hljs-function"><span class="hljs-function">SDL_GLContext </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">glCreateContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_THIS, SDL_Window *window)</span></span></span><span class="hljs-function"> </span></span>{ OSMesaContext ctx; <span class="hljs-comment"><span class="hljs-comment">/*   -  --    .. */</span></span> sdl_init_buffers(); <span class="hljs-comment"><span class="hljs-comment">/*    Mesa */</span></span> ctx = OSMesaCreateContextExt(OSMESA_BGRA, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); OSMesaMakeCurrent(ctx, fb_base, GL_UNSIGNED_BYTE, fb_width, fb_height); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ctx; }</code> </pre> <br><p>  Handler kedua diperlukan untuk memberi tahu SDL yang berfungsi untuk memanggil saat bekerja dengan OpenGL. </p><br><p>  Untuk melakukan ini, kami memulai array dan dari awal ke awal kami memeriksa panggilan mana yang hilang, kira-kira seperti ini: </p><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *proc; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *fn; } embox_sdl_tbl[] = { { <span class="hljs-string"><span class="hljs-string">"glClear"</span></span>, glClear }, { <span class="hljs-string"><span class="hljs-string">"glClearColor"</span></span>, glClearColor }, { <span class="hljs-string"><span class="hljs-string">"glColor4f"</span></span>, glColor4f }, { <span class="hljs-string"><span class="hljs-string">"glColor4ubv"</span></span>, glColor4ubv }, { <span class="hljs-number"><span class="hljs-number">0</span></span> }, }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">glGetProcAddress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_THIS, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *proc)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; embox_sdl_tbl[i].proc != <span class="hljs-number"><span class="hljs-number">0</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(embox_sdl_tbl[i].proc, proc)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> embox_sdl_tbl[i].fn; } } <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"embox/sdl: Failed to find %s\n"</span></span>, proc); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><p>  Dalam beberapa restart, daftar menjadi cukup lengkap untuk menggambar layar pembuka dan menu.  Untungnya, Mesa memiliki semua fungsi yang diperlukan.  Satu-satunya hal adalah karena alasan tertentu tidak ada fungsi <code>glGetString()</code> , <code>glGetString()</code> harus digunakan <code>_mesa_GetString()</code> . </p><br><p>  Sekarang ketika aplikasi dimulai, layar splash muncul, bersorak! </p><br><img src="https://habrastorage.org/webt/_o/te/pv/_otepvhrhcyqp1aotjvgcylm4fs.png"><br><br><h2 id="dobavlyaem-ustroystva-vvoda">  Tambahkan perangkat input </h2><br><p>  Tambahkan dukungan keyboard dan mouse ke SDL. </p><br><p>  Untuk bekerja dengan acara, Anda perlu menambahkan penangan </p><br><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> SDL_VideoDevice *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createDevice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> devindex)</span></span></span><span class="hljs-function"> </span></span>{ ... device-&gt;PumpEvents = pumpEvents; ... }</code> </pre> <br><p>  Mari kita mulai dengan keyboard.  Kami menutup fungsi untuk mengganggu menekan / melepaskan kunci.  Fungsi ini harus mengingat peristiwa (dalam kasus paling sederhana, kita cukup menulis ke variabel lokal, antrian dapat digunakan jika diinginkan), untuk kesederhanaan kita hanya akan menyimpan acara terakhir. </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> input_event last_event; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sdl_indev_eventhnd</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">struct</span></span></span></span><span class="hljs-function"><span class="hljs-params"> input_dev *indev</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">/*    ,   last_event */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span> == input_dev_event(indev, &amp;last_event)) { } }</code> </pre><br><p>  Lalu, di <code>pumpEvents()</code> memproses acara dan meneruskannya ke SDL: </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pumpEvents</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_THIS</span></span></span><span class="hljs-function">)</span></span> { SDL_Scancode scancode; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> pressed; scancode = scancode_from_event(&amp;last_event); pressed = is_press(last_event); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pressed) { SDL_SendKeyboardKey(SDL_PRESSED, scancode); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { SDL_SendKeyboardKey(SDL_RELEASED, scancode); } }</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Lebih lanjut tentang Kode Kunci dan SDL_Scancode</b> <div class="spoiler_text"><p>  SDL menggunakan enum sendiri untuk kode kunci, jadi Anda harus mengonversi kode kunci OS ke kode SDL. </p><br><p>  Daftar kode-kode ini didefinisikan dalam file <code>SDL_scancode.h</code> </p><br><p>  Misalnya, Anda dapat mengonversi kode ASCII seperti ini (tidak semua karakter ASCII ada di sini, tetapi ini sudah cukup): </p><br><pre> <code class="hljs powershell"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> int key_to_sdl[] = { [<span class="hljs-string"><span class="hljs-string">' '</span></span>] = SDL_SCANCODE_SPACE, [<span class="hljs-string"><span class="hljs-string">'\r'</span></span>] = SDL_SCANCODE_RETURN, [<span class="hljs-number"><span class="hljs-number">27</span></span>] = SDL_SCANCODE_ESCAPE, [<span class="hljs-string"><span class="hljs-string">'0'</span></span>] = SDL_SCANCODE_0, [<span class="hljs-string"><span class="hljs-string">'1'</span></span>] = SDL_SCANCODE_1, ... [<span class="hljs-string"><span class="hljs-string">'8'</span></span>] = SDL_SCANCODE_8, [<span class="hljs-string"><span class="hljs-string">'9'</span></span>] = SDL_SCANCODE_9, [<span class="hljs-string"><span class="hljs-string">'a'</span></span>] = SDL_SCANCODE_A, [<span class="hljs-string"><span class="hljs-string">'b'</span></span>] = SDL_SCANCODE_B, [<span class="hljs-string"><span class="hljs-string">'c'</span></span>] = SDL_SCANCODE_C, ... [<span class="hljs-string"><span class="hljs-string">'x'</span></span>] = SDL_SCANCODE_X, [<span class="hljs-string"><span class="hljs-string">'y'</span></span>] = SDL_SCANCODE_Y, [<span class="hljs-string"><span class="hljs-string">'z'</span></span>] = SDL_SCANCODE_Z, };</code> </pre></div></div><br><p>  Itu saja dengan keyboard, sisanya akan ditangani oleh SDL dan Quake sendiri.  Ngomong-ngomong, ternyata di sekitar sini bahwa di suatu tempat dalam pemrosesan penekanan tombol, gempa menggunakan instruksi yang tidak didukung oleh QEMU, Anda harus beralih ke mesin virtual yang ditafsirkan dari mesin virtual x86, untuk ini kami menambahkan <code>BASE_CFLAGS += -DNO_VM_COMPILED</code> ke Makefile. </p><br><p>  Setelah itu, akhirnya, Anda bisa "melewatkan" screensaver dan bahkan memulai permainan (meretas beberapa kesalahan :)).  Sangat terkejut bahwa semuanya dibuat sebagaimana mestinya, meskipun dengan fps yang sangat rendah. </p><br><p><img src="https://habrastorage.org/webt/fk/rx/cj/fkrxcjn_k-kheteoo4ak1tdwb2q.png"></p><br><p>  Sekarang Anda dapat memulai dukungan mouse.  Untuk interupsi mouse, Anda perlu satu handler lagi, dan penanganan event perlu sedikit rumit.  Kami membatasi diri hanya untuk tombol mouse kiri.  Jelas bahwa dengan cara yang sama, Anda dapat menambahkan kunci, roda, dll. </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pumpEvents</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_THIS</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (from_keyboard(&amp;last_event)) { <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> ... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_left_click(&amp;last_event)) { <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> SDL_SendMouseButton(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, SDL_PRESSED, SDL_BUTTON_LEFT); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_left_release(&amp;last_event)) { <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> SDL_SendMouseButton(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, SDL_RELEASED, SDL_BUTTON_LEFT); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> SDL_SendMouseMotion(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, mouse_diff_x(), <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> mouse_diff_y()); <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> } } }</code> </pre> <br><p>  Setelah itu, menjadi mungkin untuk mengontrol kamera dan memotret, tepuk tangan!  Sebenarnya, ini sudah cukup untuk dimainkan :) </p><br><p><img src="https://habrastorage.org/webt/q5/pz/lb/q5pzlbtkbrinpcmgdggt4e5vfma.png"></p><br><h2 id="optimizaciya">  Optimasi </h2><br><p>  Tentu saja keren, bahwa ada kontrol dan beberapa jenis gambar, tetapi FPS seperti itu benar-benar tidak berharga.  Kemungkinan besar, sebagian besar waktu dihabiskan untuk OpenGL (dan ini adalah perangkat lunak, dan, apalagi, SIMD tidak digunakan), dan implementasi dukungan perangkat keras adalah tugas yang terlalu panjang dan sulit. </p><br><p>  Mari kita coba percepat permainan dengan sedikit darah. </p><br><h3 id="optimizaciya-kompilyatora-i-snizhenie-razresheniya">  Optimalisasi kompiler dan resolusi lebih rendah </h3><br><p>  Kami sedang membangun permainan, semua perpustakaan, dan OS itu sendiri dengan <code>-O3</code> (jika, tiba-tiba, seseorang membaca ke tempat ini, tetapi tidak tahu apa bendera ini - lebih banyak tentang bendera optimasi GCC dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> ). </p><br><p>  Selain itu, kami menggunakan resolusi minimum - 320x240 untuk memudahkan kerja prosesor. </p><br><h3 id="kvm">  Kvm </h3><br><p>  KVM (Mesin Virtual berbasis Kernel) memungkinkan Anda untuk menggunakan virtualisasi perangkat keras (Intel VT dan AMD-V) untuk meningkatkan kinerja.  Qemu mendukung mekanisme ini, untuk menggunakannya Anda perlu melakukan hal berikut. </p><br><p>  Pertama, Anda perlu mengaktifkan dukungan virtualisasi di BIOS.  Saya memiliki motherboard Gigabyte B450M DS3H, dan AMD-V dihidupkan melalui MIT -&gt; Pengaturan Frekuensi Lanjut -&gt; Pengaturan Inti CPU Lanjutan -&gt; Mode SVM -&gt; Diaktifkan (Gigabyte, ada apa dengan Anda?). </p><br><p>  Kemudian kami meletakkan paket yang diperlukan dan menambahkan modul yang sesuai </p><br><pre> <code class="hljs powershell">sudo apt install qemu<span class="hljs-literal"><span class="hljs-literal">-kvm</span></span> sudo modprobe kvm<span class="hljs-literal"><span class="hljs-literal">-amd</span></span> <span class="hljs-comment"><span class="hljs-comment">#  kvm-intel</span></span></code> </pre> <br><p>  Itu saja, sekarang Anda dapat melewati qemu flag <code>-enable-kvm</code> (atau <code>-no-kvm</code> agar tidak menggunakan akselerasi perangkat keras). </p><br><h2 id="itog">  Ringkasan </h2><br><iframe width="560" height="315" src="https://www.youtube.com/embed/t6k_FSF-py0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Permainan dimulai, grafik ditampilkan sesuai kebutuhan, kontrol berfungsi.  Sayangnya, gambar diambil pada CPU dalam satu aliran, juga tanpa SIMD, karena fps rendah (2-3 frame per detik) sangat tidak nyaman untuk dikendalikan. </p><br><p>  Proses porting menarik.  Mungkin di masa depan akan dimungkinkan untuk meluncurkan gempa pada platform dengan akselerasi grafis perangkat keras, tetapi untuk sekarang saya akan fokus pada apa yang ada. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id428634/">https://habr.com/ru/post/id428634/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id428624/index.html">Jeffrey Richter, Pavel Yosifovich, Greg Young dan semuanya. Hardcore dan arsitektur di DotNext 2018 Moscow</a></li>
<li><a href="../id428626/index.html">Cara membuat ekstensi di PHP7 lebih sulit daripada "halo, dunia", dan tidak menjadi mata merah. Bagian 1</a></li>
<li><a href="../id428628/index.html">Bekerja dengan pohon sintaksis JavaScript abstrak</a></li>
<li><a href="../id428630/index.html">Tidak, Bitcoin tidak akan menghancurkan iklim kita pada tahun 2033.</a></li>
<li><a href="../id428632/index.html">Berurusan dengan Pencegat dalam Bereaksi</a></li>
<li><a href="../id428636/index.html">Roskomnadzor akan memulihkan denda dari Google</a></li>
<li><a href="../id428638/index.html">Hearts Flame Motor: QardioCore Heart Monitor Review</a></li>
<li><a href="../id428640/index.html">Dengan handset di saku Anda: Peralatan Snom DECT untuk jaringan telepon nirkabel</a></li>
<li><a href="../id428644/index.html">Brainfuck tingkat rendah</a></li>
<li><a href="../id428646/index.html">Model iPhone tahun lalu juga melambat karena baterai habis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>