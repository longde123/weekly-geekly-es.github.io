<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüë®‚Äçüëß‚Äçüë¶ üå¶Ô∏è üë®‚Äçüë®‚Äçüëß DRO universal basado en Arduino Nano - shDRO. Parte 2 ‚òùüèΩ ‚úçüèæ üåû</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola de nuevo 

 Sigo describiendo mi desarrollo de shDRO. En esta secci√≥n, describir√© el algoritmo de sondeo del dispositivo y el formato de los coma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DRO universal basado en Arduino Nano - shDRO. Parte 2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446458/">  Hola de nuevo <br><br>  Sigo describiendo mi desarrollo de shDRO.  En esta secci√≥n, describir√© el algoritmo de sondeo del dispositivo y el formato de los comandos de la consola. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">La primera parte</a> <br><a name="habracut"></a><br>  <b>Firmware</b> <br><br>  Como el n√∫mero de canales / puertos a los que se pueden conectar los lectores es de 12, y cada canal se puede configurar te√≥ricamente para interrumpir, se utilizan dos manejadores de interrupci√≥n PCINT (para los puertos D y C).  Esto implica una limitaci√≥n en la conexi√≥n: todas las salidas del dispositivo que est√°n configuradas para entrada deben estar conectadas a los canales de un grupo.  Si el canal est√° configurado para salida, entonces para el dispositivo actual, no importa a qu√© grupo pertenece.  Grupos: grupo1 (canales 0-5), grupo2 (canales 6-11). <br><br>  Se usan dos memorias intermedias de anillo, de 256 bytes cada una, para los manejadores de interrupciones. <br><br>  El c√≥digo del controlador de interrupciones es: <br><br><pre><code class="cpp hljs">buf[pos] = DATA_N; pos++;</code> </pre> <br>  Donde DATA_N es uno de los puertos: PIND, PINC. <br><br>  El procesamiento de datos es el siguiente: <br><br><ul><li>  se produce una interrupci√≥n, se escribe un nuevo valor de puerto en el b√∫fer; </li><li>  el b√∫fer se sondea peri√≥dicamente y de √©l se leen los datos que aparecieron despu√©s de la √∫ltima encuesta (la posici√≥n del b√∫fer de la √∫ltima encuesta se almacena en la estructura del dispositivo); </li><li>  En el proceso de lectura de nuevos datos, los niveles de interrupci√≥n establecidos para los canales se comparan con los datos del puerto actual.  Si el nivel de interrupci√≥n no coincide, los datos se ignoran. </li><li>  comprueba que se hayan aceptado todos los datos para el procesamiento (por ejemplo, se deben recibir 24 bits para el protocolo BIN6); </li><li>  los datos se procesan de forma "legible" y los datos procesados ‚Äã‚Äãse muestran en la pantalla; </li><li>  entonces el proceso se repite; </li></ul><br>  Para implementar la l√≥gica anterior, se implementan los siguientes m√≥dulos l√≥gicos en el firmware: <br><br><ul><li>  Dispositivo: el m√≥dulo contiene toda la informaci√≥n sobre un dispositivo conectado.  Para cada dispositivo conectado, se crea dicho m√≥dulo; </li><li>  Protocolo: el m√≥dulo contiene informaci√≥n sobre el protocolo y c√≥mo procesar las se√±ales que llegan a los puertos de acuerdo con este protocolo de intercambio; </li><li>  Funci√≥n: el m√≥dulo contiene informaci√≥n sobre c√≥mo convertir los datos recibidos del m√≥dulo Protocolo.  Por ejemplo, hay un m√≥dulo de protocolo que admite una se√±al de cuadratura, pero los dispositivos que emiten una se√±al de cuadratura pueden ser diferentes: puede ser una regla √≥ptica o un sensor de velocidad.  Es decir  en un caso, los datos deben convertirse a mm o pulgadas, y en el otro rpm.  Este m√≥dulo solo hace esto; </li><li>  Led: un m√≥dulo que muestra informaci√≥n sobre indicadores.  shDRO contiene 4 indicadores, y para cada dispositivo se configura el indicador de visualizaci√≥n deseado; </li></ul><br>  Como resultado, para conectar el dispositivo, en la consola necesita: <br><br><ul><li>  configurar los canales deseados; </li><li>  agregar dispositivo; </li><li>  para protocolo de conjunto de dispositivos, funci√≥n y led; </li><li>  agregar / vincular los canales necesarios al dispositivo; </li></ul><br>  <b>Consola</b> <br><br>  Por el momento, verifiqu√© el funcionamiento de la consola en el monitor de puerto ArduinoIDE y en la Terminal v.1.9b.  Para terminales del tipo Putty, debe implementar el modo de eco (no implementado). <br><br>  Formato de comando: <br><br><pre> <code class="plaintext hljs">&lt;&gt; &lt;/1&gt; &lt;_1&gt; &lt;/N&gt; &lt;_N&gt;</code> </pre> <br>  El n√∫mero m√°ximo de argumentos por l√≠nea es 5. <br><br>  El caso no importa; el an√°lisis del comando se produce despu√©s de que la cadena se convierte en min√∫scula (excepci√≥n: el valor del argumento entre comillas). <br><br>  Todos los comandos se ejecutan solo despu√©s de emitir el comando de configuraci√≥n (una excepci√≥n es el comando de Ayuda, que muestra una lista de todos los comandos disponibles). <br><br>  Todos los comandos se describen en el archivo adjunto, as√≠ como en la primera versi√≥n del firmware en formato hexadecimal. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">shDRO.zip (.hex + descripci√≥n de comandos)</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fuentes de ShDRO</a> <br><br>  Continuar√° <br><br>  Gracias <br><br>  PS <br>  Los comandos relacionados con la configuraci√≥n de dispositivos y canales se pueden enviar al arduino sin correas. <br><br>  PS1 <br>  Solicitud a quienes viven en Kazan. <br>  Si tienes: <br><ul><li>  pinzas digitales que funcionan seg√∫n los protocolos: 24BIT, BCD7; </li><li>  iGaging reglas digitales (protocolo 21BIT); </li></ul><br>  entonces, ¬øpodr√≠as darme un par de d√≠as para escribir y depurar protocolos para ellos? <br>  ¬°Prometo mantenerlos sanos y salvos! <br>  Pero esto es en la tarde.  Gracias de antemano. <br><br>  PS2 <br>  Olvid√© agregar dos comandos al archivo de descripci√≥n del comando: <br>  - guardar: guarda la configuraci√≥n de canales y dispositivos en la EEPROM; <br>  - cargar: descarga la configuraci√≥n de canales y dispositivos desde la EEPROM (la carga se realiza autom√°ticamente durante la inicializaci√≥n); <br>  No volver√© a cargar el archivo, solo tenlo en cuenta.  Pero "ayuda" muestra estos comandos. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/446458/">https://habr.com/ru/post/446458/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../446446/index.html">Conceptos b√°sicos del motor de JavaScript: formularios generales y almacenamiento en cach√© en l√≠nea. Parte 1</a></li>
<li><a href="../446448/index.html">5 reglas b√°sicas para realizar entrevistas problem√°ticas para identificar las necesidades del consumidor</a></li>
<li><a href="../446452/index.html">Misi√≥n lunar "Bereshit": el 4 de abril de 2019, se complet√≥ la transici√≥n a la √≥rbita lunar, 7 d√≠as de vuelo por delante, 6 maniobras y 1 aterrizaje</a></li>
<li><a href="../446454/index.html">Desarrollo del servidor web de Golang: de f√°cil a complejo</a></li>
<li><a href="../446456/index.html">Sustituci√≥n de importaciones en la pr√°ctica. Parte 1. Opciones</a></li>
<li><a href="../446460/index.html">Food Design Digest Marzo 2019</a></li>
<li><a href="../446462/index.html">Inmersi√≥n en el controlador: el principio general de reversa utilizando el ejemplo de la tarea NeoQUEST-2019</a></li>
<li><a href="../446464/index.html">15 loros: elija un proveedor de alojamiento para servidores VPS / VDS</a></li>
<li><a href="../446466/index.html">Content Marketing for Business: Habraseminar # 6 y sus puntos principales</a></li>
<li><a href="../446468/index.html">Gu√≠a pr√°ctica de variables de entorno en Go</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>