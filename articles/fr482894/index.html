<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧚🏼 👩🏽‍🏭 ↖️ Génération procédurale adaptative utilisant l'algorithme WaveFunctionCollapse et la distribution de probabilité a priori 👩🏿‍💼 🌠 💆🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Qu'est-ce que la génération procédurale? 
 La génération procédurale comprend de nombreux algorithmes génératifs, dont le principe est de créer des do...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Génération procédurale adaptative utilisant l'algorithme WaveFunctionCollapse et la distribution de probabilité a priori</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482894/"><h1>  Qu'est-ce que la génération procédurale? </h1><br>  La génération procédurale comprend de nombreux algorithmes génératifs, dont le principe est de créer des données non pas manuellement, mais de façon algorithmique: au lieu de fabriquer manuellement ce que nous voulons créer (cartes, musique, terrain ...), un algorithme est écrit qui peut créer avec succès divers exemples sans effectuer le même processus plusieurs fois.  Cette approche est particulièrement utile dans les jeux vidéo où une carte ou un niveau entier peut être généré de manière aléatoire (par exemple, des cartes dans Minecraft, Terraria ou Factorio, ou des schémas de niveaux dans la plupart des roguelike). <br><br><h1>  L'algorithme d'effondrement de la fonction d'onde et sa portée </h1><br>  Dans cet article, nous examinons <a href="https://github.com/mxgmn/WaveFunctionCollapse" rel="noopener nofollow">l'algorithme d'effondrement de la fonction d'onde (WaveFunctionCollapse, WFC)</a> proposé par <a href="https://twitter.com/exutumno%3Flang%3Dca" rel="noopener nofollow">Maxim Gumin</a> (son Twitter a une collection de contenu incroyable créé en utilisant cet algorithme par d'autres développeurs!) Pour la génération procédurale d'images ou de terrain en créant des images qui sont localement similaires à celles entrantes image dans une grille d'une taille donnée. <br><br>  L'algorithme est basé sur l'idée de création pas à pas d'une image finie avec suivi des tuiles «correspondant» à une image déjà partiellement construite.  Pour étudier la description détaillée de l'algorithme, nous vous recommandons de vous référer au <a href="https://github.com/mxgmn/WaveFunctionCollapse" rel="noopener nofollow">référentiel WFC d'origine sur Github</a> et à la quatrième section de l'article " <a href="https://adamsmith.as/papers/wfc_is_constraint_solving_in_the_wild.pdf" rel="noopener nofollow">WaveFunctionCollapse est la résolution des contraintes dans la nature</a> ". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/887/cab/bc8/887cabbc82864fa16f590d3e6ca859e1.png"></div><br>  <i>Exemples d'images de départ générées de manière procédurale</i> <br><a name="habracut"></a><br>  En plus de créer des images similaires, un autre domaine d'application de l'algorithme WFC est la génération de cartes de tuiles.  La génération de cartes de tuiles sera le sujet principal de l'article, car il est plus facile à utiliser pour expliquer clairement nos idées.  Au lieu d'une image d'exemple, vous ne pouvez stocker que des tuiles et des paires de tuiles qui peuvent être connectées les unes aux autres à tour de rôle.  Dans ce cas, l'algorithme peut être utilisé pour créer des images similaires à celle illustrée ci-dessous. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e72/7d0/cfc/e727d0cfc2cf088a7fa82d04513dfe1e.png"></div><br>  <i>Exemples de tuiles générées au hasard</i> <br><br><h2>  Le défi et notre solution </h2><br>  Nous avons pris la tâche de générer une carte tuile basée sur le jeu de plateau <a href="https://boardgamegeek.com/boardgame/822/carcassonne" rel="noopener nofollow">Carcassonne</a> («Carcassonne»), dans laquelle le champ est généré par les joueurs «manuellement» (voir animation ci-dessous) à partir des tuiles qui doivent être combinées entre elles. <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 57.501%;"><video loop="" muted="" webkit-playsinline="" autoplay="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Votre navigateur ne prend pas en charge la vidéo HTML5. <source src="https://thumbs.gfycat.com/OilyFarAmericanpainthorse-mobile.mp4" type="video/mp4"></video></div></div></div><br>  Étonnamment, conceptuellement, cela est très similaire à l'algorithme WFC pour créer des cartes de tuiles arbitraires en ajoutant de nouvelles pièces à une solution incomplète.  Et comme WaveFunctionCollapse peut être utilisé comme générateur de cartes de tuiles, il peut également générer des champs "Carcassonne"! <br><br>  Cependant, dans le jeu lui-même, il y a trop de tuiles différentes, et coder tous leurs ratios est une tâche trop volumineuse pour un hackathon de 24 heures.  Par conséquent, nous avons décidé de jouer une version très simplifiée de "Carcassonne" sans châteaux et rivières, uniquement avec des routes, de l'herbe et des monastères.  Nous avons donc obtenu 6 tuiles possibles avec leurs rotations et leur symétrie.  Mais même dans de telles conditions, le résultat est magnifique et ressemble à un vrai match à Carcassonne! <br><br><div class="oembed"><div style="max-width: 100vh;"><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 100%;"><video loop="" muted="" webkit-playsinline="" autoplay="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Votre navigateur ne prend pas en charge la vidéo HTML5. <source src="https://thumbs.gfycat.com/DimThornyBunny-mobile.mp4" type="video/mp4"></video></div></div></div><br>  <i>Visualisation du remplissage de l'algorithme de champ de Carcassonne</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8fe/681/d89/8fe681d89415778bf69d4fab4e735d27.png"></div><br>  <i>Exemple de règles introduites dans l'algorithme</i> <br><br>  L'image ci-dessus contient un exemple de règles d'entrée ajoutées à l'algorithme.  Cependant, nous devons encore contrôler certains aspects de l'apparence du champ.  L'algorithme devrait-il créer des «rues» à partir de routes remplies de monastères et similaires à une ville, ou le champ devrait-il être constitué d'herbe avec des villages dispersés autour d'elle?  Dans l'algorithme d'origine, il n'y a aucun moyen de contrôler de telles conditions (comme les autres), mais pour la possibilité de contrôle, il est possible d'apporter une amélioration simple. <br><br><h2>  Distribution de probabilité a priori bayésienne </h2><br>  Comme mentionné ci-dessus, à chaque étape, l'algorithme ajoute une nouvelle tuile au champ afin qu'elle corresponde aux tuiles déjà placées, mais nous n'avons pas dit ce qui se passerait si plusieurs tuiles différentes pouvaient être placées à l'emplacement sélectionné (nous n'avons pas non plus expliqué comment choisissez généralement cet endroit, mais dans l'article, nous ne le considérerons pas!).  Dans l'algorithme d'origine, n'importe quelle tuile appropriée est sélectionnée de manière uniforme et aléatoire.  Cependant, dans notre décision, nous pouvons préférer des tuiles spécifiques, par exemple, de l'herbe, afin qu'elles se produisent plus souvent sur le terrain.  Cela peut être réalisé en créant une distribution inégale de «probabilité préalable» de tuiles, dans laquelle l'herbe a plus de chances d'être utilisée que la route, si les deux types de tuiles peuvent être utilisés.  Cela rappelle les techniques bayésiennes.  Dans le cas simplifié du choix entre deux options, l'herbe et les routes, on peut ajouter de l'herbe avec une probabilité p&gt; 0,5, et non pas avec l'habituel 0,5, obtenu avec une probabilité uniforme.  Cette tâche peut être facilement généralisée en attribuant une valeur de priorité à chaque tuile et en utilisant cette valeur pour définir la probabilité comme une valeur divisée par la somme des valeurs de toutes les tuiles possibles.  La figure ci-dessous montre deux solutions appropriées avec des valeurs de coefficient très différentes, ce qui permet de comprendre la sensibilité de l'algorithme. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b6f/4b0/30a/b6f4b030a2b8a2baf17b5e140a5afce8.png"></div><br>  <i>Différentes solutions pour différentes distributions de probabilité initiales a priori</i> <br><br><h2>  Autre exemple: probabilités conditionnelles et regroupement </h2><br>  Vous pouvez développer cette idée, et pour illustrer cela, nous allons générer, au lieu des champs de Carcassonne, des cartes bidimensionnelles du minerai Minecraft.  Différents types de minerais dans Minecraft se trouvent généralement dans de grandes formations, donc en plus de définir les probabilités de chaque minerai, nous dépendrons des probabilités en fonction des voisins déjà placés sur la carte.  Même s'il n'y a rien «d'interdit» dans la disposition du fer à côté du charbon, à côté du charbon déjà placé, un autre charbon est prioritaire. <br><br>  Bien que cela ne soit pas pris en compte dans l'image ci-dessous, dans le jeu, la probabilité dépend également de la hauteur des tuiles, donc la position dans l'image peut également affecter les conditions de distribution des probabilités de tuile. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c84/715/69e/c8471569ee2741d7a7f781154e520136.png"></div><br>  <i>Exemple de carte de tuiles de minerai Minecraft créé par WFC</i> <br><br><h1>  Conclusion </h1><br>  La génération procédurale est un outil puissant qui vaut la peine d'être en stock.  En particulier, le WFC est activement utilisé dans la génération mondiale, et il convient de considérer la possibilité que la distribution de nouvelles tuiles soit inégale et puisse être influencée par d'autres facteurs, par exemple, les voisins déjà placés sur la carte, les nouvelles tuiles et la position dans l'image.  Nous avons créé une application très simple, mais les possibilités de développement sont presque infinies! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr482894/">https://habr.com/ru/post/fr482894/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr482882/index.html">Le moteur comme frein électromagnétique</a></li>
<li><a href="../fr482884/index.html">Leçon du soir: écriture de la coloration syntaxique</a></li>
<li><a href="../fr482886/index.html">Analyse Habra: la durée de publication est-elle importante?</a></li>
<li><a href="../fr482888/index.html">Lancement d'un serveur VPN derrière le fournisseur NAT</a></li>
<li><a href="../fr482892/index.html">Soit vs const - quoi utiliser?</a></li>
<li><a href="../fr482896/index.html">OSCP - Mon expérience</a></li>
<li><a href="../fr482898/index.html">Histoire de l'épuisement professionnel à Moscou - de 1996 à 2017. Le chemin du haut dirigeant de la société d'État aux chercheurs</a></li>
<li><a href="../fr482900/index.html">Merchandising automatique pour en ligne ou comment j'ai inventé un vélo</a></li>
<li><a href="../fr482902/index.html">Non, l'intelligence artificielle ne peut pas nous vaincre</a></li>
<li><a href="../fr482904/index.html">Une brève histoire des microprocesseurs spatiaux, première partie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>