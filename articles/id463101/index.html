<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙆🏿 🍗 🐿️ Mengelola ratusan server untuk pengujian beban: autoscaling, pemantauan khusus, budaya DevOps 🌴 🐕 👨🏼‍🏫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam artikel sebelumnya, saya berbicara tentang infrastruktur uji beban besar kami. Rata-rata, kami membuat sekitar 100 server untuk memasok beban da...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mengelola ratusan server untuk pengujian beban: autoscaling, pemantauan khusus, budaya DevOps</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/miro/blog/463101/">  Dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel sebelumnya,</a> saya berbicara tentang infrastruktur uji beban besar kami.  Rata-rata, kami membuat sekitar 100 server untuk memasok beban dan sekitar 150 server untuk layanan kami.  Semua server ini harus dibuat, dihapus, dikonfigurasi, dan dijalankan.  Untuk melakukan ini, kami menggunakan alat yang sama seperti pada prod untuk mengurangi jumlah pekerjaan manual: <br><br><ul><li>  Untuk membuat dan menghapus lingkungan pengujian - Skrip Terraform; </li><li>  Untuk mengonfigurasi, memperbarui, dan menjalankan - Skrip yang mungkin; </li><li>  Untuk penskalaan dinamis tergantung pada beban - skrip Python yang ditulis sendiri. </li></ul><br>  Berkat skrip Terraform dan Ansible, semua operasi mulai dari membuat instance hingga memulai server dilakukan hanya dengan enam perintah: <br><br><pre><code class="plaintext hljs">#     aws ansible-playbook deploy-config.yml #   ansible-playbook start-application.yml #      ansible-playbook update-test-scenario.yml --ask-vault-pass # Jmeter ,      infrastructure-aws-cluster/jmeter_clients:~# terraform apply # jmeter     ansible-playbook start-jmeter-server-cluster.yml # jmeter  ansible-playbook start-stress-test.yml # </code> </pre> <br><a name="habracut"></a><h2>  Penskalaan server dinamis </h2><br>  Pada jam sibuk produksi, kami memiliki lebih dari 20 ribu pengguna online pada saat yang sama, dan pada jam lain mungkin ada 6 ribu.  Tidak masuk akal untuk terus menjaga volume penuh server, jadi kami mengatur penskalaan otomatis untuk server-papan, di mana papan terbuka saat pengguna memasukinya, dan untuk server-API yang memproses permintaan API.  Sekarang server dibuat dan dihapus jika perlu. <br><br>  Mekanisme seperti ini sangat efektif dalam pengujian beban: secara default, kita dapat memiliki jumlah minimum server, dan pada saat pengujian mereka akan secara otomatis naik dalam jumlah yang tepat.  Pada awalnya, kita dapat memiliki 4 server papan, dan pada puncaknya - hingga 40. Pada saat yang sama, server baru tidak dibuat segera, tetapi hanya setelah server saat ini dimuat.  Misalnya, kriteria untuk membuat instance baru mungkin 50% dari pemanfaatan CPU.  Ini memungkinkan Anda untuk tidak memperlambat pertumbuhan pengguna virtual dalam skrip dan tidak membuat server yang tidak perlu. <br><br>  Bonus dari pendekatan ini adalah bahwa berkat penskalaan dinamis, kami mempelajari berapa kapasitas yang kami butuhkan untuk jumlah pengguna yang berbeda, yang belum kami miliki pada penjualan tersebut. <br><br><h2>  Koleksi metrik seperti pada prod </h2><br>  Ada banyak pendekatan dan alat untuk memantau tes stres, tetapi kami melakukannya dengan caranya sendiri. <br><br>  Kami memantau produksi dengan tumpukan standar: Logstash, Elasticsearch, Kibana, Prometheus dan Grafana.  Cluster kami untuk pengujian mirip dengan produk, jadi kami memutuskan untuk melakukan pemantauan yang sama dengan prod, dengan metrik yang sama.  Ada dua alasan untuk ini: <br><br><ul><li>  Tidak perlu membangun sistem pemantauan dari awal, kami sudah memilikinya lengkap dan segera; </li><li>  Kami juga menguji pemantauan penjualan: jika selama pemantauan pengujian kami memahami bahwa kami tidak memiliki cukup data untuk menganalisis masalah, maka mereka tidak akan cukup untuk produksi, ketika masalah seperti itu muncul di sana. </li></ul><br><img src="https://habrastorage.org/webt/rp/f6/8n/rpf68nydaytyhyw62bd6vegvbmy.png"><br><br><h2>  Apa yang kami tunjukkan dalam laporan </h2><br><ul><li>  Karakteristik teknis dudukan; </li><li>  Script itu sendiri, dijelaskan dalam kata-kata, bukan kode; </li><li>  Hasil yang dapat dimengerti oleh semua anggota tim, baik pengembang maupun manajer; </li><li>  Grafik keadaan umum dudukan; </li><li>  Grafik yang menunjukkan bottleneck atau yang dipengaruhi oleh optimasi diperiksa dalam tes. </li></ul><br>  Penting bahwa semua hasil disimpan di satu tempat.  Jadi akan lebih mudah untuk membandingkan mereka satu sama lain dari peluncuran ke peluncuran. <br><br>  Kami membuat laporan dalam produk kami <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">(contoh papan tulis dengan laporan)</a> : <br><br><img src="https://habrastorage.org/webt/ot/li/tf/otlitfwav4v-cby0ipnrin4xhxk.png"><br><br>  Membuat laporan membutuhkan banyak waktu.  Karena itu, kami berencana untuk membuat pengumpulan informasi umum otomatis menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">API publik kami</a> . <br><br><h2>  Infrastruktur sebagai kode </h2><br>  Kami bertanggung jawab atas kualitas produk, bukan QA Engineers, tetapi seluruh tim.  Tes stres adalah salah satu alat jaminan kualitas.  Keren, jika tim mengerti bahwa penting untuk memeriksa di bawah memuat perubahan yang telah dibuat.  Untuk mulai memikirkannya, dia harus bertanggung jawab atas produksi.  Di sini kami dibantu oleh prinsip-prinsip budaya DevOps, yang kami mulai terapkan dalam pekerjaan kami. <br><br>  Tetapi mulai berpikir untuk melakukan tes stres hanyalah langkah pertama.  Tim tidak akan dapat memikirkan tes tanpa memahami perangkat produksi.  Kami menghadapi masalah seperti itu ketika kami mulai mengatur proses melakukan tes beban dalam tim.  Pada saat itu, tim tidak memiliki cara untuk mengetahui alat produksi, sehingga sulit bagi mereka untuk bekerja pada desain tes.  Ada beberapa alasan: kurangnya dokumentasi terbaru atau satu orang yang akan menyimpan seluruh gambar di kepala;  beberapa pertumbuhan tim pengembangan. <br><br>  Untuk membantu tim memahami pekerjaan penjualan, pendekatan Infrastruktur dapat digunakan sebagai kode, yang mulai kami gunakan dalam tim pengembangan. <br><br>  Masalah apa yang sudah kami mulai pecahkan dengan menggunakan pendekatan ini: <br><br><ul><li>  Semuanya harus ditulis dan dapat dinaikkan kapan saja.  Ini secara signifikan mengurangi waktu pemulihan untuk penjualan jika terjadi kecelakaan pusat data dan memungkinkan Anda untuk menjaga jumlah lingkungan pengujian yang relevan dengan tepat; </li><li>  Penghematan yang wajar: kami menerapkan lingkungan di Openstack ketika itu dapat menggantikan platform mahal seperti AWS; </li><li>  Tim sendiri membuat tes stres karena mereka mengerti perangkat itu laku; </li><li>  Kode menggantikan dokumentasi, sehingga tidak perlu memperbaharuinya tanpa henti, selalu lengkap dan terkini; </li><li>  Anda tidak perlu ahli terpisah di bidang sempit untuk menyelesaikan masalah biasa.  Insinyur mana pun dapat mengetahui kode tersebut; </li><li>  Dengan struktur penjualan yang jelas, jauh lebih mudah untuk menjadwalkan tes beban penelitian seperti pengujian kekacauan monyet atau tes kebocoran memori yang panjang. </li></ul><br>  Saya ingin memperluas pendekatan ini tidak hanya untuk penciptaan infrastruktur, tetapi juga dengan dukungan berbagai alat.  Sebagai contoh, tes database, yang saya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bicarakan di artikel sebelumnya</a> , kami benar-benar berubah menjadi kode.  Karena itu, alih-alih situs yang disiapkan sebelumnya, kami memiliki serangkaian skrip, yang dengannya dalam 7 menit kami mendapatkan lingkungan yang dikonfigurasi dalam akun AWS yang benar-benar kosong dan dapat memulai pengujian.  Untuk alasan yang sama, kami sekarang mempertimbangkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Gatling</a> dengan hati-hati, yang pembuatnya posisikan sebagai alat untuk "Memuat uji sebagai kode". <br><br>  Pendekatan infrastruktur sebagai kode memerlukan pendekatan yang sama untuk mengujinya dan skrip yang ditulis tim untuk meningkatkan infrastruktur fitur baru.  Semua ini harus ditanggung oleh tes.  Ada juga berbagai kerangka kerja pengujian, seperti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Molekul</a> .  Ada alat untuk pengujian kekacauan monyet, untuk AWS ada alat berbayar, untuk Docker ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pumba</a> , dll.  Mereka memungkinkan Anda untuk menyelesaikan berbagai jenis tugas: <br><br><ul><li>  Cara memeriksa apakah salah satu contoh di AWS lumpuh untuk memeriksa apakah beban pada server yang tersisa diseimbangkan kembali dan jika layanan akan selamat dari pengalihan permintaan yang sedemikian tajam; </li><li>  Bagaimana mensimulasikan operasi lambat jaringan, kerusakan dan masalah teknis lainnya, setelah itu logika infrastruktur layanan tidak boleh rusak. </li></ul><br>  Solusi masalah seperti itu dalam rencana langsung kami. <br><br><h2>  Kesimpulan </h2><br><ol><li>  Tidak sepadan dengan waktu untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mengatur</a> secara manual <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">infrastruktur</a> pengujian, lebih baik mengotomatiskan tindakan ini untuk mengelola semua lingkungan dengan lebih andal, termasuk prod; </li><li>  Penskalaan dinamis secara signifikan mengurangi biaya mempertahankan penjualan dan lingkungan pengujian yang besar, dan juga mengurangi faktor manusia saat penskalaan; </li><li>  Anda tidak dapat menggunakan sistem pemantauan terpisah untuk pengujian, tetapi ambil dari pasar; </li><li>  Adalah penting bahwa laporan stress test dikumpulkan secara otomatis di satu tempat dan memiliki pandangan yang seragam.  Ini akan memungkinkan mereka untuk dengan mudah membandingkan dan menganalisis perubahan; </li><li>  Tes stres akan menjadi proses di perusahaan ketika tim merasa bertanggung jawab atas penjualan; </li><li>  Tes beban - tes infrastruktur.  Jika tes beban berhasil, ada kemungkinan itu tidak dikompilasi dengan benar.  Validasi kebenaran tes membutuhkan pemahaman yang mendalam tentang penjualan.  Tim harus memiliki kesempatan untuk memahami perangkat penjualan secara mandiri.  Kami memecahkan masalah ini dengan menggunakan Infrastruktur sebagai pendekatan Kode; </li><li>  Skrip persiapan infrastruktur juga memerlukan pengujian seperti kode lainnya. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id463101/">https://habr.com/ru/post/id463101/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id463085/index.html">Sistem Akses File Jarak Jauh Kandang</a></li>
<li><a href="../id463089/index.html">Penerapan sistem pencarian perusahaan untuk desainer mekanik menggunakan platform Low-Code</a></li>
<li><a href="../id463095/index.html">Kenapa tidak SQL?</a></li>
<li><a href="../id463097/index.html">Go Product Development: Satu Sejarah Proyek</a></li>
<li><a href="../id463099/index.html">1000 dan 1 umpan balik. Bagaimana memberi umpan balik dan mengajar orang lain, pengalaman Lamoda</a></li>
<li><a href="../id463105/index.html">Hari keempat saya dengan Haiku: masalah instalasi dan boot</a></li>
<li><a href="../id463107/index.html">ShIoTiny: otomatisasi kecil, Internet, atau "enam bulan sebelum liburan"</a></li>
<li><a href="../id463113/index.html">Kontrol Data dan Model Versi dalam pertemuan Visi Komputer</a></li>
<li><a href="../id463115/index.html">Masalah pintu dalam desain penembak</a></li>
<li><a href="../id463117/index.html">Preloading dalam PHP 7.4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>