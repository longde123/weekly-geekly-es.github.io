<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â—¾ï¸ â›ºï¸ ğŸ ç¥å¥‡çš„æ’ä»¶ï¼Œå·ã€‚ 2.ç»ƒä¹  â›´ï¸ âœğŸ» âœŠğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥é˜…è¯»æœ‰å…³æ’ä»¶å·¥ç¨‹ç†è®ºçš„ç¬¬ä¸€ç¯‡æ–‡ç« ã€‚ 


 åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘å°†å‘Šè¯‰æ‚¨åœ¨åˆ›å»ºæ’ä»¶æœŸé—´é‡åˆ°äº†å“ªäº›é—®é¢˜ä»¥åŠæˆ‘ä»¬å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ã€‚ 

 æˆ‘è¦è¯´ä»€ä¹ˆ 


- å®è·µéƒ¨åˆ† å¤šé¡µç”¨æˆ·ç•Œé¢ æ’ä»¶ä¸­çš„DI ä»£ç ç”Ÿæˆ ä»£ç ä¿®æ”¹ 
- å¤šé¡µç”¨æˆ·ç•Œé¢ 
- æ’ä»¶ä¸­çš„DI 
- ä»£ç ç”Ÿæˆ 
- ä»£ç ä¿®æ”¹ 
-...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ç¥å¥‡çš„æ’ä»¶ï¼Œå·ã€‚ 2.ç»ƒä¹ </h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/hh/blog/463611/"><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨è¿™é‡Œï¼Œ</a>æ‚¨å¯ä»¥é˜…è¯»æœ‰å…³æ’ä»¶å·¥ç¨‹ç†è®ºçš„ç¬¬ä¸€ç¯‡æ–‡ç« ã€‚ </p><br><p> åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘å°†å‘Šè¯‰æ‚¨åœ¨åˆ›å»ºæ’ä»¶æœŸé—´é‡åˆ°äº†å“ªäº›é—®é¢˜ä»¥åŠæˆ‘ä»¬å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ã€‚ <br><img src="https://habrastorage.org/webt/db/cn/c-/dbcnc-m5gfz68a0hpvnt2qjdcgw.png" alt="å›¾ç‰‡"></p><a name="habracut"></a><br><h1 id="o-chem-budu-govorit"> æˆ‘è¦è¯´ä»€ä¹ˆ </h1><br><ul><li> å®è·µéƒ¨åˆ† <br><ul><li> å¤šé¡µç”¨æˆ·ç•Œé¢ </li><li> æ’ä»¶ä¸­çš„DI </li><li> ä»£ç ç”Ÿæˆ </li><li> ä»£ç ä¿®æ”¹ </li></ul></li><li> æ¥ä¸‹æ¥è¦åšä»€ä¹ˆï¼Ÿ <br><ul><li> å°è´¹ </li><li> å¸¸è§é—®é¢˜ </li></ul></li></ul><br><h2 id="mnogostranichnyy-ui"> å¤šé¡µç”¨æˆ·ç•Œé¢ </h2><br><p> æˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯åˆ›å»ºä¸€ä¸ªå¤šé¡µé¢çš„UIã€‚ æˆ‘ä»¬ä½¿ç”¨äº†è®¸å¤šå¤é€‰æ ‡è®°å’Œè¾“å…¥å­—æ®µæ¥åˆ¶ä½œäº†ç¬¬ä¸€ä¸ªå¤æ‚è¡¨æ ¼ã€‚ è¿‡äº†ä¸€ä¼šå„¿ï¼Œæˆ‘ä»¬å†³å®šå¢åŠ é€‰æ‹©ç”¨æˆ·å¯ä»¥è¿æ¥åˆ°æ–°æ¨¡å—çš„æ¨¡å—åˆ—è¡¨çš„åŠŸèƒ½ã€‚ æˆ‘ä»¬è¿˜å¸Œæœ›é€‰æ‹©è®¡åˆ’å°†åˆ›å»ºçš„æ¨¡å—è¿æ¥åˆ°çš„åº”ç”¨ç¨‹åºæ¨¡å—ã€‚ </p><br><p> åœ¨ä¸€ç§è¡¨å•ä¸Šæ‹¥æœ‰å¦‚æ­¤å¤šçš„æ§ä»¶ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œå› æ­¤ä»–ä»¬åˆ¶ä½œäº†ä¸‰ä¸ªå•ç‹¬çš„é¡µé¢ï¼Œä¸‰ä¸ªå•ç‹¬çš„å°ç”œé¥¼åˆ‡å‰²å™¨ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œå‘å¯¼å¯¹è¯æ¡†ã€‚ </p><br><p><img src="https://habrastorage.org/webt/hd/jw/wf/hdjwwfojlb6w7gj_sacdswi802g.png" alt="å›¾ç‰‡"></p><br><p> ä½†æ˜¯ç”±äºåœ¨æ’ä»¶ä¸­åˆ¶ä½œå¤šé¡µUIéå¸¸ç—›è‹¦ï¼Œæ‰€ä»¥æˆ‘æƒ³æ‰¾ä¸€äº›å‡†å¤‡å¥½çš„ä¸œè¥¿ã€‚ åœ¨IDEAçš„è‚ é“ä¸­ï¼Œæˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªåä¸º<em>WizardDialog</em>çš„ç±»ã€‚ </p><br><p><img src="https://habrastorage.org/webt/tl/gr/6z/tlgr6ztp3yro6-yyyqyhjsd55ky.png" alt="å›¾ç‰‡"></p><br><p> è¿™æ˜¯å¸¸è§„å¯¹è¯æ¡†ä¸Šçš„åŒ…è£…å™¨ç±»ï¼Œå¯ç‹¬ç«‹ç›‘è§†å‘å¯¼ä¸­ç”¨æˆ·çš„è¿›åº¦ï¼Œå¹¶æ˜¾ç¤ºå¿…è¦çš„æŒ‰é’®ï¼ˆä¸Šä¸€ä¸ªï¼Œä¸‹ä¸€ä¸ªï¼Œå®Œæˆç­‰ï¼‰ã€‚ ç‰¹æ®Šçš„<em>WizardModel</em>é™„åŠ åˆ°<em>WizardDialog</em> ï¼Œå¹¶å‘å…¶ä¸­æ·»åŠ äº†å„ä¸ªWizardStepsã€‚ æ¯ä¸ª<em>WizardStep</em>éƒ½æ˜¯å•ç‹¬çš„è¡¨å•ã€‚ </p><br><p> å¯¹è¯çš„æœ€ç®€å•å½¢å¼å¦‚ä¸‹ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">å·«å¸ˆå¯¹è¯</b> <div class="spoiler_text"><pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyWizardDialog</span></span></span></span>( model: MyWizardModel, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> onFinishButtonClickedListener: (MyWizardModel) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> ): WizardDialog&lt;MyWizardModel&gt;(<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, model) { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onWizardGoalAchieved</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onWizardGoalAchieved() onFinishButtonClickedListener.invoke(myModel) } }</code> </pre> </div></div><br><p>  <em>æˆ‘ä»¬å°†ä»WizardDialog</em>ç±»<em>ç»§æ‰¿</em> ï¼Œå¹¶ä½¿ç”¨<em>WizardModelçš„</em>ç±»è¿›è¡Œå‚æ•°<em>åŒ–</em> ã€‚ æ­¤ç±»å…·æœ‰ç‰¹æ®Šçš„å›è°ƒï¼ˆ <em>onWizardGoalAchieved</em> ï¼‰ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬ç”¨æˆ·å·²é€šè¿‡å‘å¯¼ç»“æŸå¹¶å•å‡»â€œå®Œæˆâ€æŒ‰é’®ã€‚ <br> é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œåœ¨æ­¤ç±»ä¸­ï¼Œæœ‰æœºä¼šä»…è®¿é—®<em>WizardModel</em> ã€‚ è¿™æ„å‘³ç€åœ¨å‘å¯¼é€šè¿‡æœŸé—´ç”¨æˆ·å°†æ”¶é›†çš„æ‰€æœ‰æ•°æ®ï¼Œå¿…é¡»æ·»åŠ åˆ°<em>WizardModelä¸­</em> ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">å‘å¯¼æ¨¡å‹</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyWizardModel</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WizardModel</span></span></span></span>(<span class="hljs-string"><span class="hljs-string">"Title for my wizard"</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.add(MyWizardStep1()) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.add(MyWizardStep2()) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.add(MyWizardStep3()) } }</code> </pre> </div></div><br><p> è¯¥æ¨¡å‹å¦‚ä¸‹æ‰€ç¤ºï¼šæˆ‘ä»¬ä»<em>WizardModel</em>ç±»ç»§æ‰¿ï¼Œå¹¶ä½¿ç”¨å†…ç½®çš„<em>add</em>æ–¹æ³•<em>å°†</em>å•ç‹¬çš„<em>WizardSteps</em> <em>æ·»åŠ </em>åˆ°å¯¹è¯æ¡†ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">å‘å¯¼æ­¥éª¤</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyWizardStep1</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WizardStep</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyWizardModel</span></span></span><span class="hljs-class">&gt;</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> contentPanel: JPanel <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepare</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(state: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">WizardNavigationState</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: JComponent { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> contentPanel } }</code> </pre> </div></div><br><p>  <em>WizardSteps</em>ä¹Ÿå¾ˆç®€å•ï¼šæˆ‘ä»¬ä»<em>WizardStep</em>ç±»ç»§æ‰¿ï¼Œä½¿ç”¨æˆ‘ä»¬çš„æ¨¡å‹ç±»å¯¹å…¶è¿›è¡Œå‚æ•°åŒ–ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œé‡æ–°å®šä¹‰prepareæ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›æ‚¨å°†æ¥è¡¨å•çš„æ ¹ç»„ä»¶ã€‚ </p><br><p> ç®€å•æ¥è¯´ï¼Œå®ƒçœ‹èµ·æ¥ç¡®å®åƒè¿™æ ·ã€‚ ä½†æ˜¯åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œæ‚¨çš„è¡¨å•å¾ˆå¯èƒ½ç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼š </p><br><p><img src="https://habrastorage.org/webt/as/6d/mc/as6dmcznqssdt7zwhdz7ndebuv8.png" alt="å›¾ç‰‡"></p><br><p> åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥å›æƒ³èµ·é‚£äº›æˆ‘ä»¬åœ¨Androidä¸–ç•Œä¸­è¿˜ä¸çŸ¥é“ä»€ä¹ˆæ˜¯Clean Architectureï¼ŒMVPå¹¶åœ¨ä¸€ä¸ªActivityä¸­ç¼–å†™æ‰€æœ‰ä»£ç çš„æ—¶ä»£ã€‚ æ¶æ„ä¹‹æˆ˜æœ‰äº†æ–°çš„é¢†åŸŸï¼Œå¦‚æœæ‚¨æƒ³å¼„ç³Šæ¶‚ï¼Œå¯ä»¥ä¸ºæ’ä»¶å®ç°è‡ªå·±çš„æ¶æ„ã€‚ </p><br><h3 id="vyvod"> ç»“è®º </h3><br><p> å¦‚æœæ‚¨éœ€è¦å¤šé¡µUIï¼Œè¯·ä½¿ç”¨<em>WizardDialog-</em>è¿™æ ·ä¼šæ›´å®¹æ˜“ã€‚ </p><br><p> æˆ‘ä»¬è¿›å…¥ä¸‹ä¸€ä¸ªä¸»é¢˜-æ’ä»¶ä¸­çš„DIã€‚ </p><br><h2 id="di-v-plaginah"> æ’ä»¶ä¸­çš„DI </h2><br><p> ä¸ºä»€ä¹ˆå¯èƒ½éœ€è¦åœ¨æ’ä»¶å†…éƒ¨è¿›è¡Œä¾èµ–æ³¨å…¥ï¼Ÿ <br> ç¬¬ä¸€ä¸ªåŸå› æ˜¯æ’ä»¶å†…éƒ¨æ¶æ„çš„ç»„ç»‡ã€‚ </p><br><p> çœ‹èµ·æ¥ï¼Œä¸ºä»€ä¹ˆé€šå¸¸åœ¨æ’ä»¶å†…éƒ¨è§‚å¯ŸæŸç§æ¶æ„ï¼Ÿ æ’ä»¶æ˜¯ä¸€ç§å®ç”¨ç¨‹åºï¼Œä¸€æ—¦æˆ‘å†™äº†ï¼Œå°±æ˜¯è¿™æ ·ï¼Œæˆ‘å¿˜è®°äº†ã€‚ <br> æ˜¯çš„ï¼Œä½†æ˜¯æ²¡æœ‰ã€‚ <br> å½“æ‚¨çš„æ’ä»¶å¢é•¿æ—¶ï¼Œå½“æ‚¨ç¼–å†™å¤§é‡ä»£ç æ—¶ï¼Œç»“æ„åŒ–ä»£ç çš„é—®é¢˜å°±è‡ªåŠ¨å‡ºç°äº†ã€‚  DIåœ¨è¿™é‡Œå¯èƒ½ä¼šæ´¾ä¸Šç”¨åœºã€‚ </p><br><p> ç¬¬äºŒä¸ªæ›´é‡è¦çš„åŸå› -åœ¨DIçš„å¸®åŠ©ä¸‹ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ç”±å…¶ä»–æ’ä»¶çš„å¼€å‘äººå‘˜ç¼–å†™çš„ç»„ä»¶ã€‚ å®ƒå¯ä»¥æ˜¯äº‹ä»¶æ€»çº¿ï¼Œè®°å½•å™¨ç­‰ç­‰ã€‚ </p><br><p> å°½ç®¡æ‚¨å¯ä»¥è‡ªç”±ä½¿ç”¨ä»»ä½•DIæ¡†æ¶ï¼ˆä¾‹å¦‚Springï¼ŒDaggerç­‰ï¼‰ï¼Œä½†åœ¨IntelliJ IDEAä¸­è¿˜æ˜¯æœ‰æ‚¨è‡ªå·±çš„DIæ¡†æ¶ï¼Œå®ƒåŸºäºå‰ä¸‰ä¸ªæŠ½è±¡çº§åˆ«ï¼Œæˆ‘å·²ç»åœ¨ä¸Šé¢æåˆ°è¿‡ï¼š <em>Application</em> ï¼Œ <em>Project</em>å’Œ<em>Module</em> ã€‚ </p><br><p><img src="https://habrastorage.org/webt/ix/kh/dk/ixkhdkerqkc0sapkdvgj5qsg_44.png" alt="å›¾ç‰‡"></p><br><p> æ¯ä¸ªçº§åˆ«éƒ½æœ‰å…¶è‡ªå·±çš„æŠ½è±¡ï¼Œç§°ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><em>Component</em></a> ã€‚ æ ¹æ®è¯¥çº§åˆ«çš„å¯¹è±¡çš„å®ä¾‹åˆ›å»ºæ‰€éœ€çº§åˆ«çš„ç»„ä»¶ã€‚ å› æ­¤ï¼Œä¸º<em>Application</em>ç±»çš„æ¯ä¸ªå®ä¾‹åˆ›å»ºä¸€æ¬¡<em>ApplicationComponent</em> ï¼Œç±»ä¼¼äº<em>Project</em>å®ä¾‹çš„<em>ProjectComponent</em> ï¼Œä¾æ­¤ç±»æ¨ã€‚ </p><br><p> ä½¿ç”¨DIæ¡†æ¶éœ€è¦åšä»€ä¹ˆï¼Ÿ </p><br><p> é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªå®ç°æˆ‘ä»¬éœ€è¦çš„æ¥å£ç»„ä»¶ä¹‹ä¸€çš„ç±»-ä¾‹å¦‚ï¼Œä¸€ä¸ªå®ç°<em>ApplicationComponent</em>æˆ–<em>ProjectComponent</em>æˆ–<em>ModuleComponentçš„ç±»</em> ã€‚ åŒæ—¶ï¼Œæˆ‘ä»¬æœ‰æœºä¼šæ³¨å…¥è¦å®ç°å…¶æ¥å£çš„çº§åˆ«çš„å¯¹è±¡ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨<em>ProjectComponent</em>ä¸­æ³¨å…¥<em>Project</em>ç±»çš„å¯¹è±¡ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">åˆ›å»ºç»„ä»¶ç±»</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyAppComponent</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> application: Application, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> anotherApplicationComponent: AnotherAppComponent ): ApplicationComponent <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyProjectComponent</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> project: Project, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> anotherProjectComponent: AnotherProjectComponent, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> myAppComponent: MyAppComponent ): ProjectComponent <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyModuleComponent</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> module: Module, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> anotherModuleComponent: AnotherModuleComponent, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> myProjectComponent: MyProjectComponent, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> myAppComponent: MyAppComponent ): ModuleComponent</code> </pre> </div></div><br><p> å…¶æ¬¡ï¼Œå¯ä»¥æ³¨å…¥ç›¸åŒæˆ–æ›´é«˜çº§åˆ«çš„å…¶ä»–ç»„ä»¶ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨<em>ProjectComponent</em>ä¸­æ³¨å…¥å…¶ä»–<em>ProjectComponent</em>æˆ–<em>ApplicationComponent</em> ã€‚ åœ¨è¿™é‡Œæ‚¨å¯ä»¥è®¿é—®â€œå¤–æ¥â€ç»„ä»¶çš„å®ä¾‹ã€‚ </p><br><p> åŒæ—¶ï¼ŒIDEAä¿è¯å°†æ­£ç¡®åœ°ç»„è£…æ•´ä¸ªä¾èµ–å›¾ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½å°†ä»¥æ­£ç¡®çš„é¡ºåºåˆ›å»ºå¹¶æ­£ç¡®åˆå§‹åŒ–ã€‚ </p><br><p> ä¸‹ä¸€æ­¥æ˜¯åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><em>plugin.xml</em></a>æ–‡ä»¶ä¸­æ³¨å†Œç»„ä»¶ã€‚ ä¸€æ—¦å®ç°äº†Componentæ¥å£ä¹‹ä¸€ï¼ˆä¾‹å¦‚<em>ApplicationComponent</em> ï¼‰ï¼ŒIDEAå°†ç«‹å³æä¾›å°†æ‚¨çš„ç»„ä»¶æ³¨å†Œåœ¨plugin.xmlä¸­çš„åŠŸèƒ½ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">åœ¨plugin.xmlä¸­æ³¨å†Œç»„ä»¶</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">idea-plugin</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project-components</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">component</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">interface-class</span></span></span><span class="hljs-tag">&gt;</span></span> com.experiment.MyProjectComponent <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">interface-class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">implementation-class</span></span></span><span class="hljs-tag">&gt;</span></span> com.experiments.MyProjectComponentImpl <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">implementation-class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">component</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project-components</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">idea-plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br><p> æ€ä¹ˆåšï¼Ÿ å‡ºç°ä¸€ä¸ªç‰¹æ®Šçš„<em>&lt;project-component&gt;</em>æ ‡è®°ï¼ˆ <em>&lt;application-component&gt;</em> ï¼Œ <em>&lt;module-component&gt;</em> -å–å†³äºçº§åˆ«ï¼‰ã€‚ å®ƒå†…éƒ¨æœ‰ä¸€ä¸ªæ ‡ç­¾<em>ï¼Œå…¶ä¸­è¿˜æœ‰ä¸¤ä¸ªæ ‡ç­¾ï¼š <em>&lt;interface-class&gt;</em> ï¼ˆè¡¨ç¤ºç»„ä»¶çš„æ¥å£åç§°ï¼‰å’Œ<em>&lt;implementation-class&gt;</em> ï¼ˆè¡¨ç¤ºå®ç°ç±»ï¼‰ã€‚</em>  <em>ä¸€ä¸ªç±»å¯ä»¥æ˜¯ç»„ä»¶çš„æ¥å£ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶å®ç°ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å•ä¸ª<em>&lt;implementation-class&gt;æ ‡ç­¾</em> ã€‚</em> <br></p><p> æœ€åè¦åšçš„æ˜¯ä»ç›¸åº”çš„å¯¹è±¡ä¸­è·å–ç»„ä»¶ï¼Œå³ï¼Œæˆ‘ä»¬ä»<em>Application</em>å®ä¾‹ä¸­è·å–<em>ApplicationComponent</em> ï¼Œä»<em>Projectä¸­</em>è·å–<em>ProjectComponent</em> ï¼Œç­‰ç­‰ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">è·å–ç»„ä»¶</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> myAppComponent = application.getComponent(MyAppComponent::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">myProjectComponent</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">project</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getComponent</span></span></span></span>(MyProjectComponent::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">myModuleComponent</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getComponent</span></span></span></span>(MyModuleComponent::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">)</span></span></code> </pre> </div></div><br><h3 id="vyvody"> ç»“è®º </h3><br><ol><li>  IDEAä¸­æœ‰ä¸€ä¸ªDIæ¡†æ¶-æ— éœ€è‡ªå·±æ‹–ä»»ä½•ä¸œè¥¿ï¼šDaggerå’ŒSpringéƒ½æ²¡æœ‰ã€‚ å½“ç„¶å¯ä»¥ã€‚ </li><li> ä½¿ç”¨æ­¤DIï¼Œæ‚¨å¯ä»¥è·å–å®Œæˆçš„ç»„ä»¶ï¼Œè¿™å°±æ˜¯æœæ±æœ¬èº«ã€‚ </li></ol><br><p> è®©æˆ‘ä»¬ç»§ç»­ç¬¬ä¸‰ä¸ªä»»åŠ¡-ä»£ç ç”Ÿæˆã€‚ </p><br><h2 id="generaciya-koda"> ä»£ç ç”Ÿæˆ </h2><br><p> è¿˜è®°å¾—å—ï¼Œåœ¨æ¸…å•ä¸­ï¼Œæˆ‘ä»¬æœ‰ç”Ÿæˆå¤§é‡æ–‡ä»¶çš„ä»»åŠ¡ï¼Ÿ æ¯æ¬¡åˆ›å»ºæ–°æ¨¡å—æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šåˆ›å»ºä¸€å †æ–‡ä»¶ï¼šäº¤äº’å™¨ï¼Œæ¼”ç¤ºè€…ï¼Œç‰‡æ®µã€‚ åˆ›å»ºæ–°æ¨¡å—æ—¶ï¼Œè¿™äº›ç»„ä»¶å½¼æ­¤éå¸¸ç›¸ä¼¼ï¼Œæˆ‘æƒ³å­¦ä¹ å¦‚ä½•è‡ªåŠ¨ç”Ÿæˆæ­¤æ¡†æ¶ã€‚ </p><br><h3 id="shablony"> æ¨¡å¼ </h3><br><p> ç”Ÿæˆå¤§é‡ç›¸ä¼¼ä»£ç çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Ÿ ä½¿ç”¨æ¨¡å¼ã€‚ é¦–å…ˆï¼Œæ‚¨éœ€è¦æŸ¥çœ‹æ¨¡æ¿å¹¶äº†è§£å¯¹ä»£ç ç”Ÿæˆå™¨æå‡ºäº†å“ªäº›è¦æ±‚ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ä¸€å—build.gradleæ–‡ä»¶æ¨¡æ¿</b> <div class="spoiler_text"><pre> <code class="java hljs">apply plugin: <span class="hljs-string"><span class="hljs-string">'com.android.library'</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isKotlinProject) { apply plugin: <span class="hljs-string"><span class="hljs-string">'kotlin-android'</span></span> apply plugin: <span class="hljs-string"><span class="hljs-string">'kotlin-kapt'</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isModuleWithUI) { apply plugin: <span class="hljs-string"><span class="hljs-string">'kotlin-android-extensions'</span></span> }&gt; }&gt; ... android { ... &lt;<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isMoxyEnabled) { kapt { arguments { arg(<span class="hljs-string"><span class="hljs-string">"moxyReflectorPackage"</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;include var="packageName"&gt;'</span></span>) } } }&gt; ... } ... dependencies { <span class="hljs-function"><span class="hljs-function">compileOnly </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">project</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">':common'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> compileOnly </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">project</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">':core-utils'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(moduleName in enabledModules)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-function">compileOnly </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">project</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'&lt;include var="moduleName"&gt;'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> }&gt; ... }</span></span></code> </pre> </div></div><br><p> é¦–å…ˆï¼šæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåœ¨è¿™äº›æ¨¡å¼ä¸­ä½¿ç”¨æ¡ä»¶ã€‚ æˆ‘ä¸¾ä¸€ä¸ªä¾‹å­ï¼šå¦‚æœæ’ä»¶ä»¥æŸç§æ–¹å¼ä¸UIè¿æ¥ï¼Œæˆ‘ä»¬æƒ³è¿æ¥ç‰¹æ®Šçš„Gradle-plugin <em>kotlin-android-extensions</em> ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æ¨¡æ¿ä¸­çš„æ¡ä»¶</b> <div class="spoiler_text"><pre> <code class="java hljs">&lt;<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isKotlinProject) { apply plugin: <span class="hljs-string"><span class="hljs-string">'kotlin-android'</span></span> apply plugin: <span class="hljs-string"><span class="hljs-string">'kotlin-kapt'</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isModuleWithUI) { apply plugin: <span class="hljs-string"><span class="hljs-string">'kotlin-android-extensions'</span></span> }&gt; }&gt;</code> </pre> </div></div><br><p> æˆ‘ä»¬æƒ³è¦çš„ç¬¬äºŒä»¶äº‹æ˜¯èƒ½å¤Ÿåœ¨æ­¤æ¨¡æ¿å†…ä½¿ç”¨å˜é‡ã€‚ ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬ä¸ºMoxyé…ç½®kaptæ—¶ï¼Œæˆ‘ä»¬æƒ³å°†åŒ…åç§°ä½œä¸ºæ³¨é‡Šå¤„ç†å™¨çš„å‚æ•°æ’å…¥ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">åœ¨æ¨¡æ¿ä¸­æ›¿æ¢å˜é‡çš„å€¼</b> <div class="spoiler_text"><pre> <code class="java hljs">kapt { arguments { arg(<span class="hljs-string"><span class="hljs-string">"moxyReflectorPackage"</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;include var="packageName"&gt;'</span></span>) } }</code> </pre> </div></div><br><p> æˆ‘ä»¬éœ€è¦çš„å¦ä¸€ä»¶äº‹æ˜¯èƒ½å¤Ÿå¤„ç†æ¨¡æ¿å†…çš„å¾ªç¯ã€‚ è¿˜è®°å¾—æˆ‘ä»¬åœ¨è¡¨æ ¼ä¸­é€‰æ‹©äº†è¦è¿æ¥åˆ°æ­£åœ¨åˆ›å»ºçš„æ–°æ¨¡å—çš„æ¨¡å—åˆ—è¡¨å—ï¼Ÿ æˆ‘ä»¬æƒ³å¾ªç¯å¤„ç†å®ƒä»¬å¹¶æ·»åŠ åŒä¸€è¡Œã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ä½¿ç”¨æ¨¡æ¿ä¸­çš„å¾ªç¯ã€‚</b> <div class="spoiler_text"><pre> <code class="java hljs">&lt;<span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (moduleName in enabledModules) { <span class="hljs-function"><span class="hljs-function">compileOnly </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">project</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'&lt;include var="moduleName"&gt;'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> }&gt;</span></span></code> </pre> </div></div><br><p> å› æ­¤ï¼Œæˆ‘ä»¬ä¸ºä»£ç ç”Ÿæˆå™¨æå‡ºäº†ä¸‰ä¸ªæ¡ä»¶ï¼š </p><br><ul><li> æˆ‘ä»¬è¦ä½¿ç”¨æ¡ä»¶ </li><li> æ›¿ä»£å˜é‡å€¼çš„èƒ½åŠ› </li><li> æˆ‘ä»¬éœ€è¦æ¨¡å¼å¾ªç¯ </li></ul><br><h3 id="generatory-koda"> ä»£ç ç”Ÿæˆå™¨ </h3><br><p> æœ‰å“ªäº›å®ç°ä»£ç ç”Ÿæˆå™¨çš„é€‰é¡¹ï¼Ÿ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ç¼–å†™è‡ªå·±çš„ä»£ç ç”Ÿæˆå™¨ã€‚ ä¾‹å¦‚ï¼ŒUberçš„äººå°±æ˜¯è¿™æ ·åšçš„ï¼šä»–ä»¬ç¼–å†™äº†è‡ªå·±çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ’ä»¶æ¥ç”ŸæˆRiblet</a> ï¼ˆæ‰€è°“çš„å»ºç­‘å•å…ƒï¼‰ã€‚ ä»–ä»¬æå‡ºäº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è‡ªå·±çš„æ¨¡æ¿è¯­è¨€</a> ï¼Œä»–ä»¬åªä½¿ç”¨äº†æ’å…¥å˜é‡çš„èƒ½åŠ›ã€‚ ä»–ä»¬ä½¿æ¡ä»¶è¾¾åˆ°<a href="">äº†å‘ç”µæœº</a>çš„<a href="">æ°´å¹³</a> ã€‚ ä½†æ˜¯æˆ‘ä»¬è®¤ä¸ºæˆ‘ä»¬ä¸ä¼šé‚£æ ·åšã€‚ </p><br><p> ç¬¬äºŒç§é€‰æ‹©æ˜¯ä½¿ç”¨IDEAä¸­å†…ç½®çš„FileTemplateManagerå®ç”¨å·¥å…·ç±»ï¼Œä½†æˆ‘ä¸å»ºè®®è¿™æ ·åšã€‚ å› ä¸ºä»–å…·æœ‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Velocity</a>ä½œä¸ºå¼•æ“ï¼Œæ‰€ä»¥åœ¨å°†Javaå¯¹è±¡è½¬å‘åˆ°æ¨¡æ¿æ–¹é¢å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚ æ­¤å¤–ï¼Œ <em>FileTemplateManager</em>æ— æ³•ä»æ¡†ä¸­ç”ŸæˆJavaæˆ–XMLä»¥å¤–çš„æ–‡ä»¶ã€‚ æˆ‘ä»¬éœ€è¦ç”ŸæˆGroovyæ–‡ä»¶ï¼ŒKotlinï¼ŒProguardå’Œå…¶ä»–ç±»å‹çš„æ–‡ä»¶ã€‚ </p><br><p> ç¬¬ä¸‰ä¸ªé€‰é¡¹æ˜¯... <em>FreeMarker</em> ã€‚ å¦‚æœæ‚¨æœ‰ç°æˆçš„<em>FreeMarker</em>æ¨¡æ¿ï¼Œè¯·ä¸è¦ç€æ€¥ä¸¢å¼ƒå®ƒä»¬-å®ƒä»¬åœ¨æ’ä»¶å†…å¯¹æ‚¨å¾ˆæœ‰ç”¨ã€‚ </p><br><p> éœ€è¦åšä»€ä¹ˆï¼Œå¦‚ä½•åœ¨æ’ä»¶ä¸­ä½¿ç”¨<em>FreeMarker</em> ï¼Ÿ é¦–å…ˆï¼Œæ·»åŠ æ–‡ä»¶æ¨¡æ¿ã€‚ æ‚¨å¯ä»¥åœ¨<em>/ resources</em>æ–‡ä»¶å¤¹å†…åˆ›å»º<em>/ templates</em>æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­æ·»åŠ æ‰€æœ‰æ–‡ä»¶çš„æ‰€æœ‰æ¨¡æ¿-æ¼”ç¤ºè€…ï¼Œç‰‡æ®µç­‰ã€‚ </p><br><p><img src="https://habrastorage.org/webt/gk/ww/fe/gkwwfelyl443hdze6vd6a99ecmw.png" alt="å›¾ç‰‡"></p><br><p> ä¹‹åï¼Œæ‚¨å°†éœ€è¦åœ¨FreeMarkeråº“ä¸Šæ·»åŠ ä¸€ä¸ªä¾èµ–é¡¹ã€‚ ç”±äºè¯¥æ’ä»¶ä½¿ç”¨Gradleï¼Œå› æ­¤æ·»åŠ ä¾èµ–é¡¹éå¸¸ç®€å•ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">åœ¨FreeMarkeråº“ä¸Šæ·»åŠ ä¾èµ–é¡¹</b> <div class="spoiler_text"><pre> <code class="java hljs">dependencies { ... compile <span class="hljs-string"><span class="hljs-string">'org.freemarker:freemarker:2.3.28'</span></span> }</code> </pre> </div></div><br><p> ä¹‹åï¼Œåœ¨æˆ‘ä»¬çš„æ’ä»¶ä¸­é…ç½®FreeMarkerã€‚ æˆ‘å»ºè®®æ‚¨åœ¨æ­¤ç®€å•å¤åˆ¶æ­¤é…ç½®-å—å…¶æŠ˜ç£¨ï¼Œå—è‹¦ï¼Œå¤åˆ¶å®ƒï¼Œä¸€åˆ‡æ­£å¸¸ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">FreeMarkeré…ç½®</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TemplatesFactory</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> project: Project) : ProjectComponent { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> freeMarkerConfig <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> lazy { Configuration(Configuration.VERSION_2_3_28).apply { setClassForTemplateLoading( TemplatesFactory::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">"/templates" ) defaultEncoding = Charsets.UTF_8.name</span></span></span></span>() templateExceptionHandler = TemplateExceptionHandler.RETHROW_HANDLER logTemplateExceptions = <span class="hljs-literal"><span class="hljs-literal">false</span></span> wrapUncheckedExceptions = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } } ...</code> </pre> </div></div><br><p> ç°åœ¨è¯¥ä½¿ç”¨<em>FreeMarker</em>åˆ›å»ºæ–‡ä»¶äº†ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä»é…ç½®ä¸­æŒ‰åç§°è·å–æ¨¡æ¿ï¼Œå¹¶ä½¿ç”¨å¸¸è§„<em>FileWriter</em>åœ¨ç£ç›˜ä¸Šç›´æ¥åˆ›å»ºå…·æœ‰æ‰€éœ€æ–‡æœ¬çš„æ–‡ä»¶ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">é€šè¿‡FileWriteråˆ›å»ºæ–‡ä»¶</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TemplatesFactory</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> project: Project) : ProjectComponent { ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( pathToFile: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, templateFileName: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">data</span></span></span></span><span class="hljs-function"><span class="hljs-params">: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Map</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Any&gt; )</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> template = freeMarkerConfig.getTemplate(templateFileName) FileWriter(pathToFile, <span class="hljs-literal"><span class="hljs-literal">false</span></span>).use { writer -&gt; template.process(<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>, writer) } } }</code> </pre> </div></div><br><p> ä»»åŠ¡ä¼¼ä¹å·²ç»è§£å†³ï¼Œä½†æ˜¯æ²¡æœ‰ã€‚ åœ¨ç†è®ºéƒ¨åˆ†ï¼Œæˆ‘æåˆ°æ•´ä¸ªIDEAéƒ½æ¸—é€äº†PSIç»“æ„ï¼Œå› æ­¤å¿…é¡»äºˆä»¥è€ƒè™‘ã€‚ å¦‚æœæ‚¨ç»•è¿‡PSIç»“æ„åˆ›å»ºæ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡FileWriterï¼‰ï¼Œåˆ™IDEAæ ¹æœ¬ä¸ä¼šç†è§£æ‚¨å·²åˆ›å»ºäº†æ–‡ä»¶ï¼Œå› æ­¤ä¸ä¼šåœ¨é¡¹ç›®æ ‘ä¸­æ˜¾ç¤ºæ–‡ä»¶ã€‚ æˆ‘ä»¬ç­‰äº†å¤§çº¦7åˆ†é’Ÿï¼Œç„¶åIDEAç´¢å¼•äº†ï¼Œç„¶åçœ‹åˆ°äº†åˆ›å»ºçš„æ–‡ä»¶ã€‚ </p><br><p> ç»“è®º-è€ƒè™‘PSIçš„ç»“æ„ï¼Œæ­£ç¡®æ‰§è¡Œæ“ä½œï¼Œåˆ›å»ºæ–‡ä»¶ã€‚ </p><br><h3 id="sozdaem-psi-strukturu-dlya-faylov"> ä¸ºæ–‡ä»¶åˆ›å»ºPSIç»“æ„ </h3><br><p> é¦–å…ˆï¼Œ <a href="">è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹</a>ä½¿ç”¨<a href="">PsiDirectoryçš„</a>æ–‡ä»¶å¤¹ç»“æ„ã€‚ å¯ä»¥ä½¿ç”¨æ‰©å±•åŠŸèƒ½<em>guessProjectDir</em>å’Œ<em>toPsiDirectory</em>è·å¾—é¡¹ç›®çš„å¼€å§‹ç›®å½•ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">è·å–PsiDirectoryé¡¹ç›®</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> projectPsiDirectory = project.guessProjectDir()?.toPsiDirectory(project)</code> </pre> </div></div><br><p> åç»­ç›®å½•å¯ä»¥ä½¿ç”¨<em>PsiDirectory</em> <em>findSubdirectory</em>ç±»æ–¹æ³•æ‰¾åˆ°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<em>createSubdirectory</em>æ–¹æ³•åˆ›å»ºã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æŸ¥æ‰¾å¹¶åˆ›å»ºPsiDirectory</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> coreModuleDir = projectPsiDirectory.findSubdirectory(<span class="hljs-string"><span class="hljs-string">"core"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> newModulePsiDir = coreModuleDir.createSubdirectory(config.mainParams.moduleName)</code> </pre> </div></div><br><p> æˆ‘è¿˜å»ºè®®æ‚¨åˆ›å»ºä¸€ä¸ª<em>Map</em> ï¼Œä½¿ç”¨å­—ç¬¦ä¸²é”®ä»ä¸­è·å–æ‰€æœ‰<em>PsiDirectory</em>æ–‡ä»¶å¤¹ç»“æ„ï¼Œç„¶åå°†åˆ›å»ºçš„æ–‡ä»¶æ·»åŠ åˆ°è¿™äº›æ–‡ä»¶å¤¹ä¸­çš„ä»»ä½•ä¸€ä¸ªã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">åˆ›å»ºæ–‡ä»¶å¤¹ç»“æ„å›¾</b> <div class="spoiler_text"><p> è¿”å›mutableMapOf &lt;Stringï¼ŒPsiDirectoryï¼Ÿ&gt;ï¼ˆï¼‰ã€‚å¥—ç”¨{ <br> è¿™ä¸ª[â€œ rootâ€] = modulePsiDir <br> è¿™ä¸ª[â€œ srcâ€] = modulePsiDir.createSubdirectoryï¼ˆâ€œ srcâ€ï¼‰ <br>  this [â€œ mainâ€] = this [â€œ srcâ€]ï¼Ÿã€‚createSubdirectoryï¼ˆâ€œ mainâ€ï¼‰ <br>  this [â€œ javaâ€] = this [â€œ mainâ€]ï¼Ÿã€‚createSubdirectoryï¼ˆâ€œ javaâ€ï¼‰ <br>  this [â€œ resâ€] = this [â€œ mainâ€]ï¼Ÿã€‚createSubdirectoryï¼ˆâ€œ resâ€ï¼‰ </p><br><pre> <code class="plaintext hljs">//   PsiDirectory   package name: // ru.hh.feature_worknear â†’ ru / hh / feature_worknear createPackageNameFolder(config) // data this["data"] = this["package"]?.createSubdirectory("data") // ...</code> </pre> <br><p>  } </p></div></div><br><p> æ–‡ä»¶å¤¹å·²åˆ›å»ºã€‚ æˆ‘ä»¬å°†ä½¿ç”¨<a href="">PsiFileFactory</a>åˆ›å»º<a href="">PsiFiles</a> ã€‚ æ­¤ç±»å…·æœ‰ç§°ä¸º<em>createFileFromText</em>çš„ç‰¹æ®Šæ–¹æ³•ã€‚ è¯¥æ–¹æ³•æ¥å—ä¸‰ä¸ªå‚æ•°ä½œä¸ºè¾“å…¥ï¼šè¾“å‡ºæ–‡ä»¶çš„åç§°ï¼ˆå­—ç¬¦ä¸²fileNameï¼‰ï¼Œæ–‡æœ¬ï¼ˆå­—ç¬¦ä¸²textï¼‰å’Œç±»å‹ï¼ˆFileType fileTypeï¼‰ã€‚ ä¸‰ä¸ªå‚æ•°ä¸­çš„ä¸¤ä¸ªå‚æ•°æ¸…æ¥šåœ°è¯´æ˜äº†ä»ä½•å¤„è·å–å®ƒï¼šæˆ‘ä»¬è‡ªå·±çŸ¥é“åç§°ï¼Œæˆ‘ä»¬ä»FreeMarkerè·å¾—äº†æ–‡æœ¬ã€‚ åœ¨å“ªé‡Œè·å–<em>FileType</em> ï¼Ÿ åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ </p><br><h3 id="filetype"> æ¡£æ¡ˆç±»å‹ </h3><br><p>  <a href=""><em>FileType</em></a>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç±»ï¼Œè¡¨ç¤ºæ–‡ä»¶çš„ç±»å‹ã€‚  â€œæ¡†â€ä¸­åªæœ‰ä¸¤ä¸ªFileTypeå¯ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼šJavaFileTypeå’ŒXmlFileTypeï¼Œåˆ†åˆ«ç”¨äºJavaæ–‡ä»¶å’ŒXMLæ–‡ä»¶ã€‚ ä½†æ˜¯é—®é¢˜æ¥äº†ï¼šä»å“ªé‡Œè·å¾—<em>build.gradle</em>æ–‡ä»¶ï¼Œ <em>Kotlin</em>æ–‡ä»¶ï¼Œ <em>Proguard</em> ï¼Œ <em>.gitignoreçš„ç±»å‹</em> ï¼Œæœ€åå‘¢ï¼Ÿ </p><br><p> é¦–å…ˆï¼Œå¤§å¤šæ•°è¿™äº›<em>FileType</em>å¯ä»¥ä»æŸäººå·²ç»ç¼–å†™çš„å…¶ä»–æ’ä»¶ä¸­è·å–ã€‚  GroovyFileTypeå¯ä»¥ä»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Groovyæ’ä»¶è·å–</a> ï¼ŒKotlinFileTypeå¯ä»¥ä»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kotlinæ’ä»¶è·å–</a> ï¼ŒProguardå¯ä»¥ä»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Androidæ’ä»¶è·å–</a> ã€‚ </p><br><p> æˆ‘ä»¬å¦‚ä½•å°†å¦ä¸€ä¸ªæ’ä»¶çš„ä¾èµ–å…³ç³»æ·»åŠ åˆ°æˆ‘ä»¬çš„æ’ä»¶ä¸­ï¼Ÿ æˆ‘ä»¬ä½¿ç”¨<em>gradle-intellij-plugin</em> ã€‚ å®ƒåœ¨æ’ä»¶çš„build.gradleæ–‡ä»¶ä¸­æ·»åŠ äº†ä¸€ä¸ªç‰¹æ®Šçš„intellijå—ï¼Œè¯¥æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å±æ€§-pluginsã€‚ åœ¨æ­¤å±æ€§ä¸­ï¼Œæ‚¨å¯ä»¥åˆ—å‡ºæˆ‘ä»¬è¦ä¾èµ–çš„æ’ä»¶æ ‡è¯†ç¬¦åˆ—è¡¨ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æ·»åŠ å¯¹å…¶ä»–æ’ä»¶çš„ä¾èµ–</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// build.gradle  intellij { â€¦ plugins = ['android', 'Groovy', 'kotlin'] }</span></span></code> </pre> </div></div><br><p> æˆ‘ä»¬ä»å®˜æ–¹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JetBrainsæ’ä»¶å­˜å‚¨åº“ä¸­</a>è·å–å¯†é’¥ã€‚ å¯¹äºå†…ç½®åœ¨IDEAä¸­çš„æ’ä»¶ï¼ˆGroovyï¼ŒKotlinå’ŒAndroidï¼‰ï¼ŒIDEAä¸­çš„æ’ä»¶æ–‡ä»¶å¤¹åç§°å°±è¶³å¤Ÿäº†ã€‚ å…¶ä½™çš„ï¼Œæ‚¨éœ€è¦è½¬åˆ°å®˜æ–¹JetBrainsæ’ä»¶å­˜å‚¨åº“ä¸­ç‰¹å®šæ’ä»¶çš„é¡µé¢ï¼Œè¯¥ä½ç½®å°†æ˜¾ç¤º<em>Plugin XML ID</em>å±æ€§ä»¥åŠç‰ˆæœ¬ï¼ˆä¾‹å¦‚ï¼Œè¿™æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Dockeræ’ä»¶</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é¡µé¢</a> ï¼‰ã€‚ é˜…è¯»æœ‰å…³<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨GitHubä¸Š</a>è¿æ¥å…¶ä»–æ’ä»¶çš„æ›´å¤šä¿¡æ¯ã€‚ </p><br><p> å…¶æ¬¡ï¼Œæ‚¨éœ€è¦åœ¨<em>plugin.xml</em>æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªä¾èµ–é¡¹æè¿°ã€‚ è¿™æ˜¯ä½¿ç”¨æ ‡è®°å®Œæˆçš„<em>ã€‚</em> <br></p><div class="spoiler">  <b class="spoiler_title">æˆ‘ä»¬åœ¨plugin.xmlä¸­è¿æ¥æ’ä»¶</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">idea-plugin</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.android<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span>org.intellij.groovy<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">idea-plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br><p> åŒæ­¥é¡¹ç›®åï¼Œæˆ‘ä»¬å°†åŠ å¼ºæ¥è‡ªå…¶ä»–æ’ä»¶çš„ä¾èµ–å…³ç³»ï¼Œå¹¶èƒ½å¤Ÿä½¿ç”¨å®ƒä»¬ã€‚ </p><br><p> ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä¸æƒ³ä¾èµ–å…¶ä»–æ’ä»¶æ€ä¹ˆåŠï¼Ÿ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ‰€éœ€çš„æ–‡ä»¶ç±»å‹åˆ›å»ºä¸€ä¸ªå­˜æ ¹ã€‚ ä¸ºæ­¤ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå°†ä»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><em>Language</em></a>ç±»ç»§æ‰¿çš„ç±»ã€‚ æˆ‘ä»¬çš„ç¼–ç¨‹è¯­è¨€çš„å”¯ä¸€æ ‡è¯†ç¬¦å°†ä¼ é€’ç»™æ­¤ç±»ï¼ˆåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ä¸º<strong>â€œ ru.hh.plugins.Ignoreâ€</strong> ï¼‰ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ä¸ºGitIgnoreæ–‡ä»¶åˆ›å»ºè¯­è¨€</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IgnoreLanguage</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">private</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">constructor</span></span></span></span>() : Language(<span class="hljs-string"><span class="hljs-string">"ru.hh.plugins.Ignore"</span></span>, <span class="hljs-string"><span class="hljs-string">"ignore"</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>), InjectableLanguage { <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> INSTANCE = IgnoreLanguage() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDisplayName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: String { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Ignore() (</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">)"</span></span> } }</code> </pre> </div></div><br><p> è¿™é‡Œæœ‰ä¸€ä¸ªåŠŸèƒ½ï¼šä¸€äº›å¼€å‘äººå‘˜æ·»åŠ ä¸€ä¸ªéå”¯ä¸€çš„è¡Œä½œä¸ºæ ‡è¯†ç¬¦ã€‚ å› æ­¤ï¼Œæ‚¨çš„æ’ä»¶ä¸å…¶ä»–æ’ä»¶çš„é›†æˆå¯èƒ½ä¼šä¸­æ–­ã€‚ æˆ‘ä»¬å¾ˆæ£’ï¼Œæˆ‘ä»¬æœ‰ä¸€æ¡ç‹¬ç‰¹çš„è·¯çº¿ã€‚ </p><br><p> åˆ›å»º<em>Language</em>ä¹‹åï¼Œæ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯åˆ›å»º<em>FileType</em> ã€‚ æˆ‘ä»¬ä»<em>LanguageFileType</em>ç±»ç»§æ‰¿ï¼Œä½¿ç”¨æˆ‘ä»¬å®šä¹‰çš„è¯­è¨€å®ä¾‹è¿›è¡Œåˆå§‹åŒ–ï¼Œè¦†ç›–ä¸€äº›éå¸¸ç®€å•çš„æ–¹æ³•ã€‚ åšå®Œäº† ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–°åˆ›å»ºçš„<em>FileType</em> ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ä¸º.gitignoreåˆ›å»ºè‡ªå·±çš„FileType</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IgnoreFileType</span></span></span></span>(language: Language) : LanguageFileType(language) { <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> INSTANCE = IgnoreFileType(IgnoreLanguage.INSTANCE) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: String = <span class="hljs-string"><span class="hljs-string">"gitignore file"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDescription</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: String = <span class="hljs-string"><span class="hljs-string">"gitignore files"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDefaultExtension</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: String = <span class="hljs-string"><span class="hljs-string">"gitignore"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIcon</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Icon? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> }</code> </pre></div></div><br><h3 id="zavershaem-sozdanie-fayla"> å®Œæˆåˆ›å»ºæ–‡ä»¶ </h3><br><p> æ‰¾åˆ°æ‰€æœ‰å¿…éœ€çš„<em>FileTypeä¹‹å</em> ï¼Œæˆ‘å»ºè®®åˆ›å»ºä¸€ä¸ªåä¸º<em>TemplateData</em>çš„ç‰¹æ®Šå®¹å™¨-è¯¥å®¹å™¨å°†åŒ…å«æœ‰å…³è¦ä»å…¶ç”Ÿæˆä»£ç çš„æ¨¡æ¿çš„æ‰€æœ‰æ•°æ®ã€‚ å®ƒå°†åŒ…å«æ¨¡æ¿æ–‡ä»¶çš„åç§°ï¼Œç”Ÿæˆä»£ç åè·å¾—çš„<em>è¾“å‡º</em>æ–‡ä»¶çš„åç§°ï¼Œæ‰€éœ€çš„<em>FileType</em>ä»¥åŠæœ€åçš„<em>PsiDirectory</em> ï¼Œåœ¨å…¶ä¸­æ·»åŠ åˆ›å»ºçš„æ–‡ä»¶ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æ¨¡æ¿æ•°æ®</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TemplateData</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> templateFileName: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> outputFileName: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> outputFileType: FileType, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> outputFilePsiDirectory: PsiDirectory? )</code> </pre> </div></div><br><p> ç„¶åè¿”å›<em>FreeMarker-</em>æˆ‘ä»¬ä»å…¶ä¸­è·å–æ¨¡æ¿æ–‡ä»¶ï¼Œä½¿ç”¨<em>StringWriter</em>è·å–æ–‡æœ¬ï¼Œåœ¨<em>PsiFileFactoryä¸­</em>ç”Ÿæˆå…·æœ‰æ‰€éœ€æ–‡æœ¬å’Œç±»å‹çš„<em>PsiFile</em> ã€‚ åˆ›å»ºçš„æ–‡ä»¶å°†æ·»åŠ åˆ°æ‰€éœ€ç›®å½•ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">åœ¨æ‰€éœ€çš„æ–‡ä»¶å¤¹ä¸­åˆ›å»ºPsiFile</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createFromTemplate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">data</span></span></span></span><span class="hljs-function"><span class="hljs-params">: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">FileTemplateData</span></span></span></span><span class="hljs-function"><span class="hljs-params">, properties: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Map</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Any&gt;)</span></span></span></span>: PsiFile { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> template = freeMarkerConfig.getTemplate(<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.templateFileName) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> text = StringWriter().use { writer -&gt; template.process(properties, writer) writer.buffer.toString() } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> psiFileFactory.createFileFromText(<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.outputFileName, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.outputFileType, text) }</code> </pre> </div></div><br><p> å› æ­¤ï¼Œè€ƒè™‘äº†PSIç»“æ„ï¼ŒIDEAå’Œå…¶ä»–æ’ä»¶å°†çœ‹åˆ°æˆ‘ä»¬æ‰€åšçš„äº‹æƒ…ã€‚ è¿™æ ·åšæœ‰å¥½å¤„ï¼šä¾‹å¦‚ï¼Œå¦‚æœGitæ’ä»¶å‘ç°æ‚¨å·²æ·»åŠ äº†æ–°æ–‡ä»¶ï¼Œå®ƒå°†è‡ªåŠ¨æ˜¾ç¤ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œè¯¢é—®æ‚¨æ˜¯å¦è¦å°†è¿™äº›æ–‡ä»¶æ·»åŠ åˆ°Gitï¼Ÿ </p><br><h3 id="vyvody-pro-generaciyu-koda"> ä»£ç ç”Ÿæˆç»“è®º </h3><br><ul><li> æ–‡æœ¬æ–‡ä»¶å¯ä»¥ç”±FreeMarkerç”Ÿæˆã€‚ å¾ˆèˆ’æœ </li><li> ç”Ÿæˆæ–‡ä»¶æ—¶ï¼Œæ‚¨éœ€è¦è€ƒè™‘PSIç»“æ„ï¼Œå¦åˆ™ä¸€åˆ‡éƒ½ä¼šå‡ºé”™ã€‚ </li><li> å¦‚æœè¦ä½¿ç”¨PsiFileFactoryç”Ÿæˆæ–‡ä»¶ï¼Œåˆ™å¿…é¡»åœ¨æŸå¤„æ‰¾åˆ°FileTypeã€‚ </li></ul><br><p> å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹æœ€åä¸€ä¸ªæœ€å®ç”¨çš„éƒ¨åˆ†-è¿™æ˜¯å¯¹ä»£ç çš„ä¿®æ”¹ã€‚ </p><br><h2 id="modifikaciya-koda"> ä»£ç ä¿®æ”¹ </h2><br><p> å®é™…ä¸Šï¼Œä»…åˆ›å»ºç”¨äºä»£ç ç”Ÿæˆçš„æ’ä»¶æ˜¯èƒ¡è¯´å…«é“ï¼Œå› ä¸ºæ‚¨å¯ä»¥ä½¿ç”¨å…¶ä»–å·¥å…·å’Œç›¸åŒçš„<em>FreeMarker</em>æ¥ç”Ÿæˆä»£ç ã€‚ ä½†æ˜¯<em>FreeMarker</em>ä¸èƒ½åšçš„å°±æ˜¯ä¿®æ”¹ä»£ç ã€‚ </p><br><p> æˆ‘ä»¬çš„æ¸…å•æœ‰å‡ é¡¹ä¸ä¿®æ”¹ä»£ç æœ‰å…³çš„ä»»åŠ¡ï¼Œè®©æˆ‘ä»¬ä»æœ€ç®€å•çš„ä¸€é¡¹å¼€å§‹-ä¿®æ”¹<em>settings.gradle</em>æ–‡ä»¶ã€‚ </p><br><h3 id="modifikaciya-settingsgradle"> ä¿®æ”¹settings.gradle </h3><br><p> è®©æˆ‘æé†’æ‚¨æˆ‘ä»¬æƒ³è¦åšä»€ä¹ˆï¼šæˆ‘ä»¬éœ€è¦åœ¨æ­¤æ–‡ä»¶ä¸­æ·»åŠ å‡ è¡Œå†…å®¹ï¼Œä»¥æè¿°æ–°åˆ›å»ºçš„æ¨¡å—çš„è·¯å¾„ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">æ¨¡å—è·¯å¾„è¯´æ˜</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// settings.gradle include ':analytics project(':analytics').projectDir = new File(settingsDir, 'core/framework-metrics/analytics) ... include ':feature-worknear' project(':feature-worknear').projectDir = new File(settingsDir, 'feature/feature-worknear')</span></span></code> </pre> </div></div><br><p> æˆ‘ç¨æ—©å“åˆ°æ‚¨ï¼Œåœ¨å¤„ç†æ–‡ä»¶æ—¶å¿…é¡»å§‹ç»ˆè€ƒè™‘PSIç»“æ„ï¼Œå¦åˆ™ <del> ä¸€åˆ‡éƒ½ä¼šç‡ƒçƒ§ </del> å°†æ— æ³•æ­£å¸¸å·¥ä½œã€‚ å®é™…ä¸Šï¼Œåœ¨ç®€å•çš„ä»»åŠ¡ä¸­ï¼ˆä¾‹å¦‚åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ å‡ è¡Œï¼‰ï¼Œå¯ä»¥å°†å…¶çœç•¥ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨é€šå¸¸çš„<em>java.io.File</em>å°†ä¸€äº›è¡Œæ·»åŠ åˆ°æ–‡ä»¶ä¸­ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬æ‰¾åˆ°æ–‡ä»¶çš„è·¯å¾„ï¼Œåˆ›å»º<em>java.io.File</em>å®ä¾‹ï¼Œå¹¶åœ¨Kotlin <em>æ‰©å±•</em>åŠŸèƒ½çš„å¸®åŠ©ä¸‹ï¼Œåœ¨æ­¤æ–‡ä»¶çš„æœ«å°¾æ·»åŠ ä¸¤è¡Œã€‚ æ‚¨å¯ä»¥æ‰§è¡Œæ­¤æ“ä½œï¼ŒIDEAå°†çœ‹åˆ°æ‚¨çš„æ›´æ”¹ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">åœ¨settings.gradleæ–‡ä»¶ä¸­æ·»åŠ è¡Œ</b> <div class="spoiler_text"><p>  val projectBaseDirPath = project.basePath ?:è¿”å› <br>  val settingsPathFile = projectBaseDirPath +â€œ /settings.gradleâ€ </p><br><p>  val settingsFile =æ–‡ä»¶ï¼ˆsettingsPathFileï¼‰ </p><br><p>  settingsFile.appendTextï¼ˆâ€œ include'ï¼š$ moduleName'â€ï¼‰ <br>  settingsFile.appendTextï¼ˆ <br>  â€œé¡¹ç›®ï¼ˆ'ï¼š$ moduleName'ï¼‰ã€‚projectDir =æ–°æ–‡ä»¶ï¼ˆsettingsDirï¼Œ'$ folderPath'ï¼‰â€ <br>  ï¼‰ </p></div></div><br><p> å¥½å§ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œå½“ç„¶ï¼Œé€šè¿‡PSIç»“æ„ä¼šæ›´å¥½-å®ƒæ›´å¯é ã€‚ </p><br><h3 id="donastroyka-kapt-a-dlya-toothpick">  Kaptè°ƒæ•´ç‰™ç­¾ </h3><br><p> æˆ‘å†æ¬¡æé†’æ‚¨è¿™ä¸ªé—®é¢˜ï¼šåœ¨åº”ç”¨ç¨‹åºæ¨¡å—ä¸­æœ‰ä¸€ä¸ª<em>build.gradle</em>æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨å…¶ä¸­æœ‰æ³¨é‡Šå¤„ç†å™¨çš„è®¾ç½®ã€‚ æˆ‘ä»¬æƒ³å°†æˆ‘ä»¬åˆ›å»ºçš„æ¨¡å—çš„è½¯ä»¶åŒ…æ·»åŠ åˆ°ç‰¹å®šä½ç½®ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">åœ¨å“ªé‡Œï¼Ÿ</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/jt/hv/1b/jthv1bxuiigvexnvwnrvzs41wh8.png" alt="å›¾ç‰‡"></p></div></div><br><p> æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ‰¾åˆ°ä¸€ä¸ªç‰¹å®šçš„<em>PsiElement</em> ï¼Œç„¶åè®¡åˆ’æ·»åŠ æˆ‘ä»¬çš„çº¿ã€‚ å¯¹å…ƒç´ çš„æœç´¢å§‹äºå¯¹<em>PsiFile</em>çš„æœç´¢ï¼Œè¯¥æ–‡ä»¶è¡¨ç¤ºåº”ç”¨ç¨‹åºæ¨¡å—çš„<em>build.gradle</em>æ–‡ä»¶ã€‚ ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦æ‰¾åˆ°æˆ‘ä»¬å°†åœ¨å…¶ä¸­å¯»æ‰¾æ–‡ä»¶çš„æ¨¡å—ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æˆ‘ä»¬æ­£åœ¨æŒ‰åç§°æŸ¥æ‰¾æ¨¡å—</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> appModule = ModuleManager.getInstance(project) .modules.toList() .first { it.name == <span class="hljs-string"><span class="hljs-string">"headhunter-applicant"</span></span> }</code> </pre> </div></div><br><p> æ¥ä¸‹æ¥ï¼Œä½¿ç”¨å®ç”¨ç¨‹åºç±»<em>FilenameIndexï¼Œ</em>å¯ä»¥é€šè¿‡å…¶åç§°æŸ¥æ‰¾<em>PsiFile</em> ï¼Œå¹¶å°†æ‰¾åˆ°çš„æ¨¡å—æŒ‡å®šä¸ºæœç´¢åŒºåŸŸã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æŒ‰åç§°æŸ¥æ‰¾PsiFile</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> buildGradlePsiFile = FilenameIndex.getFilesByName( appModule.project, <span class="hljs-string"><span class="hljs-string">"build.gradle"</span></span>, appModule.moduleContentScope ).first()</code> </pre> </div></div><br><p> æ‰¾åˆ°PsiFileä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹æœç´¢PsiElementã€‚   ,      â€“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PSI Viewer</a> .     IDEA  ,    PSI-  . </p><br><p><img src="https://habrastorage.org/webt/sd/nl/ac/sdnlac9nrqcqqt14wtrhohr9pf8.png" alt="å›¾ç‰‡"></p><br><p>    -  (, build.gradle)        ,      PSI-   . </p><br><p><img src="https://habrastorage.org/webt/gt/et/xo/gtetxo8_4hbk0gzzfty7p_zmawu.png" alt="å›¾ç‰‡"></p><br><p>    â€“   ,        <em>PsiFile</em> -. </p><br><p>    .   <em>PsiFile</em> .            . </p><br><div class="spoiler"> <b class="spoiler_title">  PsiElement</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> toothpickRegistryPsiElement = buildGradlePsiFile.originalFile .collectDescendantsOfType&lt;GrAssignmentExpression&gt;() .firstOrNull { it.text.startsWith(<span class="hljs-string"><span class="hljs-string">"arguments"</span></span>) } ?.lastChild ?.children?.firstOrNull { it.text.startsWith(<span class="hljs-string"><span class="hljs-string">"toothpick_registry_children_package_names"</span></span>) } ?.collectDescendantsOfType&lt;GrListOrMap&gt;() ?.first() ?: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span></code> </pre> </div></div><br><p><del>  ?.. </del>   ?          PSI-.        <em>GrAssignmentExpression</em> ,   ,    <em>arguments = [ â€¦ ]</em> .      ,      <em>toothpick_registry_children_package_names = [...]</em> ,       Groovy-. </p><br><p>    <em>PsiElement</em> ,   .            .      . </p><br><p>     PSI- ,       <em>PsiElementFactory</em>   ,    .  Java-?    Java-.   Groovy?  <em>GroovyPsiElementFactory</em> . ä¾æ­¤ç±»æ¨ã€‚ </p><br><p>  <em>PsiElementFactory</em>       .       Groovy  Kotlin ,        . </p><br><div class="spoiler"> <b class="spoiler_title"> PsiElement  package name</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> factory = GroovyPsiElementFactory.getInstance(buildGradlePsiFile.project) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> packageName = config.mainParams.packageName <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> newArgumentItem = factory.createStringLiteralForReference(packageName)</code> </pre> </div></div><br><p>         <em>PsiElement</em> . </p><br><div class="spoiler"> <b class="spoiler_title">   Map-</b> <div class="spoiler_text"><pre> <code class="kotlin hljs">targetPsiElement.add(newArgumentItem)</code> </pre> </div></div><br><h3 id="donastroyka-kapt-a-dlya-moxy-v-application-module">  kapt-  Moxy  application  </h3><br><p>    -,    , â€“  kapt-  Moxy  application .  :          <em>@RegisterMoxyReflectorPackages</em> . </p><br><div class="spoiler"> <b class="spoiler_title">-?</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/us/17/in/us17inlvgteb4k9pmegkurtl7y8.png" alt="å›¾ç‰‡"></p></div></div><br><p>         ,  :  <em>PsiFile</em> ,  <em>PsiElement</em> ,  â€¦      ,         <em>PsiElement</em> -. </p><br><p>     :  ,    <em>@RegisterMoxyReflectorPackages</em> ,       <em>value</em>  ,          . </p><br><p>    ,       . ,     <em>PsiManager</em> ,   <em>PsiClass</em>  . </p><br><div class="spoiler"> <b class="spoiler_title"> PsiClass  @RegisterMoxyReflectorPackages</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> appModule = ModuleManager.getInstance(project) .modules.toList() .first { it.name == <span class="hljs-string"><span class="hljs-string">"headhunter-applicant"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> psiManager = PsiManager.getInstance(appModule.project) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> annotationPsiClass = ClassUtil.findPsiClass( psiManager, <span class="hljs-string"><span class="hljs-string">"com.arellomobile.mvp.RegisterMoxyReflectorPackages"</span></span> ) ?: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span></code> </pre> </div></div><br><p>     <em>AnnotatedMembersSearch</em>   ,      . </p><br><div class="spoiler"> <b class="spoiler_title"> ,  </b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> annotatedPsiClass = AnnotatedMembersSearch.search( annotationPsiClass, appModule.moduleContentScope ).findAll() ?.firstOrNull() ?: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span></code> </pre> </div></div><br><p>  ,  <em>PsiElement</em>  ,        value.     ,      . </p><br><div class="spoiler"> <b class="spoiler_title">      </b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> annotationPsiElement = (annotatedPsiClass .annotations .first() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> KtLightAnnotationForSourceEntry ).kotlinOrigin <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> packagesPsiElements = annotationPsiElement .collectDescendantsOfType&lt;KtValueArgumentList&gt;() .first() .collectDescendantsOfType&lt;KtValueArgument&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> updatedPackagesList = packagesPsiElements .mapTo(mutableListOf()) { it.text } .apply { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> += <span class="hljs-string"><span class="hljs-string">"\"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${config.packageName}</span></span></span><span class="hljs-string">\""</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> newAnnotationValue = updatedPackagesList.joinToString(separator = <span class="hljs-string"><span class="hljs-string">",\n"</span></span>)</code> </pre> </div></div><br><p>   <em>KtPsiFactory</em>   <em>PsiElement</em> â€“          . </p><br><div class="spoiler"> <b class="spoiler_title">      </b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> kotlinPsiFactory = KtPsiFactory(project) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> newAnnotationPsiElement = kotlinPsiFactory.createAnnotationEntry( <span class="hljs-string"><span class="hljs-string">"@RegisterMoxyReflectorPackages(\n</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$newAnnotationValue</span></span></span><span class="hljs-string">\n)"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> replaced = annotationPsiElement.replace(newAnnotationPsiElement)</code> </pre> </div></div><br><p>  . </p><br><p>     ?    code style.  ,      IDEA    : CodeStyleManager. </p><br><div class="spoiler"> <b class="spoiler_title"> code style</b> <div class="spoiler_text"><pre> <code class="kotlin hljs">CodeStyleManager.getInstance(module.project).reformat(replacedElement)</code> </pre> </div></div><br><p>    -  ,     . </p><br><h3 id="vyvody-1">  </h3><br><ul><li>     ,      PSI-,      . </li><li> ,  PSI     ,    ,    PsiElement-. </li></ul><br><h1 id="chto-delat-dalshe">   ? </h1><br><p>   . </p><br><ul><li>      â€“    ,       . </li><li>       .       .   :            . </li><li>     ?      .  , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">   IDEA</a>   ,   .       ,        . â€”   -  ,    GitHub  .  ,    ,  . </li><li>    -   â€“    IntelliJ IDEA   .  ,   <em>Util</em>  <em>Manager</em> ,  ,    ,    . </li><li>   :     .  ,  <em>runIde</em> ,     IDEA,   .   ,           hh.ru,       . </li></ul><br><p> ä»…æ­¤è€Œå·²ã€‚ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  </a> ,  ,   â€“ . </p><br><h2 id="faq"> å¸¸è§é—®é¢˜ </h2><br><ul><li>       ? </li></ul><br><p>       ,       .      ,   2  3 . </p><br><ul><li>       IDEA   ,   -  ? </li></ul><br><p> ,    IDEA   IDEA SDK ,   deprecated,   ,  .   SDK-   ,   ,     . </p><br><ul><li>         ? </li></ul><br><p>    â€“    gitignore .   -   . </p><br><ul><li>          ? </li></ul><br><p>      Android Studio  Mac OS,    Ubuntu,   . ,     Windows,    . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN463611/">https://habr.com/ru/post/zh-CN463611/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN463599/index.html">â€œè¿™æ˜¯ä¸€åœºå™©æ¢¦â€ï¼šå®‡èˆªå‘˜å°±å¥½è±ååœ¨æ‹æ‘„å¤ªç©ºç”µå½±æ—¶çŠ¯çš„é”™è¯¯åˆ†äº«çœ‹æ³•</a></li>
<li><a href="../zh-CN463601/index.html">Java / logbackä¸­çš„å•ç‹¬æ–¹æ³•è®°å½•</a></li>
<li><a href="../zh-CN463605/index.html">æŠ€æœ¯çŸ¥è¯†åˆ†å­-æ¥è‡ªæ·±ç©º</a></li>
<li><a href="../zh-CN463607/index.html">å¸¦æœ‰React Contextå’Œhookçš„Reduxå†…ç½®æ›¿ä»£æ–¹æ¡ˆ</a></li>
<li><a href="../zh-CN463609/index.html">Directum Clubçš„æ¨èç³»ç»Ÿã€‚ ç¬¬ä¸€éƒ¨åˆ†ï¼Œåä½œ</a></li>
<li><a href="../zh-CN463613/index.html">Dockeré•œåƒä¹Ÿå¯ä»¥ä½¿ç”¨å¸¸è§„Dockerfileåœ¨werfä¸­æ„å»º</a></li>
<li><a href="../zh-CN463617/index.html">æµ‹è¯•ç§»åŠ¨MMOçš„åŠŸèƒ½</a></li>
<li><a href="../zh-CN463619/index.html">è¿œç¨‹å·¥ä½œï¼šæˆ‘ä»¬çš„ç»éªŒ</a></li>
<li><a href="../zh-CN463623/index.html">æˆ‘ä»¬æ˜¯ä»æµ‹è¯•çš„ä¸›æ—ä¸­é€‰æ‹”å‡ºæ¥çš„ï¼šä»å¤¹å…·åˆ°æµ‹è¯•ï¼Œæˆ‘ä»¬æ­£åœ¨å»ºç«‹ä¸€æ¡æ·å¾„</a></li>
<li><a href="../zh-CN463625/index.html">ä½¿ç”¨Flowmon Networksè§£å†³æ–¹æ¡ˆè¿›è¡Œç½‘ç»œç›‘è§†å’Œå¼‚å¸¸ç½‘ç»œæ´»åŠ¨çš„æ£€æµ‹</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>