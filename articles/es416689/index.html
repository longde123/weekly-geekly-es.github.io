<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙍🏾 🤾🏻 🤓 Acerca de las características de la arquitectura de Android a través de los ojos de un desarrollador que no es Android 🕣 📄 👵</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recientemente, hemos rediseñado por completo la aplicación Pyrus para Android. La primera versión de la aplicación ya funcionaba con Android 2.2. Al n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Acerca de las características de la arquitectura de Android a través de los ojos de un desarrollador que no es Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416689/"> Recientemente, hemos rediseñado por completo la aplicación Pyrus para Android.  La primera versión de la aplicación ya funcionaba con Android 2.2.  Al negarnos a admitir Android por debajo de 4.1, pudimos pagar la deuda técnica acumulada y simplificamos significativamente el código fuente.  Sí, perdimos una parte de los usuarios (menos del 1%), pero por otro lado, ahorramos tiempo a los desarrolladores para corregir errores raros.  Podremos invertirlo en el desarrollo de funcionalidades para todos los usuarios actuales y nuevos.  A la larga, esto es mucho más importante. <br><br>  Aquí compartimos experiencias que pueden ser útiles para aquellos que están considerando comenzar a desarrollar la plataforma Android. <br><a name="habracut"></a><br>  Android atrae buenas herramientas de desarrollo, lenguaje probado en el tiempo (Java) con la sintaxis habitual, una gran audiencia de usuarios.  Sin embargo, crear aplicaciones convenientes en Android es difícil: a pesar de la API desarrollada, a menudo sucede que no hay un componente listo para usar con un comportamiento adecuado.  Debe abandonar las ideas del diseñador de experiencia de usuario, aceptar depender de bibliotecas de terceros o escribir usted mismo.  No todas las soluciones arquitectónicas en Android resultaron exitosas, y esto también aumenta la cantidad de código sin un beneficio obvio. <br><br><h3>  Muriendo y resucitando de las cenizas </h3><br>  La interfaz en Android se basa en la actividad.  Este es un contenedor que generalmente ocupa toda la pantalla del dispositivo, otros widgets viven en él y recibe eventos sobre la interacción del usuario. <br><br>  Cuando el usuario activa la aplicación, se genera un evento onResume en la Actividad.  Presioné el botón de Inicio - La actividad desapareció, pero antes de eso recibió el evento onPause.  Hasta ahora, todo es lógico.  ¿Qué sucede cuando un usuario gira la pantalla del dispositivo 90 grados?  Nunca adivinarás: el sistema operativo mata la actividad y se vuelve a crear.  Cuando desinstala una actividad, todos los componentes que contiene se eliminan.  Esto significa que debe escribir un código especial que guarde el estado de los widgets dentro de la Actividad (posición de desplazamiento, texto seleccionado, estado de las casillas de verificación) y los restaure después de que se vuelva a crear el padre.  Android hace algo de este trabajo por ti, pero no todo. <br><br>  Es difícil entender qué llevó a los arquitectos a tomar esa decisión.  Más tarde, alguien decidió que se veía feo y agregó el mismo parámetro, que suprime el comportamiento predeterminado del sistema.  Ahora, en lugar de volver a crear Actividad, el SO puede llamar al método especial onConfigurationChanged.  Esta "solución" parece un truco sucio y solo exacerbó el problema, porque la documentación de Android <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dice</a> "esta técnica debería considerarse una medida extrema y no se recomienda para la mayoría de las aplicaciones". <br><br><h3>  Fragmentos Fragmentados </h3><br>  Inicialmente, el sistema operativo Android fue creado para teléfonos.  Con el advenimiento de las tabletas, el equipo de Android decidió acertadamente que los elementos de la interfaz que anteriormente estaban separados por diferentes actividades debido al pequeño tamaño de la pantalla del teléfono ahora pueden coexistir en la pantalla grande de la tableta.  (Ejemplo: la lista de cartas y el correo electrónico en el teléfono estaban en dos Actividades diferentes, y en la tableta compartieron una pantalla juntos). Sí, el problema es que varias Actividades no pueden interactuar simultáneamente con el usuario por diseño.  Por lo tanto, se necesita otro mecanismo para reutilizar componentes, y se encontró una solución: aparecieron fragmentos (Fragmento). <br><br>  Por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">definición</a> , un Fragmento representa un comportamiento o parte de una interfaz de usuario en una Actividad.  Todo esta claro.  Sin embargo, en las instrucciones para usar fragmentos encontramos la sección "Agregar un fragmento que no tiene una interfaz de usuario".  Que?  ¡Resulta que un fragmento puede no tener su propia ventana para renderizar! <br><br>  Pero, ¿qué sucede con los fragmentos al girar la pantalla?  Los desarrolladores de Android pensaron en esto: cuando recrea una actividad, todos sus fragmentos también se recrean automáticamente.  Sin embargo, tras una cuidadosa consideración, el fragmento tiene el método "setRetainInstance", si lo llama, este fragmento no se eliminará ni restaurará durante los turnos. <br><br>  Esbelto y consistente, este concepto no puede ser llamado. <br><br><h3>  Operación asincrónica </h3><br>  El subproceso de procesamiento de eventos no puede bloquearse mediante operaciones largas, por lo tanto, el intercambio de datos con el disco y la red debe realizarse de forma asincrónica en otros subprocesos.  Android proporciona hasta cuatro mecanismos para la operación asincrónica: AsyncTask, Service, IntentService, Thread.  Se alienta a los desarrolladores a determinar cuál es el mejor para ellos.  La elección no es trivial: por ejemplo, si la aplicación inició AsyncTask y el usuario giró la pantalla durante su ejecución, al finalizar el trabajo, AsyncTask no puede encontrar una nueva Actividad (creada después del turno).  Y ninguno de los cuatro mecanismos implementa una lógica simple: si el usuario inició el segundo proceso asincrónico sin esperar los resultados del primero, y luego el primero todavía terminó antes, entonces es apropiado ignorar y no reflejar sus resultados en la interfaz de usuario. <br><br>  Se hace evidente la aparición de numerosas bibliotecas: buses de datos para organizar el trabajo asincrónico dentro de una aplicación de Android. <br><br><h3>  Reiniciar la aplicación después de OOM </h3><br>  Si Android se queda sin RAM, el sistema operativo puede completar cualquier proceso.  Cuando el usuario active la aplicación en el futuro, el sistema intentará restaurar su estado.  En teoría, esto debería ser invisible para el desarrollador (si implementó el método onSaveInstanceState en todos los componentes): el propio sistema recrea la pila de Actividad tal como estaba durante la parada forzada.  Sin embargo, si la inicialización lleva tiempo (por ejemplo, cargar cachés desde el disco o desde la red), será correcto mostrarle al usuario un indicador de espera.  Resulta que al crear una actividad, aún necesita monitorear el "arranque en frío" y llevar a cabo la inicialización manualmente.  Sin mencionar que al reiniciar, no se restauran Thread y AsyncTask. <br><br>  ¿Qué posibilidades hay de quedarse sin memoria en la práctica?  Típicamente, esta situación ocurre cuando se procesan imágenes de alta resolución.  Por ejemplo, una imagen de 2048x1536 ocupa 12Mb en la memoria de un objeto de mapa de bits.  La cantidad de memoria disponible para la aplicación depende del modelo de dispositivo específico y, a veces, es muy pequeña (64 Mb o 128 Mb).  Dado que el recolector de basura en todas las versiones de Android anteriores a 8.0 no estaba compactando, incluso si tiene 100Mb de memoria libre, pero está dividido en bloques de 10Mb, un intento de asignar memoria para esa imagen condujo a un bloqueo de la aplicación. <br><br><h3>  Recogida de basura eterna </h3><br>  Una vez que nuestro usuario se dio cuenta de que al desplazarse por las listas largas, la aplicación "se retrasaba": cada 2-3 segundos la animación se detenía por breves pausas (200-300 ms), y luego continuaba.  El análisis mostró que la recolección de basura a menudo comienza sospechosamente en la aplicación.  Resultó que la clase HashMap estándar (que usamos para obtener un objeto Java por su ID) es ineficiente en nuestro caso: necesitamos crear un objeto contenedor para cada clave, que es un entero (int).  Por lo tanto, el número de asignaciones de memoria aumenta sin ningún beneficio.  La solución fue cambiar a un contenedor especial SparseArray (disponible solo en Android, no en la plataforma estándar de Java), lo que inmediatamente redujo la presión sobre el recolector de basura. <br><br>  ¿Qué tiene que ver el retraso en la animación?  El hecho es que el recolector de basura en Android detuvo todos los hilos durante su funcionamiento, incluido el hilo principal involucrado en el renderizado.  En las versiones de Android que comienzan con 5.0, se usa otra máquina virtual (ART en lugar de Dalvik) y un algoritmo diferente de recolección de basura, que detiene cada vez menos la animación.  (Puede leer sobre cómo comparar el tiempo de recolección de basura <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aquí</a> ). <br><br><h3>  Ver documentos </h3><br>  Si desea insertar vistas previas de documentos en su aplicación, se ve obligado a decepcionar: en Android no hay un componente integrado que pueda mostrar archivos de Word, Excel, Powerpoint.  Sin mencionar los archivos ZIP o documentos PDF.  Salida?  Obligue al usuario a instalar aplicaciones de terceros para ver cada tipo de archivo o usar el componente WebView (en realidad un navegador).  En ambos casos, cuando el usuario graba el archivo, se iniciará una aplicación externa y algunos escenarios simplemente no se pueden implementar, por ejemplo, una alimentación de imágenes: no hay una manera fácil de integrar WebView en un ViewPager estándar. <br><br><h3>  Que sigue </h3><br>  Algunos estudios afirman que la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">complejidad del desarrollo de Android es relativamente alta</a> .  Nuestra experiencia muestra que es fácil para un desarrollador competente acostumbrarse a las características de esta plataforma.  Y aunque hoy Android es el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sistema operativo móvil más popular del mundo</a> , en 5-10 años la situación puede cambiar radicalmente. <br><br>  En los últimos años, Google ha estado desarrollando en secreto el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nuevo Fuchsia OC</a> con un modelo de seguridad fundamentalmente diferente (en comparación con el sistema operativo moderno).  Probablemente usará <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Dart</a> como el lenguaje de programación principal y el marco <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Flutter</a> como la forma principal de crear aplicaciones.  Se rumorea que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fuchsia puede reemplazar Android y ChromeOS</a> en todos los dispositivos.  Si Google hace esto, es probable que la compañía brinde soporte nativo para aplicaciones escritas para Android (como lo hizo Microsoft al cambiar de DOS a Windows).  Por lo tanto, hasta ahora no puede preocuparse y continuar acumulando experiencia en Android.  Y para aquellos que quieran mirar hacia el futuro, pueden descargar Flutter y jugar con él <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aquí</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es416689/">https://habr.com/ru/post/es416689/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es416679/index.html">Computación periférica: una combinación amistosa de la "niebla" con las "nubes"</a></li>
<li><a href="../es416681/index.html">Cómo PostgreSQL y ClickHouse en Python mucho, rápida e inmediatamente en numpy</a></li>
<li><a href="../es416683/index.html">Que sigue O cómo elegir características para el desarrollo</a></li>
<li><a href="../es416685/index.html">Seguimiento de Epson ColorWorks: sus preguntas, nuestras respuestas</a></li>
<li><a href="../es416687/index.html">QSAN Storage como competidor de las marcas Tier 1</a></li>
<li><a href="../es416691/index.html">Seguridad del aprendizaje automático: ¿técnicas de defensa eficaces o nuevas amenazas?</a></li>
<li><a href="../es416693/index.html">Certificados de D-Link y Changing Information Technologies utilizados para firmar malware</a></li>
<li><a href="../es416695/index.html">Compatibilidad con vSphere 6.7 y otras funciones de la última actualización Veaam Backup & Replication 9.5 3a</a></li>
<li><a href="../es416697/index.html">Fusión de operadores de telecomunicaciones en 2018</a></li>
<li><a href="../es416699/index.html">Francotirador geek o cómo hacer un "buen ojo"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>