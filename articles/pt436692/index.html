<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôå ü§õüèø ‚úçüèª (in) Guerra Finita üîÅ üéÖüèº ü§µüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="N√≥s temos um problema. O problema com o teste. O problema ao testar os componentes do React √© bastante fundamental. √â sobre a diferen√ßa entre unit tes...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>(in) Guerra Finita</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436692/"><p><img src="https://habrastorage.org/webt/4w/m4/cc/4wm4ccdyq2tqs2giqspeys3e9sa.jpeg" alt="guerra infinita"></p><br><p> N√≥s temos um problema.  O problema com o teste.  O problema ao testar os componentes do React √© bastante fundamental.  √â sobre a diferen√ßa entre <code>unit testing</code> e <code>integration testing</code> .  √â sobre a diferen√ßa entre o que chamamos de teste de unidade e o que chamamos de teste de integra√ß√£o, o tamanho e o escopo. </p><br><p>  N√£o √© sobre o teste em si, mas sobre a Arquitetura de Componentes.  Sobre a diferen√ßa entre <strong>componentes de</strong> teste, bibliotecas independentes e <strong>aplicativos</strong> finais. </p><br><p>  Todo mundo sabe como testar componentes simples (eles s√£o simples), provavelmente sabe como testar aplicativos (E2E).  Como testar coisas <em>finitas</em> e <em>infinitas</em> ... </p><a name="habracut"></a><br><h2 id="define-the-problem">  Definir o problema </h2><br><p>  Existem duas maneiras diferentes de testar o React Component - <code>shallow</code> e tudo o mais, incluindo <code>mount</code> , <code>react-testing-library</code> <code>webdriver</code> , <code>webdriver</code> e assim por diante.  Apenas <code>shallow</code> √© especial - o resto se comporta da mesma maneira. </p><br><p>  E essa diferen√ßa √© sobre <em>o tamanho e o escopo</em> - sobre O QUE seria testado, e apenas parcialmente <em>como</em> . </p><br><p>  Em resumo - <code>shallow</code> apenas gravar√° chamadas para React.createElement, mas n√£o executar√° efeitos colaterais, incluindo renderiza√ß√£o de elementos DOM - √© um efeito colateral (alg√©brico) de React.createElement. </p><br><p>  Qualquer outro comando executar√° o c√≥digo que voc√™ forneceu, com todos os efeitos colaterais tamb√©m sendo executados.  Como seria real, e esse √© o objetivo. </p><br><p>  E <strong>o problema</strong> √© o seguinte: <code>you can NOT run each and every side effect</code> . </p><br><h3 id="why-not">  Porque n√£o </h3><br><p>  Pureza da fun√ß√£o?  Pureza e imutabilidade - as vacas sagradas de hoje.  E voc√™ est√° matando um deles.  Os axiomas do teste de unidade - sem efeitos colaterais, isolamento, zombaria, tudo sob controle. </p><br><ul><li><p>  Mas isso <em>n√£o</em> √© <em>um problema</em> para ... <code>dumb components</code> .  Eles s√£o burros, cont√™m apenas a camada de apresenta√ß√£o, mas n√£o os "efeitos colaterais". </p><br></li><li><p>  Mas isso √© <em>um problema</em> para <code>Containers</code> .  Contanto que eles n√£o sejam burros, contenham o que quiserem, e totalmente sobre efeitos colaterais.  Eles s√£o o problema! </p><br></li></ul><br><p>  Provavelmente, se definirmos as regras de "O componente certo", poder√≠amos testar facilmente - ele nos guiar√° e nos ajudar√°. </p><br><blockquote>  TRDL: O componente finito </blockquote><br><h2 id="smart-and-dumb-components">  Componentes inteligentes e mudos </h2><br><p>  De acordo com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Dan Abramov Article</a> Presentation Components s√£o: </p><br><ul><li>  Preocupa-se com a apar√™ncia das coisas. </li><li>  Pode conter componentes de apresenta√ß√£o e de cont√™iner <code>**</code> internos e, geralmente, possui alguns estilos e marca√ß√£o DOM. </li><li>  Freq√ºentemente, permita a conten√ß√£o por this.props.children. </li><li>  N√£o tem depend√™ncias no restante do aplicativo, como a√ß√µes ou lojas do Flux. </li><li>  N√£o especifique como os dados s√£o carregados ou alterados. </li><li>  Receba dados e retornos de chamada exclusivamente via adere√ßos. </li><li>  Raramente t√™m seu pr√≥prio estado (quando o fazem, √© o estado da interface do usu√°rio em vez de dados). </li><li>  S√£o gravados como componentes funcionais, a menos que precisem de estado, ganchos de ciclo de vida ou otimiza√ß√µes de desempenho. </li><li>  Exemplos: P√°gina, Barra Lateral, Hist√≥ria, Informa√ß√µes do Usu√°rio, Lista. </li><li>  .... </li><li>  E Containers s√£o apenas fornecedores de dados / objetos para esses componentes. </li></ul><br><p>  De acordo com as origens: <strong>Na aplica√ß√£o ideal ...</strong> <strong><br></strong>  <strong>Recipientes s√£o a √°rvore.</strong>  <strong>Componentes s√£o folhas de √°rvores.</strong> </p><br><h4 id="find-the-black-cat-in-the-dark-room">  Encontre o gato preto no quarto escuro </h4><br><p>  O molho secreto aqui, uma mudan√ßa que precisamos alterar nesta defini√ß√£o, est√° oculto dentro de <em>"Pode conter componentes de apresenta√ß√£o e de recipiente <code>**</code> "</em> , deixe-me citar o artigo original: </p><br><blockquote>  Em uma vers√£o anterior deste artigo, afirmei que os componentes de apresenta√ß√£o devem conter apenas outros componentes de apresenta√ß√£o.  N√£o acho mais esse o caso.  Se um componente √© um componente de apresenta√ß√£o ou um cont√™iner √© seu detalhe de implementa√ß√£o.  Voc√™ poder√° substituir um componente de apresenta√ß√£o por um cont√™iner sem modificar nenhum dos sites de chamada.  Portanto, os componentes de apresenta√ß√£o e de container podem conter outros componentes de apresenta√ß√£o ou de container. </blockquote><p>  Ok, mas e a regra, que torna a unidade de componentes de apresenta√ß√£o test√°vel - <em>"N√£o h√° depend√™ncias no restante do aplicativo"</em> ? </p><br><p>  Infelizmente, ao incluir cont√™ineres nos componentes da apresenta√ß√£o, voc√™ est√° tornando os segundos <strong>infinitos</strong> e injetando depend√™ncia no restante do aplicativo. </p><br><p>  Provavelmente, isso n√£o √© algo que voc√™ deveria fazer.  Portanto, n√£o tenho outra escolha, a n√£o ser tornar o componente burro finito: </p><br><p>  <strong>COMPONENTES DE APRESENTA√á√ÉO DEVEM CONTER APENAS OUTROS COMPONENTES DE APRESENTA√á√ÉO</strong> </p><br><p>  E a √∫nica pergunta, voc√™ deve perguntar (olhando para sua base de c√≥digos atual): <em>Como?</em>  : tableflip:?! </p><br><p>  Hoje, os componentes e cont√™ineres da apresenta√ß√£o n√£o s√£o apenas enredados, mas √†s vezes n√£o s√£o extra√≠dos como entidades "puras" (ol√° GraphQL). </p><br><h4 id="solution-1---di">  Solu√ß√£o 1 - DI </h4><br><p>  A solu√ß√£o 1 √© simples - n√£o contenha cont√™ineres aninhados no componente burro - cont√©m <code>slots</code> .  Apenas aceite "conte√∫do" (filhos), como adere√ßos, e isso resolveria o problema: </p><br><ul><li>  voc√™ pode testar o componente burro sem "o resto do seu aplicativo" </li><li>  voc√™ pode testar a integra√ß√£o com fuma√ßa / integra√ß√£o / e2e test, n√£o testes. </li></ul><br><pre> <code class="plaintext hljs">// Test me with mount, with "slots emty". const PageChrome = ({children, aside}) =&gt; ( &lt;section&gt; &lt;aside&gt;{aside}&lt;/aside&gt; {children} &lt;/section&gt; ); // test me with shallow, or real integration test const PageChromeContainer = () =&gt; ( &lt;PageChrome aside={&lt;ASideContainer /&gt;}&gt; &lt;Page /&gt; &lt;/PageChrome&gt; );</code> </pre> <br><p>  Aprovado pelo pr√≥prio Dan: <br>  {% twitter 1021850499618955272%} </p><br><p>  O DI (inje√ß√£o de depend√™ncia e invers√£o de depend√™ncia), provavelmente, √© a t√©cnica mais reutiliz√°vel aqui, capaz de tornar sua vida muito, muito mais f√°cil. </p><br><blockquote>  Aponte aqui - Componentes mudos s√£o mudos! </blockquote><br><h4 id="solution-2---boundaries">  Solu√ß√£o 2 - Limites </h4><br><p>  Esta √© uma solu√ß√£o bastante declarativa e pode estender a <code>Solution 1</code> - basta declarar todos os pontos de <em>extens√£o</em> .  Basta envolv√™-los com ... <code>Boundary</code> </p><br><pre> <code class="plaintext hljs">const Boundary = ({children}) =&gt; ( process.env.NODE_ENV === 'test' ? null : children // or `jest.mock` ); const PageChrome = () =&gt; ( &lt;section&gt; &lt;aside&gt;&lt;Boundary&gt;&lt;ASideContainer /&gt;&lt;/Boundary&gt;&lt;/aside&gt; &lt;Boundary&gt;&lt;Page /&gt;&lt;/Boundary&gt; &lt;/section&gt; );</code> </pre> <br><p>  Ent√£o - voc√™ pode desativar, apenas zero, o <code>Boundary</code> para reduzir o escopo do componente e torn√°-lo <em>finito</em> . </p><br><blockquote>  Aponte aqui - o limite est√° no n√≠vel do componente Dumb.  O componente Dumb est√° controlando o qu√£o Dumb √©. </blockquote><br><h3 id="solution-3---tier">  Solu√ß√£o 3 - Camada </h3><br><p>  √â o mesmo que a Solu√ß√£o 2, mas com um limite mais inteligente, capaz de simular <em>camada</em> , <em>camada</em> ou o que voc√™ diz: </p><br><pre> <code class="plaintext hljs">const checkTier = tier =&gt; tier === currentTier; const withTier = tier =&gt; WrapperComponent =&gt; (props) =&gt; ( (process.env.NODE_ENV !== 'test' || checkTier(tier)) &amp;&amp; &lt;WrapperComponent{...props} /&gt; ); const PageChrome = () =&gt; ( &lt;section&gt; &lt;aside&gt;&lt;ASideContainer /&gt;&lt;/aside&gt; &lt;Page /&gt; &lt;/section&gt; ); const ASideContainer = withTier('UI')(...) const Page = withTier('Page')(...) const PageChromeContainer = withTier('UI')(PageChrome);</code> </pre> <br><blockquote>  Mesmo que isso seja quase semelhante ao exemplo de Limite - o componente Dumb √© Dumb e os Containers controlam a visibilidade de outros Containers. </blockquote><br><h4 id="solution-4---separate-concerns">  Solu√ß√£o 4 - Preocupa√ß√µes separadas </h4><br><p>  Outra solu√ß√£o √© apenas separar preocupa√ß√µes!  Quero dizer - voc√™ j√° fez isso, e provavelmente √© hora de utiliz√°-lo. </p><br><blockquote>  Ao <code>connect</code> componente ao Redux ou ao GQL, voc√™ est√° produzindo Containers <em>conhecidos</em> .  Quero dizer - com nomes <em>conhecidos</em> - <code>Container(WrapperComponent)</code> .  Voc√™ pode zombar deles pelo nome </blockquote><br><pre> <code class="plaintext hljs">const PageChrome = () =&gt; ( &lt;section&gt; &lt;aside&gt;&lt;ASideContainer /&gt;&lt;/aside&gt; &lt;Page /&gt; &lt;/section&gt; ); // remove all components matching react-redux pattern reactRemock.mock(/Connect\(\w\)/) // all any other container reactRemock.mock(/Container/)</code> </pre> <br><p>  Essa abordagem √© um pouco grosseira - vai limpar <em>tudo</em> , dificultando o teste de Contaiers, e voc√™ pode usar uma zombaria um pouco mais complexa para manter o "primeiro": </p><br><pre> <code class="plaintext hljs">import {createElement, remock} from 'react-remock'; // initially "open" const ContainerCondition = React.createContext(true); reactRemock.mock(/Connect\(\w\)/, (type, props, children) =&gt; ( &lt;ContainerCondition.Consumer&gt; { opened =&gt; ( opened ? ( // "close" and render real component &lt;ContainerCondition.Provider value={false}&gt; {createElement(type, props, ...children)} &lt;ContainerCondition.Provider&gt; ) // it's "closed" : null )} &lt;/ContainerCondition.Consumer&gt; )</code> </pre> <br><blockquote>  Aponte aqui: n√£o h√° l√≥gica interna nem Apresenta√ß√£o, n√£o Cont√™iner - toda l√≥gica est√° externa. </blockquote><br><h4 id="bonus-solution---separate-concerns">  Solu√ß√£o de b√¥nus - preocupa√ß√µes separadas </h4><br><p>  Voc√™ pode manter <em>um acoplamento r√≠gido</em> usando <code>defaultProps</code> e anular esses adere√ßos em testes ... </p><br><pre> <code class="plaintext hljs">const PageChrome = ({Content = Page, Aside = ASideContainer}) =&gt; ( &lt;section&gt; &lt;aside&gt;&lt;Aside/&gt;&lt;/aside&gt; &lt;Content/&gt; &lt;/section&gt; );</code> </pre> <br><h2 id="so">  Ent√£o </h2><br><p>  Acabei de publicar algumas maneiras de reduzir o escopo de qualquer componente e torn√°-lo muito mais test√°vel.  A maneira simples de tirar uma <code>gear</code> da <code>gearbox</code> de <code>gearbox</code> .  Um padr√£o simples para facilitar sua vida. </p><br><p>  Os testes E2E s√£o √≥timos, mas √© dif√≠cil simular algumas condi√ß√µes, que podem ocorrer dentro de um recurso profundamente aninhado e estar pronto para eles.  Voc√™ precisa ter testes de unidade para poder simular diferentes cen√°rios.  Voc√™ precisa ter testes de integra√ß√£o para garantir que tudo esteja conectado corretamente. </p><br><p>  Voc√™ sabe, como Dan escreveu em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">outro artigo</a> : </p><br><blockquote>  Por exemplo, se um bot√£o puder estar em um dos 5 estados diferentes (normal, ativo, pairar, perigo, desabilitado), o c√≥digo que atualiza o bot√£o deve estar correto para 5 √ó 4 = 20 transi√ß√µes poss√≠veis - ou proibir algumas delas.  Como domar a explos√£o combinat√≥ria de poss√≠veis estados e tornar a sa√≠da visual previs√≠vel? </blockquote><p>  Enquanto a solu√ß√£o certa aqui s√£o as m√°quinas de estado, ser capaz de escolher um √∫nico √°tomo ou mol√©cula e brincar com ele - √© o requisito b√°sico. </p><br><h3 id="the-main-points-of-this-article">  Os principais pontos deste artigo </h3><br><ol><li>  Os componentes de apresenta√ß√£o devem conter apenas outros componentes de apresenta√ß√£o. </li><li>  Recipientes s√£o a √°rvore.  Componentes s√£o folhas de √°rvores. </li><li>  Voc√™ nem <em>sempre</em> precisa conter cont√™ineres dentro dos de apresenta√ß√£o, mas <em>n√£o os cont√©m</em> apenas em testes. </li></ol><br><blockquote>  Voc√™ pode se aprofundar no problema lendo o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo</a> da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">m√≠dia</a> , mas aqui vamos pular todo o a√ß√∫car. </blockquote><p>  PS: Esta √© uma tradu√ß√£o da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">vers√£o do</a> artigo do <em>ru-habr</em> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt436692/">https://habr.com/ru/post/pt436692/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt436682/index.html">N√£o crie sua pr√≥pria JL (DSL) para expandir a funcionalidade do aplicativo</a></li>
<li><a href="../pt436684/index.html">Anivers√°rio Android 10 (Q). O que se sabe agora?</a></li>
<li><a href="../pt436686/index.html">JPEG do mundo 3D. O que √© glTF?</a></li>
<li><a href="../pt436688/index.html">A gigante de TI sai do mercado de chips para data centers - conte-nos o que isso significa para a ind√∫stria</a></li>
<li><a href="../pt436690/index.html">[Pergunte - responda] sobre propriedade intelectual e prote√ß√£o de dados</a></li>
<li><a href="../pt436694/index.html">Meu compilador Pascal e arte contempor√¢nea polonesa</a></li>
<li><a href="../pt436696/index.html">Como gerar som binaural em uma faixa de √°udio monocanal - o v√≠deo ajudar√°</a></li>
<li><a href="../pt436698/index.html">De quantas maneiras posso escrever fatorial para Scheme?</a></li>
<li><a href="../pt436700/index.html">Anti-spoofing: como os sistemas de reconhecimento de rosto resistem aos golpistas?</a></li>
<li><a href="../pt436704/index.html">A hist√≥ria de como escolhemos balan√ßas para automa√ß√£o de caixas registradoras</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>