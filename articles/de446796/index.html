<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê¢ üö• üéöÔ∏è Nicht standardm√§√üige Schaltung: Sieben-Segment-Anzeige bei ATtiny13 üèà ‚ûó üôãüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wir suchen nicht nach einfachen Wegen. 



 Zuvor war es meine erste Ver√∂ffentlichung, die bei den Nutzern von Habr f√ºr Resonanz sorgte. Beschlossen, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nicht standardm√§√üige Schaltung: Sieben-Segment-Anzeige bei ATtiny13</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446796/"><blockquote>  <i>Wir suchen nicht nach einfachen Wegen.</i> </blockquote><br><br><img src="https://habrastorage.org/webt/gl/vh/go/glvhgoheu-u5slanwr-7y9azjlg.jpeg" alt="Bild"><br><br>  Zuvor war es meine erste <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ver√∂ffentlichung,</a> die bei den Nutzern von Habr f√ºr Resonanz sorgte.  Beschlossen, nicht aufzuh√∂ren.  Wir quetschen weiterhin das Unm√∂gliche aus ATtiny13 heraus.  Ich warne Sie sofort, die beschriebenen L√∂sungen sind wieder nicht standardisiert und jemand kann Emp√∂rung und kognitive Dissonanz verursachen ("Und worum geht es dann im Artikel? Zeigen Sie, welche Elemente verbunden werden k√∂nnen?").  Dar√ºber hinaus ist eine solche L√∂sung auch wirklich unpraktisch, worauf ich weiter unten n√§her eingehen werde.  Aber so kam es, dass Standardl√∂sungen seit langem bekannt sind und das Lesen dar√ºber nicht immer interessant ist, aber das Schreiben ist undankbar. <br><a name="habracut"></a><br>  Ich mag dieses Kind ATtiny13 wirklich.  Er hat genug Verstand, um viele allt√§gliche Probleme zu l√∂sen (Licht einschalten, Bel√ºftung, <s>Bierladen</s> ).  Und der Preis ist einfach l√§cherlich.  Hier sind nur ein paar Beine und es gibt √ºberhaupt keine Griffe.  Daher m√ºssen Sie alle m√∂glichen Tricks anwenden, um das Problem des Beinmangels zu l√∂sen. <br><br>  W√§hrend ich die Programmierung von Mikrocontrollern studierte (in der Arduino-Umgebung sagen Sie es einfach niemandem), habe ich, wie viele andere auch, den Schritt des Anschlusses eines Ultraschall-Abstandssensors durchlaufen, etwa so: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2a2/c6c/0c1/2a2c6c0c19d10932dbcffa732d0482d7.jpg" alt="Bild"><br><br>  Da die Methode zur √úbertragung von Informationen vom Sensor zur Steuerung einfach zu blamieren ist, kann ATtiny13 dies problemlos bew√§ltigen.  Dann war es notwendig, Informationen auf einem Sieben-Segment-Indikator unter Verwendung von Schieberegistern anzuzeigen.  Das hei√üt, das Schema des Anzeigeteils war um ein Vielfaches gr√∂√üer als das der Steuerung selbst.  In diesem Moment spielte ich herum und ging weiter. <br><br>  K√ºrzlich dachte ich, was w√§re sonst eine √ºberw√§ltigende Aufgabe, Tinka zuzuweisen?  Was sie in den beschriebenen Beispielen noch nicht bew√§ltigen konnte.  Das erste, woran ich mich bei der Indikation erinnerte.  Vor einiger Zeit habe ich bereits nach Informationen zu einem √§hnlichen Thema gesucht.  Dann fand ich eine so <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">interessante</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Option.</a> <br><br><div class="spoiler">  <b class="spoiler_title">Bild</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/e08/0b6/2fb/e080b62fbc0864cbe0ba6f8dd6682132.gif" alt="Bild"><br></div></div><br>  21 Segmente von 5 Fu√ü des Controllers.  Wow!  Ich brauche nicht einmal so viel, zwei Zeichen reichen aus, plus ein Punkt, insgesamt 15 Segmente.  Und wenn mit vier Beinen?  Dann erhalten Sie maximal 13 Segmente, nicht genug.  Beim Anblick der Schaltung entstand sofort der Wunsch, zusammenzubauen und zu versuchen, obwohl es nicht einfach ist, einen Operationsalgorithmus zu erstellen.  Bei n√§herer Betrachtung verstehen Sie jedoch, dass das Sammeln nicht funktioniert. Solche sieben segmentierten Tiere gibt es in der Natur (h√∂chstwahrscheinlich) nicht.  Sie k√∂nnen nat√ºrlich machen, aber dies ist eine andere Ebene.  Dann wurde die Idee auf bessere Zeiten verschoben. <br><br>  Offtopic: Warum gibt es keine Sieben-Segment-Indikatoren mit integrierter Logik?  Wo suchen die Entwickler?  Wie bequem ist die Installation und Steuerung - zwei Power-Legs und 3 (1, 2) Daten-Legs.  Und schlie√ülich waren sie sogar in der UdSSR: 490IP1, 490IP2.  In der gew√∂hnlichsten Anzeige f√ºr 2 ... 4 Stellen ist viel Platz f√ºr die Platzierung der Chip-Mikroschaltung, und der Preis f√ºr das Schieberegister betr√§gt zusammen mit dem Geh√§use 0,064 cu.  Na ja. <br><br>  Und so dachte ich noch einmal dar√ºber nach, wie ich die Anzahl der Beine f√ºr die Arbeit mit dem Sieben-Segment-Indikator reduzieren kann.  Die Controller-Ausg√§nge k√∂nnen drei Zust√§nde annehmen (tats√§chlich 4, aber jetzt spielt es keine Rolle).  Gibt es eine M√∂glichkeit, dies zu nutzen?  Wenn zwei Zust√§nde in Bezug auf die LED nur als leuchtend interpretiert werden k√∂nnen, nicht als leuchtend, dann ist es mit drei etwas interessanter.  Ich habe noch nicht herausgefunden, wie ich es verwenden soll, aber das folgende Schema kam mir in den Sinn: <br><br><img src="https://habrastorage.org/webt/cw/f8/32/cwf832ajr1kedukuv_tyigpuzwk.jpeg" alt="Bild"><br><br>  Wenn sich der Controller-Ausgang im Nullzustand befindet, leuchten die LEDs nicht auf (was offensichtlich ist). <br><br>  Befindet sich der Ausgang im Ger√§tezustand, leuchten die LEDs, was ebenfalls verst√§ndlich ist. <br><br>  Wenn der Ausgang jedoch √ºberhaupt nicht der Ausgang ist, sondern auf den Eingang eingeschaltet ist, flie√üt ein Strom durch die Schaltung zweier Widerst√§nde und der LED HL1, wodurch am Verbindungspunkt der Widerst√§nde ein Spannungsabfall von ungef√§hr (5-1,7) / (2,2 + 1,5) entsteht. * 1,5 + 1,7 = 3,0 V. Dies reicht nicht aus, damit der Strom durch den Stromkreis VD1_R3_HL2 flie√üt (ungef√§hr 3,4 V werden ben√∂tigt).  VD1 ist eine zus√§tzliche LED, die als Zenerdiode verwendet wird (der Stabilisator ist korrekter), daher werden wir sie nicht als LED betrachten, um nicht verwirrt zu werden.  Es spielt keine Rolle, ob der Pull-up-Widerstand im Mikrocontroller eingeschaltet ist, sein Widerstand (20 kOhm) hat praktisch keinen Einfluss auf die Situation.  Ich bin nicht sofort zu solchen Bewertungen gekommen, bevor ich es mit einer normalen Diode wie VD1 versucht habe, funktioniert es auch ziemlich gut mit den gleichen Widerst√§nden R1 und R2.  Aber es ist besser, dass R2 ungef√§hr eineinhalb Mal gr√∂√üer ist als R1.  Und das Wichtigste habe ich fast vergessen: Alles Beschriebene ist nur mit <i>roten</i> und zus√§tzlichen LEDs m√∂glich.  In extremen F√§llen k√∂nnen <i>entweder die</i> Anzeige <i>oder</i> zus√§tzliche LEDs gr√ºn angelegt werden.  Und mit einer Versorgungsspannung von 4,5 V bis 5 V. <br><br>  Was haben wir am Ende?  Drei Zust√§nde: Keine LED (0) leuchtet, HL1 (1) leuchtet oder HL1 und HL2 (2) leuchten.  Sehr √§hnlich dem tern√§ren System.  Aber wir k√∂nnen HL2 nicht ohne HL1 beleuchten, das muss beachtet werden.  Aber jetzt k√∂nnen wir mit Hilfe der vier Beine des Mikrocontrollers acht LEDs steuern (das wollte ich mir denken). <br><br>  Dann habe ich versucht, die Indikatorsegmente in Paare aufzuteilen (genau wie in einem Kindergarten: ein Junge-M√§dchen).  Die Hauptbedingung ist, dass in jedem Paar eines der Segmente nicht f√ºr sich allein leuchten kann, eine solche Unterscheidung.  Folgendes habe ich bekommen: <br><br><img src="https://habrastorage.org/webt/rj/oa/dr/rjoadrat5-jro2zaaj6oe4dxrno.jpeg" alt="Bild"><br><br>  Vier Segmentpaare, in jedem Gro√übuchstaben ist das dominante Segment angegeben, das f√ºr sich arbeiten kann, das zweite nur mit ihm.  M√∂glicherweise stellen Sie fest, dass sich das Segment ‚Äûa‚Äú mit zwei gleichzeitig aufr√ºhrt und niemand den schlechten Punkt erreicht hat.  Wie es aussieht wie das Leben! <br><br>  Aber mit diesen Paaren k√∂nnen Sie (fast) alle Zahlen anzeigen: <br><br><div class="spoiler">  <b class="spoiler_title">Bild</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ux/vb/tv/uxvbtvxvpp1rlhvkqg23uld0oou.jpeg" alt="Bild"><br></div></div><br>  Jedes Paar ist in seiner eigenen Farbe bemalt.  Ein aufmerksamer Betrachter bemerkte, dass etwas mit der Zwei nicht stimmte.  Wir werden uns vorerst nicht darauf konzentrieren.  Ich habe ein paar weitere Optionen zum Gruppieren von Segmenten ausprobiert, besser nicht.  Vielleicht schl√§gt jemand vor.  Vielleicht k√∂nnte das neuronale Netzwerk damit umgehen. <br><br>  In der zweiten Phase der Experimente musste ich einen Indikator mit einer gemeinsamen Anode verwenden.  Daher lautet das endg√ºltige Schema wie folgt: <br><br><div class="spoiler">  <b class="spoiler_title">Schema</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/cq/nd/jo/cqndjod7jj6ofopx2fcwmuvqums.jpeg" alt="Bild"><br></div></div><br>  Jemand k√∂nnte fragen: Wo sind die 100-Ohm-Widerst√§nde geblieben?  Es ist seit langem bekannt (und wird aktiv genutzt), dass bei korrekt gemachten dynamischen Anzeigen auf strombegrenzende Widerst√§nde verzichtet werden kann.  Selbst wenn die Spannung vom Ausgang des Controllers st√§ndig an die beiden versehentlich in Reihe geschalteten LEDs angelegt wird, halten der Mikrocontroller und die LEDs dies normalerweise aus, wird der Strom durch den √úbergangswiderstand im MC begrenzt.  Und mehr √ºber Widerst√§nde.  Der maximale Strom durch HL1 gem√§√ü dem vorherigen Schema betr√§gt ungef√§hr 2 mA und durch HL2 erreicht er 25 ... 40 mA (vermutlich werde ich Ihnen sp√§ter sagen, woher diese Zahlen stammen).  Dies bedeutet, dass die Lichtleistung verschiedener Segmente unterschiedlich ist.  Da jedoch eine dynamische Anzeige verwendet wird, kann dies aufgrund der unterschiedlichen Anzeigezeit der Segmente leicht gel√∂st werden. <br><br>  Alle Experimente habe ich am Arduino Nano in der Arduino IDE durchgef√ºhrt.  Ein exzellentes Prototyping-Board, es wird gut im Steckbrett, es wird problemlos √ºber USB geflasht.  Ist etwas gescheitert?  Ich habe die Skizze repariert und in einer Minute eine neue Firmware hochgeladen.  Und wenn Sie den Code debuggt haben, k√∂nnen Sie die Firmware in ATtiny13 aufrufen, es sind noch ein wenig mehr Gesten erforderlich. <br><br>  √úbrigens blinke ich auch mit Arduino in der Arduino-Umgebung, dies eliminiert praktisch die M√∂glichkeit, MK mit den falschen Sicherungen zu verriegeln, und ist viel einfacher. <br><br>  Hier ist ein Beispiel f√ºr die Anzeige von 4 im Code: <br><br><pre><code class="cpp hljs">pinMode(f_a, INPUT); <span class="hljs-comment"><span class="hljs-comment">//    f_a   digitalWrite(f_a, 1); //   F pinMode(d_e, OUTPUT); //    d_e   digitalWrite(d_e, 1); //     1,     D  E pinMode(b_a, INPUT); //    b_a   digitalWrite(b_a, 1); //   B pinMode(c_g, OUTPUT); //    c_g   digitalWrite(c_g, 0); //     0,   C,  G delayMicroseconds (150); // F, B, C, G c  150  pinMode(c_g, INPUT); //    c_g   digitalWrite(c_g, 1); //   G ,     delay (time_2); // F, B, C c  2 </span></span></code> </pre> <br>  Im Prinzip sollte alles klar sein, auch f√ºr diejenigen, die nicht mit Arduino vertraut sind, aber ein wenig √ºber die Controller verstehen.  Zahlen von 150 Mikrosekunden und 2 Millisekunden werden experimentell durch die Helligkeit der Segmente ausgew√§hlt.  Im endg√ºltigen Code m√ºssen Sie sie in separate Variablen einf√ºgen, damit Sie sie w√§hrend des Debuggens √§ndern k√∂nnen.  Aus diesen Figuren ist es m√∂glich, die Reihenfolge der Stromdifferenz √ºber zwei Segmente in einem Paar ungef√§hr zu bestimmen.  Da das G-Segment etwa 13-mal weniger leuchtet als die anderen und die gleiche Helligkeit bietet, kann davon ausgegangen werden, dass der Strom durch dieses Segment 13-mal h√∂her ist als durch die anderen.  Tats√§chlich ist die Abh√§ngigkeit der Helligkeit vom Strom nichtlinear, so dass der Strom 25-mal gr√∂√üer sein kann, d. H. 50 mA.  Das mit einem solchen Arbeitszyklus ist f√ºr die Ausgabe von MK ziemlich sicher.  √úbrigens spielte dieser Unterschied in den Str√∂men bei der L√∂sung des Problems von Abbildung 2 in die H√§nde. Wie ich oben geschrieben habe, kann Segment G nur zusammen mit Segment C beleuchtet werden. Wenn Sie jedoch 0 f√ºr 150 Œºs und danach an das MK-Bein √ºbergeben, das f√ºr C und G verantwortlich ist 2 ms, um 1 darauf zu halten, dann "arbeitet" das G-Segment bei voller Helligkeit, und das C-Segment hat nur wenig Zeit, um f√ºr die gleichen 150 Mikrosekunden zu leuchten.  Wir bekommen fast volle zwei.  So gelang es mir, die von mir selbst festgelegte Regel zu brechen.  Was kann man nicht aus Hoffnungslosigkeit machen. <br><br>  Also haben wir die Figur mit den vier Beinen des MK beleuchtet.  Eigentlich habe ich diese Etappe f√ºr mich verpasst, sofort zwei Charaktere angezeigt.  Trennen Sie dazu den Ausgang der gemeinsamen Anode eines der Anzeigebits vom Power Plus und verbinden Sie ihn mit einem anderen MK-Ausgang und die Anode der anderen Entladung mit dem n√§chsten Ausgang (bereits 6 Beine).  Setzen Sie nun wiederum 1 auf die Anode der niedrigstwertigen Ziffer, zeigen Sie die Ziffer der niedrigstwertigen Ziffer an, dann 1 auf der Anode der niedrigstwertigen Ziffer und zeigen Sie die Ziffer der h√∂chsten Ziffer usw. in einem Kreis an.  Ich habe dieses Experiment mit Arduino Nano durchgef√ºhrt, sie hat genug Beine.  Der gesamte Code wurde darauf debuggt, nicht beim ersten Mal.  Und so funktionierte es, wie es sollte. <br><br><div class="spoiler">  <b class="spoiler_title">Schema</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/m6/5t/jp/m65tjptj6-dkubdfrmwlxup9olm.jpeg" alt="Bild"><br></div></div><br>  Da die Anoden nacheinander mit Hilfe einer einfachen Verfeinerung verbunden sind, kann ein weiterer Ausgang des MK freigegeben werden.  Hier ist das zusammenfassende Diagramm: <br><br><div class="spoiler">  <b class="spoiler_title">Schema</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/8e/xe/zc/8exezcoas6flcayfpbvdeenevdm.jpeg" alt="Bild"><br></div></div><br>  Verwenden Sie insgesamt 5 Beine MK, um eine zweistellige Zahl anzuzeigen.  Zu diesem Zeitpunkt k√∂nnen Sie es bereits mit dem Baby ATtiny versuchen.  Was ich getan habe.  Aber nicht sofort.  Eine in einer Arduino-Umgebung f√ºr ATtiny13 erstellte Skizze beanspruchte ungef√§hr 1,7 kB Speicher, wobei 1 kB verf√ºgbar war.  Um die Gr√∂√üe zu reduzieren, musste ich mich direkt an die Ports wenden, was ich sp√§ter tun w√ºrde.  √úbrigens habe ich auf Arduino die gleichen Ports verwendet, die ich auf ATtiny verwenden wollte. Das ist sehr praktisch.  Sie sind bereits im letzten Diagramm angegeben.  Nach der Verarbeitung verlor der Code ein Kilobyte. <br><br>  Hier ist der resultierende Code f√ºr ATtiny13: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> time_2 2 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    ,  #define time_3 150 //    ,  byte in1_; byte in2_; int disp_; int d_ = 0; void setup() { } void loop() { d_ = d_ + 1; if (d_ &gt; 150) { //    150     1 d_ = 0; disp_ = disp_ + 1; if (disp_ &gt; 99)(disp_ = 0); //   0  99 } in2_ = disp_ / 10; //     -    10 in1_ = disp_ % 10; //          10 } switch (in1_) { case 0: DDRB = B00001111; PORTB = B00010000; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 1: DDRB = B00000111; PORTB = B00000110; delay (time_2); break; case 2: DDRB = B00011111; PORTB = B00000010; delayMicroseconds (time_3); DDRB = B00010011; PORTB = B00010010; delay (time_2); break; case 3: DDRB = B00011011; PORTB = B00000110; delayMicroseconds (time_3); DDRB = B00000011; delay (time_2); break; case 4: DDRB = B00010101; PORTB = B00001110; delayMicroseconds (time_3); DDRB = B00000101; delay (time_2); break; case 5: DDRB = B00011011; PORTB = B00001100; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 6: DDRB = B00011111; PORTB = B00001000; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 7: DDRB = B00001111; PORTB = B00010110; delayMicroseconds (time_3); DDRB = B00000111; delay (time_2); break; case 8: DDRB = B00011111; PORTB = B00000000; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 9: DDRB = B00011011; PORTB = B00000100; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; } switch (in2_) { case 0: DDRB = B00001111; PORTB = B00010001; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 1: DDRB = B00000111; PORTB = B00000111; delay (time_2); break; case 2: DDRB = B00011111; PORTB = B00000011; delayMicroseconds (time_3); DDRB = B00010011; PORTB = B00010011; delay (time_2); break; case 3: DDRB = B00011011; PORTB = B00000111; delayMicroseconds (time_3); DDRB = B00000011; delay (time_2); break; case 4: DDRB = B00010101; PORTB = B00001111; delayMicroseconds (time_3); DDRB = B00000101; delay (time_2); break; case 5: DDRB = B00011011; PORTB = B00001101; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 6: DDRB = B00011111; PORTB = B00001001; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 7: DDRB = B00001111; PORTB = B00010111; delayMicroseconds (time_3); DDRB = B00000111; delay (time_2); break; case 8: DDRB = B00011111; PORTB = B00000001; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 9: DDRB = B00011011; PORTB = B00000101; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; } DDRB = B00011111;//   PORTB = B00011110; delay (5); }</span></span></span></span></code> </pre><br></div></div><br>  Mit dem obigen Code kann Ihr ATtiny13 von 0 bis 99 lesen. Es w√§re korrekter, die M√∂glichkeit einer Neuzuweisung der MK-Beine vorzusehen.  Programmiergurus k√∂nnen den Code mehrmals reduzieren ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wo ist das Mindestlimit f√ºr Hello World bei AVR?</a> ). <br><br>  Sie k√∂nnen dem Code die erforderliche Funktion hinzuf√ºgen, damit MK etwas Bewusstes anzeigt.  Zwar hat Tinki schon alle Beine besetzt.  Es gibt auch einen Reset-Zweig, der als Eingabe- / Ausgabeport verwendet werden kann.  Aber es zu benutzen war schwieriger als ich dachte.  Deshalb gehe ich f√ºr mich "f√ºr sp√§ter".  Aber es gibt eine interessante Funktion, die nicht jeder kennt.  Der Analogeingang ADC0 wird an denselben Zweig ausgegeben und funktioniert!  Wenn die Spannung weniger als 1/4 der Versorgungsspannung betr√§gt, wechselt der MK in den Reset-Modus.  Von 1/4 bis zur Versorgungsspannung ist es jedoch durchaus m√∂glich, die Eingangsspannung zu messen.  Ich habe das ausgenutzt: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> time_2 2 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    ,  #define time_3 150 //    ,  byte in1_; byte in2_; int disp_; int d_ = 0; void setup() { } void loop() { d_ = d_ + 1; if (d_ &gt; 50) { //   50 ... d_ = 0; disp_ = analogRead(A0) / 10; // ...   ,   10,    . if (disp_ &gt; 99)(disp_ = 99); in2_ = disp_ / 10; //     -    10 in1_ = disp_ % 10; //          10 } switch (in1_) { case 0: DDRB = B00001111; PORTB = B00010000; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 1: DDRB = B00000111; PORTB = B00000110; delay (time_2); break; case 2: DDRB = B00011111; PORTB = B00000010; delayMicroseconds (time_3); DDRB = B00010011; PORTB = B00010010; delay (time_2); break; case 3: DDRB = B00011011; PORTB = B00000110; delayMicroseconds (time_3); DDRB = B00000011; delay (time_2); break; case 4: DDRB = B00010101; PORTB = B00001110; delayMicroseconds (time_3); DDRB = B00000101; delay (time_2); break; case 5: DDRB = B00011011; PORTB = B00001100; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 6: DDRB = B00011111; PORTB = B00001000; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 7: DDRB = B00001111; PORTB = B00010110; delayMicroseconds (time_3); DDRB = B00000111; delay (time_2); break; case 8: DDRB = B00011111; PORTB = B00000000; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 9: DDRB = B00011011; PORTB = B00000100; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; } switch (in2_) { case 0: DDRB = B00001111; PORTB = B00010001; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 1: DDRB = B00000111; PORTB = B00000111; delay (time_2); break; case 2: DDRB = B00011111; PORTB = B00000011; delayMicroseconds (time_3); DDRB = B00010011; PORTB = B00010011; delay (time_2); break; case 3: DDRB = B00011011; PORTB = B00000111; delayMicroseconds (time_3); DDRB = B00000011; delay (time_2); break; case 4: DDRB = B00010101; PORTB = B00001111; delayMicroseconds (time_3); DDRB = B00000101; delay (time_2); break; case 5: DDRB = B00011011; PORTB = B00001101; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 6: DDRB = B00011111; PORTB = B00001001; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 7: DDRB = B00001111; PORTB = B00010111; delayMicroseconds (time_3); DDRB = B00000111; delay (time_2); break; case 8: DDRB = B00011111; PORTB = B00000001; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 9: DDRB = B00011011; PORTB = B00000101; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; } DDRB = B00011111;//   PORTB = B00011110; delay (5); }</span></span></span></span></code> </pre><br></div></div><br>  Die Erfahrung zeigt, dass die Anzeige auf bis zu 21 reduziert werden kann. Erst dann wechselt der MK in den Reset-Modus und beginnt zu arbeiten, wenn er auf etwa 25 und h√∂her zur√ºckkehrt.  Es ist also m√∂glich, eine sehr falsche ‚ÄûAnzeige‚Äú f√ºr die Anzeige einer Spannung von 25 bis 99 Volt zu erstellen, nat√ºrlich mit einem Teiler am Messeingang. <br><br>  Nun zur praktischen Anwendung.  Die urspr√ºngliche Idee, Daten von einem Abstandssensor anzuzeigen, wurde aufgrund des Fehlens eines digitalen Eingangs auf bessere Zeiten verschoben.  Warum sonst k√∂nnen Sie das Schema anwenden, bis Ideen kommen.  Noch eine Einschr√§nkung: Von Rentabilit√§t kann keine Rede sein.  Selbst wenn Sie alle Segmente auszahlen, flie√üt ein Strom von 2,5 mA durch den Widerstand R2 (gem√§√ü dem ersten Schema), insgesamt 10 mA pro Indikator, und die Steuerung des Transistors f√ºgt etwa 5 weitere hinzu.  Ich habe nicht erw√§hnt, der Transistor von fast jedem PNP ist modern. <br><br>  √úber Zweckm√§√üigkeit.  Die billigste Option f√ºr die Ausgabe in das Siebensegment ist ATtiny13 plus 74HC595.  Zwei SMD-F√§lle kosten mich ungef√§hr 0,50 cu  Das einfachste ist ATmega8 (und das war's, keine Widerst√§nde, nichts weiter), es ist 0,68 cu  Und die oben beschriebene Option sind die Kosten f√ºr ATtiny, 9 Widerst√§nde, 4 LEDs, einen Transistor (alle SMDs) - das sind ungef√§hr 0,46 cu, obwohl es St√ºck f√ºr St√ºck alles manchmal teurer ist.  Dar√ºber hinaus ist das Zusammenstellen komplizierter als in den vorherigen Versionen. <br><br>  Eigentlich ist die einzige Option, die ich sehen kann, wenn Sie ein volles ATtiny13 haben, aber Sie m√ºssen immer noch f√ºr ATmega in den Laden gehen.  Nun, wenn eine Sieben-Segment-Anzeige die Hauptdekoration Ihres Ger√§ts ist, w√ºrde ich dieses Schema nicht empfehlen, die Anzeige ist nicht perfekt, in einigen Kombinationen werden unn√∂tige Segmente leicht hervorgehoben.  Es kommt vor, dass die Anzeige gelegentlich beim Einrichten ben√∂tigt wird, dann der Ort selbst. <br><br>  Im Allgemeinen habe ich ein paar Tage vergebens verbracht. <br><br>  Neben der Kritik warte ich auf Vorschl√§ge zur Verbesserung des Codes und zur Vereinfachung des Schemas.  Oder verbesserte Funktionalit√§t ohne Komplikationen.  Was mich am meisten interessiert, ist, wie man einen Punkt beleuchtet, dies w√ºrde den Umfang erweitern.  Aber wenn wir auch eine Schlussfolgerung aus den 5 Beteiligten herausholen k√∂nnten, w√§re es m√∂glich, sich zu bewegen. <br><br>  Ich w√ºrde mich freuen, wenn meine nicht standardm√§√üige L√∂sung irgendwann jemandem zugute kommt, nicht jetzt. <br><br><blockquote>  UPD: Ich wei√ü √ºber Charliplexing Bescheid!  Das Schema von Drittanbietern, das ich am Anfang dieses Artikels zitiert habe, ist Charliplexing.  Und dort schrieb ich, warum Charliplexing nicht geeignet ist. <br>  Bitte schreiben Sie keine Kommentare, wenn Sie den Artikel diagonal lesen. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de446796/">https://habr.com/ru/post/de446796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de446782/index.html">Yo-ho-ho und eine Flasche Rum</a></li>
<li><a href="../de446786/index.html">Warum ich Disqus verlassen habe und du gehen musst</a></li>
<li><a href="../de446788/index.html">Tipps und Tricks von Kubernetes: Informationen zur lokalen Entwicklung und Telepr√§senz</a></li>
<li><a href="../de446790/index.html">Wie ich in der Sicherheit von Android ein Osterei entdeckte und keinen Job bei Google bekam</a></li>
<li><a href="../de446794/index.html">Wir arbeiten korrekt mit Wordstat. Komplette Anleitung</a></li>
<li><a href="../de446798/index.html">Der Abgang eines Elektronikingenieurs von Apple sorgte bei Aktienspekulanten f√ºr Aufsehen. Wie werde ich wie er?</a></li>
<li><a href="../de446802/index.html">Punktkassetten nachf√ºllen - das ist interessant</a></li>
<li><a href="../de446806/index.html">Hintergrund: "Autonomous Runet" - was ist das und wer braucht es?</a></li>
<li><a href="../de446808/index.html">Mein Compiler f√ºr Lisp</a></li>
<li><a href="../de446810/index.html">Wenn Sie eine Schachtel Zigaretten in der Tasche haben ...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>