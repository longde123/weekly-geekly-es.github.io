<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëãüèæ ü§ü üëèüèø T√∫neis e VPNs resistentes a DPI ‚úÇÔ∏è üí© üßôüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vivemos um momento interessante. Eu diria mesmo de maneiras surpreendentes. Por um lado, vemos algumas pessoas que realmente querem saber o que as out...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>T√∫neis e VPNs resistentes a DPI</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415977/"> Vivemos um momento interessante.  Eu diria mesmo de maneiras surpreendentes.  Por um lado, vemos algumas pessoas que realmente querem saber o que as outras pessoas est√£o falando e querem realmente dizer a elas o que pode ser lido e o que n√£o pode ser lido.  Por outro lado, os cidad√£os que desejam reivindicar seus direitos a segredos de correspond√™ncia pessoal e informa√ß√µes gratuitas e n√£o querem que os fatos dessa mesma correspond√™ncia e o recebimento dessas informa√ß√µes sejam usados ‚Äã‚Äãcontra eles.  Um grande n√∫mero de sites, servi√ßos e empresas de terceiros atingidos por "bloqueios de carpete" sofre como um b√¥nus. <br><br>  Mas n√£o, este artigo n√£o √© sobre sociedade, mas sobre tecnologia. <br><br><img src="https://habrastorage.org/webt/ai/x5/4v/aix54v5uoghgxq1dmmisvj-brke.jpeg" alt="imagem"><br><a name="habracut"></a><br>  A alfabetiza√ß√£o t√©cnica das pessoas, gra√ßas a tudo o que est√° acontecendo, tamb√©m est√° crescendo.  Se antes as palavras ‚ÄúVPN‚Äù e ‚Äúproxies‚Äù eram familiares apenas aos especialistas em TI, agora at√© as donas de casa as conhecem e, al√©m disso, usam o que essas palavras significam. <br><br>  Em geral, as not√≠cias chegaram recentemente bastante divertidas.  Por exemplo, o fornecimento de servi√ßos VPN e similares para criptografar tr√°fego e contornar bloqueios <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">agora</a> √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pun√≠vel</a> e, na China, eles geralmente os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aprisionam</a> por isso.  E n√£o faz muito tempo, o ILV come√ßou a usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a an√°lise de pacotes para bloquear</a> o protocolo MTProxy.  Voc√™ tamb√©m pode se referir √† experi√™ncia dos pa√≠ses mais bem-sucedidos em tais assuntos: China, Ir√£, Cazaquist√£o, Venezuela.  Na Venezuela, por exemplo, eles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bloqueiam</a> diretamente as conex√µes diretas com o Tor e ofuscam o tr√°fego para as pontes.  Com base em tudo isso, pode-se presumir que o futuro nos espera tamb√©m √© muito interessante, especialmente se as ‚Äúpessoas respons√°veis‚Äù pararem de fazer falsas idiotas repetidas vezes e agirem de maneira mais inteligente e sofisticada. <br><br>  Sobre Habr√©, repetidamente, nos coment√°rios, previs√µes de como a luta com tecnologias de criptografia para cidad√£os comuns pode continuar.  Analisando os pensamentos expressos e observando testemunhos de outros pa√≠ses, tentei sugerir em que dire√ß√£o as medidas para limitar a comunica√ß√£o poderiam avan√ßar ainda mais.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">DistortNeo</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">shifttstas</a> lan√ßaram algumas id√©ias mais interessantes e, no final, prometi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">√† el777</a> adicionar este artigo. <br><br>  Com os filtros ACL, tudo fica claro.  Eles est√£o agindo agora, e com sucesso variado, conseguem e n√£o conseguem lutar (embora haja <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">previs√µes</a> bastante <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pessimistas</a> ).  DPI √© mais interessante. <br><br>  Os m√©todos para "determinar" o tipo de tr√°fego para DPI podem ser divididos em dois grupos: <br><br><ul><li>  An√°lise de assinatura.  Ou seja, desmontar a embalagem "pelos ossos", comparando os cabe√ßalhos e a estrutura com as amostras, e assim determinando sua finalidade.  Assim, muitos t√∫neis s√£o detectados, por exemplo, OpenVPN, L2TP / IPSec, SOCKS, etc. </li><li>  Uma an√°lise preliminar dos padr√µes de troca de tr√°fego, por exemplo, a propor√ß√£o do fluxo de entrada / sa√≠da, a frequ√™ncia da solicita√ß√£o-resposta e outros crit√©rios nos permitir√° separar o "tr√°fego real" de um protocolo e o t√∫nel que apenas se disfar√ßa como protocolo. </li></ul><br><img src="https://habrastorage.org/webt/xj/a3/ny/xja3nye4iqnsser5zm2gxgbcjbq.jpeg" alt="imagem"><br><br>  Voc√™ pode dividir o tr√°fego em v√°rios grupos e assumir o que eles far√£o com cada um deles. <br><br><ol><li>  <b>VPNs, t√∫neis e proxies ‚Äúexpl√≠citos‚Äù (OpenVPN, L2TP / IPSec, SOCKS, etc.)</b> VPNs e t√∫neis comuns podem ser bloqueados automaticamente, como, por exemplo, na China e na Venezuela.  Se algumas organiza√ß√µes ou empresas precisarem dela para trabalhar, deixe-as se registrar e certificar, como fala especificamente a lei russa mencionada acima.  Com um proxy, √© ainda mais f√°cil - que o HTTP, o SOCKS transmite endere√ßos e conte√∫dos em texto n√£o criptografado, o que geralmente n√£o cria problemas para o "corte" seletivo de solicita√ß√µes e a escuta telef√¥nica das informa√ß√µes transmitidas. </li><li>  <b>Tecnologias de uso duplo, como SSH</b> .  Pouco tempo depois da sess√£o ter sido estabelecida, a velocidade √© reduzida a uma tartaruga, para que voc√™ possa trabalhar pelo menos de alguma forma no console, mas n√£o h√° mais navega√ß√£o e download.  O fato de isso criar problemas durante o trabalho normal n√£o incomoda ningu√©m (o que nos foi mostrado pela ILV mais de uma vez nos √∫ltimos tempos). </li><li>  <b>Protocolos altamente espec√≠ficos, como mensageiros, clientes de jogos etc.</b> </li><li>  <b>Compostos cujo tipo n√£o pode ser determinado</b> . </li></ol><br>  Para os itens 3 e 4, as ‚Äúlistas brancas‚Äù s√£o bastante poss√≠veis (nas quais, por exemplo, s√£o inseridas sub-redes de servidores oficiais de jogos ou mensageiros ‚Äúcorretos‚Äù e tudo o que os propriet√°rios do servidor desejam declarar e organizar conforme necess√°rio para que n√£o sejam tocados, aqueles que a ILV j√° possui para dom√≠nios e endere√ßos IP).  E aqueles que n√£o est√£o nessas listas enfrentar√£o o mesmo destino que o par√°grafo 1 ou o par√°grafo 2, embora seja poss√≠vel n√£o bloquear ou diminuir abruptamente a velocidade, mas analisar os padr√µes de troca mencionados anteriormente para determinar se o tr√°fego √© "puro" "Ou" suspeito. " <br><br>  Ou seja, se voc√™ deseja se disfar√ßar de protocolos especiais ou ofuscar as conex√µes para que seja imposs√≠vel determinar seu tipo, voc√™ tamb√©m precisar√° criar um "ru√≠do" que impe√ßa a detec√ß√£o de padr√µes reais de troca.  At√© o momento, esses desenvolvimentos n√£o passaram pela minha cabe√ßa. <br><br>  Voc√™ nem se lembra dos diferentes t√∫neis de ICMP e DNS - uma grande quantidade de tr√°fego "onde n√£o √© necess√°rio" neles automaticamente tamb√©m levanta suspeitas. <br><br>  5. <b>TLS e SSL, HTTPS</b> .  √â imposs√≠vel fazer uma limpeza, pois isso significa automaticamente bloquear toda a Internet.  A an√°lise de padr√µes n√£o faz sentido, pois a navega√ß√£o na web √© apenas o principal objetivo do uso de HTTPS.  De todas as op√ß√µes acima, o SSL / TLS na porta 443 parece a op√ß√£o mais "desavisada" e confi√°vel.  Portanto, vamos tentar nos disfar√ßar como ele. <br><br><img src="https://habrastorage.org/webt/sj/3u/2z/sj3u2zoggi2ofngemk1maytasyw.jpeg" alt="imagem"><br><br><h3>  Disfar√ßar-nos </h3><br>  Para considera√ß√£o, foi decidido escolher as solu√ß√µes Streisand e SoftEther. <br><br>  <a href="" rel="nofollow">Streisand</a> - um conjunto completo de servi√ßos diferentes: OpenConnect / AnyConnect, OpenVPN, stunnel, Shadowsocks, WireGuard.  Tudo isso √© definido no modo ‚Äúchave na m√£o‚Äù autom√°tico ou semiautom√°tico e, na sa√≠da, o usu√°rio recebe um servidor configurado, al√©m de arquivos e documenta√ß√£o detalhada para a configura√ß√£o de clientes. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">O SoftEther</a> √© um servidor VPN capaz de levantar L2TP / IPsec, OpenVPN, SSTP e outros protocolos, al√©m de possuir seu pr√≥prio protocolo SSL-VPN, que, segundo os autores, √© indistingu√≠vel do tr√°fego HTTPS normal. <br><br>  Ent√£o ... <br><br>  <b>OpenConnect / AnyConnect.</b>  Implementa√ß√£o de c√≥digo aberto do protocolo Cisco AnyConnect SSL.  Quando uma conex√£o √© estabelecida, n√£o apenas os pacotes TLS (TCP), mas tamb√©m os pacotes DTLS (UDP) s√£o vis√≠veis.  O DTLS, em princ√≠pio, tamb√©m √© usado muito onde "para fins pac√≠ficos", mas isso n√£o √© como "HTTPS normal".  No entanto, se voc√™ cortar o tr√°fego UDP no firewall, o AnyConnect imediatamente retornar√° ao TCP e, do lado de fora, parecer√° completamente e completamente como o TLS normal, e at√© a autentica√ß√£o dentro do t√∫nel criptografado √© quase como no HTTP. <br><br>  <b>Shadowsocks</b> .  Proxy SOCKS criptografado.  Aparentemente, se desejado, ele <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">pode ser detectado</a> , no entanto, existem plugins que o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">disfar√ßam como "puro HTTPS"</a> .  H√° tamb√©m um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">plugin</a> para trabalhar com websockets, mas mais sobre isso mais tarde. <br><br>  <b>Wireguard</b>  A julgar pela descri√ß√£o, ele possui criptografia bem distorcida e um mecanismo de configura√ß√£o de sess√£o, mas toda a comunica√ß√£o ocorre atrav√©s do UDP.  O Wireshark define o tipo de pacote como algo completamente inaud√≠vel, e que opini√£o do que est√° acontecendo com um DPI de terceiros √© uma quest√£o muito, muito grande.  <b>Upd:</b> As vers√µes mais recentes definem o Wireguard exclusivamente como Wireguard, portanto a resposta para a pergunta √© √≥bvia. <br><br>  <b>obfs3, obfs4</b> .  Os pacotes ser√£o ofuscados para que, de fora, pare√ßam um conjunto de valores completamente aleat√≥rio.  Ou seja, eles se enquadram no item 4 da lista acima. <br><br>  <b>SoftEther</b>  Parece HTTPS, mas com uma captura.  Al√©m de TLS diretamente sobre TCP, ele envia ativamente pacotes de pacotes UDP.  Como foi descoberto na documenta√ß√£o, o UDP pode ser usado para acelerar a transfer√™ncia de dados no caso em que n√£o √© eliminado no firewall.  Essa funcionalidade est√° desabilitada na configura√ß√£o e, depois de desabilitada, tudo se torna como deveria. <br><br>  <b>SSTP</b> .  Prokotol VPN da Microsoft.  Suporte nativo no Windows, suporte a software no GNU / Linux.  Do lado de fora, parece HTTPS, e o Wireshark confirma isso completamente. <br><br><h3>  Mas isso n√£o √© tudo </h3><br>  Suponha que voc√™ instalou um servidor VPN ou o fim de um t√∫nel em um host e o configurou para escutar na porta 443.  Parece que est√° tudo bem, mas h√° um MAS: se nos disfar√ßarmos de HTTPS, voc√™ pode verificar se, na verdade, est√° travado na porta 443, simplesmente tentando se enterrar nessa porta com um navegador simples ou CURL, ou de qualquer outra maneira.  Em alguns artigos, esse m√©todo √© chamado de "conex√£o de chumbo" e, como mencionado, j√° √© bastante utilizado na China. <br><br>  Portanto, precisamos que, na porta 443, tenhamos o servidor da Web mais comum e decente.  E aqui surge um problema interessante. <br><br>  Nenhum dos servi√ßos acima na documenta√ß√£o principal encontrou uma descri√ß√£o do mecanismo de trabalho do compartilhamento de portas.  A <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">op√ß√£o SSLH</a> n√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√©</a> adequada, apenas porque o sslh n√£o pode compartilhar tr√°fego entre HTTPS e os servi√ßos acima.  Pelo menos, porque se o tipo de tr√°fego sem descriptografia completa puder distinguir sslh, o DPI poder√°. <br><br>  A maioria dos homens, assim, sugere o uso de Server Name Indication (SNI) - uma extens√£o TLS que permite especificar um nome de host e, em seguida, usar HAProxy, sniproxy e outras ferramentas para dispersar as conex√µes de servi√ßos.  O problema √© que, nas implementa√ß√µes modernas do TLS, o nome do host especificado ao usar o SNI √© transmitido em texto sem formata√ß√£o, ou seja, em forma n√£o criptografada e, portanto, tamb√©m pode ser espionado e usado no futuro. <br><br>  Portanto, improvisaremos, e ent√£o duas op√ß√µes vieram √† minha mente. <br><br><h4>  Porto batendo </h4><br><img src="https://habrastorage.org/webt/54/_n/v7/54_nv7qxgj4idvoek-ooxn6r6ju.jpeg" alt="imagem"><br><br>  A batida na porta foi projetada apenas para ativar "servi√ßos ocultos" no servidor.  Por exemplo, de uma maneira semelhante, a porta na qual o daemon SSH trava √© frequentemente fechada "para fora" para evitar for√ßa bruta e o uso de vulnerabilidades de 0 dia.  Na vers√£o cl√°ssica (consulte, por exemplo, a implementa√ß√£o do daemon knockd), a batida √© geralmente entendida como tentativas de estabelecer uma conex√£o ou enviar pacotes para portas de host espec√≠ficas em uma determinada sequ√™ncia, como resultado do qual o daemon o ‚Äúreconhece‚Äù por si pr√≥prio e ativa uma regra de firewall que permite o acesso a uma porta espec√≠fica somente do seu IP. <br><br>  No nosso caso, essa op√ß√£o n√£o √© totalmente aceit√°vel.  Em primeiro lugar, as pr√≥prias portas ‚Äún√£o padronizadas‚Äù podem ser bloqueadas em algum ponto do caminho e, em segundo lugar, o pr√≥prio procedimento, quando analisado de fora, pode parecer suspeito.  Desde que nos disfar√ßamos como HTTPS, precisamos "bater" no HTTPS. <br><br>  Surpreendentemente, n√£o havia batedores HTTP / HTTPS com a funcionalidade necess√°ria e, portanto, um nocker nasceu com o nome rom√¢ntico <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">Labean</a> (hussardos, fique quieto!). <br><br>  Dado: nosso servidor, no qual o Nginx √© executado na porta 443 com certificados configurados corretamente e exibe algum conte√∫do completamente inofensivo, por exemplo, GIFs com gatos, imagens ISO de distribui√ß√µes GNU / Linux ou um espelho da Wikipedia e a biblioteca de Moshkov. <br><br>  Ao mesmo tempo, as linhas do formul√°rio ocultam na configura√ß√£o do Nginx <br><br><pre><code class="nginx hljs"> <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> <span class="hljs-regexp"><span class="hljs-regexp">~ ^/somesecret/(.*)</span></span> {
    <span class="hljs-attribute"><span class="hljs-attribute">auth_basic</span></span>      <span class="hljs-string"><span class="hljs-string">"Administrator Login"</span></span>;
    <span class="hljs-attribute"><span class="hljs-attribute">auth_basic_user_file</span></span>  /var/www/.htpasswd;
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span>  X-Real-IP  <span class="hljs-variable"><span class="hljs-variable">$remote_addr</span></span>;
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://127.0.0.1:8080/<span class="hljs-variable"><span class="hljs-variable">$1</span></span>;
  }
</code></pre><br>
      ,       CURL'   <br>
<code>https://ourserver.org/somesecret/vpn/on</code><br>
  ,   ,     ,           IP-,  - <br>
<code>iptables -t nat -A PREROUTING -p tcp -s {clientIP} --dport 443 -j REDIRECT --to-port 4443</code><br>
    .<br>
<br>
  N  (,   )  ,    ,        ,         IP       .<br>
<br>
     ,    ,  URL   ,   /off  .<br>
<br>
       ,     IPv6 (v6-    X-Real-IP  ).<br>
<br>
   Go,    ,   ,    . ,      nginx  init-    Gihub:<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">https://github.com/uprt/labean</a><br>
<br>
<h4>Websockets</h4><br>
<img src="https://habrastorage.org/webt/as/nw/yn/asnwynceu_p8gghmcgf13e3ryiq.jpeg" alt="image"><br>
<br>
     :      HTTPS ‚Äî    .  Web-         TCP    ,    Websocket (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">RFC 6455</a>).    HTTP-,      ,             TCP-.  , ,       HTTPS       .<br>
<br>
      WS  ,  - ‚Äî    ,     CDN, , Cloudflare    .  ,        :    IP  CDN/proxy          CDN,          VPN/proxy   CDN,       .<br>
<br>
 WS-   (    Haskell),     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">wstunnel</a>,   nodejs   ,       .<br>
<br>
       .       wss://-, <br>
<br>
<pre><code class="bash hljs">wstunnel -t 33 wss://server:443</code></pre><br>
   ,  ¬´¬ª ws-      ¬´¬ª .   wstunnel,    ,      URI    -  :<br>
<br>
<pre><code class="bash hljs">wstunnel -t 33 wss://ourserver.org:443/hiddenws/</code></pre><br>
  :     <br>
<br>
   ,    443   Nginx c -  . <br>
<br>
    proxy-   Websockets-:<br>
<br>
<pre><code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">location</span></span> /hiddenws {
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://127.0.0.1:8081;
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_http_version</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>;
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Upgrade <span class="hljs-variable"><span class="hljs-variable">$http_upgrade</span></span>;
    <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Connection <span class="hljs-string"><span class="hljs-string">"Upgrade"</span></span>;
  }</code></pre><br>
        websockets-.        SOCKS- (, Dante),  OpenVPN, ,   ,    .<br>
<br>
<div class="spoiler"><b class="spoiler_title"> selinux</b><div class="spoiler_text">   RHEL  ,   SELinux,    nginx   <br>
<code>2018/07/05 13:28:03 [crit] 7724#0: *11 connect() to 127.0.0.1:8081 failed (13: Permission denied) while connecting to upstream, client: IP_ADDRES, server: _, request: ¬´GET /hiddenws/?dst=localhost:22 HTTP/1.1¬ª, upstream: ¬´127.0.0.1:8081/hiddenws/?dst=localhost:22¬ª,</code><br>
<br>
        :<br>
<br>
<pre><code class="bash hljs">semanage port -a -t http_port_t -p tcp 22
semanage port -m -t http_port_t -p tcp 22
semanage port -a -t http_port_t -p tcp 8081</code></pre><br>
<br>
 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Renatk</a>        .<br>
</div></div><br>
<br>
    ‚Äî   SOCKS-  VPN-       wstunnel,           ¬´¬ª .<br>
<br>
 ,   v2ray  shadowcocks,   websockets    shadowsocks.    : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">https://github.com/shadowsocks/v2ray-plugin</a><br>
<br>
<h3> </h3><br>
 ‚Äî   VPN- -   MTU,  1400;<br>
 ‚Äî   VPN- 2 IP-.        VPN/,       ;<br>
 ‚Äî  ¬´¬ª IP-   ,    ICMP ping;<br>
 ‚Äî     -  reverse DNS ,     -, , gateway-001.somehomeisp.net;<br>
 ‚Äî      VPN/  DNS- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"> OpenNIC</a>;<br>
         (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"> </a>).<br>
<br>
<h3> </h3><br>
<img src="https://habrastorage.org/webt/dz/mp/tf/dzmptf35twb-e_wzib77grk3ksq.jpeg" alt="image"><br>
<br>
      - ,     ‚Äî  .     ,   ,   ‚Äî   ,    ,   . ,   HTTPS      ‚Äî ,     ,    -    ¬´   ¬ª/   /etc.,  ,      ¬´ ¬ª,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   </a>. <br>
<br>
 ,  ,   ,            ,     ‚Äî  ,   ,    ,   . <br>
 .</div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt415977/">https://habr.com/ru/post/pt415977/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt415965/index.html">O que ler em julho: 19 novos livros para profissionais digitais</a></li>
<li><a href="../pt415967/index.html">SolidFire - Armazenamento para aqueles ** que odeiam armazenamento</a></li>
<li><a href="../pt415969/index.html">HyperX Pulsefire Surge RGB - um assassino natural</a></li>
<li><a href="../pt415973/index.html">Como n√£o quebrar o cluster do Apache Ignite desde o in√≠cio</a></li>
<li><a href="../pt415975/index.html">Os chineses introduziram uma arma laser com alcance de quase um quil√¥metro</a></li>
<li><a href="../pt415979/index.html">Semana de Seguran√ßa 24: Rowhammer no Android e a complexidade das vulnerabilidades de hardware</a></li>
<li><a href="../pt415981/index.html">Google e HTTP</a></li>
<li><a href="../pt415983/index.html">Universo primitivo 5. Redshift cosmol√≥gico e din√¢mica de um universo em expans√£o uniforme, parte 1</a></li>
<li><a href="../pt415987/index.html">SuperJob de controle de qualidade</a></li>
<li><a href="../pt415989/index.html">An√°lise do uso de assinaturas digitais: 10 das 15 principais criptomoedas n√£o assinam software</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>