<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•É üë©‚Äçüè≠ üë®üèø‚Äçüî¨ ¬øQu√© errores est√°n ocultos en el c√≥digo Infer.NET? üëäüèª üßõüèº üìô</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La publicaci√≥n de Microsoft del c√≥digo fuente para sus proyectos es una buena raz√≥n para verificarlos. Esta vez no fue la excepci√≥n, y hoy miramos los...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>¬øQu√© errores est√°n ocultos en el c√≥digo Infer.NET?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/429578/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d3f/18a/6a6/d3f18a6a6127aceeae10d53591e0ce65.png"></div><br>  La publicaci√≥n de Microsoft del c√≥digo fuente para sus proyectos es una buena raz√≥n para verificarlos.  Esta vez no fue la excepci√≥n, y hoy miramos los lugares sospechosos que se encuentran en el c√≥digo Infer.NET.  Abajo la anotaci√≥n: ¬°vaya al grano! <br><a name="habracut"></a><br><h2>  Un poco sobre el proyecto y el analizador. </h2><br>  Infer.NET es un sistema de aprendizaje autom√°tico desarrollado por especialistas de Microsoft.  El c√≥digo fuente del proyecto recientemente estuvo disponible en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GitHub</a> , que fue el motivo de su verificaci√≥n.  Se pueden encontrar m√°s detalles sobre el proyecto, por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br>  El proyecto se verific√≥ utilizando el analizador est√°tico PVS-Studio versi√≥n 6.26.  Perm√≠tame recordarle que PVS-Studio est√° buscando errores en el c√≥digo en C \ C ++ \ C # (y pronto en Java) en Windows, Linux, macOS.  C # c√≥digo hasta ahora estamos analizando solo en Windows.  El analizador se puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">descargar y probar</a> en su proyecto. <br><br>  El cheque en s√≠ mismo fue extremadamente simple y sin problemas.  Anteriormente, descargu√© el proyecto de GitHub, restaur√© los paquetes necesarios (dependencias) y me asegur√© de que el proyecto se haya creado correctamente.  Esto es necesario para que el analizador tenga acceso a toda la informaci√≥n necesaria para un an√°lisis completo.  Despu√©s de ensamblar en un par de clics, inici√© el an√°lisis de la soluci√≥n a trav√©s del complemento PVS-Studio para Visual Studio. <br><br>  Por cierto, este no es el primer proyecto de Microsoft probado usando PVS-Studio; hubo otros: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Roslyn</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MSBuild</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PowerShell</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CoreFX</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">otros</a> . <br><br>  <b>Nota</b>  Si usted o sus conocidos est√°n interesados ‚Äã‚Äãen analizar el c√≥digo Java, puede escribirnos en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">soporte</a> seleccionando "Quiero un analizador para Java".  No hay una versi√≥n beta p√∫blica del analizador, pero deber√≠a estar disponible pronto.  En alg√∫n lugar de un laboratorio secreto (a trav√©s del muro), los muchachos est√°n trabajando activamente en √©l. <br><br>  Pero suficiente conversaci√≥n abstracta: veamos los problemas en el c√≥digo. <br><br><h2>  ¬øEs esto un error o una caracter√≠stica? </h2><br>  Sugiero tratar de encontrar el error usted mismo, una tarea completamente solucionable.  No hay bromas en el esp√≠ritu de lo que estaba en el art√≠culo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Los 10 errores principales en proyectos de C ++ para 2017</a> ", sinceramente.  Por lo tanto, no se apresure a leer la advertencia del analizador proporcionada despu√©s del fragmento de c√≥digo. <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MergeParallelTransitions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( transition1.DestinationStateIndex == transition2.DestinationStateIndex &amp;&amp; transition1.Group == transition2.Group) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (transition1.IsEpsilon &amp;&amp; transition2.IsEpsilon) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!transition1.IsEpsilon &amp;&amp; !transition2.IsEpsilon) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>.IsInfinity(transition1.Weight.Value) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>.IsInfinity(transition1.Weight.Value)) { newElementDistribution.SetToSum( <span class="hljs-number"><span class="hljs-number">1.0</span></span>, transition1.ElementDistribution, <span class="hljs-number"><span class="hljs-number">1.0</span></span>, transition2.ElementDistribution); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { newElementDistribution.SetToSum( transition1.Weight.Value, transition1.ElementDistribution, transition2.Weight.Value, transition2.ElementDistribution); } .... }</code> </pre> <br>  <b>Advertencia de PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3001</a> Hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">subexpresiones</a> id√©nticas 'double.IsInfinity (transition1.Weight.Value)' a la izquierda y a la derecha del operador '&amp;&amp;'.  Runtime Automaton.Simplification.cs 479 <br><br>  Como puede ver en el fragmento de c√≥digo, el m√©todo est√° trabajando con un par de variables: <i>transici√≥n1</i> y <i>transici√≥n2</i> .  El uso de nombres similares a veces est√° bastante justificado, pero vale la pena recordar que en este caso aumenta la probabilidad de cometer un error accidentalmente en alg√∫n lugar con el nombre. <br><br>  Esto es <i>lo que</i> sucedi√≥ al verificar los n√∫meros para el infinito ( <i>double.IsInfinity</i> ).  Debido a un error, verificamos el valor de la misma variable 2 veces: <i>transition1.Weight.Value</i> .  El valor marcado en la segunda subexpresi√≥n deb√≠a ser la variable <i>transici√≥n2.Peso.Valor</i> . <br><br>  Otro c√≥digo sospechoso similar. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> MethodBase </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToMethodInternal</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IMethodReference imr</span></span></span><span class="hljs-function">)</span></span> { .... bf |= BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Instance; .... }</code> </pre> <br>  <b>Advertencia de PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3001</a> Hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">subexpresiones</a> id√©nticas 'BindingFlags.Public' a la izquierda y a la derecha de '|'  operador  Compilador CodeBuilder.cs 194 <br><br>  Al formar el valor de la variable <i>bf</i> , el elemento de enumeraci√≥n <i>BindingFlags.Public</i> se usa dos veces.  O este c√≥digo contiene una operaci√≥n de marcado adicional, o en lugar del segundo uso de <i>BindingFlags.Public,</i> deber√≠a haber un valor de enumeraci√≥n diferente. <br><br>  Por cierto, en el c√≥digo fuente este c√≥digo est√° escrito en una l√≠nea.  Me parece que si est√° formateado en un estilo de tabla (como aqu√≠), el problema es m√°s f√°cil de detectar. <br><br>  Sigamos adelante.  Traigo todo el cuerpo del m√©todo y nuevamente le sugiero que encuentre el error (o tal vez el error) usted mismo. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ForEachPrefix</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IExpression expr, Action&lt;IExpression&gt; action</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// This method must be kept consistent with GetTargets. if (expr is IArrayIndexerExpression) ForEachPrefix(((IArrayIndexerExpression)expr).Target, action); else if (expr is IAddressOutExpression) ForEachPrefix(((IAddressOutExpression)expr).Expression, action); else if (expr is IPropertyReferenceExpression) ForEachPrefix(((IPropertyReferenceExpression)expr).Target, action); else if (expr is IFieldReferenceExpression) { IExpression target = ((IFieldReferenceExpression)expr).Target; if (!(target is IThisReferenceExpression)) ForEachPrefix(target, action); } else if (expr is ICastExpression) ForEachPrefix(((ICastExpression)expr).Expression, action); else if (expr is IPropertyIndexerExpression) ForEachPrefix(((IPropertyIndexerExpression)expr).Target, action); else if (expr is IEventReferenceExpression) ForEachPrefix(((IEventReferenceExpression)expr).Target, action); else if (expr is IUnaryExpression) ForEachPrefix(((IUnaryExpression)expr).Expression, action); else if (expr is IAddressReferenceExpression) ForEachPrefix(((IAddressReferenceExpression)expr).Expression, action); else if (expr is IMethodInvokeExpression) ForEachPrefix(((IMethodInvokeExpression)expr).Method, action); else if (expr is IMethodReferenceExpression) ForEachPrefix(((IMethodReferenceExpression)expr).Target, action); else if (expr is IUnaryExpression) ForEachPrefix(((IUnaryExpression)expr).Expression, action); else if (expr is IAddressReferenceExpression) ForEachPrefix(((IAddressReferenceExpression)expr).Expression, action); else if (expr is IDelegateInvokeExpression) ForEachPrefix(((IDelegateInvokeExpression)expr).Target, action); action(expr); }</span></span></code> </pre> <br>  Has encontrado  Estamos comprobando! <br><br>  <b>Advertencias de PVS-Studio</b> : <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3003</a> Se us√≥ el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">patr√≥n</a> 'if (A) {...} else if (A) {...}'.  Hay una probabilidad de presencia de error l√≥gico.  Verificaci√≥n de l√≠neas: 1719, 1727. C√≥digo del compiladorRecognizer.cs 1719 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3003</a> Se us√≥ el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">patr√≥n</a> 'if (A) {...} else if (A) {...}'.  Hay una probabilidad de presencia de error l√≥gico.  L√≠neas de verificaci√≥n: 1721, 1729. C√≥digo del compiladorRecognizer.cs 1721 </li></ul><br>  Simplifique un poco el c√≥digo para que los problemas sean m√°s obvios. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ForEachPrefix</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IExpression expr, Action&lt;IExpression&gt; action</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (....) .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (expr <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IUnaryExpression) ForEachPrefix(((IUnaryExpression)expr).Expression, action); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (expr <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IAddressReferenceExpression) ForEachPrefix(((IAddressReferenceExpression)expr).Expression, action); .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (expr <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IUnaryExpression) ForEachPrefix(((IUnaryExpression)expr).Expression, action); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (expr <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IAddressReferenceExpression) ForEachPrefix(((IAddressReferenceExpression)expr).Expression, action) .... }</code> </pre> <br>  Expresiones condicionales y <i>luego</i> ramas de varios <i>si las declaraciones est√°n</i> duplicadas.  Quiz√°s este c√≥digo se escribi√≥ utilizando el m√©todo de copiar y pegar, por lo que surgi√≥ el problema.  Ahora resulta que las ramas de los duplicados nunca se ejecutar√°n, ya que: <br><br><ul><li>  si la expresi√≥n condicional es verdadera, se ejecuta el cuerpo de la primera <i>instrucci√≥n if</i> del par correspondiente; </li><li>  Si la expresi√≥n condicional es falsa en el primer caso, ser√° falsa en el segundo. </li></ul><br>  Desde <i>entonces, las</i> ramas contienen las mismas acciones, ahora parece un c√≥digo redundante que es confuso.  Es posible que este sea un tipo diferente de problema: en lugar de duplicados, se deber√≠an haber realizado otras verificaciones. <br><br>  Continuamos <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Compare</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Pair&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; x, Pair&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; y</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x.First &lt; y.First) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x.Second &gt;= y.Second) { <span class="hljs-comment"><span class="hljs-comment">// y strictly contains x return 1; } else { // No containment - order by left bound return 1; } } else if (x.First &gt; y.First) { if (x.Second &lt;= y.Second) { // x strictly contains y return -1; } else { // No containment - order by left bound return -1; } } .... }</span></span></code> </pre> <br>  <b>Advertencias de PVS-Studio</b> : <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3004</a> La declaraci√≥n 'then' es equivalente a la declaraci√≥n 'else'.  Runtime RegexpTreeBuilder.cs 1080 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3004</a> La declaraci√≥n 'then' es equivalente a la declaraci√≥n 'else'.  Runtime RegexpTreeBuilder.cs 1093 </li></ul><br>  El c√≥digo parece extremadamente sospechoso, ya que contiene dos declaraciones condicionales con cuerpos id√©nticos de <i>entonces</i> y de <i>otras</i> ramas.  En ambos casos, probablemente valga la pena devolver valores diferentes.  O, si este es un comportamiento concebido, ser√° √∫til eliminar las declaraciones condicionales redundantes. <br><br>  Hubo ciclos interesantes.  Ejemplo a continuaci√≥n: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Set&lt;StochasticityPattern&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IntersectPatterns</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerable&lt;StochasticityPattern&gt; patterns</span></span></span><span class="hljs-function">)</span></span> { Set&lt;StochasticityPattern&gt; result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Set&lt;StochasticityPattern&gt;(); result.AddRange(patterns); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> changed; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = result.Count; AddIntersections(result); changed = (result.Count != count); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (changed); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br>  <b>Advertencia de PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3020</a> Una 'interrupci√≥n' incondicional dentro de un bucle.  Compilador DefaultFactorManager.cs 474 <br><br>  Debido a la declaraci√≥n de <i>interrupci√≥n</i> incondicional, se realiza exactamente una iteraci√≥n del bucle, y la variable de control <i>modificada</i> ni siquiera se usa.  En general, el c√≥digo parece extra√±o y sospechoso. <br><br>  El mismo m√©todo (copia exacta) se encontr√≥ en otra clase.  Advertencia del analizador correspondiente: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3020</a> Una 'interrupci√≥n' incondicional dentro de un bucle.  Visualizers.Windows FactorManagerView.cs 350 <br><br>  Por cierto, un m√©todo se encontr√≥ con una declaraci√≥n de <i>continuaci√≥n</i> incondicional en un bucle (fue encontrado por el analizador con el mismo diagn√≥stico), pero hubo un comentario arriba que confirma que esta es una soluci√≥n temporal especial: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// TEMPORARY continue;</span></span></code> </pre> <br>  Recuerdo que no hubo tales comentarios cerca de la declaraci√≥n de <i>ruptura</i> incondicional. <br><br>  Sigamos adelante. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> DependencyInformation </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDependencyInfo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... IExpression resultIndex = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resultIndex != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (parameter.IsDefined( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(SkipIfMatchingIndexIsUniformAttribute), <span class="hljs-literal"><span class="hljs-literal">false</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resultIndex == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InferCompilerException( parameter.Name + <span class="hljs-string"><span class="hljs-string">" has SkipIfMatchingIndexIsUniformAttribute but "</span></span> + StringUtil.MethodNameToString(method) + <span class="hljs-string"><span class="hljs-string">" has no resultIndex parameter"</span></span>); .... } .... } .... }</code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Advertencia de</a> <b>PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3022 La</a> expresi√≥n 'resultIndex == null' siempre es falsa.  Compilador FactorManager.cs 382 <br><br>  Inmediatamente, observo que entre la declaraci√≥n y la verificaci√≥n anterior, el valor de la variable <i>resultIndex</i> puede cambiar.  Sin embargo, entre las comprobaciones <i>resultIndex! = Null</i> y <i>resultIndex == null, el</i> valor ya no se puede cambiar.  Por lo tanto, el resultado de la expresi√≥n <i>resultIndex == null</i> siempre ser√° <i>falso</i> , lo que significa que nunca se lanzar√° una excepci√≥n. <br><br>  Espero que tenga inter√©s en encontrar errores usted mismo, sin mis sugerencias, para encontrar un problema, pero por si acaso, le propondr√© hacerlo nuevamente.  El c√≥digo del m√©todo es peque√±o, lo dar√© en su totalidad. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Tuple&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComputeMovieGenre</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> feature</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] genres = feature.Split(<span class="hljs-string"><span class="hljs-string">'|'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (genres.Length &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; genres.Length &gt; <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format( <span class="hljs-string"><span class="hljs-string">"Movies should have between 1 and 3 genres; given {0}."</span></span>, genres.Length)); } <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = <span class="hljs-number"><span class="hljs-number">1.0</span></span> / genres.Length; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder( <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format( <span class="hljs-string"><span class="hljs-string">"{0}:{1}"</span></span>, offset + MovieGenreBuckets[genres[<span class="hljs-number"><span class="hljs-number">0</span></span>]], <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt; genres.Length; ++i) { result.Append( <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format( <span class="hljs-string"><span class="hljs-string">"|{0}:{1}"</span></span>, offset + MovieGenreBuckets[genres[i].Trim()], <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Tuple&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(MovieGenreBucketCount, result.ToString()); }</code> </pre> <br>  Veamos que pasa aqu√≠.  La cadena de entrada se analiza con el car√°cter '|'.  Si la longitud de la matriz no es la esperada, se debe lanzar una excepci√≥n.  <i>Espera un segundo</i> ... <i>g√©neros</i> . <i>Longitud &lt;1 &amp; &amp; g√©neros. Longitud&gt; 3</i> ?  Como no hay un n√∫mero que se encuentre inmediatamente en el rango de valores requeridos por la expresi√≥n ( <i>[int.MinValue..1)</i> y <i>(3..int.MaxValue]</i> ), el resultado de la expresi√≥n siempre ser√° <i>falso</i> .  Por lo tanto, esta verificaci√≥n no protege contra nada y no se lanzar√° la excepci√≥n esperada. <br><br>  Esto es exactamente lo que advierte el analizador: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3022</a> Expresi√≥n 'g√©neros. Longitud &lt;1 &amp;&amp; g√©neros. Longitud&gt; 3' siempre es falso.  Probablemente el '||'  El operador debe usarse aqu√≠.  Caracter√≠sticas del evaluador.cs 242 <br><br>  Operaci√≥n de fisi√≥n sospechosa se reuni√≥. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateTrueThetaAndPhi</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> expectedRepeatOfTopicInDoc = averageDocLength / numUniqueTopicsPerDoc; .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cnt = Poisson.Sample(expectedRepeatOfTopicInDoc); .... }</code> </pre> <br>  <b>Advertencia de PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3041</a> La expresi√≥n se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">convirti√≥</a> impl√≠citamente de tipo 'int' a tipo 'doble'.  Considere utilizar un molde de tipo expl√≠cito para evitar la p√©rdida de una parte fraccional.  Un ejemplo: doble A = (doble) (X) / Y;.  LDA Utilities.cs 74 <br><br>  Aqu√≠ es sospechoso: se realiza una divisi√≥n entera (las variables <i>averageDocLength</i> y <i>numUniqueTopicsPerDoc</i> son de tipo <i>int</i> ), y el resultado se escribe en una variable de tipo <i>double</i> .  Se plantea la pregunta: ¬øse hace especialmente o todav√≠a se implica la divisi√≥n de n√∫meros reales?  Si la variable <i>esperadaRepeatOfTopicInDoc</i> fuera del tipo <i>int</i> , esto aclarar√≠a las posibles preguntas. <br><br>  En otros lugares, se <i>usa el</i> m√©todo <i>Poisson.Sample</i> , cuyo argumento es la variable sospechosa <i>esperadaRepeatOfTopicInDoc</i> , por ejemplo, como se describe a continuaci√≥n. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> numUniqueWordsPerTopic = Poisson.Sample((<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)averageWordsPerTopic);</code> </pre> <br>  <i>averageWordsPerTopic</i> es de tipo <i>int</i> , que ya est√° convertido a <i>doble</i> en el lugar de uso. <br><br>  Y aqu√≠ hay otro lugar de uso: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span> expectedRepeatOfWordInTopic = ((<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)numDocs) * averageDocLength / numUniqueWordsPerTopic; .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cnt = Poisson.Sample(expectedRepeatOfWordInTopic);</code> </pre> <br>  Tenga en cuenta que las variables tienen los mismos nombres que en el ejemplo original, solo la divisi√≥n de n√∫meros reales se usa para inicializar el <i>esperado</i> <i>RepeatOfWordInTopic</i> (debido a la conversi√≥n expl√≠cita de <i>numDocs</i> al <i>doble</i> ). <br><br>  En general, vale la pena mirar el punto de partida donde el analizador emiti√≥ una advertencia. <br><br>  Pero reflexiones sobre si vale la pena editar y c√≥mo, dejemos a los autores del c√≥digo (lo saben mejor), pero vamos m√°s all√°.  A la siguiente divisi√≥n sospechosa. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> NonconjugateGaussian </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BAverageLogarithm</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> v_opt = <span class="hljs-number"><span class="hljs-number">2</span></span> / <span class="hljs-number"><span class="hljs-number">3</span></span> * (Math.Log(mx * mz / Ex2 / <span class="hljs-number"><span class="hljs-number">2</span></span>) - m); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (v_opt != v) { .... } .... }</code> </pre> <br>  <b>Advertencia de PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3041</a> La expresi√≥n se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">convirti√≥</a> impl√≠citamente de tipo 'int' a tipo 'doble'.  Considere utilizar un molde de tipo expl√≠cito para evitar la p√©rdida de una parte fraccional.  Un ejemplo: doble A = (doble) (X) / Y;.  Tiempo de ejecuci√≥n ProductExp.cs 137 <br><br>  El analizador volvi√≥ a detectar la operaci√≥n sospechosa de la divisi√≥n de enteros, ya que  <i>2</i> y <i>3</i> son literales num√©ricos enteros, y el resultado de la expresi√≥n 2/3 ser√° <i>0</i> .  Como resultado, toda la expresi√≥n toma la forma: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span> v_opt = <span class="hljs-number"><span class="hljs-number">0</span></span> * expr;</code> </pre> <br>  De acuerdo, un poco extra√±o.  Varias veces volv√≠ a esta advertencia, tratando de encontrar alg√∫n tipo de captura, y no tratando de agregarla al art√≠culo.  El m√©todo est√° lleno de matem√°ticas y varias f√≥rmulas (que, francamente, realmente no quer√≠a desmontar), nunca se sabe qu√© esperar.  Adem√°s, trato de ser lo m√°s esc√©ptico posible sobre las advertencias que escribo en el art√≠culo, y las describo solo despu√©s de haberlas estudiado mejor. <br><br>  Pero luego me di cuenta: ¬øpor qu√© necesito un factor de <i>0</i> , escrito como <i>2/3</i> ?  As√≠ que vale la pena ver este lugar de todos modos. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteAttribute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TextWriter writer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> defaultValue, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Func&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; converter = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( defaultValue == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.Equals(defaultValue)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> stringValue = converter == <span class="hljs-literal"><span class="hljs-literal">null</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.ToString() : converter(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); writer.Write(<span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{name}</span></span></span><span class="hljs-string">=\"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{stringValue}</span></span></span><span class="hljs-string">\" "</span></span>); }</code> </pre> <br>  <b>Advertencia de PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3080</a> Posible desreferencia nula.  Considere inspeccionar el 'valor'.  Compilador WriteHelpers.cs 78 <br><br>  Afirmaci√≥n bastante justa del analizador basada en la condici√≥n.  La desreferenciaci√≥n de una referencia nula puede ocurrir en el valor de la expresi√≥n. <i>Igual (</i> <i>valor</i> <i>predeterminado)</i> si <i>valor == nulo</i> .  Dado que esta expresi√≥n es el operando derecho del operador ||, para calcularlo, el operando izquierdo debe ser <i>falso</i> , y para esto es suficiente que al menos una de las variables <i>defaultValue</i> \ <i>value</i> no sea <i>nula</i> .  Como resultado, si <i>defaultValue! = Null</i> , y <i>value == null</i> : <br><br><ul><li>  <i>defaultValue == null</i> -&gt; <i>false</i> ; </li><li>  <i>defaultValue == null &amp;&amp; value == null</i> -&gt; <i>false</i> ;  (no se verific√≥ el valor) </li><li>  <i>value.Equals (defaultValue)</i> -&gt; <i>NullReferenceException</i> , ya que el <i>valor</i> es <i>nulo</i> . </li></ul><br>  Veamos un caso similar: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FeatureParameterDistribution</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> GaussianMatrix traitFeatureWeightDistribution, GaussianArray biasFeatureWeightDistribution</span></span></span><span class="hljs-function">)</span></span> { Debug.Assert( (traitFeatureWeightDistribution == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; biasFeatureWeightDistribution == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) || traitFeatureWeightDistribution.All( w =&gt; w != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; w.Count == biasFeatureWeightDistribution.Count), <span class="hljs-string"><span class="hljs-string">"The provided distributions should be valid and consistent in the number of features."</span></span>); .... }</code> </pre> <br>  <b>Advertencia de PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3080</a> Posible desreferencia nula.  Considere la posibilidad de inspeccionar 'traitFeatureWeightDistribution'.  Recomendador FeatureParameterDistribution.cs 65 <br><br>  Desechamos el exceso, dejando solo la l√≥gica para calcular el valor booleano, de modo que sea m√°s f√°cil de entender: <br><br><pre> <code class="cs hljs">(traitFeatureWeightDistribution == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; biasFeatureWeightDistribution == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) || traitFeatureWeightDistribution.All( w =&gt; w != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; w.Count == biasFeatureWeightDistribution.Count)</code> </pre> <br>  De nuevo, el operando correcto de ||  Se calcula solo si el resultado del c√°lculo de la izquierda es <i>falso</i> .  El operando izquierdo puede ser <i>falso</i> , incluso cuando <i>traitFeatureWeightDistribution == null</i> y <i>biasFeatureWeightDistribution! = Null</i> .  Luego, se calcular√° el operando correcto del operador ||, y una llamada a <i>traitFeatureWeightDistribution.All</i> generar√° una <i>excepci√≥n</i> <i>ArgumentNullException</i> . <br><br>  Otra pieza interesante de c√≥digo: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetQuantile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> probability, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] quantiles</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n = quantiles.Length; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (quantiles == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(quantiles)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-string"><span class="hljs-string">"quantiles array is empty"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(quantiles)); .... }</code> </pre> <br>  <b>PVS-Studio Advertencia</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3095</a> El objeto 'cuantiles' se us√≥ antes de que se verificara como nulo.  L√≠neas de verificaci√≥n: 91, 92. Runtime OuterQuantiles.cs 91 <br><br>  Tenga en cuenta que <i>primero se accede a la</i> propiedad <i>quantiles.Length</i> y luego <i>se</i> verifica que los <i>cuantiles sean</i> <i>nulos</i> .  Como resultado, si los <i>cuantiles == nulo</i> , el m√©todo arrojar√° una excepci√≥n, solo un poco mal, y un poco no donde se necesitaba.  Aparentemente, desordenaron las l√≠neas en algunos lugares. <br><br>  Si usted mismo se ha ocupado de la detecci√≥n de los errores anteriores, le sugiero que prepare una taza de caf√© e intente repetir la haza√±a, encontrando el error en el siguiente m√©todo.  Para hacerlo un poco m√°s interesante, cito el c√≥digo completo del m√©todo. <br><br>  ( <a href="">Enlace a tama√±o completo</a> ) <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c2c/5ff/2d9/c2c5ff2d99aca64bbda4136acfa4b1d4.png" alt="Imagen 2"></p><br><br>  Est√° bien, est√° bien, eso fue una broma (¬øo tuviste √©xito?!).  Simplifiquemos un poco la tarea: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sample.Precision &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { precisionIsBetween = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; lowerBound = <span class="hljs-number"><span class="hljs-number">-1.0</span></span> / v; upperBound = -mean.Precision; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sample.Precision &lt; -mean.Precision) { precisionIsBetween = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; lowerBound = <span class="hljs-number"><span class="hljs-number">0</span></span>; upperBound = -mean.Precision; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// in this case, the precision should NOT be in this interval. precisionIsBetween = false; lowerBound = -mean.Precision; lowerBound = -1.0 / v; }</span></span></code> </pre> <br>  ¬øHa mejorado?  El analizador emiti√≥ la siguiente advertencia para este c√≥digo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3008</a> A la variable 'lowerBound' se le asignan valores dos veces seguidas.  Quiz√°s esto sea un error.  L√≠neas de verificaci√≥n: 324, 323. Runtime GaussianOp.cs 324 <br><br>  De hecho, en la √∫ltima rama <i>m√°s</i> , el valor de la variable <i>lowerBound</i> se asigna dos veces seguidas.  Aparentemente (y a juzgar por el c√≥digo anterior), la variable <i>upperBound</i> debe estar involucrada en una de las asignaciones. <br><br>  Seguimos m√°s all√°. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteAucMatrix</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c = <span class="hljs-number"><span class="hljs-number">0</span></span>; c &lt; classLabelCount; c++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> labelWidth = labels[c].Length; columnWidths[c + <span class="hljs-number"><span class="hljs-number">1</span></span>] = labelWidth &gt; MaxLabelWidth ? MaxLabelWidth : labelWidth; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> r = <span class="hljs-number"><span class="hljs-number">0</span></span>; r &lt; classLabelCount; r++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> countWidth = MaxValueWidth; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (countWidth &gt; columnWidths[c + <span class="hljs-number"><span class="hljs-number">1</span></span>]) { columnWidths[c + <span class="hljs-number"><span class="hljs-number">1</span></span>] = countWidth; } } .... }</code> </pre> <br>  <b>Advertencia de PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3081</a> El contador 'r' no se usa dentro de un bucle anidado.  Considere inspeccionar el uso del contador 'c'.  CommandLine ClassifierEvaluationModule.cs 459 <br><br>  Tenga en cuenta que el contador del bucle interno - <i>r</i> - no se usa en el cuerpo de este bucle.  Debido a esto, resulta que durante todas las iteraciones del bucle interno se realizan las mismas operaciones en los mismos elementos; despu√©s de todo, los √≠ndices tambi√©n usan el contador del bucle externo ( <i>c</i> ), y no el interno ( <i>r</i> ). <br><br>  Veamos qu√© m√°s se encontr√≥ interesante. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegexpFormattingSettings</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> putOptionalInSquareBrackets, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> showAnyElementAsQuestionMark, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ignoreElementDistributionDetails, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> truncationLength, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> escapeCharacters, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> useLazyQuantifier</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.PutOptionalInSquareBrackets = putOptionalInSquareBrackets; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ShowAnyElementAsQuestionMark = showAnyElementAsQuestionMark; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IgnoreElementDistributionDetails = ignoreElementDistributionDetails; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.TruncationLength = truncationLength; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.EscapeCharacters = escapeCharacters; }</code> </pre> <br>  <b>Advertencia de PVS-Studio</b> : no se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">usa el</a> par√°metro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3117</a> Constructor 'useLazyQuantifier'.  Runtime RegexpFormattingSettings.cs 38 <br><br>  El constructor no usa un par√°metro: <i>useLazyQuantifier</i> .  Esto parece particularmente sospechoso en el contexto del hecho de que una propiedad con el nombre y el tipo correspondiente se define en la clase: <i>UseLazyQuantifier</i> .  Aparentemente, olvidaron inicializarlo a trav√©s del par√°metro correspondiente. <br><br>  Conoc√≠ a varios controladores de eventos potencialmente peligrosos.  A continuaci√≥n se muestra un ejemplo de uno de ellos: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RecommenderRun</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> EventHandler Started; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Report that the run has been started if (this.Started != null) { this.Started(this, EventArgs.Empty); } .... } .... }</span></span></code> </pre> <br>  <b>Advertencia de PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3083</a> Invocaci√≥n insegura del evento 'Iniciado', es posible NullReferenceException.  Considere asignar un evento a una variable local antes de invocarlo.  Evaluador recomendado: Run.cs 115 <br><br>  El hecho es que entre la verificaci√≥n de la desigualdad <i>nula</i> y la llamada del controlador, se puede cancelar la suscripci√≥n de un evento, y si en el momento entre la verificaci√≥n de <i>nulo</i> y la llamada de los controladores el evento no tiene suscriptores, se lanzar√° una <i>NullReferenceException</i> .  Para evitar tales problemas, por ejemplo, puede guardar el enlace a la cadena de delegados en una variable local o usar el operador '?.'  para llamar a los manejadores. <br><br>  Adem√°s del fragmento de c√≥digo anterior, hab√≠a 35 de esos lugares. <br><br>  Por cierto, tambi√©n se cumplieron <b>785</b> advertencias de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3024</a> .  Se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">emite la</a> advertencia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3024</a> al comparar n√∫meros reales utilizando los operadores '! =' O '=='.  No me detendr√© aqu√≠ sobre por qu√© tales comparaciones no siempre son correctas: m√°s sobre esto est√° escrito en la documentaci√≥n, tambi√©n hay un enlace a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">StackOverflow</a> (esto es todo). <br><br>  Teniendo en cuenta que las f√≥rmulas y los c√°lculos a menudo se cumplieron, estas advertencias tambi√©n pueden ser importantes, aunque se llevan al nivel 3 (ya que est√°n lejos de ser relevantes en todos los proyectos). <br><br>  Si est√° seguro de que estas advertencias son irrelevantes, puede eliminarlas con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">casi un clic</a> , reduciendo el n√∫mero total de operaciones del analizador. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/47e/77b/72d/47e77b72dbb716dadbd1623513150819.png"></div><br><br><h2>  Conclusi√≥n </h2><br>  De alguna manera result√≥ que durante mucho tiempo no hab√≠a escrito art√≠culos sobre la verificaci√≥n de proyectos, y tocar este proceso nuevamente fue bastante agradable.  Espero que tambi√©n hayas aprendido algo nuevo / √∫til de este art√≠culo, o al menos lo leas con inter√©s. <br><br>  Les deseo a los desarrolladores una correcci√≥n temprana de las √°reas problem√°ticas y les recuerdo que cometer errores es normal, sin embargo, somos personas.  Para esto, se necesitan herramientas adicionales como analizadores est√°ticos para encontrar lo que una persona se perdi√≥, ¬øverdad?  De todos modos, ¬°buena suerte con el proyecto y gracias por el trabajo! <br><br>  Y recuerde que el beneficio m√°ximo de un analizador est√°tico se logra con su <i>uso regular</i> . <br><br>  Todo lo mejor! <br><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br><br>  Si desea compartir este art√≠culo con una audiencia de habla inglesa, utilice el enlace a la traducci√≥n: Sergey Vasiliev.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬øQu√© errores acechan en el c√≥digo Infer.NET?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es429578/">https://habr.com/ru/post/es429578/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es429564/index.html">‚ÄúSolo soy un entusiasta del proyecto y usuario del lenguaje Dart‚Äù - entrevista con Ari Lerner, autor del famoso ng-book</a></li>
<li><a href="../es429568/index.html">Reduzca el tiempo de inactividad de Zimbra durante los bloqueos del servidor con Zextras Backup</a></li>
<li><a href="../es429570/index.html">Ense√±ar a un agente a jugar Mario Kart con filtros</a></li>
<li><a href="../es429572/index.html">Interceptar conversaciones privadas en Skype usando Devicelock DLP</a></li>
<li><a href="../es429574/index.html">Curso gratuito de Check Point para principiantes en CheckMates</a></li>
<li><a href="../es429580/index.html">Microinteracciones en iOS. Conferencia de Yandex</a></li>
<li><a href="../es429582/index.html">Indicador anal√≥gico de carga de la computadora</a></li>
<li><a href="../es429586/index.html">C√≥mo determinar el mejor momento para operar en el intercambio</a></li>
<li><a href="../es429588/index.html">Toda la verdad sobre RTOS. Art√≠culo # 20. Sem√°foros: servicios auxiliares y estructuras de datos</a></li>
<li><a href="../es429590/index.html">An√°lisis de voz para centros de llamadas basados ‚Äã‚Äãen SOLR</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>