<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëçüèæ üë©üèø‚Äçü§ù‚Äçüë©üèª üë©üèø‚Äçüé§ Orchestre de performance üö∑ üÖæÔ∏è üòì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il n'est pas faux de dire que le meilleur des gens 
 prendre de la joie par la souffrance. 
 Ludwig van Beethoven 





 Je m'appelle Sergey, je trava...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Orchestre de performance</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yamoney/blog/443822/"><p>  <em>Il n'est pas faux de dire que le meilleur des gens</em> <em><br></em>  <em>prendre de la joie par la souffrance.</em> <em><br></em>  <em>Ludwig van Beethoven</em> </p><br><p><img src="https://habrastorage.org/webt/9k/ht/xx/9khtxxwiwqsesccfpb5n2sbrnwo.jpeg"></p><br><p>  Je m'appelle Sergey, je travaille chez Yandex.Money dans une √©quipe de recherche sur la performance.  Je veux vous raconter le d√©but d'une histoire sur notre chemin vers l'orchestration - comment nous avons choisi les instruments et ce que nous avons pris en compte.  Tous les √©v√©nements de l'article se d√©roulent en temps r√©el, alors vous, chers lecteurs, suivez presque en direct l'√©volution de la situation. </p><a name="habracut"></a><br><h2 id="zachem-nam-dirizhyor-v-komande">  Pourquoi avons-nous besoin d'un chef d'orchestre dans l'√©quipe? </h2><br><p>  Qui est chef d'orchestre?  Du fr.  diriger - g√©rer, diriger, diriger - dans le monde de la musique - c'est une personne, le leader de l'apprentissage et de la performance de la musique d'ensemble.  Dans notre cas, cet endroit est occup√© par des syst√®mes d'orchestration et d'automatisation. </p><br><p>  Leur r√¥le n'est pas diff√©rent de celui du chef d'orchestre en musique - ils sont n√©cessaires pour aider l'√©quipe, diriger et organiser sa pi√®ce. </p><br><p>  En r√®gle g√©n√©rale, une √©quipe a un certain ensemble de capacit√©s - appelons-les serveurs sur lesquels ils mettent en ≈ìuvre leurs projets. </p><br><p>  L'approche pour obtenir et exploiter ces serveurs est diverse.  Quelques exemples: </p><br><ul><li>  L'√©quipe demande par exemple au groupe d'op√©ration de lui fournir des ressources avec certains param√®tres. </li><li>  Le groupe d'exploitation leur fournit la quantit√© requise - nuage ou m√©tal nu (¬´m√©tal nu¬ª) - et s'engage √† les maintenir en bon √©tat selon le SLA.  L'ajustement est √©galement effectu√© par l'√©quipe des op√©rations. </li><li>  L'√©quipe ne re√ßoit que des ressources cloud ou bare metal du groupe d'op√©rations; elle effectue ses propres param√®tres. </li><li>  L'√©quipe elle-m√™me ¬´ach√®te¬ª des ressources et les soutient / les configure de mani√®re totalement ind√©pendante. </li></ul><br><p>  Notre √©quipe utilise des serveurs qui doivent √™tre pris en charge - mettre √† jour le syst√®me d'exploitation, installer de nouveaux packages, etc. </p><br><p>  Pour nous, nous les avons distingu√©s en deux types principaux: </p><br><ul><li>  groupe de r√©servoirs </li><li>  groupe de service. </li></ul><br><p>  Le groupe de chars se compose d'h√¥tes avec Yandex.Tank. </p><br><p>  Le groupe de services comprend tout ce qui concerne la maintenance - ce sont divers services pour fournir une assistance pour le cycle de publication, g√©n√©rer des rapports automatiques, etc. </p><br><p>  √Ä un moment donn√©, il √©tait devenu g√™nant de g√©rer tout cela manuellement, et nous avons pens√© √† automatiser l'ensemble du processus, en commen√ßant par le ¬´chargement¬ª des serveurs et en terminant par le d√©veloppement, la mise en page et le lancement de notre service interne. </p><br><h2 id="pochemu-dirizhyor-nuzhen-dazhe-esli-orkestr-sam-umeet-igrat">  Pourquoi un chef d'orchestre est-il n√©cessaire, m√™me si l'orchestre lui-m√™me peut jouer? </h2><br><p>  Pour commencer, nous avons ma√Ætris√© Ansible et avons commenc√© √† ¬´verser¬ª nos serveurs bare metal pour √™tre moins d√©pendants des administrateurs syst√®me - tout le monde y gagne, nous acqu√©rons de nouvelles comp√©tences et d√©charge les administrateurs de la partie du travail qu'ils ont toujours sans nous.  Nous nous effor√ßons de d√©velopper notre √©quipe en dehors de notre sp√©cialit√© et de notre autonomie autant que possible. </p><br><p>  La soci√©t√© travaille avec Ansible depuis longtemps d√©j√† install√©e et r√©glement√©e, nous avons donc facilement int√©gr√© notre solution dans ce processus. </p><br><p>  L'h√©bergement comprend d√©sormais trois r√¥les Ansible: </p><br><ul><li>  le premier r√¥le installe le syst√®me d'exploitation, </li><li>  le deuxi√®me d√©roule les param√®tres de base de l'h√¥te, l'autorisation LDAP, par exemple, </li><li>  et le troisi√®me installe Yandex.Tank et les d√©pendances associ√©es dans le conteneur Docker. </li></ul><br><p>  Passons aux services que nous utilisons au sein de l'√©quipe. </p><br><p> Pour nos t√¢ches, nous utilisons √©galement Kotlin et Python, et un peu plus Golang.  Pour unifier le d√©veloppement et le d√©ploiement de nos services, nous avons d√©cid√© de les emballer dans des containers dockers.  Cela donne la libert√© de choisir un langage de programmation et r√©gule en m√™me temps le format de livraison uniforme de son application. </p><br><h3 id="nebolshaya-remarka-pro-ipv6-v-docker">  Une petite remarque sur ipv6 dans Docker </h3><br><p>  Certains des services avec lesquels nous interagissons ne sont disponibles que via ipv6, j'ai donc d√ª trouver comment cr√©er ipv6 pour les conteneurs. </p><br><p>  Selon la documentation d'ipv6 sur le site officiel de Docker, ipv6 est activ√© en ajoutant des param√®tres √† daemon.json: </p><br><pre><code class="plaintext hljs">{ "ipv6": true, "fixed-cidr-v6": "2001:db8:1::/64" }</code> </pre> <br><p>  Dans ce cas, le fournisseur doit √©mettre le sous-r√©seau ipv6, que vous <code>fixed-cidr-v6.</code> dans <code>fixed-cidr-v6.</code> <br>  Cependant, nous avons choisi une autre option - ipv6 NAT, et voici pourquoi: </p><br><ul><li>  Docker <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ne peut plus √™tre utilis√©</a> uniquement avec ipv6. </li><li>  La pr√©sence d'une adresse routable √† l'√©chelle mondiale dans chaque conteneur signifie que tous les ports (m√™me ceux non publi√©s) deviennent accessibles √† tous si aucun filtrage suppl√©mentaire n'est effectu√©. </li><li>  proxy de l'espace utilisateur pour la publication des ports, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">iptables pour ipv4 uniquement</a> . </li></ul><br><p>  ipv6 NAT est un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">conteneur docker</a> qui g√®re lui-m√™me les r√®gles dans ip6tables et les modifie lorsqu'un nouveau conteneur est ajout√©. </p><br><p>  Pour que cette solution fonctionne correctement, un certain nombre de manipulations ont d√ª √™tre effectu√©es.  Assurez-vous d'initialiser ip6table_nat sur le syst√®me.  La pr√©sence d'un module install√© dans le syst√®me ne garantit pas qu'au d√©marrage le module sera charg√© dans le noyau.  Nous sommes tomb√©s sur ce probl√®me lorsque nous avons eu cette erreur lors du d√©marrage d'un conteneur avec NAT sur un nouvel h√¥te: </p><br><pre> <code class="plaintext hljs">2019/01/22 14:59:54 running [/sbin/ip6tables -t filter -N DOCKER --wait]: exit status 3: modprobe: can't change directory to '/lib/modules': No such file or directory ip6tables v1.6.2: can't initialize ip6tables table `filter': Table does not exist (do you need to insmod?)</code> </pre> <br><p>  Le probl√®me a √©t√© r√©solu apr√®s avoir ajout√© l'initialisation au r√¥le Ansible √† l'aide du module modprobe et l'avoir charg√© au d√©marrage √† l'aide de lineinfile: </p><br><pre> <code class="plaintext hljs">- name: Add ip6table_nat module modprobe: name: ip6table_nat state: present - name: Add ip6table_nat to boot lineinfile: path: /etc/modules line: 'ip6table_nat'</code> </pre> <br><p>  √Ä propos, il y a un bon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> sur Haber, qui d√©crit bri√®vement et clairement les avantages et les inconv√©nients d'une m√©thode particuli√®re pour travailler avec ipv6 dans docker. </p><br><p>  Mais revenons √† notre question pos√©e au d√©but: <br>  <strong>Pourquoi un chef d'orchestre est-il n√©cessaire, m√™me si l'orchestre lui-m√™me peut jouer?</strong> </p><br><p>  Maintenant, tout le monde sait jouer dans notre √©quipe: </p><br><ul><li>  le processus de "remplissage" des serveurs est cr√©√©, </li><li>  le d√©veloppement et le d√©ploiement des services sont unifi√©s. </li></ul><br><p>  Une question raisonnable se pose: comment d√©ployer, mettre √† jour, contr√¥ler nos services dans des conteneurs Docker de mani√®re efficace et aussi automatis√©e que possible? </p><br><p>  Malgr√© le fait que chaque membre de l'orchestre connaisse sa propre part, il peut s'√©garer, s'√©loigner de l'id√©e originale.  Ici, nous arrivons au fait que sans chef d'orchestre, notre orchestre ne pourra pas r√©p√©ter et jouer de mani√®re harmonieuse.  Le chef d'orchestre est responsable de tous les param√®tres de performance, pour s'assurer que tout est uni par un rythme et une humeur uniques. </p><br><h2 id="kak-s-minimalnymi-vlozheniyami-poluchit-horoshego-dirizhera">  Comment obtenir un bon conducteur avec un investissement minimal? </h2><br><p>  Le th√®me de l'orchestration est bien d√©velopp√© sur le march√©.  Mais d'abord, parlons des outils de support qui peuvent aider le chef d'orchestre. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Consul</a> est un syst√®me qui fournit deux fonctions principales: </p><br><ul><li>  d√©couverte de service </li><li>  stockage de valeurs-cl√©s distribu√©. </li></ul><br><p>  Dans notre orchestre, le consul sera responsable de l'enregistrement des services et du stockage de leurs configurations.  Il existe deux options d'inscription: </p><br><ul><li>  Actif - c'est lorsque le service lui-m√™me s'enregistre √† l'aide de l'API HTTP; </li><li>  Passif - le service doit √™tre enregistr√© manuellement. </li></ul><br><p>  Vault est un r√©f√©rentiel qui standardise et unifie le stockage s√©curis√© et utilise des secrets - mots de passe, certificats. <br>  Voici les avantages que nous retirerons de cet outil: </p><br><ul><li>  Un centre unique pour cr√©er et garder des secrets, g√©rer leur cycle de vie via l'API HTTP. </li><li>  Transit Secrets Engine - cryptage-d√©cryptage des donn√©es sans les enregistrer.  La capacit√© de transmettre des donn√©es sous forme crypt√©e via des canaux de communication non s√©curis√©s. </li><li>  Strat√©gies d'acc√®s faciles √† configurer. </li><li>  Auditez l'acc√®s aux secrets. </li><li>  Possibilit√© de cr√©er votre propre CA (autorit√© de certification) pour g√©rer les certificats auto-sign√©s au sein de votre infrastructure. </li></ul><br><p>  Compte tenu de toutes nos exigences, deux options convenaient au r√¥le de chef d'orchestre - Kubernetes et Nomad. </p><br><h4 id="kubernetes">  Kubernetes </h4><br><p>  Combien d'articles et de livres ont d√©j√† √©t√© √©crits sur lui (celui- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ci</a> , par exemple), des rapports ont dit que j'√©crirai en bref - c'est une moissonneuse-batteuse universelle qui peut faire presque n'importe quoi.  Le payer n'est pas toujours facile √† configurer et √† prendre en charge un cluster sur Kubernetes. </p><br><h4 id="nomad">  Nomade </h4><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'outil provient</a> de HashiCorp, une entreprise connue pour le consul et le coffre-fort mentionn√©s ci-dessus. </p><br><p>  Nomad nous a sembl√© plut√¥t simple √† installer et √† configurer que Kubernetes.  Un fichier binaire fonctionne √† la fois en mode serveur et en mode client.  En m√™me temps, Nomad couvre toute la liste des t√¢ches que nous voulons qu'il r√©sout: gestion de cluster, ordonnanceur rapide, support multi-centre.  De plus, lorsque vous utilisez consul et vault, nous b√©n√©ficions d'une int√©gration plus √©troite pour orchestrer nos services. </p><br><p>  Ce qui est maintenant au travail: </p><br><ul><li>  pr√©par√© les serveurs pour le d√©ploiement de Consul, </li><li>  la configuration du cluster nomade sera saisie dans Consul, avec laquelle le nomade devra √™tre d√©ploy√© automatiquement, </li><li>  En parall√®le, nous installerons le coffre-fort pour garder les secrets. </li></ul><br><p>  La question dans la salle est de savoir s'il vaut la peine d'avoir un chef d'orchestre pour de telles t√¢ches, ou un orchestre est-il bon sans lui?  Dites-nous dans les commentaires ce que vous en pensez. </p><br><hr><br><p>  Abonnez-vous √† notre blog et restez en contact - nous vous dirons bient√¥t ce qui s'est finalement pass√© et si nous avons configur√© le cluster nomade, comme nous le voulions. </p><br><p>  Visitez notre salon de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">discussion</a> confortable sur les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">t√©l√©grammes</a> o√π vous pouvez toujours demander des conseils, aider vos coll√®gues et simplement parler de la recherche de performances et plus encore. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr443822/">https://habr.com/ru/post/fr443822/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr443812/index.html">Comment impl√©menter un langage de programmation en JavaScript. Partie 2: interpr√®te</a></li>
<li><a href="../fr443814/index.html">Donner est mon "ancienne entreprise"</a></li>
<li><a href="../fr443816/index.html">Le minist√®re des Communications insiste sur un seul op√©rateur 5G</a></li>
<li><a href="../fr443818/index.html">R√©sum√© des √©v√©nements informatiques de mars (deuxi√®me partie)</a></li>
<li><a href="../fr443820/index.html">Comment l'a√©roport de Fukuoka a d√©couvert quelles mesures seraient efficaces pour r√©duire les files d'attente</a></li>
<li><a href="../fr443824/index.html">5 raisons de passer √† l'impression 3D de produits m√©talliques</a></li>
<li><a href="../fr443826/index.html">Emp√™cher l'obsolescence du mat√©riel p√©dagogique</a></li>
<li><a href="../fr443828/index.html">Les origines de la culture de d√©marrage: comment les premi√®res r√©ussites ont fa√ßonn√© l'√©tat moderne de l'industrie technologique</a></li>
<li><a href="../fr443830/index.html">Tesla a pr√©sent√© le nouveau mod√®le Y - d√©tails, photos de la pr√©sentation et impressions du parcours d'essai</a></li>
<li><a href="../fr443834/index.html">Runet au tournant du mill√©naire: qu'en retenez-vous?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>