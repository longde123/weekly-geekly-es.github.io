<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥈 🗿 👵 GameDev TDD ou Rabbit Hell 🧗🏾 🐭 😠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TDD est rarement utilisé dans le développement de jeux. Il est généralement plus facile d'embaucher un testeur que de mettre de côté un développeur po...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GameDev TDD ou Rabbit Hell</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pixonic/blog/455076/">  TDD est rarement utilisé dans le développement de jeux.  Il est généralement plus facile d'embaucher un testeur que de mettre de côté un développeur pour écrire des tests - cela économise à la fois des ressources et du temps.  Par conséquent, chaque utilisation réussie de TDD devient plus intéressante.  Sous la coupe, la traduction du matériau, où cette technique de développement a été utilisée pour créer le mouvement des personnages dans le jeu ElemenTerra. <br><br><img src="https://habrastorage.org/webt/6x/yz/5c/6xyz5cjyml6vqmszhh-68zfy3_w.gif"><br><a name="habracut"></a><br>  Le développement piloté par les tests ou TDD (développement par le biais de tests) est une technique de développement logiciel dans laquelle l'ensemble du processus est divisé en plusieurs petits cycles.  Des tests unitaires sont écrits, puis du code est écrit qui réussit ces tests, puis une refactorisation est effectuée.  Et l'algorithme se répète. <br><br><h3>  TDD Basics </h3><br>  Supposons que nous écrivions une fonction qui ajoute deux nombres.  Dans un flux de travail normal, nous l'écrivions simplement.  Mais pour utiliser TDD, vous devez commencer par créer une fonction d'espace réservé et des tests unitaires: <br><br><pre><code class="plaintext hljs">// Placeholder-,    : int add(int a, int b){ return -1; } // Unit-,   ,  add    : void runTests(){ if (add(1, 1) is not equal to 2) throw error; if (add(2, 2) is not equal to 4) throw error; }</code> </pre> <br>  Au début, nos tests unitaires ne fonctionneront pas, car la fonction d'espace réservé renvoie -1 pour chaque entrée.  Nous pouvons maintenant exécuter <i>add</i> correctement pour renvoyer <i>a + b</i> .  Les tests seront passés.  Cela peut sembler une solution de contournement, mais il existe plusieurs avantages: <br><br>  Si nous écrivons par erreur <i>add</i> comme <i>a - b</i> , nos tests ne fonctionneront pas et nous apprendrons immédiatement comment corriger la fonction.  Sans tests, nous ne pouvons pas attraper cette erreur et voir une réaction non standard qui prendra du temps à déboguer. <br>  Nous pouvons continuer les tests et les exécuter à tout moment pendant l'écriture du code.  Cela signifie que si un autre programmeur modifie accidentellement l' <i>ajout</i> , il reconnaîtra immédiatement l'erreur - les tests échoueront à nouveau. <br><br><h3>  TDD dans le jeu dev </h3><br>  Il y a deux problèmes avec TDD dans le développement de jeu.  Premièrement, de nombreuses fonctions de jeu ont des objectifs subjectifs qui ne peuvent pas être mesurés.  Et deuxièmement, il est difficile d’écrire des tests couvrant toutes les possibilités de l’espace des mondes qui regorgent d’objets complexes en interaction.  Les développeurs qui veulent que les mouvements de leurs personnages «paraissent bien» ou que les simulations physiques «ne paraissent pas saccadées» auront du mal à exprimer ces métriques comme des conditions déterministes «réussies / non réussies». <br><br>  Cependant, la technique TDD est applicable à des caractéristiques complexes et subjectives - par exemple, le mouvement des personnages.  Et dans le jeu ElemenTerra, nous l'avons fait. <br><br><h3>  Tests unitaires contre les niveaux de débogage </h3><br>  Avant de commencer à pratiquer, je veux faire la distinction entre un test unitaire automatique et un «niveau de débogage» traditionnel.  La création d'emplacements cachés avec des conditions artificielles est une chose courante dans gamedev.  Cela permet aux programmeurs et aux QA de surveiller les événements individuels. <br><br><img src="https://habrastorage.org/webt/ln/qv/4e/lnqv4efk5tcmb1pzm7x1qz47eqs.png"><br>  <i>Niveau de débogage secret dans The Legend of Zelda: The Wind Waker</i> <br><br>  ElemenTerra a plusieurs de ces niveaux: un niveau plein de géométrie problématique pour le personnage d'un joueur, des niveaux avec des interfaces utilisateur spéciales qui déclenchent certains états de jeu et d'autres. <br><br>  Comme les tests unitaires, ces niveaux de débogage peuvent être utilisés pour reproduire et diagnostiquer les erreurs.  Mais à certains égards, ils diffèrent: <br><br>  Les tests unitaires divisent les systèmes en parties et les évaluent individuellement, tandis que les niveaux de débogage effectuent les tests de manière plus globale.  Après avoir trouvé l'erreur au niveau du débogage, les développeurs peuvent encore avoir besoin de rechercher manuellement le point d'erreur. <br>  Les tests unitaires sont automatisés et doivent à chaque fois donner des résultats déterministes, tandis que de nombreux niveaux de débogage sont «contrôlés» par le joueur.  Cela fait une différence dans les sessions. <br><br>  Mais cela ne signifie pas que les tests unitaires sont meilleurs que les niveaux de débogage.  Ces derniers sont souvent plus pratiques.  Cependant, les tests unitaires peuvent même être utilisés sur des systèmes où ils n'étaient pas traditionnellement présents. <br><br><h3>  Bienvenue à Rabbit Hell </h3><br>  À ElemenTerra, les joueurs utilisent les forces mystiques de la nature pour sauver les créatures affectées par une tempête spatiale.  L'une de ces forces est la capacité d'ouvrir la voie qui mène les créatures à la nourriture et à l'abri.  Étant donné que ces chemins sont des grilles dynamiques créées par les joueurs, le mouvement de la créature doit traiter des cas géométriques inhabituels et un terrain arbitrairement complexe. <br><br>  Le mouvement des personnages est l'un de ces systèmes complexes où «tout affecte tout le reste».  Si vous avez déjà fait cela, vous savez que lors de l'écriture de nouveau code, il est très facile de casser les fonctionnalités existantes.  Avez-vous besoin de lapins pour escalader de petits rebords?  D'accord, mais maintenant ils se contractent, grimpant les pentes.  Voulez-vous que les chemins du lézard ne se croisent pas?  Cela a fonctionné, mais maintenant leur comportement typique est ruiné. <br><br>  En tant que responsable de l'IA et de la majeure partie du code de gameplay, je savais que je n'avais pas le temps d'erreurs surprises.  Je voulais immédiatement remarquer la régression, donc le développement à l'aide de TDD m'a semblé être une bonne option. <br><br>  L'étape suivante a été la création d'un système dans lequel je pouvais facilement identifier chaque cas de mouvement sous la forme d'un test de réussite / échec simulé: <br><br><img src="https://habrastorage.org/webt/tb/uf/8q/tbuf8ql64djoz57rkpjjsbdc-sq.gif"><br><br>  Cet "enfer de lapin" se compose de 18 couloirs isolés.  Chacun avec une créature et son propre itinéraire, conçu pour se déplacer uniquement si une certaine fonction de mouvement fonctionne.  Les tests sont considérés comme réussis si le lapin est capable de se déplacer pendant une durée infiniment longue sans se coincer.  Sinon, échec.  Notez que nous testons uniquement le corps des créatures (pion en termes irréels), pas l'intelligence artificielle.  Dans ElemenTerra, les créatures peuvent manger, dormir et réagir au monde, mais dans "l'enfer des lapins", leur seule instruction est de courir entre deux points. <br><br>  Voici quelques exemples de tels tests: <br><br><img src="https://habrastorage.org/webt/s3/pb/9u/s3pb9ucpk-ezq2sg8ehnwjmpo5s.gif"><br>  <i>1, 2, 3: Libre circulation, obstacles statiques et obstacles dynamiques</i> <br><br><img src="https://habrastorage.org/webt/5e/co/jh/5ecojh5plbr-lpajkm3ttqvyfdu.gif"><br>  <i>8 et 9: Pentes uniformes et terrain accidenté</i> <br><br><img src="https://habrastorage.org/webt/tl/fp/o0/tlfpo0gylqb4k0vcic6lvnklvp4.gif"><br>  <i>10: Plancher en voie de disparition</i> <br><br><img src="https://habrastorage.org/webt/t_/et/pd/t_etpdknaotnaxi0ozma56rosos.gif"><br>  <i>13: Reproduction d'un bug dans lequel les créatures tournaient sans cesse autour des cibles proches</i> <br><br><img src="https://habrastorage.org/webt/7w/yf/mu/7wyfmuvpvihnaoljhwuvrttqd7c.gif"><br>  <i>14 et 15: Capacité de naviguer sur des rebords plats et complexes</i> <i><br></i> <br>  Parlons des similitudes et des différences entre mon implémentation et le TDD «propre». <br><br>  Mon système était similaire à TDD en ceci: <br><br><ul><li>  J'ai commencé à travailler sur des fonctions en créant des tests, puis j'ai écrit le code nécessaire pour les exécuter. </li><li>  J'ai continué d'exécuter d'anciens tests, en ajoutant de nouvelles fonctionnalités. </li><li>  Chaque test a mesuré exactement une partie du système, ce qui m'a permis de trouver rapidement des problèmes. </li><li>  Les tests étaient automatisés et ne nécessitaient pas d'entrée du joueur. </li></ul><br>  Et différait en cela: <br><br><ul><li>  Lors de l'évaluation des tests, il y avait un élément de subjectivité.  Alors que les vraies erreurs de déplacement (le personnage ne passait pas de A à B) pouvaient être détectées par programme.  C'est-à-dire, par exemple, une position asymétrique, des problèmes de synchronisation de l'animation et des mouvements de contraction nécessitaient une évaluation humaine. </li><li>  Les tests n'étaient pas complètement déterministes.  Des facteurs aléatoires, tels que les fluctuations de la fréquence d'images, ont provoqué de petits écarts.  Mais en général, les créatures suivent généralement les mêmes chemins et ont le même succès / échec entre les sessions. </li></ul><br><h3>  Limitations </h3><br>  Utiliser TDD pour déplacer une créature ElemenTerra était un énorme avantage, mais mon approche avait plusieurs limites: <br><br><ul><li>  Les tests unitaires ont évalué chaque caractéristique du mouvement individuellement, donc les erreurs avec des combinaisons de plusieurs caractéristiques n'ont pas été prises en compte.  Parfois, il était nécessaire de compléter les tests unitaires par des niveaux de débogage traditionnels. </li><li>  ElemenTerra a quatre types de créatures, mais les tests ne contiennent que des lapins.  C'est une caractéristique de notre calendrier de production (les trois autres types ont été ajoutés beaucoup plus tard dans le développement).  Heureusement, tous les quatre ont la même mobilité, mais le grand corps de Mossmork a causé plusieurs problèmes.  La prochaine fois, j'aurais les tests engendrer dynamiquement les espèces sélectionnées au lieu d'utiliser des lapins pré-placés. </li></ul><br><img src="https://habrastorage.org/webt/xo/ua/yq/xouayqg87iiyszdn4tfonai7rou.png"><br>  <i>Ce Mossmork nécessite un peu plus d'espace qu'un lapin.</i> <br><br><h3>  TDD est votre choix? </h3><br>  Les développeurs peuvent consacrer trop d'efforts aux niveaux de tests unitaires que le joueur n'appréciera jamais.  Je ne le nie pas, j'ai moi-même eu beaucoup de plaisir à créer "l'enfer du lapin".  Ces fonctions internes peuvent prendre du temps et compromettre des étapes plus importantes.  Pour éviter que cela ne se produise, étudiez soigneusement où et quand utiliser les tests unitaires.  Ci-dessous, j'ai mis en évidence plusieurs critères qui justifient TDD pour le mouvement d'une créature ElemenTerra. <br><br>  1. Cela prendra-t-il beaucoup de temps pour terminer manuellement les tâches de test? <br><br>  Avant de passer du temps sur des tests automatisés, vous devez vérifier si nous pouvons évaluer la fonction à l'aide des commandes de jeu conventionnelles.  Si vous voulez vous assurer que vos clés déverrouillent les portes, générez la clé et ouvrez la porte pour elles.  La création de tests unitaires pour cette fonction serait une perte de temps - les tests manuels ne prennent que quelques secondes. <br><br>  2. Est-il difficile de créer des cas de test manuellement? <br><br>  Les tests unitaires automatisés sont justifiés lorsqu'il existe des cas connus et difficiles à reproduire.  Le test n ° 7 de «l'enfer des lapins» vérifie comment ils marchent le long des rebords - quelque chose que l'IA s'efforce généralement d'éviter.  Une telle situation peut être difficile ou impossible à reproduire à l'aide des commandes de jeu, et les tests sont faciles. <br><br>  3. Savez-vous que les résultats souhaités ne changeront pas? <br><br>  La conception du jeu est entièrement basée sur des itérations, de sorte que les objectifs des fonctionnalités peuvent changer à mesure que votre jeu change.  Même de petits changements peuvent invalider les métriques par lesquelles vous évaluez vos fonctionnalités, et donc tous les tests unitaires.  Si le comportement des créatures pendant la nourriture, le sommeil et l'interaction avec le joueur changeait plusieurs fois, la transition du point A au point B restait inchangée.  Par conséquent, le code de mouvement et ses tests unitaires sont restés pertinents tout au long du développement. <br><br>  4. Les régressions sont-elles susceptibles de passer inaperçues? <br><br>  Avez-vous rencontré une situation lorsque vous avez terminé l'une des dernières tâches avant d'envoyer le jeu, et soudain, vous trouvez une erreur qui enfreint les règles?  Et dans la fonction que vous avez terminée il y a de nombreuses années.  Les jeux sont de gigantesques systèmes interconnectés, et il est donc naturel que l'ajout d'une nouvelle fonction B puisse entraîner l'échec de l'ancienne fonction A. <br><br>  Ce n'est pas si mal quand une fonction cassée est utilisée partout (par exemple, un saut) - vous devriez immédiatement remarquer une panne de la mécanique.  Les erreurs découvertes dans un développement ultérieur peuvent perturber le calendrier et, après le lancement, peuvent nuire au gameplay. <br><br>  5. Le pire qui puisse arriver lors de l'utilisation de tests et sans eux? <br><br>  La création de tests est une forme de gestion des risques.  Imaginez que vous décidiez d'acheter une assurance automobile.  Vous devez répondre à trois questions: <br><br><ul><li>  Combien coûtent les primes d'assurance mensuelles? </li><li>  Quelle est la probabilité que la voiture soit endommagée? </li><li>  Quel serait le pire scénario si vous n'étiez pas assuré? </li></ul><br>  Pour TDD, nous pouvons imaginer des contributions mensuelles sous forme de coûts de production pour l'entretien de nos tests unitaires, la probabilité de dommages à la voiture comme la probabilité d'avoir un bug, et le coût d'un remplacement complet de voiture comme le pire des cas pour une erreur de régression. <br><br>  S'il faut beaucoup de temps pour créer un test de fonctionnalité, il est simple et peu susceptible d'être modifié (ou il peut être traité s'il se casse dans le développement ultérieur), alors les tests unitaires peuvent causer plus de problèmes que de bien.  Si les tests sont faciles à faire, la fonction est instable et interconnectée (ou ses erreurs prendront beaucoup de temps), alors les tests aideront. <br><br><h3>  Limites d'automatisation </h3><br>  Les tests unitaires peuvent être un excellent ajout à la recherche et à l'élimination des erreurs, mais ils ne remplacent pas la nécessité d'un contrôle de qualité professionnel dans les jeux à grande échelle.  L'AQ est un art qui nécessite de la créativité, un jugement subjectif et une excellente communication technique. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr455076/">https://habr.com/ru/post/fr455076/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr455064/index.html">Talent contre chance: le rôle du hasard dans le succès et l'échec</a></li>
<li><a href="../fr455066/index.html">Diffusion et présentations de l'analyse système MeetUp UPD2</a></li>
<li><a href="../fr455068/index.html">Politique zéro bug. Pas de bugs - pas de problèmes?</a></li>
<li><a href="../fr455070/index.html">Pourquoi les interviews sont-elles si souvent posées sur les listes chaînées</a></li>
<li><a href="../fr455072/index.html">Toute la vérité sur RTOS. Article # 28. Minuteries logicielles</a></li>
<li><a href="../fr455078/index.html">Où parler d'Apache Ignite et des systèmes distribués en été</a></li>
<li><a href="../fr455080/index.html">Les personnes âgées n'appartiennent pas ici? Programmable après trente-cinq</a></li>
<li><a href="../fr455082/index.html">Nous étudions MITRE ATT & CK. Matrices mobiles: accès aux appareils. Partie 4</a></li>
<li><a href="../fr455088/index.html">Que testent les entretiens et les éléments de test</a></li>
<li><a href="../fr455096/index.html">Tester les compétences avec des tests - pourquoi et comment</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>