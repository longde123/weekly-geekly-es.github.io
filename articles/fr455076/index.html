<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•à üóø üëµ GameDev TDD ou Rabbit Hell üßóüèæ üê≠ üò†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TDD est rarement utilis√© dans le d√©veloppement de jeux. Il est g√©n√©ralement plus facile d'embaucher un testeur que de mettre de c√¥t√© un d√©veloppeur po...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GameDev TDD ou Rabbit Hell</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pixonic/blog/455076/">  TDD est rarement utilis√© dans le d√©veloppement de jeux.  Il est g√©n√©ralement plus facile d'embaucher un testeur que de mettre de c√¥t√© un d√©veloppeur pour √©crire des tests - cela √©conomise √† la fois des ressources et du temps.  Par cons√©quent, chaque utilisation r√©ussie de TDD devient plus int√©ressante.  Sous la coupe, la traduction du mat√©riau, o√π cette technique de d√©veloppement a √©t√© utilis√©e pour cr√©er le mouvement des personnages dans le jeu ElemenTerra. <br><br><img src="https://habrastorage.org/webt/6x/yz/5c/6xyz5cjyml6vqmszhh-68zfy3_w.gif"><br><a name="habracut"></a><br>  Le d√©veloppement pilot√© par les tests ou TDD (d√©veloppement par le biais de tests) est une technique de d√©veloppement logiciel dans laquelle l'ensemble du processus est divis√© en plusieurs petits cycles.  Des tests unitaires sont √©crits, puis du code est √©crit qui r√©ussit ces tests, puis une refactorisation est effectu√©e.  Et l'algorithme se r√©p√®te. <br><br><h3>  TDD Basics </h3><br>  Supposons que nous √©crivions une fonction qui ajoute deux nombres.  Dans un flux de travail normal, nous l'√©crivions simplement.  Mais pour utiliser TDD, vous devez commencer par cr√©er une fonction d'espace r√©serv√© et des tests unitaires: <br><br><pre><code class="plaintext hljs">// Placeholder-,    : int add(int a, int b){ return -1; } // Unit-,   ,  add    : void runTests(){ if (add(1, 1) is not equal to 2) throw error; if (add(2, 2) is not equal to 4) throw error; }</code> </pre> <br>  Au d√©but, nos tests unitaires ne fonctionneront pas, car la fonction d'espace r√©serv√© renvoie -1 pour chaque entr√©e.  Nous pouvons maintenant ex√©cuter <i>add</i> correctement pour renvoyer <i>a + b</i> .  Les tests seront pass√©s.  Cela peut sembler une solution de contournement, mais il existe plusieurs avantages: <br><br>  Si nous √©crivons par erreur <i>add</i> comme <i>a - b</i> , nos tests ne fonctionneront pas et nous apprendrons imm√©diatement comment corriger la fonction.  Sans tests, nous ne pouvons pas attraper cette erreur et voir une r√©action non standard qui prendra du temps √† d√©boguer. <br>  Nous pouvons continuer les tests et les ex√©cuter √† tout moment pendant l'√©criture du code.  Cela signifie que si un autre programmeur modifie accidentellement l' <i>ajout</i> , il reconna√Ætra imm√©diatement l'erreur - les tests √©choueront √† nouveau. <br><br><h3>  TDD dans le jeu dev </h3><br>  Il y a deux probl√®mes avec TDD dans le d√©veloppement de jeu.  Premi√®rement, de nombreuses fonctions de jeu ont des objectifs subjectifs qui ne peuvent pas √™tre mesur√©s.  Et deuxi√®mement, il est difficile d‚Äô√©crire des tests couvrant toutes les possibilit√©s de l‚Äôespace des mondes qui regorgent d‚Äôobjets complexes en interaction.  Les d√©veloppeurs qui veulent que les mouvements de leurs personnages ¬´paraissent bien¬ª ou que les simulations physiques ¬´ne paraissent pas saccad√©es¬ª auront du mal √† exprimer ces m√©triques comme des conditions d√©terministes ¬´r√©ussies / non r√©ussies¬ª. <br><br>  Cependant, la technique TDD est applicable √† des caract√©ristiques complexes et subjectives - par exemple, le mouvement des personnages.  Et dans le jeu ElemenTerra, nous l'avons fait. <br><br><h3>  Tests unitaires contre les niveaux de d√©bogage </h3><br>  Avant de commencer √† pratiquer, je veux faire la distinction entre un test unitaire automatique et un ¬´niveau de d√©bogage¬ª traditionnel.  La cr√©ation d'emplacements cach√©s avec des conditions artificielles est une chose courante dans gamedev.  Cela permet aux programmeurs et aux QA de surveiller les √©v√©nements individuels. <br><br><img src="https://habrastorage.org/webt/ln/qv/4e/lnqv4efk5tcmb1pzm7x1qz47eqs.png"><br>  <i>Niveau de d√©bogage secret dans The Legend of Zelda: The Wind Waker</i> <br><br>  ElemenTerra a plusieurs de ces niveaux: un niveau plein de g√©om√©trie probl√©matique pour le personnage d'un joueur, des niveaux avec des interfaces utilisateur sp√©ciales qui d√©clenchent certains √©tats de jeu et d'autres. <br><br>  Comme les tests unitaires, ces niveaux de d√©bogage peuvent √™tre utilis√©s pour reproduire et diagnostiquer les erreurs.  Mais √† certains √©gards, ils diff√®rent: <br><br>  Les tests unitaires divisent les syst√®mes en parties et les √©valuent individuellement, tandis que les niveaux de d√©bogage effectuent les tests de mani√®re plus globale.  Apr√®s avoir trouv√© l'erreur au niveau du d√©bogage, les d√©veloppeurs peuvent encore avoir besoin de rechercher manuellement le point d'erreur. <br>  Les tests unitaires sont automatis√©s et doivent √† chaque fois donner des r√©sultats d√©terministes, tandis que de nombreux niveaux de d√©bogage sont ¬´contr√¥l√©s¬ª par le joueur.  Cela fait une diff√©rence dans les sessions. <br><br>  Mais cela ne signifie pas que les tests unitaires sont meilleurs que les niveaux de d√©bogage.  Ces derniers sont souvent plus pratiques.  Cependant, les tests unitaires peuvent m√™me √™tre utilis√©s sur des syst√®mes o√π ils n'√©taient pas traditionnellement pr√©sents. <br><br><h3>  Bienvenue √† Rabbit Hell </h3><br>  √Ä ElemenTerra, les joueurs utilisent les forces mystiques de la nature pour sauver les cr√©atures affect√©es par une temp√™te spatiale.  L'une de ces forces est la capacit√© d'ouvrir la voie qui m√®ne les cr√©atures √† la nourriture et √† l'abri.  √âtant donn√© que ces chemins sont des grilles dynamiques cr√©√©es par les joueurs, le mouvement de la cr√©ature doit traiter des cas g√©om√©triques inhabituels et un terrain arbitrairement complexe. <br><br>  Le mouvement des personnages est l'un de ces syst√®mes complexes o√π ¬´tout affecte tout le reste¬ª.  Si vous avez d√©j√† fait cela, vous savez que lors de l'√©criture de nouveau code, il est tr√®s facile de casser les fonctionnalit√©s existantes.  Avez-vous besoin de lapins pour escalader de petits rebords?  D'accord, mais maintenant ils se contractent, grimpant les pentes.  Voulez-vous que les chemins du l√©zard ne se croisent pas?  Cela a fonctionn√©, mais maintenant leur comportement typique est ruin√©. <br><br>  En tant que responsable de l'IA et de la majeure partie du code de gameplay, je savais que je n'avais pas le temps d'erreurs surprises.  Je voulais imm√©diatement remarquer la r√©gression, donc le d√©veloppement √† l'aide de TDD m'a sembl√© √™tre une bonne option. <br><br>  L'√©tape suivante a √©t√© la cr√©ation d'un syst√®me dans lequel je pouvais facilement identifier chaque cas de mouvement sous la forme d'un test de r√©ussite / √©chec simul√©: <br><br><img src="https://habrastorage.org/webt/tb/uf/8q/tbuf8ql64djoz57rkpjjsbdc-sq.gif"><br><br>  Cet "enfer de lapin" se compose de 18 couloirs isol√©s.  Chacun avec une cr√©ature et son propre itin√©raire, con√ßu pour se d√©placer uniquement si une certaine fonction de mouvement fonctionne.  Les tests sont consid√©r√©s comme r√©ussis si le lapin est capable de se d√©placer pendant une dur√©e infiniment longue sans se coincer.  Sinon, √©chec.  Notez que nous testons uniquement le corps des cr√©atures (pion en termes irr√©els), pas l'intelligence artificielle.  Dans ElemenTerra, les cr√©atures peuvent manger, dormir et r√©agir au monde, mais dans "l'enfer des lapins", leur seule instruction est de courir entre deux points. <br><br>  Voici quelques exemples de tels tests: <br><br><img src="https://habrastorage.org/webt/s3/pb/9u/s3pb9ucpk-ezq2sg8ehnwjmpo5s.gif"><br>  <i>1, 2, 3: Libre circulation, obstacles statiques et obstacles dynamiques</i> <br><br><img src="https://habrastorage.org/webt/5e/co/jh/5ecojh5plbr-lpajkm3ttqvyfdu.gif"><br>  <i>8 et 9: Pentes uniformes et terrain accident√©</i> <br><br><img src="https://habrastorage.org/webt/tl/fp/o0/tlfpo0gylqb4k0vcic6lvnklvp4.gif"><br>  <i>10: Plancher en voie de disparition</i> <br><br><img src="https://habrastorage.org/webt/t_/et/pd/t_etpdknaotnaxi0ozma56rosos.gif"><br>  <i>13: Reproduction d'un bug dans lequel les cr√©atures tournaient sans cesse autour des cibles proches</i> <br><br><img src="https://habrastorage.org/webt/7w/yf/mu/7wyfmuvpvihnaoljhwuvrttqd7c.gif"><br>  <i>14 et 15: Capacit√© de naviguer sur des rebords plats et complexes</i> <i><br></i> <br>  Parlons des similitudes et des diff√©rences entre mon impl√©mentation et le TDD ¬´propre¬ª. <br><br>  Mon syst√®me √©tait similaire √† TDD en ceci: <br><br><ul><li>  J'ai commenc√© √† travailler sur des fonctions en cr√©ant des tests, puis j'ai √©crit le code n√©cessaire pour les ex√©cuter. </li><li>  J'ai continu√© d'ex√©cuter d'anciens tests, en ajoutant de nouvelles fonctionnalit√©s. </li><li>  Chaque test a mesur√© exactement une partie du syst√®me, ce qui m'a permis de trouver rapidement des probl√®mes. </li><li>  Les tests √©taient automatis√©s et ne n√©cessitaient pas d'entr√©e du joueur. </li></ul><br>  Et diff√©rait en cela: <br><br><ul><li>  Lors de l'√©valuation des tests, il y avait un √©l√©ment de subjectivit√©.  Alors que les vraies erreurs de d√©placement (le personnage ne passait pas de A √† B) pouvaient √™tre d√©tect√©es par programme.  C'est-√†-dire, par exemple, une position asym√©trique, des probl√®mes de synchronisation de l'animation et des mouvements de contraction n√©cessitaient une √©valuation humaine. </li><li>  Les tests n'√©taient pas compl√®tement d√©terministes.  Des facteurs al√©atoires, tels que les fluctuations de la fr√©quence d'images, ont provoqu√© de petits √©carts.  Mais en g√©n√©ral, les cr√©atures suivent g√©n√©ralement les m√™mes chemins et ont le m√™me succ√®s / √©chec entre les sessions. </li></ul><br><h3>  Limitations </h3><br>  Utiliser TDD pour d√©placer une cr√©ature ElemenTerra √©tait un √©norme avantage, mais mon approche avait plusieurs limites: <br><br><ul><li>  Les tests unitaires ont √©valu√© chaque caract√©ristique du mouvement individuellement, donc les erreurs avec des combinaisons de plusieurs caract√©ristiques n'ont pas √©t√© prises en compte.  Parfois, il √©tait n√©cessaire de compl√©ter les tests unitaires par des niveaux de d√©bogage traditionnels. </li><li>  ElemenTerra a quatre types de cr√©atures, mais les tests ne contiennent que des lapins.  C'est une caract√©ristique de notre calendrier de production (les trois autres types ont √©t√© ajout√©s beaucoup plus tard dans le d√©veloppement).  Heureusement, tous les quatre ont la m√™me mobilit√©, mais le grand corps de Mossmork a caus√© plusieurs probl√®mes.  La prochaine fois, j'aurais les tests engendrer dynamiquement les esp√®ces s√©lectionn√©es au lieu d'utiliser des lapins pr√©-plac√©s. </li></ul><br><img src="https://habrastorage.org/webt/xo/ua/yq/xouayqg87iiyszdn4tfonai7rou.png"><br>  <i>Ce Mossmork n√©cessite un peu plus d'espace qu'un lapin.</i> <br><br><h3>  TDD est votre choix? </h3><br>  Les d√©veloppeurs peuvent consacrer trop d'efforts aux niveaux de tests unitaires que le joueur n'appr√©ciera jamais.  Je ne le nie pas, j'ai moi-m√™me eu beaucoup de plaisir √† cr√©er "l'enfer du lapin".  Ces fonctions internes peuvent prendre du temps et compromettre des √©tapes plus importantes.  Pour √©viter que cela ne se produise, √©tudiez soigneusement o√π et quand utiliser les tests unitaires.  Ci-dessous, j'ai mis en √©vidence plusieurs crit√®res qui justifient TDD pour le mouvement d'une cr√©ature ElemenTerra. <br><br>  1. Cela prendra-t-il beaucoup de temps pour terminer manuellement les t√¢ches de test? <br><br>  Avant de passer du temps sur des tests automatis√©s, vous devez v√©rifier si nous pouvons √©valuer la fonction √† l'aide des commandes de jeu conventionnelles.  Si vous voulez vous assurer que vos cl√©s d√©verrouillent les portes, g√©n√©rez la cl√© et ouvrez la porte pour elles.  La cr√©ation de tests unitaires pour cette fonction serait une perte de temps - les tests manuels ne prennent que quelques secondes. <br><br>  2. Est-il difficile de cr√©er des cas de test manuellement? <br><br>  Les tests unitaires automatis√©s sont justifi√©s lorsqu'il existe des cas connus et difficiles √† reproduire.  Le test n ¬∞ 7 de ¬´l'enfer des lapins¬ª v√©rifie comment ils marchent le long des rebords - quelque chose que l'IA s'efforce g√©n√©ralement d'√©viter.  Une telle situation peut √™tre difficile ou impossible √† reproduire √† l'aide des commandes de jeu, et les tests sont faciles. <br><br>  3. Savez-vous que les r√©sultats souhait√©s ne changeront pas? <br><br>  La conception du jeu est enti√®rement bas√©e sur des it√©rations, de sorte que les objectifs des fonctionnalit√©s peuvent changer √† mesure que votre jeu change.  M√™me de petits changements peuvent invalider les m√©triques par lesquelles vous √©valuez vos fonctionnalit√©s, et donc tous les tests unitaires.  Si le comportement des cr√©atures pendant la nourriture, le sommeil et l'interaction avec le joueur changeait plusieurs fois, la transition du point A au point B restait inchang√©e.  Par cons√©quent, le code de mouvement et ses tests unitaires sont rest√©s pertinents tout au long du d√©veloppement. <br><br>  4. Les r√©gressions sont-elles susceptibles de passer inaper√ßues? <br><br>  Avez-vous rencontr√© une situation lorsque vous avez termin√© l'une des derni√®res t√¢ches avant d'envoyer le jeu, et soudain, vous trouvez une erreur qui enfreint les r√®gles?  Et dans la fonction que vous avez termin√©e il y a de nombreuses ann√©es.  Les jeux sont de gigantesques syst√®mes interconnect√©s, et il est donc naturel que l'ajout d'une nouvelle fonction B puisse entra√Æner l'√©chec de l'ancienne fonction A. <br><br>  Ce n'est pas si mal quand une fonction cass√©e est utilis√©e partout (par exemple, un saut) - vous devriez imm√©diatement remarquer une panne de la m√©canique.  Les erreurs d√©couvertes dans un d√©veloppement ult√©rieur peuvent perturber le calendrier et, apr√®s le lancement, peuvent nuire au gameplay. <br><br>  5. Le pire qui puisse arriver lors de l'utilisation de tests et sans eux? <br><br>  La cr√©ation de tests est une forme de gestion des risques.  Imaginez que vous d√©cidiez d'acheter une assurance automobile.  Vous devez r√©pondre √† trois questions: <br><br><ul><li>  Combien co√ªtent les primes d'assurance mensuelles? </li><li>  Quelle est la probabilit√© que la voiture soit endommag√©e? </li><li>  Quel serait le pire sc√©nario si vous n'√©tiez pas assur√©? </li></ul><br>  Pour TDD, nous pouvons imaginer des contributions mensuelles sous forme de co√ªts de production pour l'entretien de nos tests unitaires, la probabilit√© de dommages √† la voiture comme la probabilit√© d'avoir un bug, et le co√ªt d'un remplacement complet de voiture comme le pire des cas pour une erreur de r√©gression. <br><br>  S'il faut beaucoup de temps pour cr√©er un test de fonctionnalit√©, il est simple et peu susceptible d'√™tre modifi√© (ou il peut √™tre trait√© s'il se casse dans le d√©veloppement ult√©rieur), alors les tests unitaires peuvent causer plus de probl√®mes que de bien.  Si les tests sont faciles √† faire, la fonction est instable et interconnect√©e (ou ses erreurs prendront beaucoup de temps), alors les tests aideront. <br><br><h3>  Limites d'automatisation </h3><br>  Les tests unitaires peuvent √™tre un excellent ajout √† la recherche et √† l'√©limination des erreurs, mais ils ne remplacent pas la n√©cessit√© d'un contr√¥le de qualit√© professionnel dans les jeux √† grande √©chelle.  L'AQ est un art qui n√©cessite de la cr√©ativit√©, un jugement subjectif et une excellente communication technique. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr455076/">https://habr.com/ru/post/fr455076/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr455064/index.html">Talent contre chance: le r√¥le du hasard dans le succ√®s et l'√©chec</a></li>
<li><a href="../fr455066/index.html">Diffusion et pr√©sentations de l'analyse syst√®me MeetUp UPD2</a></li>
<li><a href="../fr455068/index.html">Politique z√©ro bug. Pas de bugs - pas de probl√®mes?</a></li>
<li><a href="../fr455070/index.html">Pourquoi les interviews sont-elles si souvent pos√©es sur les listes cha√Æn√©es</a></li>
<li><a href="../fr455072/index.html">Toute la v√©rit√© sur RTOS. Article # 28. Minuteries logicielles</a></li>
<li><a href="../fr455078/index.html">O√π parler d'Apache Ignite et des syst√®mes distribu√©s en √©t√©</a></li>
<li><a href="../fr455080/index.html">Les personnes √¢g√©es n'appartiennent pas ici? Programmable apr√®s trente-cinq</a></li>
<li><a href="../fr455082/index.html">Nous √©tudions MITRE ATT & CK. Matrices mobiles: acc√®s aux appareils. Partie 4</a></li>
<li><a href="../fr455088/index.html">Que testent les entretiens et les √©l√©ments de test</a></li>
<li><a href="../fr455096/index.html">Tester les comp√©tences avec des tests - pourquoi et comment</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>