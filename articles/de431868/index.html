<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüëß‚Äçüë¶ üèéÔ∏è üïì Stunden auf Gasentladungslampen (GRI) sind sie Nixie Uhr üë©üèº‚Äçü§ù‚Äçüë®üèø ‚ôéÔ∏è üë®‚Äçüë®‚Äçüë¶‚Äçüë¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Projektkonzept 
 Das Konzept dieses Produkts besteht darin, die Notwendigkeit zu erf√ºllen, die reale Flamme zu betrachten. Eine Glimmentladung in eine...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Stunden auf Gasentladungslampen (GRI) sind sie Nixie Uhr</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431868/"><h3>  Projektkonzept </h3><br>  Das Konzept dieses Produkts besteht darin, die Notwendigkeit zu erf√ºllen, die reale Flamme zu betrachten.  Eine Glimmentladung in einem Gas ist streng genommen keine Flamme, obwohl sie wie eine echte Flamme aussieht. <br>  Ich mag seine Farbe und dies war das einzige Motiv, solche Uhren in einer einzigen Kopie f√ºr mich selbst zu kreieren. <br><br>  Die Aufgabe, ein Ger√§t f√ºr die Massenproduktion zu schaffen, wurde nicht gestellt. <br><br>  Daher ist das Projektbudget viel vern√ºnftiger.  Entscheidungen wurden aufgrund unserer eigenen Vorstellungen von Sch√∂nheit getroffen, die Kosten f√ºr Komponenten wurden nicht ber√ºcksichtigt.  Nat√ºrlich gibt es immer Einschr√§nkungen, zum Beispiel habe ich keine gro√üen GRI (Gasentladungsindikatoren) wie IN18 gekauft - ihr Preis ist mehr als eine intuitiv definierte Grenze und sie passten nicht zu meinem Konzept des Erscheinungsbilds des Produkts.  Ich habe den GRI-Typ IN-12 verwendet. <br><a name="habracut"></a><br>  IN12 ist mit einer Mischung aus Neon (oder einer Mischung aus Inertgasen) und Quecksilberdampf gef√ºllt.  Quecksilberdampf erh√∂ht die Haltbarkeit der Vorrichtung erheblich und verleiht dem Gl√ºhen des Plasmas eine bl√§uliche F√§rbung.  Andere GRIs k√∂nnen quecksilberfrei sein und ein klares Neonlicht erzeugen. <br><br>  Die Hauptfunktion der Uhr besteht darin, die genaue Uhrzeit anzuzeigen (CEP, hallo!).  Es ist sehr w√ºnschenswert, dass die Zeit beim Start automatisch eingestellt wird und keine Manipulation durch den Benutzer erfordert.  Aus meiner pers√∂nlichen Sicht werden Tasten auf solchen Ger√§ten √ºberhaupt nicht ben√∂tigt.  √Ñhnliche Ger√§te mit einem Dutzend Tasten und Hunderten von Funktionen, die durch verschiedene Kombinationen von Dr√ºcken und Druckzeiten verursacht werden, machen mich sehr traurig.  Erstens - GRI sind gut angepasst, um nur Zahlen anzuzeigen.  Es ist nichts anderes vorgesehen, und Versuche, Men√ºelemente usw. anzuzeigen, verwenden meiner Meinung nach ein ungeeignetes Werkzeug.  Gleiches gilt f√ºr Zusatzfunktionen wie Wecker etc. <br><br>  Zweitens ist es offensichtlich, dass es unrealistisch ist, sich daran zu erinnern, welche Kombination von Tastendr√ºcken die eine oder andere eingebettete Funktion aktiviert.  Das Schreiben von Programmen f√ºr solche Ger√§te macht Spa√ü und ist angenehm, aber dann unm√∂glich zu verwenden. <br><br>  Diese Frage wird in dem Buch Donald A. Norman Design vertrauter Dinge perfekt ber√ºcksichtigt.  Ich werde eine Passage zitieren: <br><br>  <i>‚ÄûW√§hrend meiner Reisen habe ich den Leitz-Diaprojektor mehrmals benutzt.</i>  <i>Das erste Mal war der schlimmste Albtraum.</i>  <i>Ich begann zu vortragen und zeigte die erste Folie.</i>  <i>Als es notwendig war, zur n√§chsten Folie zu wechseln, dr√ºckte der f√ºr die Show verantwortliche Student sanft auf den Knopf und begann mit Entsetzen zu beobachten, wie der St√§nder in die entgegengesetzte Richtung ging, aus dem Diaprojektor rutschte und vom Tisch auf den Boden fiel und alle Folien mischte.</i>  <i>Es dauerte 15 Minuten, um die Folien in der richtigen Reihenfolge anzuordnen.</i>  <i>Schuld daran war nicht der Student, sondern dieser elegante Diaprojektor.</i>  <i>Wie kann eine Taste zwei entgegengesetzte Funktionen ausf√ºhren?</i>  <i>Niemand konnte es beim ersten Mal richtig machen. ‚Äú</i> <i><br><br></i>  <i>Das Problem war, dass eine Taste zwei entgegengesetzte Funktionen ausf√ºhrte - ein kurzer Druck verschob den Schieber nach vorne, ein langer nach hinten. ‚Äú</i> <br><br>  Wir setzen die Diskussion √ºber das Einstellen der Uhr fort.  Diese Ger√§te werden mithilfe eines Computers, Tablets oder Smartphones optimal von ihrer eigenen Webseite aus konfiguriert. <br><br>  Ich brauche keinen Wecker f√ºr Uhren mit GRI - erstens gibt es immer Mobiltelefone mit solchen Funktionen und einer viel bequemeren Oberfl√§che.  Zweitens kann der Takt am GRI keine autonome Stromquelle verwenden, da der typische Stromverbrauch (200 Volt * 7 mA = 1400 mW oder 1,4 Watt) ziemlich gro√ü ist und f√ºr chemische Stromquellen vern√ºnftige Grenzen √ºberschreitet.  Daher wird die Uhr mit der GRI vom Netzwerk gespeist, und die Alarmfunktion h√§ngt von der Zuverl√§ssigkeit des Netzwerks ab. <br><br>  Aus den obigen √úberlegungen ergibt sich das folgende System: <br><br>  GRI-Uhr mit Strom aus dem Netzwerk, mit der M√∂glichkeit, die genaue Zeit aus dem Internet zu ermitteln, mit der Einstellung von einer eigenen Webseite.  Es sind keine zus√§tzlichen Funktionen erforderlich. <br><br>  Trotzdem habe ich die Strenge dieser Regel verletzt, indem ich die folgenden Funktionen hinzugef√ºgt habe: <br><br>  Eine Uhr kann Stra√üentemperatur, Luftfeuchtigkeit und Luftdruck anzeigen.  Diese Funktion erf√ºllt mein pers√∂nliches Bed√ºrfnis, die Au√üentemperatur zu kennen, wenn ich morgens zur Arbeit komme.  Ich befestige mein Hemd jeden Tag an derselben Stelle und wenn die Uhr mich dort findet, zeigen sie konstant die Au√üentemperatur, Luftfeuchtigkeit und den Luftdruck in Millimetern Quecksilber an.  Die Veranstaltung erwies sich sowohl bei mir als auch bei meinen Familienmitgliedern als erfolgreich und sehr gefragt.  Daten zu Stra√üentemperatur, -druck und -feuchtigkeit werden automatisch erfasst und f√ºr die Zeit zwischen Paketen von einer externen Quelle gespeichert.  Wenn das Zeitlimit √ºberschritten wird (Daten sind veraltet), zeigt die Uhr das aktuelle Datum an.  In meinem Heimsystem kommen Daten zu den Parametern der externen Umgebung in Intervallen von 10 Minuten an, das Zeitlimit "Daten veraltet" ist auf 30 Minuten eingestellt.  Bei der Gestaltung der Uhr wurde davon ausgegangen, dass dem externen Team eine Stimme gegeben werden konnte, zum Beispiel: ‚ÄûUhr, Wetter!‚Äú.  W√§hrend des Prototyping stellte sich jedoch heraus, dass diese Methode unzuverl√§ssig und unpraktisch ist.  Daher wurde in Zukunft die Sprachsteuerung durch ein Verfahren zur Bestimmung der Anwesenheit einer Person vor der Uhr gem√§√ü dem Flugzeit-Lasersuchger√§t ersetzt.  Die Uhr sollte Wetterdaten anzeigen, wenn Sie etwa eine Sekunde vor ihnen stehen. <br><br>  Die Uhr eines externen Befehls √ºber die HTTP-Schnittstelle kann die in diesem Befehl empfangenen Daten anzeigen.  Das Team √ºbertr√§gt sowohl die Daten selbst als auch die Zeit, zu der sie auf dem Display angezeigt werden.  Es wurde als Gelegenheit konzipiert, etwas vom Computer durch Ereignisse anzuzeigen, beispielsweise durch √úberhitzung des Prozessors des Heimservers oder durch andere Parameter.  √úber die eingebettete Oberfl√§che k√∂nnen Sie von au√üen einen siebenstelligen Code mit zwei Punkten anzeigen.  In der Praxis wird es √ºberhaupt nicht angewendet. <br><br>  Zu den zwingenden Anforderungen geh√∂rte auch die Auswirkung einer reibungslosen √Ñnderung der Zahlen.  Es ist dieser Effekt, der einzige von allen, den ich wirklich mag! <br><br>  Die Helligkeit der Anzeigen sollte an das Umgebungslicht angepasst werden, w√§hrend der Bildkontrast unver√§ndert bleibt. <br><br>  Die Uhr sollte sechs Ziffern und einen Hilfswert vor den Ziffern anzeigen, um anzuzeigen, was aktuell angezeigt wird. <br><br><h3>  Implementierung der konzipierten Hardwarel√∂sung </h3><br><h3>  GRI-Auswahl </h3><br>  Zur Anzeige der Zeit und anderer Daten wurden vier GRI IN-12A, zwei IN-12B und ein IN-15A verwendet. <br><br>  IN-12B enth√§lt die Punkte, mit denen ich Stunden-Minuten-Sekunden getrennt habe. <br><br>  GRI IN-15A kann eine Reihe von Sonderzeichen ‚Äû+‚Äú, ‚Äû-‚Äú, ‚Äû%‚Äú, ‚ÄûP‚Äú usw. am Zeilenanfang anzeigen. <br><br><h3>  Der optimale Abstand zwischen den Anzeigen. </h3><br>  Damit die Uhr harmonisch aussieht, sollte ein gewisser Abstand zwischen den Anzeigen wie zwischen den Buchstaben in einer Zeile vorgesehen werden.  Die Untersuchung der Frage ergab folgende Informationen: Der optimale Abstand zwischen den Zahlen betr√§gt 4 mm, zwischen den W√∂rtern 8 mm.  Der optimale Abstand zwischen den Zahlen wird durch einen passgenauen Indikator in den Panels sichergestellt.  Ich glaube, das ist kein Zufall, dachten sowjetische Ingenieure w√§hrend der Entwicklung mit dem Kopf und machten den richtigen Abstand. <br><br><h3>  Synchronisation mit Zeitservern </h3><br>  √úberlegen Sie, wie Sie automatisch die genaue Zeit ermitteln k√∂nnen: <br><br><ol><li>  Eine Anfrage √ºber das Internet an einen genauen Zeitserver. </li><li>  Glonass \ GPS-Empf√§nger.  Leider funktioniert es in einigen F√§llen nicht: In meiner Wohnung am unteren Rand des Raums verschwindet beispielsweise das Signal der Satelliten, und die erfolglose Konfiguration der umliegenden Geb√§ude wirkt sich auf mich aus, bei der der klare Himmel nur direkt am Fenster sichtbar ist. </li><li>  Mobilfunknetz.  Theoretisch k√∂nnen Sie Zeit von einer Mobilfunkstation anfordern, ohne sich zu registrieren (d. H. Ohne SIM-Karte).  Ich habe es nicht versucht.  Theoretisch der universellste Weg, der vom Benutzer nichts verlangt. </li><li>  Pr√§zise Zeitsignale bei langen Wellenl√§ngen.  Es ist schwierig f√ºr die Anwendung, es gibt keine tragbaren fertigen L√∂sungen. </li></ol><br>  Meiner Meinung nach ist es am besten, die genaue Zeit √ºber das Internet abzufragen.  Es ist zu beachten, dass sich die integrierten Funktionen zum Speichern der aktuellen Uhrzeit des ESP8266 als recht genau herausstellten: In einem Monat, in dem der Zugangspunkt zum Netzwerk, √ºber das die beschriebenen Stunden mit dem Internet verbunden waren, versehentlich getrennt wurde, betrug die Abfahrt weniger als eine Minute.  Ich habe dies durch das Zusammentreffen von Uhr und Computerzeit bestimmt.  Nach Wiederherstellung der Stromversorgung wird der Access Point automatisch synchronisiert. <br><br><h3>  Die Wahl der Prozessor- und Steuerschaltungen GRI </h3><br>  Zur Steuerung der Uhr ist ein Prozessor erforderlich, der auf das Internet zugreifen kann.  Bei den verf√ºgbaren handelt es sich um Karten, die auf dem ESP8266 basieren.  Die Studie des Problems zeigte, dass das Board billig und weit verbreitet ist, √ºber eine umfangreiche, vorgefertigte Software verf√ºgt, die von Enthusiasten erstellt wurde und in der Arduino-Umgebung programmiert werden kann. <br><br><h3>  Die Wahl des Systems (Mikroschaltung) der Steuerung </h3><br>  GRI wird mit einer ziemlich hohen Spannung von etwa 200 Volt betrieben.  Laut Pass (siehe Abb. 1) ben√∂tigt IN12 mindestens 170 Volt f√ºr das normale Auftreten einer Glimmentladung bei einem Strom von bis zu 2 mA.  Das Steuersystem muss in der Lage sein, Str√∂me von mehreren Milliampere zu schalten und Spannungen im Bereich von 200 Volt standzuhalten.  In der Sowjetunion wurden K155ID1 (133ID1 usw.) Mikroschaltungen hergestellt (bin√§rer Hochspannungsdezimaldecoder).  Sie arbeiteten perfekt im statischen Modus, ein Decoder war pro Lampe erforderlich.  Jetzt sind diese Mikroschaltungen aus alten Lagerbest√§nden erh√§ltlich und werden im Werk Minsk Integral sogar in kleinen Mengen hergestellt.  Grunds√§tzlich eine gute Wahl f√ºr Uhren auf Gegenmikrokreisen.  Aufgrund der begrenzten Anzahl von Ausg√§ngen auf Mikroprozessoren sind sie jedoch in einem Mikroprozessorsystem schwierig zu verwenden.  Die ESP8266-Uhr, die als Grundlage dient, hat nur ein Dutzend Schlussfolgerungen, und einige davon weisen bestimmte Einschr√§nkungen auf.  F√ºr 7 Decoder sind 28 Ausg√§nge oder ein Zwischenregister erforderlich, in das Daten sequentiell ausgegeben und dann parallel zu K155ID1 ausgegeben werden m√ºssen, was die Schaltung erheblich kompliziert. <br><br><img src="https://habrastorage.org/webt/99/81/ve/9981vejezvjuviohr0l_8xauc_8.gif"><br>  <i>Abb. 1. Pass der Glimmentladungsanzeige IN-12</i> <br><br><img src="https://habrastorage.org/webt/ij/w7/dv/ijw7dvvzivci68gogd0tcyjigfe.jpeg"><br>  <i>Abb. 2. Pass der Glimmentladungsanzeige IN-15</i> <br><br>  Bei Verwendung von 155ID1 erfordert der Effekt einer reibungslosen √Ñnderung der Zahlen eine dynamische Anzeige.  Tatsache ist, dass GRI ein scharf nichtlineares Ger√§t ist und es sehr schwierig ist, seine Helligkeit auf analoge Weise durch √Ñndern der Spannung zu steuern - es ist aufgrund der hohen Steigung der Strom-angelegten Spannungscharakteristik sehr schwierig.  Im Bereich geringer Helligkeit wird die Gasentladung instabil.  Die externe Beleuchtung wirkt sich auch auf das stetige Einschalten der Lampe aus - bei einer Verringerung der externen Beleuchtung steigen sowohl die Durchbruchspannung als auch die Einschaltzeit der Anzeige an.  Externe Photonen dienen als eine Art Feuerzeug, Initiatoren der Entladung.  √úbrigens wird die hohe Steilheit der Abh√§ngigkeit des Stroms durch die Gasentladungsvorrichtung von der angelegten Spannung verwendet, um eine stabile Spannung zu erhalten, tats√§chlich ist eine solche Gasentladungsvorrichtung ein Spannungsstabilisator.  Um die Helligkeit des GDI zu steuern, ist daher die Verwendung eines gepulsten Leistungsmodus erforderlich, bei dem die Helligkeit proportional zum durchschnittlichen Strom durch den GDI ist, der wiederum proportional zur Breite des Impulses ist. <br><br>  Eine dynamische Anzeige bei Verwendung von 155ID1 + GRI ist durchaus m√∂glich, weist jedoch eine Reihe von Einschr√§nkungen auf.  Aufgrund der Besonderheit der 155ID1-Schaltung (relativ niedrige Spannungsschl√ºsselelemente - nur 60 Volt) sind Blitze benachbarter Nummern und andere unerw√ºnschte Effekte m√∂glich.  Diese Effekte werden mit einer Vielzahl von Tricks bek√§mpft - sowohl Hardware als auch Software.  Auf der RADIOKOT.RU-Website (https://radiokot.ru/forum/viewtopic.php?f=3&amp;t=3210) gibt es ein gro√ües Thema, das NIXIE CLOCK gewidmet ist. Ich habe alles gelesen und Schlussfolgerungen f√ºr mich gezogen - dynamische Anzeige ist f√ºr meine Zwecke ungeeignet . <br><br>  Eine Suche im Internet ergab einen hervorragenden Ersatz f√ºr 155ID1 - dies ist der HV5622-Chip, der ein 32-Bit-Schieberegister mit Hochspannungsausg√§ngen darstellt.  Das Blockschaltbild ist in Abb. 3 dargestellt. <br><br><img src="https://habrastorage.org/webt/rb/nu/xc/rbnuxc9pdbdqrtxg5epadxwbtg8.png"><br>  <i>Abbildung 3. Strukturdiagramm von HV5622, Supertex inc.</i>  <i>¬©</i> <br><br>  Der HV5622 kann Spannungen bis zu 230 Volt umschalten und Daten √ºber eine serielle Schnittstelle mit einer Taktfrequenz von bis zu 8 MHz empfangen.  Mikroschaltungen k√∂nnen in einer Kette in Reihe geschaltet werden.  Zur Steuerung sind nur 4 Ausg√§nge vom MK erforderlich: Daten, ein Taktsignal, ein Schreibsignal in das Ausgangsregister und ein Freigabesignal.  Das einzige, was Zweifel aufkommen lie√ü, war die n√§hrende Spannung.  Laut Handbuch sollten es mindestens 8 Volt sein.  Und ich m√∂chte die Chips mit 5 Volt versorgen und sie sogar mit einem logischen Signal mit einem Pegel von 3,3 V steuern.  Im Internet habe ich einige Beispiele f√ºr die Verwendung solcher Mikroschaltungen gefunden und sie mit 5 Volt betrieben.  Daher bot ich w√§hrend der Entwicklung f√ºr alle F√§lle die M√∂glichkeit, einen Logikpegelwandler und ein 5622-Netzteil mit einer h√∂heren Spannung zu installieren, installierte diese Knoten jedoch nicht sofort.  Die Praxis hat gezeigt, dass ab 5 Volt sowieso alles gut funktioniert. <br><br><h3>  Beobachten Sie Ern√§hrung </h3><br>  Um die Uhr am GRI mit Strom zu versorgen, ist eine Stromversorgung mit zwei Ausg√§ngen erforderlich: 5 Volt mit einem Strom im Bereich von einem halben Ampere und 180-200 Volt mit einem Strom von etwa 10 mA.  Standardm√§√üig l√∂sen die Autoren von Schemata f√ºr solche Uhren das Leistungsproblem wie folgt: Sie verwenden ein externes Schaltnetzteil 220 -&gt; 12 Volt, von denen 5 Volt im Takt erzeugt werden, und 180 Volt f√ºr die Stromversorgung werden vom zweiten Impulswandler vom Eingang 12 Volt erhalten.  Das hei√üt,  Tats√§chlich werden 2 Impulswandler in der allgemeinen Stromversorgungsschaltung verwendet, von denen der erste 220 - 12 und der zweite 12 - 180 ergibt. Meiner Meinung nach ist dies ineffizient.  Aus diesem Grund habe ich mich f√ºr eine sehr traditionelle Art der Verwendung des vorgefertigten Ringkerntransformators TorAN15 entschieden.  Das Aussehen dieses Transformators ist in Abb. 4 dargestellt. <br><br><img src="https://habrastorage.org/webt/1e/uv/f_/1euvf_52xjsdpo-m64pa5dgxqwy.jpeg"><br>  <i>Abbildung 4. TorAN15-Transformator</i> <br><br>  Ich habe diesen Transformator auf der ISTOK2.COM-Website gekauft.  Der Transformator hat zwei Sekund√§rwicklungen - eine bei 170 Volt, die zweite bei 6,3 Volt.  Dies erm√∂glichte es, mit der einfachsten Stromversorgungsschaltung auszukommen.  Hochleistungsversorgung GRI wird durch eine Diodenbr√ºcke gleichgerichtet und auf Kondensatoren gefiltert.  Diese Teile werden von einem unn√∂tigen Leuchtstofflampenschoner verwendet.  Niedrig f√ºr die Mikrokreisstromversorgung wird auch durch eine Diodenbr√ºcke gleichgerichtet, auf einem Elektrolytkondensator gefiltert und auf einem integrierten Stabilisator 7805 stabilisiert. Der Wirkungsgrad einer solchen Schaltung ist viel h√∂her als bei einem System mit zwei Umwandlungen, die Zuverl√§ssigkeit des Systems ist viel h√∂her.  Plus das v√∂llige Fehlen von Hochfrequenzst√∂rungen.  Das Minus ist unmodern und der Transformator ist schwer.  Aber die Schwere des Transformators ist in diesem Fall eher ein Plus - ich wollte, dass die Uhr brutal massiv ist. <br><br>  Das Taktschema ist also definiert: Es handelt sich um ein fertiges Modul auf Basis von ESP12E, drei HV5622-Mikroschaltungen, einen Lichtsensor auf Basis von MAX44009 und eine herk√∂mmliche (ich w√ºrde sogar konservative sagen) Stromversorgung.  Anschlie√üend wurde ein Knoten zum Bestimmen einer Person vor der Uhr basierend auf dem VL53L0X-Flugzeit-Entfernungsmesser-Lasermodul hinzugef√ºgt.  Das schematische Diagramm der Uhr ist in Fig. 5 gezeigt. <br><br><img src="https://habrastorage.org/webt/uo/n7/oy/uon7oyahasvsbxnkajvzm-bz0oi.jpeg"><br>  <i>Abbildung 5. Dronsky Nixie Uhr.</i>  <i>Schematische Darstellung</i> <br><br>  Ich habe die Pin-Umschaltung wie folgt aufgeteilt: Die ersten drei Lampen - die erste HV5622, die zweiten drei Lampen - die zweite HV5622, die verbleibende HV5622 steuern die Lampe mit Sonderzeichen und Punkten in zwei IN12B. <br><br>  In der Entwurfsphase war nicht klar, ob der SPI-Kanal genug Geschwindigkeit haben w√ºrde, um Daten f√ºr einen reibungslosen Ziffernwechsel auszugeben.  Die Tatsache, dass es f√ºr den ESP12E nicht schwierig ist, einmal pro Sekunde 96 Bit auszugeben, stand au√üer Zweifel.  Aber gibt es genug Geschwindigkeit, um Effekte auszugeben?  Nach Berechnungen sollte mit einem Spielraum ausreichen.  Aber wie Sie wissen, war es glatt auf dem Papier ... <br><br>  Daher war zun√§chst geplant, Daten in drei Stufen separat f√ºr jeden Chip auszugeben.  Ein praktischer Test hat gezeigt, dass der SPI-Kanal auch bei einer Taktfrequenz von 4 MHz eine ausreichende Geschwindigkeit mit einem gro√üen Spielraum f√ºr Effekte aufweist.  Sogar die F√§higkeit, die Geschwindigkeit zu verdoppeln, wurde nicht beansprucht.  Infolgedessen sind alle Mikroschaltungen in einer Kette verbunden und die Ausgabe von 96 Bit erfolgt mit einem Befehl.  Berechnungen zufolge sollte die Ausgabezeit von 96 Bit 24 Œºs betragen.  Abbildung 6 zeigt eine Aufzeichnung eines logischen Analysators, der sieben Zeichen auf der GRI ausgibt.  Die Gesamtausgabezeit unter Ber√ºcksichtigung der Erzeugung des LE-Signals betr√§gt weniger als 30 ŒºS. <br><br><img src="https://habrastorage.org/webt/my/iw/-m/myiw-mjjwbqh8sghcw2no7obnzo.png"><br>  <i>Abbildung 6. Ausgang des 96-Bit-Ausgangskanals HSPI des Logikanalysators mit einer Taktfrequenz von 4 MHz</i> <br><br>  Die CLOCK-Pins aller Chips sind kombiniert.  Der DI-Anschluss (Dateneingang) der zweiten und dritten Mikroschaltung ist mit den DO-Anschl√ºssen (Datenausgang) der ersten bzw. zweiten Mikroschaltung verbunden.  Die LE-Pins (Latch-Freigabe) werden kombiniert, sie empfangen einen Impuls, der Daten von der Verschiebung zum Ausgangsregister √ºbertr√§gt.  Bis zur √úbertragung der Lampe wird ausgegeben, was im Ausgangsregister gespeichert ist.  BLOCK-Pins werden kombiniert und √ºber einen 1k-Widerstand mit Masse verbunden, um die Ausgangsstufen des HV5622 ausgeschaltet zu halten, bis das Programm im MK startet.  Im Handbuch wird empfohlen, die Stromversorgung einzuschalten, die erste Datenausgabe vorzunehmen und dann die Ausgangsstufen einzuschalten. <br><br><h3>  Helligkeitsregelung </h3><br>  Um die Helligkeit des GRI zu steuern, um einen konstanten optimalen Kontrast der Anzeigen aufrechtzuerhalten, wird der BLOCK-Ausgang verwendet, an den ein PWM-Signal mit einer Frequenz von 2500 Hz geliefert wird.  Es wurde eine ausreichend hohe Frequenz des PWM-Steuersignals verwendet, die das Fehlen von Strobe-Effekten usw. garantierte. In √úbereinstimmung mit den Normen (Konstruktionsnormen und -vorschriften (Konstruktionsnormen und -regeln) 23 - 05 - 2010 (aktualisierte Version von SNiP 23 - 05 - 95) und den Hygienevorschriften und -normen von SNPiN 2.21 /2.1.1.1278-03) Es wird angenommen, dass eine Person die Frequenz von Beleuchtungspulsationen √ºber 300 Hz nicht wahrnimmt.  In diesem Fall bietet ein √úberschreiten der PWM-Frequenz um fast eine Bestellung das richtige Ma√ü an Sehkomfort. <br><br><h3>  Der Effekt einer reibungslosen √Ñnderung der Zahlen </h3><br>  Um den visuellen Effekt einer reibungslosen √Ñnderung der Ziffern zu erzielen, m√ºssen die alten und neuen Ziffern w√§hrend des Wechsels einer Ziffer in eine andere (normalerweise 200 bis 250 ms) abwechselnd eingeschaltet werden. Die Brenndauer der alten Ziffer sollte abnehmen und die neue sollte zunehmen.  Der Algorithmus zum √Ñndern von Ziffern (Unterprogramm√§nderung ()) f√ºhrt 60 Zyklen durch.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beim Starten des Ziffern√§nderungsalgorithmus ist die erste Ziffer 100% der Zykluszeit und die zweite 0% enthalten. W√§hrend die Zyklen vergehen, nimmt die Einschaltzeit der ersten Ziffer von 100% auf 0% ab, und die Einschaltdauer der zweiten Ziffer steigt von 0% auf 100%. Somit reduziert der Algorithmus zum reibungslosen √Ñndern von Ziffern √ºber 200 ms und 60 Zyklen die Helligkeit der ersten Ziffer auf Aus und der zweiten auf volle Helligkeit. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W√§hrend der restlichen Zeit des zweiten Intervalls werden die Nummern kontinuierlich und statisch eingeschaltet. Ihre Gesamthelligkeit wird durch Steuern der allgemeinen Ein / Aus-Anzeige des PWM-Signals an den BL-Anschl√ºssen verringert.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung 7 zeigt die vom Logikanalysator beim √Ñndern der Zahlen aufgezeichneten Signale. </font><font style="vertical-align: inherit;">Es ist ersichtlich, dass zu Beginn des Verschiebungsunterprogramms die alte Nummer f√ºr die maximale Zeit eingeschaltet ist und die neue die minimale ist, und w√§hrend der Verschiebung (ungef√§hr 250 ms) verringert sich die Brennzeit der alten Nummer auf 0 und die neue w√§chst auf das Maximum. </font><font style="vertical-align: inherit;">Optisch √§u√üert sich dies in einer sanften Abnahme der Helligkeit der alten Figur bei gleichzeitigem ‚ÄûAuftauen‚Äú der neuen Figur. </font></font><br><br><img src="https://habrastorage.org/webt/q9/ic/db/q9icdb570c3qwwi3cdxxpoji5tk.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abb. 7. Aufzeichnung von Steuersignalen w√§hrend eines reibungslosen Ziffernwechsels. Hier wird</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine Videoaufzeichnung des Effekts gegeben.</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/1d2PpXAWdis" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und hier </font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/iLqac4LQwv8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  und hier: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/jb82CykLpQA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Synchronisation mit Zeitservern </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachdem ich das Problem im Internet untersucht hatte, kam ich zu dem Schluss, dass Autoren von Programmen selbst Routinen f√ºr das NTP-Protokoll schreiben (oder vorgefertigte Routinen von Drittanbietern verwenden). Dies hat mich etwas √ºberrascht, da das Espressif SDK integrierte Funktionen f√ºr die Arbeit mit Echtzeit erw√§hnt. Die eingebaute Funktionalit√§t bietet eine Anforderung f√ºr Zeitserver (bis zu drei), Zeitkorrektur (nach meinen Beobachtungen - eine Anforderung an einen Zeitserver erfolgt alle 4-6 Stunden), Konvertierung eines Wertes in Form von Unix-Zeit in eine f√ºr Menschen lesbare Form, Korrektur gem√§√ü einer bestimmten Zeit- Zone. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zu den Funktionen der Verwendung der integrierten Echtzeitfunktion: F√ºr die erste und mehrere nachfolgende Zeitanforderungen wird Null zur√ºckgegeben und die Diagnose "RTC zuerst ausf√ºhren" ausgegeben. Vorgehensweise - Ich habe sie nicht gefunden und warte daher nur (einige Sekunden), bis eine andere Zeit als Null angezeigt wird.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Taktstartalgorithmus </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn die Uhr eingeschaltet ist, wird das System im Client-Modus eingeschaltet und versucht, mit den gespeicherten Details eine Verbindung zum Access Point herzustellen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP8266 speichert diese Details nach einer erfolgreichen vorherigen Verbindung allein im Dienstspeicher. </font><font style="vertical-align: inherit;">Dies ist eine im SDK implementierte Funktion. </font><font style="vertical-align: inherit;">Wenn diese Verbindung nicht erfolgreich ist, wird der n√§chste Versuch unternommen, aber der Name und das Kennwort f√ºr den Zugriffspunkt werden aus dem EEPROM gelesen. </font><font style="vertical-align: inherit;">Das EEPROM speichert auch die Zeitzone (eine Zahl im Bereich von -12 - +12), die dann verwendet wird, um die Zeit korrekt in ein lokales Format zu konvertieren.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn diese Verbindung ebenfalls nicht erfolgreich ist, wechselt der Betriebsmodus zum ‚ÄûZugangspunkt‚Äú und die Webseite der Uhr wird unter der Standardadresse 192.168.4.1 f√ºr jedes an diesen Zugangspunkt angeschlossene Ger√§t verf√ºgbar. In meinem Fall lautet der Name des Zugriffspunkts ESP_D. Gehen Sie von einem Smartphone, Tablet oder Laptop zur Ger√§teseite, w√§hlen Sie einen Zugangspunkt aus und geben Sie ein Passwort ein. W√§hrend der Access Point-Modus aktiviert ist, ist der Client-Modus deaktiviert. Dies ist auf die Besonderheiten des Verhaltens des Systems in einer Situation zur√ºckzuf√ºhren, in der die Verbindung zum Zugriffspunkt fehlgeschlagen ist. Das System wiederholt st√§ndig Beitrittsversuche, es wird nur damit besch√§ftigt sein und es werden praktisch keine Ressourcen mehr f√ºr irgendetwas anderes √ºbrig sein. √Ñu√üerlich wird sich dies als unangenehme Hemmung der Schnittstelle manifestieren. Das Erscheinungsbild der Seite ist in Abb. 8 dargestellt.</font></font><br><br><img src="https://habrastorage.org/webt/8o/am/ie/8oamiekijplb_n_aoqwaj6o9l_a.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abb. 8. Darstellung der WEB-Taktschnittstelle und der Befehlszeile, die die Reaktion auf den Ping-Befehl demonstrieren.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Auf dieser Seite werden alle gefundenen Zugriffspunkte angezeigt. Zugangspunkte werden nach Signalst√§rke sortiert. Die oberste Zeile ist der Zugangspunkt mit dem st√§rksten Signal und h√∂chstwahrscheinlich der n√§chstgelegene (d. H. Derjenige, dem Sie beitreten m√ºssen). Sie m√ºssen ein Passwort eingeben, eine Zeitzone ausw√§hlen und auf OK klicken. Das System aktiviert den Client-Modus (gleichzeitig mit dem Access Point) und versucht, eine Verbindung herzustellen. Wenn die Verbindung erfolgreich hergestellt wurde, werden die Parameter im EEPROM gespeichert. Wenn die Verbindung fehlgeschlagen ist, wird auf der Seite eine Meldung angezeigt, und Sie k√∂nnen erneut versuchen, das Kennwort usw. einzugeben.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nach einer erfolgreichen Anmeldung im Netzwerk wird der "Zugangspunkt" -Modus deaktiviert und nur der "Client" -Modus verbleibt, d. H. Auf die √úberwachungsseite kann nur √ºber das interne Netzwerk zugegriffen werden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um √ºber den Namen auf die Uhr zugreifen zu k√∂nnen (in meinem Fall ‚Äûesp‚Äú), wird die NBNS-Bibliothek gestartet, die eine Antwort √ºber das NetBios-Protokoll liefert. Die Bibliothek erm√∂glicht es der Uhr, auf Befehle wie ping esp zu reagieren und einfach unter dem Namen </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">esp darauf</font></a><font style="vertical-align: inherit;"> zuzugreifen</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aus Gr√ºnden, die mir nicht klar sind, ist dies eine wunderbare Bibliothek, die eine Antwort auf eine Broadcast-Anfrage wie "An welcher Adresse ist der" Name "?" </font><font style="vertical-align: inherit;">und damit Sie das trostlose Verfahren zum Ermitteln der IP-Adresse des Ger√§ts anhand der internen Daten des Routers (Switch) vergessen k√∂nnen, wird es sehr selten verwendet. </font><font style="vertical-align: inherit;">Fast alle im Internet beschriebenen Ger√§te des ESP8266 verwenden diesen einfachen und praktischen Mechanismus nicht. </font><font style="vertical-align: inherit;">Faulheit sollte den Fortschritt bewegen - aber in diesem Fall bewegt sie sich nicht. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Als n√§chstes beginnt der Hauptprogrammzyklus, in dem Folgendes auftritt:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Die aktuelle Zeit wird abgefragt und wenn die Sekunden vergehen, beginnt eine √Ñnderung der Zeitanzeige. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Lichtsensor wird abgefragt und das Tastverh√§ltnis des PWM-Signals angepasst, wodurch die Helligkeit der Uhr gesteuert wird. </font><font style="vertical-align: inherit;">Der Zweck der Einstellung besteht darin, den konstanten Kontrast der Zahlen beim √Ñndern der Beleuchtung im Raum beizubehalten.</font></font></li><li>    VL53L0X.       ,       2 . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Experimente haben gezeigt, dass 2 Meter unter idealen Bedingungen sind, wenn ein wei√ües Blatt Papier oder Aluminiumfolie mit einem Reflexionskoeffizienten nahe der Einheit als Reflektor verwendet wird. Bei gew√∂hnlichen Objekten mit einem unvollst√§ndigen Reflexionskoeffizienten (Gewebe, menschliche Haut usw.) betr√§gt der Abstand zur sicheren Bestimmung etwas mehr als 1 Meter. Wenn der Sensor das Vorhandensein eines Objekts vor der Uhr anzeigt, zeigt eine Unterroutine die aktuelle Au√üentemperatur, Luftfeuchtigkeit und den Luftdruck an. Es wurden Ma√ünahmen ergriffen, um die St√∂rfestigkeit etwas zu erh√∂hen - der einfachste Algorithmus ‚Äûmehr als 50% der Operationen‚Äú wird verwendet. Dies bedeutet, dass f√ºr ein Intervall von 800 ms das Ziel in mehr als der H√§lfte der Entfernungsmessungen in einer Entfernung von weniger als 1 Meter erfasst werden muss. Beim Debuggen zeigte das System, dass normalerweise 50-60 Operationen erhalten werden, wenn sich das Ziel im Sichtfeld des Sensors befindet.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das menschliche Erkennungssystem funktioniert nur, wenn das Ziel im Sichtfeld erscheint. Um die Show erneut zu starten, m√ºssen Sie einen Schritt zur√ºcktreten und erneut gehen. Dies geschieht, um die Situation zu beseitigen, dass beim Stehen vor der Uhr st√§ndig externe Parameter angezeigt werden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Lasersensor VL53L0X verwendet eine IR-Laserdiode, die bei einer Wellenl√§nge von 940 nm emittiert und f√ºr die Augen sicher ist. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Video zeigt die Reaktion des Systems auf das Auftreten eines Hindernisses im Sichtfeld des Lasersuchger√§ts:</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/He5ZtJGpG68" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der urspr√ºngliche Plan zum Ausl√∂sen der Anzeige externer Daten war die Verwendung eines Spracherkennungs-Chips. Zu diesem Zweck habe ich den WTK6900B02-Chip (Sprachbefehlserkennung) verwendet, der freundlicherweise von Sound Technologies zur Verf√ºgung gestellt wurde. Gem√§√ü der Beschreibung sollte die Mikroschaltung ein Dutzend Audiobefehle erkennen und einen Bin√§rcode ausgeben, der dem empfangenen Befehl entspricht. Ein Impuls von der Mikroschaltung wurde an einen der Ausg√§nge des ESP8266 angeschlossen und ein Hardware-Interrupt-Handler wurde daran angeschlossen. Durch Hardwareunterbrechung wird die Tatsache der Erkennung eines Sprachbefehls aufgezeichnet. Auf dem Chip, den ich erhalten habe, wurde eine Reihe von Befehlen in englischer Sprache aufgezeichnet. Ich habe hart in der "richtigen Aussprache" von Befehlen trainiert, damit sie erkannt werden. Es stellte sich heraus, dass man nicht mit Oxford-Aussprache sprechen sollte, sondern mit einem chinesischen Akzent :)), ziemlich laut.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trotz des erheblichen Zeitaufwands konnte ich Sprachbefehle nicht zuverl√§ssig erkennen. Das Beste, was ich bekam, war eine zu 50% korrekte Erkennung. Daher musste ich einen anderen Mechanismus zum Ausl√∂sen der Anzeige externer Daten verwenden - den Laser-Entfernungsmesser VL53L0X. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Hauptprogramm der Uhr hinterlie√ü Spuren der Verwendung des Sprachsteuerungssystems.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Programm enth√§lt auch Teile zum Lesen von Daten von ihrem Ultraviolett-Sensor VEML6070. </font><font style="vertical-align: inherit;">Tatsache ist, dass ich das Uhrprogramm abwechselnd zu Hause und bei der Arbeit getestet habe und nur einen MAX44009-Sensor hatte. </font><font style="vertical-align: inherit;">Daher wurde bei der Arbeit der Ultraviolettsensor VEML6070 an den ESP8266 angeschlossen und ein Teil des Programms geschrieben, der bestimmt, welcher der Sensoren derzeit angeschlossen ist. </font><font style="vertical-align: inherit;">Um den Kontrastanpassungsalgorithmus zu erarbeiten, stellte sich heraus, dass dies v√∂llig ausreichend war, und ich habe in der endg√ºltigen Version des Programms nichts ge√§ndert.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Datenausgabe an die Register HV5622 </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie oben erw√§hnt, sind zur Steuerung von Gasentladungslampen Mikroschaltungen erforderlich, die eine ziemlich hohe Spannung schalten k√∂nnen. Ich entschied mich f√ºr die HV5622-Chips, die ein 32-Bit-Register mit sequentiellem Schreiben und parallelem Auslesen sind. Die Kathoden der Lampen sind jeweils mit ihrem HV5622-Anschluss verbunden. Um eine bestimmte Ziffer zu z√ºnden, muss 0 ausgegeben werden. An die ersten beiden HV5622 sind die Kathoden von sechs GRI angeschlossen, an die dritte HV5622 sind die Punkttrennzeichen von Stunden-Minuten und Minuten-Sekunden und die Kathoden der siebten Lampe mit Sonderzeichen. Um die erforderlichen Ziffern in den Lampen zu aktivieren, muss im Register eine 32-Bit-Nummer angezeigt werden, in der Protokoll 1 (die Daten im HV5622 sind invertiert) den erforderlichen Kathoden der Lampen entspricht. Das Programm verf√ºgt √ºber Arrays mit 32-Bit-Variablen der Dimension 10.Jedes Element eines solchen Arrays enth√§lt eine Bin√§rzahl mit log 1 an einer der Positionen, deren Ausgabe an das Register zur Z√ºndung der gew√ºnschten Ziffer f√ºhrt. Da jede Mikroschaltung mehrere GDIs steuert, ist es f√ºr die Ausgabe erforderlich, eine 32-Bit-Variable aus mehreren Elementen zu bilden, die haupts√§chlich aus logischer 0 bestehen, wobei log 1 den erforderlichen Ziffern in jeder Lampe entspricht.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist erw√§hnenswert, dass die Entscheidung, Arrays zur Steuerung der GRI-Kathoden zu verwenden, einen schwerwiegenden Vorteil hat: Wenn beim L√∂ten von Dr√§hten von den GRI-Buchsen zu den HV5622-Buchsen ein Fehler aufgetreten ist und die Schlussfolgerungen der GRI gemischt wurden, √§ndern Sie zum Fixieren einfach die Konstante im Programm, ohne etwas zu l√∂ten. Die gro√üe Anzahl und die enge Anordnung der HV5622-Kabel erschweren das L√∂ten zweier benachbarter Dr√§hte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um alle drei Register zu vervollst√§ndigen, m√ºssen 3 32-Bit-Variablen (insgesamt 96 Bit) ausgegeben werden. Es ist unvern√ºnftig, dies mit einem ‚ÄûHebel‚Äú zu tun - zu lang, zeitaufw√§ndig.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gl√ºcklicherweise enth√§lt der ESP8266 einen Hardwaremechanismus (HSPI) f√ºr die serielle Kommunikation, und das SDK verf√ºgt √ºber Zugriffsfunktionen auf diesen Mechanismus. Mit dem Start dieses Mechanismus musste ich leiden. Die Schwierigkeit bestand darin, dass nicht klar war, wo 32-Bit-Variablen f√ºr die Ausgabe im HSPI-Modus abgelegt werden sollten. Um den HSPI-Mechanismus zu verstehen, habe ich einen Logikanalysator verwendet. Nach einer Reihe von Experimenten wurde mir klar, dass 96 Bit ausgegeben werden. Dies ist jedoch die gew√ºnschte 32-Bit-Nummer am Anfang und zwei 32-Bit-Nummern, die beliebigen M√ºll enthalten. Die Suche im Internet ergab nichts, aber zu welchem ‚Äã‚ÄãZeitpunkt wurde mir klar, dass es eine Anweisung wie WRITE_PERI_REG (SPI_W0 (HSPI), d0) gibt. dann k√∂nnen Sie versuchen, WRITE_PERI_REG (SPI_W1 (HSPI), d1) zu schreiben; und weiter WRITE_PERI_REG (SPI_W2 (HSPI), d2); Dabei sind d0, d1, d2 32-Bit-Variablen.</font></font> Das hei√üt,<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie m√ºssen zuerst die Daten in die Register SPI_W0 - SPI_W2 zerlegen und dann einen Befehl zum Starten des Austauschs ausgeben. </font><font style="vertical-align: inherit;">Ich stelle auch fest, dass das HSPI-Modul bis zu 512 Bit ausgeben kann und es nur 16 solcher Register gibt: W0 - W15. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das LE-Signal, mit dem Daten an das Ausgangsregister HV5622 √ºbertragen werden, wird programmgesteuert erzeugt.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> System-Debugging </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich habe es nicht gewagt, das System sofort mit einer vollwertigen Hochspannung (230 Volt) zu debuggen und aus einem Dutzend LEDs eine Debug-Anzeige mit einer Betriebsspannung von 5 Volt zu machen. </font><font style="vertical-align: inherit;">Als ich nach dem Debuggen sicher war, dass die richtigen LEDs richtig aufleuchteten, wurden die GRI in den Panels montiert und eine hohe angewendet. </font><font style="vertical-align: inherit;">Infolge einer solchen Debugging-Sequenz wurde kein einzelner Chip oder eine einzelne Anzeigelampe besch√§digt :). </font><font style="vertical-align: inherit;">Ein Foto des zum Debuggen verwendeten Knotens ist in Abbildung 9 dargestellt. </font></font><br><br><img src="https://habrastorage.org/webt/7r/k9/8v/7rk98vqof6l_pkxyrkgqkvrjkja.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung 9. Foto der Debug-LED-Baugruppe. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein kurzer Video-Debugging-Prozess hier</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/QJY9gOSSuRQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  Geh√§use </h3><br>  Die urspr√ºngliche Idee war, ein brutales Geh√§use aus dickem Metall wie Kupfer, Messing oder Bronze herzustellen.  Da f√ºr die Wi-Fi-Verbindung jedoch ein dielektrisches Geh√§use erforderlich ist, bleibt in der endg√ºltigen Version nur die Frontplatte aus dickem Metall √ºbrig.  Eine fl√ºchtige Suche im Internet nach Unternehmen, die ma√ügeschneiderte Geh√§use herstellen, ergab einen Wert von rund 5000 r pro Geh√§use.  Meiner Meinung nach ist dies unter den gegenw√§rtigen Umst√§nden ein unangemessener Betrag.  Also nahm ich das fertige Geb√§ude (Gainta G2119C), kaufte es auf dem Weg zum Cottage im Shcherbinsky Chip-i-Deep-Laden und entschied mich daf√ºr und lie√ü die Frage nach der Frontplatte und m√∂glicherweise einem anderen Geb√§ude f√ºr sp√§ter. <br><br>  Trotz des Fehlers im Teil des Uhrengeh√§uses habe ich beschlossen, die erzielten Ergebnisse in dem Artikel anzugeben, da ich der Ansicht war, dass die entwickelten und angewendeten Schaltungs- und Softwarel√∂sungen f√ºr die √ñffentlichkeit von Interesse sein w√ºrden. <br><br>  Das heutige Erscheinungsbild des Falles ist in Abb. 10 dargestellt. <br><br><img src="https://habrastorage.org/webt/ze/bn/4v/zebn4v6lvphsgy-eovfqp6kdi9a.jpeg"><br><br><img src="https://habrastorage.org/webt/rx/jo/gh/rxjoghkpz0xhrl5_j2fvlj0losm.jpeg"><br>  <i>Abbildung 10. Aussehen des Uhrengeh√§uses</i> <br><br><h3>  Fazit </h3><br>  Die Uhr arbeitet seit mehr als einem Jahr, es gab keine Fehler, die Aufgaben wurden erledigt.  Ich werde noch einmal die Unterscheidungsmerkmale meiner Uhrenvariante auflisten: <br><br><ul><li>  Statischer Anzeigemodus bei gleichzeitiger Auswirkung eines reibungslosen Zahlenwechsels </li><li>  Verwenden von HV5622-Chips zur Steuerung von GRI </li><li>  HV5622-Daten werden mit der HSPI-Hardware-Engine geschrieben </li><li>  Die genaue Zeit wird von den genauen Zeitservern aus dem Internet √ºbernommen. </li><li>  Der Zugriff auf die Uhr ist √ºber das interne Netzwerk namentlich m√∂glich </li><li>  Das Setup ist beim ersten Start einmal erforderlich. </li><li>  Das v√∂llige Fehlen von Tasten, Alarmen usw. </li><li>  Stufenlose Anpassung der Helligkeit des Gl√ºhens des GRI, um einen konstanten Bildkontrast in den gegebenen Grenzen der √Ñnderung des Umgebungslichts aufrechtzuerhalten </li><li>  Die Uhr reagiert auf die Ann√§herung einer Person und zeigt Stra√üentemperatur, Luftfeuchtigkeit und Luftdruck an. </li></ul><br>  Ich bin zufrieden :) <br><br>  ‚Üí Hier liegt das Archiv mit dem Programm </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de431868/">https://habr.com/ru/post/de431868/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de431858/index.html">Mitap Sbertekh in Rostow am Don</a></li>
<li><a href="../de431860/index.html">√úber Linux-Treiberoptionen oder wie ich das Wochenende verbracht habe</a></li>
<li><a href="../de431862/index.html">Mitap Sbertekh in Jekaterinburg</a></li>
<li><a href="../de431864/index.html">PVS-Studio ROI: Wie man nicht Millionen verliert (Entwurfsversion des Artikels)</a></li>
<li><a href="../de431866/index.html">Programmierer falsche Vorstellungen √ºber Namen - mit Beispielen</a></li>
<li><a href="../de431870/index.html">Entwickler interaktiver B√ºcher mit LEDs beschweren sich √ºber den Diebstahl von Ideen durch Google-Mitarbeiter</a></li>
<li><a href="../de431872/index.html">JavaScript-Handbuch Teil 9: √úbersicht √ºber die ES7-, ES8- und ES9-Standards</a></li>
<li><a href="../de431874/index.html">Imba: JavaScript-kompatible Sprache f√ºr die schnelle Arbeit mit DOM</a></li>
<li><a href="../de431876/index.html">Optimierung von Winkelanwendungen</a></li>
<li><a href="../de431878/index.html">Wenig bekannte JavaScript-Funktionen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>