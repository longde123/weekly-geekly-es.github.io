<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÑ üëåüèª üëêüèΩ Seperti apa bentuk arsip zip dan apa yang bisa kita lakukan dengannya. Bagian 4 - Membaca arsip ‚õ≥Ô∏è üñêüèº ü§±üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kelanjutan dari siklus tentang arsip Zip dan PHP. Artikel sebelumnya: Bagian 1 , Bagian 2 , Bagian 3 

 Selamat siang, pembaca yang budiman. 
 Kali in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Seperti apa bentuk arsip zip dan apa yang bisa kita lakukan dengannya. Bagian 4 - Membaca arsip</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485264/"> <i>Kelanjutan dari siklus tentang arsip Zip dan PHP.</i>  <i>Artikel sebelumnya: <a href="https://habr.com/ru/post/471066/">Bagian 1</a> , <a href="https://habr.com/ru/post/472966/">Bagian 2</a> , <a href="https://habr.com/ru/post/484520/">Bagian 3</a></i> <br><br>  Selamat siang, pembaca yang budiman. <br>  Kali ini saya ingin memperkenalkan, mungkin, bagian akhir dari siklus tentang arsip Zip dan PHP. <br><br>  Pada artikel ini saya akan menunjukkan cara membaca arsip yang ada dan sebagai contoh kita akan mengambil <b>foto.zip</b> dari <a href="https://habr.com/ru/post/484520/">artikel sebelumnya</a> .  Agar tidak mengulangi semua prosedur, kami akan menggunakan yang sudah jadi - <a href="">https://github.com/userqq/images/raw/master/photos.zip</a> . <br><br>  Dan sekarang mari kita menyimpang sejenak dan ingat apa yang terdiri dari arsip kita: pertama ada satu set data file yang dikemas, di mana setiap file yang dikemas diawali oleh struktur Header File Lokal (LFH), setelah semua data kita memiliki satu set struktur Header File Direktori Utama (CDFH) - Ini adalah daftar isi dalam arsip kami, yang mencantumkan semua elemen dan posisi perpindahannya relatif ke awal file.  Dan arsip Catatan Direktori Tengah (EOCD) selesai - di sini adalah posisi awal dari struktur CDFH, jumlah dan panjang total dalam byte.  Oleh karena itu, arsip harus dibaca dari akhir, pertama untuk menemukan EOCD, kemudian membaca struktur CDFH dan dengan demikian mendapatkan daftar file dalam arsip. <br><br>  <i>FYI: Dan beberapa format, seperti JPEG, dibaca dari awal.</i>  <i>Oleh karena itu, kita dapat merekatkan gambar dengan arsip, bahkan norak melalui <b>cat image.jpeg archive.zip&gt; imagearchive.jpeg</b> , tanpa kehilangan fungsionalitas.</i>  <i>Browser dan aplikasi untuk melihat gambar akan menunjukkan kepada kita gambar tanpa masalah.</i>  <i>Sementara aplikasi apa pun untuk membaca arsip zip, baik itu 7z atau unzip, akan dapat bekerja dengan tenang dengan file sebagai arsip.</i>  <i>Misalnya, di sini - <a href="">https://github.com/userqq/images/blob/master/jpegarchive.jpg</a> (Perhatian, benda ini beratnya sekitar 20mb, jadi saya tidak menyarankan membuka lalu lintas dari ponsel atau jika Anda peduli tentang lalu lintas).</i>  <i>Jadi, jika Anda tahu hosting gambar yang gambarnya tidak dikode ulang dan tidak dipotong, Anda dapat mengunggah tidak hanya gambar di sana :) Meskipun, menurut saya, sekarang Anda tidak dapat menemukannya.</i> <br><a name="habracut"></a><br>  Pertama, kita mendefinisikan fungsi pembantu yang akan memudahkan kita untuk bekerja dengan membongkar (Saya melihat ide ini pada <a href="">petunjuk</a> di salah satu repositori untuk bekerja dengan kaus kaki dan memodifikasinya sedikit untuk kasus kita): <br><br><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readBytes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($fh, $formatArray)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//          pack() // https://www.php.net/manual/ru/function.pack.php //        // , L = unsigned long 32bit = 4  static $lengths = ['L' =&gt; 4, 'l' =&gt; 4, 'i' =&gt; 4, 'I' =&gt; 4, 'S' =&gt; 2, 'a' =&gt; 1]; //     , //    fread()     . $totalLength = 0; //      ,     unpack(); $unpackFormat = []; //   ,        -,     0. // ,    ,      0,      . //       $nullData = []; foreach ($formatArray as $name =&gt; $format) { $length = 1; //      , , ['versionMadeBy' =&gt; 'S'], //       SversionMadeBy //   ['filename' =&gt; ['a', $filenameLength]] //    "a{$filenameLength}filename" if (is_array($format)) { [$format, $length] = $format; } //    ,    - //  ['extraFieldLength' =&gt; ['a', 0]] //       //      ['extraFieldLength' =&gt; null] if ($length &lt; 1) { $nullData[] = $name; continue; } $totalLength += $lengths[$format] * $length; $unpackFormat[] = $format . (($length &gt; 1) ? $length : '') . $name; } $packet = []; if ($totalLength &gt; 0) { $packet = unpack(implode('/', $unpackFormat), fread($fh, $totalLength)); } foreach ($nullData as $empty) { $packet[$empty] = null; } return $packet; }</span></span></code> </pre> <br>  Sekarang mari kita cari struktur EOCD.  Panjang minimumnya, jika tidak ada komentar, akan menjadi 22 byte, dimana 4 pertama adalah tanda tangan.  Oleh karena itu, pertama-tama kita pindah ke posisi fileize ($ file) - 22, baca 4 byte berikutnya, dan jika kita beruntung dan byte ini sama dengan tanda tangan (0x06054b50), maka ini adalah EOCD kita.  Jika Anda tidak beruntung - byte-demi-bit kami pindah ke awal file sampai kami menemukan atau menyelesaikan file - maka, mungkin, ini bukan arsip. <br><br><pre> <code class="php hljs">$fh = fopen(<span class="hljs-string"><span class="hljs-string">'photos.zip'</span></span>, <span class="hljs-string"><span class="hljs-string">'r'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($offset = <span class="hljs-number"><span class="hljs-number">22</span></span>, $length = fstat($fh)[<span class="hljs-string"><span class="hljs-string">'size'</span></span>]; $offset &lt;= $length; $offset++) { fseek($fh, $offset * <span class="hljs-number"><span class="hljs-number">-1</span></span>, SEEK_END); <span class="hljs-comment"><span class="hljs-comment">// "\x50\x4b\x05\x06" === pack('L', 0x06054b50),  EOCD if ("\x50\x4b\x05\x06" === $bytes = fread($fh, 4)) { echo 'EOCD    ' . ($length - $offset) . PHP_EOL; break; } } $EOCD = readBytes($fh, [ 'diskNumber' =&gt; 'S', 'startDiskNumber' =&gt; 'S', 'numberCentralDirectoryRecord' =&gt; 'S', 'totalCentralDirectoryRecord' =&gt; 'S', 'sizeOfCentralDirectory' =&gt; 'L', 'centralDirectoryOffset' =&gt; 'L', 'commentLength' =&gt; 'S', ]); echo '  : ' . $EOCD['numberCentralDirectoryRecord'] . PHP_EOL; echo ' CDFH: ' . $EOCD['centralDirectoryOffset'] . PHP_EOL;</span></span></code> </pre> <br>  Sekarang kita tahu berapa banyak elemen yang kita miliki di arsip dan di mana "daftar isi" dimulai - daftar struktur CDFH.  Kita dapat mengulanginya dan mendapatkan nama, ukuran data, dan posisi awal LFH untuk masing-masing elemen arsip. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'   :'</span></span> . PHP_EOL; <span class="hljs-comment"><span class="hljs-comment">//  ,       CDFH  LFH - $offset = $EOCD['centralDirectoryOffset']; for ($i = 0; $i &lt; $EOCD['numberCentralDirectoryRecord']; $i++) { fseek($fh, $offset, SEEK_SET); // "\x50\x4b\x01\x02" === pack('L', 0x02014b50),  CDFH if ("\x50\x4b\x01\x02" !== $bytes = fread($fh, 4)) { exit('  CDFH' . PHP_EOL); } //  CDFH $CDFH = readBytes($fh, [ 'versionMadeBy' =&gt; 'S', 'versionToExtract' =&gt; 'S', 'generalPurposeBitFlag' =&gt; 'S', 'compressionMethod' =&gt; 'S', 'modificationTime' =&gt; 'S', 'modificationDate' =&gt; 'S', 'crc32' =&gt; 'L', 'compressedSize' =&gt; 'L', 'uncompressedSize' =&gt; 'L', 'filenameLength' =&gt; 'S', 'extraFieldLength' =&gt; 'S', 'fileCommentLength' =&gt; 'S', 'diskNumber' =&gt; 'S', 'internalFileAttributes' =&gt; 'S', 'externalFileAttributes' =&gt; 'L', 'localFileHeaderOffset' =&gt; 'L', ]); $CDFH += readBytes($fh, [ 'filename' =&gt; ['a', $CDFH['filenameLength']], 'extraField' =&gt; ['a', $CDFH['extraFieldLength']], 'fileComment' =&gt; ['a', $CDFH['fileCommentLength']], ]); // ,       CDFH $offset = ftell($fh); //   LFH fseek($fh, $CDFH['localFileHeaderOffset'], SEEK_SET); // "\x50\x4b\x03\x04" === pack('L', 0x04034b50),  LFH if ("\x50\x4b\x03\x04" !== $bytes = fread($fh, 4)) { exit('  LFH' . PHP_EOL); } //  LFH $LFH = readBytes($fh, [ 'versionToExtract' =&gt; 'S', 'generalPurposeBitFlag' =&gt; 'S', 'compressionMethod' =&gt; 'S', 'modificationTime' =&gt; 'S', 'modificationDate' =&gt; 'S', 'crc32' =&gt; 'L', 'compressedSize' =&gt; 'L', 'uncompressedSize' =&gt; 'L', 'filenameLength' =&gt; 'S', 'extraFieldLength' =&gt; 'S', ]); $LFH += readBytes($fh, [ 'filename' =&gt; ['a', $LFH['filenameLength']], 'extraField' =&gt; ['a', $LFH['extraFieldLength']], ]); $dataOffset = ftell($fh); echo '&gt; ' . $CDFH['filename'] . ' ' . $CDFH['compressedSize'] . ' , '; echo 'LFH: ' . $CDFH['localFileHeaderOffset'] . ', '; echo ' : ' . $dataOffset . ', '; echo ' : ' . ($dataOffset + $CDFH['compressedSize']); echo PHP_EOL; } fclose($fp);</span></span></code> </pre> <br>  <i>Secara umum, menjalankan file bolak-balik untuk masing-masing catatan bukanlah ide terbaik dalam hal kinerja, jadi saya akan merekomendasikan membaca semua struktur CDFH, dan kemudian membaca LFH dan data, jika perlu, tapi di sini kita memilikinya " Pemrograman yang tidak konvensional, ‚Äùjadi kami bisa.</i> <br><br><div class="spoiler">  <b class="spoiler_title">Kode skrip lengkap</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readBytes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($fh, $formatArray)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $lengths = [<span class="hljs-string"><span class="hljs-string">'L'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'l'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'i'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'I'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'S'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'a'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>]; $totalLength = <span class="hljs-number"><span class="hljs-number">0</span></span>; $unpackFormat = []; $nullData = []; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($formatArray <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $name =&gt; $format) { $length = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_array($format)) { [$format, $length] = $format; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($length &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { $nullData[] = $name; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } $totalLength += $lengths[$format] * $length; $unpackFormat[] = $format . (($length &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) ? $length : <span class="hljs-string"><span class="hljs-string">''</span></span>) . $name; } $packet = []; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($totalLength &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { $packet = unpack(implode(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, $unpackFormat), fread($fh, $totalLength)); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($nullData <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $empty) { $packet[$empty] = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $packet; } $fh = fopen(<span class="hljs-string"><span class="hljs-string">'photos.zip'</span></span>, <span class="hljs-string"><span class="hljs-string">'r'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($offset = <span class="hljs-number"><span class="hljs-number">22</span></span>, $length = fstat($fh)[<span class="hljs-string"><span class="hljs-string">'size'</span></span>]; $offset &lt;= $length; $offset++) { fseek($fh, $offset * <span class="hljs-number"><span class="hljs-number">-1</span></span>, SEEK_END); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"\x50\x4b\x05\x06"</span></span> === $bytes = fread($fh, <span class="hljs-number"><span class="hljs-number">4</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'EOCD    '</span></span> . ($length - $offset) . PHP_EOL; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } $EOCD = readBytes($fh, [ <span class="hljs-string"><span class="hljs-string">'diskNumber'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, <span class="hljs-string"><span class="hljs-string">'startDiskNumber'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, <span class="hljs-string"><span class="hljs-string">'numberCentralDirectoryRecord'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, <span class="hljs-string"><span class="hljs-string">'totalCentralDirectoryRecord'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, <span class="hljs-string"><span class="hljs-string">'sizeOfCentralDirectory'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'L'</span></span>, <span class="hljs-string"><span class="hljs-string">'centralDirectoryOffset'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'L'</span></span>, <span class="hljs-string"><span class="hljs-string">'commentLength'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, ]); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'  : '</span></span> . $EOCD[<span class="hljs-string"><span class="hljs-string">'numberCentralDirectoryRecord'</span></span>] . PHP_EOL; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'  CDFH: '</span></span> . $EOCD[<span class="hljs-string"><span class="hljs-string">'centralDirectoryOffset'</span></span>] . PHP_EOL; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'   :'</span></span> . PHP_EOL; $offset = $EOCD[<span class="hljs-string"><span class="hljs-string">'centralDirectoryOffset'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $EOCD[<span class="hljs-string"><span class="hljs-string">'numberCentralDirectoryRecord'</span></span>]; $i++) { fseek($fh, $offset, SEEK_SET); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"\x50\x4b\x01\x02"</span></span> !== $bytes = fread($fh, <span class="hljs-number"><span class="hljs-number">4</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(<span class="hljs-string"><span class="hljs-string">'  CDFH'</span></span> . PHP_EOL); } $CDFH = readBytes($fh, [ <span class="hljs-string"><span class="hljs-string">'versionMadeBy'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, <span class="hljs-string"><span class="hljs-string">'versionToExtract'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, <span class="hljs-string"><span class="hljs-string">'generalPurposeBitFlag'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, <span class="hljs-string"><span class="hljs-string">'compressionMethod'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, <span class="hljs-string"><span class="hljs-string">'modificationTime'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, <span class="hljs-string"><span class="hljs-string">'modificationDate'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, <span class="hljs-string"><span class="hljs-string">'crc32'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'L'</span></span>, <span class="hljs-string"><span class="hljs-string">'compressedSize'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'L'</span></span>, <span class="hljs-string"><span class="hljs-string">'uncompressedSize'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'L'</span></span>, <span class="hljs-string"><span class="hljs-string">'filenameLength'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, <span class="hljs-string"><span class="hljs-string">'extraFieldLength'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, <span class="hljs-string"><span class="hljs-string">'fileCommentLength'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, <span class="hljs-string"><span class="hljs-string">'diskNumber'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, <span class="hljs-string"><span class="hljs-string">'internalFileAttributes'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, <span class="hljs-string"><span class="hljs-string">'externalFileAttributes'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'L'</span></span>, <span class="hljs-string"><span class="hljs-string">'localFileHeaderOffset'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'L'</span></span>, ]); $CDFH += readBytes($fh, [ <span class="hljs-string"><span class="hljs-string">'filename'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'a'</span></span>, $CDFH[<span class="hljs-string"><span class="hljs-string">'filenameLength'</span></span>]], <span class="hljs-string"><span class="hljs-string">'extraField'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'a'</span></span>, $CDFH[<span class="hljs-string"><span class="hljs-string">'extraFieldLength'</span></span>]], <span class="hljs-string"><span class="hljs-string">'fileComment'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'a'</span></span>, $CDFH[<span class="hljs-string"><span class="hljs-string">'fileCommentLength'</span></span>]], ]); $offset = ftell($fh); fseek($fh, $CDFH[<span class="hljs-string"><span class="hljs-string">'localFileHeaderOffset'</span></span>], SEEK_SET); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"\x50\x4b\x03\x04"</span></span> !== $bytes = fread($fh, <span class="hljs-number"><span class="hljs-number">4</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(<span class="hljs-string"><span class="hljs-string">'  LFH'</span></span> . PHP_EOL); } $LFH = readBytes($fh, [ <span class="hljs-string"><span class="hljs-string">'versionToExtract'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, <span class="hljs-string"><span class="hljs-string">'generalPurposeBitFlag'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, <span class="hljs-string"><span class="hljs-string">'compressionMethod'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, <span class="hljs-string"><span class="hljs-string">'modificationTime'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, <span class="hljs-string"><span class="hljs-string">'modificationDate'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, <span class="hljs-string"><span class="hljs-string">'crc32'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'L'</span></span>, <span class="hljs-string"><span class="hljs-string">'compressedSize'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'L'</span></span>, <span class="hljs-string"><span class="hljs-string">'uncompressedSize'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'L'</span></span>, <span class="hljs-string"><span class="hljs-string">'filenameLength'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, <span class="hljs-string"><span class="hljs-string">'extraFieldLength'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'S'</span></span>, ]); $LFH += readBytes($fh, [ <span class="hljs-string"><span class="hljs-string">'filename'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'a'</span></span>, $LFH[<span class="hljs-string"><span class="hljs-string">'filenameLength'</span></span>]], <span class="hljs-string"><span class="hljs-string">'extraField'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'a'</span></span>, $LFH[<span class="hljs-string"><span class="hljs-string">'extraFieldLength'</span></span>]], ]); $dataOffset = ftell($fh); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&gt; '</span></span> . $CDFH[<span class="hljs-string"><span class="hljs-string">'filename'</span></span>] . <span class="hljs-string"><span class="hljs-string">' '</span></span> . $CDFH[<span class="hljs-string"><span class="hljs-string">'compressedSize'</span></span>] . <span class="hljs-string"><span class="hljs-string">' , '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'LFH: '</span></span> . $CDFH[<span class="hljs-string"><span class="hljs-string">'localFileHeaderOffset'</span></span>] . <span class="hljs-string"><span class="hljs-string">', '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">' : '</span></span> . $dataOffset . <span class="hljs-string"><span class="hljs-string">', '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">' : '</span></span> . ($dataOffset + $CDFH[<span class="hljs-string"><span class="hljs-string">'compressedSize'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> PHP_EOL; } fclose($fh);</code> </pre></div></div><br>  Sebagai hasil dari skrip, kita harus mendapatkan informasi tentang arsip seperti berikut: <br><br><pre> <code class="plaintext hljs">$ php readzip.php EOCD    18873702   : 172  CDFH: 18864696    : &gt; 0.jpg 135021 , LFH: 0,  : 35,  : 135056 &gt; 1.jpg 205686 , LFH: 135056,  : 135091,  : 340777 &gt; 2.jpg 81393 , LFH: 340777,  : 340812,  : 422205 &gt; 3.jpg 64892 , LFH: 422205,  : 422240,  : 487132 ... &gt; 171.jpg 50465 , LFH: 18814194,  : 18814231,  : 18864696</code> </pre><br>  Dan, secara umum, berkat data ini, kami sudah dapat mengekstrak semua atau file tertentu. <br><br>  Kami melewati kompresi enkripsi dan hanya mempertimbangkan kasus ketika kami memiliki data dalam arsip sebagaimana adanya, tetapi ini tidak diperlukan untuk memahami struktur, dan bagi mereka yang ingin bingung, tidak akan sulit untuk membaca spesifikasi dan menambahkan fungsionalitas yang hilang berdasarkan seri artikel ini. <br><br>  Oleh karena itu, saya pikir kita dapat mempertimbangkan siklus utama selesai.  Jika Anda masih memiliki pertanyaan atau saya akan memanggil beberapa komentar di komentar untuk artikel sebelumnya, maka mungkin ada beberapa artikel tambahan. <br><br>  Untuk semuanya sim. <br><br>  Dan saya harap meskipun itu sedikit bagi Anda, itu masih menarik :) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id485264/">https://habr.com/ru/post/id485264/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id485236/index.html">File konfigurasi python</a></li>
<li><a href="../id485238/index.html">Kami menggunakan penyeleksi redux terlalu banyak</a></li>
<li><a href="../id485240/index.html">Layout go pet project di VPS</a></li>
<li><a href="../id485256/index.html">Ivan Lilekvist dan Kim Dotkom, sebuah wawancara besar: kisah Megaupload, ekstradisi ke Amerika Serikat, kebebasan, bitcoin. Bagian 1</a></li>
<li><a href="../id485260/index.html">13 Kesalahan Umum untuk Analis Bisnis Awal</a></li>
<li><a href="../id485266/index.html">Habr Contest: pemenang dari kontes ide</a></li>
<li><a href="../id485268/index.html">Jika .NET berfungsi di mana-mana, maka pada Windows 3.11 dan DOS juga</a></li>
<li><a href="../id485270/index.html">Retas admin</a></li>
<li><a href="../id485272/index.html">Komputer Taimyr - evolusi adalah sebaliknya</a></li>
<li><a href="../id485274/index.html">Moscow JS Meetup di Raiffeisenbank: tetap siaran</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>