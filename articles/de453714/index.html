<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌑 👨‍❤️‍👨 🧖🏿 TON-Testclient (Telegram Open Network) und die neue Fift-Sprache für intelligente Verträge 💆 🔵 🏤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor mehr als einem Jahr wurde bekannt, dass der Telegram Messenger plant, sein eigenes dezentrales Netzwerk Telegram Open Network freizugeben. Dann wu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>TON-Testclient (Telegram Open Network) und die neue Fift-Sprache für intelligente Verträge</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453714/"><p>  Vor mehr als einem Jahr wurde bekannt, dass der Telegram Messenger plant, sein eigenes dezentrales Netzwerk <strong>Telegram Open Network</strong> freizugeben.  Dann wurde ein umfangreiches technisches Dokument verfügbar, das vermutlich von Nikolai Durov verfasst wurde und die Struktur des zukünftigen Netzwerks beschrieb.  Für diejenigen, die es verpasst haben, empfehle ich, dass Sie meine Nacherzählung dieses Dokuments lesen ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 2</a> ; der dritte Teil verstaubt leider immer noch in Entwurfskopien). </p><br><p> Seitdem gab es keine wesentlichen Neuigkeiten über den Entwicklungsstatus von TON, bis vor ein paar Tagen (in einem der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">inoffiziellen Kanäle</a> ) ein Link zur Seite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://test.ton.org/download.html erschien</a> , wo: </p><br><p>  ◦ <a href="">ton-test-liteclient-full.tar.xz</a> - leichter Client-Quellcode für das TON-Testnetzwerk; <br>  ◦ <a href="">ton-lite-client-test1.config.json</a> - Konfigurationsdatei für die Verbindung mit einem Testnetzwerk; <br>  ◦ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">README</a> - Informationen zum Erstellen und Starten des Clients; <br>  ◦ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">HOWTO</a> - Schritt-für-Schritt-Anleitung zum Erstellen eines intelligenten Vertrags mit einem Kunden; <br>  ◦ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ton.pdf</a> - aktualisiertes Dokument (vom 2. März 2019) mit einem technischen Überblick über das TON-Netzwerk; <br>  ◦ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tvm.pdf</a> - technische Beschreibung von TVM (TON Virtual Machine, TON Virtual Machine); <br>  ◦ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tblkch.pdf</a> - technische Beschreibung der TON-Blockchain; <br>  ◦ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fiftbase.pdf</a> - eine Beschreibung der neuen Fift-Sprache, mit der intelligente Verträge in TON erstellt werden sollen. </p><br><p>  Ich wiederhole, es gab keine offizielle Bestätigung der Seite und all dieser Dokumente durch das Telegramm, aber das Volumen dieser Materialien macht sie durchaus plausibel.  Führen Sie einen veröffentlichten Client <strong>auf eigenes Risiko aus</strong> . </p><a name="habracut"></a><br><h2 id="sborka-testovogo-klienta">  Testen Sie den Client-Build </h2><br><p>  Versuchen wir zunächst, einen Testclient zu erstellen und auszuführen. Glücklicherweise beschreibt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">README</a> diesen einfachen Prozess ausführlich.  Ich werde dies am Beispiel von macOS 10.14.5 tun, ich kann nicht für den Erfolg der Montage auf anderen Systemen bürgen. </p><br><ol><li><p>  Laden Sie das <a href="">Archiv</a> herunter und entpacken Sie es <a href="">mit Quellcodes</a> .  Es ist wichtig, die neueste Version herunterzuladen, da die Abwärtskompatibilität derzeit nicht garantiert ist. </p><br></li><li><p>  Wir stellen sicher, dass die neuesten Versionen von make, cmake (Version 3.0.2 oder höher), OpenSSL (einschließlich C-Header-Dateien), g ++ oder clang auf dem System installiert sind.  Ich musste nichts neu installieren, alles wurde sofort gesammelt. </p><br></li><li><p> Angenommen, die Quellen werden in den Ordner <code>~/lite-client</code> entpackt.  Separat erstellen wir einen leeren Ordner für das zusammengestellte Projekt (z. B. <code>~/liteclient-build</code> ) und <code>cd ~/liteclient-build</code> daraus ( <code>cd ~/liteclient-build</code> ) <code>cd ~/liteclient-build</code> Befehle auf: </p><br><pre> <code class="bash hljs">cmake ~/lite-client cmake --build . --target <span class="hljs-built_in"><span class="hljs-built_in">test</span></span>-lite-client</code> </pre> <br><p><img src="https://habrastorage.org/webt/sr/lx/j8/srlxj8au48yus3uuddlpenvika0.png" alt="Erfolgreicher Kundenaufbau"><br><br>  Um den Fift-Sprachinterpreter für intelligente Verträge zu erstellen (siehe unten), rufen wir auch an </p><br><pre> <code class="plaintext hljs">cmake --build . --target fift</code> </pre> <br></li><li><p>  Laden Sie die aktuelle <a href="">Konfigurationsdatei</a> herunter, um eine Verbindung zum Testnetzwerk herzustellen, und legen Sie sie im Ordner mit dem zusammengestellten Client ab. </p><br></li><li><p>  <strong>Fertig</strong> , Sie können den Client starten: </p><br><pre> <code class="plaintext hljs">./test-lite-client -C ton-lite-client-test1.config.json</code> </pre> <br></li></ol><br><p>  Wenn alles richtig gemacht ist, sollten Sie so etwas sehen: </p><br><p><img src="https://habrastorage.org/webt/gl/gg/d3/glggd35dzg4vwogf9woibu43zrk.png" alt="Client-Start"></p><br><p>  Wie Sie sehen können, stehen nur wenige Befehle zur Verfügung: </p><br><p>  ◦ <strong><code>help</code></strong> - Zeigt diese Befehlsliste an. <br>  ◦ <strong><code>quit</code></strong> - <strong><code>quit</code></strong> ; <br>  ◦ <strong><code>time</code></strong> - Zeigt die aktuelle Zeit auf dem Server an. <br>  ◦ <strong><code>status</code></strong> - Zeigt den Status der Verbindung und der lokalen Datenbank an. <br>  ◦ <strong><code>last</code></strong> - Aktualisiert den Status der Blockchain (lädt den letzten Block).  Es ist wichtig, diesen Befehl vor allen Anforderungen auszuführen, um sicherzustellen, dass Sie genau den aktuellen Status des Netzwerks sehen. <br>  ◦ <strong><code>sendfile</code></strong> <code>&lt;filename&gt;</code> - Laden <strong><code>sendfile</code></strong> eine lokale Datei in das TON-Netzwerk <strong><code>sendfile</code></strong> .  Dies ist die Interaktion mit dem Netzwerk - einschließlich beispielsweise der Erstellung neuer intelligenter Verträge und der Anforderung, Geld zwischen Konten zu überweisen. <br>  ◦ <strong><code>getaccount</code></strong> <code>&lt;address&gt;</code> - <strong><code>getaccount</code></strong> den aktuellen <strong><code>getaccount</code></strong> (zum Zeitpunkt der Ausführung des <strong><code>last</code></strong> Befehls) mit der angegebenen Adresse an. <br>  ◦ <strong><code>privkey</code></strong> <code>&lt;filename&gt;</code> - lädt den privaten Schlüssel aus der lokalen Datei. </p><br><p>  Wenn Sie beim Client-Start den Ordner mit der Option <code>-D</code> ihn übergeben, wird der letzte Block der Master-Kette hinzugefügt: </p><br><pre> <code class="bash hljs">./<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>-lite-client -C ton-lite-client-test1.config.json -D ~/ton-db-dir</code> </pre> <br><p>  Jetzt können wir zu interessanteren Dingen übergehen - die Sprache Fift lernen, versuchen, einen intelligenten Vertrag zu erstellen (z. B. eine Testmappe erstellen), ihn in das Netzwerk hochladen und versuchen, Geld zwischen Konten zu überweisen. </p><br><h2 id="yazyk-fift">  Fünfzig Sprache </h2><br><p>  In <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fiftbase.pdf können</a> Sie herausfinden, dass das Telegrammteam zur Erstellung intelligenter Verträge eine neue Stapelsprache <strong>Fift erstellt hat</strong> (anscheinend ab der <em>fünften</em> Ziffer in Analogie zu Forth - einer Sprache, mit der Fift viel gemeinsam hat). </p><br><p>  Das Dokument ist mit 87 Seiten ziemlich umfangreich, und ich werde seinen Inhalt im Rahmen dieses Artikels nicht im Detail nacherzählen (zumindest, weil ich es selbst nicht zu Ende gelesen habe :).  Ich werde auf die Hauptpunkte eingehen und einige Codebeispiele in dieser Sprache geben. </p><br><p>  Grundsätzlich ist die Syntax von Fift recht einfach: Der Code besteht aus <em>Wörtern</em> , die normalerweise durch Leerzeichen oder Zeilenumbrüche getrennt sind (Sonderfall: Einige Wörter benötigen kein Trennzeichen nach sich selbst).  Jedes <em>Wort</em> ist eine Zeichenfolge, bei der zwischen Groß- und Kleinschreibung unterschieden wird und die einer <em>Definition entspricht</em> (grob gesagt, was der Interpreter tun muss, wenn er auf dieses Wort stößt).  Wenn das Wort nicht definiert ist, versucht der Interpreter, es als Zahl zu analysieren und auf den Stapel zu legen.  Übrigens sind die Zahlen hier - plötzlich - 257-Bit-Ganzzahlen, aber es gibt überhaupt keine Bruchzahlen - genauer gesagt, sie werden sofort zu einem Paar von Ganzzahlen, die den Zähler und Nenner eines rationalen Bruchs bilden. </p><br><p>  Wörter interagieren normalerweise mit Bedeutungen am oberen Rand des Stapels.  Ein separater Worttyp - <em>Präfix</em> - verwendet nicht den Stapel, sondern die nachfolgenden Zeichen aus der Quelldatei.  Beispielsweise werden Zeichenfolgenliterale auf diese Weise implementiert. Das Zeichen "Anführungszeichen" ( <code>"</code> ) ist ein Präfixwort, das nach dem nächsten (schließenden) Anführungszeichen sucht und die Zeichenfolge zwischen ihnen auf den Stapel legt. Einzeilig ( <code>//</code> ) und mehrzeilig ( <code>/*</code> ) verhalten sich gleich. Kommentare. </p><br><p>  Damit endet fast die gesamte interne Struktur der Sprache.  Alles andere (einschließlich Kontrollstrukturen) wird als Wörter definiert (entweder intern, wie z. B. arithmetische Operationen und die Definition neuer Wörter, oder in der "Standardbibliothek" <code>Fift.fif</code> , die sich im <code>crypto/fift</code> in der Quelle befindet). </p><br><p>  Ein einfaches Beispiel für ein Fift-Programm: </p><br><pre> <code class="plaintext hljs">{ dup =: x dup * =: y } : setxy 3 setxy x . y . xy + . 7 setxy x . y . xy + .</code> </pre> <br><p>  Die erste Zeile definiert das neue Wort <code>setxy</code> (beachten Sie das Präfix <code>{</code> , das den Block vor dem Schließen erstellt <code>}</code> und das Präfix <code>:</code> das das Wort tatsächlich definiert).  <code>setxy</code> nimmt eine Zahl vom oberen <code>setxy</code> des Stapels, definiert sie (oder definiert sie neu) als globale <em>Konstante</em> <code>x</code> und das Quadrat dieser Zahl als Konstante <code>y</code> (da die Werte der Konstanten neu definiert werden können, würde ich sie lieber Variablen nennen, aber ich folge der Benennung in der Sprache). </p><br><p>  In den nächsten beiden Zeilen wird eine Zahl auf den Stapel gelegt, <code>setxy</code> wird <code>setxy</code> , dann werden die Werte der Konstanten <code>x</code> , <code>y</code> ausgegeben (das Wort wird für die Ausgabe verwendet). Beide Konstanten werden auf den Stapel gelegt, summiert und das Ergebnis wird ebenfalls angezeigt.  Als Ergebnis werden wir sehen: </p><br><pre> <code class="plaintext hljs">3 9 12 ok 7 49 56 ok</code> </pre> <br><p>  (Der Interpreter druckt die Zeile "OK", wenn die Verarbeitung der aktuellen Zeile im interaktiven Eingabemodus abgeschlossen ist.) </p><br><p>  Nun, ein vollständiges Codebeispiel: </p><br><pre> <code class="plaintext hljs">"Asm.fif" include -1 constant wc // create a wallet in workchain -1 (masterchain) // Create new simple wallet &lt;{ SETCP0 DUP IFNOTRET INC 32 THROWIF // return if recv_internal, fail unless recv_external 512 INT LDSLICEX DUP 32 PLDU // sign cs cnt c4 PUSHCTR CTOS 32 LDU 256 LDU ENDS // sign cs cnt cnt' pubk s1 s2 XCPU // sign cs cnt pubk cnt' cnt EQUAL 33 THROWIFNOT // ( seqno mismatch? ) s2 PUSH HASHSU // sign cs cnt pubk hash s0 s4 s4 XC2PU // pubk cs cnt hash sign pubk CHKSIGNU // pubk cs cnt ? 34 THROWIFNOT // signature mismatch ACCEPT SWAP 32 LDU NIP DUP SREFS IF:&lt;{ 8 LDU LDREF // pubk cnt mode msg cs s0 s2 XCHG SENDRAWMSG // pubk cnt cs ; ( message sent ) }&gt; ENDS INC NEWC 32 STU 256 STU ENDC c4 POPCTR }&gt;c // code &lt;b 0 32 u, newkeypair swap dup constant wallet_pk "new-wallet.pk" B&gt;file B, b&gt; // data // no libraries &lt;bb{00110} s, rot ref, swap ref, b&gt; // create StateInit dup ."StateInit: " &lt;s csr. cr dup hash dup constant wallet_addr ."new wallet address = " wc . .": " dup x. cr wc over 7 smca&gt;$ type cr 256 u&gt;B "new-wallet.addr" B&gt;file &lt;b 0 32 u, b&gt; dup ."signing message: " &lt;s csr. cr dup hash wallet_pk ed25519_sign_uint rot &lt;bb{1000100} s, wc 8 i, wallet_addr 256 u, b{000010} s, swap &lt;ss, b{0} s, swap B, swap &lt;ss, b&gt; dup ."External message for initialization is " &lt;s csr. cr 2 boc+&gt;B dup Bx. cr "new-wallet-query.boc" tuck B&gt;file ."(Saved to file " type .")" cr</code> </pre> <br><p>  Diese beängstigend aussehende Datei wurde entwickelt, um einen intelligenten Vertrag zu erstellen. Sie wird nach der Ausführung in der <code>new-wallet-query.boc</code> .  Bitte beachten Sie, dass hier eine andere Assembler-Sprache für die TON Virtual Machine verwendet wird (ich werde nicht näher darauf eingehen), deren Anweisungen in die Blockchain eingefügt werden. </p><br><p>  Daher ist der Assembler für TVM in Fift geschrieben - die Quellen dieses Assemblers befinden sich in der Datei <code>crypto/fift/Asm.fif</code> und sind am Anfang des obigen Codeteils verbunden. </p><br><p>  Was soll ich sagen, anscheinend liebt Nikolai Durov es einfach, neue Programmiersprachen zu erstellen :) </p><br><h2 id="sozdanie-smart-kontrakta-i-vzaimodeystvie-s-ton">  Erstellen eines intelligenten Vertrags und Interaktion mit TON </h2><br><p>  Nehmen wir also an, wir haben einen TON-Client und einen Fift-Interpreter wie oben beschrieben zusammengestellt und uns mit der Sprache vertraut gemacht.  Wie erstelle ich jetzt einen intelligenten Vertrag?  Dies wird in der an die Quelle angehängten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">HOWTO-</a> Datei beschrieben. </p><br><h3 id="akkaunty-v-ton">  TON-Konten </h3><br><p>  Wie ich im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">TON-Test beschrieben habe</a> , enthält dieses Netzwerk mehr als eine Blockchain - es gibt eine gemeinsame, die sogenannte  "Master-Kette" sowie eine beliebige Anzahl zusätzlicher "Arbeitsketten", die durch eine 32-Bit-Nummer gekennzeichnet sind.  Die Hauptkette hat einen Bezeichner von -1. Zusätzlich kann eine „grundlegende“ Arbeitskette mit dem Bezeichner 0 verwendet werden. Jede Arbeitskette kann eine eigene Konfiguration haben.  Intern ist jede Arbeitsgruppe in Shardchains unterteilt, dies ist jedoch bereits ein Detail der Implementierung, das nicht berücksichtigt werden muss. </p><br><p>  Viele Konten werden in einer Arbeitskette gespeichert, die ihre eigenen account_id-IDs haben.  Für die Masterkette und die Nullarbeitskette haben sie eine Länge von 256 Bit.  So wird die Konto-ID beispielsweise wie folgt geschrieben: </p><br><pre> <code class="plaintext hljs">-1:8156775b79325e5d62e742d9b96c30b6515a5cd2f1f64c5da4b193c03f070e0d</code> </pre> <br><p>  Dies ist ein "rohes" Format: zuerst die Arbeitskettenkennung, dann ein Doppelpunkt und die Kontokennung in hexadezimaler Schreibweise. </p><br><p>  Darüber hinaus gibt es ein verkürztes Format: Die Arbeitskettennummer und die Kontoadresse werden in binärer Form codiert, eine Prüfsumme wird hinzugefügt und all dies wird in Base64 codiert: </p><br><pre> <code class="plaintext hljs">Ef+BVndbeTJeXWLnQtm5bDC2UVpc0vH2TF2ksZPAPwcODSkb</code> </pre> <br><p>  Wenn wir dieses Aufzeichnungsformat kennen, können wir den aktuellen Status eines Kontos über einen Testclient mit dem Befehl anfordern </p><br><pre> <code class="plaintext hljs">getaccount -1:8156775b79325e5d62e742d9b96c30b6515a5cd2f1f64c5da4b193c03f070e0d</code> </pre> <br><p>  Wir bekommen eine Antwort wie diese: </p><br><pre> <code class="plaintext hljs">[ 3][t 2][1558746708.815218925][test-lite-client.cpp:631][!testnode] requesting account state for -1:8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D [ 3][t 2][1558746708.858564138][test-lite-client.cpp:652][!testnode] got account state for -1:8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D with respect to blocks (-1,8000000000000000,72355):F566005749C1B97F18EDE013EBA7A054B9014961BC1AD91F475B9082919A2296:1BD5DE54333164025EE39D389ECE2E93DA2871DA616D488253953E52B50DC03F and (-1,8000000000000000,72355):F566005749C1B97F18EDE013EBA7A054B9014961BC1AD91F475B9082919A2296:1BD5DE54333164025EE39D389ECE2E93DA2871DA616D488253953E52B50DC03F account state is (account addr:(addr_std anycast:nothing workchain_id:-1 address:x8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D) storage_stat:(storage_info used:(storage_used cells:(var_uint len:1 value:3) bits:(var_uint len:2 value:539) public_cells:(var_uint len:0 value:0)) last_paid:0 due_payment:nothing) storage:(account_storage last_trans_lt:74208000003 balance:(currencies grams:(nanograms amount:(var_uint len:7 value:999928362430000)) other:(extra_currencies dict:hme_empty)) state:(account_active ( split_depth:nothing special:nothing code:(just value:(raw@^Cell x{} x{FF0020DDA4F260D31F01ED44D0D31FD166BAF2A1F80001D307D4D1821804A817C80073FB0201FB00A4C8CB1FC9ED54} )) data:(just value:(raw@^Cell x{} x{0000000D} )) library:hme_empty)))) x{CFF8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D2068086C000000000000000451C90E00DC0E35B7DB5FB8C134_} x{FF0020DDA4F260D31F01ED44D0D31FD166BAF2A1F80001D307D4D1821804A817C80073FB0201FB00A4C8CB1FC9ED54} x{0000000D}</code> -client.cpp: <code class="plaintext hljs">[ 3][t 2][1558746708.815218925][test-lite-client.cpp:631][!testnode] requesting account state for -1:8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D [ 3][t 2][1558746708.858564138][test-lite-client.cpp:652][!testnode] got account state for -1:8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D with respect to blocks (-1,8000000000000000,72355):F566005749C1B97F18EDE013EBA7A054B9014961BC1AD91F475B9082919A2296:1BD5DE54333164025EE39D389ECE2E93DA2871DA616D488253953E52B50DC03F and (-1,8000000000000000,72355):F566005749C1B97F18EDE013EBA7A054B9014961BC1AD91F475B9082919A2296:1BD5DE54333164025EE39D389ECE2E93DA2871DA616D488253953E52B50DC03F account state is (account addr:(addr_std anycast:nothing workchain_id:-1 address:x8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D) storage_stat:(storage_info used:(storage_used cells:(var_uint len:1 value:3) bits:(var_uint len:2 value:539) public_cells:(var_uint len:0 value:0)) last_paid:0 due_payment:nothing) storage:(account_storage last_trans_lt:74208000003 balance:(currencies grams:(nanograms amount:(var_uint len:7 value:999928362430000)) other:(extra_currencies dict:hme_empty)) state:(account_active ( split_depth:nothing special:nothing code:(just value:(raw@^Cell x{} x{FF0020DDA4F260D31F01ED44D0D31FD166BAF2A1F80001D307D4D1821804A817C80073FB0201FB00A4C8CB1FC9ED54} )) data:(just value:(raw@^Cell x{} x{0000000D} )) library:hme_empty)))) x{CFF8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D2068086C000000000000000451C90E00DC0E35B7DB5FB8C134_} x{FF0020DDA4F260D31F01ED44D0D31FD166BAF2A1F80001D307D4D1821804A817C80073FB0201FB00A4C8CB1FC9ED54} x{0000000D}</code> für -1: 8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D mit Bezug auf die Blöcke (-1,8000000000000000,72355): F566005749C1B97F18EDE013EBA7A054B9014961BC1AD91F475B9082919A2296: 1BD5DE54333164025EE39D389ECE2E93DA2871DA616D488253953E52B50DC03F und <code class="plaintext hljs">[ 3][t 2][1558746708.815218925][test-lite-client.cpp:631][!testnode] requesting account state for -1:8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D [ 3][t 2][1558746708.858564138][test-lite-client.cpp:652][!testnode] got account state for -1:8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D with respect to blocks (-1,8000000000000000,72355):F566005749C1B97F18EDE013EBA7A054B9014961BC1AD91F475B9082919A2296:1BD5DE54333164025EE39D389ECE2E93DA2871DA616D488253953E52B50DC03F and (-1,8000000000000000,72355):F566005749C1B97F18EDE013EBA7A054B9014961BC1AD91F475B9082919A2296:1BD5DE54333164025EE39D389ECE2E93DA2871DA616D488253953E52B50DC03F account state is (account addr:(addr_std anycast:nothing workchain_id:-1 address:x8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D) storage_stat:(storage_info used:(storage_used cells:(var_uint len:1 value:3) bits:(var_uint len:2 value:539) public_cells:(var_uint len:0 value:0)) last_paid:0 due_payment:nothing) storage:(account_storage last_trans_lt:74208000003 balance:(currencies grams:(nanograms amount:(var_uint len:7 value:999928362430000)) other:(extra_currencies dict:hme_empty)) state:(account_active ( split_depth:nothing special:nothing code:(just value:(raw@^Cell x{} x{FF0020DDA4F260D31F01ED44D0D31FD166BAF2A1F80001D307D4D1821804A817C80073FB0201FB00A4C8CB1FC9ED54} )) data:(just value:(raw@^Cell x{} x{0000000D} )) library:hme_empty)))) x{CFF8156775B79325E5D62E742D9B96C30B6515A5CD2F1F64C5DA4B193C03F070E0D2068086C000000000000000451C90E00DC0E35B7DB5FB8C134_} x{FF0020DDA4F260D31F01ED44D0D31FD166BAF2A1F80001D307D4D1821804A817C80073FB0201FB00A4C8CB1FC9ED54} x{0000000D}</code> </pre> <br><p>  Wir sehen die Struktur, die im DHT der angegebenen Arbeitskette gespeichert ist.  Im Feld <code>storage.balance</code> befindet sich beispielsweise der aktuelle Kontostand, in <code>storage.state.code</code> der intelligente Vertragscode und in <code>storage.state.data</code> die aktuellen Daten.  Beachten Sie, dass der TON-Datenspeicher - Zelle, Zellen - ein Baum ist. Jede Zelle kann ihre eigenen Daten sowie untergeordnete Zellen haben.  Dies wird in den letzten Zeilen als Einrückung angezeigt. </p><br><h3 id="sborka-smart-kontrakta">  Intelligente Vertragsmontage </h3><br><p>  Lassen Sie uns nun selbst eine solche Struktur (sie heißt BOC - <em>Bag of Cells</em> ) mit der Sprache Fift erstellen.  Glücklicherweise müssen Sie keinen intelligenten Vertrag selbst schreiben. Im Ordner <code>new-wallet.fif</code> <code>crypto/block</code> aus dem <code>new-wallet.fif</code> befindet sich eine Datei <code>new-wallet.fif</code> , mit der wir eine neue Brieftasche erstellen können.  Kopieren Sie es mit dem zusammengestellten Client in den Ordner ( <code>~/liteclient-build</code> , wenn Sie <code>~/liteclient-build</code> obigen Anweisungen <code>~/liteclient-build</code> ).  Ich habe den Inhalt oben als Beispiel für Code auf Fift zitiert. </p><br><p>  Wir führen diese Datei wie folgt aus: </p><br><pre> <code class="plaintext hljs">./crypto/fift -I"&lt;source-directory&gt;/crypto/fift" new-wallet.fif</code> </pre> <br><p>  Hier muss <code>&lt;source-directory&gt;</code> durch den Pfad zu den entpackten Quellen ersetzt werden (das Symbol "~" kann hier leider nicht verwendet werden, Sie benötigen leider den vollständigen Pfad).  Anstatt den <code>-I</code> Sie die Umgebungsvariable <code>FIFTPATH</code> und diesen Pfad <code>FIFTPATH</code> . </p><br><p>  Da wir Fift mit dem Dateinamen <code>new-wallet.fif</code> , wird es ausgeführt und abgeschlossen.  Wenn Sie den Dateinamen weglassen, können Sie im interaktiven Modus mit dem Interpreter spielen. </p><br><p>  Nach der Ausführung sollte in der Konsole Folgendes angezeigt werden: </p><br><pre> <code class="plaintext hljs">StateInit: x{34_} x{FF0020DDA4F260810200D71820D70B1FED44D0D31FD3FFD15112BAF2A122F901541044F910F2A2F80001D31F3120D74A96D307D402FB00DED1A4C8CB1FCBFFC9ED54} x{0000000055375F730EDC2292E8CB15C42E8036EE9C25AA958EE002D2DE48A205E3A3426B} new wallet address = -1 : 4fcd520b8fcca096b567d734be3528edc6bed005f6930a9ec9ac1aa714f211f2 0f9PzVILj8yglrVn1zS-NSjtxr7QBfaTCp7JrBqnFPIR8nhZ signing message: x{00000000} External message for initialization is x{89FEE120E20C7E953E31546F64C23CD654002C1AA919ADD24DB12DDF85C6F3B58AE41198A28AD8DAF3B9588E7A629252BA3DB88F030D00BC1016110B2073359EAC3C13823C53245B65D056F2C070B940CDA09789585935C7ABA4D2AD4BED139281CFA1200000001_} x{FF0020DDA4F260810200D71820D70B1FED44D0D31FD3FFD15112BAF2A122F901541044F910F2A2F80001D31F3120D74A96D307D402FB00DED1A4C8CB1FCBFFC9ED54} x{0000000055375F730EDC2292E8CB15C42E8036EE9C25AA958EE002D2DE48A205E3A3426B} B5EE9C724104030100000000D60002CF89FEE120E20C7E953E31546F64C23CD654002C1AA919ADD24DB12DDF85C6F3B58AE41198A28AD8DAF3B9588E7A629252BA3DB88F030D00BC1016110B2073359EAC3C13823C53245B65D056F2C070B940CDA09789585935C7ABA4D2AD4BED139281CFA1200000001001020084FF0020DDA4F260810200D71820D70B1FED44D0D31FD3FFD15112BAF2A122F901541044F910F2A2F80001D31F3120D74A96D307D402FB00DED1A4C8CB1FCBFFC9ED5400480000000055375F730EDC2292E8CB15C42E8036EE9C25AA958EE002D2DE48A205E3A3426B6290698B (Saved to file new-wallet-query.boc)</code> die <code class="plaintext hljs">StateInit: x{34_} x{FF0020DDA4F260810200D71820D70B1FED44D0D31FD3FFD15112BAF2A122F901541044F910F2A2F80001D31F3120D74A96D307D402FB00DED1A4C8CB1FCBFFC9ED54} x{0000000055375F730EDC2292E8CB15C42E8036EE9C25AA958EE002D2DE48A205E3A3426B} new wallet address = -1 : 4fcd520b8fcca096b567d734be3528edc6bed005f6930a9ec9ac1aa714f211f2 0f9PzVILj8yglrVn1zS-NSjtxr7QBfaTCp7JrBqnFPIR8nhZ signing message: x{00000000} External message for initialization is x{89FEE120E20C7E953E31546F64C23CD654002C1AA919ADD24DB12DDF85C6F3B58AE41198A28AD8DAF3B9588E7A629252BA3DB88F030D00BC1016110B2073359EAC3C13823C53245B65D056F2C070B940CDA09789585935C7ABA4D2AD4BED139281CFA1200000001_} x{FF0020DDA4F260810200D71820D70B1FED44D0D31FD3FFD15112BAF2A122F901541044F910F2A2F80001D31F3120D74A96D307D402FB00DED1A4C8CB1FCBFFC9ED54} x{0000000055375F730EDC2292E8CB15C42E8036EE9C25AA958EE002D2DE48A205E3A3426B} B5EE9C724104030100000000D60002CF89FEE120E20C7E953E31546F64C23CD654002C1AA919ADD24DB12DDF85C6F3B58AE41198A28AD8DAF3B9588E7A629252BA3DB88F030D00BC1016110B2073359EAC3C13823C53245B65D056F2C070B940CDA09789585935C7ABA4D2AD4BED139281CFA1200000001001020084FF0020DDA4F260810200D71820D70B1FED44D0D31FD3FFD15112BAF2A122F901541044F910F2A2F80001D31F3120D74A96D307D402FB00DED1A4C8CB1FCBFFC9ED5400480000000055375F730EDC2292E8CB15C42E8036EE9C25AA958EE002D2DE48A205E3A3426B6290698B (Saved to file new-wallet-query.boc)</code> } <code class="plaintext hljs">StateInit: x{34_} x{FF0020DDA4F260810200D71820D70B1FED44D0D31FD3FFD15112BAF2A122F901541044F910F2A2F80001D31F3120D74A96D307D402FB00DED1A4C8CB1FCBFFC9ED54} x{0000000055375F730EDC2292E8CB15C42E8036EE9C25AA958EE002D2DE48A205E3A3426B} new wallet address = -1 : 4fcd520b8fcca096b567d734be3528edc6bed005f6930a9ec9ac1aa714f211f2 0f9PzVILj8yglrVn1zS-NSjtxr7QBfaTCp7JrBqnFPIR8nhZ signing message: x{00000000} External message for initialization is x{89FEE120E20C7E953E31546F64C23CD654002C1AA919ADD24DB12DDF85C6F3B58AE41198A28AD8DAF3B9588E7A629252BA3DB88F030D00BC1016110B2073359EAC3C13823C53245B65D056F2C070B940CDA09789585935C7ABA4D2AD4BED139281CFA1200000001_} x{FF0020DDA4F260810200D71820D70B1FED44D0D31FD3FFD15112BAF2A122F901541044F910F2A2F80001D31F3120D74A96D307D402FB00DED1A4C8CB1FCBFFC9ED54} x{0000000055375F730EDC2292E8CB15C42E8036EE9C25AA958EE002D2DE48A205E3A3426B} B5EE9C724104030100000000D60002CF89FEE120E20C7E953E31546F64C23CD654002C1AA919ADD24DB12DDF85C6F3B58AE41198A28AD8DAF3B9588E7A629252BA3DB88F030D00BC1016110B2073359EAC3C13823C53245B65D056F2C070B940CDA09789585935C7ABA4D2AD4BED139281CFA1200000001001020084FF0020DDA4F260810200D71820D70B1FED44D0D31FD3FFD15112BAF2A122F901541044F910F2A2F80001D31F3120D74A96D307D402FB00DED1A4C8CB1FCBFFC9ED5400480000000055375F730EDC2292E8CB15C42E8036EE9C25AA958EE002D2DE48A205E3A3426B6290698B (Saved to file new-wallet-query.boc)</code> </pre> <br><p>  Dies bedeutet, dass die Brieftasche mit der Kennung <code>-1:4fcd520b8fcca096b567d734be3528edc6bed005f6930a9ec9ac1aa714f211f2</code> (oder, was dasselbe ist, <code>0f9PzVILj8yglrVn1zS-NSjtxr7QBfaTCp7JrBqnFPIR8nhZ</code> erstellt wurde.  Der entsprechende Code wird in der <code>new-wallet-query.boc</code> <code>new-wallet.addr</code> <code>new-wallet-query.boc</code> , die Adresse in <code>new-wallet.addr</code> und der private Schlüssel in <code>new-wallet.pk</code> (Vorsicht - beim Neustart des Skripts werden diese Dateien überschrieben). </p><br><p>  Natürlich kennt das TON-Netzwerk diese Brieftasche noch nicht, sie wird nur in Form dieser Dateien gespeichert.  Jetzt müssen Sie es in das Netzwerk hochladen.  Das Problem ist jedoch, dass Sie zum Erstellen eines intelligenten Vertrags eine Provision zahlen müssen und der Kontostand immer noch Null beträgt. </p><br><p>  Im Arbeitsmodus wird dieses Problem durch den Kauf von Gramm an der Börse (oder durch das Übertragen von einer anderen Brieftasche) gelöst.  Nun, im aktuellen Testmodus wurde ein spezieller Smart-Vertrag gestartet, bei dem Sie einfach so bis zu 20 Gramm verlangen können. </p><br><h3 id="formirovanie-zaprosa-k-chuzhomu-smart-kontraktu">  Bildung einer Anfrage an den Smart Contract eines anderen </h3><br><p>  Fordern Sie dazu einen intelligenten Vertrag an und verteilen Sie die Grammatik nach links und rechts.  Im selben <code>crypto/block</code> Ordner befindet sich die Datei <code>testgiver.fif</code> : </p><br><pre> <code class="plaintext hljs">// "testgiver.addr" file&gt;B 256 B&gt;u@ 0x8156775b79325e5d62e742d9b96c30b6515a5cd2f1f64c5da4b193c03f070e0d dup constant wallet_addr ."Test giver address = " x. cr 0x4fcd520b8fcca096b567d734be3528edc6bed005f6930a9ec9ac1aa714f211f2 constant dest_addr -1 constant wc 0x00000011 constant seqno 1000000000 constant Gram { Gram swap */ } : Gram*/ 6.666 Gram*/ constant amount // bx --&gt; b' ( serializes a Gram amount ) { -1 { 1+ 2dup 8 * ufits } until rot over 4 u, -rot 8 * u, } : Gram, // create a message (NB: 01b00.., b = bounce) &lt;bb{010000100} s, wc 8 i, dest_addr 256 u, amount Gram, 0 9 64 32 + + 1+ 1+ u, "GIFT" $, b&gt; &lt;b seqno 32 u, 1 8 u, swap ref, b&gt; dup ."enveloping message: " &lt;s csr. cr &lt;bb{1000100} s, wc 8 i, wallet_addr 256 u, 0 Gram, b{00} s, swap &lt;ss, b&gt; dup ."resulting external message: " &lt;s csr. cr 2 boc+&gt;B dup Bx. cr "wallet-query.boc" B&gt;file</code> </pre> <br><p>  Wir speichern es auch im Ordner mit dem zusammengestellten Client, <code>constant dest_addr</code> aber die fünfte Zeile - vor der Zeile " <code>constant dest_addr</code> ".  Ersetzen Sie es durch die Adresse der Brieftasche, die Sie zuvor erstellt haben (vollständig, nicht abgekürzt).  "-1:" Sie müssen nicht am Anfang schreiben, sondern "0x" am Anfang setzen. </p><br><p>  Sie können auch die Zeile <code>6.666 Gram*/ constant amount</code> ändern - dies ist die Menge in Gramm, die Sie anfordern (nicht mehr als 20).  Lassen Sie den Dezimalpunkt, auch wenn Sie eine Ganzzahl angeben. </p><br><p>  Schließlich müssen Sie die Zeile <code>0x00000011 constant seqno</code> .  Die erste Nummer hier ist die aktuelle Sequenznummer, die auf dem Konto gespeichert ist, auf dem die Gramm ausgegeben werden.  Woher bekommt man es?  Starten Sie wie oben erwähnt den Client und führen Sie Folgendes aus: </p><br><pre> <code class="plaintext hljs">last getaccount -1:8156775b79325e5d62e742d9b96c30b6515a5cd2f1f64c5da4b193c03f070e0d</code> </pre> <br><p>  Ganz am Ende stehen die Daten des Smart Contract </p><br><pre> <code class="plaintext hljs">... x{FF0020DDA4F260D31F01ED44D0D31FD166BAF2A1F80001D307D4D1821804A817C80073FB0201FB00A4C8CB1FC9ED54} x{0000000D}</code> </pre> <br><p>  Die Nummer 0000000D (Sie werden mehr haben) ist die Sequenznummer, die in <code>testgiver.fif</code> . </p><br><p>  Das war's, speichern Sie die Datei und führen Sie sie aus ( <code>./crypto/fift testgiver.fif</code> ).  Die Ausgabe ist die <code>wallet-query.boc</code> .  Dies ist die gebildete <em>Nachricht</em> an den intelligenten Vertrag eines anderen - die Anfrage lautet "Übertragen Sie so viele Gramm auf das eine oder andere Konto". </p><br><p>  Mit dem Client laden wir es in das Netzwerk hoch: </p><br><pre> <code class="plaintext hljs">&gt; sendfile wallet-query.boc [ 1][t 1][1558747399.456575155][test-lite-client.cpp:577][!testnode] sending query from file wallet-query.boc [ 3][t 2][1558747399.500236034][test-lite-client.cpp:587][!query] external message status is 1</code> </pre> <br><p>  Wenn wir jetzt <code>last</code> anrufen und dann erneut den Status des Kontos anfordern, von dem wir nach Gramm gefragt haben, sollten wir feststellen, dass sich die Sequenznummer um eins erhöht hat - dies bedeutet, dass Geld auf unser Konto gesendet wurde. </p><br><p>  Der letzte Schritt bleibt: Wir laden den Code unserer Brieftasche (der Kontostand wurde bereits aufgefüllt, aber ohne den intelligenten Vertragscode können wir ihn nicht verwalten).  <code>sendfile new-wallet-query.boc</code> - und das war's, Sie haben Ihre eigene Brieftasche im TON-Netzwerk (wenn auch <code>sendfile new-wallet-query.boc</code> nur eine Test-Brieftasche). </p><br><h3 id="sozdanie-ishodyaschih-tranzakciy">  Erstellen Sie ausgehende Transaktionen </h3><br><p>  Um Geld vom Kontostand des erstellten Kontos zu überweisen, gibt es eine <code>crypto/block/wallet.fif</code> , die ebenfalls im Ordner des gesammelten Clients abgelegt werden muss. </p><br><p>  Ähnlich wie in den vorherigen Schritten müssen Sie den von Ihnen überwiesenen Betrag, die Adresse des Empfängers (dest_addr) und die Nummer Ihrer Brieftasche anpassen (nach der Initialisierung der Brieftasche beträgt sie 1 und erhöht sich nach jeder ausgehenden Transaktion um 1 - Sie können sie anzeigen, indem Sie den Status Ihres Kontos anfordern). .  Für Tests können Sie beispielsweise meine Brieftasche verwenden - <code>0x4fcd520b8fcca096b567d734be3528edc6bed005f6930a9ec9ac1aa714f211f2</code> . </p><br><p>  Wenn Sie ( <code>./crypto/fift wallet.fif</code> ) <code>./crypto/fift wallet.fif</code> das Skript die Adresse Ihrer Brieftasche (von der Sie sie übertragen) und ihren privaten Schlüssel aus den Dateien <code>new-wallet.addr</code> und <code>new-wallet.pk</code> und schreibt die empfangene Nachricht in <code>new-wallet-query.boc</code> . </p><br><p>  <code>sendfile new-wallet-query.boc</code> die Transaktion direkt auszuführen, rufen wir nach wie vor <code>sendfile new-wallet-query.boc</code> im Client auf.  Vergessen Sie danach nicht, den Status der Blockchain ( <code>last</code> ) zu aktualisieren und zu überprüfen, ob sich das Guthaben und die Sequenz unserer Brieftasche geändert haben ( <code>getaccount &lt;account_id&gt;</code> ). </p><br><p><img src="https://habrastorage.org/webt/fp/d1/is/fpd1is8dlh4_iz9rdbakflyeq5s.png" alt="Kontobeschreibung"></p><br><p>  Das ist alles, jetzt können wir intelligente Verträge in TON erstellen und Anfragen an diese senden.  Wie Sie sehen, reicht die aktuelle Funktionalität bereits aus, um beispielsweise eine benutzerfreundlichere Brieftasche mit grafischer Oberfläche zu erstellen (es wird jedoch erwartet, dass sie als Teil des Messenger verfügbar sein wird). </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de453714/">https://habr.com/ru/post/de453714/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de453700/index.html">Lektionen zu SDL 2: Lektion 1 - Hallo, SDL 2</a></li>
<li><a href="../de453706/index.html">Wie ich die Zertifizierungsprüfung für Google Cloud Professional Data Engineer bestanden habe</a></li>
<li><a href="../de453708/index.html">AQUA RTOS Echtzeit-Betriebssystem für MK AVR in der BASCOM AVR-Umgebung</a></li>
<li><a href="../de453710/index.html">Entwicklungspraxis in großen Projekten: mitp SberPractice iOS # 1</a></li>
<li><a href="../de453712/index.html">Wie eBay einen Barcode-Scanner in WebAssembly erstellt hat</a></li>
<li><a href="../de453716/index.html">Country Coworking für Familien-IT-Mitarbeiter - gibt es jemanden?</a></li>
<li><a href="../de453720/index.html">Feinheiten von Lambda-Ausdrücken in C #</a></li>
<li><a href="../de453722/index.html">Über die Erforschung instationärer Prozesse</a></li>
<li><a href="../de453728/index.html">Schlacht der Hyperstars</a></li>
<li><a href="../de453730/index.html">Moderne Zahnmedizin: gleichzeitige Zahnimplantation und Streckung des Kieferknochens durch die Augen des technischen Direktors</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>