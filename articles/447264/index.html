<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëçüèª üå† üë©üèæ‚Äçü§ù‚Äçüë®üèΩ Encender la cuadr√≠cula de servicio: reiniciar üôÅ üßû ü§πüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El 26 de febrero, realizamos el mitap Apache Ignite GreenSource, donde se presentaron los colaboradores del proyecto de c√≥digo abierto Apache Ignite ....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Encender la cuadr√≠cula de servicio: reiniciar</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sberbank/blog/447264/">  El 26 de febrero, realizamos el mitap Apache Ignite GreenSource, donde se presentaron los colaboradores del proyecto de c√≥digo abierto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Apache Ignite</a> .  Un evento importante en la vida de esta comunidad fue la reestructuraci√≥n del componente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ignite Service Grid</a> , que le permite implementar microservicios personalizados directamente en el cl√∫ster Ignite.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Vyacheslav Daradur</a> , desarrollador senior de Yandex y colaborador de Apache Ignite durante m√°s de dos a√±os, habl√≥ sobre este dif√≠cil proceso en la reuni√≥n. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/760/950/25c/76095025c0c68e0fd17702019d3357cc.png"><br><a name="habracut"></a><br>  Para empezar, qu√© es Apache Ignite en general.  Esta es una base de datos que es un repositorio clave / valor distribuido con soporte para SQL, transaccional y almacenamiento en cach√©.  Adem√°s, Ignite le permite implementar servicios de usuario directamente en el cl√∫ster Ignite.  El desarrollador pone a disposici√≥n todas las herramientas que proporciona Ignite: estructuras de datos distribuidos, mensajer√≠a, transmisi√≥n, computaci√≥n y cuadr√≠cula de datos.  Por ejemplo, cuando se usa la cuadr√≠cula de datos, el problema de administrar una infraestructura separada para el almac√©n de datos y, como resultado, la sobrecarga resultante de esto desaparece. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/546/48f/754/54648f7549d3e955de20339ed49cb686.png"><br><br>  Con la API de Service Grid, puede implementar un servicio simplemente especificando el esquema de implementaci√≥n en la configuraci√≥n y, en consecuencia, el servicio en s√≠. <br><br>  Por lo general, un patr√≥n de implementaci√≥n es una indicaci√≥n del n√∫mero de instancias que deben implementarse en los nodos del cl√∫ster.  Hay dos patrones de implementaci√≥n t√≠picos.  El primero es Cluster Singleton: en cualquier momento en el cl√∫ster, se garantizar√° que una instancia del servicio de usuario est√© disponible.  El segundo es Node Singleton: una instancia del servicio se implementa en cada nodo del cl√∫ster. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2db/1b1/785/2db1b178520547827c39fc66e2f98b33.png"><br><br>  El usuario tambi√©n puede especificar el n√∫mero de instancias de servicio en todo el cl√∫ster y definir un predicado para filtrar nodos adecuados.  En este escenario, Service Grid calcular√° la distribuci√≥n √≥ptima para la implementaci√≥n de los servicios. <br><br>  Adem√°s, existe una caracter√≠stica como el Servicio de afinidad.  La afinidad es una funci√≥n que define la relaci√≥n de claves con particiones y la relaci√≥n de partes con nodos en la topolog√≠a.  Con la clave, puede determinar el nodo primario en el que se almacenan los datos.  Por lo tanto, puede asociar su propio servicio con la clave y el cach√© de la funci√≥n de afinidad.  Si la funci√≥n de afinidad cambia, se producir√° una reoperaci√≥n autom√°tica.  Por lo tanto, el servicio siempre se colocar√° junto a los datos que debe manipular y, en consecuencia, reducir√° la sobrecarga de acceso a la informaci√≥n.  Tal esquema se puede llamar una especie de computaci√≥n colocada. <br><br>  Ahora que hemos descubierto cu√°l es la belleza de Service Grid, le diremos sobre su historial de desarrollo. <br><br><h2>  Lo que era antes </h2><br>  La implementaci√≥n anterior de Service Grid se bas√≥ en el cach√© del sistema transaccional replicado Ignite.  La palabra "cach√©" en Ignite significa almacenamiento.  Es decir, esto no es algo temporal, como podr√≠a pensar.  A pesar de que el cach√© es replicable y cada nodo contiene el conjunto de datos completo, dentro del cach√© tiene una vista particionada.  Esto se debe a la optimizaci√≥n del almacenamiento. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/93b/cff/f34/93bcfff34a86ed6da30dfdc4190600c6.png"><br><br>  ¬øQu√© sucedi√≥ cuando un usuario quer√≠a implementar un servicio? <br><br><ul><li>  Todos los nodos del cl√∫ster se suscribieron para actualizar los datos en el repositorio utilizando el mecanismo de consulta continua incorporado. <br></li><li> Un nodo iniciador bajo una transacci√≥n de lectura confirmada hizo un registro en la base de datos que conten√≠a la configuraci√≥n del servicio, incluida la instancia serializada. <br></li><li>  Al recibir la notificaci√≥n de un nuevo registro, el coordinador calcul√≥ la distribuci√≥n en funci√≥n de la configuraci√≥n.  El objeto resultante se vuelve a escribir en la base de datos. <br></li><li>  Los nodos leen informaci√≥n sobre la nueva distribuci√≥n y los servicios desplegados en <br>  si es necesario <br></li></ul><br><h2>  Lo que no nos conven√≠a </h2><br>  En alg√∫n momento, llegamos a la conclusi√≥n: es imposible trabajar con servicios.  Hubo varias razones. <br><br>  Si se produjo alg√∫n tipo de error durante la implementaci√≥n, entonces podr√≠a averiguarlo solo desde los registros del nodo donde sucedi√≥ todo.  Solo hubo una implementaci√≥n asincr√≥nica, por lo que despu√©s de devolver el control del m√©todo de implementaci√≥n al usuario, tom√≥ un tiempo adicional para iniciar el servicio, y en ese momento el usuario no pod√≠a controlar nada.  Para desarrollar a√∫n m√°s Service Grid, ver nuevas caracter√≠sticas, atraer nuevos usuarios y facilitar la vida de todos, debe cambiar algo. <br><br>  Al dise√±ar una nueva Cuadr√≠cula de servicios, en primer lugar quer√≠amos proporcionar una garant√≠a de implementaci√≥n s√≠ncrona: tan pronto como el usuario devolviera el control de la API, pod√≠a usar los servicios de inmediato.  Tambi√©n quer√≠a darle al iniciador la oportunidad de manejar los errores de implementaci√≥n. <br><br>  Adem√°s, quer√≠a facilitar la implementaci√≥n, es decir, alejarme de las transacciones y el reequilibrio.  A pesar de que el cach√© es replicable y no hay equilibrio, hubo problemas durante una implementaci√≥n grande con muchos nodos.  Al cambiar la topolog√≠a, los nodos necesitan intercambiar informaci√≥n, y con una implementaci√≥n grande, estos datos pueden pesar mucho. <br><br>  Cuando la topolog√≠a era inestable, el coordinador necesitaba recalcular la distribuci√≥n de servicios.  Y, en general, cuando tiene que trabajar con transacciones en una topolog√≠a inestable, esto puede conducir a errores dif√≠ciles de predecir. <br><br><h2>  Los problemas </h2><br>  ¬øQu√© cambios globales sin problemas de acompa√±amiento?  El primero de ellos fue un cambio en la topolog√≠a.  Debe comprender que en cualquier momento, incluso en el momento de la implementaci√≥n del servicio, un nodo puede entrar o salir de un cl√∫ster.  Adem√°s, si en el momento de la implementaci√≥n el nodo ingresa al cl√∫ster, ser√° necesario transferir constantemente toda la informaci√≥n sobre los servicios al nuevo nodo.  Y estamos hablando no solo de lo que ya se ha implementado, sino tambi√©n de las implementaciones actuales y futuras. <br><br>  Este es solo uno de los problemas que se pueden agrupar en una lista separada: <br><br><ul><li>  ¬øC√≥mo implementar servicios configurados est√°ticamente al iniciar un nodo? <br></li><li>  Salida de nodo del cl√∫ster: ¬øqu√© sucede si los servicios de host del host? <br></li><li>  ¬øQu√© hacer si el coordinador ha cambiado? <br></li><li>  ¬øQu√© hacer si el cliente se reconect√≥ al cl√∫ster? <br></li><li>  ¬øNecesito procesar solicitudes de activaci√≥n / desactivaci√≥n y c√≥mo? <br></li><li>  Pero, ¬øqu√© pasa si llamaron al cach√© Destroy y tenemos servicios de afinidad vinculados a √©l? <br></li></ul><br>  Y eso no es todo. <br><br><h2>  Soluci√≥n </h2><br>  Como objetivo, elegimos el enfoque Event Driven con la implementaci√≥n de procesos de comunicaci√≥n utilizando mensajes.  Ignite ya ha implementado dos componentes que permiten a los nodos reenviar mensajes entre ellos: comunicaci√≥n-spi y descubrimiento-spi. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/11d/bf0/a76/11dbf0a76a9ec1c193af0b1037116534.png"><br><br>  Communication-spi permite a los nodos comunicarse y reenviar mensajes directamente.  Es muy adecuado para enviar grandes cantidades de datos.  Discovery-spi le permite enviar un mensaje a todos los nodos del cl√∫ster.  En una implementaci√≥n est√°ndar, esto se realiza de acuerdo con la topolog√≠a de anillo.  Tambi√©n hay integraci√≥n con Zookeeper, en este caso se utiliza la topolog√≠a en estrella.  Otro punto importante que vale la pena se√±alar: discovery-spi garantiza que el mensaje se entregar√° en el orden correcto a todos los nodos. <br><br>  Considere el protocolo de implementaci√≥n.  Todas las solicitudes de implementaci√≥n y distribuci√≥n de los usuarios se env√≠an a trav√©s de discovery-spi.  Esto ofrece las siguientes <i>garant√≠as</i> : <br><br><ul><li>  La solicitud ser√° recibida por todos los nodos del cl√∫ster.  Esto le permitir√° continuar procesando la solicitud cuando cambie el coordinador.  Tambi√©n significa que en un mensaje cada nodo tendr√° todos los metadatos necesarios, como la configuraci√≥n del servicio y su instancia serializada. <br></li><li>  Un pedido estricto de entrega de mensajes le permite resolver conflictos de configuraci√≥n y solicitudes competidoras. <br></li><li>  Dado que la entrada del nodo a la topolog√≠a tambi√©n es procesada por discovery-spi, todos los datos necesarios para trabajar con los servicios llegar√°n al nuevo nodo. <br></li></ul><br>  Al recibir la solicitud, los nodos del cl√∫ster la validan y forman tareas para su procesamiento.  Estas tareas se ponen en cola y un trabajador independiente las procesa en otro subproceso.  Esto se implementa de esta manera, porque una implementaci√≥n puede llevar un tiempo considerable y retrasar un flujo de descubrimiento costoso es inaceptable. <br><br>  El gestor de despliegue procesa todas las solicitudes de la cola.  Tiene un trabajador especial que saca una tarea de esta cola y la inicializa para comenzar el despliegue.  Despu√©s de esto, se producen las siguientes acciones: <br><br><ol><li>  Cada nodo calcula independientemente la distribuci√≥n gracias a una nueva funci√≥n de asignaci√≥n determinista. <br></li><li>  Los nodos forman un mensaje con los resultados de la implementaci√≥n y lo env√≠an al coordinador. <br></li><li>  El coordinador agrega todos los mensajes y genera el resultado de todo el proceso de implementaci√≥n, que se env√≠a a trav√©s de discovery-spi a todos los nodos del cl√∫ster. <br></li><li>  Al recibir el resultado, se completa el proceso de implementaci√≥n, despu√©s de lo cual la tarea se elimina de la cola. <br></li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/6a6/add/3ef/6a6add3ef7ff9c01c4e31aa58b901171.png"><br>  <i>Nuevo dise√±o basado en eventos: org.apache.ignite.internal.processors.service.IgniteServiceProcessor.java</i> <br><br>  Si se produjo un error en el momento de la implementaci√≥n, el nodo incluye inmediatamente este error en el mensaje, que lo env√≠a al coordinador.  Despu√©s de la agregaci√≥n de mensajes, el coordinador tendr√° informaci√≥n sobre todos los errores durante la implementaci√≥n y enviar√° este mensaje a trav√©s de discovery-spi.  La informaci√≥n de error estar√° disponible en cualquier nodo del cl√∫ster. <br><br>  Seg√∫n este algoritmo, se procesan todos los eventos importantes en la cuadr√≠cula de servicios.  Por ejemplo, un cambio de topolog√≠a tambi√©n es un mensaje de descubrimiento-spi.  Y en general, en comparaci√≥n con lo que era, el protocolo result√≥ ser bastante ligero y confiable.  Tanto como para manejar cualquier situaci√≥n durante el despliegue. <br><br><h2>  ¬øQu√© pasar√° despu√©s? </h2><br>  Ahora sobre los planes.  Cualquier desarrollo importante en el proyecto Ignite se lleva a cabo como una iniciativa para mejorar Ignite, el llamado IEP.  El redise√±o de la red de servicio tambi√©n tiene un IEP - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">IEP No. 17</a> con el nombre de bromas "Cambio de aceite en la red de servicio".  Pero, de hecho, no cambiamos el aceite del motor, sino todo el motor. <br><br>  Dividimos las tareas en IEP en 2 fases.  La primera es una fase importante, que consiste en alterar el protocolo de implementaci√≥n.  Ya est√° vertido en el asistente, puede probar el nuevo Service Grid, que aparecer√° en la versi√≥n 2.8.  La segunda fase incluye muchas otras tareas: <br><br><ul><li>  Redenci√≥n en caliente <br></li><li>  Servicio de versiones <br></li><li>  Mayor resistencia <br></li><li>  Cliente delgado <br></li><li>  Herramientas para monitorear y contar varias m√©tricas <br></li></ul><br>  Finalmente, podemos aconsejarle a Service Grid para construir sistemas de alta disponibilidad tolerantes a fallas.  Tambi√©n lo invitamos a <a href="">la lista de desarrolladores</a> y la <a href="">lista de</a> <a href="">usuarios para</a> compartir su experiencia.  Su experiencia es realmente importante para la comunidad, lo ayudar√° a comprender a d√≥nde ir a continuaci√≥n, c√≥mo desarrollar el componente en el futuro. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/447264/">https://habr.com/ru/post/447264/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447254/index.html">C√≥mo insertar par√°metros en m√©todos sin par√°metros en c√≥digo seguro</a></li>
<li><a href="../447256/index.html">El milagro de materializar magia: Nissan gasta segundos en lugar de meses de trabajo</a></li>
<li><a href="../447258/index.html">Semana de la seguridad 15: ataque a enrutadores con suplantaci√≥n de DNS</a></li>
<li><a href="../447260/index.html">Live Share en Visual Studio 2019</a></li>
<li><a href="../447262/index.html">Acelerando el sitio con JivoSite. Descarga diferida de consultor en l√≠nea</a></li>
<li><a href="../447266/index.html">Lenguaje y √≥rganos sensoriales</a></li>
<li><a href="../447268/index.html">Microsoft Azure Security Center anuncia nuevas caracter√≠sticas</a></li>
<li><a href="../447270/index.html">BGP herida perforante</a></li>
<li><a href="../447274/index.html">Lo que sucede detr√°s de escena C #: lo b√°sico para trabajar con la pila</a></li>
<li><a href="../447276/index.html">¬øQu√© es la biblioteca ITIL y por qu√© su empresa la necesita?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>