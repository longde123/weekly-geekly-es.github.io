<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¸ğŸ¾ ğŸ‘¨ğŸ¾â€ğŸ¤â€ğŸ‘¨ğŸ» ğŸ–ï¸ ç›‘æ§Zadarma Zabbixæˆ¿é—´ ğŸ¶ ğŸ‘©ğŸ¾â€ğŸ³ âœï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘æä¾›äº†ä¸€ä¸ªç”¨äºZabbixçš„ç°æˆæ¨¡æ¿å’Œä¸€ä¸ªPythonè„šæœ¬ï¼Œç”¨äºè‡ªåŠ¨æ£€æµ‹æ–°çš„Zadarmaæä¾›ç¨‹åºç¼–å·ï¼ˆåœ¨æ‚¨æ‰€è´­ä¹°çš„ç¼–å·çš„æ„ä¹‰ä¸Šï¼Œæ˜¯æ–°çš„ï¼‰ã€‚ 

 è¯¥æ¨¡æ¿å…·æœ‰å¤šä¸ªè§¦å‘å™¨å’Œæœ‰å…³æˆ¿é—´çš„åŸºæœ¬ä¿¡æ¯ã€‚ è¯¥è„šæœ¬å¯ä¸Zadarma APIæˆ–MySQLæ•°æ®åº“ä¸€èµ·ä½¿ç”¨ã€‚ 

 è¦ä½¿ç”¨MySQLï¼Œå¿…é¡»äº‹å…ˆå°†æ•°æ®æ”¾åˆ°è¡¨...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ç›‘æ§Zadarma Zabbixæˆ¿é—´</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416231/"> æˆ‘æä¾›äº†ä¸€ä¸ªç”¨äºZabbixçš„ç°æˆæ¨¡æ¿å’Œä¸€ä¸ªPythonè„šæœ¬ï¼Œç”¨äºè‡ªåŠ¨æ£€æµ‹æ–°çš„Zadarmaæä¾›ç¨‹åºç¼–å·ï¼ˆåœ¨æ‚¨æ‰€è´­ä¹°çš„ç¼–å·çš„æ„ä¹‰ä¸Šï¼Œæ˜¯æ–°çš„ï¼‰ã€‚ <br><br> è¯¥æ¨¡æ¿å…·æœ‰å¤šä¸ªè§¦å‘å™¨å’Œæœ‰å…³æˆ¿é—´çš„åŸºæœ¬ä¿¡æ¯ã€‚ è¯¥è„šæœ¬å¯ä¸Zadarma APIæˆ–MySQLæ•°æ®åº“ä¸€èµ·ä½¿ç”¨ã€‚ <br><br> è¦ä½¿ç”¨MySQLï¼Œå¿…é¡»äº‹å…ˆå°†æ•°æ®æ”¾åˆ°è¡¨å† ä¸Šï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨å•ç‹¬çš„è„šæœ¬ä»æ‹¨å·è®¡åˆ’ä¸­æ”¾æ•°æ®ã€‚ <br><br> ä¸¤ç§è„šæœ¬å‡è¢«å‰ªåˆ‡ã€‚ <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">zadarma_number.py</b> <div class="spoiler_text"> è¯¥è„šæœ¬å¿…é¡»ä¸zabbizä»£ç†çš„è„šæœ¬ä¸€èµ·æ”¾åœ¨ç›®å½•ä¸­ï¼Œæˆ‘å·²ç»æ‹¥æœ‰äº† <br><br><pre><code class="bash hljs">/etc/zabbix/scripts/</code> </pre> <br> å¦å¤–ï¼Œæˆäºˆå®ƒè¿è¡Œçš„æƒåˆ©ï¼Œä»¥é˜²ä¸‡ä¸€æ›´æ”¹zabbixçš„æ‰€æœ‰è€…å’Œç»„ï¼š <br><br><pre> <code class="bash hljs">chmod +x /etc/zabbix/scripts/zadarma_number.py chown zabbix:zabbix /etc/zabbix/scripts/zadarma_number.py</code> </pre><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#! /usr/bin/env python3 import json import pymysql import argparse import sys import base64 import hmac import requests from hashlib import sha1, md5 from collections import OrderedDict from urllib.parse import urlencode api_key = '222c2fd22c2d2222a2b2' secret_key = '2a2f2222cee2222f2222' database_address = '192.168.10.18' database_name = 'asterisk' database_user = 'asterisk' database_password = 'dFgXuasfvgas45hAkEb2' zadarma_api_url = 'http://api.zadarma.com' monthly_fee_all = 0 def sql_result(sql): cursor.execute(sql) data = cursor.fetchall() return data def str_for_json(data): json_data = [] for result in data: json_data.append(dict(zip(['{#NUMBER}'], result))) json_data = ({"data":json_data}) return json.dumps(json_data) # return json.dumps(json_data) def createParser(): parser = argparse.ArgumentParser( prog='Zadarma for Zabbix', description='''       Zadarma       zabbiz .''', epilog='''(c)  2018.  ,  ,       .''' ) parser.add_argument('-l', '--allnumbers', action='store_true', help='"Show all found phone numbers in a format suitable for zabbix. ' ' Running a script without parameters (or with the -f option) leads to the same result."') parser.add_argument('-n', '--number', help = '"Phone number and -s or -S or -g or -e or -d or -m or -a "', metavar = 'phone number') parser.add_argument('-S', '--status', action='store_true') parser.add_argument('-g', '--start_date', action='store_true') parser.add_argument('-e', '--stop_date', action='store_true') parser.add_argument('-d', '--description', action='store_true') parser.add_argument('-s', '--sip', action='store_true', help='"can be used in combination with "-c""') parser.add_argument('-m', '--monthly_fee', action='store_true', help='"The amount required to renew a phone number or all phone numbers"') parser.add_argument('-a', '--autorenew', action='store_true') parser.add_argument('-b', '--balance', action='store_true', help='All balance numbers') parser.add_argument('-f', '--force_API', action='store_true',default=False, help = '"Force the use of api, the database is ignored"') parser.add_argument('-c', '--cut', type=int, default=0, help='''Used only in conjunction with "-s" 0 - The whole line, 1- Part of the string before "@", 2 - Part of the line after "@"''', metavar='[0,1,2] or none') return parser def api_zapros(method,data): if not data: data = {'format': 'json'} sorted_dict_params = OrderedDict(sorted(data.items())) query_string = urlencode(sorted_dict_params) h = md5(query_string.encode('utf8')).hexdigest() data = method + query_string + h hashed = hmac.new(secret_key.encode('utf8'), data.encode('utf8'), sha1) auth = api_key + ':' + base64.b64encode(bytes(hashed.hexdigest(), 'utf8')).decode() headers = {'User-Agent': '-', 'Authorization': auth} url = zadarma_api_url + method + '?' + query_string; r = requests.get(url, headers=headers) r.raise_for_status() return json.loads(r.text) def no_sql(*args): number = args[0] parametr = args[1] for number_string in numbers_result['info']: if number_string['number'] == number: if number_string[parametr] == 'true' or number_string[parametr] == 'on': return '0' elif number_string[parametr] == 'false' or number_string[parametr] == 'off': return '1' else: return number_string[parametr] def zapros(*args): if namespace.force_API: return no_sql(namespace.number,args[0]) else: return sql_result(sql)[0][0] parser = createParser() namespace = parser.parse_args(sys.argv[1:]) if not namespace.force_API: try: db = pymysql.connect(database_address, database_user, database_password, database_name) cursor = db.cursor() except pymysql.Error as e: print('\n\t!!!!!!!!!!!SQL no connect!!!!!!!!!!!\n') print(e) exit(1) else: try: numbers_result = api_zapros('/v1/direct_numbers/', '') balance_info = api_zapros('/v1/info/balance/', '') except Exception as e: print('Error connect API zadarma') exit(1) # print('namespace', namespace) if namespace.number and namespace.status: sql = "SELECT status FROM zadarma_numbers WHERE number = %s;" % (namespace.number) print(zapros('status')) elif namespace.number and namespace.start_date: sql = "SELECT start_date FROM zadarma_numbers WHERE number = %s;" % (namespace.number) print(zapros('start_date')) elif namespace.number and namespace.stop_date: sql = "SELECT stop_date FROM zadarma_numbers WHERE number = %s;" % (namespace.number) print(zapros('stop_date')) elif namespace.number and namespace.autorenew: sql = "SELECT autorenew FROM zadarma_numbers WHERE number = %s;" % (namespace.number) print(zapros('autorenew')) elif namespace.number and namespace.description: sql = "SELECT description FROM zadarma_numbers WHERE number = %s;" % (namespace.number) print(zapros('description')) elif namespace.number and namespace.sip: sql = "SELECT sip FROM zadarma_numbers WHERE number = %s;" % (namespace.number) if namespace.cut == 0: print(zapros('sip')) if namespace.cut == 1: try: print(zapros('sip').split('@')[0]) except IndexError: print(zapros('sip')) if namespace.cut == 2: try: print(zapros('sip').split('@')[1]) except IndexError: print(zapros('sip')) elif namespace.number and namespace.monthly_fee: sql = "SELECT monthly_fee FROM zadarma_numbers WHERE number = %s;" % (namespace.number) print(zapros('monthly_fee')) else: if namespace.number: # sql = "SELECT * FROM zadarma_numbers WHERE number = %s;" % (namespace.number) # print(zapros(namespace.number)) print(namespace.number, 'there are not enough arguments or incorrect combination of arguments') sys.exit(1) elif namespace.balance: if namespace.force_API: balance = balance_info['balance'] print(balance) else: print(sql_result('SELECT balance FROM zadarma_balance;')[0][0]) elif namespace.monthly_fee: if namespace.force_API: for result in numbers_result['info']: monthly_fee_all = monthly_fee_all + result['monthly_fee'] print(monthly_fee_all) else: print(sql_result('SELECT monthly_fee FROM zadarma_balance;')[0][0]) elif namespace.allnumbers: if namespace.force_API: json_data = [] for result in numbers_result['info']: print(result['number']) json_data.append(dict(zip(['{#NUMBER}'], [result['number']]))) json_data = ({"data": json_data}) print('jkgkgliuui',json.dumps(json_data)) else: data = sql_result('SELECT number FROM zadarma_numbers WHERE stop_date &gt; date') print(str_for_json(data)) else: if namespace.force_API: json_data = [] for result in numbers_result['info']: json_data.append(dict(zip(['{#NUMBER}'], [result['number']]))) json_data = ({"data": json_data}) print(json.dumps(json_data)) else: data = sql_result('SELECT number FROM zadarma_numbers WHERE stop_date &gt; date') print(str_for_json(data)) if not namespace.force_API: db.close()</span></span></code> </pre><br></div></div><br> ä»ç†è®ºä¸Šè®²ï¼Œä½¿ç”¨ç»™å®šçš„æ•°æ®åº“å¯èƒ½æ›´ç›¸å…³ï¼Œå› ä¸ºå¯ä»¥åœ¨æ¯æ¬¡è°ƒç”¨åè¿è¡Œç”¨äºæ·»åŠ ä¿¡æ¯çš„è„šæœ¬ã€‚ å› æ­¤ï¼Œä¸ç›´æ¥ä»Zabbixç›´æ¥ä½¿ç”¨APIâ€‹â€‹ç›¸æ¯”ï¼Œæ•°æ®åº“ä¸­çš„ä¿¡æ¯å¯èƒ½ä¼šæ›´æœ‰æ„ä¹‰ã€‚ <br><br> åœ¨Zabbixæ¨¡æ¿ä¸­ï¼Œå®{$ FORCE_API}å¼ºåˆ¶è„šæœ¬ä¸Zadarma APIä¸€èµ·ä½¿ç”¨ã€‚ <br> å®{$ CUT}ç”¨äºå°†SIP-URIè¯·æ±‚å­—ç¬¦ä¸²åˆ†æˆâ€œ @â€ä¹‹å‰å’Œä¹‹åçš„éƒ¨åˆ†ã€‚ <br><br> è¯¥è„šæœ¬æœ‰å‡ ä¸ªè¦è¿è¡Œçš„é”®ã€‚ <br><br> æ²¡æœ‰é”®æˆ–æ²¡æœ‰-lå¼€å…³ï¼Œè„šæœ¬å°†ä»¥jsonæ ¼å¼è¿”å›æ•°å­—åˆ—è¡¨ï¼Œé€‚ç”¨äºè‡ªåŠ¨æ£€æµ‹zabbixä¸­çš„æ•°å­—ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">è„šæœ¬é”®å¸®åŠ©ï¼š</b> <div class="spoiler_text"> ç”¨æ³•ï¼šZadarma for Zabbix [-h] [-l] [-nç”µè¯å·ç ] [-S] [-g] [-e] [-d] [-s] <br>  [-m] [-a] [-b] [-f] [-c [0,1,2]æˆ–æ— ] <br><br> æ­¤ç¨‹åºæ—¨åœ¨ç›‘è§†Zadarmaæä¾›ç¨‹åºçš„æ•°é‡ä»¥åŠ <br> æœ€åˆè¢«è®¤ä¸ºæ˜¯zabbizä»£ç†ç¨‹åºçš„è„šæœ¬ã€‚ <br><br><pre> <code class="bash hljs">optional arguments: -h, --<span class="hljs-built_in"><span class="hljs-built_in">help</span></span> show this <span class="hljs-built_in"><span class="hljs-built_in">help</span></span> message and <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> -l, --allnumbers <span class="hljs-string"><span class="hljs-string">"Show all found phone numbers in a format suitable for zabbix. Running a script without parameters (or with the -f option) leads to the same result."</span></span> -n phone number, --number phone number <span class="hljs-string"><span class="hljs-string">"Phone number and -s or -S or -g or -e or -d or -m or -a "</span></span> -S, --status -g, --start_date -e, --stop_date -d, --description -s, --sip <span class="hljs-string"><span class="hljs-string">"can be used in combination with "</span></span>-c<span class="hljs-string"><span class="hljs-string">""</span></span> -m, --monthly_fee <span class="hljs-string"><span class="hljs-string">"The amount required to renew a phone number or all phone numbers"</span></span> -a, --autorenew -b, --balance All balance numbers -f, --force_API <span class="hljs-string"><span class="hljs-string">"Force the use of api, the database is ignored"</span></span> -c [0,1,2] or none, --cut [0,1,2] or none Used only <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> conjunction with <span class="hljs-string"><span class="hljs-string">"-s"</span></span> 0 - The whole line, 1- Part of the string before <span class="hljs-string"><span class="hljs-string">"@"</span></span>, 2 - Part of the line after <span class="hljs-string"><span class="hljs-string">"@"</span></span></code> </pre> <br></div></div><br> é”®â€œ -Sï¼Œ-sï¼Œ-gï¼Œ-eï¼Œ-dï¼Œ-aâ€ä»…ä¸æ•°å­—ç»“åˆä½¿ç”¨ <br>  -må¼€å…³å¯ä»¥ä¸æ•°å­—ä¸€èµ·ä½¿ç”¨æˆ–ä¸ä¸æ•°å­—ä¸€èµ·ä½¿ç”¨ <br> é”®-bï¼Œä»…ä¸å¸¦æ•°å­— <br>  -cå¼€å…³ä»…ä¸-så¼€å…³ä¸€èµ·ä½¿ç”¨ <br>  -få¼€å…³å¼ºåˆ¶ä½¿ç”¨APIâ€‹â€‹ï¼Œå¦‚æœæ²¡æœ‰å®ƒï¼Œåˆ™å°†è¯·æ±‚å‘é€åˆ°æ•°æ®åº“ï¼Œå¹¶ä¸”å¯ä»¥ä¸ä»»ä½•å¼€å…³ä¸€èµ·ä½¿ç”¨ã€‚ <br><br> ç¬¬äºŒä¸ªè„šæœ¬ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">è„šæœ¬API_to_MySql</b> <div class="spoiler_text"> å› æ­¤ï¼Œèµ‹äºˆå®ƒè¿è¡Œæƒï¼š <br><br><pre> <code class="bash hljs">chmod +x ./main.py</code> </pre><br> å¦‚ä½•è°ƒç”¨è„šæœ¬ä»¥åŠåœ¨ä½•å¤„æ”¾ç½®è„šæœ¬ï¼Œè¯·è‡ªå·±å†³å®šã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#! /usr/bin/env python3 from hashlib import sha1, md5 from collections import OrderedDict from urllib.parse import urlencode import hmac import requests import base64 import json import pymysql api_key = '222c2fd22c2d2222a2b2' secret_key = '2a2f2222cee2222f2222' database_address = '192.168.10.18' database_name = 'asterisk' database_user = 'asterisk' database_password = 'dFgXuasfvgas45hAkEb2' zadarma_api_url = 'http://api.zadarma.com' monthly_fee_all = 0 debug = True # debug = False db = pymysql.connect(database_address, database_user, database_password, database_name) cursor = db.cursor() def sql_insert(): sql = "REPLACE zadarma_numbers (id, date, number, number_name, description, sip, start_date, stop_date, monthly_fee, status, channels, autorenew) \ VALUES (NULL, UTC_TIMESTAMP(), '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s');" % \ (number,number_name, description, sip, start_date, stop_date, monthly_fee, status, channels, autorenew) try: # Execute the SQL command cursor.execute(sql) # Commit your changes in the database db.commit() except: # Rollback in case there is any error db.rollback() def zapros(method,data): if not data: data = {'format': 'json'} sorted_dict_params = OrderedDict(sorted(data.items())) query_string = urlencode(sorted_dict_params) h = md5(query_string.encode('utf8')).hexdigest() data = method + query_string + h hashed = hmac.new(secret_key.encode('utf8'), data.encode('utf8'), sha1) auth = api_key + ':' + base64.b64encode(bytes(hashed.hexdigest(), 'utf8')).decode() headers = {'User-Agent': '-', 'Authorization': auth} url = zadarma_api_url + method + '?' + query_string; r = requests.get(url, headers=headers) return json.loads(r.text) # print(r.text) numbers = zapros('/v1/direct_numbers/', '') if debug: print(numbers['info']) for res in numbers['info']: description = res['description'] number = res['number'] number_name = res['number_name'] start_date = res['start_date'] stop_date = res['stop_date'] sip = res['sip'] if res['autorenew'] == 'true': autorenew = 0 else: autorenew = 1 monthly_fee = res['monthly_fee'] if res['status'] == 'on': status = 0 else: status = 1 channels = res['channels'] monthly_fee_all = monthly_fee_all + monthly_fee if debug: print('number', number) print('description', description) print('sip',sip) print('number_name', number_name) print('start_date', start_date) print('stop_date', stop_date) print('monthly_fee',monthly_fee) print('status', status) # print('monthly_fee_all',monthly_fee_all) if autorenew != 0: if debug: print('!!!!!!!!!!!!!!!\nautorenew OFF\n!!!!!!!!!!!!!!!\n') if debug: print() sql_insert() balance_info = zapros('/v1/info/balance/','') balance = balance_info['balance'] if debug: print('balance', balance) print('monthly_fee_all',monthly_fee_all) sql = "REPLACE zadarma_balance (id, date, balance, monthly_fee) VALUES (NULL, UTC_TIMESTAMP(), '%s', '%s');" % (balance, monthly_fee_all) try: cursor.execute(sql) db.commit() except: db.rollback() if debug: print('doplata --&gt;', balance - monthly_fee_all ) print('monthly_fee_all', monthly_fee_all) db.close() &lt;spoiler title="  MySQL  "&gt;</span></span></code> </pre><br> è¦ç¦ç”¨å‘æ§åˆ¶å°çš„ä¿¡æ¯è¾“å‡ºï¼Œæ‚¨éœ€è¦å–æ¶ˆæ³¨é‡Šè¯¥è¡Œ <br> è°ƒè¯•=å‡ <br><br></div></div><br> ä¸ºäº†ä½¿ä¸¤ä¸ªè„šæœ¬éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼Œæ‚¨å¾ˆå¯èƒ½éœ€è¦å®‰è£…â€œè¯·æ±‚â€ <br><br><pre> <code class="bash hljs">pip install requests</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">æ•°å­—è¡¨</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`zadarma_numbers`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`date`</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'0000-00-00 00:00:00'</span></span>, <span class="hljs-string"><span class="hljs-string">`number`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">12</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`number_name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">60</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`description`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">60</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">`sip`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">80</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`start_date`</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`stop_date`</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`monthly_fee`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`status`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`channels`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`autorenew`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">205</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`zadarma_numbers`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`number`</span></span> (<span class="hljs-string"><span class="hljs-string">`number`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`calldate`</span></span> (<span class="hljs-string"><span class="hljs-string">`date`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`accountcode`</span></span> (<span class="hljs-string"><span class="hljs-string">`monthly_fee`</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`zadarma_numbers`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MODIFY</span></span> <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT;</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">ä½™é¢è¡¨</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`zadarma_balance`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`date`</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'0000-00-00 00:00:00'</span></span>, <span class="hljs-string"><span class="hljs-string">`balance`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`monthly_fee`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`zadarma_balance`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`balance`</span></span> (<span class="hljs-string"><span class="hljs-string">`balance`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`calldate`</span></span> (<span class="hljs-string"><span class="hljs-string">`date`</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`zadarma_balance`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MODIFY</span></span> <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT;</code> </pre><br></div></div><br> å¸¦æœ‰mysqlæ¨¡æ¿ï¼Œè„šæœ¬å’Œè½¬å‚¨çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å­˜å‚¨åº“</a> ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN416231/">https://habr.com/ru/post/zh-CN416231/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN416213/index.html">å¼€æ”¾å¼ç½‘ç»œç ”è®¨ä¼šâ€œ Angularä¸­çš„ä¾èµ–æ³¨å…¥â€</a></li>
<li><a href="../zh-CN416215/index.html">é£Ÿå“è®¾è®¡æ–‡æ‘˜2018å¹´6æœˆ</a></li>
<li><a href="../zh-CN416217/index.html">æˆ‘å¦‚ä½•å°†è®¡ç®—æœºå’Œç”¨æˆ·è¿æ¥åˆ°ç½‘ç»œMACMonitorç›‘è§†ç¨‹åºä¸­çš„ç½‘ç»œè®¾å¤‡ç«¯å£</a></li>
<li><a href="../zh-CN416219/index.html">Yandexå¼€å§‹ä½¿ç”¨å¯†ç ç´¢å¼•Googleæ–‡æ¡£</a></li>
<li><a href="../zh-CN416229/index.html">è®¾è®¡å¸ˆåº”é˜…è¯»çš„10æœ¬æœ‰å…³è¥é”€å’Œç›¸å…³ä¸»é¢˜çš„ä¹¦</a></li>
<li><a href="../zh-CN416235/index.html">ä¸ºBootstrap 4åˆ›å»ºè‡ªå®šä¹‰ç»„ä»¶</a></li>
<li><a href="../zh-CN416237/index.html">æˆä¸ºè®¾è®¡å¸ˆï¼šä»æ—…é¦†çš„è‡ªç”±èŒä¸šè€…åˆ°ä¸é¡¶å°–å…¬å¸åˆä½œå¹¶æ¨å‡ºæ‚¨çš„äº§å“</a></li>
<li><a href="../zh-CN416239/index.html">PMOåœ¨è®¾è®¡å…¬å¸ä¸­çš„è§’è‰²å’ŒåŠŸèƒ½</a></li>
<li><a href="../zh-CN416241/index.html">ä½¿ç”¨Pythonä»è¶…çº§é©¬é‡Œå¥¥å…„å¼Ÿä¸­è·å–å…³å¡</a></li>
<li><a href="../zh-CN416243/index.html">é’´çš„æ›¿ä»£å“ï¼Œç”µæ± ä¸­çš„è¿™ç§è¡€è…¥é’»çŸ³</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>