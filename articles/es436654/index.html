<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåä üå¨Ô∏è üë¶üèº Desarrollo de un equipo para consultar datos de la base de datos - parte 4, concluyendo üöå ‚èπÔ∏è üë®üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Esta es una continuaci√≥n de la historia que comenz√≥ aqu√≠ y continu√≥ aqu√≠ y aqu√≠ . 


 En la √∫ltima parte, escrib√≠ una prueba de integraci√≥n que demues...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Desarrollo de un equipo para consultar datos de la base de datos - parte 4, concluyendo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436654/"><p>  Esta es una continuaci√≥n de la historia que comenz√≥ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> y continu√≥ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </p><br><p>  En la √∫ltima parte, escrib√≠ una prueba de integraci√≥n que demuestra el proceso de inicializaci√≥n y ejecuci√≥n de un conjunto completo de controladores que extraen datos de una base de datos.  Pero dado que puede llevar demasiado tiempo escribir esta prueba para ejecutarla, necesaria para codificar no solo el controlador, sino tambi√©n las reglas de configuraci√≥n para todas las consultas necesarias en la base de datos, hoy decid√≠ implementar su versi√≥n modular, dise√±ada para configurar y ejecutar todo un manejador  Esta prueba se ve as√≠: <a name="habracut"></a></p><br><pre><code class="javascript hljs">describe(<span class="hljs-string"><span class="hljs-string">'requestHandler'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createStore = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'redux'</span></span>).createStore; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducers = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../../src/reducers.js'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DbMock = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../mocks/DbMock'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> db = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DbMock(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rules = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../../src/rules'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dbRequest = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../../src/storage/dbRequest'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> request = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, store = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, context = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; beforeEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { store = createStore(reducers); context = { db, store, rules }; request = dbRequest.bind(context, [ <span class="hljs-string"><span class="hljs-string">'user'</span></span> ]); expect(store.getState().user).toBeNull(); expect(store.getState().error).toEqual([]); }); it(<span class="hljs-string"><span class="hljs-string">'should get user from database'</span></span>, (done) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> assert = checkUser.bind(context, [ done ]); store.subscribe(assert); store.dispatch({<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'NOTE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">note</span></span>: { <span class="hljs-attr"><span class="hljs-attr">Id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">UserRecordId</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }}); request(); }); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkUser</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">args</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> state = store.getState(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(state.user === <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> user = state.user; expect(user.Id).toEqual(<span class="hljs-number"><span class="hljs-number">1</span></span>); expect(user.Name).toEqual(<span class="hljs-string"><span class="hljs-string">'Jack'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> checkIsCompleted = args[<span class="hljs-number"><span class="hljs-number">0</span></span>]; checkIsCompleted(); } });</code> </pre> <br><p>  Ejecuto las pruebas y recibo un mensaje de que no se encontr√≥ el m√≥dulo con las reglas.  Una vez m√°s, ¬øqu√© necesitar√° extraer el controlador de las reglas? </p><br><ol><li>  El nombre de la clave de propiedad del contenedor de propiedades a la que se vincular√° el registro recibido de la base de datos. </li><li>  El nombre de la tabla de la base de datos de la que desea extraer el registro. </li><li>  El m√©todo que forma la solicitud que deber√° enviarse a la base de datos para obtener una respuesta </li><li>  El m√©todo del despachador que env√≠a el registro recibido de la base de datos al almac√©n de contenedores del estado. </li><li>  Un m√©todo de env√≠o que env√≠a un error, si lo hay, al almacenamiento del contenedor de estado.  Decid√≠ primero consolidar los errores en el contenedor de estado y luego tratarlos. </li></ol><br><p>  El conjunto de reglas me parece un diccionario ( <code>Map</code> ), en el que la clave ser√° el nombre de la propiedad del contenedor de estado y probablemente formular√© la primera prueba unitaria: </p><br><pre> <code class="javascript hljs">describe(<span class="hljs-string"><span class="hljs-string">'rules'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rules = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../src/rules'</span></span>); it(<span class="hljs-string"><span class="hljs-string">'should contain user rules'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rule = rules.get(<span class="hljs-string"><span class="hljs-string">'user'</span></span>); expect(rule.table).toEqual(<span class="hljs-string"><span class="hljs-string">'users'</span></span>); }); });</code> </pre> <br><p>  Ejecut√© las pruebas y <code>Jasmine</code> me dice que ahora tengo dos pruebas fallidas.  Para no complicar la tarea, comenzar√© con una regla simple que me dice que para asignar un valor a la clave de <code>user</code> del contenedor de estado, mi solicitud debe ir a la tabla de <code>users</code> para obtener datos.  Todo parece ser l√≥gico.  Escribir√© como me parece un peque√±o c√≥digo. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> makeRules = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rules = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>(); rules.set(<span class="hljs-string"><span class="hljs-string">'user'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">table</span></span>: <span class="hljs-string"><span class="hljs-string">'users'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rules; }; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = makeRules();</code> </pre> <br><p>  Ejecuto las pruebas y veo que solo la prueba de mi controlador falla, aunque el error ahora es diferente.  Sin embargo, volver√© a esta prueba m√°s tarde, cuando tenga al menos una regla completa en mi diccionario lista. </p><br><p>  Modificar√© un poco la prueba del diccionario de reglas.  Agregar√© un c√≥digo que verifica la presencia de un m√©todo de despachador que maneja un error al ejecutar una consulta a la base de datos: </p><br><pre> <code class="javascript hljs">describe(<span class="hljs-string"><span class="hljs-string">'rules'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rules = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../src/rules'</span></span>); it(<span class="hljs-string"><span class="hljs-string">'should contain user rules'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rule = rules.get(<span class="hljs-string"><span class="hljs-string">'user'</span></span>); expect(rule.table).toEqual(<span class="hljs-string"><span class="hljs-string">'users'</span></span>); expect(rule.onError.name).toEqual(<span class="hljs-string"><span class="hljs-string">'dispatchError'</span></span>); expect(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> rule.onError).toEqual(<span class="hljs-string"><span class="hljs-string">'function'</span></span>); }); });</code> </pre> <br><p>  Ejecuto las pruebas, me aseguro de volver a tener dos pruebas fallidas y vuelvo a finalizar el c√≥digo del m√©todo de f√°brica para generar el diccionario de reglas.  Agrego la funci√≥n al objeto literal de la primera regla: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> makeRules = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rules = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>(); rules.set(<span class="hljs-string"><span class="hljs-string">'user'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">table</span></span>: <span class="hljs-string"><span class="hljs-string">'users'</span></span>, <span class="hljs-attr"><span class="hljs-attr">onError</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispatchError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error, store</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> action = { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'ERROR'</span></span>, error }; store.dispatch(action); } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rules; }; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = makeRules();</code> </pre> <br><p>  Ejecutando las pruebas nuevamente.  El nuevo fragmento de regla pasa la prueba con √©xito, por lo que decido agregar comprobaciones para todas las reglas restantes: </p><br><pre> <code class="javascript hljs">describe(<span class="hljs-string"><span class="hljs-string">'rules'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rules = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../src/rules'</span></span>); it(<span class="hljs-string"><span class="hljs-string">'should contain user rules'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rule = rules.get(<span class="hljs-string"><span class="hljs-string">'user'</span></span>); expect(rule.table).toEqual(<span class="hljs-string"><span class="hljs-string">'users'</span></span>); expect(rule.onError.name).toEqual(<span class="hljs-string"><span class="hljs-string">'dispatchError'</span></span>); expect(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> rule.onError).toEqual(<span class="hljs-string"><span class="hljs-string">'function'</span></span>); expect(rule.onSuccess.name).toEqual(<span class="hljs-string"><span class="hljs-string">'dispatchUser'</span></span>); expect(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> rule.onSuccess).toEqual(<span class="hljs-string"><span class="hljs-string">'function'</span></span>); expect(rule.query.name).toEqual(<span class="hljs-string"><span class="hljs-string">'getUserQuery'</span></span>); expect(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> rule.query).toEqual(<span class="hljs-string"><span class="hljs-string">'function'</span></span>); }); });</code> </pre> <br><p>  Corro pruebas.  El conjunto de prueba para el diccionario de reglas nuevamente arroja un error.  Estoy escribiendo el c√≥digo: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> makeRules = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rules = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>(); rules.set(<span class="hljs-string"><span class="hljs-string">'user'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">table</span></span>: <span class="hljs-string"><span class="hljs-string">'users'</span></span>, <span class="hljs-attr"><span class="hljs-attr">onError</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispatchError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error, store</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> action = { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'ERROR'</span></span>, error }; store.dispatch(action); }, <span class="hljs-attr"><span class="hljs-attr">onSuccess</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispatchUser</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">user, store</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> action = { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'USER'</span></span>, user }; store.dispatch(action); }, <span class="hljs-attr"><span class="hljs-attr">query</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUserQuery</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">store</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> state = store.getState(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(state.note === <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">Id</span></span>: state.note.UserRecordId }; } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rules; }; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = makeRules();</code> </pre> <br><p>  Corro pruebas.  La prueba del conjunto de reglas nuevamente se realiza con √©xito, y me parece que ahora puedo comenzar a escribir c√≥digo para la versi√≥n realmente nueva de solicitar datos de la base de datos.  Esta vez no usar√© la sintaxis de la clase, porque no veo ninguna ventaja de su uso.  Habr√° mucho c√≥digo a la vez, porque copio sin piedad la parte probada de la implementaci√≥n de la solicitud existente, complet√°ndola con una verificaci√≥n, en caso de que el registro de la base de datos ya se haya extra√≠do y colocado en el contenedor de estado.  Entonces el c√≥digo: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dbRequest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">args</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> key = args[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getQuery = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rules.get(key).query; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dispatchUser = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rules.get(key).onSuccess; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dispatchError = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rules.get(key).onError; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tableName = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rules.get(key).table; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> table = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.db.Model.extend({ <span class="hljs-attr"><span class="hljs-attr">tableName</span></span>: tableName }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> state = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.getState(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(state[key] !== <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> query = getQuery(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(query === <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; table.where(query).fetch().then(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function">) =&gt;</span></span> { dispatchUser(item, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store); }).catch(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) =&gt;</span></span> { dispatchError(error, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store); }); } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = dbRequest;</code> </pre> <br><p>  Ejecuci√≥n de pruebas ... tambor roll!  Y veo una l√≠nea de puntos verdes.  Todas las pruebas se completaron con √©xito.  Y, por lo tanto, agregar√© otra prueba al conjunto que verifica la correcci√≥n del manejo de errores, hasta que haya olvidado que para que mi pseudo- <code>DbMock</code> devuelva un error, necesito pedirle una entrada con <code>Id</code> igual a <em>555</em> : </p><br><pre> <code class="javascript hljs">it(<span class="hljs-string"><span class="hljs-string">'should add error in store state'</span></span>, (done) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> assert = checkErrorHasBeenAdded.bind(context, [ done ]); store.subscribe(assert); store.dispatch({<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'NOTE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">note</span></span>: { <span class="hljs-attr"><span class="hljs-attr">Id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">UserRecordId</span></span>: <span class="hljs-number"><span class="hljs-number">555</span></span> }}); request(); }); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkErrorHasBeenAdded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">args</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> state = store.getState(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(state.error.length === <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> error = state.error; expect(<span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.isArray(error)).toBeTruthy(); expect(error.length).toEqual(<span class="hljs-number"><span class="hljs-number">1</span></span>); expect(error[<span class="hljs-number"><span class="hljs-number">0</span></span>].message).toEqual(<span class="hljs-string"><span class="hljs-string">'Something goes wrong!'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> checkIsCompleted = args[<span class="hljs-number"><span class="hljs-number">0</span></span>]; checkIsCompleted(); }</code> </pre> <br><p>  Corro las pruebas de nuevo.  Todo funciona como se esperaba.  Podemos suponer que el prototipo correcto del comando de consulta a la base de datos est√° listo y volver a refactorizar y desarrollar las reglas para configurar consultas, porque ahora est√° claro que el c√≥digo para generar el conjunto de reglas dejar√° de ser legible despu√©s de agregar solo un par de reglas m√°s en el mismo formato. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es436654/">https://habr.com/ru/post/es436654/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es436644/index.html">S√≠mbolos sint√©ticos y m√≥dulos (WinDbg / DbgEng)</a></li>
<li><a href="../es436646/index.html">Transl√∫cido en Android y ajuste.</a></li>
<li><a href="../es436648/index.html">Combinando proyectos en diferentes centros de datos</a></li>
<li><a href="../es436650/index.html">3 estrategias ganadoras de monetizaci√≥n de aplicaciones en 2019</a></li>
<li><a href="../es436652/index.html">MPS 2018.3: planes de generaci√≥n, mejoras en el lenguaje de ensamblaje y empaquetado y en el lenguaje del editor, interfaz actualizada</a></li>
<li><a href="../es436656/index.html">Automatizaci√≥n para los aut√≥nomos: c√≥mo integrar los impuestos con un proyecto de TI</a></li>
<li><a href="../es436658/index.html">El futuro del comercio minorista: tendencias digitales clave basadas en el Big Show 2019 de NRF Retail</a></li>
<li><a href="../es436660/index.html">Mapa de ruta del c√≥digo VS 2019 - BORRADOR</a></li>
<li><a href="../es436662/index.html">1 de febrero de 2019 su sitio puede dejar de funcionar</a></li>
<li><a href="../es436664/index.html">Presentamos la serie .NET Community Standup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>