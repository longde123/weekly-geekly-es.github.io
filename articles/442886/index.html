<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö¥ üë¶üèΩ üëõ Sketch + Node.js: genera iconos para muchas plataformas y marcas. Parte 2 üíÖüèΩ üëÇüèΩ ‚ôâÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Esta es la segunda parte del art√≠culo sobre la creaci√≥n de una herramienta que puede exportar todos los √≠conos ubicados en un archivo de Sketch: en di...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sketch + Node.js: genera iconos para muchas plataformas y marcas. Parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/442886/"><img src="https://habrastorage.org/webt/na/kj/v5/nakjv5srowi99bsjteoqabwtoz8.png"><br><br>  Esta es la segunda parte del art√≠culo sobre la creaci√≥n de una herramienta que puede exportar todos los √≠conos ubicados en un archivo de Sketch: en diferentes formatos, para diferentes plataformas, con la posibilidad de probar A / B de cada √≠cono. <br><br>  Puedes leer la primera parte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">desde el enlace</a> . <br><br><img src="https://habrastorage.org/webt/s6/lt/2d/s6lt2dttycpvlqbolmyeyacaeas.png"><br><br>  La √∫ltima vez, preparamos archivos de croquis que contienen todos los iconos en los estilos correctos y con los nombres correctos.  Es el turno de escribir c√≥digo. <br><br>  Baste decir que pasamos por prueba y error.  Despu√©s de que el l√≠der de nuestro equipo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Nihil Verma</a> , quien sent√≥ las bases del gui√≥n, desarroll√≥ el c√≥digo fuente clave, comenc√© un proceso que requer√≠a al menos tres fases de refactorizaci√≥n y muchas modificaciones.  Por esta raz√≥n, no entrar√© en los detalles de la creaci√≥n del gui√≥n y me centrar√© en c√≥mo funciona hoy, en su forma final. <br><a name="habracut"></a><br><h2>  Construir script </h2><br>  El script de compilaci√≥n escrito en Node.js es bastante sencillo en su trabajo: al importar las dependencias, declarar una lista de archivos de Sketch para procesar (es una lista de marcas, cada una de las cuales tiene una lista de archivos relacionados) y asegurarse de que Sketch est√© instalado en el cliente , el script procesa las marcas a su vez, realizando una serie de acciones con cada una de ellas. <br><br><ol><li>  Toma tokens de dise√±o apropiados para las marcas (necesitamos valores de color). <br></li><li>  Clona archivos de bocetos asociados con la marca, los descomprime para extraer archivos JSON internos y procesa algunos de sus valores internos (m√°s sobre eso m√°s adelante). <br></li><li>  Lee los metadatos necesarios de estos archivos JSON ( <i>document.json</i> , <i>meta.json</i> y <i>pages / pageUniqueID.json</i> ).  Estamos interesados ‚Äã‚Äãen listas de estilos comunes y recursos / √≠conos contenidos en archivos. <br></li><li>  Despu√©s de algunas manipulaciones m√°s con archivos JSON, recrea el archivo y, utilizando archivos Sketch (clonados y actualizados), exporta y crea los archivos de salida finales para tres plataformas (iOS, Android, Web m√≥vil). <br></li></ol><br>  Las partes relevantes del script de compilaci√≥n se pueden encontrar aqu√≠: <br><br><pre><code class="plaintext hljs">// ... modules imports here const SKETCH_FILES = { badoo: ['icons_common'], blendr: ['icons_common', 'icons_blendr'], fiesta: ['icons_common', 'icons_fiesta'], hotornot: ['icons_common', 'icons_hotornot'], }; const SKETCH_FOLDER_PATH = path.resolve(__dirname, '../src/'); const SKETCH_TEMP_PATH = path.resolve(SKETCH_FOLDER_PATH, 'tmp'); const DESTINATION_PATH = path.resolve(__dirname, '../dist'); console.log('Build started...'); if (sketchtool.check()) { console.log(`Processing Sketch file via ${sketchtool.version()}`); build(); } else { console.info('You need Sketch installed to run this script'); process.exit(1); } // ---------------------------------------- function build() { // be sure to start with a blank slate del.sync([SKETCH_TEMP_PATH, DESTINATION_PATH]); // process all the brands declared in the list of Sketch files Object.keys(SKETCH_FILES).forEach(async (brand) =&gt; {   // get the design tokens for the brand   const brandTokens = getDesignTokens(brand);    // prepare the Sketch files (unzipped) and get a list of them   const sketchUnzipFolders = await prepareSketchFiles({     brand,     sketchFileNames: SKETCH_FILES[brand],     sketchFolder: SKETCH_FOLDER_PATH,     sketchTempFolder: SKETCH_TEMP_PATH   });   // get the Sketch metadata   const sketchMetadata = getSketchMetadata(sketchUnzipFolders);   const sketchDataSharedStyles = sketchMetadata.sharedStyles;   const sketchDataAssets = sketchMetadata.assetsMetadata;   generateAssetsPDF({     platform: 'ios',     brand,     brandTokens,     sketchDataSharedStyles,     sketchDataAssets   });   generateAssetsSVGDynamicMobileWeb({     platform: 'mw',     brand,     brandTokens,     sketchDataSharedStyles,     sketchDataAssets   });   generateAssetsVectorDrawableDynamicAndroid({     platform: 'android',     brand,     brandTokens,     sketchDataSharedStyles,     sketchDataAssets   }); }); }</code> </pre> <br>  De hecho, el c√≥digo de la tuber√≠a es mucho m√°s complicado.  La raz√≥n de esta complejidad radica en las <code>prepareSketchFiles</code> , <code>getSketchMetadata</code> y <code>generateAssets[format][platform]</code> .  A continuaci√≥n intentar√© describirlos con m√°s detalle. <br><br><h2>  Preparar archivos de croquis </h2><br>  El primer paso en el proceso de ensamblaje es la preparaci√≥n de archivos de Sketch, que luego se utilizar√°n para exportar recursos para varias plataformas. <br><br>  Los archivos asociados con una marca en particular (por ejemplo, en el caso de Blendr, estos son los <i>archivos</i> <i>icons_common.sketch</i> y <i>icons_blendr.sketch</i> ) se clonan en una carpeta temporal (m√°s precisamente, en una subcarpeta con el nombre de la marca que se procesa) y se descomprimen. <br><br>  Luego se procesan los archivos JSON.  Se agrega un prefijo al nombre de los recursos sujetos a las pruebas A / B; por lo tanto, durante la exportaci√≥n, se guardar√°n en una subcarpeta con un nombre predefinido (correspondiente al nombre √∫nico del experimento).  Puede entender si un recurso est√° sujeto a pruebas A / B por el nombre de la p√°gina en la que est√° almacenado: si es as√≠, el nombre contendr√° el prefijo " <i>XP_</i> ". <br><br><img src="https://habrastorage.org/webt/k7/qo/df/k7qodfiyytkacnk1uknx_6gxhzw.png"><br><br>  En el ejemplo anterior, los recursos exportados se almacenar√°n en una subcarpeta de " <i>this__is_an_experiment</i> " con un nombre de archivo de la forma " <i>icon-name [variant-name] .ext</i> ". <br><br><h2>  Lectura de metadatos de croquis </h2><br>  El segundo paso importante es extraer todos los metadatos necesarios de los archivos de Sketch, o m√°s bien, de los archivos JSON internos.  Como vimos anteriormente, estos son dos archivos principales ( <i>document.json</i> y <i>meta.json</i> ) y archivos de p√°gina ( <i>pages / pageUniqueId.json</i> ). <br><br>  El archivo <i>document.json</i> se usa para obtener la lista de estilos comunes que aparece bajo la propiedad del objeto <i>layerStyles</i> : <br><br><pre> <code class="plaintext hljs">{ "_class": "document", "do_objectID": "45D2DA82-B3F4-49D1-A886-9530678D71DC", "colorSpace": 1, ... "layerStyles": {  "_class": "sharedStyleContainer",  "objects": [    {      "_class": "sharedStyle",      "do_objectID": "9BC39AAD-CDE6-4698-8EA5-689C3C942DB4",      "name": "features/feature-like",      "value": {        "_class": "style",        "fills": [          {            "_class": "fill",            "isEnabled": true,            "color": {              "_class": "color",              "alpha": 1,              "blue": 0.10588235408067703,              "green": 0.4000000059604645,              "red": 1            },            "fillType": 0,            "noiseIndex": 0,            "noiseIntensity": 0,            "patternFillType": 1,            "patternTileScale": 1          }        ],        "blur": {...},        "startMarkerType": 0,        "endMarkerType": 0,        "miterLimit": 10,        "windingRule": 1      }    },    ...</code> </pre> <br>  Almacenamos informaci√≥n b√°sica sobre cada estilo en un objeto de formato clave-valor.  Se usar√° m√°s adelante cuando necesitemos extraer el nombre del estilo basado en una ID √∫nica (propiedad <code>do_objectID</code> en Sketch): <br><br><pre> <code class="plaintext hljs">const parsedSharedStyles = {}; parsedDocument.layerStyles.objects.forEach((object) =&gt; { parsedSharedStyles[object.do_objectID] = {  name: object.name,  isFill: _.get(object, 'value.fills[0].color') !== undefined,  isBorder: _.get(object, 'value.borders[0].color') !== undefined, }; });</code> </pre> <br>  Ahora vamos al archivo <i>meta.json</i> y obtenemos una lista de p√°ginas.  Estamos interesados ‚Äã‚Äãen su <code>unique-id</code> y <code>name</code> <code>unique-id</code> : <br><br><pre> <code class="plaintext hljs">{ "commit": "623a23f2c4848acdbb1a38c2689e571eb73eb823", "pagesAndArtboards": {  "EE6BE8D9-9FAD-4976-B0D8-AB33D2B5DBB7": {    "name": "Icons",    "artboards": {      "3275987C-CE1B-4369-B789-06366EDA4C98": {        "name": "badge-feature-like"      },      "C6992142-8439-45E7-A346-FC35FA01440F": {        "name": "badge-feature-crush"      },      ...      "7F58A1C4-D624-40E3-A8C6-6AF15FD0C32D": {        "name": "tabbar-livestream"      }      ...    }  },  "ACF82F4E-4B92-4BE1-A31C-DDEB2E54D761": {    "name": "XP_this__is_an_experiment",    "artboards": {      "31A812E8-D960-499F-A10F-C2006DDAEB65": {        "name": "this__is_an_experiment/tabbar-livestream[variant1]"      },      "20F03053-ED77-486B-9770-32E6BA73A0B8": {        "name": "this__is_an_experiment/tabbar-livestream[variant2]"      },      "801E65A4-3CC6-411B-B097-B1DBD33EC6CC": {        "name": "this__is_an_experiment/tabbar-livestream[control]"      }    }  },</code> </pre> <br>  Luego leemos los archivos JSON correspondientes a cada p√°gina en la carpeta de <i>p√°ginas</i> (repito que los nombres de los archivos tienen la forma <i>[pageUniqueId] .json</i> ) y estudiamos los recursos almacenados en esta p√°gina (se ven como capas).  Por lo tanto, obtenemos el <b>nombre</b> , el <b>ancho / alto de</b> cada √≠cono, los <b>metadatos del</b> boceto para el √≠cono de esta capa, y si estamos tratando con una p√°gina de <b>experimento</b> , entonces el nombre de la <b>prueba A / B</b> y una <b>variante de</b> este √≠cono. <br><br>  <i>Nota</i> : el objeto page.json tiene un dispositivo muy complejo, por lo que no me detendr√© en √©l.  Si est√° interesado en lo que hay dentro, le aconsejo que cree un nuevo archivo de Sketch vac√≠o, que agregue alg√∫n contenido y lo guarde;  luego cambie el nombre de su extensi√≥n a ZIP, descompr√≠malo y examine uno de los archivos en la carpeta de p√°ginas. <br><br>  En el proceso de procesamiento de mesas de trabajo, tambi√©n crearemos una <b>lista de experimentos</b> (y recursos relacionados).  Lo necesitaremos para determinar qu√© variaciones del √≠cono se utilizan en cada experimento: los nombres de las variaciones del √≠cono se adjuntan al objeto "base". <br><br>  Para cada archivo de Sketch <code>assetsMetadata</code> que se procesa, creamos un objeto de <code>assetsMetadata</code> que se ve as√≠: <br><br><pre> <code class="plaintext hljs">{ "navigation-bar-edit": {  "do_objectID": "86321895-37CE-4B3B-9AA6-6838BEDB0977",  ...sketch_artboard_properties,  "name": "navigation-bar-edit",  "assetname": "navigation-bar-edit",  "source": "icons_common",  "width": 48,  "height": 48  "layers": [    {      "do_objectID": "A15FA03C-DEA6-4732-9F85-CA0412A57DF4",      "name": "Path",      ...sketch_layer_properties,      "sharedStyleID": "6A3C0FEE-C8A3-4629-AC48-4FC6005796F5",      "style": {        ...        "fills": [          {            "_class": "fill",            "isEnabled": true,            "color": {              "_class": "color",              "alpha": 1,              "blue": 0.8784313725490196,              "green": 0.8784313725490196,              "red": 0.8784313725490196            },          }        ],        "miterLimit": 10,        "startMarkerType": 0,        "windingRule": 1      },    },  ],  ... }, "experiment-name/navigation-bar-edit[variant]": {  "do_objectID": "00C0A829-D8ED-4E62-8346-E7EFBC04A7C7",  ...sketch_artboard_properties,  "name": "experiment-name/navigation-bar-edit[variant]",  "assetname": "navigation-bar-edit",  "source": "icons_common",  "width": 48,  "height": 48  ...</code> </pre> <br>  Como puede ver, en el experimento, un solo icono (en este caso, <i>barra de navegaci√≥n-editar</i> ) puede corresponder a muchos recursos.  Al mismo tiempo, el mismo icono puede aparecer bajo el mismo nombre en otro archivo de boceto asociado con la marca.  <b>Esto es muy √∫til</b> : utilizamos este truco para compilar un conjunto com√∫n de iconos y luego identificamos opciones espec√≠ficas seg√∫n la marca.  Es por eso que declaramos los archivos de Sketch asociados con una marca en particular como una matriz: <br><br><pre> <code class="plaintext hljs">const SKETCH_FILES = { badoo: ['icons_common'], blendr: ['icons_common', 'icons_blendr'], fiesta: ['icons_common', 'icons_fiesta'], hotornot: ['icons_common', 'icons_hotornot'], };</code> </pre> <br>  En este caso, el orden es de fundamental importancia.  De hecho, en la funci√≥n <code>getSketchMetadata</code> llamada por el script, no <code>assetsMetadata</code> objetos <code>assetsMetadata</code> uno a la vez como un archivo de lista.  En su lugar, realizamos una fusi√≥n profunda de objetos: los combinamos y devolvemos un √∫nico objeto <code>assetsMetadata</code> . <br><br>  En general, esto no es m√°s que una fusi√≥n "l√≥gica" de archivos Sketch y sus recursos en un solo archivo.  Sin embargo, la l√≥gica no es tan simple como parece.  Aqu√≠ est√° el diagrama que creamos en un intento de descubrir qu√© sucede cuando los iconos con el mismo nombre (y posiblemente sujetos a pruebas A / B) en diferentes archivos est√°n asociados con la misma marca: <br><br><img src="https://habrastorage.org/webt/yg/ug/-6/ygug-6xnds3cvysntithaenmbfw.png"><br><br><h2>  Creaci√≥n de archivos listos para usar en diferentes formatos para diferentes plataformas. </h2><br>  La etapa final de nuestro proceso es crear directamente archivos de iconos en diferentes formatos para diferentes plataformas (PDF para iOS, SVG / JSX para Web y VectorDrawable para Android). <br><br>  Como puede ver en la cantidad de par√°metros pasados ‚Äã‚Äãa las funciones <code>generateAssets[format][platform]</code> , esta parte de la tuber√≠a es la m√°s compleja.  Aqu√≠ es donde el proceso comienza a romperse y cambiar seg√∫n la plataforma.  A continuaci√≥n, ver√° el curso l√≥gico del script en su conjunto y c√≥mo la parte relacionada con la generaci√≥n de recursos se divide en tres procesos similares pero diferentes: <br><br> <a href=""><img src="https://habrastorage.org/webt/jv/83/xy/jv83xyzcpvzmn4snh0xakkrfu8k.png"></a> <br><br>  Para crear recursos listos para usar con los colores correctos correspondientes a la marca que se procesa, necesitaremos realizar algunas manipulaciones m√°s con los archivos JSON.  Revisamos todas las capas a las que se aplica el estilo general y reemplazamos los valores de color con los colores del token de dise√±o de la marca. <br><br>  Para generar archivos para Android, debe realizar una acci√≥n adicional (al respecto un poco m√°s adelante): cambiamos la propiedad de la <code>fill-rule</code> de cada capa de <code>even-odd</code> a <code>even-odd</code> a <code>non-zero</code> (esto est√° controlado por la propiedad <code>windingRule</code> del objeto JSON, en el que 1 significa "impar / par" , y 0 es "no es igual a cero"). <br><br>  Una vez realizadas estas manipulaciones, empaquetamos los archivos JSON en un archivo Sketch est√°ndar para procesar y exportar recursos con propiedades actualizadas (los archivos clonados y actualizados son archivos Sketch normales, se pueden abrir, ver, editar, guardar, etc. ) <br><br>  Despu√©s de eso, usamos SketchTool (envuelto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">bajo Node</a> ) para exportar autom√°ticamente todos los recursos en formatos adecuados para plataformas.  Para cada uno de los archivos asociados con la marca (o m√°s bien, sus versiones clonadas y actualizadas), ejecutamos el siguiente comando: <br><br><pre> <code class="plaintext hljs">sketchtool.run(`export slices ${cloneSketchFile} --formats=svg --scales=1 --output=${destinationFolder} --overwriting`);</code> </pre> <br>  Como puede suponer, este comando exporta recursos a la carpeta de destino en un formato espec√≠fico, opcionalmente usando escala (mantenemos la escala original por ahora).  La clave aqu√≠ es la opci√≥n de <code>-overwriting</code> : al igual que hacemos una fusi√≥n profunda de los objetos de objetos de <code>assetsMetadata</code> (correspondientes a los archivos de boceto "l√≥gicos"), al exportar fusionamos muchos archivos en un directorio (relacionado con la marca / plataforma).  Esto significa que si el recurso, identificado por el nombre de la capa, ya exist√≠a en el archivo Sketch anterior, se sobrescribir√° durante la pr√≥xima exportaci√≥n.  De nuevo, esto no es m√°s que una operaci√≥n de fusi√≥n normal. <br><br>  Sin embargo, en este ejemplo, algunos recursos pueden resultar ser "fantasmas".  Esto sucede cuando el icono en el archivo est√° sujeto a pruebas A / B, pero se sobrescribe en el archivo posterior.  Luego, los archivos variantes se exportan a la carpeta de destino, tienen un enlace correspondiente al recurso en el objeto <code>assetsMetadata</code> (con su clave y propiedades), pero no se asocian con ning√∫n recurso base (debido a la fusi√≥n profunda de los objetos <code>assetsMetadata</code> ).  Dichos archivos se eliminar√°n m√°s tarde, antes de completar el proceso. <br><br><hr><br>  Como ya se mencion√≥, diferentes plataformas requieren diferentes formatos de salida.  Los archivos de iOS se ajustan a los PDF y podemos exportarlos directamente con el comando SketchTool.  Los archivos JSX son necesarios para Mobile Web y VectorDrawable para Android.  Por esta raz√≥n, exportamos recursos en formato SVG a una carpeta temporal y luego los procesamos. <br><br><h2>  PDF para iOS </h2><br>  Curiosamente, PDF es el √∫nico formato (?) Que admite Xcode y OS / iOS para importar y representar recursos vectoriales ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠ hay una breve explicaci√≥n de</a> la elecci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de</a> Apple). <br><br>  Como podemos exportar directamente a PDF a trav√©s de SketchTool, no se requieren pasos adicionales: simplemente guarde los archivos directamente en la carpeta de destino, y eso es todo. <br><br><h2>  Reaccionar / archivos web JSX </h2><br>  En el caso de la Web, utilizamos el nodo de biblioteca SVGR, que le permite convertir SVG a componentes React.  Sin embargo, queremos hacer algo abruptamente: "colorear din√°micamente" el √≠cono en tiempo de ejecuci√≥n (los colores se toman de los tokens).  Para hacer esto, antes de convertir, cambiamos los valores de <code>fill</code> de los vectores a los que se aplic√≥ previamente el estilo general a los valores de los tokens correspondientes a este estilo. <br><br>  Entonces, si el archivo <i>badge-feature-like.svg</i> exportado desde Sketch se ve as√≠: <br><br><pre> <code class="plaintext hljs">&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;svg width="128px" height="128px" viewBox="0 0 128 128" version="1.1" xmlns="&lt;a href="http://www.w3.org/2000/svg"&gt;http://www.w3.org/2000/svg&lt;/a&gt;" xmlns:xlink="&lt;a href="http://www.w3.org/1999/xlink"&gt;http://www.w3.org/1999/xlink&lt;/a&gt;"&gt; &lt;!-- Generator: sketchtool 52.2 (67145) -&lt;a href="http://www.bohemiancoding.com/sketch"&gt; http://www.bohemiancoding.com/sketch&lt;/a&gt; --&gt; &lt;title&gt;badge-feature-like&lt;/title&gt; &lt;desc&gt;Created with sketchtool.&lt;/desc&gt; &lt;g id="Icons" fill="none" fill-rule="evenodd"&gt;  &lt;g id="badge-feature-like"&gt;    &lt;circle id="circle" fill="#E71032" cx="64" cy="64" r="64"&gt;    &lt;path id="Shape" fill="#FFFFFF" d="M80.4061668,..."&gt;&lt;/path&gt;  &lt;/g&gt; &lt;/g&gt; &lt;/svg&gt;</code> </pre> <br>  entonces el <i>icono</i> final resource / <i>badge-feature-like.js</i> se ver√° as√≠: <br><br><pre> <code class="plaintext hljs">/* This file is generated automatically - DO NOT EDIT */ /* eslint-disable max-lines,max-len,camelcase */ const React = require('react'); module.exports = function badge_feature_like({ tokens }) { return (  &lt;svg data-origin="pipeline" viewBox="0 0 128 128"&gt;    &lt;g fill="none" fillRule="evenodd"&gt;      &lt;circle fill={tokens.TOKEN_COLOR_FEATURE_LIKED_YOU} cx={64} cy={64} r={64} /&gt;      &lt;path fill="#FFF" d="M80.4061668,..." /&gt;    &lt;/g&gt;  &lt;/svg&gt; ); };</code> </pre> <br>  Como puede ver, reemplazamos el color de <code>fill</code> est√°tico por uno din√°mico que toma valores de tokens (pueden estar disponibles para el componente Reaccionar <code>&lt;Icon/&gt;</code> trav√©s de la API de contexto, pero esta es una historia diferente). <br><br>  Este reemplazo es posible gracias a los metadatos de Sketch para los activos del objeto <code>assetsMetadata</code> : yendo recursivamente a trav√©s de las capas, puede crear un selector DOM (para el ejemplo anterior, <code>#Icons</code> <code>#badge-feature-like #circle</code> ) y usarlo para buscar un nodo en el √°rbol SVG y reemplazar su valor atributo de <code>fill</code> (para esto necesitamos la biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cheerio</a> ). <br><br><h2>  VectorDrawable Files para Android </h2><br>  Android admite gr√°ficos vectoriales utilizando el formato vectorial personalizado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">VectorDrawable</a> .  Por lo general, la conversi√≥n de SVG a VectorDrawable se realiza <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">directamente en Android Studio</a> .  Sin embargo, quer√≠amos automatizar completamente el proceso, por lo que est√°bamos buscando una forma de convertir usando c√≥digo. <br><br>  Despu√©s de estudiar varias herramientas y bibliotecas, nos decidimos por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">svg2vectordrawable</a> .  No solo es compatible activamente (en cualquier caso, m√°s activo que todos los dem√°s), sino tambi√©n m√°s funcional que el resto. <br><br>  Las realidades son que VectorDrawable y SVG no son iguales en su funcionalidad: algunas funciones SVG (por ejemplo, gradientes radiales y resaltado complejo) no son compatibles con VectorDrawable, mientras que otras comenzaron a ser compatibles recientemente (comenzando con Android API 24).  Uno de los problemas derivados de esto es que las versiones anteriores (hasta 24) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">no admiten el valor par-impar del atributo de regla de relleno</a> .  Sin embargo, en Badoo necesitamos soporte para Android 5 y superior.  Es por eso que, en una de las etapas anteriores, llevamos el <code>fill</code> cada vector en los archivos de Sketch a un valor <code>non-zero</code> . <br><br>  En principio, los dise√±adores pueden realizar esta acci√≥n manualmente: <br><br><img src="https://habrastorage.org/webt/oj/ec/bp/ojecbp2no3lxsas5uwxcqmobcji.png"><br><br>  Pero esto es f√°cil de olvidar y cometer un error.  Por lo tanto, decidimos agregar un paso adicional al proceso para Android, en el cual todos los vectores en JSON se convierten autom√°ticamente a <code>non-zero</code> .  Esto se hace para que al exportar iconos a SVG ya est√©n en el formato requerido, y cada objeto VectorDrawable creado sea compatible con dispositivos en Android 5. <br><br>  El archivo <i>badge-feature-like.xml terminado se</i> ve as√≠: <br><br><pre> <code class="plaintext hljs">&lt;!-- This file is generated automatically - DO NOT EDIT --&gt; &lt;vector xmlns:android="&lt;a href="http://schemas.android.com/apk/res/android"&gt;http://schemas.android.com/apk/res/android&lt;/a&gt;" android:width="128dp" android:height="128dp" android:viewportWidth="128" android:viewportHeight="128"&gt; &lt;path  android:fillColor="?color_feature_liked_you"  android:pathData="M64 1a63 63 0 1 0 0 126A63 63 0 1 0 64 1z" /&gt; &lt;path  android:fillColor="#FFFFFF"  android:pathData="M80.406 ..." /&gt; &lt;/vector&gt;</code> </pre> <br>  En los archivos de VectorDrawable, insertamos nombres de variables para colores de <code>fill</code> , que est√°n asociados con tokens de dise√±o a trav√©s de estilos comunes en aplicaciones de Android. <br><br> <a href=""><img src="https://habrastorage.org/webt/zu/n4/8q/zun48q0knfv8k9xy4amb6eqrxxa.png"></a> <br><br>  Vale la pena se√±alar que Android Studio tiene requisitos estrictos para organizar los recursos: ¬°no hay subcarpetas ni letras may√∫sculas en los nombres!  As√≠ que tuvimos que crear un nuevo formato para los nombres de los √≠conos: en el caso de los recursos que se probar√°n, se ver√°n as√≠: <code>ic_icon-name__experiment-name__variant-name</code> . <br><br><h2>  Diccionario JSON como biblioteca de recursos </h2><br>  Una vez que los archivos de recursos se guardan en el formato final, solo queda recopilar toda la metainformaci√≥n obtenida durante el ensamblaje y guardarla en un "diccionario" para usar cuando los recursos son importados y utilizados por la base de c√≥digo de varias plataformas. <br><br>  Despu√©s de extraer una lista plana de iconos del objeto <code>assetsMetadata</code> revisamos y verificamos cada uno de ellos: <br><br><ul><li>  ¬øEs este un recurso regular (por ejemplo, <code>tabbar-livestream</code> );  si es as√≠, simplemente d√©jalo; <br></li><li>  Si esta es una opci√≥n para una prueba A / B (por ejemplo, <i>experiment / tabbar-livestream [variante]</i> ), asociamos su nombre, ruta, nombres de la prueba A / B y la variante con la propiedad <code>abtests</code> <br>  el recurso base (en nuestro caso es <i>tabbar-livestream</i> ), despu√©s de lo cual eliminamos el registro sobre la variante de la lista / objeto (solo importa el elemento "base"); <br></li><li>  si es un "fantasma", elimine el archivo y elimine la entrada de la lista / objeto. <br></li></ul><br>  Despu√©s de completar este proceso, el diccionario contendr√° una lista de todos los √≠conos b√°sicos (y sus pruebas A / B, si corresponde), y solo ellos.  La informaci√≥n sobre cada uno de ellos incluye el nombre, el tama√±o, la ruta y, si el icono est√° sujeto a pruebas A / B, informaci√≥n sobre sus diversas opciones. <br><br>  El diccionario se guarda en formato JSON en la carpeta de destino para la <i>marca</i> y la <i>plataforma</i> .  Aqu√≠, por ejemplo, est√° el archivo <i>assets.json</i> generado para la aplicaci√≥n Blendr para Mobile Web: <br><br><pre> <code class="plaintext hljs">{ "platform": "mw", "brand": "blendr", "assets": {    "badge-feature-like": {    "assetname": "badge-feature-like",    "path": "assets/badge-feature-like.jsx",    "width": 64,    "height": 64,    "source": "icons_common"  },  "navigation-bar-edit": {    "assetname": "navigation-bar-edit",    "path": "assets/navigation-bar-edit.jsx",    "width": 48,    "height": 48,    "source": "icons_common"  },  "tabbar-livestream": {    "assetname": "tabbar-livestream",    "path": "assets/tabbar-livestream.jsx",    "width": 128,    "height": 128,    "source": "icons_blendr",    "abtest": {      "this__is_an_experiment": {        "control": "assets/this__is_an_experiment/tabbar-livestream__control.jsx",        "variant1": "assets/this__is_an_experiment/tabbar-livestream__variant1.jsx",        "variant2": "assets/this__is_an_experiment/tabbar-livestream__variant2.jsx"      },      "a_second-experiment": {        "control": "assets/a_second-experiment/tabbar-livestream__control.jsx",        "variantA": "assets/a_second-experiment/tabbar-livestream__variantA.jsx"      }    }  },  ... } }</code> </pre> <br>  Ahora todo lo que queda es empacar todas las carpetas de <i>activos</i> en archivos ZIP para facilitar la descarga. <br><br><h2>  Resumen </h2><br>  El proceso descrito en el art√≠culo, desde clonar y manipular archivos de boceto hasta exportar y convertir recursos a formatos compatibles con plataformas y guardar metainformaci√≥n recopilada en la biblioteca de recursos, se repite con cada marca anunciada en el script de compilaci√≥n. <br><br>  Aqu√≠ hay una captura de pantalla que muestra la apariencia de las carpetas <i>src</i> y <i>dist una</i> vez que se completa el proceso: <br><br><img src="https://habrastorage.org/webt/yg/nc/d9/ygncd9uupdngcnav-rmkrsq1dsg.png"><br><br>  En esta etapa, con un comando simple, puede cargar todos los recursos (JSON, ZIP y archivos de recursos) en el almacenamiento remoto y ponerlos a disposici√≥n de todas las plataformas para descargar y usar en la base de c√≥digo. <br><br>  La forma exacta en que las plataformas reciben y procesan los recursos (usando scripts personalizados creados espec√≠ficamente para este prop√≥sito) no va m√°s all√° del alcance de este art√≠culo.  Y esta pregunta probablemente ser√° cubierta en una de las siguientes publicaciones de uno de mis colegas. <br><br><h2>  Conclusi√≥n (y lecciones aprendidas) </h2><br>  Siempre me ha encantado Sketch.  Durante muchos a√±os, el programa ha sido la herramienta predeterminada para desarrolladores y dise√±adores.  Por lo tanto, ten√≠a mucha curiosidad por aprender herramientas de integraci√≥n como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">html-sketchapp</a> y otras herramientas similares que podr√≠amos usar en el flujo de trabajo y nuestras canalizaciones. <br><br>  Yo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">como muchos otros</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">siempre me he esforzado</a> por tal proceso (ideal): <br><br><img src="https://habrastorage.org/webt/kq/7l/n4/kq7ln4kr6txurb-mvh6brqbhnqe.png"><br><br>  Sin embargo, debo admitir que comenc√© a dudar de que Sketch sea una herramienta adecuada, especialmente teniendo en cuenta el sistema de dise√±o.  Por lo tanto, comenc√© a buscar otros servicios, como Figma con sus API abiertas y Framer X con una integraci√≥n conveniente con React, porque no sent√≠a el movimiento de Sketch hacia la integraci√≥n con el c√≥digo (lo que fuera). <br><br>  Entonces, este proyecto me convenci√≥.  No completamente, pero de muchas maneras. <br><br>  Aunque Sketch no abre sus API, el dispositivo mismo de la estructura interna de sus archivos sirve como una especie de API "no oficial".  Los creadores podr√≠an usar nombres cifrados u ocultar claves en objetos JSON, pero en su lugar se adhieren a una convenci√≥n de nomenclatura clara, legible y conceptual.  No creo que esto sea un accidente. <br><br>  El hecho de que los archivos de boceto se puedan administrar de esta manera me ha abierto el camino a muchos desarrollos y mejoras futuros: desde complementos para verificar el nombre, estilizaci√≥n y estructura de capas para los iconos hasta la integraci√≥n con nuestra Wiki y la documentaci√≥n de nuestro sistema de dise√±o (mutuo).  Al crear aplicaciones Node en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Electron</a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Carlo</a> , podemos facilitar que los dise√±adores completen muchas tareas rutinarias. <br><br>    (  ,  )   ,  Sketch-   Cosmos  ¬´ ¬ª ‚Äî      - Cosmos.   ,        (   ;    ,    ‚Äî ).    ,      ‚Äî  ,   ,  . <br><br>      ,  Sketch-  , ,    MVP-,       .    ,     ,     . , , -,  ‚Äî    ,             .  ,         . <br><br>  :       <i></i> ,      <i></i> .   ,       <i></i> . <br><br> ,    , ‚Äî   .  ,  ,       ,    (,         A/B-),            Node.js  Sketch. <br><br>   !     . <br><br><h2>  </h2><br>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> (Mobile Web),     , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> (Android)  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> (iOS),           . <br><br> , !             . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/442886/">https://habr.com/ru/post/442886/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442872/index.html">C√≥mo encontr√© el huevo de Pascua en la protecci√≥n de Android y no consegu√≠ un trabajo en Google</a></li>
<li><a href="../442876/index.html">Mapeo de ruido con KSQL, Raspberry Pi y radio</a></li>
<li><a href="../442880/index.html">Puntos de verificaci√≥n virtuales: lista de verificaci√≥n de configuraci√≥n</a></li>
<li><a href="../442882/index.html">[Video] "No se necesitan piems" y tres ideas m√°s de gesti√≥n de proyectos</a></li>
<li><a href="../442884/index.html">La tecnolog√≠a ya le permite hablar con el autom√≥vil como persona.</a></li>
<li><a href="../442888/index.html">Personalizar select en css puro</a></li>
<li><a href="../442890/index.html">CYOD? COPE? BYOD?</a></li>
<li><a href="../442892/index.html">Programaci√≥n orientada a la depuraci√≥n o tristeza a los ojos del integrador</a></li>
<li><a href="../442896/index.html">La producci√≥n aditiva de ciclo completo en una empresa de aviaci√≥n es un asunto para el futuro cercano</a></li>
<li><a href="../442898/index.html">Soluciones al problema de los bots de spam agregados a grupos de telegramas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>