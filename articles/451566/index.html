<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ö üïå üéà Operation TaskMasters: c√≥mo expusimos a las organizaciones de ataque del grupo cibern√©tico en Rusia y la CEI ü•ü ü§≥ üñäÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Imagen: Unsplash 

 En el oto√±o de 2018, los expertos del PT Expert Security Center revelaron la actividad de un grupo criminal cuyas actividades esta...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Operation TaskMasters: c√≥mo expusimos a las organizaciones de ataque del grupo cibern√©tico en Rusia y la CEI</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/451566/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/lz/hs/uj/lzhsujgy5_y3llxp6xwz38yycfe.png"></a> <br><br>  <i>Imagen: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Unsplash</a></i> <br><br>  En el oto√±o de 2018, los expertos del PT Expert Security Center revelaron la actividad de un grupo criminal cuyas actividades estaban destinadas a robar documentos confidenciales y espionaje.  Hoy hablaremos sobre el progreso de la investigaci√≥n, as√≠ como tambi√©n describiremos los principales m√©todos y herramientas que utiliz√≥ el grupo. <br><br>  <i>Nota</i> : El enlace proporciona un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">informe de</a> investigaci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">completo</a> .  Tambi√©n proporciona indicadores de compromiso que pueden usarse para identificar signos de un ataque. <a name="habracut"></a><br><br><h2>  A qui√©n est√° atacando el grupo y cu√°ndo fue descubierto </h2><br>  La agrupaci√≥n fue identificada por expertos del PT Expert Security Center en 2018.  Los delincuentes utilizaron un m√©todo inusual de protecci√≥n en la infraestructura, basado en la creaci√≥n de tareas espec√≠ficas (tareas) en el programador de tareas, por eso PT ESC llam√≥ al grupo TaskMasters. <br><br>  El Programador de tareas le permite ejecutar comandos del sistema operativo y ejecutar software en un momento espec√≠fico especificado en la tarea.  Adem√°s, el programador AtNow utilizado por esta agrupaci√≥n le permite realizar tareas no solo localmente, sino tambi√©n en computadoras remotas en la red, y hacerlo independientemente de la configuraci√≥n de tiempo de estos nodos.  Adem√°s, esta utilidad no requiere instalaci√≥n.  Estas caracter√≠sticas simplifican la automatizaci√≥n de ataques. <br><br>  Los piratas inform√°ticos piratearon empresas de diferentes pa√≠ses, con un n√∫mero significativo de v√≠ctimas en Rusia y la CEI.  La mayor√≠a de las empresas atacadas pueden atribuirse a la industria.  En total, somos conscientes del compromiso de m√°s de 30 organizaciones en diversas industrias, incluidos los sectores de energ√≠a y petr√≥leo y gas y organismos gubernamentales. <br><br>  El objetivo principal del grupo es robar informaci√≥n confidencial.  Los atacantes intentan afianzarse en el sistema de informaci√≥n corporativo durante mucho tiempo y obtener acceso a los servidores clave de la empresa, las estaciones de trabajo de alta direcci√≥n y los sistemas comerciales cr√≠ticos. <br><br>  Los primeros rastros de la presencia del grupo en la infraestructura se remontan a 2010, y en ese momento los delincuentes ya controlaban completamente algunos servidores y estaciones de trabajo, lo que significa que la penetraci√≥n ocurri√≥ mucho antes. <br><br><h2>  Huella asi√°tica </h2><br>  En el c√≥digo en GitHub del shell web ASPXSpy2014, que se utiliz√≥ durante el ataque, hay enlaces a desarrolladores chinos.  Sin embargo, la versi√≥n que encontramos contiene un enlace a google.ru en su lugar. <br><br><img src="https://habrastorage.org/webt/ag/oh/va/agohvad709ucmllwefycordfjhw.png"><br><br>  <i>ASPXSpy: versiones p√∫blicas y atacadas</i> <br><br>  En las solicitudes de shells web, se identificaron las direcciones IP que pertenecen al proveedor de alojamiento y las imprentas en Europa del Este.  Pero en los eventos del registro del servidor proxy de una de las organizaciones atacadas, el momento en que los atacantes cambiaron a la direcci√≥n IP china residente 115.171.23.103 se reflej√≥, lo que probablemente ocurri√≥ debido a la desconexi√≥n del software VPN en el momento del ataque. <br><br>  Durante el ataque, los atacantes utilizaron una copia del archivo WinRAR, que se activ√≥ con una clave que se distribuye ampliamente en foros cuyos usuarios se comunican en chino. <br><br><img src="https://habrastorage.org/webt/5d/tg/eh/5dtgeh4xjibopstd7zh6altqxas.png"><br><br>  <i>Versi√≥n con licencia de WinRAR en recursos de software</i> <br><br><img src="https://habrastorage.org/webt/dc/qs/as/dcqsas2b1wfkqble9g_pntsvbcc.png"><br><br>  <i>Clave de licencia WinRAR publicada en foros chinos</i> <br><br>  Para una de las tareas, se utiliz√≥ el dominio Brengkolang.com, registrado a trav√©s de un registrador chino.  Adem√°s, muchas utilidades contienen mensajes de error y otra informaci√≥n de depuraci√≥n escrita en ingl√©s con errores, lo que puede indicar que no es nativa de los desarrolladores. <br><br><h2>  C√≥mo act√∫an los atacantes </h2><br>  El vector de ataque general es bastante predecible.  Despu√©s de penetrar en la red local, los atacantes examinan la infraestructura, explotan las vulnerabilidades del sistema (por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CVE-2017-0176</a> ), luego la descargan en nodos comprometidos y desempacan un conjunto de utilidades.  Con este conjunto, buscan, copian y archivan los archivos que les interesan y luego los env√≠an a los servidores de administraci√≥n. <br><br>  Para navegar por la red, los delincuentes ejecutan comandos del sistema en nodos remotos utilizando la utilidad AtNow, que le permite ejecutar software y ejecutar comandos despu√©s de un intervalo de tiempo especificado.  Para administrar los nodos utilizando peque√±as puertas traseras, a trav√©s de las cuales se conectan a los servidores de administraci√≥n.  Al mismo tiempo, hay canales de respaldo en forma de shells web cargados en recursos externos, por ejemplo, en el servidor de Exchange. <br><br><img src="https://habrastorage.org/webt/_t/4n/wv/_t4nwviraqyi6_wd43biwwuovt8.png"><br><br>  <i>Patr√≥n de ataque</i> <br><br>  El grupo utiliza la infraestructura DNS din√°mica para sus dominios.  Los atacantes utilizan un gran conjunto de utilidades y herramientas para realizar ataques cibern√©ticos y utilizan activamente el esquema de ataque de la cadena de suministro. <br><br>  Para escanear la red y comprometer los sistemas, los atacantes usan software libre (incluidos NBTScan, PWDump, Mimikatz).  Adem√°s de las herramientas de terceros, tambi√©n se utilizan programas de desarrollo propio. <br><br>  El software principal del grupo TaskMasters, con el que controlaron los nodos infectados, consta de dos componentes: <br><br><ul><li>  RemShell Downloader - cargador, </li><li>  RemShell: software con un conjunto b√°sico de funciones. </li></ul><br>  Considere con m√°s detalle cada uno de los componentes. <br><br><h2>  Descargador RemShell </h2><br>  Este componente de malware est√° dise√±ado para entregar la carga principal al sistema atacado.  El esquema general del trabajo del gestor de arranque se muestra en la figura a continuaci√≥n. <br><br><img src="https://habrastorage.org/webt/wc/gq/q_/wcgqq_svfh88x9m3gxtf1qamhys.png"><br><br>  <i>Flujo de trabajo del cargador RemShell</i> <br><br>  El cargador accede a la p√°gina HTML en la direcci√≥n previamente especificada en su c√≥digo y lee el valor del atributo Attribute de la etiqueta HTML: <br><br><img src="https://habrastorage.org/webt/of/ug/6c/ofug6cpcp-u6byrh-7ghxx7tf-a.png"><br><br>  <i>Ejemplo de archivo HTML</i> <br><br>  Luego, el valor de lectura se descifra y, seg√∫n lo que contenga, el gestor de arranque entra en modo de espera (comando Suspender) o guarda el archivo PE en el disco y lo inicia.  El archivo PE descargado es solo la carga √∫til: el troyano RemShell principal. <br><br><h2>  Trojan RemShell </h2><br>  RemShell, el principal malware utilizado por los atacantes para controlar los nodos infectados, proporciona a los atacantes las siguientes opciones: <br><br><ol><li>  Terminal para control de host remoto (shell cmd). </li><li>  Subir archivos a un host remoto. </li><li>  Descargue archivos desde un host remoto al servidor de administraci√≥n. </li></ol><br>  El troyano utiliza dos servidores de administraci√≥n.  El primero act√∫a como intermediario o proxy, que a pedido del malware proporciona la direcci√≥n del servidor de administraci√≥n principal.  Adem√°s, se puede recibir un comando del primer servidor de administraci√≥n para transferir malware a otro servidor proxy de administraci√≥n. <br><br><img src="https://habrastorage.org/webt/7r/pg/ll/7rpgll7b5bjlvyyljapucz_hsec.png"><br><br>  <i>Cambiar del primer servidor de administraci√≥n al primario</i> <br><br>  Encontramos varias variaciones de este malware.  En algunos, por ejemplo, no hab√≠a un comando para descargar archivos del nodo al servidor de administraci√≥n; en tales casos, los atacantes usaron una utilidad patentada para cargar archivos.  En otros, se han agregado comandos que le permiten obtener una lista de procesos que se ejecutan en el sistema y completar el proceso mediante PID (identificador de proceso). <br>  Los datos de configuraci√≥n, como la direcci√≥n del servidor proxy de control, el puerto, el agente de usuario, se cifran con RC4 y se configuran mediante constantes en el c√≥digo de malware. <br><br>  Los datos enviados entre los servidores de administraci√≥n y el malware se cifran con el algoritmo RC4 y se codifican adicionalmente con Base64.  La clave para RC4 se genera utilizando una cadena constante calculando el hash MD5.  El resultado de ejecutar comandos recibidos del servidor de administraci√≥n se env√≠a como una solicitud HTTP a la URL con un prefijo espec√≠fico 1111. <br><br>  El malware tambi√©n incluye el mecanismo Heartbeat, que a intervalos aleatorios "toca" con una solicitud HTTP que contiene el resultado del comando hostname a una URL dada con un prefijo espec√≠fico de 0000. <br><br><img src="https://habrastorage.org/webt/ng/-j/f_/ng-jf_ivno95yki2nb0wced6ygo.png"><br><br>  <i>Latido del coraz√≥n</i> <br><br><h2>  Servidores de gestion </h2><br>  La parte del servidor para administrar el malware en los nodos infectados est√° representada por los archivos ELF de la consola.  La interfaz de administraci√≥n del servidor se realiza en forma de shell y admite los comandos presentados en la figura a continuaci√≥n. <br><br><img src="https://habrastorage.org/webt/dm/zc/oy/dmzcoy-l6yk0yizsuueiksglsta.png"><br><br>  El servidor registra en detalle todos los comandos enviados al host remoto.  Estos archivos de registro se almacenan en el disco en forma cifrada.  Para cifrar archivos de registro, se utiliza el algoritmo RC4. <br><br>  Pudimos analizar varias instancias del lado del servidor del malware.  En un caso, encontramos una menci√≥n del desarrollador de AiMi, al que encontramos referencias en otras herramientas del grupo TaskMasters. <br><br><img src="https://habrastorage.org/webt/pv/ie/sv/pviesv3b2-pss7d6tyedpcrk1yg.png"><br><br>  <i>Mencionar a los desarrolladores en la informaci√≥n que muestra el script</i> <br><br><h2>  Web Shell 404-input-shell </h2><br>  La ventana de autorizaci√≥n para acceder a la funcionalidad del shell web se disfraza como la p√°gina de error est√°ndar 404 del servidor web IIS.  Para acceder a la l√≠nea de comandos y ejecutar comandos, debe ingresar una contrase√±a.  El campo de contrase√±a se oculta y se muestra si hace clic en el enlace Atr√°s. <br><br><img src="https://habrastorage.org/webt/q_/wv/x1/q_wvx1r71d3xebktyd7fpwl-th0.png"><br><br><pre><code class="bash hljs">Click the &lt;a href=<span class="hljs-string"><span class="hljs-string">"#"</span></span> ondblclick=<span class="hljs-string"><span class="hljs-string">"history_back()"</span></span>&gt;Back&lt;/a&gt; button to try another link.&lt;/li&gt;</code> </pre> <br>  Para la autorizaci√≥n, los atacantes usaron la contrase√±a 0p; / 9ol.  - utilizaron la misma contrase√±a para encriptar archivos.  El c√≥digo de shell web contiene el hash MD5 de esta contrase√±a. <br><br><img src="https://habrastorage.org/webt/jg/ia/vg/jgiavgy650zj9gonqkmegfuekk8.png"><br><br>  En total, como parte de las investigaciones, descubrimos tres modificaciones de este shell web.  Difieren en funcionalidad: uno de ellos se usa solo para descargar archivos del servidor, el otro para cargar archivos al servidor, el tercero para ejecutar comandos del sistema operativo. <br><br><h2>  Conclusi√≥n </h2><br>  Nuestro estudio muestra que los cibercriminales pueden perseguir no solo objetivos financieros moment√°neos.  Cada vez m√°s, buscan obtener acceso a los datos y capturar el control de los flujos de informaci√≥n de las organizaciones. <br><br>  Las v√≠ctimas del ciberespionaje pueden ser empresas de diversos sectores de la econom√≠a.  Para entender c√≥mo defenderse de tales ataques, es necesario utilizar herramientas especializadas.  Tambi√©n en la etapa de investigaci√≥n, es importante estudiar en detalle las t√°cticas utilizadas por los atacantes.  Es bastante dif√≠cil para las organizaciones resolver este problema por s√≠ mismas, ya que esto requiere no solo herramientas avanzadas, sino tambi√©n especialistas en seguridad de la informaci√≥n altamente calificados.  La implementaci√≥n de las recomendaciones recibidas de los profesionales de seguridad aumentar√° el nivel de seguridad de la infraestructura y complicar√° su pirater√≠a. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/451566/">https://habr.com/ru/post/451566/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451552/index.html">Creamos canales de venta en red del gadget DO-RA</a></li>
<li><a href="../451556/index.html">Flutter: localizaci√≥n de aplicaciones con Android Studio</a></li>
<li><a href="../451558/index.html">Un d√≠a en la vida de la automatizaci√≥n del control de calidad.</a></li>
<li><a href="../451560/index.html">Estimado cliente, es por eso que este cambio tom√≥ tanto tiempo.</a></li>
<li><a href="../451562/index.html">¬øC√≥mo escapar de una secta?</a></li>
<li><a href="../451570/index.html">Mudarse a Francia por trabajo: salarios, visas y curr√≠culums</a></li>
<li><a href="../451572/index.html">Tendencias de tecnolog√≠a de desarrollo web 2019</a></li>
<li><a href="../451574/index.html">Desarrollar una utilidad en GraalVM</a></li>
<li><a href="../451576/index.html">El libro "Nuestro c√≥digo. Artesan√≠a, profesi√≥n, arte "</a></li>
<li><a href="../451580/index.html">MODX Digest # 5 (22 de abril - 13 de mayo de 2019)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>