<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>❓ 🥪 💇🏽 Cara lain untuk mengukur kinerja metode aplikasi .NET 👦🏿 ↖️ 🥑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Seringkali, perlu untuk mengumpulkan statistik tentang kinerja metode aplikasi secara real time (ketika aplikasi sudah berjalan) untuk mengidentifikas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cara lain untuk mengukur kinerja metode aplikasi .NET</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485198/"><p><img src="https://habrastorage.org/webt/-q/hs/z8/-qhsz8oawswkr7chwsijjbkrr1y.png"></p><br><p>  Seringkali, perlu untuk mengumpulkan statistik tentang kinerja metode aplikasi secara real time (ketika aplikasi sudah berjalan) untuk mengidentifikasi hambatannya dan melihat bagian mana dari aplikasi yang melambat. </p><br><p>  Selain itu, alangkah baiknya, selain data kinerja itu sendiri (waktu pengembangan metode, tanggal mulai dan berakhirnya panggilan) untuk menyimpan konteks panggilan di mana kinerja dipantau (seperti argumen pemanggilan metode dan data sewenang-wenang yang ditambahkan oleh pengembang). </p><br><p>  Nah, "cherry on the cake" bisa dianggap kenyamanan dan kesederhanaan alat yang digunakan, yang juga penting. </p><br><p>  Untuk mengatasi masalah ini, pustaka .NET open-source cross-platform <a href="https://github.com/unchase/Unchase.FluentPerformanceMeter" rel="nofollow">Unchase.FluentPerformanceMeter dikembangkan</a> . </p><a name="habracut"></a><br><h2 id="vvedenie">  Pendahuluan </h2><br><p> Jadi, artikel ini adalah deskripsi bekerja dengan <a href="https://github.com/unchase/Unchase.FluentPerformanceMeter" rel="nofollow"><strong>Unchase Fluent Performance Meter</strong></a> , pustaka sumber terbuka lintas-platform <em>.Net Standard 2.0 yang</em> dirancang untuk menghitung kinerja metode. </p><br><p>  Perpustakaan dapat digunakan dalam aplikasi .NET Core dan .NET Framework yang mendukung <em>.Net Standard 2.0</em> , dan memungkinkan: </p><br><ul><li>  <a href="https://habr.com/ru/post/485198/"><strong>Buat pengukuran yang akurat dari</strong></a> kinerja <strong>metode <em>publik</em></strong> untuk <strong>kelas <em>publik</em> dari</strong> kode Anda dan <a href="https://habr.com/ru/post/485198/">kode perpustakaan yang digunakan</a> (dengan menetapkan waktu yang tepat dari awal dan akhir pengukuran); </li><li>  <a href="https://habr.com/ru/post/485198/"><strong>Tambahkan</strong></a> <strong>data tambahan</strong> (Data Khusus) <a href="https://habr.com/ru/post/485198/"><strong>ke hasil</strong></a> pengukuran.  Sebagai contoh, nilai-nilai parameter input metode dan hasilnya;  atau metode data konteks eksekusi;  atau <em>corellationId</em> , dengan mana dimungkinkan untuk menghubungkan beberapa pengukuran kinerja metode; </li><li>  <a href="https://habr.com/ru/post/485198/"><strong>Hancurkan pengukuran</strong></a> kinerja metode <strong>menjadi langkah terpisah</strong> (Langkah) dengan memperbaiki data sendiri untuk setiap langkah.  Selain itu, Anda dapat <a href="https://habr.com/ru/post/485198/">mengatur</a> runtime <a href="https://habr.com/ru/post/485198/">minimum</a> , yang darinya langkah akan diperhitungkan dalam pengukuran (jika langkah tersebut diselesaikan lebih cepat, itu tidak akan diukur); </li><li>  <a href="https://habr.com/ru/post/485198/"><strong>Kecualikan</strong></a> <strong>setiap bagian dari kode</strong> <a href="https://habr.com/ru/post/485198/"><strong>untuk mengukur</strong></a> kinerja (misalnya, panggilan ke metode individual yang waktu pelaksanaannya tidak perlu diperhitungkan saat mengukur); </li><li>  <a href="https://habr.com/ru/post/485198/"><strong>Tambahkan perintah Anda sendiri</strong></a> (Perintah), yang dijamin <strong>akan dieksekusi segera setelah</strong> akhir pengukuran kinerja metode (misalnya, untuk menambahkan pemrosesan tambahan dari hasil yang diperoleh, seperti mencatat atau menulis data ke penyimpanan); </li><li>  <a href="https://habr.com/ru/post/485198/"><strong>Tambahkan exception handler Anda sendiri</strong></a> untuk kode yang dieksekusi dalam konteks pengukuran kinerja metode (keduanya umum untuk semua pengukuran, dan untuk setiap pengukuran secara terpisah); </li><li>  <a href="https://habr.com/ru/post/485198/"><strong>Atur waktu untuk menyimpan hasil</strong></a> pengukuran produktivitas metode, setelah itu hasilnya akan dihapus; </li><li>  <a href="https://habr.com/ru/post/485198/"><strong>Tambahkan</strong></a> data tentang <strong>siapa yang memanggil metode</strong> (Penelepon) melalui <em>tugas IHttpContextAccesor</em> atau Penelepon dalam kode ke hasil pengukuran (misalnya, Anda dapat menentukan nama layanan eksternal yang disebut metode); </li><li>  <a href="https://habr.com/ru/post/485198/"><strong>Tambahkan ke</strong></a> data <a href="https://habr.com/ru/post/485198/"><strong>hasil pengukuran</strong></a> di tempat pengukuran kinerja dimulai (nama file dan nomor baris dengan lokasi panggilan dalam kode); </li><li>  <a href="https://habr.com/ru/post/485198/"><strong>Untuk mengganggu pengukuran</strong></a> kinerja metode <strong>sampai selesai</strong> . </li></ul><br><p>  Data yang diperoleh sebagai hasil pengukuran kinerja metode dapat digunakan untuk menganalisis kinerja aplikasi (bagian individualnya, baik kode internal - asli, dan eksternal - kode perpustakaan yang digunakan) dan ditampilkan dalam bentuk grafik yang nyaman untuk Anda. </p><br><h2 id="soderzhanie">  Isi </h2><br><ul><li>  <a href="https://habr.com/ru/post/485198/">Memulai</a> </li><li>  <a href="https://habr.com/ru/post/485198/">Contoh Penggunaan</a> <br><ul><li>  <a href="https://habr.com/ru/post/485198/">Metode Pengukuran Kinerja</a> </li><li>  <a href="https://habr.com/ru/post/485198/">Metode pengukuran kinerja menggunakan DiagnosticSource</a> </li><li>  <a href="https://habr.com/ru/post/485198/">Mengukur kinerja metode yang digunakan oleh perpustakaan</a> </li><li>  <a href="https://habr.com/ru/post/485198/">Menambahkan Data Tambahan (Data Khusus) dan Paginasi (Langkah)</a> </li><li>  <a href="https://habr.com/ru/post/485198/">Pengecualian dari pengukuran (Abaikan)</a> </li><li>  <a href="https://habr.com/ru/post/485198/">Menambahkan Perintah dan Tindakan</a> </li><li>  <a href="https://habr.com/ru/post/485198/">Menambahkan Penangan Pengecualian</a> </li><li>  <a href="https://habr.com/ru/post/485198/">Mengatur waktu penyimpanan data (Setel Waktu Cache)</a> </li><li>  <a href="https://habr.com/ru/post/485198/">Menambahkan data tentang metode panggilan dan tempat panggilan (gangguan pengukuran kinerja)</a> </li></ul></li></ul><br><h2 id="a-namestarta-nachalo-raboty">  Memulai </h2><br><p>  Untuk menggunakan perpustakaan, instal <a href="https://www.nuget.org/packages/Unchase.FluentPerformanceMeter/" rel="nofollow">paket <em>NuGet</em></a> di proyek Anda: </p><br><h4 id="vruchnuyu-s-pomoschyu-menedzhera-nuget-paketov-package-manager">  Menggunakan Manajer Paket <em>NuGet</em> secara manual: </h4><br><pre><code class="powershell hljs"><span class="hljs-built_in"><span class="hljs-built_in">Install-Package</span></span> Unchase.FluentPerformanceMeter</code> </pre> <br><h4 id="s-pomoschyu-net-cli">  Menggunakan .NET CLI: </h4><br><pre> <code class="powershell hljs">dotnet add package Unchase.FluentPerformanceMeter -<span class="hljs-literal"><span class="hljs-literal">-version</span></span> {version}</code> </pre> <br><blockquote>  Di mana {version} adalah versi paket yang ingin Anda instal. <br>  Misalnya, <code>dotnet add package Unchase.FluentPerformanceMeter --version 1.0.0</code> </blockquote><br><h2 id="a-namesimplesamplesa-primery-ispolzovaniya">  Contoh Penggunaan </h2><br><h3 id="izmerenie-proizvoditelnosti-metoda">  Metode Pengukuran Kinerja </h3><br><p>  Berikut ini adalah contoh sederhana menggunakan perpustakaan (tanpa konfigurasi dan pengaturan tambahan) untuk mengukur kinerja metode (Aksi) <code>SimpleWatchingMethodStart</code> pengontrol <code>SimpleWatchingMethodStart</code> (Pengontrol) <code>PerformanceMeterController</code> <em>Asp.Net Core 2.2</em> aplikasi <em>WebAPI</em> .  Untuk melakukan ini, Anda dapat menggunakan metode ekstensi <code>.WatchingMethod().Start()</code> atau fungsionalitas serupa <code>.StartWatching()</code> . <br>  Sejak v1.0.5, Anda juga dapat menggunakan <code>.WatchingMethod().Start(SimpleWatchingMethodStart)</code> atau <code>.StartWatching(SimpleWatchingMethodStart)</code> dengan nama metode. </p><br><blockquote>  Semua contoh menggunakan perpustakaan dapat ditemukan di proyek <code>Unchase.FluentPerformanceMeter.Test*</code> dari <a href="https://github.com/unchase/Unchase.FluentPerformanceMeter" rel="nofollow">repositori ini</a> . </blockquote><br><pre> <code class="plaintext hljs">/// &lt;summary&gt; /// Test GET method with simple performance watching. /// &lt;/summary&gt; [HttpGet("SimpleWatchingMethodStart")] public ActionResult SimpleWatchingMethodStart() { // for C# 8 you can use: //using var pm = PerformanceMeter&lt;PerformanceMeterController&gt;.StartWatching(); using (PerformanceMeter&lt;PerformanceMeterController&gt;.WatchingMethod().Start()) { // put your code with some logic here return Ok(); } }</code> </pre> <br><p>  Untuk mendapatkan hasil pengukuran kinerja metode publik dari kelas controller <code>PerformanceMeterController</code> , Anda dapat memanggil metode berikut: </p><br><pre> <code class="plaintext hljs">/// &lt;summary&gt; /// Get methods performance info for this controller. /// &lt;/summary&gt; /// &lt;returns&gt;Returns methods performance info.&lt;/returns&gt; [HttpGet("GetPerformanceInfo")] [IgnoreMethodPerformance] public ActionResult&lt;IPerformanceInfo&gt; GetPerformanceInfo() { return Ok(PerformanceMeter&lt;PerformanceMeterController&gt;.PerformanceInfo); }</code> </pre> <br><p>  Setelah memanggil metode <code>SimpleWatchingMethodStart</code> saat memanggil <code>GetPerformanceInfo</code> kita mendapatkan: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"methodCalls"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleWatchingMethodStart"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"elapsed"</span></span>: <span class="hljs-string"><span class="hljs-string">"00:00:00.0016350"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"caller"</span></span>: <span class="hljs-string"><span class="hljs-string">"unknown"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"startTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T10:27:27.3385385Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"endTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T10:27:27.3401735Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: {}, <span class="hljs-attr"><span class="hljs-attr">"steps"</span></span>: [] } ], <span class="hljs-attr"><span class="hljs-attr">"totalActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleWatchingMethodStart"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"currentActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleWatchingMethodStart"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"uptimeSince"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T10:27:27.3370183Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"className"</span></span>: <span class="hljs-string"><span class="hljs-string">"Unchase.FluentPerformanceMeter.TestWebAPI.Controllers.PerformanceMeterController"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"methodNames"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"SimpleWatchingMethodStart"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: {}, <span class="hljs-attr"><span class="hljs-attr">"timerFrequency"</span></span>: <span class="hljs-number"><span class="hljs-number">10000000</span></span> }</code> </pre> <br><h3 id="a-namediagnosticsourcesamplea-izmerenie-proizvoditelnosti-metoda-s-pomoschyu-diagnosticsource">  Metode pengukuran kinerja menggunakan <code>DiagnosticSource</code> </h3><br><p>  Dimulai dengan versi <em>v1.1.0</em> , menjadi mungkin untuk mengukur kinerja metode dalam aplikasi <em>AspNetCore MVC</em> menggunakan <code>DiagnosticSource</code> dan atribut khusus <code>WatchingWithDiagnosticSourceAttribute</code> . <br>  Untuk melakukan ini, tambahkan paket <a href="" rel="nofollow"><code>Unchase.FluentPerformanceMeter.AspNetCore.Mvc</code></a> ke proyek <em>NuGet</em> dan tambahkan kode berikut ke <code>Startap.cs</code> : </p><br><pre> <code class="plaintext hljs">public void ConfigureServices(IServiceCollection services) { // ... // allows to measure methods performance for class "MeasurableClass" and "MeasurableSecondClass" services.AddPerformanceDiagnosticObserver&lt;MeasurableClass&gt;(); services.AddPerformanceDiagnosticObserver&lt;MeasurableSecondClass&gt;(); // ... the same for another classes services.AddMvc(); // ... } public void Configure(IApplicationBuilder app, IHostingEnvironment env) { // ... app.UsePerformanceDiagnosticObserver(); app.UseMvc(); }</code> </pre> <br><p>  Kemudian tandai dengan atribut <code>WatchingWithDiagnosticSourceAttribute</code> atau metode individual: </p><br><pre> <code class="plaintext hljs">[HttpGet("SimpleWatchingMethodStart")] [WatchingWithDiagnosticSource] public ActionResult SimpleWatchingMethodStart() { return Ok(); }</code> </pre> <br><p>  atau seluruh kelas: </p><br><pre> <code class="plaintext hljs">[ApiController] [Route("api/v1/[controller]")] [Produces("application/json")] [SwaggerTag("Unchase.PerformanceMeter Test WebAPI Controller")] [WatchingWithDiagnosticSource] public class PerformanceMeterController : ControllerBase { // measurable methods }</code> </pre> <br><p>  Dimulai dengan versi <em>v1.2.0</em> , menjadi mungkin untuk menambahkan argumen doa ke data pengukuran kinerja metode pengguna dalam aplikasi <em>AspNetCore MVC</em> menggunakan atribut <code>AddMethodArgumentsToCustomDataAttribute</code> khusus bersama dengan atribut <code>WatchingWithDiagnosticSourceAttribute</code> : </p><br><pre> <code class="plaintext hljs">[HttpPost("SimpleWatchingMethodStartWithArgs")] [WatchingWithDiagnosticSource] [AddMethodArgumentsToCustomData("actionArguments")] public ActionResult SimpleWatchingMethodStartWithArgs(DTOArgument arg) { return Ok(); }</code> </pre> <br><p>  Setelah memanggil metode <code>SimpleWatchingMethodStartWithArgs</code> saat memanggil <code>GetPerformanceInfo</code> kita mendapatkan: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"methodCalls"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleWatchingMethodStartWithArgs"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"elapsed"</span></span>: <span class="hljs-string"><span class="hljs-string">"00:00:00.0016350"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"caller"</span></span>: <span class="hljs-string"><span class="hljs-string">"unknown"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"startTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T10:27:27.3385385Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"endTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T10:27:27.3401735Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"actionArguments"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"arg"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;string_in_DTOArgument&gt;"</span></span> } } }, <span class="hljs-attr"><span class="hljs-attr">"steps"</span></span>: [] } ], <span class="hljs-attr"><span class="hljs-attr">"totalActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleWatchingMethodStartWithArgs"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"currentActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleWatchingMethodStartWithArgs"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"uptimeSince"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T10:27:27.3370183Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"className"</span></span>: <span class="hljs-string"><span class="hljs-string">"Unchase.FluentPerformanceMeter.TestWebAPI.Controllers.PerformanceMeterController"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"methodNames"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"SimpleWatchingMethodStartWithArgs"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: {}, <span class="hljs-attr"><span class="hljs-attr">"timerFrequency"</span></span>: <span class="hljs-number"><span class="hljs-number">10000000</span></span> }</code> </pre> <br><h3 id="a-namesampleexternala-izmerenie-proizvoditelnosti-metoda-ispolzuemoy-biblioteki">  Mengukur kinerja metode yang digunakan oleh perpustakaan </h3><br><p>  Untuk mengukur kinerja metode <em>publik</em> dari kelas <em>publik</em> dari perpustakaan pihak ketiga yang digunakan, Anda harus secara eksplisit mengatur kelas itu sendiri dan nama metodenya: </p><br><pre> <code class="plaintext hljs">[HttpGet("GetThreadSleepPerformance")] public ActionResult&lt;string&gt; GetThreadSleepPerformance() { using (PerformanceMeter&lt;Thread&gt;.WatchingMethod(nameof(Thread.Sleep)).Start()) { Thread.Sleep(1000); } return Ok(PerformanceMeter&lt;Thread&gt;.PerformanceInfo.MethodCalls.FirstOrDefault(ta =&gt; ta.MethodName == nameof(Thread.Sleep))?.Elapsed); }</code> </pre> <br><p>  Metode yang dieksekusi akan kembali: </p><br><pre> <code class="plaintext hljs">"00:00:01.0033040"</code> </pre> <br><p>  Anda dapat memperoleh data tentang cara memanggil metode ini melalui panggilan: </p><br><pre> <code class="plaintext hljs">/// &lt;summary&gt; /// Get methods performance info for Thread class. /// &lt;/summary&gt; /// &lt;returns&gt;Returns Thread methods performance info.&lt;/returns&gt; [HttpGet("GetThreadPerformanceInfo")] [IgnoreMethodPerformance] public ActionResult&lt;IPerformanceInfo&gt; GetThreadPerformanceInfo() { return Ok(PerformanceMeter&lt;Thread&gt;.PerformanceInfo); }</code> </pre> <br><blockquote>  Atribut <code>IgnoreMethodPerformance</code> dirancang sehingga metode yang <code>IgnoreMethodPerformance</code> tidak diperhitungkan saat mengukur kinerja. </blockquote><p>  Menanggapi panggilan untuk metode ini akan: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"methodCalls"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Sleep"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"elapsed"</span></span>: <span class="hljs-string"><span class="hljs-string">"00:00:01.0033040"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"caller"</span></span>: <span class="hljs-string"><span class="hljs-string">"unknown"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"startTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T13:08:09.336624Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"endTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T13:08:10.339928Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: {}, <span class="hljs-attr"><span class="hljs-attr">"steps"</span></span>: [] } ], <span class="hljs-attr"><span class="hljs-attr">"totalActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Abort"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, // ... { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Sleep"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } // ... ], <span class="hljs-attr"><span class="hljs-attr">"currentActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Abort"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, // ... { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Sleep"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } // ... ], <span class="hljs-attr"><span class="hljs-attr">"uptimeSince"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T13:08:09.3357028Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"className"</span></span>: <span class="hljs-string"><span class="hljs-string">"System.Threading.Thread"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"methodNames"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"Abort"</span></span>, // ... <span class="hljs-string"><span class="hljs-string">"Sleep"</span></span>, // ... ], <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: {}, <span class="hljs-attr"><span class="hljs-attr">"timerFrequency"</span></span>: <span class="hljs-number"><span class="hljs-number">10000000</span></span> }</code> </pre> <br><h3 id="a-namesamplecustomdataa-dobavlenie-dopolnitelnyh-dannyh-custom-data-i-razbienie-na-shagi-steps">  Menambahkan Data Tambahan (Data Khusus) dan Paginasi (Langkah) </h3><br><p>  Anda dapat menambahkan data tambahan (Data Khusus) untuk semua pengukuran kinerja metode kelas tertentu.  Misalnya, dalam konstruktor statis dari kelas controller <code>PerformanceMeterController</code> : </p><br><pre> <code class="plaintext hljs">[ApiController] [Route("api/v1/[controller]")] public class PerformanceMeterController : ControllerBase { /// &lt;summary&gt; /// Static constructor. /// &lt;/summary&gt; static PerformanceMeterController() { // add common custom data (string) to class performance information PerformanceMeter&lt;PerformanceMeterController&gt;.AddCustomData("Tag", "CustomTag"); // add common custom data (anonymous class) to class performance information PerformanceMeter&lt;PerformanceMeterController&gt;.AddCustomData("Custom anonymous class", new { Name = "Custom Name", Value = 1 }); } // ... actions }</code> </pre> <br><p>  Selain itu, Anda dapat menambahkan data tambahan (Data Khusus) untuk pengukuran tertentu menggunakan metode ekstensi <code>.WithSettingData.CustomData("&lt;key&gt;", &lt;value&gt;)</code> (termasuk melalui atribut khusus metode <code>MethodCustomDataAttribute</code> ) dan untuk setiap langkah (Langkah ) pengukuran ini, ditambahkan menggunakan <code>.Step("&lt;step_name&gt;")</code> ekstensi <code>.Step("&lt;step_name&gt;")</code> , menggunakan <code>.AddCustomData("&lt;key&gt;", &lt;value&gt;)</code> ekstensi <code>.AddCustomData("&lt;key&gt;", &lt;value&gt;)</code> : </p><br><pre> <code class="plaintext hljs">/// &lt;summary&gt; /// Test GET method with simple performance watching (with steps). /// &lt;/summary&gt; [HttpGet("SimpleStartWatchingWithSteps")] [MethodCustomData("Custom data from attribute", "Attr")] public ActionResult SimpleStartWatchingWithSteps() { using (var pm = PerformanceMeter&lt;PerformanceMeterController&gt; .WatchingMethod() .WithSettingData .CustomData("coins", 1) .CustomData("Coins sets", new { Gold = "Many", Silver = 5 }) .Start()) { // put your code with some logic here // add "Step 1" using (pm.Step("Step 1")) { Thread.Sleep(1000); } // add "Step 2" with custom data using (var pmStep = pm.Step("Step 2").AddCustomData("step2 custom data", "data!")) { // add "Step 3 in Step 2" using (pm.Step("Step 3 in Step 2")) { Thread.Sleep(1000); } // add custom data to "Step 2" pmStep.AddCustomData("step2 another custom data", "data2!"); // get and remove custom data from "Step 2" var customData = pmStep.GetAndRemoveCustomData&lt;string&gt;("step2 custom data"); // get custom data from "Step 2" (without removing) var anotherCustomData = pmStep.GetCustomData&lt;string&gt;("step2 another custom data"); // ... } } }</code> </pre> <br><p>  Akibatnya, saat memanggil <code>GetPerformanceInfo</code> kami mendapatkan: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"methodCalls"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleStartWatchingWithSteps"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"elapsed"</span></span>: <span class="hljs-string"><span class="hljs-string">"00:00:02.0083031"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"caller"</span></span>: <span class="hljs-string"><span class="hljs-string">"unknown"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"startTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T11:58:18.9006891Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"endTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T11:58:20.9089922Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Coins sets"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"gold"</span></span>: <span class="hljs-string"><span class="hljs-string">"Many"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"silver"</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"coins"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Custom data from attribute"</span></span>: <span class="hljs-string"><span class="hljs-string">"Attr"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"steps"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"stepName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Step 1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"elapsed"</span></span>: <span class="hljs-string"><span class="hljs-string">"00:00:01.0009758"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"startTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T11:58:18.9018272Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"endTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T11:58:19.902803Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: {} }, { <span class="hljs-attr"><span class="hljs-attr">"stepName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Step 3 in Step 2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"elapsed"</span></span>: <span class="hljs-string"><span class="hljs-string">"00:00:01.0004549"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"startTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T11:58:19.9046523Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"endTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T11:58:20.9051072Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: {} }, { <span class="hljs-attr"><span class="hljs-attr">"stepName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Step 2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"elapsed"</span></span>: <span class="hljs-string"><span class="hljs-string">"00:00:01.0029596"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"startTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T11:58:19.904534Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"endTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T11:58:20.9074936Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"step2 another custom data"</span></span>: <span class="hljs-string"><span class="hljs-string">"data2!"</span></span> } } ] } ], <span class="hljs-attr"><span class="hljs-attr">"totalActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleStartWatchingWithSteps"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"currentActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleStartWatchingWithSteps"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"uptimeSince"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T11:58:18.8801249Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"className"</span></span>: <span class="hljs-string"><span class="hljs-string">"Unchase.FluentPerformanceMeter.TestWebAPI.Controllers.PerformanceMeterController"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"methodNames"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"SimpleStartWatchingWithSteps"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Tag"</span></span>: <span class="hljs-string"><span class="hljs-string">"CustomTag"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Custom anonymous class"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Custom Name"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"timerFrequency"</span></span>: <span class="hljs-number"><span class="hljs-number">10000000</span></span> }</code> </pre> <br><h3 id="a-namesampleignorea-isklyuchenie-iz-zamera-ignore">  Pengecualian dari pengukuran (Abaikan) </h3><br><p>  Anda dapat mengabaikan setiap bagian dari metode ini dalam mengukur kinerja (menggunakan <code>.Ignore()</code> atau <code>.Executing().WithoutWatching().Start(&lt;Action&gt;)</code> ), dan juga tidak menyimpan langkah individual (metode ekstensi <code>.StepIf("&lt;step_name&gt;", &lt;minSaveMs&gt;)</code> ) jika mereka tidak memenuhi ketentuan (waktu eksekusi langkah akan diperhitungkan dalam waktu eksekusi metode): </p><br><pre> <code class="plaintext hljs">using (var pm = PerformanceMeter&lt;PerformanceMeterController&gt;.WatchingMethod().Start()) { // put your code with some logic here // sleep 1 sec Thread.Sleep(1000); // ignore this block in performance watching using (pm.Ignore()) { Thread.Sleep(5000); } // skip this step with minSaveMs (not save, but consider duration in method performance watching) using (pm.StepIf("Skipped step", minSaveMs: 1000)) { Thread.Sleep(500); } // execute action without performance watching pm.Executing().WithoutWatching().Start(() =&gt; { Thread.Sleep(2000); }); return Ok(); }</code> </pre> <br><p>  Sebagai hasilnya, kita mendapatkan: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"methodCalls"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleStartWatchingWithIgnored"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"elapsed"</span></span>: <span class="hljs-string"><span class="hljs-string">"00:00:01.5080227"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"caller"</span></span>: <span class="hljs-string"><span class="hljs-string">"unknown"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"startTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T12:34:36.9187359Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"endTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T12:34:38.4267586Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: {}, <span class="hljs-attr"><span class="hljs-attr">"steps"</span></span>: [] } ], <span class="hljs-attr"><span class="hljs-attr">"totalActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleStartWatchingWithIgnored"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"currentActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleStartWatchingWithIgnored"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"uptimeSince"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T12:34:36.9035129Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"className"</span></span>: <span class="hljs-string"><span class="hljs-string">"Unchase.FluentPerformanceMeter.TestWebAPI.Controllers.PerformanceMeterController"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"methodNames"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"SimpleStartWatchingWithIgnored"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: { }, <span class="hljs-attr"><span class="hljs-attr">"timerFrequency"</span></span>: <span class="hljs-number"><span class="hljs-number">10000000</span></span> }</code> </pre> <br><h3 id="a-namesamplecustomcommandsa-dobavlenie-komand-commands-i-deystviy-actions">  Menambahkan Perintah dan Tindakan </h3><br><p>  Untuk menambahkan perintah yang akan dijamin akan dieksekusi setelah selesai mengukur kinerja metode, perlu untuk membuat kelas perintah yang akan mengimplementasikan antarmuka <code>IPerformanceCommand</code> . <br>  Pada saat yang sama, Anda dapat mentransfer data sewenang-wenang melalui konstruktor dari perintah yang dibuat yang akan digunakan selama eksekusi.  Sebagai contoh: </p><br><pre> <code class="plaintext hljs">/// &lt;summary&gt; /// Custom executed command. /// &lt;/summary&gt; public class ExecutedCommand : IPerformanceCommand { /// &lt;summary&gt; /// Executed commad name. /// &lt;/summary&gt; public string CommandName =&gt; this.GetType().Name; private string _customString { get; } internal bool IsCommandExecuted { get; private set; } /// &lt;summary&gt; /// Constructor. /// &lt;/summary&gt; /// &lt;remarks&gt; /// You can pass any data through the command constructor. /// &lt;/remarks&gt; /// &lt;param name="customString"&gt;&lt;/param&gt; public ExecutedCommand(string customString) { this._customString = customString; } /// &lt;summary&gt; /// Execute command. /// &lt;/summary&gt; /// &lt;param name="performanceInfo"&gt;&lt;see cref="IPerformanceInfo"/&gt;.&lt;/param&gt; public void Execute(IPerformanceInfo performanceInfo) { // for example, write to the debug console some information Debug.WriteLine(this.CommandName); Debug.WriteLine(this._customString); Debug.WriteLine($"Method names count: {performanceInfo.MethodNames.Count}"); this.IsCommandExecuted = true; } }</code> </pre> <br><p>  Anda bisa menambahkan perintah (IPerformanceCommand) dan tindakan (Aksi) sehingga dijalankan di akhir pengukuran, dengan cara berikut: </p><br><pre> <code class="plaintext hljs">// custom "ExecutedCommand" will be executed after performance watching is completed using (PerformanceMeter&lt;PerformanceMeterController&gt; .WatchingMethod() .WithExecutingOnComplete .Command(new ExecutedCommand("bla-bla-bla")) .Action((pi) =&gt; { Debug.WriteLine($"Class name: {pi.ClassName}"); }) .Start()) { return Ok(); }</code> </pre> <br><p>  Akibatnya, pada akhir pengukuran kinerja metode di <em>Debug-</em> konsol, itu akan menampilkan: </p><br><pre> <code class="plaintext hljs">ExecutedCommand bla-bla-bla Method names count: 13 Class name: Unchase.FluentPerformanceMeter.TestWebAPI.Controllers.PerformanceMeterController</code> </pre> <br><h3 id="a-namesamplecustomexceptionhandlera-dobavlenie-obrabotchikov-isklyucheniy-exception-handlers">  Menambahkan Penangan Pengecualian </h3><br><p>  Jika Anda perlu menangani pengecualian yang mungkin terjadi selama pelaksanaan bagian dari metode yang kinerjanya dipantau, Anda perlu menambahkan penangan pengecualian sebagai berikut: </p><br><pre> <code class="plaintext hljs">using (var pm = PerformanceMeter&lt;PerformanceMeterController&gt;.StartWatching()) { // execute action throws Exception with exception handler pm.Executing() .WithExceptionHandler((ex) =&gt; Debug.WriteLine(ex.Message)) .Start(() =&gt; throw new Exception("Exception")); // execute action throws custom Exception with exception handler pm.Executing&lt;CustomException&gt;() .WithExceptionHandler((ex) =&gt; { Debug.WriteLine(ex.Message); }) .Start(() =&gt; { throw new CustomException("Custom exception was occured!"); }); return Ok(); }</code> </pre> <br><p>  Di mana kelas <code>CustomException</code> , misalnya: </p><br><pre> <code class="plaintext hljs">/// &lt;summary&gt; /// Custom exception. /// &lt;/summary&gt; public class CustomException : Exception { public CustomException(string message) : base(message) { } public CustomException(string message, Exception innerException) : base(message, innerException) { } public CustomException() { } }</code> </pre> <br><p>  Akibatnya, konsol <em>Debug</em> akan menampilkan: </p><br><pre> <code class="plaintext hljs">Exception Custom exception was occured!</code> </pre> <br><p>  Selain itu, Anda dapat menentukan penangan pengecualian yang akan digunakan secara default untuk mengukur kinerja metode apa pun dari kelas ini, misalnya, melalui konstruktor statis dari kelas pengontrol <code>PerformanceMeterController</code> : </p><br><pre> <code class="plaintext hljs">[ApiController] [Route("api/v1/[controller]")] public class PerformanceMeterController : ControllerBase { /// &lt;summary&gt; /// Static constructor. /// &lt;/summary&gt; static PerformanceMeterController() { // set default exception handler for PerformanceMeterController class PerformanceMeter&lt;PerformanceMeterController&gt;.SetDefaultExceptionHandler((ex) =&gt; Debug.WriteLine(ex.Message)); } // ... actions }</code> </pre> <br><h3 id="a-namesamplesettingcachetimea-ustanovka-vremeni-hraneniya-dannyh-set-cache-time">  Mengatur waktu penyimpanan data (Setel Waktu Cache) </h3><br><p>  Anda dapat mengatur waktu penyimpanan untuk data pengukuran kinerja metode, setelah itu data ini akan dihapus.  Untuk setiap kelas yang pengukurannya dilakukan, waktu ini diatur secara terpisah.  Misalnya, waktu dapat diatur melalui konstruktor statis dari kelas controller <code>PerformanceMeterController</code> : </p><br><pre> <code class="plaintext hljs">[ApiController] [Route("api/v1/[controller]")] public class PerformanceMeterController : ControllerBase { /// &lt;summary&gt; /// Static constructor. /// &lt;/summary&gt; static PerformanceMeterController() { // set cache time for PerformanceMeterController class PerformanceMeter&lt;PerformanceMeterController&gt;.SetMethodCallsCacheTime(5); } // ... actions }</code> </pre> <br><h3 id="a-namesamplesetcallerandsourcewithstopa-dobavlenie-dannyh-o-vyzyvayuschem-metod-i-meste-vyzova-i-preryvanie-zamera-proizvoditelnosti">  Menambahkan data tentang metode panggilan dan tempat panggilan (dan mengganggu pengukuran kinerja) </h3><br><ul><li><p>  Anda dapat menentukan siapa yang memanggil metode menggunakan metode ekstensi <code>.CallerFrom("&lt;caller_name&gt;")</code> (baik string atau <em>IHttpContextAccessor diteruskan ke sana</em> ) atau atribut khusus dari metode <code>[MethodCaller("&lt;caller_name&gt;")]</code> .  Selain itu, jika atribut dan metode ekstensi digunakan, maka nilainya akan diambil dari yang terakhir. </p><br></li><li><p>  Metode ekstensi <code>.WithSettingData.CallerSourceData()</code> digunakan untuk menambahkan titik panggilan untuk mengukur kinerja. </p><br></li><li><p>  Untuk berhenti mengukur kinerja di dalam blok <code>using</code> , gunakan metode ekstensi <code>.StopWatching()</code> atau metode <code>Dispose()</code> langsung: </p><br></li></ul><br><pre> <code class="plaintext hljs">[HttpPost("StartWatchingWithCallerName")] [MethodCaller("testCaller")] public ActionResult&lt;string&gt; StartWatchingWithCallerName([FromBody] string value) { // method performance info will reach with caller name (if internal HttpContextAccessor is null) using (var pm = PerformanceMeter&lt;PerformanceMeterController&gt; .WatchingMethod() .WithSettingData .CallerSourceData() .CallerFrom("Test caller") .Start()) { pm.StopWatching(); // stop watching here (or you can use "pm.Dispose();") Thread.Sleep(2000); return Ok(value); } }</code> </pre> <br><p>  Sebagai hasil dari memanggil metode <code>GetPerformanceInfo</code> , <code>GetPerformanceInfo</code> mendapatkan: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"methodCalls"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"StartWatchingWithCallerName"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"elapsed"</span></span>: <span class="hljs-string"><span class="hljs-string">"00:00:00.0019172"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"caller"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test caller"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"startTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T13:35:45.3164507Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"endTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T13:35:45.3183679Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"customData123"</span></span>: <span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callerSourceLineNumber"</span></span>: <span class="hljs-number"><span class="hljs-number">525</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callerSource"</span></span>: <span class="hljs-string"><span class="hljs-string">"D:\\GitHub\\Unchase.FluentPerformanceMeter\\Unchase.FluentPerformanceMeter.TestWebAPI\\Controllers\\PerformanceMeterController.cs"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"steps"</span></span>: [] } ], <span class="hljs-attr"><span class="hljs-attr">"totalActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"StartWatchingWithCallerName"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"currentActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"StartWatchingWithCallerName"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"uptimeSince"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T13:35:45.2601668Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"className"</span></span>: <span class="hljs-string"><span class="hljs-string">"Unchase.FluentPerformanceMeter.TestWebAPI.Controllers.PerformanceMeterController"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"methodNames"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"StartWatchingWithCallerName"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: { }, <span class="hljs-attr"><span class="hljs-attr">"timerFrequency"</span></span>: <span class="hljs-number"><span class="hljs-number">10000000</span></span> }</code> </pre> <br><h2 id="zaklyuchenie">  Kesimpulan </h2><br><p>  Dengan demikian, solusi yang disajikan memungkinkan kami untuk mengotomatisasi sebagian pengumpulan informasi tentang kinerja metode aplikasi .NET dengan cara yang lebih nyaman.  Data yang dikumpulkan dapat divisualisasikan dengan cara yang lebih cocok untuk setiap pengembang spesifik. </p><br><p>  Tentu saja, perpustakaan tidak menyelesaikan semua masalah yang terkait dengan pengumpulan data tentang kinerja metode, tetapi berusaha untuk menyederhanakan yang paling umum. </p><br><p>  Perpustakaan adalah solusi open-source, setiap saran dan saran untuk pengembangannya hanya diterima, demikian juga laporan bug (semua orang dapat mengikuti <a href="https://github.com/unchase/Unchase.FluentPerformanceMeter/issues" rel="nofollow">tautan</a> ; penulis akan berterima kasih atas bantuan apa pun!). </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id485198/">https://habr.com/ru/post/id485198/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id485184/index.html">Hasil Jajak Pendapat Tab</a></li>
<li><a href="../id485186/index.html">Startup bernilai trilyun dolar atau bagaimana perusahaan Valley paling sukses dilahirkan</a></li>
<li><a href="../id485190/index.html">Andrew Eun "Gairah Belajar Mesin." Terjemahan bab 47-58</a></li>
<li><a href="../id485194/index.html">Pohon segmen: cepat dan mudah</a></li>
<li><a href="../id485196/index.html">AvitoTech On Tour: Pergi dan berhadapan rapat di Kazan</a></li>
<li><a href="../id485200/index.html">Mess pada awalnya: post-mortem pada kecepatan peluncuran aplikasi iOS</a></li>
<li><a href="../id485202/index.html">Sistem Penindasan</a></li>
<li><a href="../id485204/index.html">Kembali ke atas: mengapa kapitalisasi Amazon akan segera melebihi $ 1 triliun</a></li>
<li><a href="../id485206/index.html">Bagaimana Typcript mengecewakan saya dan apakah itu layak?</a></li>
<li><a href="../id485208/index.html">Pembuatan infrastruktur TI yang toleran terhadap kesalahan. Bagian 2. Memasang dan mengonfigurasi kluster oVirt 4.3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>