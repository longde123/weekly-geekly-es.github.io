<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍈 👩🏿‍🚒 👨‍🔬 Seluruh kebenaran tentang RTOS. Artikel # 19. Semaphores: pengantar dan layanan dasar 🥦 🐐 🍺</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Semaphores disebutkan dalam salah satu artikel sebelumnya (# 5). Tugas utama mereka adalah mengendalikan akses ke sumber daya. 

 Artikel sebelumnya d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Seluruh kebenaran tentang RTOS. Artikel # 19. Semaphores: pengantar dan layanan dasar</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429156/"><img src="https://habrastorage.org/webt/59/6c/rd/596crdjhkaeefilqj_5ogaagbsc.jpeg"><br><br>  Semaphores disebutkan dalam salah satu artikel sebelumnya (# 5).  Tugas utama mereka adalah mengendalikan akses ke sumber daya. <br><a name="habracut"></a><br>  Artikel sebelumnya dalam seri: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 18.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Grup Bendera Acara: Layanan Pembantu dan Struktur Data</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 17.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Grup Bendera Acara: Pengantar dan Layanan Dasar</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 16.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Sinyal</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 15.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Partisi Memori: Layanan dan Struktur Data</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 14.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bagian memori: pengantar dan layanan dasar</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 13.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Struktur data tugas dan panggilan API yang tidak didukung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 12.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Layanan untuk bekerja dengan tugas</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 11.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tugas: konfigurasi dan pengantar API</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 10.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Penjadwal: fitur canggih dan pelestarian konteks</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 9.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Penjadwal: implementasi</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 8.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Nucleus SE: Desain dan Penyebaran Internal</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 7.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Nucleus SE: Pendahuluan</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 6.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Layanan RTOS lainnya</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 5.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Interaksi tugas dan sinkronisasi</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tugas, pengalihan konteks, dan interupsi</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tugas dan Perencanaan</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">RTOS: Struktur dan mode waktu-nyata</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">RTOS: pengantar.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><br></a> <br><h2>  Menggunakan semaphores </h2><br>  Dalam Nucleus SE, semaphores didefinisikan pada tahap perakitan.  Aplikasi dapat memiliki hingga 16 semaphore.  Jika semaphore tidak ditentukan, kode panggilan layanan dan struktur data tidak termasuk dalam aplikasi. <br><br>  Semaphore adalah penghitung tipe <b>U8</b> , akses yang dikontrol sedemikian rupa sehingga beberapa tugas dapat menggunakannya.  Suatu tugas dapat menurunkan nilai penghitung semafor (menangkap) atau meningkatkannya (melepaskan).  Mencoba untuk menangkap semafor dengan nilai nol dapat menyebabkan kesalahan atau penangguhan tugas, tergantung pada parameter panggilan API yang dipilih dan konfigurasi Nucleus SE. <br><br><h2>  Menyiapkan semafor </h2><br><h3>  Jumlah semafor </h3><br>  Seperti kebanyakan objek Nucleus SE, pengaturan semaphores ditentukan oleh arahan <b>#define</b> di <b>nuse_config.h</b> .  Parameter utama adalah <b>NUSE_SEMAPHORE_NUMBER</b> , yang menentukan jumlah semafor dalam aplikasi.  Secara default, parameter diatur ke 0 (semaphores tidak digunakan dalam aplikasi) dan dapat mengambil nilai apa pun hingga 16. Nilai yang salah akan menyebabkan kesalahan kompilasi, yang akan dihasilkan dengan memeriksa <b>nuse_config_check.h</b> (file ini termasuk dalam <b>nuse_config.c</b> , yang berarti ia mengkompilasi bersama dengan modul ini), sebagai hasilnya, arahan <b>#error</b> akan <b>diaktifkan</b> . <br><br>  Memilih nilai bukan nol berfungsi sebagai aktivator utama untuk semafor.  Parameter ini digunakan ketika mendefinisikan struktur data dan ukurannya tergantung pada nilainya (untuk lebih jelasnya, lihat lebih lanjut dalam artikel ini).  Selain itu, nilai bukan nol mengaktifkan pengaturan API. <br><br><h3>  Aktifkan Panggilan API </h3><br>  Setiap fungsi API (panggilan utilitas) di Nucleus SE diaktifkan oleh arahan <b>#define</b> di <b>nuse_config.h</b> .  Untuk semaphores, ini termasuk: <br><br> <code>NUSE_SEMAPHORE_OBTAIN <br> NUSE_SEMAPHORE_RELEASE <br> NUSE_SEMAPHORE_RESET <br> NUSE_SEMAPHORE_INFORMATION <br> NUSE_SEMAPHORE_COUNT <br></code> <br><br>  Secara default, mereka diatur ke <b>FALSE</b> , sehingga menonaktifkan setiap panggilan layanan dan memblokir masuknya kode yang mengimplementasikannya.  Untuk mengatur semafor, Anda perlu memilih panggilan API yang diperlukan dan mengatur arahan terkait ke <b>TRUE</b> . <br><br>  Berikut ini adalah kutipan dari file <b>nuse_config.h</b> default. <br><br><pre> <code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> NUSE_SEMAPHORE_NUMBER 0 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Number of semaphores in the system - 0-16 */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> NUSE_SEMAPHORE_OBTAIN FALSE </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Service call enabler */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> NUSE_SEMAPHORE_RELEASE FALSE </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Service call enabler */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> NUSE_SEMAPHORE_RESET FALSE </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Service call enabler */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> NUSE_SEMAPHORE_INFORMATION FALSE </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Service call enabler */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> NUSE_SEMAPHORE_COUNT FALSE </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Service call enabler */</span></span></span></span></code> </pre><br>  Fungsi API yang diaktifkan jika tidak ada semafor dalam aplikasi akan menyebabkan kesalahan kompilasi (kecuali untuk <b>NUSE_Semaphore_Count ()</b> , yang selalu diaktifkan).  Jika kode Anda menggunakan panggilan API yang belum diaktifkan, kesalahan tata letak akan terjadi karena kode implementasi tidak termasuk dalam aplikasi. <br><br><h2>  Utilitas panggilan semafor </h2><br>  Nucleus RTOS mendukung delapan panggilan layanan yang menyediakan fungsionalitas berikut: <br><br><ul><li>  Menangkap semaphore.  Nucleus SE diimplementasikan dalam fungsi <b>NUSE_Semaphore_Obtain ()</b> . </li><li>  Lepaskan semaphore.  Dalam Nucleus SE, ini diimplementasikan dalam fungsi <b>NUSE_Semaphore_Release ()</b> . </li><li>  Mengembalikan semafor ke status yang tidak digunakan dengan melepaskan semua tugas yang dijeda (reboot).  Nucleus SE diimplementasikan dalam <b>NUSE_Semaphore_Reset ()</b> . </li><li>  Memberikan informasi tentang semaphore tertentu.  Nucleus SE diimplementasikan dalam <b>NUSE_Semaphore_Information ()</b> . </li><li>  Mengembalikan jumlah semafor yang dikonfigurasi dalam aplikasi.  Nucleus SE diimplementasikan di <b>NUSE_Semaphore_Count ()</b> . </li><li>  Menambahkan semaphore baru ke aplikasi.  Nucleus SE tidak diimplementasikan. </li><li>  Menghapus semaphore dari aplikasi.  Nucleus SE tidak diimplementasikan. </li><li>  Mengembalikan pointer ke semua semaphores.  Nucleus SE tidak diimplementasikan. </li></ul><br>  Implementasi dari setiap panggilan layanan dijelaskan secara rinci di bawah ini. <br><br><h2>  Utilitas panggilan untuk menangkap dan melepaskan semaphores </h2><br>  Operasi mendasar yang dapat dilakukan pada semaphores adalah penangkapan dan pelepasan (penurunan dan peningkatan nilai).  Nucleus RTOS dan Nucleus SE menyediakan dua panggilan API dasar untuk operasi ini. <br><br><h3>  Menangkap semaphore </h3><br>  Panggilan utilitas Nucleus RTOS untuk menangkap semafor sangat fleksibel dan memungkinkan Anda untuk menjeda tugas secara implisit atau dengan batas waktu tertentu jika operasi tidak dapat dilakukan saat ini, misalnya, jika Anda mencoba menangkap semafor dengan nilai nol.  Nucleus SE menyediakan fitur yang sama, hanya jeda tugas yang opsional, dan batas waktu tidak diterapkan. <br><br>  <b><i>Tantangan untuk menangkap semaphore di Nucleus RTOS</i></b> <br>  Prototipe panggilan layanan: <br>  <b>STATUS NU_Obtain_Semaphore (NU_SEMAPHORE * semaphore, ditangguhkan tanpa ditandatangani);</b> <br><br>  Parameter: <br><br>  <b>semaphore</b> - penunjuk ke blok kontrol semaphore yang disediakan oleh pengguna; <br>  <b>menangguhkan</b> - parameter penangguhan tugas, dapat mengambil nilai <b>NU_NO_SUSPEND</b> atau <b>NU_SUSPEND</b> , serta nilai batas waktu. <br><br>  Nilai pengembalian: <br><br>  <b>NU_SUCCESS</b> - panggilan berhasil diselesaikan; <br>  <b>NU_UNAVAILABLE</b> - semaphore memiliki nilai nol; <br>  <b>NU_INVALID_SEMAPHORE</b> - pointer tidak valid ke semaphore; <br>  <b>NU_INVALID_SUSPEND</b> - upaya untuk menjeda dari utas yang tidak terkait tugas; <br>  <b>NU_SEMAPHORE_WAS_RESET</b> - semaphore direset saat tugas ditangguhkan. <br><br>  <b><i>Tantangan untuk menangkap semafor di Nucleus SE</i></b> <br>  Panggilan API ini mendukung fungsionalitas inti API Nucleus RTOS. <br><br>  Prototipe panggilan layanan: <br><br>  <b>STATUS NUSE_Semaphore_Obtain (NUSE_SEMAPHORE semaphore, U8 menangguhkan);</b> <br><br>  Parameter: <br><br>  <b>semaphore</b> - index (ID) dari semaphore yang digunakan; <br>  <b>menangguhkan</b> - parameter penangguhan tugas, dapat berupa <b>NUSE_NO_SUSPEND</b> atau <b>NUSE_SUSPEND</b> . <br><br>  Nilai pengembalian: <br><br>  <b>NUSE_SUCCESS</b> - panggilan berhasil diselesaikan; <br>  <b>NUSE_UNAVAILABLE</b> - semaphore memiliki nilai nol; <br>  <b>NUSE_INVALID_SEMAPHORE</b> - indeks semaphore tidak valid; <br>  <b>NUSE_INVALID_SUSPEND</b> - upaya untuk menjeda dari utas yang tidak terkait tugas atau ketika fungsionalitas pemblokiran API dinonaktifkan; <br>  <b>NUSE_SEMAPHORE_WAS_RESET</b> - semaphore direset saat tugas ditangguhkan; <br><br>  <b><i>Menerapkan penangkapan semafor di Nucleus SE</i></b> <br>  Versi kode fungsi <b>NUSE_Semaphore_Obtain ()</b> (setelah memeriksa parameter) dipilih menggunakan kompilasi bersyarat tergantung pada apakah dukungan untuk tugas pemblokiran (jeda) diaktifkan atau tidak.  Pertimbangkan kedua opsi tersebut. <br><br>  Jika kunci tidak diaktifkan, logika panggilan API ini cukup sederhana: <br><br><pre> <code class="hljs powershell"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (NUSE_Semaphore_Counter[<span class="hljs-type"><span class="hljs-type">semaphore</span></span>] != <span class="hljs-number"><span class="hljs-number">0</span></span>) /* semaphore available */ { NUSE_Semaphore_Counter[<span class="hljs-type"><span class="hljs-type">semaphore</span></span>]--; return_value = NUSE_SUCCESS; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> /* semaphore unavailable */ { return_value = NUSE_UNAVAILABLE; }</code> </pre><br>  Nilai penghitung semafor diperiksa, dan jika tidak sama dengan nol, menurun. <br><br>  Jika penguncian tugas diaktifkan, logika menjadi lebih kompleks: <br><br><pre> <code class="hljs powershell"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (NUSE_Semaphore_Counter[<span class="hljs-type"><span class="hljs-type">semaphore</span></span>] != <span class="hljs-number"><span class="hljs-number">0</span></span>) /* semaphore available */ { NUSE_Semaphore_Counter[<span class="hljs-type"><span class="hljs-type">semaphore</span></span>]--; return_value = NUSE_SUCCESS; suspend = NUSE_NO_SUSPEND; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> /* semaphore unavailable */ { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (suspend == NUSE_NO_SUSPEND) { return_value = NUSE_UNAVAILABLE; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { /* block task */ NUSE_Semaphore_Blocking_Count[<span class="hljs-type"><span class="hljs-type">semaphore</span></span>]++; NUSE_Suspend_Task(NUSE_Task_Active, semaphore &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) | NUSE_SEMAPHORE_SUSPEND); return_value = NUSE_Task_Blocking_Return[<span class="hljs-type"><span class="hljs-type">NUSE_Task_Active</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (return_value != NUSE_SUCCESS) { suspend = NUSE_NO_SUSPEND; } } } } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (suspend == NUSE_SUSPEND);</code> </pre><br>  Beberapa klarifikasi mungkin bermanfaat. <br><br>  Kode ditempatkan dalam <b>loop do ... while</b> , yang berjalan saat parameter <b>menangguhkan</b> adalah <b>NUSE_SUSPEND</b> . <br><br>  Jika semaphore memiliki nilai bukan nol, maka berkurang.  Variabel <b>penangguhan</b> diatur ke <b>NUSE_NO_SUSPEND</b> , dan panggilan API berakhir dan mengembalikan <b>NUSE_SUCESS</b> . <br><br>  Jika semafor adalah nol dan variabel <b>penangguhan</b> disetel ke <b>NUSE_NO_SUSPEND</b> , panggilan API mengembalikan <b>NUSE_UNAVAILABLE</b> .  Jika penangguhan ditetapkan ke <b>NUSE_SUSPEND</b> , tugas akan dijeda.  Setelah panggilan selesai (misalnya, ketika tugas dilanjutkan), jika nilai kembali adalah <b>NUSE_SUCCESS</b> (yang menunjukkan bahwa tugas dilanjutkan setelah semaphore dirilis, dan bukan setelah reset), siklus dimulai dari awal. <br><br><h3>  Rilis Semaphore </h3><br>  Panggilan utilitas ke Nucleus RTOS API untuk membebaskan semaphore cukup sederhana: nilai penghitung semaphore meningkat dan pesan sukses dikembalikan.  Nucleus SE menyediakan fitur yang sama, tetapi dengan pengecekan overflow tambahan. <br><br>  <b><i>Tantang untuk merilis semaphores di Nucleus RTOS</i></b> <br>  Prototipe panggilan layanan: <br><br>  <b>STATUS NU_Release_Semaphore (NU_SEMAPHORE * semaphore);</b> <br><br>  Parameter: <br><br>  <b>semaphore</b> - pointer ke blok kontrol semaphore yang disediakan oleh pengguna. <br><br>  Nilai pengembalian: <br><br>  <b>NU_SUCCESS</b> - panggilan berhasil diselesaikan; <br>  <b>NU_INVALID_SEMAPHORE</b> - Pointer semaphore <b>tidak valid</b> . <br><br>  <b><i>Tantangan untuk merilis semaphore di Nucleus SE</i></b> <br>  Panggilan API ini mendukung fungsionalitas inti API Nucleus RTOS. <br><br>  Prototipe panggilan layanan: <br><br>  <b>STATUS NUSE_Semaphore_Release (NUSE_SEMAPHORE semaphore);</b> <br><br>  Parameter: <br><br>  <b>semaphore</b> - Indeks (ID) dari semaphore yang dibebaskan. <br><br>  Nilai pengembalian: <br><br>  <b>NUSE_SUCCESS</b> - panggilan berhasil diselesaikan; <br>  <b>NUSE_INVALID_SEMAPHORE</b> - indeks semaphore tidak valid; <br>  <b>NUSE_UNAVAILABLE</b> - semaphore memiliki nilai 255 dan tidak dapat ditingkatkan. <br><br>  <b><i>Menerapkan rilis semaphore di Nucleus SE</i></b> <br>  Kode fungsi <b>NUSE_Semaphore_Release ()</b> (setelah memeriksa parameter) adalah umum, terlepas dari apakah kunci tugas diaktifkan atau tidak.  Nilai penghitung semafor diperiksa, dan jika kurang dari 255, itu meningkat. <br><br>  Kode lebih lanjut dipilih menggunakan kompilasi bersyarat jika dukungan untuk panggilan pemblokiran API (penangguhan tugas) diaktifkan: <br><br><pre> <code class="hljs kotlin">NUSE_CS_Enter(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (NUSE_Semaphore_Counter[semaphore] &lt; <span class="hljs-number"><span class="hljs-number">255</span></span>) { NUSE_Semaphore_Counter[semaphore]++; return_value = NUSE_SUCCESS; #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> NUSE_BLOCKING_ENABLE <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (NUSE_Semaphore_Blocking_Count[semaphore] != <span class="hljs-number"><span class="hljs-number">0</span></span>) { U8 index; <span class="hljs-comment"><span class="hljs-comment">/* check whether a task is blocked */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* on this semaphore */</span></span> NUSE_Semaphore_Blocking_Count[semaphore]--; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (index=<span class="hljs-number"><span class="hljs-number">0</span></span>; index&lt;NUSE_TASK_NUMBER; index++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((LONIB(NUSE_Task_Status[index]) == NUSE_SEMAPHORE_SUSPEND) &amp;&amp; (HINIB(NUSE_Task_Status[index]) == semaphore)) { NUSE_Task_Blocking_Return[index] = NUSE_SUCCESS; NUSE_Wake_Task(index); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } #endif } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { return_value = NUSE_UNAVAILABLE; } NUSE_CS_Exit(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> return_value;</code> </pre><br>  Jika ada tugas yang ditangguhkan pada semafor ini, yang pertama dilanjutkan. <br><br>  Artikel berikut akan menjelaskan panggilan API tambahan yang terkait dengan semaphores dan struktur datanya. <br><br>  <b>Tentang Pengarang:</b> Colin Walls telah bekerja di industri elektronik selama lebih dari tiga puluh tahun, mencurahkan sebagian besar waktunya untuk firmware.  Dia sekarang adalah seorang insinyur firmware di Mentor Embedded (sebuah divisi dari Mentor Graphics).  Colin Walls sering berbicara di konferensi dan seminar, penulis berbagai artikel teknis dan dua buku tentang firmware.  Tinggal di Inggris.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Blog</a> profesional <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Colin</a> , email: colin_walls@mentor.com. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id429156/">https://habr.com/ru/post/id429156/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id429146/index.html">Mengalihkan catu daya untuk teletype dari tahun 1940-an (dengan thyratron merkuri bercahaya!)</a></li>
<li><a href="../id429148/index.html">Bagaimana "manajer efektif" menenggelamkan Flickr</a></li>
<li><a href="../id429150/index.html">Mengelola modul Anda untuk CMS menggunakan komposer</a></li>
<li><a href="../id429152/index.html">Komponen navigasi Android. Hal-hal sederhana yang harus Anda lakukan sendiri</a></li>
<li><a href="../id429154/index.html">Penagihan, pasar, dan kotak pasir kedua kalinya untuk Big Data: apa yang dapat dilakukan pengujian lingkungan di cloud?</a></li>
<li><a href="../id429158/index.html">Sindrom penipu memengaruhi pria tidak kurang dari wanita ... dan temuan lain dari 10.000 wawancara teknis</a></li>
<li><a href="../id429160/index.html">Nintendo DS Console GPU dan Fitur Menarik</a></li>
<li><a href="../id429162/index.html">"Untuk Membuat Perubahan, Memahami Mengapa Orang Menentangnya": Jim Holmes tentang Budaya Pengujian</a></li>
<li><a href="../id429166/index.html">Multicrystal: dari sejarah hingga spekulasi tentang masa depan</a></li>
<li><a href="../id429168/index.html">Melalui api dan air: sejarah sastra sains populer Rusia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>