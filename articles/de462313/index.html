<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👂🏼 🖖🏻 🥒 Tipps und Tricks von meinem Telegramm-Kanal @pythonetc, Juli 2019 🤷🏿 ✈️ 💃🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Es ist eine neue Auswahl von Tipps und Tricks zu Python und Programmierung von meinem Telegramm-Kanal @pythonetc. 

 ← Frühere Veröffentlichungen 


 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tipps und Tricks von meinem Telegramm-Kanal @pythonetc, Juli 2019</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/462313/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/6y/mg/hj/6ymghjaofoi5w4ljk7nmxvgaznq.jpeg"></div><br>  Es ist eine neue Auswahl von Tipps und Tricks zu Python und Programmierung von meinem Telegramm-Kanal @pythonetc. <br><br>  ← <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Frühere Veröffentlichungen</a> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ix/fw/hm/ixfwhm2i27b6uy36zmz5qlvjqdc.png"></div><br>  Sie können Abschlussvariablen nicht mutieren, indem Sie sie einfach zuweisen.  Python behandelt die Zuweisung als Definition innerhalb eines Funktionskörpers und schließt überhaupt nicht. <br><a name="habracut"></a><br>  Funktioniert gut, druckt <code>2</code> : <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_closure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">closure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> print(x) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> closure make_closure(<span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> <br>  <code>UnboundLocalError: local variable 'x' referenced before assignment</code> : <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_closure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">closure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> print(x) x *= <span class="hljs-number"><span class="hljs-number">2</span></span> print(x) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> closure make_closure(<span class="hljs-number"><span class="hljs-number">2</span></span>)()</code> </pre> <br><br>  Damit es funktioniert, sollten Sie nicht <code>nonlocal</code> .  Der Interpreter wird ausdrücklich angewiesen, die Zuweisung nicht als Definition zu behandeln: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_closure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">closure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nonlocal</span></span> x print(x) x *= <span class="hljs-number"><span class="hljs-number">2</span></span> print(x) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> closure make_closure(<span class="hljs-number"><span class="hljs-number">2</span></span>)()</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ix/fw/hm/ixfwhm2i27b6uy36zmz5qlvjqdc.png"></div><br>  Manchmal möchten Sie während der Iteration wissen, ob dies der erste oder der letzte Elementschritt der Iteration ist.  Ein einfacher Weg, dies zu handhaben, ist die Verwendung eines expliziten Flags: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sparse_list</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(iterable, num_of_zeros=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> result = [] zeros = [<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(num_of_zeros)] first = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> iterable: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> first: result += zeros result.append(x) first = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> sparse_list([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>) == [ <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, ]</code> </pre> <br>  Sie können auch das erste Element außerhalb der Schleife verarbeiten, was klarer erscheint, aber bis zu einem gewissen Grad zu einer Codeduplizierung führt.  Es ist auch nicht einfach, mit abstrakten iterablen Elementen zu arbeiten: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sparse_list</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(iterable, num_of_zeros=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> result = [] zeros = [<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(num_of_zeros)] iterator = iter(iterable) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: result.append(next(iterator)) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> StopIteration: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> iterator: result += zeros result.append(x) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result</code> </pre> <br>  Sie können auch <code>enumerate</code> und nach <code>i == 0</code> (funktioniert nur zur Erkennung des ersten Elements, nicht des letzten Elements), aber die ultimative Lösung könnte ein Generator sein, der das <code>first</code> und das <code>last</code> Flag zusammen mit dem Element eines zurückgibt iterable: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">first_last_iter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(iterable)</span></span></span><span class="hljs-function">:</span></span> iterator = iter(iterable) first = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> last = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> last: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> first: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: current = next(iterator) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> StopIteration: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: current = next_one <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: next_one = next(iterator) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> StopIteration: last = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> (first, last, current) first = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre> <br>  Die anfängliche Funktion kann nun folgendermaßen aussehen: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sparse_list</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(iterable, num_of_zeros=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> result = [] zeros = [<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(num_of_zeros)] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> first, last, x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> first_last_iter(iterable): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> first: result += zeros result.append(x) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ix/fw/hm/ixfwhm2i27b6uy36zmz5qlvjqdc.png"></div><br>  Wenn Sie die Zeit zwischen zwei Ereignissen messen möchten, sollten Sie <code>time.monotonic()</code> anstelle von <code>time.time()</code> .  <code>time.monotonic()</code> geht niemals rückwärts, selbst wenn die Systemuhr aktualisiert wird: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> contextlib <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> contextmanager <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time @contextmanager <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">timeit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> start = time.monotonic() <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> print(time.monotonic() - start) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> timeit(): time.sleep(<span class="hljs-number"><span class="hljs-number">2</span></span>) main()</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ix/fw/hm/ixfwhm2i27b6uy36zmz5qlvjqdc.png"></div><br>  Verschachtelte Kontextmanager wissen normalerweise nicht, dass sie verschachtelt sind.  Sie können sie wissen lassen, indem Sie innere Kontextmanager durch den äußeren hervorbringen: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> contextlib <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> AbstractContextManager <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TimeItContextManager</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(AbstractContextManager)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, name, parent=None)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self._name = name self._parent = parent self._start = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self._substracted = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__enter__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self._start = time.monotonic() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__exit__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, exc_type, exc_value, traceback)</span></span></span><span class="hljs-function">:</span></span> delta = time.monotonic() - self._start <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self._parent <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self._parent.substract(delta) print(self._name, <span class="hljs-string"><span class="hljs-string">'total'</span></span>, delta) print(self._name, <span class="hljs-string"><span class="hljs-string">'outer'</span></span>, delta - self._substracted) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">child</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, name)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> type(self)(name, parent=self) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">substract</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, n)</span></span></span><span class="hljs-function">:</span></span> self._substracted += n timeit = TimeItContextManager <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> timeit(<span class="hljs-string"><span class="hljs-string">'large'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> large_t: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> large_t.child(<span class="hljs-string"><span class="hljs-string">'medium'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> medium_t: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> medium_t.child(<span class="hljs-string"><span class="hljs-string">'small-1'</span></span>): time.sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> medium_t.child(<span class="hljs-string"><span class="hljs-string">'small-2'</span></span>): time.sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>) time.sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>) time.sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>) main()</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ix/fw/hm/ixfwhm2i27b6uy36zmz5qlvjqdc.png"></div><br>  Wenn Sie einige Informationen über die Aufrufkette weitergeben möchten, verwenden Sie normalerweise den einfachsten Weg: Sie übergeben sie als Funktionsargumente. <br><br>  In einigen Fällen kann es jedoch äußerst unpraktisch sein, alle Funktionen in der Kette zu ändern, um neue Daten zu verbreiten.  Stattdessen möchten Sie möglicherweise einen Kontext einrichten, der von allen Funktionen in der Kette verwendet wird.  Wie kann dieser Kontext technisch gemacht werden? <br><br>  Die einfachste Lösung ist eine globale Variable.  In Python können Sie auch Module und Klassen als Kontexthalter verwenden, da es sich streng genommen auch um globale Variablen handelt.  Sie tun es wahrscheinlich täglich für Dinge wie Logger. <br><br>  Wenn Ihre Anwendung über mehrere Threads verfügt, funktioniert eine reine globale Variable für Sie nicht, da sie nicht threadsicher ist.  Möglicherweise wird mehr als eine Anrufkette gleichzeitig ausgeführt, und jede von ihnen benötigt einen eigenen Kontext.  Das <code>threading</code> Modul behandelt Sie und stellt das <code>threading.local()</code> -Objekt bereit, das threadsicher ist.  Speichern Sie dort alle Daten, indem Sie einfach auf die Attribute zugreifen: <code>threading.local().symbol = '@'</code> . <br><br>  Beide Ansätze sind jedoch nicht parallel, was bedeutet, dass sie nicht für die Coroutine-Aufrufkette funktionieren, bei der Funktionen nicht nur aufgerufen werden, sondern auch abgewartet werden können.  Sobald eine Coroutine <code>await</code> , kann eine Ereignisschleife eine völlig andere Coroutine aus einer völlig anderen Kette ausführen.  Das wird nicht funktionieren: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> asyncio <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys global_symbol = <span class="hljs-string"><span class="hljs-string">'.'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indication</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(timeout)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: print(global_symbol, end=<span class="hljs-string"><span class="hljs-string">''</span></span>) sys.stdout.flush() <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.sleep(timeout) <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sleep</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t, indication_t, symbol=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'.'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> loop = asyncio.get_event_loop() <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> global_symbol global_symbol = symbol task = loop.create_task( indication(indication_t) ) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.sleep(t) task.cancel() loop = asyncio.get_event_loop() loop.run_until_complete(asyncio.gather( sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0.1</span></span>, <span class="hljs-string"><span class="hljs-string">'0'</span></span>), sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0.1</span></span>, <span class="hljs-string"><span class="hljs-string">'a'</span></span>), sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0.1</span></span>, <span class="hljs-string"><span class="hljs-string">'b'</span></span>), sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0.1</span></span>, <span class="hljs-string"><span class="hljs-string">'c'</span></span>), ))</code> </pre> <br>  Sie können dies beheben, indem Sie die Schleife festlegen und den Kontext jedes Mal wiederherstellen, wenn zwischen Coroutinen gewechselt wird.  Sie können dies mit dem <code>contextvars</code> Modul seit Python 3.7 tun. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> asyncio <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> contextvars global_symbol = contextvars.ContextVar(<span class="hljs-string"><span class="hljs-string">'symbol'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indication</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(timeout)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: print(global_symbol.get(), end=<span class="hljs-string"><span class="hljs-string">''</span></span>) sys.stdout.flush() <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.sleep(timeout) <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sleep</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t, indication_t, symbol=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'.'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> loop = asyncio.get_event_loop() global_symbol.set(symbol) task = loop.create_task(indication(indication_t)) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.sleep(t) task.cancel() loop = asyncio.get_event_loop() loop.run_until_complete(asyncio.gather( sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0.1</span></span>, <span class="hljs-string"><span class="hljs-string">'0'</span></span>), sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0.1</span></span>, <span class="hljs-string"><span class="hljs-string">'a'</span></span>), sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0.1</span></span>, <span class="hljs-string"><span class="hljs-string">'b'</span></span>), sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0.1</span></span>, <span class="hljs-string"><span class="hljs-string">'c'</span></span>), ))</code> </pre></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de462313/">https://habr.com/ru/post/de462313/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de462299/index.html">Rundung auf das Ganze in .NET</a></li>
<li><a href="../de462301/index.html">Geheimnisse, Tipps, Tricks: So erstellen Sie eine coole Aktion für Google Assistant</a></li>
<li><a href="../de462303/index.html">Clusterspeicher mit Annäherung</a></li>
<li><a href="../de462307/index.html">Speichern des Routing-Status auf der Festplatte in einer plattformübergreifenden .NET Core-GUI-App mit ReactiveUI und Avalonia</a></li>
<li><a href="../de462311/index.html">@ Pythonetc-Zusammenstellung, Juli 2019</a></li>
<li><a href="../de462315/index.html">Büro-Energieeffizienz: Wie kann der reale Energieverbrauch gesenkt werden?</a></li>
<li><a href="../de462317/index.html">Tipps zur Optimierung Ihrer Laravel-Architektur mit AWS</a></li>
<li><a href="../de462321/index.html">Internationales SEO | Internationale SEO-Ranking-Faktoren</a></li>
<li><a href="../de462323/index.html">Fettleibigkeit - Entspannen und einbeziehen</a></li>
<li><a href="../de462325/index.html">Web Worker einfacher als Sie dachten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>