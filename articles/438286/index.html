<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÉ üëèüèæ üë©üèΩ‚Äçüç≥ Trabajando con zonas horarias en JavaScript üë®üèº‚Äçüéì üë©üèø‚Äçü§ù‚Äçüë®üèª üï¥üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recientemente, estaba trabajando en la tarea de agregar zonas horarias a la biblioteca de calendario JS mantenida por mi equipo. Era muy consciente de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Trabajando con zonas horarias en JavaScript</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/438286/"><img src="https://habrastorage.org/getpro/habr/post_images/540/5d5/588/5405d55887909032bc8016afe3f65796.jpg"><br><br>  Recientemente, estaba trabajando en la tarea de agregar zonas horarias a la biblioteca de calendario JS mantenida por mi equipo.  Era muy consciente del soporte de zona horaria in√∫til en JavaScript, pero esperaba que abstraer objetos de datos existentes facilitar√≠a la resoluci√≥n de la mayor√≠a de las dificultades. <br><br>  Sin embargo, mis sue√±os se hicieron polvo.  Cuando profundic√© en la tarea, me di cuenta de que es realmente dif√≠cil trabajar con zonas horarias en este idioma.  Implementar algo m√°s complicado que simplemente formatear la visualizaci√≥n de la hora y calcular la fecha usando operaciones complejas (funciones de calendario) fue extremadamente dif√≠cil.  Adquir√≠ una valiosa experiencia en la soluci√≥n de este problema, y ‚Äã‚Äãesto conllev√≥ nuevas dificultades. <br><br>  En este art√≠culo quiero discutir lo que encontr√© y c√≥mo se resolvi√≥.  Mientras escrib√≠a el texto, me di cuenta de que la raz√≥n de todas las dificultades era mi pobre comprensi√≥n del tema de las zonas horarias.  A la luz de esta conciencia, propongo hablar primero en detalle sobre la definici√≥n y los est√°ndares, y solo luego pasar a JavaScript. <br><a name="habracut"></a><br><h2>  ¬øQu√© es una zona horaria? </h2><br>  Una zona horaria es una regi√≥n geogr√°fica que utiliza la misma hora local establecida por el gobierno.  Muchos pa√≠ses se relacionan por completo con cualquier zona horaria en particular, y en los territorios de los grandes estados, como Rusia y Estados Unidos, se utilizan varias zonas horarias.  Es curioso que aunque China tambi√©n es lo suficientemente grande, solo acepta una zona horaria.  A veces esto lleva a situaciones extra√±as cuando el amanecer en la parte occidental del pa√≠s comienza alrededor de las 10 de la ma√±ana. <br><br><h2>  GMT, UTC y Offset </h2><br><h4>  GMT </h4><br>  La hora local de Corea del Sur se designa como <code>GMT+09:00</code> .  GMT significa Greenwich Mean Time (GMT), es decir, esta vez en el reloj del Observatorio Real de Greenwich, Reino Unido.  Se encuentra en el primer meridiano.  La se√±al de radio del sistema GMT comenz√≥ a transmitirse el 5 de febrero de 1924, y se convirti√≥ en un est√°ndar mundial el 1 de enero de 1972. <br><br><h4>  UTC </h4><br>  Mucha gente piensa que GMT y UTC son lo mismo, us√°ndolos a menudo como sistemas intercambiables.  Pero esto es un error.  El sistema UTC apareci√≥ en 1972 como una forma de compensar el efecto de la rotaci√≥n de la Tierra.  El sistema se basa en el tiempo at√≥mico internacional, calculado por la frecuencia de las vibraciones electromagn√©ticas de los √°tomos de cesio.  En otras palabras, UTC es un reemplazo m√°s preciso para GMT.  Aunque la diferencia en tiempo real entre los dos sistemas es muy peque√±a, es mejor que los desarrolladores de software conf√≠en en UTC. <br><br>  Un hecho interesante: cuando UTC a√∫n se estaba desarrollando, se sugiri√≥ en los pa√≠ses de habla inglesa que se llamara CUT (Tiempo Universal Coordinado), y en los pa√≠ses de habla francesa - TUC (Coordinaci√≥n Universal de Temps).  Sin embargo, ninguno de los campamentos pudo ganar, y acordaron llamar al sistema UTC, deletreando las dos opciones propuestas (C, T y U). <br><br><h4>  Offset </h4><br>  <code>+09:00</code> en <code>UTC+09:00</code> significa que la hora local est√° 9 horas por delante de la hora UTC est√°ndar.  Es decir, cuando son las 9 p.m. en Corea del Sur, es mediod√≠a en la regi√≥n UTC.  La diferencia entre la hora UTC est√°ndar y la hora local se denomina "desplazamiento", que se expresa como valores positivos o negativos: <code>+09:00</code> , <code>-03:00</code> , etc. <br><br>  En muchos pa√≠ses, es costumbre dar a sus zonas horarias nombres √∫nicos.  Por ejemplo, la zona horaria de Corea del Sur se llama KST (hora est√°ndar de Corea), su desplazamiento se expresa como <code>KST = UTC+09:00</code> .  Sin embargo, la compensaci√≥n <code>+09:00</code> utilizada no solo por Corea del Sur, sino tambi√©n por Jap√≥n, Indonesia y muchos otros pa√≠ses, por lo tanto, la relaci√≥n entre las compensaciones y los cinturones no se expresa como 1: 1, sino como 1: N.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Aqu√≠</a> se presenta una lista de pa√≠ses con una compensaci√≥n de <code>+09:00</code> . <br><br>  Algunas compensaciones operan no solo por horas.  Por ejemplo, en Corea del Norte, el tiempo est√°ndar es <code>+08:30</code> , mientras que en Australia en algunas regiones <code>+10:30</code> <code>+8:45</code> , <code>+09:30</code> y <code>+10:30</code> . <br><br>  Una lista completa de compensaciones UTC est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><h2>  Zona horaria! == desplazamiento? </h2><br>  Como dije, usamos nombres de zonas horarias (KST, JST) con desplazamientos como intercambiables, sin distinguir entre ellos.  Pero ser√° err√≥neo considerar el mismo tiempo y el cambio de una regi√≥n en particular.  Hay varias razones: <br><br><h4>  Horario de verano (DST) </h4><br>  En algunos pa√≠ses, este t√©rmino es desconocido, pero en muchos estados se practica el horario de verano, principalmente en Europa.  Para esto, se adopta el t√©rmino internacional DST: horario de verano.  Significa mover el reloj en verano durante una hora antes de la hora est√°ndar relativa. <br><br>  Por ejemplo, California usa PST (hora est√°ndar del Pac√≠fico) en invierno y PDT (hora de verano del Pac√≠fico, <code>UTC-07:00</code> ) en invierno.  En los Estados Unidos y Canad√°, el t√©rmino Hora del Pac√≠fico (PT, Hora del Pac√≠fico) se usa para las regiones que usan dos zonas horarias. <br><br>  ¬øCu√°ndo comienza y termina el horario de verano?  Todo depende del pa√≠s.  Por ejemplo, en EE. UU. Y Canad√° hasta 2006, el horario de verano se us√≥ desde las 2 a.m. del primer domingo de abril hasta las 12 a.m. del √∫ltimo domingo de octubre.  Y a partir de 2007, el horario de verano comenz√≥ a contar desde 2 noches el segundo domingo de marzo hasta 2 noches el primer domingo de noviembre.  En Europa, diferentes pa√≠ses practican el uso progresivo de DST dependiendo de cada zona horaria. <br><br><h4>  ¬øEst√°n cambiando las zonas horarias? </h4><br>  Cada pa√≠s determina qu√© zonas horarias usar, por lo que la hora local puede cambiar por cualquier raz√≥n pol√≠tica y / o econ√≥mica.  Por ejemplo, en los Estados Unidos, las fronteras del horario de verano se cambiaron en 2007 porque George W. Bush inici√≥ la pol√≠tica energ√©tica en 2005.  Egipto y Rusia sol√≠an cambiar al horario de verano, pero lo han abandonado desde 2011. <br><br>  En algunos casos, el gobierno puede cambiar no solo el horario de verano, sino tambi√©n el horario est√°ndar.  Por ejemplo, antes Samoa usaba la compensaci√≥n <code>UTC-10:00</code> , pero luego cambiaron a <code>UTC+14:00</code> para reducir las p√©rdidas en el comercio debido a la diferencia horaria con Australia y Nueva Zelanda.  Esta decisi√≥n condujo a la p√©rdida de vidas del pa√≠s un d√≠a entero, el 30 de diciembre de 2011, seg√∫n lo informado por los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">peri√≥dicos de todo el mundo</a> . <br><br>  En los Pa√≠ses Bajos, el desplazamiento <code>+0:19:32.13</code> ha utilizado desde 1909, desde 1937 el pa√≠s cambi√≥ a <code>+00:20</code> , y desde 1940 a <code>+01:00</code> , desde entonces el horario principal no ha cambiado all√≠. <br><br><h2>  Zona horaria 1: Offset N </h2><br>  Por lo tanto, la zona horaria puede tener uno o m√°s desplazamientos.  El tiempo que se acepta como est√°ndar depende de las razones pol√≠ticas y / o econ√≥micas actuales en un pa√≠s en particular. <br><br>  En la vida cotidiana, esto no causa dificultades hasta que intente sistematizar estos datos en funci√≥n de algunas reglas.  Imagine que desea establecer la hora est√°ndar en su tel√©fono inteligente utilizando alg√∫n tipo de sesgo.  Si vive en una regi√≥n donde se practica el horario de verano, entonces su tel√©fono inteligente debe saber exactamente cu√°ndo ir y venir.  Es decir, debe establecer la relaci√≥n entre el horario est√°ndar y el horario de verano en una zona horaria (por ejemplo, hora del Pac√≠fico). <br><br>  Pero esto no se puede hacer con un par de reglas simples.  Por ejemplo, cuando en EE. UU. En 2007 se modificaron el comienzo y el final del horario de verano, el 31 de mayo de 2006 se supon√≠a que deb√≠a usar PDT ( <code>-07:00</code> ) como hora est√°ndar y el 31 de marzo de 2007 - PST ( <code>-08:00</code> ).  Resulta que para referirse a una zona horaria espec√≠fica, debe conocer el historial completo del cambio en las zonas horarias o la fecha de cambio de las reglas de horario de verano. <br><br>  Puede decir: "La zona horaria en Nueva York es PST ( <code>-08:00</code> )".  Sin embargo, debe aclararse: "La zona horaria actual en Nueva York es PST".  Adem√°s, para una implementaci√≥n precisa del sistema, debe usar una expresi√≥n a√∫n m√°s precisa.  Olv√≠dese del t√©rmino "zona horaria".  Debe decir: "Ahora en Nueva York, el PST se usa como hora est√°ndar". <br><br>  Entonces, ¬øqu√© debemos usar en lugar del desplazamiento para determinar la zona horaria de una regi√≥n en particular?  El nombre de esta regi√≥n.  M√°s precisamente, debe agrupar en una zona horaria √∫nica aquellas regiones en las que cambian por igual al horario de verano y al horario est√°ndar.  Puede usar nombres como PT (hora del Pac√≠fico), pero solo combinan la hora est√°ndar actual y la hora de verano, y no necesariamente tienen en cuenta todos los cambios hist√≥ricos.  Adem√°s, dado que PT est√° en circulaci√≥n solo en los EE. UU. Y Canad√°, debe confiar en los est√°ndares establecidos de las organizaciones acreditadas para garantizar la universalidad de su software. <br><br><h2>  Base de datos de zonas horarias de la IANA </h2><br>  Debo admitir que la informaci√≥n sobre zonas horarias es m√°s bien una base de datos, no un conjunto de reglas, porque esta informaci√≥n debe contener todos los cambios hist√≥ricos relevantes.  Existen varias bases de datos est√°ndar dise√±adas para resolver tareas relacionadas con zonas horarias.  Con mayor frecuencia, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se utiliza la base de datos de zonas horarias de la IANA</a> , y generalmente se denomina base de datos tz (o tzdata).  La base de datos contiene datos hist√≥ricos sobre los cambios en el horario est√°ndar y el horario de verano en todo el mundo.  Adem√°s, est√° organizado de modo que sea posible verificar todos los datos hist√≥ricos y asegurarse de que la hora sea precisa a partir de la hora de Unix ( <code>1970.01/01 00:00:00</code> ).  Aunque puede encontrar informaci√≥n en la base de datos incluso antes de 1970, su precisi√≥n no est√° garantizada. <br><br>  La convenci√≥n de nomenclatura utiliza la regla de regi√≥n / lugar.  El nombre del continente u oc√©ano (Asia, Am√©rica, Oc√©ano Pac√≠fico) se usa generalmente como regi√≥n, y los nombres de las principales ciudades (Se√∫l, Nueva York) como lugar.  La raz√≥n es que las ciudades suelen durar m√°s que los pa√≠ses.  Por ejemplo, la zona horaria de Corea del Sur es <code>Asia/Seoul</code> y <code>Asia/Tokyo</code> .  Aunque ambos pa√≠ses usan la misma compensaci√≥n <code>UTC+09:00</code> , su hora local cambi√≥ de manera diferente, por lo que se dividieron en diferentes zonas horarias. <br><br>  La base de IANA est√° dirigida por muchas comunidades de desarrolladores e historiadores.  Los datos hist√≥ricos reci√©n encontrados se ingresan de inmediato y las pol√≠ticas actuales se actualizan, por lo que la base de datos actual puede considerarse la fuente m√°s confiable.  Adem√°s, muchos sistemas Unix, incluidos Linux y MacOS, lo utilizan bajo el cap√≥, as√≠ como varios lenguajes de programaci√≥n populares, como Java y PHP. <br><br>  Tenga en cuenta que Windows usa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la base de datos de Microsoft</a> .  Sin embargo, es inexacto en t√©rminos de datos hist√≥ricos y solo es compatible con Microsoft.  Por lo tanto, la base es menos confiable que la base IANA. <br><br><h2>  JavaScript e IANA </h2><br>  La funcionalidad relacionada con la zona horaria se implementa en JavaScript de la nada.  De forma predeterminada, el idioma utiliza el cintur√≥n de regi√≥n actual (m√°s precisamente, el cintur√≥n seleccionado durante la instalaci√≥n del sistema operativo), y no hay forma de cambiarlo.  Adem√°s, incluso las especificaciones para el est√°ndar de base de datos en JavaScript son vagas, y usted mismo lo comprender√° si decide tratar con la especificaci√≥n para ES2015.  Sobre la zona horaria local y la disponibilidad de DST, solo hay un par de declaraciones vagas.  Por ejemplo, DST se define de la siguiente manera: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ECMAScript 2015 - Ajuste del horario de verano</a> . <br><br><blockquote>  Este es un algoritmo dependiente de la implementaci√≥n que utiliza la mejor informaci√≥n de zona horaria disponible para determinar la configuraci√≥n del horario de verano local DaylightSavingTA (t), que se calcula en milisegundos.  Una implementaci√≥n de ECMAScript deber√≠a ayudarlo a determinar mejor su configuraci√≥n de horario de verano local. </blockquote><br>  Parece que solo dicen: "Amigos, intenten que esto funcione".  Entre otras cosas, debe resolver el problema de compatibilidad con diferentes navegadores.  Usted dice: "¬°Qu√© desastre!" Y luego lee la siguiente l√≠nea: <br><br><blockquote>  Nota: le recomendamos que utilice informaci√≥n de la base de datos de zonas horarias de la IANA <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://www.iana.org/time-zones/</a> en sus implementaciones. </blockquote><br>  Si  Las especificaciones de ECMA le dan la pelota con una recomendaci√≥n sin pretensiones para usar la base de datos de IANA, porque JavaScript no tiene una base de datos est√°ndar especial.  Como resultado, diferentes navegadores usan sus propias operaciones con zonas horarias, que a menudo son incompatibles entre s√≠, para calcular la hora.  M√°s tarde, en ECMA, para la API internacional, se <code>Intl.DateTimeFormat</code> la opci√≥n de usar los datos de IANA en formato ECMA-402 <code>Intl.DateTimeFormat</code> .  Pero esta opci√≥n es mucho menos confiable que los an√°logos en otros lenguajes de programaci√≥n. <br><br><h2>  Zona horaria en entorno servidor-cliente </h2><br>  Considere un escenario simple: necesitamos determinar la zona horaria.  Supongamos que creamos un calendario que procesar√° la informaci√≥n del tiempo.  Cuando un usuario en el entorno del cliente ingresa una fecha y hora en la ventana de registro, la fecha se transfiere al servidor y se almacena en la base de datos.  Luego, el cliente recibe del servidor la fecha registrada en el programa para su visualizaci√≥n en la pantalla. <br><br>  Aqu√≠ debes decidir algo.  ¬øQu√© sucede si algunos de los clientes que acceden al servidor est√°n en diferentes zonas horarias?  El evento en el calendario, que se registr√≥ en Se√∫l el 10 de marzo de 2017 a las 23.30, en Nueva York deber√≠a mostrarse como el 10 de marzo de 2017 a las 9.30.  Para que el servidor sirva a clientes de diferentes zonas horarias, la programaci√≥n almacenada debe contener valores absolutos que no dependen de la zona.  Cada servidor tiene su propia forma de almacenar tales valores, esta pregunta est√° m√°s all√° del alcance del art√≠culo, ya que todo depende de un servidor o base de datos espec√≠ficos.  En general, la fecha y la hora transmitidas desde el cliente al servidor deben presentarse en forma de valores basados ‚Äã‚Äãen un √∫nico desplazamiento (generalmente UTC) o en forma de valores que contienen informaci√≥n sobre la zona horaria del entorno del cliente. <br><br>  T√≠picamente, dichos datos se transmiten como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hora Unix</a> en formato UTC o de acuerdo con el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">est√°ndar ISO-8601</a> con informaci√≥n de desplazamiento.  Si en nuestro ejemplo convertimos Se√∫l 21.30 el 10 de marzo de 2017 a la hora de Unix, entonces obtenemos el valor entero <code>1489113000</code> .  Y en el formato ISO-8601, el valor de la cadena es <code>2017‚Äì03‚Äì10T11:30:00+09:00</code> . <br><br>  Si usa JavaScript en un entorno de navegador, debe convertir el valor ingresado como se describe anteriormente y luego volver a convertirlo para que coincida con la zona horaria del usuario.  Es necesario resolver ambos problemas.  Desde el punto de vista del lenguaje de programaci√≥n, la primera operaci√≥n se llama "an√°lisis" y la segunda "formateo".  Ahora veamos c√≥mo se hace esto en JavaScript. <br><br>  Incluso cuando trabaja con JS en un entorno de servidor utilizando Node.js, es posible que deba analizar los datos recibidos del cliente.  Pero dado que las zonas horarias de los servidores y las bases de datos generalmente est√°n sincronizadas y el formato se asigna a los clientes, en un entorno de navegador debe decidir varios factores.  Adem√°s explicar√© en relaci√≥n con el entorno del navegador. <br><br><h2>  Objeto de fecha de JavaScript </h2><br>  Las tareas relacionadas con el trabajo con un tiempo u hora determinados se resuelven utilizando el objeto <code>Date</code> .  Este es un objeto nativo definido en ECMAScript, como <code>Array</code> o <code>Function</code> .  Es decir, en su mayor parte, se implementa utilizando c√≥digo nativo como C ++.  La API est√° bien descrita en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n de MDN</a> .  La clase <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">java.util.Date</a> de Java tuvo un gran impacto en el objeto, por lo que hered√≥ algunas propiedades indeseables, como las caracter√≠sticas de los datos mutables y un mes a partir de cero. <br><br>  Bajo el cap√≥, un objeto <code>Date</code> JavaScript funciona con el tiempo utilizando valores absolutos en formato de tiempo Unix.  Pero los constructores y m√©todos como las funciones <code>parse()</code> , <code>getHour()</code> , <code>setHour()</code> y otros se ven afectados por la zona horaria del cliente (m√°s precisamente, el cintur√≥n especificado en el sistema operativo en el que se ejecuta el navegador).  Por lo tanto, si crea un objeto <code>Date</code> directamente utilizando datos ingresados ‚Äã‚Äãpor el usuario, la zona horaria local del cliente se reflejar√° en estos datos. <br><br>  Como mencion√©, JavaScript no proporciona ninguna forma de cambiar arbitrariamente la zona horaria.  Por lo tanto, suponemos que podemos usar directamente el valor de zona horaria especificado en el navegador. <br><br><h2>  Crear un objeto de fecha utilizando la entrada del usuario </h2><br>  Volvamos al primer ejemplo.  Supongamos que un usuario ingres√≥ la hora de Se√∫l en su dispositivo a las 11.30 del 11 de marzo de 2017. Estos datos se guardan en cinco n√∫meros: 2017, 2, 11, 11 y 30: a√±o, mes, d√≠a, horas y minutos, respectivamente (dado que el mes comienza en 0, el valor debe ser 3‚Äì1 = 2).  Usando el constructor, puede crear f√°cilmente un objeto <code>Date</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> d1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(<span class="hljs-number"><span class="hljs-number">2017</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>); d1.toString(); <span class="hljs-comment"><span class="hljs-comment">// Sat Mar 11 2017 11:30:00 GMT+0900 (KST)</span></span></code> </pre> <br>  Si observa el valor devuelto por <code>d1.toString()</code> , ver√° que el valor absoluto del objeto creado es 11.00 11 de marzo de 2017, se calcul√≥ utilizando la mezcla <code>+09:00</code> (KST). <br><br>  Puede usar datos de cadena en el constructor.  Si los aplica a <code>Date</code> , el objeto llama internamente a <code>Date.parse()</code> y <code>Date.parse()</code> valor correcto.  Esta caracter√≠stica es compatible con las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">especificaciones RFC2888</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ISO-8601</a> .  Pero la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n de MDN para Date.parse ()</a> dice que el valor devuelto por este m√©todo depende del navegador, y el formato del tipo de cadena puede afectar el valor final exacto.  Por lo tanto, es mejor no usar este m√©todo.  Por ejemplo, en Safari e Internet Explorer, un valor de cadena como <code>2015‚Äì10‚Äì12 12:00:00</code> devuelve <code>NaN</code> , mientras que en Chrome y Firefox devuelve la zona horaria local.  En algunas situaciones, se devuelve un valor basado en UTC. <br><br><h2>  Crear un objeto de fecha utilizando datos del servidor </h2><br>  Suponga que desea recibir datos de un servidor.  Si est√°n en forma de tiempo num√©rico de Unix, simplemente puede usar el constructor para crear un objeto <code>Date</code> .  Todav√≠a no he mencionado que cuando el constructor <code>Date</code> recibe un valor √∫nico como un par√°metro √∫nico, calcula el valor de tiempo Unix en milisegundos (nota: JS procesa el tiempo Unix en milisegundos. Esto significa que el segundo valor debe multiplicarse por 1000).  Al ejecutar el siguiente c√≥digo, obtenemos el mismo valor que en el ejemplo anterior: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> d1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(<span class="hljs-number"><span class="hljs-number">1489199400000</span></span>); d1.toString(); <span class="hljs-comment"><span class="hljs-comment">// Sat Mar 11 2017 11:30:00 GMT+0900 (KST)</span></span></code> </pre> <br>  ¬øY si en lugar de Unix-time usa el tipo de cadena ISO-8601?  Como expliqu√© anteriormente, el m√©todo <code>Date.parse()</code> se vuelve poco confiable y es mejor no usarlo.  Sin embargo, comenzando con ECMAScript 5, puede usar construcciones de cadena en el formato ISO-8601 en el constructor de <code>Date</code> en Internet Explorer 9.0 y superior. <br><br>  Si no est√° utilizando el navegador m√°s reciente, aseg√∫rese de que la <code>Z</code> al final de los valores.  Sin √©l, su antiguo navegador puede interpretar el valor en funci√≥n de la hora local, no UTC.  Aqu√≠ hay un ejemplo de uso en Internet Explorer 10: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> d1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(<span class="hljs-string"><span class="hljs-string">'2017-03-11T11:30:00'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> d2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(<span class="hljs-string"><span class="hljs-string">'2017-03-11T11:30:00Z'</span></span>); d1.toString(); <span class="hljs-comment"><span class="hljs-comment">// "Sat Mar 11 11:30:00 UTC+0900 2017" d2.toString(); // "Sat Mar 11 20:30:00 UTC+0900 2017"</span></span></code> </pre> <br>  Seg√∫n la especificaci√≥n, en ambos casos se debe obtener el mismo valor.  Pero son diferentes.  En un navegador posterior, los valores ser√°n los mismos.  Para evitar este problema, agregue siempre <code>Z</code> al final de la l√≠nea si la informaci√≥n de zona horaria no est√° disponible. <br><br><h2>  Crear una fecha para pasar al servidor </h2><br>  Ahora puede usar la <code>Date</code> creada anteriormente, recuperar o agregar la hora libremente seg√∫n las zonas horarias locales.  Solo al final del procesamiento no olvide convertir los datos al formato anterior antes de devolverlos al servidor. <br><br>  Si es tiempo de Unix, puede usar el m√©todo <code>getTime()</code> (no se olvide de milisegundos). <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> d1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(<span class="hljs-number"><span class="hljs-number">2017</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>); d1.getTime(); <span class="hljs-comment"><span class="hljs-comment">// 1489199400000</span></span></code> </pre> <br>  ¬øQu√© pasa con un valor de cadena en formato ISO-8601?  Como dije, Internet Explorer 9.0 y superior son compatibles con ECMAScript 5, y las versiones posteriores son compatibles con ISO-8601.  Por lo tanto, usando los <code>toISOString()</code> o <code>toJSON()</code> , puede crear una cadena en ISO-8601 ( <code>toJSON()</code> puede usarse para llamadas recursivas con <code>JSON.stringify()</code> y otros).  Ambos m√©todos dan el mismo resultado, excepto cuando se procesan datos no v√°lidos: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> d1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(<span class="hljs-number"><span class="hljs-number">2017</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>); d1.toISOString(); <span class="hljs-comment"><span class="hljs-comment">// "2017-03-11T02:30:00.000Z" d1.toJSON(); // "2017-03-11T02:30:00.000Z" const d2 = new Date('Hello'); d2.toISOString(); // Error: Invalid Date d2.toJSON(); // null</span></span></code> </pre> <br>  Puede usar los m√©todos <code>toGMTString()</code> o <code>toUTCString()</code> para crear una cadena UTC.  Esto dar√° como resultado un valor que cumple con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC-1123</a> . <br><br>  El objeto <code>Date</code> incluye <code>toString()</code> , <code>toLocaleString()</code> y sus m√©todos de extensi√≥n.  Pero son de poca utilidad, ya que se utilizan principalmente para devolver cadenas basadas en la zona horaria local, y los valores devueltos dependen del navegador y el sistema operativo. <br><br><h2>  Cambia tu zona horaria local </h2><br>  Como puede ver, hay alg√∫n tipo de soporte de zona horaria en JS.              ?           ?      , JS       .         ,         .   .  ,   . <br><br>      .       .     11.30 11  2017       - .     Unix-    ,  -   <code>-05:00</code> .    ,       . <br><br>       <code>getTimeZoneOffset()</code> .   API  JavaScript,        .        : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> seoul = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(<span class="hljs-number"><span class="hljs-number">1489199400000</span></span>); seoul.getTimeZoneOffset(); <span class="hljs-comment"><span class="hljs-comment">// -540</span></span></code> </pre> <br>  <code>-540</code> ,     540   .    ,      ( <code>+09:00</code> ).  , ,    .          -,   <code>60 * 5 = 300</code> .   <code>840</code>       <code>Date</code> .     <code>getXX</code>       .       : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">formatDate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">date</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> date.getFullYear() + <span class="hljs-string"><span class="hljs-string">'/'</span></span> + (date.getMonth() + <span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-string"><span class="hljs-string">'/'</span></span> + date.getDate() + <span class="hljs-string"><span class="hljs-string">' '</span></span> + date.getHours() + <span class="hljs-string"><span class="hljs-string">':'</span></span> + date.getMinutes(); } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> seoul = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(<span class="hljs-number"><span class="hljs-number">1489199400000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ny = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(<span class="hljs-number"><span class="hljs-number">1489199400000</span></span> - (<span class="hljs-number"><span class="hljs-number">840</span></span> * <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>)); formatDate(seoul); <span class="hljs-comment"><span class="hljs-comment">// 2017/3/11 11:30 formatDate(ny); // 2017/3/10 21:30</span></span></code> </pre> <br> <code>formatDate()</code>              -. ,    .        ,      ?  , .   ,      ‚Äî   ,     .                ( ). <br><br><h2>      </h2><br>       ,     . ,       -,      11  15 .    <code>setDate()</code>   <code>Date</code> ,    ,    . <br><br><pre> <code class="javascript hljs">ny.setDate(<span class="hljs-number"><span class="hljs-number">15</span></span>); formatDate(ny); <span class="hljs-comment"><span class="hljs-comment">// 2017/3/15 21:30</span></span></code> </pre> <br>  ,    .  ,      ?   ,       <code>getTime()</code>  <code>getISOString()</code> .     ,      . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> time = ny.getTime() + (<span class="hljs-number"><span class="hljs-number">840</span></span> * <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-comment"><span class="hljs-comment">// 1489631400000</span></span></code> </pre> <br>   ,      ,         .             <code>Date</code>   ?  No    <code>Date</code>        11-  15-,   4  ( <code>24 * 4 * 60 * 60 * 1000</code> ).      -     10-  15-,    5  ( <code>24* 5 * 60 * 60 * 1000</code> ).             . <br><br>     .     ,     .   -     12 ,   15  2017  <code>-04:00</code> ,   <code>-05:00</code> .      ,    780 ,   60  ,   . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> time = ny.getTime() + (<span class="hljs-number"><span class="hljs-number">780</span></span> * <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-comment"><span class="hljs-comment">// 1489627800000</span></span></code> </pre> <br>   ,        -      ,         . <br><br>  ,                .    ,    ,   ,       .       ,     ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> IANA</a> . <br><br>         ,         <code>Date</code>      ,        .  ,   .         ,        .    .        JS    .     . <br><br><h2> Moment Timezone </h2><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Moment</a> ‚Äî  JavaScript-,   .    API     ,        .       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Moment Timezone</a> ,     .     IANA        API,         . <br><br>           .  ,         .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> . <br><br> ,  Moment Timezone: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> seoul = moment(<span class="hljs-number"><span class="hljs-number">1489199400000</span></span>).tz(<span class="hljs-string"><span class="hljs-string">'Asia/Seoul'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ny = moment(<span class="hljs-number"><span class="hljs-number">1489199400000</span></span>).tz(<span class="hljs-string"><span class="hljs-string">'America/New_York'</span></span>); seoul.format(); <span class="hljs-comment"><span class="hljs-comment">// 2017-03-11T11:30:00+09:00 ny.format(); // 2017-03-10T21:30:00-05:00 seoul.date(15).format(); // 2017-03-15T11:30:00+09:00 ny.date(15).format(); // 2017-03-15T21:30:00-04:00</span></span></code> </pre> <br>  <code>seoul</code>  ,   <code>ny</code>   <code>-05:00</code>  <code>-04:00</code> .     <code>format()</code> ,      ISO-8601,     .       . <br><br><h2>  Conclusi√≥n </h2><br>   API  ,   JavaScript,     .          ,         API,   Internet Explorer 9  .     ,     .                  ,     <code>getTimezoneOffset()</code> .        ,     .     Moment Timezone. <br><br>     ,   ,   .      :  .   ,    ,    ,   .      ,      JavaScript    .   ,      . <br><br><h2>  Enlaces utiles </h2><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Pluralsight: Date and Time Fundamentals</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Wikipedia: timezone</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Wikipedia: DST</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Wikipedia: Unix Time</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Wikipedia: ISO-8601</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">IANA timezone Database</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Microsoft Daylight Saving Time &amp; Time Zone Blog</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MDN: Date API</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">java.util.Date API</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Moment Timezone</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC-1123</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC2888</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/438286/">https://habr.com/ru/post/438286/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../438270/index.html">Love Kubernetes en Mail.ru Group: 14 de febrero</a></li>
<li><a href="../438272/index.html">C√≥mo enviamos SMS desde la cueva</a></li>
<li><a href="../438274/index.html">Definici√≥n de "personalidad t√≥xica" en TI</a></li>
<li><a href="../438278/index.html">Ense√±ar a los ni√±os a programar</a></li>
<li><a href="../438280/index.html">"Eliminar" objetos en Django</a></li>
<li><a href="../438288/index.html">Protecci√≥n sin miedo. Seguridad de memoria en √≥xido</a></li>
<li><a href="../438290/index.html">Post-mortem con GGJ-2019: c√≥mo obtener golpes, pero a√∫n as√≠ hacer el juego</a></li>
<li><a href="../438292/index.html">Automatizaci√≥n de apartamentos con HomePod, Raspberry Pi y Node.js</a></li>
<li><a href="../438294/index.html">Encontrar Twitch Streamers en una partida de PUBG</a></li>
<li><a href="../438296/index.html">OpenSceneGraph: Sistema de complementos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>