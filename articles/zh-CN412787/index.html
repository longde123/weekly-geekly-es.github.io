<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏽‍🌾 🕸️ 👨🏽‍🍳 将Git嵌入企业开发系统中 🖨️ 🙅 👨🏽‍🌾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="知道并知道如何使用git的开发人员最近增长了一个数量级。 您习惯了命令执行的速度。 您习惯了分支机构的便利和更改的轻松回滚。 解决冲突是如此普遍，以至于程序员习惯于英勇地解决不应该解决的冲突。 


 Directum的团队正在开发用于平台解决方案的开发工具。 如果您看到1C，那么您可以粗略地想象一...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>将Git嵌入企业开发系统中</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412787/"><p><img src="https://habrastorage.org/webt/vt/fp/ou/vtfpoukjlruesmucbjvwrgshncc.jpeg"></p><br><p> 知道并知道如何使用git的开发人员最近增长了一个数量级。 您习惯了命令执行的速度。 您习惯了分支机构的便利和更改的轻松回滚。 解决冲突是如此普遍，以至于程序员习惯于英勇地解决不应该解决的冲突。 </p><br><p> Directum的团队正在开发用于平台解决方案的开发工具。 如果您看到1C，那么您可以粗略地想象一下我们“客户”（应用程序开发人员）的工作环境。 应用程序开发人员使用此开发工具为客户创建应用程序解决方案。 </p><br><p> 我们的团队面临着简化申请人生活的任务。 我们为Visual Studio，ReSharper和IDEA的现代芯片所宠爱。 申请人要求我们将git开箱即用地集成到该工具中。 </p><a name="habracut"></a><br><p> 这就是困难。 在每种类型的实体（合同，报告，目录，模块）的工具中，都可能存在锁定。 一位开发人员开始编辑实体类型并阻止它，直到完成更改并将其提交到服务器。 此时，其他开发人员将相同类型的实体视为只读。 该开发使人想起了在SVN中工作或在多个用户之间通过邮件发送Word文档的过程。 我一次想要所有东西，但也许只有一个。 </p><br><p> 每种类型的实体可以具有许多处理程序（打开文档，在保存之前进行验证，写入数据库），您需要在其中编写与实体的特定实例配合使用的代码。 例如，锁定按钮，向用户显示消息或为表演者创建新任务。 该平台提供的API框架内的所有代码。 处理程序是其中包含许多方法的类。 当两个人需要用代码修复同一文件时，则无法执行此操作，因为平台会阻止整个实体类型以及相关代码。 </p><br><p> 我们的从业人员一路过关斩将。 他们悄悄地给自己分了一份我们开发环境的“非法”副本，注释掉了阻塞部分，并将我们的提交合并到了自己身上。 应用程序代码保存在git下，通过第三方工具（git bash，SourceTree和其他工具）提交。 我们得出结论： </p><br><ol><li> 我们的团队低估了应用程序开发人员适应该平台的意愿。 巨大的尊重和荣誉！ </li><li> 他们提出的解决方案不适合生产。 有了git，一个人的手就可以解开，并且他可以创建任何东西。 要支持所有的多样性将是愚蠢的，不要劫持。 另外，有必要教育平台客户。 记录平台的所有git命令都会使文档团队发疯。 </li></ol><br><p><img src="https://habrastorage.org/webt/2o/o9/ik/2oo9ikx4h9ctyrdh86yktmh-waa.jpeg"></p><br><h1 id="chego-hochetsya-ot-git"> 您想从Git获得什么 </h1><br><p> 因此，用git out放弃生产是不好的。 我们决定以某种方式封装主要操作的逻辑并限制其数量。 至少对于第一个版本。 尽可能减少了参赛队伍，并保持： </p><br><ul><li> 状态 </li><li> 提交 </li><li> 拉 </li><li> 推 </li><li> 重设--hard到HEAD </li><li> 重置为最后的“服务器”提交 </li></ul><br><p> 对于第一个发行版，他们决定拒绝与分支机构合作。 并不是说这很困难，只是团队没有满足时间资源。 </p><br><p> 我们的合作伙伴会定期发送他们的应用程序开发并询问：“某些事情对我们不起作用。我们在做错什么？”。 在这种情况下，应用程序会使用其他人的开发来加载自身并查看代码。 过去这样工作： </p><br><ol><li> 开发人员随开发人员一起删除了归档文件； </li><li> 在配置中更改了本地数据库； </li><li> 把别人的发展倒在自己的基础上； </li><li> 调试，发现错误； </li><li> 提出的建议； </li><li> 他把自己的发展归还了 </li></ol><br><p> 新方法不适合旧方法。 我不得不砸头。 该团队提出了两种解决此问题的方法： </p><br><ol><li> 将所有开发内容存储在一个git存储库中。 如有必要，请与其他人共同决定创建一个临时分支。 </li><li> 将不同团队的开发存储在不同的存储库中。 将加载到环境中的文件夹的设置移到配置文件中。 </li></ol><br><p> 我们决定走第二条路。 第一个似乎很难实现，而且通过分支切换更容易使自己陷入困境。 </p><br><p> 但是第二个也不甜。 上述命令不仅应在同一个存储库中运行，而且应同时运行多个。 来自不同存储库的实体类型是否发生变化？ 我们在一个窗口中显示它们。 对于应用程序开发人员来说，这更加方便和透明。 通过按下提交按钮，该工具会将更改提交到每个存储库。 因此，“在幕后”的拉/推/复位命令适用于物理上不同的存储库。 </p><br><p><img src="https://habrastorage.org/webt/cj/jx/hc/cjjxhctyhbggbu0zuy2-tfw1zhs.jpeg"></p><br><h1 id="libgit2sharp">  Libgit2sharp </h1><br><p> 要使用git，我们从两个选项中进行选择： </p><br><ol><li> 使用系统上安装的git，将其拉到Process.Start并解析输出。 </li><li> 使用libgit2sharp，它可以通过pinvoke拉到libgit2库。 </li></ol><br><p> 在我们看来，使用现成的库是一个合理的解决方案。 是徒劳的。 我稍后再告诉您原因。 最初，图书馆为我们提供了快速推出可运行原型的机会。 </p><br><h1 id="pervaya-iteraciya-razrabotki"> 第一次开发迭代 </h1><br><p>大约一个月就可以实施。 实际上，拧紧git很快，而且大多数时候我们试图修复已经打开的伤口，因为我们已经切断了存储源文件的旧机制。  <code>git status</code>返回的所有内容都返回到接口。 单击每个文件将显示差异。 它看起来像一个git gui界面。 </p><br><h1 id="vtoraya-iteraciya-razrabotki"> 二次开发迭代 </h1><br><p> 第一种选择是提供过多信息。 对于每种类型的实体，一次都会关联许多文件。 这些文件产生了噪音，并且不清楚哪些类型的实体发生了变化以及究竟发生了什么变化。 </p><br><p> 按实体类型对文件进行分组。 每个文件都有一个易于理解的名称，与GUI中的名称相同。 实体类型元数据在JSON中进行了描述。 它们还需要以人类可读的格式呈现。 使用jsondiffpatch库开始分析json版本“之前”和“之后”的变化，然后他们编写了自己的JSON比较实现（以下称为JSONdiff）。 我们通过产生人类可读记录的分析器来运行比较结果。 从视图中隐藏了许多文件，从而在更改树中保留了一个简单的条目。 </p><br><p> 最终结果如下： </p><br><p><img src="https://habrastorage.org/webt/g7/pl/3k/g7pl3ku4bqatgba2u9t6_msyxlc.png"></p><br><h1 id="voznikshie-slozhnosti-s-libgit2">  libgit2遇到问题 </h1><br><p>  Libgit2产生了大量意外的惊喜。 与某些人打交道超出了合理时间的能力。 我会告诉你我所记得的。 </p><br><p> 某些标准操作会导致意外和难以复制。  “本机库未提供任何错误”告诉​​我们包装器。 太好了 您正在诅咒，正在调试中重建本机库，正在重复以前删除的案例，但在调试模式下不会崩溃。 在发行版本中进行重建，然后再次下降。 </p><br><p> 如果第三方工具（例如SourceTree）与libgit2sharp并行运行，则commit可能不会提交某些文件。 或在某些文件上显示差异时冻结。 一旦尝试调试，就无法复制。 </p><br><p> 在我们的一个应用程序中， <code>git status</code>的实现耗时40秒。 四十卡尔！ 同时，从控制台启动的git可以正常运行一秒钟。 我花了几天的时间进行整理。 搜索更改时，Libgit2会查看文件夹的文件属性，并将其与索引中的条目进行比较。 如果修改时间不同，则说明文件夹中的内容已更改，您需要查看内部和/或查看文件。 如果一切都没有改变，那么您不应该爬进去。 显然，控制台git中也进行了这种优化。 我不知道是什么原因，但只是git索引中的一个人mtime发生了变化。 因此，git每次都会检查存储库中所有文件的内容是否有更改。 </p><br><p> 在发布时，我们的团队<code>fetch + rebase + autostash</code>了应用程序团队的意愿，并用<code>fetch + rebase + autostash</code>代替了<code>git pull</code> 。 然后，我们发现了许多错误，包括“本机库没有提供错误”。 </p><br><p> 状态，提取和重新设置工作的时间比调用控制台命令的时间长得多。 </p><br><h1 id="avtomaticheskiy-merzh"> 自动合并 </h1><br><p> 开发中的文件分为两种类型： </p><br><ol><li> 应用程序在开发工具中看到的文件。 例如，代码，图像，资源。 这些文件需要像git一样合并。 </li><li> 开发环境创建的JSON文件，但是应用程序开发人员只能以GUI的形式看到它们。 他们需要自动解决冲突。 </li><li> 使用开发工具时会自动重新创建的生成文件。 这些文件不会进入存储库，该工具会立即小心地放置.gitignore。 </li></ol><br><p> 通过一种新方法，两个不同的施加器能够更改相同类型的实体。 </p><br><p> 例如，Sasha将更改有关如何在数据库中存储实体类型的信息并为save事件编写处理程序，而Sergey将为实体的表示样式。 从git的角度来看，这不会是冲突，并且两个更改都将合并而不会带来复杂性。 </p><br><p> 然后，Sasha更改了Property1属性并为其设置了处理程序。  Sergey创建了Property2属性并设置了处理程序。 如果从上面看情况，尽管从git的角度来看，相同的文件也会受到影响，但它们的更改不会冲突。 <br> 我希望该工具能够自行解决这种情况。 </p><br><p> 在发生冲突时合并两个JSON的示例算法： </p><br><ol><li><p> 从JSON基本git下载。 </p><br></li><li><p> 从我们的JSON gita下载。 </p><br></li><li><p> 从git下载他们的JSON。 </p><br></li><li><p> 使用jsondiff，我们形成base-&gt;我们的软件补丁并应用于它们。 生成的JSON称为P1。 </p><br></li><li><p> 使用jsondiff，我们形成base-&gt;他们的软件补丁并应用于我们的补丁。 生成的JSON称为P2。 </p><br></li><li><p> 理想情况下，在应用补丁P1 === P2之后。 如果是这样，则将P1写入磁盘。 </p><br></li><li> 在不完美的情况下（当确实存在冲突时），我们建议用户在P1和P2之间进行选择，并具有用双手完成的能力。 我们将选择内容写入磁盘。 </li></ol><br><p> 合并后，我们检查是否达到没有验证错误的状态。 如果您尚未到达，请取消合并并要求用户重复。 这不是最佳解决方案，但至少可以保证第二次或第三次合并不会发生令人不愉快的后果。 </p><br><h1 id="itogi"> 总结 </h1><br><ol><li> 屠夫很高兴他们可以合法使用。 </li><li>  git的引入加快了开发速度。 </li><li> 自动合并通常看起来很神奇。 </li><li> 我们将对libgit2的未来拒绝放在了一起，以调用git进程。 </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN412787/">https://habr.com/ru/post/zh-CN412787/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt486164/index.html">Coronavírus 2019-nCoV. Perguntas frequentes sobre proteção respiratória e desinfecção</a></li>
<li><a href="../pt486174/index.html">Tenho rotatividade zero</a></li>
<li><a href="../zh-CN412781/index.html">NES爱好者可以在控制台上启动SNES游戏</a></li>
<li><a href="../zh-CN412783/index.html">在Centos 7上从源代码安装MTProto Telegram代理</a></li>
<li><a href="../zh-CN412785/index.html">管理硕士和自由职业者。 故事分为三个部分</a></li>
<li><a href="../zh-CN412789/index.html">“工作中的帮助”：如何使聊天机器人更智能</a></li>
<li><a href="../zh-CN412791/index.html">改善视频监控系统的性能并防止崩溃</a></li>
<li><a href="../zh-CN412793/index.html">MassTransit，Saga和RabbitMQ用于实施流程管理器</a></li>
<li><a href="../zh-CN412795/index.html">让我们从文章“极客时代重返哈勃尔到底出了什么问题”的讨论中得出结论。</a></li>
<li><a href="../zh-CN412797/index.html">关于Google的CDN，服务和字体的危害</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>