<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õπüèº üõë ‚öìÔ∏è Vigilant Lida: Automatizaci√≥n de pruebas de seguridad üïü üë©üèª‚Äç‚öñÔ∏è ü¶á</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Buenas tardes, queridos lectores. Mi nombre es Victor Burov, soy desarrollador en ISPsystem. En la √∫ltima publicaci√≥n habl√© sobre la herramienta para ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Vigilant Lida: Automatizaci√≥n de pruebas de seguridad</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ispsystem/blog/426969/">  Buenas tardes, queridos lectores.  Mi nombre es Victor Burov, soy desarrollador en ISPsystem.  En la √∫ltima publicaci√≥n habl√© sobre la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">herramienta para crear</a> pruebas autom√°ticas, hoy compartir√© mi experiencia en la automatizaci√≥n de pruebas de seguridad. <br><br><img src="https://habrastorage.org/webt/9t/xm/uy/9txmuy_rzmrhxjp0mbe4hfobvq8.jpeg"><br><br>  Al principio, un empleado separado busc√≥ las vulnerabilidades en los productos.  Las pruebas manuales tomaron mucho tiempo y no garantizaban que se encontraran todas las vulnerabilidades.  Habiendo comprobado las leyes b√°sicas de las pruebas, llegamos a la conclusi√≥n de que puede automatizarse.  Luego decidimos escribir una utilidad que facilitar√° la vida del probador, le ahorrar√° tiempo y le permitir√° verificar los productos despu√©s de cada cambio.  Como el probador se llamaba Lida, nombramos la nueva aplicaci√≥n en su honor.  En general, en nuestra empresa se ha convertido en una tradici√≥n llamar a las herramientas de prueba por los nombres de los evaluadores. <br><a name="habracut"></a><br>  Despu√©s de analizar las utilidades de b√∫squeda de vulnerabilidades, llegu√© a la conclusi√≥n de que todos necesitan especificar las funciones a llamar y los par√°metros utilizados.  Nuevamente decidimos aprovechar la interfaz unificada y formulamos los requisitos para Lida. <br><br><h4>  Requisitos de inicio: </h4><br><ol><li>  Crear autom√°ticamente listas de funciones. </li><li>  Opciones de autocompletar. </li><li>  Hacer solicitudes de API. </li><li>  An√°lisis de salida de datos despu√©s de realizar funciones. </li><li>  Buscar vulnerabilidades en los datos. </li><li>  Formaci√≥n de informes. </li><li>  Configuraciones flexibles. </li></ol><br>  Darse cuenta de todo esto no fue f√°cil. <br><br><h2>  Implementaci√≥n </h2><br><h3>  Omitir formularios y listas </h3><br>  Para encontrar vulnerabilidades en una funci√≥n, debe ejecutarse pasando los par√°metros necesarios.  Nuestra interfaz se basa en listas y formularios, por lo que puede automatizar la recopilaci√≥n de datos procesando documentos xml que describen la estructura de los elementos de la interfaz. <br><br>  Decid√≠ comenzar el rastreo desde el men√∫ principal, yendo recursivamente a todas las listas anidadas.  "Lida" abre la lista del primer nivel.  Como regla, tiene varios botones que invocan algunas funciones. <br><br>  Si el bot√≥n abre el formulario, el resultado de la llamada ser√° un documento xml con nodos que contienen informaci√≥n sobre los campos: nombre, validador, rango de valores v√°lidos.  En base a esta informaci√≥n, se generan valores de campo.  Por ejemplo, se generar√° un n√∫mero para int.  Si no hay un validador, se genera una cadena aleatoria.  Despu√©s de completar todos los campos del formulario, se env√≠a una solicitud. <br><br>  Si la funci√≥n es una lista, se abrir√° y las funciones asociadas con los botones se llamar√°n por sus elementos. <br><br>  Al verificar las listas, surge un problema: todas las listas deben tener un conjunto de registros que garanticen que se pueda hacer clic en todos los botones de la lista. <br><br><h3>  B√∫squeda por inyecci√≥n SQL </h3><br>  La inyecci√≥n SQL es probablemente uno de los problemas m√°s comunes para las aplicaciones, incluido el nuestro.  Muchas llamadas a funciones generan varias consultas DBMS.  Se produce un error cuando los par√°metros que provienen del exterior se sustituyen en el cuerpo de la solicitud "tal cual".  Las consecuencias de tales errores pueden ser tristes: desde la recepci√≥n no autorizada de datos hasta la eliminaci√≥n de tablas. <br><br>  Para comenzar la b√∫squeda de inyecciones SQL, organic√© el resultado de todas las consultas SQL en un archivo.  Despu√©s de ejecutar la funci√≥n, la aplicaci√≥n busca los valores de los par√°metros pasados ‚Äã‚Äãen las consultas SQL resultantes. <br><br>  <i>Puede usar el registro del servidor SQL en s√≠.</i>  <i>Pero en nuestro caso, solo hay un m√©todo para ejecutar consultas y agregar registros no fue dif√≠cil.</i>  <i>Gracias a esto, sabemos exactamente qu√© desaf√≠o ha generado esta o aquella solicitud.</i> <br><br>  Cuando se encuentra el valor del par√°metro pasado, la utilidad pasa un valor que contiene una comilla simple a este par√°metro.  Si la cita se encuentra en la misma secuencia, entonces el par√°metro no se escapa; encontramos un lugar para la inyecci√≥n de SQL. <br><br><h3>  An√°lisis de llamadas del sistema </h3><br>  Un problema similar ocurre cuando realizamos llamadas al sistema.  Decid√≠ buscarlos con strace y seleccion√© los par√°metros de lanzamiento √≥ptimos para ello.  Ejemplo de inicio de ISPmanager: <br><br><pre><code class="xml hljs">strace -f -s 1024 -e trace=file,process bin/core ispmgr</code> </pre> <br>  Adem√°s de las inyecciones de SQL, Lida realiza una funci√≥n y analiza la salida de capas para determinar si se incluyen los valores de los par√°metros pasados ‚Äã‚Äãpara <i>abrir, desvincular, rmdir, chmod chown, chflags, mknod, mkfifo, fcntl, enlace simb√≥lico, enlace, execve, mkdir</i> . <br><br>  Si se encuentra el par√°metro, la utilidad le pasa un valor que contiene, por ejemplo, una ruta con una transici√≥n al directorio anterior.  Si se pone como est√°, entonces se encuentra una vulnerabilidad potencial. <br><br>  El an√°lisis de la funci√≥n ejecutiva result√≥ ser muy √∫til.  Le permite determinar en qu√© funci√≥n no se escapan los argumentos para ejecutar archivos ejecutables.  Este error es muy costoso, porque a trav√©s de √©l puede obtener acceso de root al servidor simplemente cambiando la contrase√±a. <br><br><blockquote>  Cuando los usuarios encuentran una vulnerabilidad en nuestros productos, la compa√±√≠a paga una recompensa en efectivo, cuyo monto depende de la categor√≠a de vulnerabilidad.  Este enfoque puede ser m√°s barato que buscar errores por su cuenta (es posible que el probador no encuentre el error y reciba un salario). </blockquote><br>  <i>Otra prueba interesante: verificar el orden de invocaci√≥n de las funciones estad√≠sticas y otras.</i>  <i>A menudo, el acceso se verifica primero a trav√©s de estad√≠sticas, y luego algunas acciones inseguras, lo que deja la oportunidad de sustituci√≥n.</i>  <i>Pero no automatizamos esto.</i> <br><br><h3>  Comprobando el acceso a objetos extra√±os </h3><br>  Verificamos el acceso a objetos extra√±os de debajo del usuario para las entidades de otro usuario y administrador.  En este modo, verificamos la capacidad de leer, modificar y ver las listas de elementos de un usuario extranjero. <br><br>  Lida omite todas las funciones disponibles en nombre del propietario o administrador y recuerda sus elementos.  Luego llama a las mismas funciones con elementos de debajo de otro usuario.  En una situaci√≥n ideal, la respuesta deber√≠a ser un error como Acceso o Perdido.  Si no se recibe dicho error, por lo tanto, es muy probable que pueda leer los datos del usuario de otra persona. <br><br>  En algunos casos, la ausencia de un error no significa que pueda acceder directamente a los objetos de otros usuarios.  Al comienzo de tales funciones, agregamos una verificaci√≥n de permisos de elementos.  Esto verifica no solo la seguridad, sino tambi√©n la exactitud de las respuestas del servidor. <br><br><h3>  Validaci√≥n API </h3><br>  La validaci√≥n de nuestra API es una ventaja adicional de verificar las funciones en busca de vulnerabilidades.  Al analizar los informes sobre el trabajo de Lida, aprendimos a devolver los tipos correctos de errores, lo que hizo que nuestra API sea m√°s conveniente y l√≥gica.  Como resultado, al igual que con la grabadora de cinta, recibimos no solo un control de seguridad, sino que tambi√©n verificamos una vez m√°s que nuestra API sea "coherente". <br><br><h2>  Dificultades </h2><br><h4>  Falsos positivos </h4><br>  La utilidad puede funcionar con todos nuestros productos, por lo tanto, verifica muchas funciones diferentes.  B√°sicamente, aparecieron falsos positivos en el modo de verificar el acceso a objetos extra√±os.  Esto se debe a las caracter√≠sticas de los botones y funciones. <br><br>  Los falsos positivos fueron el mayor problema de Lida.  Parec√≠a que estaba completamente depurado, pero al verificar en diferentes paneles, surgieron nuevos falsos positivos.  Como resultado, hubo varias etapas de su correcci√≥n. <br><br><h4>  Creaci√≥n de entidad </h4><br>  La mayor√≠a de las acciones en el panel se realizan en cualquier entidad (nombre de dominio, base de datos, etc.).  Para lograr la m√°xima automatizaci√≥n, Lida tuvo que crear estas entidades autom√°ticamente.  Pero en la pr√°ctica esto result√≥ ser dif√≠cil de implementar.  A veces, la validaci√≥n se realiza en c√≥digo, por lo que no siempre es posible sustituir un valor de par√°metro autom√°ticamente.  La segunda raz√≥n son las entidades dependientes.  Por ejemplo, para crear un buz√≥n, debe crear un dominio de correo. <br><br>  Por lo tanto, decidimos no luchar por la automatizaci√≥n total.  Antes de comenzar, el probador crea entidades manualmente y toma una instant√°nea de la m√°quina, ya que las entidades cambiar√°n despu√©s de la verificaci√≥n.  Esto le permite no omitir la comprobaci√≥n de un grupo de funciones en caso de creaci√≥n incorrecta de una entidad. <br><br><h4>  Llamando a funciones destructivas </h4><br>  Casi todas las listas tienen funciones para eliminar o desactivar una entidad.  Si los ejecuta en secuencia, la entidad se eliminar√° antes de realizar otras funciones.  Defino tales funciones y realizo despu√©s de otras.  Adem√°s se agreg√≥ una clave que proh√≠be la ejecuci√≥n de tales funciones. <br><br>  Algunas funciones reinician el servidor.  Deben ser rastreados y agregados a la lista de ignorados. <br><br>  Debido a la naturaleza de la l√≥gica de funcionamiento, algunas funciones reinician el panel.  Durante las pruebas de seguridad, esto hace que el panel se inicie sin rastrear consultas SQL o estratos; una mayor verificaci√≥n deja de tener sentido.  Tiene que rastrear esto y reiniciar el panel en modo rastreo. <br><br><h4>  Comprobaci√≥n de par√°metros dependientes </h4><br>  En los formularios hay campos para ingresar texto, casillas de verificaci√≥n, listas desplegables, de cuyos valores depende la disponibilidad de valores de otros campos.  Cada valor del campo dependiente puede tener una secci√≥n de c√≥digo separada, por lo tanto, las partes cuando pueden permanecer sin verificar. <br><br>  Para resolver este problema, agregu√© algoritmos para analizar campos dependientes y verificar todas las combinaciones de controles dependientes. <br><br><h4>  Comprobar funciones no disponibles en la interfaz </h4><br>  Las funciones de servicio no est√°n disponibles para la transici√≥n, pero pueden contener vulnerabilidades.  Para identificarlos y verificarlos, tenemos una funci√≥n especial que devuelve una lista de todas las funciones registradas.  Comparamos esta lista con la lista de funciones probadas.  No hay metadatos para las funciones de utilidad, por lo que es imposible verificar los par√°metros procesados ‚Äã‚Äãdentro de ellos. Para verificar tales funciones, les paso nuestros par√°metros est√°ndar <i>elid, plid</i> y otros. <br><br><h2>  Conclusi√≥n </h2><br>  Incluimos a Lida en cada construcci√≥n nocturna en Jenkins.  En funci√≥n de los resultados de su trabajo, se genera un informe de verificaci√≥n y se muestra informaci√≥n sobre la funci√≥n sospechosa con todos los par√°metros. <br><br>  La tarea cerrada por el desarrollador ahora es verificada no solo por el probador, sino tambi√©n por Lida.  El probador procesa el informe recibido: copia los par√°metros de la funci√≥n sospechosa en el navegador y analiza el comportamiento y el panel de registro.  Si se confirma la vulnerabilidad, el error se registra en el desarrollador. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es426969/">https://habr.com/ru/post/es426969/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es426959/index.html">Instale kubernetes a trav√©s de kubespray (almacenamiento local, instale Elasticsearch + Fluentd + Kibana, prometheus)</a></li>
<li><a href="../es426961/index.html">C√≥mo Microsoft reescribi√≥ el compilador de C # a C # y lo abri√≥</a></li>
<li><a href="../es426963/index.html">¬øLas aplicaciones Flutter sue√±an con widgets basados ‚Äã‚Äãen plataformas?</a></li>
<li><a href="../es426965/index.html">¬øQu√© pasar√° con el manejo de errores en C ++ 2a?</a></li>
<li><a href="../es426967/index.html">Generador de c√≥digo ABAP en l√≠nea</a></li>
<li><a href="../es426971/index.html">Fatalismo en el manejo de errores</a></li>
<li><a href="../es426973/index.html">Sandwiches corporativos</a></li>
<li><a href="../es426975/index.html">Joker 2018: lo imposible es posible</a></li>
<li><a href="../es426977/index.html">LibreOffice: la pesadilla del contador</a></li>
<li><a href="../es426979/index.html">C√≥mo aprender ingl√©s gratis: 3 herramientas comunes e instrucciones detalladas para cada</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>