<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò¥ ü§≥ üéØ Pas une nouvelle relique: un regard sur Datadog et Atatus üßîüèª üë®‚Äçüë®‚Äçüë¶ üìß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans l'environnement des ing√©nieurs SRE / DevOps, vous ne serez pas surpris qu'un jour un client (ou un syst√®me de surveillance) apparaisse et dise qu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pas une nouvelle relique: un regard sur Datadog et Atatus</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/465177/"><img src="https://habrastorage.org/webt/rp/lp/ct/rplpctt6yzam8cvxnufgkygd3um.png"><br><br>  Dans l'environnement des ing√©nieurs SRE / DevOps, vous ne serez pas surpris qu'un jour un client (ou un syst√®me de surveillance) apparaisse et dise que ¬´tout est perdu¬ª: le site ne fonctionne pas, les paiements ne passent pas, la vie est en d√©composition ... Peu importe comment je voudrais aider dans cette situation Il peut √™tre tr√®s difficile de le faire sans un outil simple et compr√©hensible.  Souvent, le probl√®me est cach√© dans le code de l'application elle-m√™me - il vous suffit de le localiser. <br><br><h2>  Et dans le chagrin et dans la joie ... </h2><br>  Il se trouve que nous aimons depuis longtemps New Relic.  Il a √©t√© et reste un excellent outil pour surveiller les performances des applications, et vous permet √©galement d'instrumenter l'architecture de microservices (en utilisant votre agent) et bien plus encore.  Et tout pourrait √™tre merveilleux, si ce n'est les changements dans la politique de prix du service: son <b>co√ªt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">a</a> augment√© de plus de 3 fois <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">depuis 2013</a></b> .  De plus, depuis l'ann√©e derni√®re, l'obtention d'un compte d'essai n√©cessite une communication avec un responsable personnel, ce qui rend difficile la pr√©sentation du produit √† un client potentiel. <a name="habracut"></a><br><br>  La situation habituelle: New Relic n'est pas n√©cessaire ¬´sur une base continue¬ª, elle n'est m√©moris√©e qu'au moment o√π les probl√®mes ont commenc√©.  Mais vous devez toujours payer r√©guli√®rement (140 USD par serveur et par mois), et dans l'infrastructure cloud automatiquement √©volutive, les montants sont plut√¥t √©lev√©s.  Bien qu'il existe la possibilit√© de ¬´Pay-As-You-Go¬ª, mais pour activer New Relic, vous devrez red√©marrer l'application, ce qui peut entra√Æner la perte de la situation probl√©matique pour laquelle tout a √©t√© d√©marr√©.  Il n'y a pas si longtemps, New Relic a introduit un nouveau plan tarifaire - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Essentials</a> , qui √† premi√®re vue semble √™tre une alternative raisonnable √† Professional ... mais apr√®s un examen plus approfondi, il s'est av√©r√© que certaines des fonctions importantes manquaient (en particulier, il n'a pas de <i>transactions cl√©s</i> , de <i>tra√ßage inter-applications, de tra√ßage</i> <i>distribu√©</i> ) . <br><br>  En cons√©quence, nous avons pens√© trouver une alternative moins ch√®re, et notre choix s'est port√© sur les deux services Datadog et Atatus.  Pourquoi exactement sur eux? <br><br><h2>  √Ä propos des concurrents </h2><br>  Je dois dire tout de suite qu'il existe d'autres solutions sur le march√©.  Nous avons m√™me envisag√© des options Open Source, mais tous les clients n'ont pas la capacit√© gratuite d'h√©berger des solutions auto-h√©berg√©es ... - en outre, ils n√©cessiteront une maintenance suppl√©mentaire.  Le couple que nous avons s√©lectionn√© s'est av√©r√© le plus proche de <b>nos besoins</b> : <br><br><ul><li>  prise en charge int√©gr√©e et d√©velopp√©e pour les applications PHP (la pile de nos clients est tr√®s diversifi√©e, mais c'est un leader clair dans le contexte de la recherche d'une alternative √† New Relic); </li><li>  co√ªt abordable (moins de 100 USD par mois par h√¥te); </li><li>  instrumentation automatique; </li><li>  Int√©gration Kubernetes </li><li>  la similitude avec l'interface New Relic est un plus notable (car nos ing√©nieurs y sont habitu√©s). </li></ul><br>  Par cons√©quent, au stade de la s√©lection initiale, nous avons √©limin√© plusieurs autres solutions populaires, et en particulier: <br><br><ul><li>  Tideways, AppDynamics et Dynatrace - pour le prix; </li><li>  Stackify - est bloqu√© dans la F√©d√©ration de Russie et affiche trop peu de donn√©es. </li></ul><br>  L'article suivant est structur√© de telle mani√®re que les solutions envisag√©es seront bri√®vement pr√©sent√©es, apr√®s quoi je parlerai de notre interaction typique avec New Relic et de l'exp√©rience / des impressions d'effectuer des op√©rations similaires dans d'autres services. <br><br><h3>  Pr√©sentation des concurrents s√©lectionn√©s </h3><br><img src="https://habrastorage.org/webt/mu/el/kq/muelkqnuiwzgvaz_jtton8mrbzs.png"><br>  Tout le monde a probablement entendu parler de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>New Relic</b></a> ?  Ce service a commenc√© son d√©veloppement il y a plus de 10 ans, en 2008.  Nous l'utilisons activement depuis 2012 et n'avons pas rencontr√© de probl√®mes d'int√©gration avec un tr√®s grand nombre d'applications en PHP, Ruby et Python, et nous avions √©galement une exp√©rience d'int√©gration avec C # et Go.  Les auteurs du service ont des solutions pour surveiller l'application, l'infrastructure, le tra√ßage des infrastructures de microservices, des applications pratiques pour les appareils des utilisateurs ont √©t√© cr√©√©es, et bien plus encore. <br><br>  Cependant, l'agent New Relic fonctionne sur des protocoles propri√©taires, il ne prend pas en charge OpenTracing.  L'instrumentation avanc√©e n√©cessite des modifications sp√©cifiques √† New Relic.  Enfin, le support de Kubernetes a jusqu'√† pr√©sent un statut exp√©rimental. <br><br><img src="https://habrastorage.org/webt/4t/ae/fp/4taefp5hohou0ekzzmcrnduvzlu.png"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>Datadog</b></a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>qui a</b></a> commenc√© son d√©veloppement en 2010, semble nettement plus int√©ressant que New Relic en termes d'utilisation dans les environnements Kubernetes.  En particulier, il prend en charge l'int√©gration avec NGINX Ingress, la collecte des journaux, les protocoles statsd et OpenTracing, ce qui vous permet de suivre une demande utilisateur √† partir du moment o√π elle est connect√©e √† la fin du travail, ainsi que de trouver des journaux pour cette demande (√† la fois c√¥t√© serveur Web et c√¥t√© consommateur). <br><br>  Lors de l'utilisation de Datadog, nous √©tions confront√©s au fait qu'il construisait parfois de mani√®re incorrecte une carte de microservice et √† quelques failles techniques.  Par exemple, il a incorrectement d√©termin√© le type de service (il a pris Django pour un service de mise en cache) et a provoqu√© les 500e erreurs dans une application PHP utilisant la biblioth√®que Predis populaire. <br><br><img src="https://habrastorage.org/webt/h5/te/m9/h5tem9e4arkqlsoed48qc0u9xha.png"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>Atatus</b></a> est le plus jeune instrument;  service lanc√© en 2014.  Son budget marketing est nettement inf√©rieur aux concurrents list√©s, les mentions sont beaucoup moins fr√©quentes.  N√©anmoins, l'outil lui-m√™me est tr√®s similaire √† New Relic, et non seulement dans ses fonctionnalit√©s (APM, surveillance du navigateur, etc.), mais aussi en apparence. <br><br>  Un inconv√©nient important est uniquement la prise en charge de Node.js et PHP.  En revanche, il est beaucoup mieux impl√©ment√© que Datadog.  Contrairement √† ce dernier, Atatus n'exige pas que les applications modifient ou d√©finissent des balises suppl√©mentaires dans le code. <br><br><h2>  Comment nous travaillons avec New Relic </h2><br>  Voyons maintenant comment nous utilisons g√©n√©ralement New Relic.  Supposons que nous ayons un probl√®me qui doit √™tre r√©solu: <br><br><img src="https://habrastorage.org/webt/mk/_t/bv/mk_tbvlysng7--qgh2gvhjum4cg.png"><br><br>  Il est facile de remarquer une <b>pouss√©e</b> sur le graphique - nous l'analysons.  Dans New Relic, les transactions Web sont imm√©diatement s√©lectionn√©es pour l'application Web, tous les composants sont indiqu√©s dans le graphique des performances, il existe des panneaux de taux d'erreur, de taux de demande ... Plus important encore, directement √† partir de ces panneaux, vous pouvez vous d√©placer entre les diff√©rentes parties de l'application (par exemple, en cliquant sur MySQL, √† la section base de donn√©es). <br><br>  √âtant donn√© que dans cet exemple, nous voyons une augmentation de l'activit√© <b>PHP</b> , cliquez sur ce graphique et acc√©dez automatiquement √† <b>Transactions</b> : <br><br><img src="https://habrastorage.org/webt/02/2v/b_/022vb_o0euwqk8jaf2qh1z4pges.png"><br><br>  La liste des transactions, qui sont essentiellement des contr√¥leurs du mod√®le MVC, est d√©j√† tri√©e par <b>Plus longue</b> , ce qui est tr√®s pratique: on voit imm√©diatement ce que fait l'application.  Voici des exemples de longues requ√™tes collect√©es automatiquement par New Relic.  Changer de tri est facile √† trouver: <br><br><ul><li>  le contr√¥leur d'application le plus charg√©; </li><li>  Le contr√¥leur le plus fr√©quemment demand√© </li><li>  le plus lent des contr√¥leurs. </li></ul><br>  De plus, vous pouvez d√©velopper chaque transaction et voir ce que l'application faisait au moment de l'ex√©cution du code: <br><br><img src="https://habrastorage.org/webt/vq/bz/sk/vqbzsk-cj4sp9prjqwx16hnzy4k.png"><br><br>  Enfin, des exemples de longues traces de requ√™te (qui fonctionnent pendant plus de 2 secondes) sont enregistr√©s dans l'application.  Voici le panneau pour une longue transaction: <br><br><img src="https://habrastorage.org/webt/jk/b_/ux/jkb_uxm9a3tx9ed6wdtufrz5g6u.png"><br><br>  On peut voir que deux m√©thodes prennent beaucoup de temps, et avec lui le moment o√π la demande a √©t√© ex√©cut√©e, son URI et son domaine sont √©galement affich√©s.  Tr√®s souvent, cela aide √† trouver la requ√™te dans les journaux.  En allant aux <b>d√©tails</b> de la <b>trace</b> , vous pouvez voir d'o√π ces m√©thodes sont appel√©es: <br><br><img src="https://habrastorage.org/webt/_1/m6/li/_1m6li8g6zgv8siatzj1mrqiclc.png"><br><br>  Et dans les <b>requ√™tes de base de donn√©es</b> - √©valuez les requ√™tes de base de donn√©es qui ont √©t√© ex√©cut√©es au moment de l'application: <br><br><img src="https://habrastorage.org/webt/ru/xv/k7/ruxvk7jbfe-93duilolwh3nj7p8.png"><br><br>  Fort de ces connaissances, nous pouvons √©valuer la cause du ralentissement de l'application et, en collaboration avec le d√©veloppeur, d√©velopper une strat√©gie pour r√©soudre le probl√®me.  En r√©alit√©, New Relic ne donne pas toujours une image claire, mais cela aide √† choisir le vecteur d'investigation: <br><br><ul><li>  le long <code>PDO::Construct</code> nous a conduit au fonctionnement √©trange de pgpoll; </li><li>  instabilit√© dans le temps <code>Memcache::Get</code> une configuration incorrecte sugg√©r√©e de la machine virtuelle; </li><li>  le temps √©trangement augment√© pour le traitement du mod√®le a conduit √† une boucle imbriqu√©e avec un contr√¥le de la pr√©sence de 500 avatars dans le stockage d'objets; </li><li>  et ainsi de suite ... </li></ul><br>  Il arrive √©galement qu'au lieu d'ex√©cuter du code sur l'√©cran principal, quelque chose li√© au stockage de donn√©es externe se d√©veloppe - et peu importe ce que ce sera: Redis ou PostgreSQL - tous sont masqu√©s dans l'onglet <b>Bases de donn√©es</b> . <br><br><img src="https://habrastorage.org/webt/ku/ke/xe/kukexe0cn79kgj_x_40dt79au5e.png"><br><br>  Vous pouvez s√©lectionner une base sp√©cifique pour la recherche et trier les requ√™tes, de la m√™me mani√®re que pour les transactions.  Et en allant dans l'onglet de demande, vous pouvez voir combien cette demande se trouve dans chacun des contr√¥leurs d'application, ainsi qu'√©valuer la fr√©quence √† laquelle elle est appel√©e.  C'est tr√®s pratique: <br><br><img src="https://habrastorage.org/webt/ac/jm/xq/acjmxqt0dop9r1ncalo1enmrihq.png"><br><br>  L'onglet <b>Services externes</b> contient des donn√©es similaires, qui masquent les demandes de services HTTP externes, telles que l'acc√®s au magasin d'objets, l'envoi d'√©v√©nements √† la sentinelle, etc.  Par son contenu, l'onglet est compl√®tement similaire aux bases de donn√©es: <br><br><img src="https://habrastorage.org/webt/vv/2h/al/vv2halrqjfjjpqltn7ty1had57y.png"><br><br><h2>  Concurrents: opportunit√©s et impressions </h2><br>  Maintenant, la chose la plus int√©ressante est de comparer les capacit√©s de New Relic avec celles des concurrents.  Malheureusement, nous n'avons pas pu tester les trois outils sur la m√™me version d'une application en cours de production.  N√©anmoins, nous avons essay√© de comparer les situations / configurations les plus identiques. <br><br><h3>  1. Datadog </h3><br>  Datadog nous accueille avec un panneau avec un mur de services: <br><br><img src="https://habrastorage.org/webt/yt/vv/rt/ytvvrt5tlhegxiaoanulug0dwfu.png"><br><br>  Il essaie de diviser les applications en composants / microservices, donc dans l'exemple d'application Django, nous voyons 2 connexions √† PostgreSQL ( <code>defaultdb</code> et <code>postgres</code> ), ainsi qu'√† Celery, Redis.  Pour travailler avec Datadog, vous devez avoir une connaissance minimale des principes de MVC: vous devez comprendre d'o√π viennent les demandes des utilisateurs.  Habituellement, <b>une carte de service</b> aide √† cela: <br><br><img src="https://habrastorage.org/webt/t3/19/r9/t319r9yb96o3h0fjhdmi5wzdxbc.png"><br><br>  Au fait, il y a quelque chose de similaire dans New Relic: <br><br><img src="https://habrastorage.org/webt/f8/sr/tq/f8srtq3vds1qmm2ddrp_g-d6pwo.png"><br><br>  ... et leur carte, √† mon avis, est rendue plus simple et plus compr√©hensible: elle n'affiche pas les composants d'une application (ce qui la rendrait inutilement d√©taill√©e, comme dans le cas de Datadog), mais seulement des services ou microservices sp√©cifiques. <br><br>  Retour √† Datadog: il ressort clairement de la carte de service que les demandes des utilisateurs parviennent √† Django.  Allons au service Django et voyons enfin ce que nous attendions: <br><br><img src="https://habrastorage.org/webt/c3/ip/fk/c3ipfkqpsv9jxxr1m0y9lqz7fvw.png"><br><br>  Malheureusement, par d√©faut, il n'y a pas de graphique de <b>temps de transaction Web</b> similaire √† celui que nous voyons sur le panneau principal de New Relic.  Cependant, il peut √™tre configur√© √† la place du graphique <b>% du temps pass√©</b> .  Il suffit de le passer en <b>temps moyen par demande par type</b> ... et maintenant le tableau familier nous regarde! <br><br><img src="https://habrastorage.org/webt/0l/jb/4m/0ljb4m2fh3_mbje9ihwvo6hlwge.png"><br><br>  Pourquoi Datadog a opt√© pour un horaire diff√©rent est un myst√®re pour nous.  Il √©tait √©galement frustrant que le syst√®me ne se souvienne pas du choix de l'utilisateur (contrairement aux deux concurrents), et donc que la cr√©ation de panneaux personnalis√©s enregistre. <br><br>  Mais j'ai √©t√© heureux de l'opportunit√© dans Datadog de passer de ces graphiques aux m√©triques des serveurs associ√©s, de lire les journaux et d'√©valuer la charge des gestionnaires de serveurs Web (Gunicorn).  Tout est presque le m√™me que dans New Relic ... et m√™me quelques autres (journaux)! <br><br>  Sous les graphiques se trouvent des transactions qui sont compl√®tement similaires √† New Relic: <br><br><img src="https://habrastorage.org/webt/ln/pg/u5/lnpgu5fj2oclzdzlc1uwwjjtfkm.png"><br><br>  Dans Datadog, les transactions sont appel√©es <b>ressources</b> .  Vous pouvez trier les contr√¥leurs par le nombre de demandes, par le temps de r√©ponse moyen, par le temps √©coul√© maximum pour une p√©riode de temps s√©lectionn√©e. <br><br>  Vous pouvez √©tendre la ressource et voir tout ce que nous avons d√©j√† observ√© dans New Relic: <br><br><img src="https://habrastorage.org/webt/3s/c1/5k/3sc15ksmnyvw_e-gyfagahxtep8.png"><br><br>  Il y a des statistiques sur la ressource, et une liste g√©n√©ralis√©e d'appels internes, et des exemples de demandes qui peuvent √™tre tri√©es par le code de r√©ponse ... Au fait, nos ing√©nieurs ont vraiment aim√© ce tri. <br><br>  Tout exemple de ressource dans Datadog peut √™tre d√©velopp√© et explor√©: <br><br><img src="https://habrastorage.org/webt/k8/tm/j8/k8tmj8vcz91rwmv-_lvshtzd8qi.png"><br><br>  Les param√®tres de requ√™te, un diagramme r√©capitulatif du temps √©coul√© pour chacun des composants et un diagramme en cascade, dans lequel la s√©quence d'appels est visible, sont pr√©sent√©s.  De plus, le passage √† l'arborescence du diagramme en cascade est √©galement disponible: <br><br><img src="https://habrastorage.org/webt/og/uu/ro/oguurozj3wo9vibezkytxmmc0c4.png"><br><br>  Et la chose la plus int√©ressante est de visualiser la charge de l'h√¥te sur lequel la demande a √©t√© ex√©cut√©e et de consulter les journaux des demandes. <br><br><img src="https://habrastorage.org/webt/vg/n6/be/vgn6belqdye20suvjgsq5kje3wu.png"><br><br>  Grande int√©gration! <br><br>  Vous vous demandez peut-√™tre o√π se trouvent les onglets <b>Bases de donn√©es</b> et <b>Services externes</b> , comme dans New Relic.  Ils ne sont pas l√†: puisque Datadog analyse l'application en composants, PostgreSQL sera consid√©r√© comme un <b>service distinct</b> , et au lieu de Services externes, il vaut la peine de rechercher <code>aws.storage</code> (il en sera de m√™me pour tout autre service externe auquel l'application peut acc√©der). <br><br><img src="https://habrastorage.org/webt/qp/bp/ap/qpbpapt5pqxtre_bkspuob-myqe.png"><br><br>  Et voici un exemple avec <code>postgres</code> : <br><br><img src="https://habrastorage.org/webt/nb/u6/ea/nbu6eaa6-6xlbkipsijjn4i9rxg.png"><br><br>  En fait, il y a tout ce que nous voulions: <br><br><img src="https://habrastorage.org/webt/ww/r8/-c/wwr8-cpjbw26yv_chyaknlyolfe.png"><br><br>  On peut voir de quel "service" la demande provient. <br><br>  Il ne sera pas superflu de rappeler que Datadog s'int√®gre parfaitement √† NGINX Ingress et permet un suivi de bout en bout √† partir du moment o√π une demande arrive dans le cluster, et vous permet √©galement d'accepter des m√©triques statsd, de collecter des journaux et des m√©triques h√¥tes. <br><br>  Un √©norme avantage de Datadog est que son prix <i>comprend l'</i> infrastructure de surveillance, l'APM, la gestion des journaux et le test des synth√©tiques, c'est-√†-dire  Vous pouvez choisir un plan de mani√®re flexible. <br><br><h3>  2. Atatus </h3><br>  L'√©quipe d'Atatus affirme que son service est "le m√™me que New Relic, mais meilleur".  Voyons voir si c'est vraiment le cas. <br><br>  La barre de titre est vraiment la m√™me, mais il n'a pas √©t√© possible de d√©terminer le Redis et le memcached utilis√©s dans l'application. <br><br><img src="https://habrastorage.org/webt/-v/f8/9t/-vf89tugun8vmi3f8vc5upnswpq.png"><br><br>  APM s√©lectionne toutes les transactions par d√©faut, bien que seul le Web soit g√©n√©ralement n√©cessaire.  Comme dans Datadog, il n'y a aucun moyen d'acc√©der au service souhait√© depuis le panneau principal.  De plus, les transactions sont r√©pertori√©es apr√®s les erreurs, ce qui pour APM ne semble pas tr√®s logique. <br><br>  Dans les transactions Atatus, tout est aussi similaire √† New Relic que possible.  Moins - vous ne pouvez pas voir imm√©diatement la dynamique de chacun des contr√¥leurs.  Vous devez le rechercher dans la table du contr√¥leur, en le triant par le <b>plus de temps consomm√©</b> : <br><br><img src="https://habrastorage.org/webt/1r/gm/df/1rgmdfhp2wi-etyz90cp-nhicne.png"><br><br>  La liste habituelle des contr√¥leurs est disponible dans l'onglet <b>Explorer</b> : <br><br><img src="https://habrastorage.org/webt/n6/bm/4e/n6bm4epe4rgm1o0-j6gckbe5xcs.png"><br><br>  √Ä certains √©gards, ce tableau ressemble √† Datadog et ressemble plus √† celui de New Relic. <br><br>  Chaque transaction peut √™tre d√©ploy√©e et voir ce que l'application a fait: <br><br><img src="https://habrastorage.org/webt/om/nj/jz/omnjjzghaohvdghitkkynauqwd8.png"><br><br>  Le panneau ressemble √©galement plus √† Datadog: il existe un certain nombre de demandes, une image globale des appels.  Le volet sup√©rieur fournit un onglet avec <b>des</b> erreurs d' <b>√©checs HTTP</b> et des exemples de demandes de <b>traces de session</b> lentes: <br><br><img src="https://habrastorage.org/webt/jc/cp/xo/jccpxoykxlwophfgejumdduui88.png"><br><br>  Si vous entrez dans une transaction, vous pouvez voir un exemple de trace, vous pouvez obtenir une liste de requ√™tes dans la base de donn√©es et voir les en-t√™tes de demande.  Tout est similaire √† New Relic: <br><br><img src="https://habrastorage.org/webt/_c/lb/dn/_clbdnkiqpd-6spg325of0c09o0.png"><br><br>  En g√©n√©ral, Atatus √©tait satisfait des traces d√©taill√©es - sans le collage typique des appels New Relic dans un bloc de rappel: <br><br><img src="https://habrastorage.org/webt/m5/ub/hk/m5ubhk5bxdzyqwg3oaidmflbmjc.png"><br><img src="https://habrastorage.org/webt/hv/3s/27/hv3s27-mped0zuubmx9qs-7b_7c.png"><br><br>  Cependant, il n'y a pas assez de filtre qui (comme dans New Relic) couperait les requ√™tes ultrarapides (&lt;5 ms).  En revanche, l'affichage de la r√©ponse finale de la transaction (r√©ussie ou erreur) √©tait agr√©able. <br><br>  Le panneau <b>Bases de donn√©es</b> vous aidera √† examiner les demandes de bases de donn√©es externes effectu√©es par l'application.  Permettez-moi de vous rappeler qu'Atatus n'a trouv√© que PostgreSQL et MySQL, bien que Redis et memcached soient √©galement impliqu√©s dans le projet. <br><br><img src="https://habrastorage.org/webt/rj/1z/vn/rj1zvn9n6wvmcbzcx1fj65x1mmg.png"><br><br>  Les demandes sont tri√©es selon les crit√®res habituels: fr√©quence de r√©ponse, temps de r√©ponse moyen, etc.  Je voudrais √©galement noter l'onglet avec les requ√™tes les plus lentes - c'est tr√®s pratique.  De plus, les donn√©es de cet onglet pour PostgreSQL ont co√Øncid√© avec les donn√©es de l'extension <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pg_stat_statements</a> - un excellent r√©sultat! <br><br><img src="https://habrastorage.org/webt/-4/th/4c/-4th4c5ykhiikiwtmrk23rr7g7g.png"><br><br>  L'onglet <b>Demandes externes</b> est identique √† Bases de donn√©es. <br><br><h2>  Conclusions </h2><br>  Les deux outils pr√©sent√©s ont bien fonctionn√© dans le r√¥le d'APM.  Chacun d'eux peut offrir le minimum n√©cessaire.  R√©sumez bri√®vement nos impressions comme suit: <br><br><h3>  Datadog </h3><br>  Avantages: <br><br><ul><li>  bar√®me tarifaire pratique (l'APM co√ªte 31 USD par h√¥te); </li><li>  bien jou√© avec Python; </li><li>  possibilit√© d'int√©gration avec OpenTracing </li><li>  Int√©gration Kubernetes </li><li>  Int√©gration avec NGINX Ingress. </li></ul><br>  Inconv√©nients: <br><br><ul><li>  Le seul APM qui a caus√© l'inaccessibilit√© de l'application en raison d'une erreur de module (predis) </li><li>  outils auto PHP faibles; </li><li>  d√©finition en partie √©trange des services et de leur finalit√©. </li></ul><br><h3>  Atatus </h3><br>  Avantages: <br><br><ul><li>  instrumentation profonde de PHP; </li><li>  Nouvelle interface utilisateur de type relique. </li></ul><br>  Inconv√©nients: <br><br><ul><li>  ne fonctionne pas sur les anciens syst√®mes d'exploitation (Ubuntu 12.05, CentOS 5); </li><li>  outils automatiques faibles; </li><li>  prise en charge de seulement deux langues (Node.js et PHP); </li><li>  fonctionnement lent de l'interface. </li></ul><br>  Compte tenu du prix Atatus de 69 USD par mois et par serveur, nous pr√©f√©rerions utiliser Datadog, qui s'int√®gre parfaitement √† nos besoins (applications web en K8) et poss√®de de nombreuses fonctionnalit√©s utiles. <br><br><h2>  PS </h2><br>  Lisez aussi dans notre blog: <br><br><ul><li>  ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Outils pour les d√©veloppeurs d'applications fonctionnant sur Kubernetes</a> ¬ª; </li><li>  ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Plugin Kubectl-debug pour le d√©bogage dans les pods Kubernetes</a> ¬ª; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Microservices: la taille compte, m√™me si vous avez Kubernetes</a> ." </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr465177/">https://habr.com/ru/post/fr465177/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr465161/index.html">Mod√®le de donn√©es Quintet et centaines de gigaoctets de donn√©es</a></li>
<li><a href="../fr465163/index.html">Impression 3D: des cas incroyables et un peu plus int√©ressants</a></li>
<li><a href="../fr465167/index.html">Planification des ressources. Pourquoi √ßa ne marche pas? Partie 1</a></li>
<li><a href="../fr465169/index.html">DIY de PVS-Studio: Gamification des r√©alisations</a></li>
<li><a href="../fr465173/index.html">Comment modifier le co√ªt de l'abonnement cr√©√© dans votre application. App Store Connect et console Google Play</a></li>
<li><a href="../fr465179/index.html">L'automatisation remplacera-t-elle les tests manuels?</a></li>
<li><a href="../fr465181/index.html">Endroits glissants en C ++ 17</a></li>
<li><a href="../fr465185/index.html">Nouvelles normes de vid√©osurveillance: couleur la nuit, anti-bruit, ePoE</a></li>
<li><a href="../fr465187/index.html">6 phrases en anglais pouvant √™tre utilis√©es dans les n√©gociations salariales avec des entreprises √©trang√®res</a></li>
<li><a href="../fr465189/index.html">√âquipe de d√©veloppement Workflow One Sprint</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>