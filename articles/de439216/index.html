<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî† üö£ üíä Pudge 500 Zeilen einbettbare Datenbank auf Golang üôèüèΩ üë©üèø‚Äç‚öñÔ∏è üìî</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="pudge ist eine einbettbare Schl√ºssel- / Wertedatenbank, die in die Go-Standardbibliothek geschrieben wurde. 


 Ich werde auf die grundlegenden Unters...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pudge 500 Zeilen einbettbare Datenbank auf Golang</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439216/">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pudge</a> ist eine einbettbare Schl√ºssel- / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wertedatenbank,</a> die in die Go-Standardbibliothek geschrieben wurde. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c05/28e/3ec/c0528e3ecf0c93f13d51987f18bbec31.jpg" alt="Bild"></div><br>  Ich werde auf die grundlegenden Unterschiede zu bestehenden L√∂sungen eingehen. <br><br>  <b>Staatenlos</b> <br><br><pre><code class="go hljs">pudge.Set(<span class="hljs-string"><span class="hljs-string">"../test/test"</span></span>, <span class="hljs-string"><span class="hljs-string">"Hello"</span></span>, <span class="hljs-string"><span class="hljs-string">"World"</span></span>)</code> </pre> <br>  Puj erstellt automatisch die Testdatenbank einschlie√ülich der Unterverzeichnisse oder √∂ffnet sie.  Der Tabellenstatus muss nicht gespeichert werden, und Sie k√∂nnen Werte sicher in Multithread-Anwendungen speichern.  Pooj ist threadsicher. <br><a name="habracut"></a><br>  <b>Maschinenfrei</b> <br><br>  In puj k√∂nnen Sie Bytes, Strings, Zahlen oder Strukturen schreiben.  Ohne sich Gedanken √ºber die Konvertierung von Daten in ihre bin√§re Darstellung zu machen. <br><br><pre> <code class="go hljs"> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Point <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { X <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Y <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">100</span></span>; i &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; i-- { p := &amp;Point{X: i, Y: i} db.Set(i, p) } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> point Point db.Get(<span class="hljs-number"><span class="hljs-number">8</span></span>, &amp;point) log.Println(point)</code> </pre><br>  <b>Abfragesystem</b> <br><br>  Puj bietet die M√∂glichkeit, Schl√ºssel in einer bestimmten Reihenfolge zu extrahieren, einschlie√ülich Auswahl mit Begrenzung, Einr√ºckung, Sortierung und Auswahl nach Pr√§fix. <br><br><pre> <code class="go hljs"> keys, _ := db.Keys(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)</code> </pre><br>  Der obige Code √§hnelt der SQL-Abfrage: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">keys</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> db <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">key</span></span>&gt;<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">keys</span></span> <span class="hljs-keyword"><span class="hljs-keyword">asc</span></span> <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  Bitte beachten Sie, dass das Sortieren von Schl√ºsseln "faul" ist.  Andererseits sind die Schl√ºssel im Speicher gespeichert und es l√§uft ziemlich schnell. <br><br>  <b>Parallelit√§t</b> <br><br>  Pooj verwendet, wie die meisten modernen Datenbanken, ein nicht blockierendes Lesemodell, aber das Schreiben in eine Datei blockiert alle Vorg√§nge.  Sie k√∂nnen jedoch Dateien im laufenden Betrieb erstellen / √∂ffnen und so die Anzahl der Sperren minimieren.  Es gibt keinen Fehler "Datenbank bereits ge√∂ffnet" in Puja.  Beispiel f√ºr die Verwendung im http-Router: <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c *gin.Context)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> err error group := c.Param(<span class="hljs-string"><span class="hljs-string">"group"</span></span>) counter := c.Param(<span class="hljs-string"><span class="hljs-string">"counter"</span></span>) db, err := pudge.Open(group, cfg) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { renderError(c, err) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } _, err = db.Counter(counter, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { renderError(c, err) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } c.String(http.StatusOK, <span class="hljs-string"><span class="hljs-string">"%s"</span></span>, <span class="hljs-string"><span class="hljs-string">"ok"</span></span>) }</code> </pre><br>  <b>Motoren</b> <br><br>  Trotz seiner geringen Gr√∂√üe unterst√ºtzt der Puj zwei Datenspeichermodi.  Im Speicher und auf der Festplatte.  Standardm√§√üig speichert puj nur Daten (Werte) auf der Festplatte.  Wenn Sie m√∂chten, k√∂nnen Sie den Modus zum Speichern von Daten im Speicher aktivieren.  In diesem Fall werden sie auf Anfrage oder beim Schlie√üen der Datenbank auf die Festplatte geleert. <br><br>  <b>Status</b> <br><br>  Pooj wird sowohl in Heimprojekten als auch in der Produktion verwendet (siehe Grafik unten) - die Anzahl der Anforderungen an den http-Server basierend auf puj und die Anzahl der Anforderungen ist l√§nger als 20 ms <br><br><img src="https://habrastorage.org/webt/ix/hw/n3/ixhwn3soybfgz39srund7huutwg.png"><br><br>  In diesem Fall wird die Puja im Vollsynchronisationsmodus eingeschaltet, und zum Zeitpunkt von fsync treten signifikante Verz√∂gerungen (mehr als 20 ms) auf.  Aber zum Gl√ºck gibt es nicht so viele in Prozent. <br><br>  Auf der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Projektseite</a> finden Sie weitere Links mit Beispielen f√ºr die Integration von Puja in verschiedene Projekte. <br><br>  <b>Geschwindigkeit</b> <br><br>  Im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Repository</a> mit Benchmark'y k√∂nnen Sie Puj mit anderen Datenbanken vergleichen: <br><br><h3>  Test 1 </h3><br><pre> <code class="plaintext hljs">Number of keys: 1000000 Minimum key size: 16, maximum key size: 64 Minimum value size: 128, maximum value size: 512 Concurrency: 2</code> </pre><table><tbody><tr><td></td><td>  <sup>Pogreb</sup> <sup><br></sup> </td><td>  <sup>goleveldb</sup> <sup><br></sup> </td><td>  <sup>Schraube</sup> <sup><br></sup> </td><td>  <sup>badgerdb</sup> <sup><br></sup> </td><td>  <sup>Pudge</sup> <sup><br></sup> </td><td>  <sup>Slowpoke</sup> <sup><br></sup> </td><td>  <sup>pudge (mem)</sup> <sup><br></sup> </td></tr><tr><td>  <sup>1M (Put + Get), Sekunden</sup> <sup><br></sup> </td><td>  <sup>187</sup> <sup><br></sup> </td><td>  <sup>38</sup> <sup><br></sup> </td><td>  <sup>126</sup> <sup><br></sup> </td><td>  <sup>34</sup> <sup><br></sup> </td><td>  <sup>23</sup> <sup><br></sup> </td><td>  <sup>23</sup> <sup><br></sup> </td><td>  <sup>2</sup> <sup><br></sup> </td></tr><tr><td>  <sup>1M Put, ops / sec</sup> <sup><br></sup> </td><td>  <sup>5336</sup> <sup><br></sup> </td><td>  <sup>34743</sup> <sup><br></sup> </td><td>  <sup>8054</sup> <sup><br></sup> </td><td>  <sup>33539</sup> <sup><br></sup> </td><td>  <sup>47298</sup> <sup><br></sup> </td><td>  <sup>46789</sup> <sup><br></sup> </td><td>  <sup>439581</sup> <sup><br></sup> </td></tr><tr><td>  <sup>1M Get, ops / sec</sup> <sup><br></sup> </td><td>  <sup>1782423</sup> <sup><br></sup> </td><td>  <sup>98406</sup> <sup><br></sup> </td><td>  <sup>499871</sup> <sup><br></sup> </td><td>  <sup>220597</sup> <sup><br></sup> </td><td>  <sup>499172</sup> <sup><br></sup> </td><td>  <sup>445783</sup> <sup><br></sup> </td><td>  <sup>1652069</sup> <sup><br></sup> </td></tr><tr><td>  <sup>FileSize Mb</sup> <sup><br></sup> </td><td>  <sup>568</sup> <sup><br></sup> </td><td>  <sup>357</sup> <sup><br></sup> </td><td>  <sup>552</sup> <sup><br></sup> </td><td>  <sup>487</sup> <sup><br></sup> </td><td>  <sup>358</sup> <sup><br></sup> </td><td>  <sup>358</sup> <sup><br></sup> </td><td>  <sup>358</sup> <sup><br></sup> </td></tr></tbody></table><br>  Pooja ist im Verh√§ltnis zwischen Schreibgeschwindigkeit und Lesegeschwindigkeit sehr ausgewogen.  Dass es sich nicht um eine hochspezialisierte Datenbank handelt, die zum Lesen oder Schreiben optimiert ist.  Bei hoher Lesegeschwindigkeit wird eine ziemlich hohe Schreibgeschwindigkeit beibehalten.  Dies kann jedoch durch Parallelisieren von Aufzeichnungen zu verschiedenen Dateien weiter erh√∂ht werden (wie dies bei LSM Tree-Engines der Fall ist). <br><br>  Links zu den im Test verwendeten Datenbanken: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pogreb</a> Eingebetteter Schl√ºsselwertspeicher f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">leselastige</a> Workloads, die in Go geschrieben wurden </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">goleveldb</a> LevelDB-Schl√ºssel- / Wertedatenbank in Go. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Schraube</a> Eine eingebettete Schl√ºssel- / Wertedatenbank f√ºr Go. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">badgerdb</a> Schneller Schl√ºsselwert-DB in Go </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">slowpoke</a> Low-Level-Schl√ºssel- / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wertspeicher</a> in pure Go (basierend auf Pudge) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pudge</a> Schneller und einfacher Schl√ºssel- / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wertspeicher</a> , der mit der Standardbibliothek von Go geschrieben wurde </li></ul><br>  Sie baten mich, mit Memcache und Redis zu vergleichen, aber da der L√∂wenanteil der Zeit f√ºr Netzwerkschnittstellen bei der Interaktion mit Datenbankdaten aufgewendet wird, ist dies nicht ganz fair.  Auf der anderen Seite gewinnt die Puja durch Multithreading, obwohl sie Daten auf die Festplatte schreibt. <br><br>  <b>Weiterentwicklung</b> <br><br><ul><li>  Transaktionen  Es w√§re praktisch, Schreibanforderungen an den Pool mit einem automatischen Rollback im Fehlerfall zu kombinieren. </li><li>  M√∂glichkeit zur Begrenzung der Schl√ºssellebensdauer (wie TTL in Memcache / Cassandra usw.) </li><li>  Das Fehlen eines Servers.  Es ist praktisch, die Puja in vorhandene Microservices einzubetten, aber h√∂chstwahrscheinlich wird ein separater Server angezeigt.  Im Rahmen eines separaten Projekts. </li><li>  Mobile Version.  Zur Verwendung unter Android, iOS und als Plugin f√ºr Flutter. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de439216/">https://habr.com/ru/post/de439216/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de439202/index.html">Web Attack Detection mit Seq2Seq Auto Encoder</a></li>
<li><a href="../de439204/index.html">Verbesserung der Effizienz der Photosynthese durch genetische Ver√§nderung von Pflanzen</a></li>
<li><a href="../de439206/index.html">Wie haben wir das Problem der Fortsetzung der Wiedergabelisten bei RecSys Challenge gel√∂st und den 3. Platz belegt?</a></li>
<li><a href="../de439208/index.html">Oh, mein Code: Wie MAPS.ME funktioniert</a></li>
<li><a href="../de439210/index.html">Java nach Vulkanausbruch</a></li>
<li><a href="../de439218/index.html">VK Bot auf seinem Knie oder wie man Menschen am 14. Februar gef√§llt</a></li>
<li><a href="../de439220/index.html">Gro√üstadt f√ºr mobile Ger√§te auf Unity. Erfahrung in Entwicklung und Optimierung</a></li>
<li><a href="../de439222/index.html">Was ist API-Verwaltung?</a></li>
<li><a href="../de439224/index.html">Nochmals zu Voronoi-Diagrammen</a></li>
<li><a href="../de439226/index.html">Scala + MXNet = Microservice mit Neuron in Prod</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>