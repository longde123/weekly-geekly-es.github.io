<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ï ‚óΩÔ∏è üë©üèø‚Äçü§ù‚Äçüë©üèª Autorisation transparente pour une application sur Oracle Weblogic Server üë®üèª üë®‚Äçüéì üë©üèæ‚Äçüöí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, je vais vous expliquer comment nous sommes pass√©s de l'autorisation NTLM √† l'autorisation Kerberos pour les applications sur Oracle ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Autorisation transparente pour une application sur Oracle Weblogic Server</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414939/">  Dans cet article, je vais vous expliquer comment nous sommes pass√©s de l'autorisation NTLM √† l'autorisation Kerberos pour les applications sur Oracle Weblogic Server, simplifiant ainsi la connexion des utilisateurs en supprimant la n√©cessit√© de saisir un mot de passe.  Tous les utilisateurs, ainsi que le serveur d'applications, sont dans le m√™me domaine; l'autorisation de domaine pour les applications du serveur Weblogic a √©galement √©t√© pr√©c√©demment configur√©e.  Toutes les configurations ont √©t√© v√©rifi√©es sur WLS 12.1.2. <br><a name="habracut"></a><br>  Tout d'abord, un peu de th√©orie, tr√®s bri√®vement pour une meilleure compr√©hension du processus d'interaction. <br><br><h3>  Qu'est-ce que l'authentification unique? </h3><br>  La connexion unique (SSO) est un m√©canisme par lequel une action d'authentification d'un seul utilisateur permet √† un utilisateur d'acc√©der √† tous les ordinateurs et syst√®mes auxquels il est autoris√© √† acc√©der sans avoir √† saisir plusieurs mots de passe.  Les informations d'identification pr√©c√©demment saisies seront r√©utilis√©es de mani√®re transparente par divers composants. <br><br><h3>  Qu'est-ce que Kerberos? </h3><br>  Kerberos est un protocole d'authentification r√©seau qui a √©t√© d√©velopp√© pour la premi√®re fois par le Massachusetts Institute of Technology.  Kerberos est une m√©thode s√©curis√©e d'authentification d'une demande de service sur le r√©seau et est con√ßue pour fournir une authentification forte pour les applications client-serveur utilisant la cryptographie avec une cl√© secr√®te. <br><br><h3>  Qu'est-ce que SPNEGO? </h3><br>  SPNEGO est un moteur de n√©gociation GSSAPI simple et s√©curis√©.  Il s'agit d'une interface normalis√©e pour l'authentification (par exemple JNDI pour les recherches dans l'annuaire), l'impl√©mentation par d√©faut de SPNEGO sur Windows est Kerberos (par exemple LDAP pour JNDI).  La terminologie Microsoft utilise ¬´Authentification Windows int√©gr√©e¬ª comme synonyme de SPNEGO.  Dans l'authentification int√©gr√©e Windows, les protocoles Kerberos ou NTLM peuvent √™tre n√©goci√©s. <br><br>  Lorsqu'un serveur re√ßoit une demande d'Internet Explorer (IE 6.1 ou sup√©rieur), il peut demander au navigateur d'utiliser le protocole SPNEGO pour l'authentification.  Ce protocole effectue l'authentification Kerberos sur HTTP et permet √† Internet Explorer de d√©l√©guer des pouvoirs d√©l√©gu√©s afin que l'application Web puisse se connecter aux services Kerberized ult√©rieurs au nom de l'utilisateur. <br><br>  Lorsque le serveur HTTP souhaite ex√©cuter SPNEGO, il renvoie une r√©ponse ¬´401 Unauthorized¬ª √† la demande HTTP avec le titre ¬´WWW-Authorization: Negotiate¬ª.  Internet Explorer contacte ensuite le Ticket Service (TGS) pour obtenir un ticket.  Il choisit le nom sp√©cial du participant au service pour demander un ticket, par exemple: <br><br><pre><code class="bash hljs">HTTP/webserver@&lt;DOMAIN NAME&gt;</code> </pre> <br>  Le ticket retourn√© est ensuite envelopp√© dans un jeton SPNEGO, qui est cod√© et renvoy√© au serveur √† l'aide d'une requ√™te HTTP.  Le jeton se d√©roule et le ticket s'authentifie. <br><br><h3>  Avantages de Kerberos </h3><br>  L'utilisation de Kerberos permet aux administrateurs de d√©sactiver l'authentification NTLM d√®s que tous les clients du r√©seau peuvent authentifier Kerberos.  Kerberos est plus flexible et efficace que NTLM et plus s√©curis√©. <br><br><h2>  Configurer l'authentification unique bas√©e sur Kerberos dans un environnement de serveur d'applications Weblogic </h2><br>  Sch√©ma d'interaction: <br><br><img src="https://habrastorage.org/webt/ag/nr/hb/agnrhbp4keg9dswqfuudfhmdy1y.png"><br><br><ol><li>  Lorsqu'un utilisateur enregistr√© (PC) demande une ressource √† Oracle WebLogic Server (WLS), il envoie la requ√™te HTTP GET d'origine. </li><li>  Le serveur Oracle WebLogic Server (WLS) ex√©cutant le code de jeton SPNEGO n√©cessite une authentification et √©met une r√©ponse 401 Access Denied, WWWAuthenticate: Negotiate. </li><li>  Un client (navigateur sur PC) demande un ticket de session √† TGS / KDC (AD). </li><li>  TGS / KDC (AD) fournit au client le ticket Kerberos n√©cessaire (√† condition que le client soit autoris√©), envelopp√© dans le jeton SPNEGO. </li><li>  Le client renvoie la requ√™te HTTP GET + N√©gociez le jeton SPNEGO dans l'en-t√™te d'autorisation: N√©gociez base64 (jeton). </li><li>  La v√©rification de l'authentification Web SPNEGO sur le serveur Weblogic affiche un en-t√™te HTTP avec le jeton SPNEGO.  SPNEGO v√©rifie le jeton SPNEGO et obtient les informations utilisateur. </li><li>  Une fois que Weblogic a re√ßu les informations utilisateur, il valide l'utilisateur dans Microsoft Active Directory / KDC.  Une fois le processus d'authentification termin√©, Weblogic ex√©cute le code Java correspondant (servlets, JSP, EJB, etc.) et v√©rifie l'autorisation. </li><li>  Le code du gestionnaire de jeton Oracle WebLogic Server accepte et traite le jeton via l'API GSS, authentifie l'utilisateur et r√©pond avec l'URL demand√©e. </li></ol><br><h3>  Passons maintenant √† la pratique </h3><br>  1. Nous effectuons les r√©glages c√¥t√© serveur du domaine du contr√¥leur sur lequel les services TGS / KDC sont configur√©s. <br><br><ul><li>  Cr√©er un utilisateur dans Active Directory (le mot de passe ne doit pas expirer) </li><li>  D√©finissez le SPN appropri√© pour le nom du serveur WLS </li></ul><br>  Effectuer la v√©rification √©tablie par SPN <br><br><pre> <code class="bash hljs">setspn ‚Äìl HTTP_weblogic</code> </pre> <br>  devrait renvoyer deux enregistrements <br>  G√©n√©rer un fichier Keytab <br><br><pre> <code class="bash hljs">ktpass -princ HTTP_weblogic@mycompany.com -pass PASSWORD -crypto RC4-HMAC-NT -ptype KRB5_NT_PRINCIPAL -kvno 0 -out c:\krb5.keytab</code> </pre> <br>  Copiez ce fichier sur le serveur WLS <br><br>  2. Configuration du serveur WLS <br><br><ul><li>  Vous devez cr√©er le fichier krb5.ini dans le dossier% windir%: C: \ Windows.  Ce fichier contient des param√®tres de configuration pour les clients, par exemple, o√π se trouve le KDC.  Le fichier ressemblera √† ceci: </li></ul><br><pre> <code class="bash hljs">[libdefaults] default_realm = &lt;DOMAIN NAME&gt; ticket_lifetime = 600 [realms] &lt;DOMAIN NAME&gt; = { kdc = &lt;HOSTNAME OF AD/KDC&gt; admin_server = &lt;HOSTNAME OF AD/KDC&gt; default_domain = &lt;DOMAIN NAME&gt; } [domain_realm] . &lt;DOMAIN NAME&gt;= &lt;DOMAIN NAME&gt; [appdefaults] autologin = <span class="hljs-literal"><span class="hljs-literal">true</span></span> forward = <span class="hljs-literal"><span class="hljs-literal">true</span></span> forwardable = <span class="hljs-literal"><span class="hljs-literal">true</span></span> encrypt = <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br><ul><li>  Cr√©ez le fichier de configuration krb5Login.conf: </li></ul><br><pre> <code class="bash hljs">com.sun.security.jgss.krb5.initiate { com.sun.security.auth.module.Krb5LoginModule required principal=<span class="hljs-string"><span class="hljs-string">"user@MYCOMPANY.COM"</span></span> useKeyTab=<span class="hljs-literal"><span class="hljs-literal">true</span></span> keyTab=krb5.keytab storeKey=<span class="hljs-literal"><span class="hljs-literal">true</span></span> debug=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; }; com.sun.security.jgss.krb5.accept { com.sun.security.auth.module.Krb5LoginModule required principal=<span class="hljs-string"><span class="hljs-string">"user@MYCOMPANY.COM"</span></span> useKeyTab=<span class="hljs-literal"><span class="hljs-literal">true</span></span> keyTab=krb5.keytab storeKey=<span class="hljs-literal"><span class="hljs-literal">true</span></span> debug=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; };</code> </pre> <br>  Veuillez noter que le nom de domaine doit √™tre en <b>majuscule</b> .  Pour les versions ant√©rieures, utilisez com.sun.security.jgss.initiate dans la configuration pr√©c√©dente au lieu de com.sun.security.jgss.krb5.initiate. <br><br><ul><li>  Les fichiers krb5Login.conf et krb5.keytab doivent √™tre situ√©s √† la racine du r√©pertoire de domaine du serveur WLS. </li></ul><br><ul><li>  Modification du fichier setDomainEnv </li></ul><br>  Trouvez l'ensemble de lignes JAVA_OPTIONS =% JAVA_OPTIONS% et ajoutez √† la fin <br><br><pre> <code class="bash hljs">-Djava.security.auth.login.config=&lt;  &gt;\krb5Login.conf -Djavax.security.auth.useSubjectCredsOnly=<span class="hljs-literal"><span class="hljs-literal">false</span></span> -Dweblogic.security.enableNegotiate=<span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre><br><ul><li>  Dans ce cas, nous n'envisageons pas de configurer l'autorisation WLS dans AD, nous pensons que cela fonctionne, si vous avez besoin de peindre cet √©l√©ment, √©crivez dans les commentaires. </li><li>  Configuration de SPNEGO dans WLS <br>  Pour ce faire, acc√©dez √† la console d'administration de WebLogic Server <br>  Acc√©dez √† la section Security Realms&gt; myrealm&gt; Providers et cliquez sur le bouton Ajouter <br>  S√©lectionnez le type de ¬´WebLogic Negotiate Identity Assertion provider¬ª <br>  V√©rifiez que les deux param√®tres sont s√©lectionn√©s. <br><br><img src="https://habrastorage.org/webt/mx/yw/dh/mxywdhiksffnmoskhudbwgbheue.png"><br><br>  Nous appuyons sur le bouton R√©organiser et contr√¥lons les fl√®ches pour d√©finir la s√©quence des types d'autorisation.  En premier lieu doit √™tre install√© WebLogic Negotiate Identity Assertion Provider en deuxi√®me lieu Fournisseur qui effectue l'authentification LDAP (autorisation de domaine) <br><br><img src="https://habrastorage.org/webt/xg/9s/3z/xg9s3zptdxssvyluczibql18jii.png"></li></ul><br><ul><li>  Red√©marrez le serveur </li></ul><br><ul><li>  Ensuite, vous devez indiquer √† l'application la m√©thode d'autorisation CLIENT-CERT, ces modifications sont appliqu√©es dans le fichier web.xml de l'application </li></ul><br><pre> <code class="bash hljs">&lt;security-constraint&gt; &lt;display-name&gt;Security Constraint <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> SSO &lt;/display-name&gt; &lt;web-resource-collection&gt; &lt;web-resource-name&gt;My webapp&lt;/web-resource-name&gt; &lt;description&gt;Group of Users&lt;/description&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt; &lt;http-method&gt;GET&lt;/http-method&gt; &lt;http-method&gt;POST&lt;/http-method&gt; &lt;/web-resource-collection&gt; &lt;auth-constraint&gt; &lt;role-name&gt;valid-users&lt;/role-name&gt; &lt;/auth-constraint&gt; &lt;/security-constraint&gt; &lt;login-config&gt; &lt;auth-method&gt;CLIENT-CERT&lt;/auth-method&gt; &lt;/login-config&gt; &lt;security-role&gt; &lt;description&gt;Role description&lt;/description&gt; &lt;role-name&gt;valid-users&lt;/role-name&gt; &lt;/security-role&gt;</code> </pre> <br>  Le r√¥le doit √™tre pr√©install√© dans le syst√®me.  Dans notre cas, le r√¥le int√©gr√© pour ADF (utilisateurs valides) est utilis√© et, en fonction des groupes de domaines, des autorisations sont accord√©es. <br><br><ul><li>  D√©boguer </li></ul><br>  Pour identifier les probl√®mes d'autorisation, vous devez activer le d√©bogage.  Pour ce faire, acc√©dez √† la section. <br><br>  Environnement -&gt; Serveurs, s√©lectionnez notre serveur -&gt; D√©bogage -&gt; weblogic (d√©velopper) -&gt; S√©curit√© -&gt; atn, cochez la case et activez-le. <br><br><img src="https://habrastorage.org/webt/el/cu/wl/elcuwln1wfg_nepcwqv5vttbh2c.png"><br><br>  Pour activer et d√©sactiver le d√©bogage, un red√©marrage n'est pas n√©cessaire. <br><br><ul><li>  Nous red√©marrons le serveur pour appliquer les modifications de configuration. </li><li>  D√©ployer l'application avec une m√©thode d'autorisation modifi√©e (nouveau web.xml) </li><li>  Pour d√©sactiver ce type d'autorisation pour la console d'administration, apportez les modifications suivantes% Ora_Home% \ wlserver \ server \ lib \ consoleapp \ webapp \ WEB-INF \ web.xml. <br><br>  Changer la ligne <br><br><pre> <code class="java hljs"> &lt;auth-method&gt;CLIENT-CERT,FORM&lt;/auth-method&gt;  &lt;auth-method&gt;FORM&lt;/auth-method&gt;</code> </pre> </li></ul><br>  Connectez-vous √† la machine du domaine, cliquez sur le lien de l'application et connectez-vous sans entrer de mot de passe.  Il convient de noter que le bouton Quitter de l'application ne fonctionnera pas dans cette configuration. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr414939/">https://habr.com/ru/post/fr414939/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr414929/index.html">TRIZ, Haskell et la pens√©e fonctionnelle</a></li>
<li><a href="../fr414931/index.html">Preuve de transit: l'IETF propose une nouvelle approche pour confirmer le chemin d'acc√®s des paquets r√©seau</a></li>
<li><a href="../fr414933/index.html">R√©seaux maill√©s sur Wi-Fi: pourquoi la Wi-Fi Alliance a propos√© sa norme</a></li>
<li><a href="../fr414935/index.html">L'agence sp√©ciale des Nations Unies publie un plan de transition IPv6 - la communaut√© informatique m√©contente</a></li>
<li><a href="../fr414937/index.html">¬´Fr√©quences inaudibles¬ª: un pare-feu est apparu qui bloque les cookies ultrasoniques</a></li>
<li><a href="../fr414943/index.html">Impl√©mentation logicielle du filtre IIR dans le canal de mesure de l'information</a></li>
<li><a href="../fr414945/index.html">L'Universit√© Johns Hopkins a cr√©√© une peau artificielle qui ressent de la douleur</a></li>
<li><a href="../fr414947/index.html">Obtenir Git pour Windows sous ReactOS</a></li>
<li><a href="../fr414951/index.html">Gestion des acc√®s dans Expressjs avec CASL</a></li>
<li><a href="../fr414953/index.html">Nvidia a appris au r√©seau neuronal √† ralentir la vid√©o</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>