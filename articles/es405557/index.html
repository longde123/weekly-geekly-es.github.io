<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>↗️ 🚈 💚 Hogar inteligente desde un viejo teléfono inteligente o antipatrones de domótica 🍁 🥙 ▫️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola queridos lectores! Otra historia sobre cómo el gerente del enlace medio, quitando el polvo de las glándulas rancias en el estante, hace esto, lo ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hogar inteligente desde un viejo teléfono inteligente o antipatrones de domótica</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/405557/">  Hola queridos lectores!  Otra historia sobre cómo el gerente del enlace medio, quitando el polvo de las glándulas rancias en el estante, hace esto, lo que hace que los profesionales de todas las rayas tengan dolor en los ojos.  ¡Pero funciona, amigo! <br><br><img src="https://habrastorage.org/web/f60/376/42b/f6037642b6b94e65a098cf7d930fbc45.jpg"><br><br>  Lo admito, esta vez quería hacer todo bien.  Tomó el Raspbery Pi del estante.  El pastel es el mismo que ya usé en mi cortacésped robótico: un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enlace a una publicación</a> y un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enlace a otra publicación</a> .  Tomó mosquitto, todo debería haber funcionado en mqtt, pero no huirás de ti mismo.  Debajo del corte, un mar de rastrillos, bicicletas, poca soldadura, un verdadero infierno para un perfeccionista. <br><a name="habracut"></a><br><img src="https://habrastorage.org/files/4c5/827/fc2/4c5827fc2a714b56bb64c18700b69382.jpg" alt="imagen"><br><br>  Todo comenzó con el deseo de complementar mi proyecto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Noorik</a> , que puse en mi puerta.  En resumen, esta es una solución de bricolaje para el bloque GSM que abre la puerta. <br>  Para abrir la puerta, es suficiente cerrar ciertos contactos en el tablero. <br><br><img src="https://habrastorage.org/files/5f3/8e2/40c/5f38e240c82f4e4692737b0f5e600041.jpg" alt="imagen"><br><br>  Reemplazó arduino con esp8266 e hizo una interfaz web con un botón abierto.  Resultó ser interesante, pero quería una sola interfaz para abrir puertas correderas, puertas de garaje seccionales y puertas. <br><br>  Cuando comencé a pintar toda mi lista de deseos, resultó que necesitaba lo mismo: <br><br><ol><li>  sistema de control de caldera </li><li>  sistema de seguridad </li><li>  interfaz móvil para cámaras de vigilancia </li><li>  datos de temperatura en la casa y en la calle </li></ol><br><h2>  Backend </h2><br>  Malinka funcionó bien, pero la próxima vez que se encendió, simplemente dejó de encenderse.  El LED de alimentación se ilumina primero, luego se apaga suavemente en 3-5 segundos, el elemento (polyfuse T075) cerca de la toma de corriente está muy caliente.  Y aquí ya tenemos ganas de aplicar mqtt, blackger, para invitar a cortesanas y otras delicias. <br><br><img src="https://habrastorage.org/web/62d/d94/26c/62dd9426ccc24ae5ae0a851147fb62ae.jpg"><br><br>  No importa, el beneficio de su destino estaba esperando a otro paciente.  Naranja pi cero al estudio.  Cuánto sufrí con este milagro del pensamiento chino: dar vida a un pastel tan pequeño resultó ser un asunto que estaba más allá de mis fuerzas.  Descargué firmware en los sitios oficiales y los dejé, compré firmware de mis manos e intercambié por criptomonedas.  Creo que acabo de encontrar una muestra defectuosa. <br><br><img src="https://habrastorage.org/web/63c/64d/d6f/63c64dd6f17f48c687b33e036ef859f6.jpg"><br><br>  Me di cuenta de que el destino mismo me estaba empujando a los brazos de la construcción de bicicletas, y para ocultar mi alegría, me sumergí en esta actividad con la cabeza. <br><br><img src="https://habrastorage.org/web/206/f40/1e3/206f401e31ff4a06b895f513756e181e.jpg"><br><br>  En primer lugar, decidí usar un teléfono inteligente como unidad principal (agente, servidor).  Sabes que estas cosas viejas simplemente no desaparecen.  Lo usé, mi esposa, hija, luego controlé <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mi robot con un quitanieves</a> desde este teléfono inteligente, traté de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ahogarlo en el río</a> (nunca llegué al río Moscú, pero este tubo hizo un ruido en mi Pakhra natal).  Y aquí está, una nueva vida para el Samsung Galaxy S3. <br><br>  Instalado Palapa Web Server y el servidor FTP en el teléfono inteligente.  La idea es simple en una base de datos MySQL con solo tres tablas: valores, registros, reglas. <br><br><ul><li>  En la tabla de valores, pares clave / valor. </li><li>  La tabla de registros muestra el historial de cambios en los valores. </li><li>  En la tabla de reglas, las reglas para cambiar algunas celdas dependiendo del valor en otras. </li></ul><br>  Toda esta granja sirve un script php, que escribe o genera datos de la base de datos mediante una solicitud http, y también sirve reglas programadas. <br>  Ni siquiera entiendo cuál debería ser el nivel de programación para que una persona quiera verlo, pero estoy listo para mostrarle el código: escriba a la LAN. <br><br><h2>  Frontend </h2><br><img src="https://habrastorage.org/web/f60/376/42b/f6037642b6b94e65a098cf7d930fbc45.jpg"><br><br>  No me arrojes piedras, me confieso.  Usé Bootstrap.  Si, pecaminoso. <br>  El pensamiento inicial fue concluir todo a través de Phonegap y obtener una aplicación completa.  Diré más, hice exactamente eso, pero al final la versión en línea resultó ser más eficiente.  Yo y mi esposa en el teléfono acabamos de hacer un acceso directo en el escritorio para abrir la página deseada en la IP interna. <br><br>  Cada elemento responde a un evento de clic + el estado de ajax se verifica mediante solicitudes al servidor y se cambia si es necesario.  Es muy conveniente, porque ve todos los cambios que han entrado en vigencia por la regla o realizados por otro usuario. <br>  En realidad, el código bajo demanda sin problemas. <br><br><h2>  ESP-8266 </h2><br><img src="https://habrastorage.org/web/900/20a/853/90020a8530cc491cadc9aa15c8fb4e5c.jpg"><br><br>  Probé diferentes módulos y ESP-8266 puro.  Como resultado, el módulo LOLIN V3 resultó ser la opción más conveniente. <br><br><img src="https://habrastorage.org/web/325/c58/cda/325c58cda83f4c9a8cef58f7a1d88e8a.jpg"><br><br>  Fuente de alimentación mediante fuentes de alimentación conmutadas. <br><br><img src="https://habrastorage.org/web/268/d77/8ee/268d778ee71443c9a369bea9bb71491a.jpg"><br><br>  Los módulos de compuerta requerían un relé y me preocupaba que los relés de contacto se activaran.  Como resultado, funcionan tanto los de estado sólido como los de contacto.  El problema es que una gran cantidad de módulos, incluso sin etiquetar al respecto, son de baja activación. <br><br><img src="https://habrastorage.org/web/c81/9a8/130/c819a813070a47b5b6ebcb23a6d1bc8d.jpg"><br><br>  Cuando se enciende el módulo, se produce una apertura a corto plazo, lo que conduce a una apertura involuntaria cuando se enciende la alimentación.  Se resuelve tirando a cero y declarando el estado antes de declarar el tipo de salida. <br><br><pre><code class="hljs lisp">digitalWrite(<span class="hljs-name"><span class="hljs-name">rele</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)<span class="hljs-comment"><span class="hljs-comment">; digitalWrite(rele2, 1); pinMode(rele, OUTPUT); pinMode(rele2, OUTPUT);</span></span></code> </pre> <br>  Como resultado, el módulo para el ensamblaje del garaje se ve así.  El sensor PIR para detectar movimiento se mordisquea suavemente en la piel nativa. <br><br><img src="https://habrastorage.org/web/2ed/8f6/3b6/2ed8f63b60ea4b7abfb7bda9c04697c6.jpg"><br><br>  En la sala de calderas, mi caldera es muy simple y no se trata de una automatización compleja. <br><br><img src="https://habrastorage.org/web/49a/966/18a/49a96618a1ec46b28d2ac11a79096533.jpg"><br><br>  Además, cada circuito sirve una bomba separada. <br><br><img src="https://habrastorage.org/web/220/bc5/af7/220bc5af7fcd43e0b90dcbf335f9b66a.jpg"><br><br>  En serie con las máquinas, se encendieron los relés para controlar las bombas y la caldera. <br><br><img src="https://habrastorage.org/web/ae4/8b6/e04/ae48b6e0415047b58588b2a2cbfc5b1d.jpg"><br><br>  Empuja suavemente toda la economía hacia el escudo. <br><br><img src="https://habrastorage.org/web/0cc/5d3/28d/0cc5d328d26b4f2a83450df8e2ced105.jpg"><br><br><h2>  Firmware </h2><br>  Decidí usar Arduino IDE para firmware para no meterme con nodemcu y lua.  En Internet y en GT en particular, una gran cantidad de información para principiantes. <br>  De lo interesante, me parece, la función de conectarse a wifi.  El hecho es que en mi casa hay 4 redes wifi y se pueden agregar.  Para no establecer rígidamente el nombre de la red, primero escaneamos las redes disponibles. <br><br><div class="spoiler">  <b class="spoiler_title">Código de configuración de WiFi ()</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> setupWiFi() { WiFi.mode(WIFI_STA); WiFi.disconnect(); delay(<span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(WiFi.status() != WL_CONNECTED) { <span class="hljs-type"><span class="hljs-type">int</span></span> n = WiFi.scanNetworks(); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("scan done"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("no networks found"); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(n); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(" networks found"); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; n; ++i) { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(""); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(i + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(": "); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(WiFi.SSID(i)); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(" ("); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(WiFi.RSSI(i)); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(")"); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println((WiFi.encryptionType(i) == ENC_TYPE_NONE)?" ":"*"); j=<span class="hljs-number"><span class="hljs-number">0</span></span>; ssid=WiFi.SSID(i); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("Connecting"); ssid.toCharArray(charBuf, <span class="hljs-number"><span class="hljs-number">50</span></span>); WiFi.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(charBuf,WIFI_PASS); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(WiFi.status() != WL_CONNECTED) { delay(<span class="hljs-number"><span class="hljs-number">500</span></span>); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("."); j++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(j&gt;<span class="hljs-number"><span class="hljs-number">20</span></span>){ break; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((WiFi.status() == WL_CONNECTED)){ break; } } } } <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("Connected"); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(WiFi.localIP()); }</code> </pre> <br></div></div><br>  Cuando el modo automático de la sala de calderas está activado, la temperatura exterior y la temperatura del refrigerante se verifican de acuerdo con el programa. <br><br><ul><li>  A temperaturas inferiores a 14 * C, se enciende el piso cálido del primer piso. </li><li>  A temperaturas inferiores a 4 * C, todos los circuitos están encendidos. </li></ul><br>  La temperatura del refrigerante se selecciona de acuerdo con la tabla dependiendo de la sección transversal de las tuberías y la temperatura exterior.  Cuando se alcanza la temperatura ambiente requerida, la caldera se apaga.  Todos aplicaron una cierta histéresis para suavizar los valores de transición. <br><br>  El sistema de seguridad funciona aún más fácil.  Hay una regla en la tabla que dice que cuando el sistema de seguridad está activado, si se detecta movimiento en uno de los sensores PIR, se envía un SMS a través de la API de uno de los servicios. <br><br><h2>  Planes </h2><br><ul><li>  Creación de una versión en línea en un servidor remoto y sincronización de cambios para la posibilidad de control remoto. </li><li>  Mostrar datos de balizas GSM / GPS en el automóvil; </li><li>  Abrir las puertas cuando nuestros autos aparecen en cierta área; </li><li>  Conexión al sistema de control remoto; </li></ul><br>  <b>Votación por foto.</b>  <b>¿Qué proyecto hacer a continuación?</b> <br><br><div class="spoiler">  <b class="spoiler_title">Finalizar patada</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://geektimes.ru/post/281716/</a> <br><img src="https://habrastorage.org/web/626/a41/9a5/626a419a5b1143f092c0549638cbf9cc.jpg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Termine la impresora Delta 3D en los pernos de construcción</b> <div class="spoiler_text"><img src="https://habrastorage.org/web/7ff/ec2/55e/7ffec255ec8b4196a7f1c9cc92ca9c4e.jpg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Estabilizador para cámara SLR</b> <div class="spoiler_text"><img src="https://habrastorage.org/web/138/3b8/b61/1383b8b61f724649b6cb832d0e69b6da.jpg"><br></div></div><br>  Gracias por su atencion  Contigo estaba SlavaGik. <br><br><img src="https://habrastorage.org/web/ebc/aa9/11a/ebcaa911ade648528ae7128e3031e563.jpg"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es405557/">https://habr.com/ru/post/es405557/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es405545/index.html">Ponga el horno en modo Apocalipsis: una revisión de dispositivos para el control de armas nucleares antes del vuelo</a></li>
<li><a href="../es405547/index.html">Dos nuevas formas de apuntar automáticamente la videocámara</a></li>
<li><a href="../es405551/index.html">Casey Rias: el software como arte</a></li>
<li><a href="../es405553/index.html">El poder causa daño cerebral</a></li>
<li><a href="../es405555/index.html">Navi para iPhone volador: DJI Spark Fly Combo más</a></li>
<li><a href="../es405561/index.html">Revisión en vivo de la impresora 3D Chocola3D Food</a></li>
<li><a href="../es405563/index.html">Microsoft está desarrollando un acelerador de IA para HoloLens</a></li>
<li><a href="../es405565/index.html">DNK | PRIME Segunda parte: pruebas</a></li>
<li><a href="../es405567/index.html">Neurogénesis: bases fisiológicas y perspectivas de regulación con fines terapéuticos.</a></li>
<li><a href="../es405571/index.html">Elementos del Sistema Nacional de Innovación de EE. UU., Parte 1: Entorno empresarial y política fiscal, comercial y económica</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>