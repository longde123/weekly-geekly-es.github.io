<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>锔   Hogar inteligente desde un viejo tel茅fono inteligente o antipatrones de dom贸tica   锔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola queridos lectores! Otra historia sobre c贸mo el gerente del enlace medio, quitando el polvo de las gl谩ndulas rancias en el estante, hace esto, lo ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hogar inteligente desde un viejo tel茅fono inteligente o antipatrones de dom贸tica</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/405557/">  Hola queridos lectores!  Otra historia sobre c贸mo el gerente del enlace medio, quitando el polvo de las gl谩ndulas rancias en el estante, hace esto, lo que hace que los profesionales de todas las rayas tengan dolor en los ojos.  隆Pero funciona, amigo! <br><br><img src="https://habrastorage.org/web/f60/376/42b/f6037642b6b94e65a098cf7d930fbc45.jpg"><br><br>  Lo admito, esta vez quer铆a hacer todo bien.  Tom贸 el Raspbery Pi del estante.  El pastel es el mismo que ya us茅 en mi cortac茅sped rob贸tico: un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enlace a una publicaci贸n</a> y un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enlace a otra publicaci贸n</a> .  Tom贸 mosquitto, todo deber铆a haber funcionado en mqtt, pero no huir谩s de ti mismo.  Debajo del corte, un mar de rastrillos, bicicletas, poca soldadura, un verdadero infierno para un perfeccionista. <br><a name="habracut"></a><br><img src="https://habrastorage.org/files/4c5/827/fc2/4c5827fc2a714b56bb64c18700b69382.jpg" alt="imagen"><br><br>  Todo comenz贸 con el deseo de complementar mi proyecto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Noorik</a> , que puse en mi puerta.  En resumen, esta es una soluci贸n de bricolaje para el bloque GSM que abre la puerta. <br>  Para abrir la puerta, es suficiente cerrar ciertos contactos en el tablero. <br><br><img src="https://habrastorage.org/files/5f3/8e2/40c/5f38e240c82f4e4692737b0f5e600041.jpg" alt="imagen"><br><br>  Reemplaz贸 arduino con esp8266 e hizo una interfaz web con un bot贸n abierto.  Result贸 ser interesante, pero quer铆a una sola interfaz para abrir puertas correderas, puertas de garaje seccionales y puertas. <br><br>  Cuando comenc茅 a pintar toda mi lista de deseos, result贸 que necesitaba lo mismo: <br><br><ol><li>  sistema de control de caldera </li><li>  sistema de seguridad </li><li>  interfaz m贸vil para c谩maras de vigilancia </li><li>  datos de temperatura en la casa y en la calle </li></ol><br><h2>  Backend </h2><br>  Malinka funcion贸 bien, pero la pr贸xima vez que se encendi贸, simplemente dej贸 de encenderse.  El LED de alimentaci贸n se ilumina primero, luego se apaga suavemente en 3-5 segundos, el elemento (polyfuse T075) cerca de la toma de corriente est谩 muy caliente.  Y aqu铆 ya tenemos ganas de aplicar mqtt, blackger, para invitar a cortesanas y otras delicias. <br><br><img src="https://habrastorage.org/web/62d/d94/26c/62dd9426ccc24ae5ae0a851147fb62ae.jpg"><br><br>  No importa, el beneficio de su destino estaba esperando a otro paciente.  Naranja pi cero al estudio.  Cu谩nto sufr铆 con este milagro del pensamiento chino: dar vida a un pastel tan peque帽o result贸 ser un asunto que estaba m谩s all谩 de mis fuerzas.  Descargu茅 firmware en los sitios oficiales y los dej茅, compr茅 firmware de mis manos e intercambi茅 por criptomonedas.  Creo que acabo de encontrar una muestra defectuosa. <br><br><img src="https://habrastorage.org/web/63c/64d/d6f/63c64dd6f17f48c687b33e036ef859f6.jpg"><br><br>  Me di cuenta de que el destino mismo me estaba empujando a los brazos de la construcci贸n de bicicletas, y para ocultar mi alegr铆a, me sumerg铆 en esta actividad con la cabeza. <br><br><img src="https://habrastorage.org/web/206/f40/1e3/206f401e31ff4a06b895f513756e181e.jpg"><br><br>  En primer lugar, decid铆 usar un tel茅fono inteligente como unidad principal (agente, servidor).  Sabes que estas cosas viejas simplemente no desaparecen.  Lo us茅, mi esposa, hija, luego control茅 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mi robot con un quitanieves</a> desde este tel茅fono inteligente, trat茅 de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ahogarlo en el r铆o</a> (nunca llegu茅 al r铆o Mosc煤, pero este tubo hizo un ruido en mi Pakhra natal).  Y aqu铆 est谩, una nueva vida para el Samsung Galaxy S3. <br><br>  Instalado Palapa Web Server y el servidor FTP en el tel茅fono inteligente.  La idea es simple en una base de datos MySQL con solo tres tablas: valores, registros, reglas. <br><br><ul><li>  En la tabla de valores, pares clave / valor. </li><li>  La tabla de registros muestra el historial de cambios en los valores. </li><li>  En la tabla de reglas, las reglas para cambiar algunas celdas dependiendo del valor en otras. </li></ul><br>  Toda esta granja sirve un script php, que escribe o genera datos de la base de datos mediante una solicitud http, y tambi茅n sirve reglas programadas. <br>  Ni siquiera entiendo cu谩l deber铆a ser el nivel de programaci贸n para que una persona quiera verlo, pero estoy listo para mostrarle el c贸digo: escriba a la LAN. <br><br><h2>  Frontend </h2><br><img src="https://habrastorage.org/web/f60/376/42b/f6037642b6b94e65a098cf7d930fbc45.jpg"><br><br>  No me arrojes piedras, me confieso.  Us茅 Bootstrap.  Si, pecaminoso. <br>  El pensamiento inicial fue concluir todo a trav茅s de Phonegap y obtener una aplicaci贸n completa.  Dir茅 m谩s, hice exactamente eso, pero al final la versi贸n en l铆nea result贸 ser m谩s eficiente.  Yo y mi esposa en el tel茅fono acabamos de hacer un acceso directo en el escritorio para abrir la p谩gina deseada en la IP interna. <br><br>  Cada elemento responde a un evento de clic + el estado de ajax se verifica mediante solicitudes al servidor y se cambia si es necesario.  Es muy conveniente, porque ve todos los cambios que han entrado en vigencia por la regla o realizados por otro usuario. <br>  En realidad, el c贸digo bajo demanda sin problemas. <br><br><h2>  ESP-8266 </h2><br><img src="https://habrastorage.org/web/900/20a/853/90020a8530cc491cadc9aa15c8fb4e5c.jpg"><br><br>  Prob茅 diferentes m贸dulos y ESP-8266 puro.  Como resultado, el m贸dulo LOLIN V3 result贸 ser la opci贸n m谩s conveniente. <br><br><img src="https://habrastorage.org/web/325/c58/cda/325c58cda83f4c9a8cef58f7a1d88e8a.jpg"><br><br>  Fuente de alimentaci贸n mediante fuentes de alimentaci贸n conmutadas. <br><br><img src="https://habrastorage.org/web/268/d77/8ee/268d778ee71443c9a369bea9bb71491a.jpg"><br><br>  Los m贸dulos de compuerta requer铆an un rel茅 y me preocupaba que los rel茅s de contacto se activaran.  Como resultado, funcionan tanto los de estado s贸lido como los de contacto.  El problema es que una gran cantidad de m贸dulos, incluso sin etiquetar al respecto, son de baja activaci贸n. <br><br><img src="https://habrastorage.org/web/c81/9a8/130/c819a813070a47b5b6ebcb23a6d1bc8d.jpg"><br><br>  Cuando se enciende el m贸dulo, se produce una apertura a corto plazo, lo que conduce a una apertura involuntaria cuando se enciende la alimentaci贸n.  Se resuelve tirando a cero y declarando el estado antes de declarar el tipo de salida. <br><br><pre><code class="hljs lisp">digitalWrite(<span class="hljs-name"><span class="hljs-name">rele</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)<span class="hljs-comment"><span class="hljs-comment">; digitalWrite(rele2, 1); pinMode(rele, OUTPUT); pinMode(rele2, OUTPUT);</span></span></code> </pre> <br>  Como resultado, el m贸dulo para el ensamblaje del garaje se ve as铆.  El sensor PIR para detectar movimiento se mordisquea suavemente en la piel nativa. <br><br><img src="https://habrastorage.org/web/2ed/8f6/3b6/2ed8f63b60ea4b7abfb7bda9c04697c6.jpg"><br><br>  En la sala de calderas, mi caldera es muy simple y no se trata de una automatizaci贸n compleja. <br><br><img src="https://habrastorage.org/web/49a/966/18a/49a96618a1ec46b28d2ac11a79096533.jpg"><br><br>  Adem谩s, cada circuito sirve una bomba separada. <br><br><img src="https://habrastorage.org/web/220/bc5/af7/220bc5af7fcd43e0b90dcbf335f9b66a.jpg"><br><br>  En serie con las m谩quinas, se encendieron los rel茅s para controlar las bombas y la caldera. <br><br><img src="https://habrastorage.org/web/ae4/8b6/e04/ae48b6e0415047b58588b2a2cbfc5b1d.jpg"><br><br>  Empuja suavemente toda la econom铆a hacia el escudo. <br><br><img src="https://habrastorage.org/web/0cc/5d3/28d/0cc5d328d26b4f2a83450df8e2ced105.jpg"><br><br><h2>  Firmware </h2><br>  Decid铆 usar Arduino IDE para firmware para no meterme con nodemcu y lua.  En Internet y en GT en particular, una gran cantidad de informaci贸n para principiantes. <br>  De lo interesante, me parece, la funci贸n de conectarse a wifi.  El hecho es que en mi casa hay 4 redes wifi y se pueden agregar.  Para no establecer r铆gidamente el nombre de la red, primero escaneamos las redes disponibles. <br><br><div class="spoiler">  <b class="spoiler_title">C贸digo de configuraci贸n de WiFi ()</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> setupWiFi() { WiFi.mode(WIFI_STA); WiFi.disconnect(); delay(<span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(WiFi.status() != WL_CONNECTED) { <span class="hljs-type"><span class="hljs-type">int</span></span> n = WiFi.scanNetworks(); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("scan done"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("no networks found"); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(n); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(" networks found"); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; n; ++i) { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(""); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(i + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(": "); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(WiFi.SSID(i)); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(" ("); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(WiFi.RSSI(i)); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(")"); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println((WiFi.encryptionType(i) == ENC_TYPE_NONE)?" ":"*"); j=<span class="hljs-number"><span class="hljs-number">0</span></span>; ssid=WiFi.SSID(i); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("Connecting"); ssid.toCharArray(charBuf, <span class="hljs-number"><span class="hljs-number">50</span></span>); WiFi.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(charBuf,WIFI_PASS); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(WiFi.status() != WL_CONNECTED) { delay(<span class="hljs-number"><span class="hljs-number">500</span></span>); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("."); j++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(j&gt;<span class="hljs-number"><span class="hljs-number">20</span></span>){ break; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((WiFi.status() == WL_CONNECTED)){ break; } } } } <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("Connected"); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(WiFi.localIP()); }</code> </pre> <br></div></div><br>  Cuando el modo autom谩tico de la sala de calderas est谩 activado, la temperatura exterior y la temperatura del refrigerante se verifican de acuerdo con el programa. <br><br><ul><li>  A temperaturas inferiores a 14 * C, se enciende el piso c谩lido del primer piso. </li><li>  A temperaturas inferiores a 4 * C, todos los circuitos est谩n encendidos. </li></ul><br>  La temperatura del refrigerante se selecciona de acuerdo con la tabla dependiendo de la secci贸n transversal de las tuber铆as y la temperatura exterior.  Cuando se alcanza la temperatura ambiente requerida, la caldera se apaga.  Todos aplicaron una cierta hist茅resis para suavizar los valores de transici贸n. <br><br>  El sistema de seguridad funciona a煤n m谩s f谩cil.  Hay una regla en la tabla que dice que cuando el sistema de seguridad est谩 activado, si se detecta movimiento en uno de los sensores PIR, se env铆a un SMS a trav茅s de la API de uno de los servicios. <br><br><h2>  Planes </h2><br><ul><li>  Creaci贸n de una versi贸n en l铆nea en un servidor remoto y sincronizaci贸n de cambios para la posibilidad de control remoto. </li><li>  Mostrar datos de balizas GSM / GPS en el autom贸vil; </li><li>  Abrir las puertas cuando nuestros autos aparecen en cierta 谩rea; </li><li>  Conexi贸n al sistema de control remoto; </li></ul><br>  <b>Votaci贸n por foto.</b>  <b>驴Qu茅 proyecto hacer a continuaci贸n?</b> <br><br><div class="spoiler">  <b class="spoiler_title">Finalizar patada</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://geektimes.ru/post/281716/</a> <br><img src="https://habrastorage.org/web/626/a41/9a5/626a419a5b1143f092c0549638cbf9cc.jpg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Termine la impresora Delta 3D en los pernos de construcci贸n</b> <div class="spoiler_text"><img src="https://habrastorage.org/web/7ff/ec2/55e/7ffec255ec8b4196a7f1c9cc92ca9c4e.jpg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Estabilizador para c谩mara SLR</b> <div class="spoiler_text"><img src="https://habrastorage.org/web/138/3b8/b61/1383b8b61f724649b6cb832d0e69b6da.jpg"><br></div></div><br>  Gracias por su atencion  Contigo estaba SlavaGik. <br><br><img src="https://habrastorage.org/web/ebc/aa9/11a/ebcaa911ade648528ae7128e3031e563.jpg"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es405557/">https://habr.com/ru/post/es405557/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es405545/index.html">Ponga el horno en modo Apocalipsis: una revisi贸n de dispositivos para el control de armas nucleares antes del vuelo</a></li>
<li><a href="../es405547/index.html">Dos nuevas formas de apuntar autom谩ticamente la videoc谩mara</a></li>
<li><a href="../es405551/index.html">Casey Rias: el software como arte</a></li>
<li><a href="../es405553/index.html">El poder causa da帽o cerebral</a></li>
<li><a href="../es405555/index.html">Navi para iPhone volador: DJI Spark Fly Combo m谩s</a></li>
<li><a href="../es405561/index.html">Revisi贸n en vivo de la impresora 3D Chocola3D Food</a></li>
<li><a href="../es405563/index.html">Microsoft est谩 desarrollando un acelerador de IA para HoloLens</a></li>
<li><a href="../es405565/index.html">DNK | PRIME Segunda parte: pruebas</a></li>
<li><a href="../es405567/index.html">Neurog茅nesis: bases fisiol贸gicas y perspectivas de regulaci贸n con fines terap茅uticos.</a></li>
<li><a href="../es405571/index.html">Elementos del Sistema Nacional de Innovaci贸n de EE. UU., Parte 1: Entorno empresarial y pol铆tica fiscal, comercial y econ贸mica</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>