<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ûï ‚úåüèº ü•Å Os 10 erros mais comuns ao trabalhar com a plataforma Spring. Parte 2 üàµ üßîüèº ü•û</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sauda√ß√£o, Khabrovsk. Assim, a tradu√ß√£o da segunda parte de um artigo preparado especialmente para os alunos do curso "Developer on the Spring Framewor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Os 10 erros mais comuns ao trabalhar com a plataforma Spring. Parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/465063/">  <i>Sauda√ß√£o, Khabrovsk.</i>  <i>Assim, a tradu√ß√£o da segunda parte de um artigo preparado especialmente para os alunos do curso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"Developer on the Spring Framework"</a> chegou a tempo.</i>  <i>A primeira parte pode ser lida <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .</i> <br><br><img src="https://habrastorage.org/webt/-i/va/66/-iva66o8uvrummnptqda3getv_i.png"><br><br><p>  <font color="gray">A primavera √© talvez uma das plataformas de desenvolvimento Java mais populares.</font>  <font color="gray">Esta √© uma ferramenta poderosa, mas bastante dif√≠cil de aprender.</font>  <font color="gray">Seus conceitos b√°sicos s√£o bastante f√°ceis de entender e aprender, mas s√£o necess√°rios tempo e esfor√ßo para se tornar um desenvolvedor experiente do Spring.</font> <font color="gray"><br><br></font>  <font color="gray">Neste artigo, examinaremos alguns dos erros mais comuns cometidos ao trabalhar no Spring e relacionados, em particular, ao desenvolvimento de aplicativos da Web e ao uso da plataforma Spring Boot.</font>  <font color="gray">Conforme observado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site do Spring Boot</a> , o Spring Boot adota uma abordagem <i>padronizada</i> para criar aplicativos prontos para uso, e este artigo seguir√° essa abordagem.</font>  <font color="gray">Ele fornecer√° v√°rias recomenda√ß√µes que podem ser efetivamente usadas no desenvolvimento de aplicativos Web padr√£o baseados no Spring Boot.</font> <font color="gray"><br><br></font>  <font color="gray">Caso voc√™ n√£o esteja familiarizado com a plataforma Spring Boot, mas queira experimentar os exemplos deste artigo, criei um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reposit√≥rio GitHub com materiais adicionais para este artigo</a> .</font>  <font color="gray">Se, em algum momento, voc√™ estiver um pouco confuso ao ler este artigo, recomendamos que voc√™ crie um clone deste reposit√≥rio e experimente o c√≥digo no seu computador.</font> </p><a name="habracut"></a><br><hr><br><h2>  Erro comum n¬∫ 6: n√£o usando valida√ß√£o de dados baseada em anota√ß√£o </h2><br>  Vamos imaginar que nosso servi√ßo TopTalent dos exemplos anteriores precise de um terminal para adicionar novos dados TopTalent.  Al√©m disso, vamos supor que, por algum motivo realmente importante, cada nome que voc√™ adicionar deve ter exatamente 10 caracteres.  Isso pode ser implementado, por exemplo, da seguinte maneira: <br><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/put"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addTopTalent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@RequestBody TopTalentData topTalentData)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> nameNonExistentOrHasInvalidLength = Optional.ofNullable(topTalentData) .map(TopTalentData::getName) .map(name -&gt; name.length() == <span class="hljs-number"><span class="hljs-number">10</span></span>) .orElse(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nameNonExistentOrInvalidLength) { <span class="hljs-comment"><span class="hljs-comment">//   } topTalentService.addTopTalent(topTalentData); }</span></span></code> </pre> <br>  No entanto, o c√≥digo acima n√£o √© apenas mal estruturado, mas n√£o √© realmente uma solu√ß√£o "limpa".  <code>TopTalentData</code> v√°rios tipos de valida√ß√£o de dados (ou seja, verificamos que o objeto <code>TopTalentData</code> n√£o <code>TopTalentData</code> nulo, que o valor do campo TopTalentData.name n√£o √© nulo e que o comprimento do campo <code>TopTalentData.name</code> √© de 10 caracteres) e tamb√©m <code>TopTalentData.name</code> uma exce√ß√£o se os dados estiverem incorretos. <br><br>  Tudo isso pode ser feito com mais precis√£o usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">validador Hibernate</a> no Spring.  Vamos primeiro reescrever o m√©todo <code>addTopTalent</code> , adicionando suporte para valida√ß√£o de dados: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/put"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addTopTalent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Valid @NotNull @RequestBody TopTalentData topTalentData)</span></span></span><span class="hljs-function"> </span></span>{ topTalentService.addTopTalent(topTalentData); } <span class="hljs-meta"><span class="hljs-meta">@ExceptionHandler</span></span> <span class="hljs-meta"><span class="hljs-meta">@ResponseStatus</span></span>(HttpStatus.BAD_REQUEST) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ErrorResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleInvalidTopTalentDataException</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MethodArgumentNotValidException methodArgumentNotValidException)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    }</span></span></code> </pre> <br>  Al√©m disso, precisamos indicar qual valida√ß√£o de propriedade queremos executar na classe <code>TopTalentData</code> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TopTalentData</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Length</span></span>(min = <span class="hljs-number"><span class="hljs-number">10</span></span>, max = <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; }</code> </pre> <br>  O Spring agora interceptar√° a solicita√ß√£o e a verificar√° antes de chamar o m√©todo, portanto, nenhuma verifica√ß√£o manual adicional ser√° necess√°ria. <br><br>  O objetivo desejado tamb√©m pode ser alcan√ßado criando suas pr√≥prias anota√ß√µes.  Sob condi√ß√µes reais, geralmente faz sentido usar suas pr√≥prias anota√ß√µes somente quando suas necessidades excederem os recursos do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">conjunto interno de restri√ß√µes de hiberna√ß√£o</a> , mas, neste exemplo, vamos imaginar que <code>@Length</code> anota√ß√µes <code>@Length</code> n√£o existem.  Voc√™ pode criar um validador de dados que verifique o comprimento de uma sequ√™ncia criando duas classes adicionais: uma para valida√ß√£o e outra para propriedades de anota√ß√£o: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Target</span></span>({ElementType.METHOD, ElementType.FIELD, ElementType.PARAMETER}) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Documented</span></span> <span class="hljs-meta"><span class="hljs-meta">@Constraint</span></span>(validatedBy = { MyAnnotationValidator.class }) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> MyAnnotation { <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> "String length does not match expected"</span></span>; Class&lt;?&gt;[] groups() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; Class&lt;? extends Payload&gt;[] payload() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">value</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyAnnotationValidator</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConstraintValidator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyAnnotation</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> expectedLength; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MyAnnotation myAnnotation)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.expectedLength = myAnnotation.value(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isValid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String s, ConstraintValidatorContext constraintValidatorContext)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> s == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || s.length() == <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.expectedLength; } }</code> </pre> <br><br>  Observe que, nesses casos, a aplica√ß√£o correta do princ√≠pio da separa√ß√£o de responsabilidades exige a marca√ß√£o da propriedade como v√°lida se seu valor for nulo <code>(s == null</code> no m√©todo <code>isValid</code> ) e, em seguida, use a anota√ß√£o <code>@NotNull</code> se for necess√°rio adicionalmente para esta propriedade: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TopTalentData</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@MyAnnotation</span></span>(value = <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; }</code> </pre> <br><h2>  Erro comum n¬∫ 7: usando configura√ß√µes herdadas baseadas em XML </h2><br>  O uso de XML era uma necessidade ao trabalhar com vers√µes anteriores do Spring, mas agora a maioria das tarefas de configura√ß√£o pode ser implementada usando c√≥digo e anota√ß√µes Java.  As configura√ß√µes XML agora agem como c√≥digo de modelo adicional e opcional. <br><br>  Neste artigo (assim como nos materiais do reposit√≥rio GitHub complementar), as anota√ß√µes s√£o usadas para configurar o Spring, e o Spring sabe quais componentes JavaBean precisam ser vinculados, j√° que o pacote raiz √© anotado usando a anota√ß√£o composta @SpringBootApplication - assim: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(Application.class, args); } }</code> </pre> <br>  Essa anota√ß√£o composta (consulte a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Spring para obter</a> mais informa√ß√µes) simplesmente informa √† plataforma Spring quais pacotes ser√£o verificados para extrair os componentes JavaBean.  No nosso caso particular, isso significa que os seguintes subpacotes de co.kukurin ser√£o usados ‚Äã‚Äãpara liga√ß√£o: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Componente</a> (TopTalentConverter, MyAnnotationValidator) </li><li>  @RestController (TopTalentController) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Reposit√≥rio</a> (TopTalentRepository) </li><li>  Classes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Service</a> (TopTalentService) </li></ul><br>  Se tivermos classes adicionais com a anota√ß√£o <code>@Configuration</code> , elas tamb√©m ser√£o verificadas quanto √† configura√ß√£o do Java. <br><br><h2>  Erro comum n¬∫ 8: n√£o usando perfis de configura√ß√£o </h2><br>  Ao desenvolver sistemas de servidor, um problema comum √© alternar entre configura√ß√µes diferentes (como regra, essas s√£o configura√ß√µes para os ambientes operacionais e de desenvolvimento).  Em vez de alterar manualmente v√°rios par√¢metros em cada transi√ß√£o entre os modos de teste e opera√ß√£o, √© mais eficiente usar perfis de configura√ß√£o. <br><br>  Imagine o caso em que, no ambiente de desenvolvimento local, voc√™ usa o banco de dados na RAM e, no ambiente da opera√ß√£o real do seu aplicativo, o banco de dados MySQL √© usado.  Isso significa essencialmente que voc√™ usar√° URLs diferentes e, presumivelmente, credenciais diferentes para acessar cada um desses bancos de dados.  Vamos ver como isso pode ser implementado usando dois arquivos de configura√ß√£o: <br><br>  <b>FILE APPLICATION.YAML</b> <br><br><pre> <code class="java hljs"># set <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> profile to <span class="hljs-string"><span class="hljs-string">'dev'</span></span> spring.profiles.active: dev # production database details spring.datasource.url: <span class="hljs-string"><span class="hljs-string">'jdbc:mysql://localhost:3306/toptal'</span></span> spring.datasource.username: root spring.datasource.password:</code> </pre> <br><br>  <b>FILE APPLICATION-DEV.YAML</b> <br><br><pre> <code class="java hljs">spring.datasource.url: <span class="hljs-string"><span class="hljs-string">'jdbc:h2:mem:'</span></span> spring.datasource.platform: h2</code> </pre> <br><br>  Deve-se supor que, ao trabalhar com c√≥digo, voc√™ n√£o deseje executar algumas a√ß√µes aleat√≥rias com um banco de dados destinado ao ambiente operacional; portanto, faz sentido selecionar o perfil para o ambiente de desenvolvimento (DEV) como o perfil padr√£o.  Posteriormente, voc√™ pode substituir manualmente o perfil de configura√ß√£o no servidor especificando <code>-Dspring.profiles.active=prod</code> para a JVM.  Al√©m disso, o perfil de configura√ß√£o padr√£o pode ser especificado na vari√°vel de ambiente do sistema operacional. <br><br><h2>  Erro comum n√∫mero 9. Falha no uso do mecanismo de inje√ß√£o de depend√™ncia </h2><br>  O uso adequado do mecanismo de inje√ß√£o de depend√™ncia no Spring significa que o Spring pode vincular todos os seus objetos, varrendo todas as classes de configura√ß√£o necess√°rias.  Isso √© √∫til para diminuir as interdepend√™ncias e facilita muito os testes.  Em vez de vincular fortemente classes, algo como isto: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TopTalentController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> TopTalentService topTalentService; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TopTalentController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.topTalentService = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TopTalentService(); } }</code> </pre> <br>  ... permitimos que a plataforma Spring se vincule: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TopTalentController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> TopTalentService topTalentService; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TopTalentController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TopTalentService topTalentService)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.topTalentService = topTalentService; } }</code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A palestra de Mishko Hevery no canal Google Tech Talks</a> explica em detalhes por que a inje√ß√£o de depend√™ncia deve ser usada, mas aqui veremos como esse mecanismo √© usado na pr√°tica.  Na divis√£o de responsabilidades (‚ÄúErro comum n¬∫ 3‚Äù), criamos as classes de servi√ßo e controlador.  Suponha que desejamos testar um controlador, assumindo que a classe <code>TopTalentService</code> funcionando corretamente.  Podemos inserir um objeto simulador em vez da implementa√ß√£o de servi√ßo atual, criando uma classe de configura√ß√£o separada: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SampleUnitTestConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> TopTalentService </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">topTalentService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ TopTalentService topTalentService = Mockito.mock(TopTalentService.class); Mockito.when(topTalentService.getTopTalent()).thenReturn( Stream.of(<span class="hljs-string"><span class="hljs-string">"Mary"</span></span>, <span class="hljs-string"><span class="hljs-string">"Joel"</span></span>).map(TopTalentData::<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>).collect(Collectors.toList())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> topTalentService; } }</code> </pre> <br>  Depois disso, podemos implementar o objeto simulador, <code>SampleUnitTestConfig</code> plataforma Spring que precisamos usar <code>SampleUnitTestConfig</code> como a fonte de configura√ß√£o: <br> <code>@ContextConfiguration(classes = { SampleUnitTestConfig.class })</code> <br> <br>  Posteriormente, isso nos permitir√° usar a configura√ß√£o contextual para incorporar o componente JavaBean personalizado em um teste de unidade. <br><br><h2>  Erro comum n√∫mero 10. Falta de teste ou teste incorreto </h2><br>  Apesar do fato de que a id√©ia de teste de unidade n√£o √© de forma alguma nova, parece que muitos desenvolvedores "esquecem" (especialmente se n√£o for <i>obrigat√≥rio</i> ) ou gastam tarde demais.  Obviamente, isso est√° errado, porque os testes n√£o apenas permitem verificar a opera√ß√£o correta do c√≥digo, mas tamb√©m servem como documenta√ß√£o que mostra como o aplicativo deve se comportar em v√°rias situa√ß√µes. <br>  Ao testar servi√ßos da Web, voc√™ raramente executa testes de unidade excepcionalmente "limpos", porque para uma conex√£o HTTP, geralmente √© necess√°rio usar o servlet Spring <code>DispatcherServlet</code> e ver o que acontece quando voc√™ recebe uma solicita√ß√£o <code>HttpServletRequest</code> real (ou seja, um teste de <i>integra√ß√£o</i> que usa valida√ß√£o, serializa√ß√£o etc.).  Uma solu√ß√£o elegante e comprovada √© usar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">REST Assured</a> , uma biblioteca Java para testar convenientemente os servi√ßos REST, com o MockMVC.  Considere o seguinte fragmento de c√≥digo com inje√ß√£o de depend√™ncia: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(SpringJUnit4ClassRunner.class) <span class="hljs-meta"><span class="hljs-meta">@ContextConfiguration</span></span>(classes = { Application.class, SampleUnitTestConfig.class }) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RestAssuredTestDemonstration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TopTalentController topTalentController; <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shouldGetMaryAndJoel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// given MockMvcRequestSpecification givenRestAssuredSpecification = RestAssuredMockMvc.given() .standaloneSetup(topTalentController); // when MockMvcResponse response = givenRestAssuredSpecification.when().get("/toptal/get"); // then response.then().statusCode(200); response.then().body("name", hasItems("Mary", "Joel")); } }</span></span></code> </pre> <br>  <code>SampleUnitTestConfig</code> vincula a implementa√ß√£o substituta da classe <code>TopTalentService</code> ao <code>TopTalentController</code> , e todas as outras classes s√£o vinculadas usando a configura√ß√£o padr√£o obtida pela verifica√ß√£o de pacotes com base no pacote da classe Application.  <code>RestAssuredMockMvc</code> simplesmente usado para configurar um ambiente leve e enviar uma solicita√ß√£o <code>GET</code> para o <code>/toptal/get</code> . <br><br><h3>  Use o Spring profissionalmente </h3><br>  O Spring √© uma plataforma poderosa e f√°cil de come√ßar, mas leva tempo e algum esfor√ßo para domin√°-lo completamente.  Se voc√™ dedicar algum tempo para se familiarizar com essa plataforma, no final, ela sem d√∫vida aumentar√° a efici√™ncia do seu trabalho, ajudar√° a criar um c√≥digo mais limpo e a aumentar suas qualifica√ß√µes como desenvolvedor. <br><br>  Eu recomendo que voc√™ preste aten√ß√£o ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Spring In Action</a> - este √© um bom livro orientado a aplicativos que discute muitos t√≥picos importantes relacionados √† plataforma Spring. <br><br>  Nesse ponto, a tradu√ß√£o deste artigo chegou ao fim. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Leia a primeira parte</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt465063/">https://habr.com/ru/post/pt465063/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt465049/index.html">10 livros sobre gerenciamento √°gil de projetos que vale a pena levar com voc√™ em 2020</a></li>
<li><a href="../pt465055/index.html">Seis habilidades para levar sua carreira de Ci√™ncia de Dados para o pr√≥ximo n√≠vel.</a></li>
<li><a href="../pt465057/index.html">Recipientes e Windows. Do Hello World ao Kubernetes. Parte I, Introdut√≥ria</a></li>
<li><a href="../pt465059/index.html">PoE a uma dist√¢ncia de mais de 200 metros. Monitoramento e reinicializa√ß√£o autom√°tica de clientes PoE</a></li>
<li><a href="../pt465061/index.html">Por que, em vez de uma semana de trabalho de quatro dias, √© melhor pensar em um dia de trabalho de seis horas</a></li>
<li><a href="../pt465069/index.html">Novo no Hadoop: Conhe√ßa os v√°rios formatos de arquivo no Hadoop</a></li>
<li><a href="../pt465071/index.html">TechTrain 2019 IT festival: como JUG.ru, JUGNsk e JUG.MSK participaram</a></li>
<li><a href="../pt465073/index.html">N√£o apare√ßa! Transi√ß√µes interromp√≠veis no iOS</a></li>
<li><a href="../pt465075/index.html">Na cabine do maquinista</a></li>
<li><a href="../pt465077/index.html">Unsafe.AsSpan: Span <T> como substituir ponteiros?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>