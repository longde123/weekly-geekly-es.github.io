<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí´ üì¥ üé≠ Pesquisa no MapKit: Dicas e truques üôèüèΩ ü¶ï üç¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O MapKit √© uma biblioteca de software que permite usar dados de mapa e tecnologias Yandex em aplicativos m√≥veis. Ela possui documenta√ß√£o oficial que j...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pesquisa no MapKit: Dicas e truques</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/428564/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/dq/_i/jl/dq_ijlbhgproad1ydyfpsill35e.png" width="480"></div><br><p>  O MapKit √© uma biblioteca de software que permite usar dados de mapa e tecnologias Yandex em aplicativos m√≥veis.  Ela possui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o oficial</a> que j√° cont√©m uma descri√ß√£o detalhada dos m√©todos da API, ent√£o hoje falaremos sobre outra coisa. </p><br><p>  Neste post, vou contar aos leitores da Habr sobre os recursos da pesquisa no MapKit e compartilhar recomenda√ß√µes e truques que podem ser √∫teis para voc√™. </p><br><p>  <strong>TL; DR</strong> Se voc√™ n√£o quiser ler o artigo inteiro, aqui est√£o dois dos pontos mais √∫teis como compensa√ß√£o pela leitura do pref√°cio: </p><br><ul><li>  N√£o se esque√ßa de salvar as sess√µes, caso contr√°rio, a pesquisa n√£o funcionar√°. </li><li>  Todas as informa√ß√µes mais interessantes s√£o armazenadas nos metadados do objeto.  Se voc√™ quiser descobrir o endere√ßo completo, o hor√°rio de funcionamento ou quanto custa uma x√≠cara de cappuccino em um caf√© espec√≠fico, precisar√° de metadados. </li></ul><br><p>  Os links para a documenta√ß√£o no texto ser√£o para Android, classes e m√©todos para iOS s√£o chamados da mesma maneira. </p><a name="habracut"></a><br><h2 id="chto-umeet-poisk">  O que pode pesquisar </h2><br><p>  Primeiro, vamos falar sobre o que a pesquisa no MapKit pode fazer.  A pesquisa pode fazer o que voc√™ espera de um aplicativo de mapa quando quiser encontrar algo l√°. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/m0/1g/wv/m01gwvpktgpsipyacy4rj5pi3yw.jpeg" width="720"></div><br><p>  Quando voc√™ digita na barra de pesquisa ‚Äúcafe‚Äù, ‚ÄúLev Tolstoy street, 16‚Äù ou ‚Äúbonde 3‚Äù, a <strong>pesquisa de texto</strong> funciona.  Este √© o tipo de pesquisa mais sofisticado.  Empilhados no sentido de que ele suporta o conjunto m√°ximo de par√¢metros para personaliza√ß√£o.  Voc√™ pode tentar procurar imediatamente ao longo de uma rota ou rua em que esteja interessado, esclarecer o n√∫mero desejado de resultados, definir a posi√ß√£o do usu√°rio e assim por diante.  Se ap√≥s a primeira pesquisa voc√™ desejar mover o mapa ou aplicar filtros √† solicita√ß√£o ("farm√°cias com piscina"), essas s√£o <strong>solicita√ß√µes novamente</strong> . </p><br><p>  <strong>A pesquisa reversa √©</strong> familiar para a maioria dos usu√°rios na pergunta "O que est√° aqui?".  Ele permite que voc√™ clique no mapa para determinar qual rua ou casa est√° "sob o cursor" ou quais organiza√ß√µes est√£o pr√≥ximas desse ponto.  <strong>A pesquisa por URI √©</strong> necess√°ria quando voc√™ deseja encontrar um objeto espec√≠fico.  Pode ser usado, por exemplo, para criar marcadores em um aplicativo.  Encontramos uma cafeteria favorita, marcada com um asterisco - da pr√≥xima vez ser√° poss√≠vel encontrar exatamente essa organiza√ß√£o pelo URI, onde quer que a janela do mapa esteja localizada.  Nem a pesquisa reversa nem as pesquisas de URI oferecem suporte a solicita√ß√µes, porque n√£o h√° nada a ser especificado para elas. </p><br><p>  Outra possibilidade que existe na pesquisa s√£o as <strong>dicas de pesquisa</strong> , que permitem complementar automaticamente a consulta enquanto voc√™ a digita.  Mas adiaremos uma hist√≥ria detalhada sobre eles por outro tempo. </p><br><h2 id="kak-ustroen-zapros">  Como a solicita√ß√£o √© organizada </h2><br><p> A pesquisa, como muitas partes do MapKit, funciona de forma ass√≠ncrona.  O principal objeto para trabalhar com essa assincronia √© a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sess√£o de pesquisa</a> .  Vejamos um pequeno exemplo. </p><br><div class="spoiler">  <b class="spoiler_title">Um pouco sobre exemplos</b> <div class="spoiler_text"><p> Os exemplos no artigo estar√£o no Kotlin para facilitar o trabalho com valores opcionais e menos c√≥digo padr√£o.  O MapKit tem um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aplicativo de demonstra√ß√£o</a> .  Pode ser usado para testar exemplos, mas, para isso, o <a href=""><code>SearchActivity</code></a> deve ser convertido de Java para Kotlin.  <code>showMessage</code> , que periodicamente aparece no c√≥digo, √© uma maneira conveniente de exibir uma linha de texto na tela ou no log. </p></div></div><br><pre> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">// `searchManager`  `searchSession` ‚Äì  .    //    ,     . searchManager = SearchFactory.getInstance().createSearchManager( SearchManagerType.ONLINE ) val point = Geometry.fromPoint(Point(59.95, 30.32)) searchSession = searchManager!!.submit("", point, SearchOptions(), object: Session.SearchListener { override fun onSearchError(p0: Error) { showMessage("Error") } override fun onSearchResponse(p0: Response) { showMessage("Success") } } )</span></span></code> </pre> <br><p>  Imediatamente ap√≥s a chamada de <code>submit</code> controle retornar√° ao seu c√≥digo e, quando o MapKit receber uma resposta do servidor, o SearchListener ser√° chamado. </p><br><p>  A sess√£o de pesquisa permite: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cancelar pedido</a> .  Por exemplo, se o usu√°rio fechar a tela de pesquisa. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Repita a solicita√ß√£o</a> em caso de erro.  Por exemplo, se houver algum problema com a rede. </li><li>  Continue a intera√ß√£o com a pesquisa ap√≥s a resposta recebida.  <strong>Re-solicita√ß√µes</strong> s√£o feitas durante a sess√£o. </li></ul><br><p>  Uma sess√£o ap√≥s o cancelamento √© automaticamente cancelada.  Isso significa que, se n√£o for salvo no lado do c√≥digo do cliente, a pesquisa n√£o funcionar√°. <br>  <strong>N√£o se esque√ßa de salvar a sess√£o, a sess√£o √© sua amiga!</strong> </p><br><h3 id="search-options">  Op√ß√µes de pesquisa </h3><br><p>  Uma maneira geral de configurar consultas de pesquisa √© atrav√©s da classe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>SearchOptions</code></a> , que permite modificar os par√¢metros da consulta. </p><br><ul><li>  O principal desses par√¢metros √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>SearchType</code></a> .  Ele permite que voc√™ especifique se deseja ver top√¥nimos, organiza√ß√µes ou transporte na resposta (voc√™ provavelmente n√£o precisar√° de outros tipos). </li><li>  Outro par√¢metro de consulta importante s√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">trechos</a> .  Falaremos sobre eles em mais detalhes na se√ß√£o sobre o dispositivo de resposta. </li><li>  Se voc√™ deseja obter a geometria do top√¥nimo (por exemplo, ruas ou √°reas), √© necess√°rio orden√°-lo atrav√©s de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>setGeometry(true)</code></a> .  Lembre-se de que a geometria √© bastante "pesada" em termos de dados transmitidos. </li><li>  Por padr√£o, a pesquisa n√£o retorna organiza√ß√µes fechadas (tempor√°ria ou permanentemente), mas se voc√™ precisar delas, precisar√° definir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>setSearchClosed(true)</code></a> . </li></ul><br><p>  Al√©m dos par√¢metros listados, h√° mais alguns que podem ser √∫teis para voc√™, eles podem ser encontrados na documenta√ß√£o da classe.  Observe que nem todas as consultas oferecem suporte a todas as combina√ß√µes de par√¢metros.  A documenta√ß√£o para cada m√©todo <code>SearchManager</code> ou <code>Session</code> indica quais par√¢metros do <code>SearchOptions</code> ele entende. </p><br><h2 id="kak-ustroen-otvet">  Como a resposta est√° organizada </h2><br><p>  A julgar pelas perguntas de suporte, a maioria dos usu√°rios fica confusa com o formato da resposta da pesquisa.  Se voc√™ olhar para a classe de resposta, ela parecer√° bastante simples (pelo menos, a parte interessante para n√≥s): </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Response</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">synchronized</span></span></span><span class="hljs-function"> SearchMetadata </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMetadata</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">synchronized</span></span></span><span class="hljs-function"> GeoObjectCollection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCollection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p>  Aqui, <code>getCollection()</code> retorna os objetos na resposta e <code>getMetadata()</code> s√£o alguns <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dados adicionais</a> que cont√™m, por exemplo, informa√ß√µes sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a janela de resposta</a> , o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tipo de classifica√ß√£o</a> e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">n√∫mero de resultados encontrados</a> .  Se voc√™ olhar dentro do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>GeoObjectCollection</code></a> poder√° ver que ele cont√©m alguns <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>Item</code></a> que podem ser outros <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>GeoObjectCollection</code></a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>GeoObject</code></a> . </p><br><p>  N√£o h√° cole√ß√µes dentro das cole√ß√µes na pesquisa (pelo menos ainda n√£o), ent√£o vamos dar uma olhada no <code>GeoObject</code> .  Dentro do objeto h√° um nome ( <code>getName()</code> ), uma descri√ß√£o ( <code>getDescriptionText()</code> ), um quadro ( <code>getBoundingBox()</code> ), um conjunto de geometrias ( <code>getGeometry()</code> ) e alguns outros m√©todos n√£o muito claros.  Onde est√£o os n√∫meros de telefone da organiza√ß√£o?  Como entender a qual cidade o top√¥nimo se refere? </p><br><p>  De acordo com os m√©todos do objeto, isso n√£o est√° muito claro. </p><br><h3 id="geoobject">  Objeto geogr√°fico </h3><br><p>  √â hora de falar mais sobre o <code>GeoObject</code> . </p><br><p>  <code>GeoObject</code> √© um objeto "b√°sico" t√£o b√°sico.  No interior, pode haver um evento na estrada, um objeto separado do resultado da pesquisa, uma manobra na rota ou um objeto no mapa (POI), como um monumento ou alguma organiza√ß√£o not√°vel. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_l/ut/15/_lut15ur4w70yz88v1127swd6wg.png"></div><br><p>  O mais interessante sobre o objeto √© armazenado em metadados.  Eles podem ser acessados ‚Äã‚Äãusando o m√©todo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>getMetadataContainer()</code></a> .  A chave neste cont√™iner √© o tipo de metadados.  Se voc√™ vir algo na documenta√ß√£o que termina com a palavra <code>Metadata</code> , provavelmente est√° aqui.  Na busca de diferentes partes de "metadados" 15. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gd/we/00/gdwe00tnfbshuzugslvjssupja4.png"></div><br><p>  Os metadados podem ser divididos em v√°rios tipos.  O primeiro tipo s√£o os metadados que determinam a que tipo de objeto o objeto pertence: top√¥nimos ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>ToponymObjectMetadata</code></a> ), organiza√ß√µes ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>BusinessObjectMetadata</code></a> ) ou transporte ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>TransitObjectMetadata</code></a> ).  Nos metadados do top√¥nimo, voc√™ pode encontrar um endere√ßo estruturado e uma geometria detalhada.  Os metadados da organiza√ß√£o s√£o o hor√°rio de opera√ß√£o ou o site da empresa.  Esses metadados s√£o determinados pelo tipo de pesquisa na solicita√ß√£o - se voc√™ pesquisou apenas top√¥nimos, cada objeto na resposta deve ter metadados correspondentes.  Se voc√™ estava procurando nomes ou organiza√ß√µes de locais, cada objeto ter√° pelo menos um dos dois "metadados". </p><br><p>  Veja como encontrar os n√∫meros de telefone da empresa: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> phones = response.collection.children.firstOrNull()?.obj ?.metadataContainer ?.getItem(<span class="hljs-type"><span class="hljs-type">BusinessObjectMetadata</span></span>::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">?</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">phones</span></span></span></span></code> </pre> <br><p>  E aqui est√° como encontrar a cidade em um endere√ßo estruturado: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> city = response.collection.children.firstOrNull()?.obj ?.metadataContainer ?.getItem(<span class="hljs-type"><span class="hljs-type">ToponymObjectMetadata</span></span>::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">?</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">address</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">?</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">components</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">?</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">firstOrNull</span></span></span><span class="hljs-class"> </span></span>{ it.kinds.contains(<span class="hljs-type"><span class="hljs-type">Address</span></span>.<span class="hljs-type"><span class="hljs-type">Component</span></span>.<span class="hljs-type"><span class="hljs-type">Kind</span></span>.<span class="hljs-type"><span class="hljs-type">LOCALITY</span></span>) } ?.name</code> </pre> <br><p>  O segundo tipo s√£o os metadados que acompanham o objeto, embora voc√™ n√£o tenha perguntado sobre ele.  O principal tipo que voc√™ precisa conhecer √© o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>URIObjectMetadata</code></a> .  Dentro do <code>URIObjectMetadata</code> o identificador exclusivo do objeto √© armazenado, que deve ser passado na <strong>pesquisa pelo URI</strong> . </p><br><pre> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">//       ¬´¬ª,     //     val uri = response.collection.children.firstOrNull()?.obj ?.metadataContainer ?.getItem(UriObjectMetadata::class.java) ?.uris ?.firstOrNull() ?.value</span></span></code> </pre> <br><p>  E o terceiro tipo s√£o os metadados, que vir√£o na resposta somente se voc√™ solicitar especificamente uma pesquisa sobre ele.  De uma maneira diferente, esses metadados s√£o chamados de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">snippets</a> .  Snippets s√£o pequenos dados adicionais que s√£o alterados com mais frequ√™ncia do que os dados b√°sicos de "refer√™ncia" ou que nem todos precisam.  Pode ser uma classifica√ß√£o, um link para fotos ou panoramas, a taxa de c√¢mbio ou o pre√ßo do combust√≠vel em um posto de gasolina.  A lista de trechos deve ser definida usando as op√ß√µes de pesquisa.  Se o servidor tiver um trecho ordenado, ele ser√° adicionado ao objeto correspondente. </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> point = <span class="hljs-type"><span class="hljs-type">Geometry</span></span>.fromPoint(<span class="hljs-type"><span class="hljs-type">Point</span></span>(<span class="hljs-number"><span class="hljs-number">59.95</span></span>, <span class="hljs-number"><span class="hljs-number">30.32</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> options = <span class="hljs-type"><span class="hljs-type">SearchOptions</span></span>() options.snippets = <span class="hljs-type"><span class="hljs-type">Snippet</span></span>.<span class="hljs-type"><span class="hljs-type">FUEL</span></span>.value searchSession = searchManager!!.submit(<span class="hljs-string"><span class="hljs-string">""</span></span>, point, options, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) ... <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> fun onSearchResponse(response: <span class="hljs-type"><span class="hljs-type">Response</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//         showMessage(response.collection.children.firstOrNull()?.obj ?.metadataContainer ?.getItem(FuelMetadata::class.java) ?.fuels ?.joinToString("\n") { "Fuel(name=${it.name}, price=${it.price?.text})" } ?: "No fuel" ) }</span></span></code> </pre> <br><p>  Todos os metadados listados acima s√£o adicionados a objetos individuais na resposta.  Tamb√©m h√° metadados que s√£o adicionados a toda a resposta.  Mas eles s√£o destacados nos m√©todos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>SearchMetadata</code></a> e n√£o precisam ser extra√≠dos de nenhuma cole√ß√£o especial. </p><br><pre> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">//            response.metadata.businessResultMetadata?.categories //     (  )     response.metadata.toponymResultMetadata?.responseInfo?.mode</span></span></code> </pre> <br><h2 id="primery-ispolzovaniya">  Exemplos de uso </h2><br><p>  Agora, vamos examinar os principais m√©todos das classes de pesquisa, ver exemplos de uso e alguns pontos n√£o √≥bvios associados a elas. </p><br><h3 id="poisk-po-tekstu">  Pesquisa de Texto </h3><br><p>  O m√©todo principal para pesquisa de texto (e para toda a pesquisa, provavelmente) √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>submit</code></a> : </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">Session </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">submit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( String text, Geometry geometry, SearchOptions searchOptions, SearchListener searchListener )</span></span></span></span>;</code> </pre> <br><ul><li>  O par√¢metro <code>text</code> deve conter o texto que voc√™ deseja pesquisar. </li><li>  O par√¢metro <code>geometry</code> √© um pouco mais complicado.  Dependendo do tipo de geometria transferida, a pesquisa se comportar√° de maneira diferente: <br><ul><li>  Se voc√™ passar um ponto, a pesquisa ser√° realizada em uma pequena janela ao lado deste ponto. </li><li>  Se voc√™ passar por uma janela retangular ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>BoundingBox</code></a> ) ou um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pol√≠gono</a> de quatro pontos, ela ser√° usada como uma caixa de pesquisa.  Um exemplo simples dessa janela √© a √°rea vis√≠vel do mapa. </li><li>  Finalmente, se voc√™ passar a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">polilinha</a> , a janela que a descreve ser√° usada como uma janela de pesquisa e a classifica√ß√£o ser√° realizada levando em considera√ß√£o essa polilinha. </li></ul></li><li>  J√° falamos sobre <code>SearchOptions</code> e <code>SearchListener</code> acima. </li></ul><br><p>  O servidor pode considerar que a resposta correta n√£o est√° na janela em que a pesquisa inicial foi realizada ("caf√© em Vladivostok" quando a janela de pesquisa est√° em Moscou).  Nesse caso, voc√™ precisar√° pegar a janela de resposta e mover o cart√£o para l√°, para que os resultados sejam vis√≠veis na tela (as solicita√ß√µes n√£o se permitem isso e n√£o pedem para mover o cart√£o). </p><br><p>  O m√©todo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>submit</code></a> possui um g√™meo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>submit</code></a> : </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">Session </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">submit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( String text, Polyline polyline, Geometry geometry, SearchOptions searchOptions, SearchListener searchListener )</span></span></span></span>;</code> </pre> <br><p>  com um par√¢metro adicional.  Este par√¢metro pode ser usado para transferir uma polilinha grande (por exemplo, uma rota para outra cidade) e uma pequena janela de pesquisa.  Em seguida, a pr√≥pria pesquisa cortar√° a parte necess√°ria da polilinha transferida e a usar√° apenas para a consulta. </p><br><h3 id="perezaprosy">  Re-solicita√ß√µes </h3><br><p>  Solicita√ß√µes diferentes, ao contr√°rio de outros tipos de solicita√ß√µes, s√£o feitas com a ajuda de uma sess√£o de pesquisa, que retorna o mesmo <code>submit</code> e seu irm√£o g√™meo.  Parte dos m√©todos da sess√£o √© simples e direta: </p><br><ul><li>  voc√™ pode alterar a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">janela de solicita√ß√£o</a> (quando o usu√°rio, por exemplo, moveu o cart√£o) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">as op√ß√µes de pesquisa</a> podem ser atualizadas (por exemplo, para atualizar a posi√ß√£o do usu√°rio) </li><li>  Voc√™ pode alterar o tipo de classifica√ß√£o - por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dist√¢ncia</a> ou por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">classifica√ß√£o</a> . </li></ul><br><p>  Para executar uma pesquisa refinada, voc√™ precisa usar o m√©todo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>resubmit</code></a> .  Ele aceita o mesmo <code>SearchListener</code> que uma pesquisa regular.  Antes de cham√°-lo, voc√™ pode alterar v√°rios par√¢metros de sess√£o.  Por exemplo, altere simultaneamente o tipo de classifica√ß√£o e aplique filtros. </p><br><h4 id="filtry">  Filtros </h4><br><p>  J√° que estamos falando de filtros.  Os filtros s√£o quando Wi-Fi e cozinha italiana.  Eles provavelmente t√™m a sintaxe mais confusa de todas as interfaces de pesquisa no MapKit.  Isso se deve ao fato de as mesmas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">estruturas de dados serem</a> usadas para obter filtros da resposta da pesquisa e para especificar filtros na solicita√ß√£o novamente. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7m/51/ky/7m51ky9gytyd1rlubljviboun5k.jpeg" width="360"></div><br><p>  Os filtros v√™m em dois tipos.  Os filtros booleanos assumem apenas dois valores mutuamente exclusivos - sim ou n√£o.  Pode ser a presen√ßa de Wi-Fi em um caf√©, um banheiro em um posto de gasolina ou estacionamento perto da organiza√ß√£o.  Os filtros de enumera√ß√£o assumem muitos valores que podem ser solicitados juntos.  Este, por exemplo, √© o tipo de cozinha para um caf√© ou os tipos de combust√≠vel em um posto de gasolina. </p><br><p>  Primeiro, vamos ver como disponibilizar os filtros para a reinicializa√ß√£o atual: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> fun filters(response: <span class="hljs-type"><span class="hljs-type">Response</span></span>): <span class="hljs-type"><span class="hljs-type">String</span></span>? { fun enumValues(filter: <span class="hljs-type"><span class="hljs-type">BusinessFilter</span></span>) = filter .values .enums ?.joinToString(prefix = <span class="hljs-string"><span class="hljs-string">" -&gt; "</span></span>) { e -&gt; e.value.id } ?: <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response .metadata .businessResultMetadata ?.businessFilters ?.joinToString(separator = <span class="hljs-string"><span class="hljs-string">"\n"</span></span>) { f -&gt; <span class="hljs-string"><span class="hljs-string">"${f.id}${enumValues(f)}"</span></span> } }</code> </pre> <br><p>  Na linha resultante, para filtros booleanos, apenas o identificador ser√° mostrado e, para filtros de enumera√ß√£o, o identificador do pr√≥prio filtro e identificadores dos valores dispon√≠veis.  Agora, armados com o conhecimento dos identificadores dispon√≠veis, procuraremos os caf√©s da culin√°ria italiana que t√™m Wi-Fi.  Primeiro adicione um filtro booleano: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> boolFilter = <span class="hljs-type"><span class="hljs-type">BusinessFilter</span></span>( <span class="hljs-comment"><span class="hljs-comment">/* id= */</span></span> <span class="hljs-string"><span class="hljs-string">"wi_fi"</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* name= */</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* disabled= */</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* values= */</span></span> <span class="hljs-type"><span class="hljs-type">BusinessFilter</span></span>.<span class="hljs-type"><span class="hljs-type">Values</span></span>.fromBooleans( listOf(<span class="hljs-type"><span class="hljs-type">BusinessFilter</span></span>.<span class="hljs-type"><span class="hljs-type">BooleanValue</span></span>(<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)) ) )</code> </pre> <br><p>  Agora o filtro enum: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enumFilter = <span class="hljs-type"><span class="hljs-type">BusinessFilter</span></span>( <span class="hljs-comment"><span class="hljs-comment">/* id= */</span></span> <span class="hljs-string"><span class="hljs-string">"type_cuisine"</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* name= */</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* disabled= */</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* values= */</span></span> <span class="hljs-type"><span class="hljs-type">BusinessFilter</span></span>.<span class="hljs-type"><span class="hljs-type">Values</span></span>.fromEnums( listOf(<span class="hljs-type"><span class="hljs-type">BusinessFilter</span></span>.<span class="hljs-type"><span class="hljs-type">EnumValue</span></span>( <span class="hljs-type"><span class="hljs-type">Feature</span></span>.<span class="hljs-type"><span class="hljs-type">FeatureEnumValue</span></span>( <span class="hljs-comment"><span class="hljs-comment">/* id= */</span></span> <span class="hljs-string"><span class="hljs-string">"italian_cuisine"</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* name= */</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* imageUrlTemplate= */</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> ), <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span> )) ) )</code> </pre> <br><p>  Por fim, voc√™ pode adicionar filtros √† sess√£o e chamar <code>resubmit()</code> : </p><br><pre> <code class="scala hljs">searchSession!!.setFilters(listOf(boolFilter, enumFilter)) searchSession!!.resubmit(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)</code> </pre> <br><p>  Observe que voc√™ n√£o pode definir filtros para a primeira consulta.  Primeiro, voc√™ precisa obter uma resposta de pesquisa que lista os filtros dispon√≠veis.  E s√≥ ent√£o para formar uma reinicializa√ß√£o. </p><br><h5 id="dopolnitelnye-rezultaty">  Resultados adicionais </h5><br><p>  Outra sess√£o permite que voc√™ verifique se h√° resultados de pesquisa adicionais para sua solicita√ß√£o.  E, se estiverem, pegue-os.  Por exemplo, quando voc√™ procura um caf√© em sua cidade, provavelmente todos eles n√£o cabem em uma p√°gina da resposta da pesquisa.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>fetchNextPage</code></a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>fetchNextPage</code></a> necess√°rios para exibir as seguintes p√°ginas da lista.  Aqui voc√™ precisa saber que, em primeiro lugar, chamar <code>fetchNextPage</code> lan√ßar√° uma exce√ß√£o se o m√©todo <code>hasNextPage</code> retornar <code>false</code> .  E segundo, o uso desses m√©todos implica que os par√¢metros restantes n√£o mudam.  Ou seja, a sess√£o √© usada para refinar a solicita√ß√£o ( <code>resubmit()</code> ) ou recuperar as seguintes p√°ginas ( <code>fetchNextPage()</code> ).  A combina√ß√£o desses modos n√£o √© necess√°ria. </p><br><h4 id="obratnyy-poisk">  Pesquisa reversa </h4><br><p>  A busca reversa por conveni√™ncia tamb√©m √© chamada de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>submit</code></a> : </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">Session </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">submit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Point point, Integer zoom, SearchOptions searchOptions, SearchListener searchListener )</span></span></span></span></code> </pre> <br><p>  Difere de outros tipos de consultas, pois <em>requer</em> apenas um tipo de pesquisa para entrar.  Voc√™ passa o tipo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>GEO</code></a> e procura nomes de lugares ou o tipo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>BIZ</code></a> e procura organiza√ß√µes.  N√£o h√° terceiro. </p><br><p>  Ao pesquisar com um tipo <code>GEO</code> , h√° pontos que precisam de esclarecimentos.  Observe que a resposta conter√° v√°rios objetos na hierarquia (ou seja, a resposta incluir√° uma casa, rua, cidade e assim por diante).  Em casos simples, voc√™ pode pegar apenas o primeiro objeto.  Nos mais complexos, pesquise na hierarquia desejada. </p><br><p>  O n√≠vel de zoom √© necess√°rio para produzir resultados adequados, dependendo do que o usu√°rio v√™ no mapa.  Imagine um usu√°rio vendo um mapa em todo o pa√≠s.  Ser√° estranho para ele clicar em uma rua ou casa separada se o usu√°rio acidentalmente conseguir entrar nelas.  Cidades suficientes.  √â para isso que serve o par√¢metro <code>zoom</code> . </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> point = <span class="hljs-type"><span class="hljs-type">Point</span></span>(<span class="hljs-number"><span class="hljs-number">55.734</span></span>, <span class="hljs-number"><span class="hljs-number">37.588</span></span>) <span class="hljs-comment"><span class="hljs-comment">//         ¬´  , 16¬ª searchSession = searchManager!!.submit(point, 16, SearchOptions(), this) //    ‚Äì  " " searchSession = searchManager!!.submit(point, 14, SearchOptions(), this)</span></span></code> </pre> <br><h4 id="poisk-po-uri">  Pesquisa por URI </h4><br><p>  Tudo est√° bem claro aqui - pegamos o URI do <code>URIObjectMetadata</code> , lembre-se, depois de um tempo entramos na pesquisa e, por esse URI, obtemos exatamente o objeto que lembramos. </p><br><pre> <code class="scala hljs">searchSession = searchManager!!.resolveURI(uri, <span class="hljs-type"><span class="hljs-type">SearchOptions</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)</code> </pre> <br><p>  De alguma forma, mesmo chato. </p><br><h2 id="poiskovyy-sloy-i-svetloe-buduschee">  Camada de pesquisa e futuro brilhante </h2><br><p>  Ao lado do <code>SearchManager</code> , ainda existe uma coisa chamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">camada de pesquisa</a> .  A camada foi concebida para combinar a pesquisa com o mapa.  Ele pr√≥prio sabe como adicionar resultados a ele, mover o mapa para que esses resultados sejam exibidos e fazer novas consultas quando o usu√°rio move o mapa.  De muitas maneiras, √© semelhante ao <code>SearchManager</code> e <code>Session</code> combinados, mas o trabalho <code>SearchManager</code> com o mapa adiciona novos recursos.  E falar sobre eles est√° al√©m do escopo deste artigo.  Na √©poca do lan√ßamento do MapKit 3.1, j√° t√≠nhamos percorrido a camada de pesquisa em aplicativos reais, para que voc√™ pudesse tentar us√°-lo em sua casa.  Talvez isso facilite seu trabalho de pesquisa. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ct/tg/g4/cttgg4rh3iffabd5xfm8fc6s_ha.jpeg" width="480"></div><br><h2 id="zaklyuchenie">  Conclus√£o </h2><br><p>  Espero que, depois de ler o artigo, voc√™ tenha uma compreens√£o de como trabalhar com a pesquisa no MapKit com for√ßa total.  Certamente ainda houve alguns momentos sutis e n√£o triviais (por exemplo, quase n√£o falamos sobre as dicas e a camada de pesquisa).  Algo pode ser encontrado na documenta√ß√£o, algo para esclarecer em projetos no GitHub ou pedir nosso apoio. </p><br><p>  Experimente o MapKit, use a pesquisa e acesse o Google <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Maps</a> para torn√°-lo ainda melhor! </p><br><p>  <strong>PS</strong> E tamb√©m nos visite em 29 de novembro para ouvir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">como o backend de roteamento automotivo √© organizado</a> .  Que, a prop√≥sito, tamb√©m pode ser usado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MapKit</a> , mas essa √© uma hist√≥ria completamente diferente. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt428564/">https://habr.com/ru/post/pt428564/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt428552/index.html">Algoritmo: Como encontrar a pr√≥xima permuta√ß√£o lexicogr√°fica</a></li>
<li><a href="../pt428556/index.html">‚ÄúO ambiente de produ√ß√£o est√° al√©m do seu controle‚Äù: Rian Lewis em testes de projetos de blockchain</a></li>
<li><a href="../pt428558/index.html">Como criei um assistente para WordPress a partir da minha profunda pregui√ßa</a></li>
<li><a href="../pt428560/index.html">An√∫ncio n√£o programado de sexta-feira</a></li>
<li><a href="../pt428562/index.html">Droidcon London. Como foi</a></li>
<li><a href="../pt428566/index.html">Fun√ß√µes da seta JavaScript: por que s√£o necess√°rias, como lidar com elas, quando us√°-las e quando n√£o</a></li>
<li><a href="../pt428568/index.html">Guia de desenvolvimento de aplicativos da Web nativos de rea√ß√£o</a></li>
<li><a href="../pt428570/index.html">Fun√ß√µes de ordem superior em JavaScript</a></li>
<li><a href="../pt428572/index.html">Componentes de ordem superior em React</a></li>
<li><a href="../pt428574/index.html">Eleve a comunica√ß√£o corporativa ao pr√≥ximo n√≠vel com o Zextras Chat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>