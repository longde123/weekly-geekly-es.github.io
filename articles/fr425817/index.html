<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👏🏻 👨🏿‍🤝‍👨🏾 ✡️ Glissez et déposez dans vos applications iOS 📪 🙏🏿 🏭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le mécanisme Drag & Drop fonctionnant sur iOS 11 et iOS 12 est un moyen de copier ou de déplacer graphiquement de manière asynchrone des données à la ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Glissez et déposez dans vos applications iOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/425817/"><img src="https://habrastorage.org/webt/gb/xu/dt/gbxudtvrfs8biaj5tlzkpjjjwe4.png"><br><br>  Le mécanisme <code>Drag &amp; Drop</code> fonctionnant sur <code>iOS 11</code> et <code>iOS 12</code> est un moyen de copier ou de déplacer graphiquement de manière asynchrone des données à la fois dans une seule application et entre différentes applications.  Bien que cette technologie ait environ 30 ans, elle est littéralement devenue une technologie «révolutionnaire» sur <code>iOS</code> raison du fait que lorsque vous faites glisser quelque chose sur <code>iOS</code> , le <code>multitouch</code> vous permet d'interagir librement avec le reste du système et de collecter des données à réinitialiser à partir de différentes applications. <br><a name="habracut"></a><br>  <code>iOS</code> permet de capturer plusieurs éléments à la fois.  De plus, ils n'ont pas besoin d'être dans une accessibilité pratique pour la sélection: vous pouvez prendre le premier objet, puis aller dans une autre application et saisir autre chose - tous les objets seront collectés en «pile» sous votre doigt.  Appelez ensuite le dock universel à l'écran, ouvrez-y n'importe quelle application et capturez le troisième objet, puis accédez à l'écran avec les applications en cours d'exécution et, sans libérer les objets, videz-les dans l'un des programmes ouverts.  Une telle liberté d'action est possible sur l' <code>iPad</code> , sur l' <code>iPhone</code> , la couverture <code>Drag &amp; Drop</code> dans <code>iOS</code> limitée au cadre d'une seule application. <br><br>  Les applications les plus populaires ( <code>Safary</code> , <code>Chrome</code> , <code>IbisPaint X</code> , <code>Mail</code> , <code>Photos</code> , <code>Files</code> , etc.) ont déjà un mécanisme <code>Drag &amp; Drop</code> .  En plus de cela, <code>Apple</code> fourni aux développeurs une <code>API</code> très simple et intuitive pour intégrer le mécanisme <code>Drag &amp; Drop</code> dans votre application.  Le mécanisme <code>Drag &amp; Drop</code> , tout comme les gestes, fonctionne sur <b><font color="#0000FF">UIView</font></b> et utilise le concept d' <b><font color="#0000FF">interactions</font></b> , un peu comme les gestes, de sorte que vous pouvez considérer le mécanisme <code>Drag &amp; Drop</code> comme un geste vraiment puissant. <br><br>  Il, ainsi que les gestes, est très facile à intégrer dans votre application.  Surtout si votre application utilise la table <b><font color="#0000FF">UITableView</font></b> ou la collection <b><font color="#0000FF">UICollectionView</font></b> , car pour eux <code>API Drag &amp; Drop</code> améliorée et élevée à un niveau d'abstraction supérieur dans le sens où la <code>Collection View</code> elle-même vous aide avec l' <b><font color="#0000FF">indexPath</font></b> de l'élément de collection que vous souhaitez faire glisser et déposer <code>Drag</code> .  Elle sait où se trouve votre doigt et l'interprète comme l' <b><font color="#0000FF">indexPath</font></b> de l'élément de collection que vous « <code>Drag</code> glisser» <code>Drag</code> en ce moment, ou comme l' <b><font color="#0000FF">indexPath</font></b> de l'élément de collection où vous «déposez» <code>Drop</code> quelque chose.  La <code>Collection View</code> vous fournit donc <b><font color="#0000FF">indexPath</font></b> , mais sinon c'est absolument la même <code>API Drag &amp; Drop</code> que pour une <b><font color="#0000FF">UIView standard</font></b> . <br><br>  Le processus <code>Drag &amp; Drop</code> sur <code>iOS</code> comporte 4 phases différentes: <br><br><h2>  Lift </h2><br>  <b>Lift</b> (levage) - c'est lorsque l'utilisateur effectue un geste de <b><font color="#FF00FF">pression longue</font></b> , indiquant l'élément qui sera «glisser-déposer».  À ce moment, un soi-disant « <code>lift preview</code> » très léger de l'élément indiqué est formé, puis l'utilisateur commence à faire glisser ses doigts. <br><br><img src="https://habrastorage.org/webt/t6/sw/tw/t6swtwdee7kasyvqq_od3ipzlxy.png" width="600" height="450"><br><br><h2>  Glisser (glisser-déposer) </h2><br>  <b>Glisser</b> (glisser-déposer) - c'est lorsque l'utilisateur déplace l'objet sur la surface de l'écran.  Au cours de cette phase, l' <code>lift preview</code> de cet objet peut être modifié (un signe «+» plus vert ou un autre signe apparaît) ... <br><br><img src="https://habrastorage.org/webt/07/yo/4x/07yo4x4yua4zelwculog6eng9aw.png" width="600" height="450"><br><br>  ... une certaine interaction avec le système est également autorisée: vous pouvez cliquer sur un autre objet et l'ajouter à la session "glisser-déposer" en cours: <br><br><img src="https://habrastorage.org/webt/yb/bx/wi/ybbxwiqe6-226ipfjmkzmpymkva.png" width="600" height="450"><br><br><h2>  Drop </h2><br>  <b>La chute</b> se produit lorsque l'utilisateur soulève un doigt.  À ce moment, deux choses peuvent se produire: soit l'objet <code>Drag</code> sera détruit, soit l'objet <code>Drop</code> sera «déposé» à la destination. <br><br><img src="https://habrastorage.org/webt/iv/b1/4z/ivb14zogie89jntnkfsxmuubvd0.png" width="600" height="450"><br><br><h2>  Transfert de données </h2><br>  Si le processus de <b>glisser</b> -déplacer n'a pas été annulé et que la réinitialisation de « <b>Drop</b> » a eu lieu, le <b>transfert de</b> données (transfert de données) se produit, auquel cas le «point de dépôt» demande des données à la «source», et le transfert de données asynchrone se produit. <br><br>  Dans ce didacticiel, nous allons vous montrer comment <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">intégrer</a> facilement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le</a> mécanisme <code>Drag &amp; Drop</code> dans votre application <code>iOS</code> à l'aide de l'application de démonstration Image Gallery, tirée <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">du cours de devoirs CS193P de Stanford</a> . <br>  Nous doterons la <code>Collection View</code> possibilité de nous remplir d'images EXTÉRIEURES, ainsi que de réorganiser les éléments INTÉRIEURS à l'aide du mécanisme <code>Drag &amp; Drop</code> .  En outre, ce mécanisme sera utilisé pour vider les éléments inutiles de la <code>Collection View</code> dans une «poubelle», qui est une vue <b><font color="#0000FF">UIV</font></b> normale et représentée par un bouton sur le panneau de navigation.  Nous pouvons également partager des images collectées dans notre galerie avec d'autres applications en utilisant le mécanisme <code>Drag &amp; Drop</code> , par exemple, <code>Notes</code> ou <code>Notes</code> ou <code>Mail</code> ou une photothèque ( <code>Photo</code> ). <br><br>  Mais avant de me concentrer sur l'implémentation du mécanisme <code>Drag &amp; Drop</code> dans l'application de démonstration «Image Gallery», je vais passer en revue ses principaux composants très brièvement. <br><br><h1>  Fonctionnalités de l'application de démonstration "Image Gallery" </h1><br>  L'interface utilisateur ( <code>UI</code> ) de l'application Image Gallery est très simple.  Il s'agit d'un «extrait d'écran» du <code>Image Gallery Collection View Controller</code> affichage de la <code>Image Gallery Collection View Controller</code> inséré dans le <code>Navigation Controller</code> : <br><br><img src="https://habrastorage.org/webt/rz/gl/o6/rzglo69owhktzl8vcstcosf5rdi.png"><br><br>  La partie centrale de l'application est certainement <code>Image Gallery Collection View Controller</code> , qui est prise en charge par la classe <b><font color="#0000FF">ImageGalleryCollectionViewController</font></b> avec le modèle de galerie d'images en tant que variable <b><font color="#0000FF">var imageGallery = ImageGallery ()</font></b> : <br><br><img src="https://habrastorage.org/webt/na/f2/1r/naf21rpv6pxjnht1bk02mowhgoi.png"><br><br>  Le modèle est représenté par une <b><font color="#0000FF">structure struct ImageGallery</font></b> contenant un tableau d'images <b><font color="#0000FF">images</font></b> , dans laquelle chaque image est décrite par une <b><font color="#0000FF">structure struct ImageModel</font></b> contenant l' <code>URL</code> localisation <code>URL</code> image (nous <b><font color="#0000FF">n'allons</font></b> pas stocker l'image elle-même) et son rapport d'aspect: <br><br><img src="https://habrastorage.org/webt/bp/0b/6_/bp0b6_kh3bgocgc4zlnjrocmk2q.png"><br><br>  Notre <b><font color="#0000FF">ImageGalleryCollectionViewController</font></b> implémente le protocole <b><font color="#0000FF">DataSource</font></b> : <br><br><img src="https://habrastorage.org/webt/ka/vr/gj/kavrgjqaraoqv4sva-aqhffwvhu.png"><br><br>  La cellule personnalisée de la collection de cellules contient une image <b><font color="#0000FF">imageView: UIImageView!</font></b>  et indicateur d'activité de <b><font color="#0000FF">spinner: UIActivityIndicatorView!</font></b>  et est pris en charge par la <code>subclass</code> personnalisée <b><font color="#0000FF">ImageCollectionViewCell de la</font></b> classe <b><font color="#0000FF">UICollectionViewCell</font></b> : <br><br><img src="https://habrastorage.org/webt/cu/hs/1l/cuhs1ljdvbara4u2_ndq3y_sfxw.png"><br><br>  <code>Public API</code> de la classe <b><font color="#0000FF">ImageCollectionViewCell</font></b> est l' <b><font color="#0000FF">URL de l'</font></b> image <b><font color="#0000FF">imageURL</font></b> .  Dès que nous l'installons, notre <code>UI</code> mise à jour, c'est-à-dire que les données de l'image sont sélectionnées de manière asynchrone sur cette <b><font color="#0000FF">imageURL</font></b> et affichées dans la cellule.  Pendant que les données sont extraites du réseau, l'indicateur d'activité de <b><font color="#0000FF">spinner</font></b> fonctionne, indiquant que nous sommes en train de récupérer des données. <br><br>  J'utilise la file d'attente globale <b><font color="#0000FF">(qos: .userInitiated)</font></b> avec l' <b><font color="#0000FF">argument de</font></b> qualité de service <b><font color="#0000FF">qos</font></b> pour obtenir des données à une <code>URL</code> donnée, qui est définie sur <b><font color="#0000FF">.userInitiated</font></b> , car je sélectionne les données à la demande de l'utilisateur: <br><br><img src="https://habrastorage.org/webt/0q/aq/2-/0qaq2-uakbn1zou8ilh7pcvysxy.png"><br><br>  Chaque fois que vous utilisez vos propres variables à l'intérieur d'une fermeture, dans notre cas c'est <b><font color="#0000FF">imageView</font></b> et <b><font color="#0000FF">imageURL</font></b> , le compilateur vous oblige à vous mettre devant elles <b><font color="#0000FF">.</font></b>  de sorte que vous vous demandez: "Y a-t-il un" lien cyclique mémoire "?"  Nous n'avons pas ici de « <code>memory cycle</code> » explicite, car le <b><font color="#0000FF">soi</font></b> lui-même n'a pas de pointeur sur cette fermeture. <br><br>  Cependant, dans le cas du multithreading, vous devez garder à l'esprit que les <b><font color="#0000FF">cellules</font></b> de la <code>Collection View</code> sont réutilisables grâce à la méthode <b><font color="#0000FF">dequeueReusableCell</font></b> .  Chaque fois qu'une cellule (nouvelle ou réutilisée) apparaît à l'écran, l'image est téléchargée du réseau de manière asynchrone (à ce moment le « <b><font color="#0000FF">spinner</font></b> » de l'indicateur d'activité de <b><font color="#0000FF">spinner</font></b> tourne). <br><br>  Dès que le téléchargement est terminé et que l'image est reçue, l' <code>UI</code> cette cellule de collecte est mise à jour.  Mais nous n'attendons pas que l'image se charge, nous continuons à faire défiler la collection et la cellule de collection que nous avons marquée quitte l'écran sans mettre à jour notre <code>UI</code> .  Cependant, une nouvelle image devrait apparaître ci-dessous et la même cellule qui a quitté l'écran sera réutilisée, mais pour une autre image, qui peut rapidement charger et mettre à jour l' <code>UI</code> .  À ce moment, le chargement de l'image précédemment démarré dans cette cellule reviendra et l'écran sera mis à jour, ce qui conduira à un résultat incorrect.  C'est parce que nous exécutons différentes choses qui fonctionnent avec le réseau dans différents threads.  Ils reviennent à des moments différents. <br><br>  Comment pouvons-nous régler la situation? <br>  Dans le cadre du mécanisme <b><font color="#0000FF">GCD</font></b> que nous utilisons, nous ne pouvons pas annuler le téléchargement de l'image de la cellule qui a quitté l'écran, mais nous pouvons, lorsque nos données <b><font color="#0000FF">imageData arrivent</font></b> du réseau, vérifier l' <code>URL</code> <b><font color="#0000FF">URL</font></b> qui a provoqué le chargement de ces données et la comparer avec celle que l'utilisateur souhaite avoir dans cette cellule pour le moment, c'est-à-dire <b><font color="#0000FF">imageURL</font></b> .  S'ils ne correspondent pas, nous ne mettrons pas à jour la cellule d' <code>UI</code> et n'attendrons pas les données d'image dont nous avons besoin: <br><br><img src="https://habrastorage.org/webt/01/xl/-v/01xl-vqsde3rlqyus1f7tksacja.png"><br><br>  Cette ligne de code apparemment absurde <b><font color="#0000FF">url == self.imageURL</font></b> fait tout fonctionner correctement dans un environnement multi-thread qui nécessite une imagination non standard.  Le fait est que certaines choses dans la programmation multi-thread se produisent dans un ordre différent de celui écrit. <br><br>  S'il n'a pas été possible de sélectionner les données d'image, une image est générée avec un message d'erreur sous la forme de la chaîne «Erreur» et un emoji avec «froncer les sourcils».  Juste l'espace vide dans notre <code>Collection View</code> peut dérouter un peu l'utilisateur: <br><br><img src="https://habrastorage.org/webt/7m/zh/dt/7mzhdt1eo0tedkkrolp6osiidhu.png"><br><br>  Nous ne voudrions pas que l'image avec le message d'erreur répète <b><font color="#0000FF">aspectRatio de</font></b> cette image d'erreur, car dans ce cas, le texte avec les emoji sera étiré ou compressé.  Nous aimerions qu'il soit neutre - carré, c'est-à-dire qu'il aurait un rapport d'aspect proche de 1,0. <br><br><img src="https://habrastorage.org/webt/7b/rj/ve/7brjvesx81juxpsgnkevsnvge_u.png"><br><br>  Nous devons informer notre <code>Controller</code> de ce souhait afin qu'il corrige le rapport d'aspect <b><font color="#0000FF">aspectRatio</font></b> pour l' <b><font color="#0000FF">indexPath</font></b> correspondant dans son modèle <b><font color="#0000FF">imageGallery</font></b> .  C'est une tâche intéressante, il existe de nombreuses façons de la résoudre, et nous choisirons la plus simple d'entre elles - en utilisant la fermeture <b><font color="#0000FF">facultative</font></b> <b><font color="#0000FF">var closAspectRatio: (() -&gt; Void)?</font></b>  .  Il peut être égal à <b><font color="#0000FF">zéro</font></b> et n'a pas besoin d'être installé si cela n'est pas nécessaire: <br><br><img src="https://habrastorage.org/webt/8v/5q/wy/8v5qwyzl2_-dju1qfotj7i9nem4.png"><br><br>  Lors de l'appel de la fermeture <b><font color="#0000FF">changeAspectRatio? ()</font></b> En cas de récupération de données erronées, j'utilise la chaîne <b><font color="#0000FF">facultative</font></b> .  Désormais, toute personne intéressée par certains types de paramètres lors de la réception d'une image erronée peut définir cette fermeture sur quelque chose de spécifique.  Et c'est exactement ce que nous faisons dans notre <code>Controller</code> dans la méthode <b><font color="#0000FF">cellForItemAt</font></b> : <br><br><img src="https://habrastorage.org/webt/uv/ee/mi/uveemimakh506que35eaasanjbi.png"><br><br>  Les détails peuvent être trouvés <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Pour afficher les images avec le bon <b><font color="#0000FF">aspectRatio</font></b> , la méthode <b><font color="#0000FF">sizeForItemAt du</font></b> délégué <b><font color="#0000FF">UICollectionViewDelegateFlowLayout</font></b> est <b><font color="#0000FF">utilisée</font></b> : <br><br><img src="https://habrastorage.org/webt/ys/v7/nz/ysv7nzh7rus7hnowtqyocbevwai.png"><br><br>  En plus de la <code>Collection View</code> images <code>Collection View</code> , sur notre <code>UI</code> nous avons placé un <code>Bar Button</code> sur le panneau de navigation avec une image <b><font color="#0000FF">GarbageView</font></b> personnalisée contenant une «poubelle» comme sous- <b><font color="#0000FF">vue</font></b> : <br><br><img src="https://habrastorage.org/webt/1h/eo/uu/1heouudwoicj6qyjrckscada9ug.png"><br><br>  Dans cette figure, les couleurs d'arrière-plan pour <b><font color="#0000FF">GarbageView</font></b> lui-même et le bouton <b><font color="#0000FF">UIButton</font></b> avec l'image de la «poubelle» (en fait, il y a un arrière-plan transparent) sont spécialement modifiés pour que vous voyiez que l'utilisateur qui «décharge» les images de la galerie dans la «poubelle» beaucoup plus de marge de manœuvre lors du "drop" <b>Drop</b> que l'icône de la poubelle. <br>  La classe <b><font color="#0000FF">GarbageView a</font></b> deux initialiseurs et tous deux utilisent la méthode <b><font color="#0000FF">setup ()</font></b> : <br><br><img src="https://habrastorage.org/webt/xj/_t/es/xj_tesvqnjlk9yxbxnrvrvc_6w8.png"><br><br>  Dans la méthode <b><font color="#0000FF">setup ()</font></b> , j'ajoute également <b><font color="#0000FF">myButton en</font></b> tant que sous- <b>vue</b> avec l'image de la «poubelle» prise à partir du <code>Bar Button</code> standard du <code>Bar Button</code> : <br><br><img src="https://habrastorage.org/webt/if/s5/3c/ifs53cvfeaggqwtrlshju1g5qwc.png"><br><br>  J'ai défini un arrière-plan transparent pour <b><font color="#0000FF">GarbageView</font></b> : <br><br><img src="https://habrastorage.org/webt/g_/9y/af/g_9yafe1tu_pz4vx6_wan3tarv0.png"><br><br>  La taille de la poubelle et sa position seront déterminées dans la méthode <b><font color="#0000FF">layoutSubviews ()</font></b> de la classe <b><font color="#0000FF">UIView</font></b> , en fonction des <b><font color="#0000FF">limites de l'</font></b> <b><font color="#0000FF">UIView</font></b> donnée: <br><br><img src="https://habrastorage.org/webt/zf/ll/jb/zflljbnvhfenkfx0o2ge8iy2q2k.png"><br><br>  Il s'agit de la version initiale de l'application de démonstration "Image Gallery", elle se trouve sur <b><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Github</a></code></b> dans le dossier <u><code>ImageGallery_beginning</code></u> .  Si vous exécutez cette version de l'application «Galerie d'images», vous verrez le résultat de l'application travaillant sur les données de test, que nous supprimerons ensuite et remplirons la «Galerie d'images» exclusivement À L'EXTÉRIEUR: <br><br><img src="https://habrastorage.org/webt/w9/jn/y4/w9jny4yxwtmeemq8cqkqhbirvoy.png"><br><br>  Le plan de mise en œuvre du mécanisme <code>Drag &amp; Drop</code> dans notre application est le suivant: <br><br><ol><li>  tout d'abord, nous doterons notre <code>Collection View</code> possibilité de «faire glisser» des images <b><font color="#0000FF">UIImage depuis</font></b> et vers l'extérieur, </li><li>  Ensuite, nous apprendrons à notre collection d'images <code>Collection View</code> à accepter le glisser- <code>Drag</code> «externe» ou local de <b><font color="#0000FF">UIImage</font></b> , </li><li>  nous apprendrons également à notre <b><font color="#0000FF">GarbageView</font></b> avec le bouton poubelle pour accepter les images <b><font color="#0000FF">UIImage glissées</font></b> de la <code>Collection View</code> locale et les supprimer de la <code>Collection View</code> </li></ol><br><br>  Si vous allez à la fin de ce didacticiel et effectuez toutes les modifications de code nécessaires, vous recevrez la version finale de l'application de démonstration «Image Gallery», dans laquelle le mécanisme <code>Drag &amp; Drop</code> a été implémenté.  Il se trouve sur <b><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Github</a></code></b> dans le dossier <u><code>ImageGallery_finished</code></u> . <br><br>  Les performances du mécanisme <code>Drag &amp; Drop</code> dans votre <code>Collection View</code> fournies par deux nouveaux délégués. <br>  Les méthodes <u>du premier délégué, <b><font color="#0000FF">dragDelegate</font></b> , sont</u> configurées pour initialiser et personnaliser les drag and drop <code>Drags</code> . <br>  Les méthodes du deuxième délégué, <b><font color="#0000FF">dropDelegate</font></b> , complètent le glisser-déposer de <code>Drags</code> et, fondamentalement, fournissent le <code>Data transfer</code> données et les paramètres d'animation personnalisés lorsque <code>Drop</code> réinitialisé, ainsi que d'autres choses similaires. <br><br>  Il est important de noter que ces deux protocoles sont complètement indépendants.  Vous pouvez utiliser l'un ou l'autre protocole si vous avez seulement besoin de «glisser» <code>Drag</code> ou seulement «déposer» <code>Drop</code> , mais vous pouvez utiliser les deux protocoles à la fois et simultanément <code>Drag</code> -déposer <code>Drag</code> et «déposer» <code>Drop</code> , ce qui ouvre des fonctionnalités supplémentaires Mécanisme <code>Drag &amp; Drop</code> pour réorganiser les éléments de votre <code>Collection View</code> . <br><br><h1>  Faites glisser et <code>Drag</code> éléments de <code>Drag</code> <code>Collection View</code> </h1><br>  L'implémentation du protocole <code>Drag</code> est très simple, et la première chose que vous devez toujours faire est de vous définir vous- <b><font color="#0000FF">même</font></b> en tant que délégué <b><font color="#0000FF">dragDelegate</font></b> : <br><br><img src="https://habrastorage.org/webt/mt/jw/dq/mtjwdqjahnvyzwjd0hz9cra47mg.png"><br><br>  Et, bien sûr, tout en haut de la classe <b><font color="#0000FF">ImageGalleryCollectionViewController,</font></b> vous devez dire «Oui», nous implémentons le protocole <b><font color="#0000FF">UICollectionViewDragDelegate</font></b> : <br><br><img src="https://habrastorage.org/webt/ie/ue/xv/ieuexvbtxfan-uouzv4cvxpjw20.png"><br><br>  Dès que nous faisons cela, le compilateur commence à "se plaindre", nous cliquons sur le cercle rouge et on nous demande: "Voulez-vous ajouter les méthodes requises du protocole <b><font color="#0000FF">UICollectionViewDragDelegate</font></b> ?" <br>  Je réponds: "Bien sûr que je veux!"  et cliquez sur le bouton <code>Fix</code> : <br><br><img src="https://habrastorage.org/webt/6d/24/it/6d24itltj_buh2uwe3fbgkh8my8.png"><br><br>  La seule méthode requise du protocole <b><font color="#0000FF">UICollectionViewDragDelegate</font></b> est la méthode <b><font color="#0000FF">itemsForBeginning</font></b> , qui indiquera au système <code>Drag</code> que nous « <b><font color="#0000FF">glissons</font></b> - <b><font color="#0000FF">déposons</font></b> ».  La méthode <b><font color="#0000FF">itemsForBeginning est</font></b> appelée lorsque l'utilisateur commence à "faire glisser" ( <code>Dragging</code> ) une cellule dans la <b><font color="#0000FF">cellule de</font></b> collection. <br><br>  Notez que dans cette méthode, la <code>Collection View</code> a ajouté <b><font color="#0000FF">indexPath</font></b> .  Cela nous dira quel élément de la collection, quel <b><font color="#0000FF">indexPath</font></b> , nous allons «glisser-déposer».  C'est vraiment très pratique pour nous, car c'est l'application qui est responsable de l'utilisation des arguments <b><font color="#0000FF">session</font></b> et <b><font color="#0000FF">indexPath</font></b> pour <b><font color="#0000FF">comprendre</font></b> comment gérer ce glisser-déposer de <code>Drag</code> . <br><br>  Si le tableau <b><font color="#0000FF">[UIDragItems] des</font></b> éléments « <b><font color="#0000FF">draggable</font></b> » est retourné, le «drag» du <code>Drag</code> initialisé, si le tableau vide <b><font color="#0000FF">[] est</font></b> retourné, le «drag» du <code>Drag</code> ignoré. <br><br>  Je vais créer une petite fonction <b><font color="#0000FF">dragItems</font></b> <b><font color="#0000FF">privée</font></b> <b><font color="#0000FF">(at: indexPath)</font></b> avec l'argument <b><font color="#0000FF">indexPath</font></b> .  Il renvoie le tableau <b><font color="#0000FF">[UIDragItem] dont</font></b> nous avons <b><font color="#0000FF">besoin</font></b> . <br><br><img src="https://habrastorage.org/webt/_y/iv/86/_yiv869sqaamn_ytg22fg89iez0.png"><br><br>  À quoi ressemble un <b><font color="#0000FF">UIDragItem</font></b> par glisser-déposer? <br>  Il n'a qu'une chose très IMPORTANTE appelée <b><font color="#0000FF">itemProvider</font></b> .  <b><font color="#0000FF">itemProvider</font></b> est juste quelque chose qui peut fournir des données qui seront glissées. <br><br>  Et vous avez le droit de demander: "Qu'en est-il du" glisser-déposer "d'un élément <b><font color="#0000FF">UIDragItem</font></b> qui n'a tout simplement pas de données?"  L'élément que vous souhaitez faire glisser peut ne pas contenir de données, par exemple, car la création de ces données est une opération coûteuse.  Il peut s'agir d'une image ou de quelque chose qui nécessite le téléchargement de données depuis Internet.  La grande chose est que l'opération <code>Drag &amp; Drop</code> est complètement asynchrone.  Lorsque vous commencez à faire glisser et <code>Drag</code> , c'est vraiment un objet très léger ( <code>lift preview</code> ), vous le faites glisser partout et rien ne se passe pendant ce "glisser".  Mais dès que vous «déposez» <code>Drop</code> quelque part votre objet, puis, en tant que <b><font color="#0000FF">fournisseur</font></b> d' <b><font color="#0000FF">articles</font></b> , il doit vraiment fournir à votre objet «traîné» et «lancé» des données réelles, même si cela prend un certain temps. <br><br>  Heureusement, il existe de nombreux <b><font color="#0000FF">fournisseurs d'éléments intégrés</font></b> .  Ce sont des classes qui existent déjà dans <code>iOS</code> et qui sont des <b><font color="#0000FF">itemPoviders</font></b> , comme, par exemple, <code>NSString</code> , qui vous permet de faire glisser et déposer du texte sans polices.  Bien sûr, il s'agit d'une image <b><font color="#0000FF">UIImage</font></b> .  Vous pouvez sélectionner et faire glisser et déposer des images <b><font color="#0000FF">UIImages tout au long</font></b> .  La classe <b><font color="#0000FF">NSURL</font></b> , ce qui est absolument merveilleux.  Vous pouvez accéder à la page <code>Web</code> , sélectionner l' <code>URL</code> et la «déposer» où vous le souhaitez.  Cela peut être un lien vers un article ou une <code>URL</code> pour une image, comme ce sera le cas dans notre démo.  Ce sont les classes de couleurs de <b><font color="#0000FF">UIColor</font></b> , l' <b><font color="#0000FF">élément de</font></b> carte <b><font color="#0000FF">MKMapItem, le</font></b> contact <b><font color="#0000FF">CNContact</font></b> depuis le carnet d'adresses, vous pouvez sélectionner et faire glisser beaucoup de choses.  Tous sont des <b><font color="#0000FF">fournisseurs d'articles</font></b> . <br><br>  Nous allons «glisser-déposer» l'image <b><font color="#0000FF">UIImage</font></b> .  Il est situé dans la cellule de la cellule <code>Collection View</code> avec <b><font color="#0000FF">indexPath</font></b> , ce qui m'aide à sélectionner la cellule de <b><font color="#0000FF">cellule</font></b> , à en extraire l'image <code>Outlet</code> et à obtenir son <b><font color="#0000FF">image</font></b> . <br><br>  Exprimons cette idée avec quelques lignes de code. <br>  Tout d'abord, je demande ma <code>Collection View</code> sur une <b><font color="#0000FF">cellule</font></b> pour l'élément <b><font color="#0000FF">item</font></b> correspondant à cet <b><font color="#0000FF">indexPath</font></b> . <br><br><img src="https://habrastorage.org/webt/ho/zi/gp/hozigp41-y0-3cfa525umwojyu4.png"><br><br>  La <b><font color="#0000FF">méthode cellForItem (at: IndexPath)</font></b> pour la <code>Collection View</code> ne fonctionne que pour les cellules visibles, mais, bien sûr, cela fonctionnera dans notre cas, car je «fais glisser-déposer» l'élément de collection <code>Drag</code> à l'écran et il est visible. <br><br>  Donc, j'ai obtenu une cellule de <b><font color="#0000FF">cellule</font></b> "déplaçable". <br>  Ensuite, j'utilise l'opérateur <b><font color="#0000FF">as?</font></b>  à cette cellule afin qu'elle ait un TYPE de ma <code>subclass</code> personnalisée.  Et si cela fonctionne, je reçois une image <code>Outlet</code> , à partir de laquelle je prends son <b><font color="#0000FF">image</font></b> .  Je viens de «capturer» l'image de l' <b><font color="#0000FF">image</font></b> pour cet <b><font color="#0000FF">indexPath</font></b> . <br><br>  Maintenant que j'ai une image, je n'ai plus qu'à créer l'un de ces <b><font color="#0000FF">UIDragItems en</font></b> utilisant l'image résultante comme <b><font color="#0000FF">itemProvider</font></b> , c'est-à-dire la chose qui nous fournit les données. <br>  Je peux créer <b><font color="#0000FF">dragItem en</font></b> utilisant le constructeur <b><font color="#0000FF">UIDragItem</font></b> , qui prend <b><font color="#0000FF">itemProvider</font></b> comme argument: <br><br><img src="https://habrastorage.org/webt/to/zb/gt/tozbgtxocfrgoaqofvn9jgf9yeo.png"><br><br>  Ensuite, nous créons un <b><font color="#0000FF">itemProvider</font></b> pour l'image <b><font color="#0000FF">image en</font></b> utilisant également le constructeur <b><font color="#0000FF">NSItemProvider</font></b> .  Il existe plusieurs constructeurs pour <b><font color="#0000FF">NSItemProvider</font></b> , mais parmi eux il y en a un vraiment merveilleux - <b><font color="#0000FF">NSItemProvider (objet: NSItemProviderWriting)</font></b> : <br><br><img src="https://habrastorage.org/webt/ey/21/cq/ey21cq0iq5riml7pfrye4gcnmi8.png"><br><br>  Vous donnez simplement l'objet <b><font color="#0000FF">objet à</font></b> ce constructeur <b><font color="#0000FF">NSItemProvider</font></b> , et il sait comment en faire <b><font color="#0000FF">itemProvider</font></b> .  En tant que tel <b><font color="#0000FF">objet,</font></b> je donne à l'image l'image que j'ai reçue de la <b><font color="#0000FF">cellule</font></b> et j'obtiens <b><font color="#0000FF">itemProvider</font></b> pour <b><font color="#0000FF">UIImage</font></b> . <br>  Et c'est tout.  Nous avons créé <b><font color="#0000FF">dragItem</font></b> et devons le renvoyer comme un tableau ayant un élément. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais avant mon retour </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , je vais faire une chose, à </font><font style="vertical-align: inherit;">savoir, pour définir la variable </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , égale à l'image résultante l' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><img src="https://habrastorage.org/webt/sh/h0/cz/shh0czt4sxjd7ienvsl2slz8yju.png"><br><br>  Qu'est-ce que cela signifie? <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous effectuez un «glisser-déposer» </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localement, c'est-à-dire à l'intérieur de votre application, vous n'avez pas besoin de parcourir tout ce code associé à </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemProvider</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , par une récupération de données asynchrone. Vous n'avez pas besoin de le faire, il vous suffit de prendre </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et de l'utiliser. Il s'agit d'une sorte de «court-circuit» avec «glisser-déposer» local </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le code que nous avons écrit fonctionnera lors du «glissement» </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hors de notre collection </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vers d'autres applications, mais si nous « </font><b><font color="#0000FF"><font style="vertical-align: inherit;">glissons</font></font></b><font style="vertical-align: inherit;"> » </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localement, nous pouvons utiliser </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ensuite, je retourne un tableau d'un élément </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soit dit en </font><font style="vertical-align: inherit;">passant, si je ne pouvais pas obtenir pour une raison quelconque l' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour cette cellule </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cellule</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , je retourne un </font><font style="vertical-align: inherit;">tableau vide </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[]</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cela signifie que le « glisser » </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est annulée. </font></font><br><br><img src="https://habrastorage.org/webt/4b/uk/o3/4buko3fve2swk7wr7d_oy5sflma.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En plus de l' </font><font style="vertical-align: inherit;">objet local </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , vous pouvez vous rappeler le contexte local </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour notre </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">session de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la session</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dans notre cas , </font><font style="vertical-align: inherit;">ce sera une collection de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CollectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et il est utile de nous après: </font></font><br><br><img src="https://habrastorage.org/webt/o_/gi/tk/o_gitkbwnnbcevnxwcwm6obckwk.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avoir « glisser-déposer » </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, vous pouvez ajouter plus d' </font><font style="vertical-align: inherit;">articles </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">articles</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à ce « glisser-déposer », juste faire le geste </font></font><b><font color="#FF00FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tap</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur eux. En conséquence, vous pouvez faire glisser</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de nombreux éléments à la fois. Et cela est facile à implémenter avec une autre </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">méthode</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> déléguée </font><font style="vertical-align: inherit;">, </font><b><font color="#0000FF"><font style="vertical-align: inherit;">UICollectionViewDragDelegate</font></font></b><font style="vertical-align: inherit;"> , très similaire à la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemsForeginning</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , une méthode nommée </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemsForAddingTo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . La méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemsForAddingTo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ressemble exactement à la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemsForeginning</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et renvoie exactement la même chose, car elle nous donne également un </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath de</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ce que l'utilisateur a «enregistré» pendant le processus de «glisser </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">déposer» </font><font style="vertical-align: inherit;">, et j'ai juste besoin de récupérer l' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la cellule sur que l'utilisateur a «enregistré» et le retourner. </font></font><br><br><img src="https://habrastorage.org/webt/u-/hc/9d/u-hc9dnk3001qhkra-et6oycphi.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Renvoie un tableau vide </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[] à</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partir de la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemsForAddingTo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conduit au fait que le geste de </font></font><b><font color="#FF00FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tapotement</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera interprété de la manière habituelle, c'est-à-dire comme le choix de cette cellule </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cellulaire</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et c'est tout ce dont nous avons besoin pour glisser-déposer </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous lançons l'application. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je sélectionne l'image "Venise", la maintiens pendant un moment et commence à bouger ... </font></font><br><br><img src="https://habrastorage.org/webt/p7/ne/9z/p7ne9zdwnirsf2uxjogvflrqwao.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... et nous pouvons vraiment faire glisser cette image dans l'application </font></font><code>Photos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, comme vous voyez le signe plus vert "+" dans le coin supérieur gauche de l'image "glissable". Je peux effectuer un geste de </font></font><b><font color="#FF00FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toucher</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur une autre image Artika de la collection </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... </font></font><br><br><img src="https://habrastorage.org/webt/cg/sj/om/cgsjomxtwxyzqxg-wxvqxz4huqi.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... et maintenant nous pouvons déposer deux images dans l'application </font></font><code>Photos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br><br><img src="https://habrastorage.org/webt/bk/xk/ud/bkxkud6ggdorw2d1yayjmatnsf4.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Puisque le </font></font><code>Photos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mécanisme est déjà intégré </font><font style="vertical-align: inherit;">dans l'application</font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alors tout fonctionne très bien et c'est cool. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Donc, le "glisser </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-déposer </font><font style="vertical-align: inherit;">" </font><font style="vertical-align: inherit;">et le "dumping" de l' </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image </font><font style="vertical-align: inherit;">de la </font><font style="vertical-align: inherit;">Galerie dans d'autres applications </font><font style="vertical-align: inherit;">fonctionnent pour moi </font><font style="vertical-align: inherit;">, je n'ai pas eu à faire grand-chose dans mon application, sauf pour livrer l' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sous forme de tableau </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[UIDragItem]</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">C'est l'une des nombreuses fonctionnalités intéressantes du mécanisme </font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- il est très facile de le faire fonctionner dans les deux sens.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Réinitialiser les </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">images à la collection</font></font><code>Collection View</code> </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, nous devons créer une </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">partie pour ma collection </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">afin que nous puissions «vider» </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toutes les images «glissées» À L'INTÉRIEUR de cette collection. Une image «déplaçable» peut «provenir» DE L'EXTÉRIEUR ou directement À L'INTÉRIEUR de cette collection. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour ce faire, nous faisons la même chose fait de déléguer </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragDelegate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , à </font><font style="vertical-align: inherit;">savoir nous faire, </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'auto</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , délégué </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dropDelegate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans la méthode de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'viewDidLoad</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/5q/wv/mf/5qwvmfjuyh74sfxzwcw7_0gikec.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encore une </font><font style="vertical-align: inherit;">fois, il faut monter au sommet de notre classe </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageGalleryCollectionViewController</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et de </font><font style="vertical-align: inherit;">vérifier l' </font><font style="vertical-align: inherit;">application du </font><font style="vertical-align: inherit;">Protocole </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UICollectionViewDropDelegate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><img src="https://habrastorage.org/webt/wc/ww/7p/wcww7pgfia3xxwe63teews1e9de.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dès que nous avons ajouté notre nouveau protocole, le compilateur a de nouveau commencé à «se plaindre» que nous n'avions pas implémenté ce protocole. Nous cliquons sur le bouton </font></font><code>Fix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et les méthodes requises de ce protocole apparaissent devant nous. Dans ce cas, nous sommes informés que nous devons implémenter la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/ll/9t/k4/ll9tk4goht7nfa-gnifnq8iaoto.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous devons le faire, sinon une «réinitialisation» ne se produira pas </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. En fait, je vais implémenter la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop en</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dernier, car il existe quelques autres </font></font><code>Apple</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">méthodes </font><font style="vertical-align: inherit;">hautement recommandées </font><font style="vertical-align: inherit;">que vous devez implémenter pour la </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pièce. C'est </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canHandle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dropSessionDidUpdate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><img src="https://habrastorage.org/webt/jd/ce/ve/jdcevehobhr1k7wwvc1iaem-w80.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si nous mettons en </font><font style="vertical-align: inherit;">œuvre ces deux méthodes, nous pouvons obtenir un peu de </font><font style="vertical-align: inherit;">billets verts signe plus « + » quand nous traînons et des </font><font style="vertical-align: inherit;">images de chute de l'extérieur de notre collection </font></font><code>ollection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et en plus, nous ne tenterons pas de vider ce que nous ne comprenons pas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implémentons </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canHandle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nous devons vous pouvez </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utiliser la version de la</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> méthode </font><b><font color="#0000FF"><font style="vertical-align: inherit;">canHandle</font></font></b><font style="vertical-align: inherit;"> , qui est destinée à la collecte </font></font><code>ollection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais cette méthode </font></font><code>ollection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ressemble exactement à la méthode similaire pour </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> normal </font><font style="vertical-align: inherit;">, il n'y a pas d' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath là</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><b><font color="#0000FF"><font style="vertical-align: inherit;">bas</font></font></b><font style="vertical-align: inherit;"> , nous avons juste besoin de retourner </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">session.canLoadObjects (ofClass: UIImage.self)</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et cela signifie que j'accepte le "reset" des objets de ce cl PAS dans ma collection </font></font><code>ollection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><img src="https://habrastorage.org/webt/0j/tz/ze/0jtzzen649jj7z58-3tiq_ehrvs.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais cela ne suffit pas pour "vider" l' </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image dans ma collection </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXTÉRIEUR. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si le « reset » </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'image se déroule dans la collection </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, l'utilisateur réorganise ses propres éléments d' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éléments</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à travers le mécanisme </font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, alors qu'une seule image </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une UIImage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et la </font><font style="vertical-align: inherit;">mise en </font><font style="vertical-align: inherit;">œuvre de la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canHandle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ressemblera à </font><font style="vertical-align: inherit;">de la manière ci - </font><font style="vertical-align: inherit;">dessus. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais si le «dumping» de l' </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image se produit À L'EXTÉRIEUR, alors nous ne devrions gérer que le «glisser-déposer» </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui est l'image </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIImage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cette image, car nous </font><b><font color="#0000FF"><font style="vertical-align: inherit;">n'allons</font></font></b><font style="vertical-align: inherit;"> pas stocker </font><b><font color="#0000FF"><font style="vertical-align: inherit;">directement les</font></font></b><font style="vertical-align: inherit;"> images </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIImage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans le modèle. Dans ce cas, je </font><font style="vertical-align: inherit;">ne </font><font style="vertical-align: inherit;">retournerai </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canHandle que</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si deux conditions sont remplies en même temps </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: session.canLoadObjects (ofClass: NSURL.self) &amp;&amp; session.canLoadObjects (ofClass: UIImage.self)</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/yj/dt/qn/yjdtqnmmxq0olgilbz1ifa5mdt8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">je dois déterminer si j'ai affaire à une «réinitialisation» À L'EXTÉRIEUR OU À L'INTÉRIEUR. Je vais le faire en utilisant la constante calculée </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isSelf</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pour le calcul de laquelle je peux utiliser une telle chose dans une </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">session de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">session</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comme sa </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">session </font><font style="vertical-align: inherit;">locale </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localDragSession</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Cette </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">session </font><font style="vertical-align: inherit;">locale </font><font style="vertical-align: inherit;">à son tour a un contexte local </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous vous souvenez, nous définissons ce contexte local dans la méthode</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemsForBeginning</font></font></font></b> <code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> délégué</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UICollectionViewDragDelegate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font><b><font color="#0000FF"><font style="vertical-align: inherit;"> J'examinerai</font></font></b></font><br><br><img src="https://habrastorage.org/webt/o_/gi/tk/o_gitkbwnnbcevnxwcwm6obckwk.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> le contexte local</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> localContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour l'égalité de ma collection</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Vrai, TYPE de</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> localContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Any</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et je dois faire un transtypage de TYPE</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Any en</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilisant l'opérateur</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> as? UICollectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><img src="https://habrastorage.org/webt/kc/zk/nt/kczknt6xiau08k5d06xu40akoyu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si le contexte local</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (session.localDragSession? .LocalContext as? UICollectionView)</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est égal à ma collection</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , alors la variable calculée</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> isSelf</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vraie</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et il y a une «réinitialisation» locale À L'INTÉRIEUR de ma collection. Si cette égalité est violée, alors nous avons affaire à une "réinitialisation" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">À L'EXTÉRIEUR. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canHandle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indique que nous ne pouvons gérer que ce type de «glisser-déposer» </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur notre collection </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Sinon, plus loin, cela n'a aucun sens de parler de "dumping" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si nous continuons à « reset » </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, il est encore jusqu'au moment où l'utilisateur soulèvera vos doigts sur l'écran et il y aura un véritable « remise à </font><font style="vertical-align: inherit;">zéro » </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous devons signaler en </font></font><code>iOS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilisant la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dropSessionDidUpdate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> délégué </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UICollectionViewDropDelegate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur notre offre </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDropProposal</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour mettre en </font><font style="vertical-align: inherit;">œuvre la </font><font style="vertical-align: inherit;">réinitialisation </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans cette méthode, nous devons renvoyer une </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">phrase qui peut avoir des </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valeurs .copy</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.move</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.cancel</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.forbidden</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour l'argument </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opération</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Et ce sont toutes les possibilités que nous avons dans le cas ordinaire lorsqu'il s'agit d'une </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> régulière </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais la collection </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">va plus loin et propose de renvoyer l'offre spécialisée </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UICollectionViewDropProposal</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui est une </font></font><code>subclass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classe de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDropProposal</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et vous permet de </font><font style="vertical-align: inherit;">spécifier, </font><font style="vertical-align: inherit;">en plus de l' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opération,</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> un paramètre d' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intention</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> supplémentaire </font><font style="vertical-align: inherit;">pour la collection </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paramètre</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'intention</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indique à la collection</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si nous voulons que l'élément «jeté» soit placé à l'intérieur d'une</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cellule</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> existante</font><b><font color="#0000FF"><font style="vertical-align: inherit;"> ,</font></font></b><font style="vertical-align: inherit;"> ou si nous voulons ajouter une nouvelle</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cellule. Vous</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> voyez la différence? Dans le cas de la collecte,</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous devons communiquer notre</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> intention</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans notre cas, nous voulons toujours ajouter une nouvelle cellule, vous verrez donc à quoi notre paramètre d'</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> intention</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera égal</font><font style="vertical-align: inherit;">.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous sélectionnons le deuxième constructeur pour</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UICollectionViewDropProposal</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><img src="https://habrastorage.org/webt/ab/vh/-p/abvh-pb04qje37u4jjgveja3lgu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans notre cas, nous voulons toujours ajouter une nouvelle cellule et le paramètre d'</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> intention</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> prendra la valeur</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .insertAtDestinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> par opposition</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.insertIntoDestinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><img src="https://habrastorage.org/webt/yg/t0/xi/ygt0xirvwaucl9zvuvuxvvil2cu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai de nouveau utilisé la constante calculée</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> isSelf</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et s'il s'agit d'une</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auto-</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> réorganisation, alors je déplace</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .move</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sinon je copie</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .copy</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dans les deux cas, nous utilisons</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .insertAtDestinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , c'est-à-dire l'insertion de nouvelles</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cellules</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jusqu'à présent, je n'ai pas implémenté la méthode</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais regardons ce qu'une collection peut déjà faire</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec cette petite information que nous lui avons fournie.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je fais glisser l'image depuis</font></font><code>Safari</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le moteur de recherche</font></font><code>Google</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et un signe «+» vert apparaît au-dessus de cette image, indiquant que notre galerie d'images est non seulement prête à accepter et copier cette image avec elle </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais aussi à fournir une place à l'intérieur de la collection </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br><br><img src="https://habrastorage.org/webt/ia/gy/gv/iagygvechjnwsm-tfvduwi0pc1o.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">je peux cliquer sur une autre paire d'images dans </font></font><code>Safari</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et Il y aura déjà 3 images "glissées": </font></font><br><br><img src="https://habrastorage.org/webt/kd/ca/7s/kdca7sflzfrbbsbtmnk8_zbueqm.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais si je lève le doigt et "dépose" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ces images, elles ne seront pas placées dans notre Galerie, mais reviendront simplement à leurs emplacements précédents, car nous n'avons pas encore implémenté la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><img src="https://habrastorage.org/webt/5v/e4/me/5ve4me_unk6t-azl6fhatljzgxs.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez voir que la collection </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sait déjà ce que je veux faire. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La collection </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est une chose absolument merveilleuse pour le mécanisme.</font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, elle a des fonctionnalités très puissantes pour cela. Nous l'avons à peine touchée en écrivant 4 lignes de code, et elle a déjà beaucoup avancé dans la perception du "reset" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Revenons au code et implémentons la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><img src="https://habrastorage.org/webt/i0/cc/es/i0ccescpyvub0pclhjyzcbdcu7o.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans cette méthode, nous ne pourrons pas nous débrouiller avec 4 lignes de code, car la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop est un</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peu plus compliquée, mais pas trop. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque la «réinitialisation» se produit </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, alors dans la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">nous devons mettre à jour notre modèle, qui est la </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">galerie d'</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> images </font><b><font color="#0000FF"><font style="vertical-align: inherit;">imageGallery</font></font></b><font style="vertical-align: inherit;"> avec une liste d'images </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">images</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et nous devons mettre à jour notre collection visuelle </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons deux scénarios de «réinitialisation» différents </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S'il y a une «réinitialisation» </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de ma collection </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , alors je dois «réinitialiser» l' </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">élément de collection dans un nouvel emplacement et le supprimer de l'ancien emplacement, car dans ce cas, je déplace ( </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.move</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) cet élément de collection. C'est une tâche insignifiante. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a une «réinitialisation» </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d'une autre application, alors nous devons utiliser la propriété </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemProvider</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de l' </font><font style="vertical-align: inherit;">élément </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> «glissé» </font><font style="vertical-align: inherit;">pour sélectionner les données. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque nous effectuons une «réinitialisation» </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans la collection </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la collection nous fournit un coordinateur </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordinateur</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Tout d'abord, nous avons signalé le coordonnateur </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordonnateur</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , il </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , à </font><font style="vertical-align: inherit;">savoir </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> « -destination », « remise à </font><font style="vertical-align: inherit;">zéro » </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui est où nous serons « remise à </font><font style="vertical-align: inherit;">zéro ». </font></font><br><br><img src="https://habrastorage.org/webt/mp/mt/wk/mpmtwkebx7beyw5ge72gt19xt7k.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peut être </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nul</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , car vous pouvez faire glisser l'image «supprimée» vers la partie de la collection </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui n'est pas la place entre certaines </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cellules</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> existantes </font><font style="vertical-align: inherit;">, elle pourrait donc être </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Si cette situation se produit, je crée un </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec l'élément </font><b><font color="#0000FF"><font style="vertical-align: inherit;">0th </font></font></b></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans la section 0th </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">section</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><img src="https://habrastorage.org/webt/qd/ei/me/qdeimejhoj1v0pkgml2xtog1jke.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je pourrais choisir n'importe quel autre </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais </font><font style="vertical-align: inherit;">j'utiliserai </font><font style="vertical-align: inherit;">cet </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> par défaut. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous savons maintenant où nous allons effectuer la «réinitialisation» </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Nous devons parcourir tous les éléments de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordinateur</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> «réinitialisables» </font><font style="vertical-align: inherit;">fournis par le </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordinateur</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Chaque </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">élément</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de cette liste a un TYPE </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UICollectionViewDropItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et peut nous fournir des informations très intéressantes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par exemple, si je peux obtenir </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceIndexPath à</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partir de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item.sourceIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , alors je saurai avec certitude que ce «glisser-déposer» </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est effectué à partir de lui-même, </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et la source du glissement </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est l'élément de collection avec </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> égal à </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/y2/3d/2u/y23d2u0pmf1pnasfw2khu9htji4.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">je n'ai même pas besoin de regarder </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans ce cas pour savoir que ce "glisser-déposer" a été effectué à L'INTÉRIEUR de la collection </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font> Ouah! <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, je connais le </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> source </font><font style="vertical-align: inherit;">et le destinationIndexPath « </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destination</font></font></font></b> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> » </font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et la tâche devient triviale. Tout ce que je dois faire est de mettre à jour le modèle afin que la source et la «destination» soient échangées, puis de mettre à jour la collection </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dans laquelle vous devrez supprimer l'élément de collection avec </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et l'ajouter à la collection avec </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notre cas local est le plus simple, car dans ce cas, le mécanisme </font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonctionne non seulement dans la même application, mais dans la même collection </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et je peux obtenir toutes les informations nécessaires en utilisant le coordinateur </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordinateur</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Implémentons-le dans ce cas local le plus simple: </font></font><br><br><img src="https://habrastorage.org/webt/1m/uu/4r/1muu4rnsxmehwuyybyspei14bvo.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans notre cas, je n'ai même pas besoin de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que j'ai «caché» plus tôt lorsque j'ai créé </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et que je peux maintenant emprunter à l' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">élément</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> « </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragged</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> » </font><font style="vertical-align: inherit;">dans la </font><font style="vertical-align: inherit;">collection d' </font><b><font color="#0000FF"><font style="vertical-align: inherit;">éléments</font></font></b><font style="vertical-align: inherit;"> sous la forme </font><b><font color="#0000FF"><font style="vertical-align: inherit;">item.localObject</font></font></b><font style="vertical-align: inherit;"> . Nous en aurons besoin lors du «dumping» d' </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">images dans la «poubelle», qui se trouve dans la même application, mais qui n'est pas la même collection </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Deux </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexPathes</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> me suffisent </font><b><font color="#0000FF"><font style="vertical-align: inherit;">maintenant</font></font></b><font style="vertical-align: inherit;"> : le source </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et le «destination» </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je reçois d'abord des informations</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageInfo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur l'image à l'ancien emplacement du modèle, en la supprimant de là. Et puis insérez dans un tableau d'</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> images</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de mes modèles</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> informations</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ImageInfo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> une image avec un nouvel indice</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> destinationIndexPath.item</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Voici comment j'ai mis à jour mon modèle:</font></font><br><br><img src="https://habrastorage.org/webt/pk/bk/ny/pkbknyitrog4kq40dcs7sfpxk0g.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">je dois maintenant mettre à jour la collection</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> elle-même</font><font style="vertical-align: inherit;">. Il est très important de comprendre que je ne veux pas surcharger toutes les données de ma collection</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reloadData ()</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au milieu du processus de «glisser-déposer»</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, car il réinstalle tout le «monde» de notre galerie d'images, ce qui est très mauvais, NE LE FAITES PAS. Au lieu de cela, je vais ranger et insérer des éléments</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éléments</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> individuellement:</font></font><br><br><img src="https://habrastorage.org/webt/1-/xa/jg/1-xajgm6ru3uwhqh53w4tf7tblu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">j'ai supprimé l'élément de collection</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sourceIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et inséré un nouvel élément de collection avec</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> destinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il semble que ce code fonctionne très bien, mais en réalité, ce code peut «planter» votre application. La raison en est que vous apportez de nombreuses modifications à votre collection</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et dans ce cas, chaque étape de modification de la collection doit être synchronisée avec le modèle normalement, ce qui n'est pas observé dans notre cas, car nous effectuons les deux opérations en même temps: supprimer et insérer. D'où la collection</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collectionVoir</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sera à un moment donné dans un état NON synchronisé avec le modèle. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais il y a un moyen vraiment cool de contourner cela, c'est que la collection </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a une méthode appelée </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performBatchUpdates</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui a une fermeture ( </font></font><code>closure</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) et à l'intérieur de cette fermeture, je peux placer n'importe quel nombre de ces </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deleteItems</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertItems</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">moveItems</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et tout ce que je veux: </font></font><br><br><img src="https://habrastorage.org/webt/6b/w_/6n/6bw_6nemnuzuv8xowkmmpt4yumw.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deleteItems</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertItems</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seront exécutés en une seule opération, et il n'y aura jamais un manque de synchronisation de votre modèle avec la collection </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et enfin, la dernière chose que nous devons faire est de demander au </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordinateur d'</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> implémenter et d'animer le «reset» lui </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">même </font><font style="vertical-align: inherit;">: </font></font><br><br><img src="https://habrastorage.org/webt/7k/qr/1u/7kqr1uatpcgzp8vim6hsf1-o_lo.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dès que vous soulevez votre doigt de l'écran, l'image bouge, tout se passe en même temps: «reset», l'image disparaît dans un endroit et l'apparence dans un autre. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essayons de déplacer l'image de test «Venise» dans notre galerie d'images à la fin de la première ligne ... </font></font><br><br><img src="https://habrastorage.org/webt/gy/k4/ci/gyk4ci8msjogcvzo4hb8iqt2atq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... et de la «réinitialiser»: </font></font><br><br><img src="https://habrastorage.org/webt/kb/a0/mv/kba0mvrjzqyf_wf1y8b0j5h27oy.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comme nous le voulions, elle a été placée à la fin de la première ligne.</font></font><br>  Hourra!<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout fonctionne! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, nous ne traiterons PAS du cas local, c'est-à-dire lorsque l'élément "reset" vient à l'extérieur, c'est-à-dire d'une autre application. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour ce faire, nous écrivons </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">else</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le code </font><font style="vertical-align: inherit;">par rapport à </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Si nous n'avons pas </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cela signifie que l'élément «réinitialisable» provenait de l'extérieur et nous devrons utiliser le transfert de données à l'aide de l' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemProver de l'</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> élément </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item.dragItem.itemProvider réinitialisable</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/wh/-9/gd/wh-9gdfe_e52v_9-wc-mf6o-7co.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si vous «glissez </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font><font style="vertical-align: inherit;">déposez» à l' </font><font style="vertical-align: inherit;">extérieur et «déposez» "</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ces informations deviennent-elles disponibles instantanément? Non, vous sélectionnez les données de la chose «traînée» ASYNCHRONE. Mais que faire si l'échantillon prend 10 secondes? Que fera la collection en ce moment </font></font><code>ollection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? De plus, les données peuvent ne pas arriver dans l'ordre dans lequel nous les avons demandées. Pour gérer cela n'est pas facile, et a </font></font><code>Apple</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proposé pour </font></font><code>ollection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce cas une technologie complètement nouvelle pour l'utilisation de substituts </font></font><code>Placeholders</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous placez un </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">espace réservé </font><font style="vertical-align: inherit;">dans votre collection </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et la collection </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gère tout cela pour vous, donc tout ce que vous avez à faire lorsque les données sont finalement sélectionnées est de demander à l'espace réservé d' </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">appeler son contexte </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">placeholderContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et dites-lui que vous avez reçu l'information. Mettez ensuite à jour votre modèle et contexte </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">placeholderContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> échange </font><font style="vertical-align: inherit;">AUTOMATIQUEMENT </font><font style="vertical-align: inherit;">la </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cellule</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec l'espace réservé </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec l'une de vos </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cellules</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ce qui correspond au type de données que vous avez reçues. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous effectuons toutes ces actions en créant un contexte d' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">espace réservé placeholderContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui gère l'espace réservé </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et que vous obtenez du coordinateur </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordinateur</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , vous demandant de «réinitialiser» </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'élément </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans l'espace réservé </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'utiliserai l'initialiseur pour le contexte d' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">espace réservé placeholderContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui "jette" </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vers un </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UICollectionViewDropPlaceholder</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/xh/lo/gk/xhlogk8aee_nhrukgwbtq0m8nae.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'objet que je vais "lancer" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item.dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , où </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un élément </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d'une </font><font style="vertical-align: inherit;">boucle, puisque nous pouvons lancer de </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nombreux </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordinator.items</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nous les «jetons» un par un. Donc, </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item.dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est ce que nous « </font><b><font color="#0000FF"><font style="vertical-align: inherit;">glissons</font></font></b><font style="vertical-align: inherit;"> - </font><b><font color="#0000FF"><font style="vertical-align: inherit;">déposons</font></font></b></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> » </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. L'argument suivant de cette fonction est l'espace réservé, et je vais le créer à l'aide de l'initialiseur </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UICollectionViewDropPlaceholder</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/hg/yu/jk/hgyujkpqodrfosah0opsrwwc-t0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour ce faire, j'ai besoin de savoir OERE je vais insérer l'espace réservé</font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, c'est-à-dire </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertionIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ainsi que l'identifiant de la cellule réutilisée </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reuseIdentifier</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'argument </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertionIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est évidemment égal à </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , c'est l' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour placer l'objet «glissé», il est calculé au tout début de la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDropWith</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Examinons maintenant l' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID de</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cellule </font><b><font color="#0000FF"><font style="vertical-align: inherit;">reuseIdentifier</font></font></b><font style="vertical-align: inherit;"> . VOUS devez décider quel type de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cellule est</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> votre localisateur </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Le coordinateur </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordinateur</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n'a pas de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cellule</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> «pré- </font><font style="vertical-align: inherit;">emballée </font><font style="vertical-align: inherit;">» </font><font style="vertical-align: inherit;">pour le localisateur</font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. C'est VOUS qui devez décider de cette cellule </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cellulaire</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Par conséquent, l'identifiant de la cellule réutilisée </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reuseIdentifiercell est demandé</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au vôtre </font></font><code>storyboard</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">afin qu'il puisse être utilisé comme PROTOTYPE. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je l'appellerai "DropPlaceholderCell", mais en gros, je pourrais le nommer. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ceci est juste la chaîne </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">String</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que je vais utiliser sur la mienne </font></font><code>storyboard</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour créer cette chose. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Revenez à la nôtre </font></font><code>storyboard</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et créez une cellule de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cellule</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour l'espace réservé </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Pour ce faire, il suffit de sélectionner une collection </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et de l'inspecter. Dans le tout premier domaine, </font></font><code>Items</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">je passe </font></font><code>1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">à</font></font><code>2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cela crée immédiatement une deuxième cellule pour nous, qui est une copie exacte de la première. </font></font><br><br><img src="https://habrastorage.org/webt/df/go/ke/dfgokefx6miugtxs8ee0_jl1zsk.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous sélectionnons notre nouvelle cellule </font></font><code>ImageCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, définissons l'identifiant « </font></font><code>DropPlaceholderCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">», en supprimons tous les </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éléments, </font><font style="vertical-align: inherit;">y </font><font style="vertical-align: inherit;">compris </font></font><code>Image View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, puisque ce PROTOTYPE est utilisé lorsque l'image n'est pas encore arrivée. Nous y ajoutons un nouvel indicateur d'activité à partir de la palette d'objets </font></font><code>Activity Indicator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, il tournera, permettant aux utilisateurs de savoir que j'attends des données de «réinitialisation». Également modifier la couleur de fond </font></font><code>Background</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour comprendre que lorsque « Reset » de l'image fonctionne exactement cette cellule </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cellulaire</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comme des </font><font style="vertical-align: inherit;">prototypes: </font></font><br><br><img src="https://habrastorage.org/webt/ur/gi/72/urgi728r6j2a1d2z0tf_4k-er1a.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outre le type de nouvelle cellule ne doit pas être </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageCollectionVewCell</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, car il n'y aura pas d'images dedans. Je ferai de cette cellule une cellule régulière de TYPE </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIollectionCiewCell</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , car nous n'en avons pas besoin </font></font><code>Outlets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour le contrôle: </font></font><br><br><img src="https://habrastorage.org/webt/sg/d8/ya/sgd8ya2342bd0lgk9fl172j-8pi.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">configurons l'indicateur d'activité </font></font><code>Activity Indicator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">afin qu'il commence à s'animer dès le début, et je n'aurais rien à écrire dans le code pour le démarrer. Pour ce faire, cliquez sur l'option </font></font><code>Animating</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br><br><img src="https://habrastorage.org/webt/qm/de/hq/qmdehqmwsuzn_dt8fkbjdoclkss.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et c'est tout. Donc, nous avons fait tous les réglages pour cette cellule </font></font><code>DropPlaceholderCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous revenons à notre code. Maintenant, nous avons un excellent localisateur </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prêt à l'emploi. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout ce que nous avons à faire est d'obtenir les données, et lorsque les données sont reçues, nous informons simplement le </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">placeholderContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de ce contexte </font><font style="vertical-align: inherit;">et il échangera le placeholder</font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et notre cellule "native" avec des données, et nous apporterons des modifications au modèle. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je vais «charger» UN objet, qui sera mon </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">élément en</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilisant la </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">méthode loadObject (ofClass: UIImage.self)</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (singulier). J'utilise le code </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item.dragItem.itemProvider</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fournisseur </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ItemProvider</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui fournira des </font><font style="vertical-align: inherit;">éléments de données ont </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">produit</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de manière asynchrone. Il est clair que si </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iitemProvider est</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> connecté </font><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">nous obtenons l' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">objet</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> «reset» </font><b><font color="#0000FF"><font style="vertical-align: inherit;">iitem en</font></font></b><font style="vertical-align: inherit;"> dehors de cette application. Ce qui suit est la </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">méthode loadObject (ofClass: UIImage.self)</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (singulier): </font></font><br><br><img src="https://habrastorage.org/webt/bv/pl/fj/bvplfjtt-wlffytoqky4jxcbxco.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette fermeture particulière n'est PAS effectuée sur</font></font><code>main queue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Et, malheureusement, nous avons dû passer à l' </font></font><code>main queue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilisation de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DispatchQueue.main.async {}</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> afin de «capturer» le rapport hauteur / largeur de l'image dans la variable </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aspectRatio</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> locale </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons vraiment introduit deux variables locales </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageURL</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aspectRatio</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... </font></font><br><br><img src="https://habrastorage.org/webt/vc/k3/vg/vck3vgqg7grejo8tj2ojbdnfdny.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... et nous les "attraperons" lors du chargement de l'image </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et de l'URL </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URL</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/jc/ui/yk/jcuiyk3c1zcz4wmkeafkpmkdvqq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si les deux variables locales </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageURL</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aspectRatio</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne </font><b><font color="#0000FF"><font style="vertical-align: inherit;">sont</font></font></b><font style="vertical-align: inherit;"> pas </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulles</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nous demanderons le contexte de l' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">espace réservé placeholderContext en</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilisant la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commitInsertion</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">donnez-nous la possibilité de changer notre modèle </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/z6/hm/8w/z6hm8w4jnyrwxgx2g8v9sfnfiuq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans cette expression, nous avons </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertionIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - c'est l' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à insérer, et nous changeons notre modèle </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . C'est tout ce que nous devons faire, et cette méthode remplacera AUTOMATIQUEMENT un espace réservé </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par une </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cellule</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en appelant la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cellForItemAt</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> normale </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notez que </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertionIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peut être très différent de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font> Pourquoi?<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parce que l'échantillonnage des données peut prendre 10 secondes, bien sûr, c'est peu probable, mais cela peut prendre 10 secondes. Pendant ce temps, </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beaucoup de choses peuvent se produire </font><font style="vertical-align: inherit;">dans la collection </font><font style="vertical-align: inherit;">. Possibilité d' </font><font style="vertical-align: inherit;">ajouter de </font><font style="vertical-align: inherit;">nouvelles cellules </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cellules</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tout se passe assez vite. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisez TOUJOURS </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertionIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et UNIQUEMENT </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertionIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour mettre à jour votre modèle. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment mettre à jour notre modèle? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous allons </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insérer la</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> structure </font><b><font color="#0000FF"><font style="vertical-align: inherit;">imageModel </font></font></b></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans le tableau imageGallery.images</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , composé du rapport d'aspect de l'image </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aspectRatio</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et de l'URL de l'image </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageURL</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que le </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fournisseur</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> correspondant nous a renvoyé </font><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela met à jour notre modèle </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commitInsertion</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fait le reste pour nous. Vous n'avez plus besoin de faire quoi que ce soit de plus, pas d'insertions, pas de suppressions, rien de tout cela. Et, bien sûr, puisque nous sommes dans une fermeture, nous devons nous ajouter </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></font></b>  . <br><br><img src="https://habrastorage.org/webt/rm/ff/nx/rmffnxnhy_1k1ukzub6ni468z6g.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si nous sommes pour une raison de </font><font style="vertical-align: inherit;">ne pas en </font><font style="vertical-align: inherit;">mesure d'obtenir le rapport d'aspect </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aspectRatio</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et l' </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageURL</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> du correspondant </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par le </font><font style="vertical-align: inherit;">fournisseur</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , une erreur aurait été reçu </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erreur</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à la place </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par le </font><font style="vertical-align: inherit;">fournisseur</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nous devons leur faire connaître le contexte </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">placeholderContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , vous devez détruire ce un espace réservé </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, parce que nous sommes tous les mêmes, nous ne pouvons pas obtenir d'autres données: </font></font><br><br><img src="https://habrastorage.org/webt/gw/tm/jj/gwtmjjywumpq4o7czavwnrcweay.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une chose à garder à l'esprit est </font></font><code>URLs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qu'elles proviennent de lieux comme celui-ci </font></font><code>Google</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, en réalité, elles ont besoin de transformations mineures pour être «propres»</font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour l'image. Comment ce problème est résolu peut être vu dans cette application de démonstration dans un fichier </font></font><code>Utilities.swift</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par conséquent, lorsque </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recevons</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> une </font><font style="vertical-align: inherit;">image, nous utilisons la propriété </font><b><font color="#0000FF"><font style="vertical-align: inherit;">imageURL</font></font></b><font style="vertical-align: inherit;"> de la classe </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URL</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/v5/cq/dc/v5cqdcxzqnwybov4eiklwlkt2o8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et c'est tout ce que vous devez faire pour accepter quelque chose à l'extérieur de la collection </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voyons cela en action. Nous lançons simultanément en mode multitâche notre application de démonstration </font></font><code>ImageGallery</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>Safari</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec un moteur de recherche </font></font><code>Google</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Comme </font></font><code>Google</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous cherchons des images sur le thème de « Dawn» (lever du </font><font style="vertical-align: inherit;">soleil). Dans </font></font><code>Safari</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">déjà construit</font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le mécanisme, afin que nous puissions sélectionner l'une de ces images, la maintenir longtemps, la déplacer un peu et la faire glisser dans notre galerie d'images. </font></font><br><br><img src="https://habrastorage.org/webt/au/t9/wk/aut9wky03l29lkgj9g7l1ulifmc.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La présence d'un signe plus vert "+" indique que notre application est prête à accepter une image tierce et à la copier dans votre collection à l'emplacement spécifié par l'utilisateur. Après l'avoir «réinitialisée», il faut un certain temps pour télécharger l'image, et à ce moment cela fonctionne </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Une </font></font><br><br><img src="https://habrastorage.org/webt/ge/e-/n0/gee-n08qnm7zc5ofbgr3e4o8df8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fois le téléchargement terminé, l'image «réinitialisée» est placée au bon endroit et </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disparaît: </font></font><br><br><img src="https://habrastorage.org/webt/m8/rb/nq/m8rbnqvi2x0s3as4w_fzpjpltae.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous pouvons continuer à «réinitialiser» les images et les placer dans notre collections d'images encore plus nombreuses: </font></font><br><br><img src="https://habrastorage.org/webt/x8/np/bq/x8npbqpkm9af1_ybkxhw13kjhug.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Après le travail de "réinitialisation" </font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br><br><img src="https://habrastorage.org/webt/b2/lq/hb/b2lqhbg6smc2mvvvjp0copbvfmu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En conséquence, notre galerie d'images est remplie de nouvelles images:</font></font><br><br><img src="https://habrastorage.org/webt/lf/jl/mq/lfjlmqca5iqv26l0woi-htqldcq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant qu'il est clair que nous sommes en </font><font style="vertical-align: inherit;">mesure de prendre des </font><font style="vertical-align: inherit;">photos de l'extérieur, on n'a pas besoin de </font><font style="vertical-align: inherit;">l'image de test, et nous supprimerons: </font></font><br><br><img src="https://habrastorage.org/webt/bv/0t/az/bv0tazx3cjushm1rkcfalu-m1au.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notre </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">viewDidLoad</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devient très simple: il est que </font><font style="vertical-align: inherit;">nous faisons notre </font></font><code>Controller</code> <code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">délégué et ajoute reconnaisseur geste de </font></font><b><font color="#FF00FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pincement</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui régule le nombre d'images par ligne: </font></font><br><br><img src="https://habrastorage.org/webt/ei/fo/1b/eifo1bz0szfk12tuqfseh5fser8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bien sûr , nous pouvons ajouter un cache pour les images </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageCache</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/f4/oi/ql/f4oiql_gjnka7racbmkrts7mbja.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous remplirons l' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageCache</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lors de la "réinitialisation" </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... </font></font><br><br><img src="https://habrastorage.org/webt/xy/hc/bt/xyhcbtodifjiqgd5norskny9cge.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et lors de la récupération à partir du "réseau" dans la classe </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageCollectionViewCell</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> personnalisée </font><font style="vertical-align: inherit;">: </font></font><br><br><img src="https://habrastorage.org/webt/nk/sl/2s/nksl2sw3dujz-_z7fmp55zixfzi.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et </font><font style="vertical-align: inherit;">nous </font><font style="vertical-align: inherit;">utiliserons le cache </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageCache</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lors de la lecture d'une cellule</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cellule de</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> notre galerie d'images dans la classe personnalisée</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ImageCollectionViewCell</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><img src="https://habrastorage.org/webt/-5/ar/zo/-5arzoeghtoj_ckv-ezxhpu403c.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, nous commençons avec une collection vide ...</font></font><br><br><img src="https://habrastorage.org/webt/rl/bq/vn/rlbqvnpsww27j5xbryp9vlgng1a.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... puis "déposons" une nouvelle image dans notre collection ...</font></font><br><br><img src="https://habrastorage.org/webt/9j/7o/es/9j7oesf_b-rk-dj-s9ysujlkte0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... l'image est téléchargée et</font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonctionne ...</font></font><br><br><img src="https://habrastorage.org/webt/tg/s7/6t/tgs76tffgkarqkpzhamq97ebvio.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... et l'image apparaît au bon endroit:</font></font><br><br><img src="https://habrastorage.org/webt/ps/uy/z8/psuyz8apr4zpulpgpl5z-hsegfy.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous continuons à remplir notre collection À L'EXTÉRIEUR:</font></font><br><br><img src="https://habrastorage.org/webt/it/ve/_y/itve_yuqqnffh8zyzlpmj_vvske.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vient charger des images et</font></font><code>Placeholders</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">travailler ...</font></font><br><br><img src="https://habrastorage.org/webt/li/rx/wd/lirxwd74znfsvgrtjkpg3gfvl8u.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et les images apparaissent au bon endroit:</font></font><br><br><img src="https://habrastorage.org/webt/uq/j0/as/uqj0asiyqcpqosl8x-3akydb3x0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Donc, nous pouvons faire beaucoup avec notre galerie d'images: remplissez-la À L'EXTÉRIEUR, réorganisez les éléments À L'INTÉRIEUR, partagez des images avec d'autres applications niyami.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous devons juste lui apprendre à se débarrasser des images inutiles en les «réinitialisant»</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans la "poubelle" présentée sur la barre de navigation à droite. </font><font style="vertical-align: inherit;">Comme décrit dans la section «Caractéristiques de l'application de démonstration d'Image Gallery», la «poubelle» est représentée par la classe </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GabageView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui hérite de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et nous devons lui apprendre à accepter les images de notre collection </font></font><code>ollection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Réinitialisez les </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">images de la galerie dans la corbeille.</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Immédiatement de l'endroit - à la carrière. Je vais ajouter à </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GabageView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> « interaction » </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interaction</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et il sera </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDropInteraction</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , depuis que </font><font style="vertical-align: inherit;">je suis en </font><font style="vertical-align: inherit;">train de « réinitialiser » </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">certaines choses. Tout ce dont nous avons besoin pour fournir cet </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDropInteraction</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un délégué </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">délégué</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et je vais </font><b><font color="#0000FF"><font style="vertical-align: inherit;">m'attribuer</font></font></b><font style="vertical-align: inherit;"> moi- </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">même</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à ce délégué </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">délégué</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/mm/tq/xn/mmtqxnmypbysaik9fjd3r2amrlg.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Naturellement, notre classe </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GabageView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> doit confirmer que nous implémentons le protocole </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDropInteractionDelegate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/nv/xy/vw/nvxyvwya12ggtiznb1byxq5vorm.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tout ce que nous devons faire pour le faire fonctionner </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, il s'agit d'implémenter les méthodes </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canHandle que</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous connaissons déjà </font><font style="vertical-align: inherit;">,</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sessionDidUpdate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><img src="https://habrastorage.org/webt/jg/m9/ol/jgm9olzkrnv_fmu0mwesx91dvsq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cependant, contrairement à des méthodes similaires pour la collecte</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous ne disposons d'aucune information supplémentaire sous la forme d'un</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indexPath du</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lieu de dumping.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implémentons ces méthodes.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans la méthode</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> canHandle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera traitée que la « glisser-déposer »</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui représentent l'image</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d' un UIImage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Par conséquent, je</font><font style="vertical-align: inherit;">ne</font><font style="vertical-align: inherit;">retournerai</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> true que</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> session.canLoadObjects (ofClass: UIImage.self)</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><img src="https://habrastorage.org/webt/if/z7/yo/ifz7yoibzsugla3mj7kat1cylt8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans la méthode</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> canHandle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,</font><font style="vertical-align: inherit;">vous dites essentiellement que si l'objet "déplaçable" n'est pas une image</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UIImage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, puis en outre, cela n'a aucun sens de continuer la suppression "reset" et d'appeler les méthodes suivantes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si l'objet «glissable» est une image </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIImage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , alors nous exécuterons la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sessionDidUpdate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Tout ce que nous devons faire dans cette méthode est de renvoyer notre </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">offre de</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> «réinitialisation» </font><b><font color="#0000FF"><font style="vertical-align: inherit;">UIDropProposal</font></font></b></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Et je suis prêt à n'accepter que l'objet LOCALEMENT «glissé» du TYPE </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIImage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de l'image </font><font style="vertical-align: inherit;">, qui peut être «déposé» </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n'importe où dans mon </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GarbageView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Mon </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GarbageView</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n'interagira pas avec les images exportées À L'EXTÉRIEUR. Donc j'analyse en utilisant la variable </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">session.localDragSession</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s'il y a une «réinitialisation» locale </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et je renvoie la phrase «réinitialisation» sous la forme du constructeur </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDropProposal</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec l'argument </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opération</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> prenant la valeur </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.copy</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , car le «glisser-déposer» TOUJOURS LOCAL </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans mon application proviendra de la collection </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Si «glisser </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">déposer» </font><font style="vertical-align: inherit;">et «réinitialiser» </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se produisent À L'EXTÉRIEUR, je renvoie la phrase «réinitialiser» sous la forme du constructeur </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDropProposal</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec l'argument d' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opération</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> prenant la valeur </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.fobbiden</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , c'est-à-dire «interdit» et nous obtiendrons un signe d'interdiction «réinitialiser» au lieu du signe plus vert . </font></font><br><br><img src="https://habrastorage.org/webt/ii/vd/wy/iivdwy9av6cxwzjkeay9kf87lby.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Copie d'une image </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIImage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous simulerons une diminution de son échelle à presque 0, et lorsque la "réinitialisation" se produira, nous supprimerons cette image de la collection </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afin de créer l'illusion d'images «vidage et disparition» dans la «poubelle» pour l'utilisateur, nous utilisons la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">previewForDropping</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">nouvelle pour nous </font><font style="vertical-align: inherit;">, qui </font><font style="vertical-align: inherit;">nous </font><font style="vertical-align: inherit;">permet de rediriger le «vidage» </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vers un autre endroit et en même temps de transformer l'objet «vidage» lors de l'animation: </font></font><br><br><img src="https://habrastorage.org/webt/e7/ej/zb/e7ejzbhlfzjxrkxsjupt9hiewz4.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dans cette méthode, en utilisant l'initialiseur </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDragPreviewTarget,</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous obtenons une nouvelle </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pré-vue</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour l'objet </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cible à </font></font></font></b><font style="vertical-align: inherit;"><b><font color="#0000FF"><font style="vertical-align: inherit;">supprimer</font></font></b><font style="vertical-align: inherit;"> et le redirige en utilisant la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retargetedPreview</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">à un nouvel endroit, à la "poubelle", avec son échelle jusqu'à presque zéro: </font></font><br><br><img src="https://habrastorage.org/webt/bu/zp/av/buzpavo-rn6n2eoeztccvman6r0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si l'utilisateur lève le doigt, une "réinitialisation" se produit </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et je </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reçois</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (comme </font><b><font color="#0000FF"><font style="vertical-align: inherit;">GarbageView</font></font></b><font style="vertical-align: inherit;"> ) un message </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dans le message </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop,</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous effectuons la «réinitialisation» réelle </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Honnêtement, l' </font><font style="vertical-align: inherit;">image qui a été </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transférée</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur </font><b><font color="#0000FF"><font style="vertical-align: inherit;">GarbageView</font></font></b><font style="vertical-align: inherit;"> lui-même </font><font style="vertical-align: inherit;">ne nous intéresse plus, car nous la rendrons pratiquement invisible, le fait même de l'achèvement de la «réinitialisation» </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signalera </font><font style="vertical-align: inherit;">probablement </font><font style="vertical-align: inherit;">que nous supprimons cette image de la collection </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Pour ce faire, nous devons connaître la collection elle </font><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">même </font><font style="vertical-align: inherit;">et la </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collection </font></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jeté l'image en elle. D'où pouvons-nous les obtenir? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parce que le processus </font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se déroule dans une seule application, il est disponible pour nous tous local: locale </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">session de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localDragSession</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> notre </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">session de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la session</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , le contexte local </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui est notre collection de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sollectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et objet local </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que nous pouvons faire par lui - </font><font style="vertical-align: inherit;">même est l' </font><font style="vertical-align: inherit;">image remis à </font><font style="vertical-align: inherit;">zéro l' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de « Galerie » ou </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . En </font><font style="vertical-align: inherit;">raison de cela , </font><font style="vertical-align: inherit;">nous pouvons obtenir dans la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> classe </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GarbageView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collection </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collection</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et utiliser</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dataSource</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comment</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ImageGalleryCollectionViewController</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et modèle</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> notre</font></font><code>Controller</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous pouvons obtenir un tableau d'images d'</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> images</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> TYPE [ImageModel]:</font></font><br><br><img src="https://habrastorage.org/webt/3t/tj/kr/3ttjkr1cuyqxh4v3islcmsofjhy.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avec l'aide de la section locale</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">session</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de localDragSession</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> notre</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">session</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la session</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nous avons pu obtenir toutes les « glisser » sur</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GarbageView</font></font></font></b> <code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> éléments des</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> éléments</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et il peut y avoir beaucoup, comme nous</font><font style="vertical-align: inherit;">savons, et tous sont des images de notre</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collection collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Création</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éléments</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dragItems</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> notre collection</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous avons fourni pour chaque « glisser »</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">élément</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> objet local</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui est l'image de</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> l' image</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais il est on ne vient pas</font><font style="vertical-align: inherit;">portée</font><font style="vertical-align: inherit;">main lors</font><font style="vertical-align: inherit;">collecte de réorganisation interne</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CollectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais la « remise</font><font style="vertical-align: inherit;">zéro » Galeries d'images « POUBELLE » nous</font><font style="vertical-align: inherit;">désespérément besoin dans l'installation locale</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> objet « drag »</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , après tout ce temps nous n'avons pas de</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> coordinateur</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui partage si généreusement les informations sur ce qui se passe dans la collection</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font><font style="vertical-align: inherit;">conséquent, nous voulons</font><font style="vertical-align: inherit;">l'objet local</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> index était</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le tableau d'images</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> images</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de nos modèles</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Effectuez les modifications nécessaires dans la méthode</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dragItems (à indexPath: indexPath)</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> classe</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ImageGalleryCollectionViewController</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><img src="https://habrastorage.org/webt/le/iy/hz/leiyhzxv04brlhk6nlhpakw4bek.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant</font><font style="vertical-align: inherit;">nous pouvons prendre tous</font><font style="vertical-align: inherit;">éléments « pretaskivaemogo »</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> point</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> il</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui est l'indice</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le tableau d'images</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> images</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de nos modèles</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imagegallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et</font><font style="vertical-align: inherit;">envoyer aux indices de tableau</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> des index</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et tableau d'</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indexPahes d'</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> images supprimées:</font></font><br><br><img src="https://habrastorage.org/webt/ci/cf/uo/cicfuo7gxvbmh7ddvjj2maorfog.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connaître le tableau d'indexes d'</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> index</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et le tableau d'</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indexPahes d'</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> images supprimées, dans la méthode</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> performBatchUpdates</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collection </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collection</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous supprimer toutes les </font><font style="vertical-align: inherit;">images supprimées de modèles d' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">images</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et de la collection de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collection</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/2t/49/i4/2t49i4wwgqlz-vqqpalim8m4h4u.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exécutez l'application, remplissez la galerie avec de </font><font style="vertical-align: inherit;">nouvelles images: </font></font><br><br><img src="https://habrastorage.org/webt/vj/kb/v5/vjkbv5nwenjhacglkmksbto5jh0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sélectionnez une paire d'images que nous voulons retirer de notre galerie ... </font></font><br><br><img src="https://habrastorage.org/webt/cm/-e/t1/cm-et1fd2cp7pext2src2vddkmm.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... « jeter » les sur l'icône avec la « poubelle » ... </font></font><br><br><img src="https://habrastorage.org/webt/yw/l3/ue/ywl3ue6tusekuyqvpjv3n4pn1xy.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ils ont réduit presque à 0 ... </font></font><br><br><img src="https://habrastorage.org/webt/14/6r/nd/146rndccir7ou4z5zitpj9gv4ek.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... et disparaissent de la collection </font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, se cachant dans la "poubelle":</font></font><br><br><img src="https://habrastorage.org/webt/1x/b_/zw/1xb_zw27xn-2yp7lb7tvlpgm_fc.png"><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Enregistrement d'images entre les démarrages. </font></font></h1><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour enregistrer la galerie d'images entre les exécutions, nous utiliserons </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UserDefaults</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , après avoir converti notre modèle en un </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">format. Pour ce faire, nous allons ajouter à notre </font></font><code>Controller</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variable de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">defailts var</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... </font></font><br><br><img src="https://habrastorage.org/webt/wy/cg/vy/wycgvy5krdrmfiugzp9dgykaphe.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... et dans le modèle </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageModel</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> protocole </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">codable</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/j2/vv/w6/j2vvw62tiuud6eidtx1n9ipeq0w.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chaîne </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chaîne</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , des </font><font style="vertical-align: inherit;">tableaux de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la matrice</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'URL</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">double</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> appliquent déjà le protocole </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">codable</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , donc nous n'avons rien d' </font><font style="vertical-align: inherit;">autre à faire pour se </font><font style="vertical-align: inherit;">rendre à l' </font><font style="vertical-align: inherit;">encodage de travail et décodage en </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modèles</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ImageGallery </font><font style="vertical-align: inherit;">au </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">format.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment obtenir la </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">version d' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour ce faire, créez une variable calculée </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var json</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui renvoie le résultat d'une tentative de conversion elle- </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">même</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , en utilisant </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSONEncoder.encode ()</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">format: </font></font><br><br><img src="https://habrastorage.org/webt/f6/o3/hz/f6o3hzee-7hryaxadmzf--0jeym.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et c'est tout. Soit les </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">données</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seront retournées </font><font style="vertical-align: inherit;">à la suite de la conversion de </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soi</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au format </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, soit </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si cette conversion échoue, bien que cette dernière ne se produise jamais, car ce TYPE est 100% </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">encodable</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . La </font><font style="vertical-align: inherit;">variable </font><b><font color="#0000FF"><font style="vertical-align: inherit;">json </font></font></b></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">facultative</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est utilisée </font><font style="vertical-align: inherit;">uniquement pour des raisons de symétrie.</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons maintenant un moyen de convertir les modèles </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au </font><font style="vertical-align: inherit;">format </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data</font></font></font></b><font style="vertical-align: inherit;"></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variable </font><b><font color="#0000FF"><font style="vertical-align: inherit;">json a-t-elle des </font></font></b></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">données</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> TYPE </font><b><font color="#0000FF"><font style="vertical-align: inherit;">?</font></font></b><font style="vertical-align: inherit;"> qui peut être mémorisé dans </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UserDefaults</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imaginez maintenant que d'une manière ou d'une autre nous avons réussi à obtenir les </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">données </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">json</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et j'aimerais recréer à partir d'eux notre modèle, une instance de la structure </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pour ce faire, il est très facile d'écrire un INITIALIZER pour </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dont l'argument d'entrée est des </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">données </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">json</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Cet initialiseur sera un initialiseur "tombant" (</font></font><code>failable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) Si elle ne parvient pas à initialiser, il « tombe » et retourne </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/g7/0n/l4/g70nl4mxpadtrajaq7y-ec4f6bw.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je suis juste une nouvelle valeur </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">newValue</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> par le décodeur </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSONDecoder</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , en </font><font style="vertical-align: inherit;">essayant de décoder les données </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui sont transférés à mon initialiseur, puis l' </font><font style="vertical-align: inherit;">affecte à </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'auto</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si j'ai réussi à le faire, alors j'obtiens une nouvelle instance d' </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais si ma tentative échoue, je retourne </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , car mon initialisation "a échoué". </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je dois dire que nous avons ici beaucoup plus de raisons d’échouer ( </font></font><code>fail</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), car il est fort possible que les </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">données </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">json</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut être gâté ou vide, tout cela peut conduire à la «chute» ( </font></font><code>fail</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) de l'initialiseur. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant , </font><font style="vertical-align: inherit;">nous pouvons mettre en </font><font style="vertical-align: inherit;">œuvre les READ </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">données et modèle de récupération </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagegallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la méthode </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">viewWillAppear</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> notre </font></font><code>Controller</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... </font></font><br><br><img src="https://habrastorage.org/webt/gw/n2/u-/gwn2u-zkggggk2vuwfi-czhycdq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... ainsi que d' </font><font style="vertical-align: inherit;">une entrée dans l'observateur </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">didSet {}</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> propriétés </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagegallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/-g/bc/yz/-gbcyzh4t5innabrtcbxdmdh3wq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lançons l'application et remplissez notre galerie d'images: </font></font><br><br><img src="https://habrastorage.org/webt/le/t5/wr/let5wryw9nwf-ahnij7f_wltztc.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si nous fermons l'application et de l' </font><font style="vertical-align: inherit;">ouvrir à </font><font style="vertical-align: inherit;">nouveau, nous pouvons voir notre galerie précédente Images enregistrées dans </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UserDefaults</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h1>  Conclusion </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cet article montre à quel point il est facile d'intégrer la technologie </font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans une </font></font><code>iOS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">application en </font><font style="vertical-align: inherit;">utilisant l'exemple d'une application de démonstration très simple «Galerie d'images» </font><font style="vertical-align: inherit;">. Cela a permis de modifier entièrement la galerie d'images, de «lancer» de nouvelles images à partir d'autres applications, de déplacer celles existantes et de supprimer celles inutiles. Et aussi de distribuer les images accumulées dans la Galerie à d'autres applications. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bien sûr, nous aimerions créer de nombreuses collections d'images thématiques pittoresques et les enregistrer directement sur l'iPad ou iCloud Drive. Cela peut être fait si chacune de ces galeries est interprétée comme un </font><b><font color="#0000FF"><font style="vertical-align: inherit;">UIDocument</font></font></b><font style="vertical-align: inherit;"> stocké en permanence</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Une telle interprétation nous permettra de passer au niveau d'abstraction suivant et de créer une application qui fonctionne avec des documents. </font><font style="vertical-align: inherit;">Dans une telle application, vos documents seront affichés par le composant </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DocumentBrowserViewController</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , très similaire à l'application </font></font><code>Files</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il vous permettra de créer des </font><font style="vertical-align: inherit;">images </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDocument</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de type «Galerie d'images» à la fois sur vous </font></font><code>iPad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et sur </font></font><code>iCloud Drive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ainsi que de sélectionner le document souhaité pour l'affichage et l'édition. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais c'est le sujet du prochain article. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS Le code de l'application de démonstration avant l'implémentation du mécanisme </font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et après est sur </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr425817/">https://habr.com/ru/post/fr425817/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr425807/index.html">Complexité des systèmes et méthodes de «lutte» avec elle</a></li>
<li><a href="../fr425809/index.html">Apprentissage des langages de programmation dans le processus: développeur de logiciels sur des projets complexes</a></li>
<li><a href="../fr425811/index.html">Un autre problème d'affichage du MacBook Pro</a></li>
<li><a href="../fr425813/index.html">CICD: déploiement transparent sur des systèmes de cluster distribués sans temps d'arrêt</a></li>
<li><a href="../fr425815/index.html">Qui n'a pas besoin de référencement, comment choisir un optimiseur et tester son travail</a></li>
<li><a href="../fr425819/index.html">GitLab 11.3 publié avec le référentiel Maven et des environnements sécurisés</a></li>
<li><a href="../fr425821/index.html">Comment devenir développeur React en 2018</a></li>
<li><a href="../fr425823/index.html">Statistiques IPO 2018: 45 milliards de dollars levés, Dropbox a levé moins d'argent que les sociétés pharmaceutiques et les vendeurs immobiliers</a></li>
<li><a href="../fr425827/index.html">Leçon Google+: les projets doivent s'assurer que les frontières entre les intérêts des utilisateurs dans la vie réelle sont respectées en ligne</a></li>
<li><a href="../fr425829/index.html">Comment nous nous sommes battus avec Roskomnadzor et ce qu'il en est advenu</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>