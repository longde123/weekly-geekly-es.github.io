<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👵🏽 👨🏾‍🎨 ➿ DIY可控制互联网的独立无人机。 关于软件的第2部分 🥚 🧝 ⛔️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="这是自主无人机故事的延续。 第一部分谈论硬件，这一部分将谈论软件。 首先，一个关于操作员与直升机互动的小型教育计划。 这是大多数自组装无人机的典型布局： 



 这是高级无人机的方案： 



 这是玩具无人机的工作方式，可通过智能手机进行控制： 



 您可以通过互联网控制无人机（如果您的SI...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DIY可控制互联网的独立无人机。 关于软件的第2部分</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414587/"> 这是自主无人机故事的延续。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第一部分</a>谈论硬件，这一<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">部分</a>将谈论软件。 首先，一个关于操作员与直升机互动的小型教育计划。 这是大多数自组装无人机的典型布局： <br><br><img src="https://habrastorage.org/webt/f6/jn/na/f6jnnadl96jkvjtcngwxhxogkcu.png" alt="图片"><br><br> 这是高级无人机的方案： <br><br><img src="https://habrastorage.org/webt/gz/5t/bg/gz5tbg7qqv82_5t86usnrsyhgsg.png" alt="图片"><br><a name="habracut"></a><br> 这是玩具无人机的工作方式，可通过智能手机进行控制： <br><br><img src="https://habrastorage.org/webt/zr/tu/7r/zrtu7r2febul6zxzy2uzrkpf8rq.png" alt="图片"><br><br> 您可以通过互联网控制无人机（如果您的SIM卡具有静态IP地址）： <br><br><img src="https://habrastorage.org/webt/ae/d1/yk/aed1yk46dzosxybjpglxk6bwu5i.png" alt="图片"><br><br> 或者，如果IP地址是动态的： <br><br><img src="https://habrastorage.org/webt/v2/x_/jo/v2x_jo1dtumefo_wekedrufda0o.png" alt="图片"><br><br> 为了确保通信通道的可靠性和冗余性，可以将后一种选项开发为以下状态： <br><br><img src="https://habrastorage.org/webt/x6/yz/ho/x6yzhoievpeggh8ya7jo8cmxvo4.png" alt="图片"><br><br> 接下来，我将描述Emlid Navio 2飞行控制器和Raspberry Pi 3微型计算机的设置过程。 <br><br><img src="https://habrastorage.org/webt/7g/lr/cv/7glrcvssoyxvii2swoekbsrkuf8.jpeg" alt="图片"><br> 但是，只需稍作修改，这些设置便适用于任何飞行控制器，您可以通过<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MAVLink</a>协议与Linux操作系统系列中的任何计算机进行通讯。 <br><br><img src="https://habrastorage.org/webt/bq/6c/my/bq6cmyprlzet6b8w4kemu_nn_ao.png" alt="图片"><br><br>  <b><u>重要！</u></b>  <b><u>必须在速度控制器的电源关闭的情况下进行设置，以免发动机意外启动。</u></b> <br><br><h3> 适用于PC和平板电脑的无人机控制软件 </h3><br> 为了控制无人机，使用了特殊的GCS（地面控制站）程序。 在下文中，我将使用该缩写。 我喜欢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">QGroundControl</a> ，这是一个开放源代码的多平台（Windows，Linux，MacOS，iOS，Android）GCS，它已成为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">DroneCode</a>项目的一部分。 但是，还有其他免费和商业选择： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">APM Planner</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MissionPlanner</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">UgCS</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">LibrePilot</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">OpenPilot</a> ，Android的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Tower</a> （DroidPlanner）， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MAVPilot</a> （iOS）和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SidePilot</a> （iOS）。 以及控制台<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MAVProxy</a> 。 <br><br><h3> 在SD卡上安装OS映像 </h3><br> 对于正常的自动驾驶操作，强烈建议使用“快速” SD卡（10级）。 慢速存储卡即使在低频下也没有时间保存自动驾驶仪日志，结果导致它们慢速甚至根本没有被写入。 这可能是“ <i>无IO心跳</i> ”错误的证据，可以在MAVLink控制台中观察到此错误（下面将介绍如何观看MAVLink控制台）。 购买时，请考虑写入4K视频的能力：最有可能是快速SD。 不幸的是，我是在无人机坠落后才发现这一点的，当时有必要分析日志并找出原因。 几个GCS无法读取日志。 在飞行中关闭电机的原因实在是太平庸了：我忘记在故障安全操作的设置中调整电池的最小电压。 <br><br> 因此，请从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">原始说明页面</a>从Emlid下载带有预装Ardupilot和ROS的Raspbian Stretch成品图像。 然后我们使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Etcher</a>或任何类似程序将其写入存储卡。 <br><br> 为了在打开后立即将Raspberry连接到您的WiFi网络，您需要在SD卡的根目录中编辑<i>wpa_supplicant.conf</i>文件。 它应包含以下几行： <br><br><pre><code class="bash hljs">network={ ssid=<span class="hljs-string"><span class="hljs-string">"_wifi_"</span></span> psk=<span class="hljs-string"><span class="hljs-string">"_wifi_"</span></span> }</code> </pre> <br> 您也可以使用以太网电缆将单板计算机连接到路由器，从而在不使用WiFi的情况下对其进行配置。 现在，从PC上卸下SD卡，将其插入Raspberry，然后打开电源。 半分钟后，它应显示在已连接设备页面上路由器的管理面板中（navio <i>主机名</i> ）。 <br><br><h3> 更新分发套件并安装必要的软件包 </h3><br> 打开SSH客户端并连接到Raspberry（本地navio IP地址，而不是<i>RASPBERRY_IP_ADDRESS</i> ）： <br><br><pre> <code class="bash hljs">ssh pi@RASPBERRY_IP_ADDRESS</code> </pre> <br> 标准密码： <i>树莓</i> 。 首先，有必要将操作系统的文件系统扩展到SD卡的整个卷中： <br><br><pre> <code class="bash hljs">sudo raspi-config --expand-rootfs</code> </pre> <br> 并重新启动： <br><br><pre> <code class="bash hljs">sudo reboot</code> </pre> <br> 重新启动后，再次连接并更新发行版： <br><br><pre> <code class="bash hljs">sudo apt-get update &amp;&amp; sudo apt-get dist-upgrade -y</code> </pre> <br> 安装其他软件包： <br><br><pre> <code class="bash hljs">sudo apt-get install autoconf automake libtool pkg-config libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev libraspberrypi-dev gstreamer1.0-tools gstreamer1.0-plugins-good gstreamer1.0-plugins-bad</code> </pre> <br> 并为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">gstreamer</a>和Raspicam本机相机编译<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">gst-rpicamsrc包装器</a> ： <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/thaytan/gst-rpicamsrc.git rpicamsrc <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> rpicamsrc chmod +x autogen.sh ./autogen.sh --prefix=/usr --libdir=/usr/lib/arm-linux-gnueabihf/ make sudo make install</code> </pre> <br> 检查摄像机是否工作（创建视频文件test.h264）： <br><br><pre> <code class="bash hljs">gst-launch-1.0 rpicamsrc bitrate=1000000 ! filesink location=test.h264</code> </pre> <br> 如果gstreamer启动，请等待几秒钟以录制视频。 您可以通过按<i>Ctrl + C</i>中断该过程<i>。</i> 如果有视频，则说明相机正在工作。 <br><br><h3> 配置并启动Ardupilot </h3><br>  Emlid的新版本发布的Ardupilot的发布有些晚。 如果最新版本提供了必要的功能，则可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用此说明</a>从源代码中安装它。 <br><br>  Navio开发人员在其传感器中添加了一个简单便捷的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Emlid工具实用程序</a> ，用于检查传感器和设置Ardupilot。 首先，检查Raspberry是否看到Navio控制器： <br><br><pre> <code class="bash hljs">emlidtool info</code> </pre> <br> 如果响应此命令会产生类似以下内容： <br><br><pre> <code class="bash hljs">Vendor: Emlid Limited Product: Navio 2 Issue: Emlid 2018-06-05 831f3b08594f2da17dccae980a2e3659115ef71f Kernel: 4.14.34-emlid-v7+ RCIO firmware: 0xcaec2284</code> </pre> <br> 这意味着他看到了。 检查传感器的状态（显示列表和状态）： <br><br><pre> <code class="bash hljs">emlidtool <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre> <br> 和Linux内核中的PWM控制器驱动程序： <br><br><pre> <code class="bash hljs">cat /sys/kernel/rcio/status/alive</code> </pre> <br>  0 =不工作，1 =工作。 <br><br>  PWM控制器的固件更新如下： <br><br><pre> <code class="bash hljs">sudo emlidtool rcio update</code> </pre> <br> 现在配置Ardupilot： <br><br><pre> <code class="bash hljs">sudo emlidtool ardupilot</code> </pre> <br> 带有逐步菜单的文本GUI将在终端中打开。 我们选择最新版本的直升机，键入<i>arducopter</i> ，在启动时自动启动（ <i>在启动时：boot</i> ），在配置后启动（ <i>Ardupilot：start</i> ）。 <br><br><img src="https://habrastorage.org/webt/w8/p7/yn/w8p7ynlxvrqybsaqrdkqxbk68yy.png" alt="图片"><br><br> 我们通过<i>退出</i>菜单项<i>退出</i> 。 <br><br> 检查Ardupilot是否已启动： <br><br><pre> <code class="bash hljs">sudo systemctl status arducopter</code> </pre> <br> 请注意，由于已配置<i>copter</i>选项，因此systemd中的启动文件称为<u>arducopter</u> 。 <br><br> 现在我们需要配置Ardupilot，以便它向我们发送遥测数据。 为此，请编辑配置文件： <br><br><pre> <code class="bash hljs">sudo nano /etc/default/arducopter</code> </pre> <br> 它应包含以下几行： <br><br><pre> <code class="bash hljs">TELEM1=<span class="hljs-string"><span class="hljs-string">"-A udp:127.0.0.1:14550"</span></span> ARDUPILOT_OPTS=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$TELEM1</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br> 保存文件（ <i>Ctrl + X</i> ，然后是<i>Y</i> ）并重新启动Ardupilot： <br><br><pre> <code class="bash hljs">sudo systemctl daemon-reload sudo systemctl restart arducopter</code> </pre> <br> 您可以使用以下命令检查Ardupilot进程的状态： <br><br><pre> <code class="bash hljs">sudo systemctl status arducopter</code> </pre> <br> 通过这些设置，Ardupilot将遥测（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MAVLink</a>数据包）传输到本地UDP端口14550。接着， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MAVProxy</a>脚本（如下所述）将从那里进行遥测，并将其发送到GCS或脚本，以及使用反方向的命令发送数据包。 <br><br> 您可以在本地网络上记录PC或平板电脑的IP地址，而不用本地地址和端口，并且数据包将立即在那里广播。 <br><br><img src="https://habrastorage.org/webt/8p/no/vv/8pnovvpynimp8tvucgtqnbvqhls.png" alt="图片"><br><br> 但是，如果遥测数据未在其他任何地方使用且具有GCS的设备具有静态IP地址，则此方法是合理的。 否则，每次必须在设置中注册新的Ardupilot。 为了通过TCP与自动驾驶仪通信，车载计算机上的多个具有动态地址的GCS和其他脚本可以同时使用，使用MAVProxy更为方便。 <br><br><img src="https://habrastorage.org/webt/lt/gu/o6/ltguo6ghxcrnv8syshno6arbwi8.png" alt="图片"><br><br> 该脚本（用Python编写）可以接收到本地UDP地址的MAVLink数据包，并将它们通过UDP和TCP中继到几个本地或远程IP地址。 数据包被双向发送到Ardupilot⇔GCS。 此外，MAVProxy是成熟的GCS，但具有文本界面。 <br><br><h3>  MAV代理 </h3><br>  Navio映像中已经安装了MAVProxy。 也可以将其<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">安装</a>在PC（Windows，Linux，MacOS）上，以便在控制台模式下与自动驾驶仪进行进一步的通信。 <br><br> 确保Ardupilot正常运行后，使用以下命令在Raspberry上运行MAVProxy脚本： <br><br><pre> <code class="bash hljs">mavproxy.py --master=udp:127.0.0.1:14550</code> </pre> <br>  <i>--master = udp：127.0.0.1：14550参数</i>设置脚本的数据源。 这是在Ardupilot配置文件中注册的本地UDP端口。 运行命令后，MAVProxy将连接到此端口并显示自动驾驶仪消息，类似于我的： <br><br><pre> <code class="bash hljs">pi@navio:~ $ mavproxy.py --master=udp:127.0.0.1:14550 Connect udp:127.0.0.1:14550 source_system=255 Failed to load module: No module named adsb. Use <span class="hljs-string"><span class="hljs-string">'set moddebug 3'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the MAVProxy console to <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> traceback Log Directory: Telemetry <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>: mav.tlog Waiting <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> heartbeat from 127.0.0.1:14550 MAV&gt; online system 1 STABILIZE&gt; Mode STABILIZE fence breach GPS lock at 0 meters APM: APM:Copter V3.5.5 (88a1ecdd) APM: Frame: UNKNOWN APM: PreArm: RC Roll not configured APM: PreArm: Compass not calibrated APM: PreArm: 3D Accel calibration needed APM: PreArm: check firmware or FRAME_CLASS APM: PreArm: Throttle below Failsafe</code> </pre> <br> 由于自动驾驶仪尚未经过校准且尚未完全调整，因此消息也雄辩地谈到了这一点。 在这种模式下，您可以通过命令与自动驾驶仪通信。 如果将无人机完全调好，那么两个命令的顺序将导致引擎启动，并且无人机起飞到20 m的高度： <br><br><pre> <code class="bash hljs">arm throttle takeoff 20</code> </pre> <br> 未经校准的自动驾驶仪将不会飞行，但会显示消息，说明其无法执行此操作的原因。 <br><br><h3> 与局域网上的无人机建立通信 </h3><br> 停止脚本（ <i>Ctrl + C</i> ）并以这种形式再次运行它： <br><br><pre> <code class="bash hljs">mavproxy.py --master=udp:127.0.0.1:14550 --out=tcpin:0.0.0.0:5762</code> </pre> <br> 使用附加参数<i>--out = tcpin：0.0.0.0：5762，</i> MAVProxy将在端口5762上侦听来自GCS的传入TCP连接。  GCS连接后，数据包将开始在无人机和GCS之间移动。 让我们尝试从PC连接： <br><br><img src="https://habrastorage.org/webt/8e/zz/eb/8ezzebgztbjr6nkllbyefkdots0.png" alt="图片"><br><br> 如果连接成功，则GCS将显示一堆消息，要求校准传感器并使用其当前值加载板载参数： <br><br><img src="https://habrastorage.org/webt/mz/gy/co/mzgycobpds-e3bk7i5szgplvvey.png" alt="图片"><br><br><img src="https://habrastorage.org/webt/i1/bx/ms/i1bxms-du1v9tbqpemtfv-sgodw.png" alt="图片"><br><br><h3> 传感器校准和自动驾驶仪参数调整 </h3><br> 自动驾驶仪校准几乎可以在任何GCS中完成。  Ardupilot文档对其进行了详细描述。 首先，我们设置框架的类型。 我有一个标准的4电机布局，所以这是<i>QuadX。</i> <br><br><img src="https://habrastorage.org/webt/mv/gc/bi/mvgcbi8augohhzhrcfrnosuia-s.png" alt="图片"><br><br> 在手动模式下，第一次飞行还是更好。 我们连接并校准无线电控件（接收器和发射器）。 <br><br><img src="https://habrastorage.org/webt/dj/ay/xw/djayxw3ulzuaabk4ubn3qavp0d4.png" alt="图片"><br><br> 仍然需要校准加速度计和指南针。 <br><br><img src="https://habrastorage.org/webt/bm/rs/1r/bmrs1rhiwgxu2udg11td3t8slak.png" alt="图片"><br><br> 为了使Ardupilot查看并考虑来自外部传感器的数据，请设置必要的参数： <br><br> 对于<u>PX4Flow</u> （ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">传感器本身的校准和固件更新</a> ） <br><br> <code>FLOW_ENABLE = 1 (Enabled) <br> FLOW_ADDR = 0 (0 =     042)</code> <br> <br> 激光测高仪<u>VL53L0X</u> （使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">说明</a> ） <br><br> <code>RNGFND_TYPE = 16 (VL53L0X) <br> RNGFND_ORIENT = 25 (  ) <br> RNGFND_ADDR = 41 (I2C-   ).   - 0x29,     = 41. <br> RNGFND_SCALING = 1 <br> RNGFND_MIN_CM = 5 <br> RNGFND_MAX_CM = 120 <br> RNGFND_GNDCLEAR = 15 (    ,     )</code> <br> <br> 对于<u>IRLock</u> （ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">详细说明</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Wiki IR-Lock</a> ） <br><br> <code>PLND_ENABLED = 1 <br> PLND_TYPE = 2 <br> PLND_BUS = 1</code> <br> <br> 对于前视图声纳（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">说明</a> ） <br><br> <code>RNGFND2_TYPE = 2 (MaxbotixI2C sonar) <br> RNGFND2_ORIENT = 0 (  ) <br> RNGFND2_MAX_CM = 700 (   )</code> <br> <br>  Ardupilot <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">选项的</a>完整<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">列表</a> 。 <br><br> 现在从GCS菜单重新启动Ardupilot，重新连接到开发板并打开MAVLink检查器窗口以查看来自传感器的数据。 <br><br><img src="https://habrastorage.org/webt/6z/x_/8z/6zx_8zmfbc4nflyaxyz-h2yv8zs.png" alt="图片"><br><br> 不幸的是，IR-Lock的读数在这里看不到，为了对其工作进行分析，您必须查看机载日志。 在此说明如何执行此操作。 <br><br> 仍然需要配置安全性设置，您可以启动无人机： <br><br><img src="https://habrastorage.org/webt/ex/jp/x-/exjpx-pjkbvzmugdr-r1ujqpziw.png" alt="图片"><br><br> 如何配置陀螺仪悬架并详细控制主相机我将在以下文章之一中进行介绍， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>概述<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">了</a>要点。 <br><br><h3> 视频播放 </h3><br> 让我们检查一下视频广播在WiFi网络中的工作方式。 使用此命令，可以使用Raspicam相机的本机raspivid实用程序在Raspberry上的TCP端口中运行视频： <br><br><pre> <code class="bash hljs">raspivid -t 0 -hf -fps 25 -w 640 -h 480 -o - | gst-launch-1.0 fdsrc ! h264parse ! rtph264pay config-interval=1 pt=96 ! gdppay ! tcpserversink host=0.0.0.0 port=5001</code> </pre> <br> 但是此命令执行相同的操作，仅对gstreamer使用先前编译的rpi-camsrc包装器： <br><br><pre> <code class="bash hljs">gst-launch-1.0 rpicamsrc sensor-mode=4 ! h264parse ! rtph264pay config-interval=1 pt=96 ! gdppay ! tcpserversink host=0.0.0.0 port=5001</code> </pre> <br> 在这两种情况下，都可以在端口5001的Raspberry IP地址上进行h264广播。 <br><br> 您可以通过在PC上运行这样的命令来查看它（必须安装<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">gstreamer</a> ），而不是<i>RPI_ADDRESS，</i>而是在网络上指定Raspberry地址： <br><br><pre> <code class="bash hljs">gst-launch-1.0 -v tcpclientsrc host=RPI_ADDRESS port=5001 ! gdpdepay ! rtph264depay ! avdec_h264 ! videoconvert ! autovideosink sync=<span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br> 结果，带有视频的窗口应打开。 <br><br> 几乎所有GCS都有一个内置的视频播放器，可以显示RTSP视频流。 要从Raspberry制作RTSP服务器，可以使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">VLC</a>控制台<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">播放器</a> 。 安装方式： <br><br><pre> <code class="bash hljs">sudo apt-get install vlc</code> </pre> <br> 视频广播开始如下： <br><br><pre> <code class="bash hljs">raspivid -o - -t 0 -n -w 320 -h 240 -fps 25 | cvlc -vvv stream:///dev/stdin --sout <span class="hljs-string"><span class="hljs-string">'#rtp{sdp=rtsp://:8554/live}'</span></span> :demux=h264</code> </pre> <br> 该视频位于（而不是<i>RPI_ADDRESS</i> ，Raspberry地址）： <br><br> <code>rtsp://RPI_ADDRESS:8554/live</code> <br> <br>  GCS设置： <br><br><img src="https://habrastorage.org/webt/uk/x8/hu/ukx8huklwh9kxu5glz289xkzenq.png" alt="图片"><br><br><img src="https://habrastorage.org/webt/7r/og/gw/7roggwghpf_arhxggulllplkr6i.png" alt="图片"><br><br> 流地址可用于连接不同设备上的多个播放器，但是由于Raspberry的视频捕获和广播是一个非常耗时的过程，因此对于多个视频用户而言，最好使用外部服务器（如下所述）。 <br><br><h3> 互联网遥测 </h3><br> 为了使GCS通过Internet连接到具有动态IP地址的无人机，需要具有静态IP的中间服务器，在该服务器上将启动MAVProxy脚本。 为此，我利用了一家知名提供商的云服务器租赁服务。 对于MAVProxy，最最小的配置是合适的，但是由于我将使用同一台服务器来中继视频，因此我选择了具有更多内存的选项（一个核心和1GB内存，Ubuntu 18.04）。 为了使板与GCS之间的数据传输延迟最小，服务器应位于无人机和GCS的最大地理位置附近。 <br><br><img src="https://habrastorage.org/webt/eu/yl/3i/euyl3i1m1s5zjyjl5suhj0gw4sg.png" alt="图片"><br><br> 在服务器上安装MAVProxy。 首先依赖： <br><br><pre> <code class="bash hljs">sudo apt-get install python-dev python-opencv python-wxgtk3.0 python-pip python-matplotlib python-pygame python-lxml python-yaml</code> </pre> <br> 然后通过PIP脚本本身： <br><br><pre> <code class="bash hljs">sudo pip install MAVProxy</code> </pre> <br> 写下路径： <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"export PATH=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$PATH</span></span></span><span class="hljs-string">:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HOME</span></span></span><span class="hljs-string">/.local/bin"</span></span> &gt;&gt; ~/.bashrc</code> </pre> <br> 并使用以下参数运行脚本： <br><br><pre> <code class="bash hljs">mavproxy.py --master=udp:0.0.0.0:15001 --out=tcpin:0.0.0.0:15002</code> </pre> <br>  MAVProxy在端口15001上监听通过UDP从无人机传来的遥测数据包，在端口15002上监听从GCS传入的TCP连接。 <br><br> 在Raspberry上使用另一个参数运行MAVProxy，以便遥测也广播到服务器（而不是<i>SERVER_IP</i>服务器<i>的</i>地址）： <br><br><pre> <code class="bash hljs">mavproxy.py --master=udp:127.0.0.1:14550 --out=tcpin:0.0.0.0:5762 --out=udpout:SERVER_IP:15001</code> </pre> <br> 在车载计算机上启动脚本后，来自自动驾驶仪的消息将出现在服务器控制台中。 如上所述，MAVProxy是具有文本界面的成熟GCS，在这种状态下，已经可以通过服务器控制台中的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">命令</a>来编辑参数并控制无人机。 <br><br> 将PC或平板电脑上的GCS连接到服务器。 连接设置与本地网络相同，只是我们指定了服务器地址和端口15002而不是Raspberry IP地址。 <br><br><img src="https://habrastorage.org/webt/8m/ed/rc/8medrcfonj1lsyr1wvufdi2elom.png" alt="图片"><br><br> 现在，您可以将4G USB调制解调器连接到Raspberry，并评估屏幕水平响应的延迟。 <br><br><h3> 网络视频 </h3><br><img src="https://habrastorage.org/webt/7i/w2/ow/7iw2owafcz4bjjmwu116q9tr65i.png" alt="图片"><br><br> 要中继视频，请在服务器上安装VLC播放器： <br><br><pre> <code class="bash hljs">sudo apt-get install vlc</code> </pre> <br> 安装后，将其作为中继从RTSP通道<i><b>SERVER_IP：8554 / live</b></i>中的UDP端口5001运行： <br><br><pre> <code class="bash hljs">cvlc -vvv udp://@:5001 --sout <span class="hljs-string"><span class="hljs-string">'#rtp{sdp=rtsp://:8554/live}'</span></span> :demux=h264</code> </pre> <br> 在船上，我们将开始通过UDP（而不是<i>SERVER_IP</i>服务器地址）从摄像机到服务器的视频广播： <br><br><pre> <code class="bash hljs">gst-launch-1.0 rpicamsrc bitrate=1000000 ! video/x-h264,width=640,height=480,framerate=25/1 ! h264parse ! udpsink host=SERVER_IP port=5001</code> </pre> <br> 现在，该流地址可以在GCS设置中用作视频源，也可以在任何支持此协议的播放器中打开。 <br><br> 现在，您可以计划飞行路线并通过互联网（例如，使用电话助手将其打开）来启动无人驾驶飞机。 <br><br> 显然，由于视频和遥测在网络上的旅行时间较长，因此该方法几乎不适合在障碍物之间以手动模式进行的FPV飞行。 <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/43rqRE9f1hA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br> 后续出版物的主题： <br><br><ul><li> 自动为我的禽舍中的无人机以及我停在哪的无人机充电的选项。 </li><li> 使用MAVProxy，NodeJS，socket.io和媒体服务器来实现基于Web的GCS，以同时管理多个无人机。 </li><li> 冗余通信渠道和无人机救援系统 </li><li> 机器视觉和激光雷达，避免与障碍物碰撞 </li></ul><br> 待续... </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN414587/">https://habr.com/ru/post/zh-CN414587/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN414577/index.html">背离：暗黑破坏神逆向工程项目</a></li>
<li><a href="../zh-CN414579/index.html">Google AI已学会预测患者何时死亡（但并非一切都如此严峻）</a></li>
<li><a href="../zh-CN414581/index.html">他的按钮在哪里？ 一个简单的人如何从Kibana和Elasticsearch卸载数据而不会给开发人员带来压力</a></li>
<li><a href="../zh-CN414583/index.html">RIT ++，Tech RaDarts和所有所有</a></li>
<li><a href="../zh-CN414585/index.html">我的String.getBytes（UTF_8）如何损坏以及如何处理</a></li>
<li><a href="../zh-CN414593/index.html">C＃和JavaScript的比较。 基础知识</a></li>
<li><a href="../zh-CN414597/index.html">问伊森：外星文明可以接近多远？</a></li>
<li><a href="../zh-CN414601/index.html">当山高而笔记本电脑大时：更多的IT历史</a></li>
<li><a href="../zh-CN414605/index.html">迷你帝国</a></li>
<li><a href="../zh-CN414609/index.html">2018 PWA（Progressive Web Apps）能否与本地应用程序抗衡？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>