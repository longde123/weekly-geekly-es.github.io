<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😩 🛥️ 🔎 使用音频代码VoIP网关删除电话线 👳🏿 👲🏿 🗃️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在我们以前的一篇文章中，我们研究了使用一对Grandstream语音网关拆除订户电话线的问题。 自发布以来，我们的许多客户注意到本文对他们非常有用，并帮助他们轻松快速地解决了问题。 同时，另一部分客户要求我们为其他流行的网关模型编写类似的文章说明。 兑现他的诺言，今天我们将考虑如何使用以色列著名的A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>使用音频代码VoIP网关删除电话线</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/arttel/blog/404399/"> 在我们以前的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一篇文章中，</a>我们研究了使用一对Grandstream语音网关拆除订户电话线的问题。 自发布以来，我们的许多客户注意到本文对他们非常有用，并帮助他们轻松快速地解决了问题。 同时，另一部分客户要求我们为其他流行的网关模型编写类似的文章说明。 兑现他的诺言，今天我们将考虑如何使用以色列著名的AudioCodes公司的设备来组织删除部分编码能力。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/db4/2dd/d52/db42ddd5240a4f7083711199aa0680bd.jpg"></div><br><a name="habracut"></a><br> 我们简要回顾一下问题的陈述-总公司设有模拟电话交换机和内部编号401、402，依此类推。 还有一个远程办公室（在另一座建筑物，城市或国家/地区），不可能从主机PBX延伸电话线，但是您需要将四个号码为601-604的用户连接到该办公室。 <br><br> 在总部，我们安装带有FXO端口的AudioCodes VoIP网关-例如， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MP-114 / FXO</a>或<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MP-118 / FXO</a> 。 在远程办公室，我们将使用具有FXS端口的网关-MP <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-114 / FXS</a>或<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MP-118 / FXS</a> 。 在总部电话交换处，我们选择四个内部端口，我们给它们提供编号601-604，并将这些端口连接到FXO网关的四个端口（为简单起见，在下文中，我们将使用MP-114 / FXO型号）。 目前，在远程办公室一侧，只需将四个普通电话机连接到MP-114 / FXS网关的FXS端口即可。 两个网关都必须连接到本地网络并具有静态IP地址。 <br><br><img src="https://habrastorage.org/web/6fd/b96/e8c/6fdb96e8c7994c88a9e41f3f1aa20d3d.jpg"><br><br> 现在我们需要解决两个问题： <br><br><ol><li> 允许总部的用户（编号401、402等）呼叫远程办公室的用户（编号601-604） </li><li> 允许远程办公室用户呼叫公司总部用户 </li></ol><br><h3> 任务1.从总部到远端的呼叫 </h3><br><h4> 阶段1.激活FXO网关上的线路 </h4><br> 除了端口或通道之类的概念外，AudioCodes网关还使用“ <b>寻线组”</b>的概念进行操作，即将多个通道逻辑组合成一个组。 在寻线组的帮助下，将来您可以配置一个相当复杂的呼叫路由逻辑。 对于我们来说，此功能是多余的，因为我们使用的方案是点对点的，并且无论如何从PBX到FXO网关的所有呼叫都无法发送到任何地方，除非发送到远程办公室的FXS网关。 但是，要激活线路，我们需要给它们指定一个唯一的编号并将它们组合到某个寻线组中，否则该方案将无法正常工作。 <br><br> 我们转到<b>配置-VoIP-GW和IP到IP-寻线组-端点电话号码</b>部分，并将行601到604分配给1-4行，并将寻线组中的所有行与号码1合并。 <br><br> <a href=""><img src="https://habrastorage.org/web/a9e/78e/4c8/a9e78e4c820544c6ba4adebd47de890a.jpg"></a> <br><br><h4> 阶段2.在FXO网关上启用路由表 </h4><br> 现在，我们需要FXO网关使用路由表来路由呼叫，我们将在下一步中进行填写。 我们转到“ <b>配置-VoIP-SIP定义-代理和注册”部分</b> 。 我们设置以下选项： <b>启用对路由表的回退</b>以<b>启用，</b>而<b>将路由表优选</b>为<b>是</b> 。 单击左下角的<b>提交</b>以保存设置。 <br><br> <a href=""><img src="https://habrastorage.org/web/ec7/119/686/ec7119686c9d474592b968db7c5b73d4.jpg"></a> <br><br><h4> 阶段3.在FXO网关上填写呼叫路由表 </h4><br> 在最后阶段，我们将AudioCodes MP-114 / FXO FXO网关配置为使用路由表优先级，现在我们需要填写此表。 为此，请转到“ <b>配置-VoIP-GW和IP至IP-路由-电话至IP路由”</b>部分。 如上所述，此路由表将具有相当原始的外观。 即：来自任何寻线组（并且我们只有一个）的所有呼叫，从任何号码（端口）到任何号码的呼叫，都应定向到远程办公室中安装的FXS网关的IP地址。 <br><br> <a href=""><img src="https://habrastorage.org/web/9f7/fa8/3ea/9f7fa83ea93c4f1ba4181bd1667abe33.jpg"></a> <br><br><h4> 步骤4.在FXO网关上替换呼叫方号码 </h4><br> 目前，我们已确保从PBX到FXO网关的所有呼叫都将重定向到远程FXS网关的IP地址。 但是，存在一个小问题，在默认情况下，FXO网关将用该呼叫所到达的线路号替换来自PBX的原始CallerID。 也就是说，到达网关第一行的所有呼叫都将被发送到具有CallerID 601的远程FXS网关，再发送到第二个-从602开始，以此类推。 也就是说，远程办公室的订户将总是看到自己的电话号码，而不是同事的城市号码或内部号码。 <br><br> 为了避免这种情况，我们将转到“ <b>配置-VoIP-GW和IP到IP-模拟网关-呼叫者ID权限”</b>部分。 并在所有四个端口上设置<b>Enable</b> 。 <br><br> <a href=""><img src="https://habrastorage.org/web/000/ed1/110/000ed11104fa4e2fb9d5ac80dea3c398.jpg"></a> <br><br><h4> 阶段5.在FXO网关上自动拨打远程号码 </h4><br> 现在是时候问以下问题：如果所有电话都将FXO网关不加选择地发送到远程FXS网关，甚至使用原始的CallerID，那么我们的远程FXS网关如何找出与它相连的电话还是另一个挑战？ <br><br> 要解决此问题，我们使用“目标电话号码”字段，即在“ <b>配置-VoIP-GW和IP到IP-模拟网关-自动拨号”</b>部分中配置的目标号码。 如果呼叫到达网关的端口号1，它将在此字段中替换601，并将呼叫转移到FXS网关。 对于呼叫2号端口，“目标电话号码”字段将替换为602，依此类推。  FXS网关将在此字段的基础上，我们稍后将看到，它将在与其连接的设备之间分配呼叫。 <br><br> <a href=""><img src="https://habrastorage.org/web/36c/959/8ce/36c9598ce5dc4b10b830ecc4f946a65b.jpg"></a> <br><br><h4> 步骤6.在FXS网关上激活线路 </h4><br> 我们已经完成了FXO网关上与子任务1有关的所有工作，我们可以安全地转到远程分支来配置FXS网关。 在这里，我们还必须首先激活线路并将它们组合为一个寻线组。 转到<b>配置-VoIP-GW和IP到IP-寻线组-端点电话号码</b>部分，并用完全类似的FXO网关填充它：给1-4行唯一的数字601-604，并将它们组合成一个具有1号的寻线组。但是，应该注意的是，如果将所有数字组合到一个寻线组中是相当正式的，那么将数字分配给行是一个基本设置，我们将在后面看到。 <br><br> <a href=""><img src="https://habrastorage.org/web/d2d/954/2fc/d2d9542fc09943a1ae468000277e2bc6.jpg"></a> <br><br><h4> 步骤7.在FXS网关上路由来电 </h4><br> 这也是一个相当正式的设置-在“ <b>配置-VoIP-GW和IP到IP-路由-IP到寻线组路由表”</b>部分中，我们指示从FXO网关IP地址的任何号码到任何号码的呼叫均应通过以下方式定向到寻线组：数字1.它已经与我们合而为一，并结合了所有四个端口。 <br><br> <a href=""><img src="https://habrastorage.org/web/9d4/31c/5ef/9d431c5ef89f44098b8da106a7c99f7d.jpg"></a> <br><br><h4> 步骤8.在FXS网关上配置寻线组行为 </h4><br> 但是，与此相反，此设置是最重要的：之前我们配置了FXO网关，以便它根据呼叫所到达的线路来填充“目标电话号码”字段。 现在，我们需要配置FXS网关，以便它根据此信息在其电话之间分配呼叫。 我们转到<b>``配置-VoIP-GW和IP到IP-寻线组-寻线组设置''</b>部分，并为我们唯一的寻线组的操作设置规则：在<b>``寻线组ID''</b>选项中，将其设置为1（这是我们唯一组的ID），在<b>``通道选择模式''</b>选项中，选择“ <b>按目的地的电话号码”</b>选项，即按目的地号码选择线路，然后在“ <b>注册模式”</b>选项中，选择<b>“不注册”</b>模式。 <br><br> 也就是说，在接收到带有目的地号码的呼叫（例如-603）之后，FXS网关会将此呼叫发送到其号码为603的线路。因此，在步骤6中为线路分配号码是基本的-这些号码必须与步骤5中指定的号码一致。关于<b>“不注册”</b>选项-这里的一切都很简单，我们不将网关与IP-PBX结合使用，而是与其他网关在点对点模式下使用，因此与我们的所有工作都在非注册模式下进行。 <br><br> <a href=""><img src="https://habrastorage.org/web/041/279/90b/04127990b6694bb2ba3e91a325e9bb1a.jpg"></a> <br><br><h4> 步骤9.验证 </h4><br> 我们从总部拿起任何内部电话，然后拨打601-呼叫应该转到连接到FXS网关第一个端口的电话。 拨打602时-第二秒，依此类推。 如果一切正常，则可以认为任务1的工作已完成，然后转到第二个任务。 <br><br><h3> 任务2.从远程办公室到总部的呼叫 </h3><br><h4> 步骤1.在FXS网关上路由去电 </h4><br> 实际上，我们已经完成了解决第二个问题的大部分工作-我们激活了网关上的线路，分配了它们的编号并将它们组合在寻线组中。 现在，实际上，我们需要镜像前面步骤中所做的设置。 <br><br> 转到FXS网关上的“ <b>配置-VoIP-GW和IP至IP-路由-电话至IP路由”</b>部分，并创建一条规则，该规则规定应将来自任何寻线组（从任意号码到任意号码）的呼叫发送到FXO IP地址网关。 如您所见，填写FXS网关上的路由表与FXO网关上的路由表完全相似。 原则上，这完成了MP-114 / FXS网关的配置，我们可以返回公司总部的MP-114 / FXO网关。 <br><br> <a href=""><img src="https://habrastorage.org/web/4ea/27b/911/4ea27b9119724d62b9ddbdfcf4233cf6.jpg"></a> <br><br><h4> 步骤2.在FXO网关上路由来电 </h4><br> 请记住，在AudioCodes网关上路由呼叫的主要实体是所谓的寻线组。 因此，首先，我们需要配置FXO网关，以便来自FXS网关的所有呼叫都转到唯一的1号寻线组。转到“ <b>配置-VoIP-GW和IP到IP-路由-IP寻线组路由表”</b>部分并创建一个规则。 在选项中<b>。</b>  <b>“电话前缀”</b>和“ <b>源电话前缀”</b>设置符号“ *”，在“ <b>源IP地址”</b>选项中指定FXS网关的IP地址，在“ <b>寻线组ID”</b>选项中-数字1。一切，现在所有从FXS网关来的任何号码到任何号码的所有呼叫将由第一狩猎组织处理。 以及如何在那里处理它们，我们将在下一步中进行配置。 <br><br> <a href=""><img src="https://habrastorage.org/web/000/17f/ced/00017fced7924ff99173ae614470f1f7.jpg"></a> <br><br><h4> 阶段3.在FXO网关上配置寻线组行为 </h4><br> 因此，我们不加区别地将所有呼叫从FXS网关发送到FXO网关的寻线组1。 但是，后者需要了解他应该通过哪条线路进一步向PBX发送呼叫，因为远程办公室中的每个用户在FXO网关上都有特定的线路，因此在PBX上有一个端口。 为此，我们需要转到“ <b>配置-VoIP-GW和IP到IP-寻线组-寻线组设置”</b>部分，并指出应将寻线组1的所有呼叫按照线路通过源号码发送到PBX。 从技术上讲，这是按照以下步骤完成的：在<b>``</b>寻线组<b>ID''</b>选项中，将该值设置为1（这是我们的寻线组的ID），在`` <b>频道选择模式''</b>选项中，选择<b>``按源电话号码''</b>选项，然后在<b>``注册模式''</b>选项中，选择<b>``不注册''</b>模式。 <br><br> <a href=""><img src="https://habrastorage.org/web/d12/afc/1eb/d12afc1eb95a4902a157953fd4e83241.jpg"></a> <br><br> 为了改善此逻辑，请考虑在尝试从远程订户拨打号码时，FXO网关从FXS网关接收的INVITE方法的SIP消息部分： <br><br><pre><code class="bash hljs">INVITE sip:401@192.168.4.21;user=phone SIP/2.0 Via: SIP/2.0/UDP 192.168.4.22:5060;branch=z9hG4bKac2108928548 Max-Forwards: 70 From: &lt;sip:601@gateway.com&gt;;tag=1c2108923745 To: &lt;sip:401@192.168.4.21;user=phone&gt;</code> </pre> <br> 如您所见，SIP消息包含两个“ <b>发件人”</b>和“ <b>收件人”</b>字段。 在“ <b>发件人”</b>字段中，指示号码601-从该号码开始，从远程办公室进行呼叫，并且FXO网关基于此字段使用其601线路将此呼叫转移到PBX。 如果返回到第一个任务的第一阶段，我们将看到数字601对应于FXO网关的第一个端口。  “ <b>收件人”</b>字段确定呼叫将被发送到的号码（在这种情况下为401）是总部的内部号码。  192.168.4.21是FXO网关的IP地址，而192.168.4.22是FXS网关的IP地址。 <br><br><h4> 步骤4.一步建立一个呼叫 </h4><br>  Audiocodes MP-114 FXO网关具有从IP网络到模拟线路进行呼叫的两种模式：两次操作（两个阶段）和一次操作（一个阶段）中的呼叫。 它们之间的区别如下：在双向呼叫模式下，到达网关的呼叫将由网关本身应答并切换到PBX端口，呼叫者将听到通常的哔哔声，就好像他只是拿起电话一样，然后您需要拨打电话号码，需要致电。 在单呼叫模式下，网关将根据指定的设置立即将呼叫重定向到模拟端口。 <br> 在我们的示例中，由于呼叫者的号码和被叫方的号码是在FXS网关侧形成的，因此我们将需要一种单步模式（一级）。 为此，请在“ <b>配置”“ VoIP”“ GW和IP到IP”“模拟网关”“ FXO设置”</b>部分中，在“ <b>拨号模式”</b>选项中选择“ <b>单阶段”</b>模式。 <br><br> <a href=""><img src="https://habrastorage.org/web/82b/d97/d43/82bd97d432ed41b1bf3e32bcc85683f7.jpg"></a> <br><br><h4> 步骤5.验证和诊断 </h4><br> 至此，电话线拆除的设置已基本完成，只需致电双方就可以进行一些标准检查，并确保一切工作正常。 如果由于某种原因某件事不起作用，或者您解决了另一个问题，例如，不在同一位置取出多条线路，而是在多个位置取出线路，则应该使用AudioCodes网关内置的调试工具来查找和解决问题。 <br><br> <a href=""><img src="https://habrastorage.org/web/325/414/c80/325414c80af540bca3d155aa956b9c6e.jpg"></a> <br><br> 最简单的方法是直接在设备的Web界面的<b>状态和诊断-系统状态-消息日志</b>部分中<b>查看消息日志</b> 。 但是，在撰写本文时，我曾使用向Syslog服务器发送消息的方式，在“ <b>配置-系统-Syslog设置”</b>部分中进行了<b>设置</b> 。 作为系统日志服务器，使用了rsyslog。 为了在Rsyslog守护程序的配置文件中接收消息日志，必须存在以下设置： <br><br><pre> <code class="hljs sql">module(<span class="hljs-keyword"><span class="hljs-keyword">load</span></span>=<span class="hljs-string"><span class="hljs-string">"imudp"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>=<span class="hljs-string"><span class="hljs-string">"imudp"</span></span> port=<span class="hljs-string"><span class="hljs-string">"514"</span></span>) $<span class="hljs-keyword"><span class="hljs-keyword">template</span></span> FILENAME,<span class="hljs-string"><span class="hljs-string">"/var/log/rsyslogd/%fromhost-ip%.log *.* ?FILENAME</span></span></code> </pre><br><h4> 结论 </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">AudioCodes</a>网关因其灵活性，可靠性和功能性而受到许多专业人士的重视。 同时，由于存在大量选项和设备的特殊逻辑，它们的配置可能给缺乏经验的用户带来很大的困难。 但是，经过一段时间后，您会逐渐熟悉这些网关，您会意识到一切都在逻辑上正确地实现了。 我希望本文能帮助初学者尽可能轻松地完成探索AudioCodes的第一阶段。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN404399/">https://habr.com/ru/post/zh-CN404399/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN404389/index.html">Atmotube Atmosphere Tube-便携式空气质量传感器</a></li>
<li><a href="../zh-CN404391/index.html">80级打印机。 爱普生WorkForce Enterprise</a></li>
<li><a href="../zh-CN404393/index.html">Bobby Compact-新一代“防盗”背包</a></li>
<li><a href="../zh-CN404395/index.html">有关SCUMM引擎的故事</a></li>
<li><a href="../zh-CN404397/index.html">热量如何杀死细胞</a></li>
<li><a href="../zh-CN404401/index.html">汽水比平时危害更大吗？</a></li>
<li><a href="../zh-CN404403/index.html">“娱乐界的艺术”：艺术家在游戏行业中的行为</a></li>
<li><a href="../zh-CN404405/index.html">WOW可能来自彗星，而不是来自地球外的情报。</a></li>
<li><a href="../zh-CN404407/index.html">Polybius在ICO筹集了开设欧洲银行所需的资金</a></li>
<li><a href="../zh-CN404411/index.html">五月份的云挖掘结果：每年高达379％</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>